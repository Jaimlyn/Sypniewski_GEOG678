// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError dojo/promise/all ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/support/aaBoundingBox ../../IntegratedMeshLayer ../../SceneLayer ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../views/3d/lib/gl-matrix ../../../views/3d/support/projectionUtils ../../../views/3d/support/ResourceController".split(" "),
function(p,b,m,l,v,f,x,k,A,y,B,d,n,a,g,q,c,u,N,J,D,G,ha,C,K,R,Y,Z,ca,la){function F(a,c){return a.length===c.length&&a.every(function(a){return 0<=O(c,a.name)})}function O(a,c){c=c.toLowerCase();for(var g=0;g<a.length;g++)if(a[g].name.toLowerCase()===c)return g;return-1}var Q=d.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");p=function(a){function d(c){c=a.call(this)||this;c.nodeIndex={};c.screenSizeFactor=0;c.featureTarget=5E4;c.updating=!0;c.updatingPercentage=0;c.leafsReached=
!1;c.uncompressedTextureDownsamplingEnabled=!1;c.alwaysLoadEverythingModeEnabled=!1;c._lodFactorProperty=null;c._featureLOD=1;c._stableFeatureLOD=!1;c._isIdle=!1;c._cameraDirty=!0;c._hasFeatures=!1;c._downloadingNodes=new Set;c._loadingNodes=new Set;c._updatingNodes=new Map;c._progressMaxNumNodes=1;c._poi=null;c._requiredAttributesDirty=!0;c._updatesDisabled=!1;c.disableCache=!1;c._restartNodeLoading=!1;c._fields=null;c._attributeStorageInfo=null;c._handles=new y;c._idleQueue=new Y.IdleQueue;c._errorCount=
0;return c}m(d,a);Object.defineProperty(d.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(la.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer instanceof
D&&this.layer.definitionExpression)try{var a=u.create(this.layer.definitionExpression);if(!a.isStandardized())return Q.error("definitionExpression is using non standard function"),null;var c=[],d=a.getFields();K.findFieldsCaseInsensitive(d,this.layer.fields,{missingFields:c});return 0<c.length?(Q.error("definitionExpression references unknown fields: "+c.join(", ")),null):a}catch(P){return Q.error("Failed to parse definitionExpression: "+P),null}else return null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return K.findFieldsCaseInsensitive(a,this._fields)}return null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"crsVertex",{get:function(){return K.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"crsIndex",{get:function(){return K.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):!0},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){a._updateIdleState(!0)},idleEnd:function(){a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended={idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=
new ha(this.layerView,function(){return a.updatingChanged()});var c=this.layerView.layer;this.layer=c;this._defaultGeometrySchema=c.store.defaultGeometrySchema;this._rootNodeUrl=c.store.rootNode;var d=this._rootNodeUrl.split("/");this._rootNodeId=d[d.length-1];this.disableCache=B("disable-feature:idb-cache");c instanceof D?("mesh"===c.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===c.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),
this._fields=c.fields,this._attributeStorageInfo=c.attributeStorageInfo):c instanceof J&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");c=f([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var c=a.layerView.view;a.setClippingArea(c.clippingArea);a._centerOnSurface=c.pointsOfInterest.centerOnSurfaceFrequent;a._handles.add(a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}));
var d=a.layerView.view.resourceController;d.memoryEvents.on("quality-changed",function(){return a._setCameraDirty()});a._handles.add(q.init(a.layerView,"suspended",function(c){a._idleFrameWorker&&(a._idleFrameWorker.remove(),a._idleFrameWorker=null,a.restartNodeLoading());a._frameWorker&&(a._frameWorker.remove(),a._frameWorker=null);c?a._idleFrameWorker=d.registerIdleFrameWorker(a.updateEventListenerWhileSuspended):(a._idleFrameWorker=d.registerIdleFrameWorker(a.updateEventListener),a._frameWorker=
d.registerFrameWorker(function(c){return a._frame(c)}))}),"layerview");a._handles.add(a.layer.watch("elevationInfo",function(c){return a._elevationInfoChanged(c)}),"layer");a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()});a.watch("alwaysLoadEverythingModeEnabled",function(){return a.restartNodeLoading()});a._handles.add(c.state.watch("camera",function(){return a._setCameraDirty()}));a._handles.add(a.watch("featureTarget",function(){a._stableFeatureLOD=!1}));
a._lodFactorProperty&&a._handles.add(a.layerView.view.watch(a._lodFactorProperty,function(){return a._setCameraDirty()}),"quality")}});this.addResolvingPromise(c);this.when(function(){return a._startNodeLoading()})};d.prototype.destroy=function(){this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null);this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._handles.destroy();this._nodeLoader=null};d.prototype._getRequiredAttributes=function(){if(!(null!=
this._attributeStorageInfo&&this.layer instanceof D&&this._fields))return[];var a=Object.create(null);this.layer.renderer&&this.layer.renderer.collectRequiredFields(a);this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(c){c._collectRequiredFields(a)});if(null!=this.definitionExpressionFields)for(var c=0,d=this.definitionExpressionFields;c<d.length;c++)a[d[c]]=!0;var g=this._attributeStorageInfo,u=this._fields,q=this.layer.objectIdField;return Object.keys(a).map(function(a){var c=
O(g,a);a=O(u,a);return 0<=c&&0<=a?{index:c,name:u[a].name,field:u[a],attributeStorageInfo:g[c]}:null}).filter(function(a){return null!=a&&a.name!==q}).sort(function(a,c){return c.index-a.index}).filter(function(a,c,d){return 0===c||d[c-1].index!==a.index})};d.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};d.prototype._labelingChanged=function(){var a=this._requiredAttributes,c=this._getRequiredAttributes();F(a,c)||this._requiredFieldsChange()};
d.prototype.setClippingArea=function(a){var c=N.create();ca.extentToBoundingBox(a,c,this.layerView.view.renderSpatialReference)?this._clippingArea=c:this._clippingArea=null};d.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=M.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))};d.prototype._calculatePointOfInterest=
function(a){void 0===a&&(a=Z.vec3d.create());var c=this._centerOnSurface.renderLocation,d=Z.vec3d.create();Z.vec3d.subtract(c,this.camPos,d);Z.vec3d.normalize(d);var g=this.layerView.view.renderCoordsHelper,u=Z.vec3d.create();g.worldUpAtPosition(c,u);d=Math.acos(Z.vec3d.dot(u,d))-.5*Math.PI;Z.vec3d.lerp(this.camPos,c,Math.max(0,Math.min(1,d/(.5*Math.PI))),a);return a};d.prototype.updateClippingArea=function(a){this.setClippingArea(a);this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};
d.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.updatingChanged()};d.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};d.prototype.updateElevationChanged=function(a,c,d){K.findIntersectingNodes(a,c,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(a){d.push(a)});for(a=0;a<d.length;a++)c=d.data[a],this._viewportQueries.invalidateCache(c.id),c.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");d.length&&this.restartNodeLoading()};d.prototype._elevationInfoChanged=
function(a){this._viewportQueries.invalidateCache();this._initViewData()};d.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};d.prototype.schedule=function(a,c){var d=this;return this._idleQueue.push(c).then(function(c){if(!d._loadingNodes.has(a)&&!d._updatingNodes.has(a))throw new v;return c})};d.prototype.reschedule=function(a,c){var d=this;return this._idleQueue.unshift(c).then(function(c){if(!d._loadingNodes.has(a)&&!d._updatingNodes.has(a))throw new v;
return c})};d.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0};d.prototype._frame=function(a){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty);this.layerView.visible&&this._processLogError(a,!1)};d.prototype._processLogError=function(a,c){void 0===c&&(c=!0);try{this._process(a,c)}catch(ia){50>this._errorCount?Q.error("Error during processing: "+ia):50===this._errorCount&&Q.error("Too many errors for this layer. Further errors will not be displayed."),
this._errorCount++}};d.prototype._process=function(a,c){var d=this;this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateViewData()&&(c=!1);var g=function(d){(c||!a.done())&&d()&&(c=!1)};g(function(){return d._processIndex()});for(g(function(){return d._processNodes(a,c)});0<this._idleQueue.length()&&(c||!a.done());)c=!1,this._idleQueue.process();this._updateFeatureLOD();g(function(){return d._prefetchIndex()});this.updatingChanged();
this._lodHandling.lodGlobalHandling()}};d.prototype._processIndex=function(){var a=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.update(k.keysOfSet(this._loadingNodes));var c=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||c===this._get("leafsReached")||this._set("leafsReached",c);return this._index.load(a)};d.prototype._prefetchIndex=function(){if(0<this._loadingNodes.size)return!1;var a=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));
return this._index.prefetch(a)};d.prototype._updateFeatureLOD=function(){var a=this._index.getFeatureEstimate(),c=this.featureTarget*this._getLOD()/this._featureLOD;if(a.estimate){var d=!this._index.isLoading();if(!d&&!this._index.isPrefetching()&&500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(d&&a.estimate<c){if(1E4<=this._featureLOD||a.leafsReached||this._stableFeatureLOD)return;d=this._featureLOD;this._featureLOD*=1+Math.min(.1*
(c/a.estimate-1),.1);if(!this._index.checkFeatureTarget(c,this._getLOD())){this._featureLOD=d;this._stableFeatureLOD=!0;return}}else if(a.estimate>1.2*c||d&&a.estimate>c){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(a.estimate/c-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._getLOD());this._index.requestReload()}};d.prototype._processNodes=function(a,c){var d=this,g=this._index.getUpdates((this._isIdle?
100:2)-this._loadingNodes.size);g.cancel.forEach(this._cancelNodeIdLoading,this);g.update.forEach(function(g){if(c||!a.done())c=!1,d._updateLoadedNode(g)});g.add.forEach(function(g){if(c||!a.done())c=!1,d._loadNode(g)});return!c};d.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.clear();this._downloadingNodes.clear();this._updatingNodes.forEach(function(c,d){return a._updatingNodes.get(d).cancel()});this._updatingNodes.clear()};d.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.delete(a);
this._downloadingNodes.delete(a)};d.prototype._getAvailableLoadTokens=function(a){return Math.floor((12-1*this._index.getIndexLoading()-2*this._downloadingNodes.size)/a)};d.prototype._hasNodeLoadToken=function(){return this._downloadingNodes.size>=(this._isIdle?5:2)?!1:0<this._getAvailableLoadTokens(2)};d.prototype.updatingChanged=function(){var a=this._index?this._index.getIndexMissing():0,c=this._index?this._index.getNodesMissing():0,a=a+3*c+2*this._loadingNodes.size,c=!(!(0<a||0<this._updatingNodes.size||
this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length()||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);c!==this._get("updating")&&this._set("updating",c);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};d.prototype._initViewData=function(){var a=this.layerView.view,
c=a.state.camera,d=a.renderCoordsHelper;this.camPos=Z.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/c.perPixelRatio;this._poi=this._calculatePointOfInterest();var g=this._getLOD();this._viewportQueries=new R(this.crsIndex,d,c,this._poi,this._clippingArea,a.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,g),screenspaceErrorBias:g,angleDependentLoD:.5>g,disableLod:this.alwaysLoadEverythingModeEnabled});this._cameraDirty=
!1;this.notifyChange("rootNodeVisible")};d.prototype._updateViewData=function(){if(!this._cameraDirty||!this._index)return!1;var a=this.layerView.view,c=a.state.camera;this.camPos=Z.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/c.perPixelRatio;this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(c);this._viewportQueries.updatePointOfInterest(this._poi);a=this._getLOD();this._viewportQueries.updateScreenSpaceErrorBias(a);this._index.progressiveLoadPenalty=
M.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestReload();this._stableFeatureLOD=!1;a=!this.alwaysLoadEverythingModeEnabled&&this._removeInvisibleNodes();this._cameraDirty=!1;this.notifyChange("rootNodeVisible");return a};d.prototype._getProgressiveLoadFactor=function(a,c){return a instanceof D&&"mesh"===a.geometryType?(a=1<=c&&B("enable-feature:progressive-3dobject"))?M.factor3dObject:1:a instanceof J?(a=1<=c&&!B("disable-feature:progressive-im"))?M.factorIM:1:1};d.prototype._getLOD=
function(){return(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this.layerView.view.resourceController.memoryFactor*this._featureLOD};d.prototype._getLodDropFactor=function(){return Math.min(this.layerView.view.resourceController.memoryFactor,.5)/.5};d.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData();this.alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()};d.prototype.isGeometryVisible=
function(a){return this._viewportQueries.isGeometryVisible(a)};d.prototype.updateVisibility=function(a){return this._viewportQueries.updateNode(a)};d.prototype._shouldLoadNode=function(a){if(!this._lodHandling.shouldLoadNode(a))return!1;var c=this._getLodDropFactor();return 0<c&&0<this._viewportQueries.maxDistance&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.distToPOI(a)>this._viewportQueries.maxDistance*c?!1:a.obb?this._viewportQueries.isGeometryVisible(a):!0};d.prototype._startNodeLoading=
function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return a._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),this.layer.watch("labelsVisible",function(){return a._labelingChanged()}),
this.layer.watch("labelingInfo",function(){return a._labelingChanged()})],"requiredAttributes"));var c=C.TextureFormat.Normal;this.layerView.useCompressedTextures?c=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(c=C.TextureFormat.Downsampled);var d=this._defaultGeometrySchema;this._nodeLoader=new C(this.streamDataSupplier,Q,d,this._requiredAttributes,{textureFormat:c,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==d||null==
d.ordering});c=M.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new G(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,c,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,Q,function(c){return a.layerView.isNodeLoaded(c)},function(c){return a._shouldLoadNode(c)},function(c){return a._enableFromGPUCache(c)},function(c){return a._needsUpdate(c)});c=this.layerView.view.renderSpatialReference;c=this.crsIndex.equals(c)||this.crsIndex.isWGS84&&c.equals(ca.SphericalECEFSpatialReference);
this._index.ignoreServiceOBB=!c;this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes();this._lodHandling.startNodeLoading(function(c){return a._viewportQueries.isNodeVisible(c)},function(c){return a._viewportQueries.isGeometryVisible(c)},function(c){return a._index.nodeTraversalState(c)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.updatingChanged()}};d.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};d.prototype.cancelNodeLoading=
function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._poi=this._index=this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())};d.prototype._removeInvisibleNodes=function(){var a=this.layerView.getLoadedNodeIDs(),c=this._getLodDropFactor(),d=this._viewportQueries.maxDistance*c,c=0<c&&0<d;da.clear();for(var g=
0;g<a.length;g++){var u=this.nodeIndex[a[g]];if(!this._viewportQueries.isGeometryVisible(u)||c&&this._lodHandling.childrenEmpty(u)&&this._viewportQueries.distToPOI(u)>d)this._lodHandling.setLodGlobalDirty(),da.push(u)}return 0<da.length?(this.layerView.removeNodeData(da),da.clear(),!0):!1};d.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;a=this.layerView.getLoadedAttributes(a);return null!=a&&a!==this._requiredAttributes};
d.prototype._updateLoadedNode=function(a){var c=this,d=a.baseUrl,u=this.layerView.getLoadedAttributes(a),d=F(u,this._requiredAttributes)?g.resolve(this.layerView.getAttributeData(a)):this._nodeLoader.loadAttributes(a,d,this._requiredAttributes);this._updatingNodes.set(a.id,d);d.then(function(d){return c.schedule(a.id).then(function(){return c.layerView.setAttributeData(a,c._requiredAttributes,d)})}).catch(function(d){d instanceof v||c.layerView.setAttributeData(a,c._requiredAttributes,{})}).always(function(){c._updatingNodes.delete(a.id);
c.updatingChanged()});this.updatingChanged()};d.prototype._loadNode=function(a){var c=this;if(!a.notInCache||this._hasNodeLoadToken())this._loadingNodes.add(a.id),this.updatingChanged(),this._loadAndAddBundle(a).always(function(){c._loadingNodes.delete(a.id);c._hasFeatures=c._hasFeatures||!!a.numFeatures;c.updatingChanged()})};d.prototype._loadAndAddBundle=function(a){1!==a.featureData.length&&Q.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");
return a.notInCache?this._loadUncached(a):this._loadCached(a).then(function(c){c||(a.notInCache=!0)}).catch(function(c){c instanceof v||(a.notInCache=!0)})};d.prototype._enableFromGPUCache=function(a){if(this.disableCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var c=this.layerView.loadCachedGPUData(a);if(!c||null==c.loadedAttributes||null==c.attributeData||!F(c.loadedAttributes,this._requiredAttributes))return!1;this.layerView.addCachedGPUData(a,c,c);this._lodHandling.lodSwapBundleLoaded(a);
return!0};d.prototype._loadCached=function(a){var c=this,d=this.layerView;return!this.disableCache&&d.loadCachedNodeData&&d.addCachedNodeData?this.schedule(a.id).then(function(){return d.loadCachedNodeData(a,function(a,d){return c._nodeLoader.loadTextures(a,d)})}).then(function(g){if(null==g)return!1;var u=c._requiredAttributes;return null!=g.loadedAttributes&&null!=g.attributeData&&F(g.loadedAttributes,u)?c.reschedule(a.id).then(function(){return d.addCachedNodeData(a,g,g)}).then(function(){c._lodHandling.lodSwapBundleLoaded(a);
return!0}):c.reschedule(a.id).then(function(){return c._nodeLoader.loadAttributes(a,a.baseUrl,u)}).then(function(d){return c.reschedule(a.id,{loadedAttributes:u,attributeData:d})}).then(function(c){return d.addCachedNodeData(a,g,c)}).then(function(){c._lodHandling.lodSwapBundleLoaded(a);return!0})}):g.resolve(!1)};d.prototype._loadUncached=function(a){var c=this;this._downloadingNodes.add(a.id);return this._nodeLoader.loadBundleData(a,0).then(function(d){c._downloadingNodes.delete(a.id);return c.schedule(a.id,
d)}).then(function(d){return c.layerView.addNodeData(a,d)}).then(function(){c._lodHandling.lodSwapBundleLoaded(a);a.notInCache=!1}).catch(function(c){c instanceof v||(Q.error("Failed to load node '"+a.id+"' bundle 0: "+c),a.failed=!0)})};d.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())};d.prototype.updateStats=function(a){a.index=Object.keys(this.nodeIndex).length;this._hasFeatures&&(a.detail=
this._featureLOD,a.target=Math.round(this.featureTarget*this._getLOD()/this._featureLOD));this._index&&this._index.updateStats(a)};l([c.property({readOnly:!0})],d.prototype,"isMeshPyramid",null);l([c.property({readOnly:!0})],d.prototype,"streamDataSupplier",null);l([c.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],d.prototype,"parsedDefinitionExpression",null);l([c.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],d.prototype,"definitionExpressionFields",null);l([c.property({readOnly:!0})],
d.prototype,"crsVertex",null);l([c.property({readOnly:!0})],d.prototype,"crsIndex",null);l([c.property({readOnly:!0})],d.prototype,"nodeIndex",void 0);l([c.property()],d.prototype,"camPos",void 0);l([c.property()],d.prototype,"screenSizeFactor",void 0);l([c.property()],d.prototype,"featureTarget",void 0);l([c.property()],d.prototype,"layerView",void 0);l([c.property()],d.prototype,"layer",void 0);l([c.property({readOnly:!0})],d.prototype,"updating",void 0);l([c.property({readOnly:!0})],d.prototype,
"updatingPercentage",void 0);l([c.property({readOnly:!0})],d.prototype,"leafsReached",void 0);l([c.property({readOnly:!0})],d.prototype,"rootNodeVisible",null);l([c.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled"})],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);l([c.property({aliasOf:"layerView.alwaysLoadEverythingModeEnabled"})],d.prototype,"alwaysLoadEverythingModeEnabled",void 0);return d=l([c.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
d)}(c.declared(x,a,A));var da=new n,M={factorIM:.2,factor3dObject:.05,distancePenalty:10};return p})},"esri/core/sql/WhereClause":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../../moment ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(p,b,m,l,v,f,x,k){function A(a){return Array.isArray(a)?a:[a]}function y(a){return null!==a?!0!==a:null}function B(a,c){if(null==a)return null;for(var d=!1,g=0;g<c.length;g++){var q=c[g];if(null==
q)d=null;else if(a===q){d=!0;break}}return d}function d(a,c,d){if(null==a)return null;for(var g="",u=0,q=0;q<c.length;q++){var n=c.charAt(q);switch(u){case 0:n===d?u=1:g=0<="-[]/{}()*+?.\\^$|".indexOf(n)?g+("\\"+n):"%"===n?g+".*":"_"===n?g+".":g+n;break;case 1:g=0<="-[]/{}()*+?.\\^$|".indexOf(n)?g+("\\"+n):g+n,u=0}}return(new RegExp("^"+g+"$")).test(a)}function n(a){return a instanceof Date?a.valueOf():a}function a(a,c,d){if(null==c||null==d)return null;c=n(c);d=n(d);switch(a){case "\x3c\x3e":return c!==
d;case "\x3d":return c===d;case "\x3e":return c>d;case "\x3c":return c<d;case "\x3e\x3d":return c>=d;case "\x3c\x3d":return c<=d}}function g(a){for(var c=[],d={},g=0;g<a.length;g++){var n=a[g],q=n.toLowerCase();void 0===d[q]&&(c.push(n),d[q]=1)}return c}return function(){function q(){this._hasAggregateFunctions=this._hasStandardizedFunctions=this.parameters=this.parseTree=null}q.create=function(a){var c=new q;c.parseTree=k.WhereGrammar.parse(a);var d=!0,g=!0;c.visitAll(c.parseTree,function(a){if("function"===
a.type){var c=a.name;a=a.args.value.length;d&&(d=x.isStandardized(c,a));g&&(g=f.isAggregate(c,a))}});c._hasStandardizedFunctions=d;c._hasAggregateFunctions=g;return c};q.prototype.isStandardized=function(){return this._hasStandardizedFunctions};q.prototype.isAggregate=function(){return this._hasAggregateFunctions};q.prototype.setVariablesDictionary=function(a){this.parameters=a};q.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};q.prototype.testSet=function(a){var c=
this,d=new l.default;this.visitAll(this.parseTree,function(a){"column_ref"!==a.type||d.has(a.column)||d.set(a.column,a)});for(var g={},n=function(a){d.forEach(function(d,n){d=c.featureValue(a,n,d);g[n]?g[n].push(d):g[n]=[d]})},q=0;q<a.length;q++)n(a[q]);return!!this.evaluateNode(this.parseTree,{attributes:g})};q.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)};q.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(c){"function"===c.type&&
a.push(c.name.toLowerCase())});return g(a)};q.prototype.getExpressions=function(){var a=new l.default;this.visitAll(this.parseTree,function(c){if("function"===c.type){var d=c.name.toLowerCase();c=c.args.value[0];if("column_ref"===c.type){c=c.column;var g=d+"-"+c;a.has(g)||a.set(g,{aggregateType:d,field:c})}}});return m.from(a.values())};q.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(c){"column_ref"===c.type&&a.push(c.column)});return g(a)};q.prototype.getVariables=
function(){var a=[];this.visitAll(this.parseTree,function(c){"param"===c.type&&a.push(c.value.toLowerCase())});return g(a)};q.prototype.featureValue=function(a,d,g){a=a&&"object"===typeof a.attributes?a.attributes:a;var c=a[d];if(void 0!==c)return c;for(var n in a)if(d.toLowerCase()===n.toLowerCase())return g.column=n,a[n];return null};q.prototype.visitAll=function(a,d){if(null!=a)switch(d(a),a.type){case "when_clause":this.visitAll(a.operand,d);this.visitAll(a.value,d);break;case "case_expression":for(var c=
0,g=a.clauses;c<g.length;c++){var n=g[c];this.visitAll(n,d)}"simple"===a.format&&this.visitAll(a.operand,d);null!==a.else&&this.visitAll(a.else,d);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)n=a[c],this.visitAll(n,d);break;case "unary_expr":this.visitAll(a.expr,d);break;case "binary_expr":this.visitAll(a.left,d);this.visitAll(a.right,d);break;case "function":this.visitAll(a.args,d)}};q.prototype.evaluateNode=function(c,g){switch(c.type){case "case_expression":if("simple"===c.format)for(var q=
n(this.evaluateNode(c.operand,g)),k=0;k<c.clauses.length;k++){if(q===n(this.evaluateNode(c.clauses[k].operand,g)))return this.evaluateNode(c.clauses[k].value,g)}else for(k=0;k<c.clauses.length;k++)if(!0===this.evaluateNode(c.clauses[k].operand,g))return this.evaluateNode(c.clauses[k].value,g);return null!==c.else?this.evaluateNode(c.else,g):null;case "param":return this.parameters[c.value.toLowerCase()];case "expr_list":q=[];k=0;for(c=c.value;k<c.length;k++){var b=c[k];q.push(this.evaluateNode(b,
g))}return q;case "unary_expr":return y(this.evaluateNode(c.expr,g));case "binary_expr":switch(c.operator){case "AND":return q=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,g),null!=q&&null!=g?!0===q&&!0===g:!1===q||!1===g?!1:null;case "OR":return q=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,g),null!=q&&null!=g?!0===q||!0===g:!0===q||!0===g?!0:null;case "IS":if("null"!==c.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(c.left,g);case "ISNOT":if("null"!==
c.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(c.left,g);case "IN":return q=A(this.evaluateNode(c.right,g)),B(this.evaluateNode(c.left,g),q);case "NOT IN":return q=A(this.evaluateNode(c.right,g)),y(B(this.evaluateNode(c.left,g),q));case "BETWEEN":return q=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,g),null==q||null==g[0]||null==g[1]?null:q>=g[0]&&q<=g[1];case "NOTBETWEEN":return q=this.evaluateNode(c.left,g),g=this.evaluateNode(c.right,g),null==q||null==
g[0]||null==g[1]?null:q<g[0]||q>g[1];case "LIKE":return d(this.evaluateNode(c.left,g),this.evaluateNode(c.right,g),c.escape);case "NOT LIKE":return y(d(this.evaluateNode(c.left,g),this.evaluateNode(c.right,g),c.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return a(c.operator,this.evaluateNode(c.left,g),this.evaluateNode(c.right,g));case "*":return this.evaluateNode(c.left,g)*this.evaluateNode(c.right,g);case "-":return this.evaluateNode(c.left,g)-this.evaluateNode(c.right,
g);case "+":return this.evaluateNode(c.left,g)+this.evaluateNode(c.right,g);case "/":return this.evaluateNode(c.left,g)/this.evaluateNode(c.right,g)}throw Error("Not Supported Operator "+c.operator);case "null":case "bool":case "string":case "number":return c.value;case "date":return v(c.value,["YYYY-M-D"]).toDate();case "timestamp":return v(c.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===c.column.toUpperCase()?
(b=new Date,b.setHours(0,0,0,0),b):"CURRENT_TIMESTAMP"===c.column.toUpperCase()?new Date:this.featureValue(g,c.column,c);case "function":return g=this.evaluateNode(c.args,g),this.isAggregate()?f.aggregateFunction(c.name,g):x.evaluateFunction(c.name,g)}throw Error("Unsupported sql syntax "+c.type);};return q}()})},"@dojo/framework/shim/array":function(){(function(p){"object"===typeof module&&"object"===typeof module.exports?(p=p(require,exports),void 0!==p&&(module.exports=p)):"function"===typeof define&&
define.amd&&define("require exports tslib ./global ./iterator ./number ./support/has ./support/util".split(" "),p)})(function(p,b){Object.defineProperty(b,"__esModule",{value:!0});var m=p("tslib"),l=p("./global"),v=p("./iterator"),f=p("./number"),x=p("./support/has");p=p("./support/util");if(x.default("es6-array")&&x.default("es6-array-fill"))b.from=l.default.Array.from,b.of=l.default.Array.of,b.copyWithin=p.wrapNative(l.default.Array.prototype.copyWithin),b.fill=p.wrapNative(l.default.Array.prototype.fill),
b.find=p.wrapNative(l.default.Array.prototype.find),b.findIndex=p.wrapNative(l.default.Array.prototype.findIndex);else{var k=function(k){if(isNaN(k))return 0;k=Number(k);isFinite(k)&&(k=Math.floor(k));return Math.min(Math.max(k,0),f.MAX_SAFE_INTEGER)},A=function(k){k=Number(k);return isNaN(k)?0:0!==k&&isFinite(k)?(0<k?1:-1)*Math.floor(Math.abs(k)):k},y=function(k,d){return 0>k?Math.max(d+k,0):Math.min(k,d)};b.from=function(f,d,n){if(null==f)throw new TypeError("from: requires an array-like object");
d&&n&&(d=d.bind(n));n=k(f.length);var a="function"===typeof this?Object(new this(n)):Array(n);if(!v.isArrayLike(f)&&!v.isIterable(f))return a;if(v.isArrayLike(f)){if(0===n)return[];for(var g=0;g<f.length;g++)a[g]=d?d(f[g],g):f[g]}else{g=0;try{for(var q=m.__values(f),c=q.next();!c.done;c=q.next()){var b=c.value;a[g]=d?d(b,g):b;g++}}catch(D){B={error:D}}finally{try{c&&!c.done&&(A=q.return)&&A.call(q)}finally{if(B)throw B.error;}}}void 0!==f.length&&(a.length=n);return a;var B,A};b.of=function(){for(var k=
[],d=0;d<arguments.length;d++)k[d]=arguments[d];return Array.prototype.slice.call(k)};b.copyWithin=function(f,d,n,a){if(null==f)throw new TypeError("copyWithin: target must be an array-like object");var g=k(f.length);d=y(A(d),g);n=y(A(n),g);a=y(void 0===a?g:A(a),g);a=Math.min(a-n,g-d);g=1;d>n&&d<n+a&&(g=-1,n+=a-1,d+=a-1);for(;0<a;)n in f?f[d]=f[n]:delete f[d],d+=g,n+=g,a--;return f};b.fill=function(f,d,n,a){var g=k(f.length);n=y(A(n),g);for(a=y(void 0===a?g:A(a),g);n<a;)f[n++]=d;return f};b.find=
function(k,d,n){d=b.findIndex(k,d,n);return-1!==d?k[d]:void 0};b.findIndex=function(f,d,n){var a=k(f.length);if(!d)throw new TypeError("find: second argument must be a function");n&&(d=d.bind(n));for(n=0;n<a;n++)if(d(f[n],n,f))return n;return-1}}x.default("es7-array")?b.includes=p.wrapNative(l.default.Array.prototype.includes):b.includes=function(k,d,n){void 0===n&&(n=0);var a;a=k.length;a=Number(a);isNaN(a)?a=0:(isFinite(a)&&(a=Math.floor(a)),a=Math.min(Math.max(a,0),f.MAX_SAFE_INTEGER));for(;n<
a;++n){var g=k[n];if(d===g||d!==d&&g!==g)return!0}return!1}})},"@dojo/framework/shim/number":function(){(function(p){"object"===typeof module&&"object"===typeof module.exports?(p=p(require,exports),void 0!==p&&(module.exports=p)):"function"===typeof define&&define.amd&&define(["require","exports","./global"],p)})(function(p,b){function m(f){return"number"===typeof f&&v.default.isFinite(f)}function l(f){return m(f)&&Math.floor(f)===f}Object.defineProperty(b,"__esModule",{value:!0});var v=p("./global");
b.EPSILON=1;b.MAX_SAFE_INTEGER=Math.pow(2,53)-1;b.MIN_SAFE_INTEGER=-b.MAX_SAFE_INTEGER;b.isNaN=function(f){return"number"===typeof f&&v.default.isNaN(f)};b.isFinite=m;b.isInteger=l;b.isSafeInteger=function(f){return l(f)&&Math.abs(f)<=b.MAX_SAFE_INTEGER}})},"@dojo/framework/shim/Map":function(){(function(p){"object"===typeof module&&"object"===typeof module.exports?(p=p(require,exports),void 0!==p&&(module.exports=p)):"function"===typeof define&&define.amd&&define("require exports tslib ./iterator ./global ./object ./support/has ./Symbol".split(" "),
p)})(function(p,b){Object.defineProperty(b,"__esModule",{value:!0});var m=p("tslib"),l=p("./iterator"),v=p("./global"),f=p("./object"),x=p("./support/has");p("./Symbol");b.Map=v.default.Map;x.default("es6-map")||(b.Map=(k=function(){function k(k){this._keys=[];this._values=[];this[Symbol.toStringTag]="Map";if(k)if(l.isArrayLike(k))for(var f=0;f<k.length;f++){var d=k[f];this.set(d[0],d[1])}else try{for(var f=m.__values(k),n=f.next();!n.done;n=f.next())d=n.value,this.set(d[0],d[1])}catch(q){a={error:q}}finally{try{n&&
!n.done&&(g=f.return)&&g.call(f)}finally{if(a)throw a.error;}}var a,g}k.prototype._indexOfKey=function(k,b){for(var d=0,n=k.length;d<n;d++)if(f.is(k[d],b))return d;return-1};Object.defineProperty(k.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0});k.prototype.clear=function(){this._keys.length=this._values.length=0};k.prototype.delete=function(k){k=this._indexOfKey(this._keys,k);if(0>k)return!1;this._keys.splice(k,1);this._values.splice(k,1);return!0};k.prototype.entries=
function(){var k=this,f=this._keys.map(function(d,n){return[d,k._values[n]]});return new l.ShimIterator(f)};k.prototype.forEach=function(k,f){for(var d=this._keys,n=this._values,a=0,g=d.length;a<g;a++)k.call(f,n[a],d[a],this)};k.prototype.get=function(k){k=this._indexOfKey(this._keys,k);return 0>k?void 0:this._values[k]};k.prototype.has=function(k){return-1<this._indexOfKey(this._keys,k)};k.prototype.keys=function(){return new l.ShimIterator(this._keys)};k.prototype.set=function(k,f){var d=this._indexOfKey(this._keys,
k),d=0>d?this._keys.length:d;this._keys[d]=k;this._values[d]=f;return this};k.prototype.values=function(){return new l.ShimIterator(this._values)};k.prototype[Symbol.iterator]=function(){return this.entries()};return k}(),k[Symbol.species]=k,k));b.default=b.Map;var k})},"@dojo/framework/shim/object":function(){(function(p){"object"===typeof module&&"object"===typeof module.exports?(p=p(require,exports),void 0!==p&&(module.exports=p)):"function"===typeof define&&define.amd&&define(["require","exports",
"./global","./support/has","./Symbol"],p)})(function(p,b){Object.defineProperty(b,"__esModule",{value:!0});var m=p("./global"),l=p("./support/has"),v=p("./Symbol");l.default("es6-object")?(p=m.default.Object,b.assign=p.assign,b.getOwnPropertyDescriptor=p.getOwnPropertyDescriptor,b.getOwnPropertyNames=p.getOwnPropertyNames,b.getOwnPropertySymbols=p.getOwnPropertySymbols,b.is=p.is,b.keys=p.keys):(b.keys=function(f){return Object.keys(f).filter(function(f){return!f.match(/^@@.+/)})},b.assign=function(f){for(var v=
[],k=1;k<arguments.length;k++)v[k-1]=arguments[k];if(null==f)throw new TypeError("Cannot convert undefined or null to object");var l=Object(f);v.forEach(function(k){k&&b.keys(k).forEach(function(f){l[f]=k[f]})});return l},b.getOwnPropertyDescriptor=function(f,b){v.isSymbol(b);return Object.getOwnPropertyDescriptor(f,b)},b.getOwnPropertyNames=function(f){return Object.getOwnPropertyNames(f).filter(function(f){return!f.match(/^@@.+/)})},b.getOwnPropertySymbols=function(f){return Object.getOwnPropertyNames(f).filter(function(f){return!!f.match(/^@@.+/)}).map(function(f){return Symbol.for(f.substring(2))})},
b.is=function(f,b){return f===b?0!==f||1/f===1/b:f!==f&&b!==b});l.default("es2017-object")?(p=m.default.Object,b.getOwnPropertyDescriptors=p.getOwnPropertyDescriptors,b.entries=p.entries,b.values=p.values):(b.getOwnPropertyDescriptors=function(f){return b.getOwnPropertyNames(f).reduce(function(v,k){v[k]=b.getOwnPropertyDescriptor(f,k);return v},{})},b.entries=function(f){return b.keys(f).map(function(b){return[b,f[b]]})},b.values=function(f){return b.keys(f).map(function(b){return f[b]})})})},"esri/core/sql/AggregateFunctions":function(){define(["require",
"exports"],function(p,b){function m(f){for(var b=0,k=0;k<f.length;k++)b+=f[k];return b/f.length}function l(f){for(var b=m(f),k=f.length,v=0,l=0;l<f.length;l++)v+=Math.pow(f[l]-b,2);return 1<k?v/(k-1):0}Object.defineProperty(b,"__esModule",{value:!0});b.aggregateFunction=function(f,b){var k=v[f.toLowerCase()];if(null==k)throw Error("Function Not Recognised");if(b.length<k.minParams||b.length>k.maxParams)throw Error("Invalid Parameter count for call to "+f.toUpperCase());return k.evaluate(b)};b.isAggregate=
function(f,b){f=v[f.toLowerCase()];return null!=f&&b>=f.minParams&&b<=f.maxParams};var v={min:{minParams:1,maxParams:1,evaluate:function(f){return null==f[0]?null:Math.min.apply(Math,f[0])}},max:{minParams:1,maxParams:1,evaluate:function(f){return null==f[0]?null:Math.max.apply(Math,f[0])}},avg:{minParams:1,maxParams:1,evaluate:function(f){return null==f[0]?null:m(f[0])}},sum:{minParams:1,maxParams:1,evaluate:function(f){if(null==f[0])f=null;else{f=f[0];for(var b=0,k=0;k<f.length;k++)b+=f[k];f=b}return f}},
stddev:{minParams:1,maxParams:1,evaluate:function(f){return null==f[0]?null:Math.sqrt(l(f[0]))}},count:{minParams:1,maxParams:1,evaluate:function(f){return null==f[0]?null:f[0].length}},var:{minParams:1,maxParams:1,evaluate:function(f){return null==f[0]?null:l(f[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(p,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.evaluateFunction=function(b,f){var v=l[b.toLowerCase()];if(null==v)throw Error("Function Not Recognised");
if(f.length<v.minParams||f.length>v.maxParams)throw Error("Invalid Parameter count for call to "+b.toUpperCase());return v.evaluate(f)};b.isStandardized=function(b,f){b=l[b.toLowerCase()];return null!=b&&f>=b.minParams&&f<=b.maxParams};var l={extract:{minParams:2,maxParams:2,evaluate:function(b){var f=b[0];b=b[1];if(null==b)return null;if(b instanceof Date)switch(f.toUpperCase()){case "SECOND":return b.getSeconds();case "MINUTE":return b.getMinutes();case "HOUR":return b.getHours();case "DAY":return b.getDate();
case "MONTH":return b.getMonth()+1;case "YEAR":return b.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(b){if(2===b.length){var f=b[0],l=b[1];return null==f||null==l?null:f.toString().substring(l-1)}if(3===b.length)return f=b[0],l=b[1],b=b[2],null==f||null==l||null==b?null:0>=b?"":f.toString().substring(l-1,l+b-1)}},position:{minParams:2,maxParams:2,evaluate:function(b){var f=b[0];b=b[1];return null==f||null==b?null:b.indexOf(f)+
1}},trim:{minParams:2,maxParams:3,evaluate:function(b){var f=3===b.length,l=f?b[1]:" ",f=f?b[2]:b[1];if(null==l||null==f)return null;l="("+m.escapeString(l)+")";switch(b[0]){case "BOTH":return f.replace(new RegExp("^"+l+"*|"+l+"*$","g"),"");case "LEADING":return f.replace(new RegExp("^"+l+"*","g"),"");case "TRAILING":return f.replace(new RegExp(l+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.abs(b[0])}},
ceiling:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.ceil(b[0])}},floor:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.floor(b[0])}},log:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.log(b[0])}},log10:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.log(b[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sin(b[0])}},cos:{minParams:1,maxParams:1,
evaluate:function(b){return null==b[0]?null:Math.cos(b[0])}},tan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.tan(b[0])}},asin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.asin(b[0])}},acos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.acos(b[0])}},atan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.atan(b[0])}},sign:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:
0<b[0]?1:0>b[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:Math.pow(b[0],b[1])}},mod:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:b[0]%b[1]}},round:{minParams:1,maxParams:2,evaluate:function(b){var f=b[0];b=2===b.length?Math.pow(10,b[1]):1;return null==f?null:Math.round(f*b)/b}},truncate:{minParams:1,maxParams:2,evaluate:function(b){return null==b[0]?null:1===b.length?parseInt(b[0].toFixed(0),10):parseFloat(b[0].toFixed(b[1]))}},
char_length:{minParams:1,maxParams:1,evaluate:function(b){return"string"===typeof b[0]||b[0]instanceof String?b[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(b){for(var f="",l=0;l<b.length;l++){if(null==b[l])return null;f+=b[l].toString()}return f}},lower:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require",
"exports","./sql92grammar"],function(p,b,m){Object.defineProperty(b,"__esModule",{value:!0});p=function(){function b(){}b.parse=function(b){return m.parse(b)};return b}();b.WhereGrammar=p})},"esri/core/sql/sql92grammar":function(){define([],function(){function p(b,m,l,v){this.message=b;this.expected=m;this.found=l;this.location=v;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,p)}(function(b,m){function l(){this.constructor=b}l.prototype=m.prototype;
b.prototype=new l})(p,Error);p.buildMessage=function(b,m){function l(b){return b.charCodeAt(0).toString(16).toUpperCase()}function v(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+l(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+l(b)})}function f(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,
"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+l(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+l(b)})}var x={literal:function(b){return'"'+v(b.text)+'"'},"class":function(b){var k="",l;for(l=0;l<b.parts.length;l++)k+=b.parts[l]instanceof Array?f(b.parts[l][0])+"-"+f(b.parts[l][1]):f(b.parts[l]);return"["+(b.inverted?"^":"")+k+"]"},any:function(b){return"any character"},end:function(b){return"end of input"},other:function(b){return b.description}};
return"Expected "+function(b){var k=Array(b.length),f;for(f=0;f<b.length;f++){var l=f,d;d=b[f];d=x[d.type](d);k[l]=d}k.sort();if(0<k.length){for(b=f=1;f<k.length;f++)k[f-1]!==k[f]&&(k[b]=k[f],b++);k.length=b}switch(k.length){case 1:return k[0];case 2:return k[0]+" or "+k[1];default:return k.slice(0,-1).join(", ")+", or "+k[k.length-1]}}(b)+" but "+(m?'"'+v(m)+'"':"end of input")+" found."};return{SyntaxError:p,parse:function(b,m){function l(e,a){return{type:"literal",text:e,ignoreCase:a}}function v(e,
a,h){return{type:"class",parts:e,inverted:a,ignoreCase:h}}function f(e){var a=Ta[e],h;if(!a){for(h=e-1;!Ta[h];)h--;a=Ta[h];for(a={line:a.line,column:a.column};h<e;)10===b.charCodeAt(h)?(a.line++,a.column=1):a.column++,h++;Ta[e]=a}return a}function x(e,a){var h=f(e),c=f(a);return{start:{offset:e,line:h.line,column:h.column},end:{offset:a,line:c.line,column:c.column}}}function k(e){h<oa||(h>oa&&(oa=h,ob=[]),ob.push(e))}function A(){var a,c,d;a=h;c=t();c!==e?(c=B(),c!==e?(d=t(),d!==e?a=c:(h=a,a=e)):
(h=a,a=e)):(h=a,a=e);return a}function y(){var a,c,d,g,w,b,k,q;a=h;c=B();if(c!==e){d=[];g=h;w=t();w!==e?(b=Aa(),b!==e?(k=t(),k!==e?(q=B(),q!==e?g=w=[w,b,k,q]:(h=g,g=e)):(h=g,g=e)):(h=g,g=e)):(h=g,g=e);for(;g!==e;)d.push(g),g=h,w=t(),w!==e?(b=Aa(),b!==e?(k=t(),k!==e?(q=B(),q!==e?g=w=[w,b,k,q]:(h=g,g=e)):(h=g,g=e)):(h=g,g=e)):(h=g,g=e);if(d!==e){a={type:"expr_list"};c=[c];for(g=0;g<d.length;g++)c.push(d[g][3]);a.value=c}else h=a,a=e}else h=a,a=e;return a}function B(){var a,c,g,w,b,k,q,n;a=h;c=d();if(c!==
e){g=[];w=h;b=t();b!==e?(k=Ga(),k!==e?(q=t(),q!==e?(n=d(),n!==e?w=b=[b,k,q,n]:(h=w,w=e)):(h=w,w=e)):(h=w,w=e)):(h=w,w=e);for(;w!==e;)g.push(w),w=h,b=t(),b!==e?(k=Ga(),k!==e?(q=t(),q!==e?(n=d(),n!==e?w=b=[b,k,q,n]:(h=w,w=e)):(h=w,w=e)):(h=w,w=e)):(h=w,w=e);g!==e?a=c=W(c,g):(h=a,a=e)}else h=a,a=e;return a}function d(){var a,c,d,g,w,b,k,q;a=h;c=n();if(c!==e){d=[];g=h;w=t();w!==e?(b=ja(),b!==e?(k=t(),k!==e?(q=n(),q!==e?g=w=[w,b,k,q]:(h=g,g=e)):(h=g,g=e)):(h=g,g=e)):(h=g,g=e);for(;g!==e;)d.push(g),g=h,
w=t(),w!==e?(b=ja(),b!==e?(k=t(),k!==e?(q=n(),q!==e?g=w=[w,b,k,q]:(h=g,g=e)):(h=g,g=e)):(h=g,g=e)):(h=g,g=e);d!==e?a=c=W(c,d):(h=a,a=e)}else h=a,a=e;return a}function n(){var d,w,f,z,l;d=h;w=P();w===e&&(w=h,33===b.charCodeAt(h)?(f=ea,h++):(f=e,0===r&&k(ga)),f!==e?(z=h,r++,61===b.charCodeAt(h)?(l=za,h++):(l=e,0===r&&k(Ha)),r--,l===e?z=void 0:(h=z,z=e),z!==e?w=f=[f,z]:(h=w,w=e)):(h=w,w=e));w!==e?(f=t(),f!==e?(z=n(),z!==e?d=w={type:"unary_expr",operator:"NOT",expr:z}:(h=d,d=e)):(h=d,d=e)):(h=d,d=e);
if(d===e)if(d=h,w=c(),w!==e)if(f=t(),f!==e){var I,u,U;f=[];z=h;l=t();l!==e?(I=a(),I!==e?(u=t(),u!==e?(U=c(),U!==e?z=l=[l,I,u,U]:(h=z,z=e)):(h=z,z=e)):(h=z,z=e)):(h=z,z=e);if(z!==e)for(;z!==e;)f.push(z),z=h,l=t(),l!==e?(I=a(),I!==e?(u=t(),u!==e?(U=c(),U!==e?z=l=[l,I,u,U]:(h=z,z=e)):(h=z,z=e)):(h=z,z=e)):(h=z,z=e);else f=e;f!==e&&(f={type:"arithmetic",tail:f});f===e&&(f=h,z=q(),z!==e?(l=t(),l!==e?(l=S(),l!==e?(l=t(),l!==e?(l=y(),l!==e?(I=t(),I!==e?(I=ra(),I!==e?f=z={op:z,right:l}:(h=f,f=e)):(h=f,f=
e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e),f===e&&(f=h,z=q(),z!==e?(l=t(),l!==e?(l=S(),l!==e?(l=t(),l!==e?(l=ra(),l!==e?f=z={op:z,right:{type:"expr_list",value:[]}}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e),f===e&&(f=h,z=q(),z!==e?(l=t(),l!==e?(l=R(),l!==e?f=z={op:z,right:l}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e))),f===e&&(f=h,l=P(),l!==e?(z=t(),z!==e?(z=na(),z!==e?(I=t(),I!==e?(I=c(),I!==e?(u=t(),u!==e?(u=ja(),u!==e?(l=t(),l!==e?(l=c(),l!==e?f=l={op:"NOT"+z,right:{type:"expr_list",
value:[I,l]}}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e),f===e&&(f=h,l=na(),l!==e?(z=t(),z!==e?(z=c(),z!==e?(I=t(),I!==e?(I=ja(),I!==e?(u=t(),u!==e?(u=c(),u!==e?f=l={op:l,right:{type:"expr_list",value:[z,u]}}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)),f===e&&(f=h,z=ya(),z!==e?(l=t(),l!==e?(l=P(),l!==e?(l=t(),l!==e?(l=c(),l!==e?f=z={op:z+"NOT",right:l}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e),f===
e&&(f=h,z=ya(),z!==e?(l=t(),l!==e?(l=c(),l!==e?f=z={op:z,right:l}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e)),f===e&&(f=h,z=g(),z!==e?(l=t(),l!==e?(l=Z(),l!==e?(I=t(),I!==e?(I=h,b.substr(h,6).toLowerCase()===dd?(u=b.substr(h,6),h+=6):(u=e,0===r&&k(ed)),u!==e?(u=h,r++,U=C(),r--,U===e?u=void 0:(h=u,u=e),u!==e?I="ESCAPE":(h=I,I=e)):(h=I,I=e),I!==e?(I=t(),I!==e?(I=ca(),I!==e?f=z={op:z,right:l,escape:I.value}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e)):(h=f,f=e),f===e&&(f=h,z=g(),z!==e?(l=t(),
l!==e?(l=Z(),l!==e?f=z={op:z,right:l,escape:""}:(h=f,f=e)):(h=f,f=e)):(h=f,f=e))))));f===e&&(f=null);f!==e?(d=w,w=f,""==w||void 0==w||null==w?w=d:(f=null,w=f="arithmetic"==w.type?W(d,w.tail):fa(w.op,d,w.right,w.escape)),d=w):(h=d,d=e)}else h=d,d=e;else h=d,d=e;return d}function a(){var a;b.substr(h,2)===Ua?(a=Ua,h+=2):(a=e,0===r&&k(pb));a===e&&(62===b.charCodeAt(h)?(a=sa,h++):(a=e,0===r&&k(Ia)),a===e&&(b.substr(h,2)===Va?(a=Va,h+=2):(a=e,0===r&&k(Ma)),a===e&&(b.substr(h,2)===Na?(a=Na,h+=2):(a=e,0===
r&&k(Tb)),a===e&&(60===b.charCodeAt(h)?(a=Ub,h++):(a=e,0===r&&k(w)),a===e&&(61===b.charCodeAt(h)?(a=za,h++):(a=e,0===r&&k(Ha)),a===e&&(b.substr(h,2)===z?(a=z,h+=2):(a=e,0===r&&k(I))))))));return a}function g(){var a,c,d,g;a=a=h;c=P();c!==e?(d=t(),d!==e?(g=ia(),g!==e?a=c=[c,d,g]:(h=a,a=e)):(h=a,a=e)):(h=a,a=e);a!==e&&(a=a[0]+" "+a[2]);a===e&&(a=ia());return a}function q(){var a,c,d,g;a=a=h;c=P();c!==e?(d=t(),d!==e?(g=Fa(),g!==e?a=c=[c,d,g]:(h=a,a=e)):(h=a,a=e)):(h=a,a=e);a!==e&&(a=a[0]+" "+a[2]);a===
e&&(a=Fa());return a}function c(){var a,c,d,g,w,b,f,k;a=h;c=N();if(c!==e){d=[];g=h;w=t();w!==e?(b=u(),b!==e?(f=t(),f!==e?(k=N(),k!==e?g=w=[w,b,f,k]:(h=g,g=e)):(h=g,g=e)):(h=g,g=e)):(h=g,g=e);for(;g!==e;)d.push(g),g=h,w=t(),w!==e?(b=u(),b!==e?(f=t(),f!==e?(k=N(),k!==e?g=w=[w,b,f,k]:(h=g,g=e)):(h=g,g=e)):(h=g,g=e)):(h=g,g=e);d!==e?a=c=W(c,d):(h=a,a=e)}else h=a,a=e;return a}function u(){var a;43===b.charCodeAt(h)?(a=U,h++):(a=e,0===r&&k(Ba));a===e&&(45===b.charCodeAt(h)?(a=Oa,h++):(a=e,0===r&&k(Ja)));
return a}function N(){var a,c,g,d,w,b,f,k;a=h;c=D();if(c!==e){g=[];d=h;w=t();w!==e?(b=J(),b!==e?(f=t(),f!==e?(k=D(),k!==e?d=w=[w,b,f,k]:(h=d,d=e)):(h=d,d=e)):(h=d,d=e)):(h=d,d=e);for(;d!==e;)g.push(d),d=h,w=t(),w!==e?(b=J(),b!==e?(f=t(),f!==e?(k=D(),k!==e?d=w=[w,b,f,k]:(h=d,d=e)):(h=d,d=e)):(h=d,d=e)):(h=d,d=e);g!==e?a=c=W(c,g):(h=a,a=e)}else h=a,a=e;return a}function J(){var a;42===b.charCodeAt(h)?(a=Wa,h++):(a=e,0===r&&k(Vb));a===e&&(47===b.charCodeAt(h)?(a=Bb,h++):(a=e,0===r&&k(Ka)));return a}
function D(){var a,c,d,g,w,f,q;q=ca();if(q===e){var n,z,l,I;n=h;var u,U,m,N;u=h;U=Q();U!==e?(m=da(),m!==e?(N=M(),N!==e?u=U=parseFloat(U+m+N):(h=u,u=e)):(h=u,u=e)):(h=u,u=e);u===e&&(u=h,U=Q(),U!==e?(m=da(),m!==e?u=U=parseFloat(U+m):(h=u,u=e)):(h=u,u=e),u===e&&(u=h,U=Q(),U!==e?(m=M(),m!==e?u=U=parseFloat(U+m):(h=u,u=e)):(h=u,u=e),u===e&&(u=h,U=Q(),U!==e&&(U=parseFloat(U)),u=U)));z=u;z!==e?(l=h,r++,I=ha(),r--,I===e?l=void 0:(h=l,l=e),l!==e?n=z={type:"number",value:z}:(h=n,n=e)):(h=n,n=e);q=n;if(q===
e){var A,D;A=h;var x,J,v,Ub;x=h;b.substr(h,4).toLowerCase()===fd?(J=b.substr(h,4),h+=4):(J=e,0===r&&k(gd));J!==e?(v=h,r++,Ub=C(),r--,Ub===e?v=void 0:(h=v,v=e),v!==e?x=J=[J,v]:(h=x,x=e)):(h=x,x=e);D=x;D!==e&&(D={type:"bool",value:!0});A=D;if(A===e){A=h;var Ba,Oa,Ja,p;Ba=h;b.substr(h,5).toLowerCase()===hd?(Oa=b.substr(h,5),h+=5):(Oa=e,0===r&&k(id));Oa!==e?(Ja=h,r++,p=C(),r--,p===e?Ja=void 0:(h=Ja,Ja=e),Ja!==e?Ba=Oa=[Oa,Ja]:(h=Ba,Ba=e)):(h=Ba,Ba=e);D=Ba;D!==e&&(D={type:"bool",value:!1});A=D}q=A;if(q===
e){var ia,P,Wa,ja,Ga;P=h;b.substr(h,4).toLowerCase()===jd?(Wa=b.substr(h,4),h+=4):(Wa=e,0===r&&k(kd));Wa!==e?(ja=h,r++,Ga=C(),r--,Ga===e?ja=void 0:(h=ja,ja=e),ja!==e?P=Wa=[Wa,ja]:(h=P,P=e)):(h=P,P=e);ia=P;ia!==e&&(ia={type:"null",value:null});q=ia;if(q===e){var na,E,Vb,Bb;na=h;var Ka,W,V,Tb;Ka=h;b.substr(h,4).toLowerCase()===ld?(W=b.substr(h,4),h+=4):(W=e,0===r&&k(md));W!==e?(V=h,r++,Tb=C(),r--,Tb===e?V=void 0:(h=V,V=e),V!==e?Ka=W="DATE":(h=Ka,Ka=e)):(h=Ka,Ka=e);E=Ka;E!==e?(Vb=t(),Vb!==e?(Bb=Z(),
Bb!==e?na=E={type:"date",value:Bb.value}:(h=na,na=e)):(h=na,na=e)):(h=na,na=e);q=na;if(q===e){var pa,ea,fa,Nb;pa=h;var Da,ga,Aa,mc;Da=h;b.substr(h,9).toLowerCase()===nd?(ga=b.substr(h,9),h+=9):(ga=e,0===r&&k(od));ga!==e?(Aa=h,r++,mc=C(),r--,mc===e?Aa=void 0:(h=Aa,Aa=e),Aa!==e?Da=ga="TIMESTAMP":(h=Da,Da=e)):(h=Da,Da=e);ea=Da;ea!==e?(fa=t(),fa!==e?(Nb=Z(),Nb!==e?pa=ea={type:"timestamp",value:Nb.value}:(h=pa,pa=e)):(h=pa,pa=e)):(h=pa,pa=e);q=pa}}}}}a=q;if(a===e){var aa,Sa,oc,kb,qa,oa,sa,nc,Rb,Ob,Pb,
sc;aa=h;var Xa,ya,Ra,tc;Xa=h;b.substr(h,7).toLowerCase()===pd?(ya=b.substr(h,7),h+=7):(ya=e,0===r&&k(qd));ya!==e?(Ra=h,r++,tc=C(),r--,tc===e?Ra=void 0:(h=Ra,Ra=e),Ra!==e?Xa=ya="EXTRACT":(h=Xa,Xa=e)):(h=Xa,Xa=e);Sa=Xa;if(Sa!==e)if(oc=t(),oc!==e)if(kb=S(),kb!==e)if(qa=t(),qa!==e){var ta,Ya,zb,za,Ma;Ya=h;b.substr(h,4).toLowerCase()===rd?(zb=b.substr(h,4),h+=4):(zb=e,0===r&&k(sd));zb!==e?(za=h,r++,Ma=C(),r--,Ma===e?za=void 0:(h=za,za=e),za!==e?Ya=zb="YEAR":(h=Ya,Ya=e)):(h=Ya,Ya=e);ta=Ya;if(ta===e){var Za,
ib,jb,Qb;Za=h;b.substr(h,5).toLowerCase()===td?(ib=b.substr(h,5),h+=5):(ib=e,0===r&&k(ud));ib!==e?(jb=h,r++,Qb=C(),r--,Qb===e?jb=void 0:(h=jb,jb=e),jb!==e?Za=ib="MONTH":(h=Za,Za=e)):(h=Za,Za=e);ta=Za;if(ta===e){var $a,yb,lb,uc;$a=h;b.substr(h,3).toLowerCase()===vd?(yb=b.substr(h,3),h+=3):(yb=e,0===r&&k(wd));yb!==e?(lb=h,r++,uc=C(),r--,uc===e?lb=void 0:(h=lb,lb=e),lb!==e?$a=yb="DAY":(h=$a,$a=e)):(h=$a,$a=e);ta=$a;if(ta===e){var ab,Ea,Cb,Ta;ab=h;b.substr(h,4).toLowerCase()===xd?(Ea=b.substr(h,4),h+=
4):(Ea=e,0===r&&k(yd));Ea!==e?(Cb=h,r++,Ta=C(),r--,Ta===e?Cb=void 0:(h=Cb,Cb=e),Cb!==e?ab=Ea="HOUR":(h=ab,ab=e)):(h=ab,ab=e);ta=ab;if(ta===e){var bb,Ha,Db,Ua;bb=h;b.substr(h,6).toLowerCase()===zd?(Ha=b.substr(h,6),h+=6):(Ha=e,0===r&&k(Ad));Ha!==e?(Db=h,r++,Ua=C(),r--,Ua===e?Db=void 0:(h=Db,Db=e),Db!==e?bb=Ha="MINUTE":(h=bb,bb=e)):(h=bb,bb=e);ta=bb;if(ta===e){var cb,Ia,Eb,Va;cb=h;b.substr(h,6).toLowerCase()===Bd?(Ia=b.substr(h,6),h+=6):(Ia=e,0===r&&k(Cd));Ia!==e?(Eb=h,r++,Va=C(),r--,Va===e?Eb=void 0:
(h=Eb,Eb=e),Eb!==e?cb=Ia="SECOND":(h=cb,cb=e)):(h=cb,cb=e);ta=cb}}}}}oa=ta;oa!==e?(sa=t(),sa!==e?(nc=La(),nc!==e?(Rb=t(),Rb!==e?(Ob=B(),Ob!==e?(Pb=t(),Pb!==e?(sc=ra(),sc!==e?aa=Sa={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:oa},Ob]}}:(h=aa,aa=e)):(h=aa,aa=e)):(h=aa,aa=e)):(h=aa,aa=e)):(h=aa,aa=e)):(h=aa,aa=e)):(h=aa,aa=e)}else h=aa,aa=e;else h=aa,aa=e;else h=aa,aa=e;else h=aa,aa=e;a=aa;if(a===e){var X,Na,pc,qc,rc,Ab,mb,nb,ob,Wb,pb,ma,qb,vc,wc,xc;X=h;var db,Xb,
Fb,Dc;db=h;b.substr(h,9).toLowerCase()===Dd?(Xb=b.substr(h,9),h+=9):(Xb=e,0===r&&k(Ed));Xb!==e?(Fb=h,r++,Dc=C(),r--,Dc===e?Fb=void 0:(h=Fb,Fb=e),Fb!==e?db=Xb="SUBSTRING":(h=db,db=e)):(h=db,db=e);Na=db;if(Na!==e)if(pc=t(),pc!==e)if(qc=S(),qc!==e)if(rc=t(),rc!==e)if(Ab=B(),Ab!==e)if(mb=t(),mb!==e)if(nb=La(),nb!==e)if(ob=t(),ob!==e)if(Wb=B(),Wb!==e)if(pb=t(),pb!==e){ma=h;var eb,Yb,Gb,Ec;eb=h;b.substr(h,3).toLowerCase()===Fd?(Yb=b.substr(h,3),h+=3):(Yb=e,0===r&&k(Gd));Yb!==e?(Gb=h,r++,Ec=C(),r--,Ec===
e?Gb=void 0:(h=Gb,Gb=e),Gb!==e?eb=Yb="FOR":(h=eb,eb=e)):(h=eb,eb=e);qb=eb;qb!==e?(vc=t(),vc!==e?(wc=B(),wc!==e?(xc=t(),xc!==e?ma=qb=[qb,vc,wc,xc]:(h=ma,ma=e)):(h=ma,ma=e)):(h=ma,ma=e)):(h=ma,ma=e);ma===e&&(ma=null);ma!==e?(qb=ra(),qb!==e?X=Na={type:"function",name:"substring",args:{type:"expr_list",value:ma?[Ab,Wb,ma[2]]:[Ab,Wb]}}:(h=X,X=e)):(h=X,X=e)}else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;else h=X,X=e;a=X;if(a===e){var H,
rb,Zb,$b,ac,ua,bc,sb,cc,dc,Fc,yc,Gc,Hc;H=h;rb=Sb();rb!==e?(Zb=t(),Zb!==e?($b=S(),$b!==e?(ac=t(),ac!==e?(ua=Y(),ua===e&&(ua=null),ua!==e?(bc=t(),bc!==e?(sb=B(),sb!==e?(cc=t(),cc!==e?(dc=La(),dc!==e?(Fc=t(),Fc!==e?(yc=B(),yc!==e?(Gc=t(),Gc!==e?(Hc=ra(),Hc!==e?H=rb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==ua?"BOTH":ua},sb,yc]}}:(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):
(h=H,H=e);H===e&&(H=h,rb=Sb(),rb!==e?(Zb=t(),Zb!==e?($b=S(),$b!==e?(ac=t(),ac!==e?(ua=Y(),ua===e&&(ua=null),ua!==e?(bc=t(),bc!==e?(sb=B(),sb!==e?(cc=t(),cc!==e?(dc=ra(),dc!==e?H=rb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==ua?"BOTH":ua},sb]}}:(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e)):(h=H,H=e));a=H;if(a===e){var ba,zc,Ic,Jc,Kc,Ac,Lc,Mc,Nc,Bc,Oc,Pc;ba=h;var fb,ec,Hb,Qc;fb=h;b.substr(h,8).toLowerCase()===Hd?(ec=
b.substr(h,8),h+=8):(ec=e,0===r&&k(Id));ec!==e?(Hb=h,r++,Qc=C(),r--,Qc===e?Hb=void 0:(h=Hb,Hb=e),Hb!==e?fb=ec="POSITION":(h=fb,fb=e)):(h=fb,fb=e);zc=fb;zc!==e?(Ic=t(),Ic!==e?(Jc=S(),Jc!==e?(Kc=t(),Kc!==e?(Ac=B(),Ac!==e?(Lc=t(),Lc!==e?(Mc=Fa(),Mc!==e?(Nc=t(),Nc!==e?(Bc=B(),Bc!==e?(Oc=t(),Oc!==e?(Pc=ra(),Pc!==e?ba=zc={type:"function",name:"position",args:{type:"expr_list",value:[Ac,Bc]}}:(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=e)):(h=ba,ba=
e)):(h=ba,ba=e)):(h=ba,ba=e);a=ba;if(a===e){var ka,fc,Rc,Sc,Tc,tb,Uc,Vc;ka=h;var va,Ib,Jb,Ca;va=h;va=Ib=G();if(va===e)if(va=h,96===b.charCodeAt(h)?(Ib=Wc,h++):(Ib=e,0===r&&k(Xc)),Ib!==e){Jb=[];Yc.test(b.charAt(h))?(Ca=b.charAt(h),h++):(Ca=e,0===r&&k(Zc));if(Ca!==e)for(;Ca!==e;)Jb.push(Ca),Yc.test(b.charAt(h))?(Ca=b.charAt(h),h++):(Ca=e,0===r&&k(Zc));else Jb=e;Jb!==e?(96===b.charCodeAt(h)?(Ca=Wc,h++):(Ca=e,0===r&&k(Xc)),Ca!==e?va=Ib=Jb.join(""):(h=va,va=e)):(h=va,va=e)}else h=va,va=e;fc=va;fc!==e?
(Rc=t(),Rc!==e?(Sc=S(),Sc!==e?(Tc=t(),Tc!==e?(tb=y(),tb===e&&(tb=null),tb!==e?(Uc=t(),Uc!==e?(Vc=ra(),Vc!==e?ka=fc={type:"function",name:fc,args:tb?tb:{type:"expr_list",value:[]}}:(h=ka,ka=e)):(h=ka,ka=e)):(h=ka,ka=e)):(h=ka,ka=e)):(h=ka,ka=e)):(h=ka,ka=e)):(h=ka,ka=e);a=ka;if(a===e){var gc,L,ub,hc,vb,ic,Pa,wa,Kb,$c,ad;L=h;ub=gb();if(ub!==e)if(hc=t(),hc!==e)if(vb=B(),vb!==e)if(ic=t(),ic!==e){Pa=[];for(wa=F();wa!==e;)Pa.push(wa),wa=F();Pa!==e?(wa=t(),wa!==e?(Kb=wb(),Kb!==e?L=ub={type:"case_expression",
format:"simple",operand:vb,clauses:Pa,else:null}:(h=L,L=e)):(h=L,L=e)):(h=L,L=e)}else h=L,L=e;else h=L,L=e;else h=L,L=e;else h=L,L=e;if(L===e)if(L=h,ub=gb(),ub!==e)if(hc=t(),hc!==e)if(vb=B(),vb!==e)if(ic=t(),ic!==e){Pa=[];for(wa=F();wa!==e;)Pa.push(wa),wa=F();Pa!==e?(wa=t(),wa!==e?(Kb=O(),Kb!==e?($c=t(),$c!==e?(ad=wb(),ad!==e?L=ub={type:"case_expression",format:"simple",operand:vb,clauses:Pa,else:Kb.value}:(h=L,L=e)):(h=L,L=e)):(h=L,L=e)):(h=L,L=e)):(h=L,L=e)}else h=L,L=e;else h=L,L=e;else h=L,L=
e;else h=L,L=e;gc=L;if(gc===e){var T,xb,jc,Qa,xa,Lb,bd,cd;T=h;xb=gb();if(xb!==e)if(jc=t(),jc!==e){Qa=[];for(xa=la();xa!==e;)Qa.push(xa),xa=la();Qa!==e?(xa=t(),xa!==e?(Lb=wb(),Lb!==e?T=xb={type:"case_expression",format:"searched",clauses:Qa,else:null}:(h=T,T=e)):(h=T,T=e)):(h=T,T=e)}else h=T,T=e;else h=T,T=e;if(T===e)if(T=h,xb=gb(),xb!==e)if(jc=t(),jc!==e){Qa=[];for(xa=la();xa!==e;)Qa.push(xa),xa=la();Qa!==e?(xa=t(),xa!==e?(Lb=O(),Lb!==e?(bd=t(),bd!==e?(cd=wb(),cd!==e?T=xb={type:"case_expression",
format:"searched",clauses:Qa,else:Lb.value}:(h=T,T=e)):(h=T,T=e)):(h=T,T=e)):(h=T,T=e)):(h=T,T=e)}else h=T,T=e;else h=T,T=e;gc=T}a=gc;if(a===e){var Mb,hb,Cc,kc,lc;hb=h;Cc=ha();if(Cc!==e){kc=[];for(lc=K();lc!==e;)kc.push(lc),lc=K();kc!==e?hb=Cc+=kc.join(""):(h=hb,hb=e)}else h=hb,hb=e;Mb=hb;Mb!==e&&(Mb={type:"column_ref",table:"",column:Mb});a=Mb;a===e&&(a=R(),a===e&&(a=h,c=S(),c!==e?(d=t(),d!==e?(g=B(),g!==e?(w=t(),w!==e?(f=ra(),f!==e?(g.paren=!0,a=c=g):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):
(h=a,a=e)))}}}}}}}return a}function G(){var a,c,d,g;a=h;c=ha();if(c!==e){d=[];for(g=C();g!==e;)d.push(g),g=C();d!==e?a=c+=d.join(""):(h=a,a=e)}else h=a,a=e;return a}function ha(){var a;Nb.test(b.charAt(h))?(a=b.charAt(h),h++):(a=e,0===r&&k(mc));return a}function C(){var a;nc.test(b.charAt(h))?(a=b.charAt(h),h++):(a=e,0===r&&k(oc));return a}function K(){var a;Ob.test(b.charAt(h))?(a=b.charAt(h),h++):(a=e,0===r&&k(pc));return a}function R(){var a,c,d;a=h;64===b.charCodeAt(h)?(c=qc,h++):(c=e,0===r&&
k(rc));c!==e?(d=G(),d!==e?a=c=[c,d]:(h=a,a=e)):(h=a,a=e);a!==e&&(a={type:"param",value:a[1]});return a}function Y(){var a,c,d;a=h;b.substr(h,7).toLowerCase()===Jd?(c=b.substr(h,7),h+=7):(c=e,0===r&&k(Kd));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="LEADING":(h=a,a=e)):(h=a,a=e);a===e&&(a=h,b.substr(h,8).toLowerCase()===Ld?(c=b.substr(h,8),h+=8):(c=e,0===r&&k(Md)),c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="TRAILING":(h=a,a=e)):(h=a,a=e),a===e&&(a=h,b.substr(h,4).toLowerCase()===
Nd?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(Od)),c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="BOTH":(h=a,a=e)):(h=a,a=e)));return a}function Z(){var a;a=ca();a===e&&(a=R());return a}function ca(){var a,c,d;a=h;39===b.charCodeAt(h)?(c=ib,h++):(c=e,0===r&&k(Ra));c===e&&(b.substr(h,2)===Pb?(c=Pb,h+=2):(c=e,0===r&&k(jb)));if(c!==e){c=[];d=h;b.substr(h,2)===pa?(d=pa,h+=2):(d=e,0===r&&k(Qb));d!==e&&(d="'");d===e&&(Rb.test(b.charAt(h))?(d=b.charAt(h),h++):(d=e,0===r&&k(Da)));for(;d!==e;)c.push(d),
d=h,b.substr(h,2)===pa?(d=pa,h+=2):(d=e,0===r&&k(Qb)),d!==e&&(d="'"),d===e&&(Rb.test(b.charAt(h))?(d=b.charAt(h),h++):(d=e,0===r&&k(Da)));c!==e?(39===b.charCodeAt(h)?(d=ib,h++):(d=e,0===r&&k(Ra)),d!==e?a=c={type:"string",value:c.join("")}:(h=a,a=e)):(h=a,a=e)}else h=a,a=e;return a}function la(){var a,c,d;a=h;c=Sa();c!==e?(c=t(),c!==e?(c=B(),c!==e?(d=t(),d!==e?(d=kb(),d!==e?(d=t(),d!==e?(d=B(),d!==e?a=c={type:"when_clause",operand:c,value:d}:(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=
a,a=e)):(h=a,a=e);return a}function F(){var a,c,d;a=h;c=Sa();c!==e?(c=t(),c!==e?(c=B(),c!==e?(d=t(),d!==e?(d=kb(),d!==e?(d=t(),d!==e?(d=B(),d!==e?a=c={type:"when_clause",operand:c,value:d}:(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e)):(h=a,a=e);return a}function O(){var a,c;a=h;var d,g;c=h;b.substr(h,4).toLowerCase()===Pd?(d=b.substr(h,4),h+=4):(d=e,0===r&&k(Qd));d!==e?(d=h,r++,g=C(),r--,g===e?d=void 0:(h=d,d=e),d!==e?c="ELSE":(h=c,c=e)):(h=c,c=e);c!==e?(c=t(),c!==e?(c=B(),c!==
e?a={type:"else_clause",value:c}:(h=a,a=e)):(h=a,a=e)):(h=a,a=e);return a}function Q(){var a,c,d;a=E();a===e&&(a=h,45===b.charCodeAt(h)?(c=Oa,h++):(c=e,0===r&&k(Ja)),c===e&&(43===b.charCodeAt(h)?(c=U,h++):(c=e,0===r&&k(Ba))),c!==e?(d=E(),d!==e?a=c=c[0]+d:(h=a,a=e)):(h=a,a=e));return a}function da(){var a,c;a=h;46===b.charCodeAt(h)?(c=yb,h++):(c=e,0===r&&k(sc));c!==e?(c=E(),c===e&&(c=null),c!==e?a="."+(null!=c?c:""):(h=a,a=e)):(h=a,a=e);return a}function M(){var a,c,d;c=a=h;lb.test(b.charAt(h))?(d=
b.charAt(h),h++):(d=e,0===r&&k(tc));d!==e?(zb.test(b.charAt(h))?(d=b.charAt(h),h++):(d=e,0===r&&k(Rd)),d===e&&(d=null),d!==e?c="e"+(null===d?"":d):(h=c,c=e)):(h=c,c=e);c!==e?(d=E(),d!==e?a=c+d:(h=a,a=e)):(h=a,a=e);return a}function E(){var a,c;a=[];c=qa();if(c!==e)for(;c!==e;)a.push(c),c=qa();else a=e;a!==e&&(a=a.join(""));return a}function qa(){var a;Ab.test(b.charAt(h))?(a=b.charAt(h),h++):(a=e,0===r&&k(uc));return a}function Fa(){var a,c,d;a=h;b.substr(h,2).toLowerCase()===Sd?(c=b.substr(h,2),
h+=2):(c=e,0===r&&k(Td));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="IN":(h=a,a=e)):(h=a,a=e);return a}function ya(){var a,c,d;a=h;b.substr(h,2).toLowerCase()===Ud?(c=b.substr(h,2),h+=2):(c=e,0===r&&k(Vd));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="IS":(h=a,a=e)):(h=a,a=e);return a}function ia(){var a,c,d;a=h;b.substr(h,4).toLowerCase()===Wd?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(Xd));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="LIKE":(h=a,a=e)):(h=a,a=e);
return a}function P(){var a,c,d;a=h;b.substr(h,3).toLowerCase()===Yd?(c=b.substr(h,3),h+=3):(c=e,0===r&&k(Zd));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="NOT":(h=a,a=e)):(h=a,a=e);return a}function ja(){var a,c,d;a=h;b.substr(h,3).toLowerCase()===$d?(c=b.substr(h,3),h+=3):(c=e,0===r&&k(ae));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="AND":(h=a,a=e)):(h=a,a=e);return a}function Ga(){var a,c,d;a=h;b.substr(h,2).toLowerCase()===be?(c=b.substr(h,2),h+=2):(c=e,0===r&&k(ce));
c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="OR":(h=a,a=e)):(h=a,a=e);return a}function na(){var a,c,d;a=h;b.substr(h,7).toLowerCase()===de?(c=b.substr(h,7),h+=7):(c=e,0===r&&k(ee));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="BETWEEN":(h=a,a=e)):(h=a,a=e);return a}function La(){var a,c,d;a=h;b.substr(h,4).toLowerCase()===fe?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(ge));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="FROM":(h=a,a=e)):(h=a,a=e);return a}function Sb(){var a,
c,d;a=h;b.substr(h,4).toLowerCase()===he?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(ie));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="TRIM":(h=a,a=e)):(h=a,a=e);return a}function gb(){var a,c,d;a=h;b.substr(h,4).toLowerCase()===je?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(ke));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="CASE":(h=a,a=e)):(h=a,a=e);return a}function wb(){var a,c,d;a=h;b.substr(h,3).toLowerCase()===le?(c=b.substr(h,3),h+=3):(c=e,0===r&&k(me));c!==e?(c=h,r++,d=C(),r--,
d===e?c=void 0:(h=c,c=e),c!==e?a="END":(h=a,a=e)):(h=a,a=e);return a}function Sa(){var a,c,d;a=h;b.substr(h,4).toLowerCase()===ne?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(oe));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="WHEN":(h=a,a=e)):(h=a,a=e);return a}function kb(){var a,c,d;a=h;b.substr(h,4).toLowerCase()===pe?(c=b.substr(h,4),h+=4):(c=e,0===r&&k(qe));c!==e?(c=h,r++,d=C(),r--,d===e?c=void 0:(h=c,c=e),c!==e?a="THEN":(h=a,a=e)):(h=a,a=e);return a}function Aa(){var a;44===b.charCodeAt(h)?
(a=re,h++):(a=e,0===r&&k(se));return a}function S(){var a;40===b.charCodeAt(h)?(a=te,h++):(a=e,0===r&&k(ue));return a}function ra(){var a;41===b.charCodeAt(h)?(a=ve,h++):(a=e,0===r&&k(we));return a}function t(){var a,c;a=[];for(c=V();c!==e;)a.push(c),c=V();return a}function V(){var a;xe.test(b.charAt(h))?(a=b.charAt(h),h++):(a=e,0===r&&k(ye));return a}function fa(a,e,c,d){a={type:"binary_expr",operator:a,left:e,right:c};void 0!==d&&(a.escape=d);return a}function W(a,e){for(var c=0;c<e.length;c++)a=
fa(e[c][1],a,e[c][3]);return a}m=void 0!==m?m:{};var e={},Ea={start:A},mb=A,ea="!",ga=l("!",!1),za="\x3d",Ha=l("\x3d",!1),Ua="\x3e\x3d",pb=l("\x3e\x3d",!1),sa="\x3e",Ia=l("\x3e",!1),Va="\x3c\x3d",Ma=l("\x3c\x3d",!1),Na="\x3c\x3e",Tb=l("\x3c\x3e",!1),Ub="\x3c",w=l("\x3c",!1),z="!\x3d",I=l("!\x3d",!1),U="+",Ba=l("+",!1),Oa="-",Ja=l("-",!1),Wa="*",Vb=l("*",!1),Bb="/",Ka=l("/",!1),Nb=/^[A-Za-z_\x80-\uFFFF]/,mc=v([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),nc=/^[A-Za-z0-9_]/,oc=v([["A","Z"],["a",
"z"],["0","9"],"_"],!1,!1),Ob=/^[A-Za-z0-9_.\x80-\uFFFF]/,pc=v([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),qc="@",rc=l("@",!1),ib="'",Ra=l("'",!1),Pb="N'",jb=l("N'",!1),pa="''",Qb=l("''",!1),Rb=/^[^']/,Da=v(["'"],!0,!1),yb=".",sc=l(".",!1),Ab=/^[0-9]/,uc=v([["0","9"]],!1,!1),lb=/^[eE]/,tc=v(["e","E"],!1,!1),zb=/^[+\-]/,Rd=v(["+","-"],!1,!1),jd="null",kd=l("NULL",!0),fd="true",gd=l("TRUE",!0),hd="false",id=l("FALSE",!0),Sd="in",Td=l("IN",!0),Ud="is",Vd=l("IS",!0),Wd="like",Xd=
l("LIKE",!0),dd="escape",ed=l("ESCAPE",!0),Yd="not",Zd=l("NOT",!0),$d="and",ae=l("AND",!0),be="or",ce=l("OR",!0),de="between",ee=l("BETWEEN",!0),fe="from",ge=l("FROM",!0),Fd="for",Gd=l("FOR",!0),Dd="substring",Ed=l("SUBSTRING",!0),pd="extract",qd=l("EXTRACT",!0),he="trim",ie=l("TRIM",!0),Hd="position",Id=l("POSITION",!0),nd="timestamp",od=l("TIMESTAMP",!0),ld="date",md=l("DATE",!0),Jd="leading",Kd=l("LEADING",!0),Ld="trailing",Md=l("TRAILING",!0),Nd="both",Od=l("BOTH",!0),rd="year",sd=l("YEAR",!0),
td="month",ud=l("MONTH",!0),vd="day",wd=l("DAY",!0),xd="hour",yd=l("HOUR",!0),zd="minute",Ad=l("MINUTE",!0),Bd="second",Cd=l("SECOND",!0),je="case",ke=l("CASE",!0),le="end",me=l("END",!0),ne="when",oe=l("WHEN",!0),pe="then",qe=l("THEN",!0),Pd="else",Qd=l("ELSE",!0),re=",",se=l(",",!1),te="(",ue=l("(",!1),ve=")",we=l(")",!1),xe=/^[ \t\n\r]/,ye=v([" ","\t","\n","\r"],!1,!1),Wc="`",Xc=l("`",!1),Yc=/^[^`]/,Zc=v(["`"],!0,!1),h=0,Ta=[{line:1,column:1}],oa=0,ob=[],r=0,nb;if("startRule"in m){if(!(m.startRule in
Ea))throw Error("Can't start parsing from rule \""+m.startRule+'".');mb=Ea[m.startRule]}nb=mb();if(nb!==e&&h===b.length)return nb;nb!==e&&h<b.length&&k({type:"end"});throw function(a,e,c){return new p(p.buildMessage(a,e),a,e,c)}(ob,oa<b.length?b.charAt(oa):null,oa<b.length?x(oa,oa+1):x(oa,oa));}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/PooledArray ../../../../core/urlUtils ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(p,b,m,l,v,f,x){var k="version level sharedResource attributeData geometryData textureData lodSelection".split(" ");p=function(){function b(d,b,a,g,f,c,k,m,B,D,y,x){var q=this;this.rootId=a;this.progressiveLoadPenalty=g;this.nodeIndex=f;this.streamDataSupplier=c;this.viewportQueries=k;this.logger=m;this._isLoaded=B;this._isSelected=D;this._enable=y;this._needsUpdate=x;this._prefetching=this._loading=this._dirty=!0;this._loadingNodes=new Set;this._indexMissing=1;this._nodesMissing=0;this._maxUnloadedPrio=
Number.NEGATIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new l;this._prefetch=new l;this._updates=new A;this.ignoreServiceOBB=!1;this._maxLodLevel=this.viewportQueries.maxLodLevel;this.rootUrl=v.makeAbsolute(b,d);this.traverseVisible(function(a,c){return q.nodeTraversalState(c)})}b.prototype.requestReload=function(){this._prefetching=this._loading=this._dirty=!0;++this._version};b.prototype.update=
function(d){var b=this;if(this._dirty){this._nodesMissing=this._indexMissing=0;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(d);this._prefetching=this._loading=!1;var a=!0,g=new y,f=new y;this.traverseVisible(function(c,k,q){b._updateFeatureEstimate(k,f);if(k){if(0===b._missing.length&&k.children)for(c=0,q=k.children;c<q.length;c++){var n=q[c];b.nodeIndex[n.id]||(b._prefetching=!0,b._loadingNodes.has(n.id)||b._prefetch.push(m({},n,
{baseUrl:k.baseUrl})))}!k.failed&&k.featureData&&0!==k.featureData.length&&(b._isLoaded(k)?(g.known+=k.memory,++g.knownNodes,b._isSelected(k)?k.children&&(a=!1):(g.unremoved+=k.memory,a=!1),b._needsUpdate(k)&&b._updates.update.push(k)):(k.memory&&(g.known+=k.memory,++g.knownNodes),b._isSelected(k)&&(++b._nodesMissing,k.children&&(a=!1),k.memory?(g.missing+=k.memory,g.known+=k.memory,++g.knownNodes):++g.missingNodes,0<=d.indexOf(k.id)?b._updates.cancel=b._updates.cancel.filter(function(a){return a!==
k.id}):b._enable(k)||b._updates.add.push(k))))}else++b._indexMissing,b._loading=!0,b._prefetching=!1,b._loadingNodes.has(c.id)||b._missing.push(m({},c,{baseUrl:q}))});this._unloadedMemoryEstimate=g.missing-g.unremoved;3<g.knownNodes&&(this._unloadedMemoryEstimate+=g.missingNodes*g.known/g.knownNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=f.known-f.missing;this._featureEstimate.leafsReached=a;if(0<f.knownNodes){var c=f.missing-f.unremoved+
f.known/f.knownNodes*f.missingNodes;0<this._featureEstimate.estimate+c&&(this._featureEstimate.estimate+=c)}this._dirty=0<this._indexMissing||0<this._nodesMissing||0<this._updates.add.length||0<this._updates.update.length||0<this._updates.cancel.length}};b.prototype.checkFeatureTarget=function(d,b){var a=this;b=this.viewportQueries.updateScreenSpaceErrorBias(b);++this._version;var g=new y;this.traverseVisible(function(c,d){return a._updateFeatureEstimate(d,g)});var f=g.known-g.missing;if(0<g.knownNodes){var c=
g.missing-g.unremoved+g.known/g.knownNodes*g.missingNodes;0<f+c&&(f+=c)}this.viewportQueries.updateScreenSpaceErrorBias(b);++this._version;return f<=d};b.prototype._updateFeatureEstimate=function(d,b){d&&!d.failed&&d.featureData&&0!==d.featureData.length&&(this._isLoaded(d)?(b.known+=d.numFeatures,++b.knownNodes,this._isSelected(d)||(b.unremoved+=d.numFeatures)):this._isSelected(d)&&(d.numFeatures?(b.missing+=d.numFeatures,b.known+=d.numFeatures,++b.knownNodes):++b.missingNodes))};b.prototype.load=
function(d){var b=this;f.buildTopNodeMap(this._missing,d,function(a){return b.entryPriority(a)});if(0>=this._missing.length)return this._loading;this._maxUnloadedPrio=this.entryPriority(this._missing.front());this._missing.forEach(function(a){return b._loadNode(a)});this._missing.clear();return this._loading};b.prototype.prefetch=function(d){var b=this;f.buildTopNodeMap(this._prefetch,d,function(a){return b.entryPriority(a)});this._prefetch.forEach(function(a){return b._loadNode(a)});this._prefetch.clear();
return this._prefetching};b.prototype.isLoading=function(){return this._loading};b.prototype.isPrefetching=function(){return this._prefetching};b.prototype.getIndexLoading=function(){return this._loadingNodes.size};b.prototype.getIndexMissing=function(){return this._indexMissing};b.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};b.prototype.getNodesMissing=function(){return this._nodesMissing};b.prototype.getUpdates=function(d){var b=this;f.buildTopNodeMap(this._updates.add,
d,function(a){return b.entryPriority(a)},this._maxUnloadedPrio);f.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(a){return b.entryPriority(a)});return this._updates};b.prototype.getFeatureEstimate=function(){return this._featureEstimate};b.prototype.nodeTraversalState=function(d){if(!d)return null;var b=this._nodeTraversalState[d.id];if(b&&b.version===this._version)return b;var a=this.viewportQueries.getLodLevel(d),g=this.viewportQueries.hasLOD(d),f=!0;if(g)if(d.parentNode){f=
this.nodeIndex[d.parentNode.id];if(null==f)return null;f=(f=this._nodeTraversalState[f.id])&&a>f.lodLevel}else f=0<a;if(b)return b.lodLevel=a,b.isChosen=f,b.version=this._version,b;this._nodeTraversalState[d.id]={nodeHasLOD:g,lodLevel:a,isChosen:f,version:this._version};return this._nodeTraversalState[d.id]};b.prototype._loadNode=function(d){var b=this;this._loadingNodes.add(d.id);var a=v.makeAbsolute(d.href,d.baseUrl);this.streamDataSupplier.request(a,"json").then(function(a,d){var c={id:d.id,mbs:d.mbs,
parentNode:d.parentNode,children:d.children,featureData:d.featureData};k.forEach(function(a){c[a]=d.hasOwnProperty(a)?d[a]:null});d.hasOwnProperty("obb")&&!b.ignoreServiceOBB&&(c.obb=x.clone(d.obb),c.hasServiceOBB=!0,b.viewportQueries.updateNode(c.id));b.nodeIndex[c.id]=c;c.baseUrl=a;c.featureData&&1===c.featureData.length&&c.featureData[0].featureRange&&(c.numFeatures=c.featureData[0].featureRange[1]-c.featureData[0].featureRange[0]+1);b.nodeTraversalState(c);b._loadingNodes.delete(c.id);b._dirty=
!0},function(g){b.loadErrorCallback(a);b._loadingNodes.delete(d.id);b._dirty=!0})};b.prototype.entryPriority=function(d){if(d.id===this.rootId)return 0;var b=0,a=this.nodeIndex[d.id];if(null!=a&&null!=a.parentNode){var g=this._nodeTraversalState[a.parentNode.id];null!=g&&(b=g.lodLevel)}for(g=this.progressiveLoadPenalty;a;a=a.parentNode?this.nodeIndex[a.parentNode.id]:null)if(this._isLoaded(a)){g=0;break}d=this.viewportQueries.distToPOI(d);return-d-b*(d+this.progressiveLoadPenalty)+g};b.prototype.traverseVisible=
function(d){var b=this.nodeIndex[this.rootId];b?this._traverse({id:this.rootId,mbs:b.mbs,href:this.rootUrl},b,d,""):d({id:this.rootId,mbs:null,href:this.rootUrl},null,"")};b.prototype._traverse=function(d,b,a,g){if(!b.children||0===b.children.length)this.viewportQueries.isGeometryVisible(b)&&a(d,b,g);else if(this.viewportQueries.isNodeVisible(b)&&(a(d,b,g),d=this.nodeTraversalState(b),!d.nodeHasLOD||d.lodLevel!==this._maxLodLevel))for(d=0,g=b.children;d<g.length;d++){var f=g[d],c=this.nodeIndex[f.id];
c?this._traverse(f,c,a,b.baseUrl):this.viewportQueries.isNodeVisible(f)&&a(f,null,b.baseUrl)}};b.prototype.loadErrorCallback=function(d){this.logger.warn("Error loading node: "+d)};b.prototype.updateStats=function(d){this._nodesMissing&&(d.nodes+=" + "+Math.round(this._nodesMissing));this._indexMissing&&(d.index+=" + "+this._indexMissing);if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-d.features;0<b?d.features+=" + "+b:0>b&&(d.features+=" - "+-b)}};return b}();var A=function(){function b(){this.update=
new l;this.add=new l;this.cancel=[]}b.prototype.reset=function(d){this.add.clear();this.update.clear();this.cancel=d};return b}(),y=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}();return p})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ./dito ./geometryUtils".split(" "),function(p,b,m,l,v,f){function x(a,d,b){return{center:l.vec3d.createFrom(a[0],
a[1],a[2]),halfSize:l.vec3.createFrom(d[0],d[1],d[2]),quaternion:l.quat4.createFrom(b[0],b[1],b[2],b[3])}}function k(a,d){var b=f.plane.distance(d,a.center);a=A(a,d);return b>a?1:b<-a?-1:0}function A(a,d){l.quat4.conjugate(a.quaternion,y);l.quat4d.multiplyVec3(y,d,B);a=a.halfSize;return Math.abs(B[0]*a[0])+Math.abs(B[1]*a[1])+Math.abs(B[2]*a[2])}Object.defineProperty(b,"__esModule",{value:!0});var y=l.quat4.create(),B=l.vec3.create(),d=l.vec3.create(),n=l.mat3.create();p=function(){return function(a){this.buffer=
new ArrayBuffer(56*a);this.obbs=Array(a);for(var d=0;d<a;d++)this.obbs[d]={center:new Float64Array(this.buffer,56*d+0,3),halfSize:new Float32Array(this.buffer,56*d+24,3),quaternion:new Float32Array(this.buffer,56*d+36,4)}}}();b.ObbArray=p;b.create=x;b.clone=function(a){return x(a.center,a.halfSize,a.quaternion)};b.set=function(a,d){l.vec3d.set(a.center,d.center);l.vec3.set(a.halfSize,d.halfSize);l.quat4.set(a.quaternion,d.quaternion)};b.compute=function(a,d){d||(d=x([0,0,0],[-1,-1,-1],[0,0,0,1]));
v.computeOBB(a,d);return d};b.intersectPlane=k;b.toAaBoundingBox=function(a,d){d||(d=m.create());var b=l.quat4.toMat3(a.quaternion,n),c=a.halfSize[0]*Math.abs(b[0])+a.halfSize[1]*Math.abs(b[3])+a.halfSize[2]*Math.abs(b[6]),g=a.halfSize[0]*Math.abs(b[1])+a.halfSize[1]*Math.abs(b[4])+a.halfSize[2]*Math.abs(b[7]),b=a.halfSize[0]*Math.abs(b[2])+a.halfSize[1]*Math.abs(b[5])+a.halfSize[2]*Math.abs(b[8]);d[0]=a.center[0]-c;d[1]=a.center[1]-g;d[2]=a.center[2]-b;d[3]=a.center[0]+c;d[4]=a.center[1]+g;d[5]=
a.center[2]+b;return d};b.minimumDistancePlane=function(a,d){var b=f.plane.distance(d,a.center);a=A(a,d);return b-a};b.maximumDistancePlane=function(a,d){var b=f.plane.distance(d,a.center);a=A(a,d);return b+a};b.isVisible=function(a,d){return 0>=k(a,d[0])&&0>=k(a,d[1])&&0>=k(a,d[2])&&0>=k(a,d[3])&&0>=k(a,d[4])&&0>=k(a,d[5])};b.intersectLine=function(a,b,f,c){void 0===c&&(c=0);l.quat4.conjugate(a.quaternion,y);l.vec3d.subtract(b,a.center,B);b=l.quat4d.multiplyVec3(y,B,B);f=l.quat4d.multiplyVec3(y,
f,d);for(var g=-Infinity,k=Infinity,q=0;3>q;q++)if(1E-6<Math.abs(f[q]))var n=(c+a.halfSize[q]-b[q])/f[q],m=(-c-a.halfSize[q]-b[q])/f[q],g=Math.max(g,Math.min(n,m)),k=Math.min(k,Math.max(n,m));else if(b[q]>a.halfSize[q]+c||b[q]<-a.halfSize[q]-c)return!1;return g<=k}})},"esri/views/3d/support/dito":function(){define(["require","exports","../lib/gl-matrix"],function(p,b,m){function l(a,c,d,b,g,f){if(!(1E-6>m.vec3d.length2(c)))for(m.vec3d.cross(d,c,G),m.vec3d.cross(b,c,ha),m.vec3d.cross(g,c,C),v(a,c,
D),R[1]=D[0],K[1]=D[1],Y[1]=K[1]-R[1],d=[d,b,g],b=[G,ha,C],g=0;3>g;++g){v(a,d[g],D);R[0]=D[0];K[0]=D[1];v(a,b[g],D);R[2]=D[0];K[2]=D[1];Y[0]=K[0]-R[0];Y[2]=K[2]-R[2];var k=A(Y);k<f.quality&&(m.vec3d.set(d[g],f.b0),m.vec3d.set(c,f.b1),m.vec3d.set(b[g],f.b2),f.quality=k)}}function v(a,c,d){var b=a.data,g=a.offsetIdx;a=a.strideIdx;d[0]=Number.POSITIVE_INFINITY;for(d[1]=Number.NEGATIVE_INFINITY;g<b.length;g+=a){var f=b[g]*c[0]+b[g+1]*c[1]+b[g+2]*c[2];d[0]=Math.min(d[0],f);d[1]=Math.max(d[1],f)}}function f(a,
c,d){m.vec3d.set(a,d.center);m.vec3d.scale(c,.5,d.halfSize);m.quat4.identity(d.quaternion)}function x(a,c,d,b,g,f){v(a,c,D);g[0]=D[0];f[0]=D[1];v(a,d,D);g[1]=D[0];f[1]=D[1];v(a,b,D);g[2]=D[0];f[2]=D[1]}function k(a,c,d,b,g,f,k){E[0]=a[0];E[3]=a[1];E[6]=a[2];E[1]=c[0];E[4]=c[1];E[7]=c[2];E[2]=d[0];E[5]=d[1];E[8]=d[2];m.quat4.fromRotationMatrix(E,k.quaternion);m.vec3d.add(b,g,qa);m.vec3d.scale(qa,.5);m.vec3d.scale(a,qa[0],k.center);m.vec3d.scale(c,qa[1],M);m.vec3d.add(k.center,M);m.vec3d.scale(d,qa[2],
M);m.vec3d.add(k.center,M);m.vec3d.scale(f,.5,k.halfSize)}function A(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}Object.defineProperty(b,"__esModule",{value:!0});var y=m.vec3d.create(),B=m.vec3d.create();b.computeOBB=function(b,v){var p=b.data.length/b.strideIdx;if(!(0>=p)){var G=new Fa(b);m.vec3d.add(G.minProj,G.maxProj,y);m.vec3d.scale(y,.5);m.vec3d.subtract(G.maxProj,G.minProj,B);var C=A(B),P=new ya;P.quality=C;14>p&&(b={data:new Float64Array(G.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var K=
m.vec3d.create(),ia=m.vec3d.create(),E=m.vec3d.create(),p=m.vec3d.create(),ha=m.vec3d.create(),R=m.vec3d.create(),Y=m.vec3d.create(),S;S=b;for(var M=m.vec3d.dist2(G.maxVert[0],G.minVert[0]),t=0,V=1;7>V;++V){var fa=m.vec3d.dist2(G.maxVert[V],G.minVert[V]);fa>M&&(M=fa,t=V)}m.vec3d.set(G.minVert[t],K);m.vec3d.set(G.maxVert[t],ia);if(1E-6>m.vec3d.dist2(K,ia))S=1;else{m.vec3d.subtract(K,ia,p);m.vec3d.normalize(p);G=S.data;M=S.strideIdx;t=Number.NEGATIVE_INFINITY;V=0;for(fa=S.offsetIdx;fa<G.length;fa+=
M){m.vec3d.set3(G[fa]-K[0],G[fa+1]-K[1],G[fa+2]-K[2],J);var W=p[0]*J[0]+p[1]*J[1]+p[2]*J[2],e=m.vec3d.length2(p),W=m.vec3d.length2(J)-W*W/e;W>t&&(t=W,V=fa)}m.vec3d.set3(G[V],G[V+1],G[V+2],E);1E-6>t?S=2:(m.vec3d.subtract(ia,E,ha),m.vec3d.normalize(ha),m.vec3d.subtract(E,K,R),m.vec3d.normalize(R),m.vec3d.cross(ha,p,Y),m.vec3d.normalize(Y),l(S,Y,p,ha,R,P),S=0)}switch(S){case 1:f(y,B,v);return;case 2:C=b;m.vec3d.set(p,ca);Math.abs(p[0])>Math.abs(p[1])&&Math.abs(p[0])>Math.abs(p[2])?ca[0]=0:Math.abs(p[1])>
Math.abs(p[2])?ca[1]=0:ca[2]=0;1E-6>m.vec3d.length2(ca)&&(ca[0]=ca[1]=ca[2]=1);m.vec3d.cross(p,ca,la);m.vec3d.normalize(la);m.vec3d.cross(p,la,F);m.vec3d.normalize(F);x(C,p,la,F,O,Q);m.vec3d.subtract(Q,O,da);k(p,la,F,O,Q,da,v);return}S=b;G=d;M=n;t=D;V=S.data;W=S.offsetIdx;fa=S.strideIdx;m.vec3d.set3(V[W],V[W+1],V[W+2],M);m.vec3d.set(M,G);t[0]=m.vec3d.dot(Z,Y);t[1]=t[0];for(W+=fa;W<V.length;W+=fa)m.vec3d.set3(V[W],V[W+1],V[W+2],Z),e=m.vec3d.dot(Z,Y),e<t[0]&&(t[0]=e,m.vec3d.set(Z,M)),e>t[1]&&(t[1]=
e,m.vec3d.set(Z,G));Y=m.vec3d.dot(K,Y);D[1]-1E-6<=Y&&(G[0]=void 0);D[0]+1E-6>=Y&&(M[0]=void 0);void 0!==d[0]&&(m.vec3d.subtract(d,K,a),m.vec3d.normalize(a),m.vec3d.subtract(d,ia,g),m.vec3d.normalize(g),m.vec3d.subtract(d,E,q),m.vec3d.normalize(q),m.vec3d.cross(g,p,c),m.vec3d.normalize(c),m.vec3d.cross(q,ha,u),m.vec3d.normalize(u),m.vec3d.cross(a,R,N),m.vec3d.normalize(N),l(S,c,p,g,a,P),l(S,u,ha,q,g,P),l(S,N,R,a,q,P));void 0!==n[0]&&(m.vec3d.subtract(n,K,a),m.vec3d.normalize(a),m.vec3d.subtract(n,
ia,g),m.vec3d.normalize(g),m.vec3d.subtract(n,E,q),m.vec3d.normalize(q),m.vec3d.cross(g,p,c),m.vec3d.normalize(c),m.vec3d.cross(q,ha,u),m.vec3d.normalize(u),m.vec3d.cross(a,R,N),m.vec3d.normalize(N),l(S,c,p,g,a,P),l(S,u,ha,q,g,P),l(S,N,R,a,q,P));x(b,P.b0,P.b1,P.b2,O,Q);b=m.vec3d.create();m.vec3d.subtract(Q,O,b);P.quality=A(b);P.quality<C?k(P.b0,P.b1,P.b2,O,Q,b,v):f(y,B,v)}};var d=m.vec3d.create(),n=m.vec3d.create(),a=m.vec3d.create(),g=m.vec3d.create(),q=m.vec3d.create(),c=m.vec3d.create(),u=m.vec3d.create(),
N=m.vec3d.create(),J=m.vec3d.create(),D=m.vec2d.create(),G=m.vec3d.create(),ha=m.vec3d.create(),C=m.vec3d.create(),K=m.vec3d.create(),R=m.vec3d.create(),Y=m.vec3d.create(),Z=m.vec3d.create(),ca=m.vec3d.create(),la=m.vec3d.create(),F=m.vec3d.create(),O=m.vec3d.create(),Q=m.vec3d.create(),da=m.vec3d.create(),M=m.vec3d.create(),E=m.mat3.create(),qa=m.vec3d.create(),Fa=function(){return function(a){this.minVert=[];this.maxVert=[];this.buffer=new ArrayBuffer(448);var c=0;this.minProj=new Float64Array(this.buffer,
c,7);c+=56;this.maxProj=new Float64Array(this.buffer,c,7);for(c+=56;7>this.minVert.length;)this.minVert.push(new Float64Array(this.buffer,c,3)),c+=24;for(;7>this.maxVert.length;)this.maxVert.push(new Float64Array(this.buffer,c,3)),c+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=Number.NEGATIVE_INFINITY;for(var d=[],b=[],g=a.data,f=a.strideIdx,c=a.offsetIdx;c<g.length;c+=f)a=g[c],a<this.minProj[0]&&(this.minProj[0]=a,d[0]=c),a>this.maxProj[0]&&(this.maxProj[0]=a,b[0]=
c),a=g[c+1],a<this.minProj[1]&&(this.minProj[1]=a,d[1]=c),a>this.maxProj[1]&&(this.maxProj[1]=a,b[1]=c),a=g[c+2],a<this.minProj[2]&&(this.minProj[2]=a,d[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,b[2]=c),a=g[c]+g[c+1]+g[c+2],a<this.minProj[3]&&(this.minProj[3]=a,d[3]=c),a>this.maxProj[3]&&(this.maxProj[3]=a,b[3]=c),a=g[c]+g[c+1]-g[c+2],a<this.minProj[4]&&(this.minProj[4]=a,d[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,b[4]=c),a=g[c]-g[c+1]+g[c+2],a<this.minProj[5]&&(this.minProj[5]=a,d[5]=c),a>this.maxProj[5]&&
(this.maxProj[5]=a,b[5]=c),a=g[c]-g[c+1]-g[c+2],a<this.minProj[6]&&(this.minProj[6]=a,d[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,b[6]=c);for(c=0;7>c;++c)a=d[c],m.vec3d.set3(g[a],g[a+1],g[a+2],this.minVert[c]),a=b[c],m.vec3d.set3(g[a],g[a+1],g[a+2],this.maxVert[c])}}(),ya=function(){return function(){this.b0=m.vec3d.createFrom(1,0,0);this.b1=m.vec3d.createFrom(0,1,0);this.b2=m.vec3d.createFrom(0,0,1);this.quality=0}}()})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports",
"../../../../core/PooledArray"],function(p,b,m){p=function(){function b(b,l){this.layerView=b;this.lodGlobalDirtyChanged=l}b.prototype.startNodeLoading=function(b,l,k,m,y,B){this._lodGlobalDirty=!1;this._maxLodLevel=B.maxLodLevel;this._nodeIndex=m;this._rootId=y;this._nodeTraversalState=k;this._isNodeVisible=b;this._isGeometryVisible=l;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};b.prototype.shouldLoadNode=function(b){var f=this._nodeTraversalState(b);return f.isChosen?f.lodLevel===this._maxLodLevel?
!0:this.childrenEmpty(b):!1};b.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};b.prototype.lodSwapBundleLoaded=function(b){this.setLodGlobalDirty()};Object.defineProperty(b.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||1.1<this.layerView.view.resourceController.usedMemory)},enumerable:!0,configurable:!0});b.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var b=
this._rootId,m=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.usedMemory-1)));l.clear();this._lodGlobalHandlingRecursion(b,m);this.layerView.removeNodeData(l);l.clear();this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}};b.prototype._lodGlobalHandlingRecursion=function(b,m){b=this._nodeIndex[b];if(null==b)return!1;var f=this._nodeTraversalState(b),A=f.isChosen&&(!f.nodeHasLOD||f.lodLevel===this._maxLodLevel);(f=this.layerView.isNodeLoaded(b))&&null!=this.layerView.setPolygonOffset&&
this.layerView.setPolygonOffset(b,!A);if(A&&f)return this._removeChildrenRecursive(b),!0;var y=!1;if(null!=b.children&&0!==b.children.length)for(var y=!0,B=0,d=b.children;B<d.length;B++){var n=d[B],a=this._nodeIndex[n.id];if(a?this._isGeometryVisible(a):this._isNodeVisible(n))n=this._lodGlobalHandlingRecursion(n.id,m),y=y&&n}f&&!A&&(y||l.length<m)&&(l.push(b),f=!1);m=!b.featureData||0===b.featureData.length;return y||f||m};b.prototype._removeChildrenRecursive=function(b){if(null!=b.children){var f=
0;for(b=b.children;f<b.length;f++){var k=this._nodeIndex[b[f].id];null!=k&&(this._removeChildrenRecursive(k),l.push(k))}}};b.prototype._subtreeEmpty=function(b){return this.layerView.isNodeLoaded(b)?!1:this.childrenEmpty(b)};b.prototype.childrenEmpty=function(b){if(null==b.children)return!0;var f=0;for(b=b.children;f<b.length;f++){var k=b[f];if(this._isNodeVisible(k)&&(k=this._nodeIndex[k.id],null!=k&&!this._subtreeEmpty(k)))return!1}return!0};return b}();var l=new m;return p})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/Deferred dojo/errors/CancelError ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SUtil ../../webgl-engine/lib/Util".split(" "),
function(p,b,m,l,v,f,x,k,A,y){p=function(){function b(d,k,a,g,q){this.loader=d;this.logger=k;this.defaultGeometrySchema=a;this.requiredAttributes=g;this.options=q;this.cancelled=!1;this.loadShared=function(a){if(null==a.sharedResource)return f.resolve({});var c=x.makeAbsolute(a.sharedResource.href,a.baseUrl);return this.load(c,"json").then(function(a){b.fixTextureEncodings(a);b.addAbsoluteHrefTexture(a,c);return a})}}b.prototype.cancelAll=function(){this.cancelled=!0};b.prototype.load=function(d,
b){b=this.loader.request(d,b);var a=new m;b.then(function(d,b){a.resolve(b)},function(b){a.reject(Error("Failed to load: "+d))});return a.promise};b.prototype.loadAttribute=function(d,b,a){d=x.makeAbsolute(a,d);return this.load(d,"binary").then(function(a){return k.readBinaryAttribute(b,a)})};b.prototype.loadAttributes=function(d,b,a){var g=this,k=a.map(function(a){return null==d.attributeData||null==d.attributeData[a.index]?(g.logger.error("Missing attributeData for '"+a.name+"' on node '"+d.id+
"'"),f.resolve(null)):g.loadAttribute(b,a.attributeStorageInfo,d.attributeData[a.index].href).catch(function(c){g.logger.error("Failed to load attributeData for '"+a.name+"' on node '"+d.id+"'");return null})});return f.all(k).then(function(c){for(var d={},b=0;b<a.length;++b)c[b]&&(d[a[b].name]=c[b]);return d})};b.prototype.prepareBinaryGeometryData=function(d,b,a,g){v.mixin(d.geometries[0].params,a);g||null!=a.vertexAttributes.region||delete a.vertexAttributes.region;if(null!=a.featureAttributes){g=
a.featureAttributes;if(g.faceRange){var f=k.createTypedView(b,g.faceRange);d.componentOffsets=A.convertFlatRangesToOffsets(f,a.header.fields.featureCount,g.faceRange.valuesPerElement)}if(g.id){d.featureIds=[];var f=1,c=k.valueType2TypedArrayClassMap[g.id.valueType];"UInt64"===g.id.valueType&&(c=Uint32Array,f=2);b=new c(b,g.id.byteOffset,g.id.count*g.id.valuesPerElement*f);for(c=0;c<a.header.fields.featureCount;c++)if(d.featureIds[c]=b[c*g.id.valuesPerElement*f],2===f){var l=b[c*g.id.valuesPerElement*
f+1];if(2097150<=l)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");d.featureIds[c]+=4294967296*l}}}};b.prototype.loadBundleData=function(d,b){var a=this,g=d.baseUrl,l=null,c=this.loadShared(d),n=null;null!=this.requiredAttributes&&(n=this.loadAttributes(d,g,this.requiredAttributes));var m=null;null!=d.geometryData&&(g=x.makeAbsolute(d.geometryData[b].href,g),m=this.load(g,"binary"));return c.then(function(c){a.handleCancelled();return(a.options.loadFeatureData?
a.loadFeatureData(d,b):f.resolve(null)).then(function(b){a.handleCancelled();var g=a.options.loadFeatureData?a.collectGeometries(d,b,c):a.meshPyramidGeometryData(d,c);b=null!=m?m.then(function(d){l=d;var b=Object.keys(c.materialDefinitions)[0],b=c.materialDefinitions[b].params.vertexRegions,f=k.createGeometryDataIndex(d,a.defaultGeometrySchema,b);a.prepareBinaryGeometryData(g[0],d,f,b);return g}):f.resolve(g);var q=a.loadTextures(g,c);return f.all([q,b,n])}).then(function(d){var b=d[0],g=d[1];d=d[2];
a.handleCancelled();var f=null;d&&(f={attributeData:d,loadedAttributes:a.requiredAttributes});return{allGeometryData:g,attributeDataInfo:f,geometryBuffer:l,sharedResource:c,textureData:b}})})};b.addAbsoluteHrefTexture=function(d,b){d=d.textureDefinitions;if(null!=d)for(var a=0,g=Object.keys(d);a<g.length;a++)for(var f=0,c=d[g[a]].images;f<c.length;f++){var k=c[f];Array.isArray(k.href)?k.hrefConcat=k.href.map(function(a){return x.makeAbsolute(a,b)}):k.hrefConcat=x.makeAbsolute(k.href,b)}};b.fixTextureEncodings=
function(d){d=d.textureDefinitions;if(null!=d)for(var b in d){var a=d[b];if(Array.isArray(a.encoding))for(var g=0;g<a.encoding.length;g++){var f=a.encoding[g];"data:"===f.substring(0,5)&&(a.encoding[g]=f.substring(5))}else f=a.encoding,"data:"===f.substring(0,5)&&(a.encoding=f.substring(5))}};b.prototype.loadTexture=function(d,b,a,g){var f=this;return g===A.DDS_ENCODING_STRING?this.load(d,"binary").then(function(a){f.handleCancelled();return{i3sTexId:b,data:a,encoding:g}}):this.load(d,"image").then(function(c){var d=
c;f.handleCancelled();if(a&&4096<=c.width*c.height){var d=Math.ceil(c.width/2),k=Math.ceil(c.height/2),l=document.createElement("canvas");l.width=d;l.height=k;l.getContext("2d").drawImage(c,0,0,d,k);d=l}return{i3sTexId:b,data:d,encoding:g}})};b.prototype.loadTextures=function(d,k){for(var a=[],g=0;g<d.length;g++){var l=d[g].geometries;if(null!=l)for(var c=0;c<l.length;c++){var n=l[c].params.textureID||"none";if("none"!==n){null!=k.textureDefinitions&&null!=k.textureDefinitions[n]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+
n);var m=k.textureDefinitions[n];y.assert(void 0!==m,"geometry wants unknown texture "+n);if(0!==m.images.length){var B=m.images[m.images.length-1],D=this.options.textureFormat===b.TextureFormat.Downsampled,p=A.getAppropriateTextureEncoding(m.encoding,this.options.textureFormat===b.TextureFormat.Compressed),m=-1<p?m.encoding[p]:m.encoding,B=-1<p?B.hrefConcat[p]:B.hrefConcat;this.options.loadTextureData?a.push(this.loadTexture(B,n,D,m)):a.push({i3sTexId:n,encoding:m,data:null})}}}}return f.all(a)};
b.prototype.meshPyramidGeometryData=function(d,b){d=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:d,textureID:b}}],featureDataPosition:[0,0,0]}]};b.prototype.collectGeometries=function(d,b,a){d=[];a=0;for(b=b.featureData;a<b.length;a++){var g=b[a],f=g.geometries;if(null!=f)for(var c=0;c<f.length;c++)d.push({featureIds:[g.id],featureDataPosition:g.position,
geometries:[g.geometries[c]]});else null!=g.position&&d.push({featureIds:[g.id],featureDataPosition:g.position,geometries:null})}return d};b.prototype.loadFeatureData=function(d,b){d=x.makeAbsolute(d.featureData[b].href,d.baseUrl);return this.load(d,"json")};b.prototype.handleCancelled=function(){if(this.cancelled)throw new l;};return b}();(function(b){b=b.TextureFormat||(b.TextureFormat={});b[b.Compressed=0]="Compressed";b[b.Normal=1]="Normal";b[b.Downsampled=2]="Downsampled"})(p||(p={}));return p})},
"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../geometry/Point ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../lib/gl-matrix ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),function(p,b,m,l,v,f,x,k,A,y,B,d){return function(){function b(a,d,b,c,f,n,y,p){void 0===p&&(p={});this.indexSR=a;this._renderCoordsHelper=
d;this.extent=f;this.elevationProvider=n;this.options=p;this._computedOBBs={};this._computedMBSs={};this._isNodeVisibleCached={};this.fp=[];this._idleCamera=!0;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=[0,0,0];this._tmp2=[0,0,0];this._tmp3=[0,0,0];this._tmp0=[0,0,0];this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=p.screenspaceErrorBias||1;this.progressiveLoadFactor=p.progressiveLoadFactor||
1;this.enableLoD=!p.disableLod;for(d=0;8>d;++d)this.fp[d]=A.plane.create();this.updateCamera(b);this._poi=k.vec3d.create(c);this.engineSR=this._renderCoordsHelper.spatialReference;y?(this._elevationContext=new l,this._elevationContext.featureExpressionInfoContext=v.createContext(v.extractExpressionInfo(y,!1)),this._elevationContext.mixinApi(y)):this._elevationContext=null;this.tmpPoint=new m({x:0,y:0,z:0,spatialReference:a})}b.prototype.updateCamera=function(a){d.matrixToFrustumPlanes(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/a.perPixelRatio;this._camPos=a.eye;this._isNodeVisibleCached={}};b.prototype.updateNode=function(a){delete this._isNodeVisibleCached[a]};b.prototype.updatePointOfInterest=function(a){k.vec3d.set(a,this._poi);this.maxDistance=0};b.prototype.updateScreenSpaceErrorBias=function(a){var d=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return d};b.prototype.setCameraIdle=function(a){this._idleCamera!==a&&(this._idleCamera=a,this._isNodeVisibleCached=
{})};b.prototype.updateExtent=function(a){this.extent=a;this._isNodeVisibleCached={}};b.prototype.computeMbs=function(a){var d=this._computedMBSs[a.id];d||(d=k.vec4d.createFrom(a.mbs[0],a.mbs[1],a.mbs[2],-1),this._computedMBSs[a.id]=d);0>d[3]&&(k.vec4d.set(a.mbs,d),this._elevationContext&&1E5>d[3]&&(this.tmpPoint.x=d[0],this.tmpPoint.y=d[1],this.tmpPoint.z=d[2],d[2]=f.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),B.mbsToMbs(d,this.indexSR,
d,this.engineSR));return d};b.prototype.computeObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])){var d=this._computedOBBs[a.id];d||(d=y.clone(a.obb),d.halfSize[0]=-1,this._computedOBBs[a.id]=d);0>d.halfSize[0]&&(d.halfSize[0]=a.obb.halfSize[0],k.vec3d.set(a.obb.center,d.center),this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],d.center[2]=f.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,
this._renderCoordsHelper,null)),B.bufferToBuffer(d.center,this.indexSR,0,d.center,this.engineSR,0,1));return d}};b.prototype._isNodeVisible=function(a){var d=this.computeMbs(a);return this.isMBSinExtent(d)?a.hasServiceOBB&&a.obb?(a=this.computeObb(a),y.isVisible(a,this.fp)):this.isMBSVisible(d):!1};b.prototype.isNodeVisible=function(a){if(!this.enableLoD)return!0;if(!this._idleCamera)return this._isNodeVisible(a);if(null!=this._isNodeVisibleCached[a.id])return this._isNodeVisibleCached[a.id];this._isNodeVisibleCached[a.id]=
this._isNodeVisible(a);return this._isNodeVisibleCached[a.id]};b.prototype.isGeometryVisible=function(a){return this.isNodeVisible(a)?a.hasServiceOBB?!0:(a=this.computeObb(a))?y.isVisible(a,this.fp):!0:!1};b.prototype.invalidateCache=function(a){if(null==a){for(var d=0,b=Object.keys(this._computedMBSs);d<b.length;d++)a=b[d],this._computedMBSs[a][3]=-1;d=0;for(b=Object.keys(this._computedOBBs);d<b.length;d++)a=b[d],this._computedOBBs[a].halfSize[0]=-1}else this._computedMBSs[a]&&(this._computedMBSs[a][3]=
-1),this._computedOBBs[a]&&(this._computedOBBs[a].halfSize[0]=-1)};b.prototype.isMBSinExtent=function(a){return this.extent?0!==x.intersectBoundingBoxWithMbs(this.extent,a):!0};b.prototype.isMBSVisible=function(a){var d=a[0],b=a[1],c=a[2];a=a[3];var f=this.fp;return f[0][0]*d+f[0][1]*b+f[0][2]*c+f[0][3]<=a&&f[1][0]*d+f[1][1]*b+f[1][2]*c+f[1][3]<=a&&f[2][0]*d+f[2][1]*b+f[2][2]*c+f[2][3]<=a&&f[3][0]*d+f[3][1]*b+f[3][2]*c+f[3][3]<=a&&f[4][0]*d+f[4][1]*b+f[4][2]*c+f[4][3]<=a&&f[5][0]*d+f[5][1]*b+f[5][2]*
c+f[5][3]<=a};b.prototype.calcScreenSpaceSize=function(a,d){a=this.computeMbs(a);var b=a[3];a=k.vec3d.dist2(a,this._camPos)-b*b;return 0>a?.5*Number.MAX_VALUE:d/Math.sqrt(a)*this._screenSizeFactor};b.prototype.calcCameraDistance=function(a){a=this.computeMbs(a);return Math.max(0,k.vec3d.dist(a,this._camPos)-a[3])};b.prototype.calcAngleDependentLoD=function(a){a=this.computeMbs(a);var d=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/k.vec3d.length(a)+
d)/k.vec3d.dist(a,this._camPos);return Math.min(1,a)};b.prototype.hasLOD=function(a){return null!=a.lodSelection};b.prototype.hasFeatures=function(a){return null!=a.featureData};b.prototype.getDistancePlanarMode=function(a,d,b){var c=a[0]-d[0],f=a[1]-d[1];a=a[2]-d[2];c=c+c+f*f;if(c<=b*b)return Math.abs(a);b=Math.sqrt(c)-b;return Math.sqrt(a*a+b*b)};b.prototype.getDistanceGlobeMode=function(a,d,b){var c=k.vec3d.length(d),f=k.vec3d.length(a)-c;k.vec3d.scale(a,k.vec3d.dot(a,d)/k.vec3d.length2(a),this._tmp0);
if(k.vec3d.dist2(d,this._tmp0)<=b*b)return Math.abs(f);d=k.vec3d.scale(d,1/c,this._tmp0);var c=k.vec3d.scale(d,c-b*b/2/c,this._tmp1),g=k.vec3d.subtract(a,c,this._tmp2),g=k.vec3d.subtract(g,k.vec3d.scale(d,k.vec3d.dot(d,g),this._tmp3),this._tmp2),c=k.vec3d.add(c,k.vec3d.scale(g,b/k.vec3d.length(g),this._tmp2),this._tmp2);b=k.vec3d.dist(a,c);2E5<=f&&(a=k.vec3d.subtract(a,c,this._tmp1),a=k.vec3d.dot(a,d)/k.vec3d.length(a),.08>a&&(a=1E-4),b/=a);return b};b.prototype.getDistance=function(a,d,b){return this.engineSR===
B.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,d,b):this.getDistancePlanarMode(a,d,b)};b.prototype._selectErrorMetric=function(a){for(var d=0;d<a.length;d++)if(0<=this.supportedMetrics.indexOf(a[d].metricType))return a[d];return null};b.prototype.getLodLevel=function(a){if(!a.lodSelection||0>=a.lodSelection.length||!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;var d=this.enableLoD?this._selectErrorMetric(a.lodSelection):null;if(null==
d)return 0;if(1>this.progressiveLoadFactor){var b=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,d)?this.evaluateLODmetric(a,b,d)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,d)?this.maxLodLevel:0};b.prototype.evaluateLODmetric=function(a,d,b){switch(b.metricType){case "screenSpaceRelative":return a=this.computeMbs(a),a=2*this.getDistance(this._camPos,a,a[3])/this._screenSizeFactor,b.maxError*d<=a;case "maxScreenThreshold":return d=
this.calcScreenSpaceSize(a,a.mbs[3]*d),this.options.angleDependentLoD&&(d*=this.calcAngleDependentLoD(a)),d<b.maxError;case "removedFeatureDiameter":return 10>this.calcScreenSpaceSize(a,b.maxError)*d;case "distanceRangeFromDefaultCamera":return this.calcCameraDistance(a)>b.maxError*d}return!1};b.prototype.distToPOI=function(a){a=this.computeMbs(a);a=k.vec3d.dist(a,this._poi)-a[3];this.maxDistance=Math.max(this.maxDistance,a);return a};b.prototype.distCameraToPOI=function(){return k.vec3d.dist(this._camPos,
this._poi)};return b}()})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/Deferred","dojo/errors/CancelError"],function(p,b,m,l){Object.defineProperty(b,"__esModule",{value:!0});p=function(){function b(){this._deferreds=[];this._values=[]}b.prototype.push=function(b){var f=new m;this._deferreds.push(f);this._values.push(b);return f.promise};b.prototype.unshift=function(b){var f=new m;this._deferreds.unshift(f);this._values.unshift(b);return f.promise};b.prototype.length=
function(){return this._deferreds.length};b.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())};b.prototype.cancelAll=function(){for(var b=new l,m=0,k=this._deferreds;m<k.length;m++)k[m].cancel(b);this._deferreds.length=0;this._values.length=0};return b}();b.IdleQueue=p})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/promiseUtils ../../../geometry/SpatialReference ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ../lib/gl-matrix ../support/meshProcessing ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),
function(p,b,m,l,v,f,x,k,A,y,B,d){p=function(){function b(){}b.prototype.process=function(a){var c=[a.geometryBuffer];return m.resolve({result:this.transform(a,c),transferList:c})};b.prototype.transform=function(c,b){var g=l.fromJSON(c.indexSR),q=l.fromJSON(c.vertexSR),m=l.fromJSON(c.renderSR),u=!1,p=0,C=[],K=f.computeGlobalTransformation(c.mbs,c.elevationOffset,g,m),R=c.obb?null:A.create([0,0,0],[-1,-1,-1],[0,0,0,1]);x.vec3d.set(c.mbs,n);n[2]+=c.elevationOffset;x.vec3d.set(n,a);for(var Y=0,Z=c.geometryData;Y<
Z.length;Y++)for(var ca=Z[Y],la=ca.componentOffsets,F=0,ca=ca.geometries;F<ca.length;F++){var O=ca[F],Q=c.layouts[p];++p;var da=v.interleaveGeometryBuffer(O,c.geometryBuffer,Q,[{name:d.VertexAttrConstants.COLOR,byteValue:255}],[d.VertexAttrConstants.NORMAL,d.VertexAttrConstants.NORMALCOMPRESSED,d.VertexAttrConstants.SYMBOLCOLOR,d.VertexAttrConstants.COMPONENTINDEX]),M=new B(new Float32Array(da),Q,void 0,void 0,void 0,!0),E=M.getAttribute(d.VertexAttrConstants.POSITION);f.reprojectPoints(E,c.mbs,K,
c.elevationOffset,g,q,m);R&&this._updateObb(R,E,K);c.needNormals&&(E={normals:M.getAttribute(d.VertexAttrConstants.NORMALCOMPRESSED),positions:E,normalInd:M.getIndices(d.VertexAttrConstants.NORMALCOMPRESSED),positionInd:M.getIndices(d.VertexAttrConstants.POSITION)},v.processAndInterleaveNormals(c.normalReferenceFrame,O,c.geometryBuffer,K,E));(O=M.getAttribute(d.VertexAttrConstants.COMPONENTINDEX))&&this._createComponentNumbers(O,la);(M=M.getAttribute(d.VertexAttrConstants.COLOR))&&!u&&(u=this._hasColors(M));
M={globalTrafo:K};O=Q[0].stride;O=k.deduplicate(da,O/4,1-.8*O/(O+4));null!=O?(da=65536>O.uniqueCount?new Uint16Array(O.indices):O.indices,E=v.extractPositionData(O.buffer,Q,da),C.push({layout:Q,interleavedVertexData:O.buffer,indices:da,corMatrices:M,hasColors:u,positionData:E}),b&&(b.push(O.buffer),b.push(da.buffer),b.push(E.data.buffer),b.push(E.indices.buffer))):(E=v.extractPositionData(da,Q),C.push({layout:Q,interleavedVertexData:da,corMatrices:M,hasColors:u,positionData:E}),b&&(b.push(da),b.push(E.data.buffer),
b.push(E.indices.buffer)))}R&&(x.mat4d.multiplyVec3(K,R.center,R.center),y.vectorToVector(R.center,m,R.center,g),R.center[2]-=c.elevationOffset);return{geometryBuffer:c.geometryBuffer,transformedGeometries:C,obb:R}};b.prototype._hasColors=function(a){var c=a.data,d=a.size,b=a.strideIdx;for(a=a.offsetIdx;a<c.length;a+=b)for(var f=0;f<d;f++)if(255!==c[a+f])return!0;return!1};b.prototype._createComponentNumbers=function(a,d){var c=a.data,b=a.strideIdx,f=c.length/b,g=0;a=a.offsetIdx;for(var k=0;k<f;k++)k>=
d[g+1]&&g++,c[a]=g,a+=b};b.prototype._updateObb=function(c,d,b){if(0<c.halfSize[0]){x.vec3d.subtract(c.center,c.halfSize,n);x.vec3d.add(c.center,c.halfSize,a);for(b=d.offsetIdx;b<d.data.length;b+=d.strideIdx)n[0]=Math.min(n[0],d.data[b]),n[1]=Math.min(n[1],d.data[b+1]),n[2]=Math.min(n[2],d.data[b+2]),a[0]=Math.max(a[0],d.data[b]),a[1]=Math.max(a[1],d.data[b+1]),a[2]=Math.max(a[2],d.data[b+2]);x.vec3d.subtract(a,n,c.halfSize);x.vec3d.scale(c.halfSize,.5);x.vec3d.add(n,a,c.center);x.vec3d.scale(c.center,
.5)}else A.compute(d,c),d=2*Math.sqrt(1+b[0]+b[5]+b[10]),g[0]=(b[9]-b[6])/d,g[1]=(b[2]-b[8])/d,g[2]=(b[4]-b[1])/d,g[3]=.25*d,x.quat4.conjugate(g),x.quat4.multiply(g,c.quaternion,c.quaternion)};return b}();var n=x.vec3d.create(),a=x.vec3d.create(),g=x.quat4.create();return p})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ./I3SBinaryReader ../../lib/gl-matrix ../../support/meshProcessing ../../webgl-engine/lib/Util".split(" "),function(p,b,m,l,v,f){function x(a,c,b,
f,g,k,l){switch(b){case 1:for(b=0;b<l;b++)f[g]=a[c],c+=1,g+=k;break;case 2:for(b=0;b<l;b++)f[g]=a[c],f[g+1]=a[c+1],c+=2,g+=k;break;case 3:for(b=0;b<l;b++)f[g]=a[c],f[g+1]=a[c+1],f[g+2]=a[c+2],c+=3,g+=k;break;case 4:for(b=0;b<l;b++)f[g]=a[c],f[g+1]=a[c+1],f[g+2]=a[c+2],f[g+3]=a[c+3],c+=4,g+=k;break;default:throw d("Unhandled stride size "+b);}}function k(a,c,b,f,g,k){switch(c){case 1:for(c=0;c<k;c++)b[f]=a,f+=g;break;case 2:for(c=0;c<k;c++)b[f]=a,b[f+1]=a,f+=g;break;case 3:for(c=0;c<k;c++)b[f]=a,b[f+
1]=a,b[f+2]=a,f+=g;break;case 4:for(c=0;c<k;c++)b[f]=a,b[f+1]=a,b[f+2]=a,b[f+3]=a,f+=g;break;default:throw d("Unhandled stride size "+c);}}function A(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function y(a){switch(a){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";
case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function B(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function d(a){return Error("I3SGeometryUtil processing failed: "+a)}Object.defineProperty(b,"__esModule",{value:!0});var n=new Uint8Array(64);b.interleaveGeometryBuffer=function(a,c,b,f,g){void 0===f&&(f=[]);void 0===g&&(g=[]);var l=a.params.vertexAttributes,m=l.position.count;if(!B(b[0].stride))throw d("Layout stride must use "+
Uint32Array.BYTES_PER_ELEMENT+"-byte words");var q=new Uint32Array(b[0].stride/Uint32Array.BYTES_PER_ELEMENT*m);b=b.slice(0).sort(function(a,c){return a.offset-c.offset});a=function(a){if(-1!==g.indexOf(a.name))return"continue";var b=l[a.name],p=A(a.type),u=void 0,v=!1;if(null==b)if(v=f.filter(function(c){return c.name===a.name})[0]){b={valueType:y(a.type),byteOffset:0,count:m,valuesPerElement:a.count};for(u=0;u<n.length;u++)n[u]=v.byteValue;u=n.buffer;v=!0}else throw d("Geometry definition is missing attribute");
else u=c;if(y(a.type)!==b.valueType)throw d("Geometry definition type must match attribute type");if(0!==b.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw d(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!B(b.valuesPerElement*p.BYTES_PER_ELEMENT)||!B(a.count*p.BYTES_PER_ELEMENT))throw d(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var u=new Uint32Array(u),D=b.byteOffset/Uint32Array.BYTES_PER_ELEMENT,b=
b.valuesPerElement*p.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,p=a.offset/Uint32Array.BYTES_PER_ELEMENT,G=a.stride/Uint32Array.BYTES_PER_ELEMENT;v?k(u[0],b,q,p,G,m):x(u,D,b,q,p,G,m)};for(var p=0;p<b.length;p++)a(b[p]);return q.buffer};b.processAndInterleaveNormals=function(b,c,d,k,n){if("none"===b){var q=n.normals,A=n.positions;c=n.normalInd;b=n.positionInd;f.assert(n.normalInd.length===n.positionInd.length);n=l.vec3.create();k=l.vec3.create();d=l.vec2.create();for(var p=A.data,y=A.offsetIdx,
A=A.strideIdx,B=q.data,v=q.offsetIdx,q=q.strideIdx,u=0;u<b.length;u+=3){var x=b[u],x=y+A*x,N=p[x],J=p[x+1],F=p[x+2],x=b[u+1],x=y+A*x;n[0]=p[x]-N;n[1]=p[x+1]-J;n[2]=p[x+2]-F;x=b[u+2];x=y+A*x;k[0]=p[x]-N;k[1]=p[x+1]-J;k[2]=p[x+2]-F;l.vec3.cross(n,k,n);f.encodeNormal(n,d);for(N=0;3>N;N++)J=v+q*c[u+N],B[J]=f.encodeInt16(d[0]),B[J+1]=f.encodeInt16(d[1])}}else if(c=m.createTypedView(d,c.params.vertexAttributes.normal),d=n.normals,J="earth-centered"===b?k:null,b=c.length/3,n=d.data,k=d.offsetIdx,d=d.strideIdx,
null!=J)for(p=J[0],y=J[1],A=J[2],B=J[4],v=J[5],q=J[6],u=J[8],N=J[9],J=J[10],F=0;F<b;F++){var x=c[3*F],O=c[3*F+1],Q=c[3*F+2];a[0]=p*x+y*O+A*Q;a[1]=B*x+v*O+q*Q;a[2]=u*x+N*O+J*Q;f.encodeNormal(a,g);n[k+F*d]=f.encodeInt16(g[0]);n[k+F*d+1]=f.encodeInt16(g[1])}else for(F=0;F<b;F++)a[0]=c[3*F],a[1]=c[3*F+1],a[2]=c[3*F+2],f.encodeNormal(a,g),n[k+F*d]=f.encodeInt16(g[0]),n[k+F*d+1]=f.encodeInt16(g[1])};b.extractPositionData=function(a,c,b){c=c[0];if(null==c||"position"!==c.name||5126!==c.type)return null;
var d=new Float32Array(a),f=c.stride/4,g=3*d.length/f,k=new Float32Array(g);for(a=0;a<g/3;a++)k[3*a]=d[a*f+c.offset],k[3*a+1]=d[a*f+c.offset+1],k[3*a+2]=d[a*f+c.offset+2];c=v.deduplicate(k.buffer,3);a=65536>c.uniqueCount;if(b)for(d=new (a?Uint16Array:Uint32Array)(b.length),a=0;a<b.length;a++)d[a]=c.indices[b[a]];else d=a?new Uint16Array(c.indices):c.indices;return{data:new Float32Array(c.buffer),indices:d}};var a=l.vec3.create(),g=l.vec2.create()})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["require",
"exports","../../lib/gl-matrix","../../support/earthUtils","../../support/projectionUtils"],function(p,b,m,l,v){function f(b,f,a){var d=m.vec3d.create(),k=Math.ceil(Math.log(b[3])*Math.LOG2E/B),c=Math.pow(2,k*B+y),n;if(a.isGeographic){n=c/l.earthRadius*180/Math.PI;a=Math.round(b[1]/n);var A=Math.max(-90,Math.min(90,a*n)),p=n/Math.cos((Math.abs(A)-n/2)/180*Math.PI);n=Math.round(b[0]/p);d[0]=n*p;d[1]=A}else n=Math.round(b[0]/c),a=Math.round(b[1]/c),d[0]=n*c,d[1]=a*c;b=Math.round((b[2]+f)/c);d[2]=b*
c;return{center:d,id:k+"_"+n+"_"+a+"_"+b}}Object.defineProperty(b,"__esModule",{value:!0});var x=new Float64Array(3E3),k=m.vec3d.create(),A=m.mat4d.create();b.computeGlobalTransformation=function(b,k,a,g){b=f(b,k,a).center;k=m.mat4d.create();v.computeLinearTransformation(a,b,k,g);return k};b.reprojectPoints=function(b,f,a,g,l,c,p){var d=b.data,n=b.offsetIdx;b=b.strideIdx;m.mat4d.inverse(a,A);m.vec3d.set(f,k);k[2]+=g;f=[0,0,0];a=d.length/b;v.vectorToVector(k,l,f,c);for(l=0;l<a;l+=1E3){g=Math.min(1E3,
a-l);for(var q=0;q<g;q++){var y=n+b*(l+q);x[3*q]=d[y]+f[0];x[3*q+1]=d[y+1]+f[1];x[3*q+2]=d[y+2]+f[2]}v.bufferToBuffer(x,c,0,x,p,0,g);for(q=0;q<g;q++){var y=x[3*q],B=x[3*q+1],u=x[3*q+2],K=n+b*(l+q);d[K]=A[0]*y+A[4]*B+A[8]*u+A[12];d[K+1]=A[1]*y+A[5]*B+A[9]*u+A[13];d[K+2]=A[2]*y+A[6]*B+A[10]*u+A[14]}}};b.createOrigin=function(b,k,a,g){k=f(b,k,a);b=k.center;k=k.id;v.vectorToVector(b,a,b,g);return{vec3:b,id:k}};var y=1,B=5-y})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports",
"../../webgl-engine/lib/HighlightSet"],function(p,b,m){var l=function(){return function(b){this.highlightSet=new m;this.ids=new Set;this.options=b}}();return function(){function b(b){this.highlights=[];this.layerView=b}b.prototype.destroy=function(){this.highlights.forEach(function(b){return b.highlightSet.removeAll()});this.highlights=null};b.prototype.acquireSet=function(b){var f=this,k=new l(b);this.highlights.push(k);return{set:k,handle:{remove:function(){return f.releaseSet(k)}}}};b.prototype.releaseSet=
function(b){b.highlightSet.removeAll();b=this.highlights?this.highlights.indexOf(b):-1;-1!==b&&this.highlights.splice(b,1)};b.prototype.setFeatureIds=function(b,l){l.forEach(function(f){return b.ids.add(f)});this.layerView._forAllFeatures(function(f,l,m,p){b.ids.has(f)&&(f=m.engineObject.setComponentHighlight(p,l,b.options),b.highlightSet.addObject(m.engineObject,f))},null,!0)};b.prototype.objectCreated=function(b){var f=this;this.highlights.forEach(function(k){f.layerView._forAllFeaturesOfNode(f.layerView._getMetadata(b),
function(f,l,m,d){k.ids.has(f)&&(f=b.setComponentHighlight(d,l,k.options),k.highlightSet.addObject(b,f))},!0)})};b.prototype.objectDeleted=function(b){this.highlights.forEach(function(f){f.highlightSet.removeObject(b)})};b.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(b){return b.highlightSet.removeAll()})};return b}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../lib/gl-matrix ../../support/Evented ../../webgl-engine/lib/Selector".split(" "),
function(p,b,m,l,v,f,x,k,A,y,B,d){var n=k.empty(),a={spatialReference:null,extent:n},g=y.vec3d.create(),q=y.vec3d.create(),c=y.vec3d.create(),u=f.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function f(a){return b.call(this)||this}m(f,b);f.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new d(this.layerView.view.viewingMode);var a=this.layerView.layer.fullExtent;this.zmin=
a.zmin;this.zmax=a.zmax};f.prototype.getElevation=function(a){if(A.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,g))return u.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,g))return u.error("could not project point for elevation alignment"),-Infinity;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;y.vec3d.set(g,q);y.vec3d.set(g,c);this.renderCoordsHelper.setAltitude(b,q);this.renderCoordsHelper.setAltitude(a,
c);this.selector.init(this.intersectLayers,q,c,null,null,1,!1);return this.selector.minResult.getIntersectionPoint(g)?this.renderCoordsHelper.getAltitude(g):-Infinity};f.prototype.layerChanged=function(){this.spatialReference&&(a.extent=this.computeLayerExtent(this.intersectLayers[0]),a.spatialReference=this.spatialReference,this.emit("elevation-change",a))};f.prototype.objectChanged=function(b){this.spatialReference&&(a.extent=this.computeObjectExtent(b),a.spatialReference=this.spatialReference,
this.emit("elevation-change",a))};f.prototype.computeObjectExtent=function(a){k.empty(n);this.expandExtent(a,n);return n};f.prototype.computeLayerExtent=function(a){k.empty(n);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],n);return n};f.prototype.expandExtent=function(a,b){for(var c=a.getBBMin(!0),d=a.getBBMax(!0),f=0;8>f;++f)g[0]=f&1?c[0]:d[0],g[1]=f&2?c[1]:d[1],g[2]=f&4?c[2]:d[2],y.mat4d.multiplyVec3(a.objectTransformation,g),this.renderCoordsHelper.fromRenderCoords(g,g,this.spatialReference),
k.expand(b,g);return b};l([x.property({constructOnly:!0})],f.prototype,"layerView",void 0);l([x.property({constructOnly:!0})],f.prototype,"stageLayer",void 0);l([x.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],f.prototype,"spatialReference",void 0);return f=l([x.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],f)}(x.declared(v,B.Evented))})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports dojo/promise/all ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/FeatureSet".split(" "),
function(p,b,m,l,v,f,x){return function(){function b(b,f,k){this._layer=b;this._support=f;this._options=k}b.prototype.queryExtent=function(b){var f=this;return this._rejectUnsupported(b).then(function(){var k=0,d=f._support.createExtentBuilder();f._forAllQueried(b,function(b){k++;d.add(b)});return{count:k,extent:0===k?null:d.getExtent()}})};b.prototype.queryFeatureCount=function(b){var f=this;return this._rejectUnsupported(b).then(function(){var k=0;f._forAllQueried(b,function(){return k++});return k})};
b.prototype.queryFeatures=function(b){var k=this;return this._rejectUnsupported(b).then(function(){var f=[],d=b&&b.outFields,n=[];if(0<k._forAllQueried(b,function(a){return n.push(k._support.createGraphic(a))},function(a){d&&(f.push(k._support.requestFields(a,n,d)),n=[])})&&!b.num)return v.reject(new l("Unsupported Query","Large feature query, use Query.num and Query.start to batch"));d||f.push(v.resolve(n));return m(f)}).then(function(b){for(var d=[],l=0;l<b.length;++l)for(var a=b[l],g=0;g<a.length;++g)d.push(f.hydrateGraphic(a[g],
k._layer));b=new x;b.features=d;return b})};b.prototype.queryObjectIds=function(b){var f=this;return this._rejectUnsupported(b).then(function(){var k=[];f._forAllQueried(b,function(b){return k.push(b.id)});return k})};b.defaultExtentBuilder=function(b){var f=null;return{add:function(k){(k=b(k))&&(f=null!=f?f.union(k):k.clone())},getExtent:function(){return f}}};b.prototype._forAllQueried=function(b,f,k){var d=[];if(b&&b.objectIds){var l=b.objectIds;d.push(function(a){return 0<=l.indexOf(a.id)})}var a=
b&&b.start||0,g=b&&b.num||1E4;d.push(function(){if(0>=g)return--g,!1;if(0<a)return--a,!1;--g;return!0});this._support.forAll(function(a){for(var b=0;b<d.length;b++)if(!(0,d[b])(a))return;f(a)},k);return Math.max(0,-g)};b.prototype._rejectUnsupported=function(b){if(null==b)return v.resolve();var f=function(b){return v.reject(new l("Unsupported Query","Unsupported property '"+b+"'"))};return null!=b.distance?f("distance"):null!=b.geometryPrecision?f("geometryPrecision"):b.groupByFieldsForStatistics&&
b.groupByFieldsForStatistics.length?f("groupByFieldsForStatistics"):null!=b.maxAllowableOffset?f("maxAllowableOffset"):b.multipatchOption?f("multipatchOption"):b.orderByFields&&b.orderByFields.length?f("orderByFields"):b.outSpatialReference?f("outSpatialReference"):b.outStatistics&&b.outStatistics.length?f("outStatistics"):b.pixelSize?f("pixelSize"):b.quantizationParameters?f("quantizationParameters"):b.relationParameter?f("relationParameter"):b.returnDistinctValues?f("returnDistinctValues"):b.text?
f("text"):b.timeExtent?f("timeExtent"):b.where?f("where"):b.geometry?f("geometry"):!this._options.enableOutFields&&b.outFields&&b.outFields.length?f("outFields"):!this._options.enableObjectId&&b.objectIds&&b.objectIds.length?f("objectIds"):v.resolve()};return b}()})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/promiseUtils"],function(p,b,m,l){function v(b){return l.create(function(f,l){b.oncomplete=function(){return f()};b.onerror=
function(){return l(b.error)};b.onabort=function(){return l(b.error)}})}function f(b){return l.create(function(f,l){"done"===b.readyState?null!=b.error?l(b.error):f(b.result):(b.onsuccess=function(){return f(b.result)},b.onerror=function(){return l(b.error)})})}Object.defineProperty(b,"__esModule",{value:!0});p=function(){function b(b,f,l){this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=
.2;this._dbName=b;this._storeName=f;this._version=l}b.prototype.init=function(){var b=this;return l.resolve().then(function(){var k=indexedDB.open(b._dbName,b._version);k.onupgradeneeded=function(f){var l=k.result,d=k.transaction,m=l.objectStoreNames.contains(b._storeName)?d.objectStore(b._storeName):l.createObjectStore(b._storeName),l=l.objectStoreNames.contains("last_access")?d.objectStore("last_access"):l.createObjectStore("last_access");l.indexNames.contains("date")||l.createIndex("date","date",
{unique:!1});l.indexNames.contains("byteSize")||l.createIndex("byteSize","byteSize",{unique:!1});f.oldVersion<b._version&&(m.clear(),l.clear())};return f(k)}).then(function(f){b._destroyed?f.close():b._db=f})};b.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};b.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};b.prototype.put=function(b,f){var k=this;return null==this._db?l.reject(new m("indexedb:not-initialized","IndexedDB Cache is not initialized")):
(null!=this._quotaReductionPromise?this._quotaReductionPromise:l.resolve()).then(function(){return k._put(b,f)}).catch(function(l){if("QuotaExceededError"===l.name)return null==k._quotaReductionPromise&&(k._quotaReductionPromise=k._getCacheSize().then(function(b){return k._removeLeastRecentlyAccessed(f.byteSize+Math.ceil(b*k.quotaReductionFactor))}),k._quotaReductionPromise.always(function(){k._quotaReductionPromise=null})),k._quotaReductionPromise.then(function(){return k._put(b,f)});throw l;}).then(function(){k._gcCounter--;
0>k._gcCounter&&(k._gcCounter=k.gcFrequency,k._getCacheSize().then(function(b){return k._removeLeastRecentlyAccessed(b-k.maxByteSize)}))})};b.prototype.get=function(b){var k=this;return null==this._db?l.resolve(null):l.resolve().then(function(){var l=k._db.transaction(k._storeName,"readonly").objectStore(k._storeName).get(b);return f(l)}).then(function(f){null==f?++k._miss:(++k._hit,k._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:f.byteSize},
b));return f}).catch(function(b){++k._miss;return null})};b.prototype.remove=function(b){var f=this;return null==this._db?l.resolve():l.resolve().then(function(){var k=f._db.transaction([f._storeName,"last_access"],"readwrite"),l=k.objectStore(f._storeName),d=k.objectStore("last_access");l.delete(b);d.delete(b);return v(k)})};b.prototype._put=function(b,f){var k=this._db.transaction([this._storeName,"last_access"],"readwrite");k.objectStore(this._storeName).put(f,b);k.objectStore("last_access").put({date:(new Date).getTime(),
byteSize:f.byteSize},b);return v(k)};b.prototype._removeLeastRecentlyAccessed=function(b){if(!(0>=b)){var f=this._db.transaction([this._storeName,"last_access"],"readwrite"),k=f.objectStore(this._storeName),l=f.objectStore("last_access"),d=0,m=l.index("date").openCursor(null,"next");m.onsuccess=function(a){a=m.result;null!=a&&(null!=a.value.byteSize&&(d+=a.value.byteSize),k.delete(a.primaryKey),l.delete(a.primaryKey),d<b&&a.continue())};return v(f)}};b.prototype._getCacheSize=function(){var b=this._db.transaction("last_access"),
f=0,l=b.objectStore("last_access").index("byteSize").openKeyCursor();l.onsuccess=function(b){if(b=l.result){var d=b.key;null!=d&&(f+=d);b.continue()}};return v(b).then(function(){return f})};return b}();b.IDBCache=p;b.whenTransaction=v;b.whenRequest=f})}}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper dojo/errors/CancelError ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/has ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../layers/IntegratedMeshLayer ../../../layers/graphics/controllers/I3SOnDemandController ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ../../../tasks/support/Query ./LayerView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SProjectionUtil ./i3s/I3SQueryEngine ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../lib/gl-matrix ../support/mathUtils ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../support/buffer/typedArrayUtil ../webgl-engine/Stage ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/DefaultMaterial module".split(" "),function(p,
b,m,l,v,f,x,k,A,y,B,d,n,a,g,q,c,u,N,J,D,G,ha,C,K,R,Y,Z,ca,la,F,O,Q,da,M,E,qa,Fa,ya,ia,P,ja,Ga,na,La,Sb,gb,wb,Sa,kb,Aa,S,ra,t,V,fa,W){function e(a,b,c,d,e){var f=!1,g;b.encoding===E.DDS_ENCODING_STRING?g=ra.DDS_ENCODING:f=!(Ga.isPowerOfTwo(a.width)&&Ga.isPowerOfTwo(a.height));c=((a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas)?d:c)&&!f;return{mipmap:c,wrapClamp:a||!b.wrap,disableAnisotropy:a&&c&&e,encoding:g,noUnpackFlip:!0}}function Ea(a){return gb.isArrayBuffer(a.data)}
function mb(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);for(a=0;a<b.length;a++)d=b[a],gb.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}var ea=wb.ModelContentType,ga=g.getLogger("esri.views.3d.layers.SceneLayerView3D"),za=[1,1,1,1],Ha=[.8,.8,.8],Ua=[.5,.5,.5],pb=function(){return function(){}}();b=function(b){function g(){var a=null!==b&&
b.apply(this,arguments)||this;a._queryEngine=null;a._highlights=new O(a);a._elevationProvider=null;a._worker=new la;a._workerThread=null;a._texId2Meta=new Map;a._nodeId2Meta=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new qa.IDBCache("esri-scenelayer-cache","geometries",10);a._cancelCount=0;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a.alwaysLoadEverythingModeEnabled=!1;a._cacheKeySuffix=
null;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;a._tmpAttributeOnlyGraphic=new A(null,null,{});return a}m(g,b);Object.defineProperty(g.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"rendererNeedsTextures",{get:function(){return E.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=ha.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=Y.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});g.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)};Object.defineProperty(g.prototype,"uncompressedTextureDownsamplingEnabled",
{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!d("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});
g.prototype.initialize=function(){var a=this;J.open(c.getAbsMid("./SceneLayerWorker",p,W),{client:this}).then(function(b){a.destroyed?b.close():a._workerThread=b});E.checkSceneLayerValid(this.layer);E.checkSceneLayerCompatibleWithView(this.layer,this.view);this._controller=new K({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;if((this._isIntegratedMesh=this.layer instanceof C)||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=
!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.view.getEdgeView());this._memCache=this.view.resourceController.getMemCache(this.layer.uid,function(b){return a._deleteNodeStageData(b)});this._addThisLayerToStage();
this._elevationProvider=new Q({layerView:this,stageLayer:this._stageLayer});this.handles.add([N.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),N.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),N.init(this.layer,"objectIdFilter",function(){return a._filterChange()}),N.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),N.init(this,"_controller.parsedDefinitionExpression",function(){return a._filterChange()}),N.watch(this,"fullOpacity",
function(b){return a._opacityChange(b)}),N.watch(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)}),N.watch(this,"elevationOffset",function(b,c){return a._reloadAll(c)}),N.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){a._reloadAll();a._memCache.clear()}),N.init(this,"suspended",function(b){return a._suspendedChange(b)})],"sceneLayerHandles");this._idbCache.init().catch(function(a){ga.warn("Failed to initialize IndexedDB cache: "+
a)});this._cacheKeySuffix=E.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._componentColorManager=this._hasSymbolColors?new V.BufferManager(this._stage.view.renderingContext):null;this._enableSecretAlwayLoadMode()};g.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._memCache=null;this._removeThisLayerFromStage();
this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=this._texId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};g.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};
g.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)};g.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};g.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};g.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};
g.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};g.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a.id)};g.prototype.getUsedMemory=function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=b.node.memory});return a};g.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0};g.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),
this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._isIntegratedMesh?"im":"scene",this._elevationProvider)};g.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+
"MB"};this._controller&&(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};g.prototype._addThisLayerToStage=function(){for(var a=this._stage,b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;this._whiteTexture=new ra(b,"white",{width:8,height:8});a.add(ea.TEXTURE,this._whiteTexture);b=this.layer.id;this._stageLayer=b=new kb(b,{},b);a.add(ea.LAYER,b);this._stage.addToViewContent([b.id])};g.prototype._removeThisLayerFromStage=
function(){if(null!=this._stageLayer){var a=this._stage;a.remove(ea.TEXTURE,this._whiteTexture.id);this._removeAllNodeDataFromStage();t.assert(0===this._nodeId2Meta.size);t.assert(0===this._texId2Meta.size);a.remove(ea.LAYER,this._stageLayer.id);this._stageLayer=void 0;this.gpuMemoryEstimate=0}};g.prototype.getLoadedAttributes=function(a){if(a=this._nodeId2Meta.get(a.id))return a.loadedAttributes};g.prototype.getAttributeData=function(a){if(a=this._nodeId2Meta.get(a.id))return a.attributeData};g.prototype.setAttributeData=
function(a,b,c){var d=this._nodeId2Meta.get(a.id);d&&(d.loadedAttributes=b,d.attributeData=c,d.cachedRendererVersion=this._getInvalidRendererVersion(),this._updateEngineObject(a,d))};g.prototype.getLoadedNodeIDs=function(){return y.keysOfMap(this._nodeId2Meta)};g.prototype._calcEngineMaterialTransparencyParams=function(b,c,d){var e=this.fullOpacity,f=1-Ga.clamp(t.fallbackIfUndefined(c.transparency,0),0,1);b=1>f||1>e||b&&a.endsWith(b.channels,"a")||!0===c.useVertexColorAlpha||d;return{opacity:f,layerOpacity:e,
transparent:b}};g.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};g.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};g.prototype._getMaterialParameters=function(b,c,d,e){var f;null!=b&&(f=(f=this._texId2Meta.get(c))&&f.engineTex?f.engineTex.id:this._whiteTexture.id);c=d.params;var g=t.fallbackIfUndefined(c.diffuse,Ha);"standard"!==d.type&&ga.warn("Unknown material type '"+
d.type+"', must be 'standard'");d=this._isIntegratedMesh;e={ambient:g,diffuse:g,specular:t.fallbackIfUndefined(c.specular,Ua),atlasRegions:c.vertexRegions,textureId:f,vertexColors:this._hasVertexColors,componentIndices:this._hasSymbolColors,componentColorBuffer:this._hasSymbolColors&&e?e.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(c),cullFace:this._calcEngineMaterialCullFaceParams(c),writeStencil:d,receiveSSAO:!d,groundNormalShading:d,compressedNormals:!d,slicePlaneEnabled:this.slicePlaneEnabled};
d||(b=this._calcEngineMaterialTransparencyParams(b,c),a.mixin(e,b));return e};g.prototype._createEngineMaterial=function(a,b,c,d,f,g,k){var w=null==b?null:this._getI3STexEncoding(b);k=this._getMaterialParameters(b,c,d,k);k=new fa(k,f);k.metadata={i3sMatId:f,i3sTexId:c,i3sTex:b,i3sMatParams:d.params};if(null!=b){(d=this._texId2Meta.get(c))?d.usedByEngineMats.push(k):(d={id:c,usedByEngineMats:[k],images:b.images,encoding:w,atlas:!0===b.atlas,wrap:"none"!==b.wrap[0]||"none"!==b.wrap[1]},this._texId2Meta.set(c,
d));a:{for(b=0;b<g.length;b++)if(w=g[b],w.i3sTexId===c){c=w.data;break a}c=null}null!=c&&null==d.engineTex&&(g=e(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),d.engineTex=new ra(c,d.id,g),this._stage.add(ea.TEXTURE,d.engineTex),a.memory+=this.memEstimateTextureAdded(d.engineTex));if(null!=d.engineTex)for(a=d.engineTex.id,c=0,g=d.usedByEngineMats;c<g.length;c++)g[c].setParameterValues({textureId:a})}return k};g.prototype._getI3STexEncoding=function(a){var b=E.getAppropriateTextureEncoding(a.encoding,
this.useCompressedTextures);return-1<b?a.encoding[b]:a.encoding};g.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,d=b.materialDefinitions[c];t.assert(void 0!==d,"geometry wants unknown material "+c);a=a.params.textureID||"none";var e;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||ga.warn("textureDefinitions missing in shared resource"),e=b.textureDefinitions[a]);b=this._getMaterialParameters(e,a,d);return Sb.glLayout(fa.getVertexBufferLayout(b))};
g.prototype._createEngineMat=function(a,b,c,d,e){var f=b.params.materialID,g=c.materialDefinitions[f];t.assert(void 0!==g,"geometry wants unknown material "+f);b=b.params.textureID||"none";var k;"none"!==b&&(null!=c.textureDefinitions&&null!=c.textureDefinitions[b]||ga.warn("textureDefinitions missing in shared resource"),k=c.textureDefinitions[b]);return this._createEngineMaterial(a,k,b,g,f,d,e)};g.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};g.prototype._findGraphicNodeAndIndex=
function(a){var b=Fa.attributeLookup(a.attributes,this._getObjectIdField()),c=null;n.everyMap(this._nodeId2Meta,function(a,d){d=a.featureIds.indexOf(b);if(-1===d)return!0;c={node:a.node,index:d};return!1});return c};g.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.id);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=Fa.attributeLookup(b[e].attributes,d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};g.prototype.whenGraphicBounds=function(a){a=
this._findGraphicNodeAndIndex(a);if(!a)return q.reject();var b=this._nodeId2Meta.get(a.node.id).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));if(La.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=G.empty(),G.expandWithBuffer(b,a,0,8),q.resolve({boundingBox:b,screenSpaceObjects:[]})};g.prototype.whenGraphicAttributes=function(a,b){var c=this;return E.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=
c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})};g.prototype.getGraphicFromStageObject=function(a,b){if(this.layer instanceof C)return q.reject();var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?(c=this._createGraphic(a,c),q.resolve(c)):q.reject()};g.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.i3sNode)};
g.prototype._getCacheKey=function(a){return a.baseUrl+this._cacheKeySuffix};g.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};g.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};g.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=(this._cancelCount|0)+1|0};g.prototype._handleCancelled=function(a){if(0<((this._cancelCount|0)+(-a|0)|0))throw new x;};g.prototype.loadCachedGPUData=
function(a){return this._memCache.pop(this._getMemCacheKey(a.id))};g.prototype.loadCachedNodeData=function(a,b){var c=this,d=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a)).then(function(e){if(null==e)return null;c._handleCancelled(d);if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=na.clone(e.nodeObb),c._controller.updateVisibility(a.id));var f=function(a){if(null==a.data)return!0;var b=c._getI3STexEncoding(e.sharedResource.textureDefinitions[a.i3sTexId]);
return a.encoding!==b};return c.rendererNeedsTextures&&e.textureData.some(f)?b(e.allGeometryData,e.sharedResource).then(function(b){e.textureData=b;b.every(Ea)&&c._idbCache.put(c._getCacheKey(a),e).catch(function(b){b&&"indexedb:not-initialized"===b.name||ga.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)});c._handleCancelled(d);return e}):e}):q.resolve(null)};g.prototype.addNodeData=function(a,b){var c=this;return this._transformBundle(a,b).then(function(b){return c._controller.reschedule(a.id,
b)}).then(function(d){a.obb||(a.obb=d.obb,c._controller.updateVisibility(a.id));d={allGeometryData:b.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:b.textureData,sharedResource:b.sharedResource,nodeVersion:a.version,nodeObb:a.obb,byteSize:mb(d.transformedGeometries,b.textureData)};if(c._cachingEnabled()){var e=d.textureData.map(function(a){return Ea(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,data:null}});c._idbCache.put(c._getCacheKey(a),{allGeometryData:d.allGeometryData,
transformedGeometries:d.transformedGeometries,textureData:e,sharedResource:d.sharedResource,nodeVersion:d.nodeVersion,nodeObb:d.nodeObb,byteSize:d.byteSize}).catch(function(b){return ga.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return c.addCachedNodeData(a,d,b.attributeDataInfo)})};g.prototype._transformBundle=function(a,b){for(var c=this,d=[],e=[b.geometryBuffer],f=0,g=b.allGeometryData;f<g.length;f++)for(var k=0,l=g[f].geometries;k<l.length;k++)d.push(this._getVertexBufferLayout(l[k],
b.sharedResource));b={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData,layouts:d,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",b,e):this._controller.reschedule(a.id,
b).then(function(a){return c._worker.transform(a)})};g.prototype.addCachedGPUData=function(a,b,c){if(!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(a))return this._memCache.put(this._getMemCacheKey(a.id),b,a.memory),q.resolve();b.attributeData=c?c.attributeData:null;b.loadedAttributes=c?c.loadedAttributes:null;this._nodeId2Meta.set(a.id,b);b.engineObject.setHidden(b.engineObject.geometryRecords[0],!1);this._updateEngineObject(a,b);this._highlights.objectCreated(b.engineObject);
return q.resolve()};g.prototype.addCachedNodeData=function(a,b,c){var d=this;if(this._nodeId2Meta.has(a.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(a.id)),this._applyFilters(a),q.resolve();if(this.suspended||!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(a))return q.resolve();var e=b.allGeometryData,f=b.transformedGeometries,g=b.textureData;b=b.sharedResource;if(0===e.length)return q.resolve();1!==e.length&&console.warn("Node with",e.length,"geometries is unsupported");
if(!this.rendererNeedsTextures)for(var k=0;k<g.length;k++)g[k].data=null;var l={};l[ea.OBJECT]={};l[ea.GEOMETRY]={};l[ea.MATERIAL]={};var k=0,w=!1;a.memory=0;var m=e[0],e=m.componentOffsets,z=m.geometries,m=m.featureIds,n=null,p=null;if(this._hasSymbolColors)for(var n=this._componentColorManager.getBuffer(m.length),p=new Uint16Array(m.length),I=0;I<m.length;I++)p[I]=n.aquireIndex();for(var I=a.id+"|"+m[0],t=[],u=[],v=[],x=[],B,A=0;A<z.length;A++){var y=z[A],D=this._createEngineMat(a,y,b,g,n),C=f[k++];
B=C.corMatrices.globalTrafo;w=w||C.hasColors;C=new S(new Float32Array(C.interleavedVertexData),C.layout,C.positionData,e||S.DefaultOffsets,C.indices||S.DefaultIndices,!0);this._hasSymbolColors&&this._setComponentIndices(C,p);var y=null!=y.transformation?ja.mat4d.create(y.transformation):ja.mat4d.identity(),E=t.length,C=new Sa(C,I+(0<E?"_"+E:""));t.push(C);v.push(y);x.push([D]);u.push(da.createOrigin(a.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference));a.memory+=
this.memEstimateGeometryAdded(C.data);l[ea.MATERIAL][D.id]=D;l[ea.GEOMETRY][C.id]=C}var G=new Aa({idHint:a.id,name:I,geometries:t,materials:x,transformations:v,origins:u,castShadow:!0,metadata:{i3sNode:a.id,layerUid:this.layer.uid}});G.setObjectTransformation(B);l[ea.OBJECT][G.id]=G;var F=new pb;F.node=a;F.engineObject=G;F.featureIds=m;F.attributeData=c?c.attributeData:null;F.loadedAttributes=c?c.loadedAttributes:null;F.componentColorBuffer=n;F.componentIndices=p;F.cachedRendererVersion=this._getInvalidRendererVersion();
F.cachedSymbolInfos=[];!this._hasTextures&&null!=a.textureData&&0<a.textureData.length&&(this._hasTextures=!0);this._hasColors||(this._hasColors=w);this._hasData=!0;this.notifyChange("hasTexturesOrVertexColors");return q.create(function(b){d._addOrUpdateEdgeRendering(F).then(function(){if(d._nodeId2Meta.has(a.id))return d._edgeView&&d._edgeView.removeObject(F.engineObject),b();var c=d._stageLayer,e=d._stage,f=l[ea.OBJECT],g;for(g in f)f.hasOwnProperty(g)&&c.addObject(f[g]);for(var k in l)if(l.hasOwnProperty(k)){var c=
l[k],w;for(w in c)c.hasOwnProperty(w)&&null==e.get(k,w)&&e.add(k,c[w])}d._nodeId2Meta.set(a.id,F);if(d.suspended)return d._removeNodeStageData(a.id),b();d._setObjectSymbology(F);d._applyFilters(a);d._highlights.objectCreated(G);d.visibleGeometryChanged(G);b()})})};g.prototype._clippingAreaChanged=function(){var a=this,b=G.create();La.extentToBoundingBox(this.view.clippingArea,b,this.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null;this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)});
this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};g.prototype._filterChange=function(){var a=this;this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)})};g.prototype._updateFilters=function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b,e){return a._objectIdFilter(c,d,e)})}if(this._controller&&this._controller.parsedDefinitionExpression&&
this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var e=this._controller.parsedDefinitionExpression,f=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,e,f,c)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,a._clippingArea,c)});this._filters=b};g.prototype._sqlFilter=function(a,b,c,d){var e={},f=new A(null,null,e);f.layer=this.layer;f.sourceLayer=this.layer;var g=this.layer.objectIdField,k=0,l=0,w=this._nodeId2Meta.get(a.id);
a=w.featureIds;for(var m=w.attributeData,w=c.every(function(a){return null!=m[a]||a===g}),n=0;n<a.length&&k<d.length;n++)if(d[k]===a[n]){var z=!0;if(w){e[g]=a[n];for(var z=0,p=c;z<p.length;z++){var q=p[z];q!==g&&(e[q]=E.getCachedAttributeValue(m[q],n))}z=this._evaluateClause(b,f)}z&&(d[l]=d[k],l++);k++}d.length=l};g.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(I){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&ga.error("Error while evaluating definitionExpression: "+
I),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&ga.error("Further errors are ignored"),!1}};g.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=y.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};g.prototype._boundingboxFilter=function(a,b,c){var d=[0,0,0,0];La.mbsToMbs(a.mbs,this._controller.crsIndex,d,this.view.renderSpatialReference);d=null!=b?E.intersectBoundingBoxWithMbs(b,d):2;if(2!==d)if(0===d)c.length=
0;else{var e=d=0,f=this._nodeId2Meta.get(a.id);a=f.featureIds;var g=f.engineObject.getObjectTransformation(),k=f.engineObject.getGeometryRecords()[0].getShaderTransformation();ja.mat4d.multiply(g,k);if(0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&0===g[11]&&1===g[15]){k=Ia;k[0]=(b[0]-g[12])/g[0];k[1]=(b[1]-g[13])/g[5];k[2]=(b[2]-g[14])/g[10];k[3]=(b[3]-g[12])/g[0];k[4]=(b[4]-g[13])/g[5];k[5]=(b[5]-g[14])/g[10];b=f.engineObject.getGeometryRecords()[0].geometry;f=
b.componentCount;for(g=0;g<f&&d<c.length;g++)if(c[d]===a[g]){var l=b.getComponentAABB(g,Va);G.intersects(k,l)&&(c[e]=c[d],e++);d++}c.length=e}}};g.prototype._addOrUpdateEdgeRendering=function(a){return v(this,void 0,void 0,function(){var b,c,d,e,g,k;return f(this,function(f){switch(f.label){case 0:if(!this._edgeView)return[2];b=a.engineObject;c=this._edgeView.hasObject(b);d=this._extractObjectEdgeMaterials(a);e=d.hasEdges;g=d.perFeatureEdgeMaterials;if(!e)return[3,4];k=!b.isHidden(b.geometryRecords[0]);
if(!c)return[3,1];this._edgeView.updateAllComponentMaterials(b,g);this._edgeView.updateObjectVisibility(b,k);return[3,3];case 1:return k?[4,this._edgeView.addObject(b,g)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[3,5];case 4:c&&this._edgeView.removeObject(b),f.label=5;case 5:return[2]}})})};g.prototype._applyFilters=function(a){var b=this._nodeId2Meta.get(a.id);b&&(this._applyFiltersToObjects(a,b),this._updateEdgeRendering(b))};g.prototype._applyFiltersToObjects=function(a,b){var c=b.engineObject;
c.unhideAllComponents();if(0!==this._filters.length){b=b.featureIds;for(var d=b.slice(),e=0,f=this._filters;e<f.length;e++)(0,f[e])(a,d);if(d.length!==b.length)for(a=0,e=c.getGeometryRecords()[0],f=0;f<b.length;f++){var g=b[f];a>=d.length||d[a]!==g?c.setComponentVisibility(e,f,!1):a++}}};g.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};g.prototype.removeNodeData=function(a){var b=
this;a.forEach(function(a){return b._removeNodeStageData(a.id)})};g.prototype._removeNodeStageData=function(a,b){void 0===b&&(b=this.elevationOffset);var c=this._nodeId2Meta.get(a);if(c){var d=c.engineObject;d.setHidden(d.geometryRecords[0],!0);this.visibleGeometryChanged(d);this._addOrUpdateEdgeRendering(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(d);this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory)}};g.prototype._deleteNodeStageData=function(a){var b=this._stage,c=
this._stageLayer,d=a.engineObject;this._edgeView&&this._edgeView.removeObject(d);c.removeObject(d);for(var c=0,e=d.getGeometryRecords();c<e.length;c++){var f=e[c];this.memEstimateGeometryRemoved(f.geometry.data);b.remove(ea.GEOMETRY,f.geometry.id);for(var g=0,f=f.materials;g<f.length;g++)this._removeMaterial(f[g],b)}if(a.componentIndices){for(c=0;c<a.componentIndices.length;c++)a.componentColorBuffer.releaseIndex(a.componentIndices[c]);this._componentColorManager.garbageCollect()}b.remove(ea.OBJECT,
d.id)};g.prototype._removeMaterial=function(a,b){b.remove(ea.MATERIAL,a.id);var c=a.metadata.i3sTexId;if(c){var d=this._texId2Meta.get(c);if(d){var e=d.usedByEngineMats;y.removeUnordered(e,a)||ga.error("Missing reference from material to texture");0===e.length&&((a=d.engineTex)&&a!==this._whiteTexture&&(this.memEstimateTextureRemoved(a),b.remove(ea.TEXTURE,d.engineTex.id)),this._texId2Meta.delete(c))}}};g.prototype.setPolygonOffset=function(a,b){var c=this._nodeId2Meta.get(a.id);if(c)for(a=0,c=c.engineObject.getGeometryRecords();a<
c.length;a++)for(var d=0,e=c[a].materials;d<e.length;d++)e[d].setParameterValues({polygonOffset:b})};g.prototype._getInvalidRendererVersion=function(){return(this._rendererVersion|0)+-1|0};g.prototype._rendererChange=function(a){this._currentRenderer=a;this._rendererVersion=(this._rendererVersion|0)+1|0;this._opacityVariable=this._colorVariable=this._rendererFields=null;a&&a.requiredFields&&(this._rendererFields=E.findFieldsCaseInsensitive(a.requiredFields,this.layer.fields));if(a&&a.visualVariables)for(var b=
0,c=a.visualVariables;b<c.length;b++){var d=c[b];"color"===d.type?this._colorVariable=d:"opacity"===d.type?this._opacityVariable=d:ga.warn("Unsupported visual variable type for 3D Object Scene Services: "+d.type)}a&&(a.colorInfo||a.sizeInfo)&&ga.warn("renderer.colorInfo and renderer.sizeInfo are not supported for 3D Object Scene Services. Use visualVariables instead.");if(a)for(b=0,a=a.getSymbols();b<a.length;b++)c=a[b],"mesh-3d"!==c.type&&ga.error("Symbols of type '"+c.type+"' are not supported for 3D Object Scene Services.");
this.view.resourceController.setMemoryDirty()};g.prototype._getSymbolInfos=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolInfos};g.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolColors};g.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b=
a.featureIds?a.featureIds.length:1,c={},d=this._tmpAttributeOnlyGraphic;d.attributes=c;for(var e=this._currentRenderer,f=null!=a.featureIds?this.layer.objectIdField:null,g=null!=a.attributeData?this._rendererFields:null,k=0;k<b;k++){null!=f&&(c[f]=a.featureIds[k]);if(null!=g)for(var l=0,m=g;l<m.length;l++){var n=m[l];a.attributeData[n]&&(c[n]=E.getCachedAttributeValue(a.attributeData[n],k))}m=e&&e.getSymbol(d);l=null;m instanceof R&&(this._symbolInfos.has(m.id)||this._symbolInfos.set(m.id,E.getSymbolInfo(m)),
l=this._symbolInfos.get(m.id));a.cachedSymbolInfos[k]=l;null==a.cachedSymbolColors&&(a.cachedSymbolColors=new Uint8Array(4*a.featureIds.length));n=m=null;if(this._colorVariable){var w=e.getColor(d,{colorInfo:this._colorVariable,color:Na});w&&(m=Ma,m[0]=w.r/255,m[1]=w.g/255,m[2]=w.b/255,this._opacityVariable||null===w.a||(n=w.a))}this._opacityVariable&&(n=e.getOpacity(d,{opacityInfo:this._opacityVariable}));l&&l.material?(l=l.material,m=null==m||null==n?F.overrideColor(m,n,l.color,l.alpha,za,Ma):F.overrideColor(m,
n,null,null,za,Ma),P.encodeSymbolColor(m,l.colorMixMode,a.cachedSymbolColors,4*k)):P.encodeSymbolColor(null,null,a.cachedSymbolColors,4*k)}}};g.prototype._extractObjectEdgeMaterials=function(a){var b=[],c=a.engineObject,d=a.featureIds?a.featureIds.length:1,e=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),f={opacity:this.fullOpacity,slicePlaneEnabled:this.slicePlaneEnabled},g=!1,k=null,l=null;a=this._getSymbolInfos(a);for(var m=0;m<d;m++){var n=a[m];c.getComponentVisibility(c.getGeometryRecords()[0],
m)&&n?(l!==n&&(l=n,(k=ya.createMaterialFromEdges(this._edgeView,n.edges,f))&&(g=!0)),b.push(null!=k?k:e)):b.push(e)}return{hasEdges:g,perFeatureEdgeMaterials:b}};g.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){for(var b=a.featureIds?a.featureIds.length:1,c=!1,d=this._getSymbolColors(a),e=a.componentColorBuffer.textureBuffer,f=0;f<b;f++){var g=4*f;e.setData(a.componentIndices[f],0,d[g],d[g+1],d[g+2],d[g+3]);P.isOpaqueSymbolColor(d,g)||(c=!0)}this._updateObjectOpacity(a.engineObject,
c)}};g.prototype._setComponentIndices=function(a,b){for(var c=a.getAttribute(t.VertexAttrConstants.COMPONENTINDEX),d=c.data,e=c.offsetIdx,c=c.strideIdx,f=a.getIndices(t.VertexAttrConstants.COMPONENTINDEX),g=0;g<b.length;g++)for(var k=a.componentOffsets[g+1],l=a.componentOffsets[g];l<k;l++)d[e+f[l]*c]=b[g]};g.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&ga.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};g.prototype._reloadAll=
function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};g.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._updateEdgeRendering(a)})};g.prototype._updateObjectOpacity=function(a,b){var c=0;for(a=a.getGeometryRecords();c<a.length;c++)for(var d=0,e=a[c].materials;d<e.length;d++){var f=e[d],g=f.metadata;void 0!==b&&(g.symbolIsTransparent=
b);var k=f.getParams(),g=this._calcEngineMaterialTransparencyParams(g.i3sTex,g.i3sMatParams,g.symbolIsTransparent);k.transparent===g.transparent&&k.layerOpacity===g.layerOpacity||f.setParameterValues(g)}};g.prototype._updateEngineObject=function(a,b){this._setObjectSymbology(b);this._addOrUpdateEdgeRendering(b);this._applyFilters(a);this.visibleGeometryChanged(b.engineObject)};g.prototype._slicePlaneEnabledChange=function(a){var b=this,c={slicePlaneEnabled:a};this._nodeId2Meta.forEach(function(a){for(var d=
0,e=a.engineObject.getGeometryRecords();d<e.length;d++)for(var f=0,g=e[d].materials;f<g.length;f++)g[f].setParameterValues(c);b._updateEdgeRendering(a)})};g.prototype._updateEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._addOrUpdateEdgeRendering(a)};g.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};g.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};g.prototype.queryFeatures=
function(a){return this._ensureQueryEngine().queryFeatures(a)};g.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};g.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};g.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new M(this.layer,{forAll:function(c,d){a._forAllFeatures(function(d,e,f){b.id=d;b.index=e;b.meta=
f;a._boundingBoxCornerPoints(e,f.engineObject,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,b.meta)},requestFields:function(b,c,d){return E.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=a._getGraphicIndices(b,c);return{node:b,indices:d}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};g.prototype._createExtentBuilder=function(){var a=
this.view.renderSpatialReference,b=this.view.spatialReference,c=G.empty(),d=new Float64Array(24);return{add:function(e){La.bufferToBuffer(e.bbCorners,a,0,d,b,0,8)&&G.expandWithBuffer(c,d,0,8)},getExtent:function(){return G.toExtent(c,b)}}};g.prototype._forAllFeatures=function(a,b,c){var d=this;this._nodeId2Meta.forEach(function(e,f){d._forAllFeaturesOfNode(e,a,c);b&&b(e.node)})};g.prototype._forAllFeaturesOfNode=function(a,b,c){for(var d=a.featureIds,e=a.engineObject.getGeometryRecords()[0],f=0;f<
d.length;f++)(c||a.engineObject.getComponentVisibility(e,f))&&b(d[f],f,a,e)};g.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);if(null!=b.attributeData)for(var d=0,e=Object.keys(b.attributeData);d<e.length;d++){var f=e[d];c[f]=E.getCachedAttributeValue(b.attributeData[f],a)}a=new A(null,null,c);a.layer=this.layer;a.sourceLayer=this.layer;return a};g.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,
Ia);for(var d=0;8>d;++d)sa[0]=d&1?a[0]:a[3],sa[1]=d&2?a[1]:a[4],sa[2]=d&4?a[2]:a[5],ja.mat4d.multiplyVec3(b.objectTransformation,sa),c[3*d]=sa[0],c[3*d+1]=sa[1],c[3*d+2]=sa[2];return c};g.prototype.highlight=function(a,b){var c=this,d=this._highlights;if(a instanceof Z){b=d.acquireSet(b);var e=b.set,f=b.handle;this.queryObjectIds(a).then(function(a){return d.setFeatureIds(e,a)});return f}"number"===typeof a?a=[a]:a instanceof A?a=[a]:a instanceof B&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof
A)return a=a.map(function(a){return Fa.attributeLookup(a.attributes,c._getObjectIdField())}),f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f;if("number"===typeof a[0])return f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f}return{remove:function(){}}};g.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=
u.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null}))};l([D.property()],g.prototype,"layer",void 0);l([D.property()],g.prototype,"_controller",void 0);l([D.property({dependsOn:["_controller.updating"]})],g.prototype,"updating",void 0);l([D.property({dependsOn:["_controller.rootNodeVisible"]})],g.prototype,"suspended",void 0);l([D.property(ia.updatingPercentage)],g.prototype,"updatingPercentage",void 0);l([D.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],
g.prototype,"updatingPercentageValue",void 0);l([D.property({readOnly:!0})],g.prototype,"hasTexturesOrVertexColors",null);l([D.property({readOnly:!0,dependsOn:["layer.renderer"]})],g.prototype,"rendererNeedsTextures",null);l([D.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],g.prototype,"elevationOffset",null);l([D.property({type:Boolean})],g.prototype,"slicePlaneEnabled",void 0);l([D.property()],g.prototype,"alwaysLoadEverythingModeEnabled",void 0);l([D.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled",
"useCompressedTextures"]})],g.prototype,"uncompressedTextureDownsamplingEnabled",null);l([D.property({dependsOn:["layer.version"]})],g.prototype,"useCompressedTextures",null);return g=l([D.subclass("esri.views.3d.layers.SceneLayerView3D")],g)}(D.declared(ca));var sa=ja.vec3d.create(),Ia=G.create(),Va=G.create(),Ma=[0,0,0,0],Na=new k([0,0,0,0]);return b});
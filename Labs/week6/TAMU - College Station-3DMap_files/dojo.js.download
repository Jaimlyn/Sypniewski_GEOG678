//>>built
(function(m,f){var k,e=function(){return"undefined"!==typeof w&&"function"!==typeof w?w:"undefined"!==typeof window?window:"undefined"!==typeof self?self:this}(),g=function(){},d=function(a){for(var b in a)return 0;return 1},h={}.toString,c=function(a){return"[object Function]"==h.call(a)},b=function(a){return"[object String]"==h.call(a)},a=function(a){return"[object Array]"==h.call(a)},l=function(a,b){if(a)for(var c=0;c<a.length;)b(a[c++])},n=function(a,b){for(var c in b)a[c]=b[c];return a},p=function(a,
b){return n(Error(a),{src:"dojoLoader",info:b})},q=1,r=function(){return"_"+q++},t=function(a,b,c){return ba(a,b,c,0,t)},w=e,u=w.document,x=u&&u.createElement("DiV"),v=t.has=function(a){return c(z[a])?z[a]=z[a](w,u,x):z[a]},z=v.cache=f.hasCache;c(m)&&(m=m(e));v.add=function(a,b,c,l){(void 0===z[a]||l)&&(z[a]=b);return c&&v(a)};v.add("host-webworker","undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);v("host-webworker")&&(n(f.hasCache,{"host-browser":0,dom:0,"dojo-dom-ready-api":0,
"dojo-sniff":0,"dojo-inject-api":1,"host-webworker":1,"dojo-guarantee-console":0}),f.loaderPatch={injectUrl:function(a,b){try{importScripts(a),b()}catch(mb){console.info("failed to load resource ("+a+")"),console.error(mb)}}});for(var y in m.has)v.add(y,m.has[y],0,1);t.async=1;var A=v("csp-restrictions")?function(){}:new Function("return eval(arguments[0]);");t.eval=function(a,b){return A(a+"\r\n//# sourceURL\x3d"+b)};var B={},C=t.signal=function(b,c){b=B[b];l(b&&b.slice(0),function(b){b.apply(null,
a(c)?c:[c])})};y=t.on=function(a,b){var c=B[a]||(B[a]=[]);c.push(b);return{remove:function(){for(var a=0;a<c.length;a++)if(c[a]===b){c.splice(a,1);break}}}};var E=[],D={},F=[],M={},N=t.map={},I=[],G={},O="",J={},Q={},e={},H=0;if(!v("foreign-loader"))var K=function(a,b){b=!1!==b;var c,l,d,e;for(c in Q)l=Q[c],(d=c.match(/^url\:(.+)/))?J["url:"+Pa(d[1],a)]=l:"*now"==c?e=l:"*noref"!=c&&(d=Na(c,a,!0),J[d.mid]=J["url:"+d.url]=l);e&&e(ka(a));b&&(Q={})};var R=function(a){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,
function(a){return"\\"+a})},P=function(a,b){b.splice(0,b.length);for(var c in a)b.push([c,a[c],new RegExp("^"+R(c)+"(/|$)"),c.length]);b.sort(function(a,b){return b[3]-a[3]});return b},L=function(a,c){l(a,function(a){c.push([b(a[0])?new RegExp("^"+R(a[0])+"$"):a[0],a[1]])})},T=function(a){var b=a.name;b||(b=a,a={name:b});a=n({main:"main"},a);a.location=a.location?a.location:b;a.packageMap&&(N[b]=a.packageMap);a.main.indexOf("./")||(a.main=a.main.substring(2));M[b]=a},S=[],W=function(a,c,d){for(var e in a){"waitSeconds"==
e&&(t.waitms=1E3*(a[e]||0));"cacheBust"==e&&(O=a[e]?b(a[e])?a[e]:(new Date).getTime()+"":"");if("baseUrl"==e||"combo"==e)t[e]=a[e];a[e]!==z&&(t.rawConfig[e]=a[e],"has"!=e&&v.add("config-"+e,a[e],0,c))}t.baseUrl||(t.baseUrl="./");/\/$/.test(t.baseUrl)||(t.baseUrl+="/");for(e in a.has)v.add(e,a.has[e],0,c);l(a.packages,T);for(var h in a.packagePaths)l(a.packagePaths[h],function(a){var c=h+"/"+a;b(a)&&(a={name:a});a.location=c;T(a)});P(n(N,a.map),I);l(I,function(a){a[1]=P(a[1],[]);"*"==a[0]&&(I.star=
a)});P(n(D,a.paths),F);L(a.aliases,E);if(!v("foreign-loader")){if(c)S.push({config:a.config});else for(e in a.config)c=Ga(e,d),c.config=n(c.config||{},a.config[e]);a.cache&&(K(),Q=a.cache,K(0,!!a.cache["*noref"]))}C("config",[a,t.rawConfig])};if(v("dojo-cdn")){var Y=u.getElementsByTagName("script");k=0;for(var X,aa,U,ha;k<Y.length;)if(X=Y[k++],(U=X.getAttribute("src"))&&(ha=U.match(/(((.*)\/)|^)dojo\.js(\W|$)/i))&&(aa=ha[3]||"",f.baseUrl=f.baseUrl||aa,H=X),U=X.getAttribute("data-dojo-config")||X.getAttribute("djConfig"))e=
t.eval("({ "+U+" })","data-dojo-config"),H=X}t.rawConfig={};W(f,1);v("dojo-cdn")&&((M.dojo.location=aa)&&(aa+="/"),M.dijit.location=aa+"../dijit/",M.dojox.location=aa+"../dojox/");W(m,1);W(e,1);if(!v("foreign-loader"))var Z=function(a){V(function(){l(a.deps,da)})},ba=function(c,l,d,e,h){var v;if(b(c)){if((v=Ga(c,e,!0))&&v.executed)return v.result;throw p("undefinedModule",c);}a(c)||(W(c,0,e),c=l,l=d);if(a(c))if(c.length){d="require*"+r();for(var q,u=[],z=0;z<c.length;)q=c[z++],u.push(Ga(q,e));v=n(Ea("",
d,0,""),{injected:2,deps:u,def:l||g,require:e?e.require:t,gc:1});G[v.mid]=v;Z(v);var k=ta&&!0;V(function(){ca(v,k)});v.executed||ga.push(v);oa()}else l&&l();return h},ka=function(a){if(!a)return t;var b=a.require;b||(b=function(c,l,d){return ba(c,l,d,a,b)},a.require=n(b,t),b.module=a,b.toUrl=function(b){return Pa(b,a)},b.toAbsMid=function(b){return Ca(b,a)});return b},ga=[],ia=[],na={},wa=function(a){a.injected=1;na[a.mid]=1;a.url&&(na[a.url]=a.pack||1);wb()},za=function(a){a.injected=2;delete na[a.mid];
a.url&&delete na[a.url];d(na)&&$a()},Aa=t.idle=function(){return!ia.length&&d(na)&&!ga.length&&!ta};var sa=function(a,b){if(b)for(var c=0;c<b.length;c++)if(b[c][2].test(a))return b[c];return 0},ma=function(a){var b=[],c,l;for(a=a.replace(/\\/g,"/").split("/");a.length;)c=a.shift(),".."==c&&b.length&&".."!=l?(b.pop(),l=b[b.length-1]):"."!=c&&b.push(l=c);return b.join("/")},Ea=function(a,b,c,l){return{pid:a,mid:b,pack:c,url:l,executed:0,def:0}},Ha=function(a,b,d,e,h,n,g,v,q,r){var u,z,k,y;y=/^\./.test(a);
if(/(^\/)|(\:)|(\.js$)/.test(a)||y&&!b)return Ea(0,a,0,a);a=ma(y?b.mid+"/../"+a:a);if(/^\./.test(a))throw p("irrationalPath",a);r||y||!n.star||(k=sa(a,n.star[1]));!k&&b&&(k=(k=sa(b.mid,n))&&sa(a,k[1]));k&&(a=k[1]+a.substring(k[3]));b=(ha=a.match(/^([^\/]+)(\/(.+))?$/))?ha[1]:"";(u=d[b])?a=b+"/"+(z=ha[3]||u.main):b="";var t=0;l(v,function(b){var l=a.match(b[0]);l&&0<l.length&&(t=c(b[1])?a.replace(b[0],b[1]):b[1])});if(t)return Ha(t,0,d,e,h,n,g,v,q);if(d=e[a])return q?Ea(d.pid,d.mid,d.pack,d.url):e[a];
e=(k=sa(a,g))?k[1]+a.substring(k[3]):b?("/"===u.location.slice(-1)?u.location.slice(0,-1):u.location)+"/"+z:a;/(^\/)|(\:)/.test(e)||(e=h+e);return Ea(b,a,u,ma(e+".js"))},Na=function(a,b,c){return Ha(a,b,M,G,t.baseUrl,I,F,E,void 0,c)};if(!v("foreign-loader"))var xa=function(a,b,c){return a.normalize?a.normalize(b,function(a){return Ca(a,c)}):Ca(b,c)},ya=0,Ga=function(a,b,c){var l,d;(l=a.match(/^(.+?)\!(.*)$/))?(d=Ga(l[1],b,c),5!==d.executed||d.load||Ta(d),d.load?(l=xa(d,l[2],b),a=d.mid+"!"+(d.dynamic?
++ya+"!":"")+l):(l=l[2],a=d.mid+"!"+ ++ya+"!waitingForPlugin"),a={plugin:d,mid:a,req:ka(b),prid:l}):a=Na(a,b);return G[a.mid]||!c&&(G[a.mid]=a)};var Ca=t.toAbsMid=function(a,b){return Na(a,b).mid},Pa=t.toUrl=function(a,b){b=Na(a+"/x",b);var c=b.url;return qa(0===b.pid?a:c.substring(0,c.length-5))};if(!v("foreign-loader")){var Ja={injected:2,executed:5,def:3,result:3};aa=function(a){return G[a]=n({mid:a},Ja)};var Ua=aa("require"),ea=aa("exports"),Oa=aa("module"),Fa={},pa=0,Ta=function(a){var b=a.result;
a.dynamic=b.dynamic;a.normalize=b.normalize;a.load=b.load;return a},Qa=function(a){var b={};l(a.loadQ,function(c){var l=xa(a,c.prid,c.req.module),d=a.dynamic?c.mid.replace(/waitingForPlugin$/,l):a.mid+"!"+l,l=n(n({},c),{mid:d,prid:l,injected:0});G[d]&&G[d].injected||ua(G[d]=l);b[c.mid]=G[d];za(c);delete G[c.mid]});a.loadQ=0;var c=function(a){for(var c=a.deps||[],l=0;l<c.length;l++)(a=b[c[l].mid])&&(c[l]=a)},d;for(d in G)c(G[d]);l(ga,c)},ra=function(a){t.trace("loader-finish-exec",[a.mid]);a.executed=
5;a.defOrder=pa++;a.loadQ&&(Ta(a),Qa(a));for(k=0;k<ga.length;)ga[k]===a?ga.splice(k,1):k++;/^require\*/.test(a.mid)&&delete G[a.mid]},eb=[],ca=function(a,b){if(4===a.executed)return t.trace("loader-circular-dependency",[eb.concat(a.mid).join("-\x3e")]),!a.def||b?Fa:a.cjs&&a.cjs.exports;if(!a.executed){if(!a.def)return Fa;var l=a.mid,d=a.deps||[],e,h=[],n=0;for(a.executed=4;e=d[n++];){e=e===Ua?ka(a):e===ea?a.cjs.exports:e===Oa?a.cjs:ca(e,b);if(e===Fa)return a.executed=0,t.trace("loader-exec-module",
["abort",l]),Fa;h.push(e)}t.trace("loader-run-factory",[a.mid]);b=a.def;h=c(b)?b.apply(null,h):b;a.result=void 0===h&&a.cjs?a.cjs.exports:h;ra(a)}return a.result},ta=0,V=function(a){try{ta++,a()}catch(ub){throw ub;}finally{ta--}Aa()&&C("idle",[])},oa=function(){ta||V(function(){for(var a,b,c=0;c<ga.length;)a=pa,b=ga[c],ca(b),a!=pa?c=0:c++})}}var qa="function"==typeof m.fixupUrl?m.fixupUrl:function(a){a+="";return a+(O?(/\?/.test(a)?"\x26":"?")+O:"")};void 0===v("dojo-loader-eval-hint-url")&&v.add("dojo-loader-eval-hint-url",
1);var ua=function(a){var b=a.plugin;5!==b.executed||b.load||Ta(b);var c=function(b){a.result=b;za(a);ra(a);oa()};b.load?b.load(a.prid,a.req,c):b.loadQ?b.loadQ.push(a):(b.loadQ=[a],ga.unshift(b),da(b))},ja=0,la=function(a,b){v("config-stripStrict")&&(a=a.replace(/(["'])use strict\1/g,""));a===ja?ja.call(null):t.eval(a,v("dojo-loader-eval-hint-url")?b.url:b.mid)},da=function(a){var b=a.mid,c=a.url;if(!(a.executed||a.injected||na[b]||a.url&&(a.pack&&na[a.url]===a.pack||1==na[a.url])))if(wa(a),a.plugin)ua(a);
else{var l=function(){Ra(a);if(2!==a.injected){if(v("dojo-enforceDefine")){C("error",p("noDefine",a));return}za(a);n(a,Ja);t.trace("loader-define-nonmodule",[a.url])}oa()};(ja=J[b]||J["url:"+a.url])?(t.trace("loader-inject",["cache",a.mid,c]),la(ja,a),l()):(t.trace("loader-inject",["script",a.mid,c]),t.injectUrl(qa(c),l,a))}},nb=function(a,b,l){t.trace("loader-define-module",[a.mid,b]);if(2===a.injected)return C("error",p("multipleDefine",a)),a;n(a,{deps:b,def:l,cjs:{id:a.mid,uri:a.url,exports:a.result=
{},setExports:function(b){a.cjs.exports=b},config:function(){return a.config}}});for(var d=0;b[d];d++)b[d]=Ga(b[d],a);za(a);c(l)||b.length||(a.result=l,ra(a));return a},Ra=function(a,b){for(var c=[],d,e;ia.length;)e=ia.shift(),b&&(e[0]=b.shift()),d=e[0]&&Ga(e[0])||a,c.push([d,e[1],e[2]]);K(a);l(c,function(a){Z(nb.apply(null,a))})},$a=g,wb=g;v("dom");if(v("dom")){var Va=function(a,b,c,l){a.addEventListener(b,l,!1);return function(){a.removeEventListener(b,l,!1)}},yb=Va(window,"load","onload",function(){t.pageLoaded=
1;try{"complete"!=u.readyState&&(u.readyState="complete")}catch(tb){}yb()}),Y=u.getElementsByTagName("script");for(k=0;!H;)/^dojo/.test((X=Y[k++])&&X.type)||(H=X);t.injectUrl=function(a,b,c){c=c.node=u.createElement("script");var l=Va(c,"load","onreadystatechange",function(a){a=a||window.event;var c=a.target||a.srcElement;if("load"===a.type||/complete|loaded/.test(c.readyState))l(),d(),b&&b()}),d=Va(c,"error","onerror",function(b){l();d();C("error",p("scriptError",[a,b]))});c.type="text/javascript";
c.charset="utf-8";c.src=a;H.parentNode.insertBefore(c,H);return c}}t.log=g;t.trace=g;v("foreign-loader")?X=g:(X=function(a,l,d){var e=arguments.length,h=["require","exports","module"],n=[0,a,l];1==e?n=[0,c(a)?h:[],a]:2==e&&b(a)?n=[a,c(l)?h:[],l]:3==e&&(n=[a,l,d]);t.trace("loader-define",n.slice(0,2));(e=n[0]&&Ga(n[0]))&&!na[e.mid]?Z(nb(e,n[1],n[2])):ia.push(n)},X.amd={vendor:"dojotoolkit.org"});n(n(t,f.loaderPatch),m.loaderPatch);y("error",function(a){try{if(console.error(a),a instanceof Error){for(var b in a)console.log(b+
":",a[b]);console.log(".")}}catch(mb){}});n(t,{uid:r,cache:J,packs:M});w.define||(w.define=X,w.require=t,v("foreign-loader")||(l(S,function(a){W(a)}),X=e.deps||m.deps||f.deps,m=e.callback||m.callback||f.callback,t.boot=X||m?[X||[],m]:0))})(function(m){return m.dojoConfig||m.djConfig||m.require||{}},{aliases:[[/^webgl-engine/,function(){return"esri/views/3d/webgl-engine"}],[/^engine/,function(){return"esri/views/3d/webgl-engine"}]],async:1,baseUrl:"js/dojo",hasCache:{"config-deferredInstrumentation":0,
"config-selectorEngine":"acme","config-tlmSiblingOfDojo":1,"dojo-built":1,"dojo-has-api":1,"dojo-loader":1,"dojo-undef-api":0,dom:1,"esri-featurelayer-webgl":1,"host-browser":1},map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}},packages:[{location:".",name:"dojo"},{location:"../dijit",name:"dijit"},{location:"../dojox",name:"dojox"},{location:"../dgrid",main:"OnDemandGrid",
name:"dgrid"},{location:"../dstore",main:"Store",name:"dstore"},{location:"../moment",main:"moment",name:"moment"},{location:"../esri",name:"esri"},{location:"../webSceneViewer",main:"WebSceneViewer.js",name:"webSceneViewer"},{location:"../@dojo",name:"@dojo"},{location:"../cldrjs",main:"dist/cldr",name:"cldrjs"},{location:"../globalize",main:"dist/globalize",name:"globalize"},{location:"../maquette",main:"dist/maquette.umd",name:"maquette"},{location:"../maquette-jsx",main:"dist/maquette-jsx.umd",
name:"maquette-jsx"},{location:"../maquette-css-transitions",main:"dist/maquette-css-transitions.umd",name:"maquette-css-transitions"},{location:"../tslib",main:"tslib",name:"tslib"},{location:"../telemetry",main:"telemetry.dojo",name:"telemetry"}]});
require({cache:{"dojo/domReady":function(){define(["./global","./has"],function(m,f){function k(a){b.push(a);c&&e()}function e(){if(!a){for(a=!0;b.length;)try{b.shift()(g)}catch(q){console.error(q,"in domReady callback",q.stack)}a=!1;k._onQEmpty()}}var g=document,d={loaded:1,complete:1},h="string"!=typeof g.readyState,c=!!d[g.readyState],b=[],a;k.load=function(a,b,c){k(c)};k._Q=b;k._onQEmpty=function(){};h&&(g.readyState="loading");if(!c){var l=[],n=function(a){a=a||m.event;c||"readystatechange"==
a.type&&!d[g.readyState]||(h&&(g.readyState="complete"),c=1,e())};f=function(a,c){a.addEventListener(c,n,!1);b.push(function(){a.removeEventListener(c,n,!1)})};f(g,"DOMContentLoaded");f(m,"load");"onreadystatechange"in g?f(g,"readystatechange"):h||l.push(function(){return d[g.readyState]});if(l.length){var p=function(){if(!c){for(var a=l.length;a--;)if(l[a]()){n("poller");return}setTimeout(p,30)}};p()}}return k})},"dojo/global":function(){define(function(){return"undefined"!==typeof global&&"function"!==
typeof global?global:"undefined"!==typeof window?window:"undefined"!==typeof self?self:this})},"dojo/has":function(){define(["./global","require","module"],function(m,f,k){var e=f.has||function(){};if(!e("dojo-has-api")){var g=(f="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location==location&&window.document==document)&&document,d=g&&g.createElement("DiV"),h=k.config&&k.config()||{},e=function(c){return"function"==typeof h[c]?h[c]=h[c](m,g,d):h[c]};
e.cache=h;e.add=function(c,b,a,l){("undefined"==typeof h[c]||l)&&(h[c]=b);return a&&e(c)};e.add("host-browser",f);e.add("dom",f)}e("host-browser")&&(e.add("touch","ontouchstart"in document||"onpointerdown"in document&&0<navigator.maxTouchPoints||window.navigator.msMaxTouchPoints),e.add("touch-events","ontouchstart"in document),e.add("pointer-events","pointerEnabled"in window.navigator?window.navigator.pointerEnabled:"PointerEvent"in window),e.add("device-width",screen.availWidth||innerWidth),k=document.createElement("form"),
e.add("dom-attributes-specified-flag",0<k.attributes.length&&40>k.attributes.length));e.clearElement=function(c){c.innerHTML="";return c};e.normalize=function(c,b){var a=c.match(/[\?:]|[^:\?]*/g),l=0,d=function(b){var c=a[l++];if(":"==c)return 0;if("?"==a[l++]){if(!b&&e(c))return d();d(!0);return d(b)}return c||0};return(c=d())&&b(c)};e.load=function(c,b,a){c?b([c],a):a()};return e})},"dojo/_base/browser":function(){require.has&&require.has.add("config-selectorEngine","acme");define("../ready ./kernel ./connect ./unload ./window ./event ./html ./NodeList ../query ./xhr ./fx".split(" "),
function(m){return m})},"dojo/ready":function(){define(["./_base/kernel","./has","require","./has!host-browser?./domReady","./_base/lang"],function(m,f,k,e,g){var d=0,h=[],c=0;f=function(){d=1;m._postLoad=m.config.afterOnLoad=!0;b()};var b=function(){if(!c){for(c=1;d&&(!e||0==e._Q.length)&&(k.idle?k.idle():1)&&h.length;){var a=h.shift();try{a()}catch(p){if(p.info=p.message,k.signal)k.signal("error",p);else throw p;}}c=0}};k.on&&k.on("idle",b);e&&(e._onQEmpty=b);var a=m.ready=m.addOnLoad=function(a,
c,l){var d=g._toArray(arguments);"number"!=typeof a?(l=c,c=a,a=1E3):d.shift();l=l?g.hitch.apply(m,d):function(){c()};l.priority=a;for(d=0;d<h.length&&a>=h[d].priority;d++);h.splice(d,0,l);b()},l=m.config.addOnLoad;if(l)a[g.isArray(l)?"apply":"call"](m,l);e?e(f):f();return a})},"dojo/_base/kernel":function(){define(["../global","../has","./config","require","module"],function(m,f,k,e,g){var d,h={},c={},b={config:k,global:m,dijit:h,dojox:c},h={dojo:["dojo",b],dijit:["dijit",h],dojox:["dojox",c]};g=
e.map&&e.map[g.id.match(/[^\/]+/)[0]];for(d in g)h[d]?h[d][0]=g[d]:h[d]=[g[d],{}];for(d in h)g=h[d],g[1]._scopeName=g[0],k.noGlobals||(m[g[0]]=g[1]);b.scopeMap=h;b.baseUrl=b.config.baseUrl=e.baseUrl;b.isAsync=e.async;b.locale=k.locale;m="$Rev: b27d4da $".match(/[0-9a-f]{7,}/);b.version={major:1,minor:14,patch:0,flag:"",revision:m?m[0]:NaN,toString:function(){var a=b.version;return a.major+"."+a.minor+"."+a.patch+a.flag+" ("+a.revision+")"}};f("csp-restrictions")||Function("d","d.eval \x3d function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(b);
b.exit=function(){};f("host-webworker");"undefined"!=typeof console||(console={});m="assert count debug dir dirxml error group groupEnd info profile profileEnd time timeEnd trace warn log".split(" ");var a;for(f=0;a=m[f++];)console[a]?console[a]=Function.prototype.bind.call(console[a],console):function(){var b=a+"";console[b]="log"in console?function(){var a=Array.prototype.slice.call(arguments);a.unshift(b+":");console.log(a.join(" "))}:function(){};console[b]._fake=!0}();b.deprecated=b.experimental=
function(){};b._hasResource={};return b})},"dojo/_base/config":function(){define(["../global","../has","require"],function(m,f,k){m={};k=k.rawConfig;for(var e in k)m[e]=k[e];!m.locale&&"undefined"!=typeof navigator&&(e=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage)&&(m.locale=e.toLowerCase());return m})},"dojo/_base/lang":function(){define(["./kernel","../has","../sniff"],function(m,f){var k=function(c,b,a){a||(a=c[0]&&m.scopeMap[c[0]]?
m.scopeMap[c.shift()][1]:m.global);try{for(var l=0;l<c.length;l++){var d=c[l];if(!(d in a))if(b)a[d]={};else return;a=a[d]}return a}catch(p){}},e=Object.prototype.toString,g=function(c,b,a){return(a||[]).concat(Array.prototype.slice.call(c,b||0))},d=/\{([^\}]+)\}/g,h={_extraNames:[],_mixin:function(c,b,a){var l,d,e={};for(l in b)d=b[l],l in c&&(c[l]===d||l in e&&e[l]===d)||(c[l]=a?a(d):d);return c},mixin:function(c,b){c||(c={});for(var a=1,l=arguments.length;a<l;a++)h._mixin(c,arguments[a]);return c},
setObject:function(c,b,a){var l=c.split(".");c=l.pop();return(a=k(l,!0,a))&&c?a[c]=b:void 0},getObject:function(c,b,a){return c?k(c.split("."),b,a):a},exists:function(c,b){return void 0!==h.getObject(c,!1,b)},isString:function(c){return"string"==typeof c||c instanceof String},isArray:Array.isArray||function(c){return"[object Array]"==e.call(c)},isFunction:function(c){return"[object Function]"===e.call(c)},isObject:function(c){return void 0!==c&&(null===c||"object"==typeof c||h.isArray(c)||h.isFunction(c))},
isArrayLike:function(c){return!!c&&!h.isString(c)&&!h.isFunction(c)&&!(c.tagName&&"form"==c.tagName.toLowerCase())&&(h.isArray(c)||isFinite(c.length))},isAlien:function(c){return c&&!h.isFunction(c)&&/\{\s*\[native code\]\s*\}/.test(String(c))},extend:function(c,b){for(var a=1,l=arguments.length;a<l;a++)h._mixin(c.prototype,arguments[a]);return c},_hitchArgs:function(c,b){var a=h._toArray(arguments,2),l=h.isString(b);return function(){var d=h._toArray(arguments),e=l?(c||m.global)[b]:b;return e&&e.apply(c||
this,a.concat(d))}},hitch:function(c,b){if(2<arguments.length)return h._hitchArgs.apply(m,arguments);b||(b=c,c=null);if(h.isString(b)){c=c||m.global;if(!c[b])throw['lang.hitch: scope["',b,'"] is null (scope\x3d"',c,'")'].join("");return function(){return c[b].apply(c,arguments||[])}}return c?function(){return b.apply(c,arguments||[])}:b},delegate:function(){function c(){}return function(b,a){c.prototype=b;b=new c;c.prototype=null;a&&h._mixin(b,a);return b}}(),_toArray:f("ie")?function(){function c(b,
a,c){c=c||[];for(a=a||0;a<b.length;a++)c.push(b[a]);return c}return function(b){return(b.item?c:g).apply(this,arguments)}}():g,partial:function(c){return h.hitch.apply(m,[null].concat(h._toArray(arguments)))},clone:function(c){if(!c||"object"!=typeof c||h.isFunction(c))return c;if(c.nodeType&&"cloneNode"in c)return c.cloneNode(!0);if(c instanceof Date)return new Date(c.getTime());if(c instanceof RegExp)return new RegExp(c);var b,a,l;if(h.isArray(c))for(b=[],a=0,l=c.length;a<l;++a)a in c&&(b[a]=h.clone(c[a]));
else b=c.constructor?new c.constructor:{};return h._mixin(b,c,h.clone)},trim:String.prototype.trim?function(c){return c.trim()}:function(c){return c.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(c,b,a){return c.replace(a||d,h.isFunction(b)?b:function(a,c){return h.getObject(c,!1,b)})}};h.mixin(m,h);return h})},"dojo/sniff":function(){define(["./has"],function(m){if(m("host-browser")){var f=navigator,k=f.userAgent,f=f.appVersion,e=parseFloat(f);m.add("edge",parseFloat(k.split("Edge/")[1])||
void 0);m.add("webkit",!m("edge")&&parseFloat(k.split("WebKit/")[1])||void 0);m.add("chrome",!m("edge")&&!0&&parseFloat(k.split("Chrome/")[1])||void 0);m.add("safari",0<=f.indexOf("Safari")&&!m("chrome")&&!m("edge")?parseFloat(f.split("Version/")[1]):void 0);m.add("mac",0<=f.indexOf("Macintosh"));if(k.match(/(iPhone|iPod|iPad)/)){var g=RegExp.$1.replace(/P/,"p"),d=k.match(/OS ([\d_]+)/)?RegExp.$1:"1",d=parseFloat(d.replace(/_/,".").replace(/_/g,""));m.add(g,d);m.add("ios",d)}m.add("trident",parseFloat(f.split("Trident/")[1])||
void 0);m("webkit")||(0<=k.indexOf("Opera")&&m.add("opera",9.8<=e?parseFloat(k.split("Version/")[1])||e:e),0<=k.indexOf("Gecko")&&!m("trident")&&!m("edge")&&m.add("mozilla",e),m("mozilla")&&m.add("ff",parseFloat(k.split("Firefox/")[1]||k.split("Minefield/")[1])||void 0),document.all&&!m("opera")&&(k=parseFloat(f.split("MSIE ")[1])||void 0,(f=document.documentMode)&&5!=f&&Math.floor(k)!=f&&(k=f),m.add("ie",k)))}return m})},"dojo/_base/connect":function(){define("./kernel ../on ../topic ../aspect ./event ../mouse ./sniff ./lang ../keys".split(" "),
function(m,f,k,e,g,d,h,c){function b(a,b,l,h,n){h=c.hitch(l,h);if(!a||!a.addEventListener&&!a.attachEvent)return e.after(a||m.global,b,h,!0);"string"==typeof b&&"on"==b.substring(0,2)&&(b=b.substring(2));a||(a=m.global);if(!n)switch(b){case "keypress":b=q;break;case "mouseenter":b=d.enter;break;case "mouseleave":b=d.leave}return f(a,b,h,n)}function a(a){a.keyChar=a.charCode?String.fromCharCode(a.charCode):"";a.charOrCode=a.keyChar||a.keyCode}h.add("events-keypress-typed",function(){var a={charCode:0};
try{a=document.createEvent("KeyboardEvent"),(a.initKeyboardEvent||a.initKeyEvent).call(a,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(w){}return 0==a.charCode&&!h("opera")});var l={106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},n=h("mac")?"metaKey":"ctrlKey",p=function(b,l){l=c.mixin({},b,l);a(l);l.preventDefault=function(){b.preventDefault()};l.stopPropagation=function(){b.stopPropagation()};return l},q;q=h("events-keypress-typed")?function(a,
b){var c=f(a,"keydown",function(a){var c=a.keyCode,d=13!=c&&32!=c&&(27!=c||!h("ie"))&&(48>c||90<c)&&(96>c||111<c)&&(186>c||192<c)&&(219>c||222<c)&&229!=c;if(d||a.ctrlKey){d=d?0:c;if(a.ctrlKey){if(3==c||13==c)return b.call(a.currentTarget,a);d=95<d&&106>d?d-48:!a.shiftKey&&65<=d&&90>=d?d+32:l[d]||d}c=p(a,{type:"keypress",faux:!0,charCode:d});b.call(a.currentTarget,c);if(h("ie"))try{a.keyCode=c.keyCode}catch(A){}}}),d=f(a,"keypress",function(a){var c=a.charCode;a=p(a,{charCode:32<=c?c:0,faux:!0});return b.call(this,
a)});return{remove:function(){c.remove();d.remove()}}}:h("opera")?function(a,b){return f(a,"keypress",function(a){var c=a.which;3==c&&(c=99);c=32>c&&!a.shiftKey?0:c;a.ctrlKey&&!a.shiftKey&&65<=c&&90>=c&&(c+=32);return b.call(this,p(a,{charCode:c}))})}:function(b,c){return f(b,"keypress",function(b){a(b);return c.call(this,b)})};var r={_keypress:q,connect:function(a,c,l,d,e){var h=arguments,n=[],g=0;n.push("string"==typeof h[0]?null:h[g++],h[g++]);var p=h[g+1];n.push("string"==typeof p||"function"==
typeof p?h[g++]:null,h[g++]);for(p=h.length;g<p;g++)n.push(h[g]);return b.apply(this,n)},disconnect:function(a){a&&a.remove()},subscribe:function(a,b,l){return k.subscribe(a,c.hitch(b,l))},publish:function(a,b){return k.publish.apply(k,[a].concat(b))},connectPublisher:function(a,b,c){var l=function(){r.publish(a,arguments)};return c?r.connect(b,c,l):r.connect(b,l)},isCopyKey:function(a){return a[n]}};r.unsubscribe=r.disconnect;c.mixin(m,r);return r})},"dojo/on":function(){define(["require","./_base/kernel",
"./sniff"],function(m,f,k){function e(a,b,d,e,n){if(e=b.match(/(.*):(.*)/))return b=e[2],e=e[1],h.selector(e,b).call(n,a,d);k("touch")&&c.test(b)&&(d=p(d));if(a.addEventListener){var g=b in l,v=g?l[b]:b;a.addEventListener(v,d,g);return{remove:function(){a.removeEventListener(v,d,g)}}}throw Error("Target must be an event emitter");}function g(){this.cancelable=!1;this.defaultPrevented=!0}function d(){this.bubbles=!1}k("dom")&&k("touch");var h=function(a,b,c,l){return"function"!=typeof a.on||"function"==
typeof b||a.nodeType?h.parse(a,b,c,e,l,this):a.on(b,c)};h.pausable=function(a,b,c,l){var d;a=h(a,b,function(){if(!d)return c.apply(this,arguments)},l);a.pause=function(){d=!0};a.resume=function(){d=!1};return a};h.once=function(a,b,c,l){var d=h(a,b,function(){d.remove();return c.apply(this,arguments)});return d};h.parse=function(a,b,c,l,d,e){var n;if(b.call)return b.call(e,a,c);b instanceof Array?n=b:-1<b.indexOf(",")&&(n=b.split(/\s*,\s*/));if(n){var g=[];b=0;for(var p;p=n[b++];)g.push(h.parse(a,
p,c,l,d,e));g.remove=function(){for(var a=0;a<g.length;a++)g[a].remove()};return g}return l(a,b,c,d,e)};var c=/^touch/;h.matches=function(a,b,c,l,d){d=d&&"function"==typeof d.matches?d:f.query;l=!1!==l;1!=a.nodeType&&(a=a.parentNode);for(;!d.matches(a,b,c);)if(a==c||!1===l||!(a=a.parentNode)||1!=a.nodeType)return!1;return a};h.selector=function(a,b,c){return function(l,d){function e(b){return h.matches(b,a,l,c,n)}var n="function"==typeof a?{matches:a}:this,g=b.bubble;return g?h(l,g(e),d):h(l,b,function(a){var b=
e(a.target);if(b)return a.selectorTarget=b,d.call(b,a)})}};var b=[].slice,a=h.emit=function(a,c,l){var e=b.call(arguments,2),h="on"+c;if("parentNode"in a){var n=e[0]={},p;for(p in l)n[p]=l[p];n.preventDefault=g;n.stopPropagation=d;n.target=a;n.type=c;l=n}do a[h]&&a[h].apply(a,e);while(l&&l.bubbles&&(a=a.parentNode));return l&&l.cancelable&&l},l={};h.emit=function(b,c,l){if(b.dispatchEvent&&document.createEvent){var d=(b.ownerDocument||document).createEvent("HTMLEvents");d.initEvent(c,!!l.bubbles,
!!l.cancelable);for(var e in l)e in d||(d[e]=l[e]);return b.dispatchEvent(d)&&d}return a.apply(h,arguments)};if(k("touch"))var n=window.orientation,p=function(a){return function(b){var c=b.corrected;if(!c){var l=b.type;try{delete b.type}catch(v){}if(b.type){var c={},d;for(d in b)c[d]=b[d];c.preventDefault=function(){b.preventDefault()};c.stopPropagation=function(){b.stopPropagation()}}else c=b,c.type=l;b.corrected=c;if("resize"==l){if(n==window.orientation)return null;n=window.orientation;c.type=
"orientationchange";return a.call(this,c)}"rotation"in c||(c.rotation=0,c.scale=1);if(window.TouchEvent&&b instanceof TouchEvent){var l=c.changedTouches[0],e;for(e in l)delete c[e],c[e]=l[e]}}return a.call(this,c)}};return h})},"dojo/topic":function(){define(["./Evented"],function(m){var f=new m;return{publish:function(k,e){return f.emit.apply(f,arguments)},subscribe:function(k,e){return f.on.apply(f,arguments)}}})},"dojo/Evented":function(){define(["./aspect","./on"],function(m,f){function k(){}
var e=m.after;k.prototype={on:function(g,d){return f.parse(this,g,d,function(h,c){return e(h,"on"+c,d,!0)})},emit:function(e,d){var h=[this];h.push.apply(h,arguments);return f.emit.apply(f,h)}};return k})},"dojo/aspect":function(){define([],function(){function m(d,c,b,a){var l=d[c],e="around"==c,h;if(e){var g=b(function(){return l.advice(this,arguments)});h={remove:function(){g&&(g=d=b=null)},advice:function(a,b){return g?g.apply(a,b):l.advice(a,b)}}}else h={remove:function(){if(h.advice){var a=h.previous,
l=h.next;l||a?(a?a.next=l:d[c]=l,l&&(l.previous=a)):delete d[c];d=b=h.advice=null}},id:d.nextId++,advice:b,receiveArguments:a};if(l&&!e)if("after"==c){for(;l.next&&(l=l.next););l.next=h;h.previous=l}else"before"==c&&(d[c]=h,h.next=l,l.previous=h);else d[c]=h;return h}function f(d){return function(c,b,a,l){var e=c[b],h;e&&e.target==c||(c[b]=h=function(){for(var a=h.nextId,b=arguments,c=h.before;c;)c.advice&&(b=c.advice.apply(this,b)||b),c=c.next;if(h.around)var l=h.around.advice(this,b);for(c=h.after;c&&
c.id<a;){if(c.advice)if(c.receiveArguments)var d=c.advice.apply(this,b),l=d===k?l:d;else l=c.advice.call(this,l,b);c=c.next}return l},e&&(h.around={advice:function(a,b){return e.apply(a,b)}}),h.target=c,h.nextId=h.nextId||0);c=m(h||e,d,a,l);a=null;return c}}var k,e=f("after"),g=f("before"),d=f("around");return{before:g,around:d,after:e}})},"dojo/_base/event":function(){define(["./kernel","../on","../has","../dom-geometry"],function(m,f,k,e){if(f._fixEvent){var g=f._fixEvent;f._fixEvent=function(d,
h){(d=g(d,h))&&e.normalizeEvent(d);return d}}k={fix:function(d,e){return f._fixEvent?f._fixEvent(d,e):d},stop:function(d){d.preventDefault();d.stopPropagation()}};m.fixEvent=k.fix;m.stopEvent=k.stop;return k})},"dojo/dom-geometry":function(){define(["./sniff","./_base/window","./dom","./dom-style"],function(m,f,k,e){function g(a,b,c,d,e,h){h=h||"px";a=a.style;isNaN(b)||(a.left=b+h);isNaN(c)||(a.top=c+h);0<=d&&(a.width=d+h);0<=e&&(a.height=e+h)}function d(a){return"button"==a.tagName.toLowerCase()||
"input"==a.tagName.toLowerCase()&&"button"==(a.getAttribute("type")||"").toLowerCase()}function h(a){return"border-box"==c.boxModel||"table"==a.tagName.toLowerCase()||d(a)}var c={boxModel:"content-box"};m("ie")&&(c.boxModel="BackCompat"==document.compatMode?"border-box":"content-box");c.getPadExtents=function(a,b){a=k.byId(a);var c=b||e.getComputedStyle(a),l=e.toPixelValue;b=l(a,c.paddingLeft);var d=l(a,c.paddingTop),h=l(a,c.paddingRight);a=l(a,c.paddingBottom);return{l:b,t:d,r:h,b:a,w:b+h,h:d+a}};
c.getBorderExtents=function(a,b){a=k.byId(a);var c=e.toPixelValue,l=b||e.getComputedStyle(a);b="none"!=l.borderLeftStyle?c(a,l.borderLeftWidth):0;var d="none"!=l.borderTopStyle?c(a,l.borderTopWidth):0,h="none"!=l.borderRightStyle?c(a,l.borderRightWidth):0;a="none"!=l.borderBottomStyle?c(a,l.borderBottomWidth):0;return{l:b,t:d,r:h,b:a,w:b+h,h:d+a}};c.getPadBorderExtents=function(a,b){a=k.byId(a);var l=b||e.getComputedStyle(a);b=c.getPadExtents(a,l);a=c.getBorderExtents(a,l);return{l:b.l+a.l,t:b.t+
a.t,r:b.r+a.r,b:b.b+a.b,w:b.w+a.w,h:b.h+a.h}};c.getMarginExtents=function(a,b){a=k.byId(a);var c=b||e.getComputedStyle(a),l=e.toPixelValue;b=l(a,c.marginLeft);var d=l(a,c.marginTop),h=l(a,c.marginRight);a=l(a,c.marginBottom);return{l:b,t:d,r:h,b:a,w:b+h,h:d+a}};c.getMarginBox=function(a,b){a=k.byId(a);b=b||e.getComputedStyle(a);b=c.getMarginExtents(a,b);var l=a.offsetLeft-b.l,d=a.offsetTop-b.t,h=a.parentNode,g=e.toPixelValue;8==m("ie")&&h&&(h=e.getComputedStyle(h),l-="none"!=h.borderLeftStyle?g(a,
h.borderLeftWidth):0,d-="none"!=h.borderTopStyle?g(a,h.borderTopWidth):0);return{l:l,t:d,w:a.offsetWidth+b.w,h:a.offsetHeight+b.h}};c.getContentBox=function(a,b){a=k.byId(a);var l=b||e.getComputedStyle(a);b=a.clientWidth;var d,h=c.getPadExtents(a,l);d=c.getBorderExtents(a,l);var l=a.offsetLeft+h.l+d.l,g=a.offsetTop+h.t+d.t;b?d=a.clientHeight:(b=a.offsetWidth-d.w,d=a.offsetHeight-d.h);if(8==m("ie")){var t=a.parentNode,w=e.toPixelValue;t&&(t=e.getComputedStyle(t),l-="none"!=t.borderLeftStyle?w(a,t.borderLeftWidth):
0,g-="none"!=t.borderTopStyle?w(a,t.borderTopWidth):0)}return{l:l,t:g,w:b-h.w,h:d-h.h}};c.setContentSize=function(a,b,d){a=k.byId(a);var l=b.w;b=b.h;h(a)&&(d=c.getPadBorderExtents(a,d),0<=l&&(l+=d.w),0<=b&&(b+=d.h));g(a,NaN,NaN,l,b)};var b={l:0,t:0,w:0,h:0};c.setMarginBox=function(a,l,n){a=k.byId(a);var p=n||e.getComputedStyle(a);n=l.w;var q=l.h,r=h(a)?b:c.getPadBorderExtents(a,p),p=c.getMarginExtents(a,p);if(m("webkit")&&d(a)){var t=a.style;0<=n&&!t.width&&(t.width="4px");0<=q&&!t.height&&(t.height=
"4px")}0<=n&&(n=Math.max(n-r.w-p.w,0));0<=q&&(q=Math.max(q-r.h-p.h,0));g(a,l.l,l.t,n,q)};c.isBodyLtr=function(a){a=a||f.doc;return"ltr"==(f.body(a).dir||a.documentElement.dir||"ltr").toLowerCase()};c.docScroll=function(a){a=a||f.doc;var b=f.doc.parentWindow||f.doc.defaultView;return"pageXOffset"in b?{x:b.pageXOffset,y:b.pageYOffset}:(b=a.documentElement)&&{x:c.fixIeBiDiScrollLeft(b.scrollLeft||0,a),y:b.scrollTop||0}};c.getIeDocumentElementOffset=function(a){return{x:0,y:0}};c.fixIeBiDiScrollLeft=
function(a,b){b=b||f.doc;var l=m("ie");if(l&&!c.isBodyLtr(b)){b=b.documentElement;var d=f.global;6==l&&d.frameElement&&b.scrollHeight>b.clientHeight&&(a+=b.clientLeft);return 8>l?a+b.clientWidth-b.scrollWidth:-a}return a};c.position=function(a,b){a=k.byId(a);f.body(a.ownerDocument);var l=a.getBoundingClientRect(),l={x:l.left,y:l.top,w:l.right-l.left,h:l.bottom-l.top};9>m("ie")&&(l.x-=0,l.y-=0);b&&(a=c.docScroll(a.ownerDocument),l.x+=a.x,l.y+=a.y);return l};c.getMarginSize=function(a,b){a=k.byId(a);
b=c.getMarginExtents(a,b||e.getComputedStyle(a));a=a.getBoundingClientRect();return{w:a.right-a.left+b.w,h:a.bottom-a.top+b.h}};c.normalizeEvent=function(a){"layerX"in a||(a.layerX=a.offsetX,a.layerY=a.offsetY);if(!("pageX"in a)){var b=a.target,b=b&&b.ownerDocument||document,d=b.documentElement;a.pageX=a.clientX+c.fixIeBiDiScrollLeft(d.scrollLeft||0,b);a.pageY=a.clientY+(d.scrollTop||0)}};return c})},"dojo/_base/window":function(){define(["./kernel","./lang","../sniff"],function(m,f,k){var e={global:m.global,
doc:m.global.document||null,body:function(e){e=e||m.doc;return e.body||e.getElementsByTagName("body")[0]},setContext:function(g,d){m.global=e.global=g;m.doc=e.doc=d},withGlobal:function(g,d,h,c){var b=m.global;try{return m.global=e.global=g,e.withDoc.call(null,g.document,d,h,c)}finally{m.global=e.global=b}},withDoc:function(g,d,h,c){var b=e.doc,a=k("ie"),l,n,p;try{return m.doc=e.doc=g,m.isQuirks=0,k("ie")&&(p=g.parentWindow)&&p.navigator&&(l=parseFloat(p.navigator.appVersion.split("MSIE ")[1])||void 0,
(n=g.documentMode)&&5!=n&&Math.floor(l)!=n&&(l=n),m.isIE=k.add("ie",l,!0,!0)),h&&"string"==typeof d&&(d=h[d]),d.apply(h,c||[])}finally{m.doc=e.doc=b,m.isQuirks=0,m.isIE=k.add("ie",a,!0,!0)}}};f.mixin(m,e);return e})},"dojo/dom":function(){define(["./sniff","./_base/window","./_base/kernel"],function(m,f,k){if(7>=m("ie"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(d){}var e={};m("ie")?e.byId=function(d,e){if("string"!=typeof d)return d;var c=e||f.doc;e=d&&c.getElementById(d);if(!e||
e.attributes.id.value!=d&&e.id!=d){c=c.all[d];if(!c||c.nodeName)c=[c];for(var b=0;e=c[b++];)if(e.attributes&&e.attributes.id&&e.attributes.id.value==d||e.id==d)return e}else return e}:e.byId=function(d,e){return("string"==typeof d?(e||f.doc).getElementById(d):d)||null};k=k.global.document||null;m.add("dom-contains",!(!k||!k.contains));e.isDescendant=m("dom-contains")?function(d,h){return!(!(h=e.byId(h))||!h.contains(e.byId(d)))}:function(d,h){try{for(d=e.byId(d),h=e.byId(h);d;){if(d==h)return!0;d=
d.parentNode}}catch(c){}return!1};m.add("css-user-select",function(d,e,c){if(!c)return!1;d=c.style;e=["Khtml","O","Moz","Webkit"];c=e.length;var b="userSelect";do if("undefined"!==typeof d[b])return b;while(c--&&(b=e[c]+"UserSelect"));return!1});var g=m("css-user-select");e.setSelectable=g?function(d,h){e.byId(d).style[g]=h?"":"none"}:function(d,h){d=e.byId(d);var c=d.getElementsByTagName("*"),b=c.length;if(h)for(d.removeAttribute("unselectable");b--;)c[b].removeAttribute("unselectable");else for(d.setAttribute("unselectable",
"on");b--;)c[b].setAttribute("unselectable","on")};return e})},"dojo/dom-style":function(){define(["./sniff","./dom","./_base/window"],function(m,f,k){function e(a,b,c){b=b.toLowerCase();if("auto"==c){if("height"==b)return a.offsetHeight;if("width"==b)return a.offsetWidth}if("fontweight"==b)switch(c){case 700:return"bold";default:return"normal"}b in l||(l[b]=n.test(b));return l[b]?h(a,c):c}var g,d={};g=m("webkit")?function(a){var b;if(1==a.nodeType){var c=a.ownerDocument.defaultView;b=c.getComputedStyle(a,
null);!b&&a.style&&(a.style.display="",b=c.getComputedStyle(a,null))}return b||{}}:m("ie")&&9>m("ie")?function(a){return 1==a.nodeType&&a.currentStyle?a.currentStyle:{}}:function(a){if(1===a.nodeType){var b=a.ownerDocument.defaultView;return(b.opener?b:k.global.window).getComputedStyle(a,null)}return{}};d.getComputedStyle=g;var h;h=m("ie")?function(a,b){if(!b)return 0;if("medium"==b)return 4;if(b.slice&&"px"==b.slice(-2))return parseFloat(b);var c=a.style,l=a.runtimeStyle,d=c.left,e=l.left;l.left=
a.currentStyle.left;try{c.left=b,b=c.pixelLeft}catch(v){b=0}c.left=d;l.left=e;return b}:function(a,b){return parseFloat(b)||0};d.toPixelValue=h;var c=function(a,b){try{return a.filters.item("DXImageTransform.Microsoft.Alpha")}catch(t){return b?{}:null}},b=9>m("ie")||(m("ie"),0)?function(a){try{return c(a).Opacity/100}catch(r){return 1}}:function(a){return g(a).opacity},a=9>m("ie")||(m("ie"),0)?function(b,l){""===l&&(l=1);var d=100*l;1===l?(b.style.zoom="",c(b)&&(b.style.filter=b.style.filter.replace(/\s*progid:DXImageTransform.Microsoft.Alpha\([^\)]+?\)/i,
""))):(b.style.zoom=1,c(b)?c(b,1).Opacity=d:b.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d"+d+")",c(b,1).Enabled=!0);if("tr"==b.tagName.toLowerCase())for(b=b.firstChild;b;b=b.nextSibling)"td"==b.tagName.toLowerCase()&&a(b,l);return l}:function(a,b){return a.style.opacity=b},l={left:!0,top:!0},n=/margin|padding|width|height|max|min|offset/,p={cssFloat:1,styleFloat:1,"float":1};d.get=function(a,c){var l=f.byId(a),h=arguments.length;if(2==h&&"opacity"==c)return b(l);c=p[c]?"cssFloat"in
l.style?"cssFloat":"styleFloat":c;var g=d.getComputedStyle(l);return 1==h?g:e(l,c,g[c]||l.style[c])};d.set=function(b,c,l){var e=f.byId(b),h=arguments.length,g="opacity"==c;c=p[c]?"cssFloat"in e.style?"cssFloat":"styleFloat":c;if(3==h)return g?a(e,l):e.style[c]=l;for(var n in c)d.set(b,n,c[n]);return d.getComputedStyle(e)};return d})},"dojo/mouse":function(){define(["./_base/kernel","./on","./has","./dom","./_base/window"],function(m,f,k,e,g){function d(h,c){var b=function(a,b){return f(a,h,function(l){if(c)return c(l,
b);if(!e.isDescendant(l.relatedTarget,a))return b.call(this,l)})};b.bubble=function(a){return d(h,function(b,c){var l=a(b.target),d=b.relatedTarget;if(l&&l!=(d&&1==d.nodeType&&a(d)))return c.call(l,b)})};return b}k={LEFT:0,MIDDLE:1,RIGHT:2,isButton:function(d,c){return d.button==c},isLeft:function(d){return 0==d.button},isMiddle:function(d){return 1==d.button},isRight:function(d){return 2==d.button}};m.mouseButtons=k;return{_eventHandler:d,enter:d("mouseover"),leave:d("mouseout"),wheel:"mousewheel",
isLeft:k.isLeft,isMiddle:k.isMiddle,isRight:k.isRight}})},"dojo/_base/sniff":function(){define(["./kernel","./lang","../sniff"],function(m,f,k){if(!k("host-browser"))return k;m._name="browser";f.mixin(m,{isBrowser:!0,isFF:k("ff"),isIE:k("ie"),isKhtml:0,isWebKit:k("webkit"),isMozilla:k("mozilla"),isMoz:k("mozilla"),isOpera:k("opera"),isSafari:k("safari"),isChrome:k("chrome"),isMac:k("mac"),isIos:k("ios"),isAndroid:0,isWii:0,isQuirks:0,isAir:0});return k})},"dojo/keys":function(){define(["./_base/kernel",
"./sniff"],function(m,f){return m.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:f("webkit")?91:224,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,
NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,UP_DPAD:175,DOWN_DPAD:176,LEFT_DPAD:177,RIGHT_DPAD:178,copyKey:f("mac")?f("safari")?91:224:17}})},"dojo/_base/unload":function(){define(["./kernel","./lang","../on"],function(m,f,k){var e=window,g={addOnWindowUnload:function(d,h){m.windowUnloaded||k(e,"unload",m.windowUnloaded=function(){});k(e,"unload",f.hitch(d,
h))},addOnUnload:function(d,h){k(e,"beforeunload",f.hitch(d,h))}};m.addOnWindowUnload=g.addOnWindowUnload;m.addOnUnload=g.addOnUnload;return g})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(m,f,k,e,g,d,h,c){m.byId=f.byId;m.isDescendant=f.isDescendant;m.setSelectable=f.setSelectable;m.getAttr=e.get;m.setAttr=e.set;m.hasAttr=e.has;m.removeAttr=e.remove;m.getNodeProp=e.getNodeProp;m.attr=
function(b,a,c){return 2==arguments.length?e["string"==typeof a?"get":"set"](b,a):e.set(b,a,c)};m.hasClass=d.contains;m.addClass=d.add;m.removeClass=d.remove;m.toggleClass=d.toggle;m.replaceClass=d.replace;m._toDom=m.toDom=h.toDom;m.place=h.place;m.create=h.create;m.empty=function(b){h.empty(b)};m._destroyElement=m.destroy=function(b){h.destroy(b)};m._getPadExtents=m.getPadExtents=c.getPadExtents;m._getBorderExtents=m.getBorderExtents=c.getBorderExtents;m._getPadBorderExtents=m.getPadBorderExtents=
c.getPadBorderExtents;m._getMarginExtents=m.getMarginExtents=c.getMarginExtents;m._getMarginSize=m.getMarginSize=c.getMarginSize;m._getMarginBox=m.getMarginBox=c.getMarginBox;m.setMarginBox=c.setMarginBox;m._getContentBox=m.getContentBox=c.getContentBox;m.setContentSize=c.setContentSize;m._isBodyLtr=m.isBodyLtr=c.isBodyLtr;m._docScroll=m.docScroll=c.docScroll;m._getIeDocumentElementOffset=m.getIeDocumentElementOffset=c.getIeDocumentElementOffset;m._fixIeBiDiScrollLeft=m.fixIeBiDiScrollLeft=c.fixIeBiDiScrollLeft;
m.position=c.position;m.marginBox=function(b,a){return a?c.setMarginBox(b,a):c.getMarginBox(b)};m.contentBox=function(b,a){return a?c.setContentSize(b,a):c.getContentBox(b)};m.coords=function(b,a){m.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");b=f.byId(b);var l=k.getComputedStyle(b),l=c.getMarginBox(b,l);b=c.position(b,a);l.x=b.x;l.y=b.y;return l};m.getProp=g.get;m.setProp=g.set;m.prop=function(b,a,c){return 2==arguments.length?g["string"==typeof a?"get":"set"](b,a):g.set(b,
a,c)};m.getStyle=k.get;m.setStyle=k.set;m.getComputedStyle=k.getComputedStyle;m.__toPixelValue=m.toPixelValue=k.toPixelValue;m.style=function(b,a,c){switch(arguments.length){case 1:return k.get(b);case 2:return k["string"==typeof a?"get":"set"](b,a)}return k.set(b,a,c)};return m})},"dojo/dom-attr":function(){define("exports ./sniff ./_base/lang ./dom ./dom-style ./dom-prop".split(" "),function(m,f,k,e,g,d){function h(a,b){a=a.getAttributeNode&&a.getAttributeNode(b);return!!a&&a.specified}var c={innerHTML:1,
textContent:1,className:1,htmlFor:f("ie"),value:1},b={classname:"class",htmlfor:"for",tabindex:"tabIndex",readonly:"readOnly"};m.has=function(a,l){var g=l.toLowerCase();return c[d.names[g]||l]||h(e.byId(a),b[g]||l)};m.get=function(a,l){a=e.byId(a);var g=l.toLowerCase(),p=d.names[g]||l,q=a[p];if(c[p]&&"undefined"!=typeof q)return q;if("textContent"==p)return d.get(a,p);if("href"!=p&&("boolean"==typeof q||k.isFunction(q)))return q;l=b[g]||l;return h(a,l)?a.getAttribute(l):null};m.set=function(a,l,h){a=
e.byId(a);if(2==arguments.length){for(var n in l)m.set(a,n,l[n]);return a}n=l.toLowerCase();var q=d.names[n]||l,r=c[q];if("style"==q&&"string"!=typeof h)return g.set(a,h),a;if(r||"boolean"==typeof h||k.isFunction(h))return d.set(a,l,h);a.setAttribute(b[n]||l,h);return a};m.remove=function(a,c){e.byId(a).removeAttribute(b[c.toLowerCase()]||c)};m.getNodeProp=function(a,c){a=e.byId(a);var l=c.toLowerCase(),g=d.names[l]||c;if(g in a&&"href"!=g)return a[g];c=b[l]||c;return h(a,c)?a.getAttribute(c):null}})},
"dojo/dom-prop":function(){define("exports ./_base/kernel ./sniff ./_base/lang ./dom ./dom-style ./dom-construct ./_base/connect".split(" "),function(m,f,k,e,g,d,h,c){var b={},a=1,l=f._scopeName+"attrid";m.names={"class":"className","for":"htmlFor",tabindex:"tabIndex",readonly:"readOnly",colspan:"colSpan",frameborder:"frameBorder",rowspan:"rowSpan",textcontent:"textContent",valuetype:"valueType"};m.get=function(a,b){a=g.byId(a);var c=b.toLowerCase();return a[m.names[c]||b]};m.set=function(n,p,q){n=
g.byId(n);if(2==arguments.length&&"string"!=typeof p){for(var r in p)m.set(n,r,p[r]);return n}r=p.toLowerCase();r=m.names[r]||p;if("style"==r&&"string"!=typeof q)return d.set(n,q),n;if("innerHTML"==r)return k("ie")&&n.tagName.toLowerCase()in{col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1}?(h.empty(n),n.appendChild(h.toDom(q,n.ownerDocument))):n[r]=q,n;if(e.isFunction(q)){var t=n[l];t||(t=a++,n[l]=t);b[t]||(b[t]={});var w=b[t][r];if(w)c.disconnect(w);else try{delete n[r]}catch(u){}q?
b[t][r]=c.connect(n,r,q):n[r]=null;return n}n[r]=q;return n}})},"dojo/dom-construct":function(){define("exports ./_base/kernel ./sniff ./_base/window ./dom ./dom-attr".split(" "),function(m,f,k,e,g,d){function h(a,b){var c=b.parentNode;c&&c.insertBefore(a,b)}function c(a){if("innerHTML"in a)try{a.innerHTML="";return}catch(v){}for(var b;b=a.lastChild;)a.removeChild(b)}var b={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table",
"thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},a=/<\s*([\w\:]+)/,l={},n=0,p="__"+f._scopeName+"ToDomId",q;for(q in b)b.hasOwnProperty(q)&&(f=b[q],f.pre="option"==q?'\x3cselect multiple\x3d"multiple"\x3e':"\x3c"+f.join("\x3e\x3c")+"\x3e",f.post="\x3c/"+f.reverse().join("\x3e\x3c/")+"\x3e");var r;8>=k("ie")&&(r=function(a){a.__dojo_html5_tested="yes";var b=t("div",{innerHTML:"\x3cnav\x3ea\x3c/nav\x3e",style:{visibility:"hidden"}},a.body);1!==
b.childNodes.length&&"abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\b\w+\b/g,function(b){a.createElement(b)});w(b)});m.toDom=function(c,d){d=d||e.doc;var h=d[p];h||(d[p]=h=++n+"",l[h]=d.createElement("div"));8>=k("ie")&&!d.__dojo_html5_tested&&d.body&&r(d);c+="";var g=c.match(a),q=g?g[1].toLowerCase():"",h=l[h];if(g&&b[q])for(g=b[q],h.innerHTML=g.pre+c+g.post,c=g.length;c;--c)h=h.firstChild;else h.innerHTML=
c;if(1==h.childNodes.length)return h.removeChild(h.firstChild);for(c=d.createDocumentFragment();d=h.firstChild;)c.appendChild(d);return c};m.place=function(a,b,c){b=g.byId(b);"string"==typeof a&&(a=/^\s*</.test(a)?m.toDom(a,b.ownerDocument):g.byId(a));if("number"==typeof c){var l=b.childNodes;!l.length||l.length<=c?b.appendChild(a):h(a,l[0>c?0:c])}else switch(c){case "before":h(a,b);break;case "after":c=a;(l=b.parentNode)&&(l.lastChild==b?l.appendChild(c):l.insertBefore(c,b.nextSibling));break;case "replace":b.parentNode.replaceChild(a,
b);break;case "only":m.empty(b);b.appendChild(a);break;case "first":if(b.firstChild){h(a,b.firstChild);break}default:b.appendChild(a)}return a};var t=m.create=function(a,b,c,l){var h=e.doc;c&&(c=g.byId(c),h=c.ownerDocument);"string"==typeof a&&(a=h.createElement(a));b&&d.set(a,b);c&&m.place(a,c,l);return a};m.empty=function(a){c(g.byId(a))};var w=m.destroy=function(a){if(a=g.byId(a)){var b=a;a=a.parentNode;b.firstChild&&c(b);a&&(k("ie")&&a.canHaveChildren&&"removeNode"in b?b.removeNode(!1):a.removeChild(b))}}})},
"dojo/dom-class":function(){define(["./_base/lang","./_base/array","./dom"],function(m,f,k){function e(b){if("string"==typeof b||b instanceof String){if(b&&!d.test(b))return h[0]=b,h;b=b.split(d);b.length&&!b[0]&&b.shift();b.length&&!b[b.length-1]&&b.pop();return b}return b?f.filter(b,function(a){return a}):[]}var g,d=/\s+/,h=[""],c={};return g={contains:function(b,a){return 0<=(" "+k.byId(b).className+" ").indexOf(" "+a+" ")},add:function(b,a){b=k.byId(b);a=e(a);var c=b.className,d,c=c?" "+c+" ":
" ";d=c.length;for(var h=0,g=a.length,r;h<g;++h)(r=a[h])&&0>c.indexOf(" "+r+" ")&&(c+=r+" ");d<c.length&&(b.className=c.substr(1,c.length-2))},remove:function(b,a){b=k.byId(b);var c;if(void 0!==a){a=e(a);c=" "+b.className+" ";for(var d=0,h=a.length;d<h;++d)c=c.replace(" "+a[d]+" "," ");c=m.trim(c)}else c="";b.className!=c&&(b.className=c)},replace:function(b,a,l){b=k.byId(b);c.className=b.className;g.remove(c,l);g.add(c,a);b.className!==c.className&&(b.className=c.className)},toggle:function(b,a,
c){b=k.byId(b);if(void 0===c){a=e(a);for(var l=0,d=a.length,h;l<d;++l)h=a[l],g[g.contains(b,h)?"remove":"add"](b,h)}else g[c?"add":"remove"](b,a);return c}}})},"dojo/_base/array":function(){define(["./kernel","../has","./lang"],function(m,f,k){function e(a){return h[a]=new Function("item","index","array",a)}function g(a){var b=!a;return function(c,l,d){var g=0,n=c&&c.length||0,p;n&&"string"==typeof c&&(c=c.split(""));"string"==typeof l&&(l=h[l]||e(l));if(d)for(;g<n;++g){if(p=!l.call(d,c[g],g,c),a^
p)return!p}else for(;g<n;++g)if(p=!l(c[g],g,c),a^p)return!p;return b}}function d(a){var l=1,d=0,e=0;a||(l=d=e=-1);return function(h,g,n,p){if(p&&0<l)return b.lastIndexOf(h,g,n);p=h&&h.length||0;var q=a?p+e:d;n===c?n=a?d:p+e:0>n?(n=p+n,0>n&&(n=d)):n=n>=p?p+e:n;for(p&&"string"==typeof h&&(h=h.split(""));n!=q;n+=l)if(h[n]==g)return n;return-1}}var h={},c,b={every:g(!1),some:g(!0),indexOf:d(!0),lastIndexOf:d(!1),forEach:function(a,b,c){var l=0,d=a&&a.length||0;d&&"string"==typeof a&&(a=a.split(""));"string"==
typeof b&&(b=h[b]||e(b));if(c)for(;l<d;++l)b.call(c,a[l],l,a);else for(;l<d;++l)b(a[l],l,a)},map:function(a,b,c,d){var l=0,g=a&&a.length||0;d=new (d||Array)(g);g&&"string"==typeof a&&(a=a.split(""));"string"==typeof b&&(b=h[b]||e(b));if(c)for(;l<g;++l)d[l]=b.call(c,a[l],l,a);else for(;l<g;++l)d[l]=b(a[l],l,a);return d},filter:function(a,b,c){var l=0,d=a&&a.length||0,g=[],n;d&&"string"==typeof a&&(a=a.split(""));"string"==typeof b&&(b=h[b]||e(b));if(c)for(;l<d;++l)n=a[l],b.call(c,n,l,a)&&g.push(n);
else for(;l<d;++l)n=a[l],b(n,l,a)&&g.push(n);return g},clearCache:function(){h={}}};k.mixin(m,b);return b})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(m,f,k){f=f.NodeList;var e=f.prototype;e.connect=f._adaptAsForEach(function(){return m.connect.apply(this,arguments)});e.coords=f._adaptAsMap(m.coords);f.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");
k.forEach(f.events,function(g){var d="on"+g;e[d]=function(e,c){return this.connect(d,e,c)}});return m.NodeList=f})},"dojo/query":function(){define("./_base/kernel ./has ./dom ./on ./_base/array ./_base/lang ./selector/_loader ./selector/_loader!default".split(" "),function(m,f,k,e,g,d,h,c){function b(a,b){var c=function(c,l){if("string"==typeof l&&(l=k.byId(l),!l))return new b([]);c="string"==typeof c?a(c,l):c?c.end&&c.on?c:[c]:[];return c.end&&c.on?c:new b(c)};c.matches=a.match||function(a,b,l){return 0<
c.filter([a],b,l).length};c.filter=a.filter||function(a,b,l){return c(b,l).filter(function(b){return-1<g.indexOf(a,b)})};if("function"!=typeof a){var l=a.search;a=function(a,b){return l(b||document,a)}}return c}var a=Array.prototype,l=a.slice,n=a.concat,p=g.forEach,q=function(a,b,c){b=[0].concat(l.call(b,0));c=c||m.global;return function(l){b[0]=l;return a.apply(c,b)}},r=function(a){var b=this instanceof t&&1;"number"==typeof a&&(a=Array(a));var c=a&&"length"in a?a:arguments;if(b||!c.sort){for(var l=
b?this:[],e=l.length=c.length,h=0;h<e;h++)l[h]=c[h];if(b)return l;c=l}d._mixin(c,w);c._NodeListCtor=function(a){return t(a)};return c},t=r,w=t.prototype=[];t._wrap=w._wrap=function(a,b,c){a=new (c||this._NodeListCtor||t)(a);return b?a._stash(b):a};t._adaptAsMap=function(a,b){return function(){return this.map(q(a,arguments,b))}};t._adaptAsForEach=function(a,b){return function(){this.forEach(q(a,arguments,b));return this}};t._adaptAsFilter=function(a,b){return function(){return this.filter(q(a,arguments,
b))}};t._adaptWithCondition=function(a,b,c){return function(){var l=arguments,d=q(a,l,c);if(b.call(c||m.global,l))return this.map(d);this.forEach(d);return this}};p(["slice","splice"],function(b){var c=a[b];w[b]=function(){return this._wrap(c.apply(this,arguments),"slice"==b?this:null)}});p(["indexOf","lastIndexOf","every","some"],function(a){var b=g[a];w[a]=function(){return b.apply(m,[this].concat(l.call(arguments,0)))}});d.extend(r,{constructor:t,_NodeListCtor:t,toString:function(){return this.join(",")},
_stash:function(a){this._parent=a;return this},on:function(a,b){var c=this.map(function(c){return e(c,a,b)});c.remove=function(){for(var a=0;a<c.length;a++)c[a].remove()};return c},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},concat:function(a){var b=l.call(this,0),c=g.map(arguments,function(a){return l.call(a,0)});return this._wrap(n.apply(b,c),this)},map:function(a,b){return this._wrap(g.map(this,a,b),this)},forEach:function(a,b){p(this,a,b);return this},filter:function(a){var b=
arguments,c=this,l=0;if("string"==typeof a){c=u._filterResult(this,b[0]);if(1==b.length)return c._stash(this);l=1}return this._wrap(g.filter(c,b[l],b[l+1]),this)},instantiate:function(a,b){var c=d.isFunction(a)?a:d.getObject(a);b=b||{};return this.forEach(function(a){new c(b,a)})},at:function(){var a=new this._NodeListCtor(0);p(arguments,function(b){0>b&&(b=this.length+b);this[b]&&a.push(this[b])},this);return a._stash(this)}});var u=b(c,r);m.query=b(c,function(a){return r(a)});u.load=function(a,
c,l){h.load(a,c,function(a){l(b(a,r))})};m._filterQueryResult=u._filterResult=function(a,b,c){return new r(u.filter(a,b,c))};m.NodeList=u.NodeList=r;return u})},"dojo/selector/_loader":function(){define(["../has","require"],function(m,f){"undefined"!==typeof document&&document.createElement("div");var k;return{load:function(e,g,d,h){if(h&&h.isBuild)d();else{h=f;e="default"==e?m("config-selectorEngine")||"css3":e;e="css2"==e||"lite"==e?"./lite":"css2.1"==e?"./lite":"css3"==e?"./lite":"acme"==e?"./acme":
(h=g)&&e;if("?"==e.charAt(e.length-1)){e=e.substring(0,e.length-1);var c=!0}if(c&&(m("dom-compliant-qsa")||k))return d(k);h([e],function(b){"./lite"!=e&&(k=b);d(b)})}}}})},"dojo/selector/acme":function(){define(["../dom","../sniff","../_base/array","../_base/lang","../_base/window"],function(m,f,k,e,g){var d=e.trim,h=k.forEach,c="BackCompat"==g.doc.compatMode,b=!1,a=function(){return!0},l=function(a){a=0<="\x3e~+".indexOf(a.slice(-1))?a+" * ":a+" ";for(var c=function(b,c){return d(a.slice(b,c))},
l=[],e=-1,h=-1,g=-1,n=-1,p=-1,v=-1,q=-1,k,z="",u="",y,r=0,t=a.length,w=null,x=null,f=function(){0<=v&&(w.id=c(v,r).replace(/\\/g,""),v=-1);if(0<=q){var a=q==r?null:c(q,r);w[0>"\x3e~+".indexOf(a)?"tag":"oper"]=a;q=-1}0<=p&&(w.classes.push(c(p+1,r).replace(/\\/g,"")),p=-1)};z=u,u=a.charAt(r),r<t;r++)"\\"!=z&&(w||(y=r,w={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return b?this.otag:this.tag}},q=r),k?u==k&&(k=null):"'"==u||'"'==u?k=u:0<=e?"]"==u?(x.attr?x.matchFor=
c(g||e+1,r):x.attr=c(e+1,r),!(e=x.matchFor)||'"'!=e.charAt(0)&&"'"!=e.charAt(0)||(x.matchFor=e.slice(1,-1)),x.matchFor&&(x.matchFor=x.matchFor.replace(/\\/g,"")),w.attrs.push(x),x=null,e=g=-1):"\x3d"==u&&(g=0<="|~^$*".indexOf(z)?z:"",x.type=g+u,x.attr=c(e+1,r-g.length),g=r+1):0<=h?")"==u&&(0<=n&&(x.value=c(h+1,r)),n=h=-1):"#"==u?(f(),v=r+1):"."==u?(f(),p=r):":"==u?(f(),n=r):"["==u?(f(),e=r,x={}):"("==u?(0<=n&&(x={name:c(n+1,r),value:null},w.pseudos.push(x)),h=r):" "==u&&z!=u&&(f(),0<=n&&w.pseudos.push({name:c(n+
1,r)}),w.loops=w.pseudos.length||w.attrs.length||w.classes.length,w.oquery=w.query=c(y,r),w.otag=w.tag=w.oper?null:w.tag||"*",w.tag&&(w.tag=w.tag.toUpperCase()),l.length&&l[l.length-1].oper&&(w.infixOper=l.pop(),w.query=w.infixOper.query+" "+w.query),l.push(w),w=null));return l},n=function(a,b){return a?b?function(){return a.apply(window,arguments)&&b.apply(window,arguments)}:a:b},p=function(a,b){b=b||[];a&&b.push(a);return b},q=function(a){return 1==a.nodeType},r=function(a,c){return a?"class"==
c?a.className||"":"for"==c?a.htmlFor||"":"style"==c?a.style.cssText||"":(b?a.getAttribute(c):a.getAttribute(c,2))||"":""},t={"*\x3d":function(a,b){return function(c){return 0<=r(c,a).indexOf(b)}},"^\x3d":function(a,b){return function(c){return 0==r(c,a).indexOf(b)}},"$\x3d":function(a,b){return function(c){c=" "+r(c,a);var l=c.lastIndexOf(b);return-1<l&&l==c.length-b.length}},"~\x3d":function(a,b){var c=" "+b+" ";return function(b){return 0<=(" "+r(b,a)+" ").indexOf(c)}},"|\x3d":function(a,b){var c=
b+"-";return function(l){l=r(l,a);return l==b||0==l.indexOf(c)}},"\x3d":function(a,b){return function(c){return r(c,a)==b}}};e=g.doc.documentElement;var w=!(e.nextElementSibling||"nextElementSibling"in e),u=w?"nextSibling":"nextElementSibling",x=w?"previousSibling":"previousElementSibling",v=w?q:a,z=function(a){for(;a=a[x];)if(v(a))return!1;return!0},y=function(a){for(;a=a[u];)if(v(a))return!1;return!0},A=function(a){var b=a.parentNode,b=7!=b.nodeType?b:b.nextSibling,c=0,l=b.children||b.childNodes,
d=a._i||a.getAttribute("_i")||-1,e=b._l||("undefined"!==typeof b.getAttribute?b.getAttribute("_l"):-1);if(!l)return-1;l=l.length;if(e==l&&0<=d&&0<=e)return d;f("ie")&&"undefined"!==typeof b.setAttribute?b.setAttribute("_l",l):b._l=l;d=-1;for(b=b.firstElementChild||b.firstChild;b;b=b[u])v(b)&&(f("ie")?b.setAttribute("_i",++c):b._i=++c,a===b&&(d=c));return d},B=function(a){return!(A(a)%2)},C=function(a){return A(a)%2},E={checked:function(a,b){return function(a){return!("checked"in a?!a.checked:!a.selected)}},
disabled:function(a,b){return function(a){return a.disabled}},enabled:function(a,b){return function(a){return!a.disabled}},"first-child":function(){return z},"last-child":function(){return y},"only-child":function(a,b){return function(a){return z(a)&&y(a)}},empty:function(a,b){return function(a){var b=a.childNodes;for(a=a.childNodes.length-1;0<=a;a--){var c=b[a].nodeType;if(1===c||3==c)return!1}return!0}},contains:function(a,b){a=b.charAt(0);if('"'==a||"'"==a)b=b.slice(1,-1);return function(a){return 0<=
a.innerHTML.indexOf(b)}},not:function(a,b){a=l(b)[0];b={el:1};"*"!=a.tag&&(b.tag=1);a.classes.length||(b.classes=1);var c=F(a,b);return function(a){return!c(a)}},"nth-child":function(a,b){a=parseInt;if("odd"==b)return C;if("even"==b)return B;if(-1!=b.indexOf("n")){b=b.split("n",2);var c=b[0]?"-"==b[0]?-1:a(b[0]):1,l=b[1]?a(b[1]):0,d=0,e=-1;0<c?0>l?l=l%c&&c+l%c:0<l&&(l>=c&&(d=l-l%c),l%=c):0>c&&(c*=-1,0<l&&(e=l,l%=c));if(0<c)return function(a){a=A(a);return a>=d&&(0>e||a<=e)&&a%c==l};b=l}var h=a(b);
return function(a){return A(a)==h}}},D=9>f("ie")||(f("ie"),0)?function(a){var c=a.toLowerCase();"class"==c&&(a="className");return function(l){return b?l.getAttribute(a):l[a]||l[c]}}:function(a){return function(b){return b&&b.getAttribute&&b.hasAttribute(a)}},F=function(c,l){if(!c)return a;l=l||{};var d=null;"el"in l||(d=n(d,q));"tag"in l||"*"!=c.tag&&(d=n(d,function(a){return a&&(b?a.tagName:a.tagName.toUpperCase())==c.getTag()}));"classes"in l||h(c.classes,function(a,b,c){var l=new RegExp("(?:^|\\s)"+
a+"(?:\\s|$)");d=n(d,function(a){return l.test(a.className)});d.count=b});"pseudos"in l||h(c.pseudos,function(a){var b=a.name;E[b]&&(d=n(d,E[b](b,a.value)))});"attrs"in l||h(c.attrs,function(a){var b,c=a.attr;a.type&&t[a.type]?b=t[a.type](c,a.matchFor):c.length&&(b=D(c));b&&(d=n(d,b))});"id"in l||c.id&&(d=n(d,function(a){return!!a&&a.id==c.id}));d||"default"in l||(d=a);return d},M=function(a){return function(b,c,l){for(;b=b[u];)if(!w||q(b)){l&&!U(b,l)||!a(b)||c.push(b);break}return c}},N=function(a){return function(b,
c,l){for(b=b[u];b;){if(v(b)){if(l&&!U(b,l))break;a(b)&&c.push(b)}b=b[u]}return c}},I=function(b,c){var l=function(a){var b=[];try{b=Array.prototype.slice.call(a)}catch(Aa){for(var c=0,l=a.length;c<l;c++)b.push(a[c])}return b};b=b||a;return function(a,d,e){var h=0,g=[],g=l(a.children||a.childNodes);for(c&&k.forEach(g,function(a){1===a.nodeType&&(g=g.concat(l(a.getElementsByTagName("*"))))});a=g[h++];)v(a)&&(!e||U(a,e))&&b(a,h)&&d.push(a);return d}},G=function(a,b){for(a=a.parentNode;a&&a!=b;)a=a.parentNode;
return!!a},O={},J=function(b){var l=O[b.query];if(l)return l;var d=b.infixOper,d=d?d.oper:"",e=F(b,{el:1}),h="*"==b.tag,n=g.doc.getElementsByClassName;if(d)n={el:1},h&&(n.tag=1),e=F(b,n),"+"==d?l=M(e):"~"==d?l=N(e):"\x3e"==d&&(l=I(e));else if(b.id)e=!b.loops&&h?a:F(b,{el:1,id:1}),l=function(a,c){var l=m.byId(b.id,a.ownerDocument||a);a.ownerDocument&&!G(a,a.ownerDocument)&&k.some(11===a.nodeType?a.childNodes:[a],function(a){a=I(function(a){return a.id===b.id},!0)(a,[]);if(a.length)return l=a[0],!1});
if(l&&e(l)&&(9==a.nodeType||G(l,a)))return p(l,c)};else if(n&&/\{\s*\[native code\]\s*\}/.test(String(n))&&b.classes.length&&!c)var e=F(b,{el:1,classes:1,id:1}),v=b.classes.join(" "),l=function(a,b,c){b=p(0,b);for(var l,d=0,h=a.getElementsByClassName(v);l=h[d++];)e(l,a)&&U(l,c)&&b.push(l);return b};else h||b.loops?(e=F(b,{el:1,tag:1,id:1}),l=function(a,c,l){c=p(0,c);for(var d,h=0,g=(d=b.getTag())?a.getElementsByTagName(d):[];d=g[h++];)e(d,a)&&U(d,l)&&c.push(d);return c}):l=function(a,c,l){c=p(0,c);
for(var d=0,e=b.getTag(),e=e?a.getElementsByTagName(e):[];a=e[d++];)U(a,l)&&c.push(a);return c};return O[b.query]=l},Q={},H={},K=function(a){var b=l(d(a));if(1==b.length){var c=J(b[0]);return function(a){if(a=c(a,[]))a.nozip=!0;return a}}return function(a){a=p(a);for(var c,l,d=b.length,e,h,g=0;g<d;g++){h=[];c=b[g];l=a.length-1;0<l&&(e={},h.nozip=!0);l=J(c);for(var n=0;c=a[n];n++)l(c,h,e);if(!h.length)break;a=h}return h}},R=f("ie")?"commentStrip":"nozip",P=!!g.doc.querySelectorAll,L=/\\[>~+]|n\+\d|([^ \\])?([>~+])([^ =])?/g,
T=function(a,b,c,l){return c?(b?b+" ":"")+c+(l?" "+l:""):a},S=/([^[]*)([^\]]*])?/g,W=function(a,b,c){return b.replace(L,T)+(c||"")},Y=function(a,b){a=a.replace(S,W);if(P){var l=H[a];if(l&&!b)return l}if(l=Q[a])return l;var l=a.charAt(0),d=-1==a.indexOf(" ");0<=a.indexOf("#")&&d&&(b=!0);if(!P||b||-1!="\x3e~+".indexOf(l)||f("ie")&&-1!=a.indexOf(":")||c&&0<=a.indexOf(".")||-1!=a.indexOf(":contains")||-1!=a.indexOf(":checked")||-1!=a.indexOf("|\x3d")){var e=a.match(/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g);
return Q[a]=2>e.length?K(a):function(a){for(var b=0,c=[],l;l=e[b++];)c=c.concat(K(l)(a));return c}}var h=0<="\x3e~+".indexOf(a.charAt(a.length-1))?a+" *":a;return H[a]=function(b){if(9==b.nodeType||d)try{var c=b.querySelectorAll(h);c[R]=!0;return c}catch(sa){}return Y(a,!0)(b)}},X=0,aa=f("ie")?function(a){return b?a.getAttribute("_uid")||a.setAttribute("_uid",++X)||X:a.uniqueID}:function(a){return a._uid||(a._uid=++X)},U=function(a,b){if(!b)return 1;a=aa(a);return b[a]?0:b[a]=1},ha=function(a){if(a&&
a.nozip)return a;if(!a||!a.length)return[];if(2>a.length)return[a[0]];var c=[];X++;var l,d;if(f("ie")&&b){var e=X+"";for(l=0;l<a.length;l++)(d=a[l])&&d.getAttribute("_zipIdx")!=e&&(c.push(d),d.setAttribute("_zipIdx",e))}else if(f("ie")&&a.commentStrip)try{for(l=0;l<a.length;l++)(d=a[l])&&q(d)&&c.push(d)}catch(wa){}else for(l=0;l<a.length;l++)(d=a[l])&&d._zipIdx!=X&&(c.push(d),d._zipIdx=X);return c},Z=function(a,c){c=c||g.doc;b="div"===(c.ownerDocument||c).createElement("div").tagName;return(a=Y(a)(c))&&
a.nozip?a:ha(a)};Z.filter=function(a,b,c){for(var d=[],e=l(b),e=1!=e.length||/[^\w#\.]/.test(b)?function(a){return-1!=k.indexOf(Z(b,m.byId(c)),a)}:F(e[0]),h=0,g;g=a[h];h++)e(g)&&d.push(g);return d};return Z})},"dojo/NodeList-dom":function(){define("./_base/kernel ./query ./_base/array ./_base/lang ./dom-class ./dom-construct ./dom-geometry ./dom-attr ./dom-style".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a){return function(b,c,l){return 2==arguments.length?a["string"==typeof c?"get":"set"](b,
c):a.set(b,c,l)}}var l=function(a){return 1==a.length&&"string"==typeof a[0]},n=function(a){var b=a.parentNode;b&&b.removeChild(a)},p=f.NodeList,q=p._adaptWithCondition,r=p._adaptAsForEach,t=p._adaptAsMap;e.extend(p,{_normalize:function(a,b){var c=!0===a.parse;if("string"==typeof a.template){var l=a.templateFunc||m.string&&m.string.substitute;a=l?l(a.template,a):a}l=typeof a;"string"==l||"number"==l?(a=d.toDom(a,b&&b.ownerDocument),a=11==a.nodeType?e._toArray(a.childNodes):[a]):e.isArrayLike(a)?e.isArray(a)||
(a=e._toArray(a)):a=[a];c&&(a._runParse=!0);return a},_cloneNode:function(a){return a.cloneNode(!0)},_place:function(a,b,c,l){if(1==b.nodeType||"only"!=c)for(var e,h=a.length,g=h-1;0<=g;g--){var n=l?this._cloneNode(a[g]):a[g];if(a._runParse&&m.parser&&m.parser.parse)for(e||(e=b.ownerDocument.createElement("div")),e.appendChild(n),m.parser.parse(e),n=e.firstChild;e.firstChild;)e.removeChild(e.firstChild);g==h-1?d.place(n,b,c):b.parentNode.insertBefore(n,b);b=n}},position:t(h.position),attr:q(a(c),
l),style:q(a(b),l),addClass:r(g.add),removeClass:r(g.remove),toggleClass:r(g.toggle),replaceClass:r(g.replace),empty:r(d.empty),removeAttr:r(c.remove),marginBox:t(h.getMarginBox),place:function(a,b){var c=f(a)[0];return this.forEach(function(a){d.place(a,c,b)})},orphan:function(a){return(a?f._filterResult(this,a):this).forEach(n)},adopt:function(a,b){return f(a).place(this[0],b)._stash(this)},query:function(a){if(!a)return this;var b=new p;this.map(function(c){f(a,c).forEach(function(a){void 0!==
a&&b.push(a)})});return b._stash(this)},filter:function(a){var b=arguments,c=this,l=0;if("string"==typeof a){c=f._filterResult(this,b[0]);if(1==b.length)return c._stash(this);l=1}return this._wrap(k.filter(c,b[l],b[l+1]),this)},addContent:function(a,b){a=this._normalize(a,this[0]);for(var c=0,l;l=this[c];c++)a.length?this._place(a,l,b,0<c):d.empty(l);return this}});return p})},"dojo/_base/xhr":function(){define("./kernel ./sniff require ../io-query ../dom ../dom-form ./Deferred ./config ./json ./lang ./array ../on ../aspect ../request/watch ../request/xhr ../request/util".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){m._xhrObj=r._create;var w=m.config;m.objectToQuery=e.objectToQuery;m.queryToObject=e.queryToObject;m.fieldToObject=d.fieldToObject;m.formToObject=d.toObject;m.formToQuery=d.toQuery;m.formToJson=d.toJson;m._blockAsync=!1;var u=m._contentHandlers=m.contentHandlers={text:function(a){return a.responseText},json:function(a){return b.fromJson(a.responseText||null)},"json-comment-filtered":function(a){c.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}\x26\x26\nUse djConfig.useCommentedJson\x3dtrue to turn off this message.");
a=a.responseText;var l=a.indexOf("/*"),d=a.lastIndexOf("*/");if(-1==l||-1==d)throw Error("JSON was not comment filtered");return b.fromJson(a.substring(l+2,d))},javascript:function(a){return m.eval(a.responseText)},xml:function(a){var b=a.responseXML;b&&!b.querySelectorAll&&(b=(new DOMParser).parseFromString(a.responseText,"application/xml"));if(f("ie")&&(!b||!b.documentElement)){var c=function(a){return"MSXML"+a+".DOMDocument"},c=["Microsoft.XMLDOM",c(6),c(4),c(3),c(2)];l.some(c,function(c){try{var l=
new ActiveXObject(c);l.async=!1;l.loadXML(a.responseText);b=l}catch(F){return!1}return!0})}return b},"json-comment-optional":function(a){return a.responseText&&/^[^{\[]*\/\*/.test(a.responseText)?u["json-comment-filtered"](a):u.json(a)}};u.arraybuffer=u.blob=u.document=function(a,b){return a.response};m._ioSetArgs=function(b,c,l,n){var p={args:b,url:b.url},v=null;if(b.form){var v=g.byId(b.form),q=v.getAttributeNode("action");p.url=p.url||(q?q.value:m.doc?m.doc.URL:null);v=d.toObject(v)}q={};v&&a.mixin(q,
v);b.content&&a.mixin(q,b.content);b.preventCache&&(q["dojo.preventCache"]=(new Date).valueOf());p.query=e.objectToQuery(q);p.handleAs=b.handleAs||"text";var k=new h(function(a){a.canceled=!0;c&&c(a);var b=a.ioArgs.error;b||(b=Error("request cancelled"),b.dojoType="cancel",a.ioArgs.error=b);return b});k.addCallback(l);var z=b.load;z&&a.isFunction(z)&&k.addCallback(function(a){return z.call(b,a,p)});var u=b.error;u&&a.isFunction(u)&&k.addErrback(function(a){return u.call(b,a,p)});var r=b.handle;r&&
a.isFunction(r)&&k.addBoth(function(a){return r.call(b,a,p)});k.addErrback(function(a){return n(a,k)});w.ioPublish&&m.publish&&!1!==p.args.ioPublish&&(k.addCallbacks(function(a){m.publish("/dojo/io/load",[k,a]);return a},function(a){m.publish("/dojo/io/error",[k,a]);return a}),k.addBoth(function(a){m.publish("/dojo/io/done",[k,a]);return a}));k.ioArgs=p;return k};var x=function(a){a=u[a.ioArgs.handleAs](a.ioArgs.xhr,a.ioArgs);return void 0===a?null:a},v=function(a,b){b.ioArgs.args.failOk||console.error(a);
return a},z=function(a){0>=y&&(y=0,w.ioPublish&&m.publish&&(!a||a&&!1!==a.ioArgs.args.ioPublish)&&m.publish("/dojo/io/stop"))},y=0;p.after(q,"_onAction",function(){--y});p.after(q,"_onInFlight",z);m._ioCancelAll=q.cancelAll;m._ioNotifyStart=function(a){w.ioPublish&&m.publish&&!1!==a.ioArgs.args.ioPublish&&(y||m.publish("/dojo/io/start"),y+=1,m.publish("/dojo/io/send",[a]))};m._ioWatch=function(b,c,l,d){b.ioArgs.options=b.ioArgs.args;a.mixin(b,{response:b.ioArgs,isValid:function(a){return c(b)},isReady:function(a){return l(b)},
handleResponse:function(a){return d(b)}});q(b);z(b)};m._ioAddQueryToUrl=function(a){a.query.length&&(a.url+=(-1==a.url.indexOf("?")?"?":"\x26")+a.query,a.query=null)};m.xhr=function(a,b,c){var l,d=m._ioSetArgs(b,function(a){l&&l.cancel()},x,v),e=d.ioArgs;"postData"in b?e.query=b.postData:"putData"in b?e.query=b.putData:"rawBody"in b?e.query=b.rawBody:(2<arguments.length&&!c||-1==="POST|PUT".indexOf(a.toUpperCase()))&&m._ioAddQueryToUrl(e);var h={method:a,handleAs:{arraybuffer:1,blob:1,document:1}[b.handleAs]?
b.handleAs:"text",responseType:b.responseType,timeout:b.timeout,withCredentials:b.withCredentials,ioArgs:e};"undefined"!==typeof b.headers&&(h.headers=b.headers);"undefined"!==typeof b.contentType&&(h.headers||(h.headers={}),h.headers["Content-Type"]=b.contentType);"undefined"!==typeof e.query&&(h.data=e.query);"undefined"!==typeof b.sync&&(h.sync=b.sync);m._ioNotifyStart(d);try{l=r(e.url,h,!0)}catch(N){return d.cancel(),d}d.ioArgs.xhr=l.response.xhr;l.then(function(){d.resolve(d)}).otherwise(function(a){e.error=
a;a.response&&(a.status=a.response.status,a.responseText=a.response.text,a.xhr=a.response.xhr);d.reject(a)});return d};m.xhrGet=function(a){return m.xhr("GET",a)};m.rawXhrPost=m.xhrPost=function(a){return m.xhr("POST",a,!0)};m.rawXhrPut=m.xhrPut=function(a){return m.xhr("PUT",a,!0)};m.xhrDelete=function(a){return m.xhr("DELETE",a)};m._isDocumentOk=function(a){return t.checkStatus(a.status)};m._getText=function(a){var b;m.xhrGet({url:a,sync:!0,load:function(a){b=a}});return b};a.mixin(m.xhr,{_xhrObj:m._xhrObj,
fieldToObject:d.fieldToObject,formToObject:d.toObject,objectToQuery:e.objectToQuery,formToQuery:d.toQuery,formToJson:d.toJson,queryToObject:e.queryToObject,contentHandlers:u,_ioSetArgs:m._ioSetArgs,_ioCancelAll:m._ioCancelAll,_ioNotifyStart:m._ioNotifyStart,_ioWatch:m._ioWatch,_ioAddQueryToUrl:m._ioAddQueryToUrl,_isDocumentOk:m._isDocumentOk,_getText:m._getText,get:m.xhrGet,post:m.xhrPost,put:m.xhrPut,del:m.xhrDelete});return m.xhr})},"dojo/io-query":function(){define(["./_base/lang"],function(m){var f=
{};return{objectToQuery:function(k){var e=encodeURIComponent,g=[],d;for(d in k){var h=k[d];if(h!=f[d]){var c=e(d)+"\x3d";if(m.isArray(h))for(var b=0,a=h.length;b<a;++b)g.push(c+e(h[b]));else g.push(c+e(h))}}return g.join("\x26")},queryToObject:function(k){var e=decodeURIComponent;k=k.split("\x26");for(var g={},d,h,c=0,b=k.length;c<b;++c)if(h=k[c],h.length){var a=h.indexOf("\x3d");0>a?(d=e(h),h=""):(d=e(h.slice(0,a)),h=e(h.slice(a+1)));"string"==typeof g[d]&&(g[d]=[g[d]]);m.isArray(g[d])?g[d].push(h):
g[d]=h}return g}}})},"dojo/dom-form":function(){define(["./_base/lang","./dom","./io-query","./json"],function(m,f,k,e){var g={fieldToObject:function(d){var e=null;if(d=f.byId(d)){var c=d.name,b=(d.type||"").toLowerCase();if(c&&b&&!d.disabled)if("radio"==b||"checkbox"==b)d.checked&&(e=d.value);else if(d.multiple)for(e=[],d=[d.firstChild];d.length;)for(c=d.pop();c;c=c.nextSibling)if(1==c.nodeType&&"option"==c.tagName.toLowerCase())c.selected&&e.push(c.value);else{c.nextSibling&&d.push(c.nextSibling);
c.firstChild&&d.push(c.firstChild);break}else e=d.value}return e},toObject:function(d){var e={};d=f.byId(d).elements;for(var c=0,b=d.length;c<b;++c){var a=d[c],l=a.name,n=(a.type||"").toLowerCase();if(l&&n&&0>"file|submit|image|reset|button".indexOf(n)&&!a.disabled){var p=e,q=l,a=g.fieldToObject(a);if(null!==a){var k=p[q];"string"==typeof k?p[q]=[k,a]:m.isArray(k)?k.push(a):p[q]=a}"image"==n&&(e[l+".x"]=e[l+".y"]=e[l].x=e[l].y=0)}}return e},toQuery:function(d){return k.objectToQuery(g.toObject(d))},
toJson:function(d,h){return e.stringify(g.toObject(d),null,h?4:0)}};return g})},"dojo/json":function(){define(["./has"],function(m){return JSON})},"dojo/_base/Deferred":function(){define("./kernel ../Deferred ../promise/Promise ../errors/CancelError ../has ./lang ../when".split(" "),function(m,f,k,e,g,d,h){var c=function(){},b=Object.freeze||function(){},a=m.Deferred=function(l){function h(a){if(r)throw Error("This deferred has already been resolved");q=a;r=!0;p()}function p(){for(var a;!a&&v;){var b=
v;v=v.next;if(a=b.progress==c)r=!1;var l=u?b.error:b.resolved;g("config-useDeferredInstrumentation")&&u&&f.instrumentRejected&&f.instrumentRejected(q,!!l);if(l)try{var e=l(q);e&&"function"===typeof e.then?e.then(d.hitch(b.deferred,"resolve"),d.hitch(b.deferred,"reject"),d.hitch(b.deferred,"progress")):(l=a&&void 0===e,a&&!l&&(u=e instanceof Error),b.deferred[l&&u?"reject":"resolve"](l?q:e))}catch(D){b.deferred.reject(D)}else u?b.deferred.reject(q):b.deferred.resolve(q)}}var q,r,t,w,u,x,v,z=this.promise=
new k;this.isResolved=z.isResolved=function(){return 0==w};this.isRejected=z.isRejected=function(){return 1==w};this.isFulfilled=z.isFulfilled=function(){return 0<=w};this.isCanceled=z.isCanceled=function(){return t};this.resolve=this.callback=function(a){this.fired=w=0;this.results=[a,null];h(a)};this.reject=this.errback=function(a){u=!0;this.fired=w=1;g("config-useDeferredInstrumentation")&&f.instrumentRejected&&f.instrumentRejected(a,!!v);h(a);this.results=[null,a]};this.progress=function(a){for(var b=
v;b;){var c=b.progress;c&&c(a);b=b.next}};this.addCallbacks=function(a,b){this.then(a,b,c);return this};z.then=this.then=function(b,l,d){var e=d==c?this:new a(z.cancel);b={resolved:b,error:l,progress:d,deferred:e};v?x=x.next=b:v=x=b;r&&p();return e.promise};var y=this;z.cancel=this.cancel=function(){if(!r){var a=l&&l(y);r||(a instanceof Error||(a=new e(a)),a.log=!1,y.reject(a))}t=!0};b(z)};d.extend(a,{addCallback:function(a){return this.addCallbacks(d.hitch.apply(m,arguments))},addErrback:function(a){return this.addCallbacks(null,
d.hitch.apply(m,arguments))},addBoth:function(a){var b=d.hitch.apply(m,arguments);return this.addCallbacks(b,b)},fired:-1});a.when=m.when=h;return a})},"dojo/Deferred":function(){define(["./has","./_base/lang","./errors/CancelError","./promise/Promise","./has!config-deferredInstrumentation?./promise/instrumentation"],function(m,f,k,e,g){var d=Object.freeze||function(){},h=function(a,b,d,e,h){m("config-deferredInstrumentation")&&2===b&&l.instrumentRejected&&0===a.length&&l.instrumentRejected(d,!1,
e,h);for(h=0;h<a.length;h++)c(a[h],b,d,e)},c=function(c,d,e,h){var g=c[d],n=c.deferred;if(g)try{var p=g(e);if(0===d)"undefined"!==typeof p&&a(n,d,p);else{if(p&&"function"===typeof p.then){c.cancel=p.cancel;p.then(b(n,1),b(n,2),b(n,0));return}a(n,1,p)}}catch(x){a(n,2,x)}else a(n,d,e);m("config-deferredInstrumentation")&&2===d&&l.instrumentRejected&&l.instrumentRejected(e,!!g,h,n.promise)},b=function(b,c){return function(l){a(b,c,l)}},a=function(a,b,c){if(!a.isCanceled())switch(b){case 0:a.progress(c);
break;case 1:a.resolve(c);break;case 2:a.reject(c)}},l=function(a){var b=this.promise=new e,g=this,n,t,w,u=!1,x=[];m("config-deferredInstrumentation")&&Error.captureStackTrace&&(Error.captureStackTrace(g,l),Error.captureStackTrace(b,l));this.isResolved=b.isResolved=function(){return 1===n};this.isRejected=b.isRejected=function(){return 2===n};this.isFulfilled=b.isFulfilled=function(){return!!n};this.isCanceled=b.isCanceled=function(){return u};this.progress=function(a,c){if(n){if(!0===c)throw Error("This deferred has already been fulfilled.");
return b}h(x,0,a,null,g);return b};this.resolve=function(a,c){if(n){if(!0===c)throw Error("This deferred has already been fulfilled.");return b}h(x,n=1,t=a,null,g);x=null;return b};var v=this.reject=function(a,c){if(n){if(!0===c)throw Error("This deferred has already been fulfilled.");return b}m("config-deferredInstrumentation")&&Error.captureStackTrace&&Error.captureStackTrace(w={},v);h(x,n=2,t=a,w,g);x=null;return b};this.then=b.then=function(a,d,e){var h=[e,a,d];h.cancel=b.cancel;h.deferred=new l(function(a){return h.cancel&&
h.cancel(a)});n&&!x?c(h,n,t,w):x.push(h);return h.deferred.promise};this.cancel=b.cancel=function(b,c){if(!n){a&&(c=a(b),b="undefined"===typeof c?b:c);u=!0;if(!n)return"undefined"===typeof b&&(b=new k),v(b),b;if(2===n&&t===b)return b}else if(!0===c)throw Error("This deferred has already been fulfilled.");};d(b)};l.prototype.toString=function(){return"[object Deferred]"};g&&g(l);return l})},"dojo/errors/CancelError":function(){define(["./create"],function(m){return m("CancelError",null,null,{dojoType:"cancel",
log:!1})})},"dojo/errors/create":function(){define(["../_base/lang"],function(m){return function(f,k,e,g){e=e||Error;var d=function(h){if(e===Error){Error.captureStackTrace&&Error.captureStackTrace(this,d);var c=Error.call(this,h),b;for(b in c)c.hasOwnProperty(b)&&(this[b]=c[b]);this.message=h;this.stack=c.stack}else e.apply(this,arguments);k&&k.apply(this,arguments)};d.prototype=m.delegate(e.prototype,g);d.prototype.name=f;return d.prototype.constructor=d}})},"dojo/promise/Promise":function(){define(["../_base/lang"],
function(m){function f(){throw new TypeError("abstract");}return m.extend(function(){},{then:function(k,e,g){f()},cancel:function(k,e){f()},isResolved:function(){f()},isRejected:function(){f()},isFulfilled:function(){f()},isCanceled:function(){f()},always:function(k){return this.then(k,k)},"catch":function(k){return this.then(null,k)},otherwise:function(k){return this.then(null,k)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})})},
"dojo/when":function(){define(["./Deferred","./promise/Promise"],function(m,f){return function(k,e,g,d){var h=k&&"function"===typeof k.then,c=h&&k instanceof f;if(!h)return 1<arguments.length?e?e(k):k:(new m).resolve(k);c||(h=new m(k.cancel),k.then(h.resolve,h.reject,h.progress),k=h.promise);return e||g||d?k.then(e,g,d):k}})},"dojo/_base/json":function(){define(["./kernel","../json"],function(m,f){m.fromJson=function(k){return eval("("+k+")")};m._escapeString=f.stringify;m.toJsonIndentStr="\t";m.toJson=
function(k,e){return f.stringify(k,function(e,d){return d&&(e=d.__json__||d.json,"function"==typeof e)?e.call(d):d},e&&m.toJsonIndentStr)};return m})},"dojo/request/watch":function(){define("./util ../errors/RequestTimeoutError ../errors/CancelError ../_base/array ../has!host-browser?../_base/window: ../has!host-browser?dom-addeventlistener?:../on:".split(" "),function(m,f,k,e,g,d){function h(){for(var l=+new Date,d=0,e;d<a.length&&(e=a[d]);d++){var h=e.response,g=h.options;e.isCanceled&&e.isCanceled()||
e.isValid&&!e.isValid(h)?(a.splice(d--,1),c._onAction&&c._onAction()):e.isReady&&e.isReady(h)?(a.splice(d--,1),e.handleResponse(h),c._onAction&&c._onAction()):e.startTime&&e.startTime+(g.timeout||0)<l&&(a.splice(d--,1),e.cancel(new f("Timeout exceeded",h)),c._onAction&&c._onAction())}c._onInFlight&&c._onInFlight(e);a.length||(clearInterval(b),b=null)}function c(c){c.response.options.timeout&&(c.startTime=+new Date);c.isFulfilled()||(a.push(c),b||(b=setInterval(h,50)),c.response.options.sync&&h())}
var b=null,a=[];c.cancelAll=function(){try{e.forEach(a,function(a){try{a.cancel(new k("All requests canceled."))}catch(n){}})}catch(l){}};g&&d&&g.doc.attachEvent&&d(g.global,"unload",function(){c.cancelAll()});return c})},"dojo/request/util":function(){define("exports ../errors/RequestError ../errors/CancelError ../Deferred ../io-query ../_base/array ../_base/lang ../promise/Promise ../has".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a){return n(a)}function l(a){return void 0!==a.data?a.data:
a.text}m.deepCopy=function(a,b){for(var c in b){var l=a[c],d=b[c];l!==d&&(l&&"object"===typeof l&&d&&"object"===typeof d?d instanceof Date?a[c]=new Date(d):m.deepCopy(l,d):a[c]=d)}return a};m.deepCreate=function(a,b){b=b||{};var c=h.delegate(a),l,d;for(l in a)(d=a[l])&&"object"===typeof d&&(c[l]=m.deepCreate(d,b[l]));return m.deepCopy(c,b)};var n=Object.freeze||function(a){return a};m.deferred=function(b,d,g,t,w,u){var p=new e(function(a){d&&d(p,b);return a&&(a instanceof f||a instanceof k)?a:new k("Request canceled",
b)});p.response=b;p.isValid=g;p.isReady=t;p.handleResponse=w;g=p.then(a).otherwise(function(a){a.response=b;throw a;});m.notify&&g.then(h.hitch(m.notify,"emit","load"),h.hitch(m.notify,"emit","error"));t=g.then(l);w=new c;for(var v in t)t.hasOwnProperty(v)&&(w[v]=t[v]);w.response=g;n(w);u&&p.then(function(a){u.call(p,a)},function(a){u.call(p,b,a)});p.promise=w;p.then=w.then;return p};m.addCommonMethods=function(a,b){d.forEach(b||["GET","POST","PUT","DELETE"],function(b){a[("DELETE"===b?"DEL":b).toLowerCase()]=
function(c,l){l=h.delegate(l||{});l.method=b;return a(c,l)}})};m.parseArgs=function(a,b,c){var l=b.data,d=b.query;!l||c||"object"!==typeof l||l instanceof ArrayBuffer||l instanceof Blob||(b.data=g.objectToQuery(l));d?("object"===typeof d&&(d=g.objectToQuery(d)),b.preventCache&&(d+=(d?"\x26":"")+"request.preventCache\x3d"+ +new Date)):b.preventCache&&(d="request.preventCache\x3d"+ +new Date);a&&d&&(a+=(~a.indexOf("?")?"\x26":"?")+d);return{url:a,options:b,getHeader:function(a){return null}}};m.checkStatus=
function(a){a=a||0;return 200<=a&&300>a||304===a||1223===a||!a}})},"dojo/errors/RequestError":function(){define(["./create"],function(m){return m("RequestError",function(f,k){this.response=k})})},"dojo/errors/RequestTimeoutError":function(){define(["./create","./RequestError"],function(m,f){return m("RequestTimeoutError",null,f,{dojoType:"timeout"})})},"dojo/request/xhr":function(){define(["../errors/RequestError","./watch","./handlers","./util","../has"],function(m,f,k,e,g){function d(a,b){var c=
a.xhr;a.status=a.xhr.status;try{a.text=c.responseText}catch(v){}"xml"===a.options.handleAs&&(a.data=c.responseXML);var l;if(b)this.reject(b);else{try{k(a)}catch(v){l=v}e.checkStatus(c.status)?l?this.reject(l):this.resolve(a):(b=l?new m("Unable to load "+a.url+" status: "+c.status+" and an error in handleAs: transformation of response",a):new m("Unable to load "+a.url+" status: "+c.status,a),this.reject(b))}}function h(a){return this.xhr.getResponseHeader(a)}function c(k,w,u){var t=w&&w.data&&w.data instanceof
FormData,v=e.parseArgs(k,e.deepCreate(r,w),t);k=v.url;w=v.options;var z=!w.data&&"POST"!==w.method&&"PUT"!==w.method;10>=g("ie")&&(k=k.split("#")[0]);var y,A=e.deferred(v,p,a,l,d,function(){y&&y()}),B=v.xhr=c._create();if(!B)return A.cancel(new m("XHR was not created")),u?A:A.promise;v.getHeader=h;n&&(y=n(B,A,v,w.uploadProgress));var C="undefined"===typeof w.data?null:w.data,E=!w.sync,D=w.method;try{B.open(D,k,E,w.user||q,w.password||q);w.withCredentials&&(B.withCredentials=w.withCredentials);w.handleAs in
b&&(B.responseType=b[w.handleAs]);var F=w.headers;k=t||z?!1:"application/x-www-form-urlencoded";if(F)for(var M in F)"content-type"===M.toLowerCase()?k=F[M]:F[M]&&B.setRequestHeader(M,F[M]);k&&!1!==k&&B.setRequestHeader("Content-Type",k);F&&"X-Requested-With"in F||B.setRequestHeader("X-Requested-With","XMLHttpRequest");e.notify&&e.notify.emit("send",v,A.promise.cancel);B.send(C)}catch(N){A.reject(N)}f(A);B=null;return u?A:A.promise}g.add("dojo-force-activex-xhr",function(){return 0});var b={blob:"blob",
document:"document",arraybuffer:"arraybuffer"},a,l,n,p;a=function(a){return!this.isFulfilled()};p=function(a,b){b.xhr.abort()};n=function(a,b,c,l){function d(a){b.handleResponse(c)}function e(a){a=new m("Unable to load "+c.url+" status: "+a.target.status,c);b.handleResponse(c,a)}function h(a,l){c.transferType=a;l.lengthComputable?(c.loaded=l.loaded,c.total=l.total,b.progress(c)):3===c.xhr.readyState&&(c.loaded="loaded"in l?l.loaded:l.position,b.progress(c))}function g(a){return h("download",a)}function n(a){return h("upload",
a)}a.addEventListener("load",d,!1);a.addEventListener("error",e,!1);a.addEventListener("progress",g,!1);l&&a.upload&&a.upload.addEventListener("progress",n,!1);return function(){a.removeEventListener("load",d,!1);a.removeEventListener("error",e,!1);a.removeEventListener("progress",g,!1);a.upload.removeEventListener("progress",n,!1);a=null}};var q,r={data:null,query:null,sync:!1,method:"GET"};c._create=function(){throw Error("XMLHTTP not available");};g("dojo-force-activex-xhr")||(c._create=function(){return new XMLHttpRequest});
e.addCommonMethods(c);return c})},"dojo/request/handlers":function(){define(["../json","../_base/kernel","../_base/array","../has","../has!dom?../selector/_loader"],function(m,f,k,e){function g(e){var c=d[e.options.handleAs];e.data=c?c(e):e.data||e.text;return e}k=function(d){return d.xhr.response};var d={javascript:function(d){return f.eval(d.text||"")},json:function(d){return m.parse(d.text||null)},xml:void 0,blob:k,arraybuffer:k,document:k};g.register=function(e,c){d[e]=c};return g})},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=k.mixin,l={},n=l._Line=function(a,b){this.start=a;this.end=b};n.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};var p=l.Animation=function(b){a(this,b);k.isArray(this.curve)&&(this.curve=new n(this.curve[0],this.curve[1]))};p.prototype=new e;k.extend(p,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var a=this._percent,b=this.easing;return b?b(a):a},_fire:function(a,b){b=b||[];if(this[a])if(f.debugAtAllCosts)this[a].apply(this,
b);else try{this[a].apply(this,b)}catch(z){console.error("exception in animation handler for:",a),console.error(z)}return this},play:function(a,b){this._delayTimer&&this._clearTimer();if(b)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);a=a||this.delay;b=k.hitch(this,"_play",b);if(0<a)return this._delayTimer=setTimeout(b,a),this;b();return this},_play:function(a){this._delayTimer&&this._clearTimer();
this._startTime=(new Date).valueOf();this._paused&&(this._startTime-=this.duration*this._percent);this._active=!0;this._paused=!1;a=this.curve.getValue(this._getStep());this._percent||(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[a]));this._fire("onPlay",[a]);this._cycle();return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);
return this},gotoPercent:function(a,b){this._stopTimer();this._active=this._paused=!0;this._percent=a;b&&this.play();return this},stop:function(a){this._delayTimer&&this._clearTimer();if(!this._timer)return this;this._stopTimer();a&&(this._percent=1);this._fire("onStop",[this.curve.getValue(this._getStep())]);this._active=this._paused=!1;return this},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var a=
(new Date).valueOf(),a=0===this.duration?1:(a-this._startTime)/this.duration;1<=a&&(a=1);this._percent=a;this.easing&&(a=this.easing(a));this._fire("onAnimate",[this.curve.getValue(a)]);1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},
_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var q=0,r=null,t={run:function(){}};k.extend(p,{_startTimer:function(){this._timer||(this._timer=d.after(t,"run",k.hitch(this,"_cycle"),!0),q++);r||(r=setInterval(k.hitch(t,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,q--);0>=q&&(clearInterval(r),r=null,q=0)}});var w=h("ie")?function(a){var c=a.style;c.width.length||"auto"!=b.get(a,"width")||(c.width="auto")}:function(){};
l._fade=function(e){e.node=c.byId(e.node);var h=a({properties:{}},e);e=h.properties.opacity={};e.start="start"in h?h.start:function(){return+b.get(h.node,"opacity")||0};e.end=h.end;e=l.animateProperty(h);d.after(e,"beforeBegin",k.partial(w,h.node),!0);return e};l.fadeIn=function(b){return l._fade(a({end:1},b))};l.fadeOut=function(b){return l._fade(a({end:0},b))};l._defaultEasing=function(a){return.5+Math.sin((a+1.5)*Math.PI)/2};var u=function(a){this._properties=a;for(var b in a){var c=a[b];c.start instanceof
g&&(c.tempColor=new g)}};u.prototype.getValue=function(a){var b={},c;for(c in this._properties){var l=this._properties[c],d=l.start;d instanceof g?b[c]=g.blendColors(d,l.end,a,l.tempColor).toCss():k.isArray(d)||(b[c]=(l.end-d)*a+d+("opacity"!=c?l.units||"px":0))}return b};l.animateProperty=function(l){var e=l.node=c.byId(l.node);l.easing||(l.easing=m._defaultEasing);l=new p(l);d.after(l,"beforeBegin",k.hitch(l,function(){var c={},l;for(l in this.properties){var d=function(a,c){var l={height:a.offsetHeight,
width:a.offsetWidth}[c];if(void 0!==l)return l;l=b.get(a,c);return"opacity"==c?+l:n?l:parseFloat(l)};if("width"==l||"height"==l)this.node.display="block";var h=this.properties[l];k.isFunction(h)&&(h=h(e));h=c[l]=a({},k.isObject(h)?h:{end:h});k.isFunction(h.start)&&(h.start=h.start(e));k.isFunction(h.end)&&(h.end=h.end(e));var n=0<=l.toLowerCase().indexOf("color");"end"in h?"start"in h||(h.start=d(e,l)):h.end=d(e,l);n?(h.start=new g(h.start),h.end=new g(h.end)):h.start="opacity"==l?+h.start:parseFloat(h.start)}this.curve=
new u(c)}),!0);d.after(l,"onAnimate",k.hitch(b,"set",l.node),!0);return l};l.anim=function(a,b,c,d,e,h){return l.animateProperty({node:a,duration:c||p.prototype.duration,properties:b,easing:d,onEnd:e}).play(h||0)};a(m,l);m._Animation=p;return l})},"dojo/_base/Color":function(){define(["./kernel","./lang","./array","./config"],function(m,f,k,e){var g=m.Color=function(d){d&&this.setColor(d)};g.named={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,
0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],transparent:e.transparentColor||[0,0,0,0]};f.extend(g,{r:255,g:255,b:255,a:1,_set:function(d,e,c,b){this.r=d;this.g=e;this.b=c;this.a=b},setColor:function(d){f.isString(d)?g.fromString(d,this):f.isArray(d)?g.fromArray(d,this):(this._set(d.r,d.g,d.b,d.a),d instanceof g||this.sanitize());return this},sanitize:function(){return this},
toRgb:function(){return[this.r,this.g,this.b]},toRgba:function(){return[this.r,this.g,this.b,this.a]},toHex:function(){return"#"+k.map(["r","g","b"],function(d){d=this[d].toString(16);return 2>d.length?"0"+d:d},this).join("")},toCss:function(d){var e=this.r+", "+this.g+", "+this.b;return(d?"rgba("+e+", "+this.a:"rgb("+e)+")"},toString:function(){return this.toCss(!0)}});g.blendColors=m.blendColors=function(d,e,c,b){b=b||new g;b.r=Math.round(d.r+(e.r-d.r)*c);b.g=Math.round(d.g+(e.g-d.g)*c);b.b=Math.round(d.b+
(e.b-d.b)*c);b.a=d.a+(e.a-d.a)*c;return b.sanitize()};g.fromRgb=m.colorFromRgb=function(d,e){return(d=d.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/))&&g.fromArray(d[1].split(/\s*,\s*/),e)};g.fromHex=m.colorFromHex=function(d,e){var c=e||new g,b=4==d.length?4:8,a=(1<<b)-1;d=Number("0x"+d.substr(1));if(isNaN(d))return null;k.forEach(["b","g","r"],function(l){var e=d&a;d>>=b;c[l]=4==b?17*e:e});c.a=1;return c};g.fromArray=m.colorFromArray=function(d,e){e=e||new g;e._set(Number(d[0]),Number(d[1]),Number(d[2]),
Number(d[3]));isNaN(e.a)&&(e.a=1);return e.sanitize()};g.fromString=m.colorFromString=function(d,e){var c=g.named[d];return c&&g.fromArray(c,e)||g.fromRgb(d,e)||g.fromHex(d,e)};return g})},"webSceneViewer/Application":function(){define("require exports dojo/dom dojo/on dojo/dom-class dojo/dom-style dojo/dom-construct dojo/has dojo/_base/window ./widgets/Tooltip/Tooltip esri/kernel esri/config esri/core/Handles esri/core/watchUtils esri/core/requireUtils esri/core/promiseUtils esri/identity/IdentityManager esri/views/3d/layers/FeatureLayerView3D ./AppState ./View ./PortalExtended ./support/portalUtils ./support/ErrorMessage ./support/errorUtils ./support/hostnameCheck ./support/persistedSettingsUtils ./support/spatialReferenceUtils ./support/urlUtils ./support/Telemetry ./support/uiUtils ./support/AutoHideUI ./support/geowConfig esri/widgets/Attribution esri/widgets/Compass esri/widgets/Compass/CompassViewModel ./widgets/Crosshair/Crosshair ./widgets/Dialog/Dialog ./widgets/FPSView/FPSView ./widgets/Header/Header ./widgets/MapControls/MapControls ./widgets/MessageListWidget/MessageListWidget ./widgets/WelcomeWidget/WelcomeWidget dojo/i18n!webSceneViewer/nls/viewer".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O,J,Q,H,K,R,P,L,T,S,W){u.maximumFeatureCount=2E3;return function(){function u(){this.appState=new x;this.handles=new p;this.widgets={}}u.prototype.destroy=function(){this.handles.destroy();this.widgets.viewerTools.destroy()};u.prototype.initialize=function(){var a=this;c.add("strict-schema-validation",C.isDevEnvironment(window.location.hostname));if(C.isDevEnvironment(window.location.hostname))for(var l=0,e=window.location.search.substr(1).split("\x26");l<
e.length;l++){var h=e[l].split("\x3d");if(2===h.length&&"disableFeatures"===h[0])for(var g=0,h=h[1].split(",");g<h.length;g++)c.add("disable-feature:"+h[g],1)}F.cleanUrl();c("safari")&&d.set(b.body(),"position","fixed");this.initializeEsriConfig();this.initializeErrorsWidget();return this.initializePortal().then(function(b){a.appState.appVersion=a.getAppVersion(b);a.setAppVersionMetaTag(b);a.initializeGeometryService(b);a.initializeThumbnailUrls(b);return a.initializeView()})};u.prototype.initializeThumbnailUrls=
function(a){if(a&&a.staticImagesUrl){var b=a.getStaticImage("scene.png");a=a.getStaticImage("desktopapp.png");var c=document.createElement("style");c.textContent=".thumbScene { background-image: url("+b+"); }\n.thumbOther { background-image: url("+a+"); }";document.head.appendChild(c)}};u.prototype.initializeErrorsWidget=function(){var a=this;T.placeAt(k.byId("webscene-map"));this.appState.errors.on("error",function(b){a.appState.warningsToConsole&&"warning"===b.type?console.warn("[WARNING]",b.message+
":",b.title):T.show({message:b.titleHtml,details:b.messageHtml,type:b.type})})};u.prototype.initializeGeometryService=function(a){a&&a.helperServices&&a.helperServices.geometry?n.geometryServiceUrl=a.helperServices.geometry.url:a||(n.geometryServiceUrl="//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer");this.testGeometryService()};u.prototype.initializeUi=function(){var a=this;this.appState.device.isMobile&&g.add(b.body(),"esriIsMobile");this.appState.device.isPhoneSize&&g.add(b.body(),
"esriIsPhoneSize");"min"===this.appState.urlParameters.ui&&g.add(b.body(),"esriIsEmbedOrFullscreen");q.when(this.appState.view,"resizing",function(){return a.updateContainerMargins()});this.initializeWidgets();this.initializeNavigationModeSetting();q.init(this.appState.view,"inputManager.latestPointerType",function(b){return a.updateLatestPointerType(b)});return this.initializeViewerTools().then(function(){return a.initializeSlideDeckWidget()}).then(function(){a.initializeAutoHide()})};u.prototype.showMobileDialog=
function(a,b){var c='\x3ca class\x3d"link" target\x3d"_blank" href\x3d\'[LINK]\'\x3e'+W.messages.unsupportedMobileLearnMore+"\x3c/a\x3e",l=c.replace("[LINK]",y.defaultHelpUrl),d=new K({title:W.messages.unsupportedMobileTitle,content:W.messages.unsupportedMobile,details:l,draggable:!1,autoCenter:!0});d._dialog.resize();y.getPortalUrls("120001294").then(function(a){l=c.replace("[LINK]",a.helpUrl);d.set("details",l)});d.on("close",function(){b();a()})};u.prototype.checkMobile=function(){var a=this;return t.create(function(b){if(E.get(E.persistedMobileWarning)||
!a.appState.device.isMobile||c("disable-mobile-warning"))b();else{a.appState.initialDialogsOpened=!0;var d={SVVersion:a.appState.appVersion?a.appState.appVersion.versionString:a.getAppVersion(a.appState.portal).versionString,apiVersion:l.version,dateViewed:(new Date).toString()};a.showMobileDialog(b,function(){E.set(E.persistedMobileWarning,JSON.stringify(d));b()})}})};u.prototype.updateContainerMargins=function(){var a=this.widgets.attribution&&this.widgets.attribution.container,a=a?Number(d.get(a,
"height")):0;this.widgets.fullScreen&&d.set(this.widgets.fullScreen.container,"margin-bottom",a+"px");d.set(k.byId("slideDeckContainer"),"margin-bottom",this.appState.device.isPhoneSize&&"landscape"===this.appState.device.orientation?"0":a+"px")};u.prototype.initializeWidgets=function(){var a=this;this.initializeWelcomeWidget();this.checkMobile().then(this.showWelcomeWidget.bind(this)).then(function(){a.appState.initialDialogsOpened=!1;!a.widgets.welcomeWidget&&a.widgets.viewerTools&&a.widgets.viewerTools._initializeActiveMenuPane()});
this.initializeHeaderWidget();this.initializeFullScreenWidget();this.initializeAttributionWidget();this.initializeNavigationWidgets();this.initializeInternalWidgets()};u.prototype.initializeWelcomeWidget=function(){var a=this;this.appState.portal&&this.appState.urlParameters.noUrlParams&&!c("disable-welcome")&&(this.widgets.welcomeWidget=new S({appState:this.appState}),this.appState.device.isMobile||this.handles.add(e(this.widgets.welcomeWidget,"open-search-tool",function(){a.widgets.viewerTools&&
(a.widgets.viewerTools.locationEnabledOnOpen=!1,a.widgets.viewerTools.setActiveMenuPane(0,null))})))};u.prototype.showWelcomeWidget=function(){var a=this;return t.create(function(b){a.widgets.welcomeWidget?(a.appState.initialDialogsOpened=!0,a.widgets.welcomeWidget.getScenes().then(function(c){0<c.length?(a.widgets.welcomeWidget.show(),a.widgets.welcomeWidget.on("hide",function(){b()})):b()})):b()})};u.prototype.initializeHeaderWidget=function(){this.widgets.header=new P({appState:this.appState},
k.byId("webmap-header"));this.widgets.header.startup()};u.prototype.initializeAutoHide=function(){var a=k.byId("webscene-page"),b=[this.widgets.slideDeck.container,this.widgets.mapControls.container,this.widgets.compass.container,this.widgets.attribution.container];this.isMinUI()&&b.push(this.widgets.header.domNode.parentNode);N.isFullScreenEnabled&&b.push(this.widgets.fullScreen.container);this.widgets.autoHide=new I.default({appState:this.appState,elements:b,container:a,enabled:!c("disable-auto-hide-ui")});
this.isMinUI()&&this.widgets.autoHide.hide();c("ui-mode:fullscreen")&&this.becameFullscreen()};u.prototype.isMinUI=function(){return"min"===this.appState.urlParameters.ui||this.appState.device.isPhoneSize};u.prototype.initializeFullScreenWidget=function(){var b=this;if(N.isFullScreenEnabled){var c=h.create("div",{className:"fullScreenContainer"});h.create("div",{className:"fullscreen"},c);var l=new a({connectId:c,label:W.buttons.fullScreen,position:["before"],showDelay:0,duration:0,hideDelay:0,appState:this.appState});
l.startup();e(c,"click",function(){var a=k.byId("webscene-page");N.toggleFullScreen(a.parentNode)});N.onFullscreenChange(function(){return b.fullScreenChanged()});h.place(c,this.appState.view.container);this.widgets.fullScreen={container:c,tooltip:l}}};u.prototype.becameUnfullscreen=function(){this.isMinUI()?this.widgets.autoHide.hide():(this.widgets.autoHide.elements.remove(this.widgets.header.domNode.parentNode),this.widgets.header.maximize(),this.widgets.editor&&this.widgets.editor.isOpen()&&this.widgets.editor.show(),
g.remove(b.body(),"esriIsEmbedOrFullscreen"),this.widgets.viewerTools.refreshTools(),this.widgets.autoHide.show());this.widgets.fullScreen.tooltip.label=W.buttons.fullScreen;g.remove(this.widgets.fullScreen.container,"exit")};u.prototype.becameFullscreen=function(){this.widgets.autoHide.elements.add(this.widgets.header.domNode.parentNode);this.widgets.autoHide.hide();this.isMinUI()||(this.widgets.header.minimize(),g.add(b.body(),"esriIsEmbedOrFullscreen"));this.widgets.fullScreen.tooltip.label=W.buttons.exitFullScreen;
g.add(this.widgets.fullScreen.container,"exit")};u.prototype.fullScreenChanged=function(){N.fullscreenElement()?this.becameFullscreen():this.becameUnfullscreen()};u.prototype.initializeAttributionWidget=function(){var a=this,b=this.appState.view,c=h.create("div",{className:"attrContainer"});h.place(c,b.container);b=new O({view:b,container:h.create("div")});h.place(b.container,c);e(b,"click",function(){return a.updateContainerMargins()});this.widgets.attribution={container:c,widget:b}};u.prototype.initializeNavigationWidgets=
function(){this.initializeMapControlsWidget();this.initializeCompassWidget();this.widgets.crosshair=new H(this.appState.view)};u.prototype.initializeInternalWidgets=function(){this.widgets.fpsView=new R(this.appState.view)};u.prototype.initializeMapControlsWidget=function(){var a=new L(this.appState);this.widgets.mapControls={container:a._domNode,widget:a}};u.prototype.initializeCompassWidget=function(){var a=h.create("div",{className:"compass"});h.place(a,this.appState.view.container);var b=new J({container:h.create("div"),
viewModel:new Q({view:this.appState.view})});h.place(b.container,a);this.widgets.compass={container:a,widget:b}};u.prototype.initializeViewerTools=function(){var a=this;return this.appState.urlParameters.noView||this.isMinUI()?t.resolve():t.all([this.appState.view,r.when(m,["webSceneViewer/widgets/ViewerTools/ViewerTools","webSceneViewer/widgets/ViewerTools/ViewerToolsViewModel"])]).then(function(b){b=b[1];a.widgets.viewerTools=new b[0]({viewModel:new b[1]({appState:a.appState})},k.byId("viewerContainer"));
a.handles.add(e(a.widgets.viewerTools,"share-email",function(b){a.widgets.editor&&a.widgets.editor.goToshareEmail(b.mailUrl)}))})};u.prototype.initializeSlideDeckWidget=function(){var a=this;return this.appState.urlParameters.noView?t.resolve():r.when(m,"webSceneViewer/widgets/SlideDeck/SlideDeck").then(function(b){a.widgets.slideDeck=new b({appState:a.appState,class:"horizontalBar"},k.byId("slideDeckContainer"));a.updateContainerMargins()})};u.prototype.initializeEditor=function(){var a=this;if(!("noEdit"in
this.appState.urlParameters||this.isMinUI())){var b=function(){r.when(m,["webSceneViewer/editor/Editor"]).then(function(b){b=b[0];if(!a.widgets.editor){a.updateMovedWidgets(!0);var c=new b(a.appState,k.byId("editorContainer"));c.set("webScene",a.appState.view.map);a.appState.portal&&c.set("portal",a.appState.portal);a.widgets.editor=c;"landscape"!==a.appState.device.orientation||a.appState.urlParameters.webscene||(a.appState.initialDialogsOpened&&a.widgets.welcomeWidget?e(a.widgets.welcomeWidget,
"open-editor",function(){setTimeout(function(){c.show()},300)}):setTimeout(function(){c.show()},0))}})},c=this.appState.portal;this.isEditorAvailable()&&setTimeout(b,1E3);c&&(c.watch("user",function(){a.isEditorAvailable()&&setTimeout(b,1E3)}),w.on("credentials-destroy",function(){a.updateMovedWidgets(!1);a.widgets.editor.destroy();a.widgets.editor=void 0}))}};u.prototype.updateLatestPointerType=function(a){g.toggle(this.widgets.compass.container,"touch","touch"===a)};u.prototype.updateMovedWidgets=
function(a){var b=this.widgets.mapControls;b&&(a?b.widget.addStyleClass("moved"):b.widget.removeStyleClass("moved"));(b=this.widgets.compass)&&(a?g.add(b.container,"moved"):g.remove(b.container,"moved"))};u.prototype.isEditorAvailable=function(){var a=this.appState.portal;return this.appState.anonymousAuthoringEnabled?!0:!a||a.isSignedIn()&&a.userHasEditingPrivileges(this.appState.view.map)?!0:!1};u.prototype.initializeView=function(){var a=this;return v.createFromAppState(this.appState).then(function(b){a.appState.view=
b;a.appState.telemetry=new M(a.appState);window.view=b;b.handleInitialErrors();try{return a.initializeUi().catch(function(a){return console.error(a)})}catch(U){console.error(U)}}).then(function(){var b=a.appState.view;b.map.when(function(){a.initializeEditor();a.initializeDevtools()});return b.map}).catch(function(b){b=B.sceneCreateError(b);a.showSceneFailDialog(b).then(function(){return a.reloadNewEmptyScene()});return null})};u.prototype.initializeDevtools=function(){m(["./devtools/flyby"],function(){})};
u.prototype.showSceneFailDialog=function(a){var b=new K({title:a.title,content:a.message,draggable:!1,autoCenter:!0});return t.create(function(a){b.on("close",function(){return a()})})};u.prototype.reloadNewEmptyScene=function(){window.location.href=F.emptySceneUrl()};u.prototype.checkPortalSecurity=function(a){a.access&&"public"!==a.access&&a.signIn(!0);a.allSSL&&"https:"!==location.protocol&&(a=a.normalizeSSL(document.location.href),document.location.href!==a&&(document.location.href=a))};u.prototype.initializePortal=
function(){var a=this;if(!this.appState.urlParameters.portal&&!G.available)return t.resolve(null);var b=new z({url:n.portalUrl,isMobilePhone:this.appState.device.isPhoneSize});return b.load().then(function(){a.appState.portal=b;a.checkPortalSecurity(b);return b}).catch(function(c){G.available&&!G.isDebug||b._deleteCookieDebugOnly();b=new z({url:n.portalUrl,isMobilePhone:a.appState.device.isPhoneSize});return b.load().then(function(){a.appState.portal=b;a.checkPortalSecurity(b);return b})})};u.prototype.initializeNavigationModeSetting=
function(){var a=E.get("navigationMode");a&&q.whenOnce(this.appState.view,"inputManager",function(b){b.mode="pro"===a?"pro":"default"})};u.prototype.testGeometryService=function(){var a=this,b=this.appState.get("portal.defaultExtent.center")||void 0;D.testGeometryService(b).catch(function(b){b=B.isRequestError(b)&&403===b.details.httpStatus?new A.default(W.messages.geometryServiceUnauthorizedTitle,W.messages.geometryServiceUnauthorized,"warning"):new A.default(W.messages.geometryServiceUnavailableTitle,
W.messages.geometryServiceUnavailable,"warning");a.appState.errors.error(b)})};u.prototype.setAppVersionMetaTag=function(a){this.appState.appVersion=this.appState.appVersion?this.appState.appVersion:this.getAppVersion(a);a=h.create("meta",{name:"websceneviewer:version",content:this.appState.appVersion.versionString});b.doc.getElementsByTagName("head")[0].insertBefore(a,b.doc.getElementsByTagName("head")[0].firstChild)};u.prototype.getAppVersion=function(a){var b="6.3.0.0";a&&a.isPortal&&(b="10.6.1");
if(b){a=b.split("_");var c=a[0].split("."),b={major:c[0],minor:c[1],patch:c[2],flag:a[1],appName:"WebSceneViewer",versionString:b,uiString:"Web Scene Viewer "+c[0]+"."+c[1]};a="Web Scene Viewer "+b.major+"."+b.minor;b.flag&&(a+=" ("+b.flag+")");b.uiString=a;return b}return{major:void 0,minor:void 0,patch:void 0,flag:void 0,appName:"WebSceneViewer",versionString:void 0,uiString:"Web Scene Viewer "}};u.prototype.initializeEsriConfig=function(){"function"===typeof l._css&&(l._css=l._css());this.appState.urlParameters.portal?
n.portalUrl=this.appState.urlParameters.portal:G.available&&G.restBaseUrl&&(n.portalUrl=G.restBaseUrl.replace(/\/sharing\/rest\/?$/,""));G.available?(n.request.proxyUrl=G.proxyServer,n.request.httpsDomains=G.httpsDomains.slice()):n.request.proxyUrl="/proxy.php"};return u}()})},"webSceneViewer/widgets/Tooltip/Tooltip":function(){define(["esri/core/declare","dijit/Tooltip","dojo/dom-class"],function(m,f,k){m=m([f],{constructor:function(e){e&&e.appState&&e.appState.device.isMobile&&(e.connectId=[],e.label=
"")}});var e=f.show;m.hide=f.hide;f.show=function(g,d,h,c,b,a,l){!k.contains(d,"inactive")&&k.contains(d,"tab")||e.call(this,g,d,h,c,b);d.classList.contains("allowTooltipOnMobile")?k.add("dijit__MasterTooltip_0","mobileTooltipVisible"):k.remove("dijit__MasterTooltip_0","mobileTooltipVisible")};return m})},"esri/core/declare":function(){define(["require","exports","dojo/_base/declare"],function(m,f,k){function e(c,b){c&&!Array.isArray(c)&&"function"!==typeof c&&(b=c,c=null);c=c||[];b=b||{};return g([this].concat(c),
b)}function g(c,b){c&&!Array.isArray(c)&&"function"!==typeof c&&(b=c,c=null);"function"===typeof c?c=[c]:c||(c=[]);b=b||{};var a,l;a=0;for(l=d.length;a<l;a++)d[a](c,b);c=k(c,b);c.createSubclass=e;a=0;for(l=h.length;a<l;a++)h[a](c);return c}var d=[],h=[];(function(c){c.hasMixin=function(b,a){b=Array.isArray(b)?b.reduce(function(a,b){return b._meta?a.concat(b._meta.bases):a},[]):b._meta?b._meta.bases:b;if(!b)return!1;if("string"===typeof a)for(var c=b.length-1;0<=c;c--)if(b[c].prototype.declaredClass===
a)return!0;return-1!==b.indexOf(a)};c.safeMixin=function(b,a){return k.safeMixin(b,a)};c.before=function(b){d.push(b)};c.after=function(b){h.push(b)}})(g||(g={}));return g})},"dojo/_base/declare":function(){define(["./kernel","../has","./lang"],function(m,f,k){function e(a,b){throw Error("declare"+(b?" "+b:"")+": "+a);}function g(a,b){for(var c=[],l=[{cls:0,refs:[]}],d={},h=1,g=a.length,n=0,p,v,q,k,u;n<g;++n){(p=a[n])?"[object Function]"!=y.call(p)&&e("mixin #"+n+" is not a callable constructor.",
b):e("mixin #"+n+" is unknown. Did you use dojo.require to pull it in?",b);v=p._meta?p._meta.bases:[p];q=0;for(p=v.length-1;0<=p;--p)k=v[p].prototype,k.hasOwnProperty("declaredClass")||(k.declaredClass="uniqName_"+B++),k=k.declaredClass,d.hasOwnProperty(k)||(d[k]={count:0,refs:[],cls:v[p]},++h),k=d[k],q&&q!==k&&(k.refs.push(q),++q.count),q=k;++q.count;l[0].refs.push(q)}for(;l.length;){q=l.pop();c.push(q.cls);for(--h;u=q.refs,1==u.length;){q=u[0];if(!q||--q.count){q=0;break}c.push(q.cls);--h}if(q)for(n=
0,g=u.length;n<g;++n)q=u[n],--q.count||l.push(q)}h&&e("can't build consistent linearization",b);p=a[0];c[0]=p?p._meta&&p===c[c.length-p._meta.bases.length]?p._meta.bases.length:1:0;return c}function d(a,b,c,l){var d,h,g,n,p,v,q=this._inherited=this._inherited||{};"string"===typeof a&&(d=a,a=b,b=c,c=l);if("function"===typeof a)g=a,a=b,b=c;else try{g=a.callee}catch(K){if(K instanceof TypeError)e("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass);
else throw K;}(d=d||g.nom)||e("can't deduce a name to call inherited()",this.declaredClass);c=l=0;n=this.constructor._meta;l=n.bases;v=q.p;if("constructor"!=d){if(q.c!==g&&(v=0,p=l[0],n=p._meta,n.hidden[d]!==g)){(h=n.chains)&&"string"==typeof h[d]&&e("calling chained method with inherited: "+d,this.declaredClass);do if(n=p._meta,h=p.prototype,n&&(h[d]===g&&h.hasOwnProperty(d)||n.hidden[d]===g))break;while(p=l[++v]);v=p?v:-1}if(p=l[++v])if(h=p.prototype,p._meta&&h.hasOwnProperty(d))c=h[d];else{g=z[d];
do if(h=p.prototype,(c=h[d])&&(p._meta?h.hasOwnProperty(d):c!==g))break;while(p=l[++v])}c=p&&c||z[d]}else{if(q.c!==g&&(v=0,(n=l[0]._meta)&&n.ctor!==g)){for((h=n.chains)&&"manual"===h.constructor||e("calling chained constructor with inherited",this.declaredClass);(p=l[++v])&&(!(n=p._meta)||n.ctor!==g););v=p?v:-1}for(;(p=l[++v])&&!(c=(n=p._meta)?n.ctor:p););c=p&&c}q.c=c;q.p=v;if(c)return!0===b?c:c.apply(this,b||a)}function h(a,b,c){return"string"===typeof a?"function"===typeof b?this.__inherited(a,
b,c,!0):this.__inherited(a,b,!0):"function"===typeof a?this.__inherited(a,b,!0):this.__inherited(a,!0)}function c(a,b,c,l){var d=this.getInherited(a,b,c);if(d)return d.apply(this,l||c||b||a)}function b(a){for(var b=this.constructor._meta.bases,c=0,l=b.length;c<l;++c)if(b[c]===a)return!0;return this instanceof a}function a(a,b){for(var c in b)"constructor"!=c&&b.hasOwnProperty(c)&&(a[c]=b[c])}function l(a){x.safeMixin(this.prototype,a);return this}function n(a,b){a instanceof Array||"function"===typeof a||
(b=a,a=void 0);b=b||{};a=a||[];return x([this].concat(a),b)}function p(a,b){return function(){var c=arguments,l=c,d=c[0],e,h;h=a.length;var g;if(!(this instanceof c.callee))return u(c);if(b&&(d&&d.preamble||this.preamble))for(g=Array(a.length),g[0]=c,e=0;;){(d=c[0])&&(d=d.preamble)&&(c=d.apply(this,c)||c);d=a[e].prototype;(d=d.hasOwnProperty("preamble")&&d.preamble)&&(c=d.apply(this,c)||c);if(++e==h)break;g[e]=c}for(e=h-1;0<=e;--e)d=a[e],(d=(h=d._meta)?h.ctor:d)&&d.apply(this,g?g[e]:c);(d=this.postscript)&&
d.apply(this,l)}}function q(a,b){return function(){var c=arguments,l=c,d=c[0];if(!(this instanceof c.callee))return u(c);b&&(d&&(d=d.preamble)&&(l=d.apply(this,l)||l),(d=this.preamble)&&d.apply(this,l));a&&a.apply(this,c);(d=this.postscript)&&d.apply(this,c)}}function r(a){return function(){var b=arguments,c=0,l,d;if(!(this instanceof b.callee))return u(b);for(;l=a[c];++c)if(l=(d=l._meta)?d.ctor:l){l.apply(this,b);break}(l=this.postscript)&&l.apply(this,b)}}function t(a,b,c){return function(){var l,
d,e=0,h=1;c&&(e=b.length-1,h=-1);for(;l=b[e];e+=h)d=l._meta,(l=(d?d.hidden:l.prototype)[a])&&l.apply(this,arguments)}}function w(a){A.prototype=a.prototype;a=new A;A.prototype=null;return a}function u(a){var b=a.callee,c=w(b);b.apply(c,a);return c}function x(c,u,A){"string"!=typeof c&&(A=u,u=c,c="");A=A||{};var m,B,D,E,F,J,Q,H=1,K=u;"[object Array]"==y.call(u)?(J=g(u,c),D=J[0],H=J.length-D,u=J[H]):(J=[0],u?"[object Function]"==y.call(u)?(D=u._meta,J=J.concat(D?D.bases:u)):e("base class is not a callable constructor.",
c):null!==u&&e("unknown base class. Did you use dojo.require to pull it in?",c));if(u)for(B=H-1;;--B){m=w(u);if(!B)break;D=J[B];(D._meta?a:v)(m,D.prototype);E=f("csp-restrictions")?function(){}:new Function;E.superclass=u;E.prototype=m;u=m.constructor=E}else m={};x.safeMixin(m,A);D=A.constructor;D!==z.constructor&&(D.nom="constructor",m.constructor=D);for(B=H-1;B;--B)(D=J[B]._meta)&&D.chains&&(Q=v(Q||{},D.chains));m["-chains-"]&&(Q=v(Q||{},m["-chains-"]));u&&u.prototype&&u.prototype["-chains-"]&&
(Q=v(Q||{},u.prototype["-chains-"]));D=!Q||!Q.hasOwnProperty("constructor");J[0]=E=Q&&"manual"===Q.constructor?r(J):1==J.length?q(A.constructor,D):p(J,D);E._meta={bases:J,hidden:A,chains:Q,parents:K,ctor:A.constructor};E.superclass=u&&u.prototype;E.extend=l;E.createSubclass=n;E.prototype=m;m.constructor=E;m.getInherited=h;m.isInstanceOf=b;m.inherited=C;m.__inherited=d;c&&(m.declaredClass=c,k.setObject(c,E));if(Q)for(F in Q)m[F]&&"string"==typeof Q[F]&&"constructor"!=F&&(D=m[F]=t(F,J,"after"===Q[F]),
D.nom=F);return E}var v=k.mixin,z=Object.prototype,y=z.toString,A,B=0;A=f("csp-restrictions")?function(){}:new Function;var C=m.config.isDebug?c:d;m.safeMixin=x.safeMixin=function(a,b){var c,l;for(c in b)l=b[c],l===z[c]&&c in z||"constructor"==c||("[object Function]"==y.call(l)&&(l.nom=c),a[c]=l);return a};return m.declare=x})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){function x(){}var v=f("dijit._MasterTooltip",[q,r],{duration:n.defaultDuration,templateString:w,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new t(this.domNode);this.fadeIn=k.fadeIn({node:this.domNode,duration:this.duration,onEnd:c.hitch(this,"_onShow")});this.fadeOut=k.fadeOut({node:this.domNode,duration:this.duration,onEnd:c.hitch(this,"_onHide")})},show:function(a,b,l,d,e,g,n){if(!this.aroundNode||this.aroundNode!==
b||this.containerNode.innerHTML!=a)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=a;e&&this.set("textDir",e);this.containerNode.align=d?"right":"left";var v=p.around(this.domNode,b,l&&l.length?l:z.defaultPosition,!d,c.hitch(this,"orient")),q=v.aroundNodePos;"M"==v.corner.charAt(0)&&"M"==v.aroundCorner.charAt(0)?(this.connectorNode.style.top=q.y+(q.h-this.connectorNode.offsetHeight>>1)-v.y+"px",this.connectorNode.style.left=""):"M"==v.corner.charAt(1)&&
"M"==v.aroundCorner.charAt(1)?this.connectorNode.style.left=q.x+(q.w-this.connectorNode.offsetWidth>>1)-v.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");h.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=b;this.onMouseEnter=g||x;this.onMouseLeave=n||x}},orient:function(a,b,c,e,h){this.connectorNode.style.top="";var g=e.h;e=e.w;a.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[b+"-"+c];this.domNode.style.width="auto";var n=d.position(this.domNode);if(l("ie")||l("trident"))n.w+=2;d.setMarginBox(this.domNode,{w:Math.min(Math.max(e,1),n.w)});"B"==c.charAt(0)&&"B"==b.charAt(0)?(a=d.position(a),b=this.connectorNode.offsetHeight,
a.h>g?(this.connectorNode.style.top=g-(h.h+b>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(h.h/2-b/2,0),a.h-b)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,n.w-e)},_onShow:function(){l("ie")&&(this.domNode.style.filter="")},hide:function(a){this._onDeck&&this._onDeck[1]==a?this._onDeck=null:this.aroundNode===a&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=x},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});l("dojo-bidi")&&v.extend({_setAutoTextDir:function(a){this.applyTextDir(a);m.forEach(a.children,function(a){this._setAutoTextDir(a)},this)},_setTextDirAttr:function(a){this._set("textDir",a);"auto"==a?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});u.showTooltip=
function(a,b,c,l,d,e,h){c&&(c=m.map(c,function(a){return{after:"after-centered",before:"before-centered"}[a]||a}));z._masterTT||(u._masterTT=z._masterTT=new v);return z._masterTT.show(a,b,c,l,d,e,h)};u.hideTooltip=function(a){return z._masterTT&&z._masterTT.hide(a)};var z=f("dijit.Tooltip",q,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(l){m.forEach(this._connections||[],function(a){m.forEach(a,function(a){a.remove()})},this);this._connectIds=
m.filter(c.isArrayLike(l)?l:l?[l]:[],function(a){return e.byId(a,this.ownerDocument)},this);this._connections=m.map(this._connectIds,function(l){l=e.byId(l,this.ownerDocument);var d=this.selector,h=d?function(b){return a.selector(d,b)}:function(a){return a},g=this;return[a(l,h(b.enter),function(){g._onHover(this)}),a(l,h("focusin"),function(){g._onHover(this)}),a(l,h(b.leave),c.hitch(g,"_onUnHover")),a(l,h("focusout"),c.hitch(g,"set","state","DORMANT"))]},this);this._set("connectId",l)},addTarget:function(a){a=
a.id||a;-1==m.indexOf(this._connectIds,a)&&this.set("connectId",this._connectIds.concat(a))},removeTarget:function(a){a=m.indexOf(this._connectIds,a.id||a);0<=a&&(this._connectIds.splice(a,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);g.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var a=this.connectId;m.forEach(c.isArrayLike(a)?a:[a],this.addTarget,this)},getContent:function(a){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(a){if(!(this.state==a||"SHOW TIMER"==a&&"SHOWING"==this.state||"HIDE TIMER"==a&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(a){case "DORMANT":this._connectNode&&(z.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var b=this.getContent(this._connectNode);if(!b){this.set("state","DORMANT");return}z.show(b,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,c.hitch(this,"set","state","SHOWING"),c.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",a)}},_onHover:function(a){this._connectNode&&a!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=a;this.set("state","SHOW TIMER")},_onUnHover:function(a){this.set("state","HIDE TIMER")},open:function(a){this.set("state","DORMANT");this._connectNode=a;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");m.forEach(this._connections||[],function(a){m.forEach(a,function(a){a.remove()})},this);this.inherited(arguments)}});z._MasterTooltip=v;z.show=
u.showTooltip;z.hide=u.hideTooltip;z.defaultPosition=["after-centered","before-centered"];return z})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang","../registry","../main"],function(m,f,k,e,g){var d={};m.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(h){d[h]=e[h]});k.mixin(d,{defaultDuration:f.defaultDuration||200});k.mixin(g,d);return g})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window",
"./main"],function(m,f,k){var e={},g={},d={length:0,add:function(d){if(g[d.id])throw Error("Tried to register widget with id\x3d\x3d"+d.id+" but that id is already registered");g[d.id]=d;this.length++},remove:function(d){g[d]&&(delete g[d],this.length--)},byId:function(d){return"string"==typeof d?g[d]:d},byNode:function(d){return g[d.getAttribute("widgetId")]},toArray:function(){var d=[],c;for(c in g)d.push(g[c]);return d},getUniqueId:function(d){var c;do c=d+"_"+(d in e?++e[d]:e[d]=0);while(g[c]);
return"dijit"==k._scopeName?c:k._scopeName+"_"+c},findWidgets:function(d,c){function b(l){for(l=l.firstChild;l;l=l.nextSibling)if(1==l.nodeType){var d=l.getAttribute("widgetId");d?(d=g[d])&&a.push(d):l!==c&&b(l)}}var a=[];b(d);return a},_destroyAll:function(){k._curFocus=null;k._prevFocus=null;k._activeStack=[];m.forEach(d.findWidgets(f.body()),function(d){d._destroyed||(d.destroyRecursive?d.destroyRecursive():d.destroy&&d.destroy())})},getEnclosingWidget:function(d){for(;d;){var c=1==d.nodeType&&
d.getAttribute("widgetId");if(c)return g[c];d=d.parentNode}return null},_hash:g};return k.registry=d})},"dijit/main":function(){define(["dojo/_base/kernel"],function(m){return m.dijit})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(m,f,k,e,g,d,h){function c(a,b,c,e){var l=d.getEffectiveBox(a.ownerDocument);a.parentNode&&"body"==String(a.parentNode.tagName).toLowerCase()||g.body(a.ownerDocument).appendChild(a);
var h=null;m.some(b,function(b){var d=b.corner,g=b.pos,n=0,p={w:{L:l.l+l.w-g.x,R:g.x-l.l,M:l.w}[d.charAt(1)],h:{T:l.t+l.h-g.y,B:g.y-l.t,M:l.h}[d.charAt(0)]},q=a.style;q.left=q.right="auto";c&&(n=c(a,b.aroundCorner,d,p,e),n="undefined"==typeof n?0:n);var k=a.style,u=k.display,r=k.visibility;"none"==k.display&&(k.visibility="hidden",k.display="");q=f.position(a);k.display=u;k.visibility=r;u={L:g.x,R:g.x-q.w,M:Math.max(l.l,Math.min(l.l+l.w,g.x+(q.w>>1))-q.w)}[d.charAt(1)];r={T:g.y,B:g.y-q.h,M:Math.max(l.t,
Math.min(l.t+l.h,g.y+(q.h>>1))-q.h)}[d.charAt(0)];g=Math.max(l.l,u);k=Math.max(l.t,r);u=Math.min(l.l+l.w,u+q.w)-g;r=Math.min(l.t+l.h,r+q.h)-k;n+=q.w-u+(q.h-r);if(null==h||n<h.overflow)h={corner:d,aroundCorner:b.aroundCorner,x:g,y:k,w:u,h:r,overflow:n,spaceAvailable:p};return!n});h.overflow&&c&&c(a,h.aroundCorner,h.corner,h.spaceAvailable,e);b=h.y;var n=h.x,p=g.body(a.ownerDocument);/relative|absolute/.test(k.get(p,"position"))&&(b-=k.get(p,"marginTop"),n-=k.get(p,"marginLeft"));p=a.style;p.top=b+
"px";p.left=n+"px";p.right="auto";return h}var b={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return h.place={at:function(a,l,d,e,h){d=m.map(d,function(a){var c={corner:a,aroundCorner:b[a],pos:{x:l.x,y:l.y}};e&&(c.pos.x+="L"==a.charAt(1)?e.x:-e.x,c.pos.y+="T"==a.charAt(0)?e.y:-e.y);return c});return c(a,d,h)},around:function(a,b,d,h,g){function l(a,b){E.push({aroundCorner:a,corner:b,pos:{x:{L:y,R:y+B,M:y+(B>>1)}[a.charAt(1)],y:{T:A,B:A+C,M:A+(C>>1)}[a.charAt(0)]}})}var n;if("string"==typeof b||"offsetWidth"in
b||"ownerSVGElement"in b){if(n=f.position(b,!0),/^(above|below)/.test(d[0])){var p=f.getBorderExtents(b),q=b.firstChild?f.getBorderExtents(b.firstChild):{t:0,l:0,b:0,r:0},x=f.getBorderExtents(a),v=a.firstChild?f.getBorderExtents(a.firstChild):{t:0,l:0,b:0,r:0};n.y+=Math.min(p.t+q.t,x.t+v.t);n.h-=Math.min(p.t+q.t,x.t+v.t)+Math.min(p.b+q.b,x.b+v.b)}}else n=b;if(b.parentNode)for(p="absolute"==k.getComputedStyle(b).position,b=b.parentNode;b&&1==b.nodeType&&"BODY"!=b.nodeName;){q=f.position(b,!0);x=k.getComputedStyle(b);
/relative|absolute/.test(x.position)&&(p=!1);if(!p&&/hidden|auto|scroll/.test(x.overflow)){var v=Math.min(n.y+n.h,q.y+q.h),z=Math.min(n.x+n.w,q.x+q.w);n.x=Math.max(n.x,q.x);n.y=Math.max(n.y,q.y);n.h=v-n.y;n.w=z-n.x}"absolute"==x.position&&(p=!0);b=b.parentNode}var y=n.x,A=n.y,B="w"in n?n.w:n.w=n.width,C="h"in n?n.h:(e.deprecated("place.around: dijit/place.__Rectangle: { x:"+y+", y:"+A+", height:"+n.height+", width:"+B+" } has been deprecated.  Please use { x:"+y+", y:"+A+", h:"+n.height+", w:"+B+
" }","","2.0"),n.h=n.height),E=[];m.forEach(d,function(a){var b=h;switch(a){case "above-centered":l("TM","BM");break;case "below-centered":l("BM","TM");break;case "after-centered":b=!b;case "before-centered":l(b?"ML":"MR",b?"MR":"ML");break;case "after":b=!b;case "before":l(b?"TL":"TR",b?"TR":"TL");l(b?"BL":"BR",b?"BR":"BL");break;case "below-alt":b=!b;case "below":l(b?"BL":"BR",b?"TL":"TR");l(b?"BR":"BL",b?"TR":"TL");break;case "above-alt":b=!b;case "above":l(b?"TL":"TR",b?"BL":"BR");l(b?"TR":"TL",
b?"BR":"BL");break;default:l(a.aroundCorner,a.corner)}});a=c(a,E,g,{w:B,h:C});a.aroundNodePos=n;return a}}})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(m,f,k,e,g){var d=new m,h;k(function(){var c=g.getBox();d._rlh=f(window,"resize",function(){var a=g.getBox();if(c.h!=a.h||c.w!=a.w)c=a,d.emit("resize")});if(8==e("ie")){var b=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=b&&(b=screen.deviceXDPI,d.emit("resize"))},
500)}e("ios")&&(f(document,"focusin",function(a){h=a.target}),f(document,"focusout",function(a){h=null}))});d.getEffectiveBox=function(c){c=g.getBox(c);var b=h&&h.tagName&&h.tagName.toLowerCase();e("ios")&&h&&!h.readOnly&&("textarea"==b||"input"==b&&/^(color|email|number|password|search|tel|text|url)$/.test(h.type))&&(c.h*=0==orientation||180==orientation?.66:.4,b=h.getBoundingClientRect(),c.h=Math.max(c.h,b.top+b.height));return c};return d})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),
function(m,f,k,e,g,d,h){f.add("rtl-adjust-position-for-verticalScrollBar",function(b,a){b=k.body(a);a=h.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},b,"last");var c=h.create("div",{style:{overflow:"hidden",direction:"ltr"}},a,"last"),d=0!=g.position(c).x;a.removeChild(c);b.removeChild(a);return d});f.add("position-fixed-support",function(b,a){b=k.body(a);a=h.create("span",{style:{visibility:"hidden",
position:"fixed",left:"1px",top:"1px"}},b,"last");var c=h.create("span",{style:{position:"fixed",left:"0",top:"0"}},a,"last"),d=g.position(c).x!=g.position(a).x;a.removeChild(c);b.removeChild(a);return d});var c={getBox:function(b){b=b||k.doc;var a="BackCompat"==b.compatMode?k.body(b):b.documentElement,l=g.docScroll(b);if(f("touch")){var d=c.get(b);b=d.innerWidth||a.clientWidth;a=d.innerHeight||a.clientHeight}else b=a.clientWidth,a=a.clientHeight;return{l:l.x,t:l.y,w:b,h:a}},get:function(b){if(f("ie")&&
c!==document.parentWindow){b.parentWindow.execScript("document._parentWindow \x3d window;","Javascript");var a=b._parentWindow;b._parentWindow=null;return a}return b.parentWindow||b.defaultView},scrollIntoView:function(b,a){try{b=e.byId(b);var c=b.ownerDocument||k.doc,h=k.body(c),p=c.documentElement||h.parentNode,q=f("ie")||f("trident"),r=f("webkit");if(b!=h&&b!=p)if(!(f("mozilla")||q||r||f("opera")||f("trident")||f("edge"))&&"scrollIntoView"in b)b.scrollIntoView(!1);else{var t="BackCompat"==c.compatMode,
w=Math.min(h.clientWidth||p.clientWidth,p.clientWidth||h.clientWidth),u=Math.min(h.clientHeight||p.clientHeight,p.clientHeight||h.clientHeight),c=r||t?h:p,x=a||g.position(b),v=b.parentNode;a=function(a){return 6>=q||7==q&&t?!1:f("position-fixed-support")&&"fixed"==d.get(a,"position").toLowerCase()};var z=this,r=function(a,b,c){"BODY"==a.tagName||"HTML"==a.tagName?z.get(a.ownerDocument).scrollBy(b,c):(b&&(a.scrollLeft+=b),c&&(a.scrollTop+=c))};if(!a(b))for(;v;){v==h&&(v=c);var y=g.position(v),A=a(v),
m="rtl"==d.getComputedStyle(v).direction.toLowerCase();if(v==c)y.w=w,y.h=u,c==p&&(q||f("trident"))&&m&&(y.x+=c.offsetWidth-y.w),y.x=0,y.y=0;else{var C=g.getPadBorderExtents(v);y.w-=C.w;y.h-=C.h;y.x+=C.l;y.y+=C.t;var E=v.clientWidth,D=y.w-E;0<E&&0<D&&(m&&f("rtl-adjust-position-for-verticalScrollBar")&&(y.x+=D),y.w=E);E=v.clientHeight;D=y.h-E;0<E&&0<D&&(y.h=E)}A&&(0>y.y&&(y.h+=y.y,y.y=0),0>y.x&&(y.w+=y.x,y.x=0),y.y+y.h>u&&(y.h=u-y.y),y.x+y.w>w&&(y.w=w-y.x));var F=x.x-y.x,M=x.y-y.y,N=F+x.w-y.w,I=M+x.h-
y.h,G,O;0<N*F&&(v.scrollLeft||v==c||v.scrollWidth>v.offsetHeight)&&(G=Math[0>F?"max":"min"](F,N),m&&(8==q&&!t||5<=f("trident"))&&(G=-G),O=v.scrollLeft,r(v,G,0),G=v.scrollLeft-O,x.x-=G);0<I*M&&(v.scrollTop||v==c||v.scrollHeight>v.offsetHeight)&&(G=Math.ceil(Math[0>M?"max":"min"](M,I)),O=v.scrollTop,r(v,0,G),G=v.scrollTop-O,x.y-=G);v=v!=c&&!A&&v.parentNode}}}catch(J){console.error("scrollIntoView: "+J),b.scrollIntoView(!1)}}};m.setObject("dojo.window",c);return c})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(){}function r(a){return function(b,c,l,d){return b&&"string"==typeof c&&b[c]==q?b.on(c.substring(2).toLowerCase(),h.hitch(l,d)):a.apply(k,arguments)}}m.around(k,"connect",r);d.connect&&m.around(d,"connect",r);m=e("dijit._Widget",[l,n,p],{onClick:q,onDblClick:q,onKeyDown:q,onKeyPress:q,onKeyUp:q,onMouseDown:q,onMouseMove:q,onMouseOut:q,onMouseOver:q,onMouseLeave:q,onMouseEnter:q,onMouseUp:q,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
q&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===q?k.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){d.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){d.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?c("[widgetId]",this.containerNode).map(a.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});g("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});
return m})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){function B(a){return function(b){c[b?
"set":"remove"](this.domNode,a,b);this._set(a,b)}}p.add("dijit-legacy-requires",!q.isAsync);p.add("dojo-bidi",!1);p("dijit-legacy-requires")&&w(0,function(){m(["dijit/_base/manager"])});var C={};e=d("dijit._WidgetBase",[u,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:B("lang"),dir:"",_setDirAttr:B("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",
a)},attributeMap:{},_blankGif:e.blankGif||m.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},l;for(l in b.attributeMap)c.push(l);for(l in b)/^on/.test(l)&&(a[l.substring(2).toLowerCase()]=l),/^_set[A-Z](.*)Attr$/.test(l)&&(l=l.charAt(4).toLowerCase()+l.substr(5,l.length-9),b.attributeMap&&l in b.attributeMap||c.push(l))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();
this.srcNodeRef=h.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,r.mixin(this,a));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=v.body(this.ownerDocument);A.add(this);
this.buildRendering();var c;this.domNode&&(this._applyAttributes(),(a=this.srcNodeRef)&&a.parentNode&&this.domNode!==a&&(a.parentNode.replaceChild(this.domNode,a),c=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);f.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(f.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,f.forEach(this.getChildren(),function(a){a._started||a._destroyed||!r.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(b){b.destroyRecursive?b.destroyRecursive(a):b.destroy&&b.destroy(a)}this._beingDestroyed=!0;this.uninitialize();f.forEach(this._connects,r.hitch(this,"disconnect"));f.forEach(this._supportingWidgets,b);this.domNode&&f.forEach(A.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);A.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?c.remove(this.domNode,"widgetId"):a.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||a.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){f.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;r.isObject(a)?n.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,l,d){d=3<=
arguments.length?d:this.attributeMap[a];f.forEach(r.isArray(d)?d:[d],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":r.isFunction(l)&&(l=r.hitch(this,l));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;e.tagName?c.set(e,d,l):e.set(d,l);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(l));break;case "textContent":e.textContent=l;break;case "innerHTML":e.innerHTML=l;break;case "class":b.replace(e,
l,this[a]);break;case "toggleClass":b.toggle(e,d.className||a,l)}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var l=this[c.s];if(r.isFunction(l))var d=l.apply(this,Array.prototype.slice.call(arguments,1));else{var l=this.focusNode&&!r.isFunction(this.focusNode)?"focusNode":"domNode",e=this[l]&&this[l].tagName,h;if((h=e)&&!(h=C[e])){h=this[l];
var g={},n;for(n in h)g[n.toLowerCase()]=!0;h=C[e]=g}n=h;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:n&&c.l in n&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?l:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return d||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",
l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;!this._created||c===b||c!==c&&b!==b||(this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}}))},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var l,d=this["on"+a];d&&(l=d.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&t.emit(this.domNode,
a.toLowerCase(),b);return l},on:function(a,b){var c=this._onMap(a);return c?k.after(this,c,b,!0):this.own(t(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},l;for(l in b.prototype)/^on/.test(l)&&(c[l.replace(/^on/,"").toLowerCase()]=l)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):
[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(g.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(x.subscribe(a,r.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():l.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=n.get(this.domNode,"display")},placeAt:function(b,c){var l=
!b.tagName&&A.byId(b);!l||!l.addChild||c&&"number"!==typeof c?(b=l&&"domNode"in l?l.containerNode&&!/after|before|replace/.test(c||"")?l.containerNode:l.domNode:h.byId(b,this.ownerDocument),a.place(this.domNode,b,c),!this._started&&(this.getParent()||{})._started&&this.startup()):l.addChild(this,c);return this},defer:function(a,b){var c=setTimeout(r.hitch(this,function(){c&&(c=null,this._destroyed||r.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});p("dojo-bidi")&&
e.extend(y);return e})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(m,f,k,e){return m("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(e){var d=this._attrPairNames;return d[e]?d[e]:d[e]={s:"_"+e+"Setter",g:"_"+e+"Getter"}},postscript:function(e){e&&this.set(e)},_get:function(e,d){return"function"===typeof this[d.g]?this[d.g]():this[e]},get:function(e){return this._get(e,this._getAttrNames(e))},set:function(g,d){if("object"===
typeof g){for(var h in g)g.hasOwnProperty(h)&&"_watchCallbacks"!=h&&this.set(h,g[h]);return this}h=this._getAttrNames(g);var c=this._get(g,h);h=this[h.s];var b;"function"===typeof h?b=h.apply(this,Array.prototype.slice.call(arguments,1)):this[g]=d;if(this._watchCallbacks){var a=this;e(b,function(){a._watchCallbacks(g,c,d)})}return this},_changeAttrValue:function(e,d){var h=this.get(e);this[e]=d;this._watchCallbacks&&this._watchCallbacks(e,h,d);return this},watch:function(e,d){var h=this._watchCallbacks;
if(!h)var c=this,h=this._watchCallbacks=function(a,b,d,e){var l=function(l){if(l){l=l.slice();for(var e=0,h=l.length;e<h;e++)l[e].call(c,a,b,d)}};l(h["_"+a]);e||l(h["*"])};d||"function"!==typeof e?e="_"+e:(d=e,e="*");var b=h[e];"object"!==typeof b&&(b=h[e]=[]);b.push(d);e={};e.unwatch=e.remove=function(){var a=k.indexOf(b,d);-1<a&&b.splice(a,1)};return e}})})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(m,f,k){return k("dijit.Destroyable",
null,{destroy:function(e){this._destroyed=!0},own:function(){var e=["destroyRecursive","destroy","remove"];m.forEach(arguments,function(g){function d(){c.remove();m.forEach(b,function(a){a.remove()})}var h,c=f.before(this,"destroy",function(a){g[h](a)}),b=[];g.then?(h="cancel",g.then(d,d)):m.forEach(e,function(a){"function"===typeof g[a]&&(h||(h=a),b.push(f.after(g,a,d,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),
function(m,f,k,e,g,d){m=e("dijit._OnDijitClickMixin",null,{connect:function(e,c,b){return this.inherited(arguments,[e,"ondijitclick"==c?d:c,b])}});m.a11yclick=d;return m})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(m,f,k,e){function g(c){if((c.keyCode===m.ENTER||c.keyCode===m.SPACE)&&!/input|button|textarea/i.test(c.target.nodeName))for(c=c.target;c;c=c.parentNode)if(c.dojoClick)return!0}var d;k(document,"keydown",function(c){g(c)?(d=c.target,c.preventDefault()):
d=null});k(document,"keyup",function(c){g(c)&&c.target==d&&(d=null,k.emit(c.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,metaKey:c.metaKey,altKey:c.altKey,_origType:c.type}))});var h=function(c,b){c.dojoClick=!0;return k(c,"click",b)};h.click=h;h.press=function(c,b){var a=k(c,e.press,function(a){("mousedown"!=a.type||f.isLeft(a))&&b(a)}),l=k(c,"keydown",function(a){a.keyCode!==m.ENTER&&a.keyCode!==m.SPACE||b(a)});return{remove:function(){a.remove();l.remove()}}};
h.release=function(c,b){var a=k(c,e.release,function(a){("mouseup"!=a.type||f.isLeft(a))&&b(a)}),l=k(c,"keyup",function(a){a.keyCode!==m.ENTER&&a.keyCode!==m.SPACE||b(a)});return{remove:function(){a.remove();l.remove()}}};h.move=e.move;return h})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a,b,c){return r&&c?function(a,b){return d(a,c,b)}:w?function(c,l){var e=
d(c,b,function(a){l.call(this,a);D=(new Date).getTime()}),h=d(c,a,function(a){(!D||(new Date).getTime()>D+1E3)&&l.call(this,a)});return{remove:function(){e.remove();h.remove()}}}:function(b,c){return d(b,a,c)}}function n(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function p(b,l,h){if(!c.isRight(b)){var g=n(b.target);if(x=!b.target.disabled&&g&&g.dojoClick)if(z=(v="useTarget"==x)?g:b.target,v&&b.preventDefault(),y=b.changedTouches?b.changedTouches[0].pageX-a.global.pageXOffset:b.clientX,
A=b.changedTouches?b.changedTouches[0].pageY-a.global.pageYOffset:b.clientY,B=("object"==typeof x?x.x:"number"==typeof x?x:0)||4,C=("object"==typeof x?x.y:"number"==typeof x?x:0)||4,!u){b=function(b){a.doc.addEventListener(b,function(a){var c=a.target;x&&!a._dojo_click&&(new Date).getTime()<=E+1E3&&("INPUT"!=c.tagName||!e.contains(c,"dijitOffScreen"))&&(a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),"click"==b&&("INPUT"!=c.tagName||"radio"==c.type&&(e.contains(c,"dijitCheckBoxInput")||
e.contains(c,"mblRadioButton"))||"checkbox"==c.type&&(e.contains(c,"dijitCheckBoxInput")||e.contains(c,"mblCheckBox")))&&"TEXTAREA"!=c.tagName&&"AUDIO"!=c.tagName&&"VIDEO"!=c.tagName&&a.preventDefault())},!0)};var p=function(b){x=v?k.isDescendant(a.doc.elementFromPoint(b.changedTouches?b.changedTouches[0].pageX-a.global.pageXOffset:b.clientX,b.changedTouches?b.changedTouches[0].pageY-a.global.pageYOffset:b.clientY),z):x&&(b.changedTouches?b.changedTouches[0].target:b.target)==z&&Math.abs((b.changedTouches?
b.changedTouches[0].pageX-a.global.pageXOffset:b.clientX)-y)<=B&&Math.abs((b.changedTouches?b.changedTouches[0].pageY-a.global.pageYOffset:b.clientY)-A)<=C};u=!0;a.doc.addEventListener(l,function(a){c.isRight(a)||(p(a),v&&a.preventDefault())},!0);a.doc.addEventListener(h,function(a){if(!c.isRight(a)&&(p(a),x)){var b=function(b){var c=document.createEvent("MouseEvents");c._dojo_click=!0;c.initMouseEvent(b,!0,!0,a.view,a.detail,e.screenX,e.screenY,e.clientX,e.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,
0,null);return c};E=(new Date).getTime();var l=v?z:a.target;"LABEL"===l.tagName&&(l=k.byId(l.getAttribute("for"))||l);var e=a.changedTouches?a.changedTouches[0]:a,h=b("mousedown"),g=b("mouseup"),n=b("click");setTimeout(function(){d.emit(l,"mousedown",h);d.emit(l,"mouseup",g);d.emit(l,"click",n);E=(new Date).getTime()},0)}},!0);b("click");b("mousedown");b("mouseup")}}}var q=5>h("ios"),r=h("pointer-events")||0,t=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]="pointer"+
b;return a}(),w=h("touch-events"),u,x,v=!1,z,y,A,B,C,E,D,F;h("touch")&&(r?b(function(){a.doc.addEventListener(t.down,function(a){p(a,t.move,t.up)},!0)}):b(function(){function b(a){var b=g.delegate(a,{bubbles:!0});6<=h("ios")&&(b.touches=a.touches,b.altKey=a.altKey,b.changedTouches=a.changedTouches,b.ctrlKey=a.ctrlKey,b.metaKey=a.metaKey,b.shiftKey=a.shiftKey,b.targetTouches=a.targetTouches);return b}F=a.body();a.doc.addEventListener("touchstart",function(a){D=(new Date).getTime();var b=F;F=a.target;
d.emit(b,"dojotouchout",{relatedTarget:F,bubbles:!0});d.emit(F,"dojotouchover",{relatedTarget:b,bubbles:!0});p(a,"touchmove","touchend")},!0);d(a.doc,"touchmove",function(c){D=(new Date).getTime();var l=a.doc.elementFromPoint(c.pageX-(q?0:a.global.pageXOffset),c.pageY-(q?0:a.global.pageYOffset));l&&(F!==l&&(d.emit(F,"dojotouchout",{relatedTarget:l,bubbles:!0}),d.emit(l,"dojotouchover",{relatedTarget:F,bubbles:!0}),F=l),d.emit(l,"dojotouchmove",b(c))||c.preventDefault())});d(a.doc,"touchend",function(c){D=
(new Date).getTime();var l=a.doc.elementFromPoint(c.pageX-(q?0:a.global.pageXOffset),c.pageY-(q?0:a.global.pageYOffset))||a.body();d.emit(l,"dojotouchend",b(c))})}));f={press:l("mousedown","touchstart",t.down),move:l("mousemove","dojotouchmove",t.move),release:l("mouseup","dojotouchend",t.up),cancel:l(c.leave,"touchcancel",r?t.cancel:null),over:l("mouseover","dojotouchover",t.over),out:l("mouseout","dojotouchout",t.out),enter:c._eventHandler(l("mouseover","dojotouchover",t.over)),leave:c._eventHandler(l("mouseout",
"dojotouchout",t.out))};return m.touch=f})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(m,f,k,e){e.extend(f,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return k("dijit._FocusMixin",null,{_focusManager:m})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){var u,x,v=new (f([n,h],{curNode:null,activeStack:[],constructor:function(){var a=c.hitch(this,function(a){k.isDescendant(this.curNode,a)&&this.set("curNode",null);k.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});m.before(d,"empty",a);m.before(d,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var d=this,e=a.document&&a.document.body;if(e){var h=l("pointer-events")?"pointerdown":l("touch-events")?
"mousedown, touchstart":"mousedown",g=b(a.document,h,function(a){a&&a.target&&null==a.target.parentNode||d._onTouchNode(c||a.target,"mouse")}),n=b(e,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"!=b&&"body"!=b&&(r.isFocusable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),p=b(e,"focusout",function(a){d._onBlurNode(c||a.target)});return{remove:function(){g.remove();n.remove();p.remove();e=g=n=p=null}}}},_onBlurNode:function(a){a=(new Date).getTime();
a<u+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(c.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<x+100||(this._clearActiveWidgetsTimer=setTimeout(c.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){x=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),
delete this._clearActiveWidgetsTimer);g.contains(a,"dijitPopup")&&(a=a.firstChild);var c=[];try{for(;a;){var l=e.get(a,"dijitPopupParent");if(l)a=t.byId(l).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===p.body())break;a=q.get(a.ownerDocument).frameElement}else{var d=a.getAttribute&&a.getAttribute("widgetId"),h=d&&t.byId(d);!h||"mouse"==b&&h.get("disabled")||c.unshift(d);a=a.parentNode}}}catch(F){}this._setStack(c,b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(u=(new Date).getTime(),
this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var c=this.activeStack,l=c.length-1,d=a.length-1;if(a[d]!=c[l]){this.set("activeStack",a);var e;for(e=l;0<=e&&c[e]!=a[e];e--)if(l=t.byId(c[e]))l._hasBeenBlurred=!0,l.set("focused",!1),l._focusManager==this&&l._onBlur(b),this.emit("widget-blur",l,b);for(e++;e<=d;e++)if(l=t.byId(a[e]))l.set("focused",
!0),l._focusManager==this&&l._onFocus(b),this.emit("widget-focus",l,b)}},focus:function(a){if(a)try{a.focus()}catch(A){}}}));a(function(){var a=v.registerWin(q.get(document));l("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});w.focus=function(a){v.focus(a)};for(var z in v)/^_/.test(z)||(w.focus[z]="function"==typeof v[z]?c.hitch(v,z):v[z]);v.watch(function(a,b,c){w.focus[a]=c});return v})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),
function(m,f,k,e,g,d,h){var c={_isElementShown:function(b){var a=e.get(b);return"hidden"!=a.visibility&&"collapsed"!=a.visibility&&"none"!=a.display&&"hidden"!=k.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return k.has(b,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var a;try{var c=b.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;a=c.body}catch(n){try{a=b.contentWindow.document.body}catch(p){return!1}}return a&&
("true"==a.contentEditable||a.firstChild&&"true"==a.firstChild.contentEditable);default:return"true"==b.contentEditable}},effectiveTabIndex:function(b){if(!k.get(b,"disabled"))return k.has(b,"tabIndex")?+k.get(b,"tabIndex"):c.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=c.effectiveTabIndex(b)},isFocusable:function(b){return-1<=c.effectiveTabIndex(b)},_getTabNavigable:function(b){function a(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&
a.name&&a.name.toLowerCase()}function l(b){return u[a(b)]||b}var e,h,g,r,t,w,u={},x=c._isElementShown,v=c.effectiveTabIndex,z=function(b){for(b=b.firstChild;b;b=b.nextSibling)if(!(1!=b.nodeType||9>=d("ie")&&"HTML"!==b.scopeName)&&x(b)){var c=v(b);if(0<=c){if(0==c)e||(e=b),h=b;else if(0<c){if(!g||c<r)r=c,g=b;if(!t||c>=w)w=c,t=b}c=a(b);k.get(b,"checked")&&c&&(u[c]=b)}"SELECT"!=b.nodeName.toUpperCase()&&z(b)}};x(b)&&z(b);return{first:l(e),last:l(h),lowest:l(g),highest:l(t)}},getFirstInTabbingOrder:function(b,
a){b=c._getTabNavigable(f.byId(b,a));return b.lowest?b.lowest:b.first},getLastInTabbingOrder:function(b,a){b=c._getTabNavigable(f.byId(b,a));return b.last?b.last:b.highest}};g.mixin(h,c);return c})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(m,f,k,e,g){var d=g.doc.documentElement;g=e("ie");var h=e("trident"),c=e("opera"),b=Math.floor,a=e("ff"),l=m.boxModel.replace(/-/,""),c={dj_quirks:0,dj_opera:c,dj_khtml:0,dj_webkit:e("webkit"),
dj_safari:e("safari"),dj_chrome:e("chrome"),dj_edge:e("edge"),dj_gecko:e("mozilla"),dj_ios:e("ios"),dj_android:0};g&&(c.dj_ie=!0,c["dj_ie"+b(g)]=!0,c.dj_iequirks=0);h&&(c.dj_trident=!0,c["dj_trident"+b(h)]=!0);a&&(c["dj_ff"+b(a)]=!0);c["dj_"+l]=!0;var n="",p;for(p in c)c[p]&&(n+=p+" ");d.className=f.trim(d.className+" "+n);k(function(){if(!m.isBodyLtr()){var a="dj_rtl dijitRtl "+n.replace(/ /g,"-rtl ");d.className=f.trim(d.className+" "+a+"dj_rtl dijitRtl "+n.replace(/ /g,"-rtl "))}});return e})},
"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(m,f,k,e){k(function(){f("highcontrast")&&m.add(e.body(),"dijit_a11y")});return f})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(m,f,k,e,g,d,h){g.add("highcontrast",function(){var c=h.doc.createElement("div");try{c.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+
(f.blankGif||m.toUrl("./resources/blank.gif"))+'");';h.body().appendChild(c);var b=e.getComputedStyle(c),a=b.backgroundImage;return b.borderTopColor==b.borderRightColor||a&&("none"==a||"url(invalid-url:)"==a)}catch(l){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+l.toString()),!1}finally{8>=g("ie")?c.outerHTML="":h.body().removeChild(c)}});d(function(){g("highcontrast")&&k.add(h.body(),"dj_a11y")});return g})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),
function(m,f,k,e,g,d,h,c){var b=f("dijit._TemplatedMixin",c,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var b=this.declaredClass,c=this;return h.substitute(a,this,function(a,l){"!"==l.charAt(0)&&(a=e.getObject(l.substr(1),!1,c));if("undefined"==typeof a)throw Error(b+" template:"+l);return null==a?"":"!"==l.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;",
"\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=m(this.templatePath,{sanitize:!0}));var a=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),c;if(e.isString(a)){if(c=k.toDom(this._stringRepl(a),this.ownerDocument),1!=c.nodeType)throw Error("Invalid template: "+a);}else c=a.cloneNode(!0);this.domNode=c}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);
this._rendered=!0},_fillContent:function(a){var b=this.containerNode;if(a&&b)for(;a.hasChildNodes();)b.appendChild(a.firstChild)}});b._templateCache={};b.getCachedTemplate=function(a,c,d){var l=b._templateCache,e=a,g=l[e];if(g){try{if(!g.ownerDocument||g.ownerDocument==(d||document))return g}catch(t){}k.destroy(g)}a=h.trim(a);if(c||a.match(/\$\{([^\}]+)\}/g))return l[e]=a;c=k.toDom(a,d);if(1!=c.nodeType)throw Error("Invalid template: "+a);return l[e]=c};d("ie")&&g(window,"unload",function(){var a=
b._templateCache,c;for(c in a){var d=a[c];"object"==typeof d&&k.destroy(d);delete a[c]}});return b})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(m){return m.cache})},"dojo/text":function(){define(["./_base/kernel","require","./has","./has!host-browser?./request"],function(m,f,k,e){var g;k("host-browser")?g=function(a,b,c){e(a,{sync:!!b,headers:{"X-Requested-With":null}}).then(c)}:f.getText?g=f.getText:console.error("dojo/text plugin failed to load because loader does not support getText");
var d={},h=function(a){if(a){a=a.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);b&&(a=b[1])}else a="";return a},c={},b={};m.cache=function(a,b,c){var l;"string"==typeof a?/\//.test(a)?(l=a,c=b):l=f.toUrl(a.replace(/\./g,"/")+(b?"/"+b:"")):(l=a+"",c=b);a=void 0!=c&&"string"!=typeof c?c.value:c;c=c&&c.sanitize;if("string"==typeof a)return d[l]=a,c?h(a):a;if(null===a)return delete d[l],null;l in d||g(l,!0,function(a){d[l]=
a});return c?h(d[l]):d[l]};return{dynamic:!0,normalize:function(a,b){a=a.split("!");var c=a[0];return(/^\./.test(c)?b(c):c)+(a[1]?"!"+a[1]:"")},load:function(a,l,e){a=a.split("!");var n=1<a.length,q=a[0],k=l.toUrl(a[0]);a="url:"+k;var t=c,w=function(a){e(n?h(a):a)};q in d?t=d[q]:l.cache&&a in l.cache?t=l.cache[a]:k in d&&(t=d[k]);if(t===c)if(b[k])b[k].push(w);else{var u=b[k]=[w];g(k,!l.async,function(a){d[q]=d[k]=a;for(var c=0;c<u.length;)u[c++](a);delete b[k]})}else w(t)}}})},"dojo/string":function(){define(["./_base/kernel",
"./_base/lang"],function(m,f){var k=/[&<>'"\/]/g,e={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"},g={};f.setObject("dojo.string",g);g.escape=function(d){return d?d.replace(k,function(d){return e[d]}):""};g.rep=function(d,e){if(0>=e||!d)return"";for(var c=[];;){e&1&&c.push(d);if(!(e>>=1))break;d+=d}return c.join("")};g.pad=function(d,e,c,b){c||(c="0");d=String(d);e=g.rep(c,Math.ceil((e-d.length)/c.length));return b?d+e:e+d};g.substitute=function(d,
e,c,b){b=b||m.global;c=c?f.hitch(b,c):function(a){return a};return d.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,function(a,l,d){if(""==l)return"$";a=f.getObject(l,!1,e);d&&(a=f.getObject(d,!1,b).call(b,a,l));d=c(a,l);if("undefined"===typeof d)throw Error('string.substitute could not find key "'+l+'" in template');return d.toString()})};g.trim=String.prototype.trim?f.trim:function(d){d=d.replace(/^\s+/,"");for(var e=d.length-1;0<=e;e--)if(/\S/.test(d.charAt(e))){d=d.substring(0,e+1);break}return d};
return g})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(m,f,k,e,g,d,h,c,b){var a=g.delegate(c,{mouseenter:d.enter,mouseleave:d.leave,keypress:k._keypress}),l;k=e("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},
_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var b=a;;)if(1==b.nodeType&&(this._processTemplateNode(b,function(a,b){return a.getAttribute(b)},this._attach)||this.searchContainerNode)&&b.firstChild)b=b.firstChild;else{if(b==a)break;for(;!b.nextSibling;)if(b=b.parentNode,b==a)return;b=b.nextSibling}},_processTemplateNode:function(a,b,c){var l=!0,d=this.attachScope||this,e=b(a,"dojoAttachPoint")||b(a,"data-dojo-attach-point");if(e)for(var h=e.split(/\s*,\s*/);e=h.shift();)g.isArray(d[e])?
d[e].push(a):d[e]=a,l="containerNode"!=e,this._attachPoints.push(e);if(b=b(a,"dojoAttachEvent")||b(a,"data-dojo-attach-event"))for(e=b.split(/\s*,\s*/),h=g.trim;b=e.shift();)if(b){var n=null;-1!=b.indexOf(":")?(n=b.split(":"),b=h(n[0]),n=h(n[1])):b=h(b);n||(n=b);this._attachEvents.push(c(a,b,g.hitch(d,n)))}return l},_attach:function(b,c,d){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?l||(l=m("./a11yclick")):a[c]||c;return h(b,c,d)},_detachTemplateNodes:function(){var a=this.attachScope||
this;f.forEach(this._attachPoints,function(b){delete a[b]});this._attachPoints=[];f.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});g.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});return k})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(m,f,k,e,g,d,h,c){c.add("config-bgIframe",
(c("ie")||c("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var b=new function(){var a=[];this.pop=function(){var b;a.length?(b=a.pop(),b.style.display=""):(9>c("ie")?(b=k.dojoBlankHtmlUrl||m.toUrl("dojo/resources/blank.html")||'javascript:""',b=document.createElement("\x3ciframe src\x3d'"+b+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(b=e.create("iframe"),b.src='javascript:""',b.className="dijitBackgroundIframe",
b.setAttribute("role","presentation"),g.set(b,"opacity",.1)),b.tabIndex=-1);return b};this.push=function(b){b.style.display="none";a.push(b)}};f.BackgroundIframe=function(a){if(!a.id)throw Error("no id");if(c("config-bgIframe")){var l=this.iframe=b.pop();a.appendChild(l);7>c("ie")?(this.resize(a),this._conn=h(a,"resize",d.hitch(this,"resize",a))):g.set(l,{width:"100%",height:"100%"})}};d.extend(f.BackgroundIframe,{resize:function(a){this.iframe&&g.set(this.iframe,{width:a.offsetWidth+"px",height:a.offsetHeight+
"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),b.push(this.iframe),delete this.iframe)}});return f.BackgroundIframe})},"esri/kernel":function(){define(["require","./core/promiseUtils","./core/has","dojo/main"],function(m,f,k,e){(function(){var g=e.config,d=g.has&&void 0!==g.has["config-deferredInstrumentation"],h=g.has&&void 0!==g.has["config-useDeferredInstrumentation"];void 0!==g.useDeferredInstrumentation||
d||h||(k.add("config-deferredInstrumentation",!1,!0,!0),k.add("config-useDeferredInstrumentation",!1,!0,!0))})();return{version:"4.9",workerMessages:{request:function(e){return f.create(function(d){m(["./request"],d)}).then(function(d){var h=e.options||{};h.responseType="array-buffer";return d(e.url,h)}).then(function(d){return{result:{data:d.data,ssl:d.ssl},transferList:[d.data]}})}}}})},"esri/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),
function(m,f,k,e,g,d){function h(b){if(b){if("function"!==typeof b.forEach){var a=Object.keys(b),c=a.map(function(a){return b[a]});return h(c).then(function(b){var c={};a.forEach(function(a,l){return c[a]=b[l]});return c})}var d=new k(function(a){b.forEach(function(b){return b.cancel(a)})}),e=[],g=b.length;0===g&&d.resolve(e);b.forEach(function(a){var b={promise:a};e.push(b);a.then(function(a){b.value=a}).catch(function(a){b.error=a}).then(function(){--g;0===g&&d.resolve(e)})});return d.promise}}
function c(b,a){var c=new k(a);b(function(a){return e(a).then(c.resolve)},c.reject);return c.promise}Object.defineProperty(f,"__esModule",{value:!0});f.all=function(b){return g(b)};f.filter=function(b,a){var c=b.slice();return g(b.map(function(b,c){return a(b,c)})).then(function(a){return c.filter(function(b,c){return a[c]})})};f.eachAlways=h;f.create=c;f.reject=function(b){var a=new k;a.reject(b);return a.promise};f.resolve=function(b){void 0===b&&(b=null);var a=new k;a.resolve(b);return a.promise};
f.after=function(b,a){void 0===a&&(a=null);var c=0,d=new k(function(){c&&(clearTimeout(c),c=0)}),c=setTimeout(function(){d.resolve(a)},b);return d.promise};f.timeout=function(b,a,c){var l=0,e=new k(b.cancel);b.then(function(a){e.isFulfilled()||(e.resolve(a),l&&(clearTimeout(l),l=0))});b.catch(function(a){e.isFulfilled()||(e.reject(a),l&&(clearTimeout(l),l=0))});l=setTimeout(function(){var b=c||new d("promiseUtils:timeout","The wrapped promise did not resolve within "+a+" ms");e.reject(b)},a);return e.promise};
f.wrapCallback=function(b){var a=!1,c=new k(function(){return a=!0});b(function(b){a||c.resolve(b)});return c.promise};f.isThenable=function(b){return b&&"function"===typeof b.then};f.when=function(b){return e(b)};f.createResolver=function(b){var a,l;b=c(function(b,c){a=b;l=c},b);var d=function(b){a(b)};d.resolve=function(b){return a(b)};d.reject=function(a){return l(a)};d.promise=b;return d}})},"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(m,
f,k,e){var g=m.some;return function(d){var h,c;f.isArray(d)?c=d:d&&"object"===typeof d&&(h=d);var b,a=[];if(h){c=[];for(var l in h)Object.hasOwnProperty.call(h,l)&&(a.push(l),c.push(h[l]));b={}}else c&&(b=[]);if(!c||!c.length)return(new k).resolve(b);var n=new k;n.promise.always(function(){b=a=null});var p=c.length;g(c,function(c,l){h||a.push(l);e(c,function(c){n.isFulfilled()||(b[a[l]]=c,0===--p&&n.resolve(b))},n.reject);return n.isFulfilled()});return n.promise}})},"esri/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(m,f,k,e,g){m=function(d){function h(c,b,a){var l=d.call(this,c,b,a)||this;return l instanceof h?l:new h(c,b,a)}k(h,d);h.prototype.toJSON=function(){return{name:this.name,message:this.message,details:e.clone(this.details),dojoType:this.dojoType}};h.fromJSON=function(c){var b=new h(c.name,c.message,c.details);null!=c.dojoType&&(b.dojoType=c.dojoType);return b};return h}(g);m.prototype.type="error";return m})},"esri/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,k){f.__proto__=k}||function(f,k){for(var e in k)k.hasOwnProperty(e)&&(f[e]=k[e])};return function(f,k){function e(){this.constructor=f}m(f,k);f.prototype=null===k?Object.create(k):(e.prototype=k.prototype,new e)}}()})},"esri/core/lang":function(){define(["./global","dojo/date","dojo/number","dojo/date/locale","dojo/i18n!../nls/common"],function(m,f,k,e,g){function d(a,b,c){var l,d,e={};for(l in b){d=
b[l];var h=!(l in e)||e[l]!==d;if(!(l in a)||a[l]!==d&&h)a[l]=c?c(d):d}return a}function h(b,c,l){var d=l.match(/([^\(]+)(\([^\)]+\))?/i),h=d[1].trim();l=c[b];var d=JSON.parse((d[2]?d[2].trim():"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z\_]+)\s*:/gi,'$1"$2":').replace(/\"\s*:\s*\'/gi,'":"').replace(/\'\s*(,|\})/gi,'"$1')),g=d.utcOffset;if(-1===a.indexOf(h)){var p;a:{h=h.split(".");g=void 0;g=m;try{for(var v=0;v<h.length;v++){var q=h[v];if(!(q in g)){p=void 0;break a}g=
g[q]}p=g;break a}catch(y){}p=void 0}"function"===typeof p&&(l=p(l,b,c,d))}else if("number"===typeof l||"string"===typeof l&&l&&!isNaN(Number(l)))switch(l=Number(l),h){case "NumberFormat":b=n.mixin({},d);c=parseFloat(b.places);if(isNaN(c)||0>c)b.places=Infinity;return k.format(l,b);case "DateString":l=new Date(l);if(d.local||d.systemLocale)return d.systemLocale?l.toLocaleDateString()+(d.hideTime?"":" "+l.toLocaleTimeString()):l.toDateString()+(d.hideTime?"":" "+l.toTimeString());l=l.toUTCString();
d.hideTime&&(l=l.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,""));return l;case "DateFormat":return l=new Date(l),null!=g&&(l=f.add(l,"minute",l.getTimezoneOffset()-g)),e.format(l,d)}return null!=l?l:""}function c(a,b){var l;if(b)for(l in a)a.hasOwnProperty(l)&&(void 0===a[l]?delete a[l]:a[l]instanceof Object&&c(a[l],!0));else for(l in a)a.hasOwnProperty(l)&&void 0===a[l]&&delete a[l];return a}function b(a){return a&&"object"==typeof a&&"function"!==typeof a?a instanceof Int8Array||a instanceof Uint8Array||
a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Date?new a.constructor(a):a instanceof ArrayBuffer?a.slice(0,a.byteLength):"function"===typeof a.clone?a.clone():"function"===typeof a.map&&"function"===typeof a.forEach?a.map(b):"function"===typeof a.notifyChange&&"function"===typeof a.watch?a.clone():d({},a,b):a}var a=["NumberFormat","DateString",
"DateFormat"],l=/<\/?[^>]+>/g,n={equals:function(a,b){return a===b||"number"===typeof a&&isNaN(a)&&"number"===typeof b&&isNaN(b)||"function"===typeof(a||{}).getTime&&"function"===typeof(b||{}).getTime&&a.getTime()==b.getTime()||"function"===typeof(a||{}).equals&&a.equals(b)||"function"===typeof(b||{}).equals&&b.equals(a)||!1},mixin:function(a){a||(a={});for(var b=1,c=arguments.length;b<c;b++)d(a,arguments[b]);return a},valueOf:function(a,b){for(var c in a)if(a[c]==b)return c;return null},stripTags:function(a){if(a){var b=
typeof a;if("string"===b)a=a.replace(l,"");else if("object"===b)for(var c in a)(b=a[c])&&"string"===typeof b&&(b=b.replace(l,"")),a[c]=b}return a},substitute:function(a,b,c){var l,d,e;null!=c&&("object"===typeof c?(l=c.first,d=c.dateFormat,e=c.numberFormat):l=c);if(b&&"{*}"!==b)return b.replace(/\{([^\}]+)\}/g,function(a,b){a=b.split(":");if(1<a.length)return b=a[0],a.shift(),h(b,this.obj,a.join(":"));if(d&&-1!==(d.properties||[]).indexOf(b))return h(b,this.obj,d.formatter||"DateString");if(e&&-1!==
(e.properties||[]).indexOf(b))return h(b,this.obj,e.formatter||"NumberFormat");b=this.obj[b];return null!=b?b:""}.bind({obj:a}));b=[];var n;b.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+g.fieldsSummary+'"\x3e\x3ctbody\x3e');for(n in a)if(c=a[n],d&&-1!==(d.properties||[]).indexOf(n)?c=h(n,a,d.formatter||"DateString"):e&&-1!==(e.properties||[]).indexOf(n)&&(c=h(n,a,e.formatter||"NumberFormat")),b.push("\x3ctr\x3e\x3cth\x3e"+n+"\x3c/th\x3e\x3ctd\x3e"+(null!=c?c:"")+"\x3c/td\x3e\x3c/tr\x3e"),
l)break;b.push("\x3c/tbody\x3e\x3c/table\x3e");return b.join("")},filter:function(a,b,c){b=["string"===typeof a?a.split(""):a,c||m,"string"===typeof b?new Function("item","index","array",b):b];c={};var l;a=b[0];for(l in a)b[2].call(b[l],a[l],l,a)&&(c[l]=a[l]);return c},startsWith:function(a,b,c){c=c||0;return a.indexOf(b,c)===c},endsWith:function(a,b,c){if("number"!==typeof c||!isFinite(c)||Math.floor(c)!==c||c>a.length)c=a.length;c-=b.length;a=a.indexOf(b,c);return-1!==a&&a===c},fixJson:c,clone:b};
return n})},"esri/core/global":function(){define(["require","exports"],function(m,f){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},"dojo/date":function(){define(["./has","./_base/lang"],function(m,f){var k={getDaysInMonth:function(e){var g=e.getMonth();return 1==g&&k.isLeapYear(e)?29:[31,28,31,30,31,30,31,31,30,31,30,31][g]},isLeapYear:function(e){e=e.getFullYear();return!(e%400)||!(e%4)&&
!!(e%100)},getTimezoneName:function(e){var g=e.toString(),d="",h=g.indexOf("(");if(-1<h)d=g.substring(++h,g.indexOf(")"));else if(h=/([A-Z\/]+) \d{4}$/,g=g.match(h))d=g[1];else if(g=e.toLocaleString(),h=/ ([A-Z\/]+)$/,g=g.match(h))d=g[1];return"AM"==d||"PM"==d?"":d},compare:function(e,g,d){e=new Date(+e);g=new Date(+(g||new Date));"date"==d?(e.setHours(0,0,0,0),g.setHours(0,0,0,0)):"time"==d&&(e.setFullYear(0,0,0),g.setFullYear(0,0,0));return e>g?1:e<g?-1:0},add:function(e,g,d){var h=new Date(+e),
c=!1,b="Date";switch(g){case "day":break;case "weekday":var a;(g=d%5)?a=parseInt(d/5):(g=0<d?5:-5,a=0<d?(d-5)/5:(d+5)/5);var l=e.getDay(),n=0;6==l&&0<d?n=1:0==l&&0>d&&(n=-1);l+=g;if(0==l||6==l)n=0<d?2:-2;d=7*a+g+n;break;case "year":b="FullYear";c=!0;break;case "week":d*=7;break;case "quarter":d*=3;case "month":c=!0;b="Month";break;default:b="UTC"+g.charAt(0).toUpperCase()+g.substring(1)+"s"}if(b)h["set"+b](h["get"+b]()+d);c&&h.getDate()<e.getDate()&&h.setDate(0);return h},difference:function(e,g,
d){g=g||new Date;d=d||"day";var h=g.getFullYear()-e.getFullYear(),c=1;switch(d){case "quarter":e=e.getMonth();g=g.getMonth();c=Math.floor(g/3)+1+4*h-(Math.floor(e/3)+1);break;case "weekday":h=Math.round(k.difference(e,g,"day"));d=parseInt(k.difference(e,g,"week"));if(0==h%7)h=5*d;else{var c=0,b=e.getDay(),a=g.getDay();d=parseInt(h/7);g=h%7;e=new Date(e);e.setDate(e.getDate()+7*d);e=e.getDay();if(0<h)switch(!0){case 6==b:c=-1;break;case 0==b:c=0;break;case 6==a:c=-1;break;case 0==a:c=-2;break;case 5<
e+g:c=-2}else if(0>h)switch(!0){case 6==b:c=0;break;case 0==b:c=1;break;case 6==a:c=2;break;case 0==a:c=1;break;case 0>e+g:c=2}h=h+c-2*d}c=h;break;case "year":c=h;break;case "month":c=g.getMonth()-e.getMonth()+12*h;break;case "week":c=parseInt(k.difference(e,g,"day")/7);break;case "day":c/=24;case "hour":c/=60;case "minute":c/=60;case "second":c/=1E3;case "millisecond":c*=g.getTime()-e.getTime()}return Math.round(c)}};f.mixin(f.getObject("dojo.date",!0),k);return k})},"dojo/number":function(){define(["./_base/lang",
"./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(m,f,k,e,g){var d={};m.setObject("dojo.number",d);d.format=function(c,b){b=m.mixin({},b||{});var a=f.normalizeLocale(b.locale),a=f.getLocalization("dojo.cldr","number",a);b.customs=a;a=b.pattern||a[(b.type||"decimal")+"Format"];return isNaN(c)||Infinity==Math.abs(c)?null:d._applyPattern(c,a,b)};d._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;d._applyPattern=function(c,b,a){a=a||{};var l=a.customs.group,e=a.customs.decimal;b=b.split(";");
var h=b[0];b=b[0>c?1:0]||"-"+h;if(-1!=b.indexOf("%"))c*=100;else if(-1!=b.indexOf("\u2030"))c*=1E3;else if(-1!=b.indexOf("\u00a4"))l=a.customs.currencyGroup||l,e=a.customs.currencyDecimal||e,b=b.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/,function(b,c,l,d){return(b=a[["symbol","currency","displayName"][l.length-1]]||a.currency||"")?c+b+d:""});else if(-1!=b.indexOf("E"))throw Error("exponential notation not supported");var g=d._numberPatternRE,h=h.match(g);if(!h)throw Error("unable to find a number expression in pattern: "+
b);!1===a.fractional&&(a.places=0);return b.replace(g,d._formatAbsolute(c,h[0],{decimal:e,group:l,places:a.places,round:a.round}))};d.round=function(c,b,a){a=10/(a||10);return(a*+c).toFixed(b)/a};if(0==(.9).toFixed()){var h=d.round;d.round=function(c,b,a){var l=Math.pow(10,-b||0),d=Math.abs(c);if(!c||d>=l)l=0;else if(d/=l,.5>d||.95<=d)l=0;return h(c,b,a)+(0<c?l:-l)}}d._formatAbsolute=function(c,b,a){a=a||{};!0===a.places&&(a.places=0);Infinity===a.places&&(a.places=6);b=b.split(".");var l="string"==
typeof a.places&&a.places.indexOf(","),h=a.places;l?h=a.places.substring(l+1):0<=h||(h=(b[1]||[]).length);0>a.round||(c=d.round(c,h,a.round));c=String(Math.abs(c)).split(".");var g=c[1]||"";b[1]||a.places?(l&&(a.places=a.places.substring(0,l)),l=void 0!==a.places?a.places:b[1]&&b[1].lastIndexOf("0")+1,l>g.length&&(c[1]=e.pad(g,l,"0",!0)),h<g.length&&(c[1]=g.substr(0,h))):c[1]&&c.pop();h=b[0].replace(",","");l=h.indexOf("0");-1!=l&&(l=h.length-l,l>c[0].length&&(c[0]=e.pad(c[0],l)),-1==h.indexOf("#")&&
(c[0]=c[0].substr(c[0].length-l)));var h=b[0].lastIndexOf(","),q,k;-1!=h&&(q=b[0].length-h-1,b=b[0].substr(0,h),h=b.lastIndexOf(","),-1!=h&&(k=b.length-h-1));b=[];for(h=c[0];h;)l=h.length-q,b.push(0<l?h.substr(l):h),h=0<l?h.slice(0,l):"",k&&(q=k,k=void 0);c[0]=b.reverse().join(a.group||",");return c.join(a.decimal||".")};d.regexp=function(c){return d._parseInfo(c).regexp};d._parseInfo=function(c){c=c||{};var b=f.normalizeLocale(c.locale),b=f.getLocalization("dojo.cldr","number",b),a=c.pattern||b[(c.type||
"decimal")+"Format"],l=b.group,e=b.decimal,h=1;if(-1!=a.indexOf("%"))h/=100;else if(-1!=a.indexOf("\u2030"))h/=1E3;else{var q=-1!=a.indexOf("\u00a4");q&&(l=b.currencyGroup||l,e=b.currencyDecimal||e)}b=a.split(";");1==b.length&&b.push("-"+b[0]);b=g.buildGroupRE(b,function(a){a="(?:"+g.escapeString(a,".")+")";return a.replace(d._numberPatternRE,function(a){var b={signed:!1,separator:c.strict?l:[l,""],fractional:c.fractional,decimal:e,exponent:!1};a=a.split(".");var g=c.places;1==a.length&&1!=h&&(a[1]=
"###");1==a.length||0===g?b.fractional=!1:(void 0===g&&(g=c.pattern?a[1].lastIndexOf("0")+1:Infinity),g&&void 0==c.fractional&&(b.fractional=!0),!c.places&&g<a[1].length&&(g+=","+a[1].length),b.places=g);a=a[0].split(",");1<a.length&&(b.groupSize=a.pop().length,1<a.length&&(b.groupSize2=a.pop().length));return"("+d._realNumberRegexp(b)+")"})},!0);q&&(b=b.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(a,b,l,d){a=g.escapeString(c[["symbol","currency","displayName"][l.length-1]]||c.currency||
"");if(!a)return"";b=b?"[\\s\\xa0]":"";d=d?"[\\s\\xa0]":"";return c.strict?b+a+d:(b&&(b+="*"),d&&(d+="*"),"(?:"+b+a+d+")?")}));return{regexp:b.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:l,decimal:e,factor:h}};d.parse=function(c,b){b=d._parseInfo(b);c=(new RegExp("^"+b.regexp+"$")).exec(c);if(!c)return NaN;var a=c[1];if(!c[1]){if(!c[2])return NaN;a=c[2];b.factor*=-1}a=a.replace(new RegExp("["+b.group+"\\s\\xa0]","g"),"").replace(b.decimal,".");return a*b.factor};d._realNumberRegexp=function(c){c=c||{};
"places"in c||(c.places=Infinity);"string"!=typeof c.decimal&&(c.decimal=".");"fractional"in c&&!/^0/.test(c.places)||(c.fractional=[!0,!1]);"exponent"in c||(c.exponent=[!0,!1]);"eSigned"in c||(c.eSigned=[!0,!1]);var b=d._integerRegexp(c),a=g.buildGroupRE(c.fractional,function(a){var b="";a&&0!==c.places&&(b="\\"+c.decimal,b=Infinity==c.places?"(?:"+b+"\\d+)?":b+("\\d{"+c.places+"}"));return b},!0),l=g.buildGroupRE(c.exponent,function(a){return a?"([eE]"+d._integerRegexp({signed:c.eSigned})+")":""}),
b=b+a;a&&(b="(?:(?:"+b+")|(?:"+a+"))");return b+l};d._integerRegexp=function(c){c=c||{};"signed"in c||(c.signed=[!0,!1]);"separator"in c?"groupSize"in c||(c.groupSize=3):c.separator="";var b=g.buildGroupRE(c.signed,function(a){return a?"[-+]":""},!0),a=g.buildGroupRE(c.separator,function(a){if(!a)return"(?:\\d+)";a=g.escapeString(a);" "==a?a="\\s":"\u00a0"==a&&(a="\\s\\xa0");var b=c.groupSize,l=c.groupSize2;return l?(a="(?:0|[1-9]\\d{0,"+(l-1)+"}(?:["+a+"]\\d{"+l+"})*["+a+"]\\d{"+b+"})",0<b-l?"(?:"+
a+"|(?:0|[1-9]\\d{0,"+(b-1)+"}))":a):"(?:0|[1-9]\\d{0,"+(b-1)+"}(?:["+a+"]\\d{"+b+"})*)"},!0);return b+a};return d})},"dojo/i18n":function(){define("./_base/kernel require ./has ./_base/array ./_base/config ./_base/lang ./has!host-browser?./_base/xhr ./json module".split(" "),function(m,f,k,e,g,d,h,c,b){k.add("dojo-preload-i18n-Api",1);h=m.i18n={};var a=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,l=function(a,b,c,l){var d=[c+l];b=b.split("-");for(var e="",h=0;h<b.length;h++)if(e+=(e?"-":"")+b[h],!a||
a[e])d.push(c+e+"/"+l),d.specificity=e;return d},n={},p=function(a,b,c){c=c?c.toLowerCase():m.locale;a=a.replace(/\./g,"/");b=b.replace(/\./g,"/");return/root/i.test(c)?a+"/nls/"+b:a+"/nls/"+c+"/"+b},q=m.getL10nName=function(a,c,l){return a=b.id+"!"+p(a,c,l)},r=function(a,b,c,e,h,g){a([b],function(v){var p=d.clone(v.root||v.ROOT),q=l(!v._v1x&&v,h,c,e);a(q,function(){for(var a=1;a<q.length;a++)p=d.mixin(d.clone(p),arguments[a]);n[b+"/"+h]=p;p.$locale=q.specificity;g()})})},t=function(a){var b=g.extraLocale||
[],b=d.isArray(b)?b:[b];b.push(a);return b},w=function(b,l,h){var g=a.exec(b),p=g[1]+"/",q=g[5]||g[4],u=p+q,w=(g=g[5]&&g[4])||m.locale||"",f=u+"/"+w,g=g?[w]:t(w),A=g.length,B=function(){--A||h(d.delegate(n[f]))},w=b.split("*"),C="preload"==w[1];if(k("dojo-preload-i18n-Api")){if(C&&(n[b]||(n[b]=1,z(w[2],c.parse(w[3]),1,l)),h(1)),(w=C)||(x&&v.push([b,l,h]),w=x&&!n[f]),w)return}else if(C){h(1);return}e.forEach(g,function(a){var b=u+"/"+a;k("dojo-preload-i18n-Api")&&y(b);n[b]?B():r(l,u,p,q,a,B)})};k("dojo-preload-i18n-Api");
var u=h.normalizeLocale=function(a){a=a?a.toLowerCase():m.locale;return"root"==a?"ROOT":a},x=0,v=[],z=h._preloadLocalizations=function(a,b,c,l){function h(a,b){l([a],b)}function g(a,b){for(a=a.split("-");a.length;){if(b(a.join("-")))return;a.pop()}b("ROOT")}function p(){for(--x;!x&&v.length;)w.apply(null,v.shift())}function q(c){c=u(c);g(c,function(v){if(0<=e.indexOf(b,v)){var q=a.replace(/\./g,"/")+"_"+v;x++;h(q,function(a){for(var b in a){var e=a[b],h=b.match(/(.+)\/([^\/]+)$/),q;if(h&&(q=h[2],
h=h[1]+"/",e._localized)){var k;if("ROOT"===v){var u=k=e._localized;delete e._localized;u.root=e;n[f.toAbsMid(b)]=u}else k=e._localized,n[f.toAbsMid(h+q+"/"+v)]=e;v!==c&&function(a,b,e,h){var v=[],q=[];g(c,function(c){h[c]&&(v.push(f.toAbsMid(a+c+"/"+b)),q.push(f.toAbsMid(a+b+"/"+c)))});v.length?(x++,l(v,function(){for(var l=v.length-1;0<=l;l--)e=d.mixin(d.clone(e),arguments[l]),n[q[l]]=e;n[f.toAbsMid(a+b+"/"+c)]=d.clone(e);p()})):n[f.toAbsMid(a+b+"/"+c)]=e}(h,q,e,k)}}p()});return!0}return!1})}l=
l||f;q();e.forEach(m.config.extraLocale,q)},y=function(){},y=function(a){for(var b,c=a.split("/"),l=m.global[c[0]],d=1;l&&d<c.length-1;l=l[c[d++]]);l&&((b=l[c[d]])||(b=l[c[d].replace(/-/g,"_")]),b&&(n[a]=b));return b};h.getLocalization=function(a,b,c){var l;a=p(a,b,c);w(a,f,function(a){l=a});return l};return d.mixin(h,{dynamic:!0,normalize:function(a,b){return/^\./.test(a)?b(a):a},load:w,cache:n,getL10nName:q})})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(m,f){var k=
{};f.setObject("dojo.regexp",k);k.escapeString=function(e,g){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(d){return g&&-1!=g.indexOf(d)?d:"\\"+d})};k.buildGroupRE=function(e,g,d){if(!(e instanceof Array))return g(e);for(var h=[],c=0;c<e.length;c++)h.push(g(e[c]));return k.group(h.join("|"),d)};k.group=function(e,g){return"("+(g?"?:":"")+e+")"};return k})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(a,b,c,l){return l.replace(/([a-z])\1*/ig,function(d){var g,n,v=d.charAt(0);d=d.length;var q=["abbr","wide","narrow"];switch(v){case "G":g=b[4>d?"eraAbbr":"eraNames"][0>a.getFullYear()?0:1];break;case "y":g=a.getFullYear();switch(d){case 1:break;case 2:if(!c.fullYear){g=String(g);g=g.substr(g.length-2);break}default:n=!0}break;case "Q":case "q":g=Math.ceil((a.getMonth()+1)/3);n=!0;break;case "M":case "L":g=a.getMonth();3>d?(g+=1,n=!0):(v=["months","L"==v?"standAlone":
"format",q[d-3]].join("-"),g=b[v][g]);break;case "w":g=p._getWeekOfYear(a,0);n=!0;break;case "d":g=a.getDate();n=!0;break;case "D":g=p._getDayOfYear(a);n=!0;break;case "e":case "c":if(g=a.getDay(),2>d){g=(g-e.getFirstDayOfWeek(c.locale)+8)%7;break}case "E":g=a.getDay();3>d?(g+=1,n=!0):(v=["days","c"==v?"standAlone":"format",q[d-3]].join("-"),g=b[v][g]);break;case "a":v=12>a.getHours()?"am":"pm";g=c[v]||b["dayPeriods-format-wide-"+v];break;case "h":case "H":case "K":case "k":n=a.getHours();switch(v){case "h":g=
n%12||12;break;case "H":g=n;break;case "K":g=n%12;break;case "k":g=n||24}n=!0;break;case "m":g=a.getMinutes();n=!0;break;case "s":g=a.getSeconds();n=!0;break;case "S":g=Math.round(a.getMilliseconds()*Math.pow(10,d-3));n=!0;break;case "v":case "z":if(g=p._getZone(a,!0,c))break;d=4;case "Z":v=p._getZone(a,!1,c);v=[0>=v?"+":"-",h.pad(Math.floor(Math.abs(v)/60),2),h.pad(Math.abs(v)%60,2)];4==d&&(v.splice(0,0,"GMT"),v.splice(3,0,":"));g=v.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+
l);}n&&(g=h.pad(g,d));return g})}function l(a,b,c,l){var d=function(a){return a};b=b||d;c=c||d;l=l||d;var e=a.match(/(''|[^'])+/g),h="'"==a.charAt(0);f.forEach(e,function(a,l){a?(e[l]=(h?c:b)(a.replace(/''/g,"'")),h=!h):e[l]=""});return l(e.join(""))}function n(a,b,c,l){l=d.escapeString(l);c.strict||(l=l.replace(" a"," ?a"));return l.replace(/([a-z])\1*/ig,function(l){var d;d=l.charAt(0);var e=l.length,h="",g="";c.strict?(1<e&&(h="0{"+(e-1)+"}"),2<e&&(g="0{"+(e-2)+"}")):(h="0?",g="0{0,2}");switch(d){case "y":d=
"\\d{2,4}";break;case "M":case "L":2<e?(d=b["months-"+("L"==d?"standAlone":"format")+"-"+q[e-3]].slice(0).join("|"),c.strict||(d=d.replace(/\./g,""),d="(?:"+d+")\\.?")):d="1[0-2]|"+h+"[1-9]";break;case "D":d="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+h+"[1-9][0-9]|"+g+"[1-9]";break;case "d":d="3[01]|[12]\\d|"+h+"[1-9]";break;case "w":d="[1-4][0-9]|5[0-3]|"+h+"[1-9]";break;case "E":case "e":case "c":d=".+?";break;case "h":d="1[0-2]|"+h+"[1-9]";break;case "k":d="1[01]|"+h+"\\d";break;case "H":d="1\\d|2[0-3]|"+
h+"\\d";break;case "K":d="1\\d|2[0-4]|"+h+"[1-9]";break;case "m":case "s":d="[0-5]\\d";break;case "S":d="\\d{"+e+"}";break;case "a":e=c.am||b["dayPeriods-format-wide-am"];h=c.pm||b["dayPeriods-format-wide-pm"];d=e+"|"+h;c.strict||(e!=e.toLowerCase()&&(d+="|"+e.toLowerCase()),h!=h.toLowerCase()&&(d+="|"+h.toLowerCase()),-1!=d.indexOf(".")&&(d+="|"+d.replace(/\./g,"")));d=d.replace(/\./g,"\\.");break;default:d=".*"}a&&a.push(l);return"("+d+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var p={};m.setObject(b.id.replace(/\//g,
"."),p);p._getZone=function(a,b,c){return b?k.getTimezoneName(a):a.getTimezoneOffset()};p.format=function(b,c){c=c||{};var d=g.normalizeLocale(c.locale),e=c.formatLength||"short",d=p._getGregorianBundle(d),h=[];b=m.hitch(this,a,b,d,c);if("year"==c.selector)return l(d["dateFormatItem-yyyy"]||"yyyy",b);var n;"date"!=c.selector&&(n=c.timePattern||d["timeFormat-"+e])&&h.push(l(n,b));"time"!=c.selector&&(n=c.datePattern||d["dateFormat-"+e])&&h.push(l(n,b));return 1==h.length?h[0]:d["dateTimeFormat-"+e].replace(/\'/g,
"").replace(/\{(\d+)\}/g,function(a,b){return h[b]})};p.regexp=function(a){return p._parseInfo(a).regexp};p._parseInfo=function(a){a=a||{};var b=g.normalizeLocale(a.locale),b=p._getGregorianBundle(b),c=a.formatLength||"short",d=a.datePattern||b["dateFormat-"+c],e=a.timePattern||b["timeFormat-"+c],c="date"==a.selector?d:"time"==a.selector?e:b["dateTimeFormat-"+c].replace(/\{(\d+)\}/g,function(a,b){return[e,d][b]}),h=[];return{regexp:l(c,m.hitch(this,n,h,b,a)),tokens:h,bundle:b}};p.parse=function(a,
b){var c=/[\u200E\u200F\u202A\u202E]/g,l=p._parseInfo(b),d=l.tokens,e=l.bundle;a=(new RegExp("^"+l.regexp.replace(c,"")+"$",l.strict?"":"i")).exec(a&&a.replace(c,""));if(!a)return null;var h=["abbr","wide","narrow"],g=[1970,0,1,0,0,0,0],n="";a=f.every(a,function(a,c){if(!c)return!0;var l=d[c-1];c=l.length;l=l.charAt(0);switch(l){case "y":if(2!=c&&b.strict)g[0]=a;else if(100>a)a=Number(a),l=""+(new Date).getFullYear(),c=100*l.substring(0,2),l=Math.min(Number(l.substring(2,4))+20,99),g[0]=a<l?c+a:c-
100+a;else{if(b.strict)return!1;g[0]=a}break;case "M":case "L":if(2<c){if(c=e["months-"+("L"==l?"standAlone":"format")+"-"+h[c-3]].concat(),b.strict||(a=a.replace(".","").toLowerCase(),c=f.map(c,function(a){return a.replace(".","").toLowerCase()})),a=f.indexOf(c,a),-1==a)return!1}else a--;g[1]=a;break;case "E":case "e":case "c":c=e["days-"+("c"==l?"standAlone":"format")+"-"+h[c-3]].concat();b.strict||(a=a.toLowerCase(),c=f.map(c,function(a){return a.toLowerCase()}));a=f.indexOf(c,a);if(-1==a)return!1;
break;case "D":g[1]=0;case "d":g[2]=a;break;case "a":c=b.am||e["dayPeriods-format-wide-am"];l=b.pm||e["dayPeriods-format-wide-pm"];if(!b.strict){var v=/\./g;a=a.replace(v,"").toLowerCase();c=c.replace(v,"").toLowerCase();l=l.replace(v,"").toLowerCase()}if(b.strict&&a!=c&&a!=l)return!1;n=a==l?"p":a==c?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":if(23<a)return!1;g[3]=a;break;case "m":g[4]=a;break;case "s":g[5]=a;break;case "S":g[6]=a}return!0});c=+g[3];"p"===n&&12>c?g[3]=c+12:"a"===
n&&12==c&&(g[3]=0);c=new Date(g[0],g[1],g[2],g[3],g[4],g[5],g[6]);b.strict&&c.setFullYear(g[0]);var q=d.join(""),l=-1!=q.indexOf("d"),q=-1!=q.indexOf("M");if(!a||q&&c.getMonth()>g[1]||l&&c.getDate()>g[2])return null;if(q&&c.getMonth()<g[1]||l&&c.getDate()<g[2])c=k.add(c,"hour",1);return c};var q=["abbr","wide","narrow"],r=[],t={};p.addCustomFormats=function(a,b){r.push({pkg:a,name:b});t={}};p._getGregorianBundle=function(a){if(t[a])return t[a];var b={};f.forEach(r,function(c){c=g.getLocalization(c.pkg,
c.name,a);b=m.mixin(b,c)},this);return t[a]=b};p.addCustomFormats(b.id.replace(/\/date\/locale$/,".cldr"),"gregorian");p.getNames=function(a,b,c,l){var d;l=p._getGregorianBundle(l);a=[a,c,b];"standAlone"==c&&(c=a.join("-"),d=l[c],1==d[0]&&(d=void 0));a[1]="format";return(d||l[a.join("-")]).concat()};p.isWeekend=function(a,b){b=e.getWeekend(b);a=(a||new Date).getDay();b.end<b.start&&(b.end+=7,a<b.start&&(a+=7));return a>=b.start&&a<=b.end};p._getDayOfYear=function(a){return k.difference(new Date(a.getFullYear(),
0,1,a.getHours()),a)+1};p._getWeekOfYear=function(a,b){1==arguments.length&&(b=0);var c=(new Date(a.getFullYear(),0,1)).getDay(),l=(c-b+7)%7,l=Math.floor((p._getDayOfYear(a)+l-1)/7);c==b&&l++;return l};return p})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(m,f){var k={};m.setObject("dojo.cldr.supplemental",k);k.getFirstDayOfWeek=function(e){e={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,
br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[k._region(e)];return void 0===e?1:e};k._region=function(e){e=f.normalizeLocale(e);e=e.split("-");var g=e[1];g?4==g.length&&(g=e[2]):g={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",
bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",
kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",
sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",
bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",
hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",
mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",
ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[e[0]];return g};k.getWeekend=
function(e){var g=k._region(e);e={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[g];g={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[g];void 0===e&&(e=6);void 0===g&&(g=0);return{start:e,end:g}};return k})},"esri/core/Message":function(){define(["require","exports","dojo/string"],function(m,f,k){return function(){function e(g,d,h){this instanceof e&&(this.name=g,this.message=d&&k.substitute(d,
h,function(c){return null==c?"":c})||"",this.details=h)}e.prototype.toString=function(){return"["+this.name+"]: "+this.message};return e}()})},"esri/core/has":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(m,f,k,e,g){function d(){var a={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1},b=document.createElement("canvas");
if(!b)return a;var c=g.createContext(b,{failIfMajorPerformanceCaveat:!0},"webgl");!c&&(c=g.createContext(b,{},"webgl"))&&(a.majorPerformanceCaveat=!0);if(!c)return a;b=c.getParameter(c.VERSION);if(!b)return a;if(b=b.match(/^WebGL\s+([\d.]*)/))a.version=parseFloat(b[1]),a.available=.94<=a.version,b=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT),a.supportsHighPrecisionFragment=b&&0<b.precision,a.supportsVertexShaderSamplers=0<c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS),a.supportsElementIndexUint=
null!==c.getExtension("OES_element_index_uint"),a.supportsStandardDerivatives=null!==c.getExtension("OES_standard_derivatives"),a.supportsInstancedArrays=null!==c.getExtension("ANGLE_instanced_arrays");return a}function h(){var a={available:!1,version:0},b=document.createElement("canvas");if(!b)return a;b=g.createContext(b,{},"webgl2");if(!b)return a;a.available=!0;b=b.getParameter(b.VERSION);if(!b)return a;if(b=b.match(/^WebGL\s+([\d.]*)/))a.version=parseFloat(b[1]);return a}var c=null,b=null;(function(){var a=
navigator.userAgent,l=a.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i),a=a.match(/iPhone/i);l&&k.add("esri-mobile",l);a&&k.add("esri-iPhone",a);k.add("esri-geolocation",function(){return!!navigator.geolocation});k.add("esri-canvas-svg-support",function(){return!(k("trident")||k("ie"))});k.add("esri-secure-context",function(){if("isSecureContext"in e)return e.isSecureContext;if(e.location&&e.location.origin)return 0===e.location.origin.indexOf("https:")});k.add("esri-wasm",
"WebAssembly"in e);k("host-webworker")||(k.add("esri-workers","Worker"in e),k.add("esri-url-encodes-apostrophe",function(){var a=e.document.createElement("a");a.href="?'";return-1<a.href.indexOf("?%27")}),c||(c=d()),k.add("esri-webgl",c.available),k.add("esri-webgl-high-precision-fragment",c.supportsHighPrecisionFragment),k.add("esri-webgl-vertex-shader-samplers",c.supportsVertexShaderSamplers),k.add("esri-webgl-element-index-uint",c.supportsElementIndexUint),k.add("esri-webgl-standard-derivatives",
c.supportsStandardDerivatives),k.add("esri-webgl-instanced-arrays",c.supportsInstancedArrays),k.add("esri-webgl-major-performance-caveat",c.majorPerformanceCaveat),k.add("esri-featurelayer-webgl",!0),k.add("esri-featurelayer-webgl-labeling",!0),b||(b=h()),k.add("esri-webgl2",b.available))})();return k})},"esri/views/webgl/context-util":function(){define(["require","exports"],function(m,f){function k(d,c,b){void 0===c&&(c={});var a;switch(b){case "webgl":a=["webgl","experimental-webgl","webkit-3d",
"moz-webgl"];break;case "webgl2":a=["webgl2"];break;default:a=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}b=null;for(var l=0;l<a.length;l++){var e=a[l];try{b=d.getContext(e,c)}catch(p){}if(b)break}return b}function e(d,c){(d=d.parentNode)&&(d.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+c+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}
Object.defineProperty(f,"__esModule",{value:!0});f.createContextOrErrorHTML=function(h,c,b){void 0===c&&(c={});if(!window.WebGLRenderingContext)return e(h,g),null;c=k(h,c,b);return c?c:(e(h,d),null)};f.createContext=k;var g='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',d='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"dojo/main":function(){define("./_base/kernel ./has require ./sniff ./_base/lang ./_base/array ./_base/config ./ready ./_base/declare ./_base/connect ./_base/Deferred ./_base/json ./_base/Color require ./has!host-browser?./_base/browser require".split(" "),function(m,f,k,e,g,d,h,c){h.isDebug&&k(["./_firebug/firebug"]);return m})},"esri/config":function(){define(["require","exports"],function(m,f){m={screenDPI:96,fontsUrl:"https://static.arcgis.com/fonts",geometryService:null,geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",
geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{httpsDomains:"arcgis.com arcgisonline.com esrikr.com premiumservices.blackbridge.com esripremium.accuweather.com gbm.digitalglobe.com firstlook.digitalglobe.com msi.digitalglobe.com".split(" "),interceptors:[],maxUrlLength:2E3,proxyRules:[],proxyUrl:null,timeout:6E4,trustedServers:[],
useIdentity:!0}};m.request.corsEnabledServers=[];m.request.corsEnabledServers.push=function(){console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664");return 0};return m})},"esri/core/Handles":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Accessor ./Collection ./accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=
c.call(this)||this;a._groups=new Map;return a}k(b,c);b.prototype.destroy=function(){this.removeAll()};Object.defineProperty(b.prototype,"size",{get:function(){var a=0;this._groups.forEach(function(b){a+=b.length});return a},enumerable:!0,configurable:!0});b.prototype.add=function(a,b){if(!this._isHandle(a)&&!Array.isArray(a)&&!d.isCollection(a))return this;var c=this._getOrCreateGroup(b);Array.isArray(a)||d.isCollection(a)?a.forEach(function(a){return c.push(a)}):c.push(a);this.notifyChange("size");
return this};b.prototype.has=function(a){return this._groups.has(this._ensureGroupKey(a))};b.prototype.remove=function(a){if(Array.isArray(a)||d.isCollection(a))return a.forEach(this.remove,this),this;if(!this.has(a))return this;for(var b=this._getGroup(a),c=0;c<b.length;c++)b[c].remove();this._deleteGroup(a);this.notifyChange("size");return this};b.prototype.removeAll=function(){this._groups.forEach(function(a){for(var b=0;b<a.length;b++)a[b].remove()});this._groups.clear();this.notifyChange("size");
return this};b.prototype._isHandle=function(a){return a&&!!a.remove};b.prototype._getOrCreateGroup=function(a){if(this.has(a))return this._getGroup(a);var b=[];this._groups.set(this._ensureGroupKey(a),b);return b};b.prototype._getGroup=function(a){return this._groups.get(this._ensureGroupKey(a))};b.prototype._deleteGroup=function(a){return this._groups.delete(this._ensureGroupKey(a))};b.prototype._ensureGroupKey=function(a){return a||"_default_"};e([h.property({readOnly:!0})],b.prototype,"size",null);
return b=e([h.subclass("esri.core.Handles")],b)}(h.declared(g))})},"esri/core/tsSupport/declareExtendsHelper":function(){define(["require","exports"],function(m,f){return function(k,e){k.__bases__=e.__bases__}})},"esri/core/tsSupport/decorateHelper":function(){define([],function(){return function(m,f,k,e){var g=arguments.length,d=3>g?f:null===e?e=Object.getOwnPropertyDescriptor(f,k):e,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(m,f,k,e);else for(var c=m.length-
1;0<=c;c--)if(h=m[c])d=(3>g?h(d):3<g?h(f,k,d):h(f,k))||d;return 3<g&&d&&Object.defineProperty(f,k,d),d}})},"esri/core/Accessor":function(){define("./declare ./accessorSupport/Properties ./accessorSupport/get ./accessorSupport/introspection ./accessorSupport/set ./accessorSupport/watch".split(" "),function(m,f,k,e,g,d){f=f.default;m.before(function(c,b){m.hasMixin(c,h)&&e.processPrototype(b)});m.after(function(c){m.hasMixin(c,h)&&(e.processClass(c),Object.defineProperties(c.prototype,{initialized:{get:function(){return this.__accessor__&&
this.__accessor__.initialized||!1}},constructed:{get:function(){return this.__accessor__&&2===this.__accessor__.lifecycle||!1}},destroyed:{get:function(){return this.__accessor__&&this.__accessor__.destroyed||!1}}}))});var h=m(null,{declaredClass:"esri.core.Accessor","-chains-":{initialize:"after",destroy:"before"},constructor:function(){if(this.constructor===h)throw Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",
{value:new f(this)});if(0<arguments.length&&this.normalizeCtorArgs){for(var c=[],b=0;b<arguments.length;b++)c.push(arguments[b]);this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,c)}},__accessor__:null,postscript:function(c){var b=this.__accessor__;c=b.ctorArgs||c;var a;null!=this.getDefaults&&(a=this.getDefaults(c||{}),this.set(a));b.initialize();c&&(this.set(c),b.ctorArgs=null);b.constructed();this.initialize()},initialize:function(){},destroy:function(){if(this.destroyed)try{throw Error("instance is already destroyed");
}catch(c){console.warn(c.stack)}else d.removeTarget(this),this.__accessor__.destroy()},get:function(c){return k.get(this,c)},hasOwnProperty:function(c){return this.__accessor__?this.__accessor__.has(c):Object.prototype.hasOwnProperty.call(this,c)},keys:function(){return this.__accessor__?this.__accessor__.keys():[]},set:function(c,b){g.set(this,c,b);return this},watch:function(c,b,a){return d.watch(this,c,b,a)},_clearOverride:function(c){return this.__accessor__.clearOverride(c)},_override:function(c,
b){return this.__accessor__.override(c,b)},_isOverridden:function(c){return this.__accessor__.isOverridden(c)},notifyChange:function(c){this.__accessor__.propertyInvalidated(c)},_get:function(c){return this.__accessor__.internalGet(c)},_set:function(c,b){return this.__accessor__.internalSet(c,b)}});return h})},"esri/core/accessorSupport/Properties":function(){define("require exports ../has ../Logger ../ObjectPool ./extensions ./PropertyOrigin ./Store".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,
"__esModule",{value:!0});e.getLogger("esri.core.accessorSupport.Properties");m=function(){function a(a){this.host=a;this._origin=h.OriginId.USER;this.ctorArgs=this.cursors=null;this.destroyed=!1;this.dirties={};this.lifecycle=0;this.overridden=null;this.store=new c.default;a=this.host.constructor.__accessorMetadata__;this.metadatas=a.properties;this.autoDestroy=a.autoDestroy}a.prototype.initialize=function(){this.lifecycle=1;d.instanceCreated(this.host,this.metadatas)};a.prototype.constructed=function(){this.lifecycle=
2};a.prototype.destroy=function(){this.destroyed=!0;var a=this.cursors;if(this.cursors)for(var b=0,c=Object.getOwnPropertyNames(a);b<c.length;b++){var d=c[b],e=a[d];if(e){for(;0<e.length;)e.pop().propertyDestroyed(this,d);a[d]=null}}if(this.autoDestroy)for(d in this.metadatas)(a=this.internalGet(d))&&a&&"function"===typeof a.destroy&&(a.destroy(),this.metadatas[d].nonNullable||this.internalSet(d,null))};Object.defineProperty(a.prototype,"initialized",{get:function(){return 0!==this.lifecycle},enumerable:!0,
configurable:!0});a.prototype.clearOverride=function(a){this.isOverridden(a)&&(this.overridden[a]=!1,this.propertyInvalidated(a))};a.prototype.get=function(a){var b=this.metadatas[a];if(this.store.has(a)&&!this.dirties[a])return this.store.get(a);var c=b.get;return c?(b=c.call(this.host),this.store.set(a,b,h.OriginId.COMPUTED),this.propertyCommitted(a),b):b.value};a.prototype.originOf=function(a){var b=this.store.originOf(a);return void 0===b&&(a=this.metadatas[a])&&a.hasOwnProperty("value")?"defaults":
h.idToName(b)};a.prototype.has=function(a){return this.metadatas[a]?this.store.has(a):!1};a.prototype.internalGet=function(a){if(this.metadatas[a]){var b=this.store;return b.has(a)?b.get(a):this.metadatas[a].value}};a.prototype.internalSet=function(a,b){if(this.metadatas[a]){var c=this.initialized?this._origin:h.OriginId.DEFAULTS,l=this.store.get(a,c);if(b!==l||!this.store.has(a,c)||this.isOverridden(a))this.propertyInvalidated(a),this.store.set(a,b,c),this.propertyCommitted(a)}};a.prototype.isOverridden=
function(a){return null!=this.overridden&&!0===this.overridden[a]};a.prototype.keys=function(){return this.store.keys()};a.prototype.override=function(a,c){if(this.metadatas[a]){this.overridden||(this.overridden={});var l=this.metadatas[a];if(!l.nonNullable||null!=c){if(l=l.cast){c=this.cast(l,c);var l=c.valid,d=c.value;b.release(c);if(!l)return;c=d}this.overridden[a]=!0;this.internalSet(a,c)}}};a.prototype.set=function(a,c){if(this.metadatas[a]){var l=this.metadatas[a];if(!l.nonNullable||null!=c){var d=
l.set;if(l=l.cast){c=this.cast(l,c);var l=c.valid,e=c.value;b.release(c);if(!l)return;c=e}d?d.call(this.host,c):this.internalSet(a,c)}}};a.prototype.setDefaultOrigin=function(a){this._origin=h.nameToId(a)};a.prototype.propertyInvalidated=function(a){var b=this.dirties,c=this.isOverridden(a),l=this.cursors&&this.cursors[a],d=this.metadatas[a].computes;if(l)for(var e=0;e<l.length;e++)l[e].propertyInvalidated(this,a);c||(b[a]=!0);if(d)for(a=0;a<d.length;a++)this.propertyInvalidated(d[a])};a.prototype.propertyCommitted=
function(a){var b=this.cursors&&this.cursors[a];this.dirties[a]=!1;if(b)for(var c=0;c<b.length;c++)b[c].propertyCommitted(this,a)};a.prototype.addCursor=function(a,b){this.cursors||(this.cursors={});var c=this.cursors[a];c||(this.cursors[a]=c=[]);c.push(b)};a.prototype.removeCursor=function(a,b){var c=this.cursors[a];this.cursors[a]&&(c.splice(c.indexOf(b),1),0===c.length&&(this.cursors[a]=null))};a.prototype.cast=function(a,c){var d=b.acquire();d.valid=!0;d.value=c;a&&(d.value=a.call(this.host,c,
d));return d};return a}();k=function(){function a(){this.value=null;this.valid=!0}a.prototype.acquire=function(){this.valid=!0};a.prototype.release=function(){this.value=null};return a}();var b=new g(k);f.default=m})},"esri/core/Logger":function(){define(["require","exports","./has"],function(m,f,k){var e={info:0,warn:1,error:2};m=function(){function g(d){void 0===d&&(d={});this.module=d.module||"";this.writer=d.writer||null;this.level=d.level||null;null!=d.enabled&&(this.enabled=!!d.enabled);g._loggers[this.module]=
this;d=this.module.lastIndexOf(".");-1!==d&&(this.parent=g.getLogger(this.module.slice(0,d)))}g.prototype.log=function(d){for(var e=[],c=1;c<arguments.length;c++)e[c-1]=arguments[c];this._isEnabled()&&this._matchLevel(d)&&(c=this._inheritedWriter())&&c.apply(void 0,[d,this.module].concat(e))};g.prototype.error=function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];this.log.apply(this,["error"].concat(d))};g.prototype.warn=function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];
this.log.apply(this,["warn"].concat(d))};g.prototype.info=function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];this.log.apply(this,["info"].concat(d))};g.prototype.getLogger=function(d){return g.getLogger(this.module+"."+d)};g.getLogger=function(d){var e=g._loggers[d];e||(e=new g({module:d}));return e};g.prototype._parentWithMember=function(d,e){for(var c=this;c&&null==c[d];)c=c.parent;return c?c[d]:e};g.prototype._inheritedWriter=function(){return this._parentWithMember("writer",
this._consoleWriter)};g.prototype._consoleWriter=function(d,e){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];console[d].apply(console,["["+e+"]"].concat(c))};g.prototype._matchLevel=function(d){return e[this._parentWithMember("level","error")]<=e[d]};g.prototype._isEnabled=function(){return this._parentWithMember("enabled",!0)};g._loggers={};return g}();m.getLogger("esri").level="warn";return m})},"esri/core/ObjectPool":function(){define(["require","exports"],function(m,f){var k=function(){return function(){}}();
return function(){function e(e,d,h,c,b){void 0===c&&(c=1);void 0===b&&(b=0);this.classConstructor=e;this.acquireFunctionOrWithConstructor=d;this.releaseFunction=h;this.growthSize=c;!0===d?this.acquireFunction=this._constructorAcquireFunction:"function"===typeof d&&(this.acquireFunction=d);this._pool=Array(b);this._set=new Set;this._initialSize=b;for(e=0;e<b;e++)this._pool[e]=new this.classConstructor;this.growthSize=Math.max(c,1)}e.prototype.acquire=function(){for(var e=[],d=0;d<arguments.length;d++)e[d]=
arguments[d];d=this.classConstructor||k;if(0===this._pool.length)for(var h=this.growthSize,c=0;c<h;c++)this._pool[c]=new d;d=this._pool.pop();this.acquireFunction?this.acquireFunction.apply(this,[d].concat(e)):d&&d.acquire&&"function"===typeof d.acquire&&d.acquire.apply(d,e);this._set.delete(d);return d};e.prototype.release=function(e){e&&!this._set.has(e)&&(this.releaseFunction?this.releaseFunction(e):e&&e.release&&"function"===typeof e.release&&e.release(),this._pool.push(e),this._set.add(e))};
e.prototype.prune=function(e){void 0===e&&(e=this._initialSize);if(!(this._pool.length<=e))for(var d;e>this._pool.length;)d=this._pool.shift(),this._set.delete(d),d.dispose&&"function"===typeof d.dispose&&d.dispose()};e.prototype._constructorAcquireFunction=function(e){for(var d=[],h=1;h<arguments.length;h++)d[h-1]=arguments[h];var c;(c=this.classConstructor).call.apply(c,[e].concat(d))};return e}()})},"esri/core/accessorSupport/extensions":function(){define(["require","exports","./extensions/aliasedProperty",
"./extensions/computedProperty","./extensions/serializableProperty"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=[k.default,e.default,g.default];f.processPrototypeMetadatas=function(e,c){for(var b=Object.getOwnPropertyNames(e),a=0;a<d.length;a++){var l=d[a];if(l.processPrototypePropertyMetadata)for(var h=0,g=b;h<g.length;h++){var q=g[h];l.processPrototypePropertyMetadata(q,e[q],e,c)}}};f.processClassMetadatas=function(e,c){for(var b=Object.getOwnPropertyNames(e),a=0;a<
d.length;a++){var l=d[a];if(l.processClassPropertyMetadata)for(var h=0,g=b;h<g.length;h++){var q=g[h];l.processClassPropertyMetadata(q,e[q],e,c)}}};f.instanceCreated=function(e,c){for(var b=Object.getOwnPropertyNames(c),a=0;a<d.length;a++){var l=d[a];l.instanceCreated&&l.instanceCreated(e,c,b)}}})},"esri/core/accessorSupport/extensions/aliasedProperty":function(){define("require exports ../../has ../get ../set ../utils ../wire".split(" "),function(m,f,k,e,g,d,h){function c(b,a,c){var l=d.getProperties(b);
return h.wire(b,c.aliasOf,function(){l.propertyInvalidated(a)})}Object.defineProperty(f,"__esModule",{value:!0});f.AliasedPropertyExtension={processClassPropertyMetadata:function(b,a,c,d){var l=a.aliasOf;if(l&&(b=l.split(".")[0],null!=c[b]&&!a.set&&!a.get)){var h;a.get=function(){var a=e.default(this,l);if("function"===typeof a){h||(h=l.split(".").slice(0,-1).join("."));var b=e.default(this,h);b&&(a=a.bind(b))}return a};a.readOnly||(a.set=function(a){return g.default(this,l,a)})}},instanceCreated:function(b,
a,d){for(var l=0;l<d.length;l++){var e=d[l],h=a[e];h.aliasOf&&c(b,e,h)}}};f.default=f.AliasedPropertyExtension})},"esri/core/accessorSupport/get":function(){define(["require","exports","./utils"],function(m,f,k){function e(c,b,a){if(null!=a.getItemAt||Array.isArray(a)){var d=parseInt(c,10);if(!isNaN(d))return Array.isArray(a)?a[d]:a.getItemAt(d)}d=k.getProperties(a);return b?k.isPropertyDeclared(d,c)?d.get(c):a[c]:k.isPropertyDeclared(d,c)?d.internalGet(c):a[c]}function g(c,b,a,d){if(null==c)return c;
if((c=e(b[d],a,c))||!(d<b.length-1))return d===b.length-1?c:g(c,b,a,d+1)}function d(c,b,a,d){void 0===a&&(a=!1);void 0===d&&(d=0);return"string"===typeof b&&-1===b.indexOf(".")?e(b,a,c):g(c,k.pathToArray(b),a,d)}function h(c,b){return d(c,b,!0)}Object.defineProperty(f,"__esModule",{value:!0});f.valueOf=d;f.get=h;f.exists=function(c,b){return void 0!==d(b,c,!0)};f.default=h})},"esri/core/accessorSupport/utils":function(){define(["require","exports","../lang"],function(m,f,k){function e(c,b,a){return b?
Object.keys(b).reduce(function(c,d){var l=null,h="merge";a&&(l=a.path?a.path+"."+d:d,h=a.policy(l));if("replace"===h)return c[d]=b[d],c;if(void 0===c[d])return c[d]=k.clone(b[d]),c;var g=c[d],h=b[d];if(g===h)return c;if(Array.isArray(h)||Array.isArray(c))g=g?Array.isArray(g)?c[d]=g.concat():c[d]=[g]:c[d]=[],h&&(Array.isArray(h)||(h=[h]),h.forEach(function(a){-1===g.indexOf(a)&&g.push(a)}));else if(h&&"object"===typeof h)if(a){var n=a.path;a.path=l;c[d]=e(g,h,a);a.path=n}else c[d]=e(g,h,null);else if(!c.hasOwnProperty(d)||
b.hasOwnProperty(d))c[d]=h;return c},c||{}):c}function g(c){return Array.isArray(c)?c:c.split(".")}function d(c){if(Array.isArray(c)||-1<c.indexOf(",")){c=Array.isArray(c)?c:c.split(",");for(var b=0;b<c.length;b++)c[b]=c[b].trim();return 1===c.length?c[0]:c}return c.trim()}function h(c){var b=!1;return function(){b||(b=!0,c())}}Object.defineProperty(f,"__esModule",{value:!0});f.getProperties=function(c){return c?c.__accessor__?c.__accessor__:c.propertyInvalidated?c:null:null};f.isPropertyDeclared=
function(c,b){return c&&c.metadatas&&null!=c.metadatas[b]};f.merge=function(c,b,a){return a?e(c,b,{policy:a,path:""}):e(c,b,null)};f.pathToStringOrArray=function(c){return c?"string"===typeof c&&-1===c.indexOf(".")?c:g(c):c};f.pathToArray=g;f.splitPath=d;f.parseConditionalPath=function(c){if(-1===c.indexOf("?"))return null;c=g(c);for(var b=Array(c.length),a=0;a<c.length;a++){var d=c[a];b[a]="?"===d[d.length-1];b[a]&&(c[a]=d.slice(0,-1))}return{fullPath:c.join("."),conditional:b}};f.parse=function(c,
b,a,l){b=d(b);if(Array.isArray(b)){var e=b.map(function(b){return l(c,b.trim(),a)});return{remove:h(function(){return e.forEach(function(a){return a.remove()})})}}return l(c,b.trim(),a)};f.once=h})},"esri/core/accessorSupport/set":function(){define(["require","exports","../has","../Logger","./get"],function(m,f,k,e,g){function d(e,c,b){if(e&&c)if("object"===typeof c){b=0;for(var a=Object.getOwnPropertyNames(c);b<a.length;b++){var l=a[b];d(e,l,c[l])}}else"_"!==c[0]&&(-1!==c.indexOf(".")?(c=c.split("."),
l=c.splice(c.length-1,1)[0],d(g.default(e,c),l,b)):e[c]=b)}Object.defineProperty(f,"__esModule",{value:!0});e.getLogger("esri.core.accessorSupport.set");f.set=d;f.default=d})},"esri/core/accessorSupport/wire":function(){define(["require","exports","./utils"],function(m,f,k){function e(a,d,e){d=k.splitPath(d);if(Array.isArray(d)){for(var l=[],h=0;h<d.length;h++)l.push((new g(d[h],e)).install(a));return new c(l)}a=(new g(d,e)).install(a);return new b(a)}Object.defineProperty(f,"__esModule",{value:!0});
var g=function(){function a(a,b){this.path=a;this.callback=b;this.conditional=this.chain=null;if(-1<a.indexOf(".")){if(a=k.parseConditionalPath(a))this.path=a.fullPath,this.conditional=a.conditional;this.chain=k.pathToArray(this.path)}this.callback=b;return this}a.prototype.install=function(a){a=this.chain?new h(this,a):new d(this,a);return a};a.prototype.notify=function(a){this.callback(a,this.path)};return a}(),d=function(){function a(a,b){this.binding=a;this.target=b;k.getProperties(b).addCursor(this.binding.path,
this)}a.prototype.destroy=function(){this.target&&(k.getProperties(this.target).removeCursor(this.binding.path,this),this.target=this.binding=null)};a.prototype.propertyDestroyed=function(a,b){k.getProperties(this.target).removeCursor(b,this)};a.prototype.propertyInvalidated=function(a,b){this.binding&&this.binding.notify(this.target)};a.prototype.propertyCommitted=function(a,b){this.binding&&this.binding.notify(this.target)};return a}(),h=function(){function a(a,b){this.binding=a;this.target=b;this.stack=
[];this.properties=k.getProperties(b);this.stack.push({properties:this.properties,propertyName:a.chain[0]});this.properties.addCursor(a.chain[0],this);this.moveForward();return this}a.prototype.destroy=function(){for(;;){var a=this.stack.pop();if(null==a)break;a.properties.removeCursor(a.propertyName,this)}this.target=this.binding=null};a.prototype.propertyDestroyed=function(a,b){this.moveBackward(a,b)};a.prototype.propertyInvalidated=function(a,b){this.binding&&this.binding.notify(this.target)};
a.prototype.propertyCommitted=function(a,b){this.binding&&(this.moveBackward(a,b),this.moveForward(),this.binding.notify(this.target))};a.prototype.moveBackward=function(a,b){for(var c=this.stack,d=c[c.length-1];d.properties!==a&&d.propertyName!==b;)d.properties.removeCursor(d.propertyName,this),c.pop(),d=c[c.length-1]};a.prototype.moveForward=function(){var a=this.stack,b=a[a.length-1],b=b.properties.internalGet(b.propertyName);if((b=k.getProperties(b))&&a.length<this.binding.chain.length){var c=
this.binding.chain[a.length];this.binding.conditional&&this.binding.conditional[a.length]&&!b.metadatas[c]||(this.stack.push({properties:b,propertyName:c}),b.addCursor(c,this),this.moveForward())}};return a}(),c=function(){function a(a){this.cursors=a}a.prototype.remove=function(){for(var a=this.cursors;0<a.length;)a.pop().destroy();this.cursors=null};return a}(),b=function(){function a(a){this.cursor=a}a.prototype.remove=function(){this.cursor.destroy();this.cursor=null};return a}();f.create=function(a,
d){a=k.splitPath(a);if(Array.isArray(a)){for(var l=[],e=0;e<a.length;e++)l.push(new g(a[e],d));return function(a){for(var b=[],d=0;d<l.length;d++)b[d]=l[d].install(a);return new c(b)}}var h=new g(a,d);return function(a){return new b(h.install(a))}};f.wire=e;f.default=e})},"esri/core/accessorSupport/extensions/computedProperty":function(){define("require exports ../../has ../../Logger ../utils ../wire".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});e.getLogger("esri.core.accessorSupport.extensions.computedProperty");
f.ComputedPropertyExtension={processClassPropertyMetadata:function(e,c,b,a){c.dependsOn&&(b=void 0,b=c.dependsOn.slice())&&(c.wire=d.create(b,function(a){return g.getProperties(a).propertyInvalidated(e)}))},instanceCreated:function(d,c,b){for(var a=0;a<b.length;a++){var l=c[b[a]];l.wire&&l.wire(d)}}};f.default=f.ComputedPropertyExtension})},"esri/core/accessorSupport/extensions/serializableProperty":function(){define("require exports ../ensureType ./serializableProperty/originAliases ./serializableProperty/reader ./serializableProperty/shorthands ./serializableProperty/writer".split(" "),
function(m,f,k,e,g,d,h){function c(b,a,c){var d=b&&b.json;b&&b.json&&b.json.origins&&c&&(b=b.json.origins[c.origin])&&a in b&&(d=b);return d}Object.defineProperty(f,"__esModule",{value:!0});f.originSpecificReadPropertyDefinition=function(b,a){return c(b,"read",a)};f.originSpecificWritePropertyDefinition=function(b,a){return c(b,"write",a)};f.SerializablePropertyExtension={processPrototypePropertyMetadata:function(b,a,c,n){if(d.process(a)){e.process(a);c=a.type;n=0;if(!k.isOneOf(c))for(;Array.isArray(c);)c=
c[0],n++;if(a.json.origins)for(var l in a.json.origins){var q=a.json.origins[l];g.create(c,n,b,q);h.create(c,n,b,q)}g.create(c,n,b,a.json);h.create(c,n,b,a.json)}}};f.default=f.SerializablePropertyExtension})},"esri/core/accessorSupport/ensureType":function(){define(["require","exports","../Logger"],function(m,f,k){function e(a,b){return b.isInstanceOf?b.isInstanceOf(a):b instanceof a}function g(a){return null==a?a:new Date(a)}function d(a){return null==a?a:!!a}function h(a){return null==a?a:a.toString()}
function c(a){return null==a?a:parseFloat(a)}function b(a){return null==a?a:Math.round(parseFloat(a))}function a(a){return a&&a.constructor&&void 0!==a.constructor._meta}function l(a,b){return null!=b&&a&&!e(a,b)}function n(a){return a&&("isCollection"in a||a._meta&&a._meta.bases&&a._meta.bases.some(function(a){return"isCollection"in a}))}function p(a){return a&&a.Type?"function"===typeof a.Type?a.Type:a.Type.base:null}function q(a,b){if(!b||!b.constructor||!n(b.constructor))return r(a,b)?b:new a(b);
var c=p(a.prototype.itemType),d=p(b.constructor.prototype.itemType);if(!c)return b;if(!d)return new a(b);if(c===d)return b;if((d=d._meta&&d._meta.bases)&&-1!==d.indexOf(c))return new a(b);r(a,b);return b}function r(b,c){return a(c)?(B.error("Accessor#set","Assigning an instance of '"+(c.declaredClass||"unknown")+"' which is not a subclass of '"+(b&&b.prototype&&b.prototype.declaredClass||"unknown")+"'"),!0):!1}function t(a,b){return null==b?b:n(a)?q(a,b):l(a,b)?r(a,b)?b:new a(b):b}function w(a){switch(a){case Number:return c;
case C:return b;case Boolean:return d;case String:return h;case Date:return g;default:return t.bind(null,a)}}function u(a,b){var c=w(a);return 1===arguments.length?c:c(b)}function x(a,b){return 1===arguments.length?x.bind(null,a):b?Array.isArray(b)?b.map(a):[a(b)]:b}function v(a,b,c){return 0!==b&&Array.isArray(c)?c.map(function(c){return v(a,b-1,c)}):a(c)}function z(a,b,c){if(2===arguments.length)return z.bind(null,a,b);if(!c)return c;c=v(a,b,c);for(var d=b,l=c;0<d&&Array.isArray(l);)d--,l=l[0];
if(void 0!==l)for(l=0;l<d;l++)c=[c];return c}function y(a,b){if(2===arguments.length)return y(a).call(null,b);for(var c=new Set,d=0;d<a.length;d++)c.add(a[d]);var l=null;return function(b,d){if(null==b)return b;c.has(b)||(l||(l=a.map(function(a){return"string"===typeof a?"'"+a+"'":""+a}).join(", ")),B.error("Accessor#set","'"+b+"' is not a valid value for this property, only the following values are valid: "+l),d&&(d.valid=!1));return b}}function A(b,c){if(2===arguments.length)return A(b).call(null,
c);var d={},e=[],h=[],g;for(g in b.typeMap){var n=b.typeMap[g];d[g]=u(n);e.push(n&&n.prototype&&n.prototype.declaredClass||"unknown");h.push(g)}var v="string"===typeof b.key?function(a){return a[b.key]}:b.key;return function(c){if(b.base&&!l(b.base,c))return c;var g=v(c)||b.defaultKeyValue,n=d[g];if(!n)return B.error("Accessor#set","Invalid property value, value needs to be one of "+("'"+e.join("', '")+"'")+", or a plain object that can autocast (having .type \x3d "+("'"+h.join("', '")+"'")+")"),
null;if(!l(b.typeMap[g],c))return c;if("string"!==typeof b.key||a(c))return n(c);var g={},p;for(p in c)p!==b.key&&(g[p]=c[p]);return n(g)}}Object.defineProperty(f,"__esModule",{value:!0});var B=k.getLogger("esri.core.Accessor");f.isInstanceOf=e;f.ensureDate=g;f.ensureBoolean=d;f.ensureString=h;f.ensureNumber=c;f.ensureInteger=b;f.isClassedType=a;f.requiresType=l;f.ensureClass=t;f.ensureType=u;f.ensureArrayTyped=x;f.ensureArray=function(a,b){return 1===arguments.length?x(u.bind(null,a)):x(u.bind(null,
a),b)};f.ensureNArrayTyped=z;f.ensureNArray=function(a,b,c){return 2===arguments.length?z(u.bind(null,a),b):z(u.bind(null,a),b,c)};f.isOneOf=function(a){if(!Array.isArray(a))return!1;a=typeof a[0];return"string"===a||"number"===a};f.ensureOneOf=y;f.ensureOneOfType=A;var C=function(){return function(){}}();f.Integer=C;f.default=u})},"esri/core/accessorSupport/extensions/serializableProperty/originAliases":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});
f.process=function(k){if(k.json&&k.json.origins){var e=k.json.origins,g={"web-document":["web-scene","web-map"]};k=function(d){if(e[d]){var c=e[d];g[d].forEach(function(b){e[b]=c});delete e[d]}};for(var d in g)k(d)}}})},"esri/core/accessorSupport/extensions/serializableProperty/reader":function(){define(["require","exports","../../../object","./type"],function(m,f,k,e){function g(l,e,h,g){if(1<e)return c(l,e);if(1===e)return b(l);if(a(l)){var n=b(l.prototype.itemType.Type);return function(a,b,c){return(a=
n(a,b,c))?new l(a):a}}return d(l)}function d(a){return a.prototype.read?function(b,c,d){return null==b?b:(new a).read(b,d)}:a.fromJSON}function h(a,b,c,d){return 0!==d&&Array.isArray(b)?b.map(function(b){return h(a,b,c,d-1)}):a(b,null,c)}function c(a,b){a=d(a);var c=h.bind(null,a);return function(a,d,l){if(null==a)return a;a=c(a,l,b);d=b;for(l=a;0<d&&Array.isArray(l);)d--,l=l[0];if(void 0!==l)for(l=0;l<d;l++)a=[a];return a}}function b(a){var b=d(a);return function(a,c,d){return null==a?a:Array.isArray(a)?
a.map(function(a){return b(a,null,d)}):[b(a,null,d)]}}function a(a){return e.isCollection(a)?(a=a.prototype.itemType)&&a.Type&&"function"===typeof a.Type?l(a.Type):!1:!1}function l(b){return Array.isArray(b)?!1:!!b&&b.prototype&&("read"in b.prototype||"fromJSON"in b||a(b))}Object.defineProperty(f,"__esModule",{value:!0});f.create=function(a,b,c,d){(!d.read||!d.read.reader&&!1!==d.read.enabled)&&l(a)&&k.setDeepValue("read.reader",g(a,b,c,d),d)}})},"esri/core/object":function(){define(["require","exports"],
function(m,f){function k(e,g,d){for(var h=0;h<e.length;h++){var c=e[h];if(!(c in d))if(g)d[c]={};else return;d=d[c]}return d}Object.defineProperty(f,"__esModule",{value:!0});f.getDeepValue=function(e,g){return k(e.split("."),!1,g)};f.setDeepValue=function(e,g,d){var h=e.split(".");e=h.pop();(d=k(h,!0,d))&&e&&(d[e]=g)}})},"esri/core/accessorSupport/extensions/serializableProperty/type":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.isCollection=
function(k){return!!k&&k.prototype&&k.prototype.declaredClass&&0===k.prototype.declaredClass.indexOf("esri.core.Collection")}})},"esri/core/accessorSupport/extensions/serializableProperty/shorthands":function(){define(["require","exports"],function(m,f){function k(e){"boolean"===typeof e.read?e.read={enabled:e.read}:"function"===typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"===typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function e(e){"boolean"===typeof e.write?e.write=
{enabled:e.write}:"function"===typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"===typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}Object.defineProperty(f,"__esModule",{value:!0});f.process=function(g){g.json||(g.json={});k(g.json);e(g.json);if(g.json.origins)for(var d in g.json.origins)k(g.json.origins[d]),e(g.json.origins[d]);return!0}})},"esri/core/accessorSupport/extensions/serializableProperty/writer":function(){define(["require","exports","../../../object",
"./type"],function(m,f,k,e){function g(a,b,c,e){k.setDeepValue(c,d(a,e),b)}function d(a,b){return a&&"function"===typeof a.write?a.write({},b):a&&"function"===typeof a.toJSON?a.toJSON():"number"===typeof a?-Infinity===a?-Number.MAX_VALUE:Infinity===a?Number.MAX_VALUE:isNaN(a)?null:a:a}function h(a,b,c,e){null===a?a=null:a&&"function"===typeof a.map?(a=a.map(function(a){return d(a,e)}),"function"===typeof a.toArray&&(a=a.toArray())):a=[d(a,e)];k.setDeepValue(c,a,b)}function c(a,b,e){return 0!==e&&
Array.isArray(a)?a.map(function(a){return c(a,b,e-1)}):d(a,b)}function b(a){return function(b,d,e,h){if(null===b)b=null;else{b=c(b,h,a);h=a;for(var l=b;0<h&&Array.isArray(l);)h--,l=l[0];if(void 0!==l)for(l=0;l<h;l++)b=[b]}k.setDeepValue(e,b,d)}}Object.defineProperty(f,"__esModule",{value:!0});f.create=function(a,c,d,p){p.write&&!p.write.writer&&!1!==p.write.enabled&&(1===c||e.isCollection(a)?p.write.writer=h:p.write.writer=1<c?b(c):g)}})},"esri/core/accessorSupport/PropertyOrigin":function(){define(["require",
"exports"],function(m,f){function k(d){switch(d){case "defaults":return g.DEFAULTS;case "service":return g.SERVICE;case "portal-item":return g.PORTAL_ITEM;case "web-scene":return g.WEB_SCENE;case "web-map":return g.WEB_MAP;case "user":return g.USER}}function e(d){switch(d){case g.DEFAULTS:return"defaults";case g.SERVICE:return"service";case g.PORTAL_ITEM:return"portal-item";case g.WEB_SCENE:return"web-scene";case g.WEB_MAP:return"web-map";case g.USER:return"user"}}Object.defineProperty(f,"__esModule",
{value:!0});var g;(function(d){d[d.DEFAULTS=0]="DEFAULTS";d[d.COMPUTED=1]="COMPUTED";d[d.SERVICE=2]="SERVICE";d[d.PORTAL_ITEM=3]="PORTAL_ITEM";d[d.WEB_SCENE=4]="WEB_SCENE";d[d.WEB_MAP=5]="WEB_MAP";d[d.USER=6]="USER";d[d.NUM=7]="NUM"})(g=f.OriginId||(f.OriginId={}));f.nameToId=k;f.idToName=e;f.readableNameToId=function(d){return k(d)};f.idToReadableName=function(d){return e(d)};f.writableNameToId=function(d){return k(d)};f.idToWritableName=function(d){return e(d)}})},"esri/core/accessorSupport/Store":function(){define(["require",
"exports","./PropertyOrigin"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(){this._values={}}e.prototype.get=function(e){return this._values[e]};e.prototype.originOf=function(e){return k.OriginId.USER};e.prototype.keys=function(){return Object.keys(this._values)};e.prototype.set=function(e,d){this._values[e]=d};e.prototype.clear=function(e){delete this._values[e]};e.prototype.has=function(e){return e in this._values};return e}();f.default=m})},"esri/core/accessorSupport/introspection":function(){define("require exports ../object ./ensureType ./extensions ./metadata ./utils ./decorators/cast".split(" "),
function(m,f,k,e,g,d,h,c){function b(a){return q.test(a)?"replace":"merge"}Object.defineProperty(f,"__esModule",{value:!0});var a=Object.prototype.hasOwnProperty,l=/^_([a-zA-Z0-9]+)(Getter|Setter|Reader|Writer|Caster)$/,n={Getter:"get",Setter:"set",Reader:"json.read.reader",Writer:"json.write.writer",Caster:"cast"},p=/^_(set|get)([a-zA-Z0-9]+)Attr$/;f.processPrototype=function(b){for(var c=b.declaredClass,q=b.properties||{},u=0,r=Object.getOwnPropertyNames(q);u<r.length;u++){var v=r[u],z=q[v],y=typeof z;
null==z?d.setPropertyMetadata(b,v,{value:z}):Array.isArray(z)?d.setPropertyMetadata(b,v,{type:[z[0]],value:null}):"object"===y?h.getProperties(z)||z instanceof Date?d.setPropertyMetadata(b,v,{type:z.constructor,value:z}):d.setPropertyMetadata(b,v,z):"boolean"===y?d.setPropertyMetadata(b,v,{type:Boolean,value:z}):"string"===y?d.setPropertyMetadata(b,v,{type:String,value:z}):"number"===y?d.setPropertyMetadata(b,v,{type:Number,value:z}):"function"===y&&d.setPropertyMetadata(b,v,{type:z,value:null})}u=
0;for(r=Object.getOwnPropertyNames(b);u<r.length;u++){var y=r[u],z=b[y],q=v=void 0,f=l.exec(y);if(f)v=f[1],q=n[f[2]];else if(f=p.exec(y))v=f[2][0].toLowerCase()+f[2].substr(1),q=f[1].toLowerCase();v&&q&&(v=d.getPropertyMetadata(b,v),k.setDeepValue(q,z,v))}u=0;for(r=Object.getOwnPropertyNames(d.getPropertiesMetadata(b));u<r.length;u++)if(v=r[u],z=d.getPropertyMetadata(b,v),q=z.type,y=z.types,void 0===z.value&&a.call(b,v)&&(z.value=b[v]),!z.cast&&q){v=z;if(e.isOneOf(q))q=e.ensureOneOf(q);else{z=0;for(y=
q;Array.isArray(y);)y=y[0],z++;q=1===z?e.ensureArray(y):1<z?e.ensureNArray(y,z):e.ensureType(q)}v.cast=q}else!z.cast&&y&&(Array.isArray(y)?z.cast=e.ensureArrayTyped(e.ensureOneOfType(y[0])):z.cast=e.ensureOneOfType(y));g.processPrototypeMetadatas(d.getPropertiesMetadata(b),c);return d.getPropertiesMetadata(b)};var q=/^properties\.[^.]+\.(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;f.processClass=function(a){for(var e=a.prototype,l=e.declaredClass,n=a._meta.bases,p={},v=n.length-1;0<=
v;v--)h.merge(p,d.getMetadata(n[v].prototype),b);var q=p.properties;g.processClassMetadatas(q,l);Object.defineProperty(a,"__accessorMetadata__",{value:{properties:q,autoDestroy:!!p.autoDestroy}});for(var k={},l=function(a){var b=q[a];k[a]={enumerable:!0,configurable:!0,get:function(){return this.__accessor__?this.__accessor__.get(a):b.value},set:function(c){var d=this.__accessor__;if(!d)Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:c});else if(!Object.isFrozen(this)){if(d.initialized&&
b.readOnly)throw new TypeError("[accessor] cannot assign to read-only property '"+a+"' of "+this.declaredClass);if(2===d.lifecycle&&b.constructOnly)throw new TypeError("[accessor] cannot assign to construct-only property '"+a+"' of "+this.declaredClass);d.set(a,c)}}}},n=0,v=Object.getOwnPropertyNames(q);n<v.length;n++)l(v[n]);Object.defineProperties(a.prototype,k);if(p.parameters)for(a=0,l=Object.getOwnPropertyNames(p.parameters);a<l.length;a++)n=l[a],v=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]},
(v=c.autocastMethod(e,n,v))&&Object.defineProperty(e,n,v);return p}})},"esri/core/accessorSupport/metadata":function(){define(["require","exports"],function(m,f){function k(c){return null!=c.__accessorMetadata__}function e(c){return k(c)&&null!=g(c).properties}function g(c){c.__accessorMetadata__||Object.defineProperty(c,"__accessorMetadata__",{value:{},enumerable:!0,configurable:!0,writable:!0});return c.__accessorMetadata__}function d(c){c=g(c);var b=c.properties;b||(b=c.properties={});return b}
function h(c,b){var a=g(c);c=a.parameters;c||(c=a.parameters={});a=c[b];a||(a=[],c[b]=a);return a}Object.defineProperty(f,"__esModule",{value:!0});f.hasMetadata=k;f.hasPropertiesMetadata=e;f.hasPropertyMetadata=function(c,b){return e(c)&&null!=d(c)[b]};f.hasParametersMetadata=function(c,b){return k(c)&&null!=g(c).parameters&&null!=g(c).parameters[b]};f.getMetadata=g;f.getPropertiesMetadata=d;f.getPropertyMetadata=function(c,b){c=d(c);var a=c[b];a||(a=c[b]={});return a};f.setPropertyMetadata=function(c,
b,a){d(c)[b]=a};f.getParametersMetadata=h;f.getParameterMetadata=function(c,b,a){var d=h(c,b)[a];d||(h(c,b)[a]=d={index:a});return d}})},"esri/core/accessorSupport/decorators/cast":function(){define(["require","exports","../ensureType","../metadata"],function(m,f,k,e){function g(a){var b="_meta"in a?k.ensureType(a):a;return function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a.push(b);return"number"===typeof a[2]?h.apply(this,a):d.apply(this,a)}}function d(a,b,c,d){e.getPropertyMetadata(a,
b).cast=d}function h(a,b,c,d){e.getParameterMetadata(a,b,c).cast=d}function c(a){return function(b,c,d){e.getPropertyMetadata(b,a).cast=b[c]}}Object.defineProperty(f,"__esModule",{value:!0});var b=Object.prototype.toString;f.autocastMethod=function(a,b,c){if(e.hasParametersMetadata(a,b)){var d=e.getParametersMetadata(a,b).filter(function(a){return null!=a.cast});if(d.length){var l=c.value;c.value=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(b=0;b<d.length;b++){var c=d[b];
a[c.index]=c.cast(a[c.index])}return l.apply(this,a)};return c}console.warn("Method "+a.declaredClass+"::"+b+" is decorated with @cast but no parameters are decorated")}};f.cast=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];if(3!==a.length||"string"!==typeof a[1]){if(1===a.length&&"[object Function]"===b.call(a[0]))return g(a[0]);if(1===a.length&&"string"===typeof a[0])return c(a[0])}}})},"esri/core/accessorSupport/watch":function(){define("require exports ../ArrayPool ../lang ../ObjectPool ../scheduling ./get ./utils ./wire".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(a){u.has(a)?x.splice(x.indexOf(a),1):u.add(a);x.push(a);v||(v=d.schedule(n))}function l(a){if(!a.removed){var b=a.callback,c=a.path,d=a.oldValue,l=a.target,g=h.valueOf(l,a.propertyPath,!0);e.equals(d,g)||(a.oldValue=g,b.call(l,g,d,c,l))}}function n(){if(v){v=null;var a=x;x=w.acquire();u.clear();for(var b=w.acquire(),c=0;c<a.length;c++){var d=a[c];l(d);d.removed&&b.push(d)}for(c=0;c<x.length;c++)d=x[c],d.removed&&(b.push(d),u.delete(d),x.splice(c,1),--c);for(c=
0;c<b.length;c++)t.pool.release(b[c]);w.release(a);w.release(b);z.forEach(function(a){return a()})}}function p(d,e,l){var g=c.parse(d,e,l,function(d,e,l){var n=h.valueOf(d,e,!0),v,p=b.wire(d,e,function(b,c){b.__accessor__.destroyed?g.remove():(v||(v=t.pool.acquire(b,c,n,l),n=null),a(v))});return{remove:c.once(function(){p.remove();v&&(v.removed=!0,a(v),v=null);g=p=n=null})}});return g}function q(a,d,l){var g=c.parse(a,d,l,function(a,c,d){var l=h.valueOf(a,c,!0),n=!1;return b.wire(a,c,function(a,b){if(a.__accessor__.destroyed)g.remove();
else if(!n){n=!0;var c=h.valueOf(a,b,!0);e.equals(l,c)||d.call(a,c,l,b,a);l=h.valueOf(a,b,!0);n=!1}})});return g}function r(a,b,c,d){void 0===d&&(d=!1);return!a.__accessor__||a.__accessor__.destroyed?{remove:function(){}}:d?q(a,b,c):p(a,b,c)}Object.defineProperty(f,"__esModule",{value:!0});var t=function(){function a(a,b,d,e){this.target=a;this.path=b;this.oldValue=d;this.callback=e;this.removed=!1;this.propertyPath=c.pathToStringOrArray(b)}a.prototype.release=function(){this.target=this.path=this.propertyPath=
this.callback=this.oldValue=null;this.removed=!0};a.pool=new g(a,!0);return a}(),w=new k,u=new Set,x=w.acquire(),v;f.dispatchTarget=function(a){for(var b=w.copy(x),c=0;c<b.length;c++){var d=b[c];d.target===a&&(l(d),u.delete(d),x.splice(x.indexOf(d),1))}};f.removeTarget=function(a){for(var b=0;b<x.length;b++){var c=x[b];c.target===a&&(c.removed=!0)}};f.dispatch=n;var z=new Set;f.afterDispatch=function(a){z.add(a);return{remove:function(){z.delete(a)}}};f.watch=r;f.isValueInUse=function(a){return x.some(function(b){return b.oldValue===
a})};f.default=r})},"esri/core/ArrayPool":function(){define(["require","exports","./ObjectPool"],function(m,f,k){function e(d){d.length=0}var g=Array.prototype.splice;m=function(){function h(c,b){void 0===c&&(c=50);void 0===b&&(b=50);this._pool=new k(Array,!1,e,b,c)}h.prototype.acquire=function(){return this._pool.acquire()};h.prototype.copy=function(c){var b=this.acquire();c.unshift(0,0);g.apply(b,c);c.splice(0,2);return b};h.prototype.release=function(c){this._pool.release(c)};h.acquire=function(){return d.acquire()};
h.copy=function(c){return d.copy(c)};h.release=function(c){return d.release(c)};return h}();var d=new m(100);return m})},"esri/core/scheduling":function(){define(["require","exports","./nextTick","./now","./requestAnimationFrame"],function(m,f,k,e,g){function d(a){void 0===a&&(a=f.now());f.debug.rafId=null;0<v.length&&(f.debug.rafId=h());if(0<p){var b=a-p;t=Math.min(b,t);if(b<q)return}f.debug.executeFrameTasks(a)}function h(){return f.debug.requestNextFrame?f.debug.requestNextFrame(a):a()}function c(){for(var a=
0;a<v.length;){var b=v[a];a++;if(b.removed){v.splice(a-1,1);for(var c=0;c<u.length;c++){var d=u[c];if(b.phases[d]){var d=z[d],e=d.indexOf(b);-1!==e&&d.splice(e,1)}}}}}function b(){for(;x.length;){var a=x.shift();a.isActive&&(a.isActive=!1,a.callback())}f.debug.willDispatch=!1}function a(){return g(d)}Object.defineProperty(f,"__esModule",{value:!0});f.now=e;var l=function(){return function(a){this.phases=a;this.paused=!1;this.pausedAt=0;this.epoch=-1;this.dt=0;this.ticks=-1;this.removed=!1}}(),n=function(){function a(a){this.callback=
a;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),p=-1,q=0,r=0,t=Number.POSITIVE_INFINITY,w={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0,spendInTask:0},u=["prepare","preRender","render","postRender","update"],x=[],v=[],z={prepare:[],preRender:[],render:[],postRender:[],update:[]},y=function(){function a(a){this._task=a}a.prototype.remove=function(){this._task.removed=!0};a.prototype.pause=function(){this._task.paused||(this._task.paused=!0,this._task.pausedAt=
f.now())};a.prototype.resume=function(){this._task.paused&&(this._task.paused=!1,-1!==this._task.epoch&&(this._task.epoch+=f.now()-this._task.pausedAt))};return a}();f.FrameTaskHandle=y;f.debug={frameTasks:v,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(a){void 0===a&&(a=!1);for(var b=0;b<v.length;b++)v[b].removed=!0;a&&c()},dispatch:b,executeFrameTasks:function(a){void 0===a&&(a=f.now());0>p&&(p=a);var b=a-p,d=0<r?r:t,e=Math.max(0,b-d);p=a;for(var l=0;l<v.length;l++){var h=
v[l];-1!==h.epoch&&(h.dt=b)}for(l=0;l<u.length;l++)for(var b=u[l],g=z[b],n=0;n<g.length;n++)h=g[(n+A)%g.length],h.paused||h.removed||(0===l&&h.ticks++,-1===h.epoch&&(h.epoch=a),w.time=a,w.deltaTime=h.dt,w.elapsedFrameTime=f.now()-a,w.frameDuration=d-e,w.spendInTask=a-h.epoch,h.phases[b].call(h,w));c();++A}};f.schedule=function(a){a=new n(a);x.push(a);f.debug.willDispatch||(f.debug.willDispatch=!0,k(b));return a};f.addFrameTask=function(a){var b=new l(a);v.push(b);for(var c=0,d=u;c<d.length;c++){var e=
d[c];a[e]&&z[e].push(b)}f.debug.rafId||(p=-1,f.debug.rafId=h());return new y(b)};f.setFrameRate=function(a){if(0>=a)r=q=0;else{var b=1.05*t;a=Math.ceil(1E3/a/b);q=(a-1)*b;r=a*t}};var A=0;f.requestNextFrame=h})},"esri/core/nextTick":function(){define(["require","exports","./global"],function(m,f,k){function e(){if(k.postMessage&&!k.importScripts){var d=k.onmessage,e=!0;k.onmessage=function(){e=!1};k.postMessage("","*");k.onmessage=d;return e}return!1}var g=k.MutationObserver||k.WebKitMutationObserver;
return function(){var d;if(k.process&&k.process.nextTick)d=function(a){k.process.nextTick(a)};else if(k.Promise)d=function(a){k.Promise.resolve().then(a)};else if(g){var h=[],c=document.createElement("div");(new g(function(){for(;0<h.length;)h.shift()()})).observe(c,{attributes:!0});d=function(a){h.push(a);c.setAttribute("queueStatus","1")}}else if(e()){var b=[];k.addEventListener("message",function(a){if(a.source===k&&"esri-nexttick-message"===a.data)for(a.stopPropagation();b.length;)b.shift()()},
!0);d=function(a){b.push(a);k.postMessage("esri-nexttick-message","*")}}else d=k.setImmediate?function(a){return k.setImmediate(a)}:function(a){return k.setTimeout(a,0)};return d}()})},"esri/core/now":function(){define(["require","exports","./global"],function(m,f,k){return function(){var e=k.performance||{};if(e.now)return function(){return e.now()};if(e.webkitNow)return function(){return e.webkitNow()};if(e.mozNow)return function(){return e.mozNow()};if(e.msNow)return function(){return e.msNow()};
if(e.oNow)return function(){return e.oNow()};var g;g=e.timing&&e.timing.navigationStart?e.timing.navigationStart:Date.now();return function(){return Date.now()-g}}()})},"esri/core/requestAnimationFrame":function(){define(["require","exports","./global","./now"],function(m,f,k,e){var g=e();m=k.requestAnimationFrame;if(!m){f=["ms","moz","webkit","o"];for(var d=0;d<f.length&&!m;++d)m=k[f[d]+"RequestAnimationFrame"];m||(m=function(d){var c=e(),b=Math.max(0,16-(c-g)),a=k.setTimeout(function(){d(e())},
b);g=c+b;return a})}return m})},"esri/core/Collection":function(){define("require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper dojo/aspect ./Accessor ./ArrayPool ./Evented ./lang ./ObjectPool ./scheduling ./accessorSupport/decorators ./accessorSupport/ensureType".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(a){return a?a.isInstanceOf&&a.isInstanceOf(C):!1}function r(a){return a?q(a)?a.toArray():a.length?Array.prototype.slice.apply(a):[]:[]}function t(a){if(a&&a.length)return a[0]}
function w(a,b,c,d){b&&b.forEach(function(b,e,l){a.push(b);w(a,c.call(d,b,e,l),c,d)})}m=function(){function a(){this.target=null;this.defaultPrevented=this.cancellable=!1}a.prototype.preventDefault=function(){this.cancellable&&(this.defaultPrevented=!0)};a.prototype.reset=function(a){this.defaultPrevented=!1;this.item=a};return a}();var u=function(){},x=new a(m,!0,function(a){a.item=null;a.target=null}),v=new Set,z=new Set,y=new Set,A=new Map,B=0,C=function(a){function c(b){b=a.call(this,b)||this;
b._boundDispatch=b._dispatchColChange.bind(b);b._chgListeners=[];b._notifications=null;b._timer=null;b.length=0;b._items=[];Object.defineProperty(b,"uid",{value:B++});return b}k(c,a);d=c;c.ofType=function(a){if(!a)return d;if(A.has(a))return A.get(a);var b;if("function"===typeof a)b=a.prototype.declaredClass;else if(a.base)b=a.base.prototype.declaredClass;else for(var c in a.typeMap){var e=a.typeMap[c].prototype.declaredClass;b=b?b+(" | "+e):e}b=d.createSubclass({declaredClass:"esri.core.Collection\x3c"+
b+"\x3e"});b.isCollection=q;c={Type:a,ensureType:"function"===typeof a?p.ensureType(a):p.ensureOneOfType(a)};Object.defineProperty(b.prototype,"itemType",{value:c});A.set(a,b);return b};c.prototype.normalizeCtorArgs=function(a){return a?Array.isArray(a)||q(a)?{items:a}:a:{}};Object.defineProperty(c.prototype,"items",{get:function(){return this._items},set:function(a){this._emitBeforeChanges()||(this._splice.apply(this,[0,this.length].concat(r(a))),this._emitAfterChanges())},enumerable:!0,configurable:!0});
c.prototype.on=function(a,b){var c;Array.isArray(a)?c=a:-1<a.indexOf(",")&&(c=a.split(/\s*,\s*/));if(c){var d=[];for(a=0;a<c.length;a++)d.push(this.on(c[a],b));d.remove=function(){for(var a=0;a<d.length;a++)d[a].remove()};return d}if("change"===a){var e=this._chgListeners,l={removed:!1,callback:b};e.push(l);this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]});return{remove:function(){this.remove=u;l.removed=!0;e.splice(e.indexOf(l),1)}}}return g.after(this,
"on"+a,b,!0)};c.prototype.hasEventListener=function(a){return"change"===a?0<this._chgListeners.length:this.inherited(arguments)};c.prototype.add=function(a,b){if(this._emitBeforeChanges())return this;b=this.getNextIndex(b);this._splice(b,0,a);this._emitAfterChanges();return this};c.prototype.addMany=function(a,b){void 0===b&&(b=this._items.length);if(!a||!a.length||this._emitBeforeChanges())return this;b=this.getNextIndex(b);this._splice.apply(this,[b,0].concat(r(a)));this._emitAfterChanges();return this};
c.prototype.removeAll=function(){if(!this.length||this._emitBeforeChanges())return[];var a=this._splice(0,this.length)||[];this._emitAfterChanges();return a};c.prototype.clone=function(){return this._createNewInstance({items:this._items.map(b.clone)})};c.prototype.concat=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c,a=a.map(r);return this._createNewInstance({items:(c=this._items).concat.apply(c,a)})};c.prototype.drain=function(a,b){if(this.length&&!this._emitBeforeChanges()){for(var c=
this._splice(0,this.length),d=c.length,e=0;e<d;e++)a.call(b,c[e],e,c);this._emitAfterChanges()}};c.prototype.every=function(a,b){return this._items.every(a,b)};c.prototype.filter=function(a,b){var c;c=2===arguments.length?this._items.filter(a,b):this._items.filter(a);return this._createNewInstance({items:c})};c.prototype.find=function(a,b){if("function"!==typeof a)throw new TypeError(a+" is not a function");for(var c=this._items,d=c.length,e=0;e<d;e++){var l=c[e];if(a.call(b,l,e,c))return l}};c.prototype.findIndex=
function(a,b){if("function"!==typeof a)throw new TypeError(a+" is not a function");for(var c=this._items,d=c.length,e=0;e<d;e++)if(a.call(b,c[e],e,c))return e;return-1};c.prototype.flatten=function(a,b){var c=[];w(c,this,a,b);return new d(c)};c.prototype.forEach=function(a,b){for(var c=this._items,d=c.length,e=0;e<d;e++)a.call(b,c[e],e,c)};c.prototype.getItemAt=function(a){return this._items[a]};c.prototype.getNextIndex=function(a){var b=this.length;a=null==a?b:a;0>a?a=0:a>b&&(a=b);return a};c.prototype.includes=
function(a,b){void 0===b&&(b=0);return arguments.length?-1!==this._items.indexOf(a,b):!1};c.prototype.indexOf=function(a,b){void 0===b&&(b=0);return this._items.indexOf(a,b)};c.prototype.join=function(a){void 0===a&&(a=",");return this._items.join(a)};c.prototype.lastIndexOf=function(a,b){void 0===b&&(b=this.length-1);return this._items.lastIndexOf(a,b)};c.prototype.map=function(a,b){a=this._items.map(a,b);return new d({items:a})};c.prototype.reorder=function(a,b){void 0===b&&(b=this.length-1);var c=
this.indexOf(a);if(-1!==c){0>b?b=0:b>=this.length&&(b=this.length-1);if(c!==b){if(this._emitBeforeChanges())return a;this._splice(c,1);this._splice(b,0,a);this._emitAfterChanges()}return a}};c.prototype.pop=function(){if(this.length&&!this._emitBeforeChanges()){var a=t(this._splice(this.length-1,1));this._emitAfterChanges();return a}};c.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(this._emitBeforeChanges())return this.length;this._splice.apply(this,[this.length,
0].concat(a));this._emitAfterChanges();return this.length};c.prototype.reduce=function(a,b){var c=this._items;return 2===arguments.length?c.reduce(a,b):c.reduce(a)};c.prototype.reduceRight=function(a,b){var c=this._items;return 2===arguments.length?c.reduceRight(a,b):c.reduceRight(a)};c.prototype.remove=function(a){return this.removeAt(this.indexOf(a))};c.prototype.removeAt=function(a){if(!(0>a||a>=this.length||this._emitBeforeChanges()))return a=t(this._splice(a,1)),this._emitAfterChanges(),a};c.prototype.removeMany=
function(a){if(!a||!a.length||this._emitBeforeChanges())return[];a=q(a)?a.toArray():a;for(var b=this._items,c=[],d=a.length,e=0;e<d;e++){var l=b.indexOf(a[e]);if(-1<l){for(var h=e+1,g=l+1,n=Math.min(a.length-h,b.length-g),v=0;v<n&&a[h+v]===b[g+v];)v++;h=1+v;(l=this._splice(l,h))&&0<l.length&&c.push.apply(c,l);e+=h-1}}this._emitAfterChanges();return c};c.prototype.reverse=function(){if(this._emitBeforeChanges())return this;var a=this._splice(0,this.length);a&&(a.reverse(),this._splice.apply(this,[0,
0].concat(a)));this._emitAfterChanges();return this};c.prototype.shift=function(){if(this.length&&!this._emitBeforeChanges()){var a=t(this._splice(0,1));this._emitAfterChanges();return a}};c.prototype.slice=function(a,b){void 0===a&&(a=0);void 0===b&&(b=this.length);return this._createNewInstance({items:this._items.slice(a,b)})};c.prototype.some=function(a,b){return this._items.some(a,b)};c.prototype.sort=function(a){if(!this.length||this._emitBeforeChanges())return this;var b=this._splice(0,this.length);
arguments.length?b.sort(a):b.sort();this._splice.apply(this,[0,0].concat(b));return this};c.prototype.splice=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];if(this._emitBeforeChanges())return[];c=this._splice.apply(this,[a,b].concat(c))||[];this._emitAfterChanges();return c};c.prototype.toArray=function(){return this._items.slice()};c.prototype.toJSON=function(){return this.toArray()};c.prototype.toLocaleString=function(){return this._items.toLocaleString()};c.prototype.toString=
function(){return this._items.toString()};c.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(this._emitBeforeChanges())return this.length;this._splice.apply(this,[0,0].concat(a));this._emitAfterChanges();return this.length};c.prototype._createNewInstance=function(a){return new this.constructor(a)};c.prototype._splice=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];var d=this._items,e=this.constructor.prototype.itemType,h,g;!this._notifications&&
this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=l.schedule(this._boundDispatch));if(b){g=d.splice(a,b);if(this.hasEventListener("before-remove")){var n=x.acquire();n.target=this;n.cancellable=!0;for(var v=0,p=g.length;v<p;v++)h=g[v],n.reset(h),this.emit("before-remove",n),n.defaultPrevented&&(g.splice(v,1),d.splice(a,0,h),a+=1,--v,--p);x.release(n)}this.length=this._items.length;
if(this.hasEventListener("after-remove")){h=x.acquire();h.target=this;h.cancellable=!1;p=g.length;for(v=0;v<p;v++)h.reset(g[v]),this.emit("after-remove",h);x.release(h)}}if(c&&c.length){if(e){v=[];for(p=0;p<c.length;p++)h=c[p],n=e.ensureType(h),null==n&&null!=h||v.push(n);c=v}e=this.hasEventListener("before-add");v=this.hasEventListener("after-add");p=a===this.length;if(e||v){h=x.acquire();h.target=this;h.cancellable=!0;n=x.acquire();n.target=this;n.cancellable=!1;for(var q=0,k=c;q<k.length;q++){var u=
k[q];e?(h.reset(u),this.emit("before-add",h),h.defaultPrevented||(p?d.push(u):d.splice(a++,0,u),this._set("length",d.length),v&&(n.reset(u),this.emit("after-add",n)))):(p?d.push(u):d.splice(a++,0,u),this._set("length",d.length),n.reset(u),this.emit("after-add",n))}x.release(h)}else p?d.push.apply(d,c):d.splice.apply(d,[a,0].concat(c)),this._set("length",d.length)}(c&&c.length||g&&g.length)&&this._notifyChangeEvent(c,g);return g};c.prototype._emitBeforeChanges=function(){var a=!1;if(this.hasEventListener("before-changes")){var b=
x.acquire();b.target=this;b.cancellable=!0;this.emit("before-changes",b);a=b.defaultPrevented;x.release(b)}return a};c.prototype._emitAfterChanges=function(){if(this.hasEventListener("after-changes")){var a=x.acquire();a.target=this;a.cancellable=!1;this.emit("after-changes",a);x.release(a)}};c.prototype._notifyChangeEvent=function(a,b){this.hasEventListener("change")&&this._notifications[this._notifications.length-1].changes.push({added:a,removed:b})};c.prototype._dispatchColChange=function(){this._timer&&
(this._timer.remove(),this._timer=null);if(this._notifications){var a=this._notifications;this._notifications=null;for(var b=function(a){var b=a.changes;v.clear();z.clear();y.clear();for(var d=0;d<b.length;d++){var e=b[d],l=e.added,e=e.removed;if(l)if(0===y.size&&0===z.size)for(var g=0,n=l;g<n.length;g++)l=n[g],v.add(l);else for(g=0,n=l;g<n.length;g++)l=n[g],z.has(l)?(y.add(l),z.delete(l)):y.has(l)||v.add(l);if(e)if(0===y.size&&0===v.size)for(g=0;g<e.length;g++)l=e[g],z.add(l);else for(g=0;g<e.length;g++)l=
e[g],v.has(l)?v.delete(l):(y.delete(l),z.add(l))}var p=h.acquire();v.forEach(function(a){p.push(a)});var q=h.acquire();z.forEach(function(a){q.push(a)});var k=c._items,u=a.items,r=h.acquire();y.forEach(function(a){u.indexOf(a)!==k.indexOf(a)&&r.push(a)});if(a.listeners&&(p.length||q.length||r.length))for(b={target:c,added:p,removed:q,moved:r},d=a.listeners.length,l=0;l<d;l++)e=a.listeners[l],e.removed||e.callback.call(c,b);h.release(p);h.release(q);h.release(r)},c=this,d=0;d<a.length;d++)b(a[d]);
v.clear();z.clear();y.clear()}};var d;c.isCollection=q;e([n.property()],c.prototype,"length",void 0);e([n.property()],c.prototype,"items",null);return c=d=e([n.subclass("esri.core.Collection")],c)}(n.declared(d,c));return C})},"esri/core/Evented":function(){define(["require","exports","dojo/aspect","dojo/on"],function(m,f,k,e){function g(d,e,c,b){var a;Array.isArray(e)?a=e:-1<e.indexOf(",")&&(a=e.split(/\s*,\s*/));if(a){var l=[];for(e=0;e<a.length;e++)l.push(g(d,a[e],c,b));l.remove=function(){for(var a=
0;a<l.length;a++)l[a].remove()};return l}return b(d,e)}return function(){function d(){}d.prototype.emit=function(d,c){if(this.hasEventListener(d))return c=c||{},c.target||(c.target=this),e.emit(this,d,c)};d.prototype.on=function(d,c){return g(this,d,c,function(b,a){return k.after(b,"on"+a,c,!0)})};d.prototype.hasEventListener=function(d){d="on"+d;return!(!this[d]||!this[d].after)};return d}()})},"esri/core/accessorSupport/decorators":function(){define("require exports ./decorators/aliasOf ./decorators/autoDestroy ./decorators/cast ./decorators/declared ./decorators/enumeration ./decorators/property ./decorators/reader ./decorators/shared ./decorators/subclass ./decorators/writer".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){function p(a){for(var b in a)f.hasOwnProperty(b)||(f[b]=a[b])}Object.defineProperty(f,"__esModule",{value:!0});p(k);p(e);p(g);p(d);p(h);p(c);p(b);p(a);p(l);p(n)})},"esri/core/accessorSupport/decorators/aliasOf":function(){define(["require","exports","../metadata"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.aliasOf=function(e){return function(g,d){k.getPropertyMetadata(g,d).aliasOf=e}}})},"esri/core/accessorSupport/decorators/autoDestroy":function(){define(["require",
"exports","../metadata"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.autoDestroy=function(){return function(e,g,d){k.getMetadata(e).autoDestroy=!0;return e[g]}}})},"esri/core/accessorSupport/decorators/declared":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.declared=function(k){for(var e=[],g=1;g<arguments.length;g++)e[g-1]=arguments[g];g=function(){return this||{}};g.__bases__=[k].concat(e);return g}})},"esri/core/accessorSupport/decorators/enumeration":function(){define(["require",
"exports","../../kebabDictionary","./property"],function(m,f,k,e){function g(d){return e.property({type:d})}Object.defineProperty(f,"__esModule",{value:!0});f.enumeration=g;(function(d){d.serializable=function(){return function(d){d=d instanceof k.KebabDictionary?d:new k.KebabDictionary(d,{ignoreUnknown:!0});return e.property({type:d.apiValues,json:{type:d.jsonValues,read:{reader:d.read},write:{writer:d.write}}})}}})(g=f.enumeration||(f.enumeration={}))})},"esri/core/kebabDictionary":function(){define(["require",
"exports"],function(m,f){function k(g,d){void 0===d&&(d={});return new e(g,d)}var e=function(){function e(d,e){var c=this;this.jsonToAPI=d;this.options=e;this.apiValues=[];this.jsonValues=[];this.apiToJSON=this.invertMap(d);this.apiValues=this.getKeysSorted(this.apiToJSON);this.jsonValues=this.getKeysSorted(this.jsonToAPI);this.read=function(b){return c.fromJSON(b)};this.write=function(b,a,d){b=c.toJSON(b);void 0!==b&&(a[d]=b)}}e.prototype.toJSON=function(d){return this.apiToJSON.hasOwnProperty(d)?
this.apiToJSON[d]:this.options.ignoreUnknown?void 0:d};e.prototype.fromJSON=function(d){return this.jsonToAPI.hasOwnProperty(d)?this.jsonToAPI[d]:this.options.ignoreUnknown?void 0:d};e.prototype.invertMap=function(d){var e={},c;for(c in d)e[d[c]]=c;return e};e.prototype.getKeysSorted=function(d){var e=[],c;for(c in d)e.push(c);e.sort();return e};return e}();(function(g){g.strict=function(){return function(d){return new g.KebabDictionary(d,{ignoreUnknown:!0})}};g.KebabDictionary=e})(k||(k={}));return k})},
"esri/core/accessorSupport/decorators/property":function(){define("require exports ../../has ../../lang ../../Logger ../metadata".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});g.getLogger("esri.core.accessorSupport.decorators.property");f.property=function(h){void 0===h&&(h={});return function(c,b){var a=c.constructor.prototype;if(a!==Function.prototype){(c=Object.getOwnPropertyDescriptor(c,b))&&(c.get||c.set)?(h=e.clone(h),c.set&&(h.set=c.set),c.get&&(h.get=c.get)):
c&&c.hasOwnProperty("value")&&(h=e.clone(h),h.value=c.value);b=d.getPropertyMetadata(a,b);for(var l in h)a=h[l],Array.isArray(a)&&"type"!==l?b[l]=(b[l]||[]).concat(a):b[l]=a}}};f.propertyJSONMeta=function(e,c,b){e=d.getPropertyMetadata(e.constructor.prototype,b);e.json||(e.json={});e=e.json;void 0!==c&&(e.origins||(e.origins={}),e.origins[c]||(e.origins[c]={}),e=e.origins[c]);return e}})},"esri/core/accessorSupport/decorators/reader":function(){define(["require","exports","../../object","./property"],
function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.reader=function(g,d,h){var c,b;void 0===d||Array.isArray(d)?(b=g,h=d,c=[void 0]):(b=d,c=Array.isArray(g)?g:[g]);return function(a,d,g){var l=a.constructor.prototype;c.forEach(function(c){c=e.propertyJSONMeta(a,c,b);c.read&&"object"!==typeof c.read&&(c.read={});k.setDeepValue("read.reader",l[d],c);h&&(c.read.source=(c.read.source||[]).concat(h))})}}})},"esri/core/accessorSupport/decorators/shared":function(){define(["require","exports"],
function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.shared=function(k){return function(e,g){e[g]=k}}})},"esri/core/accessorSupport/decorators/subclass":function(){define(["require","exports","../../declare","../metadata"],function(m,f,k,e){function g(a,b){a.read&&("function"===typeof a.read?b.push(a.read):"object"===typeof a.read&&a.read.reader&&b.push(a.read.reader))}function d(a,b){a.write&&("function"===typeof a.write?b.push(a.write):"object"===typeof a.write&&a.write.writer&&b.push(a.write.writer))}
function h(a){var b=[];a=e.getPropertiesMetadata(a.prototype);if(!a)return b;for(var c in a){var l=a[c];l.cast&&b.push(l.cast);l.copy&&b.push(l.copy);if(l=l.json)if(g(l,b),d(l,b),l=l.origins)for(var h in l){var k=l[h];g(k,b);d(k,b)}}return b}function c(b){var c={values:{},descriptors:{}},d=["__bases__"],l=e.getPropertiesMetadata(b.prototype),g=h(b);Object.getOwnPropertyNames(b.prototype).filter(function(c){return-1!==d.indexOf(c)||l&&l.hasOwnProperty(c)||!a(Object.getOwnPropertyDescriptor(b.prototype,
c))&&-1!==g.indexOf(b.prototype[c])?!1:!0}).forEach(function(d){var e=Object.getOwnPropertyDescriptor(b.prototype,d);a(e)?c.descriptors[d]=e:c.values[d]=b.prototype[d]});return c}function b(b){var c=Object.getOwnPropertyNames(b),d=Object.getPrototypeOf(b.prototype).constructor,e=Object.getOwnPropertyNames(Function);e.push("__bases__");var l=Object.getOwnPropertyNames(d),h={values:{},descriptors:{}};c.filter(function(a){return-1!==e.indexOf(a)?!1:-1===l.indexOf(a)||d[a]!==b[a]?!0:!1}).forEach(function(c){var d=
Object.getOwnPropertyDescriptor(b,c);a(d)?h.descriptors[c]=d:h.values[c]=b[c]});return h}function a(a){return a&&!(!a.get&&!a.set)}Object.defineProperty(f,"__esModule",{value:!0});f.subclass=function(a){return function(d){var e=c(d),l=b(d);null!=a&&(e.values.declaredClass=a);d=k(d.__bases__,e.values);Object.defineProperties(d.prototype,e.descriptors);for(var h in l.values)d[h]=l.values[h];Object.defineProperties(d,l.descriptors);return d}}})},"esri/core/accessorSupport/decorators/writer":function(){define(["require",
"exports","../../object","./property"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.writer=function(g,d,h){var c,b;void 0===d?(b=g,c=[void 0]):"string"!==typeof d?(b=g,c=[void 0],h=d):(b=d,c=Array.isArray(g)?g:[g]);return function(a,d,g){var l=a.constructor.prototype;c.forEach(function(c){c=e.propertyJSONMeta(a,c,b);c.write&&"object"!==typeof c.write&&(c.write={});h&&k.setDeepValue("write.target",h,c);k.setDeepValue("write.writer",l[d],c)})}}})},"esri/core/watchUtils":function(){define(["require",
"exports","dojo/Deferred","dojo/promise/Promise"],function(m,f,k,e){function g(a,b,c,d,e){e=a.watch(b,function(b,e,l,h){d&&!d(b)||c.call(a,b,e,l,h)},e);if(Array.isArray(b))for(var l=0;l<b.length;l++){var h=a.get(b[l]);d&&d(h)&&c.call(a,h,h,b,a)}else h=a.get(b),d&&d(h)&&c.call(a,h,h,b,a);return e}function d(a,b,c,d,l){function h(){p&&(p.remove(),p=null)}var n=!1,p,q=new k(h),u=new e;u.cancel=q.cancel;u.isCanceled=q.isCanceled;u.isFulfilled=q.isFulfilled;u.isRejected=q.isRejected;u.isResolved=q.isResolved;
u.then=q.then;u.remove=h;Object.freeze(u);p=g(a,b,function(b,d,e,l){n=!0;h();c&&c.call(a,b,d,e,l);q.resolve({value:b,oldValue:d,propertyName:e,target:l})},d,l);n&&h();return u}function h(a){return!!a}function c(a){return!a}function b(a){return!0===a}function a(a){return!1===a}function l(a){return void 0!==a}function n(a){return void 0===a}function p(a,b,c,d){var e=Array.isArray(b)?b:-1<b.indexOf(",")?b.split(","):[b];b=a.watch(b,c,d);for(d=0;d<e.length;d++){var l=e[d].trim(),h=a.get(l);c.call(a,h,
h,l,a)}return b}Object.defineProperty(f,"__esModule",{value:!0});f.init=p;f.watch=function(a,b,c,d){return a.watch(b,c,d)};f.once=function(a,b,c,e){return d(a,b,c,null,e)};f.when=function(a,b,c,d){return g(a,b,c,h,d)};f.whenOnce=function(a,b,c,e){return d(a,b,c,h,e)};f.whenNot=function(a,b,d,e){return g(a,b,d,c,e)};f.whenNotOnce=function(a,b,e,l){return d(a,b,e,c,l)};f.whenTrue=function(a,c,d,e){return g(a,c,d,b,e)};f.whenTrueOnce=function(a,c,e,l){return d(a,c,e,b,l)};f.whenFalse=function(b,c,d,
e){return g(b,c,d,a,e)};f.whenFalseOnce=function(b,c,e,l){return d(b,c,e,a,l)};f.whenDefined=function(a,b,c,d){return g(a,b,c,l,d)};f.whenDefinedOnce=function(a,b,c,e){return d(a,b,c,l,e)};f.whenUndefined=function(a,b,c,d){return g(a,b,c,n,d)};f.whenUndefinedOnce=function(a,b,c,e){return d(a,b,c,n,e)};f.pausable=function(a,b,c,d){var e=!1,l=a.watch(b,function(b,d,l,h){e||c.call(a,b,d,l,h)},d);return{remove:function(){l.remove()},pause:function(){e=!0},resume:function(){e=!1}}};f.on=function(a,b,c,
d,e,l,h){function g(b){var d=n[b];d&&(l&&l(d.target,b,a,c),d.handle.remove(),delete n[b])}var n={},v=p(a,b,function(b,l,h){g(h);b&&"function"===typeof b.on&&(n[h]={handle:b.on(c,d),target:b},e&&e(b,h,a,c))},h);return{remove:function(){v.remove();for(var a in n)g(a)}}}})},"esri/core/requireUtils":function(){define(["require","exports","./promiseUtils"],function(m,f,k){function e(g,d){return Array.isArray(d)?k.create(function(e){g(d,function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];
e(c)})}):e(g,[d]).then(function(d){return d[0]})}Object.defineProperty(f,"__esModule",{value:!0});f.when=e;f.getAbsMid=function(e,d,h){return d.toAbsMid?d.toAbsMid(e):h.id.replace(/\/[^\/]*$/gi,"/")+e}})},"esri/identity/IdentityManager":function(){define(["./IdentityManagerDialog","../kernel","./OAuthSignInHandler","../core/declare"],function(m,f,k,e){m=new m;f.id=e.safeMixin(m,k);return f.id})},"esri/identity/IdentityManagerDialog":function(){define("dojo/_base/kernel ../core/declare dojo/Deferred dojo/dom-attr dojo/keys dijit/registry dijit/Dialog ../kernel ../core/lang ../core/Error ../core/domUtils ./Credential ./IdentityManagerBase dojo/i18n!./nls/identity dojo/query dijit/form/Button dijit/form/Form dijit/form/ValidationTextBox".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){return f([p],{declaredClass:"esri.identity.IdentityManager",constructor:function(a){b.mixin(this,a)},_dialogContent:"\x3cdiv data-dojo-type\x3d'dijit.form.Form' data-dojo-props\x3d'\"class\":\"esriIdForm\"'\x3e\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e{info}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e{invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3ctable style\x3d'width: 100%;'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e{lblUser}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"text\", \"class\":\"esriIdUser\", required:true, trim:true, style:\"width: 100%;\", autocapitalize:\"none\", autocorrect:\"off\", spellcheck:false' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e{lblPwd}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"password\", \"class\":\"esriIdPwd\", required:true, style:\"width: 100%;\"' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e{lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e{lblCancel}\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e",
signIn:function(b,c,d){this._nls||(this._nls=q);this._loginDialog||(this._loginDialog=this.dialog=this._createLoginDialog(),this.emit("dialog-create"));var h=this._loginDialog,g=d&&d.error,n=d&&d.token,p=new k(function(){h.onCancel()});if(h.open)return b=new a("identity-manager:busy","BUSY"),p.reject(b),p.promise;l.hide(h.errMsg_);g&&g.details&&403==g.details.httpStatus&&n&&(e.set(h.errMsg_,"innerHTML",this._nls.forbidden),l.show(h.errMsg_));h.dfd_=p;h.serverInfo_=c;h.resUrl_=b;h.admin_=d&&d.isAdmin;
e.set(h.resLink_,{title:b,innerHTML:"("+(this.getResourceName(b)||this._nls.lblItem)+")"});e.set(h.serverLink_,{title:c.server,innerHTML:(-1!==c.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":c.server)+" "});h.txtPwd_.set("value","");h.show();return p.promise},_createLoginDialog:function(){var p=this._nls,q=b.substitute(p,this._dialogContent),q=b.substitute({resource:"\x3cspan class\x3d'resLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e",server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},
q),k=new h({title:p.title,content:q,"class":" esri-widget esriSignInDialog esriIdentityDialog",style:"width: 18em;",esriIdMgr_:this,onShow:function(){this.domNode.classList.add("esriIdentityDialog--visible")},onHide:function(){this.domNode.classList.remove("esriIdentityDialog--visible")},keypressed_:function(a){a.charOrCode===g.ENTER&&this.execute_()},execute_:function(){var a=this.txtUser_.get("value"),b=this.txtPwd_.get("value"),d=this.dfd_,g=this;if(this.form_.validate()&&a&&b){this.btnSubmit_.set("label",
p.lblSigning);var q=c.id.findCredential(g.resUrl_,a),k=function(b){g.btnSubmit_.set("label",p.lblOk);g.btnSubmit_.set("disabled",!1);l.hide(g.errMsg_);g.hide();h._DialogLevelManager.hide(g);var c=g.serverInfo_;g.dfd_=g.serverInfo_=g.generateDfd_=g.resUrl_=null;var e,v,k=q,u;b&&(e=b.token,v=null!=b.expires?Number(b.expires):null,u=!!b.ssl,k?(k.userId=a,k.token=e,k.expires=v,k.validity=b.validity,k.ssl=u,k.creationTime=(new Date).getTime()):k=new n({userId:a,server:c.server,token:e,expires:v,ssl:u,
isAdmin:g.admin_,validity:b.validity}));d.resolve(k)};q&&!q._enqueued?k():(g.btnSubmit_.set("disabled",!0),g.generateDfd_=c.id.generateToken(this.serverInfo_,{username:a,password:b},{isAdmin:this.admin_}).then(k).then(null,function(a){g.btnSubmit_.set("disabled",!1);g.generateDfd_=null;g.btnSubmit_.set("label",p.lblOk);e.set(g.errMsg_,"innerHTML",a&&a.details&&a.details.httpStatus?p.invalidUser:p.noAuthService);l.show(g.errMsg_)}))}},cancel_:function(){k.generateDfd_&&k.generateDfd_.cancel();var b=
k.dfd_,c=k.resUrl_,d=k.serverInfo_;k.btnSubmit_.set("disabled",!1);k.dfd_=k.serverInfo_=k.generateDfd_=k.resUrl_=null;l.hide(k.errMsg_);h._DialogLevelManager.hide(k);k.esriIdMgr_.emit("dialog-cancel",{resourceUrl:c,serverInfo:d});c=new a("identity-manager:user-aborted","ABORTED");b.reject(c)}}),q=k.domNode;k.form_=d.byNode(m.query(".esriIdForm",q)[0]);k.txtUser_=d.byNode(m.query(".esriIdUser",q)[0]);k.txtPwd_=d.byNode(m.query(".esriIdPwd",q)[0]);k.btnSubmit_=d.byNode(m.query(".esriIdSubmit",q)[0]);
k.btnCancel_=d.byNode(m.query(".esriIdCancel",q)[0]);k.resLink_=m.query(".resLink",q)[0];k.serverLink_=m.query(".serverLink",q)[0];k.errMsg_=m.query(".esriErrorMsg",q)[0];k.connect(k.txtUser_,"onKeyPress",k.keypressed_);k.connect(k.txtPwd_,"onKeyPress",k.keypressed_);k.connect(k.btnSubmit_,"onClick",k.execute_);k.connect(k.btnCancel_,"onClick",k.onCancel);k.connect(k,"onCancel",k.cancel_);return k}})})},"dijit/Dialog":function(){define("require dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/ready dojo/sniff dojo/touch dojo/window dojo/dnd/Moveable dojo/dnd/TimedMoveable ./focus ./_base/manager ./_Widget ./_TemplatedMixin ./_CssStateMixin ./form/_FormMixin ./_DialogMixin ./DialogUnderlay ./layout/ContentPane ./layout/utils dojo/text!./templates/Dialog.html ./a11yclick dojo/i18n!./nls/common".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I){function G(){}var O=new g;O.resolve(!0);y=e("dijit._DialogBase"+(t("dojo-bidi")?"_NoBidi":""),[B,E,D,C],{templateString:I,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:y.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(a){this._set("draggable",a)},maxRatio:.9,
closable:!0,_setClosableAttr:function(a){this.closeButtonNode.style.display=a?"":"none";this._set("closable",a)},postMixInProperties:function(){var a=l.getLocalization("dijit","common");p.mixin(this,a);this.inherited(arguments)},postCreate:function(){b.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);k.after(this,"onExecute",p.hitch(this,"hide"),!0);k.after(this,"onCancel",p.hitch(this,"hide"),!0);q(this.closeButtonNode,
w.press,function(a){a.stopPropagation()});this._modalconnects=[]},onLoad:function(){this.resize();this._position();this.autofocus&&Q.isTop(this)&&(this._getFocusItems(),z.focus(this._firstFocusItem));this.inherited(arguments)},focus:function(){this._getFocusItems();z.focus(this._firstFocusItem)},_endDrag:function(){var a=c.position(this.domNode),b=u.getBox(this.ownerDocument);a.y=Math.min(Math.max(a.y,0),b.h-a.h);a.x=Math.min(Math.max(a.x,0),b.w-a.w);this._relativePosition=a;this._position()},_setup:function(){var a=
this.domNode;this.titleBar&&this.draggable?(this._moveable=new (6==t("ie")?v:x)(a,{handle:this.titleBar}),k.after(this._moveable,"onMoveStop",p.hitch(this,"_endDrag"),!0)):h.add(a,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,"class":f.map(this["class"].split(/\s/),function(a){return a+"_underlay"}).join(" "),_onKeyDown:p.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!h.contains(this.ownerDocumentBody,"dojoMove")){var a=
this.domNode,d=u.getBox(this.ownerDocument),e=this._relativePosition,l=c.position(a);b.set(a,{left:Math.floor(d.l+(e?Math.min(e.x,d.w-l.w):(d.w-l.w)/2))+"px",top:Math.floor(d.t+(e?Math.min(e.y,d.h-l.h):(d.h-l.h)/2))+"px"})}},_onKey:function(a){if(a.keyCode==n.TAB){this._getFocusItems();var b=a.target;this._firstFocusItem==this._lastFocusItem?(a.stopPropagation(),a.preventDefault()):b==this._firstFocusItem&&a.shiftKey?(z.focus(this._lastFocusItem),a.stopPropagation(),a.preventDefault()):b!=this._lastFocusItem||
a.shiftKey||(z.focus(this._firstFocusItem),a.stopPropagation(),a.preventDefault())}else this.closable&&a.keyCode==n.ESCAPE&&(this.onCancel(),a.stopPropagation(),a.preventDefault())},show:function(){if(this.open)return O.promise;this._started||this.startup();this._alreadyInitialized||(this._setup(),this._alreadyInitialized=!0);this._fadeOutDeferred&&(this._fadeOutDeferred.cancel(),Q.hide(this));var c=u.get(this.ownerDocument);this._modalconnects.push(q(c,"scroll",p.hitch(this,"resize",null)));this._modalconnects.push(q(this.domNode,
"keydown",p.hitch(this,"_onKey")));b.set(this.domNode,{opacity:0,display:""});this._set("open",!0);this._onShow();this.resize();this._position();var d;this._fadeInDeferred=new g(p.hitch(this,function(){d.stop();delete this._fadeInDeferred}));this._fadeInDeferred.then(void 0,G);c=this._fadeInDeferred.promise;d=a.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:p.hitch(this,function(){Q.show(this,this.underlayAttrs)}),onEnd:p.hitch(this,function(){this.autofocus&&Q.isTop(this)&&(this._getFocusItems(),
z.focus(this._firstFocusItem));this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred})}).play();return c},hide:function(){if(!this._alreadyInitialized||!this.open)return O.promise;this._fadeInDeferred&&this._fadeInDeferred.cancel();var b;this._fadeOutDeferred=new g(p.hitch(this,function(){b.stop();delete this._fadeOutDeferred}));this._fadeOutDeferred.then(void 0,G);this._fadeOutDeferred.then(p.hitch(this,"onHide"));var c=this._fadeOutDeferred.promise;b=a.fadeOut({node:this.domNode,duration:this.duration,
onEnd:p.hitch(this,function(){this.domNode.style.display="none";Q.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred})}).play();this._scrollConnected&&(this._scrollConnected=!1);for(var d;d=this._modalconnects.pop();)d.remove();this._relativePosition&&delete this._relativePosition;this._set("open",!1);return c},resize:function(a){if("none"!=this.domNode.style.display){this._checkIfSingleChild();if(!a){this._shrunk&&(this._singleChild&&"undefined"!=typeof this._singleChildOriginalStyle&&
(this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle,delete this._singleChildOriginalStyle),f.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],function(a){a&&b.set(a,{position:"static",width:"auto",height:"auto"})}),this.domNode.style.position="absolute");var d=u.getBox(this.ownerDocument);d.w*=this.maxRatio;d.h*=this.maxRatio;var e=c.position(this.domNode);e.w>=d.w||e.h>=d.h?(a={w:Math.min(e.w,d.w),h:Math.min(e.h,d.h)},this._shrunk=!0):this._shrunk=!1}if(a){c.setMarginBox(this.domNode,
a);d=[];this.titleBar&&d.push({domNode:this.titleBar,region:"top"});this.actionBarNode&&d.push({domNode:this.actionBarNode,region:"bottom"});e={domNode:this.containerNode,region:"center"};d.push(e);var l=N.marginBox2contentBox(this.domNode,a);N.layoutChildren(this.domNode,l,d);this._singleChild?(d=N.marginBox2contentBox(this.containerNode,e),this._singleChild.resize({w:d.w,h:d.h})):(this.containerNode.style.overflow="auto",this._layoutChildren())}else this._layoutChildren();t("touch")||a||this._position()}},
_layoutChildren:function(){f.forEach(this.getChildren(),function(a){a.resize&&a.resize()})},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var a;a=this._modalconnects.pop();)a.remove();Q.hide(this);this.inherited(arguments)}});t("dojo-bidi")&&(y=e("dijit._DialogBase",y,{_setTitleAttr:function(a){this._set("title",a);this.titleNode.innerHTML=a;this.applyTextDir(this.titleNode)},
_setTextDirAttr:function(a){this._created&&this.textDir!=a&&(this._set("textDir",a),this.set("title",this.title))}}));var J=e("dijit.Dialog",[M,y],{});J._DialogBase=y;var Q=J._DialogLevelManager={_beginZIndex:950,show:function(a,c){H[H.length-1].focus=z.curNode;var d=H[H.length-1].dialog?H[H.length-1].zIndex+2:J._DialogLevelManager._beginZIndex;b.set(a.domNode,"zIndex",d);F.show(c,d-1);H.push({dialog:a,underlayAttrs:c,zIndex:d})},hide:function(a){if(H[H.length-1].dialog==a){H.pop();var b=H[H.length-
1];1==H.length?F.hide():F.show(b.underlayAttrs,b.zIndex-1);if(a.refocus&&(a=b.focus,!b.dialog||a&&d.isDescendant(a,b.dialog.domNode)||(b.dialog._getFocusItems(),a=b.dialog._firstFocusItem),a))try{a.focus()}catch(P){}}else b=f.indexOf(f.map(H,function(a){return a.dialog}),a),-1!=b&&H.splice(b,1)},isTop:function(a){return H[H.length-1].dialog==a}},H=J._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];z.watch("curNode",function(a,b,c){a=H[H.length-1].dialog;if(c&&a&&!a._fadeOutDeferred&&c.ownerDocument==
a.ownerDocument){do if(c==a.domNode||h.contains(c,"dijitPopup"))return;while(c=c.parentNode);a.focus()}});t("dijit-legacy-requires")&&r(0,function(){m(["dijit/TooltipDialog"])});return J})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p){var q,r=function(){},r=function(a,b){"touchAction"in document.body.style?q="touchAction":
"msTouchAction"in document.body.style&&(q="msTouchAction");r=function(a,b){a.style[q]=b};r(a,b)};return f("dojo.dnd.Moveable",[d],{handle:"",delay:0,skip:!1,constructor:function(b,d){this.node=e.byId(b);r(this.node,"none");d||(d={});this.handle=d.handle?e.byId(d.handle):null;this.handle||(this.handle=this.node);this.delay=0<d.delay?d.delay:0;this.skip=d.skip;this.mover=d.mover?d.mover:n;this.events=[c(this.handle,a.press,k.hitch(this,"onMouseDown")),c(this.handle,"dragstart",k.hitch(this,"onSelectStart")),
c(this.handle,"selectstart",k.hitch(this,"onSelectStart"))]},markupFactory:function(a,b,c){return new c(b,a)},destroy:function(){m.forEach(this.events,function(a){a.remove()});r(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(b){if(!this.skip||!l.isFormElement(b)){if(this.delay)this.events.push(c(this.handle,a.move,k.hitch(this,"onMouseMove")),c(this.handle.ownerDocument,a.release,k.hitch(this,"onMouseUp"))),this._lastX=b.pageX,this._lastY=b.pageY;else this.onDragDetected(b);
b.stopPropagation();b.preventDefault()}},onMouseMove:function(a){if(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)this.onMouseUp(a),this.onDragDetected(a);a.stopPropagation();a.preventDefault()},onMouseUp:function(a){for(var b=0;2>b;++b)this.events.pop().remove();a.stopPropagation();a.preventDefault()},onSelectStart:function(a){this.skip&&l.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onDragDetected:function(a){new this.mover(this.node,a,this)},
onMoveStart:function(a){b.publish("/dnd/move/start",a);g.add(p.body(),"dojoMove");g.add(this.node,"dojoMoveItem")},onMoveStop:function(a){b.publish("/dnd/move/stop",a);g.remove(p.body(),"dojoMove");g.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(a,b){this.onMoving(a,b);var c=a.node.style;c.left=b.l+"px";c.top=b.t+"px";this.onMoved(a,b)},onMoving:function(){},onMoved:function(){}})})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],
function(m,f,k,e){var g=k.getObject("dojo.dnd",!0);g.getCopyKeyState=function(d){return d[m("mac")?"metaKey":"ctrlKey"]};g._uniqueId=0;g.getUniqueId=function(){var d;do d=f._scopeName+"Unique"+ ++g._uniqueId;while(e.byId(d));return d};g._empty={};g.isFormElement=function(d){d=d.target;3==d.nodeType&&(d=d.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+d.tagName.toLowerCase()+" ")};return g})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){return f("dojo.dnd.Mover",[b],{constructor:function(b,c,e){function h(a){a.preventDefault();a.stopPropagation()}this.node=d.byId(b);this.marginBox={l:c.pageX,t:c.pageY};this.mouseButton=c.button;c=this.host=e;b=b.ownerDocument;this.events=[a(b,l.move,k.hitch(this,"onFirstMove")),a(b,l.move,k.hitch(this,"onMouseMove")),a(b,l.release,k.hitch(this,"onMouseUp")),a(b,"dragstart",h),a(b.body,"selectstart",h)];p.autoScrollStart(b);if(c&&c.onMoveStart)c.onMoveStart(this)},
onMouseMove:function(a){p.autoScroll(a);var b=this.marginBox;this.host.onMove(this,{l:b.l+a.pageX,t:b.t+a.pageY},a);a.preventDefault();a.stopPropagation()},onMouseUp:function(a){(e("webkit")&&e("mac")&&2==this.mouseButton?0==a.button:this.mouseButton==a.button)&&this.destroy();a.preventDefault();a.stopPropagation()},onFirstMove:function(a){var b=this.node.style,d,e=this.host;switch(b.position){case "relative":case "absolute":d=Math.round(parseFloat(b.left))||0;b=Math.round(parseFloat(b.top))||0;break;
default:b.position="absolute";b=h.getMarginBox(this.node);d=g.doc.body;var l=c.getComputedStyle(d),n=h.getMarginBox(d,l),l=h.getContentBox(d,l);d=b.l-(l.l-n.l);b=b.t-(l.t-n.t)}this.marginBox.l=d-this.marginBox.l;this.marginBox.t=b-this.marginBox.t;if(e&&e.onFirstMove)e.onFirstMove(this,a);this.events.shift().remove()},destroy:function(){m.forEach(this.events,function(a){a.remove()});var a=this.host;if(a&&a.onMoveStop)a.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),
function(m,f,k,e,g,d){var h={};m.setObject("dojo.dnd.autoscroll",h);h.getViewport=d.getBox;h.V_TRIGGER_AUTOSCROLL=32;h.H_TRIGGER_AUTOSCROLL=32;h.V_AUTOSCROLL_VALUE=16;h.H_AUTOSCROLL_VALUE=16;var c,b=k.doc,a=Infinity,l=Infinity;h.autoScrollStart=function(e){b=e;c=d.getBox(b);e=k.body(b).parentNode;a=Math.max(e.scrollHeight-c.h,0);l=Math.max(e.scrollWidth-c.w,0)};h.autoScroll=function(e){var g=c||d.getBox(b),n=k.body(b).parentNode,r=0,f=0;e.clientX<h.H_TRIGGER_AUTOSCROLL?r=-h.H_AUTOSCROLL_VALUE:e.clientX>
g.w-h.H_TRIGGER_AUTOSCROLL&&(r=Math.min(h.H_AUTOSCROLL_VALUE,l-n.scrollLeft));e.clientY<h.V_TRIGGER_AUTOSCROLL?f=-h.V_AUTOSCROLL_VALUE:e.clientY>g.h-h.V_TRIGGER_AUTOSCROLL&&(f=Math.min(h.V_AUTOSCROLL_VALUE,a-n.scrollTop));window.scrollBy(r,f)};h._validNodes={div:1,p:1,td:1};h._validOverflow={auto:1,scroll:1};h.autoScrollNodes=function(a){for(var b,c,d,l,n,u=0,x=0,v=a.target;v;){if(1==v.nodeType&&v.tagName.toLowerCase()in h._validNodes){d=g.getComputedStyle(v);n=d.overflowX.toLowerCase()in h._validOverflow;
l=d.overflowY.toLowerCase()in h._validOverflow;if(n||l)b=e.getContentBox(v,d),c=e.position(v,!0);if(n){d=Math.min(h.H_TRIGGER_AUTOSCROLL,b.w/2);n=a.pageX-c.x;if(f("webkit")||f("opera"))n+=k.body().scrollLeft;u=0;0<n&&n<b.w&&(n<d?u=-d:n>b.w-d&&(u=d),v.scrollLeft+=u)}if(l){l=Math.min(h.V_TRIGGER_AUTOSCROLL,b.h/2);d=a.pageY-c.y;if(f("webkit")||f("opera"))d+=k.body().scrollTop;x=0;0<d&&d<b.h&&(d<l?x=-l:d>b.h-l&&(x=l),v.scrollTop+=x)}if(u||x)return}try{v=v.parentNode}catch(z){v=null}}h.autoScroll(a)};
return h})},"dojo/dnd/TimedMoveable":function(){define(["../_base/declare","./Moveable"],function(m,f){var k=f.prototype.onMove;return m("dojo.dnd.TimedMoveable",f,{timeout:40,constructor:function(e,g){g||(g={});g.timeout&&"number"==typeof g.timeout&&0<=g.timeout&&(this.timeout=g.timeout)},onMoveStop:function(e){e._timer&&(clearTimeout(e._timer),k.call(this,e,e._leftTop));f.prototype.onMoveStop.apply(this,arguments)},onMove:function(e,g){e._leftTop=g;if(!e._timer){var d=this;e._timer=setTimeout(function(){e._timer=
null;k.call(d,e,e._leftTop)},this.timeout)}}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n){f=f("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);m.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(a){this.watch(a,
d.hitch(this,"_setStateClass"))},this);for(var a in this.cssStateNodes||{})this._trackMouseState(this[a],this.cssStateNodes[a]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",
!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function a(a){b=b.concat(m.map(b,function(b){return b+a}),"dijit"+a)}var b=this.baseClass.split(" ");this.isLeftToRight()||a("Rtl");var c="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&a(c);this.state&&a(this.state);this.selected&&a("Selected");this._opened&&a("Opened");this.disabled?a("Disabled"):this.readOnly?a("ReadOnly"):this.active?
a("Active"):this.hovering&&a("Hover");this.focused&&a("Focused");var c=this.stateNode||this.domNode,d={};m.forEach(c.className.split(" "),function(a){d[a]=!0});"_stateClasses"in this&&m.forEach(this._stateClasses,function(a){delete d[a]});m.forEach(b,function(a){d[a]=!0});var e=[],l;for(l in d)e.push(l);c.className=e.join(" ");this._stateClasses=b},_subnodeCssMouseEvent:function(a,b,c){function d(c){e.toggle(a,b+"Active",c)}if(!this.disabled&&!this.readOnly)switch(c.type){case "mouseover":case "MSPointerOver":case "pointerover":e.toggle(a,
b+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":e.toggle(a,b+"Hover",!1);d(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":d(!0);break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":d(!1);break;case "focus":case "focusin":e.toggle(a,b+"Focused",!0);break;case "blur":case "focusout":e.toggle(a,b+"Focused",!1)}},_trackMouseState:function(a,b){a._cssState=b}});c(function(){function c(a,
b,c){if(!c||!k.isDescendant(c,b))for(;b&&b!=c;b=b.parentNode)if(b._cssState){var d=n.getEnclosingWidget(b);d&&(b==d.domNode?d._cssMouseEvent(a):d._subnodeCssMouseEvent(b,b._cssState,a))}}var d=a.body(),e;h(d,b.over,function(a){c(a,a.target,a.relatedTarget)});h(d,b.out,function(a){c(a,a.target,a.relatedTarget)});h(d,l.press,function(a){e=a.target;c(a,e)});h(d,l.release,function(a){c(a,e);e=null});h(d,"focusin, focusout",function(a){var b=a.target;if(b._cssState&&!b.getAttribute("widgetId")){var c=
n.getEnclosingWidget(b);c&&c._subnodeCssMouseEvent(b,b._cssState,a)}})});return f})},"dijit/form/_FormMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/on dojo/window".split(" "),function(m,f,k,e,g,d){return f("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(d){var c=[];m.forEach(d||this.getChildren(),function(b){"value"in b?c.push(b):c=c.concat(this._getDescendantFormWidgets(b.getChildren()))},this);return c},reset:function(){m.forEach(this._getDescendantFormWidgets(),
function(d){d.reset&&d.reset()})},validate:function(){var e=!1;return m.every(m.map(this._getDescendantFormWidgets(),function(c){c._hasBeenBlurred=!0;var b=c.disabled||!c.validate||c.validate();b||e||(d.scrollIntoView(c.containerNode||c.domNode),c.focus(),e=!0);return b}),function(c){return c})},setValues:function(d){k.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",d)},_setValueAttr:function(d){var c={};m.forEach(this._getDescendantFormWidgets(),
function(a){a.name&&(c[a.name]||(c[a.name]=[])).push(a)});for(var b in c)if(c.hasOwnProperty(b)){var a=c[b],l=e.getObject(b,!1,d);void 0!==l&&(l=[].concat(l),"boolean"==typeof a[0].checked?m.forEach(a,function(a){a.set("value",-1!=m.indexOf(l,a._get("value")))}):a[0].multiple?a[0].set("value",l):m.forEach(a,function(a,b){a.set("value",l[b])}))}},getValues:function(){k.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var d=
{};m.forEach(this._getDescendantFormWidgets(),function(c){var b=c.name;if(b&&!c.disabled){var a=c.get("value");"boolean"==typeof c.checked?/Radio/.test(c.declaredClass)?!1!==a?e.setObject(b,a,d):(a=e.getObject(b,!1,d),void 0===a&&e.setObject(b,null,d)):(c=e.getObject(b,!1,d),c||(c=[],e.setObject(b,c,d)),!1!==a&&c.push(a)):(c=e.getObject(b,!1,d),"undefined"!=typeof c?e.isArray(c)?c.push(a):e.setObject(b,[c,a],d):e.setObject(b,a,d))}});return d},isValid:function(){return""==this.state},onValidStateChange:function(){},
_getState:function(){var d=m.map(this._descendants,function(c){return c.get("state")||""});return 0<=m.indexOf(d,"Error")?"Error":0<=m.indexOf(d,"Incomplete")?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(d){this._descendants=this._getDescendantFormWidgets();m.forEach(this._descendants,function(c){c._started||c.startup()});d||this._onChildChange()},_onChildChange:function(d){d&&"state"!=d&&"disabled"!=d||this._set("state",this._getState());d&&"value"!=d&&"disabled"!=d&&
"checked"!=d||(this._onChangeDelayTimer&&this._onChangeDelayTimer.remove(),this._onChangeDelayTimer=this.defer(function(){delete this._onChangeDelayTimer;this._set("value",this.get("value"))},10))},startup:function(){this.inherited(arguments);this._descendants=this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var d=this;this.own(g(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(c){c.target!=d.domNode&&
d._onChildChange(c.type.replace("attrmodified-",""))}));this.watch("state",function(c,b,a){this.onValidStateChange(""==a)})},destroy:function(){this.inherited(arguments)}})})},"dijit/_DialogMixin":function(){define(["dojo/_base/declare","./a11y"],function(m,f){return m("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var k=f._getTabNavigable(this.domNode);
this._firstFocusItem=k.lowest||k.first||this.closeButtonNode||this.domNode;this._lastFocusItem=k.last||k.highest||this._firstFocusItem}})})},"dijit/DialogUnderlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/dom-attr dojo/dom-style dojo/on dojo/window ./_Widget ./_TemplatedMixin ./BackgroundIframe ./Viewport ./main".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n){var p=m("dijit.DialogUnderlay",[c,b],{templateString:"\x3cdiv class\x3d'dijitDialogUnderlayWrapper'\x3e\x3cdiv class\x3d'dijitDialogUnderlay' tabIndex\x3d'-1' data-dojo-attach-point\x3d'node'\x3e\x3c/div\x3e\x3c/div\x3e",
dialogId:"","class":"",_modalConnects:[],_setDialogIdAttr:function(a){e.set(this.node,"id",a+"_underlay");this._set("dialogId",a)},_setClassAttr:function(a){this.node.className="dijitDialogUnderlay "+a;this._set("class",a)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.own(d(this.domNode,"keydown",f.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var a=this.node.style,b=this.domNode.style;b.display="none";var c=h.getBox(this.ownerDocument);b.top=
c.t+"px";b.left=c.l+"px";a.width=c.w+"px";a.height=c.h+"px";b.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new a(this.domNode);var b=h.get(this.ownerDocument);this._modalConnects=[l.on("resize",f.hitch(this,"layout")),d(b,"scroll",f.hitch(this,"layout"))]},hide:function(){this.bgIframe.destroy();delete this.bgIframe;for(this.domNode.style.display="none";this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();
this.inherited(arguments)},_onKeyDown:function(){}});p.show=function(a,b){var c=p._singleton;!c||c._destroyed?c=n._underlay=p._singleton=new p(a):a&&c.set(a);g.set(c.domNode,"zIndex",b);c.open||c.show()};p.hide=function(){var a=p._singleton;a&&!a._destroyed&&a.hide()};return p})},"dijit/layout/ContentPane":function(){define("dojo/_base/kernel dojo/_base/lang ../_Widget ../_Container ./_ContentPaneResizeMixin dojo/string dojo/html dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-construct dojo/_base/xhr dojo/i18n dojo/when dojo/i18n!../nls/loading".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){return b("dijit.layout.ContentPane",[k,e,g],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:m._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"\x3cspan class\x3d'dijitContentPaneLoading'\x3e\x3cspan class\x3d'dijitInline dijitIconLoading'\x3e\x3c/span\x3e${loadingState}\x3c/span\x3e",errorMessage:"\x3cspan class\x3d'dijitContentPaneError'\x3e\x3cspan class\x3d'dijitInline dijitIconError'\x3e\x3c/span\x3e${errorState}\x3c/span\x3e",
isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(a,b,c){var d=new c(a,b);return!d.href&&d._contentSetter&&d._contentSetter.parseDeferred&&!d._contentSetter.parseDeferred.isFulfilled()?d._contentSetter.parseDeferred.then(function(){return d}):d},create:function(a,b){if(!(a&&a.template||!b||"href"in a||"content"in a)){b=l.byId(b);for(var c=b.ownerDocument.createDocumentFragment();b.firstChild;)c.appendChild(b.firstChild);
a=f.delegate(a,{content:c})}this.inherited(arguments,[a,b])},postMixInProperties:function(){this.inherited(arguments);var a=r.getLocalization("dijit","loading",this.lang);this.loadingMessage=d.substitute(this.loadingMessage,a);this.errorMessage=d.substitute(this.errorMessage,a)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&c.forEach(this._contentSetter.parseResults,
function(a){a._started||a._destroyed||!f.isFunction(a.startup)||(a.startup(),a._started=!0)},this)},_startChildren:function(){c.forEach(this.getChildren(),function(a){a._started||a._destroyed||!f.isFunction(a.startup)||(a.startup(),a._started=!0)});this._contentSetter&&c.forEach(this._contentSetter.parseResults,function(a){a._started||a._destroyed||!f.isFunction(a.startup)||(a.startup(),a._started=!0)},this)},setHref:function(a){m.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.",
"","2.0");return this.set("href",a)},_setHrefAttr:function(b){this.cancel();this.onLoadDeferred=new a(f.hitch(this,"cancel"));this.onLoadDeferred.then(f.hitch(this,"onLoad"));this._set("href",b);this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0;return this.onLoadDeferred},setContent:function(a){m.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",a)},_setContentAttr:function(b){this._set("href",
"");this.cancel();this.onLoadDeferred=new a(f.hitch(this,"cancel"));this._created&&this.onLoadDeferred.then(f.hitch(this,"onLoad"));this._setContent(b||"");this._isDownloaded=!1;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(a){this._beingDestroyed||
this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},refresh:function(){this.cancel();this.onLoadDeferred=new a(f.hitch(this,"cancel"));this.onLoadDeferred.then(f.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var a=this,b={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};
f.isObject(this.ioArgs)&&f.mixin(b,this.ioArgs);var c=this._xhrDfd=(this.ioMethod||q.get)(b),d;c.then(function(b){d=b;try{return a._isDownloaded=!0,a._setContent(b,!1)}catch(y){a._onError("Content",y)}},function(b){c.canceled||a._onError("Download",b);delete a._xhrDfd;return b}).then(function(){a.onDownloadEnd();delete a._xhrDfd;return d});delete this._hrefChanged},_onLoadHandler:function(a){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(a)}catch(u){console.error("Error "+(this.widgetId||
this.id)+" running custom onLoad code: "+u.message)}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(w){console.error("Error "+this.widgetId+" running custom onUnload code: "+w.message)}},destroyDescendants:function(a){this.isLoaded&&this._onUnloadHandler();var b=this._contentSetter;c.forEach(this.getChildren(),function(b){b.destroyRecursive?b.destroyRecursive(a):b.destroy&&b.destroy(a);b._destroyed=!0});b&&(c.forEach(b.parseResults,function(b){b._destroyed||(b.destroyRecursive?
b.destroyRecursive(a):b.destroy&&b.destroy(a),b._destroyed=!0)}),delete b.parseResults);a||p.empty(this.containerNode);delete this._singleChild},_setContent:function(a,b){a=this.preprocessContent(a);this.destroyDescendants();var c=this._contentSetter;c&&c instanceof h._ContentSetter||(c=this._contentSetter=new h._ContentSetter({node:this.containerNode,_onError:f.hitch(this,this._onError),onContentError:f.hitch(this,function(a){a=this.onContentError(a);try{this.containerNode.innerHTML=a}catch(A){console.error("Fatal "+
this.id+" could not change content due to "+A.message,A)}})}));var d=f.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!a.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{}),d=c.set(f.isObject(a)&&a.domNode?a.domNode:a,d),e=this;return t(d&&d.then?d:c.parseDeferred,function(){delete e._contentSetterParams;b||(e._started&&(e._startChildren(),e._scheduleLayout()),e._onLoadHandler(a))})},
preprocessContent:function(a){return a},_onError:function(a,b,c){this.onLoadDeferred.reject(b);a=this["on"+a+"Error"].call(this,b);c?console.error(c,b):a&&this._setContent(a,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],
function(m,f,k,e){return f("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(e,d){var h=this.containerNode;if(0<d){for(h=h.firstChild;0<d;)1==h.nodeType&&d--,h=h.nextSibling;h?d="before":(h=this.containerNode,d="last")}k.place(e.domNode,h,d);this._started&&!e._started&&e.startup()},removeChild:function(e){"number"==typeof e&&(e=this.getChildren()[e]);e&&(e=e.domNode)&&e.parentNode&&e.parentNode.removeChild(e)},
hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(e,d){var h=this.getChildren();e=m.indexOf(h,e);return h[e+d]},getIndexOfChild:function(e){return m.indexOf(this.getChildren(),e)}})})},"dijit/layout/_ContentPaneResizeMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/query ../registry ../Viewport ./utils".split(" "),function(m,f,k,e,g,d,h,c,b,a){return f("dijit.layout._ContentPaneResizeMixin",
null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var a=this.getParent();this._childOfLayoutWidget=a&&a.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(b.on("resize",d.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var a=[],b=!1;h("\x3e *",this.containerNode).some(function(d){var e=c.byNode(d);e&&e.resize?a.push(e):!/script|link|style/i.test(d.nodeName)&&
d.offsetHeight&&(b=!0)});this._singleChild=1!=a.length||b?null:a[0];k.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(a,b){this._resizeCalled=!0;this._scheduleLayout(a,b)},_scheduleLayout:function(a,b){this._isShown()?this._layout(a,b):(this._needLayout=!0,this._changeSize=a,this._resultSize=b)},_layout:function(b,c){delete this._needLayout;this._wasShown||!1===this.open||this._onShow();b&&e.setMarginBox(this.domNode,b);var l=this.containerNode;l===this.domNode?
(c=c||{},d.mixin(c,b||{}),"h"in c&&"w"in c||(c=d.mixin(e.getMarginBox(l),c)),this._contentBox=a.marginBox2contentBox(l,c)):this._contentBox=e.getContentBox(l);this._layoutChildren()},_layoutChildren:function(){this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var a=this._contentBox||e.getContentBox(this.containerNode);this._singleChild.resize({w:a.w,h:a.h})}else for(var a=this.getChildren(),b,c=0;b=a[c++];)b.resize&&b.resize()},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&
"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var a=this.domNode,b=this.domNode.parentNode;return"none"!=a.style.display&&"hidden"!=a.style.visibility&&!k.contains(a,"dijitHidden")&&b&&b.style&&"none"!=b.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})})},"dijit/layout/utils":function(){define(["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],
function(m,f,k,e,g){function d(b){return b.substring(0,1).toUpperCase()+b.substring(1)}function h(b,a){var c=b.resize?b.resize(a):k.setMarginBox(b.domNode,a);c?g.mixin(b,c):(g.mixin(b,k.getMarginBox(b.domNode)),g.mixin(b,a))}var c={marginBox2contentBox:function(b,a){var c=e.getComputedStyle(b),d=k.getMarginExtents(b,c),h=k.getPadBorderExtents(b,c);return{l:e.toPixelValue(b,c.paddingLeft),t:e.toPixelValue(b,c.paddingTop),w:a.w-(d.w+h.w),h:a.h-(d.h+h.h)}},layoutChildren:function(b,a,c,e,p){a=g.mixin({},
a);f.add(b,"dijitLayoutContainer");c=m.filter(c,function(a){return"center"!=a.region&&"client"!=a.layoutAlign}).concat(m.filter(c,function(a){return"center"==a.region||"client"==a.layoutAlign}));m.forEach(c,function(b){var c=b.domNode,l=b.region||b.layoutAlign;if(!l)throw Error("No region setting for "+b.id);var g=c.style;g.left=a.l+"px";g.top=a.t+"px";g.position="absolute";f.add(c,"dijitAlign"+d(l));c={};e&&e==b.id&&(c["top"==b.region||"bottom"==b.region?"h":"w"]=p);"leading"==l&&(l=b.isLeftToRight()?
"left":"right");"trailing"==l&&(l=b.isLeftToRight()?"right":"left");"top"==l||"bottom"==l?(c.w=a.w,h(b,c),a.h-=b.h,"top"==l?a.t+=b.h:g.top=a.t+a.h+"px"):"left"==l||"right"==l?(c.h=a.h,h(b,c),a.w-=b.w,"left"==l?a.l+=b.w:g.left=a.l+a.w+"px"):"client"!=l&&"center"!=l||h(b,a)})}};g.setObject("dijit.layout.utils",c);return c})},"dojo/html":function(){define("./_base/kernel ./_base/lang ./_base/array ./_base/declare ./dom ./dom-construct ./parser".split(" "),function(m,f,k,e,g,d,h){var c=0,b={_secureForInnerHtml:function(a){return a.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,
"")},_emptyNode:d.empty,_setNodeContent:function(a,b){d.empty(a);if(b)if("number"==typeof b&&(b=b.toString()),"string"==typeof b&&(b=d.toDom(b,a.ownerDocument)),!b.nodeType&&f.isArrayLike(b))for(var c=b.length,e=0;e<b.length;e=c==b.length?e+1:0)d.place(b[e],a,"last");else d.place(b,a,"last");return a},_ContentSetter:e("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:m._scopeName,startup:!0,constructor:function(a,b){f.mixin(this,
a||{});b=this.node=g.byId(this.node||b);this.id||(this.id=["Setter",b?b.id||b.tagName:"",c++].join("_"))},set:function(a,b){void 0!==a&&(this.content=a);"number"==typeof a&&(a=a.toString());b&&this._mixin(b);this.onBegin();this.setContent();return(a=this.onEnd())&&a.then?a:this.node},setContent:function(){var a=this.node;if(!a)throw Error(this.declaredClass+": setContent given no node");try{a=b._setNodeContent(a,this.content)}catch(n){var c=this.onContentError(n);try{a.innerHTML=c}catch(p){console.error("Fatal "+
this.declaredClass+".setContent could not change content due to "+p.message,p)}}this.node=a},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred);this.parseResults&&this.parseResults.length&&(k.forEach(this.parseResults,function(a){a.destroy&&a.destroy()}),delete this.parseResults);d.empty(this.node)},onBegin:function(){var a=this.content;if(f.isString(a)&&(this.cleanContent&&(a=b._secureForInnerHtml(a)),this.extractContent)){var c=
a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);c&&(a=c[1])}this.empty();this.content=a;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(a){return"Error occurred setting content: "+a},onExecError:function(a){return"Error occurred executing scripts: "+a},_mixin:function(a){var b={},c;for(c in a)c in b||(this[c]=a[c])},_parse:function(){var a=
this.node;try{var b={};k.forEach(["dir","lang","textDir"],function(a){this[a]&&(b[a]=this[a])},this);var c=this;this.parseDeferred=h.parse({rootNode:a,noStart:!this.startup,inherited:b,scope:this.parserScope}).then(function(a){return c.parseResults=a},function(a){c._onError("Content",a,"Error parsing in _ContentSetter#"+c.id)})}catch(p){this._onError("Content",p,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(a,c,d){a=this["on"+a+"Error"].call(this,c);d?console.error(d,c):a&&b._setNodeContent(this.node,
a,!0)}}),set:function(a,c,d){void 0==c&&(console.warn("dojo.html.set: no cont argument provided, using empty string"),c="");"number"==typeof c&&(c=c.toString());return d?(new b._ContentSetter(f.mixin(d,{content:c,node:a}))).set():b._setNodeContent(a,c,!0)}};f.setObject("dojo.html",b);return b})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a){return eval("("+a+")")}function u(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<v){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=v}return b}function x(a,b){b||(b=m);var c=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),d=a.join();if(!c[d]){for(var e=[],l=0,h=a.length;l<h;l++){var g=a[l];e[e.length]=c[g]=c[g]||k.getObject(g)||~g.indexOf("/")&&b(g)}a=e.shift();c[d]=e.length?a.createSubclass?
a.createSubclass(e):a.extend.apply(a,e):a}return c[d]}new Date("X");var v=0;b.after(k,"extend",function(){v++},!0);p={_clearCache:function(){v++;_ctorMap={}},_functionFromScript:function(a,b){var c="",d="",l=a.getAttribute(b+"args")||a.getAttribute("args");b=a.getAttribute("with");l=(l||"").split(/\s*,\s*/);b&&b.length&&e.forEach(b.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(l,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||f._scopeName)+
"Type",l="data-"+(c.scope||f._scopeName)+"-",h=l+"type",g=l+"mixins",n=[];e.forEach(a,function(a){var c=d in b?b[d]:a.getAttribute(h)||a.getAttribute(d);if(c){var e=a.getAttribute(g),c=e?[c].concat(e.split(/\s*,\s*/)):[c];n.push({node:a,types:c})}});return this._instantiate(n,b,c)},_instantiate:function(b,c,d,l){function h(a){c._started||d.noStart||e.forEach(a,function(a){"function"!==typeof a.startup||a._started||a.startup()});return a}b=e.map(b,function(a){var b=a.ctor||x(a.types,d.contextRequire);
if(!b)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(b,a.node,c,d,a.scripts,a.inherited)},this);return l?a(b).then(h):h(b)},construct:function(a,d,e,h,g,n){function v(a){C&&k.setObject(C,a);for(m=0;m<P.length;m++)b[P[m].advice||"after"](a,P[m].method,k.hitch(a,P[m].func),!0);for(m=0;m<L.length;m++)L[m].call(a);for(m=0;m<T.length;m++)a.watch(T[m].prop,T[m].func);for(m=0;m<S.length;m++)r(a,S[m].event,S[m].func);return a}var p=a&&a.prototype;h=h||{};var z=
{};h.defaults&&k.mixin(z,h.defaults);n&&k.mixin(z,n);var y;y=d.attributes;var x=h.scope||f._scopeName;n="data-"+x+"-";var t={};"dojo"!==x&&(t[n+"props"]="data-dojo-props",t[n+"type"]="data-dojo-type",t[n+"mixins"]="data-dojo-mixins",t[x+"type"]="dojotype",t[n+"id"]="data-dojo-id");for(var m=0,A,x=[],C,B;A=y[m++];){var E=A.name,R=E.toLowerCase();A=A.value;switch(t[R]||R){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":B=A;break;case "data-dojo-id":case "jsid":C=
A;break;case "data-dojo-attach-point":case "dojoattachpoint":z.dojoAttachPoint=A;break;case "data-dojo-attach-event":case "dojoattachevent":z.dojoAttachEvent=A;break;case "class":z["class"]=d.className;break;case "style":z.style=d.style&&d.style.cssText;break;default:if(E in p||(E=u(a)[R]||E),E in p)switch(typeof p[E]){case "string":z[E]=A;break;case "number":z[E]=A.length?Number(A):NaN;break;case "boolean":z[E]="false"!=A.toLowerCase();break;case "function":""===A||-1!=A.search(/[^\w\.]+/i)?z[E]=
new Function(A):z[E]=k.getObject(A,!1)||new Function(A);x.push(E);break;default:R=p[E],z[E]=R&&"length"in R?A?A.split(/\s*,\s*/):[]:R instanceof Date?""==A?new Date(""):"now"==A?new Date:l.fromISOString(A):R instanceof c?f.baseUrl+A:w(A)}else z[E]=A}}for(y=0;y<x.length;y++)t=x[y].toLowerCase(),d.removeAttribute(t),d[t]=null;if(B)try{B=w.call(h.propsThis,"{"+B+"}"),k.mixin(z,B)}catch(W){throw Error(W.toString()+" in data-dojo-props\x3d'"+B+"'");}k.mixin(z,e);g||(g=a&&(a._noScript||p._noScript)?[]:
q("\x3e script[type^\x3d'dojo/']",d));var P=[],L=[],T=[],S=[];if(g)for(m=0;m<g.length;m++)t=g[m],d.removeChild(t),e=t.getAttribute(n+"event")||t.getAttribute("event"),h=t.getAttribute(n+"prop"),B=t.getAttribute(n+"method"),x=t.getAttribute(n+"advice"),y=t.getAttribute("type"),t=this._functionFromScript(t,n),e?"dojo/connect"==y?P.push({method:e,func:t}):"dojo/on"==y?S.push({event:e,func:t}):z[e]=t:"dojo/aspect"==y?P.push({method:B,advice:x,func:t}):"dojo/watch"==y?T.push({prop:h,func:t}):L.push(t);
a=(g=a.markupFactory||p.markupFactory)?g(z,d,a):new a(z,d);return a.then?a.then(v):v(a)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(q)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var d=[],l=[],h={},g=(b.scope||f._scopeName)+"Type",v="data-"+(b.scope||f._scopeName)+"-",p=v+"type",q=v+"textdir",v=v+"mixins",k=a.firstChild,u=b.inherited;
if(!u){var z=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&z(a.parentNode,b)},u={dir:z(a,"dir"),lang:z(a,"lang"),textDir:z(a,q)},y;for(y in u)u[y]||delete u[y]}y={inherited:u};for(var r,t;;)if(k)if(1!=k.nodeType)k=k.nextSibling;else if(r&&"script"==k.nodeName.toLowerCase())(u=k.getAttribute("type"))&&/^dojo\/\w/i.test(u)&&r.push(k),k=k.nextSibling;else if(t)k=k.nextSibling;else if(u=k.getAttribute(p)||k.getAttribute(g),a=k.firstChild,u||a&&(3!=a.nodeType||a.nextSibling)){t=
null;if(u){var w=k.getAttribute(v);r=w?[u].concat(w.split(/\s*,\s*/)):[u];try{t=x(r,b.contextRequire)}catch(P){}t||e.forEach(r,function(a){~a.indexOf("/")&&!h[a]&&(h[a]=!0,l[l.length]=a)});w=t&&!t.prototype._noScript?[]:null;y={types:r,ctor:t,parent:y,node:k,scripts:w};y.inherited=c(y);d.push(y)}else y={node:k,scripts:r,parent:y};r=w;t=k.stopParser||t&&t.prototype.stopParser&&!b.template;k=a}else k=k.nextSibling;else{if(!y||!y.node)break;k=y.node.nextSibling;t=!1;y=y.parent;r=y.scripts}var R=new n;
l.length?(b.contextRequire||m)(l,function(){R.resolve(e.filter(d,function(a){if(!a.ctor)try{a.ctor=x(a.types,b.contextRequire)}catch(S){}for(var c=a.parent;c&&!c.types;)c=c.parent;var d=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(d&&d.stopParser&&!b.template);a.instantiate=!c||c.instantiate&&c.instantiateChildren;return a.instantiate}))}):R.resolve(d);return R.promise},_require:function(a,b){a=w("{"+a.innerHTML+"}");var c=[],d=[],e=new n;b=b&&b.contextRequire||m;for(var l in a)c.push(l),d.push(a[l]);
b(d,function(){for(var a=0;a<c.length;a++)k.setObject(c[a],arguments[a]);e.resolve(arguments)});return e.promise},_scanAmd:function(a,b){var c=new n,d=c.promise;c.resolve(!0);var e=this;q("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){!a||"string"==typeof a||"nodeType"in a||(b=a,a=b.rootNode);var c=a?d.byId(a):h.body();b=b||{};var e=b.template?{template:!0}:{},l=[],g=this;a=this._scanAmd(c,
b).then(function(){return g.scan(c,b)}).then(function(a){return g._instantiate(a,e,b,!0)}).then(function(a){return l=l.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});k.mixin(l,a);return l}};f.parser=p;g.parseOnLoad&&t(100,p,"parse");return p})},"dojo/_base/url":function(){define(["./kernel"],function(m){var f=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/,k=/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,e=function(){for(var g=
arguments,d=[g[0]],h=1;h<g.length;h++)if(g[h]){var c=new e(g[h]+""),d=new e(d[0]+"");if(""==c.path&&!c.scheme&&!c.authority&&!c.query)null!=c.fragment&&(d.fragment=c.fragment),c=d;else if(!c.scheme&&(c.scheme=d.scheme,!c.authority&&(c.authority=d.authority,"/"!=c.path.charAt(0)))){for(var d=(d.path.substring(0,d.path.lastIndexOf("/")+1)+c.path).split("/"),b=0;b<d.length;b++)"."==d[b]?b==d.length-1?d[b]="":(d.splice(b,1),b--):0<b&&(1!=b||""!=d[0])&&".."==d[b]&&".."!=d[b-1]&&(b==d.length-1?(d.splice(b,
1),d[b-1]=""):(d.splice(b-1,2),b-=2));c.path=d.join("/")}d=[];c.scheme&&d.push(c.scheme,":");c.authority&&d.push("//",c.authority);d.push(c.path);c.query&&d.push("?",c.query);c.fragment&&d.push("#",c.fragment)}this.uri=d.join("");g=this.uri.match(f);this.scheme=g[2]||(g[1]?"":null);this.authority=g[4]||(g[3]?"":null);this.path=g[5];this.query=g[7]||(g[6]?"":null);this.fragment=g[9]||(g[8]?"":null);null!=this.authority&&(g=this.authority.match(k),this.user=g[3]||null,this.password=g[4]||null,this.host=
g[6]||g[7],this.port=g[9]||null)};e.prototype.toString=function(){return this.uri};return m._Url=e})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(m,f){var k={};m.setObject("dojo.date.stamp",k);k.fromISOString=function(e,g){k._isoRegExp||(k._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var d=k._isoRegExp.exec(e);e=null;if(d){d.shift();d[1]&&d[1]--;d[6]&&(d[6]*=1E3);g&&(g=new Date(g),f.forEach(f.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(b){return g["get"+b]()}),function(b,a){d[a]=d[a]||b}));e=new Date(d[0]||1970,d[1]||0,d[2]||1,d[3]||0,d[4]||0,d[5]||0,d[6]||0);100>d[0]&&e.setFullYear(d[0]||1970);var h=0,c=d[7]&&d[7].charAt(0);"Z"!=c&&(h=60*(d[8]||0)+(Number(d[9])||0),"-"!=c&&(h*=-1));c&&(h-=e.getTimezoneOffset());h&&e.setTime(e.getTime()+6E4*h)}return e};k.toISOString=function(e,g){var d=function(a){return 10>a?"0"+a:a};g=g||{};var h=[],c=g.zulu?"getUTC":"get",b="";"time"!=g.selector&&(b=e[c+"FullYear"](),b=["0000".substr((b+
"").length)+b,d(e[c+"Month"]()+1),d(e[c+"Date"]())].join("-"));h.push(b);"date"!=g.selector&&(b=[d(e[c+"Hours"]()),d(e[c+"Minutes"]()),d(e[c+"Seconds"]())].join(":"),c=e[c+"Milliseconds"](),g.milliseconds&&(b+="."+(100>c?"0":"")+d(c)),g.zulu?b+="Z":"time"!=g.selector&&(e=e.getTimezoneOffset(),g=Math.abs(e),b+=(0<e?"-":"+")+d(Math.floor(g/60))+":"+d(g%60)),h.push(b));return h.join("T")};return k})},"esri/core/domUtils":function(){define(["dojo/on","dojo/dom-style","./has"],function(m,f,k){var e={show:function(g){if(g=
e.getNode(g))g.style.display="block"},getNode:function(e){return e&&e.domNode||e},hide:function(g){if(g=e.getNode(g))g.style.display="none"},toggle:function(g){if(g=e.getNode(g))g.style.display="none"===g.style.display?"block":"none"},documentBox:8>=k("ie")?{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}:{w:window.innerWidth,h:window.innerHeight},setScrollable:function(e){if(e=this.getNode(e)){var d=0,h=0,c=0,b=0,a=0,l=0;return[m(e,"touchstart",function(g){d=g.touches[0].screenX;
h=g.touches[0].screenY;c=e.scrollWidth;b=e.scrollHeight;a=e.clientWidth;l=e.clientHeight}),m(e,"touchmove",function(g){g.preventDefault();var n=e.firstChild;n instanceof Text&&(n=e.childNodes[1]);var q=n._currentX||0,k=n._currentY||0,q=q+(g.touches[0].screenX-d);0<q?q=0:0>q&&Math.abs(q)+a>c&&(q=-1*(c-a));n._currentX=q;k+=g.touches[0].screenY-h;0<k?k=0:0>k&&Math.abs(k)+l>b&&(k=-1*(b-l));n._currentY=k;f.set(n,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+q+"px, "+
k+"px)"});d=g.touches[0].screenX;h=g.touches[0].screenY})]}}};return e})},"esri/identity/Credential":function(){define(["./IdentityManagerBase"],function(m){return m.Credential})},"esri/identity/IdentityManagerBase":function(){define("../core/declare dojo/_base/array dojo/Deferred dojo/_base/url dojo/cookie dojo/io-query dojo/regexp ../kernel ../config ../core/global ../core/has ../core/lang ../core/object ./ServerInfo ../core/urlUtils ../core/deferredUtils ../core/Accessor ../request ../core/Error ../core/Evented ./OAuthCredential ./OAuthInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y){var A={},B=function(a){var b=(new e(a.owningSystemUrl)).host;a=(new e(a.server)).host;var c=/.+\.arcgis\.com$/i;return c.test(b)&&c.test(a)},C=function(a,b){return!!(B(a)&&b&&f.some(b,function(b){return b.test(a.server)}))},E;m=m(v,{declaredClass:"esri.identity.IdentityManagerBase",constructor:function(){this._portalConfig=a.esriGeowConfig;this.serverInfos=[];this.oAuthInfos=[];this.credentials=[];this._soReqs=[];this._xoReqs=[];this._portals=
[];this._getOAuthHash();window.addEventListener("pageshow",function(a){this._pageShowHandler(a)}.bind(this))},defaultOAuthInfo:null,defaultTokenValidity:60,tokenValidity:null,signInPage:null,useSignInPage:!0,normalizeWebTierAuth:!1,_busy:null,_rejectOnPersistedPageShow:!1,_oAuthHash:null,_gwTokenUrl:"/sharing/generateToken",_agsRest:"/rest/services",_agsPortal:/\/sharing(\/|$)/i,_agsAdmin:/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i,_adminSvcs:/\/admin\/services(\/|$)/i,_agolSuffix:".arcgis.com",
_gwDomains:[{regex:/https?:\/\/www\.arcgis\.com/i,tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/dev\.arcgis\.com/i,tokenServiceUrl:"https://dev.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*dev[^.]*\.arcgis\.com/i,tokenServiceUrl:"https://devext.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*qa[^.]*\.arcgis\.com/i,tokenServiceUrl:"https://qaext.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*.arcgis\.com/i,tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"}],
_legacyFed:[],_regexSDirUrl:/http.+\/rest\/services\/?/ig,_regexServerType:/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|GeoenrichmentServer|VectorTileServer|SceneServer)).*/ig,_gwUser:/http.+\/users\/([^\/]+)\/?.*/i,_gwItem:/http.+\/items\/([^\/]+)\/?.*/i,_gwGroup:/http.+\/groups\/([^\/]+)\/?.*/i,_errorCodes:[499,498,403,401],_rePortalTokenSvc:/\/sharing(\/rest)?\/generatetoken/i,_publicUrls:[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,
/\/rest\/info/i],_createDefaultOAuthInfo:!0,_hasTestedIfAppIsOnPortal:!1,registerServers:function(a){var b=this.serverInfos;b?(a=f.filter(a,function(a){return!this.findServerInfo(a.server)},this),this.serverInfos=b.concat(a)):this.serverInfos=a;f.forEach(a,function(a){a.owningSystemUrl&&this._portals.push(a.owningSystemUrl);a.hasPortal&&this._portals.push(a.server)},this)},registerOAuthInfos:function(a){var b=this.oAuthInfos;b?(a=f.filter(a,function(a){return!this.findOAuthInfo(a.portalUrl)},this),
this.oAuthInfos=b.concat(a)):this.oAuthInfos=a},registerToken:function(a){a=n.mixin({},a);var b=this._sanitizeUrl(a.server),c=this.findServerInfo(b),d=this._isServerRsrc(b),e=!0,l;c||(c=new q,c.server=this._getServerInstanceRoot(b),d?c.hasServer=!0:(c.tokenServiceUrl=this._getTokenSvcUrl(b),c.hasPortal=!0),this.registerServers([c]));(l=this._findCredential(b))?(delete a.server,n.mixin(l,a),e=!1):(l=new E({userId:a.userId,server:c.server,token:a.token,expires:a.expires,ssl:a.ssl,scope:d?"server":"portal"}),
l.resources=[b],this.credentials.push(l));l.emitTokenChange(!1);e||l.refreshServerTokens()},toJSON:function(){return n.fixJson({serverInfos:f.map(this.serverInfos,function(a){return a.toJSON()}),oAuthInfos:f.map(this.oAuthInfos,function(a){return a.toJSON()}),credentials:f.map(this.credentials,function(a){return a.toJSON()})})},initialize:function(a){if(a){"string"===typeof a&&(a=JSON.parse(a));var b=a.serverInfos,c=a.oAuthInfos;a=a.credentials;if(b){var d=[];f.forEach(b,function(a){a.server&&a.tokenServiceUrl&&
d.push(a.declaredClass?a:new q(a))});d.length&&this.registerServers(d)}if(c){var e=[];f.forEach(c,function(a){a.appId&&e.push(a.declaredClass?a:new y(a))});e.length&&this.registerOAuthInfos(e)}a&&f.forEach(a,function(a){a.server&&a.token&&a.expires&&a.expires>(new Date).getTime()&&(a=a.declaredClass?a:new E(a),a.emitTokenChange(),this.credentials.push(a))},this)}},findServerInfo:function(a){var b;a=this._sanitizeUrl(a);f.some(this.serverInfos,function(c){this._hasSameServerInstance(c.server,a)&&(b=
c);return!!b},this);return b},findOAuthInfo:function(a){var b;a=this._sanitizeUrl(a);f.some(this.oAuthInfos,function(c){this._hasSameServerInstance(c.portalUrl,a)&&(b=c);return!!b},this);return b},findCredential:function(a,b){var c,d;a=this._sanitizeUrl(a);d=this._isServerRsrc(a)?"server":"portal";b?f.some(this.credentials,function(e){this._hasSameServerInstance(e.server,a)&&b===e.userId&&e.scope===d&&(c=e);return!!c},this):f.some(this.credentials,function(b){this._hasSameServerInstance(b.server,
a)&&-1!==this._getIdenticalSvcIdx(a,b)&&b.scope===d&&(c=b);return!!c},this);return c},getCredential:function(a,b){var c,d,e=!0;null!=b&&("object"===typeof b?(c=!!b.token,d=b.error,e=!1!==b.prompt):c=b);a=this._sanitizeUrl(a);var l=t.makeDeferredCancellingPending(),h=this._isAdminResource(a),n=c&&this._doPortalSignIn(a)?this._getEsriAuthCookie():null;if((c=c?this.findCredential(a):null)&&d&&498===d.code)c.destroy(),n&&n.token===b.token&&g("esri_auth",null,{expires:-1,path:"/",domain:document.domain});
else if(n||c)return a=new x("identity-manager:not-authorized","You are currently signed in as: '"+(n&&n.email||c&&c.userId)+"'. You do not have access to this resource: "+a,{error:d}),l.reject(a),l.promise;if(d=this._findCredential(a,b))return l.resolve(d),l.promise;d=this.findServerInfo(a);if(d)!d.hasServer&&this._isServerRsrc(a)&&(d._restInfoPms=this._getTokenSvcUrl(a),d.hasServer=!0);else{n=this._getTokenSvcUrl(a);if(!n)return a=new x("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),
l.reject(a),l.promise;d=new q;d.server=this._getServerInstanceRoot(a);"string"===typeof n?(d.tokenServiceUrl=n,d.hasPortal=!0):(d._restInfoPms=n,d.hasServer=!0);this.registerServers([d])}e&&d.hasPortal&&void 0===d._selfReq&&!this._findOAuthInfo(a)&&(d._selfReq={owningTenant:b&&b.owningTenant,selfDfd:this._getPortalSelf(d.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),a)});return this._enqueue(a,d,b,l,h)},getResourceName:function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,
"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""},generateToken:function(a,b,d){var l,h,g,v,p,q,k=this._rePortalTokenSvc.test(a.tokenServiceUrl),z=new e(window.location.href.toLowerCase()),y=this._getEsriAuthCookie(),f,t=!b;v=a.shortLivedTokenValidity;var w;b&&(w=c.id.tokenValidity||v||c.id.defaultTokenValidity,w>v&&0<v&&(w=v));d&&(l=d.isAdmin,h=
d.serverUrl,g=d.token,q=d.ssl,a.customParameters=d.customParameters);l?v=a.adminTokenServiceUrl:(v=a.tokenServiceUrl,p=new e(v.toLowerCase()),y&&(f=(f=y.auth_tier)&&f.toLowerCase()),("web"===f||a.webTierAuth)&&d&&d.serverUrl&&!q&&"http"===z.scheme&&(r.hasSameOrigin(z.uri,v,!0)||"https"===p.scheme&&z.host===p.host&&"7080"===z.port&&"7443"===p.port)&&(v=v.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),t&&k&&(v=v.replace(/\/rest/i,"")));d=n.mixin({query:n.mixin({request:"getToken",username:b&&
b.username,password:b&&b.password,serverUrl:h,token:g,expiration:w,referer:l||k?window.location.host:null,client:l?"referer":null,f:"json"},a.customParameters),method:t?"auto":"post",authMode:"anonymous",useProxy:this._useProxy(a,d),responseType:"json"},d&&d.ioArgs);k||(d.withCredentials=!1);return u(v,d).then(function(c){c=c.data;if(!c||!c.token)return new x("identity-manager:authentication-failed","Unable to generate token");var d=a.server;A[d]||(A[d]={});b&&(A[d][b.username]=b.password);c.validity=
w;return c})},isBusy:function(){return!!this._busy},checkSignInStatus:function(a){return this.getCredential(a,{prompt:!1}).then(function(a){return a.token?u(a.server+("portal"===a.scope?"/sharing/rest":"/rest/services"),{query:{f:"json",token:a.token},authMode:"anonymous"}).then(function(){return a}).catch(function(b){if(498===b.code)throw a.destroy(),new x("identity-manager:not-authenticated","User is not signed in.");return a}):a})},setRedirectionHandler:function(a){this._redirectFunc=a},setProtocolErrorHandler:function(a){this._protocolFunc=
a},signIn:function(){},oAuthSignIn:function(){},destroyCredentials:function(){if(this.credentials){var a=this.credentials.slice();f.forEach(a,function(a){a.destroy()})}this.emit("credentials-destroy")},_getOAuthHash:function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));var a=d.queryToObject(a),b=!1;a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username")?(a.state=JSON.parse(a.state),this._oAuthHash=a,b=!0):a.error&&a.error_description&&(console.log("IdentityManager OAuth Error: ",
a.error," - ",a.error_description),"access_denied"===a.error&&(b=!0));b&&(!l("ie")||8<l("ie"))&&(window.location.hash="")}},_pageShowHandler:function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=new x("identity-manager:user-aborted","ABORTED"),this._errbackFunc(a))},_findCredential:function(a,b){var c=-1,d,e,l,h=b&&b.token;b=b&&b.resource;var g=this._isServerRsrc(a)?"server":"portal",n=f.filter(this.credentials,function(b){return this._hasSameServerInstance(b.server,a)&&b.scope===
g},this);a=b||a;if(n.length)if(1===n.length)if(b=n[0],e=(d=(l=this.findServerInfo(b.server))&&l.owningSystemUrl)&&this.findCredential(d,b.userId),c=this._getIdenticalSvcIdx(a,b),h)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,e));else return-1===c&&b.resources.push(a),this._addResource(a,e),b;else{var v,p;f.some(n,function(b){p=this._getIdenticalSvcIdx(a,b);return-1!==p?(v=b,e=(d=(l=this.findServerInfo(v.server))&&l.owningSystemUrl)&&this.findCredential(d,v.userId),c=p,!0):!1},this);if(h)v&&
(v.resources.splice(c,1),this._removeResource(a,e));else if(v)return this._addResource(a,e),v}},_findOAuthInfo:function(a){var b=this.findOAuthInfo(a);b||f.some(this.oAuthInfos,function(c){this._isIdProvider(c.portalUrl,a)&&(b=c);return!!b},this);return b},_addResource:function(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)},_removeResource:function(a,b){var c=-1;b&&(c=this._getIdenticalSvcIdx(a,b),-1<c&&b.resources.splice(c,1))},_useProxy:function(a,b){return b&&b.isAdmin&&!r.hasSameOrigin(a.adminTokenServiceUrl,
window.location.href)||!this._isPortalDomain(a.tokenServiceUrl)&&10.1==a.currentVersion&&!r.hasSameOrigin(a.tokenServiceUrl,window.location.href)},_getOrigin:function(a){a=new e(a);return a.scheme+"://"+a.host+(null!=a.port?":"+a.port:"")},_getServerInstanceRoot:function(a){var b=a.toLowerCase(),c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&(c=b.indexOf("/admin"));-1===c&&(c=b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&(c=b.length-1);return-1<c?a.substring(0,c):a},_hasSameServerInstance:function(a,
b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b},_normalizeAGOLorgDomain:function(a){var b=/^https?:\/\/.+\.maps\.arcgis\.com/i,c=/^https?:\/\/.+\.mapsdevext\.arcgis\.com/i,d=/^https?:\/\/.+\.mapsqa\.arcgis\.com/i;b.test(a)?a=a.replace(b,"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):
d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a},_sanitizeUrl:function(a){var c=(b.request.proxyUrl||"").toLowerCase(),d=c?a.toLowerCase().indexOf(c+"?"):-1;-1!==d&&(a=a.substring(d+c.length+1));a=r.normalize(a);return r.urlToObject(a).path},_isRESTService:function(a){return-1<a.indexOf(this._agsRest)},_isAdminResource:function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)},_isServerRsrc:function(a){return this._isRESTService(a)||this._isAdminResource(a)},_isIdenticalService:function(a,
b){var c;this._isRESTService(a)&&this._isRESTService(b)?(a=this._getSuffix(a).toLowerCase(),b=this._getSuffix(b).toLowerCase(),c=a===b,c||(c=/(.*)\/(MapServer|FeatureServer).*/ig,c=a.replace(c,"$1")===b.replace(c,"$1"))):this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=!0);return c},_isPortalDomain:function(b){b=b.toLowerCase();var c=(new e(b)).authority,d=this._portalConfig,l=-1!==c.indexOf(this._agolSuffix);!l&&d&&
(l=this._hasSameServerInstance(this._getServerInstanceRoot(d.restBaseUrl),b));l||(!this._arcgisUrl&&(d=p.getDeepValue("esri.arcgis.utils.arcgisUrl",a))&&(this._arcgisUrl=(new e(d)).authority),this._arcgisUrl&&(l=this._arcgisUrl.toLowerCase()===c));l||(l=f.some(this._portals,function(a){return this._hasSameServerInstance(a,b)},this));return l=l||this._agsPortal.test(b)},_isIdProvider:function(a,b){var c=-1,d=-1;f.forEach(this._gwDomains,function(e,l){-1===c&&e.regex.test(a)&&(c=l);-1===d&&e.regex.test(b)&&
(d=l)});var e=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)e=!0}else if(1===c){if(1===d||2===d)e=!0}else 2===c?2===d&&(e=!0):3===c&&3===d&&(e=!0);if(!e){var l=this.findServerInfo(b),h=l&&l.owningSystemUrl;h&&B(l)&&this._isPortalDomain(h)&&this._isIdProvider(a,h)&&(e=!0)}return e},_isPublic:function(a){a=this._sanitizeUrl(a);return f.some(this._publicUrls,function(b){return b.test(a)})},_getIdenticalSvcIdx:function(a,b){var c=-1;f.some(b.resources,function(b,d){return this._isIdenticalService(a,
b)?(c=d,!0):!1},this);return c},_getSuffix:function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")},_getTokenSvcUrl:function(a){var b,c,d=this._isRESTService(a);if(d||this._isAdminResource(a))return c=a.toLowerCase().indexOf(d?this._agsRest:"/admin/"),b=a.substring(0,c)+"/admin/generateToken",a=a.substring(0,c)+(d?"/rest/info":"/info"),c=u(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}),{adminUrl:b,promise:c};if(this._isPortalDomain(a)){var l=
"";f.some(this._gwDomains,function(b){b.regex.test(a)&&(l=b.tokenServiceUrl);return!!l});l||f.some(this._portals,function(b){this._hasSameServerInstance(b,a)&&(l=b+this._gwTokenUrl);return!!l},this);l||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(l=a.substring(0,c)+this._gwTokenUrl));l||(l=this._getOrigin(a)+this._gwTokenUrl);l&&(b=(new e(a)).port,/^http:\/\//i.test(a)&&"7080"===b&&(l=l.replace(/:7080/i,":7443")),l=l.replace(/http:/i,"https:"));return l}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"},
_getPortalSelf:function(a,b){"https:"===window.location.protocol?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return u(a,{query:{f:"json"},authMode:"anonymous",responseType:"json",withCredentials:!0}).then(function(a){return a.data})},_hasPortalSession:function(){return!!this._getEsriAuthCookie()},_getEsriAuthCookie:function(){var a=null;if(g.isSupported()){var b=this._getAllCookies("esri_auth"),c;for(c=0;c<
b.length;c++){var d=JSON.parse(b[c]);if(d.portalApp){a=d;break}}}a&&(b=null,a.expires&&("number"===typeof a.expires?b=a.expires:"string"===typeof a.expires&&(b=Date.parse(a.expires)),isNaN(b)&&(b=null),a.expires=b),b&&b<Date.now()&&(a=null));return a},_getAllCookies:function(a){var b=[],c=document.cookie.match(new RegExp("(?:^|; )"+h.escapeString(a)+"\x3d([^;]*)","g"));if(c)for(a=0;a<c.length;a++){var d=c[a],e=d.indexOf("\x3d");-1<e&&(d=d.substring(e+1),b.push(decodeURIComponent(d)))}return b},_doPortalSignIn:function(a){if(g.isSupported()){var b=
this._getEsriAuthCookie(),c=this._portalConfig,d=window.location.href,e=this.findServerInfo(a);if(this.useSignInPage&&(c||this._isPortalDomain(d)||b)&&(e?e.hasPortal||e.owningSystemUrl&&this._isPortalDomain(e.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(d,a)||c&&(this._hasSameServerInstance(this._getServerInstanceRoot(c.restBaseUrl),a)||this._isIdProvider(c.restBaseUrl,a))||r.hasSameOrigin(d,a,!0)))return!0}return!1},_checkProtocol:function(a,b,c,d){var e=!0;d=d?b.adminTokenServiceUrl:
b.tokenServiceUrl;0===d.trim().toLowerCase().indexOf("https:")&&0!==window.location.href.toLowerCase().indexOf("https:")&&r.getProxyRule(d)&&(e=this._protocolFunc?!!this._protocolFunc({resourceUrl:a,serverInfo:b}):!1,e||(a=new x("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection."),c(a)));return e},_enqueue:function(a,b,c,d,e,l){d||(d=t.makeDeferredCancellingPending());d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=e;d.refresh_=l;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),
this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):this._xoReqs.push(d):this._doSignIn(d);return d.promise},_doSignIn:function(a){this._busy=a;this._rejectOnPersistedPageShow=!1;var b=this,c=function(c){var d=a.options_&&a.options_.resource,e=a.resUrl_,l=a.refresh_,h=!1;-1===f.indexOf(b.credentials,c)&&(l&&-1!==f.indexOf(b.credentials,l)?(l.userId=c.userId,l.token=c.token,l.expires=c.expires,l.validity=c.validity,l.ssl=c.ssl,l.creationTime=
c.creationTime,h=!0,c=l):b.credentials.push(c));c.resources||(c.resources=[]);c.resources.push(d||e);c.scope=b._isServerRsrc(e)?"server":"portal";c.emitTokenChange();var d=b._soReqs,g={};b._soReqs=[];f.forEach(d,function(a){if(!this._isIdenticalService(e,a.resUrl_)){var b=this._getSuffix(a.resUrl_);g[b]||(g[b]=!0,c.resources.push(a.resUrl_))}},b);a.resolve(c);f.forEach(d,function(a){this._hasSameServerInstance(this._getServerInstanceRoot(e),a.resUrl_)?a.resolve(c):this._soReqs.push(a)},b);b._busy=
a.resUrl_=a.sinfo_=a.refresh_=null;h||b.emit("credential-create",{credential:c});b._soReqs.length?b._doSignIn(b._soReqs.shift()):b._xoReqs.length&&b._doSignIn(b._xoReqs.shift())},d=function(c){a.reject(c);b._busy=a.resUrl_=a.sinfo_=a.refresh_=null;b._soReqs.length?b._doSignIn(b._soReqs.shift()):b._xoReqs.length&&b._doSignIn(b._xoReqs.shift())},e=function(e,l,h,g){var n=a.sinfo_,v=!a.options_||!1!==a.options_.prompt,p=n.hasPortal&&b._findOAuthInfo(a.resUrl_);b._doPortalSignIn(a.resUrl_)?(e=b._getEsriAuthCookie(),
p=b._portalConfig,e?(n.webTierAuth||"web"!==(e.auth_tier&&e.auth_tier.toLowerCase())||(n.webTierAuth=!0),c(new E({userId:e.email,server:n.server,token:e.token,expires:e.expires}))):v?(v="",e=window.location.href,v=b.signInPage?b.signInPage:p?p.baseUrl+p.signin:b._isIdProvider(e,a.resUrl_)?b._getOrigin(e)+"/home/signin.html":n.tokenServiceUrl.replace(b._rePortalTokenSvc,"")+"/home/signin.html",v=v.replace(/http:/i,"https:"),p&&!1===p.useSSL&&(v=v.replace(/https:/i,"http:")),0===e.toLowerCase().replace("https",
"http").indexOf(v.toLowerCase().replace("https","http"))?(n=new x("identity-manager:unexpected-error","Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: "+a.resUrl_),d(n)):(b._rejectOnPersistedPageShow=!0,b._redirectFunc?b._redirectFunc({signInPage:v,returnUrlParamName:"returnUrl",returnUrl:e,resourceUrl:a.resUrl_,serverInfo:n}):window.location=v+"?returnUrl\x3d"+window.escape(e))):(n=new x("identity-manager:not-authenticated","User is not signed in."),
d(n))):e?c(new E({userId:e,server:n.server,token:h,expires:null!=g?Number(g):null,ssl:!!l})):p?(e=p._oAuthCred,e||(l=new z(p,window.localStorage),h=new z(p,window.sessionStorage),l.isValid()&&h.isValid()?l.expires>h.expires?(e=l,h.destroy()):(e=h,l.destroy()):e=l.isValid()?l:h,p._oAuthCred=e),e.isValid()?c(new E({userId:e.userId,server:n.server,token:e.token,expires:e.expires,ssl:e.ssl,_oAuthCred:e})):b._oAuthHash&&b._oAuthHash.state.portalUrl===p.portalUrl?(v=b._oAuthHash,n=new E({userId:v.username,
server:n.server,token:v.access_token,expires:(new Date).getTime()+1E3*Number(v.expires_in),ssl:"true"===v.ssl,oAuthState:v.state,_oAuthCred:e}),e.storage=v.persist?window.localStorage:window.sessionStorage,e.token=n.token,e.expires=n.expires,e.userId=n.userId,e.ssl=n.ssl,e.save(),b._oAuthHash=null,c(n)):v?a._pendingDfd=b.oAuthSignIn(a.resUrl_,n,p,a.options_).then(c,d):(n=new x("identity-manager:not-authenticated","User is not signed in."),d(n))):v?b._checkProtocol(a.resUrl_,n,d,a.admin_)&&(v=a.options_,
a.admin_&&(v=v||{},v.isAdmin=!0),a._pendingDfd=b.signIn(a.resUrl_,n,v).then(c,d)):(n=new x("identity-manager:not-authenticated","User is not signed in."),d(n))},l=function(){var e=a.sinfo_,l=e.owningSystemUrl,h=a.options_,g,n,v,p;h&&(g=h.token,n=h.error,v=h.prompt);(p=b._findCredential(l,{token:g,resource:a.resUrl_}))||f.some(b.credentials,function(a){this._isIdProvider(l,a.server)&&(p=a);return!!p},b);p?(h=b.findCredential(a.resUrl_,p.userId))?c(h):C(e,b._legacyFed)?(h=p.toJSON(),h.server=e.server,
h.resources=null,c(new E(h))):(a._pendingDfd=b.generateToken(b.findServerInfo(p.server),null,{serverUrl:a.resUrl_,token:p.token,ssl:p.ssl})).then(function(b){c(new E({userId:p.userId,server:e.server,token:b.token,expires:null!=b.expires?Number(b.expires):null,ssl:!!b.ssl,isAdmin:a.admin_,validity:b.validity}))},d):(b._busy=null,g&&(a.options_.token=null),(a._pendingDfd=b.getCredential(l.replace(/\/?$/,"/sharing"),{resource:a.resUrl_,owningTenant:e.owningTenant,token:g,error:n,prompt:v})).then(function(c){b._enqueue(a.resUrl_,
a.sinfo_,a.options_,a,a.admin_)},function(a){d(a)}))};this._errbackFunc=d;var h=a.sinfo_.owningSystemUrl,g=this._isServerRsrc(a.resUrl_),n=a.sinfo_._restInfoPms;n?n.promise.then(function(c){var d=a.sinfo_;d.adminTokenServiceUrl=d._restInfoPms.adminUrl;d._restInfoPms=null;d.tokenServiceUrl=p.getDeepValue("authInfo.tokenServicesUrl",c)||p.getDeepValue("authInfo.tokenServiceUrl",c)||p.getDeepValue("tokenServiceUrl",c);d.shortLivedTokenValidity=p.getDeepValue("authInfo.shortLivedTokenValidity",c);d.currentVersion=
c.currentVersion;d.owningTenant=c.owningTenant;(c=d.owningSystemUrl=c.owningSystemUrl)&&b._portals.push(c);g&&c?l():e()},function(){a.sinfo_._restInfoPms=null;var b=new x("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");d(b)}):g&&h?l():a.sinfo_._selfReq?a.sinfo_._selfReq.selfDfd.then(function(c){var d={},e,l,h,g;c&&(e=c.user&&c.user.username,d.username=e,d.allSSL=c.allSSL,l=c.supportsOAuth,h=c.currentVersion,"multitenant"===c.portalMode&&
(g=c.customBaseUrl));a.sinfo_.webTierAuth=!!e;return e&&b.normalizeWebTierAuth?b.generateToken(a.sinfo_,null,{ssl:d.allSSL}).always(function(a){d.portalToken=a&&a.token;d.tokenExpiration=a&&a.expires;return d}):!e&&l&&4.4<=parseFloat(h)&&!b._doPortalSignIn(a.resUrl_)?b._generateOAuthInfo({portalUrl:a.sinfo_.server,customBaseUrl:g,owningTenant:a.sinfo_._selfReq.owningTenant}).always(function(){return d}):d}).always(function(b){a.sinfo_._selfReq=null;b?e(b.username,b.allSSL,b.portalToken,b.tokenExpiration):
e()}):e()},_generateOAuthInfo:function(a){var b=this,c,d=a.portalUrl,e=a.customBaseUrl,l=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){c=window.location.href;var h=c.indexOf("?");-1<h&&(c=c.slice(0,h));h=c.search(/\/(apps|home)\//);c=-1<h?c.slice(0,h):null}a&&c?(this._hasTestedIfAppIsOnPortal=!0,a=u(c+"/sharing/rest",{query:{f:"json"},responseType:"json"}).then(function(){b.defaultOAuthInfo=new y({appId:"arcgisonline",popup:!0,popupCallbackUrl:c+
"/home/oauth-callback.html"})})):(a=new k,a.resolve(),a=a.promise);return a.then(function(){if(b.defaultOAuthInfo)return d=d.replace(/^http:/i,"https:"),u(d+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:l,client_id:b.defaultOAuthInfo.appId,redirect_uri:r.makeAbsolute(b.defaultOAuthInfo.popupCallbackUrl),f:"json"},responseType:"json"}).then(function(a){if(a.data.valid){var c=b.defaultOAuthInfo.clone();c.portalUrl=a.data.urlKey&&e?"https://"+a.data.urlKey+"."+e:d;b.oAuthInfos.push(c)}})})}});
E=w.createSubclass([v],{declaredClass:"esri.identity.Credential",constructor:function(a){a&&a._oAuthCred&&(this._oAuthCred=a._oAuthCred)},initialize:function(){this.resources=this.resources||[];null==this.creationTime&&(this.creationTime=(new Date).getTime())},_oAuthCred:null,properties:{creationTime:{},expires:{},isAdmin:{},oAuthState:{},resources:{},scope:{},server:{},ssl:{},token:{},tokenRefreshBuffer:2,userId:{},validity:{}},refreshToken:function(){var a=this,b=this.resources&&this.resources[0],
d=c.id.findServerInfo(this.server),e=d&&d.owningSystemUrl,l=!!e&&"server"===this.scope,h=l&&C(d,c.id._legacyFed),g=l&&c.id.findServerInfo(e),n,v=(n=d.webTierAuth)&&c.id.normalizeWebTierAuth,p=A[this.server],p=p&&p[this.userId],q={username:this.userId,password:p},k;if(!n||v)if(l&&!g&&f.some(c.id.serverInfos,function(a){c.id._isIdProvider(e,a.server)&&(g=a);return!!g}),n=g&&c.id.findCredential(g.server,this.userId),!l||n)if(h)n.refreshToken();else{if(l)k={serverUrl:b,token:n&&n.token,ssl:n&&n.ssl};
else if(v)q=null,k={ssl:this.ssl};else if(p)this.isAdmin&&(k={isAdmin:!0});else{var u;b&&(b=c.id._sanitizeUrl(b),this._enqueued=1,u=c.id._enqueue(b,d,null,null,this.isAdmin,this),u.then(function(){a._enqueued=0;a.refreshServerTokens()}).then(null,function(){a._enqueued=0}));return u}return c.id.generateToken(l?g:d,l?null:q,k).then(function(b){a.token=b.token;a.expires=null!=b.expires?Number(b.expires):null;a.creationTime=(new Date).getTime();a.validity=b.validity;a.emitTokenChange();a.refreshServerTokens()}).then(null,
function(){})}},refreshServerTokens:function(){"portal"===this.scope&&f.forEach(c.id.credentials,function(a){var b=c.id.findServerInfo(a.server),d=b&&b.owningSystemUrl;a!==this&&a.userId===this.userId&&d&&"server"===a.scope&&(c.id._hasSameServerInstance(this.server,d)||c.id._isIdProvider(d,this.server))&&(C(b,c.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.emitTokenChange()):a.refreshToken())},this)},emitTokenChange:function(a){clearTimeout(this._refreshTimer);
var b=this.server&&c.id.findServerInfo(this.server),d=(b=b&&b.owningSystemUrl)&&c.id.findServerInfo(b);!1===a||b&&"portal"!==this.scope&&(!d||!d.webTierAuth||c.id.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer();this.emit("token-change")},destroy:function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var a=f.indexOf(c.id.credentials,this);
-1<a&&c.id.credentials.splice(a,1);this.emitTokenChange();this.emit("destroy")},toJSON:function(){var a=n.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a},_startRefreshTimer:function(){clearTimeout(this._refreshTimer);var a=6E4*this.tokenRefreshBuffer,b=(this.validity?this.creationTime+6E4*this.validity:
this.expires)-(new Date).getTime();0>b&&(b=0);this._refreshTimer=setTimeout(this.refreshToken.bind(this),b>a?b-a:b)}});m.Credential=E;return m})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(m,f){m.cookie=function(k,e,g){var d=document.cookie,h;if(1==arguments.length)h=(h=d.match(new RegExp("(?:^|; )"+f.escapeString(k)+"\x3d([^;]*)")))?decodeURIComponent(h[1]):void 0;else{g=g||{};d=g.expires;if("number"==typeof d){var c=new Date;c.setTime(c.getTime()+864E5*d);d=g.expires=
c}d&&d.toUTCString&&(g.expires=d.toUTCString());e=encodeURIComponent(e);var d=k+"\x3d"+e,b;for(b in g)d+="; "+b,c=g[b],!0!==c&&(d+="\x3d"+c);document.cookie=d}return h};m.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return m.cookie})},"esri/identity/ServerInfo":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){return function(h){function c(b){b=h.call(this)||this;b.adminTokenServiceUrl=null;b.currentVersion=null;b.hasPortal=null;b.hasServer=null;b.owningSystemUrl=null;b.owningTenant=null;b.server=null;b.shortLivedTokenValidity=null;b.tokenServiceUrl=null;b.webTierAuth=null;return b}k(c,h);e([d.property({json:{write:!0}})],c.prototype,"adminTokenServiceUrl",void 0);e([d.property({json:{write:!0}})],c.prototype,"currentVersion",void 0);e([d.property({json:{write:!0}})],c.prototype,"hasPortal",
void 0);e([d.property({json:{write:!0}})],c.prototype,"hasServer",void 0);e([d.property({json:{write:!0}})],c.prototype,"owningSystemUrl",void 0);e([d.property({json:{write:!0}})],c.prototype,"owningTenant",void 0);e([d.property({json:{write:!0}})],c.prototype,"server",void 0);e([d.property({json:{write:!0}})],c.prototype,"shortLivedTokenValidity",void 0);e([d.property({json:{write:!0}})],c.prototype,"tokenServiceUrl",void 0);e([d.property({json:{write:!0}})],c.prototype,"webTierAuth",void 0);return c=
e([d.subclass("esri.identity.ServerInfo")],c)}(d.declared(g))})},"esri/core/JSONSupport":function(){define("require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper ./Accessor ./declare ./accessorSupport/decorators ./accessorSupport/read ./accessorSupport/write".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a,b){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");var c=new this;c.read(a,b);return c}var l=function(d){function l(){return null!==
d&&d.apply(this,arguments)||this}k(l,d);l.prototype.read=function(a,b){c.default(this,a,b);return this};l.prototype.write=function(a,c){return b.default(this,a||{},c)};l.prototype.toJSON=function(a){return this.write(null,a)};l.fromJSON=function(b,c){return a.call(this,b,c)};return l=e([h.subclass("esri.core.JSONSupport")],l)}(h.declared(g));l.prototype.toJSON.isDefaultToJSON=!0;d.after(function(b){d.hasMixin(b,l)&&(b.fromJSON=a.bind(b))});return l})},"esri/core/accessorSupport/read":function(){define("require exports ../tsSupport/assignHelper ./get ./utils ./extensions/serializableProperty".split(" "),
function(m,f,k,e,g,d){function h(b,a,l){void 0===l&&(l=c);if(a&&"object"===typeof a){for(var h=g.getProperties(b),p=h.metadatas,q={},k=0,f=Object.getOwnPropertyNames(a);k<f.length;k++){var w=q,u=p,x=f[k],v=a,z=l,y=d.originSpecificReadPropertyDefinition(u[x],z);y&&(!y.read||!1!==y.read.enabled&&!y.read.source)&&(w[x]=!0);for(var m=0,B=Object.getOwnPropertyNames(u);m<B.length;m++){var C=B[m],y=d.originSpecificReadPropertyDefinition(u[C],z),E;a:{E=x;var D=v;if(y&&y.read&&!1!==y.read.enabled&&y.read.source)if(y=
y.read.source,"string"===typeof y){if(y===E||-1<y.indexOf(".")&&0===y.indexOf(E)&&e.exists(y,D)){E=!0;break a}}else for(var F=0;F<y.length;F++){var M=y[F];if(M===E||-1<M.indexOf(".")&&0===M.indexOf(E)&&e.exists(M,D)){E=!0;break a}}E=!1}E&&(w[C]=!0)}}h.setDefaultOrigin(l.origin);f=0;for(w=Object.getOwnPropertyNames(q);f<w.length;f++)k=w[f],x=(u=d.originSpecificReadPropertyDefinition(p[k],l).read)&&u.source,v=void 0,v=x&&"string"===typeof x?e.valueOf(a,x):a[k],u&&u.reader&&(v=u.reader.call(b,v,a,l)),
void 0!==v&&h.set(k,v);a=0;for(p=Object.getOwnPropertyNames(p);a<p.length;a++)k=p[a],q[k]||(f=b,w=h,u=l,x=(x=d.originSpecificReadPropertyDefinition(w.metadatas[k],u))&&x.read&&x.read.default,void 0!==x&&(f="function"===typeof x?x.call(f,k,u):x,void 0!==f&&w.set(k,f)));h.setDefaultOrigin("user")}}Object.defineProperty(f,"__esModule",{value:!0});var c={origin:"service"};f.read=h;f.readLoadable=function(b,a,d,e){void 0===e&&(e=c);a=k({},e,{messages:[]});d(a);a.messages.forEach(function(a){"warning"!==
a.type||b.loaded?e&&e.messages.push(a):b.loadWarnings.push(a)})};f.default=h})},"esri/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(m){for(var f,k=1,e=arguments.length;k<e;k++){f=arguments[k];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(m[g]=f[g])}return m}})},"esri/core/accessorSupport/write":function(){define("require exports ../Error ../Logger ./PropertyOrigin ./utils ./extensions/serializableProperty".split(" "),function(m,f,k,e,g,d,
h){function c(b,c,d,e,h,f){if(!e||!e.write)return!1;var l=b.get(d);if(void 0===l)return!1;if(!h&&e.write.overridePolicy){var n=e.write.overridePolicy.call(b,l,d,f);void 0!==n&&(h=n)}h||(h=e.write);if(!h||!1===h.enabled)return!1;if(null===l){if(h.allowNull)return!0;h.isRequired&&((b=new k("web-document-write:property-required","Missing value for required property '"+d+"' on '"+b.declaredClass+"'",{propertyName:d,target:b}),f)&&f.messages?f.messages.push(b):b&&!f&&a.error(b.name,b.message));return!1}return!h.ignoreOrigin&&
f&&f.origin&&c.store.originOf(d)<g.nameToId(f.origin)?!1:!0}function b(a,b,e){if(a&&"function"===typeof a.toJSON&&(!a.toJSON.isDefaultToJSON||!a.write))return d.merge(b,a.toJSON());var l=d.getProperties(a),n=l.metadatas,p;for(p in n){var k=h.originSpecificWritePropertyDefinition(n[p],e);if(c(a,l,p,k,null,e)){var u=a.get(p),f={};k.write.writer.call(a,u,f,"string"===typeof k.write.target?k.write.target:p,e);k=f;0<Object.keys(k).length&&(b=d.merge(b,k),e&&e.writtenProperties&&e.writtenProperties.push({target:a,
propName:p,oldOrigin:g.idToReadableName(l.store.originOf(p)),newOrigin:e.origin}))}}return b}Object.defineProperty(f,"__esModule",{value:!0});var a=e.getLogger("esri.core.accessorSupport.write");f.willPropertyWrite=function(a,b,e,g){var l=d.getProperties(a),n=h.originSpecificWritePropertyDefinition(l.metadatas[b],g);return n?c(a,l,b,n,e,g):!1};f.write=b;f.disableWriteDefaultPolicy=function(a){return function(b){return{enabled:b!==a}}};f.default=b})},"esri/core/urlUtils":function(){define("require exports ./tsSupport/assignHelper dojo/io-query dojo/_base/url ../config ./Error ./global ./lang ./Logger".split(" "),
function(m,f,k,e,g,d,h,c,b,a){function l(a){var b={path:null,query:null},c=new g(a),d=a.indexOf("?");null===c.query?b.path=a:(b.path=a.substring(0,d),b.query=e.queryToObject(c.query));c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.substring(0,b.path.length-(c.fragment.length+1))));return b}function n(a){var b=a.indexOf("?");-1!==b?(W.path=a.slice(0,b),W.query=a.slice(b+1)):(W.path=a,W.query=null);return W}function p(a){a=n(a).path;a&&"/"===a[a.length-1]||(a+="/");a=I(a,!0);return a=
a.toLowerCase()}function q(a){var b=H.proxyRules;a=p(a);for(var c=0;c<b.length;c++)if(0===a.indexOf(b[c].urlPrefix))return b[c]}function r(a){a=x(a);var b=a.indexOf("/sharing");return 0<b?a.substring(0,b):a.replace(/\/+$/,"")}function t(a,b,c){void 0===c&&(c=!1);a=J(a);b=J(b);return c||a.scheme===b.scheme?a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port:!1}function w(a,b,c){void 0===b&&(b=f.appBaseUrl);if(E(a))return c&&c.preserveProtocolRelative?a:"http"===f.appUrl.scheme&&f.appUrl.authority===
z(a).slice(2)?"http:"+a:"https:"+a;if(D(a))return a;c=v;if("/"===a[0]){var d=b.indexOf("//"),d=b.indexOf("/",d+2);b=-1===d?b:b.slice(0,d)}return c(b,a)}function u(a,b,c){void 0===b&&(b=f.appBaseUrl);if(!y(a))return a;var d=x(a),e=d.toLowerCase();b=x(b).toLowerCase().replace(/\/+$/,"");if((c=c?x(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;for(var l=function(a,b,c){c=a.indexOf(b,c);return-1===c?a.length:c},h=l(e,"/",e.indexOf("//")+2),g=-1;e.slice(0,h+1)===b.slice(0,h)+"/";){g=
h+1;if(h===e.length)break;h=l(e,"/",h+1)}if(-1===g||c&&g<c.length)return a;a=d.slice(g);d=b.slice(g-1).replace(/[^/]+/g,"").length;if(0<d)for(e=0;e<d;e++)a="../"+a;else a="./"+a;return a}function x(a){a=a.trim();a=w(a);if(/^https?:\/\//i.test(a)){var b=n(a);a=b.path.replace(/\/{2,}/g,"/");a=a.replace("/","//");b.query&&(a+="?"+b.query)}a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");return a=G(a)}function v(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a&&a.length){b=[];if(y(a[0])){var c=
a[0],d=c.indexOf("//");b.push(c.slice(0,d+1));L.test(a[0])&&(b[0]+="/");a[0]=c.slice(d+2)}else"/"===a[0][0]&&b.push("");a=a.reduce(function(a,b){return b?a.concat(b.split("/")):a},[]);for(c=0;c<a.length;c++)d=a[c],".."===d&&0<b.length?b.pop():!d||"."===d&&0!==b.length||b.push(d);return b.join("/")}}function z(a){if(A(a)||B(a))return null;var b=a.indexOf("://");if(-1===b&&E(a))b=2;else if(-1!==b)b+=3;else return null;b=a.indexOf("/",b);return-1===b?a:a.slice(0,b)}function y(a){return E(a)||D(a)}function A(a){return"blob:"===
a.slice(0,5)}function B(a){return"data:"===a.slice(0,5)}function C(a){return(a=a.match(Y))?{mediaType:a[1],isBase64:!!a[2],data:a[3]}:null}function E(a){return a&&"/"===a[0]&&"/"===a[1]}function D(a){return K.test(a)}function F(a){return R.test(a)||"http"===f.appUrl.scheme&&E(a)}function M(a){return E(a)?"https:"+a:a.replace(R,"https:")}function N(){return"https"===f.appUrl.scheme}function I(a,b){void 0===b&&(b=!1);if(E(a))return a.slice(2);a=a.replace(K,"");b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&
(a=a.slice(2));return a}function G(a){var c=H.httpsDomains;if(!F(a))return a;var d=a.indexOf("/",7),e;e=-1===d?a:a.slice(0,d);e=e.toLowerCase().slice(7);if(T.test(e))if(b.endsWith(e,":80"))e=e.slice(0,-3),a=a.replace(":80","");else return a;if("http"===f.appUrl.scheme&&e===f.appUrl.authority&&!S.test(a))return a;if(N()&&e===f.appUrl.authority||c&&c.some(function(a){return e===a||b.endsWith(e,"."+a)})||N()&&!q(a))a=M(a);return a}function O(a,b,c){if(!(b&&c&&a&&y(a)))return a;var d=a.indexOf("//"),
e=a.indexOf("/",d+2),l=a.indexOf(":",d+2),e=Math.min(0>e?a.length:e,0>l?a.length:l);if(a.slice(d+2,e).toLowerCase()!==b.toLowerCase())return a;b=a.slice(0,d+2);a=a.slice(e);return""+b+c+a}function J(a){if("string"===typeof a)return new g(w(a));a.scheme||(a.scheme=f.appUrl.scheme);return a}Object.defineProperty(f,"__esModule",{value:!0});var Q=a.getLogger("esri.core.urlUtils"),H=d.request,K=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,R=/^\s*http:/i,P=/^\s*https:/i,L=/^\s*file:/i,T=/:\d+$/,S=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i;
f.appUrl=new g(c.location);f.trustedServersUrlCache={};f.appBaseUrl=function(){var a=f.appUrl.path,a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return""+(f.appUrl.scheme+"://"+f.appUrl.host+(null!=f.appUrl.port?":"+f.appUrl.port:""))+a}();f.urlToObject=l;f.getProxyUrl=function(a){void 0===a&&(a=!1);var b,c=H.proxyUrl;if("string"===typeof a){if(b=a,b=P.test(b)||"https"===f.appUrl.scheme&&E(b),a=q(a))c=a.proxyUrl}else b=!!a;if(!c)throw Q.warn("esri/config: esriConfig.request.proxyUrl is not set."),
new h("urlutils:proxy-not-set","esri/config: esriConfig.request.proxyUrl is not set.");b&&N()&&(c=M(c));return l(c)};f.addProxy=function(a){var b=q(a),c,d;b&&(d=n(b.proxyUrl),c=d.path,d=d.query?e.queryToObject(d.query):null);c&&(b=l(a),a=c+"?"+b.path,(c=e.objectToQuery(k({},d,b.query)))&&(a=a+"?"+c));return a};var W={path:"",query:""};f.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:p(a.urlPrefix)};for(var b=H.proxyRules,c=a.urlPrefix,d=b.length,e=0;e<b.length;e++){var l=b[e].urlPrefix;
if(0===c.indexOf(l)){if(c.length===l.length)return-1;d=e;break}0===l.indexOf(c)&&(d=e+1)}b.splice(d,0,a);return d};f.getProxyRule=q;f.hasSamePortal=function(a,b){a=r(a);b=r(b);return I(a)===I(b)};f.getInterceptor=function(a){var c=function(c){return null==c||c instanceof RegExp&&c.test(a)||"string"===typeof c&&b.startsWith(a,c)},d=H.interceptors;if(d)for(var e=0;e<d.length;e++){var l=d[e];if(Array.isArray(l.urls)){if(l.urls.some(c))return l}else if(c(l.urls))return l}return null};f.hasSameOrigin=
t;f.isTrustedServer=function(a){if("string"===typeof a)if(y(a))a=J(a);else return!0;for(var b=H.trustedServers||[],c=0;c<b.length;c++){var d;d=b[c];f.trustedServersUrlCache[d]||(D(d)||E(d)?f.trustedServersUrlCache[d]=[new g(w(d))]:f.trustedServersUrlCache[d]=[new g("http://"+d),new g("https://"+d)]);d=f.trustedServersUrlCache[d];for(var e=0;e<d.length;e++)if(t(a,d[e]))return!0}return!1};f.makeAbsolute=w;f.makeRelative=u;f.normalize=x;f.join=v;f.getOrigin=z;f.isAbsolute=y;f.isBlobProtocol=A;f.isDataProtocol=
B;f.dataToArrayBuffer=function(a){a=C(a);if(!a||!a.isBase64)return null;a=atob(a.data);for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer};var Y=/^data:(.*?)(;base64)?,(.*)$/;f.dataComponents=C;f.makeData=function(a){return a.isBase64?"data:"+a.mediaType+";base64,"+a.data:"data:"+a.mediaType+","+a.data};f.isProtocolRelative=E;f.hasProtocol=D;f.toHTTP=function(a){return E(a)?"http:"+a:a.replace(P,"http:")};f.toHTTPS=M;f.removeFile=function(a){var b=0;if(y(a)){var c=
a.indexOf("//");-1!==c&&(b=c+2)}c=a.lastIndexOf("/");return c<b?a:a.slice(0,c+1)};f.removeTrailingSlash=function(a){return a.replace(/\/+$/,"")};f.changeDomain=O;f.read=function(a,b){var c=b&&b.url&&b.url.path;a&&c&&(a=w(a,c,{preserveProtocolRelative:!0}));(b=b&&b.portal)&&!b.isPortal&&b.urlKey&&b.customBaseUrl?(c=b.urlKey+"."+b.customBaseUrl,b=t(f.appUrl,f.appUrl.scheme+"://"+c)?O(a,b.portalHostname,c):O(a,c,b.portalHostname)):b=a;return b};f.write=function(a,b){if(!a)return a;!y(a)&&b&&b.blockedRelativeUrls&&
b.blockedRelativeUrls.push(a);var c=w(a);if(b){var d=b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.rootPath||b.url&&b.url.path;d&&(c=u(c,d,d),c!==a&&b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.writtenUrls.push(c))}a=c;c=(b=b&&b.portal)&&!b.isPortal&&b.urlKey&&b.customBaseUrl?O(a,b.urlKey+"."+b.customBaseUrl,b.portalHostname):a;return c};f.writeOperationalLayerUrl=function(a,b){a&&E(a)&&(a="https:"+a);b.url=a?x(a):a};f.isSVG=function(a){return X.test(a)};f.removeQueryParameters=function(a,
b){a=l(a);var c=Object.keys(a.query||{});0<c.length&&b&&b.warn("removeQueryParameters()","Url query parameters are not supported, the following parameters have been removed: "+c.join(", ")+".");return a.path};f.addQueryParameter=function(a,b,c){a=l(a);var d=a.query||{};d[b]=c;return a.path+"?"+e.objectToQuery(d)};f.addQueryParameters=function(a,b){a=l(a);var c=a.query||{},d;for(d in b)c[d]=b[d];return(b=e.objectToQuery(c))?a.path+"?"+b:a.path};f.removeQueryParameter=function(a,b){var c=l(a),d=c.path,
c=c.query;if(!c)return a;delete c[b];return(a=e.objectToQuery(c))?d+"?"+a:d};var X=/(^data:image\/svg|\.svg$)/i})},"esri/core/deferredUtils":function(){define(["dojo/Deferred"],function(m){var f={makeDeferredCancellingPending:function(){var k={},e=f._dfdCanceller.bind(null,k),e=new m(e);return k.deferred=e},_dfdCanceller:function(k){k=k.deferred?k.deferred:k;k.canceled=!0;var e=k._pendingDfd;k.isResolved()||!e||e.isResolved()||e.cancel();k._pendingDfd=null},_fixDfd:function(k){var e=k.then;k.then=
function(g,d,h){if(g){var c=g;g=function(b){return b&&b._argsArray?c.apply(null,b):c(b)}}return e.call(this,g,d,h)};return k},_resDfd:function(k,e,g){var d=e.length;1===d?g?k.reject(e[0]):k.resolve(e[0]):1<d?(e._argsArray=!0,k.resolve(e)):k.resolve()}};return f})},"esri/request":function(){define("require exports ./core/tsSupport/assignHelper dojo/Deferred dojo/has!host-webworker?./core/workers/request dojo/io-query dojo/_base/url dojo/errors/CancelError dojo/request/xhr ./config ./core/deferredUtils ./core/Error ./core/global ./core/has ./core/lang ./core/promiseUtils ./core/urlUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){function u(a,b){void 0===b&&(b=!1);w.isBlobProtocol(a.url)||w.isDataProtocol(a.url)||!a.content||(a.preventCache&&(a.content["request.preventCache"]=Date.now()),a.url=w.addQueryParameters(a.url,a.content));var c=new Image;c.crossOrigin=a.withCredentials?"use-credentials":"anonymous";var d=!1,l=new e(function(){d=!0;c.onload=c.onerror=c.onabort=null;c.src=""}),h=function(){c.onload=c.onerror=c.onabort=null;b&&URL.revokeObjectURL(this.src);d||l.reject(Error("Unable to load the resource"))};
c.onload=function(){c.onload=c.onerror=c.onabort=null;b&&URL.revokeObjectURL(this.src);d||l.resolve(this)};c.onerror=h;c.onabort=h;c.alt="";c.src=a.url;return l.promise}function x(a){a=new h(a);return(a.host+(a.port?":"+a.port:"")).toLowerCase()}function v(){return G?G:G=t.create(function(a){m(["./identity/IdentityManager"],a)}).then(function(a){I=a})}function z(a,c){var l=!!a.useProxy,h=a.method||"auto";a=k({},a);a.content=a.content||{};a._ssl&&(a.url=a.url.replace(/^http:/i,"https:"));var g=a.url,
n=w.isBlobProtocol(g)||w.isDataProtocol(g);a._token&&(a.content.token=a._token);var v=0,p;n||(p=d.objectToQuery(a.content),v=p.length+g.length+1,q("esri-url-encodes-apostrophe")&&(v=p.replace(/'/g,"%27").length+g.length+1));a.timeout=null!=a.timeout?a.timeout:D.timeout;a.handleAs=a.handleAs||"json";try{var z=p=void 0,y=!n&&("post"===h||!!a.body||v>D.maxUrlLength),f=!n&&(l||!!w.getProxyRule(a.url)),x;if(x=!f&&"image"===a.handleAs&&D.proxyUrl&&!n){var t=w.getOrigin(a.url);x=!(!t||r.endsWith(t,".arcgis.com")||
w.hasSameOrigin(t,w.appUrl)||-1!==E._corsServers.indexOf(t)||w.isTrustedServer(t))}x&&(a.handleAs="blob");f&&(q("host-browser")||q("host-webworker"))&&(p=w.getProxyUrl(g),z=p.path,!y&&z.length+1+v>D.maxUrlLength&&(y=!0),p.query&&(a.content=k({},p.query,a.content)),y||(a.preventCache&&(a.content["request.preventCache"]=Date.now(),a.preventCache=!1),a.url=w.addQueryParameters(a.url,a.content),a.content=null),a.url=z+"?"+a.url);if(!n){var m=a.headers;!q("host-browser")&&!q("host-webworker")||m&&m.hasOwnProperty("X-Requested-With")||
(m=a.headers=m||{},m["X-Requested-With"]=null);if(q("host-browser")&&c){var A=a.content&&a.content.token;A&&(c.set?c.set("token",A):c.append("token",A));a.contentType=!1}if(!a.hasOwnProperty("withCredentials"))if(l=f?z:g,w.isTrustedServer(l))a.withCredentials=!0;else if(I){var C=I.findServerInfo(l);C&&C.webTierAuth&&(a.withCredentials=!0)}}if(y)return"image"===a.handleAs&&(a.handleAs="blob"),a.body?(a.data=c||a.body,a.query=a.content):a.data=a.content,delete a.body,delete a.content,!f&&q("safari")&&
(a.url+=(-1===a.url.indexOf("?")?"?":"\x26")+"_ts\x3d"+(new Date).getTime()+M++),b.post(a.url,a);if("image"===a.handleAs)return u(a);a.query=a.content;delete a.content;return b.get(a.url,a)}catch(Z){return a=new e,a.reject(Z),a.promise}}function y(a,b,c,d){function l(a){a._pendingDfd=z(c,p);var b=!!a._pendingDfd.response;(a._pendingDfd.response||a._pendingDfd).then(function(a){if(!b||!a.data)return a;D.proxyUrl&&!r.startsWith(a.url,D.proxyUrl)&&C(a.url);var c=a.getHeader("Content-Type");if(c&&(c=
c.toLowerCase(),-1===c.indexOf("text/plain")&&-1===c.indexOf("application/json")))return a;c=a.data;if(c instanceof ArrayBuffer&&750>=c.byteLength)c=new Blob([c]);else if(!(c instanceof Blob&&750>=c.size))return a;var d=new e,l=new FileReader;l.readAsText(c);l.onloadend=function(){if(!l.error)try{var b=JSON.parse(l.result);b.error&&(Object.isExtensible(a)||(a=k({},a)),a._jsonData=b)}catch(ka){}d.resolve(a)};return d.promise}).then(function(a){return b&&!a._jsonData&&"image"===d.requestOptions.responseType&&
a.data instanceof Blob?(b=!1,c.url=URL.createObjectURL(a.data),u(c,!0)):a}).then(function(c){var e=b?c.data:c,l=b?c.getHeader.bind(c):N;if(e&&(c=b&&c._jsonData||e,c.error||"error"===c.status))throw e=r.mixin(Error(),c.error||c),e.getHeader=l,e;a.resolve({data:e,url:d.url,requestOptions:d.requestOptions,getHeader:l});a._pendingDfd=null}).catch(function(b){var e,l,n,v;b&&(e=Number(b.code),l=b.hasOwnProperty("subcode")?Number(b.subcode):null,n=(n=b.messageCode)&&n.toUpperCase(),v=b.response);if(v&&0===
v.status&&D.proxyUrl&&!h&&"post"!==c.method&&v.url&&!r.startsWith(v.url,D.proxyUrl))w.addProxyRule({proxyUrl:D.proxyUrl,urlPrefix:w.removeFile(w.urlToObject(c.url).path)}),y(a,!0,c,d);else{if(403===e&&(4===l||b.message&&-1<b.message.toLowerCase().indexOf("ssl")&&-1===b.message.toLowerCase().indexOf("permission"))){if(!c._ssl){c._ssl=c._sslFromServer=!0;y(a,!0,c,d);return}}else if(g&&"no-prompt"!==c.authMode&&I._errorCodes&&-1!==I._errorCodes.indexOf(e)&&!I._isPublic(c.url)&&(403!==e||F&&-1===F.indexOf(n)&&
(null==l||2===l&&c._token))){A(a,c,d,B("request:server",b,d));return}v&&0<v.status&&v.url&&D.proxyUrl&&!r.startsWith(v.url,D.proxyUrl)&&C(v.url);a.reject(B("request:server",b,d));a._pendingDfd=null}})}var h=c.body,g=c.useIdentity,v,p=null,q=h instanceof FormData;if(q||h&&h.elements)p=q?h:new FormData(h);var f=!!(-1!==c.url.toLowerCase().indexOf("token\x3d")||c.content&&c.content.token||p&&p.get&&p.get("token")||h&&h.elements&&h.elements.token);b||(!g||f||c._token||I._isPublic(c.url)||(b=function(a){a&&
(c._token=a.token,c._ssl=a.ssl)},"immediate"===c.authMode?v=I.getCredential(c.url).then(b):"no-prompt"===c.authMode?v=I.checkSignInStatus(c.url).then(b).catch(function(){}):b(I.findCredential(c.url))),a.then(function(a){(/\/sharing\/rest\/accounts\/self/i.test(c.url)||/\/sharing\/rest\/portals\/self/i.test(c.url))&&!f&&!c._token&&a.user&&a.user.username&&(w.isTrustedServer(c.url)||D.trustedServers.push(x(c.url)));var b=c._credential;if(b){var d=I.findServerInfo(b.server),d=d&&d.owningSystemUrl,e=
void 0;d&&(d=d.replace(/\/?$/,"/sharing"),(e=I.findCredential(d,b.userId))&&-1===I._getIdenticalSvcIdx(d,e)&&e.resources.splice(0,0,d))}return a}).always(function(a){delete c._credential;if(a){var b=!!c._ssl;a instanceof n?a.details.ssl=b:a.ssl=b}}));v?v.then(function(){a.isCanceled()||l(a)}).catch(function(b){a.reject(b)}):l(a);return a.promise}function A(a,b,c,d){a._pendingDfd=I.getCredential(b.url,{error:d,token:b._token});a._pendingDfd.then(function(d){b._token=d.token;b._credential=d;b._ssl=
b._sslFromServer||d.ssl;y(a,!0,b,c)}).catch(function(b){a.reject(b);a._pendingDfd=null})}function B(a,b,c){var d="Error",e={url:c.url,requestOptions:c.requestOptions,getHeader:N};if(b instanceof n)return b.details?(b.details=r.clone(b.details),b.details.url=c.url,b.details.requestOptions=c.requestOptions):b.details=e,b;if(b){var l=b.response;c=l&&l.getHeader;var l=l&&l.status,h=b.message;c=b.getHeader||c;h&&(d=h);c&&(e.getHeader=c);e.httpStatus=(null!=b.httpCode?b.httpCode:b.code)||l;e.subCode=b.subcode;
e.messageCode=b.messageCode;e.messages="string"===typeof b.details?[b.details]:b.details}a=new n(a,d,e);b&&"cancel"===b.dojoType&&(a.name="AbortError",a.dojoType="cancel");return a}function C(a){w.isBlobProtocol(a)||w.isDataProtocol(a)||(a=w.getOrigin(a))&&-1===E._corsServers.indexOf(a)&&E._corsServers.push(a)}function E(a,b){if(g&&p.invokeStaticMessage)return g.execute(a,b);w.isBlobProtocol(a)||w.isDataProtocol(a)||(a=w.normalize(a));var d={url:a,requestOptions:k({},b)},e=w.getInterceptor(a);if(e){if(null!=
e.responseData)return t.resolve({data:e.responseData,requestOptions:d.requestOptions,getHeader:N,url:a});e.headers&&(d.requestOptions.headers=k({},d.requestOptions.headers,e.headers));e.query&&(d.requestOptions.query=k({},d.requestOptions.query,e.query));if(e.before&&(b=e.before(d),null!=b))return b instanceof Error||b instanceof n?t.reject(B("request:interceptor",b,d)):t.resolve({data:b,requestOptions:d.requestOptions,getHeader:N,url:d.url})}var u=k({url:d.url},d.requestOptions);u.content=u.query;
delete u.query;u.preventCache=!!u.cacheBust;delete u.cacheBust;u.handleAs=u.responseType;delete u.responseType;"array-buffer"===u.handleAs&&(u.handleAs="arraybuffer");if("image"===u.handleAs){if(q("host-webworker"))return t.reject(B("request:invalid-parameters",Error("responseType 'image' is not supported in Web Workers or Node environment"),d))}else if(w.isDataProtocol(a))return t.reject(B("request:invalid-parameters",Error("Data URLs are not supported for responseType \x3d "+u.handleAs),d));var z=
D.useIdentity;"anonymous"===u.authMode&&(z=!1);u.useIdentity=z;u.urlObj=new h(u.url);var r=l.makeDeferredCancellingPending(),f;d.requestOptions.signal&&(a=d.requestOptions.signal,f=function(){r.cancel(B("AbortError",new c("Request canceled"),d))},a.aborted?f():a.addEventListener("abort",f));t.resolve().then(function(){if(z&&!I)return v()}).always(function(){r.isCanceled()||y(r,!1,u,d)});return r.then(function(a){d.requestOptions.signal&&d.requestOptions.signal.removeEventListener("abort",f);e&&e.after&&
e.after(a);return a}).catch(function(a){d.requestOptions.signal&&d.requestOptions.signal.removeEventListener("abort",f);throw a;})}var D=a.request,F=["COM_0056","COM_0057"],M=0,N=function(){return null},I,G;(E||(E={}))._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];return E})},"esri/identity/OAuthCredential":function(){define(["../core/declare"],function(m){return m(null,{declaredClass:"esri.identity.OAuthCredential",oAuthInfo:null,storage:null,expires:null,ssl:null,
token:null,userId:null,constructor:function(f,k){this.oAuthInfo=f;this.storage=k;this._init()},isValid:function(){var f=!1;if(this.oAuthInfo&&this.token&&this.userId){var k=(new Date).getTime();this.expires>k&&(this.expires-k)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(f=!0)}return f},save:function(){if(this.storage){var f=this._load(),k=this.oAuthInfo;if(k&&k.authNamespace&&k.portalUrl){var e=f[k.authNamespace];e||(e=f[k.authNamespace]={});e[k.portalUrl]={expires:this.expires,ssl:this.ssl,token:this.token,
userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(f))}catch(g){console.log(g)}}}},destroy:function(){var f=this._load(),k=this.oAuthInfo;if(k&&k.authNamespace&&k.portalUrl&&this.storage){var e=f[k.authNamespace];if(e){delete e[k.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",JSON.stringify(f))}catch(g){console.log(g)}}}k&&(this.oAuthInfo=k._oAuthCred=null)},_init:function(){var f=this._load(),k=this.oAuthInfo;k&&k.authNamespace&&k.portalUrl&&(f=f[k.authNamespace])&&
(f=f[k.portalUrl])&&(this.expires=f.expires,this.ssl=f.ssl,this.token=f.token,this.userId=f.userId)},_load:function(){var f={};if(this.storage){var k=this.storage.getItem("esriJSAPIOAuth");if(k)try{f=JSON.parse(k)}catch(e){console.log(e)}}return f}})})},"esri/identity/OAuthInfo":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(h){function c(a){a=
h.call(this)||this;a._oAuthCred=null;a.appId=null;a.authNamespace="/";a.expiration=20160;a.forceLogin=!1;a.locale=null;a.minTimeUntilExpiration=30;a.popup=!1;a.popupCallbackUrl="oauth-callback.html";a.popupWindowFeatures="height\x3d490,width\x3d800,resizable,scrollbars,status";a.portalUrl="https://www.arcgis.com";return a}k(c,h);b=c;c.prototype.clone=function(){return b.fromJSON(this.toJSON())};var b;e([d.property({json:{write:!0}})],c.prototype,"appId",void 0);e([d.property({json:{write:!0}})],c.prototype,
"authNamespace",void 0);e([d.property({json:{write:!0}})],c.prototype,"expiration",void 0);e([d.property({json:{write:!0}})],c.prototype,"forceLogin",void 0);e([d.property({json:{write:!0}})],c.prototype,"locale",void 0);e([d.property({json:{write:!0}})],c.prototype,"minTimeUntilExpiration",void 0);e([d.property({json:{write:!0}})],c.prototype,"popup",void 0);e([d.property({json:{write:!0}})],c.prototype,"popupCallbackUrl",void 0);e([d.property({json:{write:!0}})],c.prototype,"popupWindowFeatures",
void 0);e([d.property({json:{write:!0}})],c.prototype,"portalUrl",void 0);return c=b=e([d.subclass("esri.identity.OAuthInfo")],c)}(d.declared(g))})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),function(m,f,k,e,g,d,h,c,b,a){e("dijit-legacy-requires")&&h(0,function(){m(["dijit/form/DropDownButton","dijit/form/ComboButton",
"dijit/form/ToggleButton"])});h=f("dijit.form.Button"+(e("dojo-bidi")?"_NoBidi":""),[c,b],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:a,_setValueAttr:"valueNode",_setNameAttr:function(a){this.valueNode&&this.valueNode.setAttribute("name",a)},postCreate:function(){this.inherited(arguments);this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=d.trim(this.containerNode.innerHTML),
this.onLabelSet())},_setShowLabelAttr:function(a){this.containerNode&&k.toggle(this.containerNode,"dijitDisplayNone",!a);this._set("showLabel",a)},setLabel:function(a){g.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},onLabelSet:function(){this.inherited(arguments);this.showLabel||"title"in this.params||(this.titleNode.title=d.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});e("dojo-bidi")&&(h=f("dijit.form.Button",
h,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(a){this._created&&this.textDir!=a&&(this._set("textDir",a),this._setLabelAttr(this.label))}}));return h})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),function(m,f,k,e,g,d,h,c){f("dijit-legacy-requires")&&e(0,
function(){require(["dijit/form/_FormValueWidget"])});return m("dijit.form._FormWidget",[g,h,d,c],{setDisabled:function(b){k.deprecated("setDisabled("+b+") is deprecated. Use set('disabled',"+b+") instead.","","2.0");this.set("disabled",b)},setValue:function(b){k.deprecated("dijit.form._FormWidget:setValue("+b+") is deprecated.  Use set('value',"+b+") instead.","","2.0");this.set("value",b)},getValue:function(){k.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.",
"","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(m,f,k,e,g,d,h,c,b,a){return f("dijit.form._FormWidgetMixin",null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",
tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(b){this._set("disabled",b);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?(k.set(this.focusNode,"disabled",b),c("trident")&&"readOnly"in this&&k.set(this.focusNode,"readonly",b||this.readOnly)):this.focusNode.setAttribute("aria-disabled",b?"true":"false");this.valueNode&&k.set(this.valueNode,"disabled",b);b?(this._set("hovering",
!1),this._set("active",!1),b="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",m.forEach(g.isArray(b)?b:[b],function(b){b=this[b];c("webkit")||a.hasDefaultTabStop(b)?b.setAttribute("tabIndex","-1"):b.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(a){if("mouse"==a&&this.isFocusable())var d=this.own(h(this.focusNode,"focus",function(){l.remove();d.remove()}))[0],e=c("pointer-events")?
"pointerup":c("touch-events")?"touchend, mouseup":"mouseup",l=this.own(h(this.ownerDocumentBody,e,g.hitch(this,function(a){l.remove();d.remove();this.focused&&("touchend"==a.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){b.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=e.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(l){}},
compare:function(a,b){return"number"==typeof a&&"number"==typeof b?isNaN(a)&&isNaN(b)?0:a-b:a>b?1:a<b?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(a,b){void 0!=this._lastValueReported||null!==b&&this._onChangeActive||(this._resetValue=this._lastValueReported=a);this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||0!=this.compare(a,this._lastValueReported);(this.intermediateChanges||b||void 0===b)&&this._pendingOnChange&&(this._lastValueReported=
a,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(a)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom","dojo/has","../registry"],
function(m,f,k,e){var g=m("dijit.form._ButtonMixin"+(k("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(d){d.stopPropagation();d.preventDefault();this.disabled||this.valueNode.click(d);return!1},_onClick:function(d){if(this.disabled)return d.stopPropagation(),d.preventDefault(),!1;!1===this.onClick(d)&&d.preventDefault();var h=d.defaultPrevented;if(!h&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var c=this.domNode;c.parentNode;c=c.parentNode){var b=e.byNode(c);
if(b&&"function"==typeof b._onSubmit){b._onSubmit(d);d.preventDefault();h=!0;break}}return!h},postCreate:function(){this.inherited(arguments);f.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(d){this._set("label",d);(this.containerNode||this.focusNode).innerHTML=d;this.onLabelSet()},onLabelSet:function(){}});k("dojo-bidi")&&(g=m("dijit.form._ButtonMixin",g,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||this.focusNode)}}));
return g})},"dijit/form/Form":function(){define("dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/sniff ../_Widget ../_TemplatedMixin ./_FormMixin ../layout/_ContentPaneResizeMixin".split(" "),function(m,f,k,e,g,d,h,c){return m("dijit.form.Form",[g,d,h,c],{name:"",action:"",method:"",encType:"","accept-charset":"",accept:"",target:"",templateString:"\x3cform data-dojo-attach-point\x3d'containerNode' data-dojo-attach-event\x3d'onreset:_onReset,onsubmit:_onSubmit' ${!nameAttrSetting}\x3e\x3c/form\x3e",
postMixInProperties:function(){this.nameAttrSetting=this.name?"name\x3d'"+this.name+"'":"";this.inherited(arguments)},execute:function(){},onExecute:function(){},_setEncTypeAttr:function(b){f.set(this.domNode,"encType",b);e("ie")&&(this.domNode.encoding=b);this._set("encType",b)},reset:function(b){var a={returnValue:!0,preventDefault:function(){this.returnValue=!1},stopPropagation:function(){},currentTarget:b?b.target:this.domNode,target:b?b.target:this.domNode};!1!==this.onReset(a)&&a.returnValue&&
this.inherited(arguments,[])},onReset:function(){return!0},_onReset:function(b){this.reset(b);b.stopPropagation();b.preventDefault();return!1},_onSubmit:function(b){var a=this.constructor.prototype;if(this.execute!=a.execute||this.onExecute!=a.onExecute)k.deprecated("dijit.form.Form:execute()/onExecute() are deprecated. Use onSubmit() instead.","","2.0"),this.onExecute(),this.execute(this.getValues());!1===this.onSubmit(b)&&(b.stopPropagation(),b.preventDefault())},onSubmit:function(){return this.isValid()},
submit:function(){!1!==this.onSubmit()&&this.containerNode.submit()}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),function(m,f,k,e,g,d,h){var c=m("dijit.form.ValidationTextBox",g,{templateString:h,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",
regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(b,a){a!=c.prototype[b]&&(f.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+b+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",a))},_setRegExpGenAttr:function(b){this._deprecateRegExp("regExpGen",b);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(b){this._deprecateRegExp("regExp",b)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},
validator:function(b,a){return(new RegExp("^(?:"+this._computeRegexp(a)+")"+(this.required?"":"?")+"$")).test(b)&&(!this.required||!this._isEmpty(b))&&(this._isEmpty(b)||void 0!==this.parse(b,a))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,this.get("constraints"))},_isEmpty:function(b){return(this.trim?/^\s*$/:/^$/).test(b)},getErrorMessage:function(){var b="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:
this.invalidMessage?this.invalidMessage:this.promptMessage,a="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:b;return this.required&&this._isEmpty(this.textbox.value)?a:b},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(b){var a="",c=this.disabled||this.isValid(b);c&&(this._maskValidSubsetError=!0);var d=this._isEmpty(this.textbox.value),e=!c&&b&&this._isValidSubset();this._set("state",c?"":((!this._hasBeenBlurred||
b)&&d||e)&&(this._maskValidSubsetError||e&&!this._hasBeenBlurred&&b)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=b&&e,a=this.getErrorMessage(b)):"Incomplete"==this.state?(a=this.getPromptMessage(b),this._maskValidSubsetError=!this._hasBeenBlurred||b):d&&(a=this.getPromptMessage(b));this.set("message",a);return c},displayMessage:function(b){b&&this.focused?d.show(b,this.domNode,this.tooltipPosition,
!this.isLeftToRight()):d.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(b){this.constraints=k.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(b){!b.locale&&this.lang&&(b.locale=this.lang);this._set("constraints",b);this._refreshState()},_setPatternAttr:function(b){this._set("pattern",b);this._refreshState()},
_computeRegexp:function(b){var a=this.pattern;"function"==typeof a&&(a=a.call(this,b));if(a!=this._lastRegExp){var c="";this._lastRegExp=a;".*"!=a&&a.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(a){switch(a.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":c+=a;break;case ")":c+="|$)";break;default:c+="(?:"+a+"|$)"}});try{"".search(c)}catch(n){c=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+
c+")$"}return a},postMixInProperties:function(){this.inherited(arguments);this.messages=e.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(b){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(b){this._set("required",b);this.focusNode.setAttribute("aria-required",b);this._refreshState()},_setMessageAttr:function(b){this._set("message",b);this.displayMessage(b)},reset:function(){this._maskValidSubsetError=
!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){d.hide(this.domNode);this.inherited(arguments)}});return c})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){c=m("dijit.form.TextBox"+(h("dojo-bidi")?"_NoBidi":""),
[c,b],{templateString:a,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:h("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var a=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||("hidden"==a||"file"==a)&&this.templateString==this.constructor.prototype.templateString)this.templateString=
this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>h("ie")&&this.defer(function(){try{var a=k.getComputedStyle(this.domNode);if(a){var b=a.fontFamily;if(b){var c=this.domNode.getElementsByTagName("INPUT");if(c)for(a=0;a<c.length;a++)c[a].style.fontFamily=b}}}catch(r){}})},_setPlaceHolderAttr:function(a){this._set("placeHolder",a);this._phspan||(this._attachPoints.push("_phspan"),this._phspan=f.create("span",{className:"dijitPlaceHolder dijitInputField"},
this.textbox,"after"),this.own(d(this._phspan,"mousedown",function(a){a.preventDefault()}),d(this._phspan,"touchend, pointerup, MSPointerUp",g.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(a));this._updatePlaceHolder()},_onInput:function(a){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},
_setValueAttr:function(a,b,c){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){e.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(a){e.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",a)},_onBlur:function(a){this.disabled||(this.inherited(arguments),
this._updatePlaceHolder(),h("mozilla")&&this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(a){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>h("ie")&&(c.prototype._isTextSelected=function(){var a=this.ownerDocument.selection.createRange();return a.parentElement()==this.textbox&&0<a.text.length},l._setSelectionRange=b._setSelectionRange=function(a,b,c){a.createTextRange&&(a=a.createTextRange(),a.collapse(!0),
a.moveStart("character",-99999),a.moveStart("character",b),a.moveEnd("character",c-b),a.select())});h("dojo-bidi")&&(c=m("dijit.form.TextBox",c,{_setPlaceHolderAttr:function(a){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return c})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(m,f,k,e){return m("dijit.form._FormValueWidget",[k,e],{_layoutHackIE7:function(){if(7==f("ie"))for(var e=this.domNode,d=e.parentNode,
h=e.firstChild||e,c=h.style.filter,b=this;d&&0==d.clientHeight;)(function(){var a=b.connect(d,"onscroll",function(){b.disconnect(a);h.style.filter=(new Date).getMilliseconds();b.defer(function(){h.style.filter=c})})})(),d=d.parentNode}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(m,f,k,e,g,d,h){return m("dijit.form._FormValueMixin",h,{readOnly:!1,_setReadOnlyAttr:function(c){d("trident")&&
"disabled"in this?f.set(this.focusNode,"readOnly",c||this.disabled):f.set(this.focusNode,"readOnly",c);this._set("readOnly",c)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(c,b){this._handleOnChange(c,b)},_handleOnChange:function(c,b){this._set("value",c);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=!1;this._setValueAttr(this._resetValue,
!0)}})})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(m,f,k,e,g,d,h,c){var b=f("dijit.form._TextBoxMixin"+(e("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(a,b,c){var d;void 0!==a&&(d=this.filter(a),
"string"!=typeof c&&(c=null===d||"number"==typeof d&&isNaN(d)?"":this.filter(this.format(d,this.constraints)),0!=this.compare(d,this.filter(this.parse(c,this.constraints)))&&(c=null)));null==c||"number"==typeof c&&isNaN(c)||this.textbox.value==c||(this.textbox.value=c,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[d,b])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(a){null==a?a="":"string"!=
typeof a&&(a=String(a));this.textbox.value=a;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(a){return null==a?"":a.toString?a.toString():a},parse:function(a){return a},_refreshState:function(){},onInput:function(){},_onInput:function(a){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||a);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),
!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(h(this.textbox,"keydown, keypress, paste, cut, compositionend",d.hitch(this,function(a){var b;if("keydown"==a.type&&229!=a.keyCode){b=a.keyCode;switch(b){case g.SHIFT:case g.ALT:case g.CTRL:case g.META:case g.CAPS_LOCK:case g.NUM_LOCK:case g.SCROLL_LOCK:return}if(!a.ctrlKey&&!a.metaKey&&
!a.altKey){switch(b){case g.NUMPAD_0:case g.NUMPAD_1:case g.NUMPAD_2:case g.NUMPAD_3:case g.NUMPAD_4:case g.NUMPAD_5:case g.NUMPAD_6:case g.NUMPAD_7:case g.NUMPAD_8:case g.NUMPAD_9:case g.NUMPAD_MULTIPLY:case g.NUMPAD_PLUS:case g.NUMPAD_ENTER:case g.NUMPAD_MINUS:case g.NUMPAD_PERIOD:case g.NUMPAD_DIVIDE:return}if(65<=b&&90>=b||48<=b&&57>=b||b==g.SPACE)return;b=!1;for(var c in g)if(g[c]===a.keyCode){b=!0;break}if(!b)return}}(b=32<=a.charCode?String.fromCharCode(a.charCode):a.charCode)||(b=65<=a.keyCode&&
90>=a.keyCode||48<=a.keyCode&&57>=a.keyCode||a.keyCode==g.SPACE?String.fromCharCode(a.keyCode):a.keyCode);b||(b=229);if("keypress"==a.type){if("string"!=typeof b)return;if("a"<=b&&"z">=b||"A"<=b&&"Z">=b||"0"<=b&&"9">=b||" "===b)if(a.ctrlKey||a.metaKey||a.altKey)return}var p={faux:!0},q;for(q in a)/^(layer[XY]|returnValue|keyLocation)$/.test(q)||(c=a[q],"function"!=typeof c&&"undefined"!=typeof c&&(p[q]=c));d.mixin(p,{charOrCode:b,_wasConsumed:!1,preventDefault:function(){p._wasConsumed=!0;a.preventDefault()},
stopPropagation:function(){a.stopPropagation()}});this._lastInputProducingEvent=p;!1===this.onInput(p)&&(p.preventDefault(),p.stopPropagation());if(!p._wasConsumed&&9>=e("ie"))switch(a.keyCode){case g.TAB:case g.ESCAPE:case g.DOWN_ARROW:case g.UP_ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:break;default:a.keyCode==g.ENTER&&"textarea"!=this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&h.emit(this.textbox,"input",{bubbles:!0})})}})),h(this.textbox,
"input",d.hitch(this,"_onInput")),h(this.domNode,"keypress",function(a){a.stopPropagation()}))},_blankValue:"",filter:function(a){if(null===a)return this._blankValue;if("string"!=typeof a)return a;this.trim&&(a=d.trim(a));this.uppercase&&(a=a.toUpperCase());this.lowercase&&(a=a.toLowerCase());this.propercase&&(a=a.replace(/[^\s]+/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}));return a},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(a){this.disabled||
(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(a){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==a&&(this._selectOnClickHandle=h.once(this.domNode,"mouseup, touchend",d.hitch(this,function(a){this._isTextSelected()||b.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=
null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});e("dojo-bidi")&&(b=f("dijit.form._TextBoxMixin",b,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));b._setSelectionRange=c._setSelectionRange=function(a,b,
c){a.setSelectionRange&&a.setSelectionRange(b,c)};b.selectInputText=c.selectInputText=function(a,c,d){a=k.byId(a);isNaN(c)&&(c=0);isNaN(d)&&(d=a.value?a.value.length:0);try{a.focus(),b._setSelectionRange(a,c,d)}catch(p){}};return b})},"esri/identity/OAuthSignInHandler":function(){define("./Credential ../core/domUtils ../core/has ../core/lang ../core/Error ../core/urlUtils dijit/Dialog dijit/registry dojo/Deferred dojo/_base/kernel dojo/dom-attr dojo/i18n!./nls/identity dojo/io-query dijit/form/Button dojo/query".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){return{_oAuthDfd:null,_oAuthIntervalId:0,_oAuthDialogContent:"\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e{oAuthInfo}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e{invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e{lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e{lblCancel}\x3c/button\x3e\x3c/div\x3e",
setOAuthRedirectionHandler:function(a){this._oAuthRedirectFunc=a},oAuthSignIn:function(a,c,d,e){var h=this._oAuthDfd=new b;h.resUrl_=a;h.sinfo_=c;h.oinfo_=d;var g=!e||!1!==e.oAuthPopupConfirmation;if(!d.popup||!g)return this._doOAuthSignIn(a,c,d),h.promise;this._nls||(this._nls=n);this.oAuthDialog||(this.oAuthDialog=this._createOAuthDialog());a=this.oAuthDialog;c=e&&e.error;e=e&&e.token;f.hide(a.errMsg_);c&&c.details&&403==c.details.httpStatus&&e&&(l.set(a.errMsg_,"innerHTML",this._nls.forbidden),
f.show(a.errMsg_));a.show();return h.promise},setOAuthResponseHash:function(a){var b=this._oAuthDfd;this._oAuthDfd=null;if(b&&a)if(clearInterval(this._oAuthIntervalId),"#"===a.charAt(0)&&(a=a.substring(1)),a=p.queryToObject(a),a.error){var c="access_denied"===a.error;a=new g(c?"identity-manager:user-aborted":"identity-manager:authentication-failed",c?"ABORTED":"OAuth: "+a.error+" - "+a.error_description);b.reject(a)}else{var c=b.oinfo_._oAuthCred,d=new m({userId:a.username,server:b.sinfo_.server,
token:a.access_token,expires:(new Date).getTime()+1E3*Number(a.expires_in),ssl:"true"===a.ssl,_oAuthCred:c});c.storage=a.persist?window.localStorage:window.sessionStorage;c.token=d.token;c.expires=d.expires;c.userId=d.userId;c.ssl=d.ssl;c.save();b.resolve(d)}},_createOAuthDialog:function(){var b=this._nls,d=e.substitute(b,this._oAuthDialogContent),l=new h({title:b.title,content:d,"class":"esri-widget esriOAuthSignInDialog esriIdentityDialog",style:"min-width: 18em;",esriIdMgr_:this,execute_:function(){var a=
l.esriIdMgr_._oAuthDfd;l.hide_();l.esriIdMgr_._doOAuthSignIn(a.resUrl_,a.sinfo_,a.oinfo_)},cancel_:function(){var a=l.esriIdMgr_._oAuthDfd;l.esriIdMgr_._oAuthDfd=null;l.hide_();var b=new g("identity-manager:user-aborted","ABORTED");a.reject(b)},hide_:function(){f.hide(l.errMsg_);l.hide();h._DialogLevelManager.hide(l)}}),b=l.domNode;l.btnSubmit_=c.byNode(a.query(".esriIdSubmit",b)[0]);l.btnCancel_=c.byNode(a.query(".esriIdCancel",b)[0]);l.errMsg_=a.query(".esriErrorMsg",b)[0];l.connect(l.btnSubmit_,
"onClick",l.execute_);l.connect(l.btnCancel_,"onClick",l.onCancel);l.connect(l,"onCancel",l.cancel_);return l},_doOAuthSignIn:function(a,b,c){var e=this,l={client_id:c.appId,response_type:"token",state:JSON.stringify({portalUrl:c.portalUrl}),expiration:c.expiration,locale:c.locale,redirect_uri:c.popup?d.makeAbsolute(c.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};c.forceLogin&&(l.force_login=!0);var h=c.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",n=h+"?"+p.objectToQuery(l);
if(c.popup){var q;7===k("ie")?(q=window.open(c.popupCallbackUrl,"esriJSAPIOAuth",c.popupWindowFeatures),q.location=n):q=window.open(n,"esriJSAPIOAuth",c.popupWindowFeatures);q?(q.focus(),this._oAuthDfd.oAuthWin_=q,this._oAuthIntervalId=setInterval(function(){if(q.closed){clearInterval(e._oAuthIntervalId);var a=e._oAuthDfd;if(a){var b=new g("identity-manager:user-aborted","ABORTED");a.reject(b)}}},500)):(a=new g("identity-manager:popup-blocked","ABORTED"),this._oAuthDfd.reject(a))}else this._rejectOnPersistedPageShow=
!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:l,authorizeUrl:h,resourceUrl:a,serverInfo:b,oAuthInfo:c}):window.location=n}}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Evented ../../../core/has ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/support/controllerUtils ../../../layers/graphics/sources/MemorySource ./FeatureLikeLayerView3D ../../layers/RefreshableLayerView".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){f=function(l){function g(a){return l.call(this)||this}k(g,l);u=g;Object.defineProperty(g.prototype,"controllerTypeForSource",{get:function(){return this.layer.source&&this.layer.source.isInstanceOf&&this.layer.source.isInstanceOf(w.default)?"memory":n("enable-feature:jkieboom/manyfeatures-lines-and-polygons")||"point"===this.layer.geometryType?"feature-tile-3d":"snapshot"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"asyncGraphicsUpdates",
{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)switch(this.controller.mode){case "snapshot":return!1;case "tiles":return!0}switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return!0;case "memory":case "snapshot":return!1}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspendResumeExtentMode",{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)return this.controller.suspendResumeExtentMode;
switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return"data";case "memory":case "snapshot":return"computed"}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"displayLimitExceeded",{get:function(){return this.controller&&"feature-tile-3d"===this.controller.type?!(this.suspended||!this.controller.displayLimitExceeded):!1},enumerable:!0,configurable:!0});g.prototype.createController=function(){return h(this,void 0,void 0,function(){var a;
return d(this,function(b){switch(b.label){case 0:a=this.controllerTypeForSource;switch(a){case "memory":return[3,1];case "snapshot":return[3,3];case "feature-tile-3d":return[3,5]}return[3,7];case 1:return[4,this.createMemoryController()];case 2:return[2,b.sent()];case 3:return[4,this.createSnapshotController()];case 4:return[2,b.sent()];case 5:return[4,this.createFeatureTileController()];case 6:return[2,b.sent()];case 7:return[3,8];case 8:return[2]}})})};g.prototype.createMemoryController=function(){return h(this,
void 0,void 0,function(){var a;return d(this,function(b){switch(b.label){case 0:return[4,p.create(function(a){m(["../../../layers/graphics/controllers/MemoryController"],a)})];case 1:return a=b.sent(),[2,new a({layerView:this,layer:this.layer,graphics:this.layer.source})]}})})};g.prototype.createFeatureTileController=function(){return h(this,void 0,void 0,function(){var a,b,c=this;return d(this,function(d){switch(d.label){case 0:return[4,p.create(function(a){m(["../../../layers/graphics/controllers/FeatureTileController3D"],
a)})];case 1:return a=d.sent(),b=new a({layerView:this,graphics:new v,extent:this.clippingExtent}),this.handles.add([b.watch("suspendResumeExtentMode",function(){return c.notifyChange("suspendResumeExtentMode")},!0),b.watch("displayLimitExceeded",function(){return c.notifyChange("displayLimitExceeded")},!0),b.watch("mode",function(){return c.notifyChange("asyncGraphicsUpdates")},!0)]),this.handles.add(q.init(b,"serviceDataExtent",function(a){return c.graphics3d.dataExtent=a})),this.handles.add(q.init(this,
"suspended",function(a){a?b.suspend():b.resume()},!0)),this.handles.add(q.init(this.graphics3d.graphicsCore,"maxNumberOfFeatures",function(a){b.displayFeatureLimit={min:Math.ceil(z*a),max:a,perTile:Math.ceil(y*a)}})),[2,b]}})})};g.prototype.createSnapshotController=function(){return h(this,void 0,void 0,function(){var a,e,l;return d(this,function(d){switch(d.label){case 0:return this.addResolvingPromise(this.validateMaximumFeatureCount()),[4,p.create(function(a){m(["../../../layers/graphics/controllers/SnapshotController"],
a)})];case 1:return a=d.sent(),e=b.ofType(c),l=new a({layerView:this,layer:this.layer,graphics:new e,maxPageSize:300,defaultReturnZ:!0,extent:this.clippingExtent}),[4,l.when()];case 2:return d.sent(),this.handles.add(q.whenFalseOnce(this,"suspended",function(){l.startup()})),[2,l]}})})};g.prototype.validateMaximumFeatureCount=function(){return 0>u.maximumFeatureCount||!this.layer.url?p.resolve():this.layer.queryFeatureCount().then(function(b){if(b>u.maximumFeatureCount)throw new a("featurelayerview3d:maximum-feature-count-exceeded",
"The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",{maximumFeatureCount:u.maximumFeatureCount,numberOfFeatures:b});})};g.prototype.doRefresh=function(){!this.suspended&&t.isRefreshable(this.controller)&&this.controller.refresh()};var u;g.maximumFeatureCount=-1;e([r.property()],g.prototype,"layer",void 0);e([r.property()],g.prototype,"controller",void 0);e([r.property({readOnly:!0,dependsOn:["layer"]})],g.prototype,"controllerTypeForSource",
null);e([r.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],g.prototype,"asyncGraphicsUpdates",null);e([r.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],g.prototype,"suspendResumeExtentMode",null);e([r.property({dependsOn:["suspended","controller"]})],g.prototype,"displayLimitExceeded",null);return g=u=e([r.subclass("esri.views.3d.layers.FeatureLayerView3D")],g)}(r.declared(u,x));var v=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b.items=new Set;return b}k(b,a);c=b;Object.defineProperty(b.prototype,"length",{get:function(){return this.items.size},enumerable:!0,configurable:!0});b.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this.items.add(a[b]);this.emit("change",{added:a,removed:[],moved:[]})};b.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.items.delete(a[b]);this.emit("change",{added:[],removed:a,moved:[]});return a};b.prototype.removeAll=function(){var a=this.toArray();this.emit("change",
{added:[],removed:a,moved:[]})};b.prototype.toArray=function(){var a=[];this.items.forEach(function(b){return a.push(b)});return a};b.prototype.forEach=function(a){this.items.forEach(a)};b.prototype.some=function(a){return this.toArray().some(a)};b.prototype.find=function(a){var b=null;this.forEach(function(c){!b&&a(c)&&(b=c)});return b};b.prototype.filter=function(a){var b=new c;this.forEach(function(c){a(c)&&b.items.add(c)});return b};var c;return b=c=e([r.subclass("esri.views.3d.layers.FeatureLayerView3D.SetCollection")],
b)}(r.declared(l)),z=.1,y=.25;return f})},"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(m,f){function k(a){return function(b){return e([a,b])}}function e(a){if(d)throw new TypeError("Generator is already executing.");for(;g;)try{if(d=1,h&&(c=a[0]&2?h["return"]:a[0]?h["throw"]||((c=h["return"])&&c.call(h),0):h.next)&&!(c=c.call(h,a[1])).done)return c;if(h=0,c)a=[a[0]&2,c.value];switch(a[0]){case 0:case 1:c=a;break;case 4:return g.label++,{value:a[1],done:!1};
case 5:g.label++;h=a[1];a=[0];continue;case 7:a=g.ops.pop();g.trys.pop();continue;default:if(!(c=g.trys,c=0<c.length&&c[c.length-1])&&(6===a[0]||2===a[0])){g=0;continue}if(3===a[0]&&(!c||a[1]>c[0]&&a[1]<c[3]))g.label=a[1];else if(6===a[0]&&g.label<c[1])g.label=c[1],c=a;else if(c&&g.label<c[2])g.label=c[2],g.ops.push(a);else{c[2]&&g.ops.pop();g.trys.pop();continue}}a=f.call(m,g)}catch(l){a=[6,l],h=0}finally{d=c=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var g={label:0,sent:function(){if(c[0]&
1)throw c[1];return c[1]},trys:[],ops:[]},d,h,c,b;return b={next:k(0),"throw":k(1),"return":k(2)},"function"===typeof Symbol&&(b[Symbol.iterator]=function(){return this}),b}})},"esri/core/tsSupport/awaiterHelper":function(){define(["../promiseUtils"],function(m){function f(k){return k&&"function"===typeof k.then?k:m.resolve(k)}return function(k,e,g,d){var h=null;return m.create(function(c,b){function a(a){try{g(d.next(a))}catch(q){b(q)}}function l(a){try{g(d["throw"](a))}catch(q){b(q)}}function g(d){d.done?
(h=f(d.value),h.then(c,b)):(h=f(d.value),h.then(a,l))}g((d=d.apply(k,e||[])).next())},function(c){h&&h.cancel(c)})}})},"esri/Graphic":function(){define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./geometry ./PopupTemplate ./core/JSONSupport ./core/lang ./core/accessorSupport/decorators ./geometry/support/typeUtils ./symbols/support/jsonUtils ./symbols/support/typeUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p){m=function(c){function q(a,
b,d,e){a=c.call(this,a,b,d,e)||this;a.layer=null;a.popupTemplate=null;a.sourceLayer=null;Object.defineProperty(a,"uid",{value:r.generateUID()});return a}e(q,c);r=q;q.prototype.normalizeCtorArgs=function(a,b,c,d){return a&&!a.declaredClass?a:{geometry:a,symbol:b,attributes:c,popupTemplate:d}};Object.defineProperty(q.prototype,"attributes",{set:function(a){var b=this._get("attributes");b!==a&&(this._set("attributes",a),this._notifyLayer("attributes",b,a))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,
"geometry",{set:function(a){var b=this._get("geometry");b!==a&&(this._set("geometry",a),this._notifyLayer("geometry",b,a))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"symbol",{set:function(a){var b=this._get("symbol");b!==a&&(this._set("symbol",a),this._notifyLayer("symbol",b,a))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"visible",{set:function(a){var b=this._get("visible");b!==a&&(this._set("visible",a),this._notifyLayer("visible",b,a))},enumerable:!0,
configurable:!0});q.prototype.getEffectivePopupTemplate=function(){return this.popupTemplate||this.sourceLayer&&this.sourceLayer.popupTemplate};q.prototype.getAttribute=function(a){return this.attributes&&this.attributes[a]};q.prototype.setAttribute=function(a,b){var c;this.attributes?(c=this.getAttribute(a),this.attributes[a]=b,this._notifyLayer("attributes",c,b,a)):(this.attributes=(c={},c[a]=b,c),this._notifyLayer("attributes",void 0,b,a))};q.prototype.toJSON=function(){return{geometry:this.geometry&&
this.geometry.toJSON(),symbol:this.symbol&&this.symbol.toJSON(),attributes:k({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}};q.prototype.clone=function(){return new r({attributes:b.clone(this.attributes),geometry:this.geometry&&this.geometry.clone()||null,layer:this.layer,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),sourceLayer:this.sourceLayer,symbol:this.symbol&&this.symbol.clone()||null,visible:this.visible})};q.prototype._notifyLayer=function(a,
b,c,d){this.layer&&(b={graphic:this,property:a,oldValue:b,newValue:c},"attributes"===a&&(b.attributeName=d),this.layer.graphicChanged(b))};var r;g([a.property({value:null})],q.prototype,"attributes",null);g([a.property({value:null,types:l.types,json:{read:d.fromJSON}})],q.prototype,"geometry",null);g([a.property()],q.prototype,"layer",void 0);g([a.property({type:h})],q.prototype,"popupTemplate",void 0);g([a.property()],q.prototype,"sourceLayer",void 0);g([a.property({value:null,types:p.types,json:{read:n.read}})],
q.prototype,"symbol",null);g([a.property({type:Boolean,value:!0,set:function(a){}})],q.prototype,"visible",null);return q=r=g([a.subclass("esri.Graphic")],q)}(a.declared(c));var q=0;(function(a){a.generateUID=function(){return q++}})(m||(m={}));return m})},"esri/geometry":function(){define("require exports ./geometry/Extent ./geometry/Geometry ./geometry/Mesh ./geometry/Multipoint ./geometry/Point ./geometry/Polygon ./geometry/Polyline ./geometry/ScreenPoint ./geometry/SpatialReference ./geometry/support/jsonUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){Object.defineProperty(f,"__esModule",{value:!0});f.Extent=k;f.BaseGeometry=e;f.Mesh=g;f.Multipoint=d;f.Point=h;f.Polygon=c;f.Polyline=b;f.ScreenPoint=a;f.SpatialReference=l;f.isGeometry=function(a){return a instanceof f.BaseGeometry};f.fromJSON=n.fromJSON})},"esri/geometry/Extent":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./Geometry ./Point ./SpatialReference ./support/contains ./support/intersects ./support/spatialReferenceUtils ./support/webMercatorUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(a,b,c){return null==b?c:null==c?b:a(b,c)}m=function(h){function r(){for(var a=0;a<arguments.length;a++);a=h.call(this)||this;a.type="extent";a.xmin=0;a.ymin=0;a.mmin=void 0;a.zmin=void 0;a.xmax=0;a.ymax=0;a.mmax=void 0;a.zmax=void 0;return a}k(r,h);f=r;r.prototype.normalizeCtorArgs=function(a,c,d,e,l){return!a||"esri.geometry.SpatialReference"!==a.declaredClass&&null==a.wkid?"object"===typeof a?(a.spatialReference=null!=a.spatialReference?a.spatialReference:
b.WGS84,a):{xmin:a,ymin:c,xmax:d,ymax:e,spatialReference:null!=l?l:b.WGS84}:{spatialReference:a,xmin:0,ymin:0,xmax:0,ymax:0}};Object.defineProperty(r.prototype,"center",{get:function(){var a=new c({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});this.hasZ&&(a.z=.5*(this.zmin+this.zmax));this.hasM&&(a.m=.5*(this.mmin+this.mmax));return a},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"extent",{get:function(){return this.clone()},enumerable:!0,
configurable:!0});Object.defineProperty(r.prototype,"hasM",{get:function(){return null!=this.mmin&&null!=this.mmax},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"hasZ",{get:function(){return null!=this.zmin&&null!=this.zmax},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"height",{get:function(){return Math.abs(this.ymax-this.ymin)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"width",{get:function(){return Math.abs(this.xmax-this.xmin)},
enumerable:!0,configurable:!0});r.prototype.centerAt=function(a){var b=this.center;return null!=a.z&&this.hasZ?this.offset(a.x-b.x,a.y-b.y,a.z-b.z):this.offset(a.x-b.x,a.y-b.y)};r.prototype.clone=function(){var a=new f;a.xmin=this.xmin;a.ymin=this.ymin;a.xmax=this.xmax;a.ymax=this.ymax;a.spatialReference=this.spatialReference;null!=this.zmin&&(a.zmin=this.zmin,a.zmax=this.zmax);null!=this.mmin&&(a.mmin=this.mmin,a.mmax=this.mmax);return a};r.prototype.contains=function(b){if(!b)return!1;var c=this.spatialReference,
d=b.spatialReference;c&&d&&!c.equals(d)&&p.canProject(c,d)&&(b=c.isWebMercator?p.geographicToWebMercator(b):p.webMercatorToGeographic(b,!0));return"point"===b.type?a.extentContainsPoint(this,b):"extent"===b.type?a.extentContainsExtent(this,b):!1};r.prototype.equals=function(a){if(!a)return!1;var b=this.spatialReference,c=a.spatialReference;b&&c&&!b.equals(c)&&p.canProject(b,c)&&(a=b.isWebMercator?p.geographicToWebMercator(a):p.webMercatorToGeographic(a,!0));return this.xmin===a.xmin&&this.ymin===
a.ymin&&this.zmin===a.zmin&&this.mmin===a.mmin&&this.xmax===a.xmax&&this.ymax===a.ymax&&this.zmax===a.zmax&&this.mmax===a.mmax};r.prototype.expand=function(a){a=.5*(1-a);var b=this.width*a,c=this.height*a;this.xmin+=b;this.ymin+=c;this.xmax-=b;this.ymax-=c;this.hasZ&&(b=(this.zmax-this.zmin)*a,this.zmin+=b,this.zmax-=b);this.hasM&&(a*=this.mmax-this.mmin,this.mmin+=a,this.mmax-=a);return this};r.prototype.intersects=function(a){if(!a)return!1;var b=this.spatialReference,c=a.spatialReference;b&&c&&
!b.equals(c)&&p.canProject(b,c)&&(a=b.isWebMercator?p.geographicToWebMercator(a):p.webMercatorToGeographic(a,!0));b=l.getExtentIntersector(a.type);return"mesh"!==a.type?b(this,a):b(this,a.extent)};r.prototype.normalize=function(){var a=this._normalize(!1,!0);return Array.isArray(a)?a:[a]};r.prototype.offset=function(a,b,c){this.xmin+=a;this.ymin+=b;this.xmax+=a;this.ymax+=b;null!=c&&(this.zmin+=c,this.zmax+=c);return this};r.prototype.shiftCentralMeridian=function(){return this._normalize(!0)};r.prototype.union=
function(a){this.xmin=Math.min(this.xmin,a.xmin);this.ymin=Math.min(this.ymin,a.ymin);this.xmax=Math.max(this.xmax,a.xmax);this.ymax=Math.max(this.ymax,a.ymax);if(this.hasZ||a.hasZ)this.zmin=q(Math.min,this.zmin,a.zmin),this.zmax=q(Math.max,this.zmax,a.zmax);if(this.hasM||a.hasM)this.mmin=q(Math.min,this.mmin,a.mmin),this.mmax=q(Math.max,this.mmax,a.mmax);return this};r.prototype.intersection=function(a){if(!this.intersects(a))return null;this.xmin=Math.max(this.xmin,a.xmin);this.ymin=Math.max(this.ymin,
a.ymin);this.xmax=Math.min(this.xmax,a.xmax);this.ymax=Math.min(this.ymax,a.ymax);if(this.hasZ||a.hasZ)this.zmin=q(Math.max,this.zmin,a.zmin),this.zmax=q(Math.min,this.zmax,a.zmax);if(this.hasM||a.hasM)this.mmin=q(Math.max,this.mmin,a.mmin),this.mmax=q(Math.min,this.mmax,a.mmax);return this};r.prototype.toJSON=function(a){return this.write(null,a)};r.prototype._shiftCM=function(a){void 0===a&&(a=n.getInfo(this.spatialReference));if(!a||!this.spatialReference)return this;var c=this.spatialReference,
d=this._getCM(a);if(d){var e=c.isWebMercator?p.webMercatorToGeographic(d):d;this.xmin-=d.x;this.xmax-=d.x;c.isWebMercator||(e.x=this._normalizeX(e.x,a).x);this.spatialReference=new b(g.substitute({Central_Meridian:e.x},c.isWGS84?a.altTemplate:a.wkTemplate))}return this};r.prototype._getCM=function(a){var b=null,c=a.valid;a=c[0];var c=c[1],d=this.xmin,e=this.xmax;d>=a&&d<=c&&e>=a&&e<=c||(b=this.center);return b};r.prototype._normalize=function(a,b,c){var d=this.spatialReference;if(!d)return this;c=
c||n.getInfo(d);if(!c)return this;var e=this._getParts(c).map(function(a){return a.extent});if(2>e.length)return e[0]||this;if(2<e.length)return a?this._shiftCM(c):this.set({xmin:c.valid[0],xmax:c.valid[1]});if(a)return this._shiftCM(c);if(b)return e;var l=!0,h=!0;e.forEach(function(a){a.hasZ||(l=!1);a.hasM||(h=!1)});return{rings:e.map(function(a){var b=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(l)for(var c=(a.zmax-a.zmin)/2,d=0;d<b.length;d++)b[d].push(c);
if(h)for(a=(a.mmax-a.mmin)/2,d=0;d<b.length;d++)b[d].push(a);return b}),hasZ:l,hasM:h,spatialReference:d}};r.prototype._getParts=function(a){var b=this.cache._parts;if(!b){var b=[],c=this.ymin,d=this.ymax,e=this.spatialReference,l=this.width,h=this.xmin,g=this.xmax,p=void 0;a=a||n.getInfo(e);var q=a.valid,k=q[0],u=q[1],p=this._normalizeX(this.xmin,a),r=p.x,q=p.frameId,p=this._normalizeX(this.xmax,a),t=p.x;a=p.frameId;p=r===t&&0<l;if(l>2*u){l=new f(h<g?r:t,c,u,d,e);h=new f(k,c,h<g?t:r,d,e);g=new f(0,
c,u,d,e);c=new f(k,c,0,d,e);d=[];e=[];l.contains(g)&&d.push(q);l.contains(c)&&e.push(q);h.contains(g)&&d.push(a);h.contains(c)&&e.push(a);for(k=q+1;k<a;k++)d.push(k),e.push(k);b.push({extent:l,frameIds:[q]},{extent:h,frameIds:[a]},{extent:g,frameIds:d},{extent:c,frameIds:e})}else r>t||p?b.push({extent:new f(r,c,u,d,e),frameIds:[q]},{extent:new f(k,c,t,d,e),frameIds:[a]}):b.push({extent:new f(r,c,t,d,e),frameIds:[q]});this.cache._parts=b}a=this.hasZ;c=this.hasM;if(a||c)for(q={},a&&(q.zmin=this.zmin,
q.zmax=this.zmax),c&&(q.mmin=this.mmin,q.mmax=this.mmax),a=0;a<b.length;a++)b[a].extent.set(q);return b};r.prototype._normalizeX=function(a,b){var c=b.valid;b=c[0];var d=c[1],c=2*d,e=0;a>d?(b=Math.ceil(Math.abs(a-d)/c),a-=b*c,e=b):a<b&&(b=Math.ceil(Math.abs(a-b)/c),a+=b*c,e=-b);return{x:a,frameId:e}};var f;e([d.property({dependsOn:"xmin ymin zmin mmin xmax ymax zmax mmax spatialReference".split(" ")})],r.prototype,"cache",void 0);e([d.property({readOnly:!0,dependsOn:["cache"]})],r.prototype,"center",
null);e([d.property({readOnly:!0,dependsOn:["cache"]})],r.prototype,"extent",null);e([d.property({readOnly:!0,dependsOn:["mmin","mmax"],json:{write:{enabled:!1,overridePolicy:null}}})],r.prototype,"hasM",null);e([d.property({readOnly:!0,dependsOn:["zmin","zmax"],json:{write:{enabled:!1,overridePolicy:null}}})],r.prototype,"hasZ",null);e([d.property({readOnly:!0,dependsOn:["ymin","ymax"]})],r.prototype,"height",null);e([d.property({readOnly:!0,dependsOn:["xmin","xmax"]})],r.prototype,"width",null);
e([d.property({type:Number,json:{write:!0}})],r.prototype,"xmin",void 0);e([d.property({type:Number,json:{write:!0}})],r.prototype,"ymin",void 0);e([d.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],r.prototype,"mmin",void 0);e([d.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],r.prototype,"zmin",void 0);e([d.property({type:Number,json:{write:!0}})],
r.prototype,"xmax",void 0);e([d.property({type:Number,json:{write:!0}})],r.prototype,"ymax",void 0);e([d.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],r.prototype,"mmax",void 0);e([d.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],r.prototype,"zmax",void 0);return r=f=e([d.subclass("esri.geometry.Extent")],r)}(d.declared(h));m.prototype.toJSON.isDefaultToJSON=
!0;return m})},"esri/geometry/Geometry":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./SpatialReference".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(){var a=c.call(this)||this;a.type=null;a.extent=null;a.hasM=!1;a.hasZ=!1;a.spatialReference=h.WGS84;return a}k(b,c);Object.defineProperty(b.prototype,"cache",{get:function(){return{}},enumerable:!0,configurable:!0});
b.prototype.readSpatialReference=function(a,b){if(a instanceof h)return a;if(null!=a){var c=new h;c.read(a,b);return c}return a};b.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};b.prototype.clearCache=function(){this.notifyChange("cache")};b.prototype.getCacheValue=function(a){return this.cache[a]};b.prototype.setCacheValue=function(a,b){this.cache[a]=b};e([d.property()],b.prototype,"type",void 0);e([d.property({readOnly:!0,dependsOn:["spatialReference"]})],
b.prototype,"cache",null);e([d.property({readOnly:!0,dependsOn:["spatialReference"]})],b.prototype,"extent",void 0);e([d.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],b.prototype,"hasM",void 0);e([d.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],b.prototype,"hasZ",void 0);e([d.property({type:h,json:{write:!0}})],b.prototype,"spatialReference",void 0);e([d.reader("spatialReference")],b.prototype,"readSpatialReference",
null);return b=e([d.subclass("esri.geometry.Geometry")],b)}(d.declared(g))})},"esri/geometry/SpatialReference":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/spatialReferenceUtils".split(" "),function(m,f,k,e,g,d,h,c){m=function(b){function a(a){a=b.call(this)||this;a.latestWkid=null;a.wkid=null;a.wkt=null;return a}k(a,b);d=a;a.fromJSON=function(a){if(!a)return null;
if(a.wkid){if(102100===a.wkid)return d.WebMercator;if(4326===a.wkid)return d.WGS84}var b=new d;b.read(a);return b};a.prototype.normalizeCtorArgs=function(a){var b;return a&&"object"===typeof a?a:(b={},b["string"===typeof a?"wkt":"wkid"]=a,b)};Object.defineProperty(a.prototype,"isWGS84",{get:function(){return c.isWGS84(this)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isWebMercator",{get:function(){return c.isWebMercator(this)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"isGeographic",{get:function(){return c.isGeographic(this)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isWrappable",{get:function(){return c.isWrappable(this)},enumerable:!0,configurable:!0});a.prototype.writeWkt=function(a,b){this.wkid||(b.wkt=a)};a.prototype.clone=function(){if(this===d.WGS84)return d.WGS84;if(this===d.WebMercator)return d.WebMercator;var a=new d;null!=this.wkid?(a.wkid=this.wkid,null!=this.latestWkid&&(a.latestWkid=this.latestWkid),null!=this.vcsWkid&&(a.vcsWkid=
this.vcsWkid),null!=this.latestVcsWkid&&(a.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(a.wkt=this.wkt);return a};a.prototype.equals=function(a){return c.equals(this,a)};a.prototype.toJSON=function(a){return this.write(null,a)};var d;a.GCS_NAD_1927=null;a.WGS84=null;a.WebMercator=null;e([h.property({dependsOn:["wkid"],readOnly:!0})],a.prototype,"isWGS84",null);e([h.property({dependsOn:["wkid"],readOnly:!0})],a.prototype,"isWebMercator",null);e([h.property({dependsOn:["wkid","wkt"],readOnly:!0})],
a.prototype,"isGeographic",null);e([h.property({dependsOn:["wkid"],readOnly:!0})],a.prototype,"isWrappable",null);e([h.property({type:Number,json:{write:!0}})],a.prototype,"latestWkid",void 0);e([h.property({type:Number,json:{write:!0,origins:{"web-scene":{write:{overridePolicy:function(){return{isRequired:null===this.wkt?!0:!1}}}}}}})],a.prototype,"wkid",void 0);e([h.property({type:String,json:{origins:{"web-scene":{write:{overridePolicy:function(){return{isRequired:null===this.wkid?!0:!1}}}}}}})],
a.prototype,"wkt",void 0);e([h.writer("wkt"),h.writer("web-scene","wkt")],a.prototype,"writeWkt",null);e([h.property({type:Number,json:{write:!0}})],a.prototype,"vcsWkid",void 0);e([h.property({type:Number,json:{write:!0}})],a.prototype,"latestVcsWkid",void 0);return a=d=e([h.subclass("esri.geometry.SpatialReference")],a)}(h.declared(g));m.prototype.toJSON.isDefaultToJSON=!0;m.GCS_NAD_1927=new m({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'});
m.WGS84=new m(4326);m.WGS84.wkt=d.substitute({Central_Meridian:"0.0"},c.getInfo(m.WGS84).wkTemplate);m.WebMercator=new m({wkid:102100,latestWkid:3857});Object.freeze&&(Object.freeze(m.GCS_NAD_1927),Object.freeze(m.WGS84),Object.freeze(m.WebMercator));return m})},"esri/geometry/support/spatialReferenceUtils":function(){define(["require","exports","./WKIDUnitConversion"],function(m,f,k){function e(b){return b.wkid&&!0===g[b.wkid]}Object.defineProperty(f,"__esModule",{value:!0});var g={102113:!0,102100:!0,
3857:!0,3785:!0},d={102113:!0,102100:!0,3857:!0,3785:!0,4326:!0};m=[-2.0037508342788905E7,2.0037508342788905E7];var h=[-2.0037508342787E7,2.0037508342787E7],c={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',
valid:m,origin:h,dx:1E-5},102100:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:m,origin:h,
dx:1E-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:m,origin:h,dx:1E-5},3857:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',
valid:m,origin:h,dx:1E-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',
valid:[-180,180],origin:[-180,180],dx:1E-5}};f.equals=function(b,a){if(a){if(b===a)return!0;if(null!=b.wkid||null!=a.wkid)return b.wkid===a.wkid||e(b)&&e(a)||null!=a.latestWkid&&b.wkid===a.latestWkid||null!=b.latestWkid&&a.wkid===b.latestWkid;if(b.wkt&&a.wkt)return b.wkt.toUpperCase()===a.wkt.toUpperCase()}return!1};f.getInfo=function(b){return b.wkid?c[b.wkid]:null};f.isGeographic=function(b){return b.wkid?null==k[b.wkid]:b.wkt?!!/^\s*GEOGCS/i.test(b.wkt):!1};f.isWGS84=function(b){return 4326===
b.wkid};f.isWebMercator=e;f.isWrappable=function(b){return b.wkid&&!0===d[b.wkid]}})},"esri/geometry/support/WKIDUnitConversion":function(){define([],function(){var m,f={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.116756,5E4,15E4],units:"Meter Foot Foot_US Foot_Clarke Yard_Clarke Link_Clarke Yard_Sears Foot_Sears Chain_Sears Chain_Benoit_1895_B Yard_Indian Yard_Indian_1937 Foot_Gold_Coast Chain_Sears_1922_Truncated 50_Kilometers 150_Kilometers".split(" "),
2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,
3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,
3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,
3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,
5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,
6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,
6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,
6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,
6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,
7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,
7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8058:0,8059:0,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,
8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25E3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,
26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53034:0,53048:0,53049:0,
54034:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,
103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,
103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,
103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,
103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103695:2};for(m=2E3;2045>=m;m++)f[m]=0;for(m=2056;2065>=m;m++)f[m]=0;for(m=2067;2135>=m;m++)f[m]=0;for(m=2137;2154>=m;m++)f[m]=0;for(m=2161;2170>=m;m++)f[m]=0;for(m=2172;2193>=m;m++)f[m]=0;for(m=2195;2198>=m;m++)f[m]=0;for(m=2200;2203>=m;m++)f[m]=0;for(m=2205;2217>=m;m++)f[m]=0;for(m=2222;2224>=m;m++)f[m]=1;for(m=2225;2250>=m;m++)f[m]=2;
for(m=2251;2253>=m;m++)f[m]=1;for(m=2257;2264>=m;m++)f[m]=2;for(m=2274;2279>=m;m++)f[m]=2;for(m=2280;2282>=m;m++)f[m]=1;for(m=2283;2289>=m;m++)f[m]=2;for(m=2290;2292>=m;m++)f[m]=0;for(m=2308;2313>=m;m++)f[m]=0;for(m=2315;2491>=m;m++)f[m]=0;for(m=2494;2866>=m;m++)f[m]=0;for(m=2867;2869>=m;m++)f[m]=1;for(m=2870;2888>=m;m++)f[m]=2;for(m=2891;2895>=m;m++)f[m]=2;for(m=2896;2898>=m;m++)f[m]=1;for(m=2902;2908>=m;m++)f[m]=2;for(m=2915;2920>=m;m++)f[m]=2;for(m=2921;2923>=m;m++)f[m]=1;for(m=2924;2930>=m;m++)f[m]=
2;for(m=2931;2962>=m;m++)f[m]=0;for(m=2964;2968>=m;m++)f[m]=2;for(m=2969;2973>=m;m++)f[m]=0;for(m=2975;2991>=m;m++)f[m]=0;for(m=2995;3051>=m;m++)f[m]=0;for(m=3054;3079>=m;m++)f[m]=0;for(m=3081;3088>=m;m++)f[m]=0;for(m=3092;3101>=m;m++)f[m]=0;for(m=3106;3138>=m;m++)f[m]=0;for(m=3146;3151>=m;m++)f[m]=0;for(m=3153;3166>=m;m++)f[m]=0;for(m=3168;3172>=m;m++)f[m]=0;for(m=3174;3203>=m;m++)f[m]=0;for(m=3294;3358>=m;m++)f[m]=0;for(m=3367;3403>=m;m++)f[m]=0;for(m=3408;3416>=m;m++)f[m]=0;for(m=3417;3438>=m;m++)f[m]=
2;for(m=3441;3446>=m;m++)f[m]=2;for(m=3447;3450>=m;m++)f[m]=0;for(m=3451;3459>=m;m++)f[m]=2;for(m=3460;3478>=m;m++)f[m]=0;for(m=3554;3559>=m;m++)f[m]=0;for(m=3560;3570>=m;m++)f[m]=2;for(m=3571;3581>=m;m++)f[m]=0;for(m=3594;3597>=m;m++)f[m]=0;for(m=3601;3604>=m;m++)f[m]=0;for(m=3637;3639>=m;m++)f[m]=0;for(m=3665;3667>=m;m++)f[m]=0;for(m=3693;3695>=m;m++)f[m]=0;for(m=3701;3727>=m;m++)f[m]=0;for(m=3728;3739>=m;m++)f[m]=2;for(m=3740;3751>=m;m++)f[m]=0;for(m=3753;3760>=m;m++)f[m]=2;for(m=3761;3773>=m;m++)f[m]=
0;for(m=3775;3777>=m;m++)f[m]=0;for(m=3779;3781>=m;m++)f[m]=0;for(m=3783;3785>=m;m++)f[m]=0;for(m=3788;3791>=m;m++)f[m]=0;for(m=3797;3802>=m;m++)f[m]=0;for(m=3814;3816>=m;m++)f[m]=0;for(m=3825;3829>=m;m++)f[m]=0;for(m=3832;3841>=m;m++)f[m]=0;for(m=3844;3852>=m;m++)f[m]=0;for(m=3873;3885>=m;m++)f[m]=0;for(m=3890;3893>=m;m++)f[m]=0;for(m=3907;3912>=m;m++)f[m]=0;for(m=3942;3950>=m;m++)f[m]=0;for(m=3968;3970>=m;m++)f[m]=0;for(m=3973;3976>=m;m++)f[m]=0;for(m=3986;3989>=m;m++)f[m]=0;for(m=3994;3997>=m;m++)f[m]=
0;for(m=4048;4051>=m;m++)f[m]=0;for(m=4056;4063>=m;m++)f[m]=0;for(m=4093;4096>=m;m++)f[m]=0;for(m=4390;4398>=m;m++)f[m]=0;for(m=4399;4413>=m;m++)f[m]=2;for(m=4418;4433>=m;m++)f[m]=2;for(m=4455;4457>=m;m++)f[m]=2;for(m=4484;4489>=m;m++)f[m]=0;for(m=4491;4554>=m;m++)f[m]=0;for(m=4568;4589>=m;m++)f[m]=0;for(m=4652;4656>=m;m++)f[m]=0;for(m=4766;4800>=m;m++)f[m]=0;for(m=5014;5016>=m;m++)f[m]=0;for(m=5069;5072>=m;m++)f[m]=0;for(m=5105;5130>=m;m++)f[m]=0;for(m=5173;5188>=m;m++)f[m]=0;for(m=5253;5259>=m;m++)f[m]=
0;for(m=5269;5275>=m;m++)f[m]=0;for(m=5292;5311>=m;m++)f[m]=0;for(m=5329;5331>=m;m++)f[m]=0;for(m=5343;5349>=m;m++)f[m]=0;for(m=5355;5357>=m;m++)f[m]=0;for(m=5387;5389>=m;m++)f[m]=0;for(m=5459;5463>=m;m++)f[m]=0;for(m=5479;5482>=m;m++)f[m]=0;for(m=5518;5520>=m;m++)f[m]=0;for(m=5530;5539>=m;m++)f[m]=0;for(m=5550;5552>=m;m++)f[m]=0;for(m=5562;5583>=m;m++)f[m]=0;for(m=5623;5625>=m;m++)f[m]=2;for(m=5631;5639>=m;m++)f[m]=0;for(m=5649;5653>=m;m++)f[m]=0;for(m=5663;5680>=m;m++)f[m]=0;for(m=5682;5685>=m;m++)f[m]=
0;for(m=5875;5877>=m;m++)f[m]=0;for(m=5921;5940>=m;m++)f[m]=0;for(m=6050;6125>=m;m++)f[m]=0;for(m=6244;6275>=m;m++)f[m]=0;for(m=6328;6348>=m;m++)f[m]=0;for(m=6350;6356>=m;m++)f[m]=0;for(m=6366;6372>=m;m++)f[m]=0;for(m=6381;6387>=m;m++)f[m]=0;for(m=6393;6404>=m;m++)f[m]=0;for(m=6480;6483>=m;m++)f[m]=0;for(m=6511;6514>=m;m++)f[m]=0;for(m=6579;6581>=m;m++)f[m]=0;for(m=6619;6624>=m;m++)f[m]=0;for(m=6625;6627>=m;m++)f[m]=2;for(m=6628;6632>=m;m++)f[m]=0;for(m=6634;6637>=m;m++)f[m]=0;for(m=6669;6692>=m;m++)f[m]=
0;for(m=6707;6709>=m;m++)f[m]=0;for(m=6720;6723>=m;m++)f[m]=0;for(m=6732;6738>=m;m++)f[m]=0;for(m=6931;6933>=m;m++)f[m]=0;for(m=6956;6959>=m;m++)f[m]=0;for(m=7005;7007>=m;m++)f[m]=0;for(m=7057;7070>=m;m++)f[m]=2;for(m=7074;7082>=m;m++)f[m]=0;for(m=7109;7118>=m;m++)f[m]=0;for(m=7119;7127>=m;m++)f[m]=1;for(m=7374;7376>=m;m++)f[m]=0;for(m=7528;7586>=m;m++)f[m]=0;for(m=7587;7645>=m;m++)f[m]=2;for(m=7755;7787>=m;m++)f[m]=0;for(m=7791;7795>=m;m++)f[m]=0;for(m=7799;7801>=m;m++)f[m]=0;for(m=7803;7805>=m;m++)f[m]=
0;for(m=7825;7831>=m;m++)f[m]=0;for(m=7845;7859>=m;m++)f[m]=0;for(m=8013;8032>=m;m++)f[m]=0;for(m=20002;20032>=m;m++)f[m]=0;for(m=20062;20092>=m;m++)f[m]=0;for(m=20135;20138>=m;m++)f[m]=0;for(m=20248;20258>=m;m++)f[m]=0;for(m=20348;20358>=m;m++)f[m]=0;for(m=20436;20440>=m;m++)f[m]=0;for(m=20822;20824>=m;m++)f[m]=0;for(m=20934;20936>=m;m++)f[m]=0;for(m=21035;21037>=m;m++)f[m]=0;for(m=21095;21097>=m;m++)f[m]=0;for(m=21148;21150>=m;m++)f[m]=0;for(m=21413;21423>=m;m++)f[m]=0;for(m=21473;21483>=m;m++)f[m]=
0;for(m=21780;21782>=m;m++)f[m]=0;for(m=21891;21894>=m;m++)f[m]=0;for(m=21896;21899>=m;m++)f[m]=0;for(m=22171;22177>=m;m++)f[m]=0;for(m=22181;22187>=m;m++)f[m]=0;for(m=22191;22197>=m;m++)f[m]=0;for(m=22234;22236>=m;m++)f[m]=0;for(m=22521;22525>=m;m++)f[m]=0;for(m=22991;22994>=m;m++)f[m]=0;for(m=23028;23038>=m;m++)f[m]=0;for(m=23830;23853>=m;m++)f[m]=0;for(m=23866;23872>=m;m++)f[m]=0;for(m=23877;23884>=m;m++)f[m]=0;for(m=23886;23894>=m;m++)f[m]=0;for(m=23946;23948>=m;m++)f[m]=0;for(m=24311;24313>=
m;m++)f[m]=0;for(m=24342;24347>=m;m++)f[m]=0;for(m=24370;24374>=m;m++)f[m]=10;for(m=24375;24381>=m;m++)f[m]=0;for(m=24718;24721>=m;m++)f[m]=0;for(m=24817;24821>=m;m++)f[m]=0;for(m=24877;24882>=m;m++)f[m]=0;for(m=24891;24893>=m;m++)f[m]=0;for(m=25391;25395>=m;m++)f[m]=0;for(m=25828;25838>=m;m++)f[m]=0;for(m=26191;26195>=m;m++)f[m]=0;for(m=26391;26393>=m;m++)f[m]=0;for(m=26701;26722>=m;m++)f[m]=0;for(m=26729;26799>=m;m++)f[m]=2;for(m=26801;26803>=m;m++)f[m]=2;for(m=26811;26813>=m;m++)f[m]=2;for(m=26847;26870>=
m;m++)f[m]=2;for(m=26891;26899>=m;m++)f[m]=0;for(m=26901;26923>=m;m++)f[m]=0;for(m=26929;26946>=m;m++)f[m]=0;for(m=26948;26998>=m;m++)f[m]=0;for(m=27037;27040>=m;m++)f[m]=0;for(m=27205;27232>=m;m++)f[m]=0;for(m=27258;27260>=m;m++)f[m]=0;for(m=27391;27398>=m;m++)f[m]=0;for(m=27561;27564>=m;m++)f[m]=0;for(m=27571;27574>=m;m++)f[m]=0;for(m=27581;27584>=m;m++)f[m]=0;for(m=27591;27594>=m;m++)f[m]=0;for(m=28191;28193>=m;m++)f[m]=0;for(m=28348;28358>=m;m++)f[m]=0;for(m=28402;28432>=m;m++)f[m]=0;for(m=28462;28492>=
m;m++)f[m]=0;for(m=29118;29122>=m;m++)f[m]=0;for(m=29168;29172>=m;m++)f[m]=0;for(m=29177;29185>=m;m++)f[m]=0;for(m=29187;29195>=m;m++)f[m]=0;for(m=29900;29903>=m;m++)f[m]=0;for(m=30161;30179>=m;m++)f[m]=0;for(m=30491;30494>=m;m++)f[m]=0;for(m=30729;30732>=m;m++)f[m]=0;for(m=31251;31259>=m;m++)f[m]=0;for(m=31265;31268>=m;m++)f[m]=0;for(m=31275;31279>=m;m++)f[m]=0;for(m=31281;31297>=m;m++)f[m]=0;for(m=31461;31469>=m;m++)f[m]=0;for(m=31491;31495>=m;m++)f[m]=0;for(m=31917;31922>=m;m++)f[m]=0;for(m=31965;32E3>=
m;m++)f[m]=0;for(m=32001;32003>=m;m++)f[m]=2;for(m=32005;32031>=m;m++)f[m]=2;for(m=32033;32060>=m;m++)f[m]=2;for(m=32064;32067>=m;m++)f[m]=2;for(m=32074;32077>=m;m++)f[m]=2;for(m=32081;32086>=m;m++)f[m]=0;for(m=32107;32130>=m;m++)f[m]=0;for(m=32133;32158>=m;m++)f[m]=0;for(m=32164;32167>=m;m++)f[m]=2;for(m=32180;32199>=m;m++)f[m]=0;for(m=32201;32260>=m;m++)f[m]=0;for(m=32301;32360>=m;m++)f[m]=0;for(m=32601;32662>=m;m++)f[m]=0;for(m=32664;32667>=m;m++)f[m]=2;for(m=32701;32761>=m;m++)f[m]=0;for(m=53001;53004>=
m;m++)f[m]=0;for(m=53008;53019>=m;m++)f[m]=0;for(m=53021;53032>=m;m++)f[m]=0;for(m=53042;53046>=m;m++)f[m]=0;for(m=53074;53080>=m;m++)f[m]=0;for(m=54001;54004>=m;m++)f[m]=0;for(m=54008;54019>=m;m++)f[m]=0;for(m=54021;54032>=m;m++)f[m]=0;for(m=54042;54046>=m;m++)f[m]=0;for(m=54048;54053>=m;m++)f[m]=0;for(m=54074;54080>=m;m++)f[m]=0;for(m=102001;102040>=m;m++)f[m]=0;for(m=102042;102063>=m;m++)f[m]=0;for(m=102065;102067>=m;m++)f[m]=0;for(m=102070;102117>=m;m++)f[m]=0;for(m=102122;102216>=m;m++)f[m]=
0;for(m=102221;102377>=m;m++)f[m]=0;for(m=102382;102388>=m;m++)f[m]=0;for(m=102389;102398>=m;m++)f[m]=2;for(m=102399;102444>=m;m++)f[m]=0;for(m=102445;102447>=m;m++)f[m]=2;for(m=102448;102458>=m;m++)f[m]=0;for(m=102459;102468>=m;m++)f[m]=2;for(m=102469;102497>=m;m++)f[m]=0;for(m=102500;102519>=m;m++)f[m]=1;for(m=102520;102524>=m;m++)f[m]=0;for(m=102525;102529>=m;m++)f[m]=2;for(m=102530;102568>=m;m++)f[m]=0;for(m=102570;102588>=m;m++)f[m]=0;for(m=102590;102598>=m;m++)f[m]=0;for(m=102601;102603>=m;m++)f[m]=
0;for(m=102605;102628>=m;m++)f[m]=0;for(m=102629;102646>=m;m++)f[m]=2;for(m=102648;102700>=m;m++)f[m]=2;for(m=102701;102703>=m;m++)f[m]=0;for(m=102707;102730>=m;m++)f[m]=2;for(m=102733;102758>=m;m++)f[m]=2;for(m=102767;102900>=m;m++)f[m]=0;for(m=102965;102969>=m;m++)f[m]=0;for(m=102971;102973>=m;m++)f[m]=0;for(m=102975;102989>=m;m++)f[m]=0;for(m=102990;102992>=m;m++)f[m]=1;for(m=102997;103002>=m;m++)f[m]=0;for(m=103003;103008>=m;m++)f[m]=2;for(m=103009;103011>=m;m++)f[m]=0;for(m=103012;103014>=m;m++)f[m]=
2;for(m=103019;103021>=m;m++)f[m]=0;for(m=103022;103024>=m;m++)f[m]=2;for(m=103029;103031>=m;m++)f[m]=0;for(m=103032;103034>=m;m++)f[m]=2;for(m=103065;103068>=m;m++)f[m]=0;for(m=103074;103076>=m;m++)f[m]=0;for(m=103077;103079>=m;m++)f[m]=1;for(m=103080;103082>=m;m++)f[m]=0;for(m=103083;103085>=m;m++)f[m]=2;for(m=103090;103093>=m;m++)f[m]=0;for(m=103097;103099>=m;m++)f[m]=0;for(m=103100;103102>=m;m++)f[m]=2;for(m=103107;103109>=m;m++)f[m]=0;for(m=103110;103112>=m;m++)f[m]=2;for(m=103113;103116>=m;m++)f[m]=
0;for(m=103117;103120>=m;m++)f[m]=2;for(m=103153;103157>=m;m++)f[m]=0;for(m=103158;103162>=m;m++)f[m]=2;for(m=103163;103165>=m;m++)f[m]=0;for(m=103166;103168>=m;m++)f[m]=1;for(m=103169;103171>=m;m++)f[m]=2;for(m=103186;103188>=m;m++)f[m]=0;for(m=103189;103191>=m;m++)f[m]=2;for(m=103192;103195>=m;m++)f[m]=0;for(m=103196;103199>=m;m++)f[m]=2;for(m=103200;103224>=m;m++)f[m]=0;for(m=103225;103227>=m;m++)f[m]=1;for(m=103232;103237>=m;m++)f[m]=0;for(m=103238;103243>=m;m++)f[m]=2;for(m=103244;103246>=m;m++)f[m]=
0;for(m=103247;103249>=m;m++)f[m]=2;for(m=103254;103256>=m;m++)f[m]=0;for(m=103257;103259>=m;m++)f[m]=2;for(m=103264;103266>=m;m++)f[m]=0;for(m=103267;103269>=m;m++)f[m]=2;for(m=103300;103375>=m;m++)f[m]=0;for(m=103381;103383>=m;m++)f[m]=0;for(m=103384;103386>=m;m++)f[m]=1;for(m=103387;103389>=m;m++)f[m]=0;for(m=103390;103392>=m;m++)f[m]=2;for(m=103397;103399>=m;m++)f[m]=0;for(m=103400;103471>=m;m++)f[m]=2;for(m=103476;103478>=m;m++)f[m]=0;for(m=103479;103481>=m;m++)f[m]=2;for(m=103486;103488>=m;m++)f[m]=
0;for(m=103489;103491>=m;m++)f[m]=2;for(m=103492;103495>=m;m++)f[m]=0;for(m=103496;103499>=m;m++)f[m]=2;for(m=103528;103543>=m;m++)f[m]=0;for(m=103544;103548>=m;m++)f[m]=2;for(m=103549;103551>=m;m++)f[m]=0;for(m=103552;103554>=m;m++)f[m]=1;for(m=103555;103557>=m;m++)f[m]=2;for(m=103558;103560>=m;m++)f[m]=0;for(m=103571;103573>=m;m++)f[m]=0;for(m=103574;103576>=m;m++)f[m]=2;for(m=103577;103580>=m;m++)f[m]=0;for(m=103581;103583>=m;m++)f[m]=2;for(m=103600;103694>=m;m++)f[m]=0;for(m=103700;103793>=m;m++)f[m]=
2;for(m=103794;103871>=m;m++)f[m]=0;for(m=103900;103971>=m;m++)f[m]=2;return f})},"esri/geometry/Point":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Logger ../core/accessorSupport/decorators ./Geometry ./SpatialReference ./support/spatialReferenceUtils ./support/webMercatorUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a){return a&&("esri.geometry.SpatialReference"===a.declaredClass||null!=a.wkid)}var n=[0,0],p=g.getLogger("esri.geometry.Point");
m=function(h){function g(a,b,c,d,e){a=h.call(this)||this;a.x=0;a.y=0;a.z=void 0;a.m=void 0;a.type="point";return a}k(g,h);q=g;g.copy=function(a,b){b.x=a.x;b.y=a.y;b.z=a.z;b.m=a.m;b.spatialReference=Object.isFrozen(a.spatialReference)?a.spatialReference:a.spatialReference.clone()};g.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;a=a.hasZ&&b.hasZ?a.z-b.z:0;return Math.sqrt(c*c+d*d+a*a)};g.prototype.normalizeCtorArgs=function(b,d,e,h,g){var v;if(Array.isArray(b))v=b,g=d,b=v[0],d=v[1],e=v[2],h=v[3];else if(b&&
"object"===typeof b){if(v=b,b=null!=v.x?v.x:v.longitude,d=null!=v.y?v.y:v.latitude,e=null!=v.z?v.z:v.altitude,h=v.m,(g=v.spatialReference)&&"esri.geometry.SpatialReference"!==g.declaredClass&&(g=new c(g)),null!=v.longitude||null!=v.latitude)null==v.longitude?p.warn(".longitude\x3d","Latitude was defined without longitude"):null==v.latitude?p.warn(".latitude\x3d","Longitude was defined without latitude"):!v.declaredClass&&g&&g.isWebMercator&&(d=a.lngLatToXY(v.longitude,v.latitude,n),b=d[0],d=d[1])}else l(e)?
(g=e,e=null):l(h)&&(g=h,h=null);b={x:b,y:d};null==b.x&&null!=b.y?p.warn(".y\x3d","Y coordinate was defined without an X coordinate"):null==b.y&&null!=b.x&&p.warn(".x\x3d","X coordinate was defined without a Y coordinate");null!=g&&(b.spatialReference=g);null!=e&&(b.z=e);null!=h&&(b.m=h);return b};Object.defineProperty(g.prototype,"hasM",{get:function(){return void 0!==this.m},set:function(a){var b=this._get("hasM");a!==b&&(this._set("m",a?0:void 0),this._set("hasM",a))},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"hasZ",{get:function(){return void 0!==this.z},set:function(a){var b=this._get("hasZ");a!==b&&(this._set("z",a?0:void 0),this._set("hasZ",a))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"latitude",{get:function(){var b=this._get("spatialReference");if(b){if(b.isWebMercator)return a.xyToLngLat(this.x,this.y,n)[1];if(b.isWGS84)return this._get("y")}return null},set:function(b){var c=this._get("spatialReference");c&&(c.isWebMercator?this._set("y",
a.lngLatToXY(this.x,b,n)[1]):c.isWGS84&&this._set("y",b),this._set("latitude",b))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"longitude",{get:function(){var b=this._get("spatialReference");if(b){if(b.isWebMercator)return a.xyToLngLat(this._get("x"),this._get("y"),n)[0];if(b.isWGS84)return this._get("x")}return null},set:function(b){var c=this._get("spatialReference");c&&(c.isWebMercator?this._set("x",a.lngLatToXY(b,this._get("y"),n)[0]):c.isWGS84&&this._set("x",b),this._set("longitude",
b))},enumerable:!0,configurable:!0});g.prototype.clone=function(){var a=new q;a.x=this.x;a.y=this.y;a.z=this.z;a.m=this.m;a.spatialReference=this.spatialReference;return a};g.prototype.copy=function(a){q.copy(a,this);return this};g.prototype.equals=function(b){var c;if(!b)return!1;var d=this.x,e=this.y,l=this.z,h=this.m,g=this.spatialReference,n=b.z,p=b.m,q=b.x;c=b.y;b=b.spatialReference;if(!g.equals(b))if(g.isWebMercator&&b.isWGS84)c=a.lngLatToXY(q,c),q=c[0],c=c[1],b=g;else if(g.isWGS84&&b.isWebMercator)c=
a.xyToLngLat(q,c),q=c[0],c=c[1],b=g;else return!1;return d===q&&e===c&&l===n&&h===p&&g.wkid===b.wkid};g.prototype.offset=function(a,b,c){this.x+=a;this.y+=b;null!=c&&this.hasZ&&(this.z+=c);return this};g.prototype.normalize=function(){if(!this.spatialReference)return this;var a=b.getInfo(this.spatialReference);if(!a)return this;var c=this.x,d=a.valid,a=d[0],e=d[1],d=2*e;c>e?(a=Math.ceil(Math.abs(c-e)/d),c-=a*d):c<a&&(a=Math.ceil(Math.abs(c-a)/d),c+=a*d);this._set("x",c);return this};g.prototype.distance=
function(a){return q.distance(this,a)};g.prototype.toArray=function(){var a=this.hasZ,b=this.hasM;return a&&b?[this.x,this.y,this.z,this.m]:a?[this.x,this.y,this.z]:b?[this.x,this.y,this.m]:[this.x,this.y]};g.prototype.toJSON=function(a){return this.write(null,a)};var q;e([d.property({dependsOn:["x","y","z","m","spatialReference"]})],g.prototype,"cache",void 0);e([d.property({type:Boolean,dependsOn:["m"],json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasM",null);e([d.property({type:Boolean,
dependsOn:["z"],json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasZ",null);e([d.property({type:Number,dependsOn:["y"]})],g.prototype,"latitude",null);e([d.property({type:Number,dependsOn:["x"]})],g.prototype,"longitude",null);e([d.property({type:Number,json:{write:{isRequired:!0}}})],g.prototype,"x",void 0);e([d.property({type:Number,json:{write:!0}})],g.prototype,"y",void 0);e([d.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasZ}}}}})],g.prototype,
"z",void 0);e([d.property({type:Number,json:{write:{overridePolicy:function(){return{enabled:this.hasM}}}}})],g.prototype,"m",void 0);return g=q=e([d.subclass("esri.geometry.Point")],g)}(d.declared(h));m.prototype.toJSON.isDefaultToJSON=!0;return m})},"esri/geometry/support/webMercatorUtils":function(){define("require exports ../../core/lang ../../core/wgs84Constants ../SpatialReference ./spatialReferenceUtils".split(" "),function(m,f,k,e,g,d){function h(a,b,c,d,e){var l;if("x"in a&&"x"in e)b=b(a.x,
a.y,n,0,d),e.x=b[0],e.y=b[1];else if("xmin"in a&&"xmin"in e)l=b(a.xmin,a.ymin,n,0,d),e.xmin=l[0],e.ymin=l[1],b=b(a.xmax,a.ymax,n,0,d),e.xmax=b[0],e.ymax=b[1];else if("paths"in a&&"paths"in e||"rings"in a&&"rings"in e){l="paths"in a?a.paths:a.rings;var h=[],g=void 0;for(a=0;a<l.length;a++){var p=l[a],g=[];h.push(g);for(var q=0;q<p.length;q++)g.push(b(p[q][0],p[q][1],[0,0],0,d)),2<p[q].length&&g[q].push(p[q][2]),3<p[q].length&&g[q].push(p[q][3])}"paths"in e?e.paths=h:e.rings=h}else if("points"in a&&
"points"in e){l=a.points;h=[];for(a=0;a<l.length;a++)h[a]=b(l[a][0],l[a][1],[0,0],0,d),2<l[a].length&&h[a].push(l[a][2]),3<l[a].length&&h[a].push(l[a][3]);e.points=h}else if("type"in a&&"mesh"===a.type&&"type"in e&&"mesh"===e.type&&(l=a.vertexAttributes&&a.vertexAttributes.position,h=e.vertexAttributes&&e.vertexAttributes.position,l))for(g=[0,0],a=0;a<l.length;a+=3)b(l[a],l[a+1],g,0,d),h[a]=g[0],h[a+1]=g[1];e.spatialReference=c;return e}function c(a,b){a=a&&(null!=a.wkid||null!=a.wkt?a:a.spatialReference);
b=b&&(null!=b.wkid||null!=b.wkt?b:b.spatialReference);return a&&b?d.equals(b,a)?!0:d.isWebMercator(b)&&d.isWGS84(a)||d.isWebMercator(a)&&d.isWGS84(b):!1}function b(a,b,c,d){void 0===c&&(c=[0,0]);void 0===d&&(d=0);89.99999<b?b=89.99999:-89.99999>b&&(b=-89.99999);b*=.017453292519943;c[d]=.017453292519943*a*l;c[d+1]=.5*l*Math.log((1+Math.sin(b))/(1-Math.sin(b)));return c}function a(a,b,c,d,e){void 0===c&&(c=[0,0]);void 0===d&&(d=0);void 0===e&&(e=!1);a=a/l*57.29577951308232;c[d]=e?a:a-360*Math.floor((a+
180)/360);c[d+1]=57.29577951308232*(Math.PI/2-2*Math.atan(Math.exp(-1*b/l)));return c}Object.defineProperty(f,"__esModule",{value:!0});var l=e.wgs84Radius,n=[0,0];f.canProject=c;f.project=function(e,l){var n=e&&e.spatialReference;l=l&&(null!=l.wkid||null!=l.wkt?l:l.spatialReference);return c(n,l)?d.equals(n,l)?k.clone(e):d.isWebMercator(l)?h(e,b,g.WebMercator,!1,k.clone(e)):d.isWGS84(l)?h(e,a,g.WGS84,!1,k.clone(e)):null:null};f.lngLatToXY=b;f.xyToLngLat=a;f.geographicToWebMercator=function(a,c,d){void 0===
c&&(c=!1);void 0===d&&(d=k.clone(a));return h(a,b,g.WebMercator,c,d)};f.webMercatorToGeographic=function(b,c,d){void 0===c&&(c=!1);void 0===d&&(d=k.clone(b));return h(b,a,g.WGS84,c,d)}})},"esri/core/wgs84Constants":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.wgs84Radius=6378137;f.wgs84InverseFlattening=298.257223563;f.wgs84Flattening=1/f.wgs84InverseFlattening;f.wgs84PolarRadius=f.wgs84Radius*(1-f.wgs84Flattening);f.wgs84Eccentricity=.0818191908426215})},
"esri/geometry/support/contains":function(){define(["require","exports"],function(m,f){function k(d,e,c,b){return e>=d.xmin&&e<=d.xmax&&c>=d.ymin&&c<=d.ymax?null!=b&&d.hasZ?b>=d.zmin&&b<=d.zmax:!0:!1}function e(d,e){if(d=d.rings)if(Array.isArray(d[0][0])){for(var c=!1,b=0,a=d.length;b<a;b++)c=g(c,d[b],e);e=c}else e=g(!1,d,e);else e=!1;return e}function g(d,e,c){var b=c[0];c=c[1];for(var a=0,l=0,h=e.length;l<h;l++){a++;a===h&&(a=0);var g=e[l],k=g[0],g=g[1],r=e[a],f=r[0],r=r[1];(g<c&&r>=c||r<c&&g>=
c)&&k+(c-g)/(r-g)*(f-k)<b&&(d=!d)}return d}Object.defineProperty(f,"__esModule",{value:!0});f.extentContainsPoint=function(d,e){return k(d,e.x,e.y,e.z)};f.extentContainsExtent=function(d,e){var c=e.xmin,b=e.ymin,a=e.zmin,l=e.xmax,h=e.ymax,g=e.zmax;return d.hasZ&&e.hasZ?k(d,c,b,a)&&k(d,c,h,a)&&k(d,l,h,a)&&k(d,l,b,a)&&k(d,c,b,g)&&k(d,c,h,g)&&k(d,l,h,g)&&k(d,l,b,g):k(d,c,b)&&k(d,c,h)&&k(d,l,h)&&k(d,l,b)};f.extentContainsCoords2D=function(d,e){return k(d,e[0],e[1])};f.extentContainsCoords3D=function(d,
e){return k(d,e[0],e[1],e[2])};f.polygonContainsPoint=function(d,h){return e(d,[h.x,h.y])};f.polygonContainsCoords=e})},"esri/geometry/support/intersects":function(){define(["require","exports","./contains"],function(m,f,k){function e(a,b){return k.extentContainsPoint(a,b)}function g(a,b){var c=a.hasZ&&b.hasZ,d;if(a.xmin<=b.xmin){if(d=b.xmin,a.xmax<d)return!1}else if(d=a.xmin,b.xmax<d)return!1;if(a.ymin<=b.ymin){if(d=b.ymin,a.ymax<d)return!1}else if(d=a.ymin,b.ymax<d)return!1;if(c&&b.hasZ)if(a.zmin<=
b.zmin){if(c=b.zmin,a.zmax<c)return!1}else if(c=a.zmin,b.zmax<c)return!1;return!0}function d(a,b){var c=b.hasZ?k.extentContainsCoords3D:k.extentContainsCoords2D,d=0;for(b=b.points;d<b.length;d++)if(c(a,b[d]))return!0;return!1}function h(a,c){l[0]=a.xmin;l[1]=a.ymax;n[0]=a.xmax;n[1]=a.ymax;p[0]=a.xmin;p[1]=a.ymin;q[0]=a.xmax;q[1]=a.ymin;for(var d=0,e=r;d<e.length;d++)if(k.polygonContainsCoords(c,e[d]))return!0;d=0;for(c=c.rings;d<c.length;d++)if(e=c[d],e.length){var h=e[0];if(k.extentContainsCoords2D(a,
h))return!0;for(var g=1;g<e.length;g++){var u=e[g];if(k.extentContainsCoords2D(a,u)||b(h,u,t))return!0;h=u}}return!1}function c(a,c){l[0]=a.xmin;l[1]=a.ymax;n[0]=a.xmax;n[1]=a.ymax;p[0]=a.xmin;p[1]=a.ymin;q[0]=a.xmax;q[1]=a.ymin;c=c.paths;for(var d=0;d<c.length;d++){var e=c[d];if(c.length){var h=e[0];if(k.extentContainsCoords2D(a,h))return!0;for(var g=1;g<e.length;g++){var u=e[g];if(k.extentContainsCoords2D(a,u)||b(h,u,t))return!0;h=u}}}return!1}function b(b,c,d){for(var e=0;e<d.length;e++)if(a(b,
c,d[e][0],d[e][1]))return!0;return!1}function a(a,b,c,d,e){var l=a[0];a=a[1];var h=b[0];b=b[1];var g=c[0],n=c[1];c=d[0]-g;var g=l-g,v=h-l;d=d[1]-n;var n=a-n,p=b-a,k=d*v-c*p;if(0===k)return!1;c=(c*n-d*g)/k;g=(v*n-p*g)/k;return 0<=c&&1>=c&&0<=g&&1>=g?(e&&(e[0]=l+c*(h-l),e[1]=a+c*(b-a)),!0):!1}Object.defineProperty(f,"__esModule",{value:!0});f.extentIntersectsPoint=e;f.extentIntersectsExtent=g;f.extentIntersectsMultipoint=d;var l=[0,0],n=[0,0],p=[0,0],q=[0,0],r=[l,n,p,q],t=[[p,l],[l,n],[n,q],[q,p]];
f.extentIntersectsPolygon=h;f.extentIntersectsPolyline=c;var w=[0,0];f.isSelfIntersecting=function(b){for(var c=0;c<b.length;c++){for(var d=b[c],e=0;e<d.length-1;e++)for(var l=d[e],h=d[e+1],g=c+1;g<b.length;g++)for(var n=0;n<b[g].length-1;n++){var p=b[g][n],k=b[g][n+1],q=a(l,h,p,k,w);if(q&&!(w[0]===l[0]&&w[1]===l[1]||w[0]===p[0]&&w[1]===p[1]||w[0]===h[0]&&w[1]===h[1]||w[0]===k[0]&&w[1]===k[1]))return!0}n=d.length;if(!(4>=n))for(e=0;e<n-3;e++){var u=n-1;0===e&&(u=n-2);l=d[e];h=d[e+1];for(g=e+2;g<u;g++)if(p=
d[g],k=d[g+1],(q=a(l,h,p,k,w))&&!(w[0]===l[0]&&w[1]===l[1]||w[0]===p[0]&&w[1]===p[1]||w[0]===h[0]&&w[1]===h[1]||w[0]===k[0]&&w[1]===k[1]))return!0}}return!1};f.segmentIntersects=a;f.getExtentIntersector=function(a){switch(a){case "esriGeometryEnvelope":case "extent":return g;case "esriGeometryMultipoint":case "multipoint":return d;case "esriGeometryPoint":case "point":return e;case "esriGeometryPolygon":case "polygon":return h;case "esriGeometryPolyline":case "polyline":return c;case "mesh":return g}}})},
"esri/geometry/Mesh":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/lang ../core/Logger ../core/accessorSupport/decorators ./Extent ./Geometry ./support/MeshComponent ./support/MeshVertexAttributes ./support/triangulationUtils ./support/meshUtils/centerAt ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){var u=
h.getLogger("esri.geometry.Mesh");m=function(a){function h(b){b=a.call(this)||this;b.components=null;b.hasZ=!0;b.hasM=!1;b.vertexAttributes=new n.MeshVertexAttributes;b.type="mesh";return b}k(h,a);f=h;Object.defineProperty(h.prototype,"extent",{get:function(){var a=this.spatialReference,c=this.vertexAttributes&&this.vertexAttributes.position;if(!c||0===c.length||this.components&&0===this.components.length)return new b({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:a});a={xmin:Infinity,
xmax:-Infinity,ymin:Infinity,ymax:-Infinity,zmin:Infinity,zmax:-Infinity,spatialReference:a};if(!this.components)return new b(this.extendExtent(a,c,null));for(var d=0,e=this.components;d<e.length;d++){var l=e[d];if(l.faces)this.extendExtent(a,c,l.faces);else{this.extendExtent(a,c,null);break}}return new b(a)},enumerable:!0,configurable:!0});h.prototype.addComponent=function(a){this.components||(this.components=[]);this.components.push(a);this.clearCache()};h.prototype.removeComponent=function(a){if(this.components&&
(a=this.components.indexOf(a),-1!==a)){this.components=this.components.splice(a,1);return}u.error("removeComponent()","Provided component is not part of the list of components")};h.prototype.rotate=function(a,b,c,d){w.axisAngleFrom(x.x,a/180*Math.PI,z);w.axisAngleFrom(x.y,b/180*Math.PI,y);w.axisAngleFrom(x.z,c/180*Math.PI,A);w.axisAngleMultiply(z,y,z);w.axisAngleMultiply(z,A,z);w.rotate(this,z,d);return this};h.prototype.offset=function(a,b,c,d){v[0]=a;v[1]=b;v[2]=c;r.offset(this,v,d);return this};
h.prototype.centerAt=function(a,b){q.centerAt(this,a,b);return this};h.prototype.clone=function(){return new f({components:d.clone(this.components),spatialReference:this.spatialReference,vertexAttributes:d.clone(this.vertexAttributes)})};h.prototype.vertexAttributesChanged=function(){this.clearCache()};h.prototype.toJSON=function(a){return this.write(null,a)};h.prototype.forEachVertex=function(a,b,c){if(b)for(e=0;e<b.length;e++){var d=3*b[e];c(a[d+0],a[d+1],a[d+2])}else for(var e=0;e<a.length;e+=
3)c(a[e+0],a[e+1],a[e+2])};h.prototype.extendExtent=function(a,b,c){this.forEachVertex(b,c,function(b,c,d){a.xmin=Math.min(a.xmin,b);a.xmax=Math.max(a.xmax,b);a.ymin=Math.min(a.ymin,c);a.ymax=Math.max(a.ymax,c);a.zmin=Math.min(a.zmin,d);a.zmax=Math.max(a.zmax,d)});return a};h.createBox=function(a,b){a=new f(t.convertUnitGeometry(t.createUnitSizeBox(),a,b));if(b&&b.imageFace&&"all"!==b.imageFace){var c=a.components[0],d=c.faces,e=t.boxFaceOrder[b.imageFace],h=6*e;b=new Uint32Array(6);for(var g=new Uint32Array(d.length-
6),n=0,v=0,p=0;p<d.length;p++)p>=h&&p<h+6?b[n++]=d[p]:g[v++]=d[p];d=new Float32Array(a.vertexAttributes.uv);e*=8;h=[0,1,1,1,1,0,0,0];for(p=0;p<h.length;p++)d[e+p]=h[p];a.vertexAttributes.uv=d;a.components=[new l({faces:b,material:c.material}),new l({faces:g})]}return a};h.createSphere=function(a,b){return new f(t.convertUnitGeometry(t.createUnitSizeSphere(b&&b.densificationFactor||0),a,b))};h.createCylinder=function(a,b){return new f(t.convertUnitGeometry(t.createUnitSizeCylinder(b&&b.densificationFactor||
0),a,b))};h.createPlane=function(a,b){return new f(t.convertUnitGeometry(t.createUnitSizePlane(b&&b.facing||"up"),a,b))};h.createFromPolygon=function(a,b){var c=p.triangulate(a);return new f({vertexAttributes:{position:c.position},components:[{faces:c.faces,shading:"flat",material:b&&b.material||null}],spatialReference:a.spatialReference})};var f;e([c.property({dependsOn:["vertexAttributes","vertexAttributes.position","components"],json:{read:!1}})],h.prototype,"cache",void 0);e([c.property({type:[l]})],
h.prototype,"components",void 0);e([c.property({dependsOn:["cache"],readOnly:!0,json:{read:!1}})],h.prototype,"extent",null);e([c.property({readOnly:!0,json:{read:!1,write:!1}})],h.prototype,"hasZ",void 0);e([c.property({readOnly:!0,json:{read:!1,write:!1}})],h.prototype,"hasM",void 0);e([c.property({type:n.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],h.prototype,"vertexAttributes",void 0);e([g(0,c.cast(l))],h.prototype,"addComponent",null);return h=f=e([c.subclass("esri.geometry.Mesh")],
h)}(c.declared(a));m.prototype.toJSON.isDefaultToJSON=!0;var x={x:[1,0,0],y:[0,1,0],z:[0,0,1]},v=[0,0,0],z=[0,0,0,0],y=[0,0,0,0],A=[0,0,0,0];return m})},"esri/core/tsSupport/paramHelper":function(){define([],function(){return function(m,f){return function(k,e){f(k,e,m)}}})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshMaterial ./MeshVertexAttributes".split(" "),
function(m,f,k,e,g,d,h,c,b,a){var l=h.getLogger("esri.geometry.support.MeshComponent");return function(h){function g(a){a=h.call(this)||this;a.faces=null;a.material=null;a.shading="source";return a}k(g,h);n=g;g.prototype.castFaces=function(b){return a.castArray(b,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},l)};g.prototype.clone=function(){return new n({faces:d.clone(this.faces),shading:this.shading,material:d.clone(this.material)})};var n;e([c.property({json:{write:!0}})],g.prototype,
"faces",void 0);e([c.cast("faces")],g.prototype,"castFaces",null);e([c.property({type:b.MeshMaterial,json:{write:!0}})],g.prototype,"material",void 0);e([c.property({type:String,json:{write:!0}})],g.prototype,"shading",void 0);return g=n=e([c.subclass("esri.geometry.support.MeshComponent")],g)}(c.declared(g))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./ImageMeshColor ./MeshColor ./ValueMeshColor".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){Object.defineProperty(f,"__esModule",{value:!0});var p={base:l.default,key:"type",defaultKeyValue:"value",typeMap:{value:n,image:a}};m=function(d){function l(a){a=d.call(this)||this;a.color=null;return a}k(l,d);r=l;l.prototype.castColor=function(c){return c?"string"===typeof c?q.test(c)||g.named[c]?new n({value:c}):new a({url:c}):Array.isArray(c)?new n({value:c}):c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof ImageData?new a({data:c}):
b.ensureOneOfType(p,c):c};l.prototype.readColor=function(b,c,d){if(b)switch(b.type){case "image":return new a(b);case "value":return new n(b)}};l.prototype.clone=function(){return new r({color:h.clone(this.color)})};var r;e([c.property({types:p,json:{write:!0}})],l.prototype,"color",void 0);e([c.cast("color")],l.prototype,"castColor",null);e([c.reader("color")],l.prototype,"readColor",null);return l=r=e([c.subclass("esri.geometry.support.MeshResources")],l)}(c.declared(d));f.MeshMaterial=m;var q=
/^\s*(#|rgba?\()/;f.default=m})},"esri/Color":function(){define(["./core/declare","./core/accessorSupport/ensureType","dojo/colors"],function(m,f,k){function e(d){return Math.max(0,Math.min(f.ensureInteger(d),255))}var g=m([k],{declaredClass:"esri.Color",toJSON:function(){return[e(this.r),e(this.g),e(this.b),1<this.a?this.a:e(255*this.a)]},clone:function(){return new g(this.toRgba())}});g.toJSON=function(d){return d&&[e(d.r),e(d.g),e(d.b),1<d.a?d.a:e(255*d.a)]};g.fromJSON=function(d){return d&&new g([d[0],
d[1],d[2],d[3]/255])};g.toUnitRGB=function(d){return[d.r/255,d.g/255,d.b/255]};g.toUnitRGBA=function(d){return[d.r/255,d.g/255,d.b/255,null!=d.a?d.a:1]};var d="named blendColors fromRgb fromHex fromArray fromString".split(" ");for(m=0;m<d.length;m++)g[d[m]]=k[d[m]];g.named.rebeccapurple=[102,51,153];return g})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(m,f,k,e){var g={};f.setObject("dojo.colors",g);var d=function(c,b,a){0>a&&++a;1<a&&
--a;var d=6*a;return 1>d?c+(b-c)*d:1>2*a?b:2>3*a?c+(b-c)*(2/3-a)*6:c};m.colorFromRgb=k.fromRgb=function(c,b){var a=c.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(a){c=a[2].split(/\s*,\s*/);var l=c.length,a=a[1];if("rgb"==a&&3==l||"rgba"==a&&4==l)return a=c[0],"%"==a.charAt(a.length-1)?(a=e.map(c,function(a){return 2.56*parseFloat(a)}),4==l&&(a[3]=c[3]),k.fromArray(a,b)):k.fromArray(c,b);if("hsl"==a&&3==l||"hsla"==a&&4==l){var a=(parseFloat(c[0])%360+360)%360/360,h=parseFloat(c[1])/
100,g=parseFloat(c[2])/100,h=.5>=g?g*(h+1):g+h-g*h,g=2*g-h,a=[256*d(g,h,a+1/3),256*d(g,h,a),256*d(g,h,a-1/3),1];4==l&&(a[3]=c[3]);return k.fromArray(a,b)}}return null};var h=function(c,b,a){c=Number(c);return isNaN(c)?a:c<b?b:c>a?a:c};k.prototype.sanitize=function(){this.r=Math.round(h(this.r,0,255));this.g=Math.round(h(this.g,0,255));this.b=Math.round(h(this.b,0,255));this.a=h(this.a,0,1);return this};g.makeGrey=k.makeGrey=function(c,b){return k.fromArray([c,c,c,b])};f.mixin(k.named,{aliceblue:[240,
248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,
0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],
forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,
211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,
250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,
221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,
245,245],yellowgreen:[154,205,50]});return k})},"esri/geometry/support/ImageMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Identifiable ../../core/urlUtils ../../core/accessorSupport/decorators ./MeshColor ../../views/support/screenshotUtils".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function c(b){b=a.call(this)||this;b.type="image";return b}k(c,a);g=c;Object.defineProperty(c.prototype,"url",{get:function(){return this._get("url")||
null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});c.prototype.writeUrl=function(a,b,c,e){b[c]=d.write(a,e)};Object.defineProperty(c.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});c.prototype.writeData=function(a,b,c,e){a instanceof HTMLImageElement?a={type:"image-element",src:d.write(a.src,e)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,
0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};c.prototype.readData=function(a,b){switch(a.type){case "image-element":return b=new Image,b.src=a.src,b;case "canvas-element":return a=this.decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData)}};Object.defineProperty(c.prototype,
"transparent",{get:function(){var a=this.data;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new g({url:this.url,data:this.data})};c.prototype.encodeImageData=function(a){for(var b="",c=0;c<a.data.length;c++)b+=
String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};c.prototype.decodeImageData=function(a){for(var c=atob(a.data),d=new Uint8ClampedArray(c.length),e=0;e<c.length;e++)d[e]=c.charCodeAt(e);return b.wrapImageData(d,a.width,a.height)};c.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};var g;e([h.property()],c.prototype,"type",void 0);e([h.property({type:String,json:{write:!0}})],c.prototype,"url",
null);e([h.writer("url")],c.prototype,"writeUrl",null);e([h.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),h.property()],c.prototype,"data",null);e([h.writer("data")],c.prototype,"writeData",null);e([h.reader("data")],c.prototype,"readData",null);e([h.property({type:Boolean,dependsOn:["data"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);return c=g=e([h.subclass("esri.geometry.support.ImageMeshColor")],
c)}(h.declared(c.default,g))})},"esri/core/Identifiable":function(){define(["./declare"],function(m){var f=0;return m(null,{constructor:function(){Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+f++})}})})},"esri/geometry/support/MeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,
d){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function c(b){return h.call(this)||this}k(c,h);c.prototype.clone=function(){throw Error("not implemented");};e([d.property({readOnly:!0,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0,enabled:!0}}})],c.prototype,"type",void 0);return c=e([d.subclass("esri.geometry.support.MeshColor")],c)}(d.declared(g));f.MeshColor=m;f.default=m})},"esri/views/support/screenshotUtils":function(){define(["require","exports","../../core/tsSupport/assignHelper"],
function(m,f,k){function e(a,b){var c=a||{},d=c.format,e=c.quality,c=c.rotation,g=b.padding||p,v;v=b.width-g.left-g.right;b=b.height-g.top-g.bottom;var k=0,g=0,q=v,r=b;if(a&&a.area){var k=Math.floor(a.area.x)||0,g=Math.floor(a.area.y)||0,f=null!=a.area.width?Math.floor(a.area.width):null,m=null!=a.area.height?Math.floor(a.area.height):null,q=q-k,r=r-g;null!=f&&null!=m?(q=Math.min(q,f),r=Math.min(r,m)):null==f&&null!=m?(f=Math.min(q,f),r*=f/q,q=f):null!=f&&null==m&&(f=Math.min(r,m),q*=f/r,r=f)}a&&
null!=a.width&&null!=a.height&&(f=a.width/a.height,m=q/r,m!==f&&(m<f?q=Math.floor(r*f):r=Math.floor(q/f)));k=Math.floor(Math.max(k,0));g=Math.floor(Math.max(g,0));v={x:k,y:g,width:Math.floor(Math.min(q,v-k)),height:Math.floor(Math.min(r,b-g))};b=v.width/v.height;g=q/r;g!==b&&(g>b?(b=Math.floor(v.width/g),v={x:v.x,y:Math.floor(v.y+(v.height-b)/2),width:v.width,height:b}):(b=Math.floor(v.height*g),v={x:Math.floor(v.x+(v.width-b)/2),y:v.y,width:b,height:v.height}));b=h(a,v);a=b.width;b=b.height;a:switch(d){case "png":case "jpg":case "jpeg":break a;
default:d=l}g=n[d];e=null!=e?e:g;return{format:d,quality:0>e?0:100<e?100:e,area:v,width:a,height:b,rotation:c}}function g(b,c){return b.toDataURL(a[c.format],c.quality/100)}function d(a,b,d){d||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),d=c);return d.getContext("2d").createImageData(a,b)}function h(a,b){if(!a)return b;var c=a.width;a=a.height;if(null!=c&&null!=a)return{width:Math.floor(c),height:Math.floor(a)};if(null==c&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(c),
height:Math.floor(c/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}Object.defineProperty(f,"__esModule",{value:!0});f.completeUserSettings=e;f.toRenderSettings=function(a,b){a=e(a,b);var c=a.area,d=a.width/c.width,l=b.padding,h=l.left+l.right,g=l.top+l.bottom;return{framebufferWidth:Math.floor((b.width-h)*d+h),framebufferHeight:Math.floor((b.height-g)*d+g),region:{x:Math.floor(c.x*d)+l.left,y:Math.floor(c.y*d)+l.top,width:a.width,height:a.height},format:a.format,quality:a.quality,rotation:a.rotation,
pixelRatio:d}};f.encodeResult=function(a,b,c,d){if(d.premultipliedAlpha)for(var e=a.data,l=e.length,h=0;h<l;h+=4){var n=e[h+3];0<n&&(n/=255,e[h+0]/=n,e[h+1]/=n,e[h+2]/=n)}c.width=a.width;c.height=a.height;e=c.getContext("2d");e.putImageData(a,0,0);d.flipY&&(e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore());a=e.getImageData(0,0,a.width,a.height);b=g(c,b);c.width=0;c.height=0;return{dataUrl:b,data:a}};f.toDataUrl=g;f.createEmptyImageData=
function(a,c,e){if(!a||!c)throw Error("Cannot construct image data without dimensions");if(b)try{return new ImageData(a,c)}catch(w){b=!1}return d(a,c,e)};f.wrapImageData=function(a,c,e,l){if(!c||!e)throw Error("Cannot construct image data without dimensions");if(b)try{return new ImageData(a,c,e)}catch(u){b=!1}c=d(c,e,l);c.data.set(a,0);return c};f.resampleHermite=function(a,b,c,d,e,l,h,g){void 0===d&&(d=0);void 0===e&&(e=0);void 0===l&&(l=a.width-d);void 0===h&&(h=a.height-e);void 0===g&&(g=!1);var n=
a.data,v=b.width,p=b.height,k=b.data;l/=v;h/=p;var q=Math.ceil(l/2),z=Math.ceil(h/2);a=a.width;for(var u=0;u<p;u++)for(var r=0;r<v;r++){for(var f=4*(r+(g?p-u-1:u)*v),x=0,t=0,w=0,m=0,Q=0,H=0,K=(u+.5)*h,R=Math.floor(u*h);R<(u+1)*h;R++)for(var P=Math.abs(K-(R+.5))/z,L=(r+.5)*l,P=P*P,T=Math.floor(r*l);T<(r+1)*l;T++){var S=Math.abs(L-(T+.5))/q,S=Math.sqrt(P+S*S);if(!(1<=S)){var S=2*S*S*S-3*S*S+1,W=4*(d+T+(e+R)*a),H=H+S*n[W+3],t=t+S;!c&&255>n[W+3]&&(S=S*n[W+3]/255);w+=S*n[W];m+=S*n[W+1];Q+=S*n[W+2];x+=
S}}k[f]=w/x;k[f+1]=m/x;k[f+2]=Q/x;k[f+3]=H/t}return b};var c=null,b=!0,a={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},l="jpg",n={png:100,jpg:98,jpeg:98},p={top:0,right:0,bottom:0,left:0}})},"esri/geometry/support/ValueMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/accessorSupport/decorators ./MeshColor".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=
b.call(this)||this;a.type="value";a.value=null;return a}k(a,b);c=a;a.prototype.clone=function(){return new c({value:d.clone(this.value)})};var c;e([h.property()],a.prototype,"type",void 0);e([h.property({type:g})],a.prototype,"value",void 0);return a=c=e([h.subclass("esri.geometry.support.ValueMeshColor")],a)}(h.declared(c.default))})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h,c){function b(a,b,c,d){var e=b.loggerTag;b=b.stride;return 0!==a.length%b?(d.error(e,"Invalid array length, expected a multiple of "+b),new c([])):a}function a(a,c,d,e,l){if(!a)return a;if(a instanceof c)return b(a,e,c,l);for(var h=0;h<d.length;h++)if(a instanceof d[h])return b(new c(a),e,c,l);if(Array.isArray(a))return b(new c(a),e,c,l);d=d.map(function(a){return"'"+a.name+"'"});l.error("Failed to set property, expected one of "+d+", but got "+a.constructor.name);return new c([])}
function l(a,b,c){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];b[c]=d}Object.defineProperty(f,"__esModule",{value:!0});var n=h.getLogger("esri.geometry.support.MeshVertexAttributes");m=function(b){function h(a){a=b.call(this)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;return a}k(h,b);g=h;h.prototype.castColor=function(b){return a(b,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},n)};h.prototype.castPosition=function(b){b&&b instanceof Float32Array&&
n.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return a(b,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},n)};h.prototype.castUv=function(b){return a(b,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},n)};h.prototype.castNormal=function(b){return a(b,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},n)};h.prototype.clone=function(){return new g({position:d.clone(this.position),
uv:d.clone(this.uv),normal:d.clone(this.normal)})};var g;e([c.property({json:{write:l}})],h.prototype,"color",void 0);e([c.cast("color")],h.prototype,"castColor",null);e([c.property({nonNullable:!0,json:{write:l}})],h.prototype,"position",void 0);e([c.cast("position")],h.prototype,"castPosition",null);e([c.property({json:{write:l}})],h.prototype,"uv",void 0);e([c.cast("uv")],h.prototype,"castUv",null);e([c.property({json:{write:l}})],h.prototype,"normal",void 0);e([c.cast("normal")],h.prototype,"castNormal",
null);return h=g=e([c.subclass("esri.geometry.support.MeshVertexAttributes")],h)}(c.declared(g));f.MeshVertexAttributes=m;f.castArray=a;f.default=m})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut","./coordsUtils"],function(m,f,k,e){function g(c,b,a){if(1===c.length)return c[0];b=new Float64Array(b);a=new Uint32Array(a);for(var d=0,e=0,h=0;h<c.length;h++){for(var g=c[h],k=0;k<g.position.length;k++)b[d++]=g.position[k];for(k=0;k<g.faces.length;k++)a[e++]=
g.faces[k]}return{position:b,faces:a}}function d(c,b){for(var a=c.length,d=Array(a),g=Array(a),p=Array(a),k=0,r=0,f=0,w=0,u=0;u<a;++u)w+=c[u].length;for(var w=new Float64Array(3*w),x=0,v=a-1;0<=v;v--){var z=c[v];if(e.isClockwise(z,!1,!1)||1===a){for(var y=z.length,u=0;u<k;++u)y+=d[u].length;u={index:x,pathLengths:Array(k+1),count:y,holeIndices:Array(k)};u.pathLengths[0]=z.length;0<z.length&&(p[f++]={index:x,count:z.length});x=h(z,0,w,x,z.length,b);for(z=0;z<k;++z)y=d[z],u.holeIndices[z]=x,u.pathLengths[z+
1]=y.length,0<y.length&&(p[f++]={index:x,count:y.length}),x=h(y,0,w,x,y.length,b);k=0;0<u.count&&(g[r++]=u)}else d[k++]=z}for(z=0;z<k;++z)y=d[z],0<y.length&&(p[f++]={index:x,count:y.length}),x=h(y,0,w,x,y.length,b);r<a&&(g.length=r);f<a&&(p.length=f);return{position:w,polygons:g,outlines:p}}function h(c,b,a,d,e,h){d*=3;for(var l=0;l<e;++l){var g=c[b++];a[d++]=g[0];a[d++]=g[1];a[d++]=h?g[2]:0}return d/3}Object.defineProperty(f,"__esModule",{value:!0});f.triangulate=function(c){var b=d(c.rings,c.hasZ),
a=[],e=0,h=0;c=function(c){var d=c.index,l=new Float64Array(b.position.buffer,3*d*b.position.BYTES_PER_ELEMENT,3*c.count);c=c.holeIndices.map(function(a){return a-d});c=new Uint32Array(k(l,c,3));a.push({position:l,faces:c});e+=l.length;h+=c.length};for(var p=0,q=b.polygons;p<q.length;p++)c(q[p]);return g(a,e,h)};f.pathsToTriangulationInfo=d})},"esri/core/libs/earcut/earcut":function(){define([],function(){function m(a,c,l){l=l||2;v=a.length/l+(c?2*c.length:0);z=!1;var g=c&&c.length,n=g?c[0]*l:a.length,
p=f(a,0,n,l,!0),q=[];if(!p)return q;var y,u,x,t;if(g)a:{var w=l,g=[],m,A,B;t=0;for(m=c.length;t<m;t++)A=c[t]*w,B=t<m-1?c[t+1]*w:a.length,A=f(a,A,B,w,!1),A===A.next&&(A.steiner=!0),g.push(b(A));g.sort(d);for(t=0;t<g.length;t++){if(!p){p=null;break a}c=g[t];w=p;if(w=h(c,w))c=r(w,c),k(c,c.next);p=k(p,p.next)}}if(z)return q;if(a.length>80*l){y=x=a[0];u=g=a[1];for(w=l;w<n;w+=l)t=a[w],c=a[w+1],t<y&&(y=t),c<u&&(u=c),t>x&&(x=t),c>g&&(g=c);x=Math.max(x-y,g-u)}e(p,q,l,y,u,x);return q}function f(a,b,c,d,e){var l;
if(e===0<x(a,b,c,d))for(e=b;e<c;e+=d)l=t(e,a[e],a[e+1],l);else for(e=c-d;e>=b;e-=d)l=t(e,a[e],a[e+1],l);l&&n(l,l.next)&&(w(l),l=l.next);return l}function k(a,b){if(!a)return a;b||(b=a);var c,d=0,e=v*v/2;do{c=!1;if(a.steiner||!n(a,a.next)&&0!==l(a.prev,a,a.next))a=a.next;else{w(a);a=b=a.prev;if(a===a.next)return null;c=!0}if(d++>e)return z=!0,null}while(c||a!==b);return b}function e(b,d,h,v,u,f,x){if(b){if(!x&&f){var y=b,t=y;do null===t.z&&(t.z=c(t.x,t.y,v,u,f)),t.prevZ=t.prev,t=t.nextZ=t.next;while(t!==
y);t.prevZ.nextZ=null;t.prevZ=null;var y=t,m,A,C,B,E,D,F=1;do{t=y;C=y=null;for(B=0;t;){B++;A=t;for(m=E=0;m<F&&(E++,A=A.nextZ,A);m++);for(D=F;0<E||0<D&&A;)0===E?(m=A,A=A.nextZ,D--):0!==D&&A?t.z<=A.z?(m=t,t=t.nextZ,E--):(m=A,A=A.nextZ,D--):(m=t,t=t.nextZ,E--),C?C.nextZ=m:y=m,m.prevZ=C,C=m;t=A}C.nextZ=null;F*=2}while(1<B)}for(y=b;b.prev!==b.next;){t=b.prev;A=b.next;if(f)a:{C=b;D=v;var R=u,P=f;B=C.prev;E=C;F=C.next;if(0<=l(B,E,F))C=!1;else{var L=B.x>E.x?B.x>F.x?B.x:F.x:E.x>F.x?E.x:F.x,T=B.y>E.y?B.y>F.y?
B.y:F.y:E.y>F.y?E.y:F.y;m=c(B.x<E.x?B.x<F.x?B.x:F.x:E.x<F.x?E.x:F.x,B.y<E.y?B.y<F.y?B.y:F.y:E.y<F.y?E.y:F.y,D,R,P);D=c(L,T,D,R,P);for(R=C.nextZ;R&&R.z<=D;){if(R!==C.prev&&R!==C.next&&a(B.x,B.y,E.x,E.y,F.x,F.y,R.x,R.y)&&0<=l(R.prev,R,R.next)){C=!1;break a}R=R.nextZ}for(R=C.prevZ;R&&R.z>=m;){if(R!==C.prev&&R!==C.next&&a(B.x,B.y,E.x,E.y,F.x,F.y,R.x,R.y)&&0<=l(R.prev,R,R.next)){C=!1;break a}R=R.prevZ}C=!0}}else C=g(b);if(C)d.push(t.i/h),d.push(b.i/h),d.push(A.i/h),w(b),y=b=A.next;else{if(z)break;b=A;
if(b===y){if(!x)e(k(b),d,h,v,u,f,1);else if(1===x){x=d;y=h;t=b;do A=t.prev,C=t.next.next,!n(A,C)&&p(A,t,t.next,C)&&q(A,C)&&q(C,A)&&(x.push(A.i/y),x.push(t.i/y),x.push(C.i/y),w(t),w(t.next),t=b=C),t=t.next;while(t!==b);b=t;e(b,d,h,v,u,f,2)}else if(2===x)a:{x=b;do{for(y=x.next.next;y!==x.prev;){if(t=x.i!==y.i){t=x;A=y;C=void 0;if(C=t.next.i!==A.i&&t.prev.i!==A.i){C=void 0;b:{C=t;do{if(C.i!==t.i&&C.next.i!==t.i&&C.i!==A.i&&C.next.i!==A.i&&p(C,C.next,t,A)){C=!0;break b}C=C.next}while(C!==t);C=!1}C=!C}B=
void 0;if(B=C&&q(t,A)&&q(A,t)){C=t;B=!1;E=(t.x+A.x)/2;A=(t.y+A.y)/2;do C.y>A!==C.next.y>A&&E<(C.next.x-C.x)*(A-C.y)/(C.next.y-C.y)+C.x&&(B=!B),C=C.next;while(C!==t)}t=B}if(t){b=r(x,y);x=k(x,x.next);b=k(b,b.next);e(x,d,h,v,u,f);e(b,d,h,v,u,f);break a}y=y.next}x=x.next}while(x!==b)}break}}}}}function g(b){var c=b.prev,d=b.next;if(0<=l(c,b,d))return!1;for(var e=b.next.next,h=0;e!==b.prev;){if(a(c.x,c.y,b.x,b.y,d.x,d.y,e.x,e.y)&&0<=l(e.prev,e,e.next))return!1;e=e.next;if(h++>v)return z=!0,!1}return!0}
function d(a,b){return a.x-b.x}function h(b,c){var d=c,e=b.x,l=b.y,h=-Infinity,g;do{if(!d)return null;if(l<=d.y&&l>=d.next.y){var n=d.x+(l-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(n<=e&&n>h){h=n;if(n===e){if(l===d.y)return d;if(l===d.next.y)return d.next}g=d.x<d.next.x?d:d.next}}d=d.next}while(d!==c);if(!g)return null;if(e===h)return g.prev;c=g;for(var n=g.x,v=g.y,p=Infinity,k,d=g.next;d!==c;)e>=d.x&&d.x>=n&&a(l<v?e:h,l,n,v,l<v?h:e,l,d.x,d.y)&&(k=Math.abs(l-d.y)/(e-d.x),(k<p||k===p&&d.x>g.x)&&q(d,b)&&
(g=d,p=k)),d=d.next;return g}function c(a,b,c,d,e){a=32767*(a-c)/e;b=32767*(b-d)/e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function b(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function a(a,b,c,d,e,l,h,g){return 0<=(e-h)*(b-g)-(a-h)*(l-g)&&0<=(a-h)*(d-g)-(c-h)*(b-g)&&0<=(c-h)*(l-g)-(e-h)*(d-g)}function l(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*
(c.y-b.y)}function n(a,b){return a.x===b.x&&a.y===b.y}function p(a,b,c,d){return n(a,b)&&n(c,d)||n(a,d)&&n(c,b)?!0:0<l(a,b,c)!==0<l(a,b,d)&&0<l(c,d,a)!==0<l(c,d,b)}function q(a,b){return 0>l(a.prev,a,a.next)?0<=l(a,b,a.next)&&0<=l(a,a.prev,b):0>l(a,b,a.prev)||0>l(a,a.next,b)}function r(a,b){var c=new u(a.i,a.x,a.y),d=new u(b.i,b.x,b.y),e=a.next,l=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;l.next=d;d.prev=l;return d}function t(a,b,c,d){a=new u(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=
a,d.next=a):(a.prev=a,a.next=a);return a}function w(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function u(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function x(a,b,c,d){for(var e=0,l=c-d;b<c;b+=d)e+=(a[l]-a[b])*(a[b+1]+a[l+1]),l=b;return e}var v,z;m.deviation=function(a,b,c,d){var e=b&&b.length,l=Math.abs(x(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,h=b.length;e<h;e++)l-=Math.abs(x(a,
b[e]*c,e<h-1?b[e+1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var h=d[e]*c,g=d[e+1]*c,n=d[e+2]*c;b+=Math.abs((a[h]-a[n])*(a[g+1]-a[h+1])-(a[h]-a[g])*(a[n+1]-a[h+1]))}return 0===l&&0===b?0:Math.abs((b-l)/l)};m.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var l=0;l<a[e].length;l++)for(var h=0;h<b;h++)c.vertices.push(a[e][l][h]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c};return m})},"esri/geometry/support/coordsUtils":function(){define(["require",
"exports"],function(m,f){function k(e,d){var h=d[0]-e[0],c=d[1]-e[1];return 2<e.length&&2<d.length?(e=e[2]-d[2],Math.sqrt(h*h+c*c+e*e)):Math.sqrt(h*h+c*c)}function e(e,d,h){var c=e[0]+h*(d[0]-e[0]),b=e[1]+h*(d[1]-e[1]);return 2<e.length&&2<d.length?[c,b,e[2]+h*(d[2]-e[2])]:[c,b]}Object.defineProperty(f,"__esModule",{value:!0});f.geometryToCoordinates=function(e){if(!e)return null;if(Array.isArray(e))return e;var d=e.hasZ,h=e.hasM;if("point"===e.type)return h&&d?[e.x,e.y,e.z,e.m]:d?[e.x,e.y,e.z]:h?
[e.x,e.y,e.m]:[e.x,e.y];if("polygon"===e.type)return e.rings.slice(0);if("polyline"===e.type)return e.paths.slice(0);if("multipoint"===e.type)return e.points.slice(0);if("extent"===e.type){e=e.clone().normalize();if(!e)return null;var c=!1,b=!1;e.forEach(function(a){a.hasZ&&(c=!0);a.hasM&&(b=!0)});return e.map(function(a){var d=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(c&&a.hasZ)for(var e=.5*(a.zmax-a.zmin),h=0;h<d.length;h++)d[h].push(e);if(b&&a.hasM)for(a=
.5*(a.mmax-a.mmin),h=0;h<d.length;h++)d[h].push(a);return d})}return null};f.getLength=k;f.getMidpoint=function(g,d){return e(g,d,.5)};f.getPathLength=function(e){for(var d=e.length,h=0,c=0;c<d-1;++c)h+=k(e[c],e[c+1]);return h};f.getPointOnPath=function(g,d){if(0>=d)return g[0];for(var h=g.length,c=0,b=0;b<h-1;++b){var a=k(g[b],g[b+1]);if(d-c<a)return e(g[b],g[b+1],(d-c)/a);c+=a}return g[h-1]};f.isClockwise=function(e,d,h){for(var c=e.length,b=0,a=0,l=0,g=0;g<c;g++){var p=e[g],k=e[(g+1)%c],r=2,b=
b+(p[0]*k[1]-k[0]*p[1]);2<p.length&&2<k.length&&h&&(a+=p[0]*k[2]-k[0]*p[2],r=3);p.length>r&&k.length>r&&d&&(l+=p[0]*k[r]-k[0]*p[r])}return 0>=b&&0>=a&&0>=l}})},"esri/geometry/support/meshUtils/centerAt":function(){define("require exports ../../../core/Logger ./projection ../../../views/3d/lib/gl-matrix ../../../views/3d/support/projectionUtils".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});var h=k.getLogger("esri.geometry.support.meshUtils.centerAt");f.centerAt=
function(n,p,k){if(n.vertexAttributes&&n.vertexAttributes.position){var q=n.spatialReference,f=k&&k.origin||n.extent.center;if(q.isWGS84||q.isWebMercator&&(!k||!1!==k.geographic)){k=n.spatialReference;var q=b,w=c;if(d.pointToVector(p,w,d.SphericalECEFSpatialReference)){d.pointToVector(f,q,d.SphericalECEFSpatialReference)||d.pointToVector(n.extent.center,q,d.SphericalECEFSpatialReference);f=n.vertexAttributes.position;p=n.vertexAttributes.normal;var u=new Float64Array(f.length),x=new Float32Array(p?
p.length:0);e.projectToECEF(f,k,u);p&&e.projectNormalToECEF(p,f,u,k,x);d.computeLinearTransformation(d.SphericalECEFSpatialReference,q,a,d.SphericalECEFSpatialReference);d.computeLinearTransformation(d.SphericalECEFSpatialReference,w,l,d.SphericalECEFSpatialReference);g.mat4d.inverse(a);g.mat4d.multiply(l,a,l);e.transformBufferInPlace(u,l);g.mat4d.inverse(l);g.mat4d.transpose(l);p&&e.transformBufferInPlace(x,l,!0);e.projectFromECEF(u,f,k);p&&e.projectNormalFromECEF(x,f,u,k,p);n.clearCache()}else h.error("Failed to project centerAt location (wkid:"+
p.spatialReference.wkid+") to ECEF")}else if(k=b,q=c,d.pointToVector(p,q,n.spatialReference)){d.pointToVector(f,k,n.spatialReference)||(p=n.extent.center,k[0]=p.x,k[1]=p.y,k[2]=p.z,h.error("Failed to project specified origin (wkid:"+f.spatialReference.wkid+") to mesh spatial reference (wkid:"+n.spatialReference.wkid+"). Using mesh extent.center instead"));if(f=n.vertexAttributes.position)for(p=0;p<f.length;p+=3)for(w=0;3>w;w++)f[p+w]+=q[w]-k[w];n.clearCache()}else h.error("Failed to project centerAt location (wkid:"+
p.spatialReference.wkid+") to mesh spatial reference (wkid:"+n.spatialReference.wkid+")")}};var c=g.vec3d.create(),b=g.vec3d.create(),a=g.mat4d.create(),l=g.mat4d.create()})},"esri/geometry/support/meshUtils/projection":function(){define(["require","exports","../../../core/Logger","../../../views/3d/lib/gl-matrix","../../../views/3d/support/projectionUtils"],function(m,f,k,e,g){function d(d,h,k,r,f,w){if(h){f=f.isWGS84;for(var n=0;n<h.length;n+=3){for(var p=0;3>p;p++)c[p]=r[n+p],b[p]=h[n+p];g.computeLinearTransformation(g.SphericalECEFSpatialReference,
c,a,g.SphericalECEFSpatialReference);e.mat4d.toMat3(a,l);f?e.mat3d.multiplyVec3(l,b):(p=g.webMercator.y2lat(k[n+1]),p=Math.cos(p),0===d&&(p=1/p),l[0]*=p,l[1]*=p,l[2]*=p,l[3]*=p,l[4]*=p,l[5]*=p,1===d&&e.mat3d.transpose(l),e.mat3d.multiplyVec3(l,b),e.vec3d.normalize(b));for(p=0;3>p;p++)w[n+p]=b[p]}return w}}Object.defineProperty(f,"__esModule",{value:!0});var h=k.getLogger("esri.geometry.support.meshUtils.normalProjection");f.projectNormalToECEF=function(a,b,c,e,l){return e.isWebMercator||e.isWGS84?
d(0,a,b,c,e,l):(h.error("Cannot convert PCS spatial reference buffer to ECEF"),l)};f.projectNormalFromECEF=function(a,b,c,e,l){return e.isWebMercator||e.isWGS84?d(1,a,b,c,e,l):(h.error("Cannot convert to PCS spatial reference buffer from ECEF"),l)};f.projectToECEF=function(a,b,c){g.bufferToBuffer(a,b,0,c,g.SphericalECEFSpatialReference,0,a.length/3);return c};f.projectFromECEF=function(a,b,c){g.bufferToBuffer(a,g.SphericalECEFSpatialReference,0,b,c,0,a.length/3);return b};f.transformBufferInPlace=
function(a,b,d){void 0===d&&(d=!1);if(a)for(var l=0;l<a.length;l+=3){for(var h=0;3>h;h++)c[h]=a[l+h];e.mat4d.multiplyVec3(b,c);d&&e.vec3d.normalize(c);for(h=0;3>h;h++)a[l+h]=c[h]}};var c=e.vec3d.create(),b=e.vec3d.create(),a=e.mat4d.create(),l=e.mat3d.create()})},"esri/views/3d/lib/gl-matrix":function(){define([],function(){var m={};(function(f,k){k(f,!0);k(f,!1)})(m,function(f,k){var e={};(function(){if("undefined"!=typeof Float32Array){var a=new Float32Array(1),b=new Int32Array(a.buffer);e.invsqrt=
function(c){a[0]=c;b[0]=1597463007-(b[0]>>1);var d=a[0];return d*(1.5-.5*c*d*d)}}else e.invsqrt=function(a){return 1/Math.sqrt(a)}})();var g=Array;"undefined"!=typeof Float32Array&&(g=k?Float32Array:Array);var d={create:function(a){var b=new g(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},createFrom:function(a,b,c){var d=new g(3);d[0]=a;d[1]=b;d[2]=c;return d},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},set3:function(a,b,c,d){d[0]=a;d[1]=b;d[2]=c;return d},equal:function(a,
b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])},max:function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c},min:function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],
a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1];a=a[2];var e=Math.sqrt(c*c+d*d+a*a);if(!e)return b[0]=0,b[1]=
0,b[2]=0,b;if(1===e)return b[0]=c,b[1]=d,b[2]=a,b;e=1/e;b[0]=c*e;b[1]=d*e;b[2]=a*e;return b},cross:function(a,b,c){c||(c=a);var d=a[0],e=a[1];a=a[2];var l=b[0],h=b[1];b=b[2];c[0]=e*b-a*h;c[1]=a*l-d*b;c[2]=d*h-e*l;return c},length:function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},length2:function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];b=Math.sqrt(d*
d+e*e+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)},dist2:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}},h=null,c=new g(4);d.unproject=function(a,b,d,e,l){l||(l=a);h||(h=t.create());var g=h;c[0]=2*(a[0]-e[0])/e[2]-1;c[1]=2*(a[1]-e[1])/
e[3]-1;c[2]=2*a[2]-1;c[3]=1;t.multiply(d,b,g);if(!t.inverse(g))return null;t.multiplyVec4(g,c);if(0===c[3])return null;l[0]=c[0]/c[3];l[1]=c[1]/c[3];l[2]=c[2]/c[3];return l};var b=d.createFrom(1,0,0),a=d.createFrom(0,1,0),l=d.createFrom(0,0,1),n=d.create();d.rotationTo=function(c,e,h){h||(h=w.create());var g=d.dot(c,e);if(1<=g)w.set(u,h);else if(-.999999>g)d.cross(b,c,n),1E-6>d.length(n)&&d.cross(a,c,n),1E-6>d.length(n)&&d.cross(l,c,n),d.normalize(n),w.fromAngleAxis(Math.PI,n,h);else{var g=Math.sqrt(2*
(1+g)),v=1/g;d.cross(c,e,n);h[0]=n[0]*v;h[1]=n[1]*v;h[2]=n[2]*v;h[3]=.5*g;w.normalize(h)}1<h[3]?h[3]=1:-1>h[3]&&(h[3]=-1);return h};var p=d.create(),q=d.create();d.project=function(a,b,c,e){e||(e=a);d.direction(b,c,p);d.subtract(a,b,q);a=d.dot(p,q);d.scale(p,a,e);d.add(e,b,e)};d.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var r={create:function(a){var b=new g(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=
b[6]=b[7]=b[8]=0;return b},createFrom:function(a,b,c,d,e,l,h,n,p){var v=new g(9);v[0]=a;v[1]=b;v[2]=c;v[3]=d;v[4]=e;v[5]=l;v[6]=h;v[7]=n;v[8]=p;return v},add:function(a,b,c){c||(c=a);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];c[4]=a[4]+b[4];c[5]=a[5]+b[5];c[6]=a[6]+b[6];c[7]=a[7]+b[7];c[8]=a[8]+b[8];return c},subtract:function(a,b,c){c||(c=a);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];c[4]=a[4]-b[4];c[5]=a[5]-b[5];c[6]=a[6]-b[6];c[7]=a[7]-b[7];c[8]=a[8]-b[8];return c},
determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],l=a[7],h=a[8];return a[0]*(h*c-d*l)+a[1]*(-h*b+d*e)+a[2]*(l*b-c*e)},inverse:function(a,b){var c=a[0],d=a[1],e=a[2],l=a[3],h=a[4],g=a[5],n=a[6],v=a[7];a=a[8];var p=a*h-g*v,k=-a*l+g*n,q=v*l-h*n,z=c*p+d*k+e*q;if(!z)return null;z=1/z;b||(b=r.create());b[0]=p*z;b[1]=(-a*d+e*v)*z;b[2]=(g*d-e*h)*z;b[3]=k*z;b[4]=(a*c-e*n)*z;b[5]=(-g*c+e*l)*z;b[6]=q*z;b[7]=(-v*c+d*n)*z;b[8]=(h*c-d*l)*z;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],l=a[2],
h=a[3],g=a[4],n=a[5],v=a[6],p=a[7];a=a[8];var k=b[0],q=b[1],z=b[2],u=b[3],r=b[4],f=b[5],y=b[6],x=b[7];b=b[8];c[0]=k*d+q*h+z*v;c[1]=k*e+q*g+z*p;c[2]=k*l+q*n+z*a;c[3]=u*d+r*h+f*v;c[4]=u*e+r*g+f*p;c[5]=u*l+r*n+f*a;c[6]=y*d+x*h+b*v;c[7]=y*e+x*g+b*p;c[8]=y*l+x*n+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[3]+a[6];c[1]=d*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=d*a[0]+e*a[3]+b*a[6];c[1]=d*a[1]+e*a[4]+b*a[7];
c[2]=d*a[2]+e*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])&&1E-6>Math.abs(a[4]-b[4])&&1E-6>Math.abs(a[5]-b[5])&&1E-6>Math.abs(a[6]-b[6])&&1E-6>Math.abs(a[7]-b[7])&&1E-6>Math.abs(a[8]-b[8])},identity:function(a){a||(a=r.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=
0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],d=a[5];a[1]=a[3];a[2]=a[6];a[3]=b;a[5]=a[7];a[6]=c;a[7]=d;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=t.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+
", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},t={create:function(a){var b=new g(16);4===arguments.length?(b[0]=arguments[0],b[1]=arguments[1],b[2]=arguments[2],b[3]=arguments[3],b[4]=arguments[4],b[5]=arguments[5],b[6]=arguments[6],b[7]=arguments[7],b[8]=arguments[8],b[9]=arguments[9],b[10]=arguments[10],b[11]=arguments[11],b[12]=arguments[12],b[13]=arguments[13],b[14]=arguments[14],b[15]=arguments[15]):a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},createFrom:function(a,b,c,d,e,l,h,n,p,k,q,u,r,f,x,t){var v=new g(16);v[0]=a;v[1]=b;v[2]=c;v[3]=d;v[4]=e;v[5]=l;v[6]=h;v[7]=n;v[8]=p;v[9]=k;v[10]=q;v[11]=u;v[12]=r;v[13]=f;v[14]=x;v[15]=t;return v},createFromMatrixRowMajor:function(a){var b=new g(16);b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=a[11];b[3]=a[12];b[7]=
a[13];b[11]=a[14];b[15]=a[15];return b},createFromMatrix:function(a){var b=new g(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},setRowMajor:function(a,b){b[0]=a[0];
b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])&&1E-6>Math.abs(a[4]-b[4])&&1E-6>Math.abs(a[5]-b[5])&&1E-6>Math.abs(a[6]-b[6])&&1E-6>Math.abs(a[7]-b[7])&&1E-6>Math.abs(a[8]-b[8])&&1E-6>Math.abs(a[9]-b[9])&&1E-6>Math.abs(a[10]-b[10])&&1E-6>Math.abs(a[11]-
b[11])&&1E-6>Math.abs(a[12]-b[12])&&1E-6>Math.abs(a[13]-b[13])&&1E-6>Math.abs(a[14]-b[14])&&1E-6>Math.abs(a[15]-b[15])},identity:function(a){a||(a=t.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],d=a[3],e=a[6],l=a[7],h=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=e;a[11]=a[14];a[12]=d;a[13]=l;a[14]=h;return a}b[0]=a[0];b[1]=
a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],l=a[4],h=a[5],g=a[6],n=a[7],p=a[8],k=a[9],v=a[10],q=a[11],u=a[12],r=a[13],f=a[14];a=a[15];return u*k*g*e-p*r*g*e-u*h*v*e+l*r*v*e+p*h*f*e-l*k*f*e-u*k*d*n+p*r*d*n+u*c*v*n-b*r*v*n-p*c*f*n+b*k*f*n+u*h*d*q-l*r*d*q-u*c*g*q+b*r*g*q+l*c*f*q-b*h*f*q-p*h*d*a+l*k*d*a+p*c*g*a-b*k*g*a-l*c*v*
a+b*h*v*a},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],l=a[3],h=a[4],g=a[5],n=a[6],p=a[7],k=a[8],v=a[9],q=a[10],u=a[11],r=a[12],f=a[13],z=a[14];a=a[15];var x=c*g-d*h,t=c*n-e*h,w=c*p-l*h,m=d*n-e*g,T=d*p-l*g,S=e*p-l*n,W=k*f-v*r,Y=k*z-q*r,X=k*a-u*r,aa=v*z-q*f,U=v*a-u*f,ha=q*a-u*z,Z=x*ha-t*U+w*aa+m*X-T*Y+S*W;if(!Z)return null;Z=1/Z;b[0]=(g*ha-n*U+p*aa)*Z;b[1]=(-d*ha+e*U-l*aa)*Z;b[2]=(f*S-z*T+a*m)*Z;b[3]=(-v*S+q*T-u*m)*Z;b[4]=(-h*ha+n*X-p*Y)*Z;b[5]=(c*ha-e*X+l*Y)*Z;b[6]=(-r*S+z*w-a*t)*Z;b[7]=
(k*S-q*w+u*t)*Z;b[8]=(h*U-g*X+p*W)*Z;b[9]=(-c*U+d*X-l*W)*Z;b[10]=(r*T-f*w+a*x)*Z;b[11]=(-k*T+v*w-u*x)*Z;b[12]=(-h*aa+g*Y-n*W)*Z;b[13]=(c*aa-d*Y+e*W)*Z;b[14]=(-r*m+f*t-z*x)*Z;b[15]=(k*m-v*t+q*x)*Z;return b},toRotationMat:function(a,b){b||(b=t.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=r.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=
a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],d=a[1],e=a[2],l=a[4],h=a[5],g=a[6],n=a[8],p=a[9];a=a[10];var k=a*h-g*p,v=-a*l+g*n,q=p*l-h*n,u=c*k+d*v+e*q;if(!u)return null;u=1/u;b||(b=r.create());b[0]=k*u;b[1]=(-a*d+e*p)*u;b[2]=(g*d-e*h)*u;b[3]=v*u;b[4]=(a*c-e*n)*u;b[5]=(-g*c+e*l)*u;b[6]=q*u;b[7]=(-p*c+d*n)*u;b[8]=(h*c-d*l)*u;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],l=a[2],h=a[3],g=a[4],n=a[5],p=a[6],k=a[7],v=a[8],q=a[9],u=a[10],
r=a[11],f=a[12],z=a[13],y=a[14];a=a[15];var x=b[0],t=b[1],w=b[2],m=b[3];c[0]=x*d+t*g+w*v+m*f;c[1]=x*e+t*n+w*q+m*z;c[2]=x*l+t*p+w*u+m*y;c[3]=x*h+t*k+w*r+m*a;x=b[4];t=b[5];w=b[6];m=b[7];c[4]=x*d+t*g+w*v+m*f;c[5]=x*e+t*n+w*q+m*z;c[6]=x*l+t*p+w*u+m*y;c[7]=x*h+t*k+w*r+m*a;x=b[8];t=b[9];w=b[10];m=b[11];c[8]=x*d+t*g+w*v+m*f;c[9]=x*e+t*n+w*q+m*z;c[10]=x*l+t*p+w*u+m*y;c[11]=x*h+t*k+w*r+m*a;x=b[12];t=b[13];w=b[14];m=b[15];c[12]=x*d+t*g+w*v+m*f;c[13]=x*e+t*n+w*q+m*z;c[14]=x*l+t*p+w*u+m*y;c[15]=x*h+t*k+w*r+m*
a;return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],e=b[1];b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var d=b[0],e=b[1],l=b[2];b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*l+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*l+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*l+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*l+a[15]*b;return c},translate:function(a,b,c){var d=b[0],e=b[1];b=b[2];var l,h,g,n,p,k,q,v,u,r,f,z;if(!c||a===c)return a[12]=
a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;l=a[0];h=a[1];g=a[2];n=a[3];p=a[4];k=a[5];q=a[6];v=a[7];u=a[8];r=a[9];f=a[10];z=a[11];c[0]=l;c[1]=h;c[2]=g;c[3]=n;c[4]=p;c[5]=k;c[6]=q;c[7]=v;c[8]=u;c[9]=r;c[10]=f;c[11]=z;c[12]=l*d+p*e+u*b+a[12];c[13]=h*d+k*e+r*b+a[13];c[14]=g*d+q*e+f*b+a[14];c[15]=n*d+v*e+z*b+a[15];return c},scale:function(a,b,c){var d=b[0],e=b[1];b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=
d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,b,c,d){var e=c[0],l=c[1];c=c[2];var h=
Math.sqrt(e*e+l*l+c*c),g,n,p,k,q,v,u,r,f,z,y,x,t,w,m,A,W,Y,X,aa;if(!h)return null;1!==h&&(h=1/h,e*=h,l*=h,c*=h);g=Math.sin(b);n=Math.cos(b);p=1-n;b=a[0];h=a[1];k=a[2];q=a[3];v=a[4];u=a[5];r=a[6];f=a[7];z=a[8];y=a[9];x=a[10];t=a[11];w=e*e*p+n;m=l*e*p+c*g;A=c*e*p-l*g;W=e*l*p-c*g;Y=l*l*p+n;X=c*l*p+e*g;aa=e*c*p+l*g;e=l*c*p-e*g;l=c*c*p+n;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*w+v*m+z*A;d[1]=h*w+u*m+y*A;d[2]=k*w+r*m+x*A;d[3]=q*w+f*m+t*A;d[4]=b*W+v*Y+z*X;d[5]=h*W+u*Y+y*X;d[6]=
k*W+r*Y+x*X;d[7]=q*W+f*Y+t*X;d[8]=b*aa+v*e+z*l;d[9]=h*aa+u*e+y*l;d[10]=k*aa+r*e+x*l;d[11]=q*aa+f*e+t*l;return d},rotateX:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[4],l=a[5],h=a[6],g=a[7],n=a[8],p=a[9],k=a[10],q=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+n*d;c[5]=l*b+p*d;c[6]=h*b+k*d;c[7]=g*b+q*d;c[8]=e*-d+n*b;c[9]=l*-d+p*b;c[10]=h*-d+k*b;c[11]=g*-d+q*b;return c},rotateY:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);
var e=a[0],l=a[1],h=a[2],g=a[3],n=a[8],p=a[9],k=a[10],q=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+n*-d;c[1]=l*b+p*-d;c[2]=h*b+k*-d;c[3]=g*b+q*-d;c[8]=e*d+n*b;c[9]=l*d+p*b;c[10]=h*d+k*b;c[11]=g*d+q*b;return c},rotateZ:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var e=a[0],l=a[1],h=a[2],g=a[3],n=a[4],p=a[5],k=a[6],q=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):
c=a;c[0]=e*b+n*d;c[1]=l*b+p*d;c[2]=h*b+k*d;c[3]=g*b+q*d;c[4]=e*-d+n*b;c[5]=l*-d+p*b;c[6]=h*-d+k*b;c[7]=g*-d+q*b;return c},frustum:function(a,b,c,d,e,l,h){h||(h=t.create());var g=b-a,n=d-c,p=l-e;h[0]=2*e/g;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/n;h[6]=0;h[7]=0;h[8]=(b+a)/g;h[9]=(d+c)/n;h[10]=-(l+e)/p;h[11]=-1;h[12]=0;h[13]=0;h[14]=-(l*e*2)/p;h[15]=0;return h},perspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return t.frustum(-b,b,-a,a,c,d,e)},ortho:function(a,b,c,d,e,l,h){h||(h=t.create());
var g=b-a,n=d-c,p=l-e;h[0]=2/g;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2/n;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=-2/p;h[11]=0;h[12]=-(a+b)/g;h[13]=-(d+c)/n;h[14]=-(l+e)/p;h[15]=1;return h},lookAt:function(a,b,c,d){d||(d=t.create());var e,l,h,g,n,p,k,q,v=a[0],u=a[1];a=a[2];h=c[0];g=c[1];l=c[2];k=b[0];c=b[1];e=b[2];if(v===k&&u===c&&a===e)return t.identity(d);b=v-k;c=u-c;k=a-e;q=1/Math.sqrt(b*b+c*c+k*k);b*=q;c*=q;k*=q;e=g*k-l*c;l=l*b-h*k;h=h*c-g*b;(q=Math.sqrt(e*e+l*l+h*h))?(q=1/q,e*=q,l*=q,h*=q):h=l=e=0;g=c*h-
k*l;n=k*e-b*h;p=b*l-c*e;(q=Math.sqrt(g*g+n*n+p*p))?(q=1/q,g*=q,n*=q,p*=q):p=n=g=0;d[0]=e;d[1]=g;d[2]=b;d[3]=0;d[4]=l;d[5]=n;d[6]=c;d[7]=0;d[8]=h;d[9]=p;d[10]=k;d[11]=0;d[12]=-(e*v+l*u+h*a);d[13]=-(g*v+n*u+p*a);d[14]=-(b*v+c*u+k*a);d[15]=1;return d},fromRotationTranslation:function(a,b,c){c||(c=t.create());var d=a[0],e=a[1],l=a[2],h=a[3],g=d+d,n=e+e,p=l+l;a=d*g;var k=d*n,d=d*p,q=e*n,e=e*p,l=l*p,g=h*g,n=h*n,h=h*p;c[0]=1-(q+l);c[1]=k+h;c[2]=d-n;c[3]=0;c[4]=k-h;c[5]=1-(a+l);c[6]=e+g;c[7]=0;c[8]=d+n;c[9]=
e-g;c[10]=1-(a+q);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},w={create:function(a){var b=new g(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,d){var e=new g(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},identity:function(a){a||(a=w.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},u=w.identity();w.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};w.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+
a[3]*b[3]};w.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],l=a[3],c=(c=c*c+d*d+e*e+l*l)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};w.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};w.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};w.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2];a=a[3];var l=
Math.sqrt(c*c+d*d+e*e+a*a);if(0===l)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;l=1/l;b[0]=c*l;b[1]=d*l;b[2]=e*l;b[3]=a*l;return b};w.add=function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};w.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],l=a[2];a=a[3];var h=b[0],g=b[1],n=b[2];b=b[3];c[0]=d*b+a*h+e*n-l*g;c[1]=e*b+a*g+l*h-d*n;c[2]=l*b+a*n+d*g-e*h;c[3]=a*b-d*h-e*g-l*n;return c};w.multiplyVec3=function(a,
b,c){c||(c=b);var d=b[0],e=b[1],l=b[2];b=a[0];var h=a[1],g=a[2];a=a[3];var n=a*d+h*l-g*e,p=a*e+g*d-b*l,k=a*l+b*e-h*d,d=-b*d-h*e-g*l;c[0]=n*a+d*-b+p*-g-k*-h;c[1]=p*a+d*-h+k*-b-n*-g;c[2]=k*a+d*-g+n*-h-p*-b;return c};w.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};w.toMat3=function(a,b){b||(b=r.create());var c=a[0],d=a[1],e=a[2],l=a[3],h=c+c,g=d+d,n=e+e;a=c*h;var p=c*g,c=c*n,k=d*g,d=d*n,e=e*n,h=l*h,g=l*g,l=l*n;b[0]=
1-(k+e);b[1]=p+l;b[2]=c-g;b[3]=p-l;b[4]=1-(a+e);b[5]=d+h;b[6]=c+g;b[7]=d-h;b[8]=1-(a+k);return b};w.toMat4=function(a,b){b||(b=t.create());var c=a[0],d=a[1],e=a[2],l=a[3],h=c+c,g=d+d,n=e+e;a=c*h;var p=c*g,c=c*n,k=d*g,d=d*n,e=e*n,h=l*h,g=l*g,l=l*n;b[0]=1-(k+e);b[1]=p+l;b[2]=c-g;b[3]=0;b[4]=p-l;b[5]=1-(a+e);b[6]=d+h;b[7]=0;b[8]=c+g;b[9]=d-h;b[10]=1-(a+k);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};w.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],l,h;if(1<=Math.abs(e))return d!==
a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;l=Math.acos(e);h=Math.sqrt(1-e*e);if(.001>Math.abs(h))return d[0]=.5*a[0]+.5*b[0],d[1]=.5*a[1]+.5*b[1],d[2]=.5*a[2]+.5*b[2],d[3]=.5*a[3]+.5*b[3],d;e=Math.sin((1-c)*l)/h;c=Math.sin(c*l)/h;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};w.fromRotationMatrix=function(a,b){b||(b=w.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=.5*d,d=.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=
w.fromRotationMatrix.s_iNext=w.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var e=d[c],l=d[e];d=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*l+l]+1);b[c]=.5*d;d=.5/d;b[3]=(a[3*l+e]-a[3*e+l])*d;b[e]=(a[3*e+c]+a[3*c+e])*d;b[l]=(a[3*l+c]+a[3*c+l])*d}return b};r.toQuat4=w.fromRotationMatrix;(function(){var a=r.create();w.fromAxes=function(b,c,d,e){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=b[0];a[5]=b[1];a[8]=b[2];return w.fromRotationMatrix(a,e)}})();w.identity=
function(a){a||(a=w.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};w.fromAngleAxis=function(a,b,c){c||(c=w.create());a*=.5;var d=Math.sin(a);c[3]=Math.cos(a);c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};w.toAngleAxis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=e.invsqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};w.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var x={create:function(a){var b=new g(4);
a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,d){var e=new g(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},identity:function(a){a||(a=x.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b)return b=a[1],a[1]=a[2],
a[2]=b,a;b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2];a=a[3];var l=c*a-e*d;if(!l)return null;l=1/l;b[0]=a*l;b[1]=-d*l;b[2]=-e*l;b[3]=c*l;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],l=a[2];a=a[3];c[0]=d*b[0]+e*b[2];c[1]=d*b[1]+e*b[3];c[2]=l*b[0]+a*b[2];c[3]=l*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],e=a[1],l=a[2];a=a[3];var h=Math.sin(b);b=Math.cos(b);
c[0]=d*b+e*h;c[1]=d*-h+e*b;c[2]=l*b+a*h;c[3]=l*-h+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=a[1],e=a[2],l=a[3],h=b[0];b=b[1];c[0]=a[0]*h;c[1]=d*b;c[2]=e*h;c[3]=l*b;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};k=k?"":"d";f["glMath"+k]=e;f["vec2"+k]={create:function(a){var b=new g(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},createFrom:function(a,b){var c=
new g(2);c[0]=a;c[1]=b;return c},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},dist2:function(a,b){var c=b[0]-a[0];a=b[1]-
a[1];return c*c+a*a},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},set2:function(a,b,c){c[0]=a;c[1]=b;return c},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=
a[0];a=a[1];return Math.sqrt(b*b+a*a)},length2:function(a){var b=a[0];a=a[1];return b*b+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0];a=a[1]-b[1];b=d*d+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}};f["vec3"+k]=d;f["vec4"+k]={create:function(a){var b=new g(4);a?(b[0]=a[0],
b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},createFrom:function(a,b,c,d){var e=new g(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/
b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},set4:function(a,b,c,d,e){e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},
length:function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},length2:function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};f["mat2"+k]=x;f["mat3"+k]=r;f["mat4"+k]=t;f["quat4"+k]=w});return m})},
"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ./earthUtils ./mathUtils ../webgl-engine/lib/BufferVectorMath".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a,b,c,e){2===a.length?(D[0]=a[0],D[1]=a[1],D[2]=0,a=D):a===c&&(d.vec3d.set(a,D),a=D);return l(a,b,0,c,e,0,1)}function l(a,b,c,d,e,l,h){void 0===h&&(h=1);w!==b&&(u=n(b),w=b);x!==e&&(v=n(e),x=e);h=c+
3*h;if(u!==v||u===t.UNKNOWN&&!b.equals(e))if(u>t.UNKNOWN&&v>t.UNKNOWN)if(v!==t.WGS84)if(b=z[v],u!==t.WGS84)for(e=y[u];c<h;c+=3,l+=3)e(a,c,F,0),b(F,0,d,l);else for(;c<h;c+=3,l+=3)b(a,c,d,l);else for(e=y[u];c<h;c+=3,l+=3)e(a,c,d,l);else return!1;else if(d!==a||c!==l)for(;c<h;c++,l++)d[l]=a[c];return!0}function n(a){return a.wkt===f.SphericalECEFSpatialReference.wkt?t.SPHERICAL_ECEF:a.isWGS84?t.WGS84:a.isWebMercator?t.WEBMERC:a.wkt===f.WGS84ECEFSpatialReference.wkt?t.WGS84_ECEF:t.UNKNOWN}function p(a,
b,c,d){c[d++]=a[b++];c[d++]=a[b++];c[d]=a[b]}function q(a,b,d,e){var l=.4999999*Math.PI,l=c.clamp(A*a[b+1],-l,l),l=Math.sin(l);d[e++]=A*a[b]*C;d[e++]=C/2*Math.log((1+l)/(1-l));d[e]=a[b+2]}function r(a,b,c,d){var e=C+a[b+2],l=A*a[b+1];a=A*a[b];b=Math.cos(l);c[d++]=Math.cos(a)*b*e;c[d++]=Math.sin(a)*b*e;c[d]=Math.sin(l)*e}Object.defineProperty(f,"__esModule",{value:!0});f.SphericalECEFSpatialReference=new e({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
f.WGS84ECEFSpatialReference=new e({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});var t;(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.SPHERICAL_ECEF=1]="SPHERICAL_ECEF";
a[a.WGS84=2]="WGS84";a[a.WEBMERC=3]="WEBMERC";a[a.WGS84_ECEF=4]="WGS84_ECEF"})(t||(t={}));var w,u,x,v;f.vectorToVector=a;f.pointToVector=function(a,b,c){D[0]=a.x;D[1]=a.y;var d=a.z;D[2]=void 0!==d?d:0;return l(D,a.spatialReference,0,b,c,0,1)};f.vectorToPoint=function(a,b,c,d){"esri.geometry.SpatialReference"===c.declaredClass?(d=c,c=new k({spatialReference:d})):d=d||c.spatialReference;return l(a,b,0,D,d,0,1)?(c.x=D[0],c.y=D[1],c.z=D[2],c.spatialReference=d,c):null};f.xyzToVector=function(a,b,c,d,
e,h){D[0]=a;D[1]=b;D[2]=c;return l(D,d,0,e,h,0,1)};f.bufferToBuffer=l;f.computeLinearTransformation=function(a,b,c,e){var l=n(a),h=n(e);if(l===h&&h!==t.SPHERICAL_ECEF&&(l!==t.UNKNOWN||a.equals(e)))return d.mat4d.identity(c),d.mat4d.translate(c,b),!0;if(h===t.SPHERICAL_ECEF){if(a=y[l])return a(b,0,F,0),r(F,0,M,0),e=A*F[0],a=A*F[1],b=Math.sin(e),e=Math.cos(e),l=Math.sin(a),a=Math.cos(a),c[0]=-b,c[4]=-l*e,c[8]=a*e,c[12]=M[0],c[1]=e,c[5]=-l*b,c[9]=a*b,c[13]=M[1],c[2]=0,c[6]=a,c[10]=l,c[14]=M[2],c[3]=
0,c[7]=0,c[11]=0,c[15]=1,!0}else if(h===t.WEBMERC&&(l===t.WGS84||l===t.SPHERICAL_ECEF))return y[l](b,0,F,0),b=A*F[1],q(F,0,M,0),d.mat4d.identity(c),d.mat4d.translate(c,M),b=1/Math.cos(b),d.mat4d.scale(c,[b,b,1]),!0;return!1};f.transformDirection=function(b,c,e,l,h){d.vec3d.set(b,N);d.vec3d.add(b,c,I);a(N,e,N,h);a(I,e,I,h);d.vec3d.subtract(I,N,l);d.vec3d.normalize(l)};f.mbsToMbs=function(a,b,c,d){var e=n(b),l=n(d);if(e===l&&(e!==t.UNKNOWN||b.equals(d)))return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],
!0;if(l===t.SPHERICAL_ECEF){if(b=y[e])return b(a,0,F,0),r(F,0,c,0),c[3]=a[3],!0}else if(l===t.WEBMERC&&(e===t.WGS84||e===t.SPHERICAL_ECEF))return y[e](a,0,F,0),b=Math.abs(A*F[1])+Math.asin(a[3]/(C+a[2])),q(F,0,c,0),c[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3],!0;return!1};f.extentToBoundingBox=function(a,b,c){if(null==a)return!1;var d;D[0]=null!=a.xmin?a.xmin:0;D[1]=null!=a.ymin?a.ymin:0;D[2]=null!=a.zmin?a.zmin:0;d=l(D,a.spatialReference,0,b,c,0,1);D[0]=null!=a.xmax?a.xmax:0;D[1]=null!=
a.ymax?a.ymax:0;D[2]=null!=a.zmax?a.zmax:0;d=d&&l(D,a.spatialReference,0,b,c,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return d};f.extentToBoundingRect=function(a,b,c){if(null==a)return!1;var d;D[0]=null!=a.xmin?a.xmin:0;D[1]=null!=a.ymin?a.ymin:0;D[2]=null!=a.zmin?a.zmin:0;d=l(D,a.spatialReference,0,D,c,0,1);b[0]=D[0];b[1]=D[1];D[0]=null!=a.xmax?a.xmax:
0;D[1]=null!=a.ymax?a.ymax:0;D[2]=null!=a.zmax?a.zmax:0;d=d&&l(D,a.spatialReference,0,D,c,0,1);b[2]=D[0];b[3]=D[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return d};f.boundingRectToBoundingRect=function(a,b,c,d){if(null==a)return!1;if(b.equals(d))return g.set(c,a),!0;var e;D[0]=a[0];D[1]=a[1];D[2]=0;e=l(D,b,0,D,d,0,1);c[0]=D[0];c[1]=D[1];D[0]=a[2];D[1]=a[3];D[2]=0;e=e&&l(D,b,0,D,d,0,1);c[2]=D[0];c[3]=D[1];return e};
(function(a){a.x2lon=function(a){return a/C};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/C))};a.lon2x=function(a){return a*C};a.lat2y=function(a){a=Math.sin(a);return C/2*Math.log((1+a)/(1-a))}})(f.webMercator||(f.webMercator={}));var z=[void 0,r,p,q,function(a,b,c,d){var e=E,l=A*a[b],h=A*a[b+1];a=a[b+2];b=Math.sin(h);var h=Math.cos(h),g=e.a/Math.sqrt(1-e.e2*b*b);c[d++]=(g+a)*h*Math.cos(l);c[d++]=(g+a)*h*Math.sin(l);c[d++]=(g*(1-e.e2)+a)*b}],y=[void 0,function(a,d,e,l){var h=b.Vec3Compact.length(a,
d),g=c.asin(a[d+2]/h);a=(0<a[d+1]?1:-1)*c.acos(a[d]/(Math.cos(g)*h));e[l++]=B*a;e[l++]=B*g;e[l]=h-C},p,function(a,b,c,d){c[d++]=B*(a[b++]/C);c[d++]=B*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/C)));c[d]=a[b]},function(a,b,c,d){var e=E,l=a[b],h=a[b+1];a=a[b+2];var g,n,p,k,q,u;b=Math.abs(a);g=l*l+h*h;n=Math.sqrt(g);p=g+a*a;k=Math.sqrt(p);l=Math.atan2(h,l);q=a*a/p;p=g/p;h=e.a2/k;g=e.a3-e.a4/k;.3<p?(q=b/k*(1+p*(e.a1+h+q*g)/k),k=Math.asin(q),h=q*q,p=Math.sqrt(1-h)):(p=n/k*(1-q*(e.a5-h-p*g)/k),k=Math.acos(p),
h=1-p*p,q=Math.sqrt(h));u=1-e.e2*h;h=e.a/Math.sqrt(u);e=e.a6*h;h=n-h*p;g=b-e*q;b=p*h+q*g;n=p*g-q*h;e=n/(e/u+b);k+=e;0>a&&(k=-k);c[d++]=B*l;c[d++]=B*k;c[d]=b+n*e/2}],A=c.deg2rad(1),B=c.rad2deg(1),C=h.earthRadius,E={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},D=d.vec3d.create(),F=d.vec3d.create(),M=d.vec3d.create(),N=d.vec3d.create(),I=d.vec3d.create()})},"esri/geometry/support/aaBoundingRect":function(){define(["require",
"exports","../Extent"],function(m,f,k){function e(a){void 0===a&&(a=f.ZERO);return[a[0],a[1],a[2],a[3]]}function g(a){return a[0]>=a[2]?0:a[2]-a[0]}function d(a){return a[1]>=a[3]?0:a[3]-a[1]}function h(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a}function c(a){return 4===a.length}function b(a,b,c){return a<b?b:a>c?c:a}Object.defineProperty(f,"__esModule",{value:!0});f.create=e;f.clone=function(a){return[a[0],a[1],a[2],a[3]]};f.fromValues=function(a,b,c,d,h){void 0===h&&(h=e());h[0]=a;h[1]=
b;h[2]=c;h[3]=d;return h};f.fromExtent=function(a,b){void 0===b&&(b=e());b[0]=a.xmin;b[1]=a.ymin;b[2]=a.xmax;b[3]=a.ymax;return b};f.toExtent=function(a,b){return new k({xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:b})};f.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])};f.expand=function(a,b,d){void 0===d&&(d=a);if("length"in b)if(c(b))d[0]=Math.min(a[0],b[0]),d[1]=Math.min(a[1],b[1]),d[2]=Math.max(a[2],b[2]),
d[3]=Math.max(a[3],b[3]);else{if(2===b.length||3===b.length)d[0]=Math.min(a[0],b[0]),d[1]=Math.min(a[1],b[1]),d[2]=Math.max(a[2],b[0]),d[3]=Math.max(a[3],b[1])}else switch(b.type){case "extent":d[0]=Math.min(a[0],b.xmin);d[1]=Math.min(a[1],b.ymin);d[2]=Math.max(a[2],b.xmax);d[3]=Math.max(a[3],b.ymax);break;case "point":d[0]=Math.min(a[0],b.x),d[1]=Math.min(a[1],b.y),d[2]=Math.max(a[2],b.x),d[3]=Math.max(a[3],b.y)}return d};f.expandWithNestedArray=function(a,b,c){void 0===c&&(c=a);var d=b.length,e=
a[0],l=a[1],h=a[2];a=a[3];for(var g=0;g<d;g++){var n=b[g],e=Math.min(e,n[0]),l=Math.min(l,n[1]),h=Math.max(h,n[0]);a=Math.max(a,n[1])}c[0]=e;c[1]=l;c[2]=h;c[3]=a;return c};f.allFinite=function(a){for(var b=0;4>b;b++)if(!isFinite(a[b]))return!1;return!0};f.width=g;f.height=d;f.diameter=function(a){var b=g(a);a=d(a);return Math.sqrt(b*b+a*a)};f.area=function(a){return g(a)*d(a)};f.center=function(a,b){void 0===b&&(b=[0,0]);b[0]=a[0]+g(a)/2;b[1]=a[1]+d(a)/2;return b};f.containsPoint=function(a,b){return b[0]>=
a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};f.containsPointWithMargin=function(a,b,c){return b[0]>=a[0]-c&&b[1]>=a[1]-c&&b[0]<=a[2]+c&&b[1]<=a[3]+c};f.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[2],a[2])&&Math.max(b[1],a[1])<=Math.min(b[3],a[3])};f.contains=function(a,b){return b[0]>=a[0]&&b[2]<=a[2]&&b[1]>=a[1]&&b[3]<=a[3]};f.intersection=function(a,c,d){void 0===d&&(d=a);var e=c[0],l=c[1],h=c[2];c=c[3];d[0]=b(a[0],e,h);d[1]=b(a[1],l,c);d[2]=b(a[2],e,h);d[3]=b(a[3],l,c);return d};
f.distance=function(a,b){var c=(a[1]+a[3])/2,e=Math.max(Math.abs(b[0]-(a[0]+a[2])/2)-g(a)/2,0);a=Math.max(Math.abs(b[1]-c)-d(a)/2,0);return Math.sqrt(e*e+a*a)};f.offset=function(a,b,c,d){void 0===d&&(d=a);d[0]=a[0]+b;d[1]=a[1]+c;d[2]=a[2]+b;d[3]=a[3]+c;return d};f.pad=function(a,b,c){void 0===c&&(c=a);c[0]=a[0]-b;c[1]=a[1]-b;c[2]=a[2]+b;c[3]=a[3]+b;return c};f.setMin=function(a,b,c){void 0===c&&(c=a);c[0]=b[0];c[1]=b[1];c!==a&&(c[2]=a[2],c[3]=a[3]);return c};f.setMax=function(a,b,c){void 0===c&&(c=
a);c[2]=b[0];c[3]=b[1];c!==a&&(c[0]=a[0],c[1]=a[1]);return a};f.set=h;f.empty=function(a){return a?h(a,f.NEGATIVE_INFINITY):e(f.NEGATIVE_INFINITY)};f.is=c;f.isPoint=function(a){return(0===g(a)||!isFinite(a[0]))&&(0===d(a)||!isFinite(a[1]))};f.equals=function(a,b,d){if(null==a||null==b)return a===b;if(!c(a)||!c(b))return!1;if(d)for(var e=0;e<a.length;e++){if(!d(a[e],b[e]))return!1}else for(e=0;e<a.length;e++)if(a[e]!==b[e])return!1;return!0};f.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];
f.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];f.ZERO=[0,0,0,0]})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/wgs84Constants ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../lib/gl-matrix ./mathUtils".split(" "),function(m,f,k,e,g,d,h,c){function b(a,b,d,l){var h,g;a instanceof e&&b instanceof e&&(d=b.longitude,l=b.latitude,g=a.latitude,h=a.longitude);a=c.deg2rad(g);l=c.deg2rad(l);h=c.deg2rad(h);
b=c.deg2rad(d);d=Math.sin((a-l)/2);h=Math.sin((h-b)/2);d=2*c.asin(Math.sqrt(d*d+Math.cos(a)*Math.cos(l)*h*h))*f.earthRadius;return Math.round(1E4*d)/1E4}function a(a,b,d){a=d/f.earthRadius;b=c.deg2rad(b);a=Math.sin(a/2);b=Math.cos(b);b=2*c.asin(Math.sqrt(a*a/(b*b)));return c.rad2deg(b)}function l(a,b,d){return c.rad2deg(d/f.earthRadius)}function n(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(f,"__esModule",{value:!0});f.earthRadius=k.wgs84Radius;f.halfEarthCircumference=Math.PI*
f.earthRadius;f.earthCircumference=2*f.halfEarthCircumference;f.metersPerDegree=f.halfEarthCircumference/180;var p=new e(0,0,g.WGS84);f.getGreatCircleDistance=b;f.getGreatCircleSpanAt=function(a,c,d){var l=c.spatialReference,h=new e(c.x,a.y,l),g=new e(d.x,a.y,l);c=new e(a.x,c.y,l);a=new e(a.x,d.y,l);return{lon:b(h,g),lat:b(c,a)}};f.getLonDeltaForDistance=a;f.getLatDeltaForDistance=l;f.getLatLonDeltaForDistance=function(b,c,d){return{lat:l(b,c,d),lon:a(b,c,d)}};f.getMaxCameraAltitude=function(a){a=
c.deg2rad(a/2);return(1-Math.sin(a))*f.earthRadius/Math.sin(a)};f.getViewExtentDistance=function(a,b){b=c.deg2rad(b/2);return 2*c.acos((Math.pow(a+f.earthRadius,2)+Math.pow(f.earthRadius,2)-Math.pow((a+f.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+f.earthRadius),2)-a*a-2*a*f.earthRadius),2))/(2*(a+f.earthRadius)*f.earthRadius))*f.earthRadius};f.computeCarthesianDistance=function(a,b){function d(a){var b=c.deg2rad(a.latitude),d=c.deg2rad(a.longitude),e=Math.cos(b);a=f.earthRadius+(a.z||
0);return[Math.cos(d)*e*a,Math.sin(b)*a,-Math.sin(d)*e*a]}a=d(a);b=d(b);b=[b[0]-a[0],b[1]-a[1],b[2]-a[2]];return Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])};f.longitudeToTimezone=n;f.positionToTimezone=function(a,b){a.spatialReference.wkid!==g.WGS84.wkid?d.webMercatorToGeographic(a,!1,p):(p.x=a.x,p.y=a.y);p.z=a.z;b||(b={hours:0,minutes:0,seconds:0});b.hours=n(p.x,!0);a=b.hours%1;b.hours-=a;b.minutes=60*a;a=b.minutes%1;b.minutes-=a;b.seconds=Math.round(60*a);return b};f.distanceToIdealHorizon=function(a,
b){b=b||f.earthRadius;a=h.vec3d.dot(a,a);return Math.sqrt(Math.abs(a-b*b))}})},"esri/views/3d/support/mathUtils":function(){define(["require","exports","../lib/gl-matrix"],function(m,f,k){function e(a){return Math.asin(1<a?1:-1>a?-1:a)}function g(a){return Math.acos(1<a?1:-1>a?-1:a)}function d(a,b,c){return a<b?b:a>c?c:a}function h(a){for(var b in a){var c=a[b];c instanceof Function&&(a[b]=c.bind(a))}return a}Object.defineProperty(f,"__esModule",{value:!0});f.deg2rad=function(a){return a*Math.PI/
180};f.rad2deg=function(a){return 180*a/Math.PI};f.asin=e;f.acos=g;f.sign=Math.sign||function(a){return+(0<a)-+(0>a)||+a};f.log2=Math.log2||function(a){return Math.log(a)/Math.LN2};f.isPowerOfTwo=function(a){return 0===(a&a-1)};f.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};f.nextHighestPowerOfTen=function(a){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(a)))};f.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};f.fovy2fovx=function(a,b,c){return 2*
Math.atan(b*Math.tan(.5*a)/c)};f.makeOrthonormal=function(a,b,c){c=c||a;var d=k.vec3d.dot(a,b);k.vec3d.set3(a[0]-d*b[0],a[1]-d*b[1],a[2]-d*b[2],c);k.vec3d.normalize(c)};f.tangentFrame=function(a,b,c){Math.abs(a[0])>Math.abs(a[1])?k.vec3d.set3(0,1,0,b):k.vec3d.set3(1,0,0,b);k.vec3d.cross(a,b,c);k.vec3d.normalize(b);k.vec3d.cross(c,a,b);k.vec3d.normalize(c)};f.cartesianToSpherical=function(a,b){var c=k.vec3d.length(a),d=e(a[2]/c);k.vec3d.set3(c,d,Math.atan2(a[1]/c,a[0]/c),b)};f.sphericalToCartesian=
function(a,b){var c=a[0],d=a[1];a=a[2];var e=Math.cos(d);k.vec3d.set3(c*e*Math.cos(a),c*e*Math.sin(a),c*Math.sin(d),b)};f.lerp=function(a,b,c){return a+(b-a)*c};f.bilerp=function(a,b,c,d,e,l){a+=(b-a)*e;return a+(c+(d-c)*e-a)*l};f.slerp=function(a,b,c,d){void 0===d&&(d=a);var e=k.vec3d.length(a),h=k.vec3d.length(b),g=k.vec3d.dot(a,b)/(e*h);if(.9999999999999999>g){var g=Math.acos(g),p=((1-c)*e+c*h)/Math.sin(g),h=p/h*Math.sin(c*g);k.vec3d.scale(a,p/e*Math.sin((1-c)*g),l);k.vec3d.scale(b,h,n);return k.vec3d.add(l,
n,d)}return k.vec3d.lerp(a,b,c,d)};f.angle=function(b,c,d){b=k.vec3d.normalize(b,l);c=k.vec3d.normalize(c,n);var e=g(k.vec3d.dot(b,c));return d&&(b=k.vec3d.cross(b,c,a),0>k.vec3d.dot(b,d))?-e:e};f.clamp=d;f.isFinite=Number.isFinite||function(a){return"number"===typeof a&&window.isFinite(a)};f.isNaN=Number.isNaN||function(a){return a!==a};f.makePiecewiseLinearFunction=function(a){var b=a.length;return function(c){if(c<=a[0][0])return a[0][1];if(c>=a[b-1][0])return a[b-1][1];for(var d=1;c>a[d][0];)d++;
var e=a[d][0];c=(e-c)/(e-a[d-1][0]);return c*a[d-1][1]+(1-c)*a[d][1]}};f.vectorEquals=function(a,b){if(null==a||null==b)return a!==b;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0};f.floatEqualRelative=function(a,b,c){void 0===c&&(c=1E-6);if(f.isNaN(a)||f.isNaN(b))return!1;if(a===b)return!0;var d=Math.abs(a-b),e=Math.abs(a),l=Math.abs(b);if(0===a||0===b||1E-12>e&&1E-12>l){if(d>.01*c)return!1}else if(d/(e+l)>c)return!1;return!0};f.floatEqualAbsolute=function(a,
b,c){void 0===c&&(c=1E-6);return f.isNaN(a)||f.isNaN(b)?!1:(a>b?a-b:b-a)<=c};m=function(){function a(a,b){this.min=a;this.max=b;this.range=b-a}a.prototype.ndiff=function(a,b){void 0===b&&(b=0);return Math.ceil((a-b)/this.range)*this.range+b};a.prototype._normalize=function(a,b,c,d){void 0===d&&(d=0);c-=d;c<a?c+=this.ndiff(a-c):c>b&&(c-=this.ndiff(c-b));return c+d};a.prototype.normalize=function(a,b){return this._normalize(this.min,this.max,a,b)};a.prototype.clamp=function(a,b){void 0===b&&(b=0);return d(a-
b,this.min,this.max)+b};a.prototype.monotonic=function(a,b,c){return a<b?b:b+this.ndiff(a-b,c)};a.prototype.minimalMonotonic=function(a,b,c){return this._normalize(a,a+this.range,b,c)};a.prototype.center=function(a,b,c){b=this.monotonic(a,b,c);return this.normalize((a+b)/2,c)};a.prototype.diff=function(a,b,c){return this.monotonic(a,b,c)-a};a.prototype.contains=function(a,b,c){b=this.minimalMonotonic(a,b);c=this.minimalMonotonic(a,c);return c>a&&c<b};return a}();f.Cyclical=m;f.planeFromPoints=function(a,
d,e,l){k.vec3d.subtract(d,a,c);k.vec3d.subtract(e,a,b);k.vec3d.cross(c,b,l);k.vec3d.normalize(l,l);l[3]=-k.vec3d.dot(a,l)};var c=k.vec3d.create(),b=k.vec3d.create();f.cyclical2PI=h(new m(0,2*Math.PI));f.cyclicalPI=h(new m(-Math.PI,Math.PI));f.cyclicalDeg=h(new m(0,360));var a=k.vec3d.create(),l=k.vec3d.create(),n=k.vec3d.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});(function(k){k.length=
function(e,g){var d=e[g],h=e[g+1];e=e[g+2];return Math.sqrt(d*d+h*h+e*e)};k.normalize=function(e,g){var d=e[g],h=e[g+1],c=e[g+2],d=1/Math.sqrt(d*d+h*h+c*c);e[g]*=d;e[g+1]*=d;e[g+2]*=d};k.scale=function(e,g,d){e[g]*=d;e[g+1]*=d;e[g+2]*=d};k.add=function(e,g,d,h,c,b){void 0===b&&(b=g);c=c||e;c[b]=e[g]+d[h];c[b+1]=e[g+1]+d[h+1];c[b+2]=e[g+2]+d[h+2]};k.subtract=function(e,g,d,h,c,b){void 0===b&&(b=g);c=c||e;c[b]=e[g]-d[h];c[b+1]=e[g+1]-d[h+1];c[b+2]=e[g+2]-d[h+2]}})(f.Vec3Compact||(f.Vec3Compact={}))})},
"esri/geometry/support/meshUtils/offset":function(){define(["require","exports","./projection","../../../views/3d/lib/gl-matrix","../../../views/3d/support/projectionUtils"],function(m,f,k,e,g){function d(a,b){if(a)for(var c=0;c<a.length;c+=3)for(var d=0;3>d;d++)a[c+d]+=b[d]}Object.defineProperty(f,"__esModule",{value:!0});f.offset=function(a,l,n){if(a.vertexAttributes&&a.vertexAttributes.position){var p=a.spatialReference;if(p.isWGS84||p.isWebMercator&&(!n||!1!==n.geographic)){n=a.spatialReference;
var p=a.vertexAttributes.position,q=a.vertexAttributes.normal,f=new Float64Array(p.length),t=new Float32Array(q?q.length:0),w=a.extent.center,u=h;g.computeLinearTransformation(n,[w.x,w.y,w.z],c,g.SphericalECEFSpatialReference);e.mat4d.toMat3(c,b);e.mat3d.multiplyVec3(b,l,u);k.projectToECEF(p,n,f);q&&k.projectNormalToECEF(q,p,f,n,t);d(f,u);k.projectFromECEF(f,p,n);q&&k.projectNormalFromECEF(t,p,f,n,q)}else d(a.vertexAttributes.position,l);a.clearCache()}};var h=e.vec3d.create(),c=e.mat4d.create(),
b=e.mat3d.create()})},"esri/geometry/support/meshUtils/primitives":function(){define(["require","exports","./georeference","../../../views/3d/lib/gl-matrix"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.createUnitSizeBox=function(){for(var b=d.faceDescriptions,a=d.faceVertexOffsets,c=d.uvScales,e=4*b.length,h=new Float64Array(3*e),g=new Float32Array(3*e),e=new Float32Array(2*e),k=new Uint32Array(6*b.length),f=0,w=0,u=0,x=0,v=0;v<b.length;v++){for(var z=b[v],y=f/3,m=0,B=a;m<
B.length;m++){var C=B[m];k[x++]=y+C}y=z.corners;for(m=0;4>m;m++){B=y[m];C=0;e[u++]=.25*c[m][0]+z.uvOrigin[0];e[u++]=z.uvOrigin[1]-.25*c[m][1];for(var E=0;3>E;E++)0!==z.axis[E]?(h[f++]=.5*z.axis[E],g[w++]=z.axis[E]):(h[f++]=.5*B[C++],g[w++]=0)}}return{position:h,normal:g,uv:e,faces:k}};f.createUnitSizeSphere=function(b){void 0===b&&(b=0);b=Math.round(8*Math.pow(2,b));for(var a=2*b,c=(b-1)*(a+1)+2*a,d=new Float64Array(3*c),e=new Float32Array(3*c),c=new Float32Array(2*c),g=new Uint32Array((b-1)*a*6),
k=0,f=0,w=0,u=0,x=0,v=0;v<=b;v++){var z=v/b*Math.PI+.5*Math.PI,y=Math.cos(z);h[2]=Math.sin(z);for(var m=(z=0===v||v===b)?a-1:a,B=0;B<=m;B++){var C=B/m*2*Math.PI;h[0]=-Math.sin(C)*y;h[1]=Math.cos(C)*y;for(C=0;3>C;C++)d[k++]=.5*h[C],e[f++]=h[C];c[w++]=(B+(z?.5:0))/a;c[w++]=v/b;0!==v&&B!==a&&(v!==b&&(g[u++]=x,g[u++]=x+1,g[u++]=x-a),1!==v&&(g[u++]=x,g[u++]=x-a,g[u++]=x-a-1));x++}}return{position:d,normal:e,uv:c,faces:g}};f.createUnitSizeCylinder=function(b){void 0===b&&(b=0);b=Math.round(16*Math.pow(2,
b));for(var a=4*(b+1)+2*b,c=new Float64Array(3*a),d=new Float32Array(3*a),a=new Float32Array(2*a),e=new Uint32Array(12*b),g=0,k=0,f=0,w=0,u=0,x=0;5>=x;x++)for(var v=0===x||5===x,z=1>=x||4<=x,y=2===x||4===x,m=v?b-1:b,B=0;B<=m;B++){var C=B/m*2*Math.PI,E=v?0:.5;h[0]=E*Math.sin(C);h[1]=E*-Math.cos(C);h[2]=2>=x?.5:-.5;for(C=0;3>C;C++)c[g++]=h[C],z?d[k++]=2===C?1>=x?1:-1:0:d[k++]=2===C?0:h[C]/E;a[f++]=(B+(v?.5:0))/b;1>=x?a[f++]=1*x/3:3>=x?a[f++]=1*(x-2)/3+1/3:a[f++]=1*(x-4)/3+2/3;y||0===x||B===b||(5!==
x&&(e[w++]=u,e[w++]=u+1,e[w++]=u-b),1!==x&&(e[w++]=u,e[w++]=u-b,e[w++]=u-b-1));u++}return{position:c,normal:d,uv:a,faces:e}};f.createUnitSizePlane=function(b){b=g.facingAxisOrderSwap[b];for(var a=g.position,c=g.normal,d=new Float64Array(a.length),e=new Float32Array(c.length),h=0,k=0;4>k;k++)for(var f=h,w=0;3>w;w++){var u=b[w],x=Math.abs(u)-1,u=0<=u?1:-1;d[h]=a[f+x]*u;e[h]=c[f+x]*u;h++}return{position:d,normal:e,uv:new Float32Array(g.uv),faces:new Uint32Array(g.faces)}};var g={position:[-.5,-.5,0,
.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]}};f.convertUnitGeometry=function(b,a,d){for(var l=0;l<b.position.length;l+=3)b.position[l+2]+=.5;l=d&&d.size;if(null!=l){l="number"===typeof l?[l,l,l]:[null!=l.width?l.width:1,null!=l.depth?l.depth:1,null!=l.height?l.height:1];c[0]=l[0];c[4]=l[1];c[8]=l[2];for(var g=0;g<b.position.length;g+=3){for(var q=
0;3>q;q++)h[q]=b.position[g+q];e.mat3d.multiplyVec3(c,h);for(q=0;3>q;q++)b.position[g+q]=h[q]}if(l[0]!==l[1]||l[1]!==l[2])for(c[0]=1/l[0],c[4]=1/l[1],c[8]=1/l[2],g=0;g<b.normal.length;g+=3){for(q=0;3>q;q++)h[q]=b.normal[g+q];e.mat3d.multiplyVec3(c,h);e.vec3d.normalize(h);for(q=0;3>q;q++)b.normal[g+q]=h[q]}}l=k.georeference(b,a,d);return{vertexAttributes:{position:l.position,normal:l.normal,uv:b.uv},components:[{faces:b.faces,material:d&&d.material||null}],spatialReference:a.spatialReference}};var d=
{faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,
1,2,0,2,3]};f.boxFaceOrder={south:0,east:1,north:2,west:3,up:4,down:5};var h=e.vec3d.create(),c=e.mat3d.identity()})},"esri/geometry/support/meshUtils/georeference":function(){define(["require","exports","../../../views/3d/lib/gl-matrix","../../../views/3d/support/projectionUtils"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.georeference=function(h,c,b){var a=c.spatialReference;if(a.isWGS84||a.isWebMercator&&(!b||!1!==b.geographic)){b=c.spatialReference;e.computeLinearTransformation(c.spatialReference,
[c.x,c.y,c.z||0],g,e.SphericalECEFSpatialReference);var a=h.position,l=g,n=c.spatialReference,p=new Float64Array(a.length);for(c=0;c<a.length;c+=3){for(var q=0;3>q;q++)d[q]=a[c+q];k.mat4d.multiplyVec3(l,d);for(q=0;3>q;q++)p[c+q]=d[q]}c=new Float64Array(a.length);e.bufferToBuffer(p,e.SphericalECEFSpatialReference,0,c,n,0,p.length/3);h=h.normal;if(b.isWebMercator&&h){b=new Float32Array(h.length);for(a=0;a<h.length;a+=3)for(l=e.webMercator.y2lat(c[a+1]),l=Math.cos(l),d[0]=h[a+0]*l,d[1]=h[a+1]*l,d[2]=
h[a+2],k.vec3d.normalize(d),l=0;3>l;l++)b[a+l]=d[l];h=b}h={position:c,normal:h}}else{b=new Float64Array(h.position.length);a=h.position;for(l=0;l<a.length;l+=3)b[l+0]=a[l+0]+c.x,b[l+1]=a[l+1]+c.y,b[l+2]=a[l+2]+(c.z||0);h={position:b,normal:h.normal}}return h};var g=k.mat4d.create(),d=k.vec3d.create()})},"esri/geometry/support/meshUtils/rotate":function(){define("require exports ../../../core/Logger ./projection ../../../views/3d/lib/gl-matrix ../../../views/3d/support/projectionUtils".split(" "),
function(m,f,k,e,g,d){function h(a,c,d){void 0===d&&(d=r);if(a)for(g.mat4d.identity(p),g.mat4d.rotate(p,c[3],c),c=0;c<a.length;c+=3){for(var e=0;3>e;e++)b[e]=a[c+e]-d[e];g.mat4d.multiplyVec3(p,b);for(e=0;3>e;e++)a[c+e]=b[e]+d[e]}}Object.defineProperty(f,"__esModule",{value:!0});var c=k.getLogger("esri.geometry.support.meshUtils.rotate");f.rotate=function(b,l,n){if(b.vertexAttributes&&b.vertexAttributes.position&&0!==l[3]){var k=b.spatialReference,u=n&&n.origin||b.extent.center;if(k.isWGS84||k.isWebMercator&&
(!n||!1!==n.geographic)){n=b.spatialReference;k=t;d.pointToVector(u,k,d.SphericalECEFSpatialReference)||d.pointToVector(b.extent.center,k,d.SphericalECEFSpatialReference);var u=b.vertexAttributes.position,f=b.vertexAttributes.normal,r=new Float64Array(u.length),x=new Float32Array(f?f.length:0);d.computeLinearTransformation(d.SphericalECEFSpatialReference,k,p,d.SphericalECEFSpatialReference);g.mat4d.toMat3(p,q);var w=g.mat3d.multiplyVec3(q,l,a);w[3]=l[3];e.projectToECEF(u,n,r);f&&e.projectNormalToECEF(f,
u,r,n,x);h(r,w,k);e.projectFromECEF(r,u,n);f&&(h(x,w),e.projectNormalFromECEF(x,u,r,n,f))}else n=t,d.pointToVector(u,n,b.spatialReference)||(k=b.extent.center,n[0]=k.x,n[1]=k.y,n[2]=k.z,c.error("Failed to project specified origin (wkid:"+u.spatialReference.wkid+") to mesh spatial reference (wkid:"+b.spatialReference.wkid+"). Using mesh extent.center instead")),h(b.vertexAttributes.position,l,n),h(b.vertexAttributes.normal,l);b.clearCache()}};f.axisAngleFrom=function(a,b,c){g.vec3d.set(a,c);c[3]=b;
return c};f.axisAngleMultiply=function(a,b,c){g.quat4d.fromAngleAxis(a[3],a,l);g.quat4d.fromAngleAxis(b[3],b,n);g.quat4d.multiply(n,l,l);g.quat4d.toAngleAxis(l,c);return c};var b=g.vec3d.create(),a=g.vec4d.create(),l=g.quat4d.create(),n=g.quat4d.create(),p=g.mat4d.create(),q=g.mat3d.create(),r=[0,0,0],t=[0,0,0]})},"esri/geometry/Multipoint":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./Extent ./Geometry ./Point ./support/zmUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a){function l(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}m=function(c){function n(){for(var a=0;a<arguments.length;a++);a=c.call(this)||this;a.points=[];a.type="multipoint";return a}k(n,c);q=n;n.prototype.normalizeCtorArgs=function(a,b){if(!a&&!b)return null;var c={};Array.isArray(a)?(c.points=a,c.spatialReference=b):!a||"esri.geometry.SpatialReference"!==a.declaredClass&&null==a.wkid?(a.points&&(c.points=a.points),a.spatialReference&&(c.spatialReference=
a.spatialReference),a.hasZ&&(c.hasZ=a.hasZ),a.hasM&&(c.hasM=a.hasM)):c.spatialReference=a;if(a=c.points&&c.points[0])void 0===c.hasZ&&void 0===c.hasM?(c.hasZ=2<a.length,c.hasM=!1):void 0===c.hasZ?c.hasZ=3<a.length:void 0===c.hasM&&(c.hasM=3<a.length);return c};Object.defineProperty(n.prototype,"extent",{get:function(){var a=this.points;if(!a.length)return null;for(var b=new h,c=this.hasZ,d=this.hasM,e=c?3:2,g=a[0],n=l(Math.min),k=l(Math.max),p=g[0],q=g[1],f=g[0],g=g[1],m,D,F,M,N=0,I=a.length;N<I;N++){var G=
a[N],O=G[0],J=G[1],p=n(p,O),q=n(q,J),f=k(f,O),g=k(g,J);c&&2<G.length&&(O=G[2],m=n(m,O),F=k(F,O));d&&G.length>e&&(G=G[e],D=n(D,G),M=k(M,G))}b.xmin=p;b.ymin=q;b.xmax=f;b.ymax=g;b.spatialReference=this.spatialReference;c?(b.zmin=m,b.zmax=F):(b.zmin=null,b.zmax=null);d?(b.mmin=D,b.mmax=M):(b.mmin=null,b.mmax=null);return b},enumerable:!0,configurable:!0});n.prototype.writePoints=function(a,b,c,d){b.points=g.clone(this.points)};n.prototype.addPoint=function(b){this.clearCache();a.updateSupportFromPoint(this,
b);Array.isArray(b)?this.points.push(b):this.points.push(b.toArray());return this};n.prototype.clone=function(){var a={points:g.clone(this.points),spatialReference:this.spatialReference};this.hasZ&&(a.hasZ=!0);this.hasM&&(a.hasM=!0);return new q(a)};n.prototype.getPoint=function(a){if(!this._validateInputs(a))return null;a=this.points[a];var c={x:a[0],y:a[1],spatialReference:this.spatialReference},d=2;this.hasZ&&(c.z=a[2],d=3);this.hasM&&(c.m=a[d]);return new b(c)};n.prototype.removePoint=function(a){if(!this._validateInputs(a))return null;
this.clearCache();return new b(this.points.splice(a,1)[0],this.spatialReference)};n.prototype.setPoint=function(b,c){if(!this._validateInputs(b))return this;this.clearCache();a.updateSupportFromPoint(c);this.points[b]=c.toArray();return this};n.prototype.toJSON=function(a){return this.write(null,a)};n.prototype._validateInputs=function(a){return null!=a&&0<=a&&a<this.points.length};var q;e([d.property({dependsOn:["points","hasZ","hasM","spatialReference"]})],n.prototype,"cache",void 0);e([d.property({dependsOn:["cache"]})],
n.prototype,"extent",null);e([d.property({type:[[Number]],json:{write:{isRequired:!0}}})],n.prototype,"points",void 0);e([d.writer("points")],n.prototype,"writePoints",null);return n=q=e([d.subclass("esri.geometry.Multipoint")],n)}(d.declared(c));m.prototype.toJSON.isDefaultToJSON=!0;return m})},"esri/geometry/support/zmUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.updateSupportFromPoint=function(k,e,g){void 0===g&&(g=!1);var d=k.hasM,
h=k.hasZ;Array.isArray(e)?4!==e.length||d||h?3===e.length&&g&&!d?(h=!0,d=!1):3===e.length&&d&&h&&(h=d=!1):h=d=!0:(h=!h&&e.hasZ&&(!d||e.hasM),d=!d&&e.hasM&&(!h||e.hasZ));k.hasZ=h;k.hasM=d}})},"esri/geometry/Polygon":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./Extent ./Geometry ./Point ./SpatialReference ./support/centroid ./support/contains ./support/coordsUtils ./support/intersects ./support/webMercatorUtils ./support/zmUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}var u=w(Math.min),x=w(Math.max);m=function(c){function f(){for(var a=0;a<arguments.length;a++);a=c.call(this)||this;a.rings=[];a.type="polygon";return a}k(f,c);v=f;f.createEllipse=function(a){var b=a.center.x,c=a.center.y,d=a.center.z,e=a.center.m,l=a.center.hasZ,h=a.center.hasM,g=a.longAxis,n=a.shortAxis,k=a.numberOfPoints;a=a.view;for(var p=[],q=2*Math.PI/k,u=l?3:2,f=0;f<k;f++){var r=
a.toMap(g*Math.cos(f*q)+b,n*Math.sin(f*q)+c),r=[r.x,r.y];l&&(r[2]=d);h&&(r[u]=e);p.push(r)}p.push(p[0]);return new v({rings:[p],spatialReference:a.spatialReference})};f.createCircle=function(a){return v.createEllipse({center:a.center,longAxis:a.r,shortAxis:a.r,numberOfPoints:a.numberOfPoints,view:a.view})};f.fromExtent=function(a){var b=a.clone().normalize();a=a.spatialReference;var c=!1,d=!1;b.map(function(a){a.hasZ&&(c=!0);a.hasM&&(d=!0)});b={rings:b.map(function(a){var b=[[a.xmin,a.ymin],[a.xmin,
a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(c&&a.hasZ)for(var e=a.zmin+.5*(a.zmax-a.zmin),l=0;l<b.length;l++)b[l].push(e);if(d&&a.hasM)for(a=a.mmin+.5*(a.mmax-a.mmin),l=0;l<b.length;l++)b[l].push(a);return b}),spatialReference:a};c&&(b.hasZ=!0);d&&(b.hasM=!0);return new v(b)};f.prototype.normalizeCtorArgs=function(b,c){var d=null,e,l,h=null;b&&!Array.isArray(b)?(d=b.rings?b.rings:null,c||(b.spatialReference?c=b.spatialReference:b.rings||(c=b)),e=b.hasZ,l=b.hasM):d=b;d=d||[];c=c||a.WGS84;
d.length&&d[0]&&null!=d[0][0]&&"number"===typeof d[0][0]&&(d=[d]);if(h=d[0]&&d[0][0])void 0===e&&void 0===l?(e=2<h.length,l=!1):void 0===e?e=!l&&3<h.length:void 0===l&&(l=!e&&3<h.length);return{rings:d,spatialReference:c,hasZ:e,hasM:l}};Object.defineProperty(f.prototype,"centroid",{get:function(){var a=l.polygonCentroid(this);if(!a||isNaN(a[0])||isNaN(a[1])||this.hasZ&&isNaN(a[2]))return null;var c=new b;c.x=a[0];c.y=a[1];c.spatialReference=this.spatialReference;this.hasZ&&(c.z=a[2]);return c},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"extent",{get:function(){var a=this.hasZ,b=this.hasM,c=this.spatialReference,d=this.rings,e=a?3:2;if(!d.length||!d[0].length)return null;for(var l=d[0][0],g=l[0],l=l[1],n=d[0][0],k=n[0],n=n[1],p=void 0,q=void 0,f=void 0,v=void 0,r=[],t=0;t<d.length;t++){for(var y=d[t],z=y[0],w=z[0],z=z[1],m=y[0],S=m[0],m=m[1],W=void 0,Y=void 0,X=void 0,aa=void 0,U=0;U<y.length;U++){var ha=y[U],Z=ha[0],ba=ha[1],g=u(g,Z),l=u(l,ba),k=x(k,Z),n=x(n,ba),w=u(w,Z),z=u(z,
ba),S=x(S,Z),m=x(m,ba);a&&2<ha.length&&(Z=ha[2],p=u(p,Z),q=x(q,Z),W=u(W,Z),Y=x(Y,Z));b&&ha.length>e&&(aa=ha[e],f=u(p,aa),v=x(q,aa),X=u(W,aa),aa=x(Y,aa))}r.push(new h({xmin:w,ymin:z,zmin:W,mmin:X,xmax:S,ymax:m,zmax:Y,mmax:aa,spatialReference:c}))}d=new h;d.xmin=g;d.ymin=l;d.xmax=k;d.ymax=n;d.spatialReference=c;a&&(d.zmin=p,d.zmax=q);b&&(d.mmin=f,d.mmax=v);d.cache._partwise=1<r.length?r:null;return d},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isSelfIntersecting",{get:function(){return q.isSelfIntersecting(this.rings)},
enumerable:!0,configurable:!0});f.prototype.writePaths=function(a,b,c,d){b.rings=g.clone(this.rings)};f.prototype.addRing=function(a){if(a){this.clearCache();var b=this.rings,c=b.length;if(Array.isArray(a[0]))b[c]=a.concat();else{for(var d=[],e=0,l=a.length;e<l;e++)d[e]=a[e].toArray();b[c]=d}return this}};f.prototype.clone=function(){var a=new v;a.spatialReference=this.spatialReference;a.rings=g.clone(this.rings);a.hasZ=this.hasZ;a.hasM=this.hasM;return a};f.prototype.contains=function(a){if(!a)return!1;
r.canProject(a,this.spatialReference)&&(a=r.project(a,this.spatialReference));return n.polygonContainsPoint(this,a)};f.prototype.isClockwise=function(a){var b=this;a=Array.isArray(a[0])?a:a.map(function(a){return b.hasZ?b.hasM?[a.x,a.y,a.z,a.m]:[a.x,a.y,a.z]:[a.x,a.y]});return p.isClockwise(a,this.hasM,this.hasZ)};f.prototype.getPoint=function(a,c){if(!this._validateInputs(a,c))return null;a=this.rings[a][c];c=this.hasZ;var d=this.hasM;return c&&!d?new b(a[0],a[1],a[2],void 0,this.spatialReference):
d&&!c?new b(a[0],a[1],void 0,a[2],this.spatialReference):c&&d?new b(a[0],a[1],a[2],a[3],this.spatialReference):new b(a[0],a[1],this.spatialReference)};f.prototype.insertPoint=function(a,b,c){if(!this._validateInputs(a,b,!0))return this;this.clearCache();t.updateSupportFromPoint(this,c);Array.isArray(c)||(c=c.toArray());this.rings[a].splice(b,0,c);return this};f.prototype.removePoint=function(a,c){if(!this._validateInputs(a,c))return null;this.clearCache();return new b(this.rings[a].splice(c,1)[0],
this.spatialReference)};f.prototype.removeRing=function(a){if(!this._validateInputs(a,null))return null;this.clearCache();a=this.rings.splice(a,1)[0];var c=this.spatialReference;return a.map(function(a){return new b(a,c)})};f.prototype.setPoint=function(a,b,c){if(!this._validateInputs(a,b))return this;this.clearCache();t.updateSupportFromPoint(this,c);Array.isArray(c)||(c=c.toArray());this.rings[a][b]=c;return this};f.prototype._validateInputs=function(a,b,c){void 0===c&&(c=!1);return null==a||0>
a||a>=this.rings.length||null!=b&&(a=this.rings[a],c&&(0>b||b>a.length)||!c&&(0>b||b>=a.length))?!1:!0};f.prototype.toJSON=function(a){return this.write(null,a)};var v;e([d.property({dependsOn:["hasM","hasZ","rings"]})],f.prototype,"cache",void 0);e([d.property({readOnly:!0,dependsOn:["cache"]})],f.prototype,"centroid",null);e([d.property({dependsOn:["cache"],readOnly:!0})],f.prototype,"extent",null);e([d.property({dependsOn:["cache"],readOnly:!0})],f.prototype,"isSelfIntersecting",null);e([d.property({type:[[[Number]]],
json:{write:{isRequired:!0}}})],f.prototype,"rings",void 0);e([d.writer("rings")],f.prototype,"writePaths",null);return f=v=e([d.subclass("esri.geometry.Polygon")],f)}(d.declared(c));m.prototype.toJSON.isDefaultToJSON=!0;return m})},"esri/geometry/support/centroid":function(){define(["require","exports","./coordsUtils"],function(m,f,k){function e(e,c){if(!e||!e.length)return null;for(var b=[],a=[],l=c?[Infinity,-Infinity,Infinity,-Infinity,Infinity,-Infinity]:[Infinity,-Infinity,Infinity,-Infinity],
h=0,k=e.length;h<k;h++){var q=g(e[h],c,l);q&&a.push(q)}a.sort(function(a,b){var d=a[2]-b[2];0===d&&c&&(d=a[4]-b[4]);return d});a.length&&(h=6*a[0][2],b[0]=a[0][0]/h,b[1]=a[0][1]/h,c&&(h=6*a[0][4],b[2]=0!==h?a[0][3]/h:0),b[0]<l[0]||b[0]>l[1]||b[1]<l[2]||b[1]>l[3]||c&&(b[2]<l[4]||b[2]>l[5]))&&(b.length=0);if(!b.length)if(e=e[0]&&e[0].length?d(e[0],c):null)b[0]=e[0],b[1]=e[1],c&&2<e.length&&(b[2]=e[2]);else return null;return b}function g(d,c,b){for(var a=0,e=0,h=0,g=0,k=0,f=0,t=d.length-1;f<t;f++){var m=
d[f],u=m[0],x=m[1],v=m[2],z=d[f+1],y=z[0],A=z[1],B=z[2],C=u*A-y*x,g=g+C,a=a+(u+y)*C,e=e+(x+A)*C;c&&2<m.length&&2<z.length&&(C=u*B-y*v,h+=(v+B)*C,k+=C);u<b[0]&&(b[0]=u);u>b[1]&&(b[1]=u);x<b[2]&&(b[2]=x);x>b[3]&&(b[3]=x);c&&(v<b[4]&&(b[4]=v),v>b[5]&&(b[5]=v))}0<g&&(g*=-1);0<k&&(k*=-1);if(!g)return null;d=[a,e,.5*g];c&&(d[3]=h,d[4]=.5*k);return d}function d(d,c){for(var b=c?[0,0,0]:[0,0],a=c?[0,0,0]:[0,0],e=0,h=0,g=0,q=0,f=0,t=d.length;f<t-1;f++){var m=d[f],u=d[f+1];if(m&&u){b[0]=m[0];b[1]=m[1];a[0]=
u[0];a[1]=u[1];c&&2<m.length&&2<u.length&&(b[2]=m[2],a[2]=u[2]);var x=k.getLength(b,a);x&&(e+=x,m=k.getMidpoint(m,u),h+=x*m[0],g+=x*m[1],c&&2<m.length&&(q+=x*m[2]))}}return 0<e?c?[h/e,g/e,q/e]:[h/e,g/e]:d.length?d[0]:null}Object.defineProperty(f,"__esModule",{value:!0});f.extentCentroid=function(d){return d?d.hasZ?[d.xmax-d.xmin/2,d.ymax-d.ymin/2,d.zmax-d.zmin/2]:[d.xmax-d.xmin/2,d.ymax-d.ymin/2]:null};f.polygonCentroid=function(d){return d?e(d.rings,d.hasZ):null};f.ringsCentroid=e;f.lineCentroid=
d})},"esri/geometry/Polyline":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./Extent ./Geometry ./Point ./SpatialReference ./support/zmUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){function n(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}var p=n(Math.min),q=n(Math.max);m=function(c){function n(){for(var a=0;a<arguments.length;a++);a=c.call(this)||this;a.paths=[];a.type="polyline";
return a}k(n,c);f=n;n.prototype.normalizeCtorArgs=function(b,c){var d=null,e,l,h=null;b&&!Array.isArray(b)?(d=b.paths?b.paths:null,c||(b.spatialReference?c=b.spatialReference:b.paths||(c=b)),e=b.hasZ,l=b.hasM):d=b;d=d||[];c=c||a.WGS84;d.length&&d[0]&&null!=d[0][0]&&"number"===typeof d[0][0]&&(d=[d]);if(h=d[0]&&d[0][0])void 0===e&&void 0===l?(e=2<h.length,l=!1):void 0===e?e=!l&&3<h.length:void 0===l&&(l=!e&&3<h.length);return{paths:d,spatialReference:c,hasZ:e,hasM:l}};Object.defineProperty(n.prototype,
"extent",{get:function(){var a=this.hasZ,b=this.hasM,c=this.spatialReference,d=this.paths,e=a?3:2;if(!d.length||!d[0].length)return null;for(var l=d[0][0],g=l[0],l=l[1],n=d[0][0],k=n[0],n=n[1],f=void 0,r=void 0,t=void 0,m=void 0,w=[],G=0;G<d.length;G++){for(var O=d[G],J=O[0],Q=J[0],J=J[1],H=O[0],K=H[0],H=H[1],R=void 0,P=void 0,L=void 0,T=void 0,S=0;S<O.length;S++){var W=O[S],Y=W[0],X=W[1],g=p(g,Y),l=p(l,X),k=q(k,Y),n=q(n,X),Q=p(Q,Y),J=p(J,X),K=q(K,Y),H=q(H,X);a&&2<W.length&&(Y=W[2],f=p(f,Y),r=q(r,
Y),R=p(R,Y),P=q(P,Y));b&&W.length>e&&(T=W[e],t=p(f,T),m=q(r,T),L=p(R,T),T=q(P,T))}w.push(new h({xmin:Q,ymin:J,zmin:R,mmin:L,xmax:K,ymax:H,zmax:P,mmax:T,spatialReference:c}))}d=new h;d.xmin=g;d.ymin=l;d.xmax=k;d.ymax=n;d.spatialReference=c;a&&(d.zmin=f,d.zmax=r);b&&(d.mmin=t,d.mmax=m);d.cache._partwise=1<w.length?w:null;return d},enumerable:!0,configurable:!0});n.prototype.writePaths=function(a,b,c,d){b.paths=g.clone(this.paths)};n.prototype.addPath=function(a){if(a){this.clearCache();var b=this.paths,
c=b.length;if(Array.isArray(a[0]))b[c]=a.concat();else{for(var d=[],e=0,l=a.length;e<l;e++)d[e]=a[e].toArray();b[c]=d}return this}};n.prototype.clone=function(){var a=new f;a.spatialReference=this.spatialReference;a.paths=g.clone(this.paths);a.hasZ=this.hasZ;a.hasM=this.hasM;return a};n.prototype.getPoint=function(a,c){if(!this._validateInputs(a,c))return null;a=this.paths[a][c];c=this.hasZ;var d=this.hasM;return c&&!d?new b(a[0],a[1],a[2],void 0,this.spatialReference):d&&!c?new b(a[0],a[1],void 0,
a[2],this.spatialReference):c&&d?new b(a[0],a[1],a[2],a[3],this.spatialReference):new b(a[0],a[1],this.spatialReference)};n.prototype.insertPoint=function(a,b,c){if(!this._validateInputs(a,b,!0))return this;this.clearCache();l.updateSupportFromPoint(this,c);Array.isArray(c)||(c=c.toArray());this.paths[a].splice(b,0,c);return this};n.prototype.removePath=function(a){if(!this._validateInputs(a,null))return null;this.clearCache();a=this.paths.splice(a,1)[0];var c=this.spatialReference;return a.map(function(a){return new b(a,
c)})};n.prototype.removePoint=function(a,c){if(!this._validateInputs(a,c))return null;this.clearCache();return new b(this.paths[a].splice(c,1)[0],this.spatialReference)};n.prototype.setPoint=function(a,b,c){if(!this._validateInputs(a,b))return this;this.clearCache();l.updateSupportFromPoint(this,c);Array.isArray(c)||(c=c.toArray());this.paths[a][b]=c;return this};n.prototype._validateInputs=function(a,b,c){void 0===c&&(c=!1);return null==a||0>a||a>=this.paths.length||null!=b&&(a=this.paths[a],c&&
(0>b||b>a.length)||!c&&(0>b||b>=a.length))?!1:!0};n.prototype.toJSON=function(a){return this.write(null,a)};var f;e([d.property({dependsOn:["hasM","hasZ","paths"]})],n.prototype,"cache",void 0);e([d.property({dependsOn:["cache"],readOnly:!0})],n.prototype,"extent",null);e([d.property({type:[[[Number]]],json:{write:{isRequired:!0}}})],n.prototype,"paths",void 0);e([d.writer("paths")],n.prototype,"writePaths",null);return n=f=e([d.subclass("esri.geometry.Polyline")],n)}(d.declared(c));m.prototype.toJSON.isDefaultToJSON=
!0;return m})},"esri/geometry/ScreenPoint":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(h){function c(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=h.apply(this,a)||this;a.x=0;a.y=0;a.z=void 0;return a}k(c,h);b=c;c.prototype.normalizeCtorArgs=function(a,b){return"number"===typeof a?{x:a,y:b}:Array.isArray(a)?{x:a[0],y:a[1]}:
a};c.prototype.clone=function(){return new b({x:this.x,y:this.y,z:this.z})};c.prototype.toArray=function(){return null==this.z?[this.x,this.y]:[this.x,this.y,this.z]};var b;e([d.property({type:Number})],c.prototype,"x",void 0);e([d.property({type:Number})],c.prototype,"y",void 0);e([d.property({type:Number})],c.prototype,"z",void 0);return c=b=e([d.subclass("esri.geometry.ScreenPoint")],c)}(d.declared(g))})},"esri/geometry/support/jsonUtils":function(){define("require exports ../Extent ../Mesh ../Multipoint ../Point ../Polygon ../Polyline".split(" "),
function(m,f,k,e,g,d,h,c){function b(a){return void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax}function a(a){return void 0!==a.points}function l(a){return void 0!==a.x&&void 0!==a.y}function n(a){return void 0!==a.paths}function p(a){return void 0!==a.rings}function q(a){return void 0!==a.vertexAttributes}function r(f){if(f){if(l(f))return d.fromJSON(f);if(n(f))return c.fromJSON(f);if(p(f))return h.fromJSON(f);if(a(f))return g.fromJSON(f);if(b(f))return k.fromJSON(f);if(q(f))return e.fromJSON(f)}return null}
Object.defineProperty(f,"__esModule",{value:!0});f.fromJson=function(a){try{throw Error("fromJson is deprecated, use fromJSON instead");}catch(u){console.warn(u.stack)}return r(a)};f.isMultipoint=a;f.isPoint=l;f.isPolyline=n;f.isPolygon=p;f.isMesh=q;f.fromJSON=r;f.getJsonType=function(c){if(c){if(l(c))return"esriGeometryPoint";if(n(c))return"esriGeometryPolyline";if(p(c))return"esriGeometryPolygon";if(b(c))return"esriGeometryEnvelope";if(a(c))return"esriGeometryMultipoint"}return null};var t={esriGeometryPoint:d,
esriGeometryPolyline:c,esriGeometryPolygon:h,esriGeometryEnvelope:k,esriGeometryMultipoint:g};f.getGeometryType=function(a){return a&&t[a]||null}})},"esri/PopupTemplate":function(){define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/Collection ./core/date ./core/JSONSupport ./core/kebabDictionary ./core/lang ./core/accessorSupport/decorators ./support/arcadeUtils ./support/actions/ActionBase ./support/actions/ActionButton ./support/actions/ActionToggle".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t=d.ofType({key:"type",defaultKeyValue:"button",base:p,typeMap:{button:q,toggle:r}}),w=b({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),u=b({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.actions=null;a.content="";a.expressionInfos=null;a.fieldInfos=null;a.layerOptions=null;a.outFields=null;a.overwriteActions=!1;
a.title="";a.relatedRecordsInfo=null;return a}e(c,b);d=c;c.prototype.readContent=function(a,b){var c=this,d=b.description,e=b.mediaInfos;a=b.showAttachments;if((b=b.popupElements)&&b.length)return b.map(function(a){"text"!==a.type||a.text?"media"===a.type&&(a.mediaInfos||e)&&(a.mediaInfos||(a.mediaInfos=e),a.mediaInfos=c._readMediaInfos(a.mediaInfos)):a.text=d;return a});b=[];d?b.push({type:"text",text:d}):b.push({type:"fields"});e&&e.length&&b.push({type:"media",mediaInfos:this._readMediaInfos(e)});
a&&b.push({type:"attachments",displayType:"list"});return b.length?b:d};c.prototype.writeContent=function(b,c){var d=this;c.showAttachments=!1;"string"===typeof b?c.description=b:Array.isArray(b)&&(c.popupElements=a.clone(b),c.popupElements.forEach(function(b){"attachments"!==b.type||c.showAttachments?"media"!==b.type||c.mediaInfos?"text"!==b.type||c.description?"fields"!==b.type||c.fieldInfos||(b.fieldInfos&&(c.fieldInfos=d._writeFieldInfos(a.clone(b.fieldInfos))),delete b.fieldInfos):(b.text&&(c.description=
b.text),delete b.text):(b.mediaInfos&&(c.mediaInfos=a.clone(b.mediaInfos),c.mediaInfos.forEach(function(a){a.type=u.toJSON(a.type)})),delete b.mediaInfos):c.showAttachments=!0;return b}))};c.prototype.writeExpressionInfos=function(a,b){b.expressionInfos=a||null};c.prototype.readFieldInfos=function(a){if(a)return a.forEach(function(a){var b=a.format&&a.format.dateFormat,c=a.stringFieldOption;b&&(a.format.dateFormat=h.fromJSON(b));c&&(a.stringFieldOption=w.fromJSON(c))}),a};c.prototype.writeFieldInfos=
function(b,c){c.fieldInfos=b?this._writeFieldInfos(a.clone(b)):b};c.prototype.writeLayerOptions=function(a,b){b.layerOptions=a||null};c.prototype.writeTitle=function(a,b){b.title=a||""};c.prototype.writeRelatedRecordsInfo=function(a,b){b.relatedRecordsInfo=a||null};Object.defineProperty(c.prototype,"requiredFields",{get:function(){return this.collectRequiredFields()},enumerable:!0,configurable:!0});c.prototype.clone=function(){var b=this.actions,b=b?a.clone(b.toArray()):[];return new d({actions:b,
content:Array.isArray(this.content)?a.clone(this.content):this.content,fieldInfos:this.fieldInfos?a.clone(this.fieldInfos):null,layerOptions:this.layerOptions?a.clone(this.layerOptions):null,overwriteActions:this.overwriteActions,relatedRecordsInfo:this.relatedRecordsInfo?a.clone(this.relatedRecordsInfo):null,title:this.title})};c.prototype.collectRequiredFields=function(){var a=(this.outFields||[]).concat(this._getActionsFields(this.actions),this._getTitleFields(this.title),this._getContentFields(this.content),
this._getExpressionInfoFields(this.expressionInfos));return-1!==a.indexOf("*")?["*"]:a.filter(function(a,b,c){return a&&b===c.indexOf(a)})};c.prototype._getContentElementFields=function(a){var b=this;if(!a||"attachments"===a.type)return[];if("fields"===a.type)return this._getFieldInfoFields(a.fieldInfos||this.fieldInfos);if("media"===a.type)return(a.mediaInfos||[]).reduce(function(a,c){return a.concat(b._getMediaInfoFields(c))},[]);if("text"===a.type)return this._extractFieldNames(a.text)};c.prototype._getMediaInfoFields=
function(a){var b=a.caption,c=a.value||{},d=c.fields,e=void 0===d?[]:d,d=c.normalizeField,l=c.tooltipField,h=c.sourceURL,c=c.linkURL;a=this._extractFieldNames(a.title).concat(this._extractFieldNames(b),this._extractFieldNames(h),this._extractFieldNames(c),e);d&&a.push(d);l&&a.push(l);return a};c.prototype._getContentFields=function(a){var b=this;return"string"===typeof a?this._extractFieldNames(a):Array.isArray(a)?a.reduce(function(a,c){return a.concat(b._getContentElementFields(c))},[]):[]};c.prototype._getExpressionInfoFields=
function(a){return a?a.reduce(function(a,b){return a.concat(n.extractFieldNames(b.expression))},[]):[]};c.prototype._getFieldInfoFields=function(a){return a?a.filter(function(a){return"undefined"===typeof a.visible?!0:!!a.visible}).map(function(a){return a.fieldName}).filter(function(a){return-1===a.indexOf("relationships/")&&-1===a.indexOf("expression/")}):[]};c.prototype._getActionsFields=function(a){var b=this;return a?a.toArray().reduce(function(a,c){return a.concat(b._getActionFields(c))},[]):
[]};c.prototype._getActionFields=function(a){var b=a.className,c=a.type,c="button"===c||"toggle"===c?a.image:"";return this._extractFieldNames(a.title).concat(this._extractFieldNames(b),this._extractFieldNames(c))};c.prototype._getTitleFields=function(a){return"string"===typeof a?this._extractFieldNames(a):[]};c.prototype._readMediaInfos=function(a){a.forEach(function(a){a.type=u.fromJSON(a.type)});return a};c.prototype._writeFieldInfos=function(a){a.forEach(function(a){var b=a.format&&a.format.dateFormat,
c=a.stringFieldOption;b&&(a.format.dateFormat=h.toJSON(b));c&&(a.stringFieldOption=w.toJSON(c));a.format||delete a.format});return a};c.prototype._extractFieldNames=function(a){if(!a||"string"!==typeof a)return[];a=a.match(/{[^}]*}/g);if(!a)return[];var b=/\{(\w+):.+\}/;return(a=a.filter(function(a){return!(0===a.indexOf("{relationships/")||0===a.indexOf("{expression/"))}).map(function(a){return a.replace(b,"{$1}")}))?a.map(function(a){return a.slice(1,-1)}):[]};var d;g([l.property({type:t})],c.prototype,
"actions",void 0);g([l.property()],c.prototype,"content",void 0);g([l.reader("content",["description","popupElements","mediaInfos","showAttachments"])],c.prototype,"readContent",null);g([l.writer("content")],c.prototype,"writeContent",null);g([l.property()],c.prototype,"expressionInfos",void 0);g([l.writer("expressionInfos")],c.prototype,"writeExpressionInfos",null);g([l.property()],c.prototype,"fieldInfos",void 0);g([l.reader("fieldInfos")],c.prototype,"readFieldInfos",null);g([l.writer("fieldInfos")],
c.prototype,"writeFieldInfos",null);g([l.property()],c.prototype,"layerOptions",void 0);g([l.writer("layerOptions")],c.prototype,"writeLayerOptions",null);g([l.property()],c.prototype,"outFields",void 0);g([l.property()],c.prototype,"overwriteActions",void 0);g([l.property({json:{type:String}})],c.prototype,"title",void 0);g([l.writer("title")],c.prototype,"writeTitle",null);g([l.property()],c.prototype,"relatedRecordsInfo",void 0);g([l.writer("relatedRecordsInfo")],c.prototype,"writeRelatedRecordsInfo",
null);g([l.property({dependsOn:"actions title content fieldInfos expressionInfos outFields".split(" "),readOnly:!0})],c.prototype,"requiredFields",null);return c=d=g([l.subclass("esri.PopupTemplate")],c)}(l.declared(c))})},"esri/core/date":function(){define(["require","exports","./kebabDictionary"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});var e={"short-date":"(datePattern: 'M/d/y', selector: 'date')","short-date-le":"(datePattern: 'd/M/y', selector: 'date')","long-month-day-year":"(datePattern: 'MMMM d, y', selector: 'date')",
"day-short-month-year":"(datePattern: 'd MMM y', selector: 'date')","long-date":"(datePattern: 'EEEE, MMMM d, y', selector: 'date')","short-date-short-time":"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')","short-date-le-short-time":"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')","short-date-short-time-24":"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')","short-date-le-short-time-24":"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
"short-date-long-time":"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')","short-date-le-long-time":"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')","short-date-long-time-24":"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')","short-date-le-long-time-24":"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')","long-month-year":"(datePattern: 'MMMM y', selector: 'date')","short-month-year":"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"};m=k({shortDate:"short-date",shortDateLE:"short-date-le",longDate:"long-date",dayShortMonthYear:"day-short-month-year",longMonthDayYear:"long-month-day-year",shortDateLongTime:"short-date-long-time",shortDateLELongTime:"short-date-le-long-time",shortDateShortTime:"short-date-short-time",shortDateLEShortTime:"short-date-le-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLongTime24:"short-date-long-time-24",
shortDateLELongTime24:"short-date-le-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year"});f.toJSON=m.toJSON.bind(m);f.fromJSON=m.fromJSON.bind(m);f.getFormat=function(g){return e[g]}})},"esri/support/arcadeUtils":function(){define("require exports ../arcade/arcade ../arcade/Dictionary ../arcade/Feature ../core/lang".split(" "),function(m,f,k,e,g,d){function h(a){var b;try{b=a?k.parseScript(a):null}catch(n){b=null}return b}Object.defineProperty(f,"__esModule",{value:!0});
var c=/^\$feature\./i,b={vars:{$feature:"any",$view:"any"},spatialReference:null};f.createSyntaxTree=h;f.createFunction=function(a,c){c=c||d.clone(b);a="string"===typeof a?h(a):a;if(!a)return null;var e;try{e=a?k.compileScript(a,c):null}catch(p){e=null}return e};f.createExecContext=function(a,b){return{vars:{$feature:null==a?new g:g.createFromGraphic(a),$view:b&&b.view},spatialReference:b&&b.sr}};f.createFeature=function(a,b,c){return g.createFromGraphicLikeObject(b,a,c)};f.updateExecContext=function(a,
b){a.vars.$feature=b};f.evalSyntaxTree=function(a,b){var c;try{c=k.executeScript(a,b,b.spatialReference)}catch(p){c=null}return c};f.executeFunction=function(a,b){var c;try{c=a?a(b,b.spatialReference):null}catch(p){c=null}return c};f.extractFieldNames=function(a){if(!a)return[];a="string"===typeof a?h(a):a;if(!a)return[];var b=[];k.extractFieldLiterals(a).forEach(function(a){c.test(a)&&(a=a.replace(c,""),b.push(a))});b.sort();return b.filter(function(a,c){return 0===c||b[c-1]!==a})};f.dependsOnView=
function(a){return k.referencesMember(a,"$view")};f.getViewInfo=function(a){if(a&&a.viewingMode&&null!=a.scale&&a.spatialReference)return{view:new e({viewingMode:a.viewingMode,scale:a.scale}),sr:a.spatialReference}};f.hasGeometryOperations=function(a){return(a="string"===typeof a?h(a):a)&&k.scriptUsesGeometryEngine(a)};f.enableGeometryOperations=function(){return k.enableGeometrySupport()}})},"esri/arcade/arcade":function(){define("require exports dojo/Deferred ./arcadeCompiler ./arcadeRuntime ./parser ../core/has".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});var c="disjoint intersects touches crosses within contains overlaps equals relate intersection union difference symmetricdifference clip cut area areageodetic length lengthgeodetic distance densify densifygeodetic generalize buffer buffergeodetic offset rotate issimple simplify multiparttosinglepart".split(" ");f.compileScript=function(b,a){return h("csp-restrictions")?function(a,c){return g.executeScript(b,a,c)}:e.compileScript(b,
a)};f.extend=function(b){g.extend(b);e.extend(b)};f.parseScript=function(b){return d.parseScript(b)};f.validateScript=function(b,a){return d.validateScript(b,a,"simple")};f.scriptCheck=function(b,a,c){return d.scriptCheck(b,a,c,"full")};f.parseAndExecuteScript=function(b,a,c){return g.executeScript(d.parseScript(b),a,c)};f.executeScript=function(b,a,c){return g.executeScript(b,a,c)};f.referencesMember=function(b,a){return g.referencesMember(b,a)};f.referencesFunction=function(b,a){return g.referencesFunction(b,
a)};f.extractFieldLiterals=function(b,a){void 0===a&&(a=!1);return d.extractFieldLiterals(b,a)};f.scriptUsesGeometryEngine=function(b){b=g.findFunctionCalls(b);for(var a=0;a<b.length;a++)if(-1<c.indexOf(b[a]))return!0;return!1};f.enableGeometrySupport=function(){var b=new k;m(["esri/geometry/geometryEngine","./functions/geomsync"],function(a,c){c.setGeometryEngine(a);b.resolve(!0)},function(a){b.reject(a)});return b.promise}})},"esri/arcade/arcadeCompiler":function(){define("require exports ./Dictionary ./Feature ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){function y(a,b,c){try{return c(a,null,b)}catch(U){throw U;}}function A(a,b){try{switch(b.type){case "EmptyStatement":return"lc.voidOperation";case "VariableDeclarator":return F(a,b);case "VariableDeclaration":for(var d=[],e=0;e<b.declarations.length;e++)d.push(A(a,b.declarations[e]));return d.join("\n")+" \n lastStatement\x3d  lc.voidOperation; \n";case "BlockStatement":return D(a,b);case "FunctionDeclaration":var e=b.id.name.toLowerCase(),l={applicationCache:void 0===
a.applicationCache?null:a.applicationCache,spatialReference:a.spatialReference,console:a.console,symbols:a.symbols,localScope:{_SymbolsMap:{}},depthCounter:a.depthCounter+1,globalScope:a.globalScope};if(64<l.depthCounter)throw Error("Exceeded maximum function depth");for(var h="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement \x3d lc.voidOperation; var lscope \x3d [];\n ",g=0;g<b.params.length;g++){var n=b.params[g].name.toLowerCase(),k=Q(n,a);l.localScope._SymbolsMap[n]=
k;h+="lscope['"+k+"']\x3darguments["+g.toString()+"];\n"}h+=D(l,b.body)+"\n return lastStatement; }, runtimeCtx))";h+="\n lastStatement \x3d lc.voidOperation; \n";void 0!==a.globalScope[e]?d="gscope['"+e+"']\x3d"+h:void 0!==a.globalScope._SymbolsMap[e]?d="gscope['"+a.globalScope._SymbolsMap[e]+"']\x3d"+h:(k=Q(e,a),a.globalScope._SymbolsMap[e]=k,d="gscope['"+k+"']\x3d"+h);return d;case "ReturnStatement":var p;p=null===b.argument?"return lc.voidOperation;":"return "+A(a,b.argument)+";";return p;case "IfStatement":if("AssignmentExpression"===
b.test.type||"UpdateExpression"===b.test.type)throw Error(c.nodeErrorMessage(b.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var q=A(a,b.test),f=H(a),u="var "+f+" \x3d "+q+";\n if ("+f+" \x3d\x3d\x3d true) {\n"+E(a,b.consequent)+"\n }\n",u=null!==b.alternate?u+("else if ("+f+"\x3d\x3d\x3dfalse)   { \n"+E(a,b.alternate)+"}\n"):u+("else if ("+f+"\x3d\x3d\x3dfalse) { \n lastStatement \x3d lc.voidOperation;\n }\n");return u+="else { lang.error({type: '"+b.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n";
case "ExpressionStatement":var v;v="AssignmentExpression"===b.expression.type?"lastStatement \x3d lc.voidOperation; "+A(a,b.expression)+" \n ":"lastStatement \x3d "+A(a,b.expression)+";";return v;case "AssignmentExpression":return C(a,b);case "UpdateExpression":return B(a,b);case "BreakStatement":return"break;";case "ContinueStatement":return"continue;";case "ForStatement":d="lastStatement \x3d lc.voidOperation; \n";null!==b.init&&(d+=A(a,b.init));var r=H(a),x=H(a),d=d+("var "+r+" \x3d true;")+"\n do { ";
null!==b.update&&(d+=" if ("+r+"\x3d\x3d\x3dfalse) {\n "+A(a,b.update)+"  \n}\n "+r+"\x3dfalse; \n");null!==b.test&&(d+="var "+x+" \x3d "+A(a,b.test)+";",d+="if ("+x+"\x3d\x3d\x3dfalse) { break; } else if ("+x+"!\x3d\x3dtrue) { lang.error({type: '"+b.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n");d+=A(a,b.body);null!==b.update&&(d+="\n "+A(a,b.update));return d+("\n"+r+" \x3d true; \n} while(true);  lastStatement \x3d lc.voidOperation;");case "ForInStatement":var t=H(a),m=H(a),
z=H(a),y="var "+t+" \x3d "+A(a,b.right)+";\n";"VariableDeclaration"===b.left.type&&(y+=A(a,b.left));var w="VariableDeclaration"===b.left.type?b.left.declarations[0].id.name:b.left.name,w=w.toLowerCase(),d="";null!==a.localScope&&(void 0!==a.localScope[w]?d="lscope['"+w+"']":void 0!==a.localScope._SymbolsMap[w]&&(d="lscope['"+a.localScope._SymbolsMap[w]+"']"));""===d&&(void 0!==a.globalScope[w]?d="gscope['"+w+"']":void 0!==a.globalScope._SymbolsMap[w]&&(d="gscope['"+a.globalScope._SymbolsMap[w]+"']"));
y=y+("if ("+t+"\x3d\x3d\x3dnull) {  lastStatement \x3d lc.voidOperation; }\n ")+("else if (lc.isArray("+t+") || lc.isString("+t+")) {")+("var "+m+"\x3d"+t+".length; \n")+("for(var "+z+"\x3d0; "+z+"\x3c"+m+"; "+z+"++) {\n");y+=d+"\x3d"+z+";\n";y+=A(a,b.body);y+="\n}\n";y+=" lastStatement \x3d lc.voidOperation; \n";y+=" \n}\n";y+="else if (lc.isImmutableArray("+t+")) {";y=y+("var "+m+"\x3d"+t+".length(); \n")+("for(var "+z+"\x3d0; "+z+"\x3c"+m+"; "+z+"++) {\n");y+=d+"\x3d"+z+";\n";y+=A(a,b.body);y+=
"\n}\n";y+=" lastStatement \x3d lc.voidOperation; \n";y+=" \n}\n";y+="else if (( "+t+" instanceof lang.Dictionary) || ( "+t+" instanceof lang.Feature)) {";y=y+("var "+m+"\x3d"+t+".keys(); \n")+("for(var "+z+"\x3d0; "+z+"\x3c"+m+".length; "+z+"++) {\n");y+=d+"\x3d"+m+"["+z+"];\n";y+=A(a,b.body);y+="\n}\n";y+=" lastStatement \x3d lc.voidOperation; \n";y+=" \n}\n";return y+"else { lastStatement \x3d lc.voidOperation; } \n";case "Identifier":return N(a,b);case "MemberExpression":var I;try{d=void 0,d=
!0===b.computed?A(a,b.property):"'"+b.property.name+"'",I="lang.member("+A(a,b.object)+","+d+")"}catch(Fa){throw Fa;}return I;case "Literal":return null===b.value||void 0===b.value?"null":JSON.stringify(b.value);case "ThisExpression":throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));case "CallExpression":try{if("Identifier"!==b.callee.type)throw Error(c.nodeErrorMessage(b,"RUNTIME","ONLYNODESSUPPORTED"));var M=b.callee.name.toLowerCase(),d="";null!==a.localScope&&(void 0!==a.localScope[M]?
d="lscope['"+M+"']":void 0!==a.localScope._SymbolsMap[M]&&(d="lscope['"+a.localScope._SymbolsMap[M]+"']"));""===d&&(void 0!==a.globalScope[M]?d="gscope['"+M+"']":void 0!==a.globalScope._SymbolsMap[M]&&(d="gscope['"+a.globalScope._SymbolsMap[M]+"']"));if(""!==d)for(e="[",l=0;l<b.arguments.length;l++)0<l&&(e+=", "),e+=A(a,b.arguments[l]);else throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTFOUND"));}catch(Fa){throw Fa;}return"lang.callfunc("+d+","+(e+"]")+",runtimeCtx)";case "UnaryExpression":var G;
try{G="lang.unary("+A(a,b.argument)+",'"+b.operator+"')"}catch(Fa){throw Fa;}return G;case "BinaryExpression":var X;try{X="lang.binary("+A(a,b.left)+","+A(a,b.right)+",'"+b.operator+"')"}catch(Fa){throw Fa;}return X;case "LogicalExpression":var O;try{if("AssignmentExpression"===b.left.type||"UpdateExpression"===b.left.type)throw Error(c.nodeErrorMessage(b.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===b.right.type||"UpdateExpression"===b.right.type)throw Error(c.nodeErrorMessage(b.right,
"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("\x26\x26"===b.operator||"||"===b.operator)O="(lang.logicalCheck("+A(a,b.left)+") "+b.operator+" lang.logicalCheck("+A(a,b.right)+"))";else throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));}catch(Fa){throw Fa;}return O;case "ConditionalExpression":throw Error(c.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{d=[];for(e=0;e<b.elements.length;e++)"Literal"===b.elements[e].type?d.push(A(a,b.elements[e])):
d.push("lang.aCheck("+A(a,b.elements[e])+",'ArrayExpression')");h="["+d.join(",")+"]"}catch(Fa){throw Fa;}return h;case "ObjectExpression":d="lang.dictionary([";for(e=0;e<b.properties.length;e++){var g=b.properties[e],J="Identifier"===g.key.type?"'"+g.key.name+"'":A(a,g.key),T=A(a,g.value);0<e&&(d+=",");d+="lang.strCheck("+J+",'ObjectExpression'),lang.aCheck("+T+", 'ObjectExpression')"}return d+"])";case "Property":throw Error("Should not get here");case "Array":throw Error(c.nodeErrorMessage(b,"RUNTIME",
"NOTSUPPORTED"));default:throw Error(c.nodeErrorMessage(b,"RUNTIME","UNREOGNISED"));}}catch(Fa){throw Fa;}}function B(a,b){var c=null,d="";if("MemberExpression"===b.argument.type)return c=A(a,b.argument.object),d=!0===b.argument.computed?A(a,b.argument.property):"'"+b.argument.property.name+"'","lang.memberupdate("+c+","+d+",'"+b.operator+"',"+b.prefix+")";c=b.argument.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[c])return"lang.update(lscope, '"+c+"','"+b.operator+"',"+b.prefix+
")";if(void 0!==a.localScope._SymbolsMap[c])return"lang.update(lscope, '"+a.localScope._SymbolsMap[c]+"','"+b.operator+"',"+b.prefix+")"}if(void 0!==a.globalScope[c])return"lang.update(gscope, '"+c+"','"+b.operator+"',"+b.prefix+")";if(void 0!==a.globalScope._SymbolsMap[c])return"lang.update(gscope, '"+a.globalScope._SymbolsMap[c]+"','"+b.operator+"',"+b.prefix+")";throw Error("Variable not recognised");}function C(a,b){var c=A(a,b.right),d=null,e="";if("MemberExpression"===b.left.type)return d=A(a,
b.left.object),e=!0===b.left.computed?A(a,b.left.property):"'"+b.left.property.name+"'","lang.assignmember("+d+","+e+",'"+b.operator+"',"+c+");";d=b.left.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[d])return"lscope['"+d+"']\x3dlang.assign("+c+",'"+b.operator+"', lscope['"+d+"']); ";if(void 0!==a.localScope._SymbolsMap[d])return"lscope['"+a.localScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+b.operator+"', lscope['"+a.localScope._SymbolsMap[d]+"']); "}if(void 0!==a.globalScope[d])return"gscope['"+
d+"']\x3dlang.assign("+c+",'"+b.operator+"', gscope['"+d+"']); ";if(void 0!==a.globalScope._SymbolsMap[d])return"gscope['"+a.globalScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+b.operator+"', gscope['"+a.globalScope._SymbolsMap[d]+"']); ";throw Error("Variable not recognised");}function E(a,b){return"BlockStatement"===b.type?A(a,b):"ReturnStatement"===b.type?A(a,b):"BreakStatement"===b.type?A(a,b):"ContinueStatement"===b.type?A(a,b):"UpdateExpression"===b.type?"lastStatement \x3d "+A(a,b)+";":
"ExpressionStatement"===b.type?A(a,b):"ObjectExpression"===b.type?"lastStatement \x3d "+A(a,b)+";":A(a,b)}function D(a,b){for(var c="",d=0;d<b.body.length;d++)c="ReturnStatement"===b.body[d].type?c+(A(a,b.body[d])+" \n"):"BreakStatement"===b.body[d].type?c+(A(a,b.body[d])+" \n"):"ContinueStatement"===b.body[d].type?c+(A(a,b.body[d])+" \n"):"UpdateExpression"===b.body[d].type?c+("lastStatement \x3d "+A(a,b.body[d])+"; \n"):"ObjectExpression"===b.body[d].type?c+("lastStatement \x3d "+A(a,b.body[d])+
"; \n"):c+(A(a,b.body[d])+" \n");return c}function F(a,b){var c=null===b.init?null:A(a,b.init);c===h.voidOperation&&(c=null);b=b.id.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[b])return"lscope['"+b+"']\x3d"+c+";";if(void 0!==a.localScope._SymbolsMap[b])return"lscope['"+a.localScope._SymbolsMap[b]+"']\x3d"+c+";";var d=Q(b,a);a.localScope._SymbolsMap[b]=d;return"lscope['"+d+"']\x3d"+c+";"}if(void 0!==a.globalScope[b])return"gscope['"+b+"']\x3d"+c+";";if(void 0!==a.globalScope._SymbolsMap[b])return"gscope['"+
a.globalScope._SymbolsMap[b]+"']\x3d"+c+";";d=Q(b,a);a.globalScope._SymbolsMap[b]=d;return"gscope['"+d+"']\x3d"+c+";"}function M(a,b,e){b=b.toLowerCase();switch(b){case "hasz":return a=a.hasZ,void 0===a?!1:a;case "hasm":return a=a.hasM,void 0===a?!1:a;case "spatialreference":return b=a.spatialReference._arcadeCacheId,void 0===b&&(e=!0,Object.freeze&&Object.isFrozen(a.spatialReference)&&(e=!1),e&&(P++,b=a.spatialReference._arcadeCacheId=P)),a=new k({wkt:a.spatialReference.wkt,wkid:a.spatialReference.wkid}),
void 0!==b&&(a._arcadeCacheId="SPREF"+b.toString()),a}switch(a.type){case "extent":switch(b){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return a=a[b],void 0!==a?a:null;case "type":return"Extent"}break;case "polygon":switch(b){case "rings":return b=h.isVersion4?a.cache._arcadeCacheId:a.getCacheValue("_arcadeCacheId"),void 0===b&&(P++,b=P,h.isVersion4?a.cache._arcadeCacheId=b:a.setCacheValue("_arcadeCacheId",b)),a=new g(a.rings,a.spatialReference,
!0===a.hasZ,!0===a.hasM,b);case "type":return"Polygon"}break;case "point":switch(b){case "x":case "y":case "z":case "m":return void 0!==a[b]?a[b]:null;case "type":return"Point"}break;case "polyline":switch(b){case "paths":return b=h.isVersion4?a.cache._arcadeCacheId:a.getCacheValue("_arcadeCacheId"),void 0===b&&(P++,b=P,h.isVersion4?a.cache._arcadeCacheId=b:a.setCacheValue("_arcadeCacheId",b)),a=new g(a.paths,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polyline"}break;case "multipoint":switch(b){case "points":return b=
h.isVersion4?a.cache._arcadeCacheId:a.getCacheValue("_arcadeCacheId"),void 0===b&&(P++,b=P,h.isVersion4?a.cache._arcadeCacheId=b:a.setCacheValue("_arcadeCacheId",b)),a=new d(a.points,a.spatialReference,!0===a.hasZ,!0===a.hasM,b,1);case "type":return"Multipoint"}}throw Error(c.nodeErrorMessage(e,"RUNTIME","PROPERTYNOTFOUND"));}function N(a,b){try{var d=b.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[d])return"lscope['"+d+"']";if(void 0!==a.localScope._SymbolsMap[d])return"lscope['"+
a.localScope._SymbolsMap[d]+"']"}if(void 0!==a.globalScope[d])return"gscope['"+d+"']";if(void 0!==a.globalScope._SymbolsMap[d])return"gscope['"+a.globalScope._SymbolsMap[d]+"']";throw Error(c.nodeErrorMessage(b,"RUNTIME","VARIABLENOTFOUND"));}catch(U){throw U;}}function I(a){return null===a?"":h.isArray(a)||h.isImmutableArray(a)?"Array":h.isDate(a)?"Date":h.isString(a)?"String":h.isBoolean(a)?"Boolean":h.isNumber(a)?"Number":a instanceof k?"Dictionary":a instanceof e?"Feature":a instanceof u?"Point":
a instanceof x?"Polygon":a instanceof v?"Polyline":a instanceof w?"Multipoint":a instanceof r?"Extent":h.isFunctionParameter(a)?"Function":a===h.voidOperation?"":"number"===typeof a&&isNaN(a)?"Number":"Unrecognised Type"}function G(a,b,c,d){try{if(h.equalityTest(b[c],d))return b[c+1];var e=b.length-c;return 1===e?b[c]:2===e?null:3===e?b[c+2]:G(a,b,c+2,d)}catch(Z){throw Z;}}function O(a,b,c,d){try{if(!0===d)return b[c+1];if(3===b.length-c)return b[c+2];var e=b[c+2];if(!1===h.isBoolean(e))throw Error("WHEN needs boolean test conditions");
return O(a,b,c+2,e)}catch(Z){throw Z;}}function J(a,b){var c=a.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[a[0]];var e=J(a.slice(0,d),b);a=J(a.slice(d,c),b);for(c=[];0<e.length||0<a.length;)0<e.length&&0<a.length?(d=b(e[0],a[0]),isNaN(d)&&(d=0),0>=d?(c.push(e[0]),e=e.slice(1)):(c.push(a[0]),a=a.slice(1))):0<e.length?(c.push(e[0]),e=e.slice(1)):0<a.length&&(c.push(a[0]),a=a.slice(1));return c}function Q(a,b){b.symbols.symbolCounter++;return"_T"+b.symbols.symbolCounter.toString()}function H(a){a.symbols.symbolCounter++;
return"_Tvar"+a.symbols.symbolCounter.toString()}function K(a,b,c){var d={};a||(a={});c||(c={});d._SymbolsMap={};d.textformatting=1;d.infinity=1;d.pi=1;for(var e in b)d[e]=1;for(e in c)d[e]=1;for(e in a)d[e]=1;return d}function R(a){console.log(a)}Object.defineProperty(f,"__esModule",{value:!0});var P=0,L={};b.registerFunctions(L,y);q.registerFunctions(L,y);n.registerFunctions(L,y);a.registerFunctions(L,y);p.registerFunctions(L,y);l.registerFunctions(L,y);L["typeof"]=function(a,b){return y(a,b,function(a,
b,c){h.pcCheck(c,1,1);a=I(c[0]);if("Unrecognised Type"===a)throw Error("Unrecognised Type");return a})};L.iif=function(a,b){try{return y(a,b,function(a,b,c){h.pcCheck(c,3,3);if(!1===h.isBoolean(c[0]))throw Error("IF Function must have a boolean test condition");return c[0]?c[1]:c[2]})}catch(aa){throw aa;}};L.decode=function(a,b){try{return y(a,b,function(b,c,d){if(2>d.length)throw Error("Missing Parameters");if(2===d.length)return d[1];if(0===(d.length-1)%2)throw Error("Must have a default value result.");
return G(a,d,1,d[0])})}catch(aa){throw aa;}};L.when=function(a,b){try{return y(a,b,function(b,c,d){if(3>d.length)throw Error("Missing Parameters");if(0===d.length%2)throw Error("Must have a default value result.");b=d[0];if(!1===h.isBoolean(b))throw Error("WHEN needs boolean test conditions");return O(a,d,0,b)})}catch(aa){throw aa;}};L.top=function(a,b){return y(a,b,function(a,b,c){h.pcCheck(c,2,2);if(h.isArray(c[0]))return h.toNumber(c[1])>=c[0].length?c[0].slice(0):c[0].slice(0,h.toNumber(c[1]));
if(h.isImmutableArray(c[0]))return h.toNumber(c[1])>=c[0].length()?c[0].slice(0):c[0].slice(0,h.toNumber(c[1]));throw Error("Top cannot accept this parameter type");})};L.first=function(a,b){return y(a,b,function(a,b,c){h.pcCheck(c,1,1);return h.isArray(c[0])?0===c[0].length?null:c[0][0]:h.isImmutableArray(c[0])?0===c[0].length()?null:c[0].get(0):null})};L.sort=function(a,b){return y(a,b,function(a,b,c){h.pcCheck(c,1,2);b=c[0];h.isImmutableArray(b)&&(b=b.toArray());if(!1===h.isArray(b))throw Error("Illegal Argument");
if(1<c.length){if(!1===h.isFunctionParameter(c[1]))throw Error("Illegal Argument");b=J(b,function(b,d){return W.callfunc(c[1],[b,d],a)})}else{if(0===b.length)return[];for(var d={},e=0;e<b.length;e++){var l=I(b[e]);""!==l&&(d[l]=!0)}if(!0===d.Array||!0===d.Dictionary||!0===d.Feature||!0===d.Point||!0===d.Polygon||!0===d.Polyline||!0===d.Multipoint||!0===d.Extent||!0===d.Function)return b.slice(0);var e=0,l="",g;for(g in d)e++,l=g;b=1<e||"String"===l?J(b,function(a,b){if(null===a||void 0===a||a===h.voidOperation)return null===
b||void 0===b||b===h.voidOperation?0:1;if(null===b||void 0===b||b===h.voidOperation)return-1;a=h.toString(a);b=h.toString(b);return a<b?-1:a===b?0:1}):"Number"===l?J(b,function(a,b){return a-b}):"Boolean"===l?J(b,function(a,b){return a===b?0:b?-1:1}):"Date"===l?J(b,function(a,b){return b-a}):b.slice(0)}return b})};for(var T in L)L[T]=new h.NativeFunction(L[T]);var S=function(){};S.prototype=L;f.functionHelper={fixSpatialReference:h.fixSpatialReference,parseArguments:function(a,b){for(var c=[],d=0;d<
b.arguments.length;d++)c.push(A(a,b.arguments[d]));return c},standardFunction:y};f.extend=function(a){for(var b={mode:"sync",compiled:!0,functions:{},signatures:[],standardFunction:y},d=0;d<a.length;d++)a[d].registerFunctions(b);for(var e in b.functions)L[e]=new h.NativeFunction(b.functions[e]),S.prototype[e]=L[e];for(d=0;d<b.signatures.length;d++)c.addFunctionDeclaration(b.signatures[d],"f")};f.executeScript=function(a,b,c){return a(b,c)};f.extractFieldLiterals=function(a,b){void 0===b&&(b=!1);return c.findFieldLiterals(a,
b)};f.validateScript=function(a,b){return c.validateScript(a,b,"simple")};f.referencesMember=function(a,b){return c.referencesMember(a,b)};f.referencesFunction=function(a,b){return c.referencesFunction(a,b)};var W={error:function(a,b,d){throw Error(c.nodeErrorMessage(a,b,d));},functionDepthchecker:function(a,b){return function(){b.depthCounte++;if(64<b.depthCounter)throw Error("Exceeded maximum function depth");var c=a.apply(this,arguments);b.depthCounte--;return c}},aCheck:function(a,b){if(h.isFunctionParameter(a))throw Error(c.nodeErrorMessage({type:b},
"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return a===h.voidOperation?null:a},Dictionary:k,Feature:e,dictionary:function(a){for(var b={},c=0;c<a.length;c+=2){if(h.isFunctionParameter(a[c+1]))throw Error("Illegal Argument");if(!1===h.isString(a[c]))throw Error("Illegal Argument");b[a[c].toString()]=a[c+1]===h.voidOperation?null:a[c+1]}a=new k(b);a.immutable=!1;return a},strCheck:function(a,b){if(!1===h.isString(a))throw Error("Illegal Argument");return a},unary:function(a,b){if(h.isBoolean(a)){if("!"===
b)return!a;if("-"===b)return-1*h.toNumber(a);if("+"===b)return 1*h.toNumber(a);throw Error(c.nodeErrorMessage({type:"UnaryExpression"},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===b)return-1*h.toNumber(a);if("+"===b)return 1*h.toNumber(a);throw Error(c.nodeErrorMessage({type:"UnaryExpression"},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));},logicalCheck:function(a){if(!1===h.isBoolean(a))throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));return a},logical:function(a,b,d){if(h.isBoolean(a)&&
h.isBoolean(b))switch(d){case "||":return a||b;case "\x26\x26":return a&&b;default:throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));}else throw Error(c.nodeErrorMessage("LogicalExpression","RUNTIME","ONLYORORAND"));},binary:function(a,b,d){switch(d){case "\x3d\x3d":return h.equalityTest(a,b);case "\x3d":return h.equalityTest(a,b);case "!\x3d":return!h.equalityTest(a,b);case "\x3c":return h.greaterThanLessThan(a,b,d);case "\x3e":return h.greaterThanLessThan(a,b,d);case "\x3c\x3d":return h.greaterThanLessThan(a,
b,d);case "\x3e\x3d":return h.greaterThanLessThan(a,b,d);case "+":return h.isString(a)||h.isString(b)?h.toString(a)+h.toString(b):h.toNumber(a)+h.toNumber(b);case "-":return h.toNumber(a)-h.toNumber(b);case "*":return h.toNumber(a)*h.toNumber(b);case "/":return h.toNumber(a)/h.toNumber(b);case "%":return h.toNumber(a)%h.toNumber(b);default:throw Error(c.nodeErrorMessage({type:"BinaryExpression"},"RUNTIME","OPERATORNOTRECOGNISED"));}},assign:function(a,b,d){switch(b){case "\x3d":return a===h.voidOperation?
null:a;case "/\x3d":return h.toNumber(d)/h.toNumber(a);case "*\x3d":return h.toNumber(d)*h.toNumber(a);case "-\x3d":return h.toNumber(d)-h.toNumber(a);case "+\x3d":return h.isString(d)||h.isString(a)?h.toString(d)+h.toString(a):h.toNumber(d)+h.toNumber(a);case "%\x3d":return h.toNumber(d)%h.toNumber(a);default:throw Error(c.nodeErrorMessage("AssignmentExpression","RUNTIME","OPERATORNOTRECOGNISED"));}},update:function(a,b,c,d){var e=h.toNumber(a[b]);a[b]="++"===c?e+1:e-1;return!1===d?e:"++"===c?e+
1:e-1},memberupdate:function(a,b,c,d){var l;if(h.isArray(a))if(h.isNumber(b)){0>b&&(b=a.length+b);if(0>b||b>=a.length)throw Error("Assignment outside of array bounds");l=h.toNumber(a[b]);a[b]="++"===c?l+1:l-1}else throw Error("Invalid Parameter");else if(a instanceof k){if(!1===h.isString(b))throw Error("Dictionary accessor must be a string");if(!0===a.hasField(b))l=h.toNumber(a.field(b)),a.setField(b,"++"===c?l+1:l-1);else throw Error("Invalid Parameter");}else if(a instanceof e){if(!1===h.isString(b))throw Error("Feature accessor must be a string");
if(!0===a.hasField(b))l=h.toNumber(a.field(b)),a.setField(b,"++"===c?l+1:l-1);else throw Error("Invalid Parameter");}else{if(h.isImmutableArray(a))throw Error("Array is Immutable");throw Error("Invalid Parameter");}return!1===d?l:"++"===c?l+1:l-1},assignmember:function(a,b,c,d){if(h.isArray(a))if(h.isNumber(b)){0>b&&(b=a.length+b);if(0>b||b>a.length)throw Error("Assignment outside of array bounds");if(b===a.length&&"\x3d"!==c)throw Error("Invalid Parameter");a[b]=this.assign(d,c,a[b])}else throw Error("Invalid Parameter");
else if(a instanceof k){if(!1===h.isString(b))throw Error("Dictionary accessor must be a string");if(!0===a.hasField(b))a.setField(b,this.assign(d,c,a.field(b)));else{if("\x3d"!==c)throw Error("Invalid Parameter");a.setField(b,this.assign(d,c,null))}}else if(a instanceof e){if(!1===h.isString(b))throw Error("Feature accessor must be a string");if(!0===a.hasField(b))a.setField(b,this.assign(d,c,a.field(b)));else{if("\x3d"!==c)throw Error("Invalid Parameter");a.setField(b,this.assign(d,c,null))}}else{if(h.isImmutableArray(a))throw Error("Array is Immutable");
throw Error("Invalid Parameter");}},member:function(a,b){if(null===a)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","NOTFOUND"));if(a instanceof k||a instanceof e){if(h.isString(b))return a.field(b)}else if(a instanceof t){if(h.isString(b))return M(a,b,"MemberExpression")}else if(h.isArray(a)){if(h.isNumber(b)&&isFinite(b)&&Math.floor(b)===b){0>b&&(b=a.length+b);if(b>=a.length||0>b)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return a[b]}}else if(h.isString(a)){if(h.isNumber(b)&&
isFinite(b)&&Math.floor(b)===b){0>b&&(b=a.length+b);if(b>=a.length||0>b)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return a[b]}}else if(h.isImmutableArray(a)&&h.isNumber(b)&&isFinite(b)&&Math.floor(b)===b){0>b&&(b=a.length()+b);if(b>=a.length()||0>b)throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","OUTOFBOUNDS"));return a.get(b)}throw Error(c.nodeErrorMessage("MemberExpression","RUNTIME","INVALIDTYPE"));},callfunc:function(a,b,c){return a instanceof h.NativeFunction?
a.fn(c,b):a instanceof h.SizzleFunction?a.fn.apply(this,b):a.apply(this,b)}};f.compileScript=function(a,b){void 0===b&&(b=null);null===b&&(b={vars:{},customfunctions:{}});b={globalScope:K(b.vars,L,b.customfunctions),localScope:null,console:R,symbols:{symbolCounter:0}};a=A(b,a.body[0].body);""===a&&(a="lc.voidOperation;");b={lc:h,lang:W,postProcess:function(a){a instanceof h.ReturnResult&&(a=a.value);a instanceof h.ImplicitResult&&(a=a.value);a===h.voidOperation&&(a=null);if(a===h.breakResult)throw Error("Cannot return BREAK");
if(a===h.continueResult)throw Error("Cannot return CONTINUE");if(h.isFunctionParameter(a))throw Error("Cannot return FUNCTION");return a},prepare:function(a,b){b||(b=new z({wkid:102100}));var c=a.vars,d=a.customfunctions,l=new S;c||(c={});d||(d={});var h=new k({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});h.immutable=!1;l._SymbolsMap={textformatting:1,infinity:1,pi:1};l.textformatting=h;l.infinity=Number.POSITIVE_INFINITY;l.pi=Math.PI;for(var g in d)l[g]=
d[g],l._SymbolsMap[g]=1;for(g in c)l._SymbolsMap[g]=1,l[g]=c[g]&&"esri.Graphic"===c[g].declaredClass?e.createFromGraphic(c[g]):c[g];return{spatialReference:b,globalScope:l,localScope:null,console:a.console?a.console:R,symbols:{symbolCounter:0},depthCounter:1,applicationCache:void 0===a.applicationCache?null:a.applicationCache}}};return(new Function("context","spatialReference","var runtimeCtx\x3dthis.prepare(context, spatialReference);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n "+
a+"\n return lastStatement; } \n return this.postProcess(mainBody());")).bind(b)}})},"esri/arcade/Dictionary":function(){define(["require","exports","./ImmutableArray","./languageUtils","../geometry/Geometry"],function(m,f,k,e,g){return function(){function d(e){this.attributes=null;this.plain=!1;this.immutable=!0;this.attributes=e instanceof d?e.attributes:void 0===e?{}:null===e?{}:e}d.prototype.field=function(d){var c=d.toLowerCase();d=this.attributes[d];if(void 0!==d)return d;for(var b in this.attributes)if(b.toLowerCase()===
c)return this.attributes[b];throw Error("Field not Found");};d.prototype.setField=function(d,c){if(this.immutable)throw Error("Dictionary is Immutable");var b=d.toLowerCase();if(void 0===this.attributes[d])for(var a in this.attributes)if(a.toLowerCase()===b){this.attributes[a]=c;return}this.attributes[d]=c};d.prototype.hasField=function(d){var c=d.toLowerCase();if(void 0!==this.attributes[d])return!0;for(var b in this.attributes)if(b.toLowerCase()===c)return!0;return!1};d.prototype.keys=function(){var d=
[],c;for(c in this.attributes)d.push(c);return d=d.sort()};d.prototype.castToText=function(){var d="",c;for(c in this.attributes){""!==d&&(d+=",");var b=this.attributes[c];null==b?d+=JSON.stringify(c)+":null":e.isBoolean(b)||e.isNumber(b)||e.isString(b)?d+=JSON.stringify(c)+":"+JSON.stringify(b):b instanceof g?d+=JSON.stringify(c)+":"+e.toStringExplicit(b):b instanceof k?d+=JSON.stringify(c)+":"+e.toStringExplicit(b):b instanceof Array?d+=JSON.stringify(c)+":"+e.toStringExplicit(b):b instanceof Date?
d+=JSON.stringify(c)+":"+JSON.stringify(b):null!==b&&"object"===typeof b&&void 0!==b.castToText&&(d+=JSON.stringify(c)+":"+b.castToText())}return"{"+d+"}"};return d}()})},"esri/arcade/ImmutableArray":function(){define(["require","exports"],function(m,f){return function(){function k(e){void 0===e&&(e=[]);this._elements=e}k.prototype.length=function(){return this._elements.length};k.prototype.get=function(e){return this._elements[e]};k.prototype.toArray=function(){for(var e=[],g=0;g<this.length();g++)e.push(this.get(g));
return e};return k}()})},"esri/arcade/languageUtils":function(){define("require exports dojo/number ../kernel ../moment ./FunctionWrapper ./ImmutableArray ./ImmutablePathArray ./ImmutablePointArray ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){function t(a,b,c){if(""===b||null===b||void 0===b||b===c||b===c)return a;do a=a.replace(b,c);while(-1!==a.indexOf(b));return a}function w(a){return a instanceof
Q||a instanceof d||a instanceof H}function u(a){return"string"===typeof a||a instanceof String}function x(a){return"boolean"===typeof a}function v(a){return"number"===typeof a}function z(a){return a instanceof Array}function y(a){return a instanceof Date}function A(a,b){if(!1===isNaN(a)){if(void 0===b||null===b||""===b)return a.toString();b=t(b,"\u2030","");b=t(b,"\u00a4","");return k.format(a,{pattern:b})}return a.toString()}function B(a,b){a=g(a);return void 0===b||null===b||""===b?a.format():a.format(C(b))}
function C(a){return a.replace(/(LTS)|L|l/g,function(a){return"["+a+"]"})}function E(a,b,c){switch(c){case "\x3e":return a>b;case "\x3c":return a<b;case "\x3e\x3d":return a>=b;case "\x3c\x3d":return a<=b}return!1}function D(a,d){if(a===d||null===a&&d===f.voidOperation||null===d&&a===f.voidOperation)return!0;if(y(a)&&y(d))return a.getTime()===d.getTime();if(a instanceof c||a instanceof b)return a.equalityTest(d);if(a instanceof p&&d instanceof p){var e=void 0,l=void 0;f.isVersion4?(e=a.cache._arcadeCacheId,
l=d.cache._arcadeCacheId):(e=a.getCacheValue("_arcadeCacheId"),l=d.getCacheValue("_arcadeCacheId"));if(void 0!==e&&null!==e)return e===l}return void 0!==a&&void 0!==d&&null!==a&&null!==d&&"object"===typeof a&&"object"===typeof d&&(a._arcadeCacheId===d._arcadeCacheId&&void 0!==a._arcadeCacheId&&null!==a._arcadeCacheId||a._underlyingGraphic===d._underlyingGraphic&&void 0!==a._underlyingGraphic&&null!==a._underlyingGraphic)?!0:!1}function F(a,b){if(u(a))return a;if(null===a)return"";if(v(a))return A(a,
b);if(x(a))return a.toString();if(y(a))return B(a,b);if(a instanceof l)return JSON.stringify(a.toJSON());if(z(a)){b=[];for(var c=0;c<a.length;c++)b[c]=N(a[c]);return"["+b.join(",")+"]"}if(a instanceof h){b=[];for(c=0;c<a.length();c++)b[c]=N(a.get(c));return"["+b.join(",")+"]"}return null!==a&&"object"===typeof a&&void 0!==a.castToText?a.castToText():w(a)?"object, Function":""}function M(b,c){if(u(b))return b;if(null===b)return"";if(v(b))return A(b,c);if(x(b))return b.toString();if(y(b))return B(b,
c);if(b instanceof l)return b instanceof a?'{"xmin":'+b.xmin.toString()+',"ymin":'+b.ymin.toString()+","+(b.hasZ?'"zmin":'+b.zmin.toString()+",":"")+(b.hasM?'"mmin":'+b.mmin.toString()+",":"")+'"xmax":'+b.xmax.toString()+',"ymax":'+b.ymax.toString()+","+(b.hasZ?'"zmax":'+b.zmax.toString()+",":"")+(b.hasM?'"mmax":'+b.mmax.toString()+",":"")+'"spatialReference":'+O(b.spatialReference)+"}":O(b.toJSON(),function(a,b){return a.key===b.key?0:"spatialReference"===a.key?1:"spatialReference"===b.key||a.key<
b.key?-1:a.key>b.key?1:0});if(z(b)){c=[];for(var d=0;d<b.length;d++)c[d]=N(b[d]);return"["+c.join(",")+"]"}if(b instanceof h){c=[];for(d=0;d<b.length();d++)c[d]=N(b.get(d));return"["+c.join(",")+"]"}return null!==b&&"object"===typeof b&&void 0!==b.castToText?b.castToText():w(b)?"object, Function":""}function N(a){if(null!==a){if(x(a)||v(a)||u(a))return JSON.stringify(a);if(a instanceof l||a instanceof h||a instanceof Array)return M(a);if(a instanceof Date)return JSON.stringify(B(a,""));if(null!==
a&&"object"===typeof a&&void 0!==a.castToText)return a.castToText()}return"null"}function I(a,b){return v(a)?a:null===a||""===a?0:y(a)?NaN:x(a)?a?1:0:z(a)||""===a||void 0===a?NaN:void 0!==b&&u(a)?(b=t(b,"\u2030",""),b=t(b,"\u00a4",""),k.parse(a,{pattern:b})):a===f.voidOperation?0:Number(a)}function G(a,b){var c;b.fields.some(function(b){b.name===a&&(c=b.domain);return!!c});return c}function O(a,b){b||(b={});"function"===typeof b&&(b={cmp:b});var c="boolean"===typeof b.cycles?b.cycles:!1,d=b.cmp&&
function(a){return function(b){return function(c,d){return a({key:c,value:b[c]},{key:d,value:b[d]})}}}(b.cmp),e=[];return function W(a){a&&a.toJSON&&"function"===typeof a.toJSON&&(a=a.toJSON());if(void 0!==a){if("number"===typeof a)return isFinite(a)?""+a:"null";if("object"!==typeof a)return JSON.stringify(a);var b,l;if(Array.isArray(a)){l="[";for(b=0;b<a.length;b++)b&&(l+=","),l+=W(a[b])||"null";return l+"]"}if(null===a)return"null";if(-1!==e.indexOf(a)){if(c)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");
}var h=e.push(a)-1,g=Object.keys(a).sort(d&&d(a));l="";for(b=0;b<g.length;b++){var n=g[b],k=W(a[n]);k&&(l&&(l+=","),l+=JSON.stringify(n)+":"+k)}e.splice(h,1);return"{"+l+"}"}}(a)}Object.defineProperty(f,"__esModule",{value:!0});m=function(){return function(a){this.value=a}}();var J=function(){return function(a){this.value=a}}(),Q=function(){return function(a){this.fn=a}}(),H=function(){return function(a){this.fn=a}}();f.NativeFunction=Q;f.ImplicitResult=J;f.ReturnResult=m;f.SizzleFunction=H;f.isVersion4=
0===e.version.indexOf("4.");f.voidOperation={type:"VOID"};f.breakResult={type:"BREAK"};f.continueResult={type:"CONTINUE"};f.multiReplace=t;f.isFunctionParameter=w;f.isSimpleType=function(a){return u(a)||v(a)||y(a)||x(a)||null===a||a===f.voidOperation||"number"===typeof a?!0:!1};f.defaultUndefined=function(a,b){return void 0===a?b:a};f.isString=u;f.isBoolean=x;f.isNumber=v;f.isArray=z;f.isFeatureCursor=function(a){return a&&void 0!==a.isFeatureCursor};f.isImmutableArray=function(a){return a instanceof
h};f.isDate=y;f.pcCheck=function(a,b,c){if(a.length<b||a.length>c)throw Error("Function called with wrong number of Parameters");};f.generateUUID=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===b?c:c&3|8).toString(16)})};f.formatNumber=A;f.formatDate=B;f.standardiseDateFormat=C;f.greaterThanLessThan=function(a,b,c){if(null===a){if(null===b||b===f.voidOperation)return E(null,
null,c);if(v(b))return E(0,b,c);if(u(b)||x(b))return E(0,I(b),c);if(y(b))return E(0,b.getTime(),c)}if(a===f.voidOperation){if(null===b||b===f.voidOperation)return E(null,null,c);if(v(b))return E(0,b,c);if(u(b)||x(b))return E(0,I(b),c);if(y(b))return E(0,b.getTime(),c)}else if(v(a)){if(v(b))return E(a,b,c);if(x(b))return E(a,I(b),c);if(null===b||b===f.voidOperation)return E(a,0,c);if(u(b))return E(a,I(b),c);if(y(b))return E(a,b.getTime(),c)}else if(u(a)){if(u(b))return E(F(a),F(b),c);if(y(b))return E(I(a),
b.getTime(),c);if(v(b))return E(I(a),b,c);if(null===b||b===f.voidOperation)return E(I(a),0,c);if(x(b))return E(I(a),I(b),c)}else if(y(a)){if(y(b))return E(a,b,c);if(null===b||b===f.voidOperation)return E(a.getTime(),0,c);if(v(b))return E(a.getTime(),b,c);if(x(b)||u(b))return E(a.getTime(),I(b),c)}else if(x(a)){if(x(b))return E(a,b,c);if(v(b))return E(I(a),I(b),c);if(y(b))return E(I(a),b.getTime(),c);if(null===b||b===f.voidOperation)return E(I(a),0,c);if(u(b))return E(I(a),I(b),c)}return!D(a,b)||"\x3c\x3d"!==
c&&"\x3e\x3d"!==c?!1:!0};f.equalityTest=D;f.toString=F;f.toNumberArray=function(a){var b=[];if(!1===z(a))return null;if(a instanceof h){for(var c=0;c<a.length();c++)b[c]=I(a.get(c));return b}for(c=0;c<a.length;c++)b[c]=I(a[c]);return b};f.toStringExplicit=M;f.toNumber=I;f.toDate=function(a,b){return y(a)?a:u(a)&&(a=g(a,[void 0===b||null===b||""===b?g.ISO_8601:b]),a.isValid())?a.toDate():null};f.toDateM=function(a,b){return y(a)?g(a):u(a)&&(a=g(a,[void 0===b||null===b||""===b?g.ISO_8601:b]),a.isValid())?
a:null};f.toBoolean=function(a){if(x(a))return a;if(u(a)){if(a=a.toLowerCase(),"true"===a)return!0}else if(v(a))return 0===a||isNaN(a)?!1:!0;return!1};f.fixSpatialReference=function(a,b){if(null===a||void 0===a)return null;if(null===a.spatialReference||void 0===a.spatialReference)a.spatialReference=b;return a};f.fixNullGeometry=function(b){return null===b?null:b instanceof p?"NaN"===b.x||null===b.x||isNaN(b.x)?null:b:b instanceof q?0===b.rings.length?null:b:b instanceof r?0===b.paths.length?null:
b:b instanceof n?0===b.points.length?null:b:b instanceof a?"NaN"===b.xmin||null===b.xmin||isNaN(b.xmin)?null:b:null};f.getDomainValue=function(a,b){if(!a||!a.domain)return null;var c=null;b="string"===a.field.type||"esriFieldTypeString"===a.field.type?F(b):I(b);for(var d=0;d<a.domain.codedValues.length;d++){var e=a.domain.codedValues[d];e.code===b&&(c=e)}return null===c?null:c.name};f.getDomainCode=function(a,b){if(!a||!a.domain)return null;var c=null;b=F(b);for(var d=0;d<a.domain.codedValues.length;d++){var e=
a.domain.codedValues[d];e.name===b&&(c=e)}return null===c?null:c.code};f.getDomain=function(a,b,c,d){void 0===c&&(c=null);if(!b||!b.fields)return null;for(var e=null,l=0;l<b.fields.length;l++){var h=b.fields[l];h.name.toLowerCase()===a.toString().toLowerCase()&&(e=h)}if(null===e)return null;var g,n;d||(d=c&&b.typeIdField&&c._field(b.typeIdField));null!=d&&b.types.some(function(a){return a.id===d?((g=a.domains&&a.domains[e.name])&&"inherited"===g.type&&(g=G(e.name,b),n=!0),!0):!1});n||g||(g=G(a,b));
return{field:e,domain:g}};f.stableStringify=O;f.autoCastFeatureToGeometry=function(a){if(null===a)return null;for(var b=[],c=0;c<a.length;c++){var d=a[c];d&&d.declaredClass&&"esri.arcade.Feature"===d.declaredClass?b.push(d.geometry()):b.push(d)}return b}})},"esri/moment":function(){define(["require","exports","./plugins/moment!"],function(m,f,k){return k})},"esri/plugins/moment":function(){define(["require","exports","dojo/_base/kernel","moment/moment"],function(m,f,k,e){Object.defineProperty(f,"__esModule",
{value:!0});var g={ar:1,"ar-dz":1,"ar-kw":1,"ar-ly":1,"ar-ma":1,"ar-sa":1,"ar-tn":1,bs:1,ca:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":1,"en-gb":1,"en-ie":1,"en-il":1,"en-nz":1,es:1,"es-do":1,"es-us":1,et:1,fi:1,fr:1,"fr-ca":1,"fr-ch":1,he:1,hi:1,hr:1,hu:1,id:1,it:1,ja:1,ko:1,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,sl:1,sr:1,"sr-cyrl":1,sv:1,th:1,tr:1,vi:1,"zh-cn":1,"zh-hk":1,"zh-tw":1};f.load=function(d,h,c){d=k.locale;var b=d in g;if(!b){var a=d.split("-");1<
a.length&&a[0]in g&&(d=a[0],b=!0)}b?h(["moment/locale/"+d],function(){c(e)}):c(e)}})},"moment/moment":function(){(function(m,f){"object"===typeof exports&&"undefined"!==typeof module?module.exports=f():"function"===typeof define&&define.amd?define(f):m.moment=f()})(this,function(){function m(){return Vb.apply(null,arguments)}function f(a){return a instanceof Array||"[object Array]"===Object.prototype.toString.call(a)}function k(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)}
function e(a){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function g(a){return void 0===a}function d(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)}function h(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function c(a,b){var c=[],d;for(d=0;d<a.length;++d)c.push(b(a[d],d));return c}function b(a,b){return Object.prototype.hasOwnProperty.call(a,
b)}function a(a,c){for(var d in c)b(c,d)&&(a[d]=c[d]);b(c,"toString")&&(a.toString=c.toString);b(c,"valueOf")&&(a.valueOf=c.valueOf);return a}function l(a,b,c,d){return eb(a,b,c,d,!0).utc()}function n(a){null==a._pf&&(a._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1});return a._pf}function p(a){if(null==a._isValid){var b=n(a),c=Wb.call(b.parsedDateParts,
function(a){return null!=a}),c=!isNaN(a._d.getTime())&&0>b.overflow&&!b.empty&&!b.invalidMonth&&!b.invalidWeekday&&!b.weekdayMismatch&&!b.nullInput&&!b.invalidFormat&&!b.userInvalidated&&(!b.meridiem||b.meridiem&&c);a._strict&&(c=c&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour);if(null!=Object.isFrozen&&Object.isFrozen(a))return c;a._isValid=c}return a._isValid}function q(b){var c=l(NaN);null!=b?a(n(c),b):n(c).userInvalidated=!0;return c}function r(a,b){var c,d,e;g(b._isAMomentObject)||
(a._isAMomentObject=b._isAMomentObject);g(b._i)||(a._i=b._i);g(b._f)||(a._f=b._f);g(b._l)||(a._l=b._l);g(b._strict)||(a._strict=b._strict);g(b._tzm)||(a._tzm=b._tzm);g(b._isUTC)||(a._isUTC=b._isUTC);g(b._offset)||(a._offset=b._offset);g(b._pf)||(a._pf=n(b));g(b._locale)||(a._locale=b._locale);if(0<Hb.length)for(c=0;c<Hb.length;c++)d=Hb[c],e=b[d],g(e)||(a[d]=e);return a}function t(a){r(this,a);this._d=new Date(null!=a._d?a._d.getTime():NaN);this.isValid()||(this._d=new Date(NaN));!1===Ib&&(Ib=!0,m.updateOffset(this),
Ib=!1)}function w(a){return a instanceof t||null!=a&&null!=a._isAMomentObject}function u(a){return 0>a?Math.ceil(a)||0:Math.floor(a)}function x(a){a=+a;var b=0;0!==a&&isFinite(a)&&(b=u(a));return b}function v(a,b,c){var d=Math.min(a.length,b.length),e=Math.abs(a.length-b.length),l=0,h;for(h=0;h<d;h++)(c&&a[h]!==b[h]||!c&&x(a[h])!==x(b[h]))&&l++;return l+e}function z(a){!1===m.suppressDeprecationWarnings&&"undefined"!==typeof console&&console.warn&&console.warn("Deprecation warning: "+a)}function y(b,
c){var d=!0;return a(function(){null!=m.deprecationHandler&&m.deprecationHandler(null,b);if(d){for(var a=[],e,l=0;l<arguments.length;l++){e="";if("object"===typeof arguments[l]){e+="\n["+l+"] ";for(var h in arguments[0])e+=h+": "+arguments[0][h]+", ";e=e.slice(0,-2)}else e=arguments[l];a.push(e)}z(b+"\nArguments: "+Array.prototype.slice.call(a).join("")+"\n"+Error().stack);d=!1}return c.apply(this,arguments)},c)}function A(a,b){null!=m.deprecationHandler&&m.deprecationHandler(a,b);Xb[a]||(z(b),Xb[a]=
!0)}function B(a){return a instanceof Function||"[object Function]"===Object.prototype.toString.call(a)}function C(c,d){var e=a({},c),l;for(l in d)b(d,l)&&(k(c[l])&&k(d[l])?(e[l]={},a(e[l],c[l]),a(e[l],d[l])):null!=d[l]?e[l]=d[l]:delete e[l]);for(l in c)b(c,l)&&!b(d,l)&&k(c[l])&&(e[l]=a({},e[l]));return e}function E(a){null!=a&&this.set(a)}function D(a,b){var c=a.toLowerCase();ob[c]=ob[c+"s"]=ob[b]=a}function F(a){return"string"===typeof a?ob[a]||ob[a.toLowerCase()]:void 0}function M(a){var c={},
d,e;for(e in a)b(a,e)&&(d=F(e))&&(c[d]=a[e]);return c}function N(a){var b=[],c;for(c in a)b.push({unit:c,priority:Ma[c]});b.sort(function(a,b){return a.priority-b.priority});return b}function I(a,b,c){var d=""+Math.abs(a);return(0<=a?c?"+":"":"-")+Math.pow(10,Math.max(0,b-d.length)).toString().substr(1)+d}function G(a,b,c,d){var e=d;"string"===typeof d&&(e=function(){return this[d]()});a&&(lb[a]=e);b&&(lb[b[0]]=function(){return I(e.apply(this,arguments),b[1],b[2])});c&&(lb[c]=function(){return this.localeData().ordinal(e.apply(this,
arguments),a)})}function O(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function J(a){var b=a.match(Yb),c,d;c=0;for(d=b.length;c<d;c++)b[c]=lb[b[c]]?lb[b[c]]:O(b[c]);return function(c){var e="",l;for(l=0;l<d;l++)e+=B(b[l])?b[l].call(c,a):b[l];return e}}function Q(a,b){if(!a.isValid())return a.localeData().invalidDate();b=H(b,a.localeData());Jb[b]=Jb[b]||J(b);return Jb[b](a)}function H(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(zb.lastIndex=0;0<=d&&zb.test(a);)a=
a.replace(zb,c),zb.lastIndex=0,--d;return a}function K(a,b,c){Kb[a]=B(b)?b:function(a,d){return a&&c?c:b}}function R(a,c){return b(Kb,a)?Kb[a](c._strict,c._locale):new RegExp(P(a))}function P(a){return L(a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}))}function L(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$\x26")}function T(a,b){var c,e=b;"string"===typeof a&&(a=[a]);d(b)&&(e=function(a,c){c[b]=x(a)});for(c=0;c<a.length;c++)Lb[a[c]]=e}
function S(a,b){T(a,function(a,c,d,e){d._w=d._w||{};b(a,d._w,d,e)})}function W(a){return 0===a%4&&0!==a%100||0===a%400}function Y(a,b){return function(c){return null!=c?(aa(this,a,c),m.updateOffset(this,b),this):X(this,a)}}function X(a,b){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+b]():NaN}function aa(a,b,c){if(a.isValid()&&!isNaN(c))if("FullYear"===b&&W(a.year())&&1===a.month()&&29===a.date())a._d["set"+(a._isUTC?"UTC":"")+b](c,a.month(),U(c,a.month()));else a._d["set"+(a._isUTC?"UTC":"")+
b](c)}function U(a,b){if(isNaN(a)||isNaN(b))return NaN;var c=(b%12+12)%12;return 1===c?W(a+(b-c)/12)?29:28:31-c%7%2}function ha(a,b){var c;if(!a.isValid())return a;if("string"===typeof b)if(/^\d+$/.test(b))b=x(b);else if(b=a.localeData().monthsParse(b),!d(b))return a;c=Math.min(a.date(),U(a.year(),b));a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c);return a}function Z(a){return null!=a?(ha(this,a),m.updateOffset(this,!0),this):X(this,"Month")}function ba(){function a(a,b){return b.length-a.length}var b=
[],c=[],d=[],e,h;for(e=0;12>e;e++)h=l([2E3,e]),b.push(this.monthsShort(h,"")),c.push(this.months(h,"")),d.push(this.months(h,"")),d.push(this.monthsShort(h,""));b.sort(a);c.sort(a);d.sort(a);for(e=0;12>e;e++)b[e]=L(b[e]),c[e]=L(c[e]);for(e=0;24>e;e++)d[e]=L(d[e]);this._monthsShortRegex=this._monthsRegex=new RegExp("^("+d.join("|")+")","i");this._monthsStrictRegex=new RegExp("^("+c.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+b.join("|")+")","i")}function ka(a,b,c,d,e,l,h){b=new Date(a,
b,c,d,e,l,h);100>a&&0<=a&&isFinite(b.getFullYear())&&b.setFullYear(a);return b}function ga(a){var b=new Date(Date.UTC.apply(null,arguments));100>a&&0<=a&&isFinite(b.getUTCFullYear())&&b.setUTCFullYear(a);return b}function ia(a,b,c){c=7+b-c;return-((7+ga(a,0,c).getUTCDay()-b)%7)+c-1}function na(a,b,c,d,e){c=(7+c-d)%7;d=ia(a,d,e);d=1+7*(b-1)+c+d;0>=d?(b=a-1,a=(W(b)?366:365)+d):d>(W(a)?366:365)?(b=a+1,a=d-(W(a)?366:365)):(b=a,a=d);return{year:b,dayOfYear:a}}function wa(a,b,c){var d=ia(a.year(),b,c),
d=Math.floor((a.dayOfYear()-d-1)/7)+1;1>d?(a=a.year()-1,b=d+za(a,b,c)):d>za(a.year(),b,c)?(b=d-za(a.year(),b,c),a=a.year()+1):(a=a.year(),b=d);return{week:b,year:a}}function za(a,b,c){var d=ia(a,b,c);b=ia(a+1,b,c);return((W(a)?366:365)-d+b)/7}function Aa(a,b,c){var d,e;a=a.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],d=0;7>d;++d)e=l([2E3,1]).day(d),this._minWeekdaysParse[d]=this.weekdaysMin(e,"").toLocaleLowerCase(),this._shortWeekdaysParse[d]=
this.weekdaysShort(e,"").toLocaleLowerCase(),this._weekdaysParse[d]=this.weekdays(e,"").toLocaleLowerCase();if(c)b="dddd"===b?Ia.call(this._weekdaysParse,a):"ddd"===b?Ia.call(this._shortWeekdaysParse,a):Ia.call(this._minWeekdaysParse,a);else if("dddd"===b){b=Ia.call(this._weekdaysParse,a);if(-1!==b)return b;b=Ia.call(this._shortWeekdaysParse,a);if(-1!==b)return b;b=Ia.call(this._minWeekdaysParse,a)}else if("ddd"===b){b=Ia.call(this._shortWeekdaysParse,a);if(-1!==b)return b;b=Ia.call(this._weekdaysParse,
a);if(-1!==b)return b;b=Ia.call(this._minWeekdaysParse,a)}else{b=Ia.call(this._minWeekdaysParse,a);if(-1!==b)return b;b=Ia.call(this._weekdaysParse,a);if(-1!==b)return b;b=Ia.call(this._shortWeekdaysParse,a)}return-1!==b?b:null}function sa(){function a(a,b){return b.length-a.length}var b=[],c=[],d=[],e=[],h,g,n,k;for(h=0;7>h;h++)g=l([2E3,1]).day(h),n=this.weekdaysMin(g,""),k=this.weekdaysShort(g,""),g=this.weekdays(g,""),b.push(n),c.push(k),d.push(g),e.push(n),e.push(k),e.push(g);b.sort(a);c.sort(a);
d.sort(a);e.sort(a);for(h=0;7>h;h++)c[h]=L(c[h]),d[h]=L(d[h]),e[h]=L(e[h]);this._weekdaysMinRegex=this._weekdaysShortRegex=this._weekdaysRegex=new RegExp("^("+e.join("|")+")","i");this._weekdaysStrictRegex=new RegExp("^("+d.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+c.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+b.join("|")+")","i")}function ma(){return this.hours()%12||12}function Ea(a,b){G(a,0,0,function(){return this.localeData().meridiem(this.hours(),
this.minutes(),b)})}function Ha(a,b){return b._meridiemParse}function Na(a){return a?a.toLowerCase().replace("_","-"):a}function xa(a){var b=null;if(!Ka[a]&&"undefined"!==typeof module&&module&&module.exports)try{b=pb._abbr,require("./locale/"+a),ya(b)}catch(Wc){}return Ka[a]}function ya(a,b){a&&((b=g(b)?Ca(a):Ga(a,b))?pb=b:"undefined"!==typeof console&&console.warn&&console.warn("Locale "+a+" not found. Did you forget to load it?"));return pb._abbr}function Ga(a,b){if(null!==b){var c;c=Zb;b.abbr=
a;if(null!=Ka[a])A("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),c=Ka[a]._config;else if(null!=b.parentLocale)if(null!=Ka[b.parentLocale])c=Ka[b.parentLocale]._config;else if(c=xa(b.parentLocale),null!=c)c=c._config;else return qb[b.parentLocale]||(qb[b.parentLocale]=[]),qb[b.parentLocale].push({name:a,
config:b}),null;Ka[a]=new E(C(c,b));qb[a]&&qb[a].forEach(function(a){Ga(a.name,a.config)});ya(a);return Ka[a]}delete Ka[a];return null}function Ca(a){var b;a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr);if(!a)return pb;if(!f(a)){if(b=xa(a))return b;a=[a]}a:{b=0;for(var c,d,e,l;b<a.length;){l=Na(a[b]).split("-");c=l.length;for(d=(d=Na(a[b+1]))?d.split("-"):null;0<c;){if(e=xa(l.slice(0,c).join("-"))){a=e;break a}if(d&&d.length>=c&&v(l,d,!0)>=c-1)break;c--}b++}a=pb}return a}function Pa(a){var b;
(b=a._a)&&-2===n(a).overflow&&(b=0>b[ab]||11<b[ab]?ab:1>b[Ya]||b[Ya]>U(b[Wa],b[ab])?Ya:0>b[La]||24<b[La]||24===b[La]&&(0!==b[Xa]||0!==b[bb]||0!==b[ib])?La:0>b[Xa]||59<b[Xa]?Xa:0>b[bb]||59<b[bb]?bb:0>b[ib]||999<b[ib]?ib:-1,n(a)._overflowDayOfYear&&(b<Wa||b>Ya)&&(b=Ya),n(a)._overflowWeeks&&-1===b&&(b=mc),n(a)._overflowWeekday&&-1===b&&(b=nc),n(a).overflow=b);return a}function Ja(a,b,c){return null!=a?a:null!=b?b:c}function Ua(a){var b,c=[],d;if(!a._d){d=new Date(m.now());d=a._useUTC?[d.getUTCFullYear(),
d.getUTCMonth(),d.getUTCDate()]:[d.getFullYear(),d.getMonth(),d.getDate()];if(a._w&&null==a._a[Ya]&&null==a._a[ab]){var e,l,h,g,k,p;e=a._w;if(null!=e.GG||null!=e.W||null!=e.E){if(k=1,p=4,l=Ja(e.GG,a._a[Wa],wa(ca(),1,4).year),h=Ja(e.W,1),g=Ja(e.E,1),1>g||7<g)b=!0}else if(k=a._locale._week.dow,p=a._locale._week.doy,h=wa(ca(),k,p),l=Ja(e.gg,a._a[Wa],h.year),h=Ja(e.w,h.week),null!=e.d){if(g=e.d,0>g||6<g)b=!0}else if(null!=e.e){if(g=e.e+k,0>e.e||6<e.e)b=!0}else g=k;1>h||h>za(l,k,p)?n(a)._overflowWeeks=
!0:null!=b?n(a)._overflowWeekday=!0:(b=na(l,h,g,k,p),a._a[Wa]=b.year,a._dayOfYear=b.dayOfYear)}if(null!=a._dayOfYear){b=Ja(a._a[Wa],d[Wa]);if(a._dayOfYear>(W(b)?366:365)||0===a._dayOfYear)n(a)._overflowDayOfYear=!0;b=ga(b,0,a._dayOfYear);a._a[ab]=b.getUTCMonth();a._a[Ya]=b.getUTCDate()}for(b=0;3>b&&null==a._a[b];++b)a._a[b]=c[b]=d[b];for(;7>b;b++)a._a[b]=c[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[La]&&0===a._a[Xa]&&0===a._a[bb]&&0===a._a[ib]&&(a._nextDay=!0,a._a[La]=0);a._d=(a._useUTC?ga:ka).apply(null,
c);c=a._useUTC?a._d.getUTCDay():a._d.getDay();null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm);a._nextDay&&(a._a[La]=24);a._w&&"undefined"!==typeof a._w.d&&a._w.d!==c&&(n(a).weekdayMismatch=!0)}}function ea(a){var b,c;b=a._i;var d=oc.exec(b)||pc.exec(b),e,l,h,g;if(d){n(a).iso=!0;b=0;for(c=Ab.length;b<c;b++)if(Ab[b][1].exec(d[1])){l=Ab[b][0];e=!1!==Ab[b][2];break}if(null==l)a._isValid=!1;else{if(d[3]){b=0;for(c=Mb.length;b<c;b++)if(Mb[b][1].exec(d[3])){h=(d[2]||" ")+Mb[b][0];break}if(null==
h){a._isValid=!1;return}}if(e||null==h){if(d[4])if(qc.exec(d[4]))g="Z";else{a._isValid=!1;return}a._f=l+(h||"")+(g||"");pa(a)}else a._isValid=!1}}else a._isValid=!1}function Oa(a){var b=rc.exec(a._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(b){var c=b[3],d=b[2],e=b[5],l=b[6],h=b[7],g=parseInt(b[4],10),c=[49>=g?2E3+g:999>=g?1900+g:g,$b.indexOf(c),parseInt(d,10),parseInt(e,10),parseInt(l,10)];h&&c.push(parseInt(h,10));a:{if(h=b[1])if(h=ac.indexOf(h),d=(new Date(c[0],c[1],c[2])).getDay(),
h!==d){n(a).weekdayMismatch=!0;h=a._isValid=!1;break a}h=!0}h&&(a._a=c,(h=b[8])?b=sc[h]:b[9]?b=0:(b=parseInt(b[10],10),h=b%100,b=(b-h)/100*60+h),a._tzm=b,a._d=ga.apply(null,a._a),a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),n(a).rfc2822=!0)}else a._isValid=!1}function Fa(a){var b=tc.exec(a._i);null!==b?a._d=new Date(+b[1]):(ea(a),!1===a._isValid&&(delete a._isValid,Oa(a),!1===a._isValid&&(delete a._isValid,m.createFromInputFallback(a))))}function pa(a){if(a._f===m.ISO_8601)ea(a);else if(a._f===
m.RFC_2822)Oa(a);else{a._a=[];n(a).empty=!0;var c=""+a._i,d,e,l,h,g,k=c.length,p=0;l=H(a._f,a._locale).match(Yb)||[];for(d=0;d<l.length;d++){h=l[d];if(e=(c.match(R(h,a))||[])[0])g=c.substr(0,c.indexOf(e)),0<g.length&&n(a).unusedInput.push(g),c=c.slice(c.indexOf(e)+e.length),p+=e.length;if(lb[h]){if(e?n(a).empty=!1:n(a).unusedTokens.push(h),g=a,null!=e&&b(Lb,h))Lb[h](e,g._a,g,h)}else a._strict&&!e&&n(a).unusedTokens.push(h)}n(a).charsLeftOver=k-p;0<c.length&&n(a).unusedInput.push(c);12>=a._a[La]&&
!0===n(a).bigHour&&0<a._a[La]&&(n(a).bigHour=void 0);n(a).parsedDateParts=a._a.slice(0);n(a).meridiem=a._meridiem;c=a._a;d=La;k=a._locale;l=a._a[La];p=a._meridiem;null!=p&&(null!=k.meridiemHour?l=k.meridiemHour(l,p):null!=k.isPM&&((k=k.isPM(p))&&12>l&&(l+=12),k||12!==l||(l=0)));c[d]=l;Ua(a);Pa(a)}}function Ta(a){if(!a._d){var b=M(a._i);a._a=c([b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],function(a){return a&&parseInt(a,10)});Ua(a)}}function Qa(b){var c=b._i,d=b._f;b._locale=
b._locale||Ca(b._l);if(null===c||void 0===d&&""===c)return q({nullInput:!0});"string"===typeof c&&(b._i=c=b._locale.preparse(c));if(w(c))return new t(Pa(c));if(h(c))b._d=c;else if(f(d)){var e,l,g;if(0===b._f.length)n(b).invalidFormat=!0,b._d=new Date(NaN);else{for(c=0;c<b._f.length;c++)if(d=0,e=r({},b),null!=b._useUTC&&(e._useUTC=b._useUTC),e._f=b._f[c],pa(e),p(e)&&(d+=n(e).charsLeftOver,d+=10*n(e).unusedTokens.length,n(e).score=d,null==g||d<g))g=d,l=e;a(b,l||e)}}else d?pa(b):ra(b);p(b)||(b._d=null);
return b}function ra(a){var b=a._i;g(b)?a._d=new Date(m.now()):h(b)?a._d=new Date(b.valueOf()):"string"===typeof b?Fa(a):f(b)?(a._a=c(b.slice(0),function(a){return parseInt(a,10)}),Ua(a)):k(b)?Ta(a):d(b)?a._d=new Date(b):m.createFromInputFallback(a)}function eb(a,b,c,d,l){var h={};if(!0===c||!1===c)d=c,c=void 0;if(k(a)&&e(a)||f(a)&&0===a.length)a=void 0;h._isAMomentObject=!0;h._useUTC=h._isUTC=l;h._l=c;h._i=a;h._f=b;h._strict=d;a=new t(Pa(Qa(h)));a._nextDay&&(a.add(1,"d"),a._nextDay=void 0);return a}
function ca(a,b,c,d){return eb(a,b,c,d,!1)}function ta(a,b){var c,d;1===b.length&&f(b[0])&&(b=b[0]);if(!b.length)return ca();c=b[0];for(d=1;d<b.length;++d)if(!b[d].isValid()||b[d][a](c))c=b[d];return c}function V(a){for(var b in a)if(-1===Ia.call(rb,b)||null!=a[b]&&isNaN(a[b]))return!1;b=!1;for(var c=0;c<rb.length;++c)if(a[rb[c]]){if(b)return!1;parseFloat(a[rb[c]])!==x(a[rb[c]])&&(b=!0)}return!0}function oa(a){a=M(a);var b=a.year||0,c=a.quarter||0,d=a.month||0,e=a.week||0,l=a.day||0,h=a.hour||0,g=
a.minute||0,n=a.second||0,k=a.millisecond||0;this._isValid=V(a);this._milliseconds=+k+1E3*n+6E4*g+36E5*h;this._days=+l+7*e;this._months=+d+3*c+12*b;this._data={};this._locale=Ca();this._bubble()}function qa(a){return a instanceof oa}function ua(a){return 0>a?-1*Math.round(-1*a):Math.round(a)}function ja(a,b){G(a,0,0,function(){var a=this.utcOffset(),c="+";0>a&&(a=-a,c="-");return c+I(~~(a/60),2)+b+I(~~a%60,2)})}function la(a,b){a=(b||"").match(a);if(null===a)return null;a=((a[a.length-1]||[])+"").match(uc)||
["-",0,0];b=+(60*a[1])+x(a[2]);return 0===b?0:"+"===a[0]?b:-b}function da(a,b){return b._isUTC?(b=b.clone(),a=(w(a)||h(a)?a.valueOf():ca(a).valueOf())-b.valueOf(),b._d.setTime(b._d.valueOf()+a),m.updateOffset(b,!1),b):ca(a).local()}function nb(){return this.isValid()?this._isUTC&&0===this._offset:!1}function Ra(a,c){var e=a,l=null;qa(a)?e={ms:a._milliseconds,d:a._days,M:a._months}:d(a)?(e={},c?e[c]=a:e.milliseconds=a):(l=vc.exec(a))?(e="-"===l[1]?-1:1,e={y:0,d:x(l[Ya])*e,h:x(l[La])*e,m:x(l[Xa])*e,
s:x(l[bb])*e,ms:x(ua(1E3*l[ib]))*e}):(l=wc.exec(a))?(e="-"===l[1]?-1:1,e={y:$a(l[2],e),M:$a(l[3],e),w:$a(l[4],e),d:$a(l[5],e),h:$a(l[6],e),m:$a(l[7],e),s:$a(l[8],e)}):null==e?e={}:"object"===typeof e&&("from"in e||"to"in e)&&(l=ca(e.from),e=ca(e.to),l.isValid()&&e.isValid()?(e=da(e,l),l.isBefore(e)?e=wb(l,e):(e=wb(e,l),e.milliseconds=-e.milliseconds,e.months=-e.months),l=e):l={milliseconds:0,months:0},e={},e.ms=l.milliseconds,e.M=l.months);e=new oa(e);qa(a)&&b(a,"_locale")&&(e._locale=a._locale);
return e}function $a(a,b){a=a&&parseFloat(a.replace(",","."));return(isNaN(a)?0:a)*b}function wb(a,b){var c={milliseconds:0,months:0};c.months=b.month()-a.month()+12*(b.year()-a.year());a.clone().add(c.months,"M").isAfter(b)&&--c.months;c.milliseconds=+b-+a.clone().add(c.months,"M");return c}function Va(a,b){return function(c,d){var e;null===d||isNaN(+d)||(A(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),
e=c,c=d,d=e);c=Ra("string"===typeof c?+c:c,d);yb(this,c,a);return this}}function yb(a,b,c,d){var e=b._milliseconds,l=ua(b._days);b=ua(b._months);a.isValid()&&(d=null==d?!0:d,b&&ha(a,X(a,"Month")+b*c),l&&aa(a,"Date",X(a,"Date")+l*c),e&&a._d.setTime(a._d.valueOf()+e*c),d&&m.updateOffset(a,l||b))}function tb(a,b){var c=12*(b.year()-a.year())+(b.month()-a.month()),d=a.clone().add(c,"months");0>b-d?(a=a.clone().add(c-1,"months"),b=(b-d)/(d-a)):(a=a.clone().add(c+1,"months"),b=(b-d)/(a-d));return-(c+b)||
0}function ub(a){if(void 0===a)return this._locale._abbr;a=Ca(a);null!=a&&(this._locale=a);return this}function mb(){return this._locale}function jb(a,b){G(0,[a,a.length],0,b)}function Qb(a,b,c,d,e){var l;if(null==a)return wa(this,d,e).year;l=za(a,d,e);b>l&&(b=l);a=na(a,b,c,d,e);a=ga(a.year,0,a.dayOfYear);this.year(a.getUTCFullYear());this.month(a.getUTCMonth());this.date(a.getUTCDate());return this}function kc(a,b){b[ib]=x(1E3*("0."+a))}function Rb(a){return a}function vb(a,b,c,d){var e=Ca();b=l().set(d,
b);return e[c](b,a)}function Sb(a,b,c){d(a)&&(b=a,a=void 0);a=a||"";if(null!=b)return vb(a,b,c,"month");var e=[];for(b=0;12>b;b++)e[b]=vb(a,b,c,"month");return e}function Gb(a,b,c,e){"boolean"!==typeof a&&(c=b=a,a=!1);d(b)&&(c=b,b=void 0);b=b||"";var l=Ca();a=a?l._week.dow:0;if(null!=c)return vb(b,(c+a)%7,e,"day");l=[];for(c=0;7>c;c++)l[c]=vb(b,(c+a)%7,e,"day");return l}function Tb(a,b,c,d){b=Ra(b,c);a._milliseconds+=d*b._milliseconds;a._days+=d*b._days;a._months+=d*b._months;return a._bubble()}function Ub(a){return 0>
a?Math.floor(a):Math.ceil(a)}function db(a){return function(){return this.as(a)}}function hb(a){return function(){return this.isValid()?this._data[a]:NaN}}function lc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function kb(a){return(0<a)-(0>a)||+a}function xb(){if(!this.isValid())return this.localeData().invalidDate();var a=Nb(this._milliseconds)/1E3,b=Nb(this._days),c=Nb(this._months),d,e;d=u(a/60);e=u(d/60);a%=60;d%=60;var l=u(c/12),c=c%12,a=a?a.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();
if(!h)return"P0D";var g=0>h?"-":"",n=kb(this._months)!==kb(h)?"-":"",k=kb(this._days)!==kb(h)?"-":"",h=kb(this._milliseconds)!==kb(h)?"-":"";return g+"P"+(l?n+l+"Y":"")+(c?n+c+"M":"")+(b?k+b+"D":"")+(e||d||a?"T":"")+(e?h+e+"H":"")+(d?h+d+"M":"")+(a?h+a+"S":"")}var Vb,Wb;Wb=Array.prototype.some?Array.prototype.some:function(a){for(var b=Object(this),c=b.length>>>0,d=0;d<c;d++)if(d in b&&a.call(this,b[d],d,b))return!0;return!1};var Hb=m.momentProperties=[],Ib=!1,Xb={};m.suppressDeprecationWarnings=
!1;m.deprecationHandler=null;var bc;bc=Object.keys?Object.keys:function(a){var c,d=[];for(c in a)b(a,c)&&d.push(c);return d};var ob={},Ma={},Yb=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,zb=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Jb={},lb={},cc=/\d/,Sa=/\d\d/,dc=/\d{3}/,Ob=/\d{4}/,Bb=/[+-]?\d{6}/,Da=/\d\d?/,ec=/\d\d\d\d?/,fc=/\d\d\d\d\d\d?/,Cb=/\d{1,3}/,
Pb=/\d{1,4}/,Db=/[+-]?\d{1,6}/,xc=/\d+/,Eb=/[+-]?\d+/,yc=/Z|[+-]\d\d:?\d\d/gi,Fb=/Z|[+-]\d\d(?::?\d\d)?/gi,sb=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Kb={},Lb={},Wa=0,ab=1,Ya=2,La=3,Xa=4,bb=5,ib=6,mc=7,nc=8;G("Y",0,0,function(){var a=this.year();return 9999>=a?""+a:"+"+a});G(0,["YY",2],0,function(){return this.year()%100});G(0,["YYYY",4],0,"year");G(0,["YYYYY",5],0,"year");G(0,["YYYYYY",
6,!0],0,"year");D("year","y");Ma.year=1;K("Y",Eb);K("YY",Da,Sa);K("YYYY",Pb,Ob);K("YYYYY",Db,Bb);K("YYYYYY",Db,Bb);T(["YYYYY","YYYYYY"],Wa);T("YYYY",function(a,b){b[Wa]=2===a.length?m.parseTwoDigitYear(a):x(a)});T("YY",function(a,b){b[Wa]=m.parseTwoDigitYear(a)});T("Y",function(a,b){b[Wa]=parseInt(a,10)});m.parseTwoDigitYear=function(a){return x(a)+(68<x(a)?1900:2E3)};var gc=Y("FullYear",!0),Ia;Ia=Array.prototype.indexOf?Array.prototype.indexOf:function(a){var b;for(b=0;b<this.length;++b)if(this[b]===
a)return b;return-1};G("M",["MM",2],"Mo",function(){return this.month()+1});G("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)});G("MMMM",0,0,function(a){return this.localeData().months(this,a)});D("month","M");Ma.month=8;K("M",Da);K("MM",Da,Sa);K("MMM",function(a,b){return b.monthsShortRegex(a)});K("MMMM",function(a,b){return b.monthsRegex(a)});T(["M","MM"],function(a,b){b[ab]=x(a)-1});T(["MMM","MMMM"],function(a,b,c,d){d=c._locale.monthsParse(a,d,c._strict);null!=d?b[ab]=d:n(c).invalidMonth=
a});var hc=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,$b="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");G("w",["ww",2],"wo","week");G("W",["WW",2],"Wo","isoWeek");D("week","w");D("isoWeek","W");Ma.week=5;Ma.isoWeek=5;K("w",Da);K("ww",Da,Sa);K("W",Da);K("WW",Da,Sa);S(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=x(a)});G("d",0,"do","day");G("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)});G("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)});G("dddd",
0,0,function(a){return this.localeData().weekdays(this,a)});G("e",0,0,"weekday");G("E",0,0,"isoWeekday");D("day","d");D("weekday","e");D("isoWeekday","E");Ma.day=11;Ma.weekday=11;Ma.isoWeekday=11;K("d",Da);K("e",Da);K("E",Da);K("dd",function(a,b){return b.weekdaysMinRegex(a)});K("ddd",function(a,b){return b.weekdaysShortRegex(a)});K("dddd",function(a,b){return b.weekdaysRegex(a)});S(["dd","ddd","dddd"],function(a,b,c,d){d=c._locale.weekdaysParse(a,d,c._strict);null!=d?b.d=d:n(c).invalidWeekday=a});
S(["d","e","E"],function(a,b,c,d){b[d]=x(a)});var ac="Sun Mon Tue Wed Thu Fri Sat".split(" ");G("H",["HH",2],0,"hour");G("h",["hh",2],0,ma);G("k",["kk",2],0,function(){return this.hours()||24});G("hmm",0,0,function(){return""+ma.apply(this)+I(this.minutes(),2)});G("hmmss",0,0,function(){return""+ma.apply(this)+I(this.minutes(),2)+I(this.seconds(),2)});G("Hmm",0,0,function(){return""+this.hours()+I(this.minutes(),2)});G("Hmmss",0,0,function(){return""+this.hours()+I(this.minutes(),2)+I(this.seconds(),
2)});Ea("a",!0);Ea("A",!1);D("hour","h");Ma.hour=13;K("a",Ha);K("A",Ha);K("H",Da);K("h",Da);K("k",Da);K("HH",Da,Sa);K("hh",Da,Sa);K("kk",Da,Sa);K("hmm",ec);K("hmmss",fc);K("Hmm",ec);K("Hmmss",fc);T(["H","HH"],La);T(["k","kk"],function(a,b,c){a=x(a);b[La]=24===a?0:a});T(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a);c._meridiem=a});T(["h","hh"],function(a,b,c){b[La]=x(a);n(c).bigHour=!0});T("hmm",function(a,b,c){var d=a.length-2;b[La]=x(a.substr(0,d));b[Xa]=x(a.substr(d));n(c).bigHour=!0});T("hmmss",
function(a,b,c){var d=a.length-4,e=a.length-2;b[La]=x(a.substr(0,d));b[Xa]=x(a.substr(d,2));b[bb]=x(a.substr(e));n(c).bigHour=!0});T("Hmm",function(a,b,c){c=a.length-2;b[La]=x(a.substr(0,c));b[Xa]=x(a.substr(c))});T("Hmmss",function(a,b,c){c=a.length-4;var d=a.length-2;b[La]=x(a.substr(0,c));b[Xa]=x(a.substr(c,2));b[bb]=x(a.substr(d))});var zc=Y("Hours",!0),Zb={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",
sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:"January February March April May June July August September October November December".split(" "),
monthsShort:$b,week:{dow:0,doy:6},weekdays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),weekdaysMin:"Su Mo Tu We Th Fr Sa".split(" "),weekdaysShort:ac,meridiemParse:/[ap]\.?m?\.?/i},Ka={},qb={},pb,oc=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,pc=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
qc=/Z|[+-]\d\d(?::?\d\d)?/,Ab=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Mb=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",
/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],tc=/^\/?Date\((\-?\d+)/i,rc=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,sc={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};m.createFromInputFallback=y("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",
function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))});m.ISO_8601=function(){};m.RFC_2822=function(){};var Ac=y("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=ca.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:q()}),Bc=y("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=ca.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?
this:a:q()}),rb="year quarter month week day hour minute second millisecond".split(" ");ja("Z",":");ja("ZZ","");K("Z",Fb);K("ZZ",Fb);T(["Z","ZZ"],function(a,b,c){c._useUTC=!0;c._tzm=la(Fb,a)});var uc=/([\+\-]|\d\d)/gi;m.updateOffset=function(){};var vc=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,wc=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;Ra.fn=oa.prototype;Ra.invalid=
function(){return Ra(NaN)};var Cc=Va(1,"add"),Dc=Va(-1,"subtract");m.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";m.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ic=y("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});G(0,["gg",2],0,function(){return this.weekYear()%100});G(0,["GG",2],0,function(){return this.isoWeekYear()%100});jb("gggg","weekYear");
jb("ggggg","weekYear");jb("GGGG","isoWeekYear");jb("GGGGG","isoWeekYear");D("weekYear","gg");D("isoWeekYear","GG");Ma.weekYear=1;Ma.isoWeekYear=1;K("G",Eb);K("g",Eb);K("GG",Da,Sa);K("gg",Da,Sa);K("GGGG",Pb,Ob);K("gggg",Pb,Ob);K("GGGGG",Db,Bb);K("ggggg",Db,Bb);S(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=x(a)});S(["gg","GG"],function(a,b,c,d){b[d]=m.parseTwoDigitYear(a)});G("Q",0,"Qo","quarter");D("quarter","Q");Ma.quarter=7;K("Q",cc);T("Q",function(a,b){b[ab]=3*(x(a)-1)});
G("D",["DD",2],"Do","date");D("date","D");Ma.date=9;K("D",Da);K("DD",Da,Sa);K("Do",function(a,b){return a?b._dayOfMonthOrdinalParse||b._ordinalParse:b._dayOfMonthOrdinalParseLenient});T(["D","DD"],Ya);T("Do",function(a,b){b[Ya]=x(a.match(Da)[0])});var jc=Y("Date",!0);G("DDD",["DDDD",3],"DDDo","dayOfYear");D("dayOfYear","DDD");Ma.dayOfYear=4;K("DDD",Cb);K("DDDD",dc);T(["DDD","DDDD"],function(a,b,c){c._dayOfYear=x(a)});G("m",["mm",2],0,"minute");D("minute","m");Ma.minute=14;K("m",Da);K("mm",Da,Sa);
T(["m","mm"],Xa);var Ec=Y("Minutes",!1);G("s",["ss",2],0,"second");D("second","s");Ma.second=15;K("s",Da);K("ss",Da,Sa);T(["s","ss"],bb);var Fc=Y("Seconds",!1);G("S",0,0,function(){return~~(this.millisecond()/100)});G(0,["SS",2],0,function(){return~~(this.millisecond()/10)});G(0,["SSS",3],0,"millisecond");G(0,["SSSS",4],0,function(){return 10*this.millisecond()});G(0,["SSSSS",5],0,function(){return 100*this.millisecond()});G(0,["SSSSSS",6],0,function(){return 1E3*this.millisecond()});G(0,["SSSSSSS",
7],0,function(){return 1E4*this.millisecond()});G(0,["SSSSSSSS",8],0,function(){return 1E5*this.millisecond()});G(0,["SSSSSSSSS",9],0,function(){return 1E6*this.millisecond()});D("millisecond","ms");Ma.millisecond=16;K("S",Cb,cc);K("SS",Cb,Sa);K("SSS",Cb,dc);var fb;for(fb="SSSS";9>=fb.length;fb+="S")K(fb,xc);for(fb="S";9>=fb.length;fb+="S")T(fb,kc);var Gc=Y("Milliseconds",!1);G("z",0,0,"zoneAbbr");G("zz",0,0,"zoneName");var fa=t.prototype;fa.add=Cc;fa.calendar=function(a,b){a=a||ca();var c=da(a,this).startOf("day"),
c=m.calendarFormat(this,c)||"sameElse";b=b&&(B(b[c])?b[c].call(this,a):b[c]);return this.format(b||this.localeData().calendar(c,this,ca(a)))};fa.clone=function(){return new t(this)};fa.diff=function(a,b,c){var d;if(!this.isValid())return NaN;a=da(a,this);if(!a.isValid())return NaN;d=6E4*(a.utcOffset()-this.utcOffset());b=F(b);switch(b){case "year":b=tb(this,a)/12;break;case "month":b=tb(this,a);break;case "quarter":b=tb(this,a)/3;break;case "second":b=(this-a)/1E3;break;case "minute":b=(this-a)/6E4;
break;case "hour":b=(this-a)/36E5;break;case "day":b=(this-a-d)/864E5;break;case "week":b=(this-a-d)/6048E5;break;default:b=this-a}return c?b:u(b)};fa.endOf=function(a){a=F(a);if(void 0===a||"millisecond"===a)return this;"date"===a&&(a="day");return this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")};fa.format=function(a){a||(a=this.isUtc()?m.defaultFormatUtc:m.defaultFormat);a=Q(this,a);return this.localeData().postformat(a)};fa.from=function(a,b){return this.isValid()&&(w(a)&&a.isValid()||
ca(a).isValid())?Ra({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()};fa.fromNow=function(a){return this.from(ca(),a)};fa.to=function(a,b){return this.isValid()&&(w(a)&&a.isValid()||ca(a).isValid())?Ra({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()};fa.toNow=function(a){return this.to(ca(),a)};fa.get=function(a){a=F(a);return B(this[a])?this[a]():this};fa.invalidAt=function(){return n(this).overflow};fa.isAfter=function(a,b){a=
w(a)?a:ca(a);if(!this.isValid()||!a.isValid())return!1;b=F(g(b)?"millisecond":b);return"millisecond"===b?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(b).valueOf()};fa.isBefore=function(a,b){a=w(a)?a:ca(a);if(!this.isValid()||!a.isValid())return!1;b=F(g(b)?"millisecond":b);return"millisecond"===b?this.valueOf()<a.valueOf():this.clone().endOf(b).valueOf()<a.valueOf()};fa.isBetween=function(a,b,c,d){d=d||"()";return("("===d[0]?this.isAfter(a,c):!this.isBefore(a,c))&&(")"===d[1]?this.isBefore(b,
c):!this.isAfter(b,c))};fa.isSame=function(a,b){a=w(a)?a:ca(a);if(!this.isValid()||!a.isValid())return!1;b=F(b||"millisecond");if("millisecond"===b)return this.valueOf()===a.valueOf();a=a.valueOf();return this.clone().startOf(b).valueOf()<=a&&a<=this.clone().endOf(b).valueOf()};fa.isSameOrAfter=function(a,b){return this.isSame(a,b)||this.isAfter(a,b)};fa.isSameOrBefore=function(a,b){return this.isSame(a,b)||this.isBefore(a,b)};fa.isValid=function(){return p(this)};fa.lang=ic;fa.locale=ub;fa.localeData=
mb;fa.max=Bc;fa.min=Ac;fa.parsingFlags=function(){return a({},n(this))};fa.set=function(a,b){if("object"===typeof a){a=M(a);b=N(a);for(var c=0;c<b.length;c++)this[b[c].unit](a[b[c].unit])}else if(a=F(a),B(this[a]))return this[a](b);return this};fa.startOf=function(a){a=F(a);switch(a){case "year":this.month(0);case "quarter":case "month":this.date(1);case "week":case "isoWeek":case "day":case "date":this.hours(0);case "hour":this.minutes(0);case "minute":this.seconds(0);case "second":this.milliseconds(0)}"week"===
a&&this.weekday(0);"isoWeek"===a&&this.isoWeekday(1);"quarter"===a&&this.month(3*Math.floor(this.month()/3));return this};fa.subtract=Dc;fa.toArray=function(){return[this.year(),this.month(),this.date(),this.hour(),this.minute(),this.second(),this.millisecond()]};fa.toObject=function(){return{years:this.year(),months:this.month(),date:this.date(),hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()}};fa.toDate=function(){return new Date(this.valueOf())};
fa.toISOString=function(a){if(!this.isValid())return null;var b=(a=!0!==a)?this.clone().utc():this;return 0>b.year()||9999<b.year()?Q(b,a?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):B(Date.prototype.toISOString)?a?this.toDate().toISOString():(new Date(this.valueOf()+6E4*this.utcOffset())).toISOString().replace("Z",Q(b,"Z")):Q(b,a?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")};fa.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var a=
"moment",b="";this.isLocal()||(a=0===this.utcOffset()?"moment.utc":"moment.parseZone",b="Z");var a="["+a+'("]',c=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY";return this.format(a+c+"-MM-DD[T]HH:mm:ss.SSS"+(b+'[")]'))};fa.toJSON=function(){return this.isValid()?this.toISOString():null};fa.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")};fa.unix=function(){return Math.floor(this.valueOf()/1E3)};fa.valueOf=function(){return this._d.valueOf()-6E4*(this._offset||
0)};fa.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}};fa.year=gc;fa.isLeapYear=function(){return W(this.year())};fa.weekYear=function(a){return Qb.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)};fa.isoWeekYear=function(a){return Qb.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)};fa.quarter=fa.quarters=function(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-
1)+this.month()%3)};fa.month=Z;fa.daysInMonth=function(){return U(this.year(),this.month())};fa.week=fa.weeks=function(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")};fa.isoWeek=fa.isoWeeks=function(a){var b=wa(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")};fa.weeksInYear=function(){var a=this.localeData()._week;return za(this.year(),a.dow,a.doy)};fa.isoWeeksInYear=function(){return za(this.year(),1,4)};fa.date=jc;fa.day=fa.days=function(a){if(!this.isValid())return null!=
a?this:NaN;var b=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=a){var c=this.localeData();"string"===typeof a&&(isNaN(a)?(a=c.weekdaysParse(a),a="number"===typeof a?a:null):a=parseInt(a,10));return this.add(a-b,"d")}return b};fa.weekday=function(a){if(!this.isValid())return null!=a?this:NaN;var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")};fa.isoWeekday=function(a){if(!this.isValid())return null!=a?this:NaN;if(null!=a){var b=this.localeData();a="string"===
typeof a?b.weekdaysParse(a)%7||7:isNaN(a)?null:a;return this.day(this.day()%7?a:a-7)}return this.day()||7};fa.dayOfYear=function(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864E5)+1;return null==a?b:this.add(a-b,"d")};fa.hour=fa.hours=zc;fa.minute=fa.minutes=Ec;fa.second=fa.seconds=Fc;fa.millisecond=fa.milliseconds=Gc;fa.utcOffset=function(a,b,c){var d=this._offset||0,e;if(!this.isValid())return null!=a?this:NaN;if(null!=a){if("string"===typeof a){if(a=la(Fb,a),
null===a)return this}else 16>Math.abs(a)&&!c&&(a*=60);!this._isUTC&&b&&(e=15*-Math.round(this._d.getTimezoneOffset()/15));this._offset=a;this._isUTC=!0;null!=e&&this.add(e,"m");d!==a&&(!b||this._changeInProgress?yb(this,Ra(a-d,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,m.updateOffset(this,!0),this._changeInProgress=null));return this}return this._isUTC?d:15*-Math.round(this._d.getTimezoneOffset()/15)};fa.utc=function(a){return this.utcOffset(0,a)};fa.local=function(a){this._isUTC&&
(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(15*-Math.round(this._d.getTimezoneOffset()/15),"m"));return this};fa.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"===typeof this._i){var a=la(yc,this._i);null!=a?this.utcOffset(a):this.utcOffset(0,!0)}return this};fa.hasAlignedHourOffset=function(a){if(!this.isValid())return!1;a=a?ca(a).utcOffset():0;return 0===(this.utcOffset()-a)%60};fa.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||
this.utcOffset()>this.clone().month(5).utcOffset()};fa.isLocal=function(){return this.isValid()?!this._isUTC:!1};fa.isUtcOffset=function(){return this.isValid()?this._isUTC:!1};fa.isUtc=nb;fa.isUTC=nb;fa.zoneAbbr=function(){return this._isUTC?"UTC":""};fa.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""};fa.dates=y("dates accessor is deprecated. Use date instead.",jc);fa.months=y("months accessor is deprecated. Use month instead",Z);fa.years=y("years accessor is deprecated. Use year instead",
gc);fa.zone=y("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(a,b){return null!=a?("string"!==typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()});fa.isDSTShifted=y("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!g(this._isDSTShifted))return this._isDSTShifted;var a={};r(a,this);a=Qa(a);if(a._a){var b=a._isUTC?l(a._a):ca(a._a);this._isDSTShifted=this.isValid()&&
0<v(a._a,b.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var Ba=E.prototype;Ba.calendar=function(a,b,c){a=this._calendar[a]||this._calendar.sameElse;return B(a)?a.call(b,c):a};Ba.longDateFormat=function(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];if(b||!c)return b;this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)});return this._longDateFormat[a]};Ba.invalidDate=function(){return this._invalidDate};Ba.ordinal=function(a){return this._ordinal.replace("%d",
a)};Ba.preparse=Rb;Ba.postformat=Rb;Ba.relativeTime=function(a,b,c,d){var e=this._relativeTime[c];return B(e)?e(a,b,c,d):e.replace(/%d/i,a)};Ba.pastFuture=function(a,b){a=this._relativeTime[0<a?"future":"past"];return B(a)?a(b):a.replace(/%s/i,b)};Ba.set=function(a){var b,c;for(c in a)b=a[c],B(b)?this[c]=b:this["_"+c]=b;this._config=a;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)};Ba.months=function(a,b){return a?
f(this._months)?this._months[a.month()]:this._months[(this._months.isFormat||hc).test(b)?"format":"standalone"][a.month()]:f(this._months)?this._months:this._months.standalone};Ba.monthsShort=function(a,b){return a?f(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[hc.test(b)?"format":"standalone"][a.month()]:f(this._monthsShort)?this._monthsShort:this._monthsShort.standalone};Ba.monthsParse=function(a,b,c){var d,e;if(this._monthsParseExact){a:{a=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=
[],this._longMonthsParse=[],this._shortMonthsParse=[],d=0;12>d;++d)e=l([2E3,d]),this._shortMonthsParse[d]=this.monthsShort(e,"").toLocaleLowerCase(),this._longMonthsParse[d]=this.months(e,"").toLocaleLowerCase();if(c)b="MMM"===b?Ia.call(this._shortMonthsParse,a):Ia.call(this._longMonthsParse,a);else if("MMM"===b){b=Ia.call(this._shortMonthsParse,a);if(-1!==b)break a;b=Ia.call(this._longMonthsParse,a)}else{b=Ia.call(this._longMonthsParse,a);if(-1!==b)break a;b=Ia.call(this._shortMonthsParse,a)}b=-1!==
b?b:null}return b}this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]);for(d=0;12>d;d++)if(e=l([2E3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(e="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(e.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a)||
c&&"MMM"===b&&this._shortMonthsParse[d].test(a)||!c&&this._monthsParse[d].test(a))return d};Ba.monthsRegex=function(a){if(this._monthsParseExact)return b(this,"_monthsRegex")||ba.call(this),a?this._monthsStrictRegex:this._monthsRegex;b(this,"_monthsRegex")||(this._monthsRegex=sb);return this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex};Ba.monthsShortRegex=function(a){if(this._monthsParseExact)return b(this,"_monthsRegex")||ba.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex;
b(this,"_monthsShortRegex")||(this._monthsShortRegex=sb);return this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex};Ba.week=function(a){return wa(a,this._week.dow,this._week.doy).week};Ba.firstDayOfYear=function(){return this._week.doy};Ba.firstDayOfWeek=function(){return this._week.dow};Ba.weekdays=function(a,b){return a?f(this._weekdays)?this._weekdays[a.day()]:this._weekdays[this._weekdays.isFormat.test(b)?"format":"standalone"][a.day()]:f(this._weekdays)?this._weekdays:
this._weekdays.standalone};Ba.weekdaysMin=function(a){return a?this._weekdaysMin[a.day()]:this._weekdaysMin};Ba.weekdaysShort=function(a){return a?this._weekdaysShort[a.day()]:this._weekdaysShort};Ba.weekdaysParse=function(a,b,c){var d,e;if(this._weekdaysParseExact)return Aa.call(this,a,b,c);this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]);for(d=0;7>d;d++)if(e=l([2E3,1]).day(d),c&&!this._fullWeekdaysParse[d]&&(this._fullWeekdaysParse[d]=
new RegExp("^"+this.weekdays(e,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[d]=new RegExp("^"+this.weekdaysShort(e,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[d]=new RegExp("^"+this.weekdaysMin(e,"").replace(".",".?")+"$","i")),this._weekdaysParse[d]||(e="^"+this.weekdays(e,"")+"|^"+this.weekdaysShort(e,"")+"|^"+this.weekdaysMin(e,""),this._weekdaysParse[d]=new RegExp(e.replace(".",""),"i")),c&&"dddd"===b&&this._fullWeekdaysParse[d].test(a)||c&&"ddd"===b&&this._shortWeekdaysParse[d].test(a)||
c&&"dd"===b&&this._minWeekdaysParse[d].test(a)||!c&&this._weekdaysParse[d].test(a))return d};Ba.weekdaysRegex=function(a){if(this._weekdaysParseExact)return b(this,"_weekdaysRegex")||sa.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex;b(this,"_weekdaysRegex")||(this._weekdaysRegex=sb);return this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex};Ba.weekdaysShortRegex=function(a){if(this._weekdaysParseExact)return b(this,"_weekdaysRegex")||sa.call(this),a?this._weekdaysShortStrictRegex:
this._weekdaysShortRegex;b(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=sb);return this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex};Ba.weekdaysMinRegex=function(a){if(this._weekdaysParseExact)return b(this,"_weekdaysRegex")||sa.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex;b(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=sb);return this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex};Ba.isPM=
function(a){return"p"===(a+"").toLowerCase().charAt(0)};Ba.meridiem=function(a,b,c){return 11<a?c?"pm":"PM":c?"am":"AM"};ya("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,b=1===x(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+b}});m.lang=y("moment.lang is deprecated. Use moment.locale instead.",ya);m.langData=y("moment.langData is deprecated. Use moment.localeData instead.",Ca);var cb=Math.abs,Hc=db("ms"),Ic=db("s"),Jc=db("m"),Kc=db("h"),Lc=db("d"),
Mc=db("w"),Nc=db("M"),Oc=db("y"),Pc=hb("milliseconds"),Qc=hb("seconds"),Rc=hb("minutes"),Sc=hb("hours"),Tc=hb("days"),Uc=hb("months"),Vc=hb("years"),gb=Math.round,Za={ss:44,s:45,m:45,h:22,d:26,M:11},Nb=Math.abs,va=oa.prototype;va.isValid=function(){return this._isValid};va.abs=function(){var a=this._data;this._milliseconds=cb(this._milliseconds);this._days=cb(this._days);this._months=cb(this._months);a.milliseconds=cb(a.milliseconds);a.seconds=cb(a.seconds);a.minutes=cb(a.minutes);a.hours=cb(a.hours);
a.months=cb(a.months);a.years=cb(a.years);return this};va.add=function(a,b){return Tb(this,a,b,1)};va.subtract=function(a,b){return Tb(this,a,b,-1)};va.as=function(a){if(!this.isValid())return NaN;var b,c=this._milliseconds;a=F(a);if("month"===a||"year"===a)return b=this._days+c/864E5,b=this._months+4800*b/146097,"month"===a?b:b/12;b=this._days+Math.round(146097*this._months/4800);switch(a){case "week":return b/7+c/6048E5;case "day":return b+c/864E5;case "hour":return 24*b+c/36E5;case "minute":return 1440*
b+c/6E4;case "second":return 86400*b+c/1E3;case "millisecond":return Math.floor(864E5*b)+c;default:throw Error("Unknown unit "+a);}};va.asMilliseconds=Hc;va.asSeconds=Ic;va.asMinutes=Jc;va.asHours=Kc;va.asDays=Lc;va.asWeeks=Mc;va.asMonths=Nc;va.asYears=Oc;va.valueOf=function(){return this.isValid()?this._milliseconds+864E5*this._days+this._months%12*2592E6+31536E6*x(this._months/12):NaN};va._bubble=function(){var a=this._milliseconds,b=this._days,c=this._months,d=this._data;0<=a&&0<=b&&0<=c||0>=a&&
0>=b&&0>=c||(a+=864E5*Ub(146097*c/4800+b),c=b=0);d.milliseconds=a%1E3;a=u(a/1E3);d.seconds=a%60;a=u(a/60);d.minutes=a%60;a=u(a/60);d.hours=a%24;b+=u(a/24);a=u(4800*b/146097);c+=a;b-=Ub(146097*a/4800);a=u(c/12);d.days=b;d.months=c%12;d.years=a;return this};va.clone=function(){return Ra(this)};va.get=function(a){a=F(a);return this.isValid()?this[a+"s"]():NaN};va.milliseconds=Pc;va.seconds=Qc;va.minutes=Rc;va.hours=Sc;va.days=Tc;va.weeks=function(){return u(this.days()/7)};va.months=Uc;va.years=Vc;va.humanize=
function(a){if(!this.isValid())return this.localeData().invalidDate();var b=this.localeData(),c;c=!a;var d=Ra(this).abs(),e=gb(d.as("s")),l=gb(d.as("m")),h=gb(d.as("h")),g=gb(d.as("d")),n=gb(d.as("M")),d=gb(d.as("y")),e=e<=Za.ss&&["s",e]||e<Za.s&&["ss",e]||1>=l&&["m"]||l<Za.m&&["mm",l]||1>=h&&["h"]||h<Za.h&&["hh",h]||1>=g&&["d"]||g<Za.d&&["dd",g]||1>=n&&["M"]||n<Za.M&&["MM",n]||1>=d&&["y"]||["yy",d];e[2]=c;e[3]=0<+this;e[4]=b;c=lc.apply(null,e);a&&(c=b.pastFuture(+this,c));return b.postformat(c)};
va.toISOString=xb;va.toString=xb;va.toJSON=xb;va.locale=ub;va.localeData=mb;va.toIsoString=y("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",xb);va.lang=ic;G("X",0,0,"unix");G("x",0,0,"valueOf");K("x",Eb);K("X",/[+-]?\d+(\.\d{1,3})?/);T("X",function(a,b,c){c._d=new Date(1E3*parseFloat(a,10))});T("x",function(a,b,c){c._d=new Date(x(a))});m.version="2.22.1";Vb=ca;m.fn=fa;m.min=function(){var a=[].slice.call(arguments,0);return ta("isBefore",a)};m.max=function(){var a=
[].slice.call(arguments,0);return ta("isAfter",a)};m.now=function(){return Date.now?Date.now():+new Date};m.utc=l;m.unix=function(a){return ca(1E3*a)};m.months=function(a,b){return Sb(a,b,"months")};m.isDate=h;m.locale=ya;m.invalid=q;m.duration=Ra;m.isMoment=w;m.weekdays=function(a,b,c){return Gb(a,b,c,"weekdays")};m.parseZone=function(){return ca.apply(null,arguments).parseZone()};m.localeData=Ca;m.isDuration=qa;m.monthsShort=function(a,b){return Sb(a,b,"monthsShort")};m.weekdaysMin=function(a,b,
c){return Gb(a,b,c,"weekdaysMin")};m.defineLocale=Ga;m.updateLocale=function(a,b){if(null!=b){var c,d=Zb;c=xa(a);null!=c&&(d=c._config);b=C(d,b);b=new E(b);b.parentLocale=Ka[a];Ka[a]=b;ya(a)}else null!=Ka[a]&&(null!=Ka[a].parentLocale?Ka[a]=Ka[a].parentLocale:null!=Ka[a]&&delete Ka[a]);return Ka[a]};m.locales=function(){return bc(Ka)};m.weekdaysShort=function(a,b,c){return Gb(a,b,c,"weekdaysShort")};m.normalizeUnits=F;m.relativeTimeRounding=function(a){return void 0===a?gb:"function"===typeof a?(gb=
a,!0):!1};m.relativeTimeThreshold=function(a,b){if(void 0===Za[a])return!1;if(void 0===b)return Za[a];Za[a]=b;"s"===a&&(Za.ss=b-1);return!0};m.calendarFormat=function(a,b){a=a.diff(b,"days",!0);return-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse"};m.prototype=fa;m.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",
TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"};return m})},"esri/arcade/FunctionWrapper":function(){define(["require","exports"],function(m,f){return function(){return function(k,e){this.context=this.definition=null;this.definition=k;this.context=e}}()})},"esri/arcade/ImmutablePathArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","./ImmutablePointArray"],function(m,f,k,e,g){return function(d){function e(c,b,a,e,h){c=d.call(this,c)||this;
c._lazyPath=[];c._hasZ=!1;c._hasM=!1;c._hasZ=a;c._hasM=e;c._spRef=b;c._cacheId=h;return c}k(e,d);e.prototype.get=function(c){if(void 0===this._lazyPath[c]){var b=this._elements[c];if(void 0===b)return;this._lazyPath[c]=new g(b,this._spRef,this._hasZ,this._hasM,this._cacheId,c)}return this._lazyPath[c]};e.prototype.equalityTest=function(c){return c===this?!0:null===c||!1===c instanceof e?!1:c.getUniqueHash()===this.getUniqueHash()};e.prototype.getUniqueHash=function(){return this._cacheId.toString()};
return e}(e)})},"esri/arcade/ImmutablePointArray":function(){define("require exports ../core/tsSupport/extendsHelper ../kernel ./ImmutableArray ../geometry/Point".split(" "),function(m,f,k,e,g,d){var h=0===e.version.indexOf("4.");return function(c){function b(a,b,d,e,h,g){a=c.call(this,a)||this;a._lazyPt=[];a._hasZ=!1;a._hasM=!1;a._spRef=b;a._hasZ=d;a._hasM=e;a._cacheId=h;a._partId=g;return a}k(b,c);b.prototype.get=function(a){if(void 0===this._lazyPt[a]){var b=this._elements[a];if(void 0===b)return;
var c=this._hasZ,e=this._hasM,g=null,g=c&&!e?new d(b[0],b[1],b[2],void 0,this._spRef):e&&c?new d(b[0],b[1],void 0,b[2],this._spRef):c&&e?new d(b[0],b[1],b[2],b[3],this._spRef):new d(b[0],b[1],this._spRef);h?g.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+a.toString():g.setCacheValue("_arcadeCacheId",this._cacheId.toString()+"-"+this._partId.toString()+"-"+a.toString());this._lazyPt[a]=g}return this._lazyPt[a]};b.prototype.equalityTest=function(a){return a===this?!0:
null===a||!1===a instanceof b?!1:a.getUniqueHash()===this.getUniqueHash()};b.prototype.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()};return b}(g)})},"esri/arcade/Feature":function(){define("require exports ../core/tsSupport/assignHelper ./Dictionary ./ImmutableArray ./languageUtils ../geometry/Geometry ../geometry/Point ../geometry/support/jsonUtils".split(" "),function(m,f,k,e,g,d,h,c,b){return function(){function a(){this.declaredClass="esri.arcade.Feature";
this._layer=this.attributes=this._geometry=null;this.immutable=this.immutable=this._datesfixed=!0}a.createFromGraphic=function(b){var c=new a;c._geometry=b.geometry;c.attributes=void 0===b.attributes?{}:null===b.attributes?{}:b.attributes;b._sourceLayer?(c._layer=b._sourceLayer,c._datesfixed=!1):b._layer?(c._layer=b._layer,c._datesfixed=!1):b.layer&&(c._layer=b.layer,c._datesfixed=!1);return c};a.createFromArcadeFeature=function(b){var c=new a;c._datesfixed=b._datesfixed;c.attributes=b.attributes;
c._geometry=b._geometry;b._layer&&(c._layer=b._layer);return c};a.createFromArcadeDictionary=function(b){var c=new a;c.attributes=b.field("attributes");null!==c.attributes?c.attributes instanceof e?(c.attributes=c.attributes.attributes,null===c.attributes&&(c.attributes={})):c.attributes={}:c.attributes={};c._geometry=b.field("geometry");null!==c._geometry&&(c._geometry instanceof e?c._geometry=a.parseGeometryFromDictionary(c._geometry):c._geometry instanceof h||(c._geometry=null));return c};a.createFromGraphicLikeObject=
function(b,c,d){void 0===d&&(d=null);var e=new a;null===c&&(c={});e.attributes=c;e._geometry=b;e._layer=d;e._layer&&(e._datesfixed=!1);return e};a.prototype.repurposeFromGraphicLikeObject=function(a,b,c){void 0===c&&(c=null);null===b&&(b={});this.attributes=b;this._geometry=a;this._datesfixed=(this._layer=c)?!1:!0};a.prototype.castToText=function(){var a="",b;for(b in this.attributes){""!==a&&(a+=",");var c=this.attributes[b];null==c?a+=JSON.stringify(b)+":null":d.isBoolean(c)||d.isNumber(c)||d.isString(c)?
a+=JSON.stringify(b)+":"+JSON.stringify(c):c instanceof h?a+=JSON.stringify(b)+":"+d.toStringExplicit(c):c instanceof g?a+=JSON.stringify(b)+":"+d.toStringExplicit(c):c instanceof Array?a+=JSON.stringify(b)+":"+d.toStringExplicit(c):c instanceof Date?a+=JSON.stringify(b)+":"+JSON.stringify(c):null!==c&&"object"===typeof c&&void 0!==c.castToText&&(a+=JSON.stringify(b)+":"+c.castToText())}return'{"geometry":'+(null===this.geometry()?"null":d.toStringExplicit(this.geometry()))+',"attributes":{'+a+"}}"};
a.prototype._fixDates=function(){for(var a=[],b=0;b<this._layer.fields.length;b++){var c=this._layer.fields[b];"date"!==c.type&&"esriFieldTypeDate"!==c.type||a.push(c.name)}0<a.length&&this._fixDateFields(a);this._datesfixed=!0};a.prototype._fixDateFields=function(a){this.attributes=k({},this.attributes);for(var b=0;b<a.length;b++){var c=this.attributes[a[b]];if(null!==c)if(void 0===c)for(var d in this.attributes){if(d.toLowerCase()===a[b]){c=this.attributes[d];null===c||c instanceof Date||(this.attributes[d]=
new Date(c));break}}else c instanceof Date||(this.attributes[a[b]]=new Date(c))}};a.prototype.geometry=function(){return null===this._geometry||this._geometry instanceof h?this._geometry:this._geometry=b.fromJSON(this._geometry)};a.prototype.field=function(a){!1===this._datesfixed&&this._fixDates();var b=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];if(this._hasFieldDefinition(b))return null;throw Error("Field not Found");
};a.prototype._hasFieldDefinition=function(a){if(null===this._layer)return!1;for(var b=0;b<this._layer.fields.length;b++)if(this._layer.fields[b].name.toLowerCase()===a)return!0;return!1};a.prototype._field=function(a){!1===this._datesfixed&&this._fixDates();var b=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];return null};a.prototype.setField=function(a,b){if(this.immutable)throw Error("Feature is Immutable");
if(!1===d.isSimpleType(b))throw Error("Illegal Value Assignment to Feature");var c=a.toLowerCase();if(void 0===this.attributes[a])for(var e in this.attributes)if(e.toLowerCase()===c){this.attributes[e]=b;return}this.attributes[a]=b};a.prototype.hasField=function(a){var b=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(var c in this.attributes)if(c.toLowerCase()===b)return!0;return this._hasFieldDefinition(b)?!0:!1};a.prototype.keys=function(){var a=[],b={},c;for(c in this.attributes)a.push(c),
b[c.toLowerCase()]=1;if(null!==this._layer)for(c=0;c<this._layer.fields.length;c++){var d=this._layer.fields[c];1!==b[d.name.toLowerCase()]&&a.push(d.name)}return a=a.sort()};a.parseGeometryFromDictionary=function(c){c=a.convertDictionaryToJson(c,!0);void 0!==c.spatialreference&&(c.spatialReference=c.spatialreference,delete c.spatialreference);void 0!==c.rings&&(c.rings=this.fixPathArrays(c.rings,!0===c.hasZ,!0===c.hasM));void 0!==c.paths&&(c.paths=this.fixPathArrays(c.paths,!0===c.hasZ,!0===c.hasM));
void 0!==c.points&&(c.points=this.fixPointArrays(c.points,!0===c.hasZ,!0===c.hasM));return b.fromJSON(c)};a.fixPathArrays=function(a,b,c){var d=[];if(a instanceof Array)for(var e=0;e<a.length;e++)d.push(this.fixPointArrays(a[e],b,c));else if(a instanceof g)for(e=0;e<a.length();e++)d.push(this.fixPointArrays(a.get(e),b,c));return d};a.fixPointArrays=function(a,b,d){var e=[];if(a instanceof Array)for(var l=0;l<a.length;l++){var h=a[l];h instanceof c?b&&d?e.push([h.x,h.y,h.z,h.m]):b?e.push([h.x,h.y,
h.z]):d?e.push([h.x,h.y,h.m]):e.push([h.x,h.y]):e.push(h)}else if(a instanceof g)for(l=0;l<a.length();l++)h=a.get(l),h instanceof c?b&&d?e.push([h.x,h.y,h.z,h.m]):b?e.push([h.x,h.y,h.z]):d?e.push([h.x,h.y,h.m]):e.push([h.x,h.y]):e.push(h);return e};a.convertDictionaryToJson=function(b,c){void 0===c&&(c=!1);var d={},l;for(l in b.attributes){var h=b.attributes[l];h instanceof e&&(h=a.convertDictionaryToJson(h));c?d[l.toLowerCase()]=h:d[l]=h}return d};a.parseAttributesFromDictionary=function(a){var b=
{},c;for(c in a.attributes){var e=a.attributes[c];if(d.isSimpleType(e))b[c]=e;else throw Error("Illegal Argument");}return b};a.fromJson=function(c){var e=null;null!==c.geometry&&void 0!==c.geometry&&(e=b.fromJSON(c.geometry));var l={};if(null!==c.attributes&&void 0!==c.attributes)for(var h in c.attributes){var g=c.attributes[h];if(d.isString(g)||d.isNumber(g)||d.isBoolean(g)||d.isDate(g))l[h]=g;else throw Error("Illegal Argument");}return a.createFromGraphicLikeObject(e,l,null)};a.prototype.domainValueLookup=
function(a,b,c){if(null===this._layer||!this._layer.fields)return null;c=d.getDomain(a,this._layer,this,c);if(void 0===b)try{b=this.field(a)}catch(q){return null}return d.getDomainValue(c,b)};a.prototype.domainCodeLookup=function(a,b,c){if(null===this._layer||!this._layer.fields)return null;a=d.getDomain(a,this._layer,this,c);return d.getDomainCode(a,b)};return a}()})},"esri/arcade/treeAnalysis":function(){define(["require","exports"],function(m,f){function k(a,b,c,d){return"0"!==a.min&&c.length<
Number(a.min)||"*"!==a.max&&c.length>Number(a.max)?-2:1}function e(a,b,c){if(null!==c.localScope&&void 0!==c.localScope[a.toLowerCase()]){var d=c.localScope[a.toLowerCase()];if("FormulaFunction"===d.type||"any"===d.type)return void 0===d.signature&&(d.signature={min:"0",max:"*"}),k(d.signature,a,b,c)}return void 0!==c.globalScope[a.toLowerCase()]&&(d=c.globalScope[a.toLowerCase()],"FormulaFunction"===d.type||"any"===d.type)?(void 0===d.signature&&(d.signature={min:"0",max:"*"}),k(d.signature,a,b,
c)):-1}function g(a,b){void 0===b&&(b=!0);var c=p(a,"SYNTAX","UNREOGNISED");try{switch(a.type){case "VariableDeclarator":return null!==a.init&&"FunctionExpression"===a.init.type?p(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):"Identifier"!==a.id.type?p(a,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):null!==a.init?g(a.init,!1):"";case "VariableDeclaration":for(var d=0;d<a.declarations.length;d++)if(c=g(a.declarations[d],b),""!==c)return c;return"";case "ForInStatement":c=g(a.left,b);if(""!==c)break;if("VariableDeclaration"===
a.left.type){if(1<a.left.declarations.length)return p(a,"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return p(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return p(a,"SYNTAX","LEFTNOTVAR");c=g(a.right,b);if(""!==c)break;c=g(a.body,b);if(""!==c)break;return"";case "ForStatement":if(null!==a.test&&(c=g(a.test,b),""!==c))break;if(null!==a.init&&(c=g(a.init,b),""!==c))break;if(null!==a.update&&(c=g(a.update,b),""!==c))break;if(null!==a.body&&(c=g(a.body,b),""!==c))break;
return"";case "ContinueStatement":return"";case "EmptyStatement":return"";case "BreakStatement":return"";case "IfStatement":c=g(a.test,b);if(""!==c)break;if(null!==a.consequent&&(c=g(a.consequent,!1),""!==c))break;if(null!==a.alternate&&(c=g(a.alternate,!1),""!==c))break;return"";case "BlockStatement":for(var e=[],d=0;d<a.body.length;d++)"EmptyStatement"!==a.body[d].type&&e.push(a.body[d]);a.body=e;for(d=0;d<a.body.length;d++)if(c=g(a.body[d],b),""!==c)return c;return"";case "FunctionDeclaration":return!1===
b?p(a,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==a.id.type?p(a,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):g(a.body,!1);case "ReturnStatement":return null!==a.argument?g(a.argument,b):"";case "UpdateExpression":return"Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type?p(a,"SYNTAX","ASSIGNMENTTOVARSONLY"):g(a.argument,b);case "AssignmentExpression":if("Identifier"!==a.left.type&&"MemberExpression"!==a.left.type)return p(a,"SYNTAX","ASSIGNMENTTOVARSONLY");c=g(a.left,b);if(""!==c)break;
switch(a.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:return p(a,"SYNTAX","OPERATORNOTRECOGNISED")}return g(a.right,!1);case "ExpressionStatement":return g(a.expression,!1);case "Identifier":c="";break;case "MemberExpression":c=g(a.object,b);if(""!==c)break;return!0===a.computed?g(a.property,b):"";case "Literal":return"";case "ThisExpression":return p(a,"SYNTAX","NOTSUPPORTED");case "CallExpression":if("Identifier"!==a.callee.type)return p(a,
"SYNTAX","ONLYNODESSUPPORTED");c="";for(d=0;d<a.arguments.length;d++)if(c=g(a.arguments[d],b),""!==c)return c;return"";case "UnaryExpression":c=g(a.argument,b);break;case "BinaryExpression":c=g(a.left,b);if(""!==c)break;c=g(a.right,b);if(""!==c)break;switch(a.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:return p(a,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "LogicalExpression":c=g(a.left,
b);if(""!==c)break;c=g(a.right);if(""!==c)break;switch(a.operator){case "\x26\x26":case "||":break;default:return p(a,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "ConditionalExpression":return p(a,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":c="";for(d=0;d<a.elements.length&&(c=g(a.elements[d],b),""===c);d++);break;case "Array":return p(a,"SYNTAX","NOTSUPPORTED");case "ObjectExpression":c="";for(d=0;d<a.properties.length&&(c="",null!==a.properties[d].key&&("Literal"!==a.properties[d].key.type&&
"Identifier"!==a.properties[d].key.type&&(c=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[d].key.type&&(e=a.properties[d].key.value,"string"===typeof e||e instanceof String||(c=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")))),""===c&&(c=g(a.properties[d],b)),""===c);d++);break;case "Property":if("Literal"!==a.key.type&&"Identifier"!==a.key.type)return p(a,"SYNTAX","ONLYLITERAL");if("Identifier"!==a.key.type&&(c=g(a.key,b),""!==c))break;c=g(a.value,b)}return c}catch(A){throw A;
}}function d(b,c){var h=p(b,"SYNTAX","UNREOGNISED"),g=null,n="";try{switch(b.type){case "VariableDeclarator":if(null!==b.init&&"FunctionExpression"===b.init.type)return p(b,"SYNTAX","FUNCTIONVARIABLEDECLARATOR");b.id.name.toLowerCase();var k=null===b.init?"":d(b.init,c);if(""!==k)return k;null===c.localScope?c.globalScope[b.id.name.toLowerCase()]={type:"any"}:c.localScope[b.id.name.toLowerCase()]={type:"any"};return"";case "FunctionDeclaration":g=a(b.id.name.toLowerCase(),b,c);n=l(b,c);if(""!==n)return n;
if(null!==c.localScope)return p(b,"SYNTAX","GLOBALFUNCTIONSONLY");g.isnative=!1;c.globalScope[b.id.name.toLowerCase()]={type:"FormulaFunction",signature:[g]};return"";case "VariableDeclaration":for(var h="",q=0;q<b.declarations.length&&(h=d(b.declarations[q],c),""===h);q++);break;case "IfStatement":h=d(b.test,c);if(""!==h)break;if("AssignmentExpression"===b.test.type||"UpdateExpression"===b.test.type)return p(b.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");if(null!==b.consequent&&(h=d(b.consequent,
c),""!==h))break;if(null!==b.alternate&&(h=d(b.alternate,c),""!==h))break;return"";case "EmptyStatement":return"";case "BlockStatement":for(q=0;q<b.body.length;q++)if(h=d(b.body[q],c),""!==h)return h;return"";case "ReturnStatement":return null!==b.argument?d(b.argument,c):"";case "ForInStatement":if("VariableDeclaration"===b.left.type){if(1<b.left.declarations.length)return p(b,"SYNTAX","ONLY1VAR");if(null!==b.left.declarations[0].init)return p(b,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==
b.left.type)return p(b,"SYNTAX","LEFTNOTVAR");h=d(b.left,c);if(""!==h)break;h=d(b.right,c);if(""!==h)break;h=d(b.body,c);if(""!==h)break;return"";case "ForStatement":if(null!==b.init&&(h=d(b.init,c),""!==h))break;if(null!==b.test&&(h=d(b.test,c),""!==h))break;if(null!==b.body&&(h=d(b.body,c),""!==h))break;if(null!==b.update&&(h=d(b.update,c),""!==h))break;return"";case "BreakStatement":return"";case "ContinueStatement":return"";case "UpdateExpression":if("Identifier"!==b.argument.type&&"MemberExpression"!==
b.argument.type)return p(b,"SYNTAX","ASSIGNMENTTOVARSONLY");var f=!1;if("MemberExpression"===b.argument.type)return d(b.argument,c);null!==c.localScope&&void 0!==c.localScope[b.argument.name.toLowerCase()]&&(f=!0);void 0!==c.globalScope[b.argument.name.toLowerCase()]&&(f=!0);return!1===f?"Identifier "+b.argument.name+" has not been declared.":"";case "AssignmentExpression":if("Identifier"!==b.left.type&&"MemberExpression"!==b.left.type)return p(b,"SYNTAX","ASSIGNMENTTOVARSONLY");var u=d(b.right,c);
if(""!==u)return u;f=!1;if("MemberExpression"===b.left.type)return u=d(b.left,c),""!==u?u:"";null!==c.localScope&&void 0!==c.localScope[b.left.name.toLowerCase()]&&(f=!0);void 0!==c.globalScope[b.left.name.toLowerCase()]&&(f=!0);return!1===f?"Identifier "+b.left.name+" has not been declared.":"";case "ExpressionStatement":return d(b.expression,c);case "Identifier":var r=b.name.toLowerCase();if(null!==c.localScope&&void 0!==c.localScope[r])return"";h=void 0!==c.globalScope[r]?"":p(b,"SYNTAX","VARIABLENOTFOUND");
break;case "MemberExpression":h=d(b.object,c);if(""!==h)break;return!0===b.computed?d(b.property,c):"";case "Literal":return"";case "ThisExpression":h=p(b,"SYNTAX","NOTSUPPORTED");break;case "CallExpression":if("Identifier"!==b.callee.type)return p(b,"SYNTAX","ONLYNODESSUPPORTED");h="";for(q=0;q<b.arguments.length;q++)if(h=d(b.arguments[q],c),""!==h)return h;var x=e(b.callee.name,b.arguments,c);-1===x&&(h=p(b,"SYNTAX","NOTFOUND"));-2===x&&(h=p(b,"SYNTAX","WRONGSIGNATURE"));break;case "UnaryExpression":h=
d(b.argument,c);break;case "BinaryExpression":h=d(b.left,c);if(""!==h)break;h=d(b.right,c);if(""!==h)break;return"";case "LogicalExpression":h=d(b.left,c);if(""!==h)break;if("AssignmentExpression"===b.left.type||"UpdateExpression"===b.left.type)return p(b.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");h=d(b.right,c);if(""!==h)break;return"AssignmentExpression"===b.right.type||"UpdateExpression"===b.right.type?p(b.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"";case "ConditionalExpression":return p(b,
"SYNTAX","NOTSUPPORTED");case "ArrayExpression":h="";for(q=0;q<b.elements.length&&(h=d(b.elements[q],c),""===h);q++);break;case "ObjectExpression":h="";for(q=0;q<b.properties.length;q++){h="";if(null!==b.properties[q].key&&("Literal"!==b.properties[q].key.type&&"Identifier"!==b.properties[q].key.type&&(h=p(b,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===b.properties[q].key.type)){var t=b.properties[q].key.value;"string"===typeof t||t instanceof String||(h=p(b,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}""===
h&&(h=d(b.properties[q],c));if(""!==h)break}break;case "Property":if("Literal"!==b.key.type&&"Identifier"!==b.key.type)return p(b,"SYNTAX","ONLYLITERAL");if("Identifier"!==b.key.type&&(h=d(b.key,c),""!==h))break;h=d(b.value,c);break;case "Array":return p(b,"SYNTAX","NOTSUPPORTED")}return h}catch(N){throw N;}}function h(a,b){var c=!1;try{switch(a.type){case "VariableDeclarator":return null!==a.init?h(a.init,b):c;case "FunctionDeclaration":return h(a.body,b);case "VariableDeclaration":for(var d=0;d<
a.declarations.length;d++)if(h(a.declarations[d],b))return!0;return c;case "IfStatement":return h(a.test,b)||null!==a.consequent&&h(a.consequent,b)||null!==a.alternate&&h(a.alternate,b)?!0:c;case "EmptyStatement":return c;case "BlockStatement":for(d=0;d<a.body.length;d++)if(h(a.body[d],b))return!0;return c;case "ReturnStatement":return null!==a.argument?h(a.argument,b):c;case "UpdateExpression":return h(a.argument,b);case "AssignmentExpression":return(c=h(a.right,b))?c:h(a.left,b);case "ExpressionStatement":return h(a.expression,
b);case "ForInStatement":return(c=h(a.left,b))||(c=h(a.right,b))?c:c=h(a.body,b);case "ForStatement":if(null!==a.init&&(c=h(a.init,b))||null!==a.test&&(c=h(a.test,b))||null!==a.body&&(c=h(a.body,b)))return c;null!==a.update&&(c=h(a.update,b));return c;case "BreakStatement":return c;case "ContinueStatement":return c;case "Compound":return c;case "Identifier":return b.toLowerCase()===a.name.toLowerCase();case "MemberExpression":if(c=h(a.object,b))return c;!0===a.computed&&(c=h(a.property,b));return c;
case "Literal":return c;case "ThisExpression":return c;case "CallExpression":for(d=0;d<a.arguments.length;d++)h(a.arguments[d],b)&&(c=!0);return c;case "ArrayExpression":for(d=0;d<a.elements.length;d++)h(a.elements[d],b)&&(c=!0);return c;case "UnaryExpression":return h(a.argument,b);case "BinaryExpression":return(c=h(a.left,b))?c:c=h(a.right,b);case "LogicalExpression":return(c=h(a.left,b))?c:c=h(a.right,b);case "ObjectExpression":for(d=0;d<a.properties.length;d++)h(a.properties[d],b)&&(c=!0);return c;
case "Property":return c=h(a.value,b);case "ConditionalExpression":return c;case "Array":return c;default:return c}}catch(y){throw y;}}function c(a,b){var d=!1;try{switch(a.type){case "VariableDeclarator":return null!==a.init?c(a.init,b):d;case "FunctionDeclaration":return c(a.body,b);case "VariableDeclaration":for(var e=0;e<a.declarations.length;e++)if(c(a.declarations[e],b))return!0;return d;case "IfStatement":return c(a.test,b)||null!==a.consequent&&c(a.consequent,b)||null!==a.alternate&&c(a.alternate,
b)?!0:d;case "EmptyStatement":return d;case "BlockStatement":for(e=0;e<a.body.length;e++)if(c(a.body[e],b))return!0;return d;case "ReturnStatement":return null!==a.argument?c(a.argument,b):d;case "UpdateExpression":return c(a.argument,b);case "AssignmentExpression":return c(a.left,b)?!0:c(a.right,b);case "ExpressionStatement":return c(a.expression,b);case "ForInStatement":return(d=c(a.left,b))||(d=c(a.right,b))?d:d=c(a.body,b);case "ForStatement":if(null!==a.init&&(d=c(a.init,b))||null!==a.test&&
(d=c(a.test,b))||null!==a.body&&(d=c(a.body,b)))return d;null!==a.update&&(d=c(a.update,b));return d;case "BreakStatement":return d;case "ContinueStatement":return d;case "Compound":return d;case "Identifier":return d;case "MemberExpression":if(d=c(a.object,b))return d;!0===a.computed&&(d=c(a.property,b));return d;case "Literal":return d;case "ThisExpression":return d;case "CallExpression":if(a.callee.name.toLowerCase()===b.toLowerCase())return!0;for(e=0;e<a.arguments.length;e++)c(a.arguments[e],
b)&&(d=!0);return d;case "ArrayExpression":for(e=0;e<a.elements.length;e++)c(a.elements[e],b)&&(d=!0);return d;case "UnaryExpression":return c(a.argument,b);case "BinaryExpression":return(d=c(a.left,b))?d:d=c(a.right,b);case "LogicalExpression":return(d=c(a.left,b))?d:d=c(a.right,b);case "ConditionalExpression":return d;case "ObjectExpression":for(e=0;e<a.properties.length;e++)c(a.properties[e],b)&&(d=!0);return d;case "Property":return d=c(a.value,b);case "Array":return d;default:return d}}catch(y){throw y;
}}function b(a,c){var d=[],e;try{switch(a.type){case "VariableDeclarator":return null!==a.init?b(a.init,c):d;case "FunctionDeclaration":return b(a.body,c);case "VariableDeclaration":for(var l=0;l<a.declarations.length;l++)e=b(a.declarations[l],c),d=d.concat(e);return d;case "ForInStatement":return e=b(a.left,c),d=d.concat(e),e=b(a.right,c),d=d.concat(e),e=b(a.body,c),d=d.concat(e);case "ForStatement":return null!==a.init&&(e=b(a.init,c),d=d.concat(e)),null!==a.test&&(e=b(a.test,c),d=d.concat(e)),
null!==a.body&&(e=b(a.body,c),d=d.concat(e)),null!==a.update&&(e=b(a.update,c),d=d.concat(e)),d;case "IfStatement":return e=b(a.test,c),d=d.concat(e),null!==a.consequent&&(e=b(a.consequent,c),d=d.concat(e)),null!==a.alternate&&(e=b(a.alternate,c),d=d.concat(e)),d;case "EmptyStatement":return d;case "BlockStatement":for(l=0;l<a.body.length;l++)e=b(a.body[l],c),d=d.concat(e);return d;case "ReturnStatement":return null!==a.argument?b(a.argument,c):d;case "UpdateExpression":return b(a.argument,c);case "AssignmentExpression":return d=
b(a.left,c),d=d.concat(b(a.right,c));case "ExpressionStatement":return b(a.expression,c);case "BreakStatement":return d;case "ContinueStatement":return d;case "Compound":return d;case "Identifier":return d;case "MemberExpression":if("Identifier"!==a.object.type)return d;if(!1===a.computed)d.push(a.object.name.toLowerCase()+"."+a.property.name.toLowerCase());else try{"Literal"===a.property.type&&"string"===typeof a.property.value&&d.push(a.object.name.toLowerCase()+"."+a.property.value.toString().toLowerCase())}catch(A){}return d;
case "Literal":return d;case "ThisExpression":return d;case "CallExpression":for(l=0;l<a.arguments.length;l++)e=b(a.arguments[l],c),d=d.concat(e);return d;case "ArrayExpression":for(l=0;l<a.elements.length;l++)e=b(a.elements[l],c),d=d.concat(e);return d;case "UnaryExpression":return b(a.argument,c);case "ObjectExpression":for(l=0;l<a.properties.length;l++)e=b(a.properties[l],c),d=d.concat(e);return d;case "Property":return b(a.value,c);case "BinaryExpression":return e=b(a.left,c),d=d.concat(e),e=
b(a.right,c),d=d.concat(e);case "LogicalExpression":return e=b(a.left,c),d=d.concat(e),e=b(a.right,c),d=d.concat(e);case "ConditionalExpression":return d;case "Array":return d;default:return d}}catch(A){throw A;}}function a(a,b,c){c=[];if(void 0!==b.params&&null!==b.params)for(var d=0;d<b.params.length;d++)c.push("any");return{name:a,return:"any",params:c}}function l(a,b){b={globalScope:b.globalScope,localScope:{}};for(var c=0;c<a.params.length;c++)b.localScope[a.params[c].name.toLowerCase()]={type:"any"};
return d(a.body,b)}function n(a,b,c,d){var e={};if(void 0===a||null===a)a={};if(void 0===c||null===c)c={};e.infinity={type:"any"};e.textformatting={type:"any"};e.pi={type:"any"};for(var l in b)if("simple"!==d||"simple"===d&&"a"===b[l].av)e[l]={type:"FormulaFunction",signature:{min:b[l].min,max:b[l].max}},"simple"!==d&&(void 0!==b[l].fmin&&(e[l].signature.min=b[l].fmin),void 0!==b[l].fmax&&(e[l].signature.max=b[l].fmax));for(b=0;b<c.length;b++)l=c[b],e[l.name]={type:"FormulaFunction",signature:l};
for(l in a)e[l]=a[l],e[l].type="any";return e}function p(a,b,c){var d="";switch(b){case "SYNTAX":d="Syntax Error: ";break;case "RUNTIME":d="Runtime Error: ";break;default:d="Syntax Error: "}try{switch(a.type){case "IfStatement":switch(c){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":d+=" Assignments not be made in logical tests";break;case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":d+=" Non Boolean used as Condition"}break;case "UpdateExpression":case "AssignmentExpression":switch(c){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":d+=
" Assignments not be made in logical tests";break;case "ASSIGNMENTTOVARSONLY":d+=" Assignments can only be made to identifiers"}break;case "ExpressionStatement":d+=" Assignments can only be made to identifiers";break;case "FunctionDeclaration":switch(c){case "GLOBALFUNCTIONSONLY":d+=" Functions cannot be declared as variables";break;case "FUNCTIONMUSTHAVEIDENTIFIER":d+=" Function Definition must have an identifier"}break;case "VariableDeclaration":d+=" Only 1 variable can be declared at a time";break;
case "VariableDeclarator":switch(c){case "FUNCTIONVARIABLEDECLARATOR":d+=" Functions cannot be declared as variables";break;case "VARIABLEMUSTHAVEIDENTIFIER":d+=" Variable Definition must have an identifier"}break;case "Identifier":d+=" Identifier Not Found. ";d+=a.name;break;case "ObjectExpression":switch(c){case "OBJECTPROPERTYMUSTBESTRING":d+=" Property name must be a string"}break;case "ForStatement":switch(c){case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":d+=" Non Boolean used as Condition"}break;
case "ForInStatement":switch(c){case "ONLY1VAR":d+=" Can only declare 1 var for use with IN";break;case "CANNOTDECLAREVAL":d+=" Can only declare value for use with IN";break;case "LEFTNOVAR":d+="Must provide a variable to iterate with.";break;case "VARIABLENOTDECLARED":d+="Variable must be declared before it is used..";break;case "CANNOTITERATETHISTYPE":d+="This type cannot be used in an IN loop"}break;case "MemberExpression":switch(c){case "PROPERTYNOTFOUND":d+="Cannot find member property. ";d+=
!1===a.computed?a.property.name:"";break;case "OUTOFBOUNDS":d+="Out of Bounds. ";d+=!1===a.computed?a.property.name:"";break;case "NOTFOUND":d+="Cannot call member method on null. ";d+=!1===a.computed?a.property.name:"";break;case "INVALIDTYPE":d+="Cannot call member property on object of this type. ",d+=!1===a.computed?a.property.name:""}break;case "Property":switch(c){case "ONLYLITERAL":d+="Property names must be literals or identifiers"}break;case "Literal":break;case "ThisExpression":d+="THIS construct is not supported.";
case "CallExpression":switch(c){case "WRONGSIGNATURE":d+="Function signature does not match: ";d+=a.callee.name;break;case "ONLYNODESUPPORTED":d+="Functions must be declared.";d+=a.callee.name;break;case "NOTAFUNCTION":d+="Not a Function: ";d+=a.callee.name;break;case "NOTFOUND":d+="Function Not Found: "+a.callee.name}break;case "UnaryExpression":switch(c){case "NOTSUPPORTEDUNARYOPERATOR":d+="Operator "+a.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";
break;case "NOTSUPPORTEDTYPE":d+="Unary operator "+a.operator+" cannot be used with this argument."}case "BinaryExpression":switch(c){case "OPERATORNOTRECOGNISED":d+="Binary Operator not recognised "+a.operator}break;case "LogicalExpression":switch(c){case "ONLYBOOLEAN":d+="Operator "+a.operator+" cannot be used. Only || or \x26\x26 are allowed values";break;case "ONLYORORAND":d+="Logical Expression "+a.operator+" being applied to parameters that are not boolean."}break;case "ConditionalExpression":d+=
"Conditional statements not supported.";break;case "ArrayExpression":switch(c){case "FUNCTIONCONTEXTILLEGAL":d+=" Cannot Put Function inside Array."}break;case "Array":d+="Expression contains unrecognised array structure.";break;default:d+="Expression contains unrecognised code structures."}}catch(y){throw y;}return d}function q(a,b,c){return{line:a.loc.start.line,character:a.loc.start.column,reason:p(a,b,c)}}function r(a,b,c,d,e){void 0===e&&(e=!0);b={globalScope:b.globalScope,localScope:{}};for(e=
0;e<a.params.length;e++)b.localScope[a.params[e].name.toLowerCase()]={type:"any"};t(a.body,b,c,d,!1)}function t(b,c,d,l,h){void 0===h&&(h=!0);if(null===b)throw Error("Unnexpexted Expression Syntax");var g=null;try{switch(b.type){case "VariableDeclarator":if(null!==b.init&&"FunctionExpression"===b.init.type){l.push(q(b,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"));break}"Identifier"!==b.id.type?l.push(q(b,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(b.id.name.toLowerCase(),null===c.localScope?c.globalScope[b.id.name.toLowerCase()]=
{type:"any"}:c.localScope[b.id.name.toLowerCase()]={type:"any"});null===b.init?"":t(b.init,c,d,l,h);break;case "FunctionDeclaration":!1===h&&l.push(q(b,"SYNTAX","GLOBALFUNCTIONSONLY"));"Identifier"!==b.id.type&&l.push(q(b,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"));g=a("",b,c);r(b,c,d,l,h);null!==c.localScope&&l.push(q(b,"SYNTAX","GLOBALFUNCTIONSONLY"));g.isnative=!1;"Identifier"===b.id.type&&(c.globalScope[b.id.name.toLowerCase()]={type:"FormulaFunction",signature:[g]});break;case "VariableDeclaration":for(var n=
0;n<b.declarations.length;n++)t(b.declarations[n],c,d,l,h);break;case "IfStatement":null!==b.test&&(t(b.test,c,d,l,h),"AssignmentExpression"!==b.test.type&&"UpdateExpression"!==b.test.type||l.push(q(b.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));null!==b.consequent&&t(b.consequent,c,d,l,h);null!==b.alternate&&t(b.alternate,c,d,l,h);break;case "EmptyStatement":break;case "BlockStatement":if(null!==b.body)for(n=0;n<b.body.length;n++)t(b.body[n],c,d,l,h);break;case "ReturnStatement":null!==
b.argument&&t(b.argument,c,d,l,h);break;case "ForInStatement":"VariableDeclaration"===b.left.type?(1<b.left.declarations.length&&l.push(q(b,"SYNTAX","ONLY1VAR")),null!==b.left.declarations[0].init&&l.push(q(b,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==b.left.type&&l.push(q(b,"SYNTAX","LEFTNOTVAR"));t(b.left,c,d,l,h);t(b.right,c,d,l,h);t(b.body,c,d,l,h);break;case "ForStatement":null!==b.init&&t(b.init,c,d,l,h);null!==b.test&&t(b.test,c,d,l,h);null!==b.body&&t(b.body,c,d,l,h);null!==b.update&&t(b.update,
c,d,l,h);break;case "BreakStatement":break;case "ContinueStatement":break;case "UpdateExpression":"Identifier"!==b.argument.type&&"MemberExpression"!==b.argument.type?l.push(q(b,"SYNTAX","ASSIGNMENTTOVARSONLY")):("Identifier"===b.argument.type&&(g=!1,!1===d&&(null!==c.localScope&&void 0!==c.localScope[b.argument.name.toLowerCase()]&&(g=!0),void 0!==c.globalScope[b.argument.name.toLowerCase()]&&(g=!0),!1===g&&l.push({line:null===b?0:b.loc.start.line,character:null===b?0:b.loc.start.column,reason:"Identifier "+
b.argument.name+" has not been declared."}))),"MemberExpression"===b.argument.type&&t(b.argument,c,d,l,h));break;case "AssignmentExpression":"Identifier"!==b.left.type&&"MemberExpression"!==b.left.type&&l.push(q(b,"SYNTAX","ASSIGNMENTTOVARSONLY"));switch(b.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:l.push(q(b,"SYNTAX","OPERATORNOTRECOGNISED"))}t(b.right,c,d,l,h);g=!1;"Identifier"===b.left.type&&(null!==c.localScope&&void 0!==c.localScope[b.left.name.toLowerCase()]&&
(g=!0),void 0!==c.globalScope[b.left.name.toLowerCase()]&&(g=!0),!1===d&&!1===g&&l.push({line:null===b?0:b.loc.start.line,character:null===b?0:b.loc.start.column,reason:"Identifier "+b.argument.name+" has not been declared."}));"MemberExpression"===b.left.type&&t(b.left,c,d,l,h);break;case "ExpressionStatement":t(b.expression,c,d,l,h);break;case "Identifier":var k=b.name.toLowerCase();if(null!==c.localScope&&void 0!==c.localScope[k])break;void 0===c.globalScope[k]&&!1===d&&l.push(q(b,"SYNTAX","VARIABLENOTFOUND"));
break;case "MemberExpression":t(b.object,c,d,l,h);!0===b.computed&&t(b.property,c,d,l,h);break;case "Literal":return"";case "ThisExpression":l.push(q(b,"SYNTAX","NOTSUPPORTED"));break;case "CallExpression":"Identifier"!==b.callee.type&&l.push(q(b,"SYNTAX","ONLYNODESSUPPORTED"));for(n=0;n<b.arguments.length;n++)t(b.arguments[n],c,d,l,h);var p=e(b.callee.name,b.arguments,c);!1===d&&-1===p&&l.push(q(b,"SYNTAX","NOTFOUND"));-2===p&&l.push(q(b,"SYNTAX","WRONGSIGNATURE"));break;case "UnaryExpression":t(b.argument,
c,d,l,h);break;case "BinaryExpression":t(b.left,c,d,l,h);t(b.right,c,d,l,h);switch(b.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:l.push(q(b,"SYNTAX","OPERATORNOTRECOGNISED"))}break;case "LogicalExpression":switch(b.operator){case "\x26\x26":case "||":break;default:l.push(q(b,"SYNTAX","OPERATORNOTRECOGNISED"))}t(b.left,c,d,l,h);"AssignmentExpression"!==b.left.type&&"UpdateExpression"!==b.left.type||
l.push(q(b,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));t(b.right,c,d,l,h);"AssignmentExpression"!==b.right.type&&"UpdateExpression"!==b.right.type||l.push(q(b,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));break;case "ConditionalExpression":l.push(q(b,"SYNTAX","NOTSUPPORTED"));break;case "ArrayExpression":for(n=0;n<b.elements.length;n++)t(b.elements[n],c,d,l,h);break;case "Array":l.push(q(b,"SYNTAX","NOTSUPPORTED"));case "ObjectExpression":for(n=0;n<b.properties.length;n++)t(b.properties[n],
c,d,l,h);break;case "Property":"Literal"!==b.key.type&&"Identifier"!==b.key.type&&l.push(q(b,"SYNTAX","ONLYLITERAL"));"Literal"===b.key.type&&t(b.key,c,d,l,h);t(b.value,c,d,l,h);break;default:l.push(q(b,"SYNTAX","UNRECOGNISED"))}}catch(D){l.push({line:null===b?0:b.loc.start.line,character:null===b?0:b.loc.start.column,reason:"Unnexpected Syntax"})}}function w(a,b){var c=[],d;try{switch(a.type){case "VariableDeclarator":return null!==a.init?w(a.init,b):c;case "FunctionDeclaration":return w(a.body,
b);case "VariableDeclaration":for(var e=0;e<a.declarations.length;e++)d=w(a.declarations[e],b),c=c.concat(d);return c;case "ForInStatement":return d=w(a.left,b),c=c.concat(d),d=w(a.right,b),c=c.concat(d),d=w(a.body,b),c=c.concat(d);case "ForStatement":return null!==a.init&&(d=w(a.init,b),c=c.concat(d)),null!==a.test&&(d=w(a.test,b),c=c.concat(d)),null!==a.body&&(d=w(a.body,b),c=c.concat(d)),null!==a.update&&(d=w(a.update,b),c=c.concat(d)),c;case "IfStatement":return d=w(a.test,b),c=c.concat(d),null!==
a.consequent&&(d=w(a.consequent,b),c=c.concat(d)),null!==a.alternate&&(d=w(a.alternate,b),c=c.concat(d)),c;case "EmptyStatement":return c;case "BlockStatement":for(e=0;e<a.body.length;e++)d=w(a.body[e],b),c=c.concat(d);return c;case "ReturnStatement":return null!==a.argument?w(a.argument,b):c;case "UpdateExpression":return w(a.argument,b);case "AssignmentExpression":return c=w(a.left,b),c=c.concat(w(a.right,b));case "ExpressionStatement":return w(a.expression,b);case "BreakStatement":return c;case "ContinueStatement":return c;
case "Compound":return c;case "Identifier":return c;case "MemberExpression":return c;case "Literal":return c;case "ThisExpression":return c;case "CallExpression":for(e=0;e<a.arguments.length;e++)d=w(a.arguments[e],b),c=c.concat(d);c.push(a.callee.name.toLowerCase());return c;case "ArrayExpression":for(e=0;e<a.elements.length;e++)d=w(a.elements[e],b),c=c.concat(d);return c;case "UnaryExpression":return w(a.argument,b);case "ObjectExpression":for(e=0;e<a.properties.length;e++)d=w(a.properties[e],b),
c=c.concat(d);return c;case "Property":return w(a.value,b);case "BinaryExpression":return d=w(a.left,b),c=c.concat(d),d=w(a.right,b),c=c.concat(d);case "LogicalExpression":return d=w(a.left,b),c=c.concat(d),d=w(a.right,b),c=c.concat(d);case "ConditionalExpression":return c;case "Array":return c;default:return c}}catch(A){throw A;}}Object.defineProperty(f,"__esModule",{value:!0});f.functionDecls={concatenate:{min:"0",max:"*",av:"a"},split:{min:"2",max:"4",av:"a"},guid:{min:"0",max:"1",av:"a"},today:{min:"0",
max:"0",av:"a"},now:{min:"0",max:"0",av:"a"},timestamp:{min:"0",max:"0",av:"a"},day:{min:"1",max:"1",av:"a"},month:{min:"1",max:"1",av:"a"},year:{min:"1",max:"1",av:"a"},hour:{min:"1",max:"1",av:"a"},second:{min:"1",max:"1",av:"a"},millisecond:{min:"1",max:"1",av:"a"},minute:{min:"1",max:"1",av:"a"},weekday:{min:"1",max:"1",av:"a"},toutc:{min:"1",max:"1",av:"a"},tolocal:{min:"1",max:"1",av:"a"},date:{min:"0",max:"7",av:"a"},datediff:{min:"2",max:"3",av:"a"},dateadd:{min:"2",max:"3",av:"a"},trim:{min:"1",
max:"1",av:"a"},text:{min:"1",max:"2",av:"a"},left:{min:"2",max:"2",av:"a"},right:{min:"2",max:"2",av:"a"},mid:{min:"2",max:"3",av:"a"},upper:{min:"1",max:"1",av:"a"},proper:{min:"1",max:"2",av:"a"},lower:{min:"1",max:"1",av:"a"},find:{min:"2",max:"3",av:"a"},iif:{min:"3",max:"3",av:"a"},decode:{min:"2",max:"*",av:"a"},when:{min:"2",max:"*",av:"a"},defaultvalue:{min:"2",max:"2",av:"a"},isempty:{min:"1",max:"1",av:"a"},domaincode:{min:"3",max:"4",av:"a"},domainname:{min:"2",max:"4",av:"a"},polygon:{min:"1",
max:"1",av:"a"},point:{min:"1",max:"1",av:"a"},polyline:{min:"1",max:"1",av:"a"},extent:{min:"1",max:"1",av:"a"},multipoint:{min:"1",max:"1",av:"a"},geometry:{min:"1",max:"1",av:"a"},count:{min:"0",max:"*",av:"a"},number:{min:"1",max:"2",av:"a"},acos:{min:"1",max:"1",av:"a"},asin:{min:"1",max:"1",av:"a"},atan:{min:"1",max:"1",av:"a"},atan2:{min:"2",max:"2",av:"a"},ceil:{min:"1",max:"2",av:"a"},floor:{min:"1",max:"2",av:"a"},round:{min:"1",max:"2",av:"a"},cos:{min:"1",max:"1",av:"a"},exp:{min:"1",
max:"1",av:"a"},log:{min:"1",max:"1",av:"a"},min:{min:"0",max:"*",av:"a"},constrain:{min:"3",max:"3",av:"a"},console:{min:"0",max:"*",av:"a"},max:{min:"0",max:"*",av:"a"},pow:{min:"2",max:"2",av:"a"},random:{min:"0",max:"0",av:"a"},sqrt:{min:"1",max:"1",av:"a"},sin:{min:"1",max:"1",av:"a"},tan:{min:"1",max:"1",av:"a"},abs:{min:"1",max:"1",av:"a"},isnan:{min:"1",max:"1",av:"a"},stdev:{min:"0",max:"*",av:"a"},average:{min:"0",max:"*",av:"a"},mean:{min:"0",max:"*",av:"a"},sum:{min:"0",max:"*",av:"a"},
variance:{min:"0",max:"*",av:"a"},distinct:{min:"0",max:"*",av:"a"},first:{min:"1",max:"1",av:"a"},top:{min:"2",max:"2",av:"a"},boolean:{min:"1",max:"1",av:"a"},dictionary:{min:"0",max:"*",av:"a"},typeof:{min:"1",max:"1",av:"a"},reverse:{min:"1",max:"1",av:"a"},replace:{min:"3",max:"4",av:"a"},sort:{min:"1",max:"2",av:"a"},feature:{min:"1",max:"*",av:"a"},haskey:{min:"2",max:"2",av:"a"},indexof:{min:"2",max:"2",av:"a"},disjoint:{min:"2",max:"2",av:"a"},intersects:{min:"2",max:"2",av:"a"},touches:{min:"2",
max:"2",av:"a"},crosses:{min:"2",max:"2",av:"a"},within:{min:"2",max:"2",av:"a"},contains:{min:"2",max:"2",av:"a"},overlaps:{min:"2",max:"2",av:"a"},equals:{min:"2",max:"2",av:"a"},relate:{min:"3",max:"3",av:"a"},intersection:{min:"2",max:"2",av:"a"},union:{min:"1",max:"2",av:"a"},difference:{min:"2",max:"2",av:"a"},symmetricdifference:{min:"2",max:"2",av:"a"},clip:{min:"2",max:"2",av:"a"},cut:{min:"2",max:"2",av:"a"},area:{min:"1",max:"2",av:"a"},areageodetic:{min:"1",max:"2",av:"a"},length:{min:"1",
max:"2",av:"a"},lengthgeodetic:{min:"1",max:"2",av:"a"},distance:{min:"2",max:"3",av:"a"},densify:{min:"2",max:"3",av:"a"},densifygeodetic:{min:"2",max:"3",av:"a"},generalize:{min:"2",max:"4",av:"a"},buffer:{min:"2",max:"3",av:"a"},buffergeodetic:{min:"2",max:"3",av:"a"},offset:{min:"2",max:"6",av:"a"},rotate:{min:"2",max:"3",av:"a"},issimple:{min:"1",max:"1",av:"a"},simplify:{min:"1",max:"1",av:"a"},centroid:{min:"1",max:"1",av:"a"},multiparttosinglepart:{min:"1",max:"1",av:"a"},setgeometry:{min:"2",
max:"2",av:"a"}};f.addFunctionDeclaration=function(a,b){var c=f.functionDecls[a.name.toLowerCase()];void 0===c?f.functionDecls[a.name.toLowerCase()]={min:a.min,max:a.max,av:b}:"a"===c.av&&"f"===b?(void 0!==c.fmin&&delete c.fmin,void 0!==c.fmax&&delete c.fmax,c.fmin=a.min,c.fmax=a.max):"f"===c.av&&"a"===b?(void 0===c.fmin&&(c.fmin=c.min),void 0===c.fmax&&(c.fmax=c.max),c.min=a.min,c.max=a.max,c.av="a"):"f"===b?(c.fmin=a.min,c.fmax=a.max):"a"===b&&(c.min=a.min,c.max=a.max)};f.checkFunctionSignature=
k;f.findFunction=e;f.validateLanguageNode=g;f.testValidityOfExpression=d;f.referencesMemberImpl=h;f.referencesMember=function(a,b){return!0===h(a.body[0].body,b.toLowerCase())?!0:!1};f.referencesFunctionImpl=c;f.referencesFunction=function(a,b){return!0===c(a.body[0].body,b)?!0:!1};f.findFieldLiteralsImpl=b;f.findFieldLiterals=function(a,c){return b(a.body[0].body,c)};f.extractFunctionDeclaration=a;f.validateFunction=l;f.constructGlobalScope=n;f.validateScript=function(a,b,c){void 0===c&&(c="full");
b={globalScope:n(b.vars,f.functionDecls,b.customFunctions,c),localScope:null};return d(a.body[0].body,b)};f.validateLanguage=function(a){return"BlockStatement"!==a.body[0].body.type?"Invalid formula content.":g(a.body[0].body)};f.nodeErrorMessage=p;f.makeError=q;f.extractAllIssuesInFunction=r;f.extractAllIssues=t;f.checkScript=function(a,b,c,d){void 0===d&&(d="full");var e=[];if("BlockStatement"!==a.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];if(null===b||void 0===b)b={vars:{},
customFunctions:[]};b={globalScope:n(b.vars,f.functionDecls,b.customFunctions,d),localScope:null};try{t(a.body[0].body,b,c,e)}catch(A){}return e};f.findFunctionCallsImpl=w;f.findFunctionCalls=function(a,b){return w(a.body[0].body,b)}})},"esri/arcade/functions/date":function(){define(["require","exports","../../moment","../languageUtils"],function(m,f,k,e){function g(d){return null===d?d:isNaN(d.getTime())?null:d}Object.defineProperty(f,"__esModule",{value:!0});f.registerFunctions=function(d,h){d.today=
function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,0,0);a=new Date;a.setHours(0,0,0,0);return a})};d.now=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,0,0);return new Date})};d.timestamp=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,0,0);a=new Date;return a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};d.toutc=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);
return null===a?null:new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};d.tolocal=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?null:k.utc([a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()]).toDate()})};d.day=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getDate()})};
d.month=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getMonth()})};d.year=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getFullYear()})};d.hour=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getHours()})};d.second=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getSeconds()})};d.millisecond=
function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getMilliseconds()})};d.minute=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getMinutes()})};d.weekday=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,1,1);a=e.toDate(c[0]);return null===a?NaN:a.getDay()})};d.date=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,0,7);if(3===c.length)return g(new Date(e.toNumber(c[0]),e.toNumber(c[1]),e.toNumber(c[2]),
0,0,0,0));if(4===c.length)return g(new Date(e.toNumber(c[0]),e.toNumber(c[1]),e.toNumber(c[2]),e.toNumber(c[3]),0,0,0));if(5===c.length)return g(new Date(e.toNumber(c[0]),e.toNumber(c[1]),e.toNumber(c[2]),e.toNumber(c[3]),e.toNumber(c[4]),0,0));if(6===c.length)return g(new Date(e.toNumber(c[0]),e.toNumber(c[1]),e.toNumber(c[2]),e.toNumber(c[3]),e.toNumber(c[4]),e.toNumber(c[5]),0));if(7===c.length)return g(new Date(e.toNumber(c[0]),e.toNumber(c[1]),e.toNumber(c[2]),e.toNumber(c[3]),e.toNumber(c[4]),
e.toNumber(c[5]),e.toNumber(c[6])));if(2===c.length){a=e.toString(c[1]);if(""===a)return null;a=e.standardiseDateFormat(a);c=k(e.toString(c[0]),a,!0);return!0===c.isValid()?c.toDate():null}if(1===c.length){if(e.isString(c[0])&&""===c[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;a=e.toNumber(c[0]);return!1===isNaN(a)?g(new Date(a)):e.toDate(c[0])}if(0===c.length)return new Date})};d.datediff=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,2,3);a=e.toDateM(c[0]);b=e.toDateM(c[1]);
if(null===a||null===b)return NaN;switch(e.toString(c[2]).toLowerCase()){case "days":case "day":case "d":return a.diff(b,"days",!0);case "months":case "month":return a.diff(b,"months",!0);case "minutes":case "minute":case "m":return"M"===c[2]?a.diff(b,"months",!0):a.diff(b,"minutes",!0);case "seconds":case "second":case "s":return a.diff(b,"seconds",!0);case "milliseconds":case "millisecond":case "ms":return a.diff(b);case "hours":case "hour":case "h":return a.diff(b,"hours",!0);case "years":case "year":case "y":return a.diff(b,
"years",!0);default:return a.diff(b)}})};d.dateadd=function(c,b){return h(c,b,function(a,b,c){e.pcCheck(c,2,3);a=e.toDateM(c[0]);if(null===a)return null;b="milliseconds";switch(e.toString(c[2]).toLowerCase()){case "days":case "day":case "d":b="days";break;case "months":case "month":b="months";break;case "minutes":case "minute":case "m":b="M"===c[2]?"months":"minutes";break;case "seconds":case "second":case "s":b="seconds";break;case "milliseconds":case "millisecond":case "ms":b="milliseconds";break;
case "hours":case "hour":case "h":b="hours";break;case "years":case "year":case "y":b="years"}a.add(e.toNumber(c[1]),b);return a.toDate()})}}})},"esri/arcade/functions/geometry":function(){define("require exports ../Dictionary ../Feature ../languageUtils ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/jsonUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n){Object.defineProperty(f,"__esModule",
{value:!0});f.registerFunctions=function(p,q){p.polygon=function(b,c){return q(b,c,function(c,d,l){g.pcCheck(l,1,1);c=null;if(l[0]instanceof k){if(c=g.fixSpatialReference(e.parseGeometryFromDictionary(l[0]),b.spatialReference),!1===c instanceof a)throw Error("Illegal Parameter");}else c=l[0]instanceof a?n.fromJSON(l[0].toJSON()):g.fixSpatialReference(new a(JSON.parse(l[0])),b.spatialReference);if(null!==c&&!1===c.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return g.fixNullGeometry(c)})};p.polyline=function(a,b){return q(a,b,function(b,c,d){g.pcCheck(d,1,1);b=null;if(d[0]instanceof k){if(b=g.fixSpatialReference(e.parseGeometryFromDictionary(d[0]),a.spatialReference),!1===b instanceof l)throw Error("Illegal Parameter");}else b=d[0]instanceof l?n.fromJSON(d[0].toJSON()):g.fixSpatialReference(new l(JSON.parse(d[0])),a.spatialReference);if(null!==b&&!1===b.spatialReference.equals(a.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return g.fixNullGeometry(b)})};p.point=function(a,c){return q(a,c,function(c,d,l){g.pcCheck(l,1,1);c=null;if(l[0]instanceof k){if(c=g.fixSpatialReference(e.parseGeometryFromDictionary(l[0]),a.spatialReference),!1===c instanceof b)throw Error("Illegal Parameter");}else c=l[0]instanceof b?n.fromJSON(l[0].toJSON()):g.fixSpatialReference(new b(JSON.parse(l[0])),a.spatialReference);if(null!==c&&!1===c.spatialReference.equals(a.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return g.fixNullGeometry(c)})};p.multipoint=function(a,b){return q(a,b,function(b,d,l){g.pcCheck(l,1,1);b=null;if(l[0]instanceof k){if(b=g.fixSpatialReference(e.parseGeometryFromDictionary(l[0]),a.spatialReference),!1===b instanceof c)throw Error("Illegal Parameter");}else b=l[0]instanceof c?n.fromJSON(l[0].toJSON()):g.fixSpatialReference(new c(JSON.parse(l[0])),a.spatialReference);if(null!==b&&!1===b.spatialReference.equals(a.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");
return g.fixNullGeometry(b)})};p.extent=function(h,p){return q(h,p,function(p,q,f){f=g.autoCastFeatureToGeometry(f);g.pcCheck(f,1,1);p=null;f[0]instanceof k?p=g.fixSpatialReference(e.parseGeometryFromDictionary(f[0]),h.spatialReference):f[0]instanceof b?(p={xmin:f[0].x,ymin:f[0].y,xmax:f[0].x,ymax:f[0].y,spatialReference:f[0].spatialReference.toJSON()},f[0].hasZ?(p.zmin=f[0].z,p.zmax=f[0].z):f[0].hasM&&(p.mmin=f[0].m,p.mmax=f[0].m),p=n.fromJSON(p)):p=f[0]instanceof a?n.fromJSON(f[0].extent.toJSON()):
f[0]instanceof l?n.fromJSON(f[0].extent.toJSON()):f[0]instanceof c?n.fromJSON(f[0].extent.toJSON()):f[0]instanceof d?n.fromJSON(f[0].toJSON()):g.fixSpatialReference(new d(JSON.parse(f[0])),h.spatialReference);if(null!==p&&!1===p.spatialReference.equals(h.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return g.fixNullGeometry(p)})};p.geometry=function(a,b){return q(a,b,function(b,c,d){g.pcCheck(d,1,1);b=null;b=d[0]instanceof
e?g.fixSpatialReference(d[0].geometry(),a.spatialReference):d[0]instanceof k?g.fixSpatialReference(e.parseGeometryFromDictionary(d[0]),a.spatialReference):g.fixSpatialReference(n.fromJSON(JSON.parse(d[0])),a.spatialReference);if(null!==b&&!1===b.spatialReference.equals(a.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return g.fixNullGeometry(b)})};p.setgeometry=function(a,b){return q(a,b,function(a,b,c){g.pcCheck(c,
2,2);if(c[0]instanceof e){if(!0===c[0].immutable)throw Error("Feature is Immutable");if(c[1]instanceof h||null===c[1])c[0]._geometry=c[1];else throw Error("Illegal Argument");}else throw Error("Illegal Argument");return g.voidOperation})};p.feature=function(a,b){return q(a,b,function(b,c,d){if(0===d.length)throw Error("Missing Parameters");b=null;if(1===d.length)if(g.isString(d[0]))b=e.fromJson(JSON.parse(d[0]));else if(d[0]instanceof e)b=e.createFromArcadeFeature(d[0]);else if(d[0]instanceof h)b=
e.createFromGraphicLikeObject(d[0],null,null);else if(d[0]instanceof k)b=d[0].hasField("geometry")?d[0].field("geometry"):null,c=d[0].hasField("attributes")?d[0].field("attributes"):null,null!==b&&b instanceof k&&(b=e.parseGeometryFromDictionary(b)),null!==c&&(c=e.parseAttributesFromDictionary(c)),b=e.createFromGraphicLikeObject(b,c,null);else throw Error("Illegal Argument");else{if(2===d.length){c=b=null;if(null!==d[0])if(d[0]instanceof h)b=d[0];else if(b instanceof k)b=e.parseGeometryFromDictionary(d[0]);
else throw Error("Illegal Argument");if(null!==d[1])if(d[1]instanceof k)c=e.parseAttributesFromDictionary(d[1]);else throw Error("Illegal Argument");}else{b=null;c={};if(null!==d[0])if(d[0]instanceof h)b=d[0];else if(b instanceof k)b=e.parseGeometryFromDictionary(d[0]);else throw Error("Illegal Argument");for(var l=1;l<d.length;l+=2){var n=g.toString(d[l]),p=d[l+1];if(null===p||void 0===p||g.isString(p)||isNaN(p)||g.isDate(p)||g.isNumber(p)||g.isBoolean(p)){if(g.isFunctionParameter(p)||!1===g.isSimpleType(p))throw Error("Illegal Argument");
c[n]=p===g.voidOperation?null:p}else throw Error("Illegal Argument");}}b=e.createFromGraphicLikeObject(b,c,null)}b._geometry=g.fixSpatialReference(b.geometry(),a.spatialReference);b.immutable=!1;return b})};p.dictionary=function(a,b){return q(a,b,function(a,b,c){if(0===c.length)throw Error("Missing Parameters");if(0!==c.length%2)throw Error("Missing Parameters");a={};for(b=0;b<c.length;b+=2){var d=g.toString(c[b]),e=c[b+1];if(null===e||void 0===e||g.isString(e)||isNaN(e)||g.isDate(e)||g.isNumber(e)||
g.isBoolean(e)||g.isArray(e)||g.isImmutableArray(e)){if(g.isFunctionParameter(e))throw Error("Illegal Argument");a[d]=e===g.voidOperation?null:e}else throw Error("Illegal Argument");}c=new k(a);c.immutable=!1;return c})};p.haskey=function(a,b){return q(a,b,function(a,b,c){g.pcCheck(c,2,2);a=g.toString(c[1]);if(c[0]instanceof e||c[0]instanceof k)return c[0].hasField(a);throw Error("Illegal Argument");})};p.indexof=function(a,b){return q(a,b,function(a,b,c){g.pcCheck(c,2,2);a=c[1];if(g.isArray(c[0])){for(b=
0;b<c[0].length;b++)if(g.equalityTest(a,c[0][b]))return b;return-1}if(g.isImmutableArray(c[0])){var d=c[0].length();for(b=0;b<d;b++)if(g.equalityTest(a,c[0].get(b)))return b;return-1}throw Error("Illegal Argument");})}}})},"esri/arcade/functions/geomsync":function(){define("require exports ../../kernel ../kernel ../languageUtils ./centroid ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/jsonUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(a){return w?a.clone():p.fromJSON(a.toJSON())}function r(a){return 0===k.version.indexOf("4.")?l.fromExtent(a):new l({spatialReference:a.spatialReference,rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]})}Object.defineProperty(f,"__esModule",{value:!0});var t=null,w=0===k.version.indexOf("4.");f.setGeometryEngine=function(a){t=a};f.registerFunctions=function(k,f){function v(a){g.pcCheck(a,2,2);if(!(a[0]instanceof
c&&a[1]instanceof c||a[0]instanceof c&&null===a[1]||a[1]instanceof c&&null===a[0]||null===a[0]&&null===a[1]))throw Error("Illegal Argument");}k.disjoint=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?!0:t.disjoint(c[0],c[1])})};k.intersects=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?!1:t.intersects(c[0],c[1])})};k.touches=function(a,b){return f(a,b,function(a,b,c){c=
g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?!1:t.touches(c[0],c[1])})};k.crosses=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?!1:t.crosses(c[0],c[1])})};k.within=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?!1:t.within(c[0],c[1])})};k.contains=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||
null===c[1]?!1:t.contains(c[0],c[1])})};k.overlaps=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?!1:t.overlaps(c[0],c[1])})};k.equals=function(a,b){return f(a,b,function(a,b,d){g.pcCheck(d,2,2);return d[0]===d[1]?!0:d[0]instanceof c&&d[1]instanceof c?t.equals(d[0],d[1]):g.isDate(d[0])&&g.isDate(d[1])?d[0].getTime()===d[1].getTime():!1})};k.relate=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,
3,3);if(d[0]instanceof c&&d[1]instanceof c)return t.relate(d[0],d[1],g.toString(d[2]));if(d[0]instanceof c&&null===d[1]||d[1]instanceof c&&null===d[0]||null===d[0]&&null===d[1])return!1;throw Error("Illegal Argument");})};k.intersection=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]||null===c[1]?null:t.intersect(c[0],c[1])})};k.union=function(a,b){return f(a,b,function(b,d,e){e=g.autoCastFeatureToGeometry(e);b=[];if(0===e.length)throw Error("Function called with wrong number of Parameters");
if(1===e.length)if(g.isArray(e[0]))for(e=g.autoCastFeatureToGeometry(e[0]),d=0;d<e.length;d++){if(null!==e[d])if(e[d]instanceof c)b.push(e[d]);else throw Error("Illegal Argument");}else if(g.isImmutableArray(e[0]))for(e=g.autoCastFeatureToGeometry(e[0].toArray()),d=0;d<e.length;d++){if(null!==e[d])if(e[d]instanceof c)b.push(e[d]);else throw Error("Illegal Argument");}else{if(e[0]instanceof c)return g.fixSpatialReference(q(e[0]),a.spatialReference);if(null===e[0])return null;throw Error("Illegal Argument");
}else for(d=0;d<e.length;d++)if(null!==e[d])if(e[d]instanceof c)b.push(e[d]);else throw Error("Illegal Argument");return 0===b.length?null:t.union(b)})};k.difference=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null!==c[0]&&null===c[1]?q(c[0]):null===c[0]?null:t.difference(c[0],c[1])})};k.symmetricdifference=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);v(c);return null===c[0]&&null===c[1]?null:null===c[0]?q(c[1]):null===c[1]?
q(c[0]):t.symmetricDifference(c[0],c[1])})};k.clip=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,2);if(!(d[1]instanceof h)&&null!==d[1])throw Error("Illegal Argument");if(null===d[0])return null;if(!(d[0]instanceof c))throw Error("Illegal Argument");return null===d[1]?null:t.clip(d[0],d[1])})};k.cut=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,2);if(!(d[1]instanceof n)&&null!==d[1])throw Error("Illegal Argument");
if(null===d[0])return[];if(!(d[0]instanceof c))throw Error("Illegal Argument");return null===d[1]?[q(d[0])]:t.cut(d[0],d[1])})};k.area=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,1,2);if(null===d[0])return 0;if(!(d[0]instanceof c))throw Error("Illegal Argument");return t.planarArea(d[0],e.convertSquareUnitsToCode(g.defaultUndefined(d[1],-1)))})};k.areageodetic=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,1,2);if(null===
d[0])return 0;if(!(d[0]instanceof c))throw Error("Illegal Argument");return t.geodesicArea(d[0],e.convertSquareUnitsToCode(g.defaultUndefined(d[1],-1)))})};k.length=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,1,2);if(null===d[0])return 0;if(!(d[0]instanceof c))throw Error("Illegal Argument");return t.planarLength(d[0],e.convertLinearUnitsToCode(g.defaultUndefined(d[1],-1)))})};k.lengthgeodetic=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);
g.pcCheck(d,1,2);if(null===d[0])return 0;if(!(d[0]instanceof c))throw Error("Illegal Argument");return t.geodesicLength(d[0],e.convertLinearUnitsToCode(g.defaultUndefined(d[1],-1)))})};k.distance=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,3);if(!(d[0]instanceof c))throw Error("Illegal Argument");if(!(d[1]instanceof c))throw Error("Illegal Argument");return t.distance(d[0],d[1],e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1)))})};k.densify=function(a,
b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof c))throw Error("Illegal Argument");a=g.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return d[0]instanceof l||d[0]instanceof n?t.densify(d[0],a,e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1))):d[0]instanceof h?t.densify(r(d[0]),a,e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1))):d[0]})};k.densifygeodetic=
function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof c))throw Error("Illegal Argument");a=g.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return d[0]instanceof l||d[0]instanceof n?t.geodesicDensify(d[0],a,e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1))):d[0]instanceof h?t.geodesicDensify(r(d[0]),a,e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1))):
d[0]})};k.generalize=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,4);if(null===d[0])return null;if(!(d[0]instanceof c))throw Error("Illegal Argument");a=g.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");return t.generalize(d[0],a,g.toBoolean(g.defaultUndefined(d[2],!0)),e.convertLinearUnitsToCode(g.defaultUndefined(d[3],-1)))})};k.buffer=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,3);if(null===d[0])return null;
if(!(d[0]instanceof c))throw Error("Illegal Argument");a=g.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");return 0===a?q(d[0]):t.buffer(d[0],a,e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1)))})};k.buffergeodetic=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof c))throw Error("Illegal Argument");a=g.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");return 0===a?q(d[0]):t.geodesicBuffer(d[0],
a,e.convertLinearUnitsToCode(g.defaultUndefined(d[2],-1)))})};k.offset=function(a,b){return f(a,b,function(a,b,c){c=g.autoCastFeatureToGeometry(c);g.pcCheck(c,2,6);if(null===c[0])return null;if(!(c[0]instanceof l||c[0]instanceof n))throw Error("Illegal Argument");a=g.toNumber(c[1]);if(isNaN(a))throw Error("Illegal Argument");b=g.toNumber(g.defaultUndefined(c[4],10));if(isNaN(b))throw Error("Illegal Argument");var d=g.toNumber(g.defaultUndefined(c[5],0));if(isNaN(d))throw Error("Illegal Argument");
return t.offset(c[0],a,e.convertLinearUnitsToCode(g.defaultUndefined(c[2],-1)),g.toString(g.defaultUndefined(c[3],"round")).toLowerCase(),b,d)})};k.rotate=function(b,d){return f(b,d,function(b,d,e){e=g.autoCastFeatureToGeometry(e);g.pcCheck(e,2,3);b=e[0];if(null===b)return null;if(!(b instanceof c))throw Error("Illegal Argument");b instanceof h&&(b=l.fromExtent(b));d=g.toNumber(e[1]);if(isNaN(d))throw Error("Illegal Argument");e=g.defaultUndefined(e[2],null);if(null===e)return t.rotate(b,d);if(e instanceof
a)return t.rotate(b,d,e);throw Error("Illegal Argument");})};k.centroid=function(e,k){return f(e,k,function(k,p,f){f=g.autoCastFeatureToGeometry(f);g.pcCheck(f,1,1);if(null===f[0])return null;if(!(f[0]instanceof c))throw Error("Illegal Argument");return f[0]instanceof a?g.fixSpatialReference(q(f[0]),e.spatialReference):f[0]instanceof l?w?f[0].centroid:f[0].getCentroid():f[0]instanceof n?d.centroidPolyline(f[0]):f[0]instanceof b?d.centroidMultiPoint(f[0]):f[0]instanceof h?w?f[0].center:f[0].getExtent().getCenter():
null})};k.multiparttosinglepart=function(d,e){return f(d,e,function(e,k,f){f=g.autoCastFeatureToGeometry(f);g.pcCheck(f,1,1);k=[];if(null===f[0])return null;if(!(f[0]instanceof c))throw Error("Illegal Argument");if(f[0]instanceof a||f[0]instanceof h)return[g.fixSpatialReference(q(f[0]),d.spatialReference)];e=t.simplify(f[0]);if(e instanceof l){k=[];var r=[];for(f=0;f<e.rings.length;f++)if(e.isClockwise(e.rings[f])){var v=p.fromJSON({rings:[e.rings[f]],hasZ:w?e.hasZ:!1,hasM:w?e.hasM:!1,spatialReference:w?
e.spatialReference.toJSON():e.spatialReference.toJson()});k.push(v)}else r.push({ring:e.rings[f],pt:e.getPoint(f,0)});for(e=0;e<r.length;e++)for(f=0;f<k.length;f++)if(k[f].contains(r[e].pt)){k[f].addRing(r[e].ring);break}return k}if(e instanceof n){k=[];for(f=0;f<e.paths.length;f++)r=p.fromJSON({paths:[e.paths[f]],hasZ:w?e.hasZ:!1,hasM:w?e.hasM:!1,spatialReference:w?e.spatialReference.toJSON():e.spatialReference.toJson()}),k.push(r);return k}if(f[0]instanceof b){e=g.fixSpatialReference(q(f[0]),d.spatialReference);
for(f=0;f<e.points.length;f++)k.push(e.getPoint(f));return k}return null})};k.issimple=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,1,1);if(null===d[0])return!0;if(d[0]instanceof c)return t.isSimple(d[0]);throw Error("Illegal Argument");})};k.simplify=function(a,b){return f(a,b,function(a,b,d){d=g.autoCastFeatureToGeometry(d);g.pcCheck(d,1,1);if(null===d[0])return null;if(d[0]instanceof c)return t.simplify(d[0]);throw Error("Illegal Argument");})}}})},"esri/arcade/kernel":function(){define(["require",
"exports","../geometry/Extent"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.errback=function(e){return function(g){e.reject(g)}};f.callback=function(e,g){return function(){try{e.apply(null,arguments)}catch(d){g.reject(d)}}};f.convertSquareUnitsToCode=function(e){if(void 0===e)return null;if("number"===typeof e)return e;switch(e.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square_meters":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 109413;
case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 109405}return null};
f.shapeExtent=function(e){if(null===e)return null;switch(e.type){case "polygon":case "multipoint":case "polyline":return e.extent;case "point":return new k({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case "extent":return e}return null};f.convertLinearUnitsToCode=function(e){if(void 0===e)return null;if("number"===typeof e||"number"===typeof e)return e;switch(e.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square-meters":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 9035;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 9002}return null};
f.sameGeomType=function(e,g){return e===g||"point"===e&&"esriGeometryPoint"===g||"polyline"===e&&"esriGeometryPolyline"===g||"polygon"===e&&"esriGeometryPolygon"===g||"extent"===e&&"esriGeometryEnvelope"===g||"multipoint"===e&&"esriGeometryMultipoint"===g||"point"===g&&"esriGeometryPoint"===e||"polyline"===g&&"esriGeometryPolyline"===e||"polygon"===g&&"esriGeometryPolygon"===e||"extent"===g&&"esriGeometryEnvelope"===e||"multipoint"===g&&"esriGeometryMultipoint"===e?!0:!1}})},"esri/arcade/functions/centroid":function(){define(["require",
"exports","../../kernel","../../geometry/Point"],function(m,f,k,e){function g(c,b,a){var e={x:0,y:0};b&&(e.z=0);a&&(e.m=0);for(var h=0,g=c[0],k=0;k<c.length;k++){var f=c[k],t;a:if(f.length!==g.length)t=!1;else{for(t=0;t<f.length;t++)if(f[t]!==g[t]){t=!1;break a}t=!0}if(!1===t){t=d(g,f,b);var m=f,u=b,x=a,v={x:(g[0]+m[0])/2,y:(g[1]+m[1])/2};u&&(v.z=(g[2]+m[2])/2);u&&x?v.m=(g[3]+m[3])/2:x&&(v.m=(g[2]+m[2])/2);g=v;g.x*=t;g.y*=t;e.x+=g.x;e.y+=g.y;b&&(g.z*=t,e.z+=g.z);a&&(g.m*=t,e.m+=g.m);h+=t;g=f}}0<h?
(e.x/=h,e.y/=h,b&&(e.z/=h),a&&(e.m/=h)):(e.x=c[0][0],e.y=c[0][1],b&&(e.z=c[0][2]),a&&b?e.m=c[0][3]:a&&(e.m=c[0][2]));return e}function d(c,b,a){var d=b[0]-c[0];c=b[1]-c[1];return a?(b=b[2]-b[2],Math.sqrt(d*d+c*c+b*b)):Math.sqrt(d*d+c*c)}Object.defineProperty(f,"__esModule",{value:!0});var h=0===k.version.indexOf("4.");f.centroidPolyline=function(c){for(var b={x:0,y:0,spatialReference:h?c.spatialReference.toJSON():c.spatialReference.toJson()},a={x:0,y:0,spatialReference:h?c.spatialReference.toJSON():
c.spatialReference.toJson()},l=0,n=0,k=0;k<c.paths.length;k++)if(0!==c.paths[k].length){var q;q=c.paths[k];var f=!0===c.hasZ;if(1>=q.length)q=0;else{for(var t=0,m=1;m<q.length;m++)t+=d(q[m-1],q[m],f);q=t}0===q?(f=g(c.paths[k],!0===c.hasZ,!0===c.hasM),b.x+=f.x,b.y+=f.y,!0===c.hasZ&&(b.z+=f.z),!0===c.hasM&&(b.m+=f.m),++l):(f=g(c.paths[k],!0===c.hasZ,!0===c.hasM),a.x+=f.x*q,a.y+=f.y*q,!0===c.hasZ&&(a.z+=f.z*q),!0===c.hasM&&(a.m+=f.m*q),n+=q)}return 0<n?(a.x/=n,a.y/=n,!0===c.hasZ&&(a.z/=n),!0===c.hasM&&
(a.m/=n),new e(a)):0<l?(b.x/=l,b.y/=l,!0===c.hasZ&&(a.z/=l),!0===c.hasM&&(b.m/=l),new e(b)):null};f.centroidMultiPoint=function(c){if(0===c.points.length)return null;for(var b=0,a=0,d=0,g=0,k=0;k<c.points.length;k++){var q=c.getPoint(k);!0===q.hasZ&&(d+=q.z);!0===q.hasM&&(g+=q.m);b+=q.x;a+=q.y;g+=q.m}b={x:b/c.points.length,y:a/c.points.length,spatialReference:null};b.spatialReference=h?c.spatialReference.toJSON():c.spatialReference.toJson();!0===c.hasZ&&(b.z=d/c.points.length);!0===c.hasM&&(b.m=g/
c.points.length);return new e(b)}})},"esri/arcade/functions/maths":function(){define(["require","exports","dojo/number","../languageUtils"],function(m,f,k,e){function g(d,e,c){if("undefined"===typeof c||0===+c)return Math[d](e);e=+e;c=+c;if(isNaN(e)||"number"!==typeof c||0!==c%1)return NaN;e=e.toString().split("e");e=Math[d](+(e[0]+"e"+(e[1]?+e[1]-c:-c)));e=e.toString().split("e");return+(e[0]+"e"+(e[1]?+e[1]+c:c))}Object.defineProperty(f,"__esModule",{value:!0});f.registerFunctions=function(d,h){function c(b,
a,c){b=e.toNumber(b);return isNaN(b)?b:isNaN(a)||isNaN(c)||a>c?NaN:b<a?a:b>c?c:b}d.number=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,2);a=c[0];return e.isNumber(a)?a:null===a?0:e.isDate(a)||e.isBoolean(a)?Number(a):e.isArray(a)?NaN:""===a||void 0===a?Number(a):e.isString(a)?void 0!==c[1]?(c=e.multiReplace(c[1],"\u2030",""),c=e.multiReplace(c,"\u00a4",""),k.parse(a,{pattern:c})):Number(a.trim()):Number(a)})};d.abs=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.abs(e.toNumber(c[0]))})};
d.acos=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.acos(e.toNumber(c[0]))})};d.asin=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.asin(e.toNumber(c[0]))})};d.atan=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.atan(e.toNumber(c[0]))})};d.atan2=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,2,2);return Math.atan2(e.toNumber(c[0]),e.toNumber(c[1]))})};d.ceil=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,
1,2);return 2===c.length?(a=e.toNumber(c[1]),isNaN(a)&&(a=0),g("ceil",e.toNumber(c[0]),-1*a)):Math.ceil(e.toNumber(c[0]))})};d.round=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,2);return 2===c.length?(a=e.toNumber(c[1]),isNaN(a)&&(a=0),g("round",e.toNumber(c[0]),-1*a)):Math.round(e.toNumber(c[0]))})};d.floor=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,2);return 2===c.length?(a=e.toNumber(c[1]),isNaN(a)&&(a=0),g("floor",e.toNumber(c[0]),-1*a)):Math.floor(e.toNumber(c[0]))})};
d.cos=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.cos(e.toNumber(c[0]))})};d.isnan=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return"number"===typeof c[0]&&isNaN(c[0])})};d.exp=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.exp(e.toNumber(c[0]))})};d.log=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.log(e.toNumber(c[0]))})};d.pow=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,2,2);return Math.pow(e.toNumber(c[0]),
e.toNumber(c[1]))})};d.random=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,0,0);return Math.random()})};d.sin=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.sin(e.toNumber(c[0]))})};d.sqrt=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.sqrt(e.toNumber(c[0]))})};d.tan=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return Math.tan(e.toNumber(c[0]))})};d.defaultvalue=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,2,2);return null===
c[0]||""===c[0]||void 0===c[0]?c[1]:c[0]})};d.isempty=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return null===c[0]||""===c[0]||void 0===c[0]?!0:!1})};d["boolean"]=function(b,a){return h(b,a,function(a,b,c){e.pcCheck(c,1,1);return e.toBoolean(c[0])})};d.constrain=function(b,a){return h(b,a,function(a,b,d){e.pcCheck(d,3,3);a=e.toNumber(d[1]);b=e.toNumber(d[2]);if(e.isArray(d[0])){var l=[],h=0;for(d=d[0];h<d.length;h++)l.push(c(d[h],a,b));return l}if(e.isImmutableArray(d[0])){l=[];
for(h=0;h<d[0].length();h++)l.push(c(d[0].get(h),a,b));return l}return c(d[0],a,b)})}}})},"esri/arcade/functions/stats":function(){define(["require","exports","../languageUtils","./fieldStats"],function(m,f,k,e){function g(d,h,c,b){if(1===b.length){if(k.isArray(b[0]))return e.calculateStat(d,b[0],-1);if(k.isImmutableArray(b[0]))return e.calculateStat(d,b[0].toArray(),-1)}return e.calculateStat(d,b,-1)}Object.defineProperty(f,"__esModule",{value:!0});f.registerFunctions=function(d,e){d.stdev=function(c,
b){return e(c,b,function(a,b,c){return g("stdev",a,b,c)})};d.variance=function(c,b){return e(c,b,function(a,b,c){return g("variance",a,b,c)})};d.average=function(c,b){return e(c,b,function(a,b,c){return g("mean",a,b,c)})};d.mean=function(c,b){return e(c,b,function(a,b,c){return g("mean",a,b,c)})};d.sum=function(c,b){return e(c,b,function(a,b,c){return g("sum",a,b,c)})};d.min=function(c,b){return e(c,b,function(a,b,c){return g("min",a,b,c)})};d.max=function(c,b){return e(c,b,function(a,b,c){return g("max",
a,b,c)})};d.distinct=function(c,b){return e(c,b,function(a,b,c){return g("distinct",a,b,c)})};d.count=function(c,b){return e(c,b,function(a,b,c){k.pcCheck(c,1,1);if(k.isArray(c[0])||k.isString(c[0]))return c[0].length;if(k.isImmutableArray(c[0]))return c[0].length();throw Error("Invalid Parameters for Count");})}}})},"esri/arcade/functions/fieldStats":function(){define(["require","exports","../languageUtils"],function(m,f,k){function e(d){for(var e=0,c=0;c<d.length;c++)e+=d[c];return e/d.length}function g(d){for(var h=
e(d),c=0,b=0;b<d.length;b++)c+=Math.pow(h-d[b],2);return c/d.length}Object.defineProperty(f,"__esModule",{value:!0});f.decodeStatType=function(d){switch(d.toLowerCase()){case "distinct":return"distinct";case "avg":case "mean":return"avg";case "min":return"min";case "sum":return"sum";case "max":return"max";case "stdev":case "stddev":return"stddev";case "var":case "variance":return"var";case "count":return"count"}return""};f.calculateStat=function(d,h,c){void 0===c&&(c=1E3);switch(d.toLowerCase()){case "distinct":a:{d=
c;c=[];for(var b={},a=[],l=0;l<h.length;l++){if(void 0!==h[l]&&null!==h[l]&&h[l]!==k.voidOperation){var n=h[l];if(k.isNumber(n)||k.isString(n))void 0===b[n]&&(c.push(n),b[n]=1);else{for(var p=!1,q=0;q<a.length;q++)!0===k.equalityTest(a[q],n)&&(p=!0);!1===p&&(a.push(n),c.push(n))}}if(c.length>=d&&-1!==d){h=c;break a}}h=c}return h;case "avg":case "mean":return e(k.toNumberArray(h));case "min":return Math.min.apply(Math,k.toNumberArray(h));case "sum":h=k.toNumberArray(h);for(c=d=0;c<h.length;c++)d+=
h[c];return d;case "max":return Math.max.apply(Math,k.toNumberArray(h));case "stdev":case "stddev":return Math.sqrt(g(k.toNumberArray(h)));case "var":case "variance":return g(k.toNumberArray(h));case "count":return h.length}return 0}})},"esri/arcade/functions/string":function(){define(["require","exports","../Feature","../languageUtils"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.registerFunctions=function(g,d){g.trim=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,
1,1);return e.toString(c[0]).trim()})};g.upper=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,1,1);return e.toString(c[0]).toUpperCase()})};g.proper=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,1,2);b=1;2===c.length&&"firstword"===e.toString(c[1]).toLowerCase()&&(b=2);a=/\s/;c=e.toString(c[0]);for(var d="",l=!0,h=0;h<c.length;h++){var g=c[h];a.test(g)?1===b&&(l=!0):g.toUpperCase()!==g.toLowerCase()&&(l?(g=g.toUpperCase(),l=!1):g=g.toLowerCase());d+=g}return d})};g.lower=function(h,
c){return d(h,c,function(b,a,c){e.pcCheck(c,1,1);return e.toString(c[0]).toLowerCase()})};g.guid=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,0,1);if(0<c.length)switch(e.toString(c[0]).toLowerCase()){case "digits":return e.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case "digits-hyphen":return e.generateUUID();case "digits-hyphen-parentheses":return"("+e.generateUUID()+")"}return"{"+e.generateUUID()+"}"})};g.console=function(h,c){return d(h,c,function(b,
a,c){0!==c.length&&(1===c.length?h.console(e.toString(c[0])):h.console(e.toString(c)));return e.voidOperation})};g.mid=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,2,3);b=e.toNumber(c[1]);if(isNaN(b))return"";0>b&&(b=0);if(2===c.length)return e.toString(c[0]).substr(b);a=e.toNumber(c[2]);if(isNaN(a))return"";0>a&&(a=0);return e.toString(c[0]).substr(b,a)})};g.find=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,2,3);b=0;if(2<c.length){b=e.toNumber(e.defaultUndefined(c[2],0));if(isNaN(b))return-1;
0>b&&(b=0)}return e.toString(c[1]).indexOf(e.toString(c[0]),b)})};g.left=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,2,2);b=e.toNumber(c[1]);if(isNaN(b))return"";0>b&&(b=0);return e.toString(c[0]).substr(0,b)})};g.right=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,2,2);b=e.toNumber(c[1]);if(isNaN(b))return"";0>b&&(b=0);return e.toString(c[0]).substr(-1*b,b)})};g.split=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,2,4);b=e.toNumber(e.defaultUndefined(c[2],-1));a=e.toBoolean(e.defaultUndefined(c[3],
!1));-1===b||null===b||!0===a?c=e.toString(c[0]).split(e.toString(c[1])):(isNaN(b)&&(b=-1),-1>b&&(b=-1),c=e.toString(c[0]).split(e.toString(c[1]),b));if(!1===a)return c;a=[];for(var d=0;d<c.length&&!(-1!==b&&a.length>=b);d++)""!==c[d]&&void 0!==c[d]&&a.push(c[d]);return a})};g.text=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,1,2);return e.toStringExplicit(c[0],c[1])})};g.concatenate=function(h,c){return d(h,c,function(b,a,c){b=[];if(1>c.length)return"";if(e.isArray(c[0])){a=e.defaultUndefined(c[2],
"");for(var d=0;d<c[0].length;d++)b[d]=e.toStringExplicit(c[0][d],a);return 1<c.length?b.join(c[1]):b.join("")}if(e.isImmutableArray(c[0])){a=e.defaultUndefined(c[2],"");for(d=0;d<c[0].length();d++)b[d]=e.toStringExplicit(c[0].get(d),a);return 1<c.length?b.join(c[1]):b.join("")}for(d=0;d<c.length;d++)b[d]=e.toStringExplicit(c[d]);return b.join("")})};g.reverse=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,1,1);if(e.isArray(c[0]))return b=c[0].slice(0),b.reverse(),b;if(e.isImmutableArray(c[0]))return b=
c[0].toArray().slice(0),b.reverse(),b;throw Error("Invalid Parameter");})};g.replace=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,3,4);b=e.toString(c[0]);a=e.toString(c[1]);var d=e.toString(c[2]);return(4===c.length?e.toBoolean(c[3]):1)?e.multiReplace(b,a,d):b.replace(a,d)})};g.domainname=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,2,4);if(c[0]instanceof k)return c[0].domainValueLookup(e.toString(c[1]),c[2],void 0===c[3]?void 0:e.toNumber(c[3]));throw Error("Invalid Parameter");
})};g.domaincode=function(h,c){return d(h,c,function(b,a,c){e.pcCheck(c,3,4);if(c[0]instanceof k)return c[0].domainCodeLookup(e.toString(c[1]),c[2],void 0===c[3]?void 0:e.toNumber(c[3]));throw Error("Invalid Parameter");})}}})},"esri/arcade/arcadeRuntime":function(){define("require exports ./Dictionary ./Feature ./FunctionWrapper ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y){function A(a,b){for(var c=[],d=0;d<b.arguments.length;d++)c.push(C(a,b.arguments[d]));return c}function B(a,b,c){try{return c(a,b,A(a,b))}catch(ba){throw ba;}}function C(a,d){try{switch(d.type){case "EmptyStatement":return c.voidOperation;case "VariableDeclarator":var l=null===d.init?null:C(a,d.init);l===c.voidOperation&&(l=null);var h=d.id.name.toLowerCase();null!==a.localScope?a.localScope[h]={value:l,valueset:!0,node:d.init}:a.globalScope[h]=
{value:l,valueset:!0,node:d.init};return c.voidOperation;case "VariableDeclaration":for(var n=0;n<d.declarations.length;n++)C(a,d.declarations[n]);return c.voidOperation;case "BlockStatement":var p;a:{for(var q=c.voidOperation,n=0;n<d.body.length;n++)if(q=C(a,d.body[n]),q instanceof c.ReturnResult||q===c.breakResult||q===c.continueResult){p=q;break a}p=q}return p;case "FunctionDeclaration":var f=d.id.name.toLowerCase();a.globalScope[f]={valueset:!0,node:null,value:new g(d,a)};return c.voidOperation;
case "ReturnStatement":var r;if(null===d.argument)r=new c.ReturnResult(c.voidOperation);else{var v=C(a,d.argument);r=new c.ReturnResult(v)}return r;case "IfStatement":var u;if("AssignmentExpression"===d.test.type||"UpdateExpression"===d.test.type)throw Error(b.nodeErrorMessage(d.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var t=C(a,d.test);if(!0===t)u=C(a,d.consequent);else if(!1===t)u=null!==d.alternate?C(a,d.alternate):c.voidOperation;else throw Error(b.nodeErrorMessage(d,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));
return u;case "ExpressionStatement":var m;if("AssignmentExpression"===d.expression.type||"UpdateExpression"===d.expression.type)m=C(a,d.expression);else{var w=C(a,d.expression);m=w===c.voidOperation?c.voidOperation:new c.ImplicitResult(w)}return m;case "AssignmentExpression":var y;var x=C(a,d.right),n=null,z="";if("MemberExpression"===d.left.type){n=C(a,d.left.object);z=!0===d.left.computed?C(a,d.left.property):d.left.property.name;if(c.isArray(n))if(c.isNumber(z)){0>z&&(z=n.length+z);if(0>z||z>n.length)throw Error("Assignment outside of array bounds");
if(z===n.length&&"\x3d"!==d.operator)throw Error("Invalid Parameter");n[z]=D(x,d.operator,n[z],d)}else throw Error("Invalid Parameter");else if(n instanceof k){if(!1===c.isString(z))throw Error("Dictionary accessor must be a string");if(!0===n.hasField(z))n.setField(z,D(x,d.operator,n.field(z),d));else{if("\x3d"!==d.operator)throw Error("Invalid Parameter");n.setField(z,D(x,d.operator,null,d))}}else if(n instanceof e){if(!1===c.isString(z))throw Error("Feature accessor must be a string");if(!0===
n.hasField(z))n.setField(z,D(x,d.operator,n.field(z),d));else{if("\x3d"!==d.operator)throw Error("Invalid Parameter");n.setField(z,D(x,d.operator,null,d))}}else{if(c.isImmutableArray(n))throw Error("Array is Immutable");throw Error("Invalid Parameter");}y=c.voidOperation}else if(n=d.left.name.toLowerCase(),null!==a.localScope&&void 0!==a.localScope[n])a.localScope[n]={value:D(x,d.operator,a.localScope[n].value,d),valueset:!0,node:d.right},y=c.voidOperation;else if(void 0!==a.globalScope[n])a.globalScope[n]=
{value:D(x,d.operator,a.globalScope[n].value,d),valueset:!0,node:d.right},y=c.voidOperation;else throw Error("Variable not recognised");return y;case "UpdateExpression":var A;var B,n=null,z="";if("MemberExpression"===d.argument.type){n=C(a,d.argument.object);z=!0===d.argument.computed?C(a,d.argument.property):d.argument.property.name;if(c.isArray(n))if(c.isNumber(z)){0>z&&(z=n.length+z);if(0>z||z>=n.length)throw Error("Assignment outside of array bounds");B=c.toNumber(n[z]);n[z]="++"===d.operator?
B+1:B-1}else throw Error("Invalid Parameter");else if(n instanceof k){if(!1===c.isString(z))throw Error("Dictionary accessor must be a string");if(!0===n.hasField(z))B=c.toNumber(n.field(z)),n.setField(z,"++"===d.operator?B+1:B-1);else throw Error("Invalid Parameter");}else if(n instanceof e){if(!1===c.isString(z))throw Error("Feature accessor must be a string");if(!0===n.hasField(z))B=c.toNumber(n.field(z)),n.setField(z,"++"===d.operator?B+1:B-1);else throw Error("Invalid Parameter");}else{if(c.isImmutableArray(n))throw Error("Array is Immutable");
throw Error("Invalid Parameter");}A=!1===d.prefix?B:"++"===d.operator?B+1:B-1}else if(n=d.argument.name.toLowerCase(),null!==a.localScope&&void 0!==a.localScope[n])B=c.toNumber(a.localScope[n].value),a.localScope[n]={value:"++"===d.operator?B+1:B-1,valueset:!0,node:d},A=!1===d.prefix?B:"++"===d.operator?B+1:B-1;else if(void 0!==a.globalScope[n])B=c.toNumber(a.globalScope[n].value),a.globalScope[n]={value:"++"===d.operator?B+1:B-1,valueset:!0,node:d},A=!1===d.prefix?B:"++"===d.operator?B+1:B-1;else throw Error("Variable not recognised");
return A;case "BreakStatement":return c.breakResult;case "ContinueStatement":return c.continueResult;case "ForStatement":null!==d.init&&C(a,d.init);z={testResult:!0,lastAction:c.voidOperation};do b:{y=a;x=d;A=z;if(null!==x.test){A.testResult=C(y,x.test);if(!1===A.testResult)break b;if(!0!==A.testResult)throw Error(b.nodeErrorMessage(x,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));}A.lastAction=C(y,x.body);A.lastAction===c.breakResult?A.testResult=!1:A.lastAction instanceof c.ReturnResult?A.testResult=
!1:null!==x.update&&C(y,x.update)}while(!0===z.testResult);n=z.lastAction instanceof c.ReturnResult?z.lastAction:c.voidOperation;return n;case "ForInStatement":return E(a,d);case "Identifier":return O(a,d);case "MemberExpression":return M(a,d);case "Literal":return d.value;case "ThisExpression":throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTED"));case "CallExpression":return J(a,d);case "UnaryExpression":return N(a,d);case "BinaryExpression":return I(a,d);case "LogicalExpression":return G(a,
d);case "ConditionalExpression":throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{for(n=[],z=0;z<d.elements.length;z++){var F=C(a,d.elements[z]);if(c.isFunctionParameter(F))throw Error(b.nodeErrorMessage(d,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));F===c.voidOperation?n.push(null):n.push(F)}}catch(Ua){throw Ua;}return n;case "ObjectExpression":n={};for(z=0;z<d.properties.length;z++){var X=C(a,d.properties[z]);if(c.isFunctionParameter(X.value))throw Error("Illegal Argument");
if(!1===c.isString(X.key))throw Error("Illegal Argument");n[X.key.toString()]=X.value===c.voidOperation?null:X.value}var T=new k(n);T.immutable=!1;return T;case "Property":return{key:"Identifier"===d.key.type?d.key.name:C(a,d.key),value:C(a,d.value)};case "Array":throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTED"));default:throw Error(b.nodeErrorMessage(d,"RUNTIME","UNREOGNISED"));}}catch(Ua){throw Ua;}}function E(a,d){var l=C(a,d.right);"VariableDeclaration"===d.left.type&&C(a,d.left);var h=
null,g="VariableDeclaration"===d.left.type?d.left.declarations[0].id.name:d.left.name;null!==a.localScope&&void 0!==a.localScope[g]&&(h=a.localScope[g]);null===h&&void 0!==a.globalScope[g]&&(h=a.globalScope[g]);if(null===h)throw Error(b.nodeErrorMessage(d,"RUNTIME","VARIABLENOTDECLARED"));if(c.isArray(l)||c.isString(l)){for(var l=l.length,n=0;n<l&&(h.value=n,g=C(a,d.body),g!==c.breakResult);n++)if(g instanceof c.ReturnResult)return g;return c.voidOperation}if(c.isImmutableArray(l)){for(n=0;n<l.length()&&
(h.value=n,g=C(a,d.body),g!==c.breakResult);n++)if(g instanceof c.ReturnResult)return g;return c.voidOperation}if(l instanceof k||l instanceof e)for(l=l.keys(),n=0;n<l.length&&(h.value=l[n],g=C(a,d.body),g!==c.breakResult);n++){if(g instanceof c.ReturnResult)return g}else return c.voidOperation}function D(a,d,e,l){switch(d){case "\x3d":return a===c.voidOperation?null:a;case "/\x3d":return c.toNumber(e)/c.toNumber(a);case "*\x3d":return c.toNumber(e)*c.toNumber(a);case "-\x3d":return c.toNumber(e)-
c.toNumber(a);case "+\x3d":return c.isString(e)||c.isString(a)?c.toString(e)+c.toString(a):c.toNumber(e)+c.toNumber(a);case "%\x3d":return c.toNumber(e)%c.toNumber(a);default:throw Error(b.nodeErrorMessage(l,"RUNTIME","OPERATORNOTRECOGNISED"));}}function F(a,e,l,g){e=e.toLowerCase();switch(e){case "hasz":return a=a.hasZ,void 0===a?!1:a;case "hasm":return a=a.hasM,void 0===a?!1:a;case "spatialreference":return e=a.spatialReference._arcadeCacheId,void 0===e&&(l=!0,Object.freeze&&Object.isFrozen(a.spatialReference)&&
(l=!1),l&&(W++,e=a.spatialReference._arcadeCacheId=W)),a=new k({wkt:a.spatialReference.wkt,wkid:a.spatialReference.wkid}),void 0!==e&&(a._arcadeCacheId="SPREF"+e.toString()),a}switch(a.type){case "extent":switch(e){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return a=a[e],void 0!==a?a:null;case "type":return"Extent"}break;case "polygon":switch(e){case "rings":return e=c.isVersion4?a.cache._arcadeCacheId:a.getCacheValue("_arcadeCacheId"),void 0===
e&&(W++,e=W,c.isVersion4?a.cache._arcadeCacheId=e:a.setCacheValue("_arcadeCacheId",e)),a=new d(a.rings,a.spatialReference,!0===a.hasZ,!0===a.hasM,e);case "type":return"Polygon"}break;case "point":switch(e){case "x":case "y":case "z":case "m":return void 0!==a[e]?a[e]:null;case "type":return"Point"}break;case "polyline":switch(e){case "paths":return e=c.isVersion4?a.cache._arcadeCacheId:a.getCacheValue("_arcadeCacheId"),void 0===e&&(W++,e=W,c.isVersion4?a.cache._arcadeCacheId=e:a.setCacheValue("_arcadeCacheId",
e)),a=new d(a.paths,a.spatialReference,!0===a.hasZ,!0===a.hasM,e);case "type":return"Polyline"}break;case "multipoint":switch(e){case "points":return e=c.isVersion4?a.cache._arcadeCacheId:a.getCacheValue("_arcadeCacheId"),void 0===e&&(W++,e=W,c.isVersion4?a.cache._arcadeCacheId=e:a.setCacheValue("_arcadeCacheId",e)),a=new h(a.points,a.spatialReference,!0===a.hasZ,!0===a.hasM,e,1);case "type":return"Multipoint"}}throw Error(b.nodeErrorMessage(g,"RUNTIME","PROPERTYNOTFOUND"));}function M(a,d){try{var l=
C(a,d.object);if(null===l)throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTFOUND"));if(!1===d.computed){if(l instanceof k||l instanceof e)return l.field(d.property.name);if(l instanceof w)return F(l,d.property.name,a,d);throw Error(b.nodeErrorMessage(d,"RUNTIME","INVALIDTYPE"));}var h=C(a,d.property);if(l instanceof k||l instanceof e){if(c.isString(h))return l.field(h)}else if(l instanceof w){if(c.isString(h))return F(l,h,a,d)}else if(c.isArray(l)){if(c.isNumber(h)&&isFinite(h)&&Math.floor(h)===h){0>
h&&(h=l.length+h);if(h>=l.length||0>h)throw Error(b.nodeErrorMessage(d,"RUNTIME","OUTOFBOUNDS"));return l[h]}}else if(c.isString(l)){if(c.isNumber(h)&&isFinite(h)&&Math.floor(h)===h){0>h&&(h=l.length+h);if(h>=l.length||0>h)throw Error(b.nodeErrorMessage(d,"RUNTIME","OUTOFBOUNDS"));return l[h]}}else if(c.isImmutableArray(l)&&c.isNumber(h)&&isFinite(h)&&Math.floor(h)===h){0>h&&(h=l.length()+h);if(h>=l.length()||0>h)throw Error(b.nodeErrorMessage(d,"RUNTIME","OUTOFBOUNDS"));return l.get(h)}throw Error(b.nodeErrorMessage(d,
"RUNTIME","INVALIDTYPE"));}catch(ka){throw ka;}}function N(a,d){try{var e=C(a,d.argument);if(c.isBoolean(e)){if("!"===d.operator)return!e;if("-"===d.operator)return-1*c.toNumber(e);if("+"===d.operator)return 1*c.toNumber(e);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===d.operator)return-1*c.toNumber(e);if("+"===d.operator)return 1*c.toNumber(e);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}catch(ba){throw ba;}}function I(a,d){try{var e=
[C(a,d.left),C(a,d.right)],l=e[0],h=e[1];switch(d.operator){case "\x3d\x3d":return c.equalityTest(l,h);case "\x3d":return c.equalityTest(l,h);case "!\x3d":return!c.equalityTest(l,h);case "\x3c":return c.greaterThanLessThan(l,h,d.operator);case "\x3e":return c.greaterThanLessThan(l,h,d.operator);case "\x3c\x3d":return c.greaterThanLessThan(l,h,d.operator);case "\x3e\x3d":return c.greaterThanLessThan(l,h,d.operator);case "+":return c.isString(l)||c.isString(h)?c.toString(l)+c.toString(h):c.toNumber(l)+
c.toNumber(h);case "-":return c.toNumber(l)-c.toNumber(h);case "*":return c.toNumber(l)*c.toNumber(h);case "/":return c.toNumber(l)/c.toNumber(h);case "%":return c.toNumber(l)%c.toNumber(h);default:throw Error(b.nodeErrorMessage(d,"RUNTIME","OPERATORNOTRECOGNISED"));}}catch(ga){throw ga;}}function G(a,d){try{if("AssignmentExpression"===d.left.type||"UpdateExpression"===d.left.type)throw Error(b.nodeErrorMessage(d.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===d.right.type||
"UpdateExpression"===d.right.type)throw Error(b.nodeErrorMessage(d.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var e=C(a,d.left);if(c.isBoolean(e))switch(d.operator){case "||":if(!0===e)return e;var l=C(a,d.right);if(c.isBoolean(l))return l;throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYORORAND"));case "\x26\x26":if(!1===e)return e;l=C(a,d.right);if(c.isBoolean(l))return l;throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYORORAND"));default:throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYORORAND"));
}else throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYBOOLEAN"));}catch(ka){throw ka;}}function O(a,c){var d;try{var e=c.name.toLowerCase();if(null!==a.localScope&&void 0!==a.localScope[e])return d=a.localScope[e],!0!==d.valueset&&(d.value=C(a,d.node),d.valueset=!0),d.value;if(void 0!==a.globalScope[e])return d=a.globalScope[e],!0!==d.valueset&&(d.value=C(a,d.node),d.valueset=!0),d.value;throw Error(b.nodeErrorMessage(c,"RUNTIME","VARIABLENOTFOUND"));}catch(ka){throw ka;}}function J(a,d){try{if("Identifier"!==
d.callee.type)throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==a.localScope&&void 0!==a.localScope[d.callee.name.toLowerCase()]){var e=a.localScope[d.callee.name.toLowerCase()];if(e.value instanceof c.NativeFunction)return e.value.fn(a,d);if(e.value instanceof g)return L(a,d,e.value.definition);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTAFUNCTION"));}if(void 0!==a.globalScope[d.callee.name.toLowerCase()]){e=a.globalScope[d.callee.name.toLowerCase()];if(e.value instanceof
c.NativeFunction)return e.value.fn(a,d);if(e.value instanceof g)return L(a,d,e.value.definition);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTAFUNCTION"));}throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTFOUND"));}catch(ba){throw ba;}}function Q(a){return null==a?"":c.isArray(a)||c.isImmutableArray(a)?"Array":c.isDate(a)?"Date":c.isString(a)?"String":c.isBoolean(a)?"Boolean":c.isNumber(a)?"Number":a instanceof k?"Dictionary":a instanceof e?"Feature":a instanceof x?"Point":a instanceof v?"Polygon":
a instanceof z?"Polyline":a instanceof u?"Multipoint":a instanceof t?"Extent":c.isFunctionParameter(a)?"Function":a===c.voidOperation?"":"number"===typeof a&&isNaN(a)?"Number":"Unrecognised Type"}function H(a,b,d,e){try{var l=C(a,b.arguments[d]);if(c.equalityTest(l,e))return C(a,b.arguments[d+1]);var h=b.arguments.length-d;return 1===h?C(a,b.arguments[d]):2===h?null:3===h?C(a,b.arguments[d+2]):H(a,b,d+2,e)}catch(ia){throw ia;}}function K(a,b,d,e){try{if(!0===e)return C(a,b.arguments[d+1]);if(3===
b.arguments.length-d)return C(a,b.arguments[d+2]);var l=C(a,b.arguments[d+2]);if(!1===c.isBoolean(l))throw Error("WHEN needs boolean test conditions");return K(a,b,d+2,l)}catch(ga){throw ga;}}function R(a,b){var c=a.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[a[0]];var e=R(a.slice(0,d),b);a=R(a.slice(d,c),b);for(c=[];0<e.length||0<a.length;)0<e.length&&0<a.length?(d=b(e[0],a[0]),isNaN(d)&&(d=0),0>=d?(c.push(e[0]),e=e.slice(1)):(c.push(a[0]),a=a.slice(1))):0<e.length?(c.push(e[0]),e=
e.slice(1)):0<a.length&&(c.push(a[0]),a=a.slice(1));return c}function P(a,b,d){try{var e=a.body;if(d.length!==a.params.length)throw Error("Invalid Parameter calls to function.");for(var l=0;l<d.length;l++)b.localScope[a.params[l].name.toLowerCase()]={value:d[l],valueset:!0,node:null};var h=C(b,e);if(h instanceof c.ReturnResult)return h.value;if(h===c.breakResult)throw Error("Cannot Break from a Function");if(h===c.continueResult)throw Error("Cannot Continue from a Function");return h instanceof c.ImplicitResult?
h.value:h}catch(ia){throw ia;}}function L(a,b,c){return B(a,b,function(b,d,e){b={spatialReference:a.spatialReference,applicationCache:void 0===a.applicationCache?null:a.applicationCache,globalScope:a.globalScope,depthCounter:a.depthCounter+1,console:a.console,localScope:{}};if(64<b.depthCounter)throw Error("Exceeded maximum function depth");return P(c,b,e)})}function T(a){return function(){var b={applicationCache:void 0===a.context.applicationCache?null:a.context.applicationCache,spatialReference:a.context.spatialReference,
console:a.context.console,localScope:{},depthCounter:a.context.depthCounter+1,globalScope:a.context.globalScope};if(64<b.depthCounter)throw Error("Exceeded maximum function depth");return P(a.definition,b,arguments)}}function S(a){console.log(a)}Object.defineProperty(f,"__esModule",{value:!0});var W=0,Y={};a.registerFunctions(Y,B);r.registerFunctions(Y,B);p.registerFunctions(Y,B);l.registerFunctions(Y,B);q.registerFunctions(Y,B);n.registerFunctions(Y,B);Y["typeof"]=function(a,b){return B(a,b,function(a,
b,d){c.pcCheck(d,1,1);a=Q(d[0]);if("Unrecognised Type"===a)throw Error("Unrecognised Type");return a})};Y.iif=function(a,b){try{c.pcCheck(null===b.arguments?[]:b.arguments,3,3);var d=C(a,b.arguments[0]);if(!1===c.isBoolean(d))throw Error("IF Function must have a boolean test condition");return!0===d?C(a,b.arguments[1]):C(a,b.arguments[2])}catch(ba){throw ba;}};Y.decode=function(a,b){try{if(2>b.arguments.length)throw Error("Missing Parameters");if(2===b.arguments.length)return C(a,b.arguments[1]);
if(0===(b.arguments.length-1)%2)throw Error("Must have a default value result.");var c=C(a,b.arguments[0]);return H(a,b,1,c)}catch(ba){throw ba;}};Y.when=function(a,b){try{if(3>b.arguments.length)throw Error("Missing Parameters");if(0===b.arguments.length%2)throw Error("Must have a default value result.");var d=C(a,b.arguments[0]);if(!1===c.isBoolean(d))throw Error("WHEN needs boolean test conditions");return K(a,b,0,d)}catch(ba){throw ba;}};Y.top=function(a,b){return B(a,b,function(a,b,d){c.pcCheck(d,
2,2);if(c.isArray(d[0]))return c.toNumber(d[1])>=d[0].length?d[0].slice(0):d[0].slice(0,c.toNumber(d[1]));if(c.isImmutableArray(d[0]))return c.toNumber(d[1])>=d[0].length()?d[0].slice(0):d[0].slice(0,c.toNumber(d[1]));throw Error("Top cannot accept this parameter type");})};Y.first=function(a,b){return B(a,b,function(a,b,d){c.pcCheck(d,1,1);return c.isArray(d[0])?0===d[0].length?null:d[0][0]:c.isImmutableArray(d[0])?0===d[0].length()?null:d[0].get(0):null})};Y.sort=function(a,b){return B(a,b,function(a,
b,d){c.pcCheck(d,1,2);a=d[0];c.isImmutableArray(a)&&(a=a.toArray());if(!1===c.isArray(a))throw Error("Illegal Argument");if(1<d.length){if(!1===c.isFunctionParameter(d[1]))throw Error("Illegal Argument");var e=T(d[1]);a=R(a,function(a,b){return e(a,b)})}else{if(0===a.length)return[];d={};for(b=0;b<a.length;b++){var l=Q(a[b]);""!==l&&(d[l]=!0)}if(!0===d.Array||!0===d.Dictionary||!0===d.Feature||!0===d.Point||!0===d.Polygon||!0===d.Polyline||!0===d.Multipoint||!0===d.Extent||!0===d.Function)return a.slice(0);
b=0;var l="",h;for(h in d)b++,l=h;a=1<b||"String"===l?R(a,function(a,b){if(null===a||void 0===a||a===c.voidOperation)return null===b||void 0===b||b===c.voidOperation?0:1;if(null===b||void 0===b||b===c.voidOperation)return-1;a=c.toString(a);b=c.toString(b);return a<b?-1:a===b?0:1}):"Number"===l?R(a,function(a,b){return a-b}):"Boolean"===l?R(a,function(a,b){return a===b?0:b?-1:1}):"Date"===l?R(a,function(a,b){return b-a}):a.slice(0)}return a})};for(var X in Y)Y[X]={value:new c.NativeFunction(Y[X]),
valueset:!0,node:null};var aa=function(){};aa.prototype=Y;aa.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};aa.prototype.pi={value:Math.PI,valueset:!0,node:null};f.functionHelper={fixSpatialReference:c.fixSpatialReference,parseArguments:A,standardFunction:B};f.extend=function(a){for(var d={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:B,evaluateIdentifier:O,arcadeCustomFunctionHandler:T},e=0;e<a.length;e++)a[e].registerFunctions(d);for(var l in d.functions)Y[l]=
{value:new c.NativeFunction(d.functions[l]),valueset:!0,node:null},aa.prototype[l]=Y[l];for(e=0;e<d.signatures.length;e++)b.addFunctionDeclaration(d.signatures[e],"f")};f.executeScript=function(a,b,d){d||(d=new y(102100));var l=b.vars,h=b.customfunctions,n=new aa;l||(l={});h||(h={});var p=new k({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});p.immutable=!1;n.textformatting={value:p,valueset:!0,node:null};for(var q in h)n[q]={value:new c.NativeFunction(h[q]),
native:!0,valueset:!0,node:null};for(q in l)n[q]=l[q]&&"esri.Graphic"===l[q].declaredClass?{value:e.createFromGraphic(l[q]),valueset:!0,node:null}:{value:l[q],valueset:!0,node:null};a=C({spatialReference:d,globalScope:n,localScope:null,console:b.console?b.console:S,depthCounter:1,applicationCache:void 0===b.applicationCache?null:b.applicationCache},a.body[0].body);a instanceof c.ReturnResult&&(a=a.value);a instanceof c.ImplicitResult&&(a=a.value);a===c.voidOperation&&(a=null);if(a===c.breakResult)throw Error("Cannot return BREAK");
if(a===c.continueResult)throw Error("Cannot return CONTINUE");if(a instanceof g)throw Error("Cannot return FUNCTION");if(a instanceof c.NativeFunction)throw Error("Cannot return FUNCTION");return a};f.extractFieldLiterals=function(a,c){void 0===c&&(c=!1);return b.findFieldLiterals(a,c)};f.validateScript=function(a,c){return b.validateScript(a,c,"simple")};f.referencesMember=function(a,c){return b.referencesMember(a,c)};f.referencesFunction=function(a,c){return b.referencesFunction(a,c)};f.findFunctionCalls=
function(a){return b.findFunctionCalls(a,!1)}})},"esri/arcade/parser":function(){define(["require","exports","./treeAnalysis","./lib/esprima"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.parseScript=function(g){g=e.parse("function _() { "+g+"\n}");if(null===g.body||void 0===g.body)throw Error("No formula provided.");if(0===g.body.length)throw Error("No formula provided.");if(0===g.body.length)throw Error("No formula provided.");if("BlockStatement"!==g.body[0].body.type)throw Error("Invalid formula content.");
var d=k.validateLanguage(g);if(""!==d)throw Error(d);return g};f.scriptCheck=function(g,d,h,c){var b=[];try{var a=e.parse("function _() { "+g+"\n}",{tolerant:!0,loc:!0}),l=a.errors;if(0<l.length)for(var n=0;n<l.length;n++)b.push({line:l[n].lineNumber,character:l[n].column,reason:l[n].description});var p=k.checkScript(a,d,h,c);for(d=0;d<p.length;d++)b.push(p[d])}catch(q){try{"Unexpected token }"===q.description?(q.index=("function _() { "+g+"\n}").length-1,b.push({line:q.lineNumber,character:q.column,
reason:"Unexpected end of script"})):b.push({line:q.lineNumber,character:q.column,reason:q.description})}catch(r){}}return b};f.extractFieldLiterals=function(e,d){void 0===d&&(d=!1);return k.findFieldLiterals(e,d)};f.validateScript=function(e,d,h){void 0===h&&(h="full");return k.validateScript(e,d,h)};f.referencesMember=function(e,d){return k.referencesMember(e,d)};f.referencesFunction=function(e,d){return k.referencesFunction(e,d)}})},"esri/arcade/lib/esprima":function(){(function(m,f){"function"===
typeof define&&define.amd?define(["exports"],f):"undefined"!==typeof exports?f(exports):f(m.esprima={})})(this,function(m){function f(a,b){if(!a)throw Error("ASSERT: "+b);}function k(a){return 48<=a&&57>=a}function e(a){return 0<="0123456789abcdefABCDEF".indexOf(a)}function g(a){return 0<="01234567".indexOf(a)}function d(a){return 10===a||13===a||8232===a||8233===a}function h(a){return 36===a||95===a||65<=a&&90>=a||97<=a&&122>=a||92===a||128<=a&&eb.NonAsciiIdentifierStart.test(String.fromCharCode(a))}
function c(a){return 36===a||95===a||65<=a&&90>=a||97<=a&&122>=a||48<=a&&57>=a||92===a||128<=a&&eb.NonAsciiIdentifierPart.test(String.fromCharCode(a))}function b(a){a=a.toLowerCase();switch(a.length){case 2:return"if"===a||"in"===a;case 3:return"var"===a||"for"===a;case 4:return"else"===a;case 5:return"break"===a;case 6:return"return"===a;case 8:return"function"===a.toLowerCase()||"continue"===a;default:return!1}}function a(a,b,c,d,e){f("number"===typeof c,"Comment must have valid position");la.lastCommentStart>=
c||(la.lastCommentStart=c,a={type:a,value:b},da.range&&(a.range=[c,d]),da.loc&&(a.loc=e),da.comments.push(a),da.attachComment&&(da.leadingComments.push(a),da.trailingComments.push(a)))}function l(b){var c,e,l;c=V-b;for(e={start:{line:oa,column:V-qa-b}};V<ua;)if(l=ca.charCodeAt(V),++V,d(l)){da.comments&&(b=ca.slice(c+b,V-1),e.end={line:oa,column:V-qa-1},a("Line",b,c,V-1,e));13===l&&10===ca.charCodeAt(V)&&++V;++oa;qa=V;return}da.comments&&(b=ca.slice(c+b,V),e.end={line:oa,column:V-qa},a("Line",b,c,
V,e))}function n(){var b,c;for(c=0===V;V<ua;)if(b=ca.charCodeAt(V),32===b||9===b||11===b||12===b||160===b||5760<=b&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(b))++V;else if(d(b))++V,13===b&&10===ca.charCodeAt(V)&&++V,++oa,qa=V,c=!0;else if(47===b)if(b=ca.charCodeAt(V+1),47===b)++V,++V,l(2),c=!0;else if(42===b){++V;++V;a:{var e=b=void 0,h=void 0,h=void 0;da.comments&&(b=V-2,e={start:{line:oa,column:V-qa-2}});for(;V<ua;)if(h=ca.charCodeAt(V),
d(h))13===h&&10===ca.charCodeAt(V+1)&&++V,++oa,++V,qa=V,V>=ua&&J();else{if(42===h&&47===ca.charCodeAt(V+1)){++V;++V;da.comments&&(h=ca.slice(b+2,V-2),e.end={line:oa,column:V-qa},a("Block",h,b,V,e));break a}++V}J()}}else break;else if(c&&45===b)if(45===ca.charCodeAt(V+1)&&62===ca.charCodeAt(V+2))V+=3,l(3);else break;else if(60===b)if("!--"===ca.slice(V+1,V+4))++V,++V,++V,++V,l(4);else break;else break}function p(a){var b,c,d=0;b="u"===a?4:2;for(a=0;a<b;++a)if(V<ua&&e(ca[V]))c=ca[V++],d=16*d+"0123456789abcdef".indexOf(c.toLowerCase());
else return"";return String.fromCharCode(d)}function q(){var a,b;a=ca.charCodeAt(V++);b=String.fromCharCode(a);92===a&&(117!==ca.charCodeAt(V)&&J(),++V,(a=p("u"))&&"\\"!==a&&h(a.charCodeAt(0))||J(),b=a);for(;V<ua;){a=ca.charCodeAt(V);if(!c(a))break;++V;b+=String.fromCharCode(a);92===a&&(b=b.substr(0,b.length-1),117!==ca.charCodeAt(V)&&J(),++V,(a=p("u"))&&"\\"!==a&&c(a.charCodeAt(0))||J(),b+=a)}return b}function r(){var a=V,b=ca.charCodeAt(V),c,d=ca[V];switch(b){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++V,
da.tokenize&&(40===b?da.openParenToken=da.tokens.length:123===b&&(da.openCurlyToken=da.tokens.length)),{type:ea.Punctuator,value:String.fromCharCode(b),lineNumber:oa,lineStart:qa,start:a,end:V};default:if(c=ca.charCodeAt(V+1),61===c)switch(b){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return V+=2,{type:ea.Punctuator,value:String.fromCharCode(b)+String.fromCharCode(c),lineNumber:oa,lineStart:qa,start:a,end:V};case 33:case 61:return V+=2,61===ca.charCodeAt(V)&&
++V,{type:ea.Punctuator,value:ca.slice(a,V),lineNumber:oa,lineStart:qa,start:a,end:V}}}b=ca.substr(V,4);if("\x3e\x3e\x3e\x3d"===b)return V+=4,{type:ea.Punctuator,value:b,lineNumber:oa,lineStart:qa,start:a,end:V};b=b.substr(0,3);if("\x3e\x3e\x3e"===b||"\x3c\x3c\x3d"===b||"\x3e\x3e\x3d"===b)return V+=3,{type:ea.Punctuator,value:b,lineNumber:oa,lineStart:qa,start:a,end:V};b=b.substr(0,2);if(d===b[1]&&0<="+-\x3c\x3e\x26|".indexOf(d)||"\x3d\x3e"===b)return V+=2,{type:ea.Punctuator,value:b,lineNumber:oa,
lineStart:qa,start:a,end:V};if(0<="\x3c\x3e\x3d!+-*%\x26|^/".indexOf(d))return++V,{type:ea.Punctuator,value:d,lineNumber:oa,lineStart:qa,start:a,end:V};J()}function t(){var a,b,c;c=ca[V];f(k(c.charCodeAt(0))||"."===c,"Numeric literal must start with a decimal digit or a decimal point");b=V;a="";if("."!==c){a=ca[V++];c=ca[V];if("0"===a){if("x"===c||"X"===c){++V;for(a="";V<ua&&e(ca[V]);)a+=ca[V++];0===a.length&&J();h(ca.charCodeAt(V))&&J();return{type:ea.NumericLiteral,value:parseInt("0x"+a,16),lineNumber:oa,
lineStart:qa,start:b,end:V}}if("b"===c||"B"===c){++V;for(c="";V<ua;){a=ca[V];if("0"!==a&&"1"!==a)break;c+=ca[V++]}0===c.length&&J();V<ua&&(a=ca.charCodeAt(V),(h(a)||k(a))&&J());return{type:ea.NumericLiteral,value:parseInt(c,2),lineNumber:oa,lineStart:qa,start:b,end:V}}if("o"===c||"O"===c){g(c)?(c=!0,a="0"+ca[V++]):(c=!1,++V,a="");for(;V<ua&&g(ca[V]);)a+=ca[V++];c||0!==a.length||J();(h(ca.charCodeAt(V))||k(ca.charCodeAt(V)))&&J();return{type:ea.NumericLiteral,value:parseInt(a,8),octal:c,lineNumber:oa,
lineStart:qa,start:b,end:V}}}for(;k(ca.charCodeAt(V));)a+=ca[V++];c=ca[V]}if("."===c){for(a+=ca[V++];k(ca.charCodeAt(V));)a+=ca[V++];c=ca[V]}if("e"===c||"E"===c){a+=ca[V++];c=ca[V];if("+"===c||"-"===c)a+=ca[V++];if(k(ca.charCodeAt(V)))for(;k(ca.charCodeAt(V));)a+=ca[V++];else J()}h(ca.charCodeAt(V))&&J();return{type:ea.NumericLiteral,value:parseFloat(a),lineNumber:oa,lineStart:qa,start:b,end:V}}function w(){ja=null;n();I("Regular Expression language structures not supported")}function u(){n();w()}
function x(){var a;a=da.tokens[da.tokens.length-1];if(!a)return u();if("Punctuator"===a.type){if("]"===a.value)return r();if(")"===a.value)return a=da.tokens[da.openParenToken-1],!a||"Keyword"!==a.type||"if"!==a.value.toLowerCase()&&"while"!==a.value.toLowerCase()&&"for"!==a.value.toLowerCase()&&"with"!==a.value.toLowerCase()?r():u();if("}"===a.value){if(da.tokens[da.openCurlyToken-3]&&"Keyword"===da.tokens[da.openCurlyToken-3].type){if(a=da.tokens[da.openCurlyToken-4],!a)return r()}else if(da.tokens[da.openCurlyToken-
4]&&"Keyword"===da.tokens[da.openCurlyToken-4].type){if(a=da.tokens[da.openCurlyToken-5],!a)return u()}else return r();if(0<=Fa.indexOf(a.value))return r()}return u()}return"Keyword"===a.type&&"this"!==a.value?u():r()}function v(){var a;n();if(V>=ua)return{type:ea.EOF,lineNumber:oa,lineStart:qa,start:V,end:V};a=ca.charCodeAt(V);if(h(a)){var l;a=V;if(92===ca.charCodeAt(V))l=q();else a:{var v;for(l=V++;V<ua;){v=ca.charCodeAt(V);if(92===v){V=l;l=q();break a}if(c(v))++V;else break}l=ca.slice(l,V)}return{type:1===
l.length?ea.Identifier:b(l)?ea.Keyword:"null"===l.toLowerCase()?ea.NullLiteral:"true"===l.toLowerCase()||"false"===l.toLowerCase()?ea.BooleanLiteral:ea.Identifier,value:l,lineNumber:oa,lineStart:qa,start:a,end:V}}if(40===a||41===a||59===a)return r();if(39===a||34===a){var u="",m,w,y;v=!1;var z,A;z=oa;A=qa;a=ca[V];f("'"===a||'"'===a,"String literal must starts with a quote");l=V;for(++V;V<ua;)if(m=ca[V++],m===a){a="";break}else if("\\"===m)if((m=ca[V++])&&d(m.charCodeAt(0)))++oa,"\r"===m&&"\n"===ca[V]&&
++V,qa=V;else switch(m){case "u":case "x":if("{"===ca[V]){++V;w=m=void 0;m=ca[V];w=0;for("}"===m&&J();V<ua;){m=ca[V++];if(!e(m))break;w=16*w+"0123456789abcdef".indexOf(m.toLowerCase())}(1114111<w||"}"!==m)&&J();m=65535>=w?String.fromCharCode(w):String.fromCharCode((w-65536>>10)+55296,(w-65536&1023)+56320);u+=m}else y=V,(w=p(m))?u+=w:(V=y,u+=m);break;case "n":u+="\n";break;case "r":u+="\r";break;case "t":u+="\t";break;case "b":u+="\b";break;case "f":u+="\f";break;case "v":u+="\x0B";break;default:g(m)?
(w="01234567".indexOf(m),0!==w&&(v=!0),V<ua&&g(ca[V])&&(v=!0,w=8*w+"01234567".indexOf(ca[V++]),0<="0123".indexOf(m)&&V<ua&&g(ca[V])&&(w=8*w+"01234567".indexOf(ca[V++]))),u+=String.fromCharCode(w)):u+=m}else if(d(m.charCodeAt(0)))break;else u+=m;""!==a&&J();return{type:ea.StringLiteral,value:u,octal:v,startLineNumber:z,startLineStart:A,lineNumber:oa,lineStart:qa,start:l,end:V}}return 46===a?k(ca.charCodeAt(V+1))?t():r():k(a)?t():da.tokenize&&47===a?x():r()}function z(){var a,b,c;n();a={start:{line:oa,
column:V-qa}};b=v();a.end={line:oa,column:V-qa};b.type!==ea.EOF&&(c=ca.slice(b.start,b.end),a={type:Oa[b.type],value:c,range:[b.start,b.end],loc:a},b.regex&&(a.regex={pattern:b.regex.pattern,flags:b.regex.flags}),da.tokens.push(a));return b}function y(){var a;a=ja;V=a.end;oa=a.lineNumber;qa=a.lineStart;ja="undefined"!==typeof da.tokens?z():v();V=a.end;oa=a.lineNumber;qa=a.lineStart;return a}function A(){var a,b,c;a=V;b=oa;c=qa;ja="undefined"!==typeof da.tokens?z():v();V=a;oa=b;qa=c}function B(){this.line=
oa;this.column=V-qa}function C(){this.start=new B;this.end=null}function E(a){this.start=a.type===ea.StringLiteral?{line:a.startLineNumber,column:a.start-a.startLineStart}:{line:a.lineNumber,column:a.start-a.lineStart};this.end=null}function D(){V=ja.start;ja.type===ea.StringLiteral?(oa=ja.startLineNumber,qa=ja.startLineStart):(oa=ja.lineNumber,qa=ja.lineStart);da.range&&(this.range=[V,0]);da.loc&&(this.loc=new C)}function F(a){da.range&&(this.range=[a.start,0]);da.loc&&(this.loc=new E(a))}function M(){var a,
b,c,d;a=V;b=oa;c=qa;n();d=oa!==b;V=a;oa=b;qa=c;return d}function N(a,b,c){var d=Error("Line "+a+": "+c);d.index=b;d.lineNumber=a;d.column=b-qa+1;d.description=c;return d}function I(a){var b,c;b=Array.prototype.slice.call(arguments,1);c=a.replace(/%(\d)/g,function(a,c){f(c<b.length,"Message reference must be in range");return b[c]});throw N(oa,V,c);}function G(a){var b,c;b=Array.prototype.slice.call(arguments,1);c=a.replace(/%(\d)/g,function(a,c){f(c<b.length,"Message reference must be in range");
return b[c]});c=N(oa,V,c);if(da.errors)da.errors.push(c);else throw c;}function O(a,b){var c=ra.UnexpectedToken;a&&(c=b?b:a.type===ea.EOF?ra.UnexpectedEOS:a.type===ea.Identifier?ra.UnexpectedIdentifier:a.type===ea.NumericLiteral?ra.UnexpectedNumber:a.type===ea.StringLiteral?ra.UnexpectedString:ra.UnexpectedToken);c=c.replace("%0",a?a.value:"ILLEGAL");return a&&"number"===typeof a.lineNumber?N(a.lineNumber,a.start,c):N(oa,V,c)}function J(a,b){throw O(a,b);}function Q(a,b){a=O(a,b);if(da.errors)da.errors.push(a);
else throw a;}function H(a){var b=y();b.type===ea.Punctuator&&b.value===a||J(b)}function K(){var a;da.errors?(a=ja,a.type===ea.Punctuator&&","===a.value?y():a.type===ea.Punctuator&&";"===a.value?(y(),Q(a)):Q(a,ra.UnexpectedToken)):H(",")}function R(a){var b=y();b.type===ea.Keyword&&b.value.toLowerCase()===a.toLowerCase()||J(b)}function P(a){return ja.type===ea.Punctuator&&ja.value===a}function L(a){return ja.type===ea.Keyword&&ja.value.toLowerCase()===a.toLowerCase()}function T(){var a;59===ca.charCodeAt(V)||
P(";")?y():(a=oa,n(),oa===a&&(ja.type===ea.EOF||P("}")||J(ja)))}function S(a){return a.type===pa.Identifier||a.type===pa.MemberExpression}function W(a,b){var c,d=new D;b=ta;c=ya();ta=b;return d.finishFunctionExpression(null,a,[],c)}function Y(){var a,b;a=ta;ta=!0;b=Ca();b=W(b.params);ta=a;return b}function X(){var a,b=new D;a=y();return a.type===ea.StringLiteral||a.type===ea.NumericLiteral?(ta&&a.octal&&Q(a,ra.StrictOctalLiteral),b.finishLiteral(a)):b.finishIdentifier(a.value)}function aa(){var a,
b,c,d=new D;a=ja;if(a.type===ea.Identifier)return b=X(),"get"!==a.value||P(":")||P("(")?"set"!==a.value||P(":")||P("(")?P(":")?(y(),a=sa(),d.finishProperty("init",b,a,!1,!1)):P("(")?(a=Y(),d.finishProperty("init",b,a,!0,!1)):d.finishProperty("init",b,b,!1,!0):(b=X(),H("("),a=ja,a.type!==ea.Identifier?(H(")"),Q(a),a=W([])):(c=[Ea()],H(")"),a=W(c,a)),d.finishProperty("set",b,a,!1,!1)):(b=X(),H("("),H(")"),a=W([]),d.finishProperty("get",b,a,!1,!1));if(a.type===ea.EOF||a.type===ea.Punctuator)J(a);else{b=
X();if(P(":"))return y(),a=sa(),d.finishProperty("init",b,a,!1,!1);if(P("("))return a=Y(),d.finishProperty("init",b,a,!0,!1);J(y())}}function U(a){var b=[],c,d,e={},l=String,h=new D;for(!0!==a&&H("{");!P("}");)a=aa(),c=a.key.type===pa.Identifier?a.key.name:l(a.key.value),d="init"===a.kind?Qa.Data:"get"===a.kind?Qa.Get:Qa.Set,c="$"+c,Object.prototype.hasOwnProperty.call(e,c)?(e[c]===Qa.Data?ta&&d===Qa.Data?G(ra.StrictDuplicateProperty):d!==Qa.Data&&G(ra.AccessorDataProperty):d===Qa.Data?G(ra.AccessorDataProperty):
e[c]&d&&G(ra.AccessorGetSet),e[c]|=d):e[c]=d,b.push(a),P("}")||K();H("}");return h.finishObjectExpression(b)}function ha(){var a,b,c,d;if(P("("))return H("("),P(")")?(y(),b=Ta.ArrowParameterPlaceHolder):(++la.parenthesisCount,b=ma(),H(")")),b;if(P("[")){b=[];var e=new D;for(H("[");!P("]");)P(",")?(y(),b.push(null)):(b.push(sa()),P("]")||H(","));y();return e.finishArrayExpression(b)}if(P("{"))return U();a=ja.type;d=new D;if(a===ea.Identifier)c=d.finishIdentifier(y().value);else if(a===ea.StringLiteral||
a===ea.NumericLiteral)ta&&ja.octal&&Q(ja,ra.StrictOctalLiteral),c=d.finishLiteral(y());else if(a===ea.Keyword){if(L("function")){d=null;var l;c=[];var h=[],g,n=new D;R("function");P("(")||(d=Ea());l=Ca(b);c=l.params;h=l.defaults;a=l.stricted;b=l.firstRestricted;l.message&&(e=l.message);g=ta;l=ya();ta&&b&&J(b,e);ta&&a&&Q(a,e);ta=g;return n.finishFunctionExpression(d,c,h,l)}L("this")?(y(),c=d.finishThisExpression()):J(y())}else a===ea.BooleanLiteral?(b=y(),b.value="true"===b.value.toLowerCase(),c=d.finishLiteral(b)):
a===ea.NullLiteral?(b=y(),b.value=null,c=d.finishLiteral(b)):P("/")||P("/\x3d")?(c="undefined"!==typeof da.tokens?d.finishLiteral(u()):d.finishLiteral(w()),A()):J(y());return c}function Z(){var a=[];H("(");if(!P(")"))for(;V<ua;){a.push(sa());if(P(")"))break;K()}H(")");return a}function ba(){H(".");var a,b=new D;a=y();a.type===ea.Identifier||a.type===ea.Keyword||a.type===ea.BooleanLiteral||a.type===ea.NullLiteral||J(a);return b.finishIdentifier(a.value)}function ka(){var a;H("[");a=ma();H("]");return a}
function ga(){var a,b,c=new D;R("new");var d;f(la.allowIn,"callee of new expression always allow in keyword.");d=ja;for(a=L("new")?ga():ha();;)if(P("["))b=ka(),a=(new F(d)).finishMemberExpression("[",a,b);else if(P("."))b=ba(),a=(new F(d)).finishMemberExpression(".",a,b);else break;b=P("(")?Z():[];return c.finishNewExpression(a,b)}function ia(){var a,b,c=ja,d,e=la.allowIn;b=ja;la.allowIn=!0;for(a=L("new")?ga():ha();;)if(P("."))d=ba(),a=(new F(b)).finishMemberExpression(".",a,d);else if(P("("))d=Z(),
a=(new F(b)).finishCallExpression(a,d);else if(P("["))d=ka(),a=(new F(b)).finishMemberExpression("[",a,d);else break;la.allowIn=e;ja.type!==ea.Punctuator||!P("++")&&!P("--")||M()||(S(a)||G(ra.InvalidLHSInAssignment),b=y(),a=(new F(c)).finishPostfixExpression(b.value,a));return a}function na(){var a,b,c;ja.type!==ea.Punctuator&&ja.type!==ea.Keyword?b=ia():P("++")||P("--")?(c=ja,a=y(),b=na(),S(b)||G(ra.InvalidLHSInAssignment),b=(new F(c)).finishUnaryExpression(a.value,b)):P("+")||P("-")||P("~")||P("!")?
(c=ja,a=y(),b=na(),b=(new F(c)).finishUnaryExpression(a.value,b)):L("delete")||L("void")||L("typeof")?(c=ja,a=y(),b=na(),b=(new F(c)).finishUnaryExpression(a.value,b),ta&&"delete"===b.operator&&b.argument.type===pa.Identifier&&G(ra.StrictDelete)):b=ia();return b}function wa(a,b){var c=0;if(a.type!==ea.Punctuator&&a.type!==ea.Keyword)return 0;switch(a.value){case "||":c=1;break;case "\x26\x26":c=2;break;case "|":c=3;break;case "^":c=4;break;case "\x26":c=5;break;case "\x3d\x3d":case "!\x3d":case "\x3d\x3d\x3d":case "!\x3d\x3d":c=
6;break;case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":case "instanceof":c=7;break;case "in":c=b?7:0;break;case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":c=8;break;case "+":case "-":c=9;break;case "*":case "/":case "%":c=11}return c}function za(){var a,b,c,d,e,l;a=ja;b=na();if(b===Ta.ArrowParameterPlaceHolder)return b;c=ja;d=wa(c,la.allowIn);if(0===d)return b;c.prec=d;y();a=[a,ja];l=na();for(e=[b,c,l];0<(d=wa(ja,la.allowIn));){for(;2<e.length&&d<=e[e.length-2].prec;)l=e.pop(),c=e.pop().value,
b=e.pop(),a.pop(),b=(new F(a[a.length-1])).finishBinaryExpression(c,b,l),e.push(b);c=y();c.prec=d;e.push(c);a.push(ja);b=na();e.push(b)}d=e.length-1;b=e[d];for(a.pop();1<d;)b=(new F(a.pop())).finishBinaryExpression(e[d-1].value,e[d-2],b),d-=2;return b}function Aa(a){var b,c,d,e,l,h,g;e=[];l=[];h=0;g={paramSet:{}};b=0;for(c=a.length;b<c;b+=1)if(d=a[b],d.type===pa.Identifier)e.push(d),l.push(null),Ga(g,d,d.name);else if(d.type===pa.AssignmentExpression)e.push(d.left),l.push(d.right),++h,Ga(g,d.left,
d.left.name);else return null;g.message===ra.StrictParamDupe&&(a=ta?g.stricted:g.firstRestricted,J(a,g.message));0===h&&(l=[]);return{params:e,defaults:l,rest:null,stricted:g.stricted,firstRestricted:g.firstRestricted,message:g.message}}function sa(){var a,b,c,d,e;a=la.parenthesisCount;b=e=ja;var l,h;h=ja;c=za();c!==Ta.ArrowParameterPlaceHolder&&P("?")&&(y(),l=la.allowIn,la.allowIn=!0,b=sa(),la.allowIn=l,H(":"),l=sa(),c=(new F(h)).finishConditionalExpression(c,b,l));if(c===Ta.ArrowParameterPlaceHolder||
P("\x3d\x3e"))if(la.parenthesisCount===a||la.parenthesisCount===a+1)if(c.type===pa.Identifier?d=Aa([c]):c.type===pa.AssignmentExpression?d=Aa([c]):c.type===pa.SequenceExpression?d=Aa(c.expressions):c===Ta.ArrowParameterPlaceHolder&&(d=Aa([])),d)return a=d,e=new F(e),H("\x3d\x3e"),d=ta,c=P("{")?ya():sa(),ta&&a.firstRestricted&&J(a.firstRestricted,a.message),ta&&a.stricted&&Q(a.stricted,a.message),ta=d,e.finishArrowFunctionExpression(a.params,a.defaults,c,c.type!==pa.BlockStatement);ja.type!==ea.Punctuator?
a=!1:(a=ja.value,a="\x3d"===a||"*\x3d"===a||"/\x3d"===a||"%\x3d"===a||"+\x3d"===a||"-\x3d"===a||"\x3c\x3c\x3d"===a||"\x3e\x3e\x3d"===a||"\x3e\x3e\x3e\x3d"===a||"\x26\x3d"===a||"^\x3d"===a||"|\x3d"===a);a&&(S(c)||G(ra.InvalidLHSInAssignment),b=y(),a=sa(),c=(new F(e)).finishAssignmentExpression(b.value,c,a));return c}function ma(){var a,b=ja;a=sa();if(P(",")){for(a=[a];V<ua&&P(",");)y(),a.push(sa());a=(new F(b)).finishSequenceExpression(a)}return a}function Ea(){var a,b=new D;a=y();a.type!==ea.Identifier&&
J(a);return b.finishIdentifier(a.value)}function Ha(a){var b=null,c,d=new D;c=Ea();"const"===a?(H("\x3d"),b=sa()):P("\x3d")&&(y(),b=sa());return d.finishVariableDeclarator(c,b)}function Na(a){var b=[];do{b.push(Ha(a));if(!P(","))break;y()}while(V<ua);return b}function xa(a){var b=ja.type,c,d;b===ea.EOF&&J(ja);if(b===ea.Punctuator&&"{"===ja.value){if(a){H("{");var e=ja;a=V;c=oa;d=qa;y();b=P(":");ja=e;V=a;oa=c;qa=d;if((ja.type===ea.Identifier||ja.type===ea.StringLiteral)&&b)return U(!0);a=new D;for(c=
[];V<ua&&!P("}");){d=Ja();if("undefined"===typeof d)break;c.push(d)}H("}");return a.finishBlockStatement(c)}return U()}a=new D;if(b===ea.Punctuator)switch(ja.value){case ";":return a=new D,H(";"),a.finishEmptyStatement();case "(":return c=ma(),T(),a.finishExpressionStatement(c)}else if(b===ea.Keyword)switch(ja.value.toLowerCase()){case "break":return c=null,R("break"),59===ca.charCodeAt(V)?(y(),la.inIteration||la.inSwitch||I(ra.IllegalBreak),a=a.finishBreakStatement(null)):M()?(la.inIteration||la.inSwitch||
I(ra.IllegalBreak),a=a.finishBreakStatement(null)):(ja.type===ea.Identifier&&(c=Ea(),d="$"+c.name,Object.prototype.hasOwnProperty.call(la.labelSet,d)||I(ra.UnknownLabel,c.name)),T(),null!==c||la.inIteration||la.inSwitch||I(ra.IllegalBreak),a=a.finishBreakStatement(c)),a;case "continue":return c=null,R("continue"),59===ca.charCodeAt(V)?(y(),la.inIteration||I(ra.IllegalContinue),a=a.finishContinueStatement(null)):M()?(la.inIteration||I(ra.IllegalContinue),a=a.finishContinueStatement(null)):(ja.type===
ea.Identifier&&(c=Ea(),d="$"+c.name,Object.prototype.hasOwnProperty.call(la.labelSet,d)||I(ra.UnknownLabel,c.name)),T(),null!==c||la.inIteration||I(ra.IllegalContinue),a=a.finishContinueStatement(c)),a;case "for":var l,g,n;g=la.allowIn;l=b=e=null;R("for");H("(");if(P(";"))y();else{if(L("var")){la.allowIn=!1;var k=new D;l=y();n=Na();l=k.finishVariableDeclaration(n,l.value);la.allowIn=g;1===l.declarations.length&&L("in")&&(y(),c=l,d=ma(),l=null)}else la.allowIn=!1,l=ma(),la.allowIn=g,L("in")&&(S(l)||
G(ra.InvalidLHSInForIn),y(),c=l,d=ma(),l=null);"undefined"===typeof c&&H(";")}"undefined"===typeof c&&(P(";")||(b=ma()),H(";"),P(")")||(e=ma()));H(")");n=la.inIteration;la.inIteration=!0;g=xa(!0);la.inIteration=n;return"undefined"===typeof c?a.finishForStatement(l,b,e,g):a.finishForInStatement(c,d,g);case "function":return Pa(a);case "if":return R("if"),H("("),c=ma(),H(")"),d=xa(!0),L("else")?(y(),b=xa(!0)):b=null,a.finishIfStatement(c,d,b);case "return":return c=null,R("return"),la.inFunctionBody||
G(ra.IllegalReturn),32===ca.charCodeAt(V)&&h(ca.charCodeAt(V+1))?(c=ma(),T(),a=a.finishReturnStatement(c)):M()?a=a.finishReturnStatement(null):(P(";")||P("}")||ja.type===ea.EOF||(c=ma()),T(),a=a.finishReturnStatement(c)),a;case "var":return R("var"),c=Na(),T(),a.finishVariableDeclaration(c,"var")}c=ma();if(c.type===pa.Identifier&&P(":"))return y(),b="$"+c.name,Object.prototype.hasOwnProperty.call(la.labelSet,b)&&I(ra.Redeclaration,"Label",c.name),la.labelSet[b]=!0,d=xa(!1),delete la.labelSet[b],a.finishLabeledStatement(c,
d);T();return a.finishExpressionStatement(c)}function ya(){var a,b=[],c,d,e,l,h,g=new D;for(H("{");V<ua&&ja.type===ea.StringLiteral;){c=ja;a=Ja();b.push(a);if(a.expression.type!==pa.Literal)break;a=ca.slice(c.start+1,c.end-1);"use strict"===a?(ta=!0,d&&Q(d,ra.StrictOctalLiteral)):!d&&c.octal&&(d=c)}c=la.labelSet;d=la.inIteration;e=la.inSwitch;l=la.inFunctionBody;h=la.parenthesizedCount;la.labelSet={};la.inIteration=!1;la.inSwitch=!1;la.inFunctionBody=!0;for(la.parenthesizedCount=0;V<ua&&!P("}");){a=
Ja();if("undefined"===typeof a)break;b.push(a)}H("}");la.labelSet=c;la.inIteration=d;la.inSwitch=e;la.inFunctionBody=l;la.parenthesizedCount=h;return g.finishBlockStatement(b)}function Ga(a,b,c){c="$"+c;ta?Object.prototype.hasOwnProperty.call(a.paramSet,c)&&(a.stricted=b,a.message=ra.StrictParamDupe):!a.firstRestricted&&Object.prototype.hasOwnProperty.call(a.paramSet,c)&&(a.firstRestricted=b,a.message=ra.StrictParamDupe);a.paramSet[c]=!0}function Ca(a){a={params:[],defaultCount:0,defaults:[],firstRestricted:a};
H("(");if(!P(")"))for(a.paramSet={};V<ua;){var b=a,c=void 0,d=void 0,e=void 0,c=ja,d=Ea();Ga(b,c,c.value);P("\x3d")&&(y(),e=sa(),++b.defaultCount);b.params.push(d);b.defaults.push(e);if(P(")"))break;H(",")}H(")");0===a.defaultCount&&(a.defaults=[]);return{params:a.params,defaults:a.defaults,stricted:a.stricted,firstRestricted:a.firstRestricted,message:a.message}}function Pa(){var a,b=[],c=[],d,e,l,h,g,n=new D;R("function");a=Ea();d=Ca(l);b=d.params;c=d.defaults;e=d.stricted;l=d.firstRestricted;d.message&&
(h=d.message);g=ta;d=ya();ta&&l&&J(l,h);ta&&e&&Q(e,h);ta=g;return n.finishFunctionDeclaration(a,b,c,d)}function Ja(){if(ja.type===ea.Keyword)return"function"===ja.value.toLowerCase()?Pa():xa(!1);if(ja.type!==ea.EOF)return xa(!1)}function Ua(){var a,b,c,d=[];for(a=0;a<da.tokens.length;++a)b=da.tokens[a],c={type:b.type,value:b.value},b.regex&&(c.regex={pattern:b.regex.pattern,flags:b.regex.flags}),da.range&&(c.range=b.range),da.loc&&(c.loc=b.loc),d.push(c);da.tokens=d}var ea,Oa,Fa,pa,Ta,Qa,ra,eb,ca,
ta,V,oa,qa,ua,ja,la,da;ea={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9};Oa={};Oa[ea.BooleanLiteral]="Boolean";Oa[ea.EOF]="\x3cend\x3e";Oa[ea.Identifier]="Identifier";Oa[ea.Keyword]="Keyword";Oa[ea.NullLiteral]="Null";Oa[ea.NumericLiteral]="Numeric";Oa[ea.Punctuator]="Punctuator";Oa[ea.StringLiteral]="String";Oa[ea.RegularExpression]="RegularExpression";Fa="( { [ in typeof instanceof new return case delete throw void \x3d +\x3d -\x3d *\x3d /\x3d %\x3d \x3c\x3c\x3d \x3e\x3e\x3d \x3e\x3e\x3e\x3d \x26\x3d |\x3d ^\x3d , + - * / % ++ -- \x3c\x3c \x3e\x3e \x3e\x3e\x3e \x26 | ^ ! ~ \x26\x26 || ? : \x3d\x3d\x3d \x3d\x3d \x3e\x3d \x3c\x3d \x3c \x3e !\x3d !\x3d\x3d".split(" ");
pa={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",
FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator"};Ta={ArrowParameterPlaceHolder:{type:"ArrowParameterPlaceHolder"}};
Qa={Data:1,Get:2,Set:4};ra={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",
MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",
StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",
AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};eb={NonAsciiIdentifierStart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0-\u08b2\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/,
NonAsciiIdentifierPart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0-\u08b2\u08e4-\u0963\u0966-\u096f\u0971-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c00-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d01-\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191e\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1ab0-\u1abd\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1cf8\u1cf9\u1d00-\u1df5\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua69d\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\ua9e0-\ua9fe\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe2d\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/};
F.prototype=D.prototype={processComment:function(){var a,b,c,d=da.bottomRightStack,e,l,h=d[d.length-1];if(!(this.type===pa.Program&&0<this.body.length)){if(0<da.trailingComments.length){c=[];for(e=da.trailingComments.length-1;0<=e;--e)l=da.trailingComments[e],l.range[0]>=this.range[1]&&(c.unshift(l),da.trailingComments.splice(e,1));da.trailingComments=[]}else h&&h.trailingComments&&h.trailingComments[0].range[0]>=this.range[1]&&(c=h.trailingComments,delete h.trailingComments);if(h)for(;h&&h.range[0]>=
this.range[0];)a=h,h=d.pop();if(a)a.leadingComments&&a.leadingComments[a.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=a.leadingComments,a.leadingComments=void 0);else if(0<da.leadingComments.length)for(b=[],e=da.leadingComments.length-1;0<=e;--e)l=da.leadingComments[e],l.range[1]<=this.range[0]&&(b.unshift(l),da.leadingComments.splice(e,1));b&&0<b.length&&(this.leadingComments=b);c&&0<c.length&&(this.trailingComments=c);d.push(this)}},finish:function(){da.range&&(this.range[1]=
V);da.loc&&(this.loc.end=new B,da.source&&(this.loc.source=da.source));da.attachComment&&this.processComment()},finishArrayExpression:function(a){this.type=pa.ArrayExpression;this.elements=a;this.finish();return this},finishAssignmentExpression:function(a,b,c){this.type=pa.AssignmentExpression;this.operator=a;this.left=b;this.right=c;this.finish();return this},finishBinaryExpression:function(a,b,c){this.type="||"===a||"\x26\x26"===a?pa.LogicalExpression:pa.BinaryExpression;this.operator=a;this.left=
b;this.right=c;this.finish();return this},finishBlockStatement:function(a){this.type=pa.BlockStatement;this.body=a;this.finish();return this},finishBreakStatement:function(a){this.type=pa.BreakStatement;this.label=a;this.finish();return this},finishCallExpression:function(a,b){this.type=pa.CallExpression;this.callee=a;this.arguments=b;this.finish();return this},finishConditionalExpression:function(a,b,c){this.type=pa.ConditionalExpression;this.test=a;this.consequent=b;this.alternate=c;this.finish();
return this},finishContinueStatement:function(a){this.type=pa.ContinueStatement;this.label=a;this.finish();return this},finishEmptyStatement:function(){this.type=pa.EmptyStatement;this.finish();return this},finishExpressionStatement:function(a){this.type=pa.ExpressionStatement;this.expression=a;this.finish();return this},finishForStatement:function(a,b,c,d){this.type=pa.ForStatement;this.init=a;this.test=b;this.update=c;this.body=d;this.finish();return this},finishForInStatement:function(a,b,c){this.type=
pa.ForInStatement;this.left=a;this.right=b;this.body=c;this.each=!1;this.finish();return this},finishFunctionDeclaration:function(a,b,c,d){this.type=pa.FunctionDeclaration;this.id=a;this.params=b;this.defaults=c;this.body=d;this.rest=null;this.expression=this.generator=!1;this.finish();return this},finishFunctionExpression:function(a,b,c,d){this.type=pa.FunctionExpression;this.id=a;this.params=b;this.defaults=c;this.body=d;this.rest=null;this.expression=this.generator=!1;this.finish();return this},
finishIdentifier:function(a){this.type=pa.Identifier;this.name=a;this.finish();return this},finishIfStatement:function(a,b,c){this.type=pa.IfStatement;this.test=a;this.consequent=b;this.alternate=c;this.finish();return this},finishLiteral:function(a){this.type=pa.Literal;this.value=a.value;this.raw=ca.slice(a.start,a.end);a.regex&&(this.regex=a.regex);this.finish();return this},finishMemberExpression:function(a,b,c){this.type=pa.MemberExpression;this.computed="["===a;this.object=b;this.property=c;
this.finish();return this},finishObjectExpression:function(a){this.type=pa.ObjectExpression;this.properties=a;this.finish();return this},finishPostfixExpression:function(a,b){this.type=pa.UpdateExpression;this.operator=a;this.argument=b;this.prefix=!1;this.finish();return this},finishProgram:function(a){this.type=pa.Program;this.body=a;this.finish();return this},finishProperty:function(a,b,c,d,e){this.type=pa.Property;this.key=b;this.value=c;this.kind=a;this.method=d;this.shorthand=e;this.finish();
return this},finishReturnStatement:function(a){this.type=pa.ReturnStatement;this.argument=a;this.finish();return this},finishUnaryExpression:function(a,b){this.type="++"===a||"--"===a?pa.UpdateExpression:pa.UnaryExpression;this.operator=a;this.argument=b;this.prefix=!0;this.finish();return this},finishVariableDeclaration:function(a,b){this.type=pa.VariableDeclaration;this.declarations=a;this.kind=b;this.finish();return this},finishVariableDeclarator:function(a,b){this.type=pa.VariableDeclarator;this.id=
a;this.init=b;this.finish();return this}};m.version="2.0.0-dev";m.tokenize=function(a,b){var c,d;c=String;"string"===typeof a||a instanceof String||(a=c(a));ca=a;V=0;oa=0<ca.length?1:0;qa=0;ua=ca.length;ja=null;la={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};da={};b=b||{};b.tokens=!0;da.tokens=[];da.tokenize=!0;da.openParenToken=-1;da.openCurlyToken=-1;da.range="boolean"===typeof b.range&&b.range;da.loc="boolean"===typeof b.loc&&b.loc;"boolean"===typeof b.comment&&
b.comment&&(da.comments=[]);"boolean"===typeof b.tolerant&&b.tolerant&&(da.errors=[]);try{A();if(ja.type===ea.EOF)return da.tokens;for(y();ja.type!==ea.EOF;)try{y()}catch(Va){if(da.errors){da.errors.push(Va);break}else throw Va;}Ua();d=da.tokens;"undefined"!==typeof da.comments&&(d.comments=da.comments);"undefined"!==typeof da.errors&&(d.errors=da.errors)}catch(Va){throw Va;}finally{da={}}return d};m.parse=function(a,b){var c,d;d=String;"string"===typeof a||a instanceof String||(a=d(a));ca=a;V=0;
oa=0<ca.length?1:0;qa=0;ua=ca.length;ja=null;la={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};da={};"undefined"!==typeof b&&(da.range="boolean"===typeof b.range&&b.range,da.loc="boolean"===typeof b.loc&&b.loc,da.attachComment="boolean"===typeof b.attachComment&&b.attachComment,da.loc&&null!==b.source&&void 0!==b.source&&(da.source=d(b.source)),"boolean"===typeof b.tokens&&b.tokens&&(da.tokens=[]),"boolean"===typeof b.comment&&b.comment&&
(da.comments=[]),"boolean"===typeof b.tolerant&&b.tolerant&&(da.errors=[]),da.attachComment&&(da.range=!0,da.comments=[],da.bottomRightStack=[],da.trailingComments=[],da.leadingComments=[]));try{var e;n();A();e=new D;ta=!1;var l;a=[];for(var h,g,k;V<ua;){h=ja;if(h.type!==ea.StringLiteral)break;l=Ja();a.push(l);if(l.expression.type!==pa.Literal)break;g=ca.slice(h.start+1,h.end-1);"use strict"===g?(ta=!0,k&&Q(k,ra.StrictOctalLiteral)):!k&&h.octal&&(k=h)}for(;V<ua;){l=Ja();if("undefined"===typeof l)break;
a.push(l)}c=e.finishProgram(a);"undefined"!==typeof da.comments&&(c.comments=da.comments);"undefined"!==typeof da.tokens&&(Ua(),c.tokens=da.tokens);"undefined"!==typeof da.errors&&(c.errors=da.errors)}catch(jb){throw jb;}finally{da={}}return c};m.Syntax=function(){var a,b={};"function"===typeof Object.create&&(b=Object.create(null));for(a in pa)pa.hasOwnProperty(a)&&(b[a]=pa[a]);"function"===typeof Object.freeze&&Object.freeze(b);return b}()})},"esri/support/actions/ActionBase":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Identifiable ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.active=!1;a.className=null;a.disabled=!1;a.id=null;a.indicator=!1;a.title=null;a.type=null;a.visible=!0;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})};var a;e([h.property()],b.prototype,"active",void 0);e([h.property()],b.prototype,"className",void 0);e([h.property()],
b.prototype,"disabled",void 0);e([h.property()],b.prototype,"id",void 0);e([h.property()],b.prototype,"title",void 0);e([h.property()],b.prototype,"type",void 0);e([h.property()],b.prototype,"visible",void 0);return b=a=e([h.subclass("esri.support.actions.ActionBase")],b)}(h.declared(g,d))})},"esri/support/actions/ActionButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./ActionBase".split(" "),
function(m,f,k,e,g,d){return function(d){function c(a){a=d.call(this)||this;a.image=null;a.type="button";return a}k(c,d);b=c;c.prototype.clone=function(){return new b({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})};var b;e([g.property()],c.prototype,"image",void 0);return c=b=e([g.subclass("esri.support.Action.ActionButton")],c)}(g.declared(d))})},"esri/support/actions/ActionToggle":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./ActionBase".split(" "),
function(m,f,k,e,g,d){return function(d){function c(a){a=d.call(this)||this;a.image=null;a.type="toggle";a.value=!1;return a}k(c,d);b=c;c.prototype.clone=function(){return new b({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})};var b;e([g.property()],c.prototype,"image",void 0);e([g.property()],c.prototype,"value",void 0);return c=b=e([g.subclass("esri.support.Action.ActionToggle")],
c)}(g.declared(d))})},"esri/geometry/support/typeUtils":function(){define("require exports ../../core/accessorSupport/ensureType ../Extent ../Geometry ../Mesh ../Multipoint ../Point ../Polygon ../Polyline".split(" "),function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});f.types={base:g,key:"type",typeMap:{extent:e,multipoint:h,point:c,polyline:a,polygon:b,mesh:d}};f.ensureType=k.ensureOneOfType(f.types)})},"esri/symbols/support/jsonUtils":function(){define("require exports ../../core/Error ../../core/Warning ../LabelSymbol3D ../LineSymbol3D ../MeshSymbol3D ../PictureFillSymbol ../PictureMarkerSymbol ../PointSymbol3D ../PolygonSymbol3D ../SimpleFillSymbol ../SimpleLineSymbol ../SimpleMarkerSymbol ../Symbol3D ../TextSymbol ../WebStyleSymbol ../callouts/LineCallout3D ./symbolConversion".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){function v(a,b,c){b=a?y[a.type]||null:null;if(b)return b=new b,b.read(a,c),b;c&&c.messages&&a&&c.messages.push(new e("symbol:unsupported","Symbols of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:c}));return null}function z(a,b,c){if(!a)return null;if(!c||"web-scene"!==c.origin||a.isInstanceOf(r)||a.isInstanceOf(w))return a.write(b,c);var d=x.to3D(a);if(d.symbol)return d.symbol.write(b,c);c.messages&&c.messages.push(new k("symbol:unsupported",
"Symbols of type '"+a.declaredClass+"' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView",{symbol:a,context:c,error:d.error}));return null}Object.defineProperty(f,"__esModule",{value:!0});var y={esriSMS:q,esriPMS:b,esriTS:t,esriSLS:p,esriSFS:n,esriPFS:c,PointSymbol3D:a,LineSymbol3D:d,PolygonSymbol3D:l,MeshSymbol3D:h,LabelSymbol3D:g,styleSymbolReference:w};f.read=v;f.writeTarget=function(a,b,c,d){(a=z(a,{},d))&&(b[c]=a)};f.write=z;f.fromJSON=function(a,
b){return v(a,null,b)};f.readCallout3D=function(a,b){if(!a||!a.type)return null;var c=null;switch(a.type){case "line":c=new u}c&&c.read(a,b);return c}})},"esri/core/Warning":function(){define(["require","exports","./tsSupport/extendsHelper","./tsSupport/decorateHelper","./Message"],function(m,f,k,e,g){m=function(d){function e(c,b,a){var l=d.call(this,c,b,a)||this;return l instanceof e?l:new e(c,b,a)}k(e,d);return e}(g);m.prototype.type="warning";return m})},"esri/symbols/LabelSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/lang ../core/accessorSupport/decorators ./Symbol3D ./TextSymbol3DLayer ./callouts/calloutUtils ./support/Symbol3DVerticalOffset".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=g.ofType({base:null,key:"type",typeMap:{text:b}});return function(b){function c(a){a=b.call(this)||this;a.verticalOffset=null;a.callout=null;a.styleOrigin=null;a.symbolLayers=new n;a.type="label-3d";return a}k(c,b);g=c;c.prototype.supportsCallout=function(){return!0};c.prototype.hasVisibleCallout=function(){return a.hasVisibleCallout(this)};c.prototype.hasVisibleVerticalOffset=function(){return a.hasVisibleVerticalOffset(this)};c.prototype.clone=function(){return new g({styleOrigin:d.clone(this.styleOrigin),
symbolLayers:d.clone(this.symbolLayers),thumbnail:d.clone(this.thumbnail),callout:d.clone(this.callout),verticalOffset:d.clone(this.verticalOffset)})};var g;e([h.property({type:l.default,json:{write:!0}})],c.prototype,"verticalOffset",void 0);e([h.property(a.calloutProperty)],c.prototype,"callout",void 0);e([h.property({json:{read:!1,write:!1}})],c.prototype,"styleOrigin",void 0);e([h.property({type:n})],c.prototype,"symbolLayers",void 0);e([h.enumeration.serializable()({LabelSymbol3D:"label-3d"})],
c.prototype,"type",void 0);return c=g=e([h.subclass("esri.symbols.LabelSymbol3D")],c)}(h.declared(c))})},"esri/symbols/Symbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/kebabDictionary ../core/Logger ../core/urlUtils ../core/Warning ../core/accessorSupport/decorators ../portal/Portal ./ExtrudeSymbol3DLayer ./FillSymbol3DLayer ./IconSymbol3DLayer ./LineSymbol3DLayer ./ObjectSymbol3DLayer ./PathSymbol3DLayer ./Symbol ./Symbol3DLayer ./TextSymbol3DLayer ./support/StyleOrigin ./support/Thumbnail".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){var B={icon:r,object:w,line:t,path:u,fill:q,extrude:p,text:z},C=g.ofType({base:v,key:"type",typeMap:B}),E=h.strict()({PointSymbol3D:"point-3d",PolygonSymbol3D:"polygon-3d",LineSymbol3D:"line-3d",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d"}),D=c.getLogger("esri.symbols.Symbol3D");return function(c){function h(a){a=c.call(this)||this;a.styleOrigin=null;a.thumbnail=null;a.type=null;var b=a.__accessor__&&a.__accessor__.metadatas&&a.__accessor__.metadatas.symbolLayers;
a._set("symbolLayers",new (b&&b.type||g));return a}k(h,c);Object.defineProperty(h.prototype,"color",{get:function(){return null},set:function(a){D.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"symbolLayers",{set:function(a){d.referenceSetter(a,this._get("symbolLayers"))},enumerable:!0,configurable:!0});h.prototype.readSymbolLayers=function(b,c,d){c=[];
for(var e=0;e<b.length;e++){var l=b[e],h=v.typeJSONDictionary.read(l.type),g=h&&B[h];g?(l=new g,l.read(b[e],d),c.push(l)):(D.warn("Unknown symbol layer type: "+h),d&&d.messages&&d.messages.push(new a("symbol-layer:unsupported","Symbol layers of type '"+(h||l.type||"unknown")+"' are not supported",{definition:l,context:d})))}return c};h.prototype.readStyleOrigin=function(c,d,e){if(c.styleUrl&&c.name)return d=b.read(c.styleUrl,e),new y({styleUrl:d,name:c.name});if(c.styleName&&c.name)return new y({portal:e&&
e.portal||n.getDefault(),styleName:c.styleName,name:c.name});e&&e.messages&&e.messages.push(new a("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:e,definition:c}))};h.prototype.writeStyleOrigin=function(c,d,e,l){c.styleUrl&&c.name?(e=b.write(c.styleUrl,l),b.isAbsolute(e)&&(e=b.normalize(e)),d.styleOrigin={styleUrl:e,name:c.name}):c.styleName&&c.name&&(c.portal&&l&&l.portal&&!b.hasSamePortal(c.portal.restUrl,l.portal.restUrl)?
l&&l.messages&&l.messages.push(new a("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):d.styleOrigin={styleName:c.styleName,name:c.name})};h.prototype.normalizeCtorArgs=function(a){return a instanceof v||a&&B[a.type]?{symbolLayers:[a]}:Array.isArray(a)?{symbolLayers:a}:a};e([l.property({json:{read:!1,write:!1}})],h.prototype,"color",null);e([l.property({type:C,nonNullable:!0,json:{write:!0}}),
l.cast(d.castForReferenceSetter)],h.prototype,"symbolLayers",null);e([l.reader("symbolLayers")],h.prototype,"readSymbolLayers",null);e([l.property({type:y})],h.prototype,"styleOrigin",void 0);e([l.reader("styleOrigin")],h.prototype,"readStyleOrigin",null);e([l.writer("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],h.prototype,"writeStyleOrigin",null);e([l.property({type:A.default,json:{read:!1}})],h.prototype,"thumbnail",
void 0);e([l.property({type:E.apiValues,readOnly:!0,json:{type:E.jsonValues,read:!1}})],h.prototype,"type",void 0);return h=e([l.subclass("esri.symbols.Symbol3D")],h)}(l.declared(x))})},"esri/core/collectionUtils":function(){define(["require","exports","./Collection"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.referenceSetter=function(e,g,d){void 0===d&&(d=k);g||(g=new d);g.removeAll();e&&(Array.isArray(e)||e.isInstanceOf&&e.isInstanceOf(k))?g.addMany(e):g.add(e);return g};
f.castForReferenceSetter=function(e){return e}})},"esri/portal/Portal":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper dojo/_base/kernel dojo/_base/url dojo/promise/all ../config ../kernel ../request ../core/Error ../core/has ../core/JSONSupport ../core/lang ../core/Loadable ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ./PortalQueryParams ./PortalQueryResult ./PortalUser".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){var B,C={Bookmark:function(){return u.create(function(a){return m(["./Bookmark"],a)})},Portal:function(){return u.create(function(a){return m(["./Portal"],a)})},PortalFolder:function(){return u.create(function(a){return m(["./PortalFolder"],a)})},PortalGroup:function(){return u.create(function(a){return m(["./PortalGroup"],a)})},PortalItem:function(){return u.create(function(a){return m(["./PortalItem"],a)})},PortalQueryParams:function(){return u.create(function(a){return m(["./PortalQueryParams"],
a)})},PortalQueryResult:function(){return u.create(function(a){return m(["./PortalQueryResult"],a)})},PortalRating:function(){return u.create(function(a){return m(["./PortalRating"],a)})},PortalUser:function(){return u.create(function(a){return m(["./PortalUser"],a)})}};return function(f){function r(b){b=f.call(this)||this;b.access=null;b.allSSL=!1;b.authMode="auto";b.authorizedCrossOriginDomains=null;b.basemapGalleryGroupQuery=null;b.bingKey=null;b.canListApps=!1;b.canListData=!1;b.canListPreProvisionedItems=
!1;b.canProvisionDirectPurchase=!1;b.canSearchPublic=!0;b.canShareBingPublic=!1;b.canSharePublic=!1;b.canSignInArcGIS=!1;b.canSignInIDP=!1;b.colorSetsGroupQuery=null;b.commentsEnabled=!1;b.created=null;b.culture=null;b.customBaseUrl=null;b.defaultBasemap=null;b.defaultExtent=null;b.defaultVectorBasemap=null;b.description=null;b.eueiEnabled=!1;b.featuredGroups=null;b.featuredItemsGroupQuery=null;b.galleryTemplatesGroupQuery=null;b.livingAtlasGroupQuery=null;b.hasCategorySchema=!1;b.helperServices=
null;b.homePageFeaturedContent=null;b.homePageFeaturedContentCount=null;b.httpPort=null;b.httpsPort=null;b.id=null;b.ipCntryCode=null;b.isPortal=!1;b.layerTemplatesGroupQuery=null;b.maxTokenExpirationMinutes=null;b.modified=null;b.name=null;b.portalHostname=null;b.portalMode=null;b.portalProperties=null;b.region=null;b.rotatorPanels=null;b.showHomePageDescription=!1;b.supportsHostedServices=!1;b.symbolSetsGroupQuery=null;b.templatesGroupQuery=null;b.units=null;b.url=a.portalUrl;b.urlKey=null;b.user=
null;b.useStandardizedQuery=!1;b.useVectorBasemaps=!1;b.vectorBasemapGalleryGroupQuery=null;return b}e(r,f);w=r;r.prototype.normalizeCtorArgs=function(a){return"string"===typeof a?{url:a}:a};r.prototype.destroy=function(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)};r.prototype.readAuthorizedCrossOriginDomains=function(b){if(b)for(var c=0;c<b.length;c++){var d=b[c];-1===a.request.trustedServers.indexOf(d)&&a.request.trustedServers.push(d)}return b};
r.prototype.readDefaultBasemap=function(a){return a?(a=B.fromJSON(a),a.portalItem={portal:this},a):null};r.prototype.readDefaultVectorBasemap=function(a){return a?(a=B.fromJSON(a),a.portalItem={portal:this},a):null};Object.defineProperty(r.prototype,"extraQuery",{get:function(){var a=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!a?" AND orgid:"+this.id:null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"isOrganization",{get:function(){return!!this.access},
enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"restUrl",{get:function(){var a=this.url;if(a)var b=a.indexOf("/sharing"),a=0<b?a.substring(0,b):this.url.replace(/\/+$/,""),a=a+"/sharing/rest";return a},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"thumbnailUrl",{get:function(){var a=this.restUrl,b=this.thumbnail;return a&&b?this._normalizeSSL(a+"/portals/self/resources/"+b):null},enumerable:!0,configurable:!0});r.prototype.readUrlKey=function(a){return a?a.toLowerCase():
a};r.prototype.readUser=function(a){var b=null;a&&(b=A.fromJSON(a),b.portal=this);return b};r.prototype.load=function(){var a=this,b=u.create(function(a){return m(["../Basemap"],a)}).then(function(a){B=a}).then(function(){return a._fetchSelf()}).then(function(b){if(l.id){var c=l.id;a.credential=c.findCredential(a.restUrl);a.credential||a.authMode!==w.AUTH_MODE_AUTO||(a._esriId_credentialCreateHandle=c.on("credential-create",function(){c.findCredential(a.restUrl)&&a._signIn()}))}a.read(b)});this.addResolvingPromise(b);
return this.when()};r.prototype.fetchBasemaps=function(a){var b=new z;b.query=a||(this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery);b.disableExtraQuery=!0;return this.queryGroups(b).then(function(a){b.num=100;b.query='type:"Web Map" -type:"Web Application"';return a.total?(a=a.results[0],b.sortField=a.sortField||"name",b.sortOrder=a.sortOrder||"desc",a.queryItems(b)):null}).then(function(a){return a&&a.total?a.results.filter(function(a){return"Web Map"===a.type}).map(function(a){return new B({portalItem:a})}):
[]})};r.prototype.fetchCategorySchema=function(){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema").then(function(a){return a.categorySchema}):u.resolve([])};r.prototype.fetchFeaturedGroups=function(){var a=this.featuredGroups,b=new z;b.num=100;b.sortField="title";if(a&&a.length){for(var c=[],d=0;d<a.length;d++){var e=a[d];c.push('(title:"'+e.title+'" AND owner:'+e.owner+")")}b.query=c.join(" OR ");return this.queryGroups(b).then(function(a){return a.results})}return u.resolve([])};
r.prototype.fetchRegions=function(){return this._request(this.restUrl+"/portals/regions",{query:{culture:this.user&&this.user.culture||this.culture||h.locale}})};r.getDefault=function(){w._default||(w._default=new w);return w._default};r.prototype.queryGroups=function(a){return this._queryPortal("/community/groups",a,"PortalGroup")};r.prototype.queryItems=function(a){return this._queryPortal("/search",a,"PortalItem")};r.prototype.queryUsers=function(a){a.sortField||(a.sortField="username");return this._queryPortal("/community/users",
a,"PortalUser")};r.prototype.toJSON=function(){throw new p("internal:not-yet-implemented","Portal.toJSON is not yet implemented");};r.prototype._fetchSelf=function(a,b){void 0===a&&(a=this.authMode);void 0===b&&(b=!1);var c=this.restUrl+"/portals/self";a={authMode:a,query:{culture:h.locale}};"auto"===a.authMode&&(a.authMode="no-prompt");b&&(a.query.default=!0);return this._request(c,a)};r.prototype._queryPortal=function(a,c,d){var e=this,l=function(d){return e._request(e.restUrl+a,c.toRequestOptions(e)).then(function(a){var b=
c.clone();b.start=a.nextStart;return new y({nextQueryParams:b,queryParams:c,total:a.total,results:w._resultsToTypedArray(d,{portal:e},a)})}).then(function(a){return b(a.results.map(function(b){return"function"===typeof b.when?b.when():a})).always(function(){return a})})};return d&&C[d]?C[d]().then(function(a){return l(a)}):l()};r.prototype._signIn=function(){var a=this;if(this.authMode===w.AUTH_MODE_ANONYMOUS)return u.reject(new p("portal:invalid-auth-mode",'Current "authMode"\' is "'+this.authMode+
'"'));if("failed"===this.loadStatus)return u.reject(this.loadError);var b=function(b){return u.resolve().then(function(){if("not-loaded"===a.loadStatus)return b||(a.authMode="immediate"),a.load().then(function(){return null});if("loading"===a.loadStatus)return a.load().then(function(){if(a.credential)return null;a.credential=b;return a._fetchSelf("immediate")});if(a.user&&a.credential===b)return null;a.credential=b;return a._fetchSelf("immediate")}).then(function(b){b&&a.read(b)})};return l.id?l.id.getCredential(this.restUrl).then(function(a){return b(a)}):
b(this.credential)};r.prototype._normalizeSSL=function(a){var b=this.allSSL;!b&&q("esri-secure-context")&&(b=!0);if(this.isPortal){var d=new c(a);return-1<this.portalHostname.toLowerCase().indexOf(d.host.toLowerCase())&&d.port&&"80"!==d.port&&"443"!==d.port?b?"https://"+d.host+(this.httpsPort&&443!==this.httpsPort?":"+this.httpsPort:"")+d.path+"?"+d.query:"http://"+d.host+(this.httpPort&&80!==this.httpPort?":"+this.httpPort:"")+d.path+"?"+d.query:b?a.replace("http:","https:"):a}return b?a.replace("http:",
"https:"):a};r.prototype._normalizeUrl=function(a){var b=this.credential&&this.credential.token;return this._normalizeSSL(b?a+(-1<a.indexOf("?")?"\x26":"?")+"token\x3d"+b:a)};r.prototype._requestToTypedArray=function(a,c,d){var e=this,l=function(d){return e._request(a,c).then(function(a){var c=w._resultsToTypedArray(d,{portal:e},a);return b(c.map(function(b){return"function"===typeof b.when?b.when():a})).always(function(){return c})})};return d?u.create(function(a){return m(["./"+d],a)}).then(function(a){return l(a)}):
l()};r.prototype._request=function(a,b){var c=this.authMode===w.AUTH_MODE_ANONYMOUS?"anonymous":"auto",d=null,e="auto",l={f:"json"},h="json";b&&(b.authMode&&(c=b.authMode),b.body&&(d=b.body),b.method&&(e=b.method),b.query&&(l=k({},l,b.query)),b.responseType&&(h=b.responseType));b={authMode:c,body:d,method:e,query:l,responseType:h,timeout:0};return n(this._normalizeSSL(a),b).then(function(a){return a.data})};r._resultsToTypedArray=function(a,b,c){if(c){if(c=c.listings||c.notifications||c.userInvitations||
c.tags||c.items||c.groups||c.comments||c.provisions||c.results||c.relatedItems||c,a||b)c=c.map(function(c){c=t.mixin(a?a.fromJSON(c):c,b);"function"===typeof c.load&&c.load();return c})}else c=[];return c};var w;r.AUTH_MODE_ANONYMOUS="anonymous";r.AUTH_MODE_AUTO="auto";r.AUTH_MODE_IMMEDIATE="immediate";g([x.property()],r.prototype,"access",void 0);g([x.property()],r.prototype,"allSSL",void 0);g([x.property()],r.prototype,"authMode",void 0);g([x.property()],r.prototype,"authorizedCrossOriginDomains",
void 0);g([x.reader("authorizedCrossOriginDomains")],r.prototype,"readAuthorizedCrossOriginDomains",null);g([x.property()],r.prototype,"basemapGalleryGroupQuery",void 0);g([x.property()],r.prototype,"bingKey",void 0);g([x.property()],r.prototype,"canListApps",void 0);g([x.property()],r.prototype,"canListData",void 0);g([x.property()],r.prototype,"canListPreProvisionedItems",void 0);g([x.property()],r.prototype,"canProvisionDirectPurchase",void 0);g([x.property()],r.prototype,"canSearchPublic",void 0);
g([x.property()],r.prototype,"canShareBingPublic",void 0);g([x.property()],r.prototype,"canSharePublic",void 0);g([x.property()],r.prototype,"canSignInArcGIS",void 0);g([x.property()],r.prototype,"canSignInIDP",void 0);g([x.property()],r.prototype,"colorSetsGroupQuery",void 0);g([x.property()],r.prototype,"commentsEnabled",void 0);g([x.property({type:Date})],r.prototype,"created",void 0);g([x.property()],r.prototype,"credential",void 0);g([x.property()],r.prototype,"culture",void 0);g([x.property()],
r.prototype,"currentVersion",void 0);g([x.property()],r.prototype,"customBaseUrl",void 0);g([x.property()],r.prototype,"defaultBasemap",void 0);g([x.reader("defaultBasemap")],r.prototype,"readDefaultBasemap",null);g([x.property({type:v})],r.prototype,"defaultExtent",void 0);g([x.property()],r.prototype,"defaultVectorBasemap",void 0);g([x.reader("defaultVectorBasemap")],r.prototype,"readDefaultVectorBasemap",null);g([x.property()],r.prototype,"description",void 0);g([x.property()],r.prototype,"eueiEnabled",
void 0);g([x.property({dependsOn:["user","id","canSearchPublic"],readOnly:!0})],r.prototype,"extraQuery",null);g([x.property()],r.prototype,"featuredGroups",void 0);g([x.property()],r.prototype,"featuredItemsGroupQuery",void 0);g([x.property()],r.prototype,"galleryTemplatesGroupQuery",void 0);g([x.property()],r.prototype,"livingAtlasGroupQuery",void 0);g([x.property()],r.prototype,"hasCategorySchema",void 0);g([x.property()],r.prototype,"helpBase",void 0);g([x.property()],r.prototype,"helperServices",
void 0);g([x.property()],r.prototype,"helpMap",void 0);g([x.property()],r.prototype,"homePageFeaturedContent",void 0);g([x.property()],r.prototype,"homePageFeaturedContentCount",void 0);g([x.property()],r.prototype,"httpPort",void 0);g([x.property()],r.prototype,"httpsPort",void 0);g([x.property()],r.prototype,"id",void 0);g([x.property()],r.prototype,"ipCntryCode",void 0);g([x.property({dependsOn:["access"],readOnly:!0})],r.prototype,"isOrganization",null);g([x.property()],r.prototype,"isPortal",
void 0);g([x.property()],r.prototype,"layerTemplatesGroupQuery",void 0);g([x.property()],r.prototype,"maxTokenExpirationMinutes",void 0);g([x.property({type:Date})],r.prototype,"modified",void 0);g([x.property()],r.prototype,"name",void 0);g([x.property()],r.prototype,"portalHostname",void 0);g([x.property()],r.prototype,"portalMode",void 0);g([x.property()],r.prototype,"portalProperties",void 0);g([x.property()],r.prototype,"region",void 0);g([x.property({dependsOn:["url"],readOnly:!0})],r.prototype,
"restUrl",null);g([x.property()],r.prototype,"rotatorPanels",void 0);g([x.property()],r.prototype,"showHomePageDescription",void 0);g([x.property()],r.prototype,"staticImagesUrl",void 0);g([x.property()],r.prototype,"stylesGroupQuery",void 0);g([x.property()],r.prototype,"supportsHostedServices",void 0);g([x.property()],r.prototype,"symbolSetsGroupQuery",void 0);g([x.property()],r.prototype,"templatesGroupQuery",void 0);g([x.property()],r.prototype,"thumbnail",void 0);g([x.property({dependsOn:["restUrl",
"thumbnail"],readOnly:!0})],r.prototype,"thumbnailUrl",null);g([x.property()],r.prototype,"units",void 0);g([x.property()],r.prototype,"url",void 0);g([x.property()],r.prototype,"urlKey",void 0);g([x.reader("urlKey")],r.prototype,"readUrlKey",null);g([x.property()],r.prototype,"user",void 0);g([x.reader("user")],r.prototype,"readUser",null);g([x.property()],r.prototype,"useStandardizedQuery",void 0);g([x.property()],r.prototype,"useVectorBasemaps",void 0);g([x.property()],r.prototype,"vectorBasemapGalleryGroupQuery",
void 0);g([d(1,x.cast(z))],r.prototype,"_queryPortal",null);return r=w=g([x.subclass("esri.portal.Portal")],r)}(x.declared(r,w))})},"esri/core/Loadable":function(){define("./Promise ./Accessor ./Error ./Warning ./lang dojo/aspect dojo/Deferred".split(" "),function(m,f,k,e,g,d,h){return m.createSubclass([f],{declaredClass:"esri.core.Loadable","-chains-":g.mixin({},f._meta.chains,{load:"after"}),constructor:function(){this._set("loadWarnings",[]);var c=new h;this.addResolvingPromise(c.promise);d.around(this,
"load",function(b){return function(){"not-loaded"===this.loadStatus&&(this.loadStatus="loading",b.apply(this));c&&(c.resolve(),c=null);return this.when()}});this.when(function(b){this.loadStatus="loaded"}.bind(this),function(b){this.loadStatus="failed";this.loadError=b}.bind(this))},properties:{loaded:{readOnly:!0,dependsOn:["loadStatus"],get:function(){return"loaded"===this.loadStatus}},loadError:null,loadStatus:"not-loaded",loadWarnings:{type:[e],readOnly:!0}},load:function(){},cancelLoad:function(){if(this.isFulfilled())return this;
this.loadError=new k("load:cancelled","Cancelled");this._promiseProps.cancel(this.loadError);return this}})})},"esri/core/Promise":function(){define("dojo/promise/all dojo/Deferred dojo/aspect dojo/errors/create ./scheduling ./Logger ./declare ./has ./lang".split(" "),function(m,f,k,e,g,d,h,c,b){d.getLogger("esri.core.Promise");var a=function(a){var b=a._promiseProps;if(!b.resolver.isFulfilled()){var c=b.resolvingPromises,d,e;b.allPromise&&b.allPromise.cancel();var l=new f;for(d=c.length-1;0<=d;d--)e=
c[d],e.isCanceled&&e.isCanceled()?c.splice(d,1):e.then(null,null,b.resolver.progress);e=null;(b.allPromise=m(c.concat([l.promise]))).then(function(){b.resolver.resolve(a);a=b=l=b.allPromise=b.resolvingPromises=null},function(c){b.allPromise=null;if(!c||"cancel"!==c.dojoType){var d=Array.prototype.slice.call(arguments,0);b.resolver.reject(d[0]);a=b=l=b.allPromise=b.resolvingPromises=null}});l&&g.schedule(function(){l&&l.resolve()})}},l=e("CancelError",null,function(a){this.target=a}),n=function(a){return a||
new l(this.instance)},p=function(a){this.instance=a;this.canceler=n.bind(this);this.resolver=new f;this.initialized=!1;this.resolvingPromises=[]};p.prototype={canceler:null,cancel:function(a){if(!this.resolver.isFulfilled()){this.allPromise.cancel();for(var b=this.resolvingPromises.concat(),c=b.length-1;0<=c;c--)b[c].cancel(a);this.resolver.cancel(a)}}};return h(null,{declaredClass:"esri.core.Promise",constructor:function(){Object.defineProperty(this,"_promiseProps",{value:new p(this),enumerable:!1,
configurable:!1,writable:!0});var b=k.after(this,"postscript",function(c,d){b.remove();b=null;a(this)},!0)},_promiseProps:null,always:function(a){return this.when(a,a)},isResolved:function(){return this._promiseProps.resolver.isResolved()},isRejected:function(){return this._promiseProps.resolver.isRejected()},isFulfilled:function(){return this._promiseProps.resolver.isFulfilled()},otherwise:function(a){return this.when(null,a)},catch:function(a){return this.when(null,a)},when:function(a,b,c){var d=
new f(this._promiseProps.canceler);a=d.then(a,b,c);this._promiseProps.resolver.then(d.resolve,d.reject,d.progress);return a},addResolvingPromise:function(b){b&&!this._promiseProps.resolver.isFulfilled()&&(b._promiseProps&&(b=b.when()),this._promiseProps.resolvingPromises.push(b),a(this))}})})},"esri/portal/PortalQueryParams":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p=h({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});return function(d){function h(a){a=d.call(this)||this;a.categories=null;a.disableExtraQuery=!1;a.extent=null;a.num=10;a.query=null;a.sortField=null;a.start=1;return a}e(h,d);q=h;Object.defineProperty(h.prototype,"sortOrder",{get:function(){return this._get("sortOrder")||"asc"},set:function(a){"asc"!==a&&"desc"!==a||this._set("sortOrder",a)},enumerable:!0,configurable:!0});
h.prototype.clone=function(){return new q({categories:this.categories?c.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})};h.prototype.toRequestOptions=function(a,b){var c;this.categories&&(c=this.categories.map(function(a){return Array.isArray(a)?JSON.stringify(a):a}));var d;if(this.extent){var e=n.project(this.extent,l.WGS84);e&&(d=e.xmin+
","+e.ymin+","+e.xmax+","+e.ymax)}e=this.query;!this.disableExtraQuery&&a.extraQuery&&(e="("+e+")"+a.extraQuery);a={categories:c,bbox:d,q:e,num:this.num,sortField:null,sortOrder:null,start:this.start};this.sortField&&(a.sortField=p.toJSON(this.sortField),a.sortOrder=this.sortOrder);return{query:k({},b,a)}};var q;g([b.property()],h.prototype,"categories",void 0);g([b.property()],h.prototype,"disableExtraQuery",void 0);g([b.property({type:a})],h.prototype,"extent",void 0);g([b.property()],h.prototype,
"num",void 0);g([b.property()],h.prototype,"query",void 0);g([b.property()],h.prototype,"sortField",void 0);g([b.property()],h.prototype,"sortOrder",null);g([b.property()],h.prototype,"start",void 0);return h=q=g([b.subclass("esri.portal.PortalQueryParams")],h)}(b.declared(d))})},"esri/portal/PortalQueryResult":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,
g,d){return function(h){function c(b){b=h.call(this)||this;b.nextQueryParams=null;b.queryParams=null;b.results=null;b.total=null;return b}k(c,h);e([d.property()],c.prototype,"nextQueryParams",void 0);e([d.property()],c.prototype,"queryParams",void 0);e([d.property()],c.prototype,"results",void 0);e([d.property()],c.prototype,"total",void 0);return c=e([d.subclass("esri.portal.PortalQueryResult")],c)}(d.declared(g))})},"esri/portal/PortalUser":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../core/Error ../core/JSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ./PortalFolder ./PortalGroup".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return function(h){function n(){var a=h.call(this)||this;a.access=null;a.created=null;a.culture=null;a.description=null;a.email=null;a.fullName=null;a.modified=null;a.orgId=null;a.portal=null;a.preferredView=null;a.privileges=null;a.region=null;a.role=null;a.roleId=null;a.units=null;a.username=null;a.userType=null;return a}k(n,h);Object.defineProperty(n.prototype,"thumbnailUrl",{get:function(){var a=this.url,b=this.thumbnail;return a&&b?this.portal._normalizeUrl(a+
"/info/"+b+"?f\x3djson"):null},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"userContentUrl",{get:function(){var a=this.get("portal.restUrl");return a?a+"/content/users/"+this.username:null},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"url",{get:function(){var a=this.get("portal.restUrl");return a?a+"/community/users/"+this.username:null},enumerable:!0,configurable:!0});n.prototype.addItem=function(a){var b=this,c=a&&a.item,d=a&&a.data;a=a&&a.folder;var e=
{method:"post"};c&&(e.query=c._getPostQuery(),null!=d&&("string"===typeof d?e.query.text=d:"object"===typeof d&&(e.query.text=JSON.stringify(d))));d=this.userContentUrl;a&&(d+="/"+a.id);return this.portal._request(d+"/addItem",e).then(function(a){c.id=a.id;c.portal=b.portal;return c.loaded?c._reload():c.load()})};n.prototype.deleteItem=function(a){var b=this.userContentUrl;a.ownerFolder&&(b+="/"+a.ownerFolder);return this.portal._request(b+("/items/"+a.id+"/delete"),{method:"post"}).then(function(){a.id=
null;a.portal=null})};n.prototype.deleteItems=function(a){var b=this.userContentUrl+"/deleteItems",d=a.map(function(a){return a.id});return d.length?(d={method:"post",query:{items:d.join(",")}},this.portal._request(b,d).then(function(){a.forEach(function(a){a.id=null;a.portal=null})})):c.resolve(void 0)};n.prototype.fetchFolders=function(){var b=this;return this.portal._request(this.userContentUrl,{query:{num:1}}).then(function(c){return c&&c.folders?c.folders.map(function(c){c=a.fromJSON(c);c.portal=
b.portal;return c}):[]})};n.prototype.fetchGroups=function(){var a=this;return this.portal._request(this.url).then(function(b){return b&&b.groups?b.groups.map(function(b){b=l.fromJSON(b);b.portal=a.portal;return b}):[]})};n.prototype.fetchItems=function(a){var b=this;a||(a={});var d=this.userContentUrl;a.folder&&(d+="/"+a.folder.id);var e;return c.create(function(a){return m(["./PortalItem"],a)}).then(function(c){e=c;return b.portal._request(d,{query:{folders:!1,num:a.num||10,start:a.start||1}})}).then(function(a){var c;
return a&&a.items?(c=a.items.map(function(a){a=e.fromJSON(a);a.portal=b.portal;return a}),g(c.map(function(a){return a.load()})).always(function(){return{items:c,nextStart:a.nextStart,total:a.total}})):{items:[],nextStart:-1,total:0}})};n.prototype.getThumbnailUrl=function(a){var b=this.thumbnailUrl;b&&a&&(b+="\x26w\x3d"+a);return b};n.prototype.queryFavorites=function(a){return this.favGroupId?(this._favGroup||(this._favGroup=new l({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(a)):
c.reject(new d("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))};n.prototype.toJSON=function(){throw new d("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented");};e([b.property()],n.prototype,"access",void 0);e([b.property({type:Date})],n.prototype,"created",void 0);e([b.property()],n.prototype,"culture",void 0);e([b.property()],n.prototype,"description",void 0);e([b.property()],n.prototype,"email",void 0);e([b.property()],n.prototype,"favGroupId",
void 0);e([b.property()],n.prototype,"fullName",void 0);e([b.property({type:Date})],n.prototype,"modified",void 0);e([b.property()],n.prototype,"orgId",void 0);e([b.property()],n.prototype,"portal",void 0);e([b.property()],n.prototype,"preferredView",void 0);e([b.property()],n.prototype,"privileges",void 0);e([b.property()],n.prototype,"region",void 0);e([b.property()],n.prototype,"role",void 0);e([b.property()],n.prototype,"roleId",void 0);e([b.property()],n.prototype,"thumbnail",void 0);e([b.property({dependsOn:["url",
"thumbnail","portal.credential.token"],readOnly:!0})],n.prototype,"thumbnailUrl",null);e([b.property()],n.prototype,"units",void 0);e([b.property({dependsOn:["portal.restUrl"],readOnly:!0})],n.prototype,"userContentUrl",null);e([b.property({dependsOn:["portal.restUrl"],readOnly:!0})],n.prototype,"url",null);e([b.property()],n.prototype,"username",void 0);e([b.property()],n.prototype,"userType",void 0);return n=e([b.subclass("esri.portal.PortalUser")],n)}(b.declared(h))})},"esri/portal/PortalFolder":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.created=null;a.id=null;a.portal=null;a.title=null;a.username=null;return a}k(b,c);Object.defineProperty(b.prototype,"url",{get:function(){var a=this.get("portal.restUrl");return a?a+"/content/users/"+this.username+"/"+this.id:null},enumerable:!0,configurable:!0});b.prototype.toJSON=function(){throw new g("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented");};e([h.property({type:Date})],b.prototype,
"created",void 0);e([h.property()],b.prototype,"id",void 0);e([h.property()],b.prototype,"portal",void 0);e([h.property()],b.prototype,"title",void 0);e([h.property({dependsOn:["portal.restUrl"],readOnly:!0})],b.prototype,"url",null);e([h.property()],b.prototype,"username",void 0);return b=e([h.subclass("esri.portal.PortalFolder")],b)}(h.declared(d))})},"esri/portal/PortalGroup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/Error ../core/JSONSupport ../core/accessorSupport/decorators ./PortalQueryParams".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function l(b){b=a.call(this)||this;b.access=null;b.created=null;b.description=null;b.id=null;b.isInvitationOnly=!1;b.modified=null;b.owner=null;b.portal=null;b.snippet=null;b.sortField=null;b.sortOrder=null;b.tags=null;b.title=null;return b}k(l,a);Object.defineProperty(l.prototype,"thumbnailUrl",{get:function(){var a=this.url,b=this.thumbnail;return a&&b?this.portal._normalizeUrl(a+"/info/"+b+"?f\x3djson"):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,
"url",{get:function(){var a=this.get("portal.restUrl");return a?a+"/community/groups/"+this.id:null},enumerable:!0,configurable:!0});l.prototype.fetchCategorySchema=function(){var a=this;return this.portal._request(this.url+"/categorySchema").then(function(b){b=b.categorySchema||[];return b.some(function(a){return"contentCategorySetsGroupQuery.LivingAtlas"===a.source})?a._fetchCategorySchemaSet("LivingAtlas"):b})};l.prototype.fetchMembers=function(){return this.portal._request(this.url+"/users")};
l.prototype.getThumbnailUrl=function(a){var b=this.thumbnailUrl;b&&a&&(b+="\x26w\x3d"+a);return b};l.prototype.toJSON=function(){throw new d("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented");};l.prototype.queryItems=function(a){if(5<parseFloat(this.portal.currentVersion))return a=a||new b,this.portal._queryPortal("/content/groups/"+this.id+"/search",a,"PortalItem");a=a?a.clone():new b;a.query="group:"+this.id+(a.query?" "+a.query:"");return this.portal.queryItems(a)};l.prototype._fetchCategorySchemaSet=
function(a){var c=this;return this.portal._fetchSelf(this.portal.authMode,!0).then(function(a){if(a=a.contentCategorySetsGroupQuery){var e=new b;e.disableExtraQuery=!0;e.num=1;e.query=a;return c.portal.queryGroups(e)}throw new d("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found");}).then(function(c){if(c.total){c=c.results[0];var e=new b;e.num=1;e.query='typekeywords:"'+a+'"';return c.queryItems(e)}throw new d("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found");
}).then(function(a){return a.total?a.results[0].fetchData().then(function(a){return(a=a&&a.categorySchema)&&a.length?a:[]}):[]})};e([c.property()],l.prototype,"access",void 0);e([c.property({type:Date})],l.prototype,"created",void 0);e([c.property()],l.prototype,"description",void 0);e([c.property()],l.prototype,"id",void 0);e([c.property()],l.prototype,"isInvitationOnly",void 0);e([c.property({type:Date})],l.prototype,"modified",void 0);e([c.property()],l.prototype,"owner",void 0);e([c.property()],
l.prototype,"portal",void 0);e([c.property()],l.prototype,"snippet",void 0);e([c.property()],l.prototype,"sortField",void 0);e([c.property()],l.prototype,"sortOrder",void 0);e([c.property()],l.prototype,"tags",void 0);e([c.property()],l.prototype,"thumbnail",void 0);e([c.property({dependsOn:["url","thumbnail","portal.credential.token"],readOnly:!0})],l.prototype,"thumbnailUrl",null);e([c.property()],l.prototype,"title",void 0);e([c.property({dependsOn:["portal.restUrl"],readOnly:!0})],l.prototype,
"url",null);e([g(0,c.cast(b))],l.prototype,"queryItems",null);return l=e([c.subclass("esri.portal.PortalGroup")],l)}(c.declared(h))})},"esri/symbols/ExtrudeSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Symbol3DLayer ./edges/utils".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.type="extrude";a.size=void 0;a.material=null;a.edges=null;return a}
k(b,c);a=b;b.prototype.clone=function(){return new a({edges:this.edges&&this.edges.clone(),enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),size:this.size})};var a;e([g.enumeration.serializable()({Extrude:"extrude"})],b.prototype,"type",void 0);e([g.property({type:Number,json:{write:!0}})],b.prototype,"size",void 0);e([g.property()],b.prototype,"material",void 0);e([g.property(h.symbol3dEdgesProperty)],b.prototype,"edges",
void 0);return b=a=e([g.subclass("esri.symbols.ExtrudeSymbol3DLayer")],b)}(g.declared(d))})},"esri/symbols/Symbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/accessorSupport/decorators ./support/ElevationInfo ./support/Symbol3DMaterial".split(" "),function(m,f,k,e,g,d,h,c,b){var a=d.strict()({Icon:"icon",Object:"object",Line:"line",Path:"path",Fill:"fill",Extrude:"extrude",Text:"text"});
m=function(d){function l(a){a=d.call(this)||this;a.enabled=!0;a.material=null;a.type=null;return a}k(l,d);l.prototype.writeEnabled=function(a,b,c){a||(b[c]=a)};e([h.property({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],l.prototype,"enabled",void 0);e([h.writer("enabled")],l.prototype,"writeEnabled",null);e([h.property({type:c,json:{read:!1,write:!1}})],l.prototype,"elevationInfo",void 0);e([h.property({type:b.default,json:{write:!0}})],l.prototype,"material",void 0);e([h.property({type:a.apiValues,
readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:a.write}}})],l.prototype,"type",void 0);return l=e([h.subclass("esri.symbols.Symbol3DLayer")],l)}(h.declared(g));(m||(m={})).typeJSONDictionary=a;return m})},"esri/symbols/support/ElevationInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators ../../support/arcadeUtils ./unitConversionUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=d.strict()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),l=d({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"}),n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);d=b;Object.defineProperty(b.prototype,"requiredFields",{get:function(){return c.extractFieldNames(this.expression)},enumerable:!0,configurable:!0});
b.prototype.clone=function(){return new d({expression:this.expression,title:this.title})};var d;e([h.property({type:String,json:{write:!0}})],b.prototype,"expression",void 0);e([h.property({readOnly:!0,dependsOn:["expression"]})],b.prototype,"requiredFields",null);e([h.property({type:String,json:{write:!0}})],b.prototype,"title",void 0);return b=d=e([h.subclass("esri.layers.support.FeatureExpressionInfo")],b)}(h.declared(g));return function(c){function d(){return null!==c&&c.apply(this,arguments)||
this}k(d,c);g=d;d.prototype.readFeatureExpressionInfo=function(a,b){if(null!=a)return a;if(b.featureExpression&&0===b.featureExpression.value)return{expression:"0"}};d.prototype.writeFeatureExpressionInfo=function(a,b,c,d){b[c]=a.write(null,d);"0"===a.expression&&(b.featureExpression={value:0})};Object.defineProperty(d.prototype,"mode",{get:function(){return this._isOverridden("mode")?this._get("mode"):null!=this.offset||this.featureExpressionInfo?"relative-to-ground":"on-the-ground"},set:function(a){this._override("mode",
a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"unit",{set:function(a){this._set("unit",a)},enumerable:!0,configurable:!0});d.prototype.write=function(a,b){return this.offset||this.mode||this.featureExpressionInfo||this.unit?this.inherited(arguments):null};d.prototype.clone=function(){return new g({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})};var g;e([h.property({type:n,json:{write:!0}})],
d.prototype,"featureExpressionInfo",void 0);e([h.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],d.prototype,"readFeatureExpressionInfo",null);e([h.writer("featureExpressionInfo",{featureExpressionInfo:{type:n},"featureExpression.value":{type:Number}})],d.prototype,"writeFeatureExpressionInfo",null);e([h.property({type:a.apiValues,dependsOn:["offset","featureExpressionInfo"],nonNullable:!0,json:{read:a.read,write:{writer:a.write,isRequired:!0}}})],d.prototype,"mode",
null);e([h.property({type:Number,json:{write:!0}})],d.prototype,"offset",void 0);e([h.property({type:b.supportedUnits,json:{read:l.read,write:l.write}})],d.prototype,"unit",null);return d=g=e([h.subclass("esri.layers.support.ElevationInfo")],d)}(h.declared(g))})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.supportsUnit=function(e){return null!=k.meterIn[e]};f.getMetersPerUnit=
function(e){return 1/(k.meterIn[e]||1)};f.supportedUnits=function(){var e=Object.keys(k.meterIn);e.sort();return e}()})},"esri/renderers/support/utils":function(){define("dojo/date/locale ../../Color ../../core/lang ../../core/numberUtils ../../core/unitUtils dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(m,f,k,e,g,d){function h(a){return a&&a.map(function(a){return new f(a)})}function c(b,c,d){var e="";0===c?e=a.lt+" ":c===d&&(e=a.gt+" ");return e+b}var b={},a={lte:"\x3c\x3d",gte:"\x3e\x3d",
lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},l={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},n={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",
dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},p={formatLength:"short",fullYear:!0},q={formatLength:"short"};k.mixin(b,{meterIn:{inches:g.convertUnit(1,"meters","inches"),feet:g.convertUnit(1,"meters","feet"),"us-feet":g.convertUnit(1,"meters","us-feet"),yards:g.convertUnit(1,"meters","yards"),miles:g.convertUnit(1,"meters","miles"),"nautical-miles":g.convertUnit(1,"meters","nautical-miles"),millimeters:g.convertUnit(1,"meters","millimeters"),centimeters:g.convertUnit(1,
"meters","centimeters"),decimeters:g.convertUnit(1,"meters","decimeters"),meters:g.convertUnit(1,"meters","meters"),kilometers:g.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/g.lengthToDegrees(1,"meters")},timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,b){var c=[];null==a||a instanceof Date||(a=new Date(a));b=b||{};b=k.mixin({},b);var e=b.selector?b.selector.toLowerCase():null,l=!e||-1<e.indexOf("time"),e=!e||-1<e.indexOf("date");
l&&(b.timeOptions=b.timeOptions||q,b.timeOptions&&(b.timeOptions=k.mixin({},b.timeOptions),b.timeOptions.selector=b.timeOptions.selector||"time",c.push(b.timeOptions)));e&&(b.dateOptions=b.dateOptions||p,b.dateOptions&&(b.dateOptions=k.mixin({},b.dateOptions),b.dateOptions.selector=b.dateOptions.selector||"date",c.push(b.dateOptions)));c&&c.length?(c=c.map(function(b){return m.format(a,b)}),b=1==c.length?c[0]:d["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return c[b]})):
b=m.format(a);return b},createColorStops:function(a){var d=a.values,l=a.colors,h=a.labelIndexes,g=a.isDate,n=a.dateFormatOptions;a=[];return a=d.map(function(a,k){var p=null;if(!h||-1<h.indexOf(k)){var q;(q=g?b.formatDate(a,n):e.format(a))&&(p=c(q,k,d.length-1))}return{value:a,color:l[k],label:p}})},updateColorStops:function(a){var d=a.stops,l=a.changes,h=a.isDate,g=a.dateFormatOptions,n=[],k,p=d.map(function(a){return a.value});l.forEach(function(a){n.push(a.index);p[a.index]=a.value});k=e.round(p,
{indexes:n});d.forEach(function(a,l){a.value=p[l];if(null!=a.label){var n,q=null;(n=h?b.formatDate(k[l],g):e.format(k[l]))&&(q=c(n,l,d.length-1));a.label=q}})},createClassBreakLabel:function(b){var c=b.minValue,d=b.maxValue,l=b.isFirstBreak?"":a.gt+" ";b="percent-of-total"===b.normalizationType?a.pct:"";c=null==c?"":e.format(c);d=null==d?"":e.format(d);return l+c+b+" "+a.ld+" "+d+b},setLabelsForClassBreaks:function(a){var c=a.classBreakInfos,d=a.classificationMethod,l=a.normalizationType,h=[];c&&
c.length&&("standard-deviation"===d?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(h.push(c[0].minValue),c.forEach(function(a){h.push(a.maxValue)}),h=e.round(h),c.forEach(function(a,c){a.label=b.createClassBreakLabel({minValue:0===c?h[0]:h[c],maxValue:h[c+1],isFirstBreak:0===c,normalizationType:l})})):c.forEach(function(a,c){a.label=b.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===c,
normalizationType:l})}))},updateClassBreak:function(a){var c=a.classBreaks,d=a.normalizationType,e=a.change,l=e.index,e=e.value,h=-1,g=-1,n=c.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===l?h=l:l===n?g=l-1:(g=l-1,h=l),-1<h&&h<n&&(a=c[h],a.minValue=e,a.label=b.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:d})),-1<g&&g<
n&&(a=c[g],a.maxValue=e,a.label=b.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===g,normalizationType:d})))},calculateDateFormatInterval:function(a){var b,c,d=a.length,e,h,g,n,k,p,q=Infinity,f;a=a.map(function(a){return new Date(a)});for(b=0;b<d-1;b++){e=a[b];g=[];k=Infinity;p="";for(c=b+1;c<d;c++)h=a[c],h=e.getFullYear()!==h.getFullYear()&&"year"||e.getMonth()!==h.getMonth()&&"month"||e.getDate()!==h.getDate()&&"day"||e.getHours()!==h.getHours()&&"hour"||e.getMinutes()!==
h.getMinutes()&&"minute"||e.getSeconds()!==h.getSeconds()&&"second"||"millisecond",n=l[h],n<k&&(k=n,p=h),g.push(h);k<q&&(q=k,f=p)}return f},createUniqueValueLabel:function(a){var c=a.value,d=a.fieldInfo,l=a.domain;a=a.dateFormatInterval;var h=String(c);(l=l&&l.codedValues?l.getName(c):null)?h=l:"number"===typeof c&&(h=d&&"date"===d.type?b.formatDate(c,a&&n[a]):e.format(c));return h},cloneColorVariable:function(a){var b;a&&(b=k.mixin({},a),b.colors=h(b.colors),b.stops=b.stops&&b.stops.map(function(a){a=
k.mixin({},a);a.color&&(a.color=new f(a.color));return a}),b.legendOptions&&(b.legendOptions=k.mixin({},b.legendOptions)));return b},cloneOpacityVariable:function(a){var b;if(a){b=k.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=a.map(function(a){return k.mixin({},a)});if(a=b.legendOptions)b.legendOptions=k.mixin({},a)}return b},cloneSizeVariable:function(a){var c;a&&(c=k.mixin({},a),c.stops&&(c.stops=c.stops.map(function(a){return k.mixin({},a)})),(a=c.minSize)&&
"object"===typeof a&&(c.minSize=b.cloneSizeVariable(a)),(a=c.maxSize)&&"object"===typeof a&&(c.maxSize=b.cloneSizeVariable(a)),a=c.legendOptions)&&(c.legendOptions=k.mixin({},a),a=a.customValues)&&(c.legendOptions.customValues=a.slice(0));return c}});return b})},"esri/core/numberUtils":function(){define(["dojo/number","dojo/i18n!dojo/cldr/nls/number"],function(m,f){function k(c,b){return c-b}var e=/^-?(\d+)(\.(\d+))?$/i,g=new RegExp("\\"+f.decimal+"0+$","g"),d=/(\d)0*$/g,h={numDigits:function(c){var b=
String(c),a=b.match(e);c={integer:0,fractional:0};a&&a[1]?(c.integer=a[1].split("").length,c.fractional=a[3]?a[3].split("").length:0):-1<b.toLowerCase().indexOf("e")&&(a=b.split("e"),b=a[0],a=a[1],b&&a&&(b=Number(b),a=Number(a),(c=0<a)||(a=Math.abs(a)),b=h.numDigits(b),c?(b.integer+=a,b.fractional=a>b.fractional?0:b.fractional-a):(b.fractional+=a,b.integer=a>b.integer?1:b.integer-a),c=b));return c},percentChange:function(c,b,a,d){var e={previous:null,next:null},l;null!=a&&(l=c-a,e.previous=Math.floor(Math.abs(100*
(b-a-l)/l)));null!=d&&(l=d-c,e.next=Math.floor(Math.abs(100*(d-b-l)/l)));return e},round:function(c,b){c=c.slice(0);var a,d,e,g,q,f,m,w,u=b&&null!=b.tolerance?b.tolerance:2,x=b&&b.indexes,v=b&&null!=b.strictBounds?b.strictBounds:!1;if(x)x.sort(k);else for(x=[],q=0;q<c.length;q++)x.push(q);for(q=0;q<x.length;q++)if(w=x[q],b=c[w],a=0===w?null:c[w-1],d=w===c.length-1?null:c[w+1],e=h.numDigits(b),e=e.fractional){f=0;for(m=!1;f<=e&&!m;){g=b;m=f;var z=void 0,y=void 0,z=Number(g.toFixed(m));z<g?y=z+1/Math.pow(10,
m):(y=z,z-=1/Math.pow(10,m));z=Number(z.toFixed(m));y=Number(y.toFixed(m));g=[z,y];g=v&&0===q?g[1]:g[0];m=u;var z=h.percentChange(b,g,a,d),A=y=void 0,y=void 0,y=null==z.previous||z.previous<=m,A=null==z.next||z.next<=m;m=y=y&&A||z.previous+z.next<=2*m;f++}m&&(c[w]=g)}return c},format:function(c,b){b=b||{places:20,round:-1};(c=m.format(c,b))&&(c=c.replace(d,"$1").replace(g,""));return c}};return h})},"esri/core/unitUtils":function(){define(["require","exports","dojo/i18n!./nls/Units","dojo/number",
"./wgs84Constants"],function(m,f,k,e,g){m={millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1E3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}};f={"square-millimeters":{inBaseUnits:1E-6},"square-centimeters":{inBaseUnits:1E-4},"square-decimeters":{inBaseUnits:.1*.1},"square-meters":{inBaseUnits:1},
"square-kilometers":{inBaseUnits:1E6},"square-inches":{inBaseUnits:6.4516E-4},"square-feet":{inBaseUnits:.09290304},"square-yards":{inBaseUnits:.83612736},"square-miles":{inBaseUnits:2589988.110336},"square-us-feet":{inBaseUnits:function(b){return b*b}(1200/3937)},acres:{inBaseUnits:4046.8564224},ares:{inBaseUnits:100},hectares:{inBaseUnits:1E4}};var d={length:{baseUnit:"meters",units:m},area:{baseUnit:"square-meters",units:f},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1E3*
1E-9},"cubic-centimeters":{inBaseUnits:.001},"cubic-decimeters":{inBaseUnits:1},"cubic-meters":{inBaseUnits:1E3},"cubic-kilometers":{inBaseUnits:1E12},"cubic-inches":{inBaseUnits:.016387064},"cubic-feet":{inBaseUnits:.09290304*304.8},"cubic-yards":{inBaseUnits:764.554857984},"cubic-miles":{inBaseUnits:4.16818182544058E12}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},h=function(){var b={},a;for(a in d)for(var c in d[a].units)b[c]=a;return b}(),c;(function(b){function a(a){if(a=
h[a])return a;throw Error("unknown measure");}function c(a){return d[a].baseUnit}function n(b,c){void 0===c&&(c=null);c=c||a(b);return d[c].baseUnit===b}function p(b,c,e){if(c===e)return b;var l=a(c);if(l!==a(e))throw Error("incompatible units");b=n(c,l)?b:b*d[l].units[c].inBaseUnits;return n(e,l)?b:b/d[l].units[e].inBaseUnits}function q(a,b){return k.units[a][b]}function f(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");return e.format(a,{places:c})+" "+q(b,d)}function m(a,b){return 3E3>p(a,b,
"meters")?"meters":"kilometers"}function w(a,b){return 1E5>p(a,b,"meters")?"meters":"kilometers"}function u(a,b){return 1E3>p(a,b,"feet")?"feet":"miles"}function x(a,b){return 1E5>p(a,b,"feet")?"feet":"miles"}function v(a,b){return 3E6>p(a,b,"square-meters")?"square-meters":"square-kilometers"}function z(a,b){return 1E6>p(a,b,"square-feet")?"square-feet":"square-miles"}b.measureForUnit=a;b.baseUnitForMeasure=c;b.baseUnitForUnit=function(b){return c(a(b))};b.isBaseUnit=n;b.convertUnit=p;b.unitName=
q;b.formatDecimal=f;b.preferredMetricLengthUnit=m;b.preferredMetricVerticalLengthUnit=w;b.formatMetricLength=function(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");var e=m(a,b);return f(p(a,b,e),e,c,d)};b.formatMetricVerticalLength=function(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");var e=w(a,b);return f(p(a,b,e),e,c,d)};b.preferredImperialLengthUnit=u;b.preferredImperialVerticalLengthUnit=x;b.formatImperialLength=function(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");var e=u(a,b);
return f(p(a,b,e),e,c,d)};b.formatImperialVerticalLength=function(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");var e=x(a,b);return f(p(a,b,e),e,c,d)};b.preferredMetricAreaUnit=v;b.formatMetricArea=function(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");var e=v(a,b);return f(p(a,b,e),e,c,d)};b.preferredImperialAreaUnit=z;b.formatImperialArea=function(a,b,c,d){void 0===c&&(c=2);void 0===d&&(d="abbr");var e=z(a,b);return f(p(a,b,e),e,c,d)};b.lengthToDegrees=function(a,b,c){void 0===c&&(c=g.wgs84Radius);
return p(a,b,"meters")/(c*Math.PI/180)};b.formatDMS=function(a,c,d){void 0===d&&(d=2);a=b.convertUnit(a,c,"degrees");c=a-Math.floor(a);a-=c;c*=60;var e=c-Math.floor(c);c-=e;e*=60;return a.toFixed()+"\u00b0 "+c.toFixed()+"' "+e.toFixed(d)+'"'}})(c||(c={}));return c})},"esri/symbols/support/Symbol3DMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./materialUtils".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}k(b,c);a=b;b.prototype.clone=function(){return new a({color:this.color?this.color.clone():null})};var a;e([d.property(h.colorAndTransparencyProperty)],b.prototype,"color",void 0);return b=a=e([d.subclass("esri.symbols.support.Symbol3DMaterial")],b)}(d.declared(g));f.Symbol3DMaterial=m;f.default=m})},"esri/symbols/support/materialUtils":function(){define("require exports ../../Color ../../core/screenUtils ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(m,f,k,e,g,d){function h(b,a){b=null!=a.transparency?d.transparencyToOpacity(a.transparency):1;if((a=a.color)&&Array.isArray(a))return new k([a[0]||0,a[1]||0,a[2]||0,b])}function c(b,a){a.color=b.toJSON().slice(0,3);b=d.opacityToTransparency(b.a);0!==b&&(a.transparency=b)}Object.defineProperty(f,"__esModule",{value:!0});f.readColorAndTransparency=h;f.writeColorAndTransparency=c;f.colorAndTransparencyProperty={type:k,json:{type:[g.Integer],read:{source:["color","transparency"],reader:h},write:{target:{color:{type:[g.Integer]},
transparency:{type:g.Integer}},writer:c}}};f.screenSizeProperty={type:Number,cast:e.toPt,json:{write:!0}}})},"esri/core/screenUtils":function(){define(["require","exports"],function(m,f){function k(e){return e?72*e/f.DPI:0}Object.defineProperty(f,"__esModule",{value:!0});var e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;f.DPI=96;f.pt2px=function(e){return e?e/72*f.DPI:0};f.px2pt=k;f.toPt=function(g){if("string"===typeof g){if(e.test(g)){var d=g.match(e),h=Number(d[1]),d=d[3]&&d[3].toLowerCase();g="-"===g.charAt(0);
h="px"===d?k(h):h;return g?-h:h}console.warn("screenUtils.toPt: input not recognized!");return null}return g}})},"esri/webdoc/support/opacityUtils":function(){define(["require","exports","../../core/accessorSupport/ensureType"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.opacityToTransparency=function(e){e=k.ensureInteger(100*(1-e));return Math.max(0,Math.min(e,100))};f.transparencyToOpacity=function(e){return Math.max(0,Math.min(1-e/100,1))}})},"esri/symbols/edges/utils":function(){define(["require",
"exports","./Edges3D","./SketchEdges3D","./SolidEdges3D"],function(m,f,k,e,g){function d(d,c,b){if(!d)return d;switch(d.type){case "solid":return c=new g,c.read(d,b),c;case "sketch":return c=new e,c.read(d,b),c}}Object.defineProperty(f,"__esModule",{value:!0});f.read=d;f.symbol3dEdgesProperty={types:{key:"type",base:k,typeMap:{solid:g,sketch:e}},json:{read:d,write:!0}}})},"esri/symbols/edges/Edges3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/screenUtils ../../core/accessorSupport/decorators ../support/materialUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return function(h){function n(a){a=h.call(this)||this;a.color=new d([0,0,0,1]);a.extensionLength=0;a.size=b.px2pt(1);return a}k(n,h);n.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=g({},a),delete a.type);return a};n.prototype.clone=function(){};n.prototype.cloneProperties=function(){return{color:c.clone(this.color),size:this.size,extensionLength:this.extensionLength}};e([a.property({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],
n.prototype,"type",void 0);e([a.property(l.colorAndTransparencyProperty)],n.prototype,"color",void 0);e([a.property(g({},l.screenSizeProperty,{json:{write:{overridePolicy:function(a){return{enabled:!!a}}}}}))],n.prototype,"extensionLength",void 0);e([a.property(l.screenSizeProperty)],n.prototype,"size",void 0);return n=e([a.subclass("esri.symbols.edges.Edges3D")],n)}(a.declared(h))})},"esri/symbols/edges/SketchEdges3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Edges3D".split(" "),
function(m,f,k,e,g,d){return function(d){function c(a){a=d.call(this)||this;a.type="sketch";return a}k(c,d);b=c;c.prototype.clone=function(){return new b(this.cloneProperties())};var b;e([g.property({type:["sketch"]})],c.prototype,"type",void 0);return c=b=e([g.subclass("esri.symbols.edges.SketchEdges3D")],c)}(g.declared(d))})},"esri/symbols/edges/SolidEdges3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Edges3D".split(" "),
function(m,f,k,e,g,d){return function(d){function c(a){a=d.call(this)||this;a.type="solid";return a}k(c,d);b=c;c.prototype.clone=function(){return new b(this.cloneProperties())};var b;e([g.property({type:["solid"]})],c.prototype,"type",void 0);return c=b=e([g.subclass("esri.symbols.support.SolidEdges3D")],c)}(g.declared(d))})},"esri/symbols/FillSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Symbol3DLayer ./edges/utils ./support/Symbol3DFillMaterial ./support/Symbol3DOutline".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function d(b){b=a.call(this)||this;b.type="fill";b.material=null;b.outline=null;b.edges=null;return b}k(d,a);n=d;d.prototype.clone=function(){return new n({edges:this.edges&&this.edges.clone(),enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),outline:this.outline&&this.outline.clone()})};var n;e([g.enumeration.serializable()({Fill:"fill"})],d.prototype,"type",void 0);e([g.property({type:c.default})],
d.prototype,"material",void 0);e([g.property({type:b.default,json:{write:!0}})],d.prototype,"outline",void 0);e([g.property(h.symbol3dEdgesProperty)],d.prototype,"edges",void 0);return d=n=e([g.subclass("esri.symbols.FillSymbol3DLayer")],d)}(g.declared(d))})},"esri/symbols/support/Symbol3DFillMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Symbol3DMaterial".split(" "),function(m,f,k,
e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function c(){return null!==d&&d.apply(this,arguments)||this}k(c,d);b=c;c.prototype.clone=function(){return new b({color:this.color?this.color.clone():null,colorMixMode:this.colorMixMode})};var b;e([g.enumeration.serializable()({multiply:"multiply",replace:"replace",tint:"tint"})],c.prototype,"colorMixMode",void 0);return c=b=e([g.subclass("esri.symbols.support.Symbol3DFillMaterial")],c)}(g.declared(d.default));f.Symbol3DFillMaterial=
m;f.default=m})},"esri/symbols/support/Symbol3DOutline":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/screenUtils ../../core/accessorSupport/decorators ./materialUtils".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.color=new g([0,0,0,1]);b.size=h.px2pt(1);return b}k(d,a);
n=d;d.prototype.clone=function(){return new n({color:this.color?this.color.clone():null,size:this.size})};var n;e([c.property(b.colorAndTransparencyProperty)],d.prototype,"color",void 0);e([c.property(b.screenSizeProperty)],d.prototype,"size",void 0);return d=n=e([c.subclass("esri.symbols.support.Symbol3DOutline")],d)}(c.declared(d));f.Symbol3DOutline=m;f.default=m})},"esri/symbols/IconSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Symbol3DLayer ./support/IconSymbol3DLayerResource ./support/materialUtils ./support/Symbol3DOutline".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function d(b){b=a.call(this)||this;b.material=null;b.resource=null;b.type="icon";b.size=12;b.anchor=void 0;b.outline=void 0;return b}k(d,a);n=d;d.prototype.clone=function(){return new n({anchor:this.anchor,enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),outline:this.outline&&this.outline.clone(),resource:this.resource&&this.resource.clone(),size:this.size})};var n;e([g.property()],
d.prototype,"material",void 0);e([g.property({type:h.default,json:{write:!0}})],d.prototype,"resource",void 0);e([g.enumeration.serializable()({Icon:"icon"})],d.prototype,"type",void 0);e([g.property(c.screenSizeProperty)],d.prototype,"size",void 0);e([g.enumeration.serializable()({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right"})],d.prototype,"anchor",void 0);e([g.property({type:b.default,
json:{write:!0}})],d.prototype,"outline",void 0);return d=n=e([g.subclass("esri.symbols.IconSymbol3DLayer")],d)}(g.declared(d))})},"esri/symbols/support/IconSymbol3DLayerResource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/urlUtils ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});var b=d.strict()({circle:"circle",
square:"square",cross:"cross",x:"x",kite:"kite"});m=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}k(d,a);g=d;d.prototype.readHref=function(a,b,c){return a?h.read(a,c):b.dataURI};d.prototype.writeHref=function(a,b,c,d){a&&(h.isDataProtocol(a)?b.dataURI=a:(b.href=h.write(a,d),h.isAbsolute(b.href)&&(b.href=h.normalize(b.href))))};d.prototype.clone=function(){return new g({href:this.href,primitive:this.primitive})};var g;e([c.property({type:String,json:{write:!0,read:{source:["href",
"dataURI"]}}})],d.prototype,"href",void 0);e([c.reader("href")],d.prototype,"readHref",null);e([c.writer("href",{href:{type:String},dataURI:{type:String}})],d.prototype,"writeHref",null);e([c.enumeration.serializable()(b)],d.prototype,"primitive",void 0);return d=g=e([c.subclass("esri.symbols.support.IconSymbol3DLayerResource")],d)}(c.declared(g));f.IconSymbol3DLayerResource=m;f.default=m})},"esri/symbols/LineSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/screenUtils ../core/accessorSupport/decorators ./Symbol3DLayer ./support/materialUtils".split(" "),
function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this)||this;a.material=null;a.type="line";a.size=g.px2pt(1);return a}k(a,b);l=a;a.prototype.clone=function(){return new l({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),size:this.size})};var l;e([d.property()],a.prototype,"material",void 0);e([d.enumeration.serializable()({Line:"line"})],a.prototype,"type",void 0);e([d.property(c.screenSizeProperty)],
a.prototype,"size",void 0);return a=l=e([d.subclass("esri.symbols.LineSymbol3DLayer")],a)}(d.declared(h))})},"esri/symbols/ObjectSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Symbol3DLayer ./support/ObjectSymbol3DLayerResource ./support/Symbol3DMaterial".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this)||this;a.material=null;a.resource=null;a.type="object";
a.width=void 0;a.height=void 0;a.depth=void 0;a.anchor=void 0;a.heading=void 0;a.tilt=void 0;a.roll=void 0;return a}k(a,b);d=a;a.prototype.clone=function(){return new d({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,depth:this.depth,enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),height:this.height,material:this.material&&this.material.clone(),resource:this.resource&&this.resource.clone(),width:this.width})};Object.defineProperty(a.prototype,
"isPrimitive",{get:function(){return!this.resource||"string"!==typeof this.resource.href},enumerable:!0,configurable:!0});var d;e([g.property({type:c.default})],a.prototype,"material",void 0);e([g.property({type:h.default,json:{write:!0}})],a.prototype,"resource",void 0);e([g.enumeration.serializable()({Object:"object"})],a.prototype,"type",void 0);e([g.property({type:Number,json:{write:!0}})],a.prototype,"width",void 0);e([g.property({type:Number,json:{write:!0}})],a.prototype,"height",void 0);e([g.property({type:Number,
json:{write:!0}})],a.prototype,"depth",void 0);e([g.enumeration.serializable()({center:"center",top:"top",bottom:"bottom",origin:"origin"})],a.prototype,"anchor",void 0);e([g.property({type:Number,json:{write:!0}})],a.prototype,"heading",void 0);e([g.property({type:Number,json:{write:!0}})],a.prototype,"tilt",void 0);e([g.property({type:Number,json:{write:!0}})],a.prototype,"roll",void 0);e([g.property({readOnly:!0,dependsOn:["resource","resource.href"]})],a.prototype,"isPrimitive",null);return a=
d=e([g.subclass("esri.symbols.ObjectSymbol3DLayer")],a)}(g.declared(d))})},"esri/symbols/support/ObjectSymbol3DLayerResource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/urlUtils ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});var b=d.strict()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",
diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});m=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}k(d,a);g=d;d.prototype.readHref=function(a,b,c){return h.read(a,c)};d.prototype.writeHref=function(a,b,c,d){a&&(b.href=h.write(a,d),h.isAbsolute(b.href)&&(b.href=h.normalize(b.href)))};d.prototype.clone=function(){return new g({href:this.href,primitive:this.primitive})};var g;e([c.property({type:String,json:{write:!0}})],d.prototype,"href",void 0);e([c.reader("href")],
d.prototype,"readHref",null);e([c.writer("href")],d.prototype,"writeHref",null);e([c.enumeration.serializable()(b)],d.prototype,"primitive",void 0);return d=g=e([c.subclass("esri.symbols.support.ObjectSymbol3DLayerResource")],d)}(c.declared(g));f.ObjectSymbol3DLayerResource=m;f.default=m})},"esri/symbols/PathSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./Symbol3DLayer".split(" "),function(m,
f,k,e,g,d){return function(d){function c(a){a=d.call(this)||this;a.material=null;a.type="path";a.size=void 0;return a}k(c,d);b=c;c.prototype.readSize=function(a,b){return a||b.width||0};c.prototype.clone=function(){return new b({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),material:this.material&&this.material.clone(),size:this.size})};var b;e([g.property()],c.prototype,"material",void 0);e([g.enumeration.serializable()({Path:"path"})],c.prototype,"type",void 0);
e([g.property({type:Number,json:{write:{enabled:!0,target:{size:{type:Number},width:{type:Number}}}}})],c.prototype,"size",void 0);e([g.reader("size",["size","width"])],c.prototype,"readSize",null);return c=b=e([g.subclass("esri.symbols.PathSymbol3DLayer")],c)}(g.declared(d))})},"esri/symbols/Symbol":function(){define(["../core/kebabDictionary","../core/JSONSupport","../Color"],function(m,f,k){m=m({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",
esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d"});var e=0;return f.createSubclass({declaredClass:"esri.symbols.Symbol",constructor:function(){this.id="sym"+e++},properties:{type:{type:String,value:null,json:{read:m.read,write:{ignoreOrigin:!0,writer:m.write}}},color:{type:k,value:new k([0,0,0,1]),json:{read:function(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e},write:{allowNull:!0}}}}})})},
"esri/symbols/TextSymbol3DLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/lang ../core/accessorSupport/decorators ./Font ./Symbol3DLayer ./support/materialUtils ./support/Symbol3DHalo".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){return function(b){function n(a){a=b.call(this)||this;a.font=null;a.halo=null;a.material=null;a.size=9;a.text=void 0;a.type="text";return a}k(n,b);q=n;n.prototype.writeFont=
function(a,b,c,d){c=g({},d,{textSymbol3D:!0});b.font=a.write({},c)};n.prototype.clone=function(){return new q({enabled:this.enabled,elevationInfo:this.elevationInfo&&this.elevationInfo.clone(),font:this.font&&d.clone(this.font),halo:this.halo&&d.clone(this.halo),material:this.material&&this.material.clone(),size:this.size,text:this.text})};var q;e([h.property({type:c,json:{write:!0}})],n.prototype,"font",void 0);e([h.writer("font")],n.prototype,"writeFont",null);e([h.property({type:l.default,json:{write:!0}})],
n.prototype,"halo",void 0);e([h.property()],n.prototype,"material",void 0);e([h.property(a.screenSizeProperty)],n.prototype,"size",void 0);e([h.property({type:String,json:{write:!0}})],n.prototype,"text",void 0);e([h.enumeration.serializable()({Text:"text"})],n.prototype,"type",void 0);return n=q=e([h.subclass("esri.symbols.TextSymbol3DLayer")],n)}(h.declared(b))})},"esri/symbols/Font":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/write".split(" "),
function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this)||this;a.decoration="none";a.family="sans-serif";a.size=9;a.style="normal";a.weight="normal";return a}k(a,b);l=a;a.prototype.castSize=function(a){return d.toPt(a)};a.prototype.clone=function(){return new l({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})};var l;e([h.property({type:["underline","line-through","none"],json:{write:{overridePolicy:c.disableWriteDefaultPolicy("none")}}})],
a.prototype,"decoration",void 0);e([h.property({type:String,json:{write:!0}})],a.prototype,"family",void 0);e([h.property({type:Number,json:{write:{overridePolicy:function(a,b,c){return{enabled:!c||!c.textSymbol3D}}}}})],a.prototype,"size",void 0);e([h.cast("size")],a.prototype,"castSize",null);e([h.property({type:["normal","italic","oblique"],json:{write:{overridePolicy:c.disableWriteDefaultPolicy("normal")}}})],a.prototype,"style",void 0);e([h.property({type:["normal","bold","bolder","lighter"],
json:{write:{overridePolicy:c.disableWriteDefaultPolicy("normal")}}})],a.prototype,"weight",void 0);return a=l=e([h.subclass("esri.symbols.Font")],a)}(h.declared(g))})},"esri/symbols/support/Symbol3DHalo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./materialUtils".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});
m=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.color=new g([0,0,0,1]);b.size=0;return b}k(d,a);n=d;d.prototype.clone=function(){return new n({color:h.clone(this.color),size:this.size})};var n;e([c.property(b.colorAndTransparencyProperty)],d.prototype,"color",void 0);e([c.property(b.screenSizeProperty)],d.prototype,"size",void 0);return d=n=e([c.subclass("esri.symbols.support.Symbol3DHalo")],d)}(c.declared(d));f.Symbol3DHalo=m;f.default=m})},"esri/symbols/support/StyleOrigin":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../portal/Portal".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.portal=null;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})};var a;e([d.property({type:String})],b.prototype,"name",void 0);e([d.property({type:String})],b.prototype,"styleUrl",void 0);e([d.property({type:String})],b.prototype,"styleName",void 0);e([d.property({type:h})],b.prototype,"portal",void 0);
return b=a=e([d.subclass("esri.symbols.support.StyleOrigin")],b)}(d.declared(g))})},"esri/symbols/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function c(){return null!==h&&h.apply(this,arguments)||this}k(c,h);b=c;c.prototype.clone=function(){return new b({url:this.url})};
var b;e([d.property({type:String})],c.prototype,"url",void 0);return c=b=e([d.subclass("esri.symbols.support.Thumbnail")],c)}(d.declared(g));f.Thumbnail=m;f.default=m})},"esri/symbols/callouts/calloutUtils":function(){define(["require","exports","./Callout3D","./LineCallout3D"],function(m,f,k,e){function g(d){if(!d)return!1;d=d.verticalOffset;return!d||0>=d.screenLength||0>=d.maxWorldLength?!1:!0}function d(d,c,b){if(!d)return d;switch(d.type){case "line":return c=new e,c.read(d,b),c}}Object.defineProperty(f,
"__esModule",{value:!0});f.hasVisibleVerticalOffset=g;f.hasVisibleCallout=function(d){if(!d||!d.supportsCallout||!d.supportsCallout())return!1;var c=d.callout;return c&&c.visible?g(d)?!0:!1:!1};f.isCalloutSupport=function(d){return"point-3d"===d.type||"label-3d"===d.type};f.read=d;f.calloutProperty={types:{key:"type",base:k,typeMap:{line:e}},json:{read:d,write:!0}}})},"esri/symbols/callouts/Callout3D":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.visible=!0;return a}e(b,c);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=k({},a),delete a.type);return a};b.prototype.clone=function(){};g([h.property({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],b.prototype,"type",void 0);g([h.property({readOnly:!0})],b.prototype,"visible",void 0);return b=g([h.subclass("esri.symbols.callouts.Callout3D")],b)}(h.declared(d))})},"esri/symbols/callouts/LineCallout3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/screenUtils ../../core/accessorSupport/decorators ./Callout3D ./LineCallout3DBorder ../support/materialUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return function(b){function n(a){a=b.call(this)||this;a.type="line";a.color=new g([0,0,0,1]);a.size=h.px2pt(1);a.border=null;return a}k(n,b);q=n;Object.defineProperty(n.prototype,"visible",{get:function(){return 0<this.size&&0<this.color.a},enumerable:!0,configurable:!0});n.prototype.clone=function(){return new q({color:d.clone(this.color),size:this.size,border:d.clone(this.border)})};var q;e([c.property({type:["line"]})],n.prototype,"type",void 0);e([c.property(l.colorAndTransparencyProperty)],
n.prototype,"color",void 0);e([c.property(l.screenSizeProperty)],n.prototype,"size",void 0);e([c.property({type:a.default,json:{write:!0}})],n.prototype,"border",void 0);e([c.property({dependsOn:["size","color"],readOnly:!0})],n.prototype,"visible",null);return n=q=e([c.subclass("esri.symbols.callouts.LineCallout3D")],n)}(c.declared(b))})},"esri/symbols/callouts/LineCallout3DBorder":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../support/materialUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.color=new g("white");return b}k(d,a);n=d;d.prototype.clone=function(){return new n({color:h.clone(this.color)})};var n;e([c.property(b.colorAndTransparencyProperty)],d.prototype,"color",void 0);return d=n=e([c.subclass("esri.symbols.callouts.LineCallout3DBorder")],d)}(c.declared(d));f.LineCallout3DBorder=m;f.default=m})},"esri/symbols/support/Symbol3DVerticalOffset":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./materialUtils".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.screenLength=0;a.minWorldLength=0;return a}k(b,c);a=b;b.prototype.writeMinWorldLength=function(a,b,c){a&&(b[c]=a)};b.prototype.clone=function(){return new a({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})};var a;e([d.property(h.screenSizeProperty)],b.prototype,"screenLength",void 0);e([d.property({type:Number,
json:{write:!0}})],b.prototype,"minWorldLength",void 0);e([d.writer("minWorldLength")],b.prototype,"writeMinWorldLength",null);e([d.property({type:Number,json:{write:!0}})],b.prototype,"maxWorldLength",void 0);return b=a=e([d.subclass("esri.symbols.support.Symbol3DVerticalOffset")],b)}(d.declared(g));f.Symbol3DVerticalOffset=m;f.default=m})},"esri/symbols/LineSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/lang ../core/accessorSupport/decorators ./LineSymbol3DLayer ./PathSymbol3DLayer ./Symbol3D ./TextSymbol3DLayer".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=g.ofType({base:null,key:"type",typeMap:{line:c,text:l,path:b}});return function(a){function b(b){b=a.call(this)||this;b.symbolLayers=new n;b.type="line-3d";return b}k(b,a);c=b;b.prototype.clone=function(){return new c({styleOrigin:d.clone(this.styleOrigin),symbolLayers:d.clone(this.symbolLayers),thumbnail:d.clone(this.thumbnail)})};var c;e([h.property({type:n})],b.prototype,"symbolLayers",void 0);e([h.enumeration.serializable()({LineSymbol3D:"line-3d"})],b.prototype,
"type",void 0);return b=c=e([h.subclass("esri.symbols.LineSymbol3D")],b)}(h.declared(a))})},"esri/symbols/MeshSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/lang ../core/accessorSupport/decorators ./FillSymbol3DLayer ./Symbol3D".split(" "),function(m,f,k,e,g,d,h,c,b){var a=g.ofType({base:null,key:"type",typeMap:{fill:c}});return function(b){function c(c){c=b.call(this)||this;c.symbolLayers=new a;c.type=
"mesh-3d";return c}k(c,b);l=c;c.prototype.clone=function(){return new l({styleOrigin:d.clone(this.styleOrigin),symbolLayers:d.clone(this.symbolLayers),thumbnail:d.clone(this.thumbnail)})};var l;e([h.property({type:a})],c.prototype,"symbolLayers",void 0);e([h.enumeration.serializable()({MeshSymbol3D:"mesh-3d"})],c.prototype,"type",void 0);return c=l=e([h.subclass("esri.symbols.MeshSymbol3D")],c)}(h.declared(b))})},"esri/symbols/PictureFillSymbol":function(){define(["../core/declare","../core/lang",
"../core/screenUtils","./FillSymbol","./support/urlUtils"],function(m,f,k,e,g){var d={xscale:1,yscale:1,xoffset:0,yoffset:0,width:12,height:12},h=m(e,{declaredClass:"esri.symbols.PictureFillSymbol",properties:{type:"picture-fill",url:g.urlPropertyDefinition,xscale:{value:1,json:{write:!0}},yscale:{value:1,json:{write:!0}},width:{value:12,cast:k.toPt,json:{write:!0}},height:{value:12,cast:k.toPt,json:{write:!0}},xoffset:{value:0,cast:k.toPt,json:{write:!0}},yoffset:{value:0,cast:k.toPt,json:{write:!0}},
source:g.sourcePropertyDefinition},getDefaults:function(){return f.mixin(this.inherited(arguments),d)},normalizeCtorArgs:function(c,b,a,d){if(c&&"string"!==typeof c&&null==c.imageData)return c;var e={};c&&(e.url=c);b&&(e.outline=b);null!=a&&(e.width=k.toPt(a));null!=d&&(e.height=k.toPt(d));return e},clone:function(){var c=new h({color:f.clone(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,
yscale:this.yscale});c._set("source",f.clone(this.source));return c}});h.defaultProps=d;return h})},"esri/symbols/FillSymbol":function(){define(["./Symbol","./SimpleLineSymbol"],function(m,f){return m.createSubclass({declaredClass:"esri.symbols.FillSymbol",properties:{outline:{type:f,json:{read:{default:null},write:!0}},type:null}})})},"esri/symbols/SimpleLineSymbol":function(){define(["../core/declare","../core/lang","../core/screenUtils","./LineSymbol"],function(m,f,k,e){var g={STYLE_SOLID:"solid",
STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dash-dot",STYLE_DASHDOTDOT:"long-dash-dot-dot",STYLE_NULL:"none",STYLE_SHORTDASH:"short-dash",STYLE_SHORTDOT:"short-dot",STYLE_SHORTDASHDOT:"short-dash-dot",STYLE_SHORTDASHDOTDOT:"short-dash-dot-dot",STYLE_LONGDASH:"long-dash",STYLE_LONGDASHDOT:"long-dash-dot",CAP_BUTT:"butt",CAP_ROUND:"round",CAP_SQUARE:"square",JOIN_MITER:"miter",JOIN_ROUND:"round",JOIN_BEVEL:"bevel"},d={color:[0,0,0,1],style:g.STYLE_SOLID,width:.75,cap:g.CAP_ROUND,join:g.JOIN_ROUND,
miterLimit:7.5},h=m(e,{declaredClass:"esri.symbols.SimpleLineSymbol",properties:{type:"simple-line",style:{value:g.STYLE_SOLID,json:{read:function(c,b){return f.valueOf(this._jsonStyles,c)||void 0},write:function(c,b){b.style=this._jsonStyles[c]}}},cap:{value:g.CAP_ROUND,json:{write:{overridePolicy:function(c,b,a){return{enabled:"round"!==c&&(null==a||null==a.origin)}}}}},join:{value:g.JOIN_ROUND,json:{write:{overridePolicy:function(c,b,a){return{enabled:"round"!==c&&(null==a||null==a.origin)}}}}},
miterLimit:{value:7.5,cast:k.toPt,json:{read:!1,write:!1}}},_jsonStyles:{solid:"esriSLSSolid",dash:"esriSLSDash",dot:"esriSLSDot","dash-dot":"esriSLSDashDot","long-dash-dot-dot":"esriSLSDashDotDot",none:"esriSLSNull","inside-frame":"esriSLSInsideFrame","short-dash":"esriSLSShortDash","short-dot":"esriSLSShortDot","short-dash-dot":"esriSLSShortDashDot","short-dash-dot-dot":"esriSLSShortDashDotDot","long-dash":"esriSLSLongDash","long-dash-dot":"esriSLSLongDashDot"},getDefaults:function(){return f.mixin(this.inherited(arguments),
d)},normalizeCtorArgs:function(c,b,a,d,e,h){if(c&&"string"!==typeof c)return c;var l={};null!=c&&(l.style=c);null!=b&&(l.color=b);null!=a&&(l.width=k.toPt(a));null!=d&&(l.cap=d);null!=e&&(l.join=e);null!=h&&(l.miterLimit=k.toPt(h));return l},clone:function(){return new h({color:f.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit})}});f.mixin(h,g);h.defaultProps=d;return h})},"esri/symbols/LineSymbol":function(){define(["../core/declare","../core/screenUtils",
"./Symbol"],function(m,f,k){return m(k,{declaredClass:"esri.symbols.LineSymbol",properties:{color:{},type:"simple-line",width:{value:.75,cast:f.toPt,json:{write:!0}}}})})},"esri/symbols/support/urlUtils":function(){define(["require","exports","../../core/urlUtils"],function(m,f,k){function e(c,b,a){return b.imageData?k.makeData({mediaType:b.contentType||"image/png",isBase64:!0,data:b.imageData}):g(b.url,a)}function g(c,b){return!b||"service"!==b.origin&&"portal-item"!==b.origin||!b.layer||"feature"!==
b.layer.type&&"stream"!==b.layer.type||k.isAbsolute(c)||!b.layer.parsedUrl?k.read(c,b):k.join(b.layer.parsedUrl.path,"images",c)}function d(c,b,a,d){k.isDataProtocol(c)?(c=k.dataComponents(c),b.contentType=c.mediaType,b.imageData=c.data,a&&a.imageData===b.imageData&&a.url&&(b.url=h(a.url,d))):b.url=h(c,d)}function h(c,b){return k.write(c,b)}Object.defineProperty(f,"__esModule",{value:!0});f.readImageDataOrUrl=e;f.read=g;f.writeImageDataAndUrl=d;f.write=h;f.urlPropertyDefinition={json:{read:{source:["imageData",
"url"],reader:e},write:{writer:function(c,b,a,e){d(c,b,this.source,e)}}}};f.sourcePropertyDefinition={readOnly:!0,json:{read:{source:["imageData","url"],reader:function(c,b,a){c={};b.imageData&&(c.imageData=b.imageData);b.contentType&&(c.contentType=b.contentType);b.url&&(c.url=g(b.url,a));return c}}}}})},"esri/symbols/PictureMarkerSymbol":function(){define(["../core/declare","../core/lang","../core/screenUtils","./MarkerSymbol","./support/urlUtils"],function(m,f,k,e,g){var d={width:12,height:12,
angle:0,xoffset:0,yoffset:0},h=m(e,{declaredClass:"esri.symbols.PictureMarkerSymbol",properties:{color:{json:{write:!1}},type:"picture-marker",url:g.urlPropertyDefinition,source:g.sourcePropertyDefinition,height:{json:{read:{source:["height","size"],reader:function(c,b){return b.size||c}},write:!0},cast:k.toPt},width:{json:{read:{source:["width","size"],reader:function(c,b){return b.size||c}},write:!0},cast:k.toPt},size:{json:{write:!1}}},getDefaults:function(){return f.mixin(this.inherited(arguments),
d)},normalizeCtorArgs:function(c,b,a){if(c&&"string"!==typeof c&&null==c.imageData)return c;var d={};c&&(d.url=c);null!=b&&(d.width=k.toPt(b));null!=a&&(d.height=k.toPt(a));return d},clone:function(){var c=new h({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});c._set("source",f.clone(this.source));return c}});h.defaultProps=d;return h})},"esri/symbols/MarkerSymbol":function(){define(["../core/declare","../core/screenUtils","./Symbol"],
function(m,f,k){return m(k,{declaredClass:"esri.symbols.MarkerSymbol",properties:{angle:{value:0,json:{read:function(e){return e&&-1*e},write:function(e,g){g.angle=e&&-1*e}}},type:{},xoffset:{value:0,cast:f.toPt,json:{write:!0}},yoffset:{value:0,cast:f.toPt,json:{write:!0}},size:{value:9,cast:function(e){return"auto"===e?e:f.toPt(e)},json:{write:!0}}}})})},"esri/symbols/PointSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/Error ../core/lang ../core/accessorSupport/decorators ./IconSymbol3DLayer ./ObjectSymbol3DLayer ./Symbol3D ./TextSymbol3DLayer ./callouts/calloutUtils ./support/Symbol3DVerticalOffset".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){var r=g.ofType({base:null,key:"type",typeMap:{icon:b,object:a,text:n}});return function(a){function b(b){b=a.call(this)||this;b.verticalOffset=null;b.callout=null;b.symbolLayers=new r;b.type="point-3d";return b}k(b,a);l=b;b.prototype.writeSymbolLayers=function(a,b,c,e){var l=a.filter(function(a){return"text"!==a.type});e&&e.messages&&l.length<a.length&&(a=a.find(function(a){return"text"===a.type}),e.messages.push(new d("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PointSymbol3D",
{symbolLayer:a})));b[c]=l.map(function(a){return a.write({},e)}).toArray()};b.prototype.supportsCallout=function(){if(1!==(this.symbolLayers?this.symbolLayers.length:0))return!1;switch(this.symbolLayers.getItemAt(0).type){case "icon":case "text":case "object":return!0}return!1};b.prototype.hasVisibleCallout=function(){return p.hasVisibleCallout(this)};b.prototype.hasVisibleVerticalOffset=function(){return p.hasVisibleVerticalOffset(this)};b.prototype.clone=function(){return new l({verticalOffset:h.clone(this.verticalOffset),
callout:h.clone(this.callout),styleOrigin:h.clone(this.styleOrigin),symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail)})};var l;e([c.property({type:q.default,json:{write:!0}})],b.prototype,"verticalOffset",void 0);e([c.property(p.calloutProperty)],b.prototype,"callout",void 0);e([c.property({type:r})],b.prototype,"symbolLayers",void 0);e([c.writer("web-scene","symbolLayers")],b.prototype,"writeSymbolLayers",null);e([c.enumeration.serializable()({PointSymbol3D:"point-3d"})],
b.prototype,"type",void 0);return b=l=e([c.subclass("esri.symbols.PointSymbol3D")],b)}(c.declared(l))})},"esri/symbols/PolygonSymbol3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/Error ../core/lang ../core/accessorSupport/decorators ./ExtrudeSymbol3DLayer ./FillSymbol3DLayer ./IconSymbol3DLayer ./LineSymbol3DLayer ./ObjectSymbol3DLayer ./Symbol3D ./TextSymbol3DLayer".split(" "),function(m,f,k,e,g,d,h,c,b,a,
l,n,p,q,r){var t=g.ofType({base:null,key:"type",typeMap:{extrude:b,fill:a,icon:l,line:n,object:p,text:r}});return function(a){function b(b){b=a.call(this)||this;b.type="polygon-3d";return b}k(b,a);l=b;b.prototype.writeSymbolLayers=function(a,b,c,e){var l=a.filter(function(a){return"text"!==a.type});e&&e.messages&&l.length<a.length&&(a=a.find(function(a){return"text"===a.type}),e.messages.push(new d("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PolygonSymbol3D",{symbolLayer:a})));
b[c]=l.map(function(a){return a.write({},e)}).toArray()};b.prototype.clone=function(){return new l({styleOrigin:h.clone(this.styleOrigin),symbolLayers:h.clone(this.symbolLayers),thumbnail:h.clone(this.thumbnail)})};b.fromJSON=function(a){var b=new l;b.read(a);if(2===b.symbolLayers.length&&"fill"===b.symbolLayers.getItemAt(0).type&&"line"===b.symbolLayers.getItemAt(1).type){var c=b.symbolLayers.getItemAt(0),d=b.symbolLayers.getItemAt(1);!d.enabled||a.symbolLayers&&a.symbolLayers[1]&&!1===a.symbolLayers[1].enable||
(c.outline={size:d.size,color:d.material.color});b.symbolLayers.removeAt(1)}return b};var l;e([c.property({type:t})],b.prototype,"symbolLayers",void 0);e([c.writer("web-scene","symbolLayers")],b.prototype,"writeSymbolLayers",null);e([c.enumeration.serializable()({PolygonSymbol3D:"polygon-3d"})],b.prototype,"type",void 0);return b=l=e([c.subclass("esri.symbols.PolygonSymbol3D")],b)}(c.declared(q))})},"esri/symbols/SimpleFillSymbol":function(){define(["../core/declare","../core/lang","./FillSymbol",
"./SimpleLineSymbol"],function(m,f,k,e){var g={style:"solid",outline:new e,color:[0,0,0,.25]},d=m(k,{declaredClass:"esri.symbols.SimpleFillSymbol",properties:{color:{},type:"simple-fill",style:{value:"solid",type:String,json:{read:function(d){return f.valueOf(this._styles,d)||void 0},write:function(d,c){c.style=this._styles[d]}}}},_styles:{solid:"esriSFSSolid",none:"esriSFSNull",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical","forward-diagonal":"esriSFSForwardDiagonal","backward-diagonal":"esriSFSBackwardDiagonal",
cross:"esriSFSCross","diagonal-cross":"esriSFSDiagonalCross"},getDefaults:function(){return f.mixin(this.inherited(arguments),g)},normalizeCtorArgs:function(d,c,b){if(d&&"string"!==typeof d)return d;var a={};d&&(a.style=d);c&&(a.outline=c);b&&(a.color=b);return a},clone:function(){return new d({color:f.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}});f.mixin(d,{STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forward-diagonal",
STYLE_BACKWARD_DIAGONAL:"backward-diagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonal-cross"});d.defaultProps=g;return d})},"esri/symbols/SimpleMarkerSymbol":function(){define("../core/declare ../core/lang ../core/screenUtils ./MarkerSymbol ./SimpleLineSymbol ./support/simpleMarkerStyles".split(" "),function(m,f,k,e,g,d){var h={style:"circle",color:[255,255,255,.25],outline:new g,size:12,angle:0,xoffset:0,yoffset:0},c=m(e,{declaredClass:"esri.symbols.SimpleMarkerSymbol",properties:{color:{json:{write:function(b,
a){b&&"x"!==this.style&&"cross"!==this.style&&(a.color=b.toJSON())}}},type:"simple-marker",size:{value:12},style:{type:String,value:"circle",json:{read:function(b){return f.valueOf(this._styles,b)},write:function(b,a){a.style=this._styles[b]}}},path:{type:String,value:null,set:function(b){this.style="path";this._set("path",b)},json:{write:!0}},outline:{type:g,json:{write:!0}}},_styles:{circle:"esriSMSCircle",square:"esriSMSSquare",cross:"esriSMSCross",x:"esriSMSX",diamond:"esriSMSDiamond",triangle:"esriSMSTriangle",
path:"esriSMSPath"},getDefaults:function(){return f.mixin(this.inherited(arguments),h)},normalizeCtorArgs:function(b,a,c,d){if(b&&"string"!==typeof b)return b;var e={};b&&(e.style=b);null!=a&&(e.size=k.toPt(a));c&&(e.outline=c);d&&(e.color=d);return e},clone:function(){return new c({angle:this.angle,color:f.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})},read:function a(c,d){return this.getInherited(a,
arguments).call(this,f.mixin({outline:null},c),d)}});f.mixin(c,d);c.defaultProps=h;return c})},"esri/symbols/support/simpleMarkerStyles":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.STYLE_CIRCLE="circle";f.STYLE_SQUARE="square";f.STYLE_CROSS="cross";f.STYLE_X="x";f.STYLE_DIAMOND="diamond";f.STYLE_PATH="path";f.STYLE_TARGET="target"})},"esri/symbols/TextSymbol":function(){define("../core/declare ../core/lang ../core/screenUtils ../Color ./Symbol ./Font".split(" "),
function(m,f,k,e,g,d){var h={text:"",rotated:!1,kerning:!0,color:[0,0,0,1],font:{},angle:0,xoffset:0,yoffset:0,horizontalAlignment:"center"},c=m(g,{declaredClass:"esri.symbols.TextSymbol",properties:{backgroundColor:{type:e,json:{write:!0}},borderLineColor:{type:e,json:{write:!0}},borderLineSize:{type:Number,json:{write:!0}},color:{},font:{type:d,json:{write:!0}},horizontalAlignment:{value:"center",json:{write:!0}},kerning:{value:!0,json:{write:!0}},haloColor:{type:e,json:{write:!0}},haloSize:{type:Number,
cast:k.toPt,json:{write:!0}},rightToLeft:{json:{write:!0}},rotated:{value:!1,json:{write:!0}},text:{type:String,json:{write:!0}},type:"text",verticalAlignment:{type:String,json:{write:!0}},xoffset:{value:0,type:Number,cast:k.toPt,json:{write:!0}},yoffset:{value:0,type:Number,cast:k.toPt,json:{write:!0}},angle:{type:Number,value:0,json:{read:function(b){return b&&-1*b},write:function(b,a){a.angle=b&&-1*b}}},width:{json:{write:!0}}},getDefaults:function(){return f.mixin(this.inherited(arguments),h)},
normalizeCtorArgs:function(b,a,c){if(b&&"string"!==typeof b)return b;var d={};b&&(d.text=b);a&&(d.font=a);c&&(d.color=c);return d},clone:function(){return new c({angle:this.angle,backgroundColor:f.clone(this.backgroundColor),borderLineColor:f.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:f.clone(this.color),font:this.font&&this.font.clone(),haloColor:f.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,rightToLeft:this.rightToLeft,
rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}});f.mixin(c,{ALIGN_START:"start",ALIGN_MIDDLE:"middle",ALIGN_END:"end",DECORATION_NONE:"none",DECORATION_UNDERLINE:"underline",DECORATION_OVERLINE:"overline",DECORATION_LINETHROUGH:"line-through"});c.defaultProps=h;return c})},"esri/symbols/WebStyleSymbol":function(){define("require exports ../core/tsSupport/extendsHelper ../core/tsSupport/decorateHelper ../core/kebabDictionary ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../portal/Portal ./Symbol ./support/Thumbnail".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p=d.getLogger("esri.symbols.WebStyleSymbol"),q=g.strict()({styleSymbolReference:"web-style"});return function(d){function l(a){a=d.call(this,a)||this;a.styleName=null;a.portal=null;a.styleUrl=null;a.thumbnail=null;a.name=null;a.type="web-style";return a}k(l,d);g=l;l.prototype._readStyleUrl=function(a,b,d){return c.read(a,d)};l.prototype._writeStyleUrl=function(a,b,d,e){b.styleUrl=c.write(a,e);c.isAbsolute(b.styleUrl)&&(b.styleUrl=c.normalize(b.styleUrl))};l.prototype.read=
function(a,b){this.portal=b?b.portal:void 0;this.inherited(arguments,[a,b]);return this};l.prototype.clone=function(){return new g({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})};l.prototype.fetchSymbol=function(){var a=this;return h.create(function(a){return m(["./support/styleUtils"],a)}).then(function(b){b=b.resolveWebStyleSymbol(a,{portal:a.portal});b.catch(function(a){p.error("#fetchSymbol()","Failed to create symbol from style",a)});return b})};var g;e([b.property({json:{write:!1}})],
l.prototype,"color",void 0);e([b.property({type:String,json:{write:!0}})],l.prototype,"styleName",void 0);e([b.property({type:a,json:{write:!1}})],l.prototype,"portal",void 0);e([b.property({type:String,json:{write:!0}})],l.prototype,"styleUrl",void 0);e([b.reader("styleUrl")],l.prototype,"_readStyleUrl",null);e([b.writer("styleUrl")],l.prototype,"_writeStyleUrl",null);e([b.property({type:n.default,json:{read:!1}})],l.prototype,"thumbnail",void 0);e([b.property({type:String,json:{write:!0}})],l.prototype,
"name",void 0);e([b.property({type:q.apiValues,readOnly:!0,json:{type:q.jsonValues,read:!1,write:q.write}})],l.prototype,"type",void 0);return l=g=e([b.subclass("esri.symbols.WebStyleSymbol")],l)}(b.declared(l))})},"esri/symbols/support/symbolConversion":function(){define("require exports ../../Color ../../symbols ../../core/Error ../../core/lang ../Font ./simpleMarkerStyles".split(" "),function(m,f,k,e,g,d,h,c){function b(b){var c=b.color?b.color.clone():new k([255,255,255]),d,l,h;b instanceof e.PictureMarkerSymbol?
(b.color&&0===b.color.r&&0===b.color.g&&0===b.color.b&&(c=new k([255,255,255])),d={href:b.url},l=b.width<=b.height?b.height:b.width):(d=b.style,d in a?d=a[d]:(console.log(d+' cannot be mapped to Icon symbol. Fallback to "circle"'),d="circle"),d={primitive:d},l=b.size,b.outline&&0<b.outline.width&&(h={size:b.outline.width,color:b.outline.color?b.outline.color.clone():[255,255,255]}));return new e.PointSymbol3D(new e.IconSymbol3DLayer({size:l,resource:d,material:{color:c},outline:h}))}Object.defineProperty(f,
"__esModule",{value:!0});var a={};a[c.STYLE_CIRCLE]="circle";a[c.STYLE_CROSS]="cross";a[c.STYLE_DIAMOND]="kite";a[c.STYLE_SQUARE]="square";a[c.STYLE_X]="x";f.to3D=function(a,c,k,q){void 0===c&&(c=!1);void 0===k&&(k=!1);void 0===q&&(q=!0);if(!a)return{symbol:null};if(e.isSymbol3D(a)||a instanceof e.WebStyleSymbol)q=a.clone();else if(a instanceof e.SimpleLineSymbol)q=new e.LineSymbol3D(new e.LineSymbol3DLayer({size:a.width||1,material:{color:a.color?a.color.clone():[255,255,255]}}));else if(a instanceof
e.SimpleMarkerSymbol)q=b(a);else if(a instanceof e.PictureMarkerSymbol)q=b(a);else if(a instanceof e.SimpleFillSymbol)q=new e.FillSymbol3DLayer({material:{color:a.color?a.color.clone():[255,255,255,0]}}),a.outline&&(q.outline={size:a.outline.width||0,color:a.outline.color?a.outline.color.clone():[255,255,255]}),q=new e.PolygonSymbol3D(q);else if(a instanceof e.TextSymbol){var l;l=a.haloColor;var n=a.haloSize;l=l&&0<n?{color:d.clone(l),size:n}:null;n=a.font?a.font.clone():new h;q=new (q?e.LabelSymbol3D:
e.PointSymbol3D)(new e.TextSymbol3DLayer({size:n.size,font:n,halo:l,material:{color:a.color.clone()},text:a.text}))}else return{error:new g("symbol-conversion:unsupported-2d-symbol","2D symbol of type '"+(a.type||a.declaredClass)+"' is unsupported in 3D",{symbol:a})};c&&(q.id=a.id);if(k&&e.isSymbol3D(q))for(a=0;a<q.symbolLayers.length;++a)q.symbolLayers.getItemAt(a)._ignoreDrivers=!0;return{symbol:q}}})},"esri/symbols":function(){define("require exports ./symbols/ExtrudeSymbol3DLayer ./symbols/FillSymbol ./symbols/FillSymbol3DLayer ./symbols/Font ./symbols/IconSymbol3DLayer ./symbols/LabelSymbol3D ./symbols/LineSymbol3D ./symbols/LineSymbol3DLayer ./symbols/MarkerSymbol ./symbols/MeshSymbol3D ./symbols/ObjectSymbol3DLayer ./symbols/PathSymbol3DLayer ./symbols/PictureFillSymbol ./symbols/PictureMarkerSymbol ./symbols/PointSymbol3D ./symbols/PolygonSymbol3D ./symbols/SimpleFillSymbol ./symbols/SimpleLineSymbol ./symbols/SimpleMarkerSymbol ./symbols/Symbol ./symbols/Symbol3D ./symbols/Symbol3DLayer ./symbols/TextSymbol ./symbols/TextSymbol3DLayer ./symbols/WebStyleSymbol ./symbols/callouts/LineCallout3D ./symbols/callouts/LineCallout3DBorder ./symbols/support/Symbol3DVerticalOffset ./symbols/support/jsonUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I){Object.defineProperty(f,"__esModule",{value:!0});f.ExtrudeSymbol3DLayer=k;f.BaseFillSymbol=e;f.FillSymbol3DLayer=g;f.Font=d;f.IconSymbol3DLayer=h;f.LabelSymbol3D=c;f.LineSymbol3D=b;f.LineSymbol3DLayer=a;f.BaseMarkerSymbol=l;f.MeshSymbol3D=n;f.ObjectSymbol3DLayer=p;f.PathSymbol3DLayer=q;f.PictureFillSymbol=r;f.PictureMarkerSymbol=t;f.PointSymbol3D=w;f.PolygonSymbol3D=u;f.SimpleFillSymbol=x;f.SimpleLineSymbol=v;f.SimpleMarkerSymbol=
z;f.BaseSymbol=y;f.BaseSymbol3D=A;f.BaseSymbol3DLayer=B;f.TextSymbol=C;f.TextSymbol3DLayer=E;f.WebStyleSymbol=D;f.LineCallout3D=F;f.LineCallout3DBorder=M;f.Symbol3DVerticalOffset=N.Symbol3DVerticalOffset;f.fromJSON=I.fromJSON;f.isSymbol=function(a){return a instanceof f.BaseSymbol};f.isSymbol2D=function(a){if(!a)return!1;switch(a.type){case "picture-fill":case "picture-marker":case "simple-fill":case "simple-line":case "simple-marker":case "text":return!0;default:return!1}};f.isSymbol3D=function(a){if(!a)return!1;
switch(a.type){case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return!0;default:return!1}}})},"esri/symbols/support/typeUtils":function(){define("require exports ../../core/accessorSupport/ensureType ../LabelSymbol3D ../LineSymbol3D ../MeshSymbol3D ../PictureFillSymbol ../PictureMarkerSymbol ../PointSymbol3D ../PolygonSymbol3D ../SimpleFillSymbol ../SimpleLineSymbol ../SimpleMarkerSymbol ../Symbol ../TextSymbol ../WebStyleSymbol".split(" "),function(m,f,k,e,g,d,h,c,
b,a,l,n,p,q,r,t){Object.defineProperty(f,"__esModule",{value:!0});f.types={base:q,key:"type",typeMap:{"simple-fill":l,"picture-fill":h,"picture-marker":c,"simple-line":n,"simple-marker":p,text:r,"label-3d":e,"line-3d":g,"mesh-3d":d,"point-3d":b,"polygon-3d":a,"web-style":t}};f.rendererTypes={base:q,key:"type",typeMap:{"simple-fill":l,"picture-fill":h,"picture-marker":c,"simple-line":n,"simple-marker":p,text:r,"line-3d":g,"mesh-3d":d,"point-3d":b,"polygon-3d":a,"web-style":t}};f.labelTypes={base:q,
key:"type",typeMap:{text:r,"label-3d":e}};f.types3D={base:q,key:"type",typeMap:{"label-3d":e,"line-3d":g,"mesh-3d":d,"point-3d":b,"polygon-3d":a,"web-style":t}};f.rendererTypes3D={base:q,key:"type",typeMap:{"line-3d":g,"mesh-3d":d,"point-3d":b,"polygon-3d":a,"web-style":t}};f.labelTypes3D={base:q,key:"type",typeMap:{"label-3d":e}};f.ensureType=k.ensureOneOfType(f.types)})},"esri/layers/graphics/controllers/support/controllerUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,
"__esModule",{value:!0});f.isRefreshable=function(k){return k&&k.refresh}})},"esri/layers/graphics/sources/MemorySource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry ../../../Graphic ../../../core/Accessor ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/kebabDictionary ../../../core/Loadable ../../../core/Logger ../../../core/requireUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/typescript ../../../tasks/support/FeatureSet module".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v){function z(a){var b=a.geometry;a=a.attributes;return{geometry:b&&"mesh"!==b.type?b&&b.toJSON():null,attributes:a}}Object.defineProperty(f,"__esModule",{value:!0});var y=l({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),A=p.getLogger("esri.layers.graphics.sources.MemorySource");h=function(c){function l(){return null!==c&&c.apply(this,arguments)||
this}k(l,c);l.prototype.load=function(){var b=this;this.addResolvingPromise(r.open(q.getAbsMid("./support/MemorySourceWorker",m,v),{client:this,strategy:a("esri-workers-for-memory-layers")?"dedicated":"local"}).then(function(a){b._connection=a;var c=b.layer,d=c.fields,e=c.spatialReference,l=c.geometryType,h=c.objectIdField,g=c.hasM,c=c.hasZ;return a.invoke("load",{features:b.items.map(z),fields:d&&d.map(function(a){return a.toJSON()}),geometryType:y.toJSON(l),hasM:g,hasZ:c,objectIdField:h,spatialReference:e&&
e.toJSON()}).then(function(a){a.featureErrors.length&&A.warn("Encountered "+a.featureErrors.length+" validation errors while loading features",a.featureErrors);b.layerDefinition=a.layerDefinition})}));return this.when()};l.prototype.applyEdits=function(a){var b=this;return this.load().then(function(){return b._applyEdits(a)})};l.prototype.openPorts=function(){var a=this;return this.load().then(function(){return a._connection.openPorts()})};l.prototype.queryFeatures=function(a){return this.queryFeaturesJSON(a).then(function(a){return x.fromJSON(a)})};
l.prototype.queryFeaturesJSON=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatures",a?a.toJSON():null)})};l.prototype.queryFeatureCount=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatureCount",a?a.toJSON():null)})};l.prototype.queryObjectIds=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryObjectIds",a?a.toJSON():null)})};l.prototype.queryExtent=function(a){var b=
this;return this.load().then(function(){return b._connection.invoke("queryExtent",a?a.toJSON():null)}).then(function(a){return{count:a.count,extent:g.Extent.fromJSON(a.extent)}})};l.prototype._applyEdits=function(a){var c=this;if(!this._connection)throw new b("feature-layer-source:edit-failure","Memory source not loaded");var d=this.layer.objectIdField,e=[],l=[],h=[];if(a.addFeatures)for(var g=0,n=a.addFeatures;g<n.length;g++){var k=n[g];e.push(z(k))}if(a.deleteFeatures)for(k=0,g=a.deleteFeatures;k<
g.length;k++)n=g[k],"objectId"in n&&null!=n.objectId?l.push(n.objectId):"attributes"in n&&null!=n.attributes[d]&&l.push(n.attributes[d]);if(a.updateFeatures)for(d=0,a=a.updateFeatures;d<a.length;d++)k=a[d],h.push(z(k));return this._connection.invoke("applyEdits",{adds:e,updates:h,deletes:l}).then(function(a){var b=a.featureEditResults;c.fullExtent=a.fullExtent;return c._createEditsResult(b)})};l.prototype._createEditsResult=function(a){return{addFeatureResults:a.addResults?a.addResults.map(this._createFeatureEditResult,
this):[],updateFeatureResults:a.updateResults?a.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:a.deleteResults?a.deleteResults.map(this._createFeatureEditResult,this):[]}};l.prototype._createFeatureEditResult=function(a){var c=!0===a.success?null:a.error||{code:void 0,description:void 0};return{objectId:a.objectId,globalId:a.globalId,error:c?new b("feature-layer-source:edit-failure",c.description,{code:c.code}):null}};e([u.shared({Type:d,ensureType:w.ensureType(d)})],
l.prototype,"itemType",void 0);e([t.property({constructOnly:!0})],l.prototype,"layer",void 0);e([t.property()],l.prototype,"layerDefinition",void 0);return l=e([t.subclass("esri.layers.graphics.sources.MemorySource")],l)}(t.declared(h,c,n));f.MemorySource=h;f.default=h})},"esri/core/workers":function(){define(["require","exports","./workers/workers"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});for(var e in k)f.hasOwnProperty(e)||(f[e]=k[e])})},"esri/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(){if(t)return t;for(var a=l+n,c=[],d=function(a){var d=b.create(a).then(function(b){return r[a]=b});c.push(d)},h=0;h<a;h++)d(h);return t=e(c).then(function(){})}Object.defineProperty(f,"__esModule",{value:!0});f.Connection=h;f.RemoteClient=c;(h=k("host-browser")?navigator.hardwareConcurrency:0)||(h=k("safari")&&k("mac")||k("trident")?8:2);var l=k("esri-workers-debug")?1:Math.max(1,Math.ceil(h/2)),n=k("esri-workers-debug")?1:Math.max(1,Math.floor(h/2)),p=g.getLogger("esri.core.workers"),
q=0,r=[];f.initialize=function(){a()};f.open=function(b,c,e){void 0===c&&(c={});if(Array.isArray(b))return new f.Connection(b.map(function(a){return new f.RemoteClient(a,c.client)}));if("string"!==typeof b){p.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var h=b;b=c;c={client:h,strategy:e?"dedicated":"distributed"}}var g=c.strategy||"distributed";return"local"===g?d.create(function(a){m([b],function(b){a(f.RemoteClient.connect(b))})}).then(function(a){return new f.Connection([new f.RemoteClient(a,
c.client)])}):a().then(function(){if("dedicated"===g){var a=l+q++;q%=n;return r[a].open(b).then(function(a){return new f.Connection([new f.RemoteClient(a,c.client)])})}return d.all(r.map(function(a){return a.open(b)})).then(function(a){return new f.Connection(a.map(function(a){return new f.RemoteClient(a,c.client)}))})})};f.terminate=function(){t&&(t.cancel(),t=null);for(var a=0;a<r.length;a++)r[a]&&r[a].terminate();r.length=0};var t=null})},"esri/core/workers/Connection":function(){define(["require",
"exports","../promiseUtils"],function(m,f,k){return function(){function e(e){this._clientIdx=0;this._clients=e}e.prototype.broadcast=function(e,d){for(var h=[],c=0,b=this._clients;c<b.length;c++)h.push(b[c].invoke(e,d));return h};e.prototype.close=function(){for(var e=0,d=this._clients;e<d.length;e++)d[e].close();this._clients=[]};e.prototype.invoke=function(e,d,h,c){var b=c&&c.client;if(!this._clients||!this._clients.length)return k.reject(Error("Connection closed"));null!=b&&-1!==this._clients.indexOf(b)||
this._clients.some(function(a){return a.isBusy()?!1:(b=a,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,b=this._clients[this._clientIdx]);e=b.invoke(e,d,h);c&&(c.client=b);return e};e.prototype.openPorts=function(){return k.all(this._clients.map(function(e){return e.openPort()}))};return e}()})},"esri/core/workers/RemoteClient":function(){define(["require","exports","../Error","../promiseUtils","./utils"],function(m,f,k,e,g){function d(a,b){a["delete"](b)}var h=g.MessageType.CLOSE,
c=g.MessageType.CANCEL,b=g.MessageType.INVOKE,a=g.MessageType.RESPONSE,l=g.MessageType.OPEN_PORT,n=function(){function a(a){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=[];this._invoke=a;this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a){a.type===g.MessageType.CANCEL?this._cancelledJobIds.add(a.jobId):(this._invokeMessages.push(a),null===this._timer&&(this._timer=setTimeout(this._process,0)))};a.prototype.clear=function(){this._invokeMessages.length=
0;this._cancelledJobIds.clear();this._timer=null};a.prototype._process=function(){this._timer=null;for(var a=0,b=this._invokeMessages;a<b.length;a++){var c=b[a];this._cancelledJobIds.has(c.jobId)||this._invoke(c)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return a}();return function(){function p(a,b,c){this._outJobs=new Map;this._inJobs=new Map;this._queue=new n(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=b;this._port=a;this._port.addEventListener("message",
this._onMessage);this._port.start();this._channel=c}p.connect=function(a){var b=new MessageChannel;a="function"===typeof a?new a:"default"in a&&"function"===typeof a.default?new a.default:a;a.remoteClient=new p(b.port1,a,b);return b.port2};p.prototype.close=function(){this._post({type:h});this._close()};p.prototype.isBusy=function(){return 0<this._outJobs.size};p.prototype.invoke=function(a,l,h){var n=this;if(!this._port)return e.reject(new k("remote-client:port-closed","Can't invoke(), port is closed"));
var p=g.newJobId(),q=function(){d(n._outJobs,p);n._post({type:c,jobId:p})};return e.create(function(c,d){n._outJobs.set(p,{resolve:c,reject:d,cancel:q});n._post({type:b,jobId:p,methodName:a},l,h)},q)};p.prototype.openPort=function(){var a=this,b=g.newJobId(),h=function(){d(a._outJobs,b);a._post({type:c,jobId:b})};return e.create(function(c,d){a._outJobs.set(b,{resolve:c,reject:d,cancel:h});a._post({type:l,jobId:b})},h)};p.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",
this._onMessage);this._port.close();this._outJobs.forEach(function(a){a.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};p.prototype._onMessage=function(d){if(d=g.receiveMessage(d))switch(d.type){case a:this._onResponse(d);break;case b:this._queue.push(d);break;case c:this._onCancel(d);break;case h:this._close();break;case l:this._onOpenPort(d)}};p.prototype._onCancel=function(a){var b=this._inJobs,c=a.jobId,e=b.get(c);this._queue.push(a);e&&
(d(b,c),e.cancel())};p.prototype._onInvoke=function(b){var c=this,l=b.methodName,h=b.jobId;b=b.data;var n=this._inJobs,k=this._client,p=k[l],q;try{if(!p&&l&&-1!==l.indexOf("."))for(var f=l.split("."),m=0;m<f.length-1;m++)k=k[f[m]],p=k[f[m+1]];if("function"!==typeof p)throw new TypeError(l+" is not a function");q=p.call(k,b,this)}catch(B){this._post({type:a,jobId:h,error:g.toInvokeError(B)});return}e.isThenable(q)?(n.set(h,q),q.then(function(b){n.has(h)&&(d(n,h),c._post({type:a,jobId:h},b))}).catch(function(b){n.has(h)&&
(d(n,h),b&&"cancel"===b.dojoType||c._post({type:a,jobId:h,error:g.toInvokeError(b||{message:"Error encountered at method "+l})}))})):this._post({type:a,jobId:h},q)};p.prototype._onOpenPort=function(b){var c=new MessageChannel;new p(c.port1,this._client);this._post({type:a,jobId:b.jobId},c.port2,[c.port2])};p.prototype._onResponse=function(a){var b=a.jobId,c=a.error;a=a.data;var e=this._outJobs;if(e.has(b)){var l=e.get(b);d(e,b);c?l.reject(k.fromJSON(JSON.parse(c))):l.resolve(a)}};p.prototype._post=
function(a,b,c){return g.postMessage(this._port,a,b,c)};return p}()})},"esri/core/workers/utils":function(){define(["require","exports","dojo/has"],function(m,f,k){function e(d){return d&&"object"===typeof d&&("result"in d||"transferList"in d)}function g(d){return d instanceof ArrayBuffer||d&&d.constructor&&"ArrayBuffer"===d.constructor.name}Object.defineProperty(f,"__esModule",{value:!0});(function(d){d[d.HANDSHAKE=0]="HANDSHAKE";d[d.CONFIGURE=1]="CONFIGURE";d[d.CONFIGURED=2]="CONFIGURED";d[d.OPEN=
3]="OPEN";d[d.OPENED=4]="OPENED";d[d.RESPONSE=5]="RESPONSE";d[d.INVOKE=6]="INVOKE";d[d.CANCEL=7]="CANCEL";d[d.CLOSE=8]="CLOSE";d[d.OPEN_PORT=9]="OPEN_PORT"})(f.MessageType||(f.MessageType={}));var d=0;f.newJobId=function(){return d++};f.isTranferableResult=e;f.toInvokeError=function(d){return d?d.toJSON?JSON.stringify(d):JSON.stringify({name:d.name,message:d.message,details:d.details,stack:d.stack}):null};f.postMessage=function(d,c,b,a){2===arguments.length||void 0===b&&void 0===a?d.postMessage(c):
(k("esri-workers-arraybuffer-transfer")||(a?(a=a.filter(function(a){return!g(a)}),a.length||(a=null)):e(b)&&b.transferList&&(b.transferList=b.transferList.filter(function(a){return!g(a)}),b.transferList.length||(b.transferList=null))),a?(c.data=b,d.postMessage(c,a)):e(b)?(c.data=b.result,b.transferList?d.postMessage(c,b.transferList):d.postMessage(c)):(c.data=b,d.postMessage(c)))};f.receiveMessage=function(d){return d?(d=d.data)?"string"===typeof d?JSON.parse(d):d:null:null}})},"esri/core/workers/WorkerOwner":function(){define("require exports ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),
function(m,f,k,e,g,d,h,c){var b=g.getLogger("esri.core.workers"),a=h.MessageType.CANCEL,l=h.MessageType.INVOKE,n=h.MessageType.OPEN,p=h.MessageType.OPENED,q=h.MessageType.RESPONSE;return function(){function g(a,c){this._outJobs=new Map;this._inJobs=new Map;this.worker=a;this.id=c;a.addEventListener("message",this._onMessage.bind(this));a.addEventListener("error",function(a){a.preventDefault();b.error(a)})}g.create=function(a){return c.createWorker().then(function(b){return new g(b,a)})};g.prototype.terminate=
function(){this.worker.terminate()};g.prototype.open=function(b){var c=this,e=h.newJobId(),l=function(){c._outJobs["delete"](e);c._post({type:a,jobId:e})};return d.create(function(a,d){c._outJobs.set(e,{resolve:a,reject:d,cancel:l});c._post({type:n,jobId:e,modulePath:b})},l)};g.prototype._onMessage=function(b){if(b=h.receiveMessage(b))switch(b.type){case p:case q:this._onResponse(b);break;case a:this._onCancel(b);break;case l:this._onInvoke(b)}};g.prototype._onCancel=function(a){(a=this._inJobs.get(a.jobId))&&
a.cancel()};g.prototype._onInvoke=function(a){var b=this,c=a.methodName,e=a.jobId;a=a.data;var l=this._inJobs,g=k.workerMessages[c],n;try{if("function"!==typeof g)throw new TypeError(c+" is not a function");n=g.call(null,a)}catch(A){this._post({type:q,jobId:e,error:h.toInvokeError(A)});return}d.isThenable(n)?(l.set(e,n),n.then(function(a){l["delete"](e);b._post({type:q,jobId:e},a)}).catch(function(a){l["delete"](e);a||(a={message:"Error encountered at method"+c});a.dojoType&&"cancel"===a.dojoType||
b._post({type:q,jobId:e,error:h.toInvokeError(a)})})):this._post({type:q,jobId:e},n)};g.prototype._onResponse=function(a){var b=a.jobId,c=a.error;a=a.data;var d=this._outJobs.get(b);d&&(this._outJobs["delete"](b),c?d.reject(e.fromJSON(JSON.parse(c))):d.resolve(a))};g.prototype._post=function(a,b,c){return h.postMessage(this.worker,a,b,c)};return g}()})},"esri/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../has ../Logger ../promiseUtils ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(a){return b.create(function(b){function c(p){if(p=n.receiveMessage(p))switch(p.type){case z:p=a;var q=g.workers.loaderUrl||l.DEFAULT_LOADER_URL,f;null!=g["default"]?(f=k({},g),delete f["default"],f=JSON.parse(JSON.stringify(f))):f=JSON.parse(JSON.stringify(g));var r=g.workers.loaderConfig,r=l.default({baseUrl:r.baseUrl,locale:e.locale,has:k({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-secure-context":h("esri-secure-context"),"esri-workers-arraybuffer-transfer":h("esri-workers-arraybuffer-transfer"),
"events-keypress-typed":0,"host-webworker":1},r.has),map:k({},r.map),paths:k({},r.paths),packages:r.packages||[]});p.postMessage({type:v,configure:{esriConfig:f,loaderUrl:q,loaderConfig:r}});break;case x:a.removeEventListener("message",c),a.removeEventListener("error",d),b(a)}}function d(b){b.preventDefault();a.removeEventListener("message",c);a.removeEventListener("error",d);w.warn("Failed to create Worker. Fallback to execute module in main thread",b);a=new p;a.addEventListener("message",c);a.addEventListener("error",
d)}a.addEventListener("message",c);a.addEventListener("error",d)})}Object.defineProperty(f,"__esModule",{value:!0});var r=a.normalize(m.toUrl("./worker.js")),t=!a.hasSameOrigin(r,location.href),w=c.getLogger("esri.core.workers"),u=null;h.add("esri-workers-arraybuffer-transfer",!h("safari")||12<=h("safari"));var x=n.MessageType.CONFIGURED,v=n.MessageType.CONFIGURE,z=n.MessageType.HANDSHAKE;f.createWorker=function(){if(!h("esri-workers"))return q(new p);if(!t){var a=void 0;try{a=new Worker(r)}catch(A){w.warn("Failed to create Worker. Fallback to execute module in main thread",
event),a=new p}return q(a)}u||(u=d(r,{responseType:"text"}));return u.then(function(a){return new Worker(URL.createObjectURL(new Blob([a.data],{type:"text/javascript"})))}).catch(function(a){w.warn("Failed to create Worker. Fallback to execute module in main thread",a);return new p}).then(function(a){return q(a)})}})},"esri/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",
{value:!0});e=e("esri-built")?"dojo/dojo-lite.js":"dojo/dojo.js";f.DEFAULT_LOADER_URL=g.makeAbsolute(g.removeQueryParameters(m.toUrl(e)));f.DEFAULT_CONFIG={baseUrl:function(){var d=g.removeQueryParameters(m.toUrl("dojo/x.js"));return g.makeAbsolute(d.slice(0,d.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},
{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};f.default=function(d){var e={async:d.async,isDebug:d.isDebug,locale:d.locale,baseUrl:d.baseUrl,has:k({},d.has),map:k({},d.map),packages:d.packages&&d.packages.concat()||
[],paths:k({},d.paths)};d.hasOwnProperty("async")||(e.async=!0);d.hasOwnProperty("isDebug")||(e.isDebug=!1);d.baseUrl||(e.baseUrl=f.DEFAULT_CONFIG.baseUrl);f.DEFAULT_CONFIG.packages.forEach(function(a){a:{for(var b=e.packages,c=0;c<b.length;c++)if(b[c].name===a.name)break a;a=k({},a);c=g.removeQueryParameters(m.toUrl(a.name+"/x.js"));c=c.slice(0,c.length-5);a.location=g.makeAbsolute(c);b.push(a)}});d=e.map=e.map||{};for(var c=0,b=Object.keys(f.DEFAULT_CONFIG.map);c<b.length;c++){var a=b[c];d[a]||
(d[a]=f.DEFAULT_CONFIG.map[a])}return e}})},"esri/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(m,f,k,e,g){var d=function(){return function(){var b=this,a=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(c){b[c]=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];return a[c].apply(a,b)}})}}(),h=e.MutationObserver||e.WebKitMutationObserver,c=function(){var b;
if(e.process&&e.process.nextTick)b=function(a){e.process.nextTick(a)};else if(e.Promise)b=function(a){e.Promise.resolve().then(a)};else if(h){var a=[],c=document.createElement("div");(new h(function(){for(;0<a.length;)a.shift()()})).observe(c,{attributes:!0});b=function(b){a.push(b);c.setAttribute("queueStatus","1")}}return b}();return function(){function b(){this._dispatcher=new d;this._isInitialized=!1;this._workerPostMessage({type:g.MessageType.HANDSHAKE})}b.prototype.terminate=function(){};Object.defineProperty(b.prototype,
"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,
configurable:!0});b.prototype.postMessage=function(a,b){var d=this;c(function(){d._workerMessageHandler(new MessageEvent("message",{data:a}))})};b.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};b.prototype.addEventListener=function(a,b,c){this._dispatcher.addEventListener(a,b,c)};b.prototype.removeEventListener=function(a,b,c){this._dispatcher.removeEventListener(a,b,c)};b.prototype._workerPostMessage=function(a,b){var d=this;c(function(){d.dispatchEvent(new MessageEvent("message",
{data:a}))})};b.prototype._workerMessageHandler=function(a){var b=this;if(a=g.receiveMessage(a)){var c=a.jobId;switch(a.type){case g.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:g.MessageType.CONFIGURED});break;case g.MessageType.OPEN:m(["esri/core/workers/RemoteClient",a.modulePath],function(a,d){a=a.connect(d);b._workerPostMessage({type:g.MessageType.OPENED,jobId:c,data:a})})}}};return b}()})},"esri/core/accessorSupport/typescript":function(){define(["../declare","../typescript",
"../JSONSupport","../lang"],function(m,f,k,e){function g(d,e){if(!d)return e;if(!e)return d;for(var c in e){var b=d[c],a=e[c];Array.isArray(a)&&Array.isArray(b)?d[c]=b.concat(a):d[c]="object"===typeof a&&"object"===typeof b?g(b,a):a}return d}return{subclass:function(d,h){return function(c){c=f.declareDefinition(c,d);b&&(c.instanceMembers.properties=g(b,c.instanceMembers.properties));var b=c.instanceMembers.properties;if(b)for(var a in b){var l=b[a];l&&!l.reader&&l.type&&(l.type===Date?l.reader=function(a){return null!=
a?new Date(a):null}:-1!==l.type._meta.bases.indexOf(k)&&(l.reader=function(a){return function(b){return a.fromJSON(b)}}(l.type)))}return e.mixin(m(c.bases,c.instanceMembers),c.classMembers)}},shared:f.shared,property:function(d){return function(e,c){var b=Object.getPrototypeOf(e),b=b&&b.properties;e.properties&&e.properties!==b||(e.properties={});e.properties=e.properties||{};e.properties[c]=d||{}}}}})},"esri/core/typescript":function(){define(["./declare","./lang"],function(m,f){var k={declareDefinition:function(e,
g){var d=[],h=Object.getPrototypeOf(e.prototype),c;if(h!==Object.prototype){var b=h.constructor;c=b.prototype;d.push(b)}g&&(d=d.concat(g));g={};for(var b=Object.getOwnPropertyNames(e.prototype),a=0;a<b.length;a++){var l=b[a];if("constructor"!==l){var n=l;"dojoConstructor"===l&&(n="constructor");c&&e.prototype[l]===c[l]||(g[n]=e.prototype[l])}}b=Object.getOwnPropertyNames(e);h=Object.getOwnPropertyNames(h.constructor);c={};for(a=0;a<b.length;a++)l=b[a],-1===h.indexOf(l)&&(c[l]=e[l]);return{bases:d,
instanceMembers:g,classMembers:c}},subclass:function(e){return function(g){g=k.declareDefinition(g,e);return f.mixin(m(g.bases,g.instanceMembers),g.classMembers)}},shared:function(e){return function(g,d){g[d]=e}}};return k})},"esri/tasks/support/FeatureSet":function(){define("../../core/kebabDictionary ../../core/JSONSupport ../../core/lang ../../Graphic ../../layers/support/Field ../../geometry/SpatialReference ../../geometry/support/graphicsUtils ../../geometry/support/jsonUtils".split(" "),function(m,
f,k,e,g,d,h,c){m=m({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"});return f.createSubclass({declaredClass:"esri.tasks.support.FeatureSet",getDefaults:function(){return k.mixin(this.inherited(arguments),{features:[]})},properties:{displayFieldName:null,exceededTransferLimit:null,features:{value:null,json:{read:function(b,a){for(var c=d.fromJSON(a.spatialReference),h=[],g=0;g<b.length;g++){var k=
b[g],f=e.fromJSON(k),k=k.geometry&&k.geometry.spatialReference;f.geometry&&!k&&(f.geometry.spatialReference=c);h.push(f)}a.transform&&this._hydrate(a.transform,a.geometryType,h);return h}}},fields:{value:null,type:[g]},geometryType:{value:null,json:{read:m.read}},spatialReference:{type:d}},toJSON:function(b){var a={hasZ:this.hasZ,hasM:this.hasM};this.displayFieldName&&(a.displayFieldName=this.displayFieldName);this.fields&&(a.fields=this.fields.map(function(a){return a.toJSON()}));this.spatialReference?
a.spatialReference=this.spatialReference.toJSON():this.features[0]&&this.features[0].geometry&&(a.spatialReference=this.features[0].geometry.spatialReference.toJSON());this.features[0]&&(this.features[0].geometry&&(a.geometryType=c.getJsonType(this.features[0].geometry)),a.features=h._encodeGraphics(this.features,b));a.exceededTransferLimit=this.exceededTransferLimit;a.transform=this.transform;return k.fixJson(a)},quantize:function(b){var a=b.translate[0],c=b.translate[1],d=b.scale[0],e=b.scale[1],
h=this.features,g=function(a,b,c){var d,e,l,h,g,n,k=[];d=0;for(e=a.length;d<e;d++)if(l=a[d],0<d){if(n=b(l[0]),l=c(l[1]),n!==h||l!==g)k.push([n-h,l-g]),h=n,g=l}else h=b(l[0]),g=c(l[1]),k.push([h,g]);return 0<k.length?k:null},k=function(a,b,c){if("point"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("polyline"===a||"polygon"===a)return function(a){var d,e,l,h,n;l=a.rings||a.paths;n=[];d=0;for(e=l.length;d<e;d++)h=l[d],(h=g(h,b,c))&&n.push(h);return 0<n.length?(a.rings?a.rings=n:a.paths=
n,a):null};if("multipoint"===a)return function(a){var d;d=g(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("extent"===a)return function(a){return a}}(this.geometryType,function(b){return Math.round((b-a)/d)},function(a){return Math.round((c-a)/e)}),f,m;f=0;for(m=h.length;f<m;f++)k(h[f].geometry)||(h.splice(f,1),f--,m--);this.transform=b;return this},_hydrate:function(b,a,c){if(b){var d=b.translate[0],e=b.translate[1],l=b.scale[0],h=b.scale[1],g=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=
b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,e,l,h,g,n,k,p;d=0;for(e=a.length;d<e;d++)for(g=a[d],l=0,h=g.length;l<h;l++)n=g[l],0<l?(k+=n[0],p+=n[1]):(k=n[0],p=n[1]),n[0]=b(k),n[1]=c(p)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,e,l,h,g;d=0;for(e=a.length;d<e;d++)l=a[d],0<d?(h+=l[0],
g+=l[1]):(h=l[0],g=l[1]),l[0]=b(h),l[1]=c(g)}}(a,function(a){return a*l+d},function(a){return e-a*h});b=0;for(a=c.length;b<a;b++)c[b].geometry&&g(c[b].geometry)}}})})},"esri/layers/support/Field":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./domains ./fieldType".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this)||this;a.alias=null;a.defaultValue=
void 0;a.domain=null;a.editable=!0;a.length=-1;a.name=null;a.nullable=!0;a.type=null;return a}k(a,b);l=a;a.prototype.clone=function(){return new l({alias:this.alias,defaultValue:this.defaultValue,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type})};var l;e([d.property({type:String,json:{write:!0}})],a.prototype,"alias",void 0);e([d.property({json:{write:{allowNull:!0}}})],a.prototype,"defaultValue",void 0);
e([d.property({types:h.types,json:{read:{reader:h.fromJSON},write:!0}})],a.prototype,"domain",void 0);e([d.property({type:Boolean,json:{write:!0}})],a.prototype,"editable",void 0);e([d.property({type:Number,json:{write:!0}})],a.prototype,"length",void 0);e([d.property({type:String,json:{write:!0}})],a.prototype,"name",void 0);e([d.property({type:Boolean,json:{write:!0}})],a.prototype,"nullable",void 0);e([d.property({type:String,json:{read:c.kebabDict.read,write:c.kebabDict.write}})],a.prototype,
"type",void 0);return a=l=e([d.subclass("esri.layers.support.Field")],a)}(d.declared(g))})},"esri/layers/support/domains":function(){define("require exports ./CodedValueDomain ./Domain ./InheritedDomain ./RangeDomain".split(" "),function(m,f,k,e,g,d){function h(b,a){switch(b.type){case "range":var d="range"in b?b.range[1]:b.maxValue;if(+a<("range"in b?b.range[0]:b.minValue)||+a>d)return c.VALUE_OUT_OF_RANGE;break;case "coded-value":case "codedValue":if(null==b.codedValues||b.codedValues.every(function(b){return null==
b||b.code!==a}))return c.INVALID_CODED_VALUE}return null}Object.defineProperty(f,"__esModule",{value:!0});f.CodedValueDomain=k;f.DomainBase=e;f.InheritedDomain=g;f.RangeDomain=d;var c;(function(b){b.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range";b.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(c=f.DomainValidationError||(f.DomainValidationError={}));f.isValidDomainValue=function(b,a){return null===h(b,a)};f.validateDomainValue=h;f.types={key:"type",base:f.DomainBase,
typeMap:{range:f.RangeDomain,"coded-value":f.CodedValueDomain}};f.getDomainRange=function(b){if(b&&"range"===b.type)return{min:"range"in b?b.range[0]:b.minValue,max:"range"in b?b.range[1]:b.maxValue}};f.fromJSON=function(b){if(b&&b.type){if("range"===b.type)return f.RangeDomain.fromJSON(b);if("codedValue"===b.type)return f.CodedValueDomain.fromJSON(b)}return null}})},"esri/layers/support/CodedValueDomain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/lang ../../core/accessorSupport/decorators ./Domain".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,a)||this;a.codedValues=null;a.type="coded-value";return a}k(b,c);a=b;b.prototype.writeCodedValues=function(a,b){var c=null;a&&(c=a.map(function(a){return g.fixJson(g.clone(a))}));b.codedValues=c};b.prototype.getName=function(a){var b=null;if(this.codedValues){var c=String(a);this.codedValues.some(function(a){String(a.code)===c&&(b=a.name);return!!b})}return b};b.prototype.clone=function(){return new a({codedValues:g.clone(this.codedValues),
name:this.name})};var a;e([d.property({json:{write:!0}})],b.prototype,"codedValues",void 0);e([d.writer("codedValues")],b.prototype,"writeCodedValues",null);e([d.enumeration.serializable()({codedValue:"coded-value"})],b.prototype,"type",void 0);return b=a=e([d.subclass("esri.layers.support.CodedValueDomain")],b)}(d.declared(h))})},"esri/layers/support/Domain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){var c=d({inherited:"inherited",codedValue:"coded-value",range:"range"});return function(b){function a(a){a=b.call(this,a)||this;a.name=null;a.type=null;return a}k(a,b);e([h.property({json:{write:!0}})],a.prototype,"name",void 0);e([h.property({json:{read:c.read,write:c.write}})],a.prototype,"type",void 0);return a=e([h.subclass("esri.layers.support.Domain")],a)}(h.declared(g))})},"esri/layers/support/InheritedDomain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Domain".split(" "),
function(m,f,k,e,g,d){return function(d){function c(a){a=d.call(this,a)||this;a.type="inherited";return a}k(c,d);b=c;c.prototype.clone=function(){return new b};var b;e([g.enumeration.serializable()({inherited:"inherited"})],c.prototype,"type",void 0);return c=b=e([g.subclass("esri.layers.support.InheritedDomain")],c)}(g.declared(d))})},"esri/layers/support/RangeDomain":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Domain".split(" "),
function(m,f,k,e,g,d){return function(d){function c(a){a=d.call(this,a)||this;a.maxValue=null;a.minValue=null;a.type="range";return a}k(c,d);b=c;c.prototype.clone=function(){return new b({maxValue:this.maxValue,minValue:this.minValue,name:this.name})};var b;e([g.property({json:{read:{source:"range",reader:function(a,b){return b.range&&b.range[1]}},write:{target:"range",writer:function(a,b,c){b[c]=[this.minValue,a]}}}})],c.prototype,"maxValue",void 0);e([g.property({json:{read:{source:"range",reader:function(a,
b){return b.range&&b.range[0]}},write:{target:"range",writer:function(a,b,c){b[c]=[a,this.maxValue]}}}})],c.prototype,"minValue",void 0);e([g.enumeration.serializable()({range:"range"})],c.prototype,"type",void 0);return c=b=e([g.subclass("esri.layers.support.RangeDomain")],c)}(g.declared(d))})},"esri/layers/support/fieldType":function(){define(["require","exports","../../core/kebabDictionary"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.kebabDict=k({esriFieldTypeSmallInteger:"small-integer",
esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})})},"esri/geometry/support/graphicsUtils":function(){define(["require","exports","../../core/Collection","../Extent"],function(m,f,k,e){Object.defineProperty(f,
"__esModule",{value:!0});f.graphicsExtent=function(g){if(!g||!g.length)return null;var d=k.isCollection(g)?g.getItemAt(0).geometry:g[0].geometry,h=d.extent,c=d;null===h&&(h=new e(c.x,c.y,c.x,c.y,d.spatialReference));for(var b=1;b<g.length;b++){var c=d=k.isCollection(g)?g.getItemAt(b).geometry:g[b].geometry,a=d.extent;null===a&&(a=new e(c.x,c.y,c.x,c.y,d.spatialReference));h=h.clone().union(a)}return 0>h.width&&0>h.height?null:h};f.getGeometries=function(e){return e.map(function(d){return d.geometry})};
f._encodeGraphics=function(e,d){var h=[];e.forEach(function(c,b){c=c.toJSON();var a={};if(c.geometry){var e=d&&d[b];a.geometry=e&&e.toJSON()||c.geometry}c.attributes&&(a.attributes=c.attributes);h[b]=a});return h}})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/QueryEngine ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/stats ./support/projectExtentUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){return function(q){function f(a){a=q.call(this)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.supportsDraping=!0;a.overlayUpdating=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._queryEngine=null;a._controllerCreated=!1;a._controllerClientSideFiltering=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;return a}k(f,q);f.prototype.initialize=function(){var a=
this;this._set("graphics3d",new r({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}}));this.handles.add([this.watch("asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.asyncUpdates=b}),this.watch("suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=
b})]);this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return w.toViewIfLocal(a)}).then(function(b){a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()}));this.notifyChange("updating")};f.prototype.destroy=function(){this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",
null));this.loadedGraphics=null};Object.defineProperty(f.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});f.prototype.getRenderingInfo=function(a){if((a=p.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};f.prototype.getGraphicFromGraphicUid=function(a){var b=this,d=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(c){c.uid===
a&&(d=l.hydrateGraphic(c,b.layer))});return c.create(function(a,b){null!==d?a(d):b()})};Object.defineProperty(f.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"graphics3DGraphicsKeys",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsKeys:null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"symbolUpdateType",
{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});f.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};f.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};f.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};f.prototype.queryFeatureCount=
function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};f.prototype.queryExtent=function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};f.prototype.highlight=function(a,b){return this.graphics3d.highlight(a,b,this.layer.objectIdField)};f.prototype.getStats=function(){var a=t.stats(this,this.graphics3d.graphicsCore);a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;
a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};f.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};f.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready)||this.graphics3d.updating};f.prototype.initializeController=function(){return d(this,
void 0,void 0,function(){var a;return g(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};f.prototype.setControllerWhenInitialized=function(a){return d(this,void 0,void 0,function(){return g(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.when()];case 1:return c.sent(),[3,3];case 2:return c.sent(),[3,3];case 3:return this._controllerCreated=
!0,this.notifyChange("updating"),this.isResolved()?[4,b.whenTrueOnce(this.view,"basemapTerrain.ready")]:[2];case 4:return c.sent(),this.controller=a,this.loadedGraphics=a.graphics,this._queryEngine=new n({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})};f.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "memory":case "stream":return!1;
case "snapshot":if(this._controllerClientSideFiltering)return!1;this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0):this.controller.extent=a;return!0;case "feature-tile-3d":return this.controller.extent=a,!0}};f.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return c.reject(new h("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};
f.prototype._rejectQuery=function(){return c.reject(new h("featurelayerview3d:query","Not ready to execute query"))};e([a.property()],f.prototype,"loadedGraphics",void 0);e([a.property({dependsOn:["graphics3d.suspended"]})],f.prototype,"suspended",void 0);e([a.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],f.prototype,"updating",void 0);e([a.property()],f.prototype,"controller",void 0);e([a.property()],f.prototype,"graphics3d",void 0);e([a.property({readOnly:!0})],
f.prototype,"asyncGraphicsUpdates",void 0);e([a.property({readOnly:!0})],f.prototype,"suspendResumeExtentMode",void 0);e([a.property({type:Boolean})],f.prototype,"slicePlaneEnabled",void 0);e([a.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],f.prototype,"hasDraped",void 0);e([a.property({readOnly:!0,type:Boolean})],f.prototype,"supportsDraping",void 0);e([a.property({type:Boolean})],f.prototype,"overlayUpdating",void 0);e([a.property()],f.prototype,"drawingOrder",null);return f=e([a.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],
f)}(a.declared(q))})},"esri/layers/graphics/dehydratedFeatures":function(){define("require exports ../../Graphic ../../core/lang ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ./dehydratedFeatureComparison".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a){switch(a){case "esriGeometryPoint":return"point";case "esriGeometryMultipoint":return"multipoint";case "esriGeometryPolyline":return"polyline";
case "esriGeometryPolygon":return"polygon";case "esriGeometryEnvelope":return"extent"}}function l(a,b,c,d){return{uid:k.generateUID(),objectId:d&&a.attributes?a.attributes[d]:null,attributes:a.attributes,geometry:n(a.geometry,b,c),visible:!0}}function n(a,b,c){if(!a)return null;switch(b){case "point":return a={x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:b,spatialReference:c};case "polyline":return a={paths:a.paths,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c};case "polygon":return a=
{rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c};case "multipoint":return a={points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c};case "extent":return a={xmin:a.xmin,ymin:a.ymin,zmin:a.zmin,mmin:a.mmin,xmax:a.xmax,ymax:a.ymax,zmax:a.zmax,mmax:a.mmax,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c}}}function p(a){return"declaredClass"in a}function q(a){var b=a.spatialReference.toJSON();switch(a.type){case "point":return{x:a.x,y:a.y,z:a.z,m:a.m,spatialReference:b};
case "polygon":var c=a.hasZ,d=a.hasM;return{rings:a.rings,hasZ:c,hasM:d,spatialReference:b};case "polyline":var e=a.paths,c=a.hasZ,d=a.hasM;return{paths:e,hasZ:c,hasM:d,spatialReference:b};case "extent":var e=a.xmin,l=a.xmax,h=a.ymin,g=a.ymax,k=a.zmin,n=a.zmax,p=a.mmin,q=a.mmax,c=a.hasZ,d=a.hasM;return{xmin:e,xmax:l,ymin:h,ymax:g,zmin:k,zmax:n,mmin:p,mmax:q,hasZ:c,hasM:d,spatialReference:b};case "multipoint":return e=a.points,c=a.hasZ,d=a.hasM,{points:e,hasZ:c,hasM:d,spatialReference:b}}}function r(a,
b){d.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=b[3]=a.x;b[1]=b[4]=a.y;a.hasZ&&(b[2]=b[5]=a.z);break;case "polyline":for(var c=0;c<a.paths.length;c++)d.expandWithNestedArray(b,a.paths[c],a.hasZ);break;case "polygon":for(c=0;c<a.rings.length;c++)d.expandWithNestedArray(b,a.rings[c],a.hasZ);break;case "multipoint":d.expandWithNestedArray(b,a.points,a.hasZ);break;case "extent":b[0]=a.xmin,b[1]=a.ymin,b[3]=a.xmax,b[4]=a.ymax,null!=a.zmin&&(b[2]=a.zmin),null!=a.zmax&&(b[5]=
a.zmax)}}function t(a,b){h.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=b[2]=a.x;b[1]=b[3]=a.y;break;case "polyline":for(var c=0;c<a.paths.length;c++)h.expandWithNestedArray(b,a.paths[c]);break;case "polygon":for(c=0;c<a.rings.length;c++)h.expandWithNestedArray(b,a.rings[c]);break;case "multipoint":h.expandWithNestedArray(b,a.points);break;case "extent":b[0]=a.xmin,b[1]=a.ymin,b[2]=a.xmax,b[3]=a.ymax}}Object.defineProperty(f,"__esModule",{value:!0});f.equals=b.equals;f.isPoint=
function(a){return"point"===a.type};f.mapJSONGeometryType=a;f.fromFeatureSetJSON=function(b){var d=a(b.geometryType),e=g.fromJSON(b.spatialReference),h=b.transform;return b.features.map(function(a){a=l(a,d,e,b.objectIdFieldName);var g=a.geometry;if(g&&h)switch(g.type){case "point":a.geometry=c.hydratePoint(h,g,g,g.hasZ,g.hasM);break;case "multipoint":a.geometry=c.hydrateMultipoint(h,g,g,g.hasZ,g.hasM);break;case "polygon":a.geometry=c.hydratePolygon(h,g,g,g.hasZ,g.hasM);break;case "polyline":a.geometry=
c.hydratePolyline(h,g,g,g.hasZ,g.hasM)}return a})};f.fromJSON=l;f.fromJSONGeometry=n;f.makeDehydratedPoint=function(a,b,c,d){return{x:a,y:b,z:c,hasZ:null!=c,hasM:!1,spatialReference:d,type:"point"}};f.isHydratedGeometry=function(a){return"declaredClass"in a};f.isHydratedGraphic=p;f.hydrateGraphic=function(a,b){if(!a||p(a))return a;b=new k({layer:b,sourceLayer:b});b.visible=a.visible;b.symbol=e.clone(a.symbol);b.attributes=e.clone(a.attributes);a.geometry&&("mesh"===a.geometry.type?b.geometry=a.geometry:
b.read({geometry:q(a.geometry)}));return b};f.computeAABB=r;f.expandAABB=function(a,b){r(a,w);d.expand(b,w)};f.computeAABR=t;f.expandAABR=function(a,b){t(a,u);h.expand(b,u)};var w=d.create(),u=h.create()})},"esri/geometry/support/aaBoundingBox":function(){define(["require","exports","../Extent","./aaBoundingRect"],function(m,f,k,e){function g(a){void 0===a&&(a=f.ZERO);return[a[0],a[1],a[2],a[3],a[4],a[5]]}function d(a){return a[0]>=a[3]?0:a[3]-a[0]}function h(a){return a[1]>=a[4]?0:a[4]-a[1]}function c(a){return a[2]>=
a[5]?0:a[5]-a[2]}function b(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a}function a(a){return 6===a.length}Object.defineProperty(f,"__esModule",{value:!0});f.create=g;f.fromValues=function(a,b,c,d,e,h){return[a,b,c,d,e,h]};f.fromExtent=function(a,b){void 0===b&&(b=g());b[0]=a.xmin;b[1]=a.ymin;b[2]=a.zmin;b[3]=a.xmax;b[4]=a.ymax;b[5]=a.zmax;return b};f.toExtent=function(a,b){return isFinite(a[2])||isFinite(a[5])?new k({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],
zmax:a[5],spatialReference:b}):new k({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:b})};f.fromMinMax=function(a,b,c){void 0===c&&(c=g());c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=b[0];c[4]=b[1];c[5]=b[2];return c};f.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[3]&&(a[3]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[4]&&(a[4]=b[1]);b[2]<a[2]&&(a[2]=b[2]);b[2]>a[5]&&(a[5]=b[2])};f.expand=function(b,c,d){void 0===d&&(d=b);a(c)?(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[2]=Math.min(b[2],
c[2]),d[3]=Math.max(b[3],c[3]),d[4]=Math.max(b[4],c[4]),d[5]=Math.max(b[5],c[5])):e.is(c)?(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[3]=Math.max(b[3],c[2]),d[4]=Math.max(b[4],c[3])):2===c.length?(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[3]=Math.max(b[3],c[0]),d[4]=Math.max(b[4],c[1])):3===c.length&&(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[2]=Math.min(b[2],c[2]),d[3]=Math.max(b[3],c[0]),d[4]=Math.max(b[4],c[1]),d[5]=Math.max(b[5],c[2]));return d};f.expandWithBuffer=
function(a,b,c,d,e){void 0===e&&(e=a);var h=a[0],l=a[1],g=a[2],k=a[3],n=a[4];a=a[5];for(var p=0;p<d;p++)h=Math.min(h,b[c+3*p]),l=Math.min(l,b[c+3*p+1]),g=Math.min(g,b[c+3*p+2]),k=Math.max(k,b[c+3*p]),n=Math.max(n,b[c+3*p+1]),a=Math.max(a,b[c+3*p+2]);e[0]=h;e[1]=l;e[2]=g;e[3]=k;e[4]=n;e[5]=a;return e};f.expandWithNestedArray=function(a,b,c,d){void 0===d&&(d=a);var e=b.length,h=a[0],l=a[1],g=a[2],k=a[3],n=a[4];a=a[5];if(c)for(c=0;c<e;c++){var p=b[c],h=Math.min(h,p[0]),l=Math.min(l,p[1]),g=Math.min(g,
p[2]),k=Math.max(k,p[0]),n=Math.max(n,p[1]);a=Math.max(a,p[2])}else for(c=0;c<e;c++)p=b[c],h=Math.min(h,p[0]),l=Math.min(l,p[1]),k=Math.max(k,p[0]),n=Math.max(n,p[1]);d[0]=h;d[1]=l;d[2]=g;d[3]=k;d[4]=n;d[5]=a;return d};f.allFinite=function(a){for(var b=0;6>b;b++)if(!isFinite(a[b]))return!1;return!0};f.width=d;f.depth=h;f.height=c;f.diameter=function(a){var b=d(a),e=c(a);a=h(a);return Math.sqrt(b*b+e*e+a*a)};f.center=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=a[0]+d(a)/2;b[1]=a[1]+h(a)/2;b[2]=a[2]+
c(a)/2;return b};f.size=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=d(a);b[1]=h(a);b[2]=c(a);return b};f.maximumDimension=function(a){return Math.max(d(a),c(a),h(a))};f.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[0]<=a[3]&&b[1]<=a[4]&&b[2]<=a[5]};f.containsPointWithMargin=function(a,b,c){return b[0]>=a[0]-c&&b[1]>=a[1]-c&&b[2]>=a[2]-c&&b[0]<=a[3]+c&&b[1]<=a[4]+c&&b[2]<=a[5]+c};f.contains=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[3]<=a[3]&&b[4]<=a[4]&&b[5]<=
a[5]};f.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[3],a[3])&&Math.max(b[1],a[1])<=Math.min(b[4],a[4])&&Math.max(b[2],a[2])<=Math.min(b[5],a[5])};f.offset=function(a,b,c,d,e){void 0===e&&(e=a);e[0]=a[0]+b;e[1]=a[1]+c;e[2]=a[2]+d;e[3]=a[3]+b;e[4]=a[4]+c;e[5]=a[5]+d;return e};f.setMin=function(a,b,c){void 0===c&&(c=a);c[0]=b[0];c[1]=b[1];c[2]=b[2];c!==a&&(c[3]=a[3],c[4]=a[4],c[5]=a[5]);return c};f.setMax=function(a,b,c){void 0===c&&(c=a);c[3]=b[0];c[4]=b[1];c[5]=b[2];c!==a&&(c[0]=
a[0],c[1]=a[1],c[2]=a[2]);return a};f.set=b;f.empty=function(a){return a?b(a,f.NEGATIVE_INFINITY):g(f.NEGATIVE_INFINITY)};f.toRect=function(a,b){b||(b=e.create());b[0]=a[0];b[1]=a[1];b[2]=a[3];b[3]=a[4];return b};f.fromRect=function(a,b){a[0]=b[0];a[1]=b[1];a[3]=b[2];a[4]=b[3];return a};f.is=a;f.isPoint=function(a){return 0===d(a)&&0===h(a)&&0===c(a)};f.equals=function(b,c,d){if(null==b||null==c)return b===c;if(!a(b)||!a(c))return!1;if(d)for(var e=0;e<b.length;e++){if(!d(b[e],c[e]))return!1}else for(e=
0;e<b.length;e++)if(b[e]!==c[e])return!1;return!0};f.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];f.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];f.ZERO=[0,0,0,0,0,0]})},"esri/geometry/support/quantizationUtils":function(){define(["require","exports"],function(m,f){function k(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function e(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function g(a,b,c){for(var d=[],h,l,g,n,p=0;p<
c.length;p++){var q=c[p];if(0<p){if(g=k(a,q[0]),n=e(a,q[1]),g!==h||n!==l)d.push(b(q,g-h,n-l)),h=g,l=n}else h=k(a,q[0]),l=e(a,q[1]),d.push(b(q,h,l))}return 0<d.length?d:null}function d(a,b,c,d){return g(a,c?d?v:x:d?x:u,b)}function h(a,b,c,d){var e=[];c=c?d?v:x:d?x:u;for(d=0;d<b.length;d++){var h=g(a,c,b[d]);h&&3<=h.length&&e.push(h)}return e.length?e:null}function c(a,b,c,d){var e=[];c=c?d?v:x:d?x:u;for(d=0;d<b.length;d++){var h=g(a,c,b[d]);h&&2<=h.length&&e.push(h)}return e.length?e:null}function b(a,
b){return b*a.scale[0]+a.translate[0]}function a(a,b){return a.translate[1]-b*a.scale[1]}function l(c,d,e){var h=Array(e.length);if(!e.length)return h;var l=c.scale,g=l[0],l=l[1],k=b(c,e[0][0]);c=a(c,e[0][1]);h[0]=d(e[0],k,c);for(var n=1;n<e.length;n++){var p=e[n],k=k+p[0]*g;c-=p[1]*l;h[n]=d(p,k,c)}return h}function n(a,b,c){for(var d=Array(c.length),e=0;e<c.length;e++)d[e]=l(a,b,c[e]);return d}function p(a,b,c,d){return l(a,c?d?v:x:d?x:u,b)}function q(a,b,c,d){return n(a,c?d?v:x:d?x:u,b)}function r(a,
b,c,d){return n(a,c?d?v:x:d?x:u,b)}function t(a,b,c){var d=c[0],e=d[0],d=d[1],h=Math.min(e,b[0]),l=Math.min(d,b[1]),g=Math.max(e,b[2]);b=Math.max(d,b[3]);for(var k=1;k<c.length;k++){var n=c[k],p=n[0],n=n[1],e=e+p,d=d+n;0>p&&(h=Math.min(h,e));0<p&&(g=Math.max(g,e));0>n?l=Math.min(l,d):0<n&&(b=Math.max(b,d))}a[0]=h;a[1]=l;a[2]=g;a[3]=b;return a}function w(a,b){if(!b.length)return null;a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var c=0;c<b.length;c++)t(a,a,b[c]);return a}
Object.defineProperty(f,"__esModule",{value:!0});var u=function(a,b,c){return[b,c]},x=function(a,b,c){return[b,c,a[2]]},v=function(a,b,c){return[b,c,a[2],a[3]]};f.toTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:null};f.equals=function(a,b){if(a===b||null==a&&null==b)return!0;if(null==a||null==b)return!1;var c,d,e,h;a&&"upperLeft"===a.originPosition?(c=a.translate[0],d=a.translate[1],a=a.scale[0]):(c=a.extent.xmin,
d=a.extent.ymax,a=a.tolerance);b&&"upperLeft"===b.originPosition?(e=b.translate[0],h=b.translate[1],b=b.scale[0]):(e=b.extent.xmin,h=b.extent.ymax,b=b.tolerance);return c===e&&d===h&&a===b};f.quantizeX=k;f.quantizeY=e;f.quantizeBounds=function(a,b,c){b[0]=k(a,c[0]);b[3]=e(a,c[1]);b[2]=k(a,c[2]);b[1]=e(a,c[3]);return b};f.quantizePoints=d;f.quantizeRings=h;f.quantizePaths=c;f.hydrateX=b;f.hydrateY=a;f.hydrateCoordsArray=l;f.hydrateCoordsArrayArray=n;f.hydrateBounds=function(c,d,e){return e?(d[0]=b(c,
e[0]),d[1]=a(c,e[3]),d[2]=b(c,e[2]),d[3]=a(c,e[1]),d):[b(c,d[0]),a(c,d[3]),b(c,d[2]),a(c,d[1])]};f.hydratePoints=p;f.hydratePaths=q;f.hydrateRings=r;f.getQuantizedBoundsCoordsArray=t;f.getQuantizedBoundsCoordsArrayArray=w;f.getQuantizedBoundsPoints=function(a){var b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return t(b,b,a)};f.getQuantizedBoundsPaths=function(a){return w([0,0,0,0],a)};f.getQuantizedBoundsRings=function(a){return w([0,0,0,
0],a)};f.quantizeExtent=function(a,b,c,d,h){b.xmin=k(a,c.xmin);b.ymin=e(a,c.ymin);b.xmax=k(a,c.xmax);b.ymax=e(a,c.ymax);b!==c&&(d&&(b.zmin=c.zmin,b.zmax=c.zmax),h&&(b.mmin=c.mmin,b.mmax=c.mmax));return b};f.quantizeMultipoint=function(a,b,c,e,h){b.points=d(a,c.points,e,h);return b};f.quantizePoint=function(a,b,c,d,h){b.x=k(a,c.x);b.y=e(a,c.y);b!==c&&(d&&(b.z=c.z),h&&(b.m=c.m));return b};f.quantizePolygon=function(a,b,c,d,e){a=h(a,c.rings,d,e);if(!a)return null;b.rings=a;return b};f.quantizePolyline=
function(a,b,d,e,h){a=c(a,d.paths,e,h);if(!a)return null;b.paths=a;return b};f.hydrateExtent=function(c,d,e,h,l){d.xmin=b(c,e.xmin);d.ymin=a(c,e.ymin);d.xmax=b(c,e.xmax);d.ymax=a(c,e.ymax);d!==e&&(h&&(d.zmin=e.zmin,d.zmax=e.zmax),l&&(d.mmin=e.mmin,d.mmax=e.mmax));return d};f.hydrateMultipoint=function(a,b,c,d,e){b.points=p(a,c.points,d,e);return b};f.hydratePoint=function(c,d,e,h,l){d.x=b(c,e.x);d.y=a(c,e.y);d!==e&&(h&&(d.z=e.z),l&&(d.m=e.m));return d};f.hydratePolygon=function(a,b,c,d,e){b.rings=
r(a,c.rings,d,e);return b};f.hydratePolyline=function(a,b,c,d,e){b.paths=q(a,c.paths,d,e);return b}})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["require","exports"],function(m,f){function k(c,b){if(c===b)return!0;if(null==c||null==b||c.length!==b.length)return!1;for(var a=0;a<c.length;a++){var d=c[a],e=b[a];if(d.length!==e.length)return!1;for(var h=0;h<d.length;h++)if(d[h]!==e[h])return!1}return!0}function e(c,b){if(c===b)return!0;if(null==c||null==b||c.length!==b.length)return!1;
for(var a=0;a<c.length;a++)if(!k(c[a],b[a]))return!1;return!0}function g(c,b){return c===b||c&&b&&c.equals(b)}function d(c,b){if(c===b)return!0;if(!c||!b||c.type!==b.type)return!1;switch(c.type){case "point":return g(c.spatialReference,b.spatialReference)?c.x===b.x&&c.y===b.y&&c.z===b.z&&c.m===b.m:!1;case "extent":return c.hasZ===b.hasZ&&c.hasM===b.hasM&&g(c.spatialReference,b.spatialReference)?c.xmin===b.xmin&&c.ymin===b.ymin&&c.zmin===b.zmin&&c.xmax===b.xmax&&c.ymax===b.ymax&&c.zmax===b.zmax:!1;
case "polyline":return c.hasZ===b.hasZ&&c.hasM===b.hasM&&g(c.spatialReference,b.spatialReference)?e(c.paths,b.paths):!1;case "polygon":return c.hasZ===b.hasZ&&c.hasM===b.hasM&&g(c.spatialReference,b.spatialReference)?e(c.rings,b.rings):!1;case "multipoint":return c.hasZ===b.hasZ&&c.hasM===b.hasM&&g(c.spatialReference,b.spatialReference)?k(c.points,b.points):!1;case "mesh":return!1}}function h(c,b){if(c===b)return!0;if(!c||!b)return!1;for(var a in c)if(!(a in b)||c[a]!==b[a])return!1;for(a in b)if(!(a in
c))return!1;return!0}Object.defineProperty(f,"__esModule",{value:!0});f.equals=function(c,b){return c===b?!0:null!=c&&null!=b&&c.objectId===b.objectId&&d(c.geometry,b.geometry)&&h(c.attributes,b.attributes)?!0:!1}})},"esri/layers/graphics/QueryEngine":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ./dehydratedFeatures ../../tasks/support/FeatureSet".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){m=function(d){function f(a){a=d.call(this)||this;a.features=null;a.layer=null;a.objectIdField=null;a.dataSpatialReference=null;return a}k(f,d);f.prototype.queryFeatures=function(a){var b=this;return this._queryFeatures(a).then(function(a){a=a.map(function(a){return l.hydrateGraphic(a,b.layer)});return new n({features:a,fields:b.layer?b.layer.fields.slice():null,geometryType:b.layer?b.layer.geometryType:null,spatialReference:b.dataSpatialReference?b.dataSpatialReference.clone():
null})})};f.prototype.queryObjectIds=function(a){var b=this;return this.objectIdField?this.queryFeatures(a).then(function(a){return b._getObjectIds(a.features)}):this._rejectQuery("Unsupported query")};f.prototype.queryFeatureCount=function(a){return this.features&&!a?c.resolve(this.features.length):this._queryFeatures(a).then(function(a){return a.length})};f.prototype.queryExtent=function(a){var b=this;return this.queryFeatures(a).then(function(a){return{count:a.features.length,extent:b._getExtent(a.features)}})};
f.prototype._queryFeatures=function(a){if(this.features){if(a){if(this._isSupportedQuery(a)){var b=this._createFilters(a);return b.length?this._executeQuery(a,b):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")};f.prototype._returnAllFeatures=function(){return c.resolve(this.features.toArray())};f.prototype._executeQuery=function(a,b){var d=this,e=[];this.features.forEach(function(c){b.every(function(b){return b.call(d,
c,a)})&&e.push(c)});return c.resolve(e)};f.prototype._isSupportedQuery=function(a){var b=!0;if(null!=a.distance||null!=a.geometryPrecision||a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length||null!=a.maxAllowableOffset||a.multipatchOption||null!=a.num||a.orderByFields&&a.orderByFields.length||a.outFields&&a.outFields.length||a.outSpatialReference||a.outStatistics&&a.outStatistics.length||a.pixelSize||a.quantizationParameters||a.relationParameter||a.returnDistinctValues||null!=a.start||
a.text||a.timeExtent||a.where||a.objectIds&&a.objectIds.length&&!this.objectIdField)b=!1;return b};f.prototype._createFilters=function(a){var b=[];a.objectIds&&a.objectIds.length&&b.push(this._createObjectIdFilter());a.geometry&&"extent"===a.geometry.type&&"intersects"===a.spatialRelationship&&b.push(this._createExtentFilter());return b};f.prototype._createExtentFilter=function(){return function(b,c){b=b.geometry;if(!b)return!1;a.fromExtent(c.geometry,p);l.computeAABR(b,q);return a.intersects(p,q)}};
f.prototype._createObjectIdFilter=function(){var a=this;return function(b,c){b=b.attributes;return-1<c.objectIds.indexOf(b&&b[a.objectIdField])}};f.prototype._rejectQuery=function(a){return c.reject(new h(this.declaredClass,a))};f.prototype._getObjectIds=function(a){var b=this.objectIdField,c=[];a.forEach(function(a){a=(a=a.attributes)&&a[b];null!=a&&c.push(a)});return c};f.prototype._getExtent=function(b){if(0===b.length)return null;a.empty(p);for(var c=0;c<b.length;c++)l.computeAABR(b[c].geometry,
q),a.expand(p,q,p);return new g.Extent({xmin:p[0],ymin:p[1],xmax:p[2],ymax:p[3],spatialReference:b[0].geometry.spatialReference})};e([b.property()],f.prototype,"features",void 0);e([b.property({constructOnly:!0})],f.prototype,"layer",void 0);e([b.property()],f.prototype,"objectIdField",void 0);e([b.property()],f.prototype,"dataSpatialReference",void 0);return f=e([b.subclass("esri.layers.graphics.QueryEngine")],f)}(b.declared(d));var p=a.create(),q=a.create();return m})},"esri/renderers/support/renderingInfoUtils":function(){define(["require",
"exports"],function(m,f){function k(e,d){if(!e||e.symbol)return null;d=d.renderer;return e&&d&&d.getObservationRenderer?d.getObservationRenderer(e):d}function e(e,d){if(e.symbol)return e.symbol;var h=k(e,d);return h&&h.getSymbol(e,d)}Object.defineProperty(f,"__esModule",{value:!0});f.getRenderer=k;f.getSymbol=e;f.getRenderingInfo=function(g,d){var h=k(g,d),c=e(g,d);if(!c)return null;c={renderer:h,symbol:c};if(h){h.colorInfo&&(c.color=h.getColor(g).toRgba());if(h.sizeInfo){var b=h.getSize(g);c.size=
[b,b,b]}if(h.visualVariables){g=h.getVisualVariableValues(g,d);b=["proportional","proportional","proportional"];for(d=0;d<g.length;d++){var a=g[d],h=a.variable,l=a.value;"color"===h.type?c.color=l.toRgba():"size"===h.type?"outline"===h.target?c.outlineSize=l:(a=h.axis,h=h.useSymbolValue?"symbolValue":l,"width"===a?b[0]=h:"depth"===a?b[1]=h:"height"===a?b[2]=h:b[0]="width-and-depth"===a?b[1]=h:b[1]=b[2]=h):"opacity"===h.type?c.opacity=l:"rotation"===h.type&&"tilt"===h.axis?c.tilt=l:"rotation"===h.type&&
"roll"===h.axis?c.roll=l:"rotation"===h.type&&(c.heading=l)}if(isFinite(b[0])||isFinite(b[1])||isFinite(b[2]))c.size=b}}return c}})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.slicePlaneEnabled=!1;b.supportsHeightUnitConversion=!1;return b}k(b,a);b.prototype.postscript=function(a){this.inherited(arguments);c.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};b.prototype._validateHeightModelInfo=function(){var a=this;return g.create(function(b,e){d.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var d=c.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);
d?e(d):b()})})};e([h.property()],b.prototype,"view",void 0);e([h.property()],b.prototype,"slicePlaneEnabled",void 0);return b=e([h.subclass("esri.views.3d.layers.LayerView3D")],b)}(h.declared(b))})},"esri/geometry/support/heightModelInfoUtils":function(){define(["require","exports","../../core/Error","../HeightModelInfo","../../layers/support/arcgisLayerUrl"],function(m,f,k,e,g){function d(a,b,c){if(h(a)&&h(b)){if(null==a||null==b)return 0;if(c||a.heightUnit===b.heightUnit){if(a.heightModel!==b.heightModel)return 2;
switch(a.heightModel){case "gravity-related-height":return 0;case "ellipsoidal":return a.vertCRS===b.vertCRS?0:3;default:return 4}}else return 1}else return 4}function h(a){return null==a||null!=a.heightModel&&null!=a.heightUnit}function c(a){var c=a.url&&g.parse(a.url);return null==(a.spatialReference&&a.spatialReference.vcsWkid)&&c&&"ImageServer"===c.serverType||!a.heightModelInfo?b(a)?e.deriveUnitFromSR(l,a.spatialReference):null:a.heightModelInfo}function b(b){return b.hasOwnProperty("capabilities")?
!!(b.capabilities&&b.capabilities.data&&b.capabilities.data.supportsZ):a(b)}function a(a){switch(a.type){case "elevation":case "integrated-mesh":case "point-cloud":case "scene":return!0}return!1}Object.defineProperty(f,"__esModule",{value:!0});f.validateWebSceneError=function(a,b){if(!a)return null;if(!h(a))return new k("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:a});var c=a.heightUnit;a=e.deriveUnitFromSR(a,b).heightUnit;
return c!==a?new k("webscene:incompatible-height-unit","The vertical units of the scene ("+c+") must match the horizontal units of the scene ("+a+")",{verticalUnit:c,horizontalUnit:a}):null};f.rejectLayerError=function(a,h,l){var g=c(a),n=d(g,h,l),p=null;if(g){var f=e.deriveUnitFromSR(g,a.spatialReference).heightUnit;l||f===g.heightUnit||(p=new k("layerview:unmatched-height-unit","The vertical units of the layer must match the horizontal units ("+f+")",{horizontalUnit:f}))}if(null==a.heightModelInfo&&
null==a.spatialReference&&b(a)||4===n||p)return new k("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:g,error:p});p=null;switch(n){case 1:a=g.heightUnit||"unknown";l=h.heightUnit||"unknown";p=new k("layerview:incompatible-height-unit","The vertical units of the layer ("+a+") must match the vertical units of the scene ("+l+")",{layerUnit:a,sceneUnit:l});break;case 2:a=g.heightModel||"unknown";l=h.heightModel||"unknown";p=new k("layerview:incompatible-height-model",
"The height model of the layer ("+a+") must match the height model of the scene ("+l+")",{layerHeightModel:a,sceneHeightModel:l});break;case 3:a=g.vertCRS||"unknown",l=h.vertCRS||"unknown",p=new k("layerview:incompatible-vertical-datum","The vertical datum of the layer ("+a+") must match the vertical datum of the scene ("+l+")",{layerDatum:a,sceneDatum:l})}return p?new k("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:g,
sceneHeightModelInfo:h,error:p}):null};f.deriveHeightModelInfoFromLayer=c;f.mayHaveHeightModelInfo=function(b){return null!=b.layers||a(b)||b.hasOwnProperty("capabilities")||b.hasOwnProperty("heightModelInfo")};var l=new e({heightModel:"gravity-related-height"})})},"esri/geometry/HeightModelInfo":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/Warning ../core/accessorSupport/decorators ./support/scaleUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a){function l(a,b){return new c("height-unit:unsupported","Height unit of value '"+a+"' is not supported",b)}function n(a,b){return new c("height-model:unsupported","Height model of value '"+a+"' is not supported",b)}var p=h.strict()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),q=h.strict()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links",
"sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});return function(c){function d(a){a=c.call(this)||this;a.heightModel="gravity-related-height";a.heightUnit="meters";a.vertCRS=null;return a}e(d,
c);h=d;d.prototype.writeHeightModel=function(a,b,c){return p.write(a,b,c)};d.prototype.readHeightModel=function(a,b,c){if(b=p.read(a))return b;c&&c.messages&&c.messages.push(n(a,{context:c}));return null};d.prototype.readHeightUnit=function(a,b,c){if(b=q.read(a))return b;c&&c.messages&&c.messages.push(l(a,{context:c}));return null};d.prototype.readHeightUnitService=function(b,c,d){if(c=a.unitFromRESTJSON(b)||q.read(b))return c;d&&d.messages&&d.messages.push(l(b,{context:d}));return null};d.prototype.readVertCRS=
function(a,b){return b.vertCRS||b.ellipsoid||b.geoid};d.prototype.clone=function(){return new h({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})};d.prototype.equals=function(a){return a?this===a?!0:this.heightModel===a.heightModel&&this.heightUnit===a.heightUnit&&this.vertCRS===a.vertCRS:!1};d.deriveUnitFromSR=function(b,c){c=a.getVerticalUnitStringForSR(c);return new h({heightModel:b.heightModel,heightUnit:c,vertCRS:b.vertCRS})};d.prototype.write=function(a,b){b=k({origin:"web-scene"},
b);return this.inherited(arguments,[a,b])};d.fromJSON=function(a){if(!a)return null;var b=new h;b.read(a,{origin:"web-scene"});return b};var h;g([b.property({type:p.apiValues,constructOnly:!0})],d.prototype,"heightModel",void 0);g([b.writer("web-scene","heightModel")],d.prototype,"writeHeightModel",null);g([b.reader(["web-scene","service"],"heightModel")],d.prototype,"readHeightModel",null);g([b.property({type:q.apiValues,constructOnly:!0,json:{origins:{"web-scene":{write:q.write}}}})],d.prototype,
"heightUnit",void 0);g([b.reader("web-scene","heightUnit")],d.prototype,"readHeightUnit",null);g([b.reader("service","heightUnit")],d.prototype,"readHeightUnitService",null);g([b.property({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],d.prototype,"vertCRS",void 0);g([b.reader("service","vertCRS",["vertCRS","ellipsoid","geoid"])],d.prototype,"readVertCRS",null);return d=h=g([b.subclass("esri.geometry.HeightModelInfo")],d)}(b.declared(d))})},"esri/geometry/support/scaleUtils":function(){define("require exports ../../config ../../core/kebabDictionary ../../core/wgs84Constants ./WKIDUnitConversion".split(" "),
function(m,f,k,e,g,d){function h(a){return q.fromJSON(a.toLowerCase())||null}function c(a){return b(a)||f.decDegToMeters}function b(a){var b,c,d;a&&("object"===typeof a?(b=a.wkid,c=a.wkt):"number"===typeof a?b=a:"string"===typeof a&&(c=a));b?d=p.values[p[b]]:c&&-1!==c.search(/^PROJCS/i)&&(a=n.exec(c))&&a[1]&&(d=parseFloat(a[1].split(",")[1]));return d}function a(a){var b,c,d;a&&("object"===typeof a?(b=a.wkid,c=a.wkt):"number"===typeof a?b=a:"string"===typeof a&&(c=a));b?d=p.units[p[b]]:c&&-1!==c.search(/^PROJCS/i)&&
(a=n.exec(c))&&a[1]&&(d=(a=/[\\"\\']{1}([^\\"\\']+)/.exec(a[1]))&&a[1]);return d?h(d):null}function l(a,b){b=c(b);return a/(b*f.inchesPerMeter*k.screenDPI)}Object.defineProperty(f,"__esModule",{value:!0});f.inchesPerMeter=39.37;f.decDegToMeters=g.wgs84Radius*Math.PI/180;var n=/UNIT\[([^\]]+)\]\]$/i,p=d,q=e.strict()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",
chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"});f.unitFromRESTJSON=h;f.unitToRESTJSON=function(a){return q.toJSON(a)||null};f.getMetersPerVerticalUnitForSR=function(a){a=c(a);return 1E5<a?1:a};f.getVerticalUnitStringForSR=function(b){return 1E5<c(b)?"meters":a(b)};f.getMetersPerUnitForSR=
c;f.getMetersPerUnit=b;f.getUnitString=a;f.getDefaultUnitSystem=function(b){if(!b)return null;switch(a(b)){case "feet":case "us-feet":case "clarke-feet":case "clarke-yards":case "clarke-links":case "sears-yards":case "sears-feet":case "sears-chains":case "benoit-1895-b-chains":case "indian-yards":case "indian-1937-yards":case "gold-coast-feet":case "sears-1922-truncated-chains":return"imperial";case "50-kilometers":case "150-kilometers":case "meters":return"metric"}return null};f.getScale=function(a,
c){c=c||a.extent;a=a.width;var d=b(c&&c.spatialReference);return c&&a?c.width/a*(d||f.decDegToMeters)*f.inchesPerMeter*k.screenDPI:0};f.getResolutionForScale=l;f.getExtentForScale=function(a,b){var c=a.extent;a=a.width;b=l(b,c.spatialReference);return c.clone().expand(b*a/c.width)}})},"esri/layers/support/arcgisLayerUrl":function(){define(["require","exports","../../core/urlUtils"],function(m,f,k){function e(d){var e=k.urlToObject(d).path.match(f.match);if(!e)return null;d=e[1];var c=e[2],b=e[3],
e=e[4],a=c.indexOf("/");return{title:g(-1!==a?c.slice(a+1):c),serverType:b,sublayer:null!=e&&""!==e?parseInt(e,10):null,url:{path:d}}}function g(d){d=d.replace(/\s*[/_]+\s*/g," ");return d[0].toUpperCase()+d.slice(1)}Object.defineProperty(f,"__esModule",{value:!0});f.serverTypes="MapServer ImageServer FeatureServer SceneServer StreamServer VectorTileServer".split(" ");f.match=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/("+f.serverTypes.join("|")+"))(?:\\/(?:layers\\/)?(\\d+))?",
"i");f.test=function(d){return!!f.match.test(d)};f.parse=e;f.cleanTitle=g;f.titleFromUrlAndName=function(d,h){var c=[];d&&(d=e(d))&&d.title&&c.push(d.title);h&&(h=g(h),c.push(h));if(2===c.length){if(-1!==c[0].toLowerCase().indexOf(c[1].toLowerCase()))return c[0];if(-1!==c[1].toLowerCase().indexOf(c[0].toLowerCase()))return c[1]}return c.join(" - ")};f.isHostedAgolService=function(d){if(!d)return!1;d=d.toLowerCase();var e=-1!==d.indexOf(".arcgis.com/");d=-1!==d.indexOf("//services")||-1!==d.indexOf("//tiles")||
-1!==d.indexOf("//features");return e&&d};f.isHostedSecuredProxyService=function(d,e){return e&&d&&-1!==d.toLowerCase().indexOf(e.toLowerCase())};f.sanitizeUrl=function(d,e){return d?k.removeTrailingSlash(k.removeQueryParameters(d,e)):d};f.sanitizeUrlWithLayerId=function(d,h,c){if(!h)return{url:h};h=k.removeQueryParameters(h,c);c=k.urlToObject(h);c=e(c.path);var b;c&&null!=c.sublayer&&(null==d.layerId&&(b=c.sublayer),h=c.url.path);return{url:k.removeTrailingSlash(h),layerId:b}};f.writeUrlWithLayerId=
function(d,e,c,b){var a=null;b?a=c:b=c;k.writeOperationalLayerUrl(e,b);b.url&&null!=d.layerId&&(b.url=k.join(b.url,a,d.layerId.toString()))}})},"esri/views/layers/LayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/Identifiable ../../core/Logger ../../core/Promise ../../core/promiseUtils ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,
h,c,b,a,l,n){return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.handles=new h;b.layer=null;b.parent=null;b.view=null;return b}k(c,a);c.prototype.initialize=function(){var a=this;this.addResolvingPromise(this.layer);this.when().catch(function(c){if("layerview:create-error"!==c.name){var d=a.layer&&a.layer.id||"no id",e=a.layer&&a.layer.title||"no title";b.getLogger(a.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+e+"', id: '"+d+"')",c);
return l.reject(c)}})};c.prototype.destroy=function(){this.layer=this.view=this.parent=null};Object.defineProperty(c.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(a){void 0===a?this._clearOverride("visible"):
this._override("visible",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"fullOpacity",{get:function(){var a=this.get("layer.opacity"),a=null!=a?a:1,b=this.get("parent.fullOpacity");return a*(null!=b?b:1)},enumerable:!0,configurable:!0});c.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1};c.prototype.isUpdating=function(){return!1};e([n.property()],c.prototype,"layer",void 0);e([n.property()],
c.prototype,"parent",void 0);e([n.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],c.prototype,"suspended",null);e([n.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],c.prototype,"updating",null);e([n.property()],c.prototype,"view",void 0);e([n.property({dependsOn:["layer.visible"]})],c.prototype,"visible",null);e([n.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],c.prototype,"fullOpacity",null);return c=e([n.subclass("esri.views.layers.LayerView")],
c)}(n.declared(g,d,c,a))})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils ../support/attributeUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){return function(d){function f(a){a=d.call(this)||this;a._handles=new h;a.highlights=new w;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}k(f,d);Object.defineProperty(f.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return!!(this.graphicsCore&&
this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});f.prototype.normalizeCtorArgs=function(a){var b=a.queryGraphicUIDsInExtent||!a.scaleVisibilityEnabled&&!a.elevationAlignmentEnabled?null:new x({spatialReference:a.owner.view.spatialReference}),c=a.frustumVisibilityEnabled?new t:null,d=a.scaleVisibilityEnabled?new u:null,e=a.elevationAlignmentEnabled?new r:null,h=function(a,c,d){return b.queryGraphicUIDsInExtent(a,
c,d)};return{graphicsCore:new q({owner:a.owner,layer:a.layer,asyncUpdates:a.asyncGraphicsUpdates,basemapTerrain:a.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),frustumVisibility:c,scaleVisibility:d,elevationAlignment:e,spatialIndex:b,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent,queryGraphicUIDsInExtent:a.queryGraphicUIDsInExtent||h}};f.prototype.initialize=
function(){var a=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(){return a.graphicsCore.elevationInfoChange()}));this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(){return a.graphicsCore.updateLabelingInfo()})));
this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.elevationAlignment,this.graphicsCore]};f.prototype.setup=function(){var a=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var b=this.owner.view.basemapTerrain,d=this.owner.view.elevationProvider;this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,b);this.elevationAlignment&&this.elevationAlignment.setup(this.owner,this.queryGraphicUIDsInExtent,
this.graphicsCore,d);this.highlights&&this.highlights.setup(this.graphicsCore);this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex));this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,spatialIndex:this.spatialIndex,labeling:this.labeling,highlights:this.highlights});this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",
function(){return a.graphicsCore.opacityChange()})]);this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)}));this.setupSuspendResumeExtent();this._handles.add(this.owner.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}));this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),
this._updateClippingExtent());this.graphicsCore.startCreateGraphics();return this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():c.resolve()};f.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",
null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null));this.highlights&&(this.highlights.destroy(),this._set("highlights",null));this._set("layer",null);this._set("owner",null)};f.prototype.highlight=function(a,b,c){var d=this;if(a instanceof n){b=this.highlights.acquireSet(b,c);var e=b.set,h=b.handle;this.owner.queryObjectIds(a).then(function(a){return d.highlights.setObjectIds(e,a)});
return h}if("number"===typeof a||a instanceof g)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof g)if(h=a,c&&h[0].attributes&&null!==z.attributeLookup(h[0].attributes,c))a=h.map(function(a){return z.attributeLookup(a.attributes,c)});else return a=h.map(function(a){return a.uid}),h=this.highlights.acquireSet(b,null),b=h.set,h=h.handle,this.highlights.setUids(b,a),h;if("number"===typeof a[0])return h=this.highlights.acquireSet(b,c),b=h.set,
h=h.handle,this.highlights.setObjectIds(b,a),h}return{remove:function(){}}};f.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=b[a];if(c&&c.needsIdleUpdate())return!0}return!1};f.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];d&&d.idleUpdate(a)}};f.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||
this.graphicsCore.recreateAllGraphics())};f.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(b.init(this,"suspendResumeExtentMode",function(c){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(b.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(b.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),
"suspendResumeExtentMode")}}))};f.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};f.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!l.canProject(a,c))return;a=l.project(a,c)}return v.enlargeExtent(a,b,p.SUSPEND_RESUME_EXTENT_OPTIMISM)};f.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&
this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};e([a.property({aliasOf:"graphicsCore.layer"})],f.prototype,"layer",void 0);e([a.property({aliasOf:"graphicsCore.owner"})],f.prototype,"owner",void 0);e([a.property({constructOnly:!0})],f.prototype,"updateClippingExtent",void 0);e([a.property({constructOnly:!0})],f.prototype,"queryGraphicUIDsInExtent",void 0);e([a.property({constructOnly:!0})],f.prototype,"graphicsCore",void 0);e([a.property({constructOnly:!0})],
f.prototype,"spatialIndex",void 0);e([a.property({constructOnly:!0})],f.prototype,"scaleVisibility",void 0);e([a.property({constructOnly:!0})],f.prototype,"elevationAlignment",void 0);e([a.property({constructOnly:!0})],f.prototype,"frustumVisibility",void 0);e([a.property({readOnly:!0})],f.prototype,"labeling",void 0);e([a.property({readOnly:!0})],f.prototype,"highlights",void 0);e([a.property()],f.prototype,"suspendResumeExtentMode",void 0);e([a.property()],f.prototype,"dataExtent",void 0);e([a.property({readOnly:!0,
dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],f.prototype,"suspended",null);e([a.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","scaleVisibility.updating"]})],f.prototype,"updating",null);return f=e([a.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],f)}(a.declared(d))})},"esri/tasks/support/Query":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../TimeExtent ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils ../../geometry/support/typeUtils ../../symbols/support/jsonUtils ../../symbols/support/typeUtils ./QuantizationParameters ./StatisticDefinition".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){var w=c({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),u=c({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",
esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(c){function h(a){a=c.call(this,a)||this;a.datumTransformation=null;a.distance=void 0;a.gdbVersion=null;a.geometry=null;a.geometryPrecision=void 0;a.groupByFieldsForStatistics=null;a.having=null;a.historicMoment=null;a.maxAllowableOffset=void 0;a.maxRecordCountFactor=1;a.multipatchOption=null;a.num=void 0;a.objectIds=null;a.orderByFields=null;a.outFields=null;a.outSpatialReference=null;a.outStatistics=
null;a.parameterValues=null;a.pixelSize=null;a.quantizationParameters=null;a.rangeValues=null;a.relationParameter=null;a.resultType=null;a.returnDistinctValues=!1;a.returnGeometry=!1;a.returnCentroid=!1;a.returnExceededLimitFeatures=!0;a.returnM=void 0;a.returnZ=void 0;a.source=null;a.spatialRelationship="intersects";a.start=void 0;a.sqlFormat=null;a.text=null;a.timeExtent=null;a.units="meters";a.where=null;return a}k(h,c);f=h;h.prototype.castDatumTransformation=function(a){return"number"===typeof a||
"object"===typeof a?a:null};h.prototype.writeHistoricMoment=function(a,b,c){b.historicMoment=a&&a.getTime()};h.prototype.writeParameterValues=function(a,b,c){if(a){c={};for(var d in a){var e=a[d];Array.isArray(e)?c[d]=e.map(function(a){return a instanceof Date?a.getTime():a}):c[d]=e instanceof Date?e.getTime():e}b.parameterValues=c}};h.prototype.writeStart=function(a,b,c){b.resultOffset=this.start;b.resultRecordCount=this.num||10;b.where="1\x3d1"};h.prototype.writeWhere=function(a,b,c){b.where=a||
"1\x3d1"};h.prototype.clone=function(){return new f(b.clone({datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,
num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,
returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnM:this.returnM,returnZ:this.returnZ,source:this.source,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.text,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))};var f;e([a.property({json:{write:!0}})],h.prototype,"datumTransformation",void 0);e([a.cast("datumTransformation")],h.prototype,"castDatumTransformation",null);e([a.property({type:Number,json:{write:!0}})],h.prototype,
"distance",void 0);e([a.property({type:String,json:{write:!0}})],h.prototype,"gdbVersion",void 0);e([a.property({types:n.types,json:{read:l.fromJSON,write:!0}})],h.prototype,"geometry",void 0);e([a.property({type:Number,json:{write:!0}})],h.prototype,"geometryPrecision",void 0);e([a.property({type:[String],json:{write:!0}})],h.prototype,"groupByFieldsForStatistics",void 0);e([a.property({type:String,json:{write:!0}})],h.prototype,"having",void 0);e([a.property({type:Date})],h.prototype,"historicMoment",
void 0);e([a.writer("historicMoment")],h.prototype,"writeHistoricMoment",null);e([a.property({type:Number,json:{write:!0}})],h.prototype,"maxAllowableOffset",void 0);e([a.property({type:Number,cast:function(a){return 1>a?1:5<a?5:a},json:{write:{overridePolicy:function(a){return{enabled:1<a}}}}})],h.prototype,"maxRecordCountFactor",void 0);e([a.property({type:String,json:{write:!0}})],h.prototype,"multipatchOption",void 0);e([a.property({type:Number,json:{read:{source:"resultRecordCount"}}})],h.prototype,
"num",void 0);e([a.property({type:[Number],json:{write:!0}})],h.prototype,"objectIds",void 0);e([a.property({type:[String],json:{write:!0}})],h.prototype,"orderByFields",void 0);e([a.property({type:[String],json:{write:!0}})],h.prototype,"outFields",void 0);e([a.property({type:g.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],h.prototype,"outSpatialReference",void 0);e([a.property({type:[t],json:{write:!0}})],h.prototype,"outStatistics",void 0);e([a.property({json:{write:!0}})],
h.prototype,"parameterValues",void 0);e([a.writer("parameterValues")],h.prototype,"writeParameterValues",null);e([a.property({types:q.types,json:{read:p.read,write:!0}})],h.prototype,"pixelSize",void 0);e([a.property({type:r.default,json:{write:!0}})],h.prototype,"quantizationParameters",void 0);e([a.property({type:[Object],json:{write:!0}})],h.prototype,"rangeValues",void 0);e([a.property({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(a){return{enabled:"relation"===
this.spatialRelationship}}}}})],h.prototype,"relationParameter",void 0);e([a.property({type:String,json:{write:!0}})],h.prototype,"resultType",void 0);e([a.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],h.prototype,"returnDistinctValues",void 0);e([a.property({type:Boolean,json:{write:!0}})],h.prototype,"returnGeometry",void 0);e([a.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],h.prototype,"returnCentroid",void 0);e([a.property({type:Boolean,
json:{write:{overridePolicy:function(a){return{enabled:!a}}}}})],h.prototype,"returnExceededLimitFeatures",void 0);e([a.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],h.prototype,"returnM",void 0);e([a.property({type:Boolean,json:{write:{overridePolicy:function(a){return{enabled:a}}}}})],h.prototype,"returnZ",void 0);e([a.property({json:{write:!0}})],h.prototype,"source",void 0);e([a.property({type:String,json:{read:{source:"spatialRel",reader:w.read},write:{target:"spatialRel",
writer:w.write}}})],h.prototype,"spatialRelationship",void 0);e([a.property({type:Number,json:{read:{source:"resultOffset"}}})],h.prototype,"start",void 0);e([a.writer("start"),a.writer("num")],h.prototype,"writeStart",null);e([a.property({type:String,json:{write:!0}})],h.prototype,"sqlFormat",void 0);e([a.property({type:String,json:{write:!0}})],h.prototype,"text",void 0);e([a.property({type:d,json:{write:!0}})],h.prototype,"timeExtent",void 0);e([a.property({type:String,json:{read:u.read,write:{writer:u.write,
overridePolicy:function(a){return{enabled:0<this.distance}}}}})],h.prototype,"units",void 0);e([a.property({type:String,json:{write:{overridePolicy:function(a){return{enabled:null!=a||0<this.start}}}}})],h.prototype,"where",void 0);e([a.writer("where")],h.prototype,"writeWhere",null);return h=f=e([a.subclass("esri.tasks.support.Query")],h)}(a.declared(h))})},"esri/TimeExtent":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/JSONSupport ./core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){var h={milliseconds:{getter:"getUTCMilliseconds",setter:"setUTCMilliseconds",multiplier:1},seconds:{getter:"getUTCSeconds",setter:"setUTCSeconds",multiplier:1},minutes:{getter:"getUTCMinutes",setter:"setUTCMinutes",multiplier:1},hours:{getter:"getUTCHours",setter:"setUTCHours",multiplier:1},days:{getter:"getUTCDate",setter:"setUTCDate",multiplier:1},weeks:{getter:"getUTCDate",setter:"setUTCDate",multiplier:7},months:{getter:"getUTCMonth",setter:"setUTCMonth",multiplier:1},years:{getter:"getUTCFullYear",
setter:"setUTCFullYear",multiplier:1},decades:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:10},centuries:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:100}};return function(c){function b(a,b){a=c.call(this)||this;a.endTime=null;a.startTime=null;return a}k(b,c);a=b;b.prototype.normalizeCtorArgs=function(a,b){return!a||a instanceof Date?{startTime:a,endTime:b}:a};b.prototype.readEndTime=function(a,b){return null!=b.endTime?new Date(b.endTime):null};b.prototype.writeEndTime=
function(a,b,c){b.endTime=a?a.getTime():null};b.prototype.readStartTime=function(a,b){return null!=b.startTime?new Date(b.startTime):null};b.prototype.writeStartTime=function(a,b,c){b.startTime=a?a.getTime():null};b.prototype.clone=function(){return new a({endTime:this.endTime,startTime:this.startTime})};b.prototype.intersection=function(b){if(!b)return null;var c=this.startTime?this.startTime.getTime():-Infinity,d=this.endTime?this.endTime.getTime():Infinity,e=b.startTime?b.startTime.getTime():-Infinity;
b=b.endTime?b.endTime.getTime():Infinity;var h,l;e>=c&&e<=d?h=e:c>=e&&c<=b&&(h=c);d>=e&&d<=b?l=d:b>=c&&b<=d&&(l=b);if(isNaN(h)||isNaN(l))return null;c=new a;c.startTime=-Infinity===h?null:new Date(h);c.endTime=Infinity===l?null:new Date(l);return c};b.prototype.offset=function(b,c){var d=new a,e=this.startTime,h=this.endTime;e&&(d.startTime=this._offsetDate(e,b,c));h&&(d.endTime=this._offsetDate(h,b,c));return d};b.prototype._offsetDate=function(a,b,c){a=new Date(a.getTime());b&&c&&(c=h[c],a[c.setter](a[c.getter]()+
b*c.multiplier));return a};var a;e([d.property({type:Date,json:{write:{allowNull:!0}}})],b.prototype,"endTime",void 0);e([d.reader("endTime")],b.prototype,"readEndTime",null);e([d.writer("endTime")],b.prototype,"writeEndTime",null);e([d.property({type:Date,json:{write:{allowNull:!0}}})],b.prototype,"startTime",void 0);e([d.reader("startTime")],b.prototype,"readStartTime",null);e([d.writer("startTime")],b.prototype,"writeStartTime",null);return b=a=e([d.subclass("esri.TimeExtent")],b)}(d.declared(g))})},
"esri/tasks/support/QuantizationParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});var a=h({upperLeft:"upper-left",lowerLeft:"lower-left"});m=function(d){function h(){var a=null!==d&&d.apply(this,arguments)||this;a.extent=
null;a.mode="view";a.originPosition="upper-left";return a}k(h,d);l=h;h.prototype.clone=function(){return new l(c.clone({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))};var l;e([b.property({type:g.Extent,json:{write:!0}})],h.prototype,"extent",void 0);e([b.property({type:String,json:{write:!0}})],h.prototype,"mode",void 0);e([b.property({type:String,json:{read:a.read,write:a.write}})],h.prototype,"originPosition",void 0);e([b.property({type:Number,
json:{write:!0}})],h.prototype,"tolerance",void 0);return h=l=e([b.subclass("esri.tasks.support.QuantizationParameters")],h)}(b.declared(d));f.default=m})},"esri/tasks/support/StatisticDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(h){function c(a){a=h.call(this)||this;a.maxPointCount=void 0;a.maxRecordCount=void 0;
a.maxVertexCount=void 0;a.onStatisticField=null;a.outStatisticFieldName=null;a.statisticType=null;return a}k(c,h);b=c;c.prototype.clone=function(){return new b({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType})};var b;e([d.property({type:Number,json:{write:!0}})],c.prototype,"maxPointCount",void 0);e([d.property({type:Number,
json:{write:!0}})],c.prototype,"maxRecordCount",void 0);e([d.property({type:Number,json:{write:!0}})],c.prototype,"maxVertexCount",void 0);e([d.property({type:String,json:{write:!0}})],c.prototype,"onStatisticField",void 0);e([d.property({type:String,json:{write:!0}})],c.prototype,"outStatisticFieldName",void 0);e([d.property({type:String,json:{write:!0}})],c.prototype,"statisticType",void 0);return c=b=e([d.subclass("esri.tasks.support.StatisticDefinition")],c)}(d.declared(g))})},"esri/views/3d/layers/graphics/constants":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.defaultIconElevationOffset=1;f.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DOwner ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ../../lib/gl-matrix ../../support/mathUtils ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../webgl-engine/lib/Layer".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O,J,Q,H,K,R,P,L,T,S){var W=new c.Point,Y=H.vec3d.create(),X=y.create(),aa=t.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");m=function(l){function f(a){a=l.call(this)||this;a.propertiesPool=new P.PropertiesPool({computedExtent:c.Extent},a);a.computedExtent=null;a.symbolCreationContext=new G.Graphics3DSymbolCreationContext;a.graphics={};a.stageLayer=null;a.stage=null;a.graphicsDrapedUids={};a.graphicsBySymbol={};a.graphicsKeys=
[];a.symbols={};a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Set;a.lastFastUpdate=null;a.handles=new q;a.viewSR=null;a.elevationAlignment=null;a.scaleVisibility=null;a.spatialIndex=null;a.labeling=null;a.highlights=null;a.viewElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.pendingUpdatesPool=new u({initialSize:2E3,allocator:function(){return{add:null,remove:null}},deallocator:function(a){a.add=null;a.remove=
null}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a.minTotalNumberOfFeatures=2E3;a.numberOfGraphics=0;a._visible=void 0;a._startCreateGraphics=!1;return a}k(f,l);m=f;Object.defineProperty(f.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&
this.scaleVisibility.updating)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxNumberOfFeatures",{get:function(){return K.clamp(Math.ceil((this.maxTotalNumberOfVertices||1)/this.maxSymbolNumberOfVertices),this.minTotalNumberOfFeatures,this.maxTotalNumberOfFeatures||1)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxSymbolNumberOfVertices",{get:function(){var a=0,b;for(b in this.symbols){var c=this.symbols[b];c&&(a=Math.max(a,c.numberOfVertices))}return 0===
a?this._get("maxSymbolNumberOfVertices")||1:a},enumerable:!0,configurable:!0});f.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference};f.prototype.setup=function(a){var b=this;this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",a.scaleVisibility);this._set("spatialIndex",a.spatialIndex);this._set("labeling",a.labeling);this._set("highlights",a.highlights);var c=this.owner.view;this.viewElevationProvider=new M.ViewElevationProvider(this.viewSR,c);
this.initializeStage(c,this.layer.uid);this.symbolCreationContext.sharedResources=c.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=c.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=c.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=
c.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=m.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=c.elevationProvider;a=N.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=N.createContext(a,this.viewSR,aa);c.deconflictor.addGraphicsOwner(this);
this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.handles.add(this.owner.watch("suspended",function(){return b.updateLayerVisibility()}));this.handles.add([this.owner.watch("layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",function(){var a=c.screenSizePerspectiveEnabled&&
b.layer.screenSizePerspectiveEnabled;a!==b.symbolCreationContext.screenSizePerspectiveEnabled&&(b.symbolCreationContext.screenSizePerspectiveEnabled=a,b.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(a){a=!!a;a!==b.symbolCreationContext.slicePlaneEnabled&&(b.symbolCreationContext.slicePlaneEnabled=a,b.recreateAllGraphics())})]);this.handles.add(v.when(c.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(b.symbolCreationContext.overlaySR)||(b.symbolCreationContext.overlaySR=
b.basemapTerrain.spatialReference);b.handles.has("loaded-graphics")?b.recreateAllGraphics():b.handles.add(v.on(b.owner,"loadedGraphics","change",function(a){return b.graphicsCollectionChanged(a)},function(){return b.recreateAllGraphics()}),"loaded-graphics")}));this.validateRenderer(this.layer.renderer)};f.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),
this.stage.remove(L.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this.viewSR=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&
(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null};f.prototype.clear=function(){for(var a in this.graphics)this.graphics[a].destroy();this.spatialIndex&&this.spatialIndex.clear();this.graphics={};this.graphicsKeys=null;this.numberOfGraphics=0;this.updateLayerVisibility();for(var b in this.symbols)(a=this.symbols[b])&&a.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();
this.pendingUpdatesPool.clear();this._set("hasDraped",!1);this.notifyChange("updating")};f.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new S(b,{isPickable:!this.owner.suspended},b);this.stage.add(L.ModelContentType.LAYER,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};f.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set,c;for(c in this.symbols){var d=this.symbols[c];d&&d.setDrawOrder(a,b)}0<b.size&&this.stage.getDrapedTextureRenderer().updateRenderOrder(b)};
f.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.maxNumberOfFeatures*ba,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()))};Object.defineProperty(f.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0});f.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};Object.defineProperty(f.prototype,
"graphics3DGraphicsKeys",{get:function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));return this.graphicsKeys},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0});f.prototype.updateLabelingInfo=function(a){return this.labeling&&this.labeling.labelingInfoChange(a)};f.prototype.updateVisibilityInfo=function(){return this.labeling&&this.labeling.visibilityInfoChange()};
Object.defineProperty(f.prototype,"symbolUpdateType",{get:function(){if(0<this.pendingUpdates.size)return"unknown";var a=0,b=0,c;for(c in this.symbols){var d=this.symbols[c];if(d){d=d.getFastUpdateStatus();if(0<d.loading)return"unknown";this.graphicsBySymbol[c]&&(b+=d.fast,a+=d.slow)}}return 0<=b&&0===a?"fast":0<=a&&0===b?"slow":"mixed"},enumerable:!0,configurable:!0});f.prototype.needsIdleUpdate=function(){return 0<this.pendingUpdates.size?!0:!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate};
f.prototype.idleUpdate=function(a){var b=this.needsIdleUpdate();this._applyPendingUpdates(a);!a.done()&&this.lastFastUpdate&&(this.lastFastUpdate=null);a=this.needsIdleUpdate();b!==a&&this.notifyChange("updating")};f.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return x.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||(b=new h,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};f.prototype.boundsForGraphics3DGraphic=function(a,b){return d(this,void 0,
void 0,function(){var c,d,e,h,l,k,n,f,p,q;return g(this,function(g){switch(g.label){case 0:return c=this.owner.view.spatialReference,d=this.owner.view.renderSpatialReference,e=this.owner.view.basemapTerrain.spatialReference,h=function(a,b,e){return R.bufferToBuffer(a,d,b,a,c,b,e)},l=function(a,b,d){return R.bufferToBuffer(a,e,b,a,c,b,d)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:b&&b.useViewElevation,minDemResolution:b&&b.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:
null,[4,a.getProjectedBoundingBox(h,l,k)];case 1:n=g.sent();if(!n)return[2,null];f=n.boundingBox;n.requiresDrapedElevation&&(p=this.symbolCreationContext.elevationProvider)&&(y.center(f,Y),W.x=Y[0],W.y=Y[1],W.z=void 0,W.spatialReference=c,q=p.getElevation(W)||0,f[2]=Math.min(f[2],q),f[5]=Math.max(f[5],q));return[2,{boundingBox:f,screenSpaceObjects:n.screenSpaceObjects}]}})})};f.prototype.whenGraphicBounds=function(a,b){var c=this;return v.whenOnce(this.owner,"loadedGraphics").then(function(){var b=
c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};f.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};f.prototype.graphicUpdateHandler=
function(a){var b=this.graphics[a.graphic.uid];if(b)switch(a.property){case "visible":this.graphicUpdateVisible(b,a);break;case "geometry":case "attributes":case "symbol":this.recreateGraphic(b)}};f.prototype.graphicUpdateVisible=function(a,b){a.setVisibilityFlag(0,b.newValue)&&this.labeling&&(this.lastFastUpdate=performance.now(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())};f.prototype.recreateGraphic=function(a){a=[a.graphic];this.remove(a);this.add(a)};f.prototype.beginGraphicUpdate=
function(a,b){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};f.prototype.endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"));this._get("symbolsUpdating")&&0===this.graphicsWaitingForSymbol.size&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))};f.prototype.expandComputedExtent=
function(a){var b=a.spatialReference;C.computeAABB(a,X);a=this.viewSR;var c=m.tmpVec;!b.equals(a)&&R.xyzToVector(X[0],X[1],0,b,c,a)&&(X[0]=c[0],X[1]=c[1],R.xyzToVector(X[3],X[4],0,b,c,a),X[3]=c[0],X[4]=c[1]);if(K.isFinite(X[0])&&K.isFinite(X[3])&&K.isFinite(X[1])&&K.isFinite(X[4])){var b=this.computedExtent,c=null,d=K.isFinite(X[2])&&K.isFinite(X[5]),e=d&&(!b||null==b.zmin||X[2]<b.zmin),d=d&&(!b||null==b.zmax||X[5]>b.zmax);if(b){if(X[0]<b.xmin||X[1]<b.ymin||X[3]>b.xmax||X[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),
c.xmin=Math.min(X[0],b.xmin),c.ymin=Math.min(X[1],b.ymin),c.xmax=Math.max(X[3],b.xmax),c.ymax=Math.max(X[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=X[0],c.ymin=X[1],c.xmax=X[3],c.ymax=X[4],c.spatialReference=a;c&&(e&&(c.zmin=X[2]),d&&(c.zmax=X[5]),this._set("computedExtent",c))}};f.prototype.updateHasDraped=function(){var a=!1,b;for(b in this.graphicsDrapedUids)if(this.graphicsDrapedUids.hasOwnProperty(b)){a=!0;break}this._set("hasDraped",a)};f.prototype.elevationInfoChange=
function(){var a=N.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=N.createContext(a,this.viewSR,aa);this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var b in this.graphicsBySymbol){var c=this.symbols[b],a=this.graphicsBySymbol[b];if(c&&c.layerPropertyChanged("elevationInfo",a))for(var d in a)for(var e=
a[d],c=e.graphic,e=e._labelGraphics,h=0;h<e.length;h++){var l=e[h];l.graphics3DSymbolLayer.updateGraphicElevationContext(c,l)}else this._recreateSymbol(b)}this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};f.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.labeling&&this.labeling.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};f.prototype.startCreateGraphics=function(){this._startCreateGraphics=
!0;this.recreateAllGraphics()};f.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};
f.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],c=[],d=[],e;for(e in b){var h=b[e];h.isDraped()&&delete this.graphicsDrapedUids[e];this.spatialIndex&&c.push(h);d.push(h.graphic);h.destroy();this.removeGraphics3DGraphic(e);this.updateLayerVisibility()}0<c.length&&this.spatialIndex.removeMany(c);this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();this.add(d)};f.prototype.add=function(a){this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?
(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):aa.error("#add()","Cannot add graphics before terrain surface has been initialized")};f.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;U.clear();for(var c=0;c<a.length;c++)this._startAddGraphic(a[c],U);U.forEach(function(a){return b._finishAddGraphics(a)});U.clear();this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};
f.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add=c:(e=this.pendingUpdatesPool.pushNew(),e.add=c,this.pendingUpdates.set(d,e))}};f.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};f.prototype._removeImmediate=function(a){for(var b=[],c=0;c<a.length;c++){var d=this._removeGraphic(a[c]);this.spatialIndex&&d&&b.push(d)}0<b.length&&this.spatialIndex.removeMany(b);
this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};f.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d)):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e))}0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear()};f.prototype._applyPendingUpdates=function(a){var b=this;if(!a.done()){this.symbolWarningLogged=
this.geometryWarningLogged=!1;var c=0;U.clear();r.everyMap(this.pendingUpdates,function(d,e){if(a.done())return!1;if(d.remove){var h=b._removeGraphic(d.remove);b.spatialIndex&&h&&b.spatialIndex.remove(h)}d.add&&b._startAddGraphic(d.add,U)&&c++;b.pendingUpdates.delete(e);1E3<c&&(U.forEach(function(a){return b._finishAddGraphics(a)}),U.clear(),c=0)});U.forEach(function(a){return b._finishAddGraphics(a)});U.clear();0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear();this.updateHasDraped();
this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()}};f.prototype._startAddGraphic=function(a,b){this.graphicsWithoutSymbol[a.uid]=a;var c=a.geometry;if(!c)return this.geometryWarningLogged||(this.geometryWarningLogged=!0,aa.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),!1;if(!this.graphicSymbolSupported&&a.symbol)return this.symbolWarningLogged||(this.symbolWarningLogged=!0,aa.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),
!1;var d=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(a);if(!d||!d.symbol)return this.symbolWarningLogged||(this.symbolWarningLogged=!0,aa.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),!1;var e=this.getOrCreateGraphics3DSymbol(d.symbol,d.renderer);if(!e)return!1;d={graphic:a,renderingInfo:d,layer:this.layer};this.expandComputedExtent(c);this.beginGraphicUpdate(a,e);a=e.symbol.id;(c=b.get(a))?c.graphics.push(d):(c=Z.acquire(),c.clear(),c.push(d),b.set(a,
{asyncSymbol:e,graphics:c}));return!0};f.prototype._finishAddGraphics=function(a){var b=this;a.asyncSymbol.then(function(){ha.clear();for(var c=0;c<a.graphics.length;c++){var d=a.graphics.data[c],e=d.graphic;b.graphicsWaitingForSymbol.has(e.uid)&&(d=b.createGraphics3DGraphic(a.asyncSymbol,d),b.spatialIndex&&d&&ha.push(d));b.endGraphicUpdate(e)}0<ha.length&&b.spatialIndex.addMany(ha.data,ha.length);ha.clear();a.graphics.clear();Z.release(a.graphics);b.labeling&&(b.lastFastUpdate=performance.now(),
b.owner.view.labeler.setDirty())},function(){for(var c=0;c<a.graphics.length;c++)b.endGraphicUpdate(a.graphics.data[c].graphic);a.graphics.clear();Z.release(a.graphics)})};f.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics[a];if(b){b.isDraped()&&delete this.graphicsDrapedUids[a];var c=b.graphics3DSymbol.symbol.id;b.destroy();delete this.graphicsBySymbol[c][a];delete this.graphicsWithoutSymbol[a];this.removeGraphics3DGraphic(a);this.labeling&&this.labeling.removeGraphic(b)}else this.graphicsWaitingForSymbol.delete(a);
return b};f.prototype.hasLabelingContext=function(b){if(b instanceof a.LabelSymbol3D||b instanceof a.TextSymbol){var c=this.symbolCreationContext.layer;return c.labelingInfo?c.labelingInfo.some(function(a){return a.symbol===b}):!1}return!1};f.prototype.hasValidSymbolCreationContext=function(b){return b instanceof a.LabelSymbol3D&&!this.hasLabelingContext(b)?(aa.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};f.prototype.createGraphics3DSymbol=
function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=F.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var d=void 0;b&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=F.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(d=b.symbol.symbolLayers));b=O.make(a.symbol,this.symbolCreationContext,d);b.then(function(){c.notifyChange("maxSymbolNumberOfVertices")});return b}a.error&&aa.error(a.error.message);return null};f.prototype.getOrCreateGraphics3DSymbol=
function(b,c){var d=this,e=this.symbols[b.id];void 0===e&&(e=b instanceof a.WebStyleSymbol?new J(b,function(a){return d.createGraphics3DSymbol(a,c)}):this.createGraphics3DSymbol(b,c),this.symbols[b.id]=e);return e};f.prototype.addGraphics3DGraphic=function(a){this.graphics[a.graphic.uid]=a;this.graphicsKeys=null;this.numberOfGraphics++;this.updateLayerVisibility()};f.prototype.removeGraphics3DGraphic=function(a){delete this.graphics3DGraphics[a];this.graphicsKeys=null;this.numberOfGraphics--;this.updateLayerVisibility()};
f.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols[a.symbol.id])this.add([c]);else if(!this.graphics[c.uid]){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol[a]||(this.graphicsBySymbol[a]={});this.graphicsBySymbol[a][c.uid]=b;b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.graphicsDrapedUids[c.uid]=!0,this._set("hasDraped",!0));b.centroid=null;"point"!==c.geometry.type&&
b instanceof I&&(b.centroid=Q.computeCentroid(c.geometry),b.centroid&&Q.convertPointSR(b.centroid,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.labeling&&this.labeling.addGraphic(b);a&&this.scaleVisibility.updateGraphicScaleVisibility(b);b.setVisibilityFlag(0,!!c.visible&&!this.owner.suspended);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this.layer,b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],
a.resolve(b);this.highlights&&this.highlights.graphicCreated(b);return b}};f.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var c=E.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;c&&("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()))}};f.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;
case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};f.prototype.applySymbolSetDiff=function(a,b,c,d){a=a||[];b=b||[];d=[];for(var e=0;e<b.length;e++){var h=b[e],l=this.graphicsBySymbol[h.id],g;for(g in l){var k=l[g],n=k.graphic,f=this.layer instanceof B?this.layer:null;if(h!==c.defaultSymbol||c.getSymbol(C.hydrateGraphic(n,f))!==c.defaultSymbol)k.isDraped()&&delete this.graphicsDrapedUids[g],a.length||c.defaultSymbol?d.push(n):this.graphicsWithoutSymbol[g]=
n,k.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[g]),delete l[g],this.removeGraphics3DGraphic(g),this.updateLayerVisibility()}if(void 0===l||0===Object.keys(l).length)delete this.graphicsBySymbol[h.id],(l=this.symbols[h.id])&&l.destroy(),delete this.symbols[h.id],this.notifyChange("maxSymbolNumberOfVertices")}if(a.length||d.length){for(g in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[g]);this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();this.owner.view.deconflictor.setDirty();
this.owner.view.labeler.setDirty()};f.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var h=e?e.added.map(function(a){return a.symbol}):[],l=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var g=0;g<e.changed.length;g++)h.push(e.changed[g].newValue.symbol),l.push(e.changed[g].oldValue.symbol);d?(c.defaultSymbol&&l.push(c.defaultSymbol),b.defaultSymbol&&h.push(b.defaultSymbol)):c.defaultSymbol&&h.length&&l.push(b.defaultSymbol);
this.applySymbolSetDiff(h,l,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};f.prototype.calculateUnchangedSymbolMapping=function(a,c,d){if(c instanceof b.UniqueValueRenderer&&d instanceof b.UniqueValueRenderer)if(!a){if(d&&d.defaultSymbol)return[{oldId:d.defaultSymbol.id,newId:c.defaultSymbol.id}]}else if("partial"===a.type){var e=a.diff;a=e.defaultSymbol;var e=e.uniqueValueInfos,h=void 0,h=e?e.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):
d.uniqueValueInfos.map(function(a,b){return{oldId:a.symbol.id,newId:c.uniqueValueInfos[b].symbol.id}});!a&&d.defaultSymbol&&h.push({oldId:d.defaultSymbol.id,newId:c.defaultSymbol.id});return h}return[]};f.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)if(c=a[d],b=c.oldId,c=c.newId,b&&b!==c){var e=this.graphicsBySymbol[b];delete this.graphicsBySymbol[b];void 0!==e&&(this.graphicsBySymbol[c]=e);e=this.symbols[b];delete this.symbols[b];
void 0!==e&&(this.symbols[c]=e,e.symbol.id=c)}};f.prototype.applyRendererDiff=function(a,c,d){if(this.diffHasSymbolChange(a))return!1;if(c instanceof b.UniqueValueRenderer&&d instanceof b.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,c,d)&&0===Object.keys(a.diff).length)return!0;for(var e in this.graphicsBySymbol)if((d=this.symbols[e])&&!d.applyRendererDiff(a,c,this.graphicsBySymbol[e]))return!1;return!0};f.prototype.opacityChange=function(){for(var a in this.graphicsBySymbol){var b=this.symbols[a];
b&&b.layerPropertyChanged("opacity")}};f.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,d=A.create();R.extentToBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=[d[0],d[1],-Infinity,d[2],d[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!n.equals(this.symbolCreationContext.clippingExtent,c)};f.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.owner.loadedGraphics){var c=!1;this.owner.loadedGraphics.forEach(function(d){var e=
b.getGraphics3DGraphicById(d.uid);e&&a(e,d)&&(c=!0)});c&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};f.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,c){c=b.setVisibilityFlag(0,c.visible);var d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b));return c||d})};f.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};f.prototype.validateRenderer=
function(a){(a=D.validateTo3D(a))&&aa.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};f.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now(),this.labeling.clear());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};f.createLocalOriginFactory=function(){return new T(5E6,16)};f.prototype.snapshotInternals=
function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:Object.keys(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};var m;f.tmpVec=H.vec3d.create();e([z.property({readOnly:!0})],f.prototype,
"computedExtent",void 0);e([z.property({readOnly:!0})],f.prototype,"elevationAlignment",void 0);e([z.property({readOnly:!0})],f.prototype,"scaleVisibility",void 0);e([z.property({readOnly:!0})],f.prototype,"spatialIndex",void 0);e([z.property({readOnly:!0})],f.prototype,"labeling",void 0);e([z.property({readOnly:!0})],f.prototype,"highlights",void 0);e([z.property()],f.prototype,"asyncUpdates",void 0);e([z.property({constructOnly:!0})],f.prototype,"elevationFeatureExpressionEnabled",void 0);e([z.property({constructOnly:!0})],
f.prototype,"owner",void 0);e([z.property({constructOnly:!0})],f.prototype,"layer",void 0);e([z.property({constructOnly:!0})],f.prototype,"basemapTerrain",void 0);e([z.property({readOnly:!0})],f.prototype,"hasDraped",void 0);e([z.property({readOnly:!0})],f.prototype,"symbolsUpdating",void 0);e([z.property({constructOnly:!0})],f.prototype,"graphicSymbolSupported",void 0);e([z.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating"]})],f.prototype,"updating",null);
e([z.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfVertices"})],f.prototype,"maxTotalNumberOfVertices",void 0);e([z.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures"})],f.prototype,"maxTotalNumberOfFeatures",void 0);e([z.property()],f.prototype,"minTotalNumberOfFeatures",void 0);e([z.property({readOnly:!0,dependsOn:["maxSymbolNumberOfVertices","maxTotalNumberOfVertices","minTotalNumberOfFeatures","maxTotalNumberOfFeatures"]})],f.prototype,
"maxNumberOfFeatures",null);e([z.property({readOnly:!0})],f.prototype,"maxSymbolNumberOfVertices",null);return f=m=e([z.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],f)}(z.declared(l));var U=new Map,ha=new u,Z=new w(u);(function(){return function(){this.remove=this.add=null}})();var ba=10;return m})},"esri/renderers":function(){define("require exports ./renderers/ClassBreaksRenderer ./renderers/HeatmapRenderer ./renderers/Renderer ./renderers/SimpleRenderer ./renderers/UniqueValueRenderer ./renderers/support/jsonUtils".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});f.ClassBreaksRenderer=k;f.HeatmapRenderer=e;f.BaseRenderer=g;f.SimpleRenderer=d;f.UniqueValueRenderer=h;f.isRenderer=function(b){return b instanceof f.BaseRenderer};f.fromJSON=c.fromJSON})},"esri/renderers/ClassBreaksRenderer":function(){define("../core/declare ../core/lang ../core/kebabDictionary ../core/Error ../core/Logger ../core/accessorSupport/ensureType ../support/arcadeUtils ../symbols/Symbol ../symbols/PolygonSymbol3D ../symbols/support/jsonUtils ../symbols/support/typeUtils ./Renderer ./support/LegendOptions ./support/ClassBreakInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){var r=g.getLogger("esri.renderers.ClassBreaksRenderer");p=p.LegendOptions;q=q.ClassBreakInfo;k=k({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});var t=d.ensureType(q),w=m(n,{declaredClass:"esri.renderers.ClassBreaksRenderer",properties:{backgroundFillSymbol:{types:{base:c,key:"type",typeMap:{"simple-fill":l.types.typeMap["simple-fill"],"picture-fill":l.types.typeMap["picture-fill"],"polygon-3d":l.types.typeMap["polygon-3d"]}},
value:null,json:{origins:{"web-scene":{read:a.read,write:{target:{backgroundFillSymbol:{type:b}},writer:a.writeTarget}}},read:a.read,write:a.writeTarget}},classBreakInfos:{type:[q],json:{read:function(a,b,c){if(Array.isArray(a)){var d=b.minValue;return a.map(function(a){var b=new q;b.read(a,c);null==b.minValue&&(b.minValue=d);null==b.maxValue&&(b.maxValue=b.minValue);d=b.maxValue;return b})}},write:function(a,b,c,d){a=a.map(function(a){return a.write({},d)});this._areClassBreaksConsecutive()&&a.forEach(function(a){delete a.classMinValue});
b[c]=a}}},minValue:{type:Number,readOnly:!0,dependsOn:["classBreakInfos"],get:function(){return this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0},json:{read:!1,write:{overridePolicy:function(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}},defaultLabel:{type:String,value:null,json:{write:!0}},defaultSymbol:{types:l.rendererTypes,value:null,json:{origins:{"web-scene":{read:a.read,write:{target:{defaultSymbol:{types:l.rendererTypes3D}},
writer:a.writeTarget}}},read:a.read,write:a.writeTarget}},valueExpression:{type:String,value:null,json:{write:!0}},valueExpressionTitle:{type:String,value:null,json:{write:!0}},compiledFunc:{dependsOn:["valueExpression"],get:function(){return h.createFunction(this.valueExpression)}},legendOptions:{type:p,value:null,json:{write:!0}},field:{value:null,cast:function(a){return null==a?a:"function"===typeof a?a:d.ensureString(a)},json:{type:String,write:function(a,b,c,d){"string"===typeof a?b[c]=a:d&&
d.messages?d.messages.push(new e("property:unsupported","ClassBreaksRenderer.field set to a function cannot be written to JSON")):r.error(".field: cannot write field to JSON since it's not a string value")}}},isMaxInclusive:!0,normalizationField:{type:String,value:null,json:{write:!0}},normalizationTotal:{type:Number,value:null,json:{write:!0}},normalizationType:{type:k.apiValues,value:null,dependsOn:["normalizationField","normalizationTotal"],get:function(){var a=this._get("normalizationType"),b=
!!this.normalizationField,c=null!=this.normalizationTotal;if(b||c)a=b&&"field"||c&&"percent-of-total",b&&c&&console.warn("warning: both normalizationField and normalizationTotal are set!");else if("field"===a||"percent-of-total"===a)a=null;return a},json:{type:k.jsonValues,read:k.read,write:k.write}},requiredFields:{dependsOn:["field","normalizationField","valueExpression"]},type:{type:["class-breaks"],value:"class-breaks",json:{type:["classBreaks"]}}},constructor:function(){this.classBreakInfos=
[]},addClassBreakInfo:function(a,b,c){a="number"===typeof a?new q({minValue:a,maxValue:b,symbol:c}):t(f.clone(a));this.classBreakInfos.push(a);1===this.classBreakInfos.length&&this.notifyChange("minValue")},removeClassBreakInfo:function(a,b){var c,d,e=this.classBreakInfos.length;for(d=0;d<e;d++)if(c=[this.classBreakInfos[d].minValue,this.classBreakInfos[d].maxValue],c[0]==a&&c[1]==b){this.classBreakInfos.splice(d,1);break}},getBreakIndex:function(a,b){var c=this.field,d=this.classBreakInfos,e=a.attributes,
l=d.length,g=this.isMaxInclusive;if(this.valueExpression)a=h.executeFunction(this.compiledFunc,h.createExecContext(a,h.getViewInfo(b)));else if("function"===typeof c)a=c(a);else if(a=parseFloat(e[c]),b=this.normalizationType)if(c=parseFloat(this.normalizationTotal),e=parseFloat(e[this.normalizationField]),"log"===b)a=Math.log(a)*Math.LOG10E;else if("percent-of-total"===b&&!isNaN(c))a=a/c*100;else if("field"===b&&!isNaN(e)){if(isNaN(a)||isNaN(e))return-1;a/=e}if(null!=a&&!isNaN(a)&&"number"===typeof a)for(e=
0;e<l;e++)if(b=[d[e].minValue,d[e].maxValue],b[0]<=a&&(g?a<=b[1]:a<b[1]))return e;return-1},getClassBreakInfo:function(a,b){a=this.getBreakIndex(a,b);return-1!==a?this.classBreakInfos[a]:null},getSymbol:function(a,b){a=this.getBreakIndex(a,b);return-1<a?this.classBreakInfos[a].symbol:this.defaultSymbol},getSymbols:function(){var a=[];this.classBreakInfos.forEach(function(b){b.symbol&&a.push(b.symbol)});this.defaultSymbol&&a.push(this.defaultSymbol);return a},clone:function(){return new w({field:this.field,
backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:f.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:f.clone(this.visualVariables),
legendOptions:f.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},collectRequiredFields:function(a){this.inherited(arguments);[this.field,this.normalizationField].forEach(function(b){b&&(a[b]=!0)});this.valueExpression&&h.extractFieldNames(this.valueExpression).forEach(function(b){a[b]=!0})},_areClassBreaksConsecutive:function(){for(var a=this.classBreakInfos,b=1;b<a.length;b++)if(a[b-1].maxValue!==a[b].minValue)return!1;return!0}});return w})},"esri/renderers/Renderer":function(){define("../core/declare ../core/Accessor ../core/JSONSupport ../core/kebabDictionary ../core/screenUtils ../core/lang ../core/Error ../support/arcadeUtils ../webdoc/support/opacityUtils ../Color ./support/utils ./support/AuthoringInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p=e({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),q=e({widthAndDepth:"width-and-depth"}),r=e({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});e=e({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap"},
{ignoreUnknown:!0});var t=Math.PI,w=b.opacityToTransparency,u=b.transparencyToOpacity;return m([f,k],{declaredClass:"esri.renderers.Renderer",properties:{authoringInfo:{type:n,value:null,json:{write:!0}},requiredFields:{dependsOn:["visualVariables"],get:function(){var a=Object.create(null);this.collectRequiredFields(a);return Object.keys(a).sort()}},type:{type:e.apiValues,readOnly:!0,json:{type:e.jsonValues,read:!1,write:{writer:e.write,ignoreOrigin:!0}}},visualVariables:{json:{read:{source:["visualVariables",
"rotationType","rotationExpression"],reader:function(a,b){return this._readVariables(a,b)}},write:function(a,b,c,d){var e=[];a.forEach(function(a,b){"size"===a.type?e.push(this._writeSizeInfo(a,d,b)):"color"===a.type?e.push(this._writeColorInfo(a,d,b)):"opacity"===a.type?e.push(this._writeOpacityInfo(a,d,b)):"rotation"===a.type&&e.push(this._writeRotationInfo(a,d,b))},this);b.visualVariables=e}}}},constructor:function(){this._cache={}},_rotationRE:/^\[([^\]]+)\]$/i,_viewScaleRE:/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,
_visualVariablesSetter:function(a){var b=this._cache;this.visualVariables&&this.visualVariables.forEach(function(a,c){b.hasOwnProperty(c)&&(b[c]=null)},this);a&&a.some(function(a){return!!a.target})&&a.sort(function(a,b){return a.target===b.target?0:a.target?1:-1});a&&a.forEach(function(a,c){"color"===a.type?b[c]=this._processColorInfo(a):"opacity"===a.type?b[c]=this._processOpacityInfo(a):"size"===a.type?b[c]=this._processSizeInfo(a):"rotation"===a.type&&(b[c]=this._processRotationInfo(a))},this);
this._set("visualVariables",a)},getSymbol:function(a,b){},getVisualVariableValues:function(a,b){var c=this.visualVariables,e;c&&(e=c.map(function(c){var e,h=c.type,l=h+"Info";b=d.mixin({},b);b[l]=c;switch(h){case "size":e=this.getSize(a,b);break;case "color":e=this.getColor(a,b);break;case "opacity":e=this.getOpacity(a,b);break;case "rotation":e=this.getRotationAngle(a,b)}return{variable:c,value:e}},this).filter(function(a){return null!=a.value},this));return e},hasVisualVariables:function(a,b){return a?
!!this.getVisualVariablesForType(a,b):!!(this.getVisualVariablesForType("size",b)||this.getVisualVariablesForType("color",b)||this.getVisualVariablesForType("opacity",b)||this.getVisualVariablesForType("rotation",b))},getVisualVariablesForType:function(a,b){var c=this.visualVariables,d;c&&(d=c.filter(function(c){return c.type===a&&("string"===typeof b?c.target===b:!1===b?!c.target:!0)}))&&0===d.length&&(d=void 0);return d},getSize:function(a,b){var c=this._getVarInfo(b&&b.sizeInfo,"size"),d=c.variable,
c=this._cache[c.cacheKey],e=null;if(d)var h=d.minSize,e=d.maxSize,h="object"===typeof h&&h?this._getSize(a,h,c&&c.minSize,b):h,e="object"===typeof e&&e?this._getSize(a,e,c&&c.maxSize,b):e,e=this._getSize(a,d,c&&c.root,b,[h,e]);return e},getSizeRangeAtScale:function(a,b){var c;a=this._getVarInfo(a,"size");var d=this._cache[a.cacheKey],e={scale:b};if((a=a.variable)&&b){b=a.minSize;var h=a.maxSize;a="object"===typeof b&&b?this._getSize({},b,d&&d.minSize,e):b;d="object"===typeof h&&h?this._getSize({},
h,d&&d.maxSize,e):h;if(null!=a||null!=d)a>d&&(c=d,d=a,a=c),c={minSize:a,maxSize:d}}return c},getColor:function(a,b){var c=this._getVarInfo(b&&b.colorInfo,"color");return this._getColorComponent(a,c.variable,this._cache[c.cacheKey],b,!1)},getOpacity:function(a,b){var c=this._getVarInfo(b&&b.opacityInfo,"opacity");return this._getColorComponent(a,c.variable,this._cache[c.cacheKey],b,!0)},getRotationAngle:function(a,b){var d=this._getVarInfo(b&&b.rotationInfo,"rotation"),e=d.variable,h=this._cache[d.cacheKey],
l=e.axis||"heading",d="heading"===l&&"arithmetic"===e.rotationType?90:0,l="heading"===l&&"arithmetic"===e.rotationType?-1:1,e=e.field,h=h&&h.compiledFunc,g=a.attributes,k=0;if(e||h)h?k=c.executeFunction(h,c.createExecContext(a,c.getViewInfo(b))):"function"===typeof e?k=e.apply(this,arguments):g&&(k=g[e]||0),k="number"!==typeof k||isNaN(k)?null:d+l*k;return k},collectRequiredFields:function(a){var b=[];this.visualVariables&&(b=b.concat(this.visualVariables));b.forEach(function(b){b&&(b.field&&(a[b.field]=
!0),b.normalizationField&&(a[b.normalizationField]=!0),b.valueExpression&&c.extractFieldNames(b.valueExpression).forEach(function(b){a[b]=!0}))})},_getVarInfo:function(a,b){var c;a&&a.type===b&&this.visualVariables?(c=this.visualVariables.indexOf(a),a=this.visualVariables[c]):this.visualVariables&&(a=(a=this.getVisualVariablesForType(b))&&a[0],c=this.visualVariables.indexOf(a));return{variable:a,cacheKey:c}},_readSizeInfo:function(a){a.axis&&(a.axis=q.fromJSON(a.axis));a.valueUnit&&(a.valueUnit=r.fromJSON(a.valueUnit));
return a},_readColorInfo:function(b){b&&(b.colors&&b.colors.forEach(function(c,d){Array.isArray(c)?b.colors[d]=a.fromJSON(c):b.colors[d]=new a(c)}),b.stops&&b.stops.forEach(function(c,d){c.color&&Array.isArray(c.color)?b.stops[d].color=a.fromJSON(c.color):c.color&&(b.stops[d].color=new a(c.color))}));return b},_readOpacityInfo:function(a){var b;a&&(b=d.mixin({},a),b.transparencyValues&&(b.opacityValues=b.transparencyValues.map(u),delete b.transparencyValues),b.stops&&(b.stops=b.stops.map(function(a){a=
d.mixin({},a);a.opacity=u(a.transparency);delete a.transparency;return a})));return b},_readVariables:function(a,b){a&&(a=a.map(function(a){a=d.clone(a);a.type=p.fromJSON(a.type);"size"===a.type?a=this._readSizeInfo(a):"color"===a.type?a=this._readColorInfo(a):"opacity"===a.type&&(a=this._readOpacityInfo(a));return a},this));var c=b.rotationType;if(b=b.rotationExpression)c={type:"rotation",rotationType:c},(b=b.match(this._rotationRE))&&b[1]&&(c.field=b[1],a||(a=[]),a.push(c));return a},_createCache:function(a){var b=
a&&a.valueExpression,d=c.createSyntaxTree(b),d=c.createFunction(d),e=!(!a||!a.expression)||this._viewScaleRE.test(b);return{ipData:this._interpolateData(a),hasExpr:!!b,compiledFunc:d,isScaleDriven:e}},_processColorInfo:function(b){b&&(b.colors&&b.colors.forEach(function(c,d){c instanceof a||(b.colors[d]=new a(c))}),b.stops&&b.stops.forEach(function(c,d){!c.color||c.color instanceof a||(b.stops[d].color=new a(c.color))}),this._sortStops(b.stops));return this._createCache(b)},_processOpacityInfo:function(a){this._sortStops(a&&
a.stops);return this._createCache(a)},_processSizeInfo:function(a){a.stops&&Array.isArray(a.stops)?a.stops=this._processSizeInfoStops(a.stops):(a.minSize=a.minSize&&this._processSizeInfoSize(a.minSize),a.maxSize=a.maxSize&&this._processSizeInfoSize(a.maxSize));return{root:this._createCache(a),minSize:this._createCache(a.minSize),maxSize:this._createCache(a.maxSize)}},_processSizeInfoSize:function(a){"object"===typeof a?a.stops=this._processSizeInfoStops(a.stops):a=g.toPt(a);return a},_processSizeInfoStops:function(a){a&&
Array.isArray(a)&&(a.forEach(function(a){a.size=g.toPt(a.size)}),this._sortStops(a));return a},_sortStops:function(a){a&&Array.isArray(a)&&a.sort(function(a,b){return a.value-b.value})},_processRotationInfo:function(a){return this._createCache(a)},_getSize:function(a,b,d,e,h){var g=a.attributes,k=b.field,n=b.stops,f=0,p=d&&d.hasExpr,q=d&&d.compiledFunc,r=d&&d.ipData,m=d&&d.isScaleDriven,u="number"===typeof a,v=u?a:null;if(k||m||p){var w=e&&e.scale,y=h?h[0]:b.minSize,z=h?h[1]:b.maxSize,x=b.minDataValue,
A=b.maxDataValue,P=b.valueUnit||"unknown",L=b.valueRepresentation,f=b.scaleBy,T=b.normalizationField,S=g?parseFloat(g[T]):void 0,W=e&&e.shape;m?v=null==w?this._getAverageValue(b):w:"number"!==typeof v&&(p?v=c.executeFunction(q,c.createExecContext(a,c.getViewInfo(e))):"function"===typeof k?v=k.apply(this,arguments):g&&(v=g[k]));if(null==v||T&&!u&&(isNaN(S)||0===S))return null;isNaN(S)||u||(v/=S);if(n)z=this._lookupData(v,r),v=z[0],y=z[1],v===y?f=n[v].size:(v=n[v].size,n=n[y].size,f=v+(n-v)*z[2]);else if(null!=
y&&null!=z&&null!=x&&null!=A)v<=x?f=y:v>=A?f=z:(n=(v-x)/(A-x),"area"===f&&W?(y=(v="circle"===W)?t*Math.pow(y/2,2):y*y,n=y+n*((v?t*Math.pow(z/2,2):z*z)-y),f=v?2*Math.sqrt(n/t):Math.sqrt(n)):f=y+n*(z-y));else if("unknown"===P)null!=y&&null!=x?(y&&x?(n=v/x,f="circle"===W?2*Math.sqrt(n*Math.pow(y/2,2)):"square"===W||"diamond"===W||"image"===W?Math.sqrt(n*Math.pow(y,2)):n*y):f=v+(y||x),f=f<y?y:f,null!=z&&f>z&&(f=z)):f=v;else{n=(e&&e.resolution?e.resolution:1)*l.meterIn[P];if("area"===L)f=Math.sqrt(v/t)/
n,f*=2;else if(f=v/n,"radius"===L||"distance"===L)f*=2;null!=y&&f<y&&(f=y);null!=z&&f>z&&(f=z)}}else b&&(f=n&&n[0]&&n[0].size,null==f&&(f=b.minSize));return f=isNaN(f)?0:f},_getAverageValue:function(a){var b=a.stops,c;b?(c=b[0].value,a=b[b.length-1].value):(c=a.minDataValue||0,a=a.maxDataValue||0);return(c+a)/2},_getColorComponent:function(a,b,d,e,h){var l=a.attributes,g=b&&b.field,k="number"===typeof a,n=k?a:null,f=d&&d.hasExpr,p=d&&d.compiledFunc,q=d&&d.ipData,r;if(g||f){var m=b.normalizationField,
u=l&&m?parseFloat(l[m]):void 0;"number"!==typeof n&&(f?n=c.executeFunction(p,c.createExecContext(a,c.getViewInfo(e))):"function"===typeof g?n=g.apply(this,arguments):l&&(n=l[g]));null==n||m&&!k&&(isNaN(u)||0===u)||(isNaN(u)||k||(n/=u),r=h?this._getOpacity(n,b,q):this._getColor(n,b,q,e&&e.color))}else b&&(l=b.stops,h?(r=l&&l[0]&&l[0].opacity,null==r&&(r=b.opacityValues&&b.opacityValues[0])):r=l&&l[0]&&l[0].color||b.colors&&b.colors[0]);return r},_interpolateData:function(a){var b;if(a)if(a.colors||
a.opacityValues){var c=(a.colors||a.opacityValues).length,d=a.minDataValue,e=(a.maxDataValue-d)/(c-1);b=[];for(a=0;a<c;a++)b[a]=d+a*e}else a.stops&&(b=a.stops.map(function(a){return a.value||0}));return b},_getOpacity:function(a,b,c){a=this._lookupData(a,c);var d;b=b||this.opacityInfo;a&&(c=a[0],d=a[1],c===d?d=this._getOpacValue(b,c):(c=this._getOpacValue(b,c),b=this._getOpacValue(b,d),d=c+(b-c)*a[2]));return d},_getOpacValue:function(a,b){return a.opacityValues?a.opacityValues[b]:a.stops[b].opacity},
_getColor:function(b,c,d,e){b=this._lookupData(b,d);c=c||this.colorInfo;if(b){d=b[0];var h=b[1];e=e||new a;d===h?e.setColor(this._getColorObj(c,d)):a.blendColors(this._getColorObj(c,d),this._getColorObj(c,h),b[2],e);return e}},_getColorObj:function(a,b){return a.colors?a.colors[b]:a.stops[b].color},_lookupData:function(a,b){var c;if(b){var d=0,e=b.length-1;b.some(function(b,c){if(a<b)return e=c,!0;d=c;return!1});c=[d,e,(a-b[d])/(b[e]-b[d])]}return c},_processForContext:function(a,b,c){if(b&&"web-scene"===
b.origin){var d=null!=a.expression,e=null!=a.valueExpressionTitle&&"rotation"===a.type;b.messages&&(d&&b.messages.push(new h("property:unsupported",a.type+"VisualVariable.expression is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:c+".expression",context:b})),e&&b.messages.push(new h("property:unsupported",a.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,
propertyName:c+".valueExpressionTitle",context:b})));d&&delete a.expression;e&&delete a.valueExpressionTitle}else"size"===a.type&&this._convertExpressionToArcade(a)},_writeRotationInfo:function(a,b,c){a&&(a=d.mixin({},a),this._processForContext(a,b,"visualVariables["+c+"]"),a.type=p.toJSON(a.type),a=d.fixJson(a,!0));return a},_convertExpressionToArcade:function(a){a&&a.expression&&(a.valueExpression="$view.scale")},_writeSizeInfo:function(a,b,c){if(a){a=d.mixin({},a);this._processForContext(a,b,"string"===
typeof c?c:"visualVariables["+c+"]");var e=a.minSize,h=a.maxSize;e&&(a.minSize="number"===typeof e?e:this._writeSizeInfo(e,b,"visualVariables["+c+"].minSize"));h&&(a.maxSize="number"===typeof h?h:this._writeSizeInfo(h,b,"visualVariables["+c+"].maxSize"));b=a.legendOptions;c=a.axis;a.type=p.toJSON(a.type);c&&(a.axis=q.toJSON(c));b&&(a.legendOptions=d.mixin({},b),b=b.customValues)&&(a.legendOptions.customValues=b.slice(0));a.stops&&(a.stops=a.stops.map(function(a){a=d.mixin({},a);null===a.label&&delete a.label;
return a}));a=d.fixJson(a,!0)}return a},_writeColorInfo:function(b,c,e){b&&(b=d.mixin({},b),this._processForContext(b,c,"visualVariables["+e+"]"),b.type=p.toJSON(b.type),b.colors&&(b.colors=b.colors.map(function(b){return a.toJSON(b)})),b.stops&&(b.stops=b.stops.map(function(b){b=d.mixin({},b);b.color&&(b.color=a.toJSON(b.color));null==b.value&&(b.value=0);null===b.label&&delete b.label;return b})),b.legendOptions&&(b.legendOptions=d.mixin({},b.legendOptions)),b=d.fixJson(b,!0));return b},_writeOpacityInfo:function(a,
b,c){var e;a&&(e=d.mixin({},a),this._processForContext(e,b,"visualVariables["+c+"]"),e.type=p.toJSON(e.type),e.opacityValues&&(e.transparencyValues=e.opacityValues.map(w),delete e.opacityValues),e.stops&&(e.stops=e.stops.map(function(a){a=d.mixin({},a);a.transparency=w(a.opacity);delete a.opacity;null===a.label&&delete a.label;return a})),e.legendOptions&&(e.legendOptions=d.mixin({},e.legendOptions)),e=d.fixJson(e,!0));return e}})})},"esri/renderers/support/AuthoringInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators ./AuthoringInfoVisualVariable".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=d({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),l=d({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance"}),n="inches feet yards miles nautical-miles millimeters centimeters decimeters meters kilometers decimal-degrees".split(" ");
return function(d){function g(a){a=d.call(this)||this;a.lengthUnit=null;a.visualVariables=null;return a}k(g,d);f=g;Object.defineProperty(g.prototype,"classificationMethod",{get:function(){var a=this._get("classificationMethod"),b=this.type;return b&&"relationship"!==b?"class-breaks-size"===b||"class-breaks-color"===b?a||"manual":null:a},set:function(a){this._set("classificationMethod",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"fields",{get:function(){return this.type&&
"predominance"!==this.type?null:this._get("fields")},set:function(a){this._set("fields",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"field1",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field1")},set:function(a){this._set("field1",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"field2",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field2")},set:function(a){this._set("field2",a)},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"focus",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("focus")},set:function(a){this._set("focus",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"numClasses",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")},set:function(a){this._set("numClasses",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"standardDeviationInterval",{get:function(){var a=
this.type;return a&&"relationship"!==a&&"class-breaks-size"!==a&&"class-breaks-color"!==a?null:this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")},set:function(a){this._set("standardDeviationInterval",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"type",{get:function(){return this._get("type")},set:function(a){var b=a;"classed-size"===a?b="class-breaks-size":"classed-color"===a&&(b="class-breaks-color");this._set("type",
b)},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new f({classificationMethod:this.classificationMethod,fields:this.fields&&this.fields.slice(0),field1:h.clone(this.field1),field2:h.clone(this.field2),focus:this.focus,numClasses:this.numClasses,lengthUnit:this.lengthUnit,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(function(a){return a.clone()})})};var f;e([c.property({type:a.apiValues,
value:null,dependsOn:["type"],json:{type:a.jsonValues,read:a.read,write:a.write}})],g.prototype,"classificationMethod",null);e([c.property({type:[String],value:null,dependsOn:["type"],json:{write:!0}})],g.prototype,"fields",null);e([c.property({value:null,dependsOn:["type"],json:{write:!0}})],g.prototype,"field1",null);e([c.property({value:null,dependsOn:["type"],json:{write:!0}})],g.prototype,"field2",null);e([c.property({type:String,value:null,dependsOn:["type"],json:{write:!0}})],g.prototype,"focus",
null);e([c.property({type:Number,value:null,dependsOn:["type"],json:{write:!0}})],g.prototype,"numClasses",null);e([c.property({type:n,json:{type:n,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],g.prototype,"lengthUnit",void 0);e([c.property({type:[.25,.33,.5,1],value:null,dependsOn:["classificationMethod","type"],json:{type:[.25,.33,.5,1],write:!0}})],g.prototype,"standardDeviationInterval",null);e([c.property({type:String,value:null,json:{type:l.jsonValues,read:l.read,write:l.write}})],
g.prototype,"type",null);e([c.property({type:[b],json:{write:!0}})],g.prototype,"visualVariables",void 0);return g=f=e([c.subclass("esri.renderers.support.AuthoringInfo")],g)}(c.declared(g))})},"esri/renderers/support/AuthoringInfoVisualVariable":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators ../../core/accessorSupport/decorators/cast".split(" "),
function(m,f,k,e,g,d,h,c){var b=d({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),a=d({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity"}),l={key:function(a){return"number"===typeof a?"number":"string"},typeMap:{number:Number,string:String},base:null},n=["high-to-low","above-and-below","centered-on","extremes"],p="seconds minutes hours days months years".split(" ");return function(d){function g(a){a=d.call(this)||this;a.endTime=null;a.field=null;a.maxSliderValue=null;
a.minSliderValue=null;a.startTime=null;a.type=null;a.units=null;return a}k(g,d);f=g;g.prototype.castEndTime=function(a){return"string"===typeof a||"number"===typeof a?a:null};g.prototype.castStartTime=function(a){return"string"===typeof a||"number"===typeof a?a:null};Object.defineProperty(g.prototype,"style",{get:function(){return"color"===this.type?this._get("style"):null},set:function(a){this._set("style",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"theme",{get:function(){return"color"===
this.type?this._get("theme")||"high-to-low":null},set:function(a){this._set("theme",a)},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new f({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})};var f;e([h.property({types:l,json:{write:!0}})],g.prototype,"endTime",void 0);e([c.cast("endTime")],g.prototype,"castEndTime",null);e([h.property({type:String,
json:{write:!0}})],g.prototype,"field",void 0);e([h.property({type:Number,json:{write:!0}})],g.prototype,"maxSliderValue",void 0);e([h.property({type:Number,json:{write:!0}})],g.prototype,"minSliderValue",void 0);e([h.property({types:l,json:{write:!0}})],g.prototype,"startTime",void 0);e([c.cast("startTime")],g.prototype,"castStartTime",null);e([h.property({type:b.apiValues,value:null,dependsOn:["type"],json:{type:b.jsonValues,read:b.read,write:b.write}})],g.prototype,"style",null);e([h.property({type:n,
value:null,dependsOn:["type"],json:{type:n,write:!0}})],g.prototype,"theme",null);e([h.property({type:a.apiValues,json:{type:a.jsonValues,read:a.read,write:a.write}})],g.prototype,"type",void 0);e([h.property({type:p,json:{type:p,write:!0}})],g.prototype,"units",void 0);return g=f=e([h.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],g)}(h.declared(g))})},"esri/renderers/support/LegendOptions":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function c(){var a=null!==h&&h.apply(this,arguments)||this;a.title=null;return a}k(c,h);b=c;c.prototype.clone=function(){return new b({title:this.title})};var b;e([d.property({type:String,json:{write:!0}})],c.prototype,"title",void 0);return c=b=e([d.subclass("esri.renderers.support.LegendOptions")],c)}(d.declared(g));f.LegendOptions=m;f.default=m})},"esri/renderers/support/ClassBreakInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../symbols/support/jsonUtils ../../symbols/support/typeUtils".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.minValue=null;a.maxValue=0;a.symbol=null;return a}k(a,b);l=a;a.prototype.clone=function(){return new l({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})};var l;e([d.property({type:String,json:{write:!0}})],a.prototype,"description",
void 0);e([d.property({type:String,json:{write:!0}})],a.prototype,"label",void 0);e([d.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],a.prototype,"minValue",void 0);e([d.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],a.prototype,"maxValue",void 0);e([d.property({types:c.rendererTypes,json:{origins:{"web-scene":{read:h.read,write:{target:{symbol:{types:c.rendererTypes3D}},writer:h.writeTarget}}},read:h.read,
write:h.writeTarget}})],a.prototype,"symbol",void 0);return a=l=e([d.subclass("esri.renderers.support.ClassBreakInfo")],a)}(d.declared(g));f.ClassBreakInfo=m;f.default=m})},"esri/renderers/HeatmapRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Color ../core/lang ../core/accessorSupport/decorators ./Renderer ./support/HeatmapColorStop".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function c(c){c=a.call(this)||this;
c.blurRadius=10;c.colorStops=[new b.HeatmapColorStop({ratio:0,color:new g("rgba(255, 140, 0, 0)")}),new b.HeatmapColorStop({ratio:.75,color:new g("rgba(255, 140, 0, 1)")}),new b.HeatmapColorStop({ratio:.9,color:new g("rgba(255, 0,   0, 1)")})];c.field=null;c.fieldOffset=0;c.maxPixelIntensity=100;c.minPixelIntensity=0;c.type="heatmap";return c}k(c,a);n=c;c.prototype.clone=function(){return new n({blurRadius:this.blurRadius,colorStops:d.clone(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,
minPixelIntensity:this.minPixelIntensity})};var n;e([h.property({type:Number,json:{write:!0}})],c.prototype,"blurRadius",void 0);e([h.property({type:[b.HeatmapColorStop],json:{write:!0}})],c.prototype,"colorStops",void 0);e([h.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);e([h.property({type:Number,json:{write:{overridePolicy:function(a,b,c){return{enabled:null==c}}}}})],c.prototype,"fieldOffset",void 0);e([h.property({type:Number,json:{write:!0}})],c.prototype,"maxPixelIntensity",
void 0);e([h.property({type:Number,json:{write:!0}})],c.prototype,"minPixelIntensity",void 0);e([h.property({dependsOn:["field"],readOnly:!0})],c.prototype,"requiredFields",void 0);e([h.enumeration.serializable()({heatmap:"heatmap"})],c.prototype,"type",void 0);return c=n=e([h.subclass("esri.renderers.HeatmapRenderer")],c)}(h.declared(c))})},"esri/renderers/support/HeatmapColorStop":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(a){a=c.call(this)||this;a.color=null;a.ratio=null;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({color:this.color,ratio:this.ratio})};var a;e([h.property({type:g,json:{write:!0}})],b.prototype,"color",void 0);e([h.property({type:Number,json:{write:!0}})],b.prototype,"ratio",void 0);return b=a=e([h.subclass("esri.renderers.support.HeatmapColorStop")],b)}(h.declared(d));f.HeatmapColorStop=
m;f.default=m})},"esri/renderers/SimpleRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./Renderer ../symbols/support/jsonUtils ../symbols/support/typeUtils".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.symbol=null;b.type="simple";return b}k(h,a);n=h;h.prototype.writeSymbolWebScene=
function(a,b,d,e){c.writeTarget(a,b,d,e)};h.prototype.writeSymbol=function(a,b,d,e){c.writeTarget(a,b,d,e)};h.prototype.readSymbol=function(a,b,d){return c.read(a,b,d)};h.prototype.getSymbol=function(a,b){return this.symbol};h.prototype.getSymbols=function(){return this.symbol?[this.symbol]:[]};h.prototype.clone=function(){return new n({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:g.clone(this.visualVariables),authoringInfo:this.authoringInfo&&
this.authoringInfo.clone()})};var n;e([d.property({type:String,json:{write:!0}})],h.prototype,"description",void 0);e([d.property({type:String,json:{write:!0}})],h.prototype,"label",void 0);e([d.property({types:b.rendererTypes})],h.prototype,"symbol",void 0);e([d.writer("web-scene","symbol",{symbol:{types:b.rendererTypes3D}})],h.prototype,"writeSymbolWebScene",null);e([d.writer("symbol")],h.prototype,"writeSymbol",null);e([d.reader("symbol")],h.prototype,"readSymbol",null);e([d.enumeration.serializable()({simple:"simple"})],
h.prototype,"type",void 0);return h=n=e([d.subclass("esri.renderers.SimpleRenderer")],h)}(d.declared(h))})},"esri/renderers/UniqueValueRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../symbols ../core/arrayUtils ../core/Error ../core/lang ../core/Logger ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../portal/Portal ./Renderer ./support/diffUtils ./support/LegendOptions ./support/UniqueValueInfo ../support/arcadeUtils ../symbols/support/jsonUtils ../symbols/support/styleUtils ../symbols/support/typeUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y){var A=a.getLogger("esri.renderers.UniqueValueRenderer"),B=p.ensureType(u.default);return function(a){function f(b){b=a.call(this)||this;b._valueInfoMap={};b._isDefaultSymbolDerived=!1;b.type="unique-value";b.backgroundFillSymbol=null;b.field=null;b.field2=null;b.field3=null;b.valueExpression=null;b.valueExpressionTitle=null;b.legendOptions=null;b.defaultLabel=null;b.fieldDelimiter=null;b.portal=null;b.styleOrigin=null;b.diff={uniqueValueInfos:function(a,
b){if(a||b){if(!a||!b)return{type:"complete",oldValue:a,newValue:b};for(var c=!1,d={type:"collection",added:[],removed:[],changed:[],unchanged:[]},e=function(e){var l=h.find(a,function(a){return a.value===b[e].value});l?t.diff(l,b[e])?d.changed.push({type:"complete",oldValue:l,newValue:b[e]}):d.unchanged.push({oldValue:l,newValue:b[e]}):d.added.push(b[e]);c=!0},l=0;l<b.length;l++)e(l);e=function(e){h.find(b,function(b){return b.value===a[e].value})||(d.removed.push(a[e]),c=!0)};for(l=0;l<a.length;l++)e(l);
return c?d:void 0}}};b._set("uniqueValueInfos",[]);return b}k(f,a);r=f;f.prototype.writeBackgroundFillSymbolWebScene=function(a,b,c,d){v.writeTarget(a,b,c,d)};f.prototype.castField=function(a){return null==a?a:"function"===typeof a?a:p.ensureString(a)};f.prototype.writeField=function(a,b,d,e){"string"===typeof a?b[d]=a:e&&e.messages?e.messages.push(new c("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):A.error(".field: cannot write field to JSON since it's not a string value")};
Object.defineProperty(f.prototype,"compiledFunc",{get:function(){return x.createFunction(this.valueExpression)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"defaultSymbol",{set:function(a){this._isDefaultSymbolDerived=!1;this._set("defaultSymbol",a)},enumerable:!0,configurable:!0});f.prototype.readDefaultSymbol=function(a,b,c){return v.read(a,b,c)};f.prototype.writeDefaultSymbolWebScene=function(a,b,c,d){this._isDefaultSymbolDerived||v.writeTarget(a,b,c,d)};f.prototype.writeDefaultSymbol=
function(a,b,c,d){this._isDefaultSymbolDerived||v.writeTarget(a,b,c,d)};f.prototype.readPortal=function(a,b,c){return c.portal||q.getDefault()};f.prototype.readStyleOrigin=function(a,b,c){if(b.styleName)return Object.freeze({styleName:b.styleName});if(b.styleUrl)return a=l.read(b.styleUrl,c),Object.freeze({styleUrl:a})};f.prototype.writeStyleOrigin=function(a,b,c,d){a.styleName?b.styleName=a.styleName:a.styleUrl&&(b.styleUrl=l.write(a.styleUrl,d),l.isAbsolute(b.styleUrl)&&(b.styleUrl=l.normalize(b.styleUrl)))};
Object.defineProperty(f.prototype,"uniqueValueInfos",{set:function(a){this.styleOrigin?A.error("#uniqueValueInfos\x3d","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",a),this._updateValueInfoMap())},enumerable:!0,configurable:!0});f.prototype.addUniqueValueInfo=function(a,b){this.styleOrigin?A.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(a="object"===typeof a?
B(a):new u.default({value:a,symbol:b}),this.uniqueValueInfos.push(a),this._valueInfoMap[a.value]=a)};f.prototype.removeUniqueValueInfo=function(a){if(this.styleOrigin)A.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var b=0;b<this.uniqueValueInfos.length;b++)if(this.uniqueValueInfos[b].value===a+""){delete this._valueInfoMap[a];this.uniqueValueInfos.splice(b,1);break}};f.prototype.getUniqueValueInfo=function(a,b){var c=
this.field,d=a.attributes,e;this.valueExpression?e=x.executeFunction(this.compiledFunc,x.createExecContext(a,x.getViewInfo(b))):"function"!==typeof c&&this.field2?(a=this.field2,b=this.field3,e=[],c&&e.push(d[c]),a&&e.push(d[a]),b&&e.push(d[b]),e=e.join(this.fieldDelimiter||"")):"function"===typeof c?e=c(a):c&&(e=d[c]);return this._valueInfoMap[e+""]};f.prototype.getSymbol=function(a,b){return(a=this.getUniqueValueInfo(a,b))&&a.symbol||this.defaultSymbol};f.prototype.getSymbols=function(){for(var a=
[],b=0,c=this.uniqueValueInfos;b<c.length;b++){var d=c[b];d.symbol&&a.push(d.symbol)}this.defaultSymbol&&a.push(this.defaultSymbol);return a};f.prototype.clone=function(){var a=new r({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:b.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:b.clone(this.visualVariables),legendOptions:b.clone(this.legendOptions),
authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:b.clone(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(a._isDefaultSymbolDerived=!0);a._set("portal",this.portal);var c=b.clone(this.uniqueValueInfos);this.styleOrigin&&(a._set("styleOrigin",Object.freeze(b.clone(this.styleOrigin))),Object.freeze(c));a._set("uniqueValueInfos",c);a._updateValueInfoMap();return a};f.prototype.collectRequiredFields=function(a){this.inherited(arguments);[this.field,this.field2,
this.field3].forEach(function(b){b&&"string"===typeof b&&(a[b]=!0)});this.valueExpression&&x.extractFieldNames(this.valueExpression).forEach(function(b){a[b]=!0})};f.prototype.populateFromStyle=function(){var a=this;return z.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(b){var c=[];a._valueInfoMap={};b&&b.data&&Array.isArray(b.data.items)&&b.data.items.forEach(function(e){var h=new d.WebStyleSymbol({styleUrl:b.styleUrl,styleName:b.styleName,portal:a.portal,name:e.name});a.defaultSymbol||
e.name!==b.data.defaultItem||(a.defaultSymbol=h,a._isDefaultSymbolDerived=!0);h=new u.default({value:e.name,symbol:h});c.push(h);a._valueInfoMap[e.name]=h});a._set("uniqueValueInfos",Object.freeze(c));!a.defaultSymbol&&a.uniqueValueInfos.length&&(a.defaultSymbol=a.uniqueValueInfos[0].symbol,a._isDefaultSymbolDerived=!0);return a})};f.prototype._updateValueInfoMap=function(){var a=this;this._valueInfoMap={};this.uniqueValueInfos.forEach(function(b){return a._valueInfoMap[b.value+""]=b})};f.fromPortalStyle=
function(a,b){var c=new r(b&&b.properties);c._set("styleOrigin",Object.freeze({styleName:a}));c._set("portal",b&&b.portal||q.getDefault());b=c.populateFromStyle();b.catch(function(b){A.error("#fromPortalStyle('"+a+"'[, ...])","Failed to create unique value renderer from style name",b)});return b};f.fromStyleUrl=function(a,b){b=new r(b&&b.properties);b._set("styleOrigin",Object.freeze({styleUrl:a}));b=b.populateFromStyle();b.catch(function(b){A.error("#fromStyleUrl('"+a+"'[, ...])","Failed to create unique value renderer from style URL",
b)});return b};var r;e([n.enumeration.serializable()({uniqueValue:"unique-value"})],f.prototype,"type",void 0);e([n.property({types:{base:d.BaseSymbol,key:"type",typeMap:{"simple-fill":y.rendererTypes.typeMap["simple-fill"],"picture-fill":y.rendererTypes.typeMap["picture-fill"],"polygon-3d":y.rendererTypes.typeMap["polygon-3d"]}},json:{read:v.read,write:v.writeTarget}})],f.prototype,"backgroundFillSymbol",void 0);e([n.writer("web-scene","backgroundFillSymbol",{backgroundFillSymbol:{type:d.PolygonSymbol3D}})],
f.prototype,"writeBackgroundFillSymbolWebScene",null);e([n.property({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],f.prototype,"field",void 0);e([n.cast("field")],f.prototype,"castField",null);e([n.writer("field")],f.prototype,"writeField",null);e([n.property({type:String,json:{write:!0}})],f.prototype,"field2",void 0);e([n.property({type:String,json:{write:!0}})],f.prototype,"field3",void 0);e([n.property({type:String,json:{write:!0}})],f.prototype,"valueExpression",void 0);
e([n.property({type:String,json:{write:!0}})],f.prototype,"valueExpressionTitle",void 0);e([n.property({dependsOn:["valueExpression"]})],f.prototype,"compiledFunc",null);e([n.property({type:w.default,json:{write:!0}})],f.prototype,"legendOptions",void 0);e([n.property({type:String,json:{write:!0}})],f.prototype,"defaultLabel",void 0);e([n.property({types:y.rendererTypes})],f.prototype,"defaultSymbol",null);e([n.reader("defaultSymbol")],f.prototype,"readDefaultSymbol",null);e([n.writer("web-scene",
"defaultSymbol",{defaultSymbol:{types:y.rendererTypes3D}})],f.prototype,"writeDefaultSymbolWebScene",null);e([n.writer("defaultSymbol")],f.prototype,"writeDefaultSymbol",null);e([n.property({type:String,json:{write:!0}})],f.prototype,"fieldDelimiter",void 0);e([n.property({type:q,readOnly:!0})],f.prototype,"portal",void 0);e([n.reader("portal",["styleName"])],f.prototype,"readPortal",null);e([n.property({readOnly:!0})],f.prototype,"styleOrigin",void 0);e([n.reader("styleOrigin",["styleName","styleUrl"])],
f.prototype,"readStyleOrigin",null);e([n.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],f.prototype,"writeStyleOrigin",null);e([n.property({type:[u.default],json:{write:{overridePolicy:function(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],f.prototype,"uniqueValueInfos",null);e([n.property({dependsOn:["field","field2","field3","valueExpression"],readOnly:!0})],f.prototype,"requiredFields",void 0);e([g(1,n.cast(y.ensureType))],f.prototype,"addUniqueValueInfo",null);
return f=r=e([n.subclass("esri.renderers.UniqueValueRenderer")],f)}(n.declared(r))})},"esri/core/arrayUtils":function(){define(["require","exports"],function(m,f){function k(a,b,c){for(var d=a.length,e=0;e<d;e++)if(b.call(c,a[e],e,a))return e;return-1}function e(b,c,d,e){void 0===d&&(d=b.length);e=e||a;for(var h=Math.max(0,e.last-10),l=-1,g=h;g<d;++g)if(b[g]===c){l=g;break}if(-1===l){for(g=0;g<h;++g)if(b[g]===c){l=g;break}if(-1===l)return}b[l]=b[d-1];b.pop();e.last=l;return c}function g(a,b,c,d){void 0===
c&&(c=a.length);var h=[];b.forEach(function(b){void 0!==e(a,b,c,d)&&(h.push(b),--c)});return h}function d(a,b){return-1===a.indexOf(b)}function h(a,b,c){return!a.some(b.bind(null,c))}function c(a){return a}Object.defineProperty(f,"__esModule",{value:!0});f.findIndex=k;f.find=function(a,b,c){for(var d=a.length,e=0;e<d;e++){var h=a[e];if(b.call(c,h,e,a))return h}};f.unique=function(a){return a.filter(function(a,b,c){return c.indexOf(a)===b})};f.equals=function(a,b,c){if(!a&&!b)return!0;if(!a||!b||a.length!==
b.length)return!1;if(c)for(var d=0;d<a.length;d++){if(!c(a[d],b[d]))return!1}else for(d=0;d<a.length;d++)if(a[d]!==b[d])return!1;return!0};f.difference=function(a,b,c){var e;c?(e=b.filter(h.bind(null,a,c)),a=a.filter(h.bind(null,b,c))):(e=b.filter(d.bind(null,a)),a=a.filter(d.bind(null,b)));return{added:e,removed:a}};f.intersect=function(a,b,c){return a&&b?c?a.filter(function(a){return-1<k(b,function(b){return c(a,b)})}):a.filter(function(a){return-1<b.indexOf(a)}):[]};f.constant=function(a,b){for(var c=
Array(a),d=0;d<a;d++)c[d]=b;return c};f.range=function(a,b){void 0===b&&(b=a,a=0);for(var c=Array(b-a),d=a;d<b;d++)c[d-a]=d;return c};f.binaryIndexOf=function(a,b,c){for(var d=a.length,e=0,h=d-1;e<h;){var l=e+Math.floor((h-e)/2);b>a[l]?e=l+1:h=l}h=a[e];return c?b>=a[d-1]?-1:h===b?e:e-1:h===b?e:-1};var b=function(){return function(){this.last=0}}();f.RemoveHint=b;var a=new b;m=function(){return function(a){var c=this;this._array=a;this._hint=new b;this.remove=function(a){return e(c._array,a,c._array.length,
c._hint)};this.removeMany=function(a){return g(c._array,a,c._array.length,c._hint)}}}();f.UnorderedRemover=m;f.removeUnordered=e;f.removeUnorderedMany=g;f.keysOfMap=function(a){var b=[];a.forEach(function(a,c){return b.push(c)});return b};f.keysOfSet=function(a,b){void 0===b&&(b=c);var d=[];a.forEach(function(a){return d.push(b(a))});return d};f.fromMapValues=function(a){if(Array.from)return Array.from(a.values());var b=Array(a.size),c=0;a.forEach(function(a){b[c++]=a});return b}})},"esri/renderers/support/diffUtils":function(){define(["require",
"exports","../../core/Accessor","../../core/Collection","../../core/accessorSupport/utils"],function(m,f,k,e,g){function d(a){return a instanceof e?Object.keys(a.items):a instanceof k?g.getProperties(a).keys():a?Object.keys(a):[]}function h(a,b){return a instanceof e?a.items[b]:a[b]}function c(a,b){return Array.isArray(a)&&Array.isArray(b)?a.length!==b.length:!1}function b(a){return a?a.declaredClass:null}function a(e,g){var n=e.diff;if(n&&"function"===typeof n)return n(e,g);var f=d(e),p=d(g);if(0!==
f.length||0!==p.length){if(!f.length||!p.length||c(e,g))return{type:"complete",oldValue:e,newValue:g};var m=p.filter(function(a){return-1===f.indexOf(a)}),u=f.filter(function(a){return-1===p.indexOf(a)}),m=f.filter(function(a){return-1<p.indexOf(a)&&h(e,a)!==h(g,a)}).concat(m,u).sort();if((u=b(e))&&-1<l.indexOf(u)&&m.length)return{type:"complete",oldValue:e,newValue:g};var x,u=e instanceof k&&g instanceof k,v;for(v in m){var z=m[v],y=h(e,z),A=h(g,z),B=void 0;(u||"function"!==typeof y&&"function"!==
typeof A)&&y!==A&&(null!=y||null!=A)&&(B=n&&n[z]&&"function"===typeof n[z]?n[z](y,A):"object"===typeof y&&"object"===typeof A&&b(y)===b(A)?a(y,A):{type:"complete",oldValue:y,newValue:A})&&(x=x||{type:"partial",diff:{}},x.diff[z]=B)}return x}}Object.defineProperty(f,"__esModule",{value:!0});var l=["esri.Color","esri.portal.Portal"];f.diff=function(c,d){if("function"!==typeof c&&"function"!==typeof d&&(c||d))return!c||!d||"object"===typeof c&&"object"===typeof d&&b(c)!==b(d)?{type:"complete",oldValue:c,
newValue:d}:a(c,d)}})},"esri/renderers/support/UniqueValueInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../symbols/support/jsonUtils ../../symbols/support/typeUtils".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.symbol=
null;a.value=null;return a}k(a,b);l=a;a.prototype.clone=function(){return new l({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})};var l;e([d.property({type:String,json:{write:!0}})],a.prototype,"description",void 0);e([d.property({type:String,json:{write:!0}})],a.prototype,"label",void 0);e([d.property({types:c.rendererTypes,json:{origins:{"web-scene":{read:h.read,write:{target:{symbol:{types:c.rendererTypes3D}},writer:h.writeTarget}}},
read:h.read,write:h.writeTarget}})],a.prototype,"symbol",void 0);e([d.property({type:String,json:{write:!0}})],a.prototype,"value",void 0);return a=l=e([d.subclass("esri.renderers.support.UniqueValueInfo")],a)}(d.declared(g));f.UniqueValueInfo=m;f.default=m})},"esri/symbols/support/styleUtils":function(){define("require exports ../../request ../../symbols ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../portal/Portal ../../portal/PortalQueryParams ./jsonUtils ./StyleOrigin ./Thumbnail".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){function p(a,b){return u(a).then(function(b){return{data:b.data,baseUrl:h.removeFile(a),styleUrl:a}})}function q(a,b){b=b.portal||c.getDefault();var d,e=b.url+" - "+(b.user&&b.user.username)+" - "+a;x[e]||(x[e]=r(a,b).then(function(a){d=a;return a.fetchData()}).then(function(b){return{data:b,baseUrl:d.itemUrl,styleName:a}}));return x[e]}function r(a,c){return c.load().then(function(){var d=new b({disableExtraQuery:!0,query:"owner:"+v+" AND type:"+z+' AND typekeywords:"'+
a+'"'});return c.queryItems(d)}).then(function(b){b=b.results;var c=null,d=a.toLowerCase();if(b&&Array.isArray(b))for(var e=0;e<b.length;e++){var h=b[e];if(h.typeKeywords.some(function(a){return a.toLowerCase()===d})&&h.type===z&&h.owner===v){c=h;break}}if(c)return c.load();throw new g("symbolstyleutils:style-not-found","The style '"+a+"' could not be found",{styleName:a});})}function t(a,b){return a.styleUrl?p(a.styleUrl,b):a.styleName?q(a.styleName,b):d.reject(new g("symbolstyleutils:style-url-and-name-missing",
"Either styleUrl or styleName is required to resolve a style"))}function w(b,c,k){for(var f=b.data,p={portal:k.portal,url:h.urlToObject(b.baseUrl),origin:"portal-item"},q=function(d){if(d.name!==c)return"continue";var g=h.read(d.webRef,p),f={portal:k.portal,url:h.urlToObject(h.removeFile(g)),origin:"portal-item"};return{value:u(g).then(function(g){if((g=a.fromJSON(g.data,f))&&g.isInstanceOf(e.BaseSymbol3D)){if(d.thumbnail)if(d.thumbnail.href){var q=h.read(d.thumbnail.href,p);g.thumbnail=new n.default({url:q})}else d.thumbnail.imageData&&
(g.thumbnail=new n.default({url:"data:image/png;base64,"+d.thumbnail.imageData}));b.styleUrl?g.styleOrigin=new l({portal:k.portal,styleUrl:b.styleUrl,name:c}):b.styleName&&(g.styleOrigin=new l({portal:k.portal,styleName:b.styleName,name:c}))}return g})}},m=0,f=f.items;m<f.length;m++){var r=q(f[m]);if("object"===typeof r)return r.value}return d.reject(new g("symbolstyleutils:symbol-name-not-found","The symbol name '"+c+"' could not be found",{symbolName:c}))}function u(a){return k(h.normalize(a),{responseType:"json",
query:{f:"json"}})}Object.defineProperty(f,"__esModule",{value:!0});var x={};f.fetchStyle=t;f.resolveWebStyleSymbol=function(a,b){return a.name?t(a,b).then(function(c){return w(c,a.name,b)}):d.reject(new g("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};f.fetchSymbolFromStyle=w;f.styleNameFromItem=function(a){var b=0;for(a=a.typeKeywords;b<a.length;b++){var c=a[b];if(/^Esri.*Style$/.test(c)&&"Esri Style"!==c)return c}};var v="esri_en",z="Style"})},
"esri/renderers/support/jsonUtils":function(){define("require exports ../../core/Error ../../core/object ../../core/Warning ../ClassBreaksRenderer ../HeatmapRenderer ../SimpleRenderer ../UniqueValueRenderer".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a,b,c){if(!a)return null;if(a&&(a.styleName||a.styleUrl)&&"uniqueValue"!==a.type)return c&&c.messages&&c.messages.push(new g("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+a.type+"'",{definition:a,
context:c})),null;b=a?n[a.type]||null:null;if(b)return b=new b,b.read(a,c),b;c&&c.messages&&a&&c.messages.push(new g("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:c}));return null}function l(a,b,c){return a?c&&"web-scene"===c.origin&&"heatmap"===a.type?(c.messages&&c.messages.push(new k("renderer:unsupported","Renderer of type '"+a.declaredClass+"' are not supported in scenes.",{renderer:a,context:c})),null):a.write(b,c):null}Object.defineProperty(f,
"__esModule",{value:!0});var n={simple:c,uniqueValue:b,classBreaks:d,heatmap:h};f.read=a;f.writeTarget=function(a,b,c,d){(a=l(a,{},d))&&e.setDeepValue(c,a,b)};f.write=l;f.fromJSON=function(b,c){return a(b,null,c)}})},"esri/core/iteratorUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.everyMap=Map.prototype.entries?function(k,e){for(k=k.entries();;){var g=k.next();if(g.done)break;if(!1===e(g.value[1],g.value[0]))return!1}return!0}:function(k,
e){var g=!0;k.forEach(function(d,h){g&&(g=!1!==e(d,h))});return g}})},"esri/core/PooledArray":function(){define(["require","exports","./arrayUtils","./HeapSort"],function(m,f,k,e){return function(){function g(d){var e=this;this.data=[];this._length=0;this._allocator=null;this._deallocator=function(b,a){return e.data[a]=void 0};this._shrink=function(){};this._hint=new k.RemoveHint;if(d){d.initialSize&&(this.data=Array(d.initialSize));if(d.allocator&&(this._allocator=d.allocator,this._deallocator=d.deallocator,
d.initialSize))for(var c=0;c<d.initialSize;++c)this.data[c]=this._allocator(c);d.shrink&&(this._shrink=function(){e.data.length>2*e.length&&(e.data.length=e.length)})}}g.prototype.toArray=function(){return this.data.slice(0,this.length)};Object.defineProperty(g.prototype,"length",{get:function(){return this._length},set:function(d){if(this._allocator)for(;this.data.length<d;)this.data.push(this._allocator(this.data.length));if(this._deallocator)for(var e=d;e<this._length;++e)this._deallocator(this.data[e],
e);this._length=d;this._shrink()},enumerable:!0,configurable:!0});g.prototype.clear=function(){this.length=0};g.prototype.equal=function(d){return k.equals(this.data,d.data)};g.prototype.push=function(d){this.data.length===this.length&&this._grow(2*(this.length+1));return this.data[this.length++]=d};g.prototype.pushArray=function(d){var e=this.length+d.length;e>=this.data.length&&this._grow(Math.max(2*this.length,e));for(e=0;e<d.length;e++)this.data[this._length++]=d[e];return this.back()};g.prototype.pushNew=
function(){this.data.length===this.length&&this._grow(2*(this.length+1));++this._length;return this.back()};g.prototype.pop=function(){if(0!==this.length){var d=this.data[this.length-1];--this.length;this._shrink();return d}};g.prototype.removeMany=function(d){var e=this,c=[];this.data=this.data.filter(function(b,a){if(a>=e.length)return!1;if(0>d.indexOf(b))return!0;c.push(b);return!1});this._length=this.data.length;return c};g.prototype.removeUnordered=function(d){d=k.removeUnordered(this.data,d,
this.length,this._hint);void 0!==d&&--this.length;return d};g.prototype.removeUnorderedMany=function(d){d=k.removeUnorderedMany(this.data,d,this.length,this._hint);this.length-=d.length;return d};g.prototype.front=function(){if(0!==this.length)return this.data[0]};g.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]};g.prototype.swapElements=function(d,e){var c;d>=this.length||e>=this.length||(c=[this.data[e],this.data[d]],this.data[d]=c[0],this.data[e]=c[1])};g.prototype.sort=
function(d){e.sort(this.data,0,this.length,d)};g.prototype.some=function(d,e){for(var c=0;c<this.length;++c)if(d.call(e,this.data[c],c,this.data))return!0;return!1};g.prototype.find=function(d,e){for(var c=0;c<this.length;++c){var b=this.data[c];if(d.call(e,b,c,this.data))return b}};g.prototype.filter=function(d,e,c){c=c||new g;for(var b=0;b<this.length;++b)d.call(e,this.data[b],b,this.data)&&c.push(this.data[b]);return c};g.prototype.forEach=function(d,e){for(var c=0;c<this.length;++c)d.call(e,this.data[c],
c,this.data)};g.prototype.map=function(d,e){for(var c=Array(this.length),b=0;b<this.length;++b)c[b]=d.call(e,this.data[b],b,this.data);return c};g.prototype._grow=function(d){if(this._allocator)for(;this.data.length<d;)this.data.push(this._allocator(this.data.length))};return g}()})},"esri/core/HeapSort":function(){define([],function(){function m(k,e,g,d){for(var h=e,c=g>>>1,b=k[h-1];e<=c;){e=h<<1;e<g&&0>d(k[e-1],k[e])&&++e;var a=k[e-1];if(0>=d(a,b))break;k[h-1]=a;h=e}k[h-1]=b}function f(k,e){return k<
e?-1:k>e?1:0}return{sort:function(k,e,g,d){void 0===e&&(e=0);void 0===g&&(g=k.length);void 0===d&&(d=f);for(var h=g>>>1;h>e;h--)m(k,h,g,d);for(var c=e+1,h=g-1;h>e;h--)g=k[e],k[e]=k[h],k[h]=g,m(k,c,h,d);return k}}})},"esri/layers/Layer":function(){define("require ../core/Accessor ../core/Error ../core/Evented ../core/Identifiable ../core/Loadable ../core/urlUtils ../core/promiseUtils ../core/Logger ../config ../kernel ../request ../geometry/SpatialReference ../geometry/Extent".split(" "),function(m,
f,k,e,g,d,h,c,b,a,l,n,p,q){var r=0,t=b.getLogger("esri.layers.Layer");f=f.createSubclass([e,g,d],{declaredClass:"esri.layers.Layer",properties:{attributionDataUrl:null,credential:{value:null,readOnly:!0,dependsOn:["loaded","parsedUrl"],get:function(){return this.loaded&&this.parsedUrl&&l.id&&l.id.findCredential(this.parsedUrl.path)||null}},fullExtent:new q(-180,-90,180,90,p.WGS84),hasAttributionData:{readOnly:!0,dependsOn:["attributionDataUrl"],get:function(){return null!=this.attributionDataUrl}},
id:{get:function(){return Date.now().toString(16)+"-layer-"+r++}},legendEnabled:!0,listMode:"show",opacity:{value:1,type:Number,nonNullable:!0,cast:function(a){return 0>a?0:1<a?1:a}},parent:null,parsedUrl:{readOnly:!0,dependsOn:["url"],get:function(){var a=this._get("url");return a?h.urlToObject(a):null}},popupEnabled:!0,attributionVisible:!0,spatialReference:p.WGS84,title:null,token:{dependsOn:["credential.token"],get:function(){var a=this.get("parsedUrl.query.token"),b=this.get("credential.token");
return a||b||null},set:function(a){a?this._override("token",a):this._clearOverride("token")}},type:{type:String,readOnly:!0,value:null,json:{read:!1}},url:{value:null},visible:{value:!0,nonNullable:!0,type:Boolean}},initialize:function(){this.when().catch(function(a){b.getLogger(this.declaredClass).error("#load()","Failed to load layer (title: '"+this.title+"', id: '"+this.id+"')",a)}.bind(this))},createLayerView:function(a){return a?this.importLayerViewModule(a).then(function(b){b.default&&(b=b.default);
return new b({layer:this,view:a})}.bind(this)):c.reject(new k("layerview:module-unavailable","No LayerView module available for layer '${layer.declaredClass}' and view type: '${view.type}'",{view:a,layer:this}))},destroyLayerView:function(a){a.destroy()},fetchAttributionData:function(){var a=this.attributionDataUrl;return this.hasAttributionData&&a?n(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}):c.reject(new k("layer:no-attribution-data","Layer does not have attribution data"))},
refresh:function(){this.emit("refresh")},importLayerViewModule:function(a){return c.reject(new k("layerview:override-method","Must provide implementation in '${layer.declaredClass}'",{view:a,layer:this}))}});f.fromArcGISServerUrl=function(a){"string"===typeof a&&(a={url:a});var b=c.create(function(a){m(["./support/arcgisLayers"],a)}).then(function(b){return b.fromUrl(a)});b.catch(function(b){t.error("#fromArcGISServerUrl({ url: '"+a.url+"'})","Failed to create layer from arcgis server url",b)});return b};
f.fromPortalItem=function(b){!b||b.portalItem||"object"!==typeof b||b.declaredClass&&"esri.portal.PortalItem"!==b.declaredClass||(b={portalItem:b});var d=c.create(function(a){m(["../portal/support/portalLayers"],a)}).then(function(a){return a.fromItem(b)});d.catch(function(c){var d=b&&b.portalItem;t.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+(d&&d.portal&&d.portal.url||a.portalUrl)+"', id: '"+(d&&d.id||"unset")+"')",c)});return d};return f})},"esri/renderers/support/rendererConversion":function(){define(["require",
"exports","../../core/Error","../../symbols/support/symbolConversion"],function(m,f,k,e){function g(c,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var a=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});a.sort();var d=[];a.forEach(function(b,c){0!==c&&b===a[c-1]||d.push(b)});return new k("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+") which are not supported in 3D",{renderer:c,
symbolErrors:b})}return null}function d(c){var b=c.uniqueValueInfos.map(function(a){return e.to3D(a.symbol).error}).filter(function(a){return!!a}),a=e.to3D(c.defaultSymbol);a.error&&b.unshift(a.error);return g(c,b)}function h(c){var b=c.classBreakInfos.map(function(a){return e.to3D(a.symbol).error}).filter(function(a){return!!a}),a=e.to3D(c.defaultSymbol);a.error&&b.unshift(a.error);return g(c,b)}Object.defineProperty(f,"__esModule",{value:!0});f.validateTo3D=function(c){return c?"simple"===c.type?
g(c,e.to3D(c.symbol).error):"unique-value"===c.type?d(c):"class-breaks"===c.type?h(c):new k("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(c.type||c.declaredClass)+"'",{renderer:c}):null}})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper dojo/Deferred ../../../../geometry ../../../../core/scheduling".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function b(a,b){this.spatialReference=a;this.view=b;this.point=new h.Point;this.point.spatialReference=a}b.prototype.getElevation=function(a,b,c){this.point.x=a;this.point.y=b;return this.view.elevationProvider.getElevation(this.point,c)};b.prototype.queryElevation=function(a,b,c,d){return e(this,void 0,void 0,function(){return k(this,function(e){this.point.x=a;this.point.y=b;return[2,this.view.elevationProvider.queryElevation(this.point,
c,d)]})})};return b}();f.ViewElevationProvider=m;m=function(){function b(a,b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=g({},c,{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(a,b,c){void 0===c&&(c=0);return e(this,void 0,void 0,function(){var e;return k(this,function(h){e=new d;this._queries.push({x:a,y:b,minDemResolution:c,result:e});this._scheduleDoQuery();return[2,e.promise]})})};b.prototype._scheduleDoQuery=
function(){var a=this;this._isScheduled||(c.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return e(this,void 0,void 0,function(){var a,b,c,d,e,f,m,w,u;return k(this,function(l){switch(l.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});c=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);d=new h.Multipoint({points:b,spatialReference:this.spatialReference});e=this._getElevationQueryProvider();
if(!e)return a.forEach(function(a,b){return a.result.reject()}),[2];m=g({},this._queryOptions,{minDemResolution:c});l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.queryElevation(d,m)];case 2:return f=l.sent(),[3,4];case 3:return w=l.sent(),a.forEach(function(a){return a.result.reject(w)}),[2];case 4:return u=f.geometry.points,a.forEach(function(a,b){return a.result.resolve(u[b][2])}),[2]}})})};return b}();f.ElevationQuery=m})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require",
"exports","../../../../support/arcadeUtils"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.createContext=function(e,g,d){var h=null;e=e&&e.expression;"string"===typeof e&&(h="0"===e?0:null,null!=h?h={cachedResult:h}:(h=k.createSyntaxTree(e),k.dependsOnView(h)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),h={cachedResult:0}):h={arcade:{func:k.createFunction(h),context:k.createExecContext(null,{sr:g})}}));return h};f.createFeature=function(e,
g){return k.createFeature(e.attributes,e.geometry,g)};f.setContextFeature=function(e,g){null!=e&&null==e.cachedResult&&k.updateExecContext(e.arcade.context,g)};f.execute=function(e){if(null!=e){if(null!=e.cachedResult)return e.cachedResult;var g=e.arcade,g=k.executeFunction(g.func,g.context);"number"!==typeof g&&(g=e.cachedResult=0);return g}return 0};f.extractExpressionInfo=function(e,g){void 0===g&&(g=!1);var d=(e=e&&e.featureExpressionInfo)&&e.expression;g||"0"===d||(e=null);return e};f.zeroContext=
{cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){var n=new d(Array,function(a){return h.set(a,
h.ZERO)},null,10,5),p=c.create();return function(){function d(b,c,d,e){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var h=Array(2),l=0;l<h.length;l++)h[l]=Array(3);this._visibilityFlags=h;this.extent=this._featureExpressionFeature=null;this.graphics3DSymbol=c;this.graphic=b;this._graphics=d;this._featureExpressionFeature=a.createFeature(b,e)}d.prototype.initialize=function(a,b){var c=this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,
b);d.setVisibility(c.isVisible())})};d.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};d.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};d.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};d.prototype.addAuxiliaryGraphic=
function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};d.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};d.prototype.areVisibilityFlagsSet=function(a,b,c){void 0===c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];a=!0;for(var d=0;d<c.length;d++)if(d!==b){var e=c[d];a=a&&(null==e||!0===e)}return a};d.prototype.isVisible=function(a){void 0===
a&&(a=0);for(var b=0;b<=a;b++)for(var c=this._visibilityFlags[b],d=0;d<c.length;d++){var e=c[d];if(null!==e&&!1===e)return!1}return!0};d.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var h=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(h)})}return!0};
d.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};d.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};d.prototype.computeExtent=function(a){if(!this.extent){this.extent=c.create();var d=this.graphic.geometry,e=d.spatialReference;b.computeAABR(d,this.extent);if(!e.equals(a)&&!l.boundingRectToBoundingRect(this.extent,e,this.extent,a))return this.extent=null,!1}return!0};d.prototype.getProjectedBoundingBox=
function(a,b,d,l){return e(this,void 0,void 0,function(){var f=this;return k(this,function(q){switch(q.label){case 0:return l||(l={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),l.boundingBox?h.empty(l.boundingBox):l.boundingBox=h.empty(),l.requiresDrapedElevation=!1,[4,g.forEach(this._graphics,function(c){return e(f,void 0,void 0,function(){var e,g,f;return k(this,function(k){switch(k.label){case 0:if(!c)return[2];e="draped"===c.type?b:a;g=n.acquire();return[4,c.getProjectedBoundingBox(e,
d,g,l.screenSpaceObjects)];case 1:return f=k.sent(),isFinite(f[2])&&isFinite(f[5])||(l.requiresDrapedElevation=!0),f&&h.expand(l.boundingBox,g),n.release(g),[2]}})})})];case 1:return q.sent(),h.allFinite(l.boundingBox)||c.allFinite(h.toRect(l.boundingBox,p))?[2,l]:[2,null]}})})};d.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&("object3d"===c.type||"lod-instance"===c.type)&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=
b[a])&&c.needsElevationUpdates)return!0;return!1};d.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(d){"object3d"!==d.type&&"lod-instance"!==d.type||d.alignWithElevation(a,b,c._featureExpressionFeature)})};d.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};d.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};d.prototype.forEachGraphicList=
function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};d.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};d.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};d.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return d}()})},"esri/core/asyncUtils":function(){define(["require","exports","./tsSupport/generatorHelper",
"./tsSupport/awaiterHelper","./promiseUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.forEach=function(d,e,c){return g.eachAlways(d.map(function(b,a){return e.apply(c,[b,a])}))};f.map=function(d,e,c){return g.eachAlways(d.map(function(b,a){return e.apply(c,[b,a])})).then(function(b){return b.map(function(a){return a.value})})};f.maybe=function(d){return d.then(function(d){return{ok:!0,value:d}}).catch(function(d){return{ok:!1,error:d}})};f.assertMaybe=function(d){if(!0===
d.ok)return d.value;throw d.error;};f.safeCast=function(d){return d}})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=
this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.slicePlaneEnabled=!1}}();f.Graphics3DSymbolCreationContext=m})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.make=function(g,d,h){var c;switch(g.type){case "point-3d":c=k;break;default:c=e}return new c(g,d,h)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(m,f,k,e,g){return function(d){function h(c,b,a){c=d.call(this,c,b,a)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&(c.calloutSymbolLayer=e.make(c.symbol,b));return c}k(h,d);h.prototype.destroy=function(){d.prototype.destroy.call(this)};h.prototype.createGraphics3DGraphic=function(c,b,a){b=d.prototype.createGraphics3DGraphic.call(this,c,a);this.calloutSymbolLayer&&
(c=this.createCalloutGraphic(c))&&b.addAuxiliaryGraphic(c);return b};h.prototype.layerPropertyChanged=function(c,b){var a=this;return d.prototype.layerPropertyChanged.call(this,c,b)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(c,b,function(b){var c=0;for(b=b._auxiliaryGraphics;c<b.length;c++){var d=b[c];if(d.graphics3DSymbolLayer===a.calloutSymbolLayer)return d}}):!0:!1};h.prototype.createCalloutGraphic=function(c){var b=c.renderingInfo;c.renderingInfo={renderer:b.renderer,
symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(c)};return h}(g)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(m,f,k,e,g){Object.defineProperty(f,
"__esModule",{value:!0});var d=k.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");f.make=function(c,b){if(!e.isCalloutSupport(c))return d.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+c.type+"' does not support callouts"),null;if(!c.callout)return null;var a=h[c.callout.type];return a?new a(c,b):(d.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+c.callout.type),null)};var h={line:g}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t,w,u=q.VertexAttrConstants;m=function(b){function f(a,c){a=b.call(this,a,null,c,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}k(f,b);f.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,this._material.id),this._material=null)};f.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()};f.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(f.prototype,"materialParameters",{get:function(){var a=this.symbolContainer,b=a.callout,c=e.toUnitRGBA(b.color);c[3]*=this._getLayerOpacity();var d=g.pt2px(b.size||0),h=null;if(a.verticalOffset)var h=a.verticalOffset,l=h.minWorldLength,
k=h.maxWorldLength,h={screenLength:g.pt2px(h.screenLength),minWorldLength:l||0,maxWorldLength:null!=k?k:Infinity};b=b.border&&b.border.color?e.toUnitRGBA(b.border.color):null;l="object"===a.symbolLayers.getItemAt(0).type;return{color:c,size:d,verticalOffset:h,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!l,shaderPolygonOffset:l?0:void 0,depthHUDAlignStart:"label-3d"===
a.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});f.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new r(this.materialParameters,b+"_lineCallout_common");a.add(l.ModelContentType.MATERIAL,this._material)};f.prototype._defaultElevationInfoNoZ=function(){return z};f.prototype.createGraphics3DGraphic=function(b){var c=b.renderingInfo;b=b.graphic;null!=c.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=c.needsOffsetAdjustment);
var d=this.getGraphicElevationContext(b,c.elevationOffset||0),e=c.symbol,h="on-the-ground"===this._elevationContext.mode&&!e.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==e.type&&h)return null;e=a.computeCentroid(b.geometry);return null==e?null:this._createAs3DShape(b,e,d,c,"graphic"+b.uid,b.uid)};f.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,
c)}return!1};f.prototype.layerOpacityChanged=function(a,b){this._material.setParameterValues(this.materialParameters);return!0};f.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;for(var e in a)c=a[e],(d=b(c))&&this.updateGraphicElevationContext(c.graphic,d);return!0};f.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);
a=b.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);return a};f.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)};Object.defineProperty(f.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});f.prototype.createVertexData=function(a){var b,c=a.translation;a=a.centerOffset;if(!c&&!a)return x;
c=c?{size:3,data:[c[0],c[1],c[2]]}:x[u.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:x[u.AUXPOS1];return b={},b[u.POSITION]=c,b[u.NORMAL]=x[u.NORMAL],b[u.AUXPOS1]=a,b};f.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=r.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new r(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,
e));return{material:e,isUnique:!1}}e=new r(c,b+"_lineCallout_unique");return{material:e,isUnique:!0}};f.prototype._createAs3DShape=function(a,b,e,l,g,k){a=new p(this.createVertexData(l),v,p.DefaultOffsets,"point");a=[new n(a,g)];var f=this.getOrCreateMaterial(l,g);g=c.createStageObjectForPoint.call(this,b,a,[[f.material]],null,null,e,g,this._context.layer.uid,k,!0);if(null===g)return null;k=new h(this,g.object,a,f.isUnique?[f.material]:null,null,d.perObjectElevationAligner,e);k.metadata={elevationOffset:l.elevationOffset||
0};k.alignedTerrainElevation=g.terrainElevation;k.needsElevationUpdates=c.needsElevationUpdates2D(e.mode);c.extendPointGraphicElevationContext(k,b,this._context.elevationProvider);return k};return f}(b);var x=(t={},t[u.POSITION]={size:3,data:[0,0,0]},t[u.NORMAL]={size:3,data:[0,0,1]},t[u.AUXPOS1]={size:4,data:[0,0,0,1]},t);t=new Uint32Array([0]);var v=(w={},w[u.POSITION]=t,w[u.NORMAL]=t,w[u.AUXPOS1]=t,w),z={mode:"relative-to-ground",offset:0};return m})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../lib/gl-matrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});var a=b.VertexAttrConstants,l=new k,n=d.vec3d.create(),p=d.vec3d.create(),q=d.vec3d.create(),r=d.vec3d.create(),t=d.mat4d.create(),w={verticalDistanceToGround:0,terrainElevation:0};f.perVertexElevationAligner=function(b,c,d,g){b=b.stageObject;l.spatialReference=d.spatialReference;for(var k=b.getGeometryRecords(),m=k.length,r="absolute-height"!==c.mode,u=0,v=0;v<m;v++){var t=k[v].geometry,z=k[v].getShaderTransformation();
p[0]=z[12];p[1]=z[13];p[2]=z[14];t.invalidateBoundingInfo();for(var z=t.data.getVertexAttr(),x=z[a.POSITION],t=x.data,z=z.mapPos.data,x=x.size,N=t.length/x,I=0,G=0,O=!1,J=0,Q=0;Q<N;Q++){l.x=z[G++];l.y=z[G++];l.z=z[G++];q[0]=t[I];q[1]=t[I+1];q[2]=t[I+2];var H=e.computeElevation(d,l,c,g,r?w:null);r&&(J+=w.terrainElevation);n[0]=t[I]+p[0];n[1]=t[I+1]+p[1];n[2]=t[I+2]+p[2];g.setAltitude(H,n);t[I]=n[0]-p[0];t[I+1]=n[1]-p[1];t[I+2]=n[2]-p[2];if(h.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)O=!0;else if(H=
f.updateThresholdInMeters/g.unitInMeters,Math.abs(q[0]-t[I])>=H||Math.abs(q[1]-t[I+1])>=H||Math.abs(q[2]-t[I+2])>=H)O=!0;I+=x}u+=J/N;O&&b.geometryVertexAttrsUpdated(v)}return u/m};f.perObjectElevationAligner=function(a,b,d,l,k){a=a.stageObject;var p=b.centerPointInElevationSR,q=0;k=0;if(a.metadata.usesVerticalDistanceToGround)q=e.computeElevation(d,p,b,l,w),g.updateVertexAttributeAuxpos1w(a,w.verticalDistanceToGround),k=w.terrainElevation;else{var m="absolute-height"!==b.mode,q=e.computeElevation(d,
p,b,l,m?w:null);m&&(k=w.terrainElevation)}b=a.getObjectTransformation();d=[b[12],b[13],b[14]];h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(n[0]=p.x,n[1]=p.y,n[2]=q,c.computeLinearTransformation(p.spatialReference,n,b,l.spatialReference)&&a.setObjectTransformation(b)):l.setAltitudeOfTransformation(q,b);l=f.updateThresholdInMeters/l.unitInMeters;(Math.abs(b[12]-d[0])>=l||Math.abs(b[13]-d[1])>=l||Math.abs(b[14]-d[2])>=l)&&a.setObjectTransformation(b);return k};f.perLodInstanceElevationAligner=function(a,
b,d,l,g){g=b.centerPointInElevationSR;var k=0,f=0,p="absolute-height"!==b.mode,k=e.computeElevation(d,g,b,l,p?w:null);p&&(f=w.terrainElevation);b=a.graphics3DSymbolLayer.lodRenderer.instanceData;b.getTranslation(a.instanceIndex,r);h.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(n[0]=g.x,n[1]=g.y,n[2]=k,c.computeLinearTransformation(g.spatialReference,n,t,l.spatialReference)&&b.setTransform(a.instanceIndex,t)):l.setAltitude(k,r);b.setTranslation(a.instanceIndex,r);return f};f.updateThresholdInMeters=
.01;f.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ../../../../symbols/callouts/calloutUtils ./graphicUtils ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a,b,c,d,e){var h=b.z||0,l=c.featureExpressionInfoContext;
switch(c.mode){case "on-the-ground":return c=a.getElevation(b,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=c),c;case "relative-to-ground":return a=a.getElevation(b,"ground")||0,c=c.calculateOffsetRenderUnits(d),null==l&&(c+=h),e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "relative-to-scene":return a=a.getElevation(b,"scene")||0,c=c.calculateOffsetRenderUnits(d),e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "absolute-height":return c=c.calculateOffsetRenderUnits(d),
null==l&&(c+=h),e&&(a=a.getElevation(b,"ground")||0,e.verticalDistanceToGround=c-a,e.terrainElevation=a),c}return 0}function n(a,b){a=e.pathsToTriangulationInfo(a,b);return{vertexData:a.position,polygons:a.polygons,outlines:a.outlines}}function p(a,b,c,d,e){b*=3;d*=3;for(var h=0;h<e;++h)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function q(a,c,d,e,h,l,g){return b.bufferToBuffer(a,d,c,e,l,h,g)}function r(a,c,d){b.pointToVector(a,c,d)}function t(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}
function w(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(f,"__esModule",{value:!0});var u=c.vec3d.create(),x=c.mat4d.identity(),v=g.makeDehydratedPoint(0,0,0,null);f.createStageObjectForPoint=function(c,d,e,g,k,n,f,p,q,m,v){var w=d?d.length:0,y=this._context.clippingExtent;r(c,u,this._context.elevationProvider.spatialReference);if(y&&!t(u,y))return null;r(c,u,this._context.renderSpatialReference);y=this._context.localOriginFactory.getOrigin(u);f=new a({castShadow:!1,
metadata:{layerUid:p,graphicUid:q,usesVerticalDistanceToGround:!!m},idHint:f});for(p=0;p<w;p++)f.addGeometry(d[p],e[p],g?g[p]:x,k,y,v);d=this._context.renderSpatialReference;g=this._context.elevationProvider;k=this._context.renderCoordsHelper;e=0;var A;f.metadata.usesVerticalDistanceToGround?(e=l(g,c,n,k,z),h.updateVertexAttributeAuxpos1w(f,z.verticalDistanceToGround),A=z.terrainElevation):(v="absolute-height"!==n.mode,e=l(g,c,n,k,v?z:null),v&&(A=z.terrainElevation));n=f.getObjectTransformation();
u[0]=c.x;u[1]=c.y;u[2]=e;b.computeLinearTransformation(c.spatialReference,u,n,d)?f.setObjectTransformation(n):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:f,terrainElevation:A}};f.extendPointGraphicElevationContext=function(a,b,c){a=a.elevationContext;c=c.spatialReference;r(b,u,c);a.centerPointInElevationSR=g.makeDehydratedPoint(u[0],u[1],b.hasZ?u[2]:0,c)};f.placePointOnGeometry=function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return h.computeCentroid(a);
case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=k.getPointOnPath(b,k.getPathLength(b)/2);return g.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null};f.computeElevation=l;f.getSingleSizeDriver=function(a,b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};f.copyPathData=n;f.copyVertices=p;f.chooseOrigin=function(a,b,c,d){b=Math.floor(b+(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};f.subtractCoordinates=function(a,b,c,d){b*=3;
for(var e=0;e<c;++e)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};f.setZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]=d,b+=3};f.offsetZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]+=d,b+=3};f.scaleZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]*=d,b+=3};f.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var e=0;e<c;++e)d.push([a[b++],a[b++],a[b++]]);return d};f.reproject=q;f.reprojectPoint=r;f.getGeometryVertexData3D=function(a,b,c,d,e,h,l){var g=e.spatialReference;a=n(a,b);b=a.vertexData;
var k=b.length/3,f=new Float64Array(b.length),m=!0;c.equals(g)?p(b,0,f,0,b.length):m=q(b,0,c,f,0,g,k);var r=c=0,u=l.mode,t=0,w=0,z=0;h=l.calculateOffsetRenderUnits(h);l=l.featureExpressionInfoContext;v.spatialReference=e.spatialReference;c*=3;for(var r=3*r,y=0;y<k;++y){v.x=f[c+0];v.y=f[c+1];v.z=f[c+2];switch(u){case "on-the-ground":w=t=e.getElevation(v)||0;z+=t;break;case "relative-to-ground":t=e.getElevation(v)||0;w=t+h;null==l&&(w+=v.z);z+=t;break;case "relative-to-scene":t=e.getElevation(v,"scene")||
0;w=t+h;z+=t;break;case "absolute-height":w=h,null==l&&(w+=v.z)}b[r+0]=f[c+0];b[r+1]=f[c+1];b[r+2]=w;c+=3;r+=3}e=z/k;g.equals(d)||q(b,0,g,b,0,d,k);return{geometryData:a,vertexData:b,eleVertexData:f,terrainElevation:e,projectionSuccess:m}};f.getGeometryVertexDataDraped=function(a,c,d){a=n(a,!1);var e=a.vertexData,h=e.length/3,l=!0;c.equals(d)||(l=b.bufferToBuffer(e,c,0,e,d,0,h));return{geometryData:a,vertexData:e,projectionSuccess:l}};f.computeBoundingBox=function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=
Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var e=0;e<c;++e){var h=a[b++],l=a[b++],g=a[b++];h<d[0]&&(d[0]=h);l<d[1]&&(d[1]=l);g<d[2]&&(d[2]=g);h>d[3]&&(d[3]=h);l>d[4]&&(d[4]=l);g>d[5]&&(d[5]=g)}return d};f.pointInBox2D=t;f.boxesIntersect2D=w;f.boundingBoxClipped=function(a,b){return b?!w(a,b):!1};f.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};f.needsElevationUpdates3D=function(a){return"absolute-height"!==
a};f.needsOffsetAdjustment=function(a,b,c,e){if(!1===b.needsOffsetAdjustment||!1===b.supportsOffsetAdjustment||"on-the-ground"===a.mode)return!1;if(0===a.meterUnitOffset){if(!0===b.needsOffsetAdjustment)return!0;if(d.isCalloutSupport(e)&&e.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!c.hasZ||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var z={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures ../../lib/gl-matrix ../../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){function n(a){var c=a.paths[0];if(!c||0===c.length)return null;c=h.getPointOnPath(c,h.getPathLength(c)/2);return b.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)}function p(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!p(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(f,"__esModule",{value:!0});var q=[1,1,1];f.computeCentroid=function(a){if("point"===a.type)return a;if(b.isHydratedGeometry(a))switch(a.type){case "extent":return a.center;
case "polygon":return a.centroid;case "polyline":return n(a);case "mesh":return a.extent.center}else switch(a.type){case "extent":var c=l.isFinite(a.zmin);return b.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);case "polygon":return(c=a.rings[0])&&0!==c.length?(c=d.ringsCentroid(a.rings,a.hasZ),a=b.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)):a=null,a;case "polyline":return n(a)}};f.convertPointSR=function(a,b){var d=a.spatialReference;
d.isWebMercator&&b.isWGS84?(c.xyToLngLat(a.x,a.y,r),a.x=r[0],a.y=r[1],a.spatialReference=k.SpatialReference.WGS84):b.isWebMercator&&d.isWGS84&&(c.lngLatToXY(a.x,a.y,r),a.x=r[0],a.y=r[1],a.spatialReference=k.SpatialReference.WebMercator)};f.enlargeExtent=function(b,c,d){if(b){c||(c=g.create());var e=.5*b.width*(d-1);d=.5*b.height*(d-1);b.width<1E-7*b.height?e+=d/20:b.height<1E-7*b.width&&(d+=e/20);a.vec4d.set4(b.xmin-e,b.ymin-d,b.xmax+e,b.ymax+d,c);return c}return null};f.updateVertexAttributeAuxpos1w=
function(a,b){for(var c=0;c<a.geometries.length;++c){var d=a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};f.mixinColorAndOpacity=function(a,b){var c=[1,1,1,1];null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);null!==b&&void 0!==b?c[3]=b:null!=a&&3<a.length&&(c[3]=a[3]);return c};f.overrideColor=function(a,b,c,d,e,h){void 0===h&&(h=[0,0,0,0]);for(var l=0;3>l;++l)h[l]=a&&null!=a[l]?a[l]:c&&null!=c[l]?c[l]:e[l];h[3]=null!=b?b:null!=d?d:e[3];return h};
f.computeObjectScale=function(a,b,c,d){void 0===a&&(a=q);void 0===d&&(d=1);var e=Array(3);if(null==b||null==c)e[0]=1,e[1]=1,e[2]=1;else{for(var h=void 0,l=0,g=2;0<=g;g--){var k=a[g],n=void 0,f=null!=k,p=0===g&&!h&&!f,m=c[g];"symbolValue"===k||p?n=0!==m?b[g]/m:1:f&&"proportional"!==k&&isFinite(k)&&(n=0!==m?k/m:1);null!=n&&(h=e[g]=n,l=Math.max(l,Math.abs(n)))}for(g=2;0<=g;g--)null==e[g]?e[g]=h:0===e[g]&&(e[g]=.001*l)}for(g=2;0<=g;g--)e[g]/=d;return e};f.computeSizeWithResourceSize=function(a,b){var c=
b.width,d=b.depth,e=b.height;b=b.isPrimitive?10:1;if(null==c&&null==e&&null==d)return[b*a[0],b*a[1],b*a[2]];for(var c=[c,d,e],h,d=0;3>d;d++)if(e=c[d],null!=e){h=e/a[d];break}for(d=0;3>d;d++)null==c[d]&&(c[d]=a[d]*h);return c};f.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return p(a)?null:"Symbol sizes may not be negative values"};f.computeObjectRotation=function(b,c,d,e){void 0===e&&(e=a.mat4d.identity());b=b||0;c=c||0;d=d||0;0!==b&&a.mat4d.rotateZ(e,-b/
180*Math.PI,e);0!==c&&a.mat4d.rotateX(e,c/180*Math.PI,e);0!==d&&a.mat4d.rotateY(e,d/180*Math.PI,e);return e};f.demResolutionForBoundingBox=function(a,b){return null!=b.minDemResolution?b.minDemResolution:e.isPoint(a)?b.minDemResolutionForPoints:.01*e.maximumDimension(a)};var r=[0,0]})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../lib/gl-matrix ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),function(m,f,k,e,g,d,
h,c,b){var a=b.assert,l=k.mat4d.identity();m=function(){function b(a){void 0===a&&(a={});this._bvObjectSpace=new n;this._bvWorldSpace=new n;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsHiddenDirty=!0;this.id=b._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=k.mat4d.identity();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}b.prototype._initializeGeometryRecords=
function(b,c,d,e){if(Array.isArray(b)){a(c.length===b.length,"Object3D: materials don't match geometries");a(d.length===b.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(b.length);this.geometries=b.slice();for(var h=0;h<b.length;h++)a(Array.isArray(c[h]),"Object3D: materials parameter must be array of array"),this.geometryRecords[h]=new g(b[h],c[h].slice(),k.mat4d.create(d[h]),{},e&&e[h]);this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=
[]};Object.defineProperty(b.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(b){a(null==this._parentLayer||null==b,"Object3D can only be added to a single Layer");this._parentLayer=b},enumerable:!0,configurable:!0});b.prototype.getParentLayer=function(){return this.parentLayer};b.prototype.addParentLayer=function(a){this.parentLayer=a};b.prototype.removeParentLayer=function(a){this.parentLayer=null};b.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};
b.prototype.getFirstGeometryIndex=function(b){b=this.geometries.indexOf(b);a(-1<b,"Object3D.getFirstGeometryIndex: geometry not found");return b};b.prototype.findGeometryRecords=function(a){for(var b=[],c=0;c<this.geometries.length;c++)this.geometries[c]===a&&b.push(this.geometryRecords[c]);return b};b.prototype.getGeometryRecord=function(b){a(0<=b&&b<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[b]};b.prototype.getGeometryRecords=function(){return this.geometryRecords};
b.prototype.addGeometry=function(b,c,d,e,h,n){void 0===d&&(d=l);a(Array.isArray(c),"Object3D.addGeometry: materials must be array");this.geometries.push(b);b=new g(b,c.slice(),k.mat4d.create(d),e||{},h,n);this.geometryRecords.push(b);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",b);this._invalidateBoundingVolume();this._allComponentsHiddenDirty=!0;return b};b.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};
b.prototype.removeGeometry=function(a){var b=this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();this._allComponentsHiddenDirty=!0;return b};b.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};b.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",
this.geometryRecords[a]);this._invalidateBoundingVolume()};b.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a];if(!e.isAllHidden(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};b.prototype.areAllComponentsVisible=function(){for(var a=0,b=this.geometryRecords;a<
b.length;a++){var c=b[a];if(!e.isAllVisible(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets))return!1}return!0};b.prototype.hasComponents=function(){for(var a=!1,b=0;b<this.geometries.length&&!(a=e.hasComponents(this.geometries[b].data.componentOffsets));b++);return a};b.prototype.setComponentVisibility=function(a,b,c){b=e.updateVisibility(a.instanceParameters.componentVisibilities,a.geometry.data.componentOffsets,b,c);a.instanceParameters.componentVisibilities=b;this._notifyDirty("visibilityChanged",
a);this._allComponentsHiddenDirty=!0};b.prototype.setHidden=function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};b.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};b.prototype.getComponentVisibility=function(a,b){return e.getVisibility(a.instanceParameters.componentVisibilities,b)};b.prototype.hideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=e.hideAllComponents(c.instanceParameters.componentVisibilities);
c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};b.prototype.unhideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=e.unhideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};b.prototype._setComponentHighlight=function(a,b,c,d){b=e.addHighlight(a.instanceParameters.componentHighlights,
b,c,d);a.instanceParameters.componentHighlights=b};b.prototype.setComponentHighlight=function(a,b,c){var e=d.generateHighlightId();this._setComponentHighlight(a,b,c,e);this._notifyDirty("componentHighlightChanged");return e};b.prototype.highlightAllComponents=function(a){for(var b=d.generateHighlightId(),c=0,e=this.geometryRecords;c<e.length;c++)this._setComponentHighlight(e[c],null,a,b);this._notifyDirty("componentHighlightChanged");return b};b.prototype.removeHighlights=function(a){for(var b=0,
c=this.geometryRecords;b<c.length;b++){var d=c[b].instanceParameters,h=e.removeHighlight(d.componentHighlights,a);d.componentHighlights=h}this._notifyDirty("componentHighlightChanged")};b.prototype.getComponentFromTriangleNr=function(b,c){a(0<=b&&b<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");return e.componentFind(this.geometryRecords[b].geometry.data.componentOffsets,3*c)};b.prototype.setGeometryTransformation=function(b,c){a(0<=b&&b<this.geometryRecords.length,
"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[b];c=new g(d.geometry,d.materials,k.mat4d.create(c),d.instanceParameters);this.geometryRecords[b]=c;this._notifyDirty("objGeometryReplaced",[d,c]);this._invalidateBoundingVolume()};b.prototype.getObjectTransformation=function(){return k.mat4d.create(this.objectTransformation)};b.prototype.setObjectTransformation=function(a){k.mat4d.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};
b.prototype.getCombinedStaticTransformation=function(a,b){b=b||k.mat4d.create();k.mat4d.multiply(this.objectTransformation,a.getStaticTransformation(),b);return b};b.prototype.getCombinedShaderTransformation=function(a,b){b=b||k.mat4d.create();k.mat4d.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};b.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};b.prototype.getCastShadow=function(){return this.castShadow};b.prototype.setCastShadow=
function(a){this.castShadow=a};b.prototype.getMetadata=function(){return this.metadata};b.prototype.getName=function(){return this.name};b.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};b.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};b.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};
b.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};b.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],c=this.geometryRecords[a],b=b.boundingInfo;this._calculateTransformedBoundingVolume(b,this._bvObjectSpace,c.getShaderTransformation());this._calculateTransformedBoundingVolume(b,
this._bvWorldSpace,this.getCombinedShaderTransformation(c))}k.vec3d.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);k.vec3d.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var c=k.vec3d.create(),d=k.vec3d.create(),e=k.mat4d.maxScale(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],h=this.geometryRecords[a].getShaderTransformation(),l=k.mat4d.maxScale(h),b=b.boundingInfo;k.mat4d.multiplyVec3(h,
b.getCenter(),c);h=k.vec3d.dist(c,this._bvObjectSpace.center);b=b.getBSRadius()*l;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,h+b);k.mat4d.multiplyVec3(this.objectTransformation,c,d);l=k.vec3d.dist(d,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,l+b*e)}this._bvDirty=!1}};b.prototype._calculateTransformedBoundingVolume=function(a,b,c){var d=a.getBBMin();a=a.getBBMax();var e=k.vec3d.create(d),h=k.vec3d.create(a);k.mat4d.multiplyVec3(c,
e);k.mat4d.multiplyVec3(c,h);for(var l=0;3>l;++l)b.bbMin[l]=Math.min(b.bbMin[l],e[l],h[l]),b.bbMax[l]=Math.max(b.bbMax[l],e[l],h[l]);for(l=0;3>l;++l){k.vec3d.set(d,e);k.vec3d.set(a,h);e[l]=a[l];h[l]=d[l];k.mat4d.multiplyVec3(c,e);k.mat4d.multiplyVec3(c,h);for(var g=0;3>g;++g)b.bbMin[g]=Math.min(b.bbMin[g],e[g],h[g]),b.bbMax[g]=Math.max(b.bbMax[g],e[g],h[g])}};b.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,
radius:this._bvWorldSpace.bsRadius})};b.prototype._notifyDirty=function(a,b,d,e){this._parentLayer&&(d=d||c.OBJECT,this._parentLayer.notifyDirty(a,b,d,e||this))};b._idGen=new h;return b}();var n=function(){function a(){this.bbMin=k.vec3d.create();this.bbMax=k.vec3d.create();this.center=k.vec3d.create();this.bsRadius=0}a.prototype.init=function(){k.vec3d.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);k.vec3d.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax);
k.vec3d.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return m})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils"],function(m,f,k){function e(a,b){if(null!=a){var c=a.isVisibleBit,d=a.data,e=8*d.BYTES_PER_ELEMENT;return b<d.length*e?p(c,d,b,e):!a.isVisibleBit}return!0}function g(a){return null===a.component?-1:a.component}
function d(a,b,c,d,l){e(b,d)&&h(a,b,c,c[d],c[d+1]-1,l)}function h(a,b,c,d,e,h){c=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var l=b?b.options:null;c>=d||(c+1===d&&l===h?b.range[1]=e:a.push({range:[d,e],options:h}))}function c(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function b(a,b){return l(a,b,!0)}function a(a,b){return l(a,b,!1)}function l(a,b,c){var d=!1;a=a||r;d=a.isVisibleBit;a=a.data;b=q(b);var e=8*a.BYTES_PER_ELEMENT,h=a.length*e;c=c===d;if(0===a.length||0===
b)d=!c;else if(h<b&&!c)d=!0;else{for(var l=t[e],h=t[0],g=0;g<a.length-1;g++)if(d=!c&&a[g]!==l||c&&a[g]!==h)return d;d=a.length-1;b=t[(b-1)%e+1];d=!c&&(a[d]&b)!==b||c&&(a[d]&b)!==h}return d}function n(a){return 0<a.length}function p(a,b,c,d){var e=c/d|0;return 0!==(b[e]&1<<c-e*d)===a}function q(a){return Math.max(0,a.length-1)}Object.defineProperty(f,"__esModule",{value:!0});f.updateVisibility=function(a,b,d,e){if(d<q(b)){null==a&&(a=c());var h=a.isVisibleBit,l=a.data,g=8*l.BYTES_PER_ELEMENT,k=d/g|
0,n=d-g*k;b=(q(b)-1)/g|0;var f=l;e=e===h;d<f.length*g||!e||(d=Math.max(k+1,Math.ceil(1.5*f.length)),d=Math.min(d,b+1),l=new Uint32Array(d),l.set(f));k<l.length&&(l[k]=l[k]&~(1<<n)|(e?1:0)<<n);a.data=l}return a};f.getVisibility=e;f.hideAllComponents=function(a){if(null==a)a=c(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};f.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};f.generateVisibleIndexRanges=
function(a,b){var c;if(a)if(n(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var d=a.isVisibleBit,e=a.data,h=8*e.BYTES_PER_ELEMENT,l=e.length*h,g=q(b),k=!1,f=0;f<l&&f<g;f++){var m=p(d,e,f,h);if(m!==k){var r=b[f];m?c.push([r,0]):(k=c[c.length-1],k[1]=r-1);k=m}}a=!a.isVisibleBit;g>l&&a&&!k?c.push([b[l],b[g]-1]):k&&(k=c[c.length-1],k[1]=b[a?g:Math.min(g,l)]-1)}else c=[],c=a.isVisibleBit?c:null;else c=null;return c};f.addHighlight=function(a,b,c,d){a=a||[];
b={component:b,options:c,id:d};a.push(b);c=g(b);for(d=a.length-1;0<d&&c<g(a[d-1]);)b=[a[d],a[d-1]],a[d-1]=b[0],a[d]=b[1],--d;return a};f.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};f.generateHighlightedIndexRanges=function(b,c,e){if(!c)return null;if(!n(e))return b&&b.isVisibleBit?null:c.map(function(a){return{range:null,options:a.options}});for(var l=e[0],g=e[e.length-1]-1,k=[],f=!a(b,e),p=0;p<c.length;++p){var m=c[p].options,r=c[p].component;
if(null!==r)d(k,b,e,r,m);else if(f)h(k,b,e,l,g,m);else for(r=0;r<q(e);++r)d(k,b,e,r,m)}return 0<k.length?k:null};f.defaultVisibilities=c;f.isAllVisible=function(b,c){return!a(b,c)};f.isAllHidden=function(a,c){return!b(a,c)};f.hasVisible=b;f.hasHidden=a;var r=c();f.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};f.hasComponent=function(a,b){return b<q(a)};f.hasComponents=n;var t=[];for(m=0;65>m;m++)t.push(Math.pow(2,m)-1);f.componentCount=q;f.componentFind=function(a,b){a=k.binaryIndexOf(a,
b,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(m,f,k){return function(){function e(g,d,h,c,b,a){this.id=e._idGen.gen(g.id);this.geometry=g;this.materials=d;this.transformation=h;this.instanceParameters=c;this.origin=b;this.customTransformation=a}e.prototype.getStaticTransformation=function(){return this.transformation};e.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):
this.transformation};e._idGen=new k;return e}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(m,f){return function(){function k(){this._count=0}k.prototype.gen=function(e){null==e&&(e="a");return e+"_"+this._count++};return k}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});var e=new k;f.generateHighlightId=function(){return e.gen("highlight")}})},
"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(m,f){return function(){function k(){}k.LAYER="layers";k.OBJECT="objects";k.GEOMETRY="geometries";k.MATERIAL="materials";k.TEXTURE="textures";return k}()})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","../../lib/gl-matrix","../../support/geometryUtils","../../support/mathUtils"],function(m,f,k,e,g){function d(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),
new N(b);}function h(a,b,c){k.mat4d.multiply(b,a,p);k.mat4d.inverse(p);for(a=0;8>a;++a)k.mat4d.multiplyVec4(p,q[a],r),k.vec3d.set3(r[0]/r[3],r[1]/r[3],r[2]/r[3],c[a])}function c(a,b){e.plane.fromPoints(a[4],a[0],a[3],b[0]);e.plane.fromPoints(a[1],a[5],a[6],b[1]);e.plane.fromPoints(a[4],a[5],a[1],b[2]);e.plane.fromPoints(a[3],a[2],a[6],b[3]);e.plane.fromPoints(a[0],a[1],a[2],b[4]);e.plane.fromPoints(a[5],a[4],a[7],b[5])}function b(a){for(var b in a)return b}function a(a,b){a[12]=b[0];a[13]=b[1];a[14]=
b[2]}function l(a,b){void 0===b&&(b=0);for(var c=0,d=0;4>d;d++)c+=a[b+d]*G[d];return c}function n(a){return a-Math.floor(a)}Object.defineProperty(f,"__esModule",{value:!0});var p=k.mat4d.create(),q=[k.vec4d.createFrom(-1,-1,-1,1),k.vec4d.createFrom(1,-1,-1,1),k.vec4d.createFrom(1,1,-1,1),k.vec4d.createFrom(-1,1,-1,1),k.vec4d.createFrom(-1,-1,1,1),k.vec4d.createFrom(1,-1,1,1),k.vec4d.createFrom(1,1,1,1),k.vec4d.createFrom(-1,1,1,1)],r=k.vec4d.create(),t=[k.vec3d.create(),k.vec3d.create(),k.vec3d.create(),
k.vec3d.create(),k.vec3d.create(),k.vec3d.create(),k.vec3d.create(),k.vec3d.create()],w=k.vec3d.create(),u=k.vec3d.create(),x=k.vec3d.create(),v=k.vec3d.create(),z=k.vec3d.create(),y=k.vec3d.create(),A=k.vec3d.create(),B=k.vec3d.create(),C=k.vec3d.create(),E=k.vec3d.create(),D=k.vec3d.create(),F=k.vec3d.create(),M=k.vec3d.createFrom(0,0,0),N=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();f.AssertException=N;f.VertexAttrConstants=
{POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};f.assert=d;f.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};f.encodeInt16=function(a){return g.clamp(Math.round(32767*a),-32767,32767)};f.encodeNormal=function(a,b){var c=Math.abs(a[0]),d=Math.abs(a[1]),e=1/(c+d+Math.abs(a[2])),h=Math.min(a[2]*
e,0);b[0]=(0>a[0]?-1:1)*(c*e-h);b[1]=(0>a[1]?-1:1)*(d*e-h)};f.fallbackIfUndefined=function(a,b){return void 0===a?b:a};f.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};f.rgb2hex=function(a){var b=g.clamp(Math.round(255*a[0]),0,255),c=g.clamp(Math.round(255*a[1]),0,255);a=g.clamp(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(c<<8)+a).toString(16)};f.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};f.raySphere=function(a,b,c,d,
e){c=c||M;var h=k.vec3d.subtract(a,c,w);c=k.vec3d.dot(b,b);var l=2*k.vec3d.dot(b,h);d=k.vec3d.dot(h,h)-d*d;d=l*l-4*c*d;if(0>d)return!1;h=Math.sqrt(d);d=(-l-h)/(2*c);c=(-l+h)/(2*c);if(0>d||c<d&&0<c)d=c;return 0<d?(e&&k.vec3d.add(a,k.vec3d.scale(b,d,F),e),!0):!1};f.rayTriangle3D=function(a,b,c,d,e,h,l,g,n){void 0===n&&(n=k.vec3d.create());var f=d[l]-c[h],p=d[l+1]-c[h+1],q=d[l+2]-c[h+2];d=e[g]-c[h];l=e[g+1]-c[h+1];e=e[g+2]-c[h+2];var m=b[1]*e-l*b[2],r=b[2]*d-e*b[0],u=b[0]*l-d*b[1];g=f*m+p*r+q*u;if(-1E-5<
g&&1E-5>g)return!1;g=1/g;var v=a[0]-c[h],t=a[1]-c[h+1];a=a[2]-c[h+2];n[1]=g*(v*m+t*r+a*u);if(0>n[1]||1<n[1])return!1;c=t*q-p*a;a=a*f-q*v;f=v*p-f*t;n[2]=g*(b[0]*c+b[1]*a+b[2]*f);if(0>n[2]||1<n[1]+n[2])return!1;n[0]=g*(d*c+l*a+e*f);return!0};f.rayBoxTest=function(a,b,c,d){var e,h=(c[0]-a[0])/b[0],l=(d[0]-a[0])/b[0];h>l&&(e=h,h=l,l=e);var g=(c[1]-a[1])/b[1],k=(d[1]-a[1])/b[1];g>k&&(e=g,g=k,k=e);if(h>k||g>l)return!1;g>h&&(h=g);k<l&&(l=k);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];c>a&&(e=c,c=a,a=e);if(h>a||
c>l)return!1;a<l&&(l=a);return 0>l?!1:!0};f.rayRay2D=function(a,b,c,d,e,h){void 0===h&&(h=k.vec2d.create());var l=(d[e]-c[e])*(b[0]-a[0])-(d[0]-c[0])*(b[e]-a[e]);if(0===l)return!1;c=((d[0]-c[0])*(a[e]-c[e])-(d[e]-c[e])*(a[0]-c[0]))/l;h[0]=a[0]+c*(b[0]-a[0]);h[1]=a[e]+c*(b[e]-a[e]);return!0};f.matrixToFrustumPoints=h;f.matrixToFrustumPlanes=function(a,b,d,e){void 0===e&&(e=d,d=t);h(a,b,d);c(d,e)};f.frustumPointsToPlanes=c;f.project=function(a,b,c,e,h){h||(h=a);r[0]=a[0];r[1]=a[1];r[2]=a[2];r[3]=1;
k.mat4d.multiplyVec4(b,r);2<h.length&&(h[2]=-r[2]);k.mat4d.multiplyVec4(c,r);d(0!==r[3]);h[0]=r[0]/r[3];h[1]=r[1]/r[3];h[2]=r[2]/r[3];h[0]=(.5*h[0]+.5)*e[2]+e[0];h[1]=(.5*h[1]+.5)*e[3]+e[1]};f.getFirstObjectKey=b;f.getFirstObjectValue=function(a){return a[b(a)]};f.objectEmpty=function(a){for(var b in a)return!1;return!0};f.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};f.setMatrixTranslation=a;f.setMatrixTranslation3=function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d};f.getMatrixTranslation=function(a,
b){void 0===b&&(b=k.vec3d.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};f.createTranslationMatrix=function(b,c){b=k.mat4d.identity(b);a(b,c);return b};f.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};f.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};f.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};f.fovx2fovd=function(a,b,c){return 2*
Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};f.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};f.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};f.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};f.lineLineDistanceSquared3D=function(a,b,c,d,e){u[0]=a[0]-c[0];u[1]=a[1]-c[1];u[2]=a[2]-c[2];x[0]=d[0]-c[0];x[1]=d[1]-c[1];x[2]=d[2]-c[2];if(1E-4>Math.abs(x[0])&&1E-4>Math.abs(x[1])&&1E-4>Math.abs(x[2]))return e.success=
!1,e;v[0]=b[0]-a[0];v[1]=b[1]-a[1];v[2]=b[2]-a[2];if(1E-4>Math.abs(v[0])&&1E-4>Math.abs(v[1])&&1E-4>Math.abs(v[2]))return e.success=!1,e;b=u[0]*x[0]+u[1]*x[1]+u[2]*x[2];d=x[0]*v[0]+x[1]*v[1]+x[2]*v[2];var h=u[0]*v[0]+u[1]*v[1]+u[2]*v[2],l=x[0]*x[0]+x[1]*x[1]+x[2]*x[2],n=(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])*l-d*d;if(1E-4>Math.abs(n))return e.success=!1,e;h=g.clamp((b*d-h*l)/n,0,1);b=g.clamp((b+d*h)/l,0,1);z[0]=a[0]+h*v[0];z[1]=a[1]+h*v[1];z[2]=a[2]+h*v[2];y[0]=c[0]+b*x[0];y[1]=c[1]+b*x[1];y[2]=c[2]+b*x[2];
a=k.vec3d.dist2(z,y);e.success=!0;e.dist2=a;e.pa=z;e.pb=y;return e};f.pointLineSegmentDistanceSquared2D=function(a,b,c){E[0]=b[0]-a[0];E[1]=b[1]-a[1];E[2]=0;D[0]=c[0]-a[0];D[1]=c[1]-a[1];D[2]=0;F[0]=c[0];F[1]=c[1];F[2]=0;b=k.vec2d.dot(D,E);c=k.vec2d.dot(E,E);b=g.clamp(b/c,0,1);C[0]=E[0]*b;C[1]=E[1]*b;A[0]=a[0]+C[0];A[1]=a[1]+C[1];k.vec2d.subtract(F,A,B);a=k.vec2d.dot(B,B);b=k.vec2d.dot(D,D);c=k.vec2d.dot(E,E);var d=k.vec2d.dot(C,C);if(d>b||d>c)a=Number.MAX_VALUE;return a};f.packFloatRGBA=function(a,
b,c){void 0===c&&(c=0);a=g.clamp(a,0,O);for(var d=0;4>d;d++)b[c+d]=Math.floor(256*n(a*I[d]))};f.unpackFloatRGBA=l;var I=[1,256,65536,16777216],G=[1/256,1/65536,1/16777216,1/4294967296],O=l(new Uint8ClampedArray([255,255,255,255]));f.inverseProjectionInfo=function(a,b,c,d,e){0===a[11]?(d[0]=2/(b*a[0]),d[1]=2/(c*a[5]),d[2]=(1+a[12])/a[0],d[3]=(1+a[13])/a[5],k.vec2d.set2(0,1,e)):(d[0]=-2/(b*a[0]),d[1]=-2/(c*a[5]),d[2]=(1-a[8])/a[0],d[3]=(1-a[9])/a[5],k.vec2d.set2(1,0,e))}})},"esri/views/3d/support/geometryUtils":function(){define(["require",
"exports","./geometryUtils/lineSegment","./geometryUtils/plane","./geometryUtils/triangle"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.plane=e;f.triangle=g;f.lineSegment=k})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define(["require","exports","../../lib/gl-matrix","../mathUtils"],function(m,f,k,e){function g(d,c){void 0===d&&(d=k.vec3d.create());void 0===c&&(c=k.vec3d.create());return{origin:d,vector:c}}Object.defineProperty(f,"__esModule",{value:!0});
f.create=g;f.fromOriginAndVector=function(d,c,b){void 0===b&&(b=g());k.vec3d.set(d,b.origin);k.vec3d.set(c,b.vector);return b};f.distance2=function(h,c){c=k.vec3d.subtract(c,h.origin);var b=k.vec3d.dot(h.vector,c),a=k.vec3d.dot(h.vector,h.vector),b=e.clamp(b/a,0,1);h=k.vec3d.subtract(k.vec3d.scale(h.vector,b,d),c,d);return k.vec3d.dot(h,h)};var d=k.vec3d.create()})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../lib/gl-matrix"],function(m,f,k){function e(a){void 0===
a&&(a=f.UP);return[a[0],a[1],a[2],a[3]]}function g(a,b,c){void 0===c&&(c=e());k.vec3d.set(b,c);c[3]=-k.vec3d.dot(b,a);return c}function d(a,c,d,h){void 0===h&&(h=e());k.vec3d.cross(c,a,b);return g(d,k.vec3d.normalize(b),h)}Object.defineProperty(f,"__esModule",{value:!0});f.create=e;f.fromValues=function(a,b,c,d,h){void 0===h&&(h=e());h[0]=a;h[1]=b;h[2]=c;h[3]=d;return h};f.fromNormalAndOffset=function(a,b,c){void 0===c&&(c=e());k.vec3d.set(a,c);c[3]=b;return c};f.fromPositionAndNormal=g;f.projectVector=
function(a,b,d){void 0===d&&(d=b);return k.vec3d.cross(a,k.vec3d.cross(b,a,c),d)};f.distance=function(a,b){return k.vec3d.dot(a,b)+a[3]};f.fromPoints=function(a,b,g,f){void 0===f&&(f=e());return d(k.vec3d.subtract(a,b,h),k.vec3d.subtract(g,b,c),a,f)};f.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};f.negate=function(a,b){void 0===b&&(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};f.fromVectorsAndPoint=d;f.intersectRay=function(a,b,c,d){var e=k.vec3d.dot(a,c);if(0===
e)return!1;a=-(k.vec3d.dot(a,b)+a[3])/e;if(0>a)return!1;k.vec3d.add(b,k.vec3d.scale(c,a,d),d);return!0};f.UP=[0,0,1,0];var h=k.vec3d.create(),c=k.vec3d.create(),b=k.vec3d.create()})},"esri/views/3d/support/geometryUtils/triangle":function(){define(["require","exports","../../lib/gl-matrix","./lineSegment"],function(m,f,k,e){function g(a,b,c){var d=k.vec2d.dist(a,b);b=k.vec2d.dist(b,c);a=k.vec2d.dist(c,a);c=(d+b+a)/2;return Math.sqrt(c*(c-d)*(c-b)*(c-a))}Object.defineProperty(f,"__esModule",{value:!0});
f.create=function(a,b,c){void 0===a&&(a=k.vec3d.create());void 0===b&&(b=k.vec3d.create());void 0===c&&(c=k.vec3d.create());return{p0:a,p1:b,p2:c}};f.distance2=function(g,f){var q=g.p0,m=g.p1;g=g.p2;var r=k.vec3d.subtract(m,q,d),x=k.vec3d.subtract(g,m,h),v=k.vec3d.subtract(q,g,c),z=k.vec3d.subtract(f,q,b),y=k.vec3d.subtract(f,m,a),A=k.vec3d.subtract(f,g,l),B=k.vec3d.cross(r,v),C=k.vec3d.dot(k.vec3d.cross(r,B,n),z),y=k.vec3d.dot(k.vec3d.cross(x,B,n),y),A=k.vec3d.dot(k.vec3d.cross(v,B,n),A);if(0<C&&
0<y&&0<A)return f=k.vec3d.dot(B,z),f*f/k.vec3d.dot(B,B);q=e.distance2(e.fromOriginAndVector(q,r,p),f);m=e.distance2(e.fromOriginAndVector(m,x,p),f);f=e.distance2(e.fromOriginAndVector(g,v,p),f);return Math.min(q,m,f)};f.areaPoints2d=g;f.area2d=function(a){return g(a.p0,a.p1,a.p2)};var d=k.vec3d.create(),h=k.vec3d.create(),c=k.vec3d.create(),b=k.vec3d.create(),a=k.vec3d.create(),l=k.vec3d.create(),n=k.vec3d.create(),p=e.create()})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){return new (function(h){function c(){var b=null!==h&&h.apply(this,arguments)||this;b.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1;b.SCENEVIEW_LOCKING_LOG=!1;b.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;b.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;b.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;b.DECONFLICTOR_SHOW_OUTLINES=!1;b.DECONFLICTOR_SHOW_GRID=!1;b.LABELS_SHOW_BORDER=!1;b.OVERLAY_DRAW_TEST_TEXTURE=!1;b.OVERLAY_SHOW_CENTER=!1;b.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;b.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=
!1;b.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;b.DRAW_MESH_GEOMETRY_NORMALS=!1;b.FEATURE_TILE_FETCH_SHOW_TILES=!1;b.FEATURE_TILE_TREE_SHOW_TILES=!1;b.ENABLE_PROFILE_DEPTH_RANGE=!1;return b}k(c,h);e([d.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);e([d.property()],c.prototype,"SCENEVIEW_LOCKING_LOG",void 0);e([d.property()],c.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);e([d.property()],c.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);e([d.property()],c.prototype,
"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);e([d.property()],c.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);e([d.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);e([d.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);e([d.property()],c.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);e([d.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);e([d.property()],c.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);e([d.property()],c.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",
void 0);e([d.property()],c.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);e([d.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);e([d.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);e([d.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);e([d.property()],c.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);return c=e([d.subclass()],c)}(d.declared(g)))})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/gl-matrix ../../webgl-engine/Stage".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){m=function(){function k(a,b,d,e,h,l,g,n){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=e;this.uniqueGeometries=d;this.uniqueTextures=h;this.stageObject=b;this.elevationAligner=l;this.elevationContext=new c(g);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=n?n:k.VisibilityModes.HIDE_FACERANGE}k.prototype.initialize=function(a,b){this.stageLayer=
a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(l.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(l.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(l.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(l.ModelContentType.OBJECT,this.stageObject)};k.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==
a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===k.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};Object.defineProperty(k.prototype,"visible",{get:function(){return this._visible},
enumerable:!0,configurable:!0});k.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(l.ModelContentType.MATERIAL,this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(l.ModelContentType.GEOMETRY,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(l.ModelContentType.TEXTURE,this.uniqueTextures[b].id)}a.remove(l.ModelContentType.OBJECT,
this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};k.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(h.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=
a))};k.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};k.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};k.prototype.getBoundingBoxObjectSpace=function(a){var b=this.stageObject;a||(a=d.create());d.setMin(a,b.getBBMin(!0));d.setMax(a,b.getBBMax(!0));return a};k.prototype.getProjectedBoundingBox=function(c,h,l,k){return g(this,void 0,void 0,function(){var g,f,m,v,u,t,w,x,M,N;return e(this,function(e){switch(e.label){case 0:g=this.getBoundingBoxObjectSpace(l);
f=r;m=d.isPoint(g)?1:f.length;for(v=0;v<m;v++)u=f[v],p[0]=g[u[0]],p[1]=g[u[1]],p[2]=g[u[2]],a.mat4d.multiplyVec3(this.stageObject.objectTransformation,p),n[3*v+0]=p[0],n[3*v+1]=p[1],n[3*v+2]=p[2];if(!c(n,0,m))return[2,null];d.empty(g);t=null;this.calculateRelativeScreenBounds&&(t=this.calculateRelativeScreenBounds());for(v=0;v<3*m;v+=3){for(w=0;3>w;w++)g[w]=Math.min(g[w],n[v+w]),g[w+3]=Math.max(g[w+3],n[v+w]);t&&k.push({location:n.slice(v,v+3),screenSpaceBoundingRect:t})}if(!h||!h.service||"absolute-height"===
this.elevationContext.mode)return[3,5];d.center(g,q);x="relative-to-scene"===this.elevationContext.mode?"scene":"ground";M=void 0;if(!h.useViewElevation)return[3,1];M=h.service.getElevation(q[0],q[1],x);return[3,4];case 1:return e.trys.push([1,3,,4]),N=b.demResolutionForBoundingBox(g,h),[4,h.service.queryElevation(q[0],q[1],N,x)];case 2:return M=e.sent(),[3,4];case 3:return e.sent(),M=null,[3,4];case 4:d.offset(g,0,0,-this.alignedTerrainElevation+M),e.label=5;case 5:return[2,g]}})})};k.prototype.addHighlight=
function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};k.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};return k}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(m||(m={}));var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=a.vec3d.create(),q=a.vec3d.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return m})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(m,f,k,e){return function(e){function d(d){d=e.call(this,d)||this;d.centerPointInElevationSR=null;return d}k(d,e);return d}(e)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(m,f,k,e){return function(){function g(d){d?this.set(d):this.setDefaults()}Object.defineProperty(g.prototype,"meterUnitOffset",
{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});g.prototype.setUnit=function(d){this._unit=d;this._metersPerElevationInfoUnit=k.getMetersPerUnit(d)};g.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};g.prototype.set=function(d){this.mode=
d.mode;this._meterUnitOffset=d._meterUnitOffset||0;this._renderUnitOffset=d._renderUnitOffset||0;this.featureExpressionInfoContext=d.featureExpressionInfoContext;this.hasOffsetAdjustment=d.hasOffsetAdjustment;this.setUnit(d.unit)};g.prototype.setOffsetMeters=function(d){this._meterUnitOffset=d;this._renderUnitOffset=0};g.prototype.setOffsetElevationInfoUnits=function(d){this._meterUnitOffset=d*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};g.prototype.setOffsetRenderUnits=function(d){this._meterUnitOffset=
0;this._renderUnitOffset=d};g.prototype.addOffsetRenderUnits=function(d){this._renderUnitOffset+=d};g.prototype.mixinApi=function(d){null!=d.mode&&(this.mode=d.mode);null!=d.unit&&this.setUnit(d.unit);null!=d.offset&&this.setOffsetElevationInfoUnits(d.offset)};g.prototype.calculateOffsetRenderUnits=function(d){var h=this._meterUnitOffset,c=this.featureExpressionInfoContext;null!=c&&(h+=e.execute(c)*this._metersPerElevationInfoUnit);return h/d.unitInMeters+this._renderUnitOffset};return g}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../lib/gl-matrix ./lib/ModelContentType ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),
function(m,f,k,e,g,d,h){return function(){function c(b,a,c,e){this.sceneIntersectionHelper=e;this._viewContent=[];this.container=a;this.viewingMode=b;this.model=new d;this.view=new h(a,this,this.model.getDirtySet(),c);this.view.setLighting({lights:[new g.MainLight(k.vec3d.createFrom(.7,.7,.7)),new g.AmbientLight(k.vec3d.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}c.prototype.setNeedsRender=function(){this.view.setNeedsRender()};c.prototype.dispose=function(){this.view.dispose();
this.model=this.view=null};c.prototype.add=function(b,a){this.model.add(b,a);"function"===typeof a.addParentStage&&a.addParentStage(this)};c.prototype.remove=function(b,a){b=this.model.remove(b,a);"function"===typeof b.removeParentStage&&b.removeParentStage(this);return b};c.prototype.notifyDirty=function(b,a,c,d){this.model.notifyDirty(b,a,c,d)};c.prototype.processDirty=function(){var b=this.model.getDirtySet(),a=b.getDirtyMaterials();if(b.hasDirtyGeometryRecords()||a){c.DebugSettings.endFrameContentValidation&&
this.model.validateContent();c.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var d=b.commitLayers(this._viewContent);(0<d[0].length+d[1].length+d[2].length||a)&&this.view.modify(d[0],d[1],d[2],a);c.DebugSettings.logDirtySet&&(console.log("RGs add: "+d[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+d[1].map(function(a){return a.uniqueName})));b.commit();b.clearDirtyMaterials();this.view.setNeedsRender()}};c.prototype.processDirtyLayer=
function(b){var a=this.model.getDirtySet(),c=a.getDirtyMaterials();b=a.commitLayers([b]);(0<b[0].length+b[1].length+b[2].length||c)&&this.view.modify(b[0],b[1],b[2],c);a.clearDirtyMaterials();this.view.setNeedsRender()};c.prototype.get=function(b,a){return this.model.get(b,a)};c.prototype.getAll=function(b){return this.model.getAll(b)};c.prototype.getCamera=function(){return this.view.getCamera()};c.prototype.setCamera=function(b){this.view.setCamera(b)};c.prototype.getViewParams=function(b){return this.view.getViewParams(b)};
c.prototype.setViewParams=function(b){this.view.setViewParams(b)};c.prototype.getLayers=function(){return this.model.getAll(e.LAYER)};c.prototype.setLighting=function(b){this.view.setLighting(b)};c.prototype.getCanvas=function(){return this.view.getCanvas()};c.prototype.setRenderParams=function(b){this.view.setRenderParams(b)};c.prototype.getRenderParams=function(){return this.view.getRenderParams()};c.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()};c.prototype.has=function(b){return this.view.has(b)};
c.prototype.getViewContent=function(){return this._viewContent.slice(0)};c.prototype.addToViewContent=function(b){for(var a=[],c=0;c<b.length;c++)-1===this._viewContent.indexOf(b[c])&&a.push(b[c]);0<b.length&&(this.processDirty(),b=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(a),this.view.modify(b,[],[]),this._viewContent.push.apply(this._viewContent,a))};c.prototype.removeFromViewContent=function(b){this.processDirty();for(var a=this.model.getDirtySet(),c=this._viewContent,
d=[],e=0;e<b.length;e++){var h=c.indexOf(b[e]);-1<h&&(c[h]=c[c.length-1],c.pop(),d.push(b[e]))}b=a.getResidentRenderGeometriesFilteredByLayers(d);this.view.modify([],b,[])};c.prototype.getFrameTask=function(){return this.view.getFrameTask()};c.prototype.takeScreenshot=function(b){return this.view.takeScreenshot(b)};c.prototype.addRenderPlugin=function(b,a){"function"===typeof a.intersect&&this.sceneIntersectionHelper.addIntersectionHandler(a);return this.view.renderPlugins.add(b,a)};c.prototype.removeRenderPlugin=
function(b){this.sceneIntersectionHelper.removeIntersectionHandler(b);return this.view.renderPlugins.remove(b)};c.prototype.getContentDebugStrings=function(b){return this.model.formatDebugInfo(b)};c.prototype.getRenderStats=function(){return this.view.getCombinedStats()};c.prototype.getRenderStatString=function(b){var a=this.getRenderStats(),c="";if(b){var c=c+"\x3ctable\x3e",d;for(d in a)c+="\x3ctr\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(a[d])+"\x3c/td\x3e\x3c/tr\x3e";
c+="\x3c/table\x3e"}else for(d in a)c+=d+": "+a[d]+"\n";return c};c.prototype.getFramebufferTexture=function(b){void 0===b&&(b="color");return this.view.getFramebufferTexture(b)};c.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()};c.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.ModelContentType=e;return c}()})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/gl-matrix"],function(m,f,k){Object.defineProperty(f,
"__esModule",{value:!0});m=function(){return function(e,g,d){void 0===e&&(e=k.vec3d.create());void 0===g&&(g=k.vec3d.createFrom(.57735,.57735,.57735));void 0===d&&(d=!0);this.intensity=e;this.direction=g;this.castShadows=d}}();f.MainLight=m;m=function(){return function(e,g){void 0===e&&(e=k.vec3d.create());void 0===g&&(g=k.vec3d.createFrom(.57735,.57735,.57735));this.intensity=k.vec3d.create();this.direction=k.vec3d.create();this.intensity=e;this.direction=g}}();f.FillLight=m;m=function(){return function(e){void 0===
e&&(e=k.vec3d.create());this.intensity=e}}();f.AmbientLight=m;m=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();f.SphericalHarmonicsLight=m})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../lib/gl-matrix ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(m,f,k,e,g,d,h,c){var b=c.assert,a=c.logWithBase;return function(){function c(){this.dirtySet=new d(this);this._uniqueIdx=0;this._id2origin=
{};this.content={};for(var a in g)this.content[g[a]]={}}c.prototype.getAll=function(a){a=this.content[a];b(void 0!==a);return a};c.prototype.get=function(a,b){return this.getAll(a)[b]};c.prototype.add=function(a,c){var d=this.content[a];b(void 0!==d);var e=c.id;b(null==d[e],"Model/Stage already contains object to be added");d[e]=c;a===g.LAYER&&this.notifyDirty(a,c,"layerAdded")};c.prototype.remove=function(a,c){var d=this.content[a];b(void 0!==d);var e=d[c];b(void 0!==e,"Model/Stage doesn't contain object to be removed");
delete d[c];a===g.TEXTURE&&e.unload();a===g.LAYER&&this.notifyDirty(a,e,"layerRemoved");return e};c.prototype.getDirtySet=function(){return this.dirtySet};c.prototype.notifyDirty=function(a,b,c,d){this.dirtySet.handleUpdate(b,c,d)};c.prototype.getOrigin=function(b,c,d){void 0===d&&(d=10);var h=0;c=c*d/1E4;1<c&&(h=Math.ceil(a(c,2)));c=1E4*Math.pow(2,h);d=Math.round(b[0]/c);var g=Math.round(b[1]/c);b=Math.round(b[2]/c);var h=h+"_"+d+"_"+g+"_"+b,l=this._id2origin[h];null==l&&(l={vec3:e.vec3d.createFrom(d*
c,g*c,b*c),id:h},this._id2origin[h]=l);return l};c.prototype.getGeometryRenderGeometries=function(a,b,c){var d=a.id,g=b.geometry,l=a.getCombinedStaticTransformation(b),k=e.mat4d.maxScale(l),n=b.origin,f=b.id,p=this._uniqueIdx++;a=new h(g.data,g.boundingInfo,b.materials[0],l,b.customTransformation,k,a.getCastShadow(),!!g.singleUse,d,f,p);a.origin=n||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=b.instanceParameters;c.push(a)};c.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,
c.transformation);c.updateTransformation(c.transformation)};c.prototype.formatDebugInfo=function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var c in g)a=g[c],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";for(c in g)a=g[c],b[0]+=k.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};
c.prototype.validateContent=function(){var a=this.getAll(g.OBJECT),b;for(b in a)this.validateObject(a[b]);var a=this.getAll(g.LAYER),c;for(c in a)this.validateLayer(a[c]);c=this.getAll(g.MATERIAL);for(var d in c)this.validateMaterial(c[d])};c.prototype.validateObject=function(a){a=a.geometryRecords;for(var c=0;c<a.length;++c){var d=a[c];b(null!=this.get(g.GEOMETRY,d.geometry.id));b(1===d.materials.length,"object materials do not match geometry groups");b(null!=this.get(g.MATERIAL,d.materials[0].id))}};
c.prototype.validateLayer=function(a){a=a.getObjects();for(var c=0;c<a.length;++c){var d=this.get(g.OBJECT,a[c].id);b(null!=d)}};c.prototype.validateMaterial=function(a){a=a.getAllTextureIds();for(var c=0;c<a.length;++c){var d=this.get(g.TEXTURE,a[c]);b(null!=d)}};c.ContentType=g;return c}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("require exports ../../../../core/arrayUtils ../../../../core/iteratorUtils ./ModelContentType ./Util".split(" "),function(m,f,k,e,g,d){return function(){function h(c){this._residentGeomRecords=
new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=c}Object.defineProperty(h.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"residentObjectCount",{get:function(){var c=0;this._residentGeomRecords.forEach(function(b){c+=b.size});return c},enumerable:!0,configurable:!0});h.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:
null};h.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};h.prototype.hasDirtyGeometryRecords=function(){var c=!1;e.everyMap(this._dirtyGeomRecords,function(b){if(c)return!1;e.everyMap(b,function(a){if(!c&&a&&0<a.size)return c=!0,!1})});return c};h.prototype.handleUpdate=function(c,b,a){d.assert(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](c,a)};h.prototype.shaderTransformationChanged=function(c){var b=this;(c=this._residentGeomRecords.get(c.id))&&c.forEach(function(a,
c){(c=b._model.content[g.OBJECT][c])&&c.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};h.prototype.commit=function(){return this.commitLayers(k.keysOfMap(this._dirtyGeomRecords))};h.prototype.commitLayers=function(c){for(var b=this,a=[],e=[],h=[],k=function(l){var k=c[l];l=f._dirtyGeomRecords.get(k);if(!l)return"continue";l.forEach(function(c,l){var n=b._ensureGeomRecord(k,l);c.forEach(function(c,k){var f=c[0],p=c[1];c=
c[2];var q=p&2&&c&1;if(p&4||q){var m=n.get(k);m?e.push.apply(e,m[1]):4===p&&d.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");m&&n.delete(k)}if(p&1||q){var r=[f,[]],m=b._model.get(g.OBJECT,l);b._model.getGeometryRenderGeometries(m,f,r[1]);a.push.apply(a,r[1]);n.set(k,r)}if(p&2&&!q)if(m=n.get(k)){k=m[1];p=k.length;if(c&16)for(m=b._model.get(g.OBJECT,l),q=0;q<p;q++)r=k[q],b._model.updateRenderGeometryTransformation(m,f,r);for(q=0;q<p;q++)r=k[q],h.push({renderGeometry:r,updateType:c})}else d.assert(!1,
"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")});0===n.size&&b._residentGeomRecords.get(k).delete(l)});0===f._residentGeomRecords.get(k).size&&f._residentGeomRecords.delete(k);f._dirtyGeomRecords.delete(k)},f=this,m=0;m<c.length;m++)k(m);return[a,e,h]};h.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(k.keysOfMap(this._residentGeomRecords))};h.prototype.getResidentRenderGeometriesFilteredByLayers=function(c){for(var b=[],
a=0;a<c.length;a++){var d=this._residentGeomRecords.get(c[a]);d&&d.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};h.prototype.visibilityChanged=function(c,b,a){if(null!=b)this._componentPropertyChanged(c,b,a,2);else{b=0;for(var d=c.getGeometryRecords();b<d.length;b++)this._componentPropertyChanged(c,d[b],a,2)}};h.prototype.componentHighlightChanged=function(c,b,a){if(null!=b)this._componentPropertyChanged(c,b,a,32);else{b=0;for(var d=c.getGeometryRecords();b<d.length;b++)this._componentPropertyChanged(c,
d[b],a,32)}};h.prototype.vertexAttrsUpdated=function(c,b,a){this._updateOrCreateDirtyRecord(c,b,a,2,0,0,2,5,4)};h.prototype.matChanged=function(c){this._dirtyMaterials.add(c.id);if(this.onMaterialChanged)this.onMaterialChanged(c)};h.prototype.layerAdded=function(c){for(var b=c.getObjects(),a=0;a<b.length;a++)this.layObjectAdded(c,b[a])};h.prototype.layerRemoved=function(c){for(var b=c.getObjects(),a=0;a<b.length;a++)this.layObjectRemoved(c,b[a])};h.prototype.layObjectAdded=function(c,b){c=c.id;for(var a=
b.getGeometryRecords(),d=0;d<a.length;d++)this.objGeometryAdded(b,a[d],c)};h.prototype.layObjectRemoved=function(c,b){c=c.id;for(var a=b.getGeometryRecords(),d=0;d<a.length;d++)this.objGeometryRemoved(b,a[d],c)};h.prototype.layObjectReplaced=function(c,b){this.layObjectRemoved(c,b[0]);this.layObjectAdded(c,b[1])};h.prototype.objDirty=function(c,b){var a=this;b=b||this._getParentLayerId(c);this._ensureGeomRecord(b,c.id).forEach(function(d){a._updateOrCreateDirtyRecord(c,d[0],b,2,0,2,0,5,1)})};h.prototype.objTransformation=
function(c,b){var a=this;b=b||this._getParentLayerId(c);this._ensureGeomRecord(b,c.id).forEach(function(d){a._updateOrCreateDirtyRecord(c,d[0],b,2,0,0,2,5,16)})};h.prototype.objGeometryAdded=function(c,b,a){this._updateOrCreateDirtyRecord(c,b,a,1,4,0,0,0)};h.prototype.objGeometryRemoved=function(c,b,a){this._updateOrCreateDirtyRecord(c,b,a,4,1,2,0,0)};h.prototype.objGeometryReplaced=function(c,b){this.objGeometryRemoved(c,b[0]);this.objGeometryAdded(c,b[1])};h.prototype.objGeometryTransformation=
function(c,b){this.objGeometryReplaced(c,b)};h.prototype._componentPropertyChanged=function(c,b,a,d){this._updateOrCreateDirtyRecord(c,b,a,2,0,0,2,5,d)};h.prototype._updateOrCreateDirtyRecord=function(c,b,a,e,h,g,k,f,m){a=a||this._getParentLayerId(c);var l=b.id;c=this._ensureDirtyRecord(a,c.id);(a=c.get(l))?(b=a[1],b&h?c.delete(l):b&g?(a[1]=e,a[2]=m):b&k?a[2]|=m:b&f||d.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):c.set(l,[b,e,m])};h.prototype._ensureGeomRecord=function(c,b){var a=
this._residentGeomRecords.get(c);a||(a=new Map,this._residentGeomRecords.set(c,a));c=a.get(b);c||(c=new Map,a.set(b,c));return c};h.prototype._ensureDirtyRecord=function(c,b){var a=this._dirtyGeomRecords.get(c);a||(a=new Map,this._dirtyGeomRecords.set(c,a));c=a.get(b);c||(c=new Map,a.set(b,c));return c};h.prototype._getParentLayerId=function(c){return c.parentLayer.id};h.prototype.formatDebugInfo=function(c){if(c)return"";var b=["ADD","UPD",void 0,"REM"],a="";this._dirtyGeomRecords.forEach(function(c,
d){c.forEach(function(c,e){0<a.length&&(a+="\n");a+=d+"."+e;var h=[];c.forEach(function(a){var b=a[1];h[b]||(h[b]=[]);h[b].push(a[0].geometry.id)});for(c=0;c<h.length;c++)if(h[c])for(a+=" "+b[c-1]+": ",e=0;e<h[c].length;e++)a+=h[c][e]+", "})});return a};return h}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","../../lib/gl-matrix"],function(m,f,k){return function(){function e(e,d,h,c,b,a,l,n,f,q,m){this.shaderTransformationDirty=!0;this.data=e.toRenderData();
this.componentOffsets=e.componentOffsets;this.boundingInfo=d;this.material=h;this.origin=null;this.center=k.vec3d.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=b;c&&this.updateTransformation(c,a);this.castShadow=l;this.singleUse=n;this.name=f;this.uniqueName=q;this.idx=m;this.canBeMerged=!0;this.instanceParameters={}}e.prototype.updateTransformation=function(e,d){this.transformation=e;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(e,d,
this.center)};e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};e.prototype.getBoundingSphere=function(e,d,h){d=d||k.mat4d.maxScale(e);k.mat4d.multiplyVec3(e,this.boundingInfo.getCenter(),h);return this.boundingInfo.getBSRadius()*d};Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?
(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=k.mat4d.create()),k.mat4d.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return e}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../lib/gl-matrix ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/ProgramRepository ../lib/tracer ../lighting/Lightsources ./Model ./Viewport ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/FramebufferObject ../../../webgl/RenderingContext".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){var v=g.getLogger("esri.views.3d.webgl-engine.parts.View");m=function(){function g(d,e,g,k){var n=this;this._backgroundColor=h.vec4d.createFrom(1,1,1,1);this._lightDirection=h.vec3d.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._supersampleScreenshots=!0;this._screenshotQueue=[];this._container=d;this._stage=e;this._initializeContext(k);this._programRepository=new l(this._rctx);this._programRepository.globalOptions.viewingMode=
k.viewingMode;this._textureRep=new a(e.getAll(q.ContentType.TEXTURE),this._programRepository,function(){return n._viewport.getCamera().viewport},this._rctx);this._materialRep=new b(this._textureRep,this._programRepository);this._viewport=new r(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,g);this._initializeFrameTask()}
Object.defineProperty(g.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0});g.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){n.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=
!0,z.lightDirection=a._lightDirection,a._viewport.render(z))},postRender:function(){n.end()},update:function(){a.resetNeedsRender();a._performScreenshots()}}};g.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};g.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style",
"width: 100%; height:100%; display:block;");var b=w.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil},a.renderContext);this._gl=n.instrumentContext(b);this._rctx=new x(this._gl,{disabledExtensions:a.deactivatedWebGLExtensions||{}});!a.alpha&&this._rctx.contextAttributes.alpha&&v.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=e("safari")&&
(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas);null!=a.supersampleScreenshots&&(this._supersampleScreenshots=a.supersampleScreenshots)};g.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=this._gl=this._canvas=this._container=
null};g.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};g.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};g.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};g.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};g.prototype.getFrameTask=
function(){return this._frameTask};g.prototype.setLighting=function(a){h.vec3d.set3(0,0,0,this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof p.MainLight){h.vec3d.negate(d.direction,this._lightDirection);break}}this._viewport.setLighting(a);this._needsRender=!0};g.prototype.getEdgeView=function(){return this._viewport.getEdgeView()};g.prototype.getMainLightDirection=function(){return this._lightDirection};g.prototype.getViewParams=function(a){var b={};if(!a||a.backgroundColor)b.backgroundColor=
this._backgroundColor;return b};g.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=a.backgroundColor)};g.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};g.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};g.prototype.getIdleSuspend=
function(){return this._idleSuspend};Object.defineProperty(g.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});g.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};g.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)};g.prototype.setCamera=function(a){this._viewport.setCamera(a)};g.prototype.getCamera=function(){return this._viewport.getCamera()};
g.prototype.getCanvas=function(){return this._canvas};g.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer};g.prototype.takeScreenshot=function(a){var b=this,c=d.createResolver(function(){b._screenshotQueue=b._screenshotQueue.filter(function(a){return a.resolver!==c})});this._screenshotQueue.push({settings:a,resolver:c});this._needsRender=!0;return c.promise};g.prototype.getFramebufferTexture=function(a){return this._viewport.getFramebufferTexture(a)};Object.defineProperty(g.prototype,
"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0});g.prototype._screenshotSuperSampleSettings=function(a){if(!this._supersampleScreenshots)return a;var b=a.framebufferWidth,c=a.framebufferHeight,d=a.region,e=Math.min(B,y/Math.max(b,c));return e<A?a:k({},a,{framebufferWidth:Math.round(b*e),framebufferHeight:Math.round(c*e),pixelRatio:a.pixelRatio*e,resample:{region:{x:Math.round(d.x*e),y:Math.round(d.y*e),width:Math.round(d.width*e),height:Math.round(d.height*
e)},width:b,height:c}})};g.prototype._readbackScreenshot=function(a){var b=a.framebufferWidth,c=a.framebufferHeight,d=a.region;if(a=a.resample){var e=t.createEmptyImageData(b,c,this._ensureScreenshotEncodeCanvas());this._gl.readPixels(0,0,b,c,6408,5121,new Uint8Array(e.data.buffer));b=t.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());return t.resampleHermite(e,b,!0,a.region.x,c-(a.region.y+a.region.height),a.region.width,a.region.height)}e=t.createEmptyImageData(d.width,
d.height,this._ensureScreenshotEncodeCanvas());this._gl.readPixels(d.x,c-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(e.data.buffer));return e};g.prototype._renderScreenshot=function(a){var b=null,c=this._viewport.getCamera();a=this._screenshotSuperSampleSettings(a);var d=a.framebufferWidth,e=a.framebufferHeight,h=!1;if(d!==c.fullWidth||e!==c.fullHeight){var g=c.copy();g.fullWidth=d;g.fullHeight=e;b=c.fovX-g.fovX;h=c.fovY-g.fovY;0>b&&b<h?g.fovX=c.fovX:0>h&&h<b&&(g.fovY=c.fovY);this._drapedRenderer.forceUpdate&&
this._drapedRenderer.forceUpdate(g);h=!0;b=new u(this._rctx,{width:g.fullWidth,height:g.fullHeight,colorTarget:0,depthStencilTarget:3});this._rctx.bindFramebuffer(b);g.setGLViewport(this._rctx);this._rctx.setClearColor.apply(this._rctx,this._backgroundColor);this._rctx.clear(16640);this._viewport.render({lightDirection:this._lightDirection,fbo:b,camera:g,pixelRatio:a.pixelRatio})}a=this._readbackScreenshot(a);b&&b.dispose();this._rctx.bindFramebuffer(null);h&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(c);
return a};g.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var a=0,b=this._screenshotQueue;a<b.length;a++){var c=b[a],d=c.settings;if(this._gl){var e=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(d),d=t.encodeResult(h,d,e,{flipY:!0,premultipliedAlpha:!0});c.resolver(d)}else c.resolver.reject()}this._screenshotQueue=[]}};g.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));
return this._screenshotEncodeCanvas};return g}();var z={lightDirection:h.vec3d.create(),camera:null,fbo:null,pixelRatio:1},y=2048,A=1.5,B=8;return m})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../lib/gl-matrix ../../support/debugFlags ./Camera ./ComponentUtils ./DefaultVertexBufferLayouts ./glUtil3D ./HighlightUtils ./Renderer ./RenderPass ./SliceHelper ./Util ../lighting/Lightsources ../materials/internal/TexOnlyGLMaterial ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){m=function(){function g(b,c,d,e,h,g){var l=this;this._renderTargets={};this._clearColor=k.vec4d.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=b;this._canvas=c;this._programRep=d;this._modelDirtySet=g;this._modelDirtySet.onMaterialChanged=function(a){return l.materialChanged(a)};this._renderer=new a(d,e,h,this._rctx,!0);this._sliceHelper=new n;this._renderer.onHasHighlightsChanged=function(a){if(l.onHasHighlightsChanged)l.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new q.AmbientLight(k.vec3d.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}g.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};g.prototype.createRenderTarget=function(a){return this.createRenderTargetInternal(a,!0)};g.prototype.createHighlightRenderTarget=function(a){return this.createRenderTargetInternal(a,!1)};g.prototype.disposeRenderTarget=
function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};g.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};g.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[]);if(this.onContentChanged)this.onContentChanged()};g.prototype.removeRenderGeometries=function(a){this._renderer.modify([],a);
if(this.onContentChanged)this.onContentChanged()};g.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};g.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};g.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};g.prototype.addRenderGeometryHighlight=
function(a,c){var e=a.instanceParameters,h=b.generateHighlightId();e.componentHighlights=d.addHighlight(e.componentHighlights,null,c,h);this.updateRenderGeometries([a],32);return h};g.prototype.removeRenderGeometryHighlight=function(a,b){var c=a.instanceParameters;c.componentHighlights=d.removeHighlight(c.componentHighlights,b);this.updateRenderGeometries([a],32)};g.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!e.OVERLAY_DRAW_TEST_TEXTURE};g.prototype.processDirtyMaterials=function(){var a=
this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});g.prototype.draw=function(a,b){return this.drawPass(l.MATERIAL,a,b)};g.prototype.drawHighlights=function(a,b){return this.drawPass(l.MATERIAL_HIGHLIGHT,a,b)};g.prototype.drawPass=function(a,b,c){if(this.isEmpty()||a===l.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;
this.processDirtyMaterials();if(!c.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;b=this._renderTargets[b];if(!b)return!1;var d=this._rctx,h=d.gl,g=c.width,n=c.height;if(b.width!==g||b.height!==n)b.resize(g,n),b.colorTexture.setSamplingMode(9729);var f=v.camera;v.fbo=b;v.pixelRatio=c.pixelRatio||1;f.near=1;f.far=1E4;d.bindFramebuffer(b);d.setDepthTestEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);d.setClearColor.apply(d,this._clearColor);d.clear(h.COLOR_BUFFER_BIT);
for(h=0;h<c.views.length;h++){var p=c.views[h];f.viewport=p.viewport;k.mat4d.ortho(0,p.extent[2]-p.extent[0],0,p.extent[3]-p.extent[1],f.near,f.far,f.projectionMatrix);k.mat4d.identity(f.viewMatrix);k.mat4d.translate(f.viewMatrix,[-p.extent[0],-p.extent[1],0]);f.setGLViewport(this._rctx);e.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(g,n,x[c.index%x.length]);this._renderer.renderGeometryPass(a,v,null,null,this._sliceHelper)}d.setDepthTestEnabled(!0);d.setBlendFunctionSeparate(770,771,1,771);d.bindFramebuffer(null);
d.setViewport(0,0,this._canvas.width,this._canvas.height);b.colorTexture.descriptor.hasMipmap&&b.colorTexture.generateMipmap();return!0};g.prototype._drawTestTexture=function(a,b,d){var e=this._rctx,g=e.gl;if(!this._testPatternMat){for(var l=new Uint8Array(a*b*4),n=0,f=0;f<b;f++)for(var p=0;p<a;p++){var q=Math.floor(p/10),m=Math.floor(f/10);2>q||2>m||10*q>a-20||10*m>b-20?(l[n++]=255,l[n++]=255,l[n++]=255,l[n++]=255):(l[n++]=255,l[n++]=255,l[n++]=255,q&1&&m&1?l[n++]=p&1^f&1?0:255:l[n++]=q&1^m&1?0:
128)}a=new w(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},l);this._testPatternMat=new r(this._programRep,a,[1,1,1,1],!0,g.ALWAYS);this._testPatternBindParams={proj:k.mat4d.identity(),view:k.mat4d.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0};this._quadVAO=c.createQuadVAO(e,h.Pos3Tex)}this._testPatternMat.setColor([d[0],d[1],d[2],1]);this._testPatternMat.bind(e,this._testPatternBindParams);this._testPatternMat.bindView(e,
this._testPatternBindParams);e.bindVAO(this._quadVAO);e.drawArrays(5,0,u.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(e)};g.prototype.getOrigin=function(a,b){var c=0;b=10*b/1E4;1<b&&(c=Math.ceil(p.logWithBase(b,2)));b=1E4*Math.pow(2,c);var d=Math.round(a[0]/b),e=Math.round(a[1]/b);a=Math.round(a[2]/b);var c=c+"_"+d+"_"+e+"_"+a,h=this._id2origin[c];null==h&&(h={vec3:k.vec3d.createFrom(d*b,e*b,a*b),id:c},this._id2origin[c]=h);return h};g.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};
g.prototype.createRenderTargetInternal=function(a,b){for(var c=a,d=0;this._renderTargets[c];)c=a+"_"+ ++d;this._renderTargets[c]=t.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:b,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return c};return g}();var x=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],v={fbo:null,camera:new g,pixelRatio:1};return m})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../lib/gl-matrix ../../support/geometryUtils ../../support/mathUtils ./Util".split(" "),
function(m,f,k,e,g,d){function h(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+e*e+a*a}function c(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function b(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}m=function(){function f(a,b,c){this._viewUp=k.vec3d.create();this._viewForward=k.vec3d.create();this._viewRight=k.vec3d.create();this._viewport=k.vec4d.create();this._padding=k.vec4d.create();this._fov=55/180*Math.PI;this._near=0;this._far=1E3;this._viewDirty=
!0;this._viewMatrix=k.mat4d.create();this._projectionDirty=!0;this._projectionMatrix=k.mat4d.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=k.mat4d.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=k.mat4d.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[e.plane.create(),e.plane.create(),e.plane.create(),e.plane.create(),e.plane.create(),e.plane.create()];this._fullViewport=null;this.relativeElevation=0;this._eye=k.vec3d.create(a);this._center=
k.vec3d.create(b);this._up=void 0!==c?k.vec3d.create(c):k.vec3d.create([0,0,1]);this._padding=k.vec4d.create()}Object.defineProperty(f.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"up",{get:function(){return this._up},
set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){k.mat4d.set(a,this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=
!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"x",{get:function(){return this._viewport[0]},
set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"width",
{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=
k.vec4d.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==
a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),k.vec4d.set(a,this._padding),this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&
(k.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,b=this.height,c=this.near*Math.tan(this.fovY/2),d=c*this.aspect;k.mat4d.frustum(-d*(1+2*this._padding[3]/a),d*(1+2*this._padding[1]/a),-c*(1+2*this._padding[2]/b),c*(1+2*this._padding[0]/b),this.near,this.far,
this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){k.mat4d.set(a,this._projectionMatrix);this._projectionDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fovX",{get:function(){return d.fovd2fovx(this._fov,
this.width,this.height)},set:function(a){this._fov=d.fovx2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"fovY",{get:function(){return d.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=d.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"distance",{get:function(){return k.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"frustumPlanes",{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=k.mat4d.create()),k.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),k.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/
2)/this.width},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});f.prototype.copyFrom=function(a){k.vec3d.set(a._eye,this._eye);k.vec3d.set(a._center,this._center);k.vec3d.set(a._up,this._up);k.vec4d.set(a._viewport,this._viewport);k.vec4d.set(a._padding,this._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.relativeElevation=a.relativeElevation;a._viewDirty?this._viewDirty=
!0:(k.mat4d.set(a._viewMatrix,this._viewMatrix),k.vec3d.set(a._viewRight,this._viewRight),k.vec3d.set(a._viewUp,this._viewUp),k.vec3d.set(a._viewForward,this._viewForward),this._viewDirty=!1);a._projectionDirty?this._projectionDirty=!0:(k.mat4d.set(a._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;a._frustumPlanesDirty?this._frustumPlanesDirty=!0:(a.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);a._viewInverseTransposeMatrixDirty?
this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?k.mat4d.set(a._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=k.mat4d.create(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?k.vec4d.set(a._fullViewport,this._fullViewport):this._fullViewport=k.vec4d.create(a._fullViewport):this._fullViewport=null;return this};f.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=
a.center;this.up=a.up};f.prototype.copy=function(){var a=new f;a.copyFrom(this);return a};f.prototype.equivalent=function(a){return c(this._eye,a._eye)&&c(this._center,a._center)&&c(this._up,a._up)&&b(this._viewport,a._viewport)&&b(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov};f.prototype.almostEquals=function(a,b,c){void 0===c&&(c=!1);b=k.vec3d.dist(this._eye,this._center)*(b||5E-4);b*=b;c?(k.vec3d.direction(a._center,a._eye,n),k.vec3d.direction(this._center,
this._eye,p),c=1E-10):(k.vec3d.set(a._center,n),k.vec3d.set(this._center,p),c=b);return k.vec3d.dist2(a._eye,this._eye)<b&&k.vec3d.dist2(n,p)<c&&.001>Math.abs(a._fov-this._fov)&&.5>h(a._padding,this._padding)&&.5>h(a._viewport,this._viewport)};f.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0};f.prototype.computePixelSizeAt=function(a){return this.computePixelSizeAtDist(k.vec3d.dist(a,this._eye))};f.prototype.computePixelSizeAtDist=function(a){return 2*
a*Math.tan(this.fovX/2)/this.width};f.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};f.prototype.copyFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=k.vec4d.create()}for(var c=this.frustumPlanes,b=0;6>b;b++)k.vec4d.set(c[b],a[b]);return a};f.prototype.computeFrustumPoints=function(a){if(!a){a=Array(8);for(var b=0;8>b;++b)a[b]=k.vec3d.create()}d.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,a);return a};
f.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],b[2]+c[1]+c[3],b[3]+c[0]+c[2])};f.prototype.applyProjection=function(b,c,d){void 0===d&&(d=!1);b!==a&&k.vec3d.set(b,a);a[3]=1;d&&(c[2]=-a[2]);k.mat4d.multiplyVec4(this.projectionMatrix,a);k.vec3d.scale(a,1/Math.abs(a[3]));b=this.fullViewport;c[0]=g.lerp(0,b[0]+b[2],.5+.5*a[0]);c[1]=g.lerp(0,b[1]+b[3],.5+.5*a[1]);d||(c[2]=.5*(a[2]+1));return c};f.prototype.projectPoint=function(b,c){a[0]=b[0];
a[1]=b[1];a[2]=b[2];a[3]=1;k.mat4d.multiplyVec4(this.viewProjectionMatrix,a);k.vec3d.scale(a,1/Math.abs(a[3]));b=this.fullViewport;c[0]=g.lerp(0,b[0]+b[2],.5+.5*a[0]);c[1]=g.lerp(0,b[1]+b[3],.5+.5*a[1]);c[2]=.5*(a[2]+1);return c};f.prototype.unprojectPoint=function(b,c,d){void 0===d&&(d=!1);if(d)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;k.mat4d.multiply(this.projectionMatrix,this.viewMatrix,l);if(!k.mat4d.inverse(l))return null;d=this.fullViewport;a[0]=
2*(b[0]-d[0])/d[2]-1;a[1]=2*(b[1]-d[1])/d[3]-1;a[2]=2*b[2]-1;a[3]=1;k.mat4d.multiplyVec4(l,a);if(0===a[3])return null;c[0]=a[0]/a[3];c[1]=a[1]/a[3];c[2]=a[2]/a[3];return c};f.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};f.prototype.computeUpGlobal=function(){k.vec3d.subtract(this.center,this.eye,n);var a=k.vec3d.length(this.center);1>a?(k.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(k.vec3d.dot(n,this.center))>.9999*k.vec3d.length(n)*a||(k.vec3d.cross(n,
this.center,this.up),k.vec3d.cross(this.up,n,this.up),k.vec3d.normalize(this.up),this.markViewDirty())};f.prototype.computeUpLocal=function(){k.vec3d.direction(this.center,this.eye,n);.9999>=Math.abs(n[2])&&(k.vec3d.scale(n,n[2]),k.vec3d.set3(-n[0],-n[1],1-n[2],this.up),k.vec3d.normalize(this.up),this.markViewDirty())};f.prototype._compareAndSetView=function(a,b){c(a,b)||(k.vec3d.set(a,b),this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0)};f.prototype._computeFrustumPlanes=function(a){if(!a){a=
Array(6);for(var b=0;6>b;++b)a[b]=e.plane.create()}d.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,a);return a};f.prototype._ensureViewClean=function(){this._viewDirty&&(k.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),k.vec3d.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),k.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),k.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],
this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return f}();var a=k.vec4d.create(),l=k.mat4d.create(),n=k.vec3d.create(),p=k.vec3d.create();return m})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];f.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},
{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];f.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];f.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];f.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});f.createQuadVAO=function(c,b){void 0===b&&(b=e.Pos2);var a=null;switch(b){case e.Pos3Tex:a=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case e.Pos3:a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case e.Pos2Tex:a=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:a=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new h(c,k.Default3D,{geometry:b},{geometry:g.createVertex(c,35044,
a)})};f.createEmptyTexture=function(c,b){void 0===b&&(b=4);return new d(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:b,height:b})};f.createColorTexture=function(c,b,a){void 0===a&&(a=4);for(var e=new Uint8Array(a*a*4),h=0;h<e.length;h+=4)e[h+0]=255*b[0],e[h+1]=255*b[1],e[h+2]=255*b[2],e[h+3]=255*b[3];return new d(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:a},e)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../3d/support/buffer/typedArrayUtil"],function(m,f,k,e){return function(){function g(d,
e,c,b,a){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=d;this._bufferType=e;this._usage=c;this._id=g._nextId++;this._glName=this._context.gl.createBuffer();b&&this.setData(b,a)}g.createIndex=function(d,e,c,b){return new g(d,34963,e,c,b)};g.createVertex=function(d,e,c){return new g(d,34962,e,c)};Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"indexType",{get:function(){return this._indexType},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});g.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};g.prototype.setData=function(d,h){if(d){if("number"===typeof d){if(0>d&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&
h)switch(this._indexType=h,this._size=d,h){case 5123:d*=2;break;case 5125:d*=4}}else h=d.byteLength,e.isUint16Array(d)&&(h/=2,this._indexType=5123),e.isUint32Array(d)&&(h/=4,this._indexType=5125),this._size=h;h=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,d,this._usage);this._context.bindVAO(h)}};g.prototype.setSubData=function(d,h,c,b){void 0===h&&(h=0);void 0===c&&(c=0);if(d){(0>h||h>=this._size)&&console.error("offset is out of range!");
var a=h,g=c,k=b,f=d.byteLength;e.isUint16Array(d)&&(f/=2,a*=2,g*=2,k*=2);e.isUint32Array(d)&&(f/=4,a*=4,g*=4,k*=4);void 0===b&&(b=f-1);c>=b&&console.error("end must be bigger than start!");h+c-b>this._size&&console.error("An attempt to write beyond the end of the buffer!");h=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);c=this._context.gl;d=ArrayBuffer.isView(d)?d.buffer:d;c.bufferSubData(this._bufferType,a,d.slice(g,k));this._context.bindVAO(h)}};g._nextId=
0;return g}()})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.forEach=function(k,e){if(k.forEach)k.forEach(e);else for(var g=0;g<k.length;g++)e(k[g],g,k)};f.slice=function(k,e,g){if(k.slice)return k.slice(e,g);void 0===e?e=0:(0>e&&(e+=k.length),e=Math.min(k.length,Math.max(0,e)));void 0===g?g=k.length:(0>g&&(g+=k.length),g=Math.min(k.length,Math.max(0,g)));g=Math.max(0,g-e);for(var d=new k.constructor(g),
h=0;h<g;h++)d[h]=k[e+h];return d};f.isArrayBuffer=function(k){return k instanceof ArrayBuffer||k&&k.constructor&&"ArrayBuffer"===k.constructor.name};f.isInt8Array=function(k){return k instanceof Int8Array||k&&k.constructor&&"Int8Array"===k.constructor.name};f.isUint8Array=function(k){return k instanceof Uint8Array||k&&k.constructor&&"Uint8Array"===k.constructor.name};f.isInt16Array=function(k){return k instanceof Int16Array||k&&k.constructor&&"Int16Array"===k.constructor.name};f.isUint16Array=function(k){return k instanceof
Uint16Array||k&&k.constructor&&"Uint16Array"===k.constructor.name};f.isInt32Array=function(k){return k instanceof Int32Array||k&&k.constructor&&"Int32Array"===k.constructor.name};f.isUint32Array=function(k){return k instanceof Uint32Array||k&&k.constructor&&"Uint32Array"===k.constructor.name};f.isFloat32Array=function(k){return k instanceof Float32Array||k&&k.constructor&&"Float32Array"===k.constructor.name};f.isFloat64Array=function(k){return k instanceof Float64Array||k&&k.constructor&&"Float64Array"===
k.constructor.name}})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/has"],function(m,f,k){return function(){function e(g,d,h){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=g;this._desc={pixelFormat:d.pixelFormat,internalFormat:d.internalFormat,dataType:d.dataType,target:d.target?d.target:3553,samplingMode:d.samplingMode?d.samplingMode:9729,wrapMode:d.wrapMode?d.wrapMode:
10497,maxAnisotropy:d.maxAnisotropy,flipped:void 0!==d.flipped?d.flipped:!1,hasMipmap:void 0!==d.hasMipmap?d.hasMipmap:!1,unpackAlignment:d.unpackAlignment?d.unpackAlignment:4,width:d.width,height:d.height,preMultiplyAlpha:void 0!==d.preMultiplyAlpha?d.preMultiplyAlpha:!1};this._id=++e._nextId;this.setData(h)}Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var d=this._context.gl;this._boundToUnits.forEach(function(d){e._context.bindTexture(null,d)});d.deleteTexture(this._glName);this._glName=null}this._context=null}};e.prototype.resize=function(e,d){var h=this._desc;if(h.width!==e||h.height!==d)h.width=e,h.height=d,this.setData(null)};e.prototype.setData=
function(g){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===g&&(g=null);null===g&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var h=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var c=this._desc;e._validateTexture(c);d.pixelStorei(d.UNPACK_ALIGNMENT,c.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha);var b=c.pixelFormat,a=c.internalFormat?
c.internalFormat:b;if(g instanceof ImageData||g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement)c.width&&c.height&&console.assert(g.width===c.width&&g.height===c.height),d.texImage2D(d.TEXTURE_2D,0,a,b,c.dataType,g),c.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=g.width),void 0===this._desc.height&&(this._desc.height=g.height);else{null!=c.width&&null!=c.height||console.error("Width and height must be specified!");d.DEPTH24_STENCIL8&&
a===d.DEPTH_STENCIL&&(a=d.DEPTH24_STENCIL8);var l=c.width,k=c.height;if(null!=g&&"type"in g&&"compressed"===g.type)for(var f=0;;++f){d.compressedTexImage2D(d.TEXTURE_2D,f,a,l,k,0,g.levels[Math.min(f,g.levels.length-1)]);if(1===l&&1===k||!c.hasMipmap)break;l=Math.max(1,l>>1);k=Math.max(1,k>>1)}else if(g)d.texImage2D(d.TEXTURE_2D,0,a,l,k,0,b,c.dataType,g),c.hasMipmap&&this.generateMipmap();else for(f=0;;++f){d.texImage2D(d.TEXTURE_2D,f,a,l,k,0,b,c.dataType,null);if(1===l&&1===k||!c.hasMipmap)break;
l=Math.max(1,l>>1);k=Math.max(1,k>>1)}}e._applySamplingMode(d,this._desc);e._applyWrapMode(d,this._desc);e._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(h,0)};e.prototype.updateData=function(e,d,h,c,b,a){a||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var g=this._context.gl,k=this._desc,f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>h||c>k.width||
b>k.height||d+c>k.width||h+b>k.height)&&console.error("An attempt to update out of bounds of the texture!");a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(console.assert(a.width===c&&a.height===b),g.texSubImage2D(g.TEXTURE_2D,e,d,h,k.pixelFormat,k.dataType,a)):g.texSubImage2D(g.TEXTURE_2D,e,d,h,c,b,k.pixelFormat,k.dataType,a);this._context.bindTexture(f,0)};e.prototype.generateMipmap=function(){var g=this._desc;g.hasMipmap||(g.hasMipmap=
!0,e._validateTexture(g));9729===g.samplingMode?(this._samplingModeDirty=!0,g.samplingMode=9985):9728===g.samplingMode&&(this._samplingModeDirty=!0,g.samplingMode=9984);g=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);this._context.bindTexture(g,0)};e.prototype.setSamplingMode=function(g){g!==this._desc.samplingMode&&(this._desc.samplingMode=g,e._validateTexture(this._desc),this._samplingModeDirty=!0)};e.prototype.setWrapMode=
function(g){g!==this._desc.wrapMode&&(this._desc.wrapMode=g,e._validateTexture(this._desc),this._wrapModeDirty=!0)};e.prototype.applyChanges=function(){var g=this._context.gl,d=this._desc;this._samplingModeDirty&&(e._applySamplingMode(g,d),this._samplingModeDirty=!1);this._wrapModeDirty&&(e._applyWrapMode(g,d),this._wrapModeDirty=!1)};e.prototype.setBoundToUnit=function(e,d){d?this._boundToUnits.add(e):this._boundToUnits.delete(e)};e._isPowerOfTwo=function(e){return 0===(e&e-1)};e._validateTexture=
function(g){(0>g.width||0>g.height)&&console.error("Negative dimension parameters are not allowed!");e._isPowerOfTwo(g.width)&&e._isPowerOfTwo(g.height)||(33071!==g.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),g.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};e._applySamplingMode=function(e,d){var h=d.samplingMode;if(9985===h||9987===h)h=9729;else if(9984===h||9986===h)h=9728;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,
h);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,d.samplingMode)};e._applyWrapMode=function(e,d){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,d.wrapMode);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,d.wrapMode)};e._applyAnisotropicFilteringParameters=function(e,d){if(null!=d.maxAnisotropy){var h=e.capabilities.textureFilterAnisotropic;h&&(e=e.gl,e.texParameterf(e.TEXTURE_2D,h.TEXTURE_MAX_ANISOTROPY,d.maxAnisotropy))}};e._nextId=0;return e}()})},"esri/views/webgl/VertexArrayObject":function(){define(["require",
"exports","../../core/has","./Util"],function(m,f,k,e){return function(){function g(d,e,c,b,a){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=d;this._layout=c;this._buffers=b;this._locations=e;a&&(this._indexBuffer=a);this._id=g._nextId++}Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){var d=this;return Object.keys(this._buffers).reduce(function(e,c){return e+d._buffers[c].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});g.prototype.dispose=function(d){void 0===d&&(d=!0);if(this._context){var e=this._context.capabilities.vao;e&&this._glName&&(e.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(d){for(var c in this._buffers)this._buffers[c].dispose(),
delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};g.prototype.initialize=function(){if(!this._initialized){var d=this._context.capabilities.vao;if(d){var e=d.createVertexArray();d.bindVertexArray(e);this._bindLayout();d.bindVertexArray(null);this._glName=e}this._initialized=!0}};g.prototype.bind=function(){this.initialize();var d=this._context.capabilities.vao;d?d.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};
g.prototype._bindLayout=function(){var d=this._buffers,h=!!this._context.capabilities.vao,c=this._layout,b=this._indexBuffer;d||console.error("Vertex buffer dictionary is empty!");var a=this._context.gl,g;for(g in d){var k=d[g];k||console.error("Vertex buffer is uninitialized!");var f=c[g];f||console.error("Vertex element descriptor is empty!");e.bindVertexBufferLayout(this._context,this._locations,k,f)}b&&(h?a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.glName):this._context.bindBuffer(b))};g.prototype.unbind=
function(){this.initialize();var d=this._context.capabilities.vao;d?d.bindVertexArray(null):this._unbindLayout()};g.prototype._unbindLayout=function(){var d=this._buffers,h=this._layout;d||console.error("Vertex buffer dictionary is empty!");for(var c in d){var b=d[c];b||console.error("Vertex buffer is uninitialized!");e.unbindVertexBufferLayout(this._context,this._locations,b,h[c])}(d=this._indexBuffer)&&this._context.unbindBuffer(d.bufferType)};g._nextId=0;return g}()})},"esri/views/webgl/Util":function(){define(["require",
"exports","../../core/tsSupport/assignHelper","../../core/Error"],function(m,f,k,e){function g(d){return d[0].stride}function d(d){switch(d){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}Object.defineProperty(f,"__esModule",{value:!0});f.vertexCount=function(d,c){return d.vertexBuffers[c].size/g(d.layout[c])};f.getStride=g;f.getBytesPerElement=d;f.addDescriptor=function(e,
c,b,a,g,k){var h=d(a);if(0<e.length){var l=e[0].stride,n=l+h*b;e.forEach(function(a){return a.stride=n});e.push({name:c,count:b,type:a,offset:l,stride:n,normalized:g,divisor:k})}else e.push({name:c,count:b,type:a,offset:0,stride:h*b,normalized:g,divisor:k})};f.assertCompatibleVertexAttributeLocations=function(d,c){(d=d.locations===c.locations)||console.error("VertexAttributeLocations are incompatible");return d};f.hasAttribute=function(d,c){for(var b=0;b<d.length;b++)if(d[b].name===c)return!0;return!1};
f.findAttribute=function(d,c){for(var b=0;b<d.length;b++)if(d[b].name===c)return d[b];return null};f.copyFramebufferToTexture=function(d,c,b,a,e){void 0===e&&(e=0);var h=d.getBoundFramebufferObject(),g=d.getBoundTexture(0);d.bindFramebuffer(c);d.bindTexture(b,0);d.gl.copyTexImage2D(d.gl.TEXTURE_2D,e,b.descriptor.pixelFormat,a[0],a[1],a[2],a[3],0);d.gl.flush();d.bindFramebuffer(h);d.bindTexture(g,0)};f.assert=function(d,c){if(!d)throw new e(c);};f.setBaseInstanceOffset=function(d,c){var b={},a;for(a in d)b[a]=
d[a].map(function(a){return a.divisor?k({},a,{baseInstance:c}):a});return b};f.bindVertexBufferLayout=function(d,c,b,a,e){var h=d.gl,g=d.capabilities.instancing;d.bindBuffer(b);a.forEach(function(a){var b=c[a.name],d=(e?e:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===b&&console.error("There is no location for vertex attribute '"+a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count)h.vertexAttribPointer(b,
a.count,a.type,a.normalized,a.stride,a.offset+d),h.enableVertexAttribArray(b),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(b,a.divisor);else if(9===a.count)for(var l=0;3>l;l++)h.vertexAttribPointer(b+l,3,a.type,a.normalized,a.stride,a.offset+12*l+d),h.enableVertexAttribArray(b+l),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(b+l,a.divisor);else if(16===a.count)for(l=0;4>l;l++)h.vertexAttribPointer(b+l,4,a.type,a.normalized,a.stride,a.offset+16*l+d),h.enableVertexAttribArray(b+l),a.divisor&&
0<a.divisor&&g&&g.vertexAttribDivisor(b+l,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};f.unbindVertexBufferLayout=function(d,c,b,a){var e=d.gl,h=d.capabilities.instancing;d.bindBuffer(b);a.forEach(function(a){var b=c[a.name];if(4>=a.count)e.disableVertexAttribArray(b),a.divisor&&0<a.divisor&&h&&h.vertexAttribDivisor(b,0);else if(9===a.count)for(var d=0;3>d;d++)e.disableVertexAttribArray(b+d),a.divisor&&0<a.divisor&&h&&h.vertexAttribDivisor(b+d,0);else if(16===
a.count)for(d=0;4>d;d++)e.disableVertexAttribArray(b+d),a.divisor&&0<a.divisor&&h&&h.vertexAttribDivisor(b+d,0);else console.error("Unsupported vertex attribute element count: "+a.count)});d.unbindBuffer(34962)}})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/iteratorUtils ../../lib/gl-matrix ../../support/buffer/glUtil ./ComponentUtils ./DefaultVertexAttributeLocations ./Float32ArrayList ./FxaaRenderPass ./HighlightTextureHelper ./InstanceBufferData ./IntervalUtilities ./LinearDepthTextureHelper ./NormalTextureHelper ./RenderContext ./RenderPass ./RenderPluginManager ./RenderSlot ./SmaaRenderPass ./StencilRenderingHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/BufferObject ../../../webgl/Profiling ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M){function N(a){return a.instanceParameters.hidden?[]:d.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)}function I(a,b,c){var d=a.origin.vec3;z.setMatrixTranslation3(L,-d[0],-d[1],-d[2]);e.mat4d.multiply(L,a.transformation,b);e.mat4d.inverse(b,c);e.mat4d.transpose(c)}function G(a,b,c){for(var d in a){var e=a[d];b(d,e);e.origin2data.forEach(function(a,b){c(b,a)})}}function O(a){return!1===a.preinterleaved?
z.getFirstObjectValue(a.indices).length:a.indexCount}var J=e.mat4d.identity();m=function(){function f(c,d,e,h,g){this._lighting=new A.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._renderContext=new r;this._isRendering=!1;this._highlights=[];this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new Q;this._edgeView=null;this.ssaoEnabled=this._edgeViewLoaded=!1;this.renderOptions={antialiasing:"smaa",
earlyOcclusionPixelDraw:!1};this._programRep=c;this._materialRep=d;this._orderedRendering=g;this._rctx=h;this._fxaaPass=new b(h);this._smaaPass=new x(h);this._renderContext.rctx=h;this._renderContext.lightingData=this._lighting.getOld();h.setDepthTestEnabled(!0);h.setFaceCullingEnabled(!0);h.setBlendingEnabled(!1);h.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,
ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._linearDepthTextureHelper=new p(h);this._normalTextureHelper=new q(h);this._highlightTextureHelper=new a(h);this._stencilRenderingHelper=new v(h);this._renderPlugins=new w.RenderPluginManager({rctx:h,gl:h.gl,programRep:c,textureRep:e,materialRep:d});this._initializeFramebufferTexture()}f.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new D(this._rctx,{target:3553,
pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:b}};f.prototype.dispose=function(){var a=this,b=function(b){a._releaseMaterials(b)},c=function(a,b){if(b.type===K.Preinterleaved)for(var c in b.instances)b.instances[c].vao.dispose(!0);else b.vao.dispose(!0)};G(this._mat2DataMerged,b,c);G(this._mat2DataInstanced,b,c);G(this._mat2DataPreinterleaved,b,c);this._mat2DataPreinterleaved=this._mat2DataInstanced=this._mat2DataMerged=null;this._framebuffer.texture.dispose();
this._framebuffer.texture=null;this._linearDepthTextureHelper.enabled=!1;this._normalTextureHelper.enabled=!1;this._stencilRenderingHelper.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)};Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"edgeView",{get:function(){var a=this;this._edgeViewLoaded||(this._edgeViewLoaded=!0,this._edgeView=new y.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){a._needsRender=!0}}),this._edgeView.initialize());return this._edgeView},enumerable:!0,configurable:!0});f.prototype.setLighting=function(a){this._lighting.set(a)};Object.defineProperty(f.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,
configurable:!0});f.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderPlugins.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()};f.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;var b=function(){},c=function(b,c){if(c.type===K.Preinterleaved)for(var d in c.instances)b=c.instances[d].vao.size,a._stats.VBOallocatedSize+=b/4,a._stats.VBOusedSize+=
b/4,a._stats.VBOoptimalSize+=b/4;else a._stats.VBOallocatedSize+=c.buffer.getArray().length,a._stats.VBOusedSize+=c.buffer.getSize(),a._stats.VBOoptimalSize+=c.optimalCount};G(this._mat2DataMerged,b,c);G(this._mat2DataInstanced,b,c);G(this._mat2DataPreinterleaved,b,c);this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};f.prototype.getFramebufferTexture=function(a){switch(a){case "linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;
case "normals":return this._normalTextureHelper.framebuffer.colorTexture}return null};f.prototype._addHighlight=function(a){var b=this._getInstance(a);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};f.prototype._removeHighlight=function(a){var b=
this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(f.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});f.prototype._renderHUDVisibility=function(a){var b=this,c=B.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&
a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b._renderInternalSlot(u.OCCLUSION_PIXELS,a)});return e};f.prototype.renderGeometrySlotsPt1=function(a){this._renderPlugins.render(u.INTERNAL_MATERIAL,a);this._renderInternalSlot(u.STENCIL_MATERIAL,a);this._renderPlugins.render(u.OPAQUE_TERRAIN,a);this._renderInternalSlot(u.OPAQUE_MATERIAL,a);this._renderPlugins.render(u.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(u.POSTPROCESSING_ATMOSPHERE_OPAQUE,
this._renderContext);this._renderInternalSlot(u.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(u.LINE_CALLOUTS,this._renderContext));this._renderPlugins.render(u.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};f.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(u.TRANSPARENT_TERRAIN,a)};f.prototype.renderGeometrySlots=function(a){this.renderGeometrySlotsPt1(a);this.renderTransparentTerrain(a)};
f.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this._renderInternalSlot(u.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(u.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(u.HUDMATERIAL2,this._renderContext)};f.prototype._renderHighlights=function(a,b){if(b&&b.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var c=null;b.profilingCallback&&(c=E.startMeasurement(this._renderContext.rctx));var d=a.fbo;this._highlightTextureHelper.prepareHighlightPass(a.camera);
this.renderGeometryPass(t.MATERIAL_HIGHLIGHT,a,null,null,this._renderContext.sliceHelper);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this.renderHUD("both");this._highlightTextureHelper.finish(d);b.render(a,this._highlightTextureHelper.framebuffer);null!==c&&b.profilingCallback&&c.stop(function(a){b.profilingCallback&&b.profilingCallback(a)})}};f.prototype._needsRenderOccluded=function(a){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b][0];if(c&&c.renderOccluded&&c.beginSlot(a)&&
c.isVisible())return!0}return!1};f.prototype._renderOccluded=function(a,b,c){if(b&&c&&c.enabled){var d=this._needsRenderOccluded(u.OPAQUE_MATERIAL)||this._needsRenderOccluded(u.TRANSPARENT_MATERIAL);if(b.enabled=d)d=this._renderContext,b.setupFBOs(a),b.prepareColorPass(),d.pass=t.MATERIAL,d.renderOccludedOnly=!0,this._renderInternalSlot(u.OPAQUE_MATERIAL,d),this._renderInternalSlot(u.TRANSPARENT_MATERIAL,d),d.renderOccludedOnly=!1,b.finish(c.framebuffer),b.apply()}};f.prototype._renderUnordered=function(a,
b,c){var d=this,e=this._rctx;this._isRendering=!0;this._stats.reset();var h=a.camera,g=a.fbo,l=a.pixelRatio;this._updateGlobalUniforms(h.projectionMatrix);this._renderContext.pass=t.MATERIAL;this._renderContext.camera=h;this._renderContext.pixelRatio=l;this._renderContext.shadowMap=b;this._renderContext.sliceHelper=c.slice;this._renderContext.ssaoHelper=c.ssao;this._renderContext.offscreenRenderingHelper=c.offscreenRendering;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;
this._renderContext.depth=this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.highlight=this._highlightTextureHelper.framebuffer;this._renderContext.options=this.renderOptions;c.offscreenRendering.enabled=!0;c.offscreenRendering.initializeFrame(h,g);this._renderPlugins.render(u.BACKGROUND,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this.edgeView.shouldRender()&&c.offscreenRendering.renderSeparateAndComposite(function(){d._edgeView.render(d._bindParameters)},
void 0,"alpha");l=b=!1;this.renderOptions.earlyOcclusionPixelDraw||(b=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(u.LINE_CALLOUTS,this._renderContext));(l=this.renderTransparentTerrain(this._renderContext))&&b&&(c.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),c.offscreenRendering.renderToTargets(function(){return d.renderHUD("occluded")},c.offscreenRendering.mainColor,c.offscreenRendering.tmpDepth,void 0,!0));l&&c.offscreenRendering.compositeTransparentTerrainOntoMain();
c.offscreenRendering.renderToTargets(function(){d._renderPlugins.render(u.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,d._renderContext);d._renderPlugins.render(u.POSTPROCESSING_EXTERNAL,d._renderContext);d._renderOccluded(h,c.renderOccluded,c.offscreenRendering)},c.offscreenRendering.mainColor,c.offscreenRendering.mainDepth);b=this.renderOptions.antialiasing;"smaa"===b&&this._smaaPass.loadResources(function(){d._needsRender=!0});"smaa"===b&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:c.offscreenRendering.colorTexture},
g)):"fxaa"===b&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:c.offscreenRendering.colorTexture},g)):(c.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable());e.bindFramebuffer(g);this._renderContext.framebufferTex=c.offscreenRendering.colorTexture;this.renderHUD("notOccluded");this._renderHighlights(a,c.highlight);this._isRendering=!1};f.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights()};f.prototype._renderGeometryPassOrderedMaterial=
function(a){for(var b=null,c=0;c<this._renderOrder.length;c++){var d=this._renderOrder[c][1];if(d.instanced){var e=d.instanced||d.merged,h=e[a.pass];h&&h.isVisible()&&(this._renderInternalInstanced(e,h,this._bindParameters,Infinity),b=null)}d.merged&&(e=d.merged,(h=e[a.pass])&&h.isVisible()&&(d=h.getProgram(),d!==b&&(d.setUniformMatrix4fv("model",J),d.hasUniform("modelNormal")&&d.setUniformMatrix4fv("modelNormal",J)),b=d,this._renderInternalMerged(e,h,this._bindParameters,Infinity)))}};f.prototype._renderGeometryPassOrdered=
function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;P[0]=b.near;P[1]=b.far;this._bindParameters.nearFar=P;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=a.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;a.isHighlightPass?
this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)};f.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,b)};f.prototype.prepareRender=function(a){this._renderPlugins.prepareRender(a);this._renderContext.rctx.setDepthFunction(513)};f.prototype.render=function(a,b){this._orderedRendering?this._renderOrdered(t.MATERIAL,a):this._renderUnordered(a,b.shadowMap,b)};f.prototype.renderAuxiliaryBuffers=function(a,b){var c=b.ssao,d=b.slice;
b=b.shadowMap;var e=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),h=a.camera,g=a.fbo;if(this._linearDepthTextureHelper.enabled=e)this._linearDepthTextureHelper.setupFBOs(h),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(t.MATERIAL_DEPTH,a,b,c,d),this._linearDepthTextureHelper.finish(g);if(this._normalTextureHelper.enabled=this.ssaoEnabled)this._normalTextureHelper.setupFBOs(h),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(t.MATERIAL_NORMAL,
a,b,c,d),this._normalTextureHelper.finish(g),c.computeSSAO(h,g,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer);c.bindAll(this._programRep)};f.prototype.renderGeometryPass=function(a,b,c,d,e){this._isRendering=!0;var h=b.camera;b=b.pixelRatio;this._updateGlobalUniforms(h.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=h;this._renderContext.pixelRatio=b;this._renderContext.shadowMap=c;this._renderContext.ssaoHelper=d;this._renderContext.depth=
this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.sliceHelper=e;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);this._isRendering=!1};f.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};f.prototype._renderInternalHighlights=function(a){void 0===a&&(a=null);for(var b=!1,c=0;c<this._highlights.length;++c){var d=
this._highlights[c],e=d.matData[t.MATERIAL_HIGHLIGHT];e&&(null===a||e.beginSlot(a))&&e.isVisible()&&(b=this._renderInternalHighlight(d,this._bindParameters,t.MATERIAL_HIGHLIGHT)||b)}return b};f.prototype._renderInternalSlotOccluded=function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var e=this._mat2DataInstanced[d],h=e[b.pass];h&&h.renderOccluded&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalInstanced(e,h,this._bindParameters,a)||c)}return c};f.prototype._renderInternalSlotMaterial=
function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var e=this._mat2DataInstanced[d],h=e[b.pass];h&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalInstanced(e,h,this._bindParameters,a)||c)}for(var e=this._programRep.getProgramsUsingUniform("model"),h=this._programRep.getProgramsUsingUniform("modelNormal"),g=0;g<e.length;g++){var l=e[g];l.setUniformMatrix4fv("model",J);-1<h.indexOf(l)&&l.setUniformMatrix4fv("modelNormal",J)}for(d in this._mat2DataMerged)e=this._mat2DataMerged[d],(h=e[b.pass])&&
h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalMerged(e,h,this._bindParameters,a)||c);for(d in this._mat2DataPreinterleaved)e=this._mat2DataPreinterleaved[d],(h=e[b.pass])&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalPreinterleaved(e,h,this._bindParameters,a)||c);a===u.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish();return c};f.prototype._renderInternalSlotHighlights=function(a,b){return this._renderInternalHighlights(a)};f.prototype._renderInternalSlot=function(a,b){this._bindParameters.view=
b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;P[0]=b.camera.near;P[1]=b.camera.far;var c=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=P;this._bindParameters.lightingData=b.lightingData;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.framebufferTex=c?
c.colorTexture:null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=c?c.hudVisibilityTexture:null;return b.isHighlightPass?this._renderInternalSlotHighlights(a,b):b.renderOccludedOnly?this._renderInternalSlotOccluded(a,
b):this._renderInternalSlotMaterial(a,b)};f.prototype._renderInternalInstanced=function(a,b,c,d){var e=this,h=this._rctx,g=h.gl,l=!1,k=b.getDrawMode(h),f=h.capabilities.instancing,n=!1;a.origin2data.forEach(function(a){c.origin=a.origin;d===u.STENCIL_MATERIAL&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());var p=!1;if(b.instanced)for(var q in a.perGeometryDataInfo){var m=a.perGeometryDataInfo[q];l||(b.bind(h,c),l=!0);h.bindVAO(m.vao);var r=b.getProgram();
F.assertCompatibleVertexAttributeLocations(m.vao,r);p||(b.bindView(h,c),p=!0);var r=m.to-m.from,v=m.refCount;k===g.TRIANGLES&&(e._stats.trianglesRendered+=v*r/3);f.drawArraysInstanced(k,m.from,r,v);n=!0;e._stats.drawCallsAngleInstanced++;e._stats.instancesDrawnAngle+=v}else for(m in q=a.instances,q)r=q[m],v=r.displayedIndexRange,v&&0===v.length||(l||(b.bind(h,c),l=!0),p||(h.bindVAO(a.vao),b.bindView(h,c),p=!0),b.bindInstance(h,r),e._stats.drawCallsInstanced++,k===g.TRIANGLES&&(e._stats.trianglesRendered+=
(r.to-r.from)/3),v?e._drawArraysFaceRange(v,r.from,k):h.drawArrays(k,r.from,r.to-r.from),n=!0)});h.bindVAO(null);l&&b.release(h,c);return n};f.prototype._renderInternalHighlight=function(a,b,c){var d=this._rctx,e=d.gl;c=a.matData[c];var h=c.getDrawMode(d),g=a.instance,l=g.highlightedIndexRange,k=this._renderContext.offscreenRenderingHelper,k=(k?k.depthTexture:null)||this._getFallbackDepthTexture(),f=c.getProgram(),n=d.capabilities.instancing;b.origin=a.originData.origin;var p=!1;if(c.instanced&&a.type===
K.Instanced)for(a=a.instancedVAO,c.bind(d,b),d.bindVAO(a),F.assertCompatibleVertexAttributeLocations(a,f),c.bindView(d,b),a=0;a<l.length;a++){var q=l[a],p=q.range?q.range[0]+g.from:g.from,q=q.range?q.range[1]-q.range[0]+1:g.to-g.from;d.bindTexture(k,5);f.setUniform1i("depthTex",5);f.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);n.drawArraysInstanced(h,p,q,1);h===e.TRIANGLES&&(this._stats.trianglesRendered+=1*q/3);this._stats.drawCallsHighlight++;
p=!0}else if(a.type===K.Instanced&&c.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{c.bind(d,b);c.bindView(d,b);n=null;switch(a.type){case K.Merged:q=a.originData;d.bindVAO(q.vao);f.setUniformMatrix4fv("model",J);break;case K.Instanced:q=a.originData;d.bindVAO(q.vao);c.bindInstance(d,g);break;case K.Preinterleaved:q=a.originData,a=q.instances[a.uniqueName].vao,d.bindVAO(a),c.bindInstance(d,g),n=a.indexBuffer&&a.indexBuffer.indexType}for(a=0;a<l.length;a++){q=
l[a];p=q.range?q.range[0]+g.from:g.from;q=q.range?q.range[1]-q.range[0]+1:g.to-g.from;d.bindTexture(k,5);c.getProgram().setUniform1i("depthTex",5);f.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);if(n){var m=F.getBytesPerElement(n);d.drawElements(h,q,n,p*m)}else d.drawArrays(h,p,q);h===e.TRIANGLES&&(this._stats.trianglesRendered+=q/3);this._stats.drawCallsHighlight++;p=!0}}d.bindVAO(null);c.release(d,b);return p};f.prototype._drawArraysFaceRange=
function(a,b,c){for(var d=this._rctx,e=0;e<a.length;e++){var h=a[e];d.drawArrays(c,h[0]+b,h[1]-h[0]+1)}this._stats.drawCallsFragmented+=a.length-1};f.prototype._drawElementsFaceRange=function(a,b,c,d){for(var e=this._rctx,h=F.getBytesPerElement(d),g=0;g<a.length;g++){var l=a[g];e.drawElements(c,l[1]-l[0]+1,d,(l[0]+b)*h)}this._stats.drawCallsFragmented+=a.length-1};f.prototype._renderInternalMerged=function(a,b,c,d){var e=this,h=this._rctx,g=h.gl,l=!1,k=!1;a.origin2data.forEach(function(a){c.origin=
a.origin;d===u.STENCIL_MATERIAL&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());if(!a.displayedIndexRange||0!==a.displayedIndexRange.length){k||(b.bind(h,c),k=!0);var f=b.getProgram();h.bindVAO(a.vao);F.assertCompatibleVertexAttributeLocations(a.vao,f);b.bindView(h,c);e._stats.drawCallsMerged++;f=b.getDrawMode(h);f===g.TRIANGLES&&(e._stats.trianglesRendered+=a.vao.vertexBuffers.geometry.size/3);a.displayedIndexRange?e._drawArraysFaceRange(a.displayedIndexRange,
0,f):h.drawArrays(f,0,F.vertexCount(a.vao,"geometry"));l=!0}});k&&b.release(h,c);return l};f.prototype._renderInternalPreinterleaved=function(a,b,c,d){var e=this,h=this._rctx,g=h.gl,l=!1,k=!1,f=b.getDrawMode(h);a.origin2data.forEach(function(a){c.origin=a.origin;var n=!1;d===u.STENCIL_MATERIAL&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());for(var p in a.instances){var q=a.instances[p],m=q.instance,r=q.vao,q=m.displayedIndexRange;if(!q||0!==q.length){k||
(b.bind(h,c),k=!0);var v=b.getProgram();F.assertCompatibleVertexAttributeLocations(r,v);h.bindVAO(r);n||(b.bindView(h,c),n=!0);b.bindInstance(h,m);e._stats.drawCallsPreinterleaved++;f===g.TRIANGLES&&(e._stats.trianglesRendered+=(m.to-m.from)/3);r=r.indexBuffer&&r.indexBuffer.indexType;q?r?e._drawElementsFaceRange(q,m.from,f,r):e._drawArraysFaceRange(q,m.from,f):r?(q=F.getBytesPerElement(r),h.drawElements(f,m.to-m.from,r,m.from*q)):h.drawArrays(f,m.from,m.to-m.from);l=!0}}});h.bindVAO(null);k&&b.release(h,
c);return l};f.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};f.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,
b=Object.keys(this._mat2DataInstanced).length,c=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+a+"/"+b+"/"+c);var d=0;G(this._mat2DataMerged,function(){},function(a,b){d+=Object.keys(b.instances).length});var e=0;G(this._mat2DataInstanced,function(){},function(a,b){e+=Object.keys(b.instances).length});var h=0;G(this._mat2DataPreinterleaved,function(){},function(a,b){h+=Object.keys(b.instances).length});console.log("number of instances (merged/instanced/preinterleaved): "+
d+"/"+e+"/"+h)};f.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var b=this._mat2DataInstanced[a];if(!k.everyMap(b.origin2data,function(a){return z.objectEmpty(a.instances)}))return!1}for(a in this._mat2DataMerged)if(b=this._mat2DataMerged[a],!k.everyMap(b.origin2data,function(a){return z.objectEmpty(a.instances)}))return!1;for(a in this._mat2DataPreinterleaved)if(b=this._mat2DataPreinterleaved[a],!k.everyMap(b.origin2data,function(a){return z.objectEmpty(a.instances)}))return!1;
return!0};f.prototype.modify=function(a,b,c,d){this._isRendering&&console.warn("Renderer.modify called while rendering");var e=[],h=[],g=[];this._classifyRenderGeometry(a,e,h,g);a=[];var l=[],k=[];this._classifyRenderGeometry(b,a,l,k);var f={};c&&this._performUpdates(c,f);c=[];this._modifyMerged(e,a,c,f);this._modifyInstanced(h,l,c);this._modifyPreinterleaved(g,k,c);this._updateMergedFaceranges(f);this._releaseMaterials(c);e=this._highlights.length;if(b&&0<b.length&&0<e&&(this._highlights=this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===
a.uniqueName})}),e!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);this._updateHighlightVAOs();d&&this._modifyMaterials(d);this._needsRender=!0};f.prototype._classifyRenderGeometry=function(a,b,c,d){for(var e=0;e<a.length;e++){var h=a[e];if(1<=O(h.data))switch(this._getType(h)){case K.Merged:b.push(h);break;case K.Instanced:c.push(h);break;case K.Preinterleaved:d.push(h)}}};f.prototype._performUpdates=function(a,b){for(var c=0;c<a.length;c++){var d=
a[c],e=d.updateType,d=d.renderGeometry,h=this._getType(d)===K.Merged;if(1<=O(d.data)){e&2&&this._updateFaceranges(d,b);if(e&32){var g=this._getInstance(d);g&&this._updateHighlightFaceranges(d,g.instance)}e&4||h&&e&16?this._updateVertexAttributes(d,!h):!h&&e&16&&this._updateInstanceTransformation(d)}}};f.prototype._updateFaceranges=function(a,b){var c=a.material.id,d=a.origin.id,e=this._getType(a),h;if(e===K.Preinterleaved){var g=this._getOriginData(e,c,d);h=g.instances[a.uniqueName].instance}else g=
this._getOriginData(e,c,d),(h=g.instances[a.uniqueName])&&e===K.Merged&&(b[this._modifiedMergedFacerangesKey(c,d)]=g);h&&(h.displayedIndexRange=N(a),this._updateHighlightFaceranges(a,h))};f.prototype._updateHighlightFaceranges=function(a,b){if(b){var c=b.highlightedIndexRange,e;e=a.instanceParameters.hidden?null:d.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets);(b.highlightedIndexRange=e)&&!c?this._addHighlight(a):
!e&&c&&this._removeHighlight(a)}};f.prototype._updateMergedFaceranges=function(a){for(var b in a){var c=a[b];c.displayedIndexRange=[];var d=c.instances,e=!0,h;for(h in d){var g=d[h];g.displayedIndexRange?(c.displayedIndexRange.push.apply(c.displayedIndexRange,n.offsetIntervals(g.displayedIndexRange,g.from)),e=!1):c.displayedIndexRange.push([g.from,g.to-1])}c.displayedIndexRange=e?null:n.mergeIntervals(c.displayedIndexRange)}};f.prototype._updateVertexAttributes=function(a,b){var c=a.material,d=c.bufferWriter,
e=c.id,h=a.origin.id,c=d.vertexBufferLayout.stride/4,g=this._getType(a);if(g===K.Preinterleaved)console.error("Updating Preinterleaved geometry not supported");else{var g=this._getOriginData(g,e,h),e=g.instances[a.uniqueName],h=g.buffer.getArray(),g=g.vao,l,k;b||(I(a,T,S),l=T,k=S);d.write({transformation:l,invTranspTransformation:k},a.data,a.instanceParameters,d.vertexBufferLayout.createView(h.buffer),e.from);z.assert(e.from+d.elementCount(a.data)===e.to,"material VBO layout has changed");g.vertexBuffers.geometry.setSubData(h,
e.from*c*4,e.from*c*4,e.to*c*4)}};f.prototype._updateInstanceTransformation=function(a){var b=this._getType(a),c=a.material.id,d=a.origin.id;b===K.Preinterleaved?(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName].instance,I(a,d.transformation,d.transformationNormal)):(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName],b=b.perGeometryDataInfo[a.data.id],c=b.instanceBufferData,I(a,d.transformation,d.transformationNormal),c&&(a=c.getSlot(a.idx),c.fill(a,0,d.transformation),c.fill(a,16,d.transformationNormal),
a=4*c.getOffset(a),d=F.getStride(b.vao.layout.instance),b.vao.vertexBuffers.instance.setSubData(c.getArray(),a,a,a+d)))};f.prototype._modifyMerged=function(a,b,c,d){a=this._compMatToDelta(a,b,K.Merged);b=this._mat2DataMerged;for(var e in a){var h=a[e],g;for(g in h){var l=h[g],k=l.optimalCount,f=l.sparseCount,n=l.material,p=n.bufferWriter.vertexBufferLayout,q=p.stride/4,m=b[e];null==m&&(z.assert(0<k),m=this._initializeMatData(n),b[e]=m,this._orderedRendering&&this._insertIntoRenderOrder(m,n.renderPriority,
"merged"));var r=m.origin2data.get(g);null==r&&(z.assert(0<k),r=this._createMergedData(p,k,l.origin),m.origin2data.set(g,r));if(0===k)r.vao.dispose(!0),r.vao=null,m.origin2data.delete(g),0===m.origin2data.size&&(c.push(e),delete b[e],this._orderedRendering&&this._removeFromRenderOrder(m,"merged"));else{var v=(p=k<l.sparseCount/2)?k:f,k=R,f=r.buffer.getSize(),m=r.buffer.getArray(),v=r.buffer.resize(v);p||v?this._rebuildMerged(r,l.toRemove,q,m,k):0<l.toRemove.length?(this._removeMergedByErasing(r,l.toRemove,
q,k),0<l.toAdd.length&&(k.end=f)):(k.begin=f,k.end=f);p=L;z.setMatrixTranslation3(p,-l.origin[0],-l.origin[1],-l.origin[2]);this._appendMerged(r,n,l.toAdd,q,p,k);l=r.vao.vertexBuffers.geometry;l.byteSize!==r.buffer.getArray().buffer.byteLength?l.setData(r.buffer.getArray()):(p=k.begin,n=k.end,p<n&&(q=r.buffer.getArray(),p*=4,l.setSubData(q,p,p,4*n)));if(k.updatedDisplayedIndexRange||r.displayedIndexRange)d[this._modifiedMergedFacerangesKey(e,g)]=r}}}};f.prototype._createMergedData=function(a,b,d){return{type:K.Merged,
instances:{},vao:new M(this._rctx,h.Default3D,{geometry:g.glLayout(a)},{geometry:C.createVertex(this._rctx,35044)}),buffer:new c(b),optimalCount:0,origin:d}};f.prototype._rebuildMerged=function(a,b,c,d,e){for(var h=0;h<b.length;++h){var g=a.instances[b[h].uniqueName];a.optimalCount-=(g.to-g.from)*c;delete a.instances[b[h].uniqueName]}b=0;h=a.buffer.getArray();e.begin=0;e.end=0;var l=-1,k=-1,f=0,n;for(n in a.instances){var g=a.instances[n],p=g.from*c,q=g.to*c,m=q-p;l!==k&&k!==p?(h.set(d.subarray(l,
k),f),f+=k-l,l=p):-1===l&&(l=p);k=q;g.from=b/c;b+=m;g.to=b/c}l!==k&&h.set(d.subarray(l,k),f);e.end=b};f.prototype._removeMergedByErasing=function(a,b,c,d){if(0!==b.length){d.begin=Infinity;d.end=-Infinity;for(var e=-1,h=-1,g=0;g<b.length;g++){var l=b[g].uniqueName,k=a.instances[l].from*c,f=a.instances[l].to*c;e!==h&&h!==k?(a.buffer.erase(e,h),e=k):-1===e&&(e=k);h=f;delete a.instances[l];a.optimalCount-=f-k;k<d.begin&&(d.begin=k);f>d.end&&(d.end=f)}e!==h&&a.buffer.erase(e,h)}};f.prototype._appendMerged=
function(a,b,c,d,h,g){g.updatedDisplayedIndexRange=!1;b=b.bufferWriter;for(var l=0;l<c.length;l++){var k=c[l],f=k.data;e.mat4d.multiply(h,k.transformation,T);e.mat4d.inverse(T,S);e.mat4d.transpose(S);var n=g.end;b.write({transformation:T,invTranspTransformation:S},f,k.instanceParameters,b.vertexBufferLayout.createView(a.buffer.getArray().buffer),g.end/d);var f=b.elementCount(f)*d,p=n+f;z.assert(null==a.instances[k.uniqueName]);var q=N(k),n=new H(k.name,n/d,p/d,q,void 0,void 0,k.idx);a.instances[k.uniqueName]=
n;this._updateHighlightFaceranges(k,n);q&&(g.updatedDisplayedIndexRange=!0);a.optimalCount+=f;g.end+=f}};f.prototype._modifyInstanced=function(a,b,d){var k=this._rctx,f=K.Instanced;a=this._compMatToDelta(a,b,f);b=this._mat2DataInstanced;for(var n in a){var p=a[n],q;for(q in p){var m=p[q];if(0===m.optimalCount)m=b[n],m.origin2data.get(q).vao.dispose(!0),m.origin2data.delete(q),0===m.origin2data.size&&(d.push(n),delete b[n],this._orderedRendering&&this._removeFromRenderOrder(m,"instanced"));else{var r=
m.material,v=r.bufferWriter,u=b[n];if(null==u){var w=r.renderPriority,u=this._initializeMatData(r);b[n]=u;this._orderedRendering&&this._insertIntoRenderOrder(u,w,"instanced")}var w=v.vertexBufferLayout,y=u[t.MATERIAL].instanced?v.instanceBufferLayout:void 0,x=y&&y.fields.get("instanceColor"),A=y&&y.fields.get("instanceFeatureAttribute"),B=w.stride/4,r=u.origin2data.get(q);null==r&&(r={type:f,instances:{},vao:new M(k,h.Default3D,{geometry:g.glLayout(w)},{geometry:C.createVertex(k,35044)}),buffer:new c(m.optimalCount),
optimalCount:0,perGeometryDataInfo:{},origin:m.origin},u.origin2data.set(q,r));var u=r.buffer.getSize(),I=r.buffer.getArray(),E=m.optimalCount<m.sparseCount/2,D=r.buffer.resize(E?m.optimalCount:m.sparseCount),F;for(F in m.perGeometryDelta){var G=r.perGeometryDataInfo[F];if(G&&G.instanceBufferData){var O=m.perGeometryDelta[F].removeCount;0<O&&G.instanceBufferData.prepareFree(O)}}var T=m.toRemove;if(E||D){for(E=0;E<T.length;++E){D=T[E];delete r.instances[D.uniqueName];F=D.data.id;var J=G=r.perGeometryDataInfo[F];
0===--J.refCount&&null==m.dataId2refCount[F]?(r.optimalCount-=(J.to-J.from)*B,delete r.perGeometryDataInfo[F]):G.instanceBufferData&&G.instanceBufferData.free(D.idx)}var u=0,E=r.buffer.getArray(),D={},X;for(X in r.perGeometryDataInfo)J=r.perGeometryDataInfo[X],z.assert(null==D[J.from]),D[J.from]=J;for(var Q in D)J=D[Q],O=J.from*B,G=J.to*B,E.set(I.subarray(O,G),u),J.from=u/B,u+=G-O,J.to=u/B;for(var S in r.instances)O=r.instances[S],O.from=r.perGeometryDataInfo[O.dataId].from,O.to=r.perGeometryDataInfo[O.dataId].to}else for(E=
0;E<T.length;++E)D=T[E],delete r.instances[D.uniqueName],F=D.data.id,G=r.perGeometryDataInfo[F],0===--G.refCount&&null==m.dataId2refCount[F]?(O=G.from*B,G=G.to*B,r.buffer.erase(O,G),r.optimalCount-=G-O,delete r.perGeometryDataInfo[F]):G.instanceBufferData&&G.instanceBufferData.free(D.idx);z.setMatrixTranslation3(L,-m.origin[0],-m.origin[1],-m.origin[2]);for(F in m.perGeometryDelta)(G=r.perGeometryDataInfo[F])&&G.instanceBufferData&&(E=m.perGeometryDelta[F].addCount,0<E&&G.instanceBufferData.prepareAllocate(E));
I=m.toAdd;for(E=0;E<I.length;++E)if(D=I[E],O=D.data,F=O.id,G=r.perGeometryDataInfo[F],null==G?(v.write({},O,void 0,v.vertexBufferLayout.createView(r.buffer.getArray().buffer),u/B),T=v.elementCount(O)*B,O=u/B,u+=T,G=u/B,r.optimalCount+=T,G={refCount:1,from:O,to:G,vao:null,instanceBufferData:null},y&&(O=y.stride/4,G.vao=new M(k,h.Default3D,{geometry:g.glLayout(w),instance:g.glLayout(y,{divisor:1})},{geometry:r.vao.vertexBuffers.geometry,instance:C.createVertex(k,35044)}),G.instanceBufferData=new l(O,
m.perGeometryDelta[F].addCount)),r.perGeometryDataInfo[F]=G):++G.refCount,z.assert(G.from*B<=r.buffer.getSize()&&G.to*B<=r.buffer.getSize()),O=e.mat4d.create(),e.mat4d.multiply(L,D.transformation,O),T=N(D),O=new H(D.name,G.from,G.to,T,O,D.instanceParameters,D.idx,F),r.instances[D.uniqueName]=O,this._updateHighlightFaceranges(D,O),G=G.instanceBufferData)T=G.allocate(D.idx),G.fill(T,0,O.transformation),G.fill(T,16,O.transformationNormal),x&&G.fill(T,x.offset/4,D.instanceParameters.color),A&&G.fill(T,
A.offset/4,D.instanceParameters.featureAttribute);z.assert(r.optimalCount===m.optimalCount);v=new Float32Array(r.buffer.getArray().buffer,0,r.buffer.getSize());r.vao.vertexBuffers.geometry.setData(v);for(F in r.perGeometryDataInfo)if(w=r.perGeometryDataInfo[F],w.vao&&(v=w.vao.vertexBuffers.instance))y=m.perGeometryDelta[F],0<y.addCount+y.removeCount&&(w=w.instanceBufferData.compact(),v.setData(w))}}}};f.prototype._modifyPreinterleaved=function(a,b,c){for(var d=this._rctx,l=K.Preinterleaved,k=this._mat2DataPreinterleaved,
f=0;f<a.length;f++){var n=a[f],p=n.material,q=p.bufferWriter,m=p.id,r=n.origin.id,v=n.origin.vec3,u=k[m];null==u&&(u=this._initializeMatData(p),k[m]=u);m=u.origin2data.get(r);null==m&&(m={type:l,origin:v,count:0,instances:{}},u.origin2data.set(r,m));z.setMatrixTranslation3(L,-v[0],-v[1],-v[2]);u=e.mat4d.create();e.mat4d.multiply(L,n.transformation,u);v=N(n);r=n.data;r.preinterleaved?null==r.vertexData?z.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available."):(u=new H(n.name,
0,r.indexCount,v,u,n.instanceParameters,n.idx,r.id),v=r.indexData?C.createIndex(d,35044,r.indexData):null,q=new M(d,h.Default3D,{geometry:g.glLayout(q.vertexBufferLayout)},{geometry:C.createVertex(d,35044)},v),q.vertexBuffers.geometry.setData(r.vertexData),r.indexData=null,r.vertexData=null,m.count+=1,m.instances[n.uniqueName]={instance:u,vao:q},this._updateHighlightFaceranges(n,u)):z.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(a=0;a<b.length;a++)n=b[a],v=n.origin,
p=n.material,m=p.id,r=v.id,n=n.uniqueName,u=k[m],d=u.origin2data.get(r),d.instances[n].vao.dispose(),delete d.instances[n],--d.count,0===d.count&&u.origin2data.delete(r),0===u.origin2data.size&&(c.push(m),delete k[m])};f.prototype._compMatToDelta=function(a,b,c){var d={};this._updateMatToDelta(a,!0,c,d);this._updateMatToDelta(b,!1,c,d);return d};f.prototype._updateMatToDelta=function(a,b,c,d){c=c===K.Instanced;for(var e=0;e<a.length;e++){var h=a[e],g=h.origin,l=h.material,k=l.bufferWriter,f=l.id,
n=c?this._mat2DataInstanced[f]:this._mat2DataMerged[f],n=n&&n.origin2data.get(g.id),p=d[f];null==p&&(p={},d[f]=p);f=p[g.id];if(null==f){f={optimalCount:null==n?0:n.optimalCount,sparseCount:null==n?0:n.buffer.getSize(),material:l,toAdd:[],toRemove:[],perGeometryDelta:null,origin:g.vec3};if(c){l={};if(void 0!==n)for(var q in n.perGeometryDataInfo)l[q]=n.perGeometryDataInfo[q].refCount;f.dataId2refCount=l;f.perGeometryDelta={}}p[g.id]=f}g=k.vertexBufferLayout.stride/4;k=k.elementCount(h.data)*g;c?(g=
h.data.id,l=f.perGeometryDelta[g],l||(l={addCount:0,removeCount:0},f.perGeometryDelta[g]=l),b?(l.addCount++,null==f.dataId2refCount[g]&&(f.dataId2refCount[g]=0),1===++f.dataId2refCount[g]&&(f.optimalCount+=k,f.sparseCount+=k),f.toAdd.push(h)):(l.removeCount++,0===--f.dataId2refCount[g]&&(delete f.dataId2refCount[g],f.optimalCount-=k),f.toRemove.push(h))):b?(f.optimalCount+=k,f.sparseCount+=k,f.toAdd.push(h)):(f.optimalCount-=k,f.toRemove.push(h))}};f.prototype._getType=function(a){if(a.data.preinterleaved)return K.Preinterleaved;
var b=!1,c=O(a.data),b=(b=(b=b||!1===a.material.canBeMerged)||a.material.instanced)||!0===a.material.renderOccluded;a.singleUse||(b=b||c>this._threshold);return b?K.Instanced:K.Merged};f.prototype._getTargetMat2Data=function(a){switch(a){case K.Merged:return this._mat2DataMerged;case K.Instanced:return this._mat2DataInstanced;case K.Preinterleaved:return this._mat2DataPreinterleaved}};f.prototype._getOriginData=function(a,b,c){return this._getTargetMat2Data(a)[b].origin2data.get(c)};f.prototype._modifiedMergedFacerangesKey=
function(a,b){return a+"_"+b};f.prototype._insertIntoRenderOrder=function(a,b,c){for(var d=a[t.MATERIAL].materialId,e=this._renderOrder.length,h=0;h<e&&this._renderOrder[h][0]>=b;){var g=this._renderOrder[h][1];if(g.id===d){z.assert(!g[c],"matData for type already exists");g[c]=a;return}h++}d={id:d,instanced:null,merged:null};d[c]=a;this._renderOrder.splice(h,0,[b,d])};f.prototype._removeFromRenderOrder=function(a,b){var c=a[t.MATERIAL].materialId;for(a=0;this._renderOrder[a][1].id!==c;)a++;c=this._renderOrder[a][1];
c[b]=null;c.instanced||c.merged||this._renderOrder.splice(a,1)};f.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[t.MATERIAL].renderPriority;b=b.matData[t.MATERIAL].renderPriority;return a>b?-1:b>a?1:0})};f.prototype._updateRenderOrder=function(a,b){for(var c=b.length,d=0;d<c&&b[d][1].id!==a;)d++;if(d<c){a=b[d][1];a=(a.merged||a.instanced)[t.MATERIAL].renderPriority;var e=b[d][0];if(a!==b[d][0])for(b[d][0]=a,e=a>e?-1:1,d+=e;-1<d&&d<c&&e*b[d][0]>e*
a;){var h=b[d];b[d]=b[d-e];b[d-e]=h;d+=e}}};f.prototype._modifyMaterials=function(a){var b=this;a.forEach(function(a){b._materialRep.updateMaterialParameters(a)})};f.prototype.modifyRenderOrder=function(a){var b=this;this._orderedRendering&&(a.forEach(function(a){b._updateRenderOrder(a,b._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)};f.prototype._initializeMatData=function(a){var b={origin2data:new Map};b[t.MATERIAL]=this._materialRep.aquire(a);b[t.MATERIAL_DEPTH_SHADOWMAP]=
this._materialRep.aquireDepthShadowMap(a);b[t.MATERIAL_NORMAL]=this._materialRep.aquireNormal(a);b[t.MATERIAL_DEPTH]=this._materialRep.aquireDepth(a);b[t.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(a);return b};f.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);
else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};f.prototype._getInstance=function(a){var b=a.uniqueName,c=a.material.id,d=this._getType(a),c=this._getTargetMat2Data(d)[c];if(!c)return null;a=c.origin2data.get(a.origin.id);if(!a)return null;var e;return(e=a.type===K.Preinterleaved?a.instances[b].instance:a.instances[b])?{type:d,uniqueName:b,instance:e,matData:c,originData:a,
instancedVAO:null,instancedVAOBaseInstance:null}:null};f.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,c=a.instance,d=a.originData;if(a.type===K.Instanced&&d.perGeometryDataInfo){var d=d.perGeometryDataInfo[c.dataId],e=d.instanceBufferData;e&&(d=d.vao,c=e.getSlot(c.idx),a.instancedVAOBaseInstance!==c&&(e=F.setBaseInstanceOffset(d.layout,c),a.instancedVAO=new M(b,d.locations,e,d.vertexBuffers,d.indexBuffer),a.instancedVAOBaseInstance=c))}};f.prototype._updateHighlightVAOs=function(){for(var a=
0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};f.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new D(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return f}();var Q=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=
this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),H=function(){return function(a,b,c,d,h,g,l,k){this.name=a;this.from=b;this.to=c;this.displayedIndexRange=d;this.transformation=h;this.instanceParameters=g;this.idx=l;this.dataId=k;null!=h&&(this.transformationNormal=e.mat4d.create(),e.mat4d.set(h,this.transformationNormal),e.mat4d.inverse(this.transformationNormal,
this.transformationNormal),e.mat4d.transpose(this.transformationNormal,this.transformationNormal))}}(),K;(function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"})(K||(K={}));var R={updatedDisplayedIndexRange:!1,begin:0,end:0},P=e.vec2d.create(),L=e.mat4d.identity(),T=e.mat4d.create(),S=e.mat4d.create();return m})},"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(m,f,k){Object.defineProperty(f,
"__esModule",{value:!0});var e={divisor:0,prefixA:!1};f.glLayout=function(d,h){void 0===h&&(h={});h=k({},e,h);var c=d.stride;return d.fieldNames.filter(function(b){b=d.fields.get(b).optional;return!(b&&b.glPadding)}).map(function(b){var a=d.fields.get(b),e=a.constructor.ElementCount,k;k=g[a.constructor.ElementType];if(!k)throw Error("BufferType not supported in WebGL");var f=a.offset,a=!(!a.optional||!a.optional.glNormalized);return{name:h.prefixA?"a"+b[0].toUpperCase()+b.substr(1):b,stride:c,count:e,
type:k,offset:f,normalized:a,divisor:h.divisor}})};var g={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","../../support/mathUtils"],function(m,f,k){return function(){function e(e){null==e?e=16:65536>e&&(e=k.nextHighestPowerOfTwo(e));this.array=new Float32Array(e);this.size=0}e.prototype.resize=function(e,d){void 0===d&&(d=!1);this.size=e;var h;if(this.size>this.array.length){for(e=this.array.length||
1;e<this.size;)e*=2;h=new Float32Array(e);d&&h.set(this.array);this.array=h;return!0}if(this.size<=this.array.length/2){e=this.array.length;for(h=2*this.size;e>=h;)e=Math.floor(e/2);h=new Float32Array(e);d&&h.set(this.array.subarray(0,e));this.array=h;return!0}return!1};e.prototype.append=function(e){var d=this.size;this.resize(this.size+e.length,!0);this.array.set(e,d)};e.prototype.erase=function(e,d){for(;e<d;++e)this.array[e]=0};e.prototype.getArray=function(){return this.array};e.prototype.getSize=
function(){return this.size};return e}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define(["require","exports","../../../webgl/BufferObject","../../../webgl/Program","../../../webgl/VertexArrayObject"],function(m,f,k,e,g){return function(){function d(d){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=d}d.prototype.enable=function(){if(!this.isEnabled){var d=this.rctx;
this.program=new e(d,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new g(d,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new k(d,34962,35044,c)});this.isEnabled=!0}};d.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};d.prototype.render=function(d,c){this.enable();var b=this.rctx;b.bindVAO(this.vao);b.bindFramebuffer(c);var a=0,e=0;null!=c?(a=c.descriptor.width,e=c.descriptor.height):
(a=b.gl.canvas.width,e=b.gl.canvas.height);b.bindProgram(this.program);b.bindTexture(d.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/a,1/e);b.setFaceCullingEnabled(!1);b.drawArrays(4,0,3)};return d}()})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(m,f,k,e){return function(){function g(d,e,c,b,a){void 0===a&&(a={});this._glName=this._context=null;this._locations={};
this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};d||console.error("RenderingContext isn't initialized!");0===e.length&&console.error("Shaders source should not be empty!");this._context=d;this._vertexShaderSource=e;this._fragmentShaderSource=c;if(Array.isArray(a))for(d=
0;d<a.length;d++)this._defines[a[d]]="1";else this._defines=a;this._id=g._nextId++;this._locations=b}Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});g.prototype.getDefine=function(d){return this._defines[d]};g.prototype.dispose=
function(){if(this._context){var d=this._context.gl;this._vShader&&(d.deleteShader(this._vShader),this._vShader=null);this._fShader&&(d.deleteShader(this._fShader),this._fShader=null);this._glName&&(d.deleteProgram(this._glName),this._glName=null);this._context=null}};g.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var d=this._context.gl,e=d.createProgram();
d.attachShader(e,this._vShader);d.attachShader(e,this._fShader);for(var c in this._locations)d.bindAttribLocation(e,this._locations[c],c);d.linkProgram(e);d.getProgramParameter(e,d.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+d.getProgramParameter(e,d.VALIDATE_STATUS)+", gl error ["+d.getError()+"]infoLog: "+d.getProgramInfoLog(e));this._glName=e;this._initialized=!0}};g.prototype.getUniformLocation=function(d){this.initialize();void 0===this._nameToUniformLocation[d]&&
(this._nameToUniformLocation[d]=this._context.gl.getUniformLocation(this._glName,d));return this._nameToUniformLocation[d]};g.prototype.hasUniform=function(d){return null!==this.getUniformLocation(d)};g.prototype.getAttribLocation=function(d){this.initialize();void 0===this._nameToAttribLocation[d]&&(this._nameToAttribLocation[d]=this._context.gl.getAttribLocation(this._glName,d));return this._nameToAttribLocation[d]};g.prototype.setUniform1i=function(d,e){var c=this._nameToUniform1[d];if(void 0===
c||e!==c)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(d),e),this._nameToUniform1[d]=e};g.prototype.setUniform1f=function(d,e){var c=this._nameToUniform1[d];if(void 0===c||e!==c)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(d),e),this._nameToUniform1[d]=e};g.prototype.setUniform1fv=function(d,e){var c=this._nameToUniform1[d];if(void 0===c||e[0]!==c)this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(d),
e),this._nameToUniform1[d]=e[0]};g.prototype.setUniform2f=function(d,e,c){var b=this._nameToUniform2[d];if(void 0===b||e!==b[0]||c!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(d),e,c),void 0===b?this._nameToUniform2[d]=[e,c]:(b[0]=e,b[1]=c)};g.prototype.setUniform2fv=function(d,e){var c=this._nameToUniform2[d];void 0!==c&&g._arraysEqual(e,c)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(d),e),void 0===c?this._nameToUniform2[d]=
g._arrayCopy(e):g._arrayAssign(e,c))};g.prototype.setUniform3f=function(d,e,c,b){var a=this._nameToUniform3[d];if(void 0===a||e!==a[0]||c!==a[1]||b!==a[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(d),e,c,b),void 0===a?this._nameToUniform3[d]=[e,c,b]:(a[0]=e,a[1]=c,a[2]=b)};g.prototype.setUniform3fv=function(d,e){var c=this._nameToUniform3[d];void 0!==c&&g._arraysEqual(e,c)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(d),
e),void 0===c?this._nameToUniform3[d]=g._arrayCopy(e):g._arrayAssign(e,c))};g.prototype.setUniform4f=function(d,e,c,b,a){var h=this._nameToUniform4[d];if(void 0===h||e!==h[0]||c!==h[1]||b!==h[2]||a!==h[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(d),e,c,b,a),void 0===h?this._nameToUniform4[d]=[e,c,b,a]:(h[0]=e,h[1]=c,h[2]=b,h[3]=a)};g.prototype.setUniform4fv=function(d,e){var c=this._nameToUniform4[d];void 0!==c&&g._arraysEqual(e,c)||(this._context.bindProgram(this),
this._context.gl.uniform4fv(this.getUniformLocation(d),e),void 0===c?this._nameToUniform4[d]=g._arrayCopy(e):g._arrayAssign(e,c))};g.prototype.setUniformMatrix3fv=function(d,e,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix3[d];void 0!==b&&(9===b.length?g._matrix3Equal(b,e):g._arraysEqual(e,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(d),c,e),void 0===b?this._nameToUniformMatrix3[d]=g._arrayCopy(e):g._arrayAssign(e,b))};g.prototype.setUniformMatrix4fv=
function(d,e,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix4[d];void 0!==b&&(16===b.length?g._matrix4Equal(b,e):g._arraysEqual(e,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(d),c,e),void 0===b?this._nameToUniformMatrix4[d]=g._arrayCopy(e):g._arrayAssign(e,b))};g._padToThree=function(d){var e=d.toString();1E3>d&&(e=("  "+d).slice(-3));return e};g.prototype._addLineNumbers=function(d){var e=2;return d.replace(/\n/g,function(){return"\n"+g._padToThree(e++)+
":"})};g.prototype._loadShader=function(d){var h=35633===d,c=h?this._vertexShaderSource:this._fragmentShaderSource,b;b="";for(var a in this._defines)b+="#define "+a+" "+this._defines[a]+"\n";b+=c;"webgl2"===this._context.contextVersion&&(b=e.transpileShader(b,h?"vertex":"fragment"));h=this._context.gl;d=h.createShader(d);h.shaderSource(d,b);h.compileShader(d);h.getShaderParameter(d,h.COMPILE_STATUS)||(console.error(h.getShaderInfoLog(d)),console.error(this._addLineNumbers(b)),"webgl2"===this._context.contextVersion&&
(console.log("Shader source before transpilation:"),console.log(c)));return d};g._matrix4Equal=function(d,e){return d[0]===e[0]&&d[1]===e[1]&&d[2]===e[2]&&d[3]===e[3]&&d[4]===e[4]&&d[5]===e[5]&&d[6]===e[6]&&d[7]===e[7]&&d[8]===e[8]&&d[9]===e[9]&&d[10]===e[10]&&d[11]===e[11]&&d[12]===e[12]&&d[13]===e[13]&&d[14]===e[14]&&d[15]===e[15]};g._matrix3Equal=function(d,e){return d[0]===e[0]&&d[1]===e[1]&&d[2]===e[2]&&d[3]===e[3]&&d[4]===e[4]&&d[5]===e[5]&&d[6]===e[6]&&d[7]===e[7]&&d[8]===e[8]};g._arraysEqual=
function(d,e){if(d.length!==e.length)return!1;for(var c=0;c<d.length;++c)if(d[c]!==e[c])return!1;return!0};g._arrayCopy=function(d){for(var e=[],c=0;c<d.length;++c)e.push(d[c]);return e};g._arrayAssign=function(d,e){for(var c=0;c<d.length;++c)e[c]=d[c]};g._nextId=0;return g}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(m,f,k,e){function g(b){return b.map(function(a){return"eof"!==a.type?a.data:""}).join("")}
function d(b,a,c,e){e=e||c;for(var h=0;h<b.length;h++){var g=b[h];if("ident"===g.type&&g.data===c)return e in a?a[e]++:a[e]=0,d(b,a,e+"_"+a[e],e)}return c}function h(b,a,c){void 0===c&&(c="afterVersion");var d={data:"\n",type:"whitespace"},e=function(a){return a<b.length?/[^\r\n]$/.test(b[a].data):!1},h=function(a){for(var b=-1,d=0,e=-1,h=0;h<a.length;h++){var g=a[h];"preprocessor"===g.type&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:g.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===c||"afterPrecision"===
c)&&"preprocessor"===g.type&&/^#version/.test(g.data)&&(e=Math.max(e,h));if("afterPrecision"===c&&"keyword"===g.type&&"precision"===g.data){a:{for(g=h;g<a.length;g++){var l=a[g];if("operator"===l.type&&";"===l.data)break a}g=null}if(null===g)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,g)}b<e&&0===d&&(b=h)}return b+1}(b);e(h-1)&&b.splice(h++,0,d);for(var g=0;g<a.length;g++){var l=a[g];b.splice(h++,0,l)}e(h-1)&&e(h)&&b.splice(h,0,d)}Object.defineProperty(f,"__esModule",
{value:!0});var c=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];f.transpileShader=function(b,a){b=e(b);var l;a:{l="100";var f="300 es";void 0===l&&(l="100");void 0===f&&(f="300 es");for(var p=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,q=0;q<b.length;q++){var m=b[q];if("preprocessor"===m.type){var t=p.exec(m.data);if(t)if(p=t[1].replace(/\s\s+/g," "),p===f){l=p;break a}else if(p===l){m.data="#version "+f;break a}else throw Error("unknown glsl version: "+
p);}}b.splice(0,0,{type:"preprocessor",data:"#version "+f},{type:"whitespace",data:"\n"});l=null}if("300 es"===l)throw Error("shader is already glsl 300 es");p=m=null;q={};t={};for(l=0;l<b.length;++l)switch(f=b[l],f.type){case "keyword":"vertex"===a&&"attribute"===f.data?f.data="in":"varying"===f.data&&(f.data="vertex"===a?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(f.data.trim())&&(f.data=f.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===a&&"gl_FragColor"===
f.data){if(!m){var m=d(b,q,"fragColor"),w=void 0;void 0===w&&(w="lowp");h(b,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:w},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:m},{type:"operator",data:";"}],"afterPrecision")}f.data=m}else"fragment"===a&&"gl_FragDepthEXT"===f.data&&(p||(p=d(b,q,"gl_FragDepth")),f.data=p);break;case "ident":if(0<=k.indexOf(f.data)){if(w="vertex"===a)a:{for(w=l-1;0<=w;w--){var u=
b[w];if("whitespace"!==u.type&&"block-comment"!==u.type)if("keyword"===u.type){if("attribute"===u.data||"in"===u.data){w=!0;break a}}else break}w=!1}if(w)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");f.data in t||(t[f.data]=d(b,q,f.data));f.data=t[f.data]}}for(l=b.length-1;0<=l;--l)f=b[l],"preprocessor"===f.type&&((a=f.data.match(/\#extension\s+(.*)\:/))&&a[1]&&0<=c.indexOf(a[1].trim())&&(a=b[l+1],b.splice(l,a&&"whitespace"===a.type?2:1)),(a=f.data.match(/\#ifdef\s+(.*)/))&&
a[1]&&0<=c.indexOf(a[1].trim())&&(f.data="#if 1"),(a=f.data.match(/\#ifndef\s+(.*)/))&&a[1]&&0<=c.indexOf(a[1].trim())&&(f.data="#if 0"));return g(b)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(m,f){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(m){"use strict;";return function(f){var k=m(),e=[],e=e.concat(k(f));return e=e.concat(k(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(m,f,k){"use strict;";var e="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function g(a){a.length&&u.push({type:e[q],
data:a,position:z,line:x,column:v})}function d(){w=w.length?[]:w;if("/"===t&&"*"===r)return z=p+n-1,q=0,t=r,n+1;if("/"===t&&"/"===r)return z=p+n-1,q=1,t=r,n+1;if("#"===r)return q=2,z=p+n,n;if(/\s/.test(r))return q=9,z=p+n,n;y=/\d/.test(r);A=/[^\w_]/.test(r);z=p+n;q=y?4:A?3:9999;return n}function h(){if(("\r"===r||"\n"===r)&&"\\"!==t)return g(w.join("")),q=999,n;w.push(r);t=r;return n+1}function c(){if("."===t&&/\d/.test(r))return q=5,n;if("/"===t&&"*"===r)return q=0,n;if("/"===t&&"/"===r)return q=
1,n;if("."===r&&w.length){for(;b(w););q=5;return n}if(";"===r||")"===r||"("===r){if(w.length)for(;b(w););g(r);q=999;return n+1}var a=2===w.length&&"\x3d"!==r;if(/[\w_\d\s]/.test(r)||a){for(;b(w););q=999;return n}w.push(r);t=r;return n+1}function b(a){var b=0,c,d;do{c=f.indexOf(a.slice(0,a.length+b).join(""));d=f[c];if(-1===c){if(0<b--+a.length)continue;d=a.slice(0,1).join("")}g(d);z+=d.length;w=w.slice(d.length);return w.length}while(1)}function a(){if("."===r||/[eE]/.test(r))return w.push(r),q=5,
t=r,n+1;if("x"===r&&1===w.length&&"0"===w[0])return q=11,w.push(r),t=r,n+1;if(/[^\d]/.test(r))return g(w.join("")),q=999,n;w.push(r);t=r;return n+1}function l(){"f"===r&&(w.push(r),t=r,n+=1);if(/[eE]/.test(r)||"-"===r&&/[eE]/.test(t))return w.push(r),t=r,n+1;if(/[^\d]/.test(r))return g(w.join("")),q=999,n;w.push(r);t=r;return n+1}var n=0,p=0,q=999,r,t,w=[],u=[],x=1,v=0,z=0,y=!1,A=!1,B="",C;return function(b){u=[];if(null!==b){b=b.replace?b.replace(/\r\n/g,"\n"):b;n=0;B+=b;for(C=B.length;r=B[n],n<
C;){b=n;switch(q){case 0:"/"===r&&"*"===t?(w.push(r),g(w.join("")),q=999):(w.push(r),t=r);n+=1;break;case 1:n=h();break;case 2:n=h();break;case 3:n=c();break;case 4:n=a();break;case 11:/[^a-fA-F0-9]/.test(r)?(g(w.join("")),q=999):(w.push(r),t=r,n+=1);break;case 5:n=l();break;case 9999:if(/[^\d\w_]/.test(r)){var e=w.join("");q=-1<m.indexOf(e)?8:-1<k.indexOf(e)?7:6;g(w.join(""));q=999}else w.push(r),t=r,n+=1;break;case 9:/[^\s]/g.test(r)?(g(w.join("")),q=999):(w.push(r),t=r,n+=1);break;case 999:n=d()}if(b!==
n)switch(B[b]){case "\n":v=0;++x;break;default:++v}}p+=n;B=B.slice(n);return u}w.length&&g(w.join(""));q=10;g("(eof)");return u}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","../../../webgl/FramebufferObject"],function(m,f,k){return function(){function e(e){this._rctx=e;this.viewportToRestore=this.fbo=null}e.prototype.dispose=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)};Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0});e.prototype.prepareHighlightPass=function(e){var d=this._rctx,h=d.gl;e=e.fullViewport;
var c=e[2],b=e[3];this.updateFBO(c,b);this.viewportToRestore=e;this._rctx.setViewport(0,0,c,b);d.bindFramebuffer(this.fbo);d.setClearColor(0,0,0,0);d.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)};e.prototype.finish=function(e){var d=this._rctx;d.bindFramebuffer(e);d.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};e.prototype.updateFBO=function(e,d){this.fbo?this.fbo.resize(e,d):this.fbo=k.createWithAttachments(this._rctx,{target:3553,
pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:e,height:d},{colorTarget:0,depthStencilTarget:1})};return e}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(m,f,k,e,g){return function(){function d(h,c,b,a){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=h;this._desc={colorTarget:c.colorTarget,depthStencilTarget:c.depthStencilTarget,
width:c.width,height:c.height,multisampled:c.multisampled};this._id=d._nextId++;b&&(h=void 0,b instanceof g?(this._colorAttachment=b,h=b.descriptor):(h=b,this._colorAttachment=new g(this._context,h)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),d._validateTextureDimensions(h,this._desc));a instanceof e?(2===c.depthStencilTarget?this._stencilAttachment=a:1===c.depthStencilTarget||3===c.depthStencilTarget?
this._depthAttachment=a:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),d._validateBufferDimensions(a.descriptor,this._desc)):a&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),c=void 0,a instanceof g?(this._depthStencilTexture=a,c=this._depthStencilTexture.descriptor):
(c=a,this._depthStencilTexture=new g(this._context,c)),d._validateTextureDimensions(c,this._desc))}d.create=function(e,c){return new d(e,c)};d.createWithAttachments=function(e,c,b,a){return new d(e,b,c,a)};Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"descriptor",{get:function(){return this._desc},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof g?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"height",{get:function(){return this._desc.height},
enumerable:!0,configurable:!0});d.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context=null)};d.prototype.attachColorTexture=function(e){if(e){d._validateTextureDimensions(e.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,
c.COLOR_ATTACHMENT0,c.TEXTURE_2D,e.glName,0)}this._colorAttachment=e}};d.prototype.detachColorTexture=function(){var d=void 0;if(this._colorAttachment instanceof g){d=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null,0)}this._colorAttachment=null}return d};d.prototype.attachDepthStencilTexture=function(e){if(e){var c=e.descriptor;34041!==c.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
34042!==c.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");d._validateTextureDimensions(c,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferTexture2D(c.FRAMEBUFFER,
c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,e.glName,0));this._depthStencilTexture=e}};d.prototype.detachDepthStencilTexture=function(){var d=this._depthStencilTexture;if(d&&this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;this._context.gl.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return d};d.prototype.attachDepthStencilBuffer=function(e){if(e){var c=e.descriptor;34041!==c.internalFormat&&33189!==c.internalFormat&&
console.error("Depth/Stencil buffer must have correct internalFormat");d._validateBufferDimensions(c,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===c.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,e.glName));this._depthAttachment=e}};d.prototype.detachDepthStencilBuffer=function(){var d=
this._context.gl,c=this._depthAttachment;c&&this._initialized&&(this._context.bindFramebuffer(this),d.framebufferRenderbuffer(d.FRAMEBUFFER,1===this._desc.depthStencilTarget?d.DEPTH_ATTACHMENT:d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,null));this._depthAttachment=null;return c};d.prototype.copyToTexture=function(d,c,b,a,e,g,k){(0>d||0>c||0>e||0>g)&&console.error("Offsets cannot be negative!");(0>=b||0>=a)&&console.error("Copy width and height must be greater than zero!");var h=this._desc,l=k.descriptor;
3553!==k.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(d+b>h.width||c+a>h.height||e+b>l.width||g+a>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");h=this._context;h.bindTexture(k);h.bindFramebuffer(this);h.gl.copyTexSubImage2D(3553,0,e,g,d,c,b,a)};d.prototype.readPixels=function(d,c,b,a,e,g,k){(0>=b||0>=a)&&console.error("Copy width and height must be greater than zero!");k||console.error("Target memory is not initialized!");
this._context.bindFramebuffer(this);this._context.gl.readPixels(d,c,b,a,e,g,k)};d.prototype.resize=function(e,c){var b=this._desc;if(b.width!==e||b.height!==c)if(this._initialized)b.width=e,b.height=c,this._colorAttachment instanceof g?(a=this._colorAttachment,b=a.descriptor,b.width=e,b.height=c,this._colorAttachment.dispose(),this._colorAttachment=new g(this._context,b),d._validateTextureDimensions(a.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?
(b=this._depthStencilTexture.descriptor,b.width=e,b.height=c,this._depthStencilTexture.dispose(),this._depthStencilTexture=new g(this._context,b)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{b.width=e;b.height=c;if(this._colorAttachment instanceof g){var a=this._colorAttachment;a.resize(e,c)}this._depthStencilTexture&&this._depthStencilTexture.resize(e,
c)}};d.prototype.initialize=function(){if(this._initialized)return!1;var d=this._context.gl;this._glName&&d.deleteFramebuffer(this._glName);var c=d.createFramebuffer(),b=this._desc;d.bindFramebuffer(d.FRAMEBUFFER,c);if(!this._colorAttachment)if(0===b.colorTarget)this._colorAttachment=new g(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:b.width,height:b.height});else{var a=new e(this._context,{internalFormat:32854,width:b.width,height:b.height});d.framebufferRenderbuffer(d.FRAMEBUFFER,
d.COLOR_ATTACHMENT0,d.RENDERBUFFER,a.glName);this._colorAttachment=a}this._colorAttachment instanceof g&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this._colorAttachment.glName,0);switch(b.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new e(this._context,{internalFormat:1===b.depthStencilTarget?33189:34041,width:b.width,height:b.height}));d.framebufferRenderbuffer(d.FRAMEBUFFER,1===b.depthStencilTarget?d.DEPTH_ATTACHMENT:d.DEPTH_STENCIL_ATTACHMENT,
d.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new e(this._context,{internalFormat:36168,width:b.width,height:b.height}));d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
this._depthStencilTexture=new g(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:b.width,height:b.height})),d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,this._depthStencilTexture.glName,0)}d.checkFramebufferStatus(d.FRAMEBUFFER)!==d.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=c;return this._initialized=!0};d.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof
g){var d=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,null,0)}d.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(d=this._colorAttachment,c=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(d));this._colorAttachment=
null};d.prototype._disposeDepthStencilAttachments=function(){var d=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),d.framebufferRenderbuffer(d.FRAMEBUFFER,1===this._desc.depthStencilTarget?d.DEPTH_ATTACHMENT:d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,
d.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};d._validateBufferDimensions=function(d,c){console.assert(0<=d.width&&0<=d.height);void 0!==c.width&&0<=c.width&&void 0!==c.height&&0<=c.height?c.width===d.width&&c.height===d.height||
console.error("Renderbuffer dimensions must match the framebuffer's!"):(c.width=d.width,c.height=d.height)};d._validateTextureDimensions=function(d,c){console.assert(0<=d.width&&0<=d.height);3553!==d.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==c.width&&0<=c.width&&void 0!==c.height&&0<=c.height?c.width===d.width&&c.height===d.height||console.error("Color attachment texture must match the framebuffer's!"):(c.width=d.width,c.height=d.height)};d._nextId=0;return d}()})},"esri/views/webgl/Renderbuffer":function(){define(["require",
"exports","../../core/has"],function(m,f,k){return function(){function e(g,d){this._context=g;this._desc=d;this._glName=null;this._id=-1;g=this._context.gl;this._id=++e._nextId;this._glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);g.renderbufferStorage(g.RENDERBUFFER,d.internalFormat,d.width,d.height)}Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});e.prototype.resize=function(e,d){var h=this._context.gl,c=this._desc;if(c.width!==e||c.height!==d)c.width=e,c.height=d,this._context.bindRenderbuffer(this),h.renderbufferStorage(h.RENDERBUFFER,c.internalFormat,c.width,c.height)};e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=
null};e._nextId=0;return e}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","../../support/mathUtils"],function(m,f,k){return function(){function e(e,d){null==d&&(d=4);var h=k.nextHighestPowerOfTwo(d*e);this.array=new Float32Array(h);this.zeroItem=new Float32Array(e);this.endSlot=0;this.perInstanceDataSize=e;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(d)}e.prototype.prepareFree=function(e){this.emptySlots.length+=e};e.prototype.free=
function(e){e=this.id2slot[e];null!=e&&(this.emptySlots[this.emptySlotsIdx++]=e,this.slot2id[e]=void 0)};e.prototype.prepareAllocate=function(e){e-=this.emptySlotsIdx;0<e&&this._resizeArray((this.endSlot+e)*this.perInstanceDataSize)};e.prototype.allocate=function(e){var d;d=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++;this.id2slot[e]=d;this.slot2id[d]=e;return d};e.prototype.getSlot=function(e){return this.id2slot[e]};e.prototype.getOffset=function(e){return e*this.perInstanceDataSize};
e.prototype.getArray=function(){return this.array};e.prototype.fill=function(e,d,h){this.array.set(h,e*this.perInstanceDataSize+d)};e.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(b,a){return b-a});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var e=this.endSlot-1,d=this.emptySlots[this.emptySlotsIdx],
h=e*this.perInstanceDataSize,c=d*this.perInstanceDataSize;this.array.set(this.array.subarray(h,h+this.perInstanceDataSize),c);this.array.set(this.zeroItem,h);h=this.slot2id[e];this.slot2id[e]=void 0;this.slot2id[d]=h;this.id2slot[h]=d;this.endSlot--}}this._resizeArray(this.endSlot*this.perInstanceDataSize);this.emptySlots.length=0;return this.array};e.prototype._resizeArray=function(e){var d;if(e>this.array.length){for(d=this.array.length||1;d<e;)d*=2;e=new Float32Array(d);e.set(this.array);this.array=
e}else if(e<=this.array.length/2){d=this.array.length;for(e*=2;d>=e;)d/=2;e=new Float32Array(d);e.set(this.array.subarray(0,d));this.array=e}};return e}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(m,f){return function(){function k(){}k.copyIntervals=function(e){for(var g=[],d=0;d<e.length;d++){var h=e[d];g.push([h[0],h[1]])}return g};k.convertFaceToIndexRange=function(e,g){for(var d=0;d<e.length;d++){var h=e[d];h[0]*=g;h[1]=h[1]*g+(g-1)}};
k.sortIntervals=function(e){return e.sort(function(e,d){return e[0]===d[0]?e[1]>d[1]?1:e[1]<d[1]?-1:0:e[0]>d[0]?1:e[0]<d[0]?-1:0})};k.intersectIntervals=function(e,g){if(0>=e.length)return[];for(var d=[],h=0;h<e.length;h++){var c=e[h];c[1]<g[0]||c[0]>g[1]||(c=[c[0],c[1]],c[0]<g[0]&&(c[0]=g[0]),c[1]>g[1]&&(c[1]=g[1]),d.push(c))}return d};k.mergeIntervals=function(e){if(0>=e.length)return[];var g=[];e=this.sortIntervals(e);g.push(e[0]);for(var d=1;d<e.length;d++){var h=g[g.length-1];h[1]+1<e[d][0]?
g.push(e[d]):h[1]<e[d][1]&&(h[1]=e[d][1],g.pop(),g.push(h))}return g};k.invertIntervals=function(e,g){for(var d=[],h=0,c=0;c<e.length;c++){var b=e[c];b[0]>h&&d.push([h,b[0]-1]);h=b[1]+1}h<=g&&d.push([h,g]);return d};k.offsetIntervals=function(e,g){for(var d=[],h=0;h<e.length;h++){var c=e[h];d.push([c[0]+g,c[1]+g])}return d};return k}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(m,f,k,e){return function(){function g(d){this._rctx=
d;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(g.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(d){d!==this.enabled&&(d?this.enable():this.disable())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0});g.prototype.setupFBOs=function(d){k.assert(this.enabled);this.viewportToRestore=d=d.fullViewport;this.width=d[2];this.height=
d[3];this._rctx.setViewport(0,0,this.width,this.height)};g.prototype.prepareDepthPass=function(){k.assert(this.enabled);var d=this._rctx,e=d.gl;this._depthFBO.resize(this.width,this.height);d.bindFramebuffer(this._depthFBO);d.setClearStencil(0);d.setClearColor(0,0,0,0);d.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);d.setBlendingEnabled(!1)};g.prototype.finish=function(d){var e=this._rctx;e.bindFramebuffer(d);e.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],
this.viewportToRestore[3])};g.prototype.enable=function(){k.assert(!this.enabled);this._depthFBO=e.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})};g.prototype.disable=function(){k.assert(this.enabled);this._depthFBO.dispose();this._depthFBO=void 0};return g}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],
function(m,f,k,e){return function(){function g(d){this.rctx=d;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(g.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(d){d?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0});g.prototype.setupFBOs=function(d){k.assert(this.enabled);this.viewportToRestore=
d=d.fullViewport;this.width=d[2];this.height=d[3];this.rctx.setViewport(0,0,this.width,this.height)};g.prototype.prepareNormalPass=function(){k.assert(this.enabled);var d=this.rctx,e=d.gl;this.normalFBO.resize(this.width,this.height);d.bindFramebuffer(this.normalFBO);d.setClearColor(0,0,0,0);d.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)};g.prototype.finish=function(d){var e=this.rctx;e.bindFramebuffer(d);e.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],
this.viewportToRestore[3])};g.prototype.enable=function(){this.enabled||(this.normalFBO=e.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};g.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)};return g}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderPass","./RenderSlot"],function(m,f,k,e){return function(){function g(){this.camera=
null;this.pixelRatio=1;this.normals=this.lightingData=this.highlight=this.depth=null;this.pass=k.MATERIAL;this.shadowMap=null;this.slot=e.BACKGROUND;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.sliceHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=!1}Object.defineProperty(g.prototype,"isHighlightPass",{get:function(){return this.pass===k.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return g}()})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require",
"exports"],function(m,f){var k;m=k||(k={});m[m.MATERIAL=0]="MATERIAL";m[m.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";m[m.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";m[m.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";m[m.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";m[m.MAX_PASS=5]="MAX_PASS";return k})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(m,f){var k;m=k||(k={});m[m.BACKGROUND=0]="BACKGROUND";m[m.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";m[m.STENCIL_MATERIAL=
2]="STENCIL_MATERIAL";m[m.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";m[m.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";m[m.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";m[m.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";m[m.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";m[m.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";m[m.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";m[m.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";m[m.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE";m[m.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=
12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT";m[m.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL";m[m.HUDMATERIAL1=14]="HUDMATERIAL1";m[m.HUDMATERIAL2=15]="HUDMATERIAL2";m[m.LINE_CALLOUTS=16]="LINE_CALLOUTS";m[m.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";m[m.MAX_SLOTS=18]="MAX_SLOTS";return k})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange","./RenderSlot"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});
m=function(){function d(d){this.pluginContext=d;this.pluginsChanged=!1;this.renderPlugins=[];this.slots=[];for(d=0;d<e.MAX_SLOTS;++d)this.slots[d]=[]}d.prototype.add=function(d,c){this.renderPlugins.push(c);for(var b=0;b<d.length;++b)this.slots[d[b]].push(c);c.initializeRenderContext(this.pluginContext);this.pluginsChanged=!0};d.prototype.remove=function(d){this.renderPlugins=this.renderPlugins.filter(function(b){return b!==d});for(var c=0;c<this.slots.length;++c)this.slots[c]=this.slots[c].filter(function(b){return b!==
d});d.uninitializeRenderContext(this.pluginContext);this.pluginsChanged=!0};d.prototype.prepareRender=function(d){for(var c=0,b=this.renderPlugins;c<b.length;c++){var a=b[c];a.prepareRender&&a.prepareRender(d)}};d.prototype.render=function(d,c){c.slot=d;var b=!1,a=0;for(d=this.slots[d];a<d.length;a++){var e=d[a];e.render(c)&&(b=e.didRender=!0)}return b};d.prototype.queryDepthRange=function(d){var c=g;c.near=Infinity;c.far=-Infinity;for(var b=0,a=this.renderPlugins;b<a.length;b++){var e=a[b];e.queryDepthRange&&
(e=e.queryDepthRange(d))&&k.union(c,e,c)}return c};d.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var d=0,c=this.renderPlugins;d<c.length;d++)if(c[d].needsRender)return!0;return!1};d.prototype.needsHighlight=function(){for(var d=0,c=this.renderPlugins;d<c.length;d++)if(c[d].needsHighlight)return!0;return!1};d.prototype.needsLinearDepth=function(){for(var d=0,c=this.renderPlugins;d<c.length;d++)if(c[d].needsLinearDepth)return!0;return!1};d.prototype.resetNeedsRender=function(){this.pluginsChanged=
!1;for(var d=0,c=this.renderPlugins;d<c.length;d++){var b=c[d];b.resetNeedsRender?b.resetNeedsRender():b.didRender&&(b.needsRender=!1,b.didRender=!1)}};return d}();f.RenderPluginManager=m;var g={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(m,f){function k(e,d){return{near:e,far:d}}function e(e,d,h){e.near=d;e.far=h;return e}Object.defineProperty(f,"__esModule",{value:!0});f.create=k;f.empty=function(g){return g?e(g,Infinity,-Infinity):
k(Infinity,-Infinity)};f.set=e;f.union=function(e,d,h){void 0===h&&(h=e);h.near=Math.min(e.near,d.near);h.far=Math.max(e.far,d.far);return h}})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(m,f,k,e,g,d,h,c){return function(){function b(a){this.isEnabled=this._isLoadingResources=
!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.loadResources=function(a){var b=this;return this.data?!0:(this._isLoadingResources=!0,m(["./SmaaRenderPassData"],function(c){b.data=c;b._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});b.prototype.enable=function(){if(this.isEnabled)return!0;
if(!this.loadResources())return!1;var a=this.rctx;this.programEdgeDetect=new d(a,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new d(a,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new d(a,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var b=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(a,this.vertexAttributeLocations,
{geometry:this.vertexBufferLayout},{geometry:new e(a,34962,35044,b)});this.tmpFramebufferEdges=g.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=g.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,
9729,6407);this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409);return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),
this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;null!=b?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setFaceCullingEnabled(!0);c.setCullFace(1029);c.setFrontFace(2305);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!1);c.setViewport(0,0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);
c.setClearColor(0,0,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(this.textureSearch,
1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);
c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3);c.setDepthTestEnabled(!0)};b.prototype.loadTextureFromBase64=function(a,b,c){var d=new h(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);k.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a)});return d};return b}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(m,f,k){Object.defineProperty(f,
"__esModule",{value:!0});f.dataURItoBlob=function(e){var g=atob(e.split(",")[1]);e=e.split(",")[0].split(":")[1].split(";")[0];for(var d=new ArrayBuffer(g.length),h=new Uint8Array(d),c=0;c<g.length;c++)h[c]=g.charCodeAt(c);return new Blob([d],{type:e})};f.requestImage=function(e){return k(e,{responseType:"image"}).then(function(e){return e.data})}})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util"],function(m,f,k){return function(){function e(e){this._enabled=
!1;this._rctx=e}Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0});e.prototype.prepareStencilWritePass=function(){k.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255);e.setStencilOp(7680,7680,7681);e.setStencilWriteMask(255)};e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0);e.setStencilOp(7680,7680,7680)}};e.prototype.enableStencilRead=
function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)};e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)};e.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};e.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};return e}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/workers ../../../lib/gl-matrix ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/bufferViewUtil ../../../support/buffer/typedArrayUtil ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../RegularGridLocalOriginFactory ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject module".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F){Object.defineProperty(f,"__esModule",{value:!0});var M=function(){function f(b,c,d){this.rctx=b;this.programRepository=c;this.callbacks=d;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new t.LocalOriginManager(new u(1E4));this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new y;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=a.vec3d.create();this.tmpCameraPosition=
a.vec3d.create();this.componentColorManager=new x.BufferManager(this.rctx,2)}f.prototype.initialize=function(){var a=this;b.open(c.getAbsMid("./EdgeProcessingWorker",m,F),{client:this}).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var d=v.VertexLayout.createBuffer(4),e=0;4>e;e++)d.sideness.set(e,0,0===e||3===e?0:1),d.sideness.set(e,1,0===e||1===e?0:1);this.verticesBufferObject=E.createVertex(this.rctx,35044,d.buffer)};f.prototype.destroy=function(){this.destroyed||(this.workerThread&&
(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};f.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage};Object.defineProperty(f.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});f.prototype.shouldRender=function(){return 0<this.renderers.size};f.prototype.addObject=function(a,b,c){return e(this,void 0,
void 0,function(){var d,e,l,k,f,n,p;return g(this,function(g){switch(g.label){case 0:if(this.hasObject(a))return[2];d=[];l={loaded:h.create(function(a){return e=a}),renderables:[]};this.perObjectData.set(a,l);if(c&&c.mergeGeometries&&1<a.geometries.length&&this.canMergeGeometries(a))d.push(this.addObjectMergedGeometries(a,l,b));else for(k=0;k<a.geometries.length;k++)f=a.geometries[k],n=a.geometryRecords[k],p=n.materials[0],p.supportsEdges&&(f.data instanceof w?d.push(this.addGeometryPreinterleaved(a,
l,f,f.data,n,b)):d.push(this.addGeometryNonPreinterleaved(a,l,f,f.data,n,b[0])));return[4,h.all(d)];case 1:return g.sent(),this.callbacks.setNeedsRender(),e(),[2]}})})};f.prototype.hasObject=function(a){return this.perObjectData.has(a)};f.prototype.updateAllComponentOpacities=function(a,b){return e(this,void 0,void 0,function(){var c,d;return g(this,function(e){switch(e.label){case 0:return(c=this.perObjectData.get(a))?[4,c.loaded]:[2];case 1:return e.sent(),d=b instanceof Array?function(a){return b[a]}:
function(a){return b},c.renderables.forEach(function(a){for(var b=a.components.meta.length,c=0;c<b;c++){var e=d(c),h=a.components.meta[c],g=h.index;h.material.opacity=e;a.components.buffer.textureBuffer.setDataElement(g,1,3,255*e)}a.allTransparent=C.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};f.prototype.updateAllComponentMaterials=function(a,b){return e(this,void 0,void 0,function(){var c,d=this;return g(this,function(e){switch(e.label){case 0:return(c=
this.perObjectData.get(a))?[4,c.loaded]:[2];case 1:return e.sent(),c.renderables.forEach(function(a){var c=b[0],e=C.determineRequiresUberRenderer(b),h=A.EdgeRenderer.getKey(e,c.type,c.slicePlaneEnabled);if(h!==a.rendererKey){var g=d.renderers.get(a.rendererKey),c=d.aquireRenderer(e,c);g.removeRenderable(a);g.refCount.decrement();a.rendererKey=h;c.addRenderable(a)}for(h=0;h<b.length;h++)a.components.meta[h].material=b[h];d.updateComponentBuffer(a.components);a.allTransparent=C.determineAllTransparent(a.components.meta)}),
this.callbacks.setNeedsRender(),[2]}})})};f.prototype.updateObjectVisibility=function(a,b){return e(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return(c=this.perObjectData.get(a))?[4,c.loaded]:[2];case 1:return d.sent(),c.renderables.forEach(function(a){a.visible=b}),this.callbacks.setNeedsRender(),[2]}})})};f.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});
b.callbacks.setNeedsRender()}))};f.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};f.prototype.createSolidEdgeMaterial=function(a){return k({},N,a,{type:"solid"})};f.prototype.createSketchEdgeMaterial=function(a){return k({},I,a,{type:"sketch"})};f.prototype.render=function(a){var b=this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(b.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();
this.componentColorManager.updateTextures();var c=a.view,d=0,e=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++})});var h={distanceFalloffFactor:d/e*40,minimumEdgeLength:C.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5)},g=this.rctx.capabilities.blendMinMax;g?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,g.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),
this.rctx.setBlendingEnabled(!1));this.rctx.setDepthTestEnabled(!0);this.rctx.setDepthFunction(515);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(c){b.renderRegularEdges(c,a,h);b.renderSilhouetteEdges(c,a,h)});this.rctx.setDepthWriteEnabled(!0);this.rctx.setDepthFunction(513);this.rctx.setBlendEquationSeparate(32774,32774);this.rctx.setBlendFunctionSeparate(1,0,1,1);a.view=c};f.prototype.computeModelTransformWithLocalOrigin=function(b,c,d){b.getCombinedStaticTransformation(c,
d);c.origin?this.localOrigins.register(c.origin):(b=a.vec3d.set3(d[12],d[13],d[14],this.tmpModelPosition),c.origin=this.localOrigins.aquire(b));r.applyToModelMatrix(c.origin.vec3,d);return d};f.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,h=l.clamp(Math.round(d.size*A.LINE_WIDTH_FRACTION_FACTOR),0,255),g=l.clamp(d.extensionLength,-A.EXTENSION_LENGTH_OFFSET,255-A.EXTENSION_LENGTH_OFFSET)+A.EXTENSION_LENGTH_OFFSET,k=
"solid"===d.type?0:1,f=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,h,g,k,f)}};f.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],h=c.aquireIndex();b.push({index:h,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};f.prototype.extractEdges=function(a,b,c,d){return this.worker.process({data:b,originalIndices:d,writerSettings:a,
skipDeduplicate:c},this.workerThread)};f.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new D(this.rctx,v.EdgeShaderAttributeLocations,{vertices:v.glVertexLayout,instances:z.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(c=new D(this.rctx,v.EdgeShaderAttributeLocations,{vertices:v.glVertexLayout,
instances:z.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};f.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};f.prototype.addGeometryNonPreinterleaved=
function(b,c,d,h,l,k){return e(this,void 0,void 0,function(){var d,e,f,n;return g(this,function(g){switch(g.label){case 0:return d=h.getAttribute("position"),e=this.computeModelTransformWithLocalOrigin(b,l,a.mat4d.create()),f=l.origin,n={position:d,indices:h.getIndices("position"),modelTransform:e,origin:f},[4,this.addNonPreinterleaved(b,c,n,k)];case 1:return g.sent(),[2]}})})};f.prototype.addNonPreinterleaved=function(a,b,c,d){return e(this,void 0,void 0,function(){var a,e,h,l,k,f,n,p,q,m,r,u,t,
w,z;return g(this,function(g){switch(g.label){case 0:a=this.aquireRenderer(!1,d);e=c.modelTransform;h=c.origin;l=c.indices;k=c.position;f=k.data.length/k.strideIdx;n=v.EdgeInputBufferLayout.createBuffer(f);for(p=0;p<f;p++)n.position.set(p,0,k.data[k.offsetIdx+p*k.strideIdx+0]),n.position.set(p,1,k.data[k.offsetIdx+p*k.strideIdx+1]),n.position.set(p,2,k.data[k.offsetIdx+p*k.strideIdx+2]);q=this.createComponentBuffers([d]);C.fillComponenBufferIndices(q.meta,[0,n.componentIndex.count],n.componentIndex);
return[4,this.extractEdges(a.writerSettings,n,!1,l)];case 1:return m=g.sent(),r=this.createEdgeResources(m),u=r.regular,t=r.silhouette,w=(u?u.vao.size:0)+(t?t.vao.size:0),z={regular:u,silhouette:t,transform:{modelMatrix:e,origin:h},statistics:{gpuMemoryUsage:w,averageEdgeLength:m.averageEdgeLength},components:q,visible:!0,allTransparent:C.determineAllTransparent(q.meta),distanceToCamera:0,rendererKey:a.key},b.renderables.push(z),a.addRenderable(z),this.gpuMemoryUsage+=w,[2]}})})};f.prototype.addGeometryPreinterleaved=
function(b,c,d,h,l,k){return e(this,void 0,void 0,function(){var d,e,f,m,r,u,t,w,z,y,x,A,B,I,N,E,D;return g(this,function(g){switch(g.label){case 0:d=h.getAttribute("position");if(!d||!q.isFloat32Array(d.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];e=k[0];f=C.determineRequiresUberRenderer(k);m=this.aquireRenderer(f,e);r=this.computeModelTransformWithLocalOrigin(b,l,a.mat4d.create());u=l.origin;t=h.getIndices("position");w=new n.BufferViewVec3f(d.data.buffer,
4*d.offsetIdx,4*d.strideIdx);z=v.EdgeInputBufferLayout.createBuffer(w.count);p.unrolledCopyVec3(z.position,w);y=this.createComponentBuffers(k);C.fillComponenBufferIndices(y.meta,h.componentOffsets,z.componentIndex,t);x=h.hasPositionData;return[4,this.extractEdges(m.writerSettings,z,x,t)];case 1:return A=g.sent(),B=this.createEdgeResources(A),I=B.regular,N=B.silhouette,E=(I?I.vao.size:0)+(N?N.vao.size:0),D={regular:I,silhouette:N,transform:{modelMatrix:r,origin:u},statistics:{gpuMemoryUsage:E,averageEdgeLength:A.averageEdgeLength},
components:y,visible:!b.isHidden(l),allTransparent:C.determineAllTransparent(y.meta),distanceToCamera:0,rendererKey:m.key},c.renderables.push(D),m.addRenderable(D),this.gpuMemoryUsage+=E,[2]}})})};f.prototype.canMergeGeometries=function(a){for(var b=null,c=null,e=0;e<a.geometries.length;e++){var h=a.geometryRecords[e];if(h.materials[0].supportsEdges){if(a.geometries[e].data instanceof w)return!1;if(!b)b=h.transformation;else if(!d.equals(b,h.transformation))return!1;if(!c&&h.origin)c=h;else if(c&&
h.origin&&c.origin.id!==h.origin.id)return!1}}return!0};f.prototype.addObjectMergedGeometries=function(b,c,d){return e(this,void 0,void 0,function(){var e,h,l,k,f,n,p,m,r,v,u,t,w,z,y,x,A,C,B,I,N;return g(this,function(g){switch(g.label){case 0:e=new Map;h=0;k=l=null;for(f=0;f<b.geometries.length;f++)if(n=b.geometries[f],p=b.geometryRecords[f],m=p.materials[0],m.supportsEdges&&(!k&&p.origin&&(k=p),r=n.data.getIndices("position"),h+=r?r.length:0,r&&null==l||l===Uint16Array))l=q.isUint16Array(r)?Uint16Array:
Uint32Array;v=h?new l(h):null;u=[];for(f=t=0;f<b.geometries.length;f++)if(n=b.geometries[f],w=b.geometryRecords[f],m=w.materials[0],m.supportsEdges){z=n.data.getAttribute("position");r=n.data.getIndices("position");y=e.get(z.data);if(null==y){y=u.length/3;for(x=z.offsetIdx;x<z.data.length;x+=z.strideIdx)u.push(z.data[x+0]),u.push(z.data[x+1]),u.push(z.data[x+2]);e.set(z.data,y)}if(r)for(A=0;A<r.length;A++)v[t++]=y+r[A]}C=k||b.geometryRecords[0];B=this.computeModelTransformWithLocalOrigin(b,C,a.mat4d.create());
I=C.origin;for(f=0;f<b.geometryRecords.length;f++)b.geometryRecords[f].origin=I;N={position:{data:u,offsetIdx:0,strideIdx:3},indices:v,modelTransform:B,origin:I};return[4,this.addNonPreinterleaved(b,c,N,d[0])];case 1:return g.sent(),[2]}})})};f.prototype.aquireRenderer=function(a,b){var c=A.EdgeRenderer.getKey(a,b.type,b.slicePlaneEnabled),d=this.renderers.get(c);this.strokesTexture||(this.strokesTexture=B.generateStrokesTexture(this.rctx));d||(d=new A.EdgeRenderer(this.rctx,this.programRepository,
{type:b.type,slicePlaneEnabled:b.slicePlaneEnabled,strokesTexture:this.strokesTexture,uber:a}),this.renderers.set(c,d));d.refCount.increment();return d};f.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};f.prototype.updateObjectCameraDistances=
function(b){var c=this;b=b.viewInvTransp;a.vec3d.set3(b[3],b[7],b[11],this.tmpCameraPosition);this.perObjectData.forEach(function(b,d){var e=a.vec3d.dist(d.getCenter(),c.tmpCameraPosition);b.renderables.forEach(function(a){return a.distanceToCamera=e})})};f.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.regular&&!e.allTransparent){var h=C.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);
a.renderRegularEdges(e,b,h);d.numberOfRenderedEdges+=h}})};f.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette&&!e.allTransparent){var h=C.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderSilhouetteEdges(e,b,h);d.numberOfRenderedEdges+=h}})};return f}();f.EdgeView=M;var N={color:a.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,
opacity:1,slicePlaneEnabled:!1},I={color:a.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1,slicePlaneEnabled:!1}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Single ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,
Float32Array,b,c,d)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(d.BufferViewSingle);f.BufferViewFloat=m;m=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(h.BufferViewVec2Impl);f.BufferViewVec2f=m;m=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(c.BufferViewVec3Impl);
f.BufferViewVec3f=m;m=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(b.BufferViewVec4Impl);f.BufferViewVec4f=m;e=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(e.BufferViewMat3);f.BufferViewMat3f=e;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d)||
this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(g.BufferViewMat4);f.BufferViewMat4f=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(d.BufferViewSingle);f.BufferViewFloat64=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(h.BufferViewVec2Impl);f.BufferViewVec2f64=
g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(c.BufferViewVec3Impl);f.BufferViewVec3f64=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(b.BufferViewVec4Impl);f.BufferViewVec4f64=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType=
"u8";return b}k(b,a);b.ElementType="u8";return b}(d.BufferViewSingle);f.BufferViewUint8=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(h.BufferViewVec2Impl);f.BufferViewVec2u8=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(c.BufferViewVec3Impl);f.BufferViewVec3u8=g;g=function(a){function b(b,
c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(b.BufferViewVec4Impl);f.BufferViewVec4u8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}k(b,a);b.ElementType="u16";return b}(d.BufferViewSingle);f.BufferViewUint16=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d)||this;b.elementType="u16";return b}k(b,a);b.ElementType=
"u16";return b}(h.BufferViewVec2Impl);f.BufferViewVec2u16=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d)||this;b.elementType="u16";return b}k(b,a);b.ElementType="u16";return b}(c.BufferViewVec3Impl);f.BufferViewVec3u16=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d)||this;b.elementType="u16";return b}k(b,a);b.ElementType="u16";return b}(b.BufferViewVec4Impl);f.BufferViewVec4u16=g;g=function(a){function b(b,c,d,e){void 0===
c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";return b}(d.BufferViewSingle);f.BufferViewUint32=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";return b}(h.BufferViewVec2Impl);f.BufferViewVec2u32=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";
return b}(c.BufferViewVec3Impl);f.BufferViewVec3u32=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";return b}(b.BufferViewVec4Impl);f.BufferViewVec4u32=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(d.BufferViewSingle);f.BufferViewInt8=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,
Int8Array,b,c,d)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(h.BufferViewVec2Impl);f.BufferViewVec2i8=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(c.BufferViewVec3Impl);f.BufferViewVec3i8=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(b.BufferViewVec4Impl);f.BufferViewVec4i8=
g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(d.BufferViewSingle);f.BufferViewInt16=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(h.BufferViewVec2Impl);f.BufferViewVec2i16=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d)||this;b.elementType="i16";
return b}k(b,a);b.ElementType="i16";return b}(c.BufferViewVec3Impl);f.BufferViewVec3i16=g;g=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(b.BufferViewVec4Impl);f.BufferViewVec4i16=g;d=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d)||this;b.elementType="i32";return b}k(b,a);b.ElementType="i32";return b}(d.BufferViewSingle);f.BufferViewInt32=d;h=function(a){function b(b,
c,d){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d)||this;b.elementType="i32";return b}k(b,a);b.ElementType="i32";return b}(h.BufferViewVec2Impl);f.BufferViewVec2i32=h;c=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d)||this;b.elementType="i32";return b}k(b,a);b.ElementType="i32";return b}(c.BufferViewVec3Impl);f.BufferViewVec3i32=c;b=function(a){function b(b,c,d){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d)||this;b.elementType="i32";return b}k(b,a);b.ElementType=
"i32";return b}(b.BufferViewVec4Impl);f.BufferViewVec4i32=b})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function k(e,g,d,h){void 0===d&&(d=0);this.TypedArrayConstructor=e;this.elementCount=9;e=this.TypedArrayConstructor;void 0===h&&(h=9*e.BYTES_PER_ELEMENT);this.data=new e(g,0===g.byteLength?0:d);this.elementStride=h/e.BYTES_PER_ELEMENT}k.prototype.getMat=function(e,g){e*=this.elementStride;
for(var d=0;9>d;d++)g[d]=this.data[e+d];return g};k.prototype.setMat=function(e,g){e*=this.elementStride;for(var d=0;9>d;d++)this.data[e+d]=g[d]};k.prototype.get=function(e,g){return this.data[e*this.elementStride+g]};k.prototype.set=function(e,g,d){this.data[e*this.elementStride+g]=d};Object.defineProperty(k.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"buffer",{get:function(){return this.data.buffer},
enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});k.ElementCount=9;return k}();f.BufferViewMat3=m})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});
m=function(){function k(e,g,d,h){void 0===d&&(d=0);this.TypedArrayConstructor=e;this.elementCount=16;e=this.TypedArrayConstructor;void 0===h&&(h=16*e.BYTES_PER_ELEMENT);this.data=new e(g,0===g.byteLength?0:d);this.elementStride=h/e.BYTES_PER_ELEMENT}k.prototype.getMat=function(e,g){e*=this.elementStride;for(var d=0;16>d;d++)g[d]=this.data[e+d];return g};k.prototype.setMat=function(e,g){e*=this.elementStride;for(var d=0;16>d;d++)this.data[e+d]=g[d]};k.prototype.get=function(e,g){return this.data[e*
this.elementStride+g]};k.prototype.set=function(e,g,d){this.data[e*this.elementStride+g]=d};Object.defineProperty(k.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});k.ElementCount=16;return k}();f.BufferViewMat4=m})},"esri/views/3d/support/buffer/internals/Single":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function k(e,g,d,h,c){void 0===d&&(d=0);this.TypedArrayConstructor=e;this.elementCount=1;e=this.TypedArrayConstructor;void 0===h&&(h=e.BYTES_PER_ELEMENT);var b=
0===g.byteLength?0:d;this.data=null==c?new e(g,b):new e(g,b,(c-d)/e.BYTES_PER_ELEMENT);this.elementStride=h/e.BYTES_PER_ELEMENT}k.prototype.get=function(e){return this.data[e*this.elementStride]};k.prototype.set=function(e,g){this.data[e*this.elementStride]=g};Object.defineProperty(k.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,
configurable:!0});Object.defineProperty(k.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});k.ElementCount=1;return k}();f.BufferViewSingle=m})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../lib/gl-matrix"],function(m,f,k){Object.defineProperty(f,"__esModule",
{value:!0});m=function(){function e(e,d,h,c,b){void 0===h&&(h=0);this.TypedArrayConstructor=e;this.elementCount=2;e=this.TypedArrayConstructor;void 0===c&&(c=2*e.BYTES_PER_ELEMENT);var a=0===d.byteLength?0:h;this.data=null==b?new e(d,a):new e(d,a,(b-h)/e.BYTES_PER_ELEMENT);this.elementStride=c/e.BYTES_PER_ELEMENT}e.prototype.getVec=function(e,d){return k.vec2d.set2(this.data[e*this.elementStride],this.data[e*this.elementStride+1],d)};e.prototype.setVec=function(e,d){this.data[e*this.elementStride]=
d[0];this.data[e*this.elementStride+1]=d[1]};e.prototype.get=function(e,d){return this.data[e*this.elementStride+d]};e.prototype.set=function(e,d,h){this.data[e*this.elementStride+d]=h};Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0});e.ElementCount=2;return e}();f.BufferViewVec2Impl=m})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../lib/gl-matrix"],function(m,
f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d,h,c,b){void 0===h&&(h=0);this.TypedArrayConstructor=e;this.elementCount=3;e=this.TypedArrayConstructor;void 0===c&&(c=3*e.BYTES_PER_ELEMENT);var a=0===d.byteLength?0:h;this.data=null==b?new e(d,a):new e(d,a,(b-h)/e.BYTES_PER_ELEMENT);this.elementStride=c/e.BYTES_PER_ELEMENT}e.prototype.getVec=function(e,d){return k.vec3d.set3(this.data[e*this.elementStride],this.data[e*this.elementStride+1],this.data[e*this.elementStride+
2],d)};e.prototype.setVec=function(e,d){this.data[e*this.elementStride]=d[0];this.data[e*this.elementStride+1]=d[1];this.data[e*this.elementStride+2]=d[2]};e.prototype.get=function(e,d){return this.data[e*this.elementStride+d]};e.prototype.set=function(e,d,h){this.data[e*this.elementStride+d]=h};Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0});e.ElementCount=3;return e}();f.BufferViewVec3Impl=m})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require",
"exports","../../../lib/gl-matrix"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d,h,c,b){void 0===h&&(h=0);this.TypedArrayConstructor=e;this.elementCount=4;e=this.TypedArrayConstructor;void 0===c&&(c=4*e.BYTES_PER_ELEMENT);var a=0===d.byteLength?0:h;this.data=null==b?new e(d,a):new e(d,a,(b-h)/e.BYTES_PER_ELEMENT);this.elementStride=c/e.BYTES_PER_ELEMENT}e.prototype.getVec=function(e,d){return k.vec4d.set4(this.data[e*this.elementStride],this.data[e*
this.elementStride+1],this.data[e*this.elementStride+2],this.data[e*this.elementStride+3],d)};e.prototype.setVec=function(e,d){this.data[e*this.elementStride]=d[0];this.data[e*this.elementStride+1]=d[1];this.data[e*this.elementStride+2]=d[2];this.data[e*this.elementStride+3]=d[3]};e.prototype.get=function(e,d){return this.data[e*this.elementStride+d]};e.prototype.set=function(e,d,h){this.data[e*this.elementStride+d]=h};Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/
this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBufferStride",{get:function(){return this.elementStride},
enumerable:!0,configurable:!0});e.ElementCount=4;return e}();f.BufferViewVec4Impl=m})},"esri/views/3d/support/buffer/bufferViewUtil":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.unrolledCopyVec4=function(k,e){var g=k.typedBuffer;k=k.typedBufferStride;var d=e.typedBuffer,h=e.typedBufferStride;e=e.count;for(var c=0;c<e;c++){var b=c*k,a=c*h;g[b]=d[a];g[b+1]=d[a+1];g[b+2]=d[a+2];g[b+3]=d[a+3]}};f.unrolledCopyVec3=function(k,e){var g=k.typedBuffer;
k=k.typedBufferStride;var d=e.typedBuffer,h=e.typedBufferStride;e=e.count;for(var c=0;c<e;c++){var b=c*k,a=c*h;g[b]=d[a];g[b+1]=d[a+1];g[b+2]=d[a+2]}};f.unrolledCopyVec2=function(k,e){var g=k.typedBuffer;k=k.typedBufferStride;var d=e.typedBuffer,h=e.typedBufferStride;e=e.count;for(var c=0;c<e;c++){var b=c*k,a=c*h;g[b]=d[a];g[b+1]=d[a+1]}};f.makeDenseSingle=function(k,e){var g=k.count;e||(e=new k.TypedArrayConstructor(g));for(var d=0;d<g;d++)e[d]=k.get(d);return e}})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.applyToModelMatrix=function(k,e){var g=-k[0],d=-k[1];k=-k[2];var h=e[3],c=e[7],b=e[11],a=e[15];e[0]+=h*g;e[1]+=h*d;e[2]+=h*k;e[4]+=c*g;e[5]+=c*d;e[6]+=c*k;e[8]+=b*g;e[9]+=b*d;e[10]+=b*k;e[12]+=a*g;e[13]+=a*d;e[14]+=a*k};f.applyToViewMatrix=function(k,e){var g=k[0],d=k[1];k=k[2];e[12]+=g*e[0]+d*e[4]+k*e[8];e[13]+=g*e[1]+d*e[5]+k*e[9];e[14]+=g*e[2]+d*e[6]+k*e[10];e[14]+=g*e[3]+d*e[7]+k*e[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require",
"exports","../../lib/gl-matrix","./localOriginHelper"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function g(d){this.factory=d;this.originData=new Map}g.prototype.aquire=function(d){return this.register(this.factory.getOrigin(d))};g.prototype.register=function(d){var e=this.originData.get(d.id);if(e)return e.refCount++,e.origin;this.originData.set(d.id,{refCount:1,viewMatrix:k.mat4d.identity(),origin:d});return d};g.prototype.release=function(d){var e=this.originData.get(d.id);
e&&(e.refCount--,0===e.refCount&&this.originData.delete(d.id))};g.prototype.updateViewMatrices=function(d){this.originData.forEach(function(h){k.mat4d.set(d,h.viewMatrix);e.applyToViewMatrix(h.origin.vec3,h.viewMatrix)})};g.prototype.getViewMatrix=function(d){return this.originData.get(d.id).viewMatrix};return g}();f.LocalOriginManager=m})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],
function(m,f,k,e,g){function d(d){switch(d){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+d);}return function(){function h(c,b,a,l,f,p){void 0===a&&(a=null);void 0===l&&(l=h.DefaultOffsets);void 0===f&&(f=h.DefaultIndices);void 0===p&&(p=!1);this._freeDataAfterUse=p;this.preinterleaved=!0;this.primitiveType="triangle";
this._positionData=null;p=g.getStride(b)/4;p=c.length/p;(this._hasDefaultIndices=f===h.DefaultIndices)&&(f=e.generateDefaultIndexArray(p));p={};for(var n=0;n<b.length;n++){var m=b[n],t=new (d(m.type))(c.buffer),w=g.getBytesPerElement(m.type);p[m.name]={data:t,size:m.count,offsetIdx:m.offset/w,strideIdx:m.stride/w}}a&&(this._positionData=a,p.position={data:a.data,size:3,offsetIdx:0,strideIdx:3});this._id=e.getNewId();this._vertexData=c;this._vertexAttributes=p;this._layout=b;this._indexData=f;this._componentOffsets=
k.createOffsets(l);this._gpuMemoryUsage=c.byteLength+(this._hasDefaultIndices?0:f.byteLength)}Object.defineProperty(h.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});h.prototype.toRenderData=function(){var c={id:this._id.toString(),
preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexData.length,vertexData:this._vertexData,layout:this._layout};this._freeDataAfterUse&&(this._indexData=this._vertexData=null,this._vertexAttributes={position:this._vertexAttributes.position});return c};h.prototype.getIndices=function(c){return"position"===c&&this._positionData?this._positionData.indices:this._indexData};h.prototype.getAttribute=function(c){return this._vertexAttributes[c]};h.prototype.estimateGpuMemoryUsage=
function(){return this._gpuMemoryUsage};Object.defineProperty(h.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});h.DefaultOffsets=new Uint32Array(0);h.DefaultIndices=new Uint32Array(0);return h}()})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});var k=1,e=null;f.generateDefaultIndexArray=function(d){if(d>k||null==e){for(;d>k;)k*=2;e=new Uint32Array(k);
for(var h=0;h<k;h++)e[h]=h}return new Uint32Array(e.buffer,0,d)};var g=0;f.getNewId=function(){return g++}})},"esri/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":function(){define(["require","exports"],function(m,f){return function(){function k(e){this._gridSize=e;this._origins={}}k.prototype.getOrigin=function(e){var g=this._gridSize,d=Math.round(e[0]/g),h=Math.round(e[1]/g);e=Math.round(e[2]/g);var g=""+k.ORIGIN_PREFIX+d+"/"+h+"/"+e,c=this._origins[g];if(!c){var c=this._gridSize,b=k.OFFSET,
c={id:g,vec3:[d*c+b,h*c+b,e*c+b]};this._origins[g]=c}return c};k.ORIGIN_PREFIX="rg_";k.OFFSET=1.11;return k}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d){void 0===d&&(d=1);this.rctx=e;this.fieldCount=d;this.buffers=[]}e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0===
e.activeCount?(e.dispose(),!1):!0})};e.prototype.getBuffer=function(e){for(var d=0,h=this.buffers;d<h.length;d++){var c=h[d];if(c.availableCount>=e)return c}if(e>k.MAX_INDEX_COUNT)return null;e=new k.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(e);return e};e.prototype.updateTextures=function(){for(var e=0,d=this.buffers;e<d.length;e++)d[e].textureBuffer.updateTexture()};return e}();f.BufferManager=m})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require",
"exports","./SimpleIndexManager","./TextureBackedBuffer"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.MAX_INDEX_COUNT=65536;m=function(){function g(d,h){void 0===h&&(h=1);this.textureBuffer=new e.TextureBackedBuffer(d,h);this.indexManager=new k.SimpleIndexManager(f.MAX_INDEX_COUNT)}g.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(g.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});g.prototype.aquireIndex=function(){var d=this.indexManager.aquire();this.textureBuffer.resizeToFit(d);return d};g.prototype.releaseIndex=function(d){this.indexManager.release(d)};return g}();f.ManagedTextureBackedBuffer=m})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],
function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function k(e){this.maxCount=e;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(k.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});k.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};k.prototype.release=function(e){this.recycledIndices.push(e)};return k}();f.SimpleIndexManager=m})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function g(d,h){void 0===h&&(h=1);this.rctx=d;this.fieldCount=h;this.textureWidth=4096;this.dirty=
!0;this.texture=new e(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new k.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}g.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};g.prototype.setData=function(d,e,c,b,a,g){d=d*this.fieldCount+e;this.dirty=!0;this.data.set(d,0,c);this.data.set(d,1,b);this.data.set(d,2,a);this.data.set(d,3,g)};g.prototype.setDataElement=
function(d,e,c,b){d=d*this.fieldCount+e;this.dirty=!0;this.data.set(d,c,b)};g.prototype.resizeToFit=function(d){d*=this.fieldCount;d>=this.data.count&&(d=new k.BufferViewVec4u8(new ArrayBuffer(Math.ceil((d+1)/this.textureWidth)*this.textureWidth*4)),d.typedBuffer.set(this.data.typedBuffer),this.data=d)};g.prototype.updateTexture=function(){if(this.dirty){var d=this.texture.descriptor.width;this.data.count>d*this.texture.descriptor.height&&this.texture.resize(d,this.data.count/d);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};g.prototype.bind=function(d,e){this.rctx.bindTexture(this.texture,e.unit);d.setUniform1i(e.texName,e.unit);d.setUniform2f(e.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return g}();f.TextureBackedBuffer=m})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});
f.EdgeInputBufferLayout=e.newLayout().vec3f("position").u16("componentIndex").u16("_padding");f.VertexLayout=e.newLayout().vec2u8("sideness");f.glVertexLayout=k.glLayout(f.VertexLayout,{prefixA:!0});f.CommonInstancesLayout=e.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});f.RegularEdgeInstancesLayout=f.CommonInstancesLayout.clone().vec3f("normal");
f.SilhouetteEdgeInstancesLayout=f.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");f.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});var e=function(){function d(d,c){this.layout=
d;this.buffer="number"===typeof c?new ArrayBuffer(c*d.stride):c;c=0;for(var b=d.fieldNames;c<b.length;c++){var a=b[c],e=d.fields.get(a);this[a]=new e.constructor(this.buffer,e.offset,this.stride)}}Object.defineProperty(d.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});d.prototype.getField=function(d,c){return(d=this[d])&&
d.elementCount===c.ElementCount&&d.elementType===c.ElementType?d:null};d.prototype.slice=function(e,c){return new d(this.layout,this.buffer.slice(e*this.stride,c*this.stride))};return d}(),g=function(){function d(){this.stride=0;this.fields=new Map;this.fieldNames=[]}d.prototype.vec2f=function(d,c){this.fields.set(d,{size:8,constructor:k.BufferViewVec2f,offset:this.stride,optional:c});this.stride+=8;this.fieldNames.push(d);return this};d.prototype.vec2f64=function(d,c){this.fields.set(d,{size:16,
constructor:k.BufferViewVec2f64,offset:this.stride,optional:c});this.stride+=16;this.fieldNames.push(d);return this};d.prototype.vec3f=function(d,c){this.fields.set(d,{size:12,constructor:k.BufferViewVec3f,offset:this.stride,optional:c});this.stride+=12;this.fieldNames.push(d);return this};d.prototype.vec3f64=function(d,c){this.fields.set(d,{size:24,constructor:k.BufferViewVec3f64,offset:this.stride,optional:c});this.stride+=24;this.fieldNames.push(d);return this};d.prototype.vec4f=function(d,c){this.fields.set(d,
{size:16,constructor:k.BufferViewVec4f,offset:this.stride,optional:c});this.stride+=16;this.fieldNames.push(d);return this};d.prototype.vec4f64=function(d,c){this.fields.set(d,{size:32,constructor:k.BufferViewVec4f64,offset:this.stride,optional:c});this.stride+=32;this.fieldNames.push(d);return this};d.prototype.mat3f=function(d,c){this.fields.set(d,{size:36,constructor:k.BufferViewMat3f,offset:this.stride,optional:c});this.stride+=36;this.fieldNames.push(d);return this};d.prototype.mat4f=function(d,
c){this.fields.set(d,{size:64,constructor:k.BufferViewMat4f,offset:this.stride,optional:c});this.stride+=64;this.fieldNames.push(d);return this};d.prototype.vec4u8=function(d,c){this.fields.set(d,{offset:this.stride,size:4,optional:c,constructor:k.BufferViewVec4u8});this.stride+=4;this.fieldNames.push(d);return this};d.prototype.f32=function(d,c){this.fields.set(d,{offset:this.stride,size:4,optional:c,constructor:k.BufferViewFloat});this.stride+=4;this.fieldNames.push(d);return this};d.prototype.f64=
function(d,c){this.fields.set(d,{offset:this.stride,size:8,optional:c,constructor:k.BufferViewFloat64});this.stride+=8;this.fieldNames.push(d);return this};d.prototype.u8=function(d,c){this.fields.set(d,{offset:this.stride,size:1,optional:c,constructor:k.BufferViewUint8});this.stride+=1;this.fieldNames.push(d);return this};d.prototype.u16=function(d,c){this.fields.set(d,{offset:this.stride,size:2,optional:c,constructor:k.BufferViewUint16});this.stride+=2;this.fieldNames.push(d);return this};d.prototype.i8=
function(d,c){this.fields.set(d,{offset:this.stride,size:1,optional:c,constructor:k.BufferViewInt8});this.stride+=1;this.fieldNames.push(d);return this};d.prototype.vec2i8=function(d,c){this.fields.set(d,{offset:this.stride,size:2,optional:c,constructor:k.BufferViewVec2i8});this.stride+=2;this.fieldNames.push(d);return this};d.prototype.vec2i16=function(d,c){this.fields.set(d,{offset:this.stride,size:4,optional:c,constructor:k.BufferViewVec2i16});this.stride+=4;this.fieldNames.push(d);return this};
d.prototype.vec2u8=function(d,c){this.fields.set(d,{offset:this.stride,size:2,optional:c,constructor:k.BufferViewVec2u8});this.stride+=2;this.fieldNames.push(d);return this};d.prototype.vec4u16=function(d,c){this.fields.set(d,{offset:this.stride,size:8,optional:c,constructor:k.BufferViewVec4u16});this.stride+=8;this.fieldNames.push(d);return this};d.prototype.u32=function(d,c){this.fields.set(d,{offset:this.stride,size:4,optional:c,constructor:k.BufferViewUint32});this.stride+=4;this.fieldNames.push(d);
return this};d.prototype.hasField=function(d){return 0<=this.fieldNames.indexOf(d)};d.prototype.createBuffer=function(d){return new e(this,d)};d.prototype.createView=function(d){return new e(this,d)};d.prototype.clone=function(){var e=new d;e.stride=this.stride;e.fields=new Map;this.fields.forEach(function(c,b){return e.fields.set(b,c)});e.fieldNames=this.fieldNames.slice();e.BufferType=this.BufferType;return e};return d}();f.InterleavedLayout=g;f.newLayout=function(){return new g}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});var c=function(){function c(){}c.prototype.updateSettings=function(a){this.settings=a};c.prototype.write=function(c,d,e){var h=b;h[0]=e.position0[0];h[1]=e.position0[1];h[2]=e.position0[2];h[3]=e.position1[0];h[4]=e.position1[1];h[5]=e.position1[2];l[0]=5381;for(h=0;h<a.length;h++)l[0]=31*l[0]+a[h];n.reseed(l[0]);var h=n.randomRangeInt(0,255),g=n.randomRangeInt(0,this.settings.variants-1),k=n.randomFloat(),k=-(1-Math.min(k/.7,
1))+Math.max(0,k-.7)/(1-.7),k=255*(Math.pow(Math.abs(k),1.2)*(0>k?-1:1)*.5+.5);c.position0.setVec(d,e.position0);c.position1.setVec(d,e.position1);c.componentIndex.set(d,e.componentIndex);c.variantOffset.set(d,h);c.variantStroke.set(d,g);c.variantExtension.set(d,k)};c.prototype.trim=function(a,b){return a.slice(0,b)};return c}();f.CommonBufferWriter=c;var b=new Float32Array(6),a=new Uint32Array(b.buffer),l=new Uint32Array(1),n=new (function(){function a(a){void 0===a&&(a=1);this.seed=a}a.prototype.randomFloat=
function(){return this.step()/a.LARGE_PRIME};a.prototype.randomRangeInt=function(a,b){b-=a;return Math.round(a+this.randomFloat()*b)};a.prototype.reseed=function(a){this.seed=a};a.prototype.step=function(){return this.seed=this.seed*a.SMALL_PRIME%a.LARGE_PRIME};a.LARGE_PRIME=2147483647;a.SMALL_PRIME=16807;return a}());m=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return h.RegularEdgeInstancesLayout.createBuffer(a)};
a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);c=g.vec3d.normalize(g.vec3d.add(c.faceNormal0,c.faceNormal1,p));a.normal.setVec(b,c)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=h.RegularEdgeInstancesLayout;a.glLayout=d.glLayout(h.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();f.RegularEdgeBufferWriter=m;m=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=
function(a){return h.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=h.SilhouetteEdgeInstancesLayout;a.glLayout=d.glLayout(h.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();f.SilhouetteEdgeBufferWriter=m;var p=g.vec3d.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../support/meshProcessing ../../../support/buffer/typedArrayUtil ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(){function l(){this.regularWriter=new b.RegularEdgeBufferWriter;this.silhouetteWriter=new b.SilhouetteEdgeBufferWriter}l.prototype.process=function(a,b){return k(this,void 0,void 0,function(){var c,d,h;return e(this,function(e){switch(e.label){case 0:if(!b)return[3,2];c=[];d=this.packInput(a,c);this.wrappedWork;return[4,b.invoke("wrappedWork",d,c)];case 1:return h=e.sent(),[2,this.unpackOutput(h)];case 2:return[2,this.work(a)]}})})};l.prototype.wrappedWork=
function(a){return k(this,void 0,void 0,function(){var b,c,d,h;return e(this,function(e){b=this.unpackInput(a);c=this.work(b);d=[];this.packInputTransferables(b,d);h=this.packOutput(c,d);return[2,{result:h,transferList:d}]})})};l.prototype.work=function(b){var c=this.extractEdgeInformation(b.data,b.skipDeduplicate,b.originalIndices);this.regularWriter.updateSettings(b.writerSettings);this.silhouetteWriter.updateSettings(b.writerSettings);return a.extractEdges(c,this.regularWriter,this.silhouetteWriter)};
l.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};l.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=d.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};l.prototype.unpackInput=function(a){return{data:c.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};l.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:h.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:h.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};l.prototype.unpackOutput=function(a){return{regular:{instancesData:h.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:h.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};l.prototype.extractEdgeInformation=function(a,
b,d){if(b&&d)return b=g.computeNeighbors(d,a.count),{faces:d,neighbors:b,vertices:a};a=g.deduplicate(a.buffer,a.stride/4);d=this.selectIndexData(a.indices,d);b=g.computeNeighbors(d,a.uniqueCount);return{faces:d,neighbors:b,vertices:c.EdgeInputBufferLayout.createView(a.buffer)}};l.prototype.selectIndexData=function(a,b){if(b){b=d.slice(b);for(var c=0;c<b.length;c++)b[c]=a[b[c]];return b}return a};return l}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports","./mathUtils"],
function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.computeNeighbors=function(e,d){for(var h=e.length/3,c=new Uint32Array(d+1),b=new Uint32Array(d+1),a=function(a,d){a<d?c[a+1]++:b[d+1]++},g=0;g<h;g++){var k=e[3*g],f=e[3*g+1],q=e[3*g+2];a(k,f);a(f,q);a(q,k)}for(g=f=k=0;g<d;g++)q=c[g+1],a=b[g+1],c[g+1]=k,b[g+1]=f,k+=q,f+=a;for(var m=new Uint32Array(6*h),t=c[d],a=function(a,d,e){if(a<d){var h=c[a+1]++;m[2*h]=d;m[2*h+1]=e}else h=b[d+1]++,m[2*t+2*h]=a,m[2*t+2*h+1]=e},g=0;g<h;g++)k=e[3*
g],f=e[3*g+1],q=e[3*g+2],a(k,f,g),a(f,q,g),a(q,k,g);k=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=m[c+2*b],e=m[c+2*b+1],h=b-1;for(h;0<=h&&m[c+2*h]>d;h--)m[c+2*h+2]=m[c+2*h],m[c+2*h+3]=m[c+2*h+1];m[c+2*h+2]=d;m[c+2*h+3]=e}};for(g=0;g<d;g++)k(c[g],c[g+1]),k(t+b[g],t+b[g+1]);for(var w=new Int32Array(3*h),u=function(a,b){return a===e[3*b]?0:a===e[3*b+1]?1:a===e[3*b+2]?2:-1},h=function(a,b){a=u(a,b);w[3*b+a]=-1},k=function(a,b,c,d){a=u(a,b);w[3*b+a]=d;c=u(c,d);w[3*d+c]=b},g=0;g<d;g++){for(var f=
c[g],q=c[g+1],a=b[g],x=b[g+1];f<q&&a<x;){var v=m[2*f],z=m[2*t+2*a];v===z?(k(g,m[2*f+1],z,m[2*t+2*a+1]),f++,a++):v<z?(h(g,m[2*f+1]),f++):(h(z,m[2*t+2*a+1]),a++)}for(;f<q;)h(g,m[2*f+1]),f++;for(;a<x;)z=m[2*t+2*a],h(z,m[2*t+2*a+1]),a++}return w};var e=null;f.deduplicate=function(g,d,h,c,b){void 0===h&&(h=0);void 0===c&&(c=0);void 0===b&&(b=g.byteLength/(4*d));g=new Uint32Array(g,c,b*d);c=new Uint32Array(b);var a=Math.floor(1.1*b)+1;if(null==e||e.length<2*a)e=new Uint32Array(k.nextHighestPowerOfTwo(2*
a));for(var l=0;l<2*a;l++)e[l]=0;for(var f=0,p=0!==h?Math.ceil(7.84*1.96/(h*h)*h*(1-h)):b,l=0;l<b;l++){if(l===p){var q=1-f/l;if(q+1.96*Math.sqrt(q*(1-q)/l)<h)return null;p*=2}for(var q=l*d,m,t=m=0;t<d;t++)m=g[q+t]+m|0,m=m+(m<<11)+(m>>>2)|0;m>>>=0;for(var t=m%a,w=f;0!==e[2*t+1];){if(e[2*t]===m){var u=e[2*t+1]-1,x=u*d;a:{for(var v=0;v<d;v++)if(g[q+v]!==g[x+v]){x=!1;break a}x=!0}if(x){w=c[u];break}}t++;t>=a&&(t-=a)}w===f&&(e[2*t]=m,e[2*t+1]=l+1,f++);c[l]=w}if(0!==h&&1-f/b<h)return null;h=new Uint32Array(d*
f);for(l=f=0;l<b;l++)if(c[l]===f){a=g;p=l*d;q=h;m=f*d;t=d;for(w=0;w<t;w++)q[m+w]=a[p+w];f++}return{buffer:h.buffer,indices:c,uniqueCount:f}}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(m,f,k,e,g){function d(b){var a=[];b.fields.forEach(function(b,c){var d=b.constructor;b=k({},b,{constructor:d.ElementType+"_"+d.ElementCount});a.push([c,b])});return{stride:b.stride,fields:a,
fieldNames:b.fieldNames}}function h(b){var a=g.newLayout();a.stride=b.stride;a.fieldNames=b.fieldNames;b.fields.forEach(function(b){return a.fields.set(b[0],k({},b[1],{constructor:c.get(b[1].constructor)}))});return a}Object.defineProperty(f,"__esModule",{value:!0});f.packInterleavedBuffer=function(b,a){a.push(b.buffer);return{buffer:b.buffer,layout:d(b.layout)}};f.unpackInterleavedBuffer=function(b){return h(b.layout).createView(b.buffer)};f.packLayout=d;f.unpackLayout=h;m=[e.BufferViewFloat,e.BufferViewVec2f,
e.BufferViewVec3f,e.BufferViewVec4f,e.BufferViewMat4f,e.BufferViewFloat64,e.BufferViewVec2f64,e.BufferViewVec3f64,e.BufferViewVec4f64,e.BufferViewUint8,e.BufferViewVec2u8,e.BufferViewVec3u8,e.BufferViewVec4u8,e.BufferViewUint16,e.BufferViewVec2u16,e.BufferViewVec3u16,e.BufferViewVec4u16,e.BufferViewUint32,e.BufferViewVec2u32,e.BufferViewVec3u32,e.BufferViewVec4u32,e.BufferViewInt8,e.BufferViewVec2i8,e.BufferViewVec3i8,e.BufferViewVec4i8,e.BufferViewInt16,e.BufferViewVec2i16,e.BufferViewVec3i16,e.BufferViewVec4i16,
e.BufferViewInt32,e.BufferViewVec2i32,e.BufferViewVec3i32,e.BufferViewVec4i32];var c=new Map;m.forEach(function(b){return c.set(b.ElementType+"_"+b.ElementCount,b)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../lib/gl-matrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(m,f,k,e,g,d){function h(b,c){var d=Math.acos(b.cosAngle),h=a.fwd,g=a.ortho;e.vec3d.normalize(e.vec3d.direction(b.position0,
b.position1,h));b=0<e.vec3d.dot(e.vec3d.cross(b.faceNormal0,b.faceNormal1,g),h)?-1:1;return d*b>c}function c(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var h=a[3*e+0],g=a[3*e+1],l=a[3*e+2],k=c[3*e+0],f=c[3*e+1],n=c[3*e+2],d=d+(-1===h||k<f?1:0),d=d+(-1===g||f<n?1:0),d=d+(-1===l||n<k?1:0);for(var d=new Int32Array(4*d),p=0,e=0;e<b;e++){h=a[3*e+0];g=a[3*e+1];l=a[3*e+2];k=c[3*e+0];f=c[3*e+1];n=c[3*e+2];if(-1===h||k<f)d[p++]=k,d[p++]=f,d[p++]=e,d[p++]=h;if(-1===g||f<n)d[p++]=
f,d[p++]=n,d[p++]=e,d[p++]=g;if(-1===l||n<k)d[p++]=n,d[p++]=k,d[p++]=e,d[p++]=l}return d}function b(a){var b=a.faces.length/3,c=a.vertices.position;a=a.faces;for(var d=l.v0,h=l.v1,g=l.v2,k=new Float32Array(3*b),f=0;f<b;f++){var n=a[3*f+1],p=a[3*f+2];c.getVec(a[3*f+0],d);c.getVec(n,h);c.getVec(p,g);e.vec3d.subtract(h,d);e.vec3d.subtract(g,d);e.vec3d.normalize(e.vec3d.cross(h,g,d));k[3*f+0]=d[0];k[3*f+1]=d[1];k[3*f+2]=d[2]}return k}Object.defineProperty(f,"__esModule",{value:!0});f.extractEdges=function(l,
f,m,t){void 0===t&&(t=n);var p=l.vertices.position,q=l.vertices.componentIndex,r=g.deg2rad(t.anglePlanar);t=g.deg2rad(t.angleSignificantEdge);var v=Math.cos(t),z=Math.cos(r),y=a.edge,A=y.position0,B=y.position1,C=y.faceNormal0,E=y.faceNormal1,D=b(l),F=c(l),M=F.length/4;l=f.allocate(M);t=0;var N=m.allocate(M),I=0,G=0,O=0,J=k.range(0,M),Q=new Float32Array(M);d.forEach(Q,function(a,b,c){p.getVec(F[4*b+0],A);p.getVec(F[4*b+1],B);c[b]=e.vec3d.dist(A,B)});J.sort(function(a,b){return Q[b]-Q[a]});for(var H=
[],K=[],R=0;R<M;R++){var P=J[R],L=Q[P],T=F[4*P+0],S=F[4*P+1],W=F[4*P+2],P=F[4*P+3],Y=-1===P;p.getVec(T,A);p.getVec(S,B);if(Y)e.vec3d.set3(D[3*W+0],D[3*W+1],D[3*W+2],C),e.vec3d.set(C,E),y.componentIndex=q.get(T),y.cosAngle=e.vec3d.dot(C,E);else if(e.vec3d.set3(D[3*W+0],D[3*W+1],D[3*W+2],C),e.vec3d.set3(D[3*P+0],D[3*P+1],D[3*P+2],E),y.componentIndex=q.get(T),y.cosAngle=e.vec3d.dot(C,E),y.cosAngle>z)continue;G+=L;O++;Y||y.cosAngle<v?(f.write(l,t++,y),H.push(L)):h(y,r)&&(m.write(N,I++,y),K.push(L))}q=
new Float32Array(H.reverse());r=new Float32Array(K.reverse());return{regular:{instancesData:f.trim(l,t),lodInfo:{lengths:q}},silhouette:{instancesData:m.trim(N,I),lodInfo:{lengths:r}},averageEdgeLength:G/O}};var a={edge:{position0:e.vec3d.create(),position1:e.vec3d.create(),faceNormal0:e.vec3d.create(),faceNormal1:e.vec3d.create(),componentIndex:0,cosAngle:0},ortho:e.vec3d.create(),fwd:e.vec3d.create()},l={v0:e.vec3d.create(),v1:e.vec3d.create(),v2:e.vec3d.create()},n={anglePlanar:4,angleSignificantEdge:35}})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ../../../support/mathUtils ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});f.LINE_WIDTH_FRACTION_FACTOR=8;f.EXTENSION_LENGTH_OFFSET=128;var b={type:"solid",slicePlaneEnabled:!1,uber:!0,
strokesTexture:null},a=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();m=function(){function e(c,d,h){this.rctx=c;this.programRepository=d;this.refCount=new a;this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=g.mat3d.create();this.settings=k({},
b,h);this.key=e.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}e.prototype.dispose=function(){for(var a in this.programs){var b=this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};e.prototype.addRenderable=function(a){this.renderables.add(a)};e.prototype.removeRenderable=function(a){this.renderables.delete(a)};e.prototype.forEachRenderable=
function(a){this.renderables.forEach(a)};e.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};e.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};e.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",
c.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};e.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};e.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,b,c)};e.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);a=this.rctx;a.bindVAO(c);a.capabilities.instancing.drawArraysInstanced(6,0,4,e)};e.prototype.setUniforms=
function(a,b,c){b.components.buffer.textureBuffer.bind(a,f.componentDataBindParameters);a.setUniformMatrix4fv("uView",c.view);a.setUniformMatrix4fv("uModel",b.transform.modelMatrix);var d=c.viewInvTransp,e=g.mat4d.toMat3(d,this.tmpViewToWorldNormalMatrix);a.setUniform3f("uCameraPosition",d[3],d[7],d[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",e);(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.fovY/2)/
(c.viewport[3]/2));a.setUniform3fv("uLocalOrigin",b.transform.origin.vec3);this.settings.slicePlaneEnabled&&h.bindSlicePlane(b.transform.origin.vec3,c.slicePlane,a)};e.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",d.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",
b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};e.prototype.getOptions=function(a){return k({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})};e.prototype.createPrograms=function(){var a=this.programRepository.getProgram(c.program,this.getOptions({silhouette:!1})),b=this.programRepository.getProgram(c.program,this.getOptions({silhouette:!0}));
this.programRepository.increaseRefCount(a);this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};e.getKey=function(a,b,c){return a?"edges-uber":"edges-t:"+b+":"+c};return e}();f.EdgeRenderer=m;f.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../geometry/support/aaBoundingBox ../../../lib/gl-matrix ../../../support/mathUtils ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(b,c,d,e,h){var g=p(c,d,v);k.setMin(u,b.getBBMin());k.setMax(u,b.getBBMax());if(q(u,c,g,e)){var g=b.getPrimitiveIndices(),f=b.getIndices(),n=b.getPosition(),m=g?g.length:f.length/3;if(m>M&&(b=b.getChildren(),void 0!==b)){for(g=0;8>g;++g)void 0!==b[g]&&a(b[g],c,d,e,h);return}l(c,d,0,m,f,n,g,h)}}function l(a,b,c,d,e,h,g,l){var k=h.data,f=h.offsetIdx;h=h.strideIdx;var p=a[0],q=a[1];a=a[2];var m=b[0]-p,r=b[1]-q;for(b=b[2]-a;c<d;c++){var v=g?g[c]:c,u=f+h*e[3*v],t=
f+h*e[3*v+1],w=f+h*e[3*v+2],x=k[u],A=k[u+1],C=k[u+2],u=k[t]-x,B=k[t+1]-A,t=k[t+2]-C,I=k[w]-x,N=k[w+1]-A,w=k[w+2]-C,E=r*w-N*b,D=b*I-w*m,M=m*N-I*r,F=u*E+B*D+t*M,x=p-x,G=q-A,O=a-C,A=G*t-B*O,C=O*u-t*x,J=x*B-u*G;if(F>z){E=x*E+G*D+O*M;if(0>E||E>F)continue;D=m*A+r*C+b*J;if(0>D||E+D>F)continue}else if(F<-z){E=x*E+G*D+O*M;if(0<E||E<F)continue;D=m*A+r*C+b*J;if(0<D||E+D<F)continue}else continue;F=(I*A+N*C+w*J)/F;0<=F&&(u=n(u,B,t,I,N,w,y),l(F,u,v))}}function n(a,b,c,d,h,g,l){e.vec3d.set3(a,b,c,A);e.vec3d.set3(d,
h,g,B);return e.vec3d.normalize(e.vec3d.cross(A,B,l))}function p(a,b,c){return e.vec3d.set3(1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]),c)}function q(a,b,c,d){var e=(a[0]-d-b[0])*c[0],h=(a[3]+d-b[0])*c[0],g=Math.min(e,h),e=Math.max(e,h),h=(a[1]-d-b[1])*c[1],l=(a[4]+d-b[1])*c[1],g=Math.max(g,Math.min(h,l)),e=Math.min(e,Math.max(h,l));if(g>e)return!1;h=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];g=Math.max(g,Math.min(h,a));e=Math.min(e,Math.max(h,a));return g<=e}function r(a,b){b=b?r(b):{};for(var c in a){var d=
a[c];d&&d.forEach&&(d=t(d));null==d&&c in b||(b[c]=d)}return b}function t(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(f,"__esModule",{value:!0});var w=e.mat4d.create(),u=k.create(),x=b.VertexAttrConstants;f.IDENTITY=e.mat4d.identity();f.intersectTriangleGeometry=function(c,e,h,g,f,n,m){b.assert("triangle"===c.data.primitiveType);e=e&&e.componentVisibilities;g=g.tolerance;if(1<c.componentCount){h=p(f,n,v);var r=c.boundingInfo;k.setMin(u,r.getBBMin());k.setMax(u,
r.getBBMax());if(q(u,f,h,g))for(var t=c.data,r=c.componentCount,z=t.getIndices(x.POSITION),w=t.getAttribute(x.POSITION),t=t.componentOffsets,y=0;y<r;y++)if(!e||d.getVisibility(e,y)){var A=c.getComponentAABB(y,u);q(A,f,h,g)&&l(f,n,t[y]/3,t[y+1]/3,z,w,void 0,m)}}else e&&!d.getVisibility(e,0)||a(c.boundingInfo,f,n,g,m)};var v=e.vec3d.create(),z=Math.pow(2,-52),y=e.vec3d.create();f.intersectTriangles=l;var A=e.vec3d.create(),B=e.vec3d.create();f.computeNormal=n;f.intersectAabbInvDir=q;f.transformToWorld=
function(a,b,c){return e.vec4d.set4(a[0]-b[0],a[1]-b[1],a[2]-b[2],1,c)};f.transformToView=function(a,b,c,d){e.mat4d.translate(c,b,w);c=w;return e.mat4d.multiplyVec4(c,a,d)};f.transformToProjection=function(a,b,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3];return e.mat4d.multiplyVec4(b,d)};f.transformToNDC=function(a,b){return e.vec4d.scale(a,1/Math.abs(a[3]),b)};f.applyScreenSizePerspectiveScale=function(a,b,d,e,h){return c.scale(a,e,d,h)};f.verticalOffsetAtDistance=function(a,b,d,e,
h){var l=d.screenLength||0;h&&(l=c.scale(l,e,b,h));return g.clamp(l*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,d.minWorldLength||0,null!=d.maxWorldLength?d.maxWorldLength:Infinity)};f.aquireIfNotUndefined=function(a,b,c){if(void 0!==a)return b.aquire(a,c)};f.releaseIfNotUndefined=function(a,b){void 0!==a&&b.release(a)};var C=e.mat4.create();f.bindView=function(a,b,c){e.mat4d.translate(b,a,C);c.setUniform3fv("localOrigin",a);c.setUniformMatrix4fv("view",C)};f.bindCamPos=function(a,b,c){c.setUniform3f("camPos",
b[3]-a[0],b[7]-a[1],b[11]-a[2])};var E=e.vec3d.create(),D=e.vec3d.create();f.bindViewOriginDouble=function(a,b){h.encodeDoubleArraySplit(a,E,D,3);b.setUniform3fv("viewOriginHi",E);b.setUniform3fv("viewOriginLo",D)};var F=e.vec3d.create();f.bindSlicePlane=function(a,b,c){e.vec3d.subtract(b.origin,a,F);c.setUniform3fv("slicePlaneOrigin",F);c.setUniform3fv("slicePlaneBasis1",b.basis1);c.setUniform3fv("slicePlaneBasis2",b.basis2)};f.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY,e=b.viewport[3],
h=void 0;void 0===h&&(h=N);h.screenLength=a.screenLength;h.perDistance=Math.tan(.5*d)/(.5*e);h.minWorldLength=a.minWorldLength;h.maxWorldLength=a.maxWorldLength;a=h;c.setUniform4f("verticalOffset",a.screenLength*(b.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};f.bindScreenSizePerspective=function(a,b,c,d){void 0===d&&(d="screenSizePerspectiveAlignment");if(a){var e=a.parameters;c.setUniform4f(d,e.divisor,e.offset,e.minPixelSize*(b.pixelRatio||1),a.paddingPixelsOverride)}};f.copyParameters=
r;f.updateParameters=function(a,b){var c=!1,d;for(d in b){var e=b[d];void 0!==e&&(c=!0,Array.isArray(e)?a[d]=e.slice():a[d]=e)}return c};(function(a){function b(a){return(a.shadowMappingEnabled?1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,c){for(var d=[],e=0;2>e;e++)for(var h=0;2>h;h++){var g=b({shadowMappingEnabled:1===e,ssaoEnabled:1===h}),l=b({shadowMappingEnabled:1===e,ssaoEnabled:1===h&&a.receiveSSAO});d[g]=d[l]||c({receiveShadows:1===e,receiveSSAO:1===h&&a.receiveSSAO})}return{programs:d.filter(function(a){return null!=
a}),byParameter:d}};a.lookup=function(a,c){return a.byParameter[b(c)]};a.programs=function(a){return a.programs}})(f.BindParametersMap||(f.BindParametersMap={}));f.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var M=1E3,N={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(m,f){function k(d,e,c){for(var b=0;b<c;++b)e[2*b]=d[b],e[2*b+1]=d[b]-e[2*b]}Object.defineProperty(f,"__esModule",
{value:!0});f.encodeDouble=function(d,e){g[0]=d;g[1]=d-g[0];e[0]=g[0];e[1]=g[1]};f.encodeDoubleArray=k;f.decodeDoubleArray=function(d,e,c){for(var b=0;b<c;++b)e[b]=d[2*b]+d[2*b+1]};f.encodeDoubleArraySplit=function(d,h,c,b){for(var a=0;a<b;++a)e[0]=d[a],k(e,g,1),h[a]=g[0],c[a]=g[1]};var e=new Float64Array(1),g=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../support/earthUtils","../../support/mathUtils"],function(m,f,
k,e){function g(a){return Math.abs(a*a*a)}function d(a,b,c,d){void 0===d&&(d=n);var e=c.parameters;c=c.paddingPixelsOverride;d.scale=Math.min(e.divisor/(b-e.offset),1);d.factor=g(a);d.minPixelSize=e.minPixelSize;d.paddingPixels=c;return d}function h(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/a)}function c(a,b){return Math.max(e.lerp(a*b.scale,a,b.factor),h(a,b))}function b(a,b,e){a=d(a,b,e);a.minPixelSize=0;a.paddingPixels=0;return c(1,a)}Object.defineProperty(f,"__esModule",
{value:!0});f.getSettings=function(b){return new a(b,f.defaultDescription)};f.getLabelSettings=function(b){var c=f.defaultDescription.curvatureDependent;return new a(b,{curvatureDependent:{min:{curvature:c.min.curvature,tiltAngle:c.min.tiltAngle,scaleFallOffFactor:l.curvatureDependent.min.scaleFallOffFactor},max:{curvature:c.max.curvature,tiltAngle:c.max.tiltAngle,scaleFallOffFactor:l.curvatureDependent.max.scaleFallOffFactor}},scaleStart:f.defaultDescription.scaleStart,scaleFallOffRange:f.defaultDescription.scaleFallOffRange,
minPixelSize:l.minPixelSize})};f.perspectiveFactor=g;f.scaleFactor=d;f.applyScaleFactor=c;f.applyScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);var d=Math.min(Math.max(b.scale,h(a[1],b)/a[1]),1);c[0]=e.lerp(a[0]*d,a[0],b.factor);c[1]=e.lerp(a[1]*d,a[1],b.factor);return c};f.precomputeScale=b;f.precomputeScaleFactor=function(a,c,d,e){e.scale=b(a,c,d);e.factor=0;e.minPixelSize=d.parameters.minPixelSize;e.paddingPixels=d.paddingPixelsOverride;return e};f.applyPrecomputedScaleFactorVec2=function(a,
b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,h(a[1],b)/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*b;return c};f.scale=function(a,b,e,h){return c(a,d(b,e,h))};var a=function(){function a(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=
this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===
a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,c=c.minPixelSize,h=a.fovY,g=a.distance,l=this.calculateCurvatureDependentParameters(a),k=this.coverageCompensation(a,l),f=l.tiltAngle,l=l.scaleFallOffFactor,g=Math.sin(f)*g,f=.5*
Math.PI-f-h*(.5-d*k),d=g/Math.cos(f),e=(d-g/Math.cos(f+h*e*k)*l)/(1-l);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=e;b.divisor=d-e;b.minPixelSize=c;return b};a.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=p);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=p);var c=
this.description.curvatureDependent;a=1+a.distance/k.earthRadius;var d=[c.min.curvature,c.max.curvature],h=d[0];a=e.clamp((Math.sqrt(a*a-1)-h)/(d[1]-h),0,1);d=[c.min,c.max];c=d[0];d=d[1];b.tiltAngle=e.lerp(c.tiltAngle,d.tiltAngle,a);b.scaleFallOffFactor=e.lerp(c.scaleFallOffFactor,d.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=k.earthRadius*k.earthRadius;
b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*k.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/e)-Math.asin(k.earthRadius/(e/Math.sin(b)))+.5*d)/d};return a}();f.defaultDescription={curvatureDependent:{min:{curvature:e.deg2rad(10),tiltAngle:e.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:e.deg2rad(70),tiltAngle:e.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var l={curvatureDependent:{min:{scaleFallOffFactor:.7},
max:{scaleFallOffFactor:.95}},minPixelSize:14};f.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var n={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e){Object.defineProperty(f,
"__esModule",{value:!0});var g=function(d){return e.glslifyDefineMap({MODE:{value:d.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:d.silhouette,ANTIALIASING:d.antialiasing,SLICE:d.slice})};f.program={name:"edges",shaders:function(d){return{vertexShader:g(d)+k.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:g(d)+k.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,
aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});var g=new e(function(d){var e=k;d.split("/").forEach(function(c){e&&(e=e[c])});return e});f.resolveIncludes=function(d){return g.resolveIncludes(d)}})},"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require",
"exports"],function(m,f){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\r\nuniform vec2 uViewportDimInv;\r\n\r\n// Utility function to check for NaN values\r\nbool isNaN(float val) {\r\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n  // important: some nVidias failed to cope with version below.\r\n  // Probably wrong optimization.\r\n  /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n}\r\n\r\n// An offset in xy screen space, along the projected normal of the edge\r\n// This reduces depth fighting when looking at a face from a flat angle\r\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n  float offsetXY \x3d uDepthBias.x;\r\n  float offsetZ  \x3d uDepthBias.y;\r\n\r\n  // screen space pixel offset\r\n  // we multiply by two to account for the fact that NDC go from -1 to 1\r\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n  // towards the camera\r\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n}\r\n\r\n// A z-offset, using a depth based heuristic.\r\nfloat calculateProjectedBiasZ(vec4 projPos) {\r\n  float offsetZ \x3d uDepthBias.y;\r\n  return sqrt(projPos.z) * offsetZ;\r\n}\r\n\r\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n  // we currently have to do this check because some geometries come with 0 length edge normals.\r\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n    projPos.xy +\x3d offsetXY;\r\n  }\r\n\r\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\r\n\r\n  return projPos;\r\n}\r\n",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec4 vColor;\r\nvarying float vRadius;\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\nvarying float vLineIndex;\r\n\r\n// At which coverage threshold we discard a fragment completely\r\n#define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\r\n\r\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n  float lineOffset \x3d calculateLineOffset();\r\n  float positionX \x3d position.x - lineOffset;\r\n\r\n  if (radius \x3c 1.0) {\r\n    // Handle this specifically for subpixel sizes:\r\n    // 1. Compute correct coverage (note coverage is computed by\r\n    //    0.5 - dist, so we make sure that that will lead to correct\r\n    //    subpixel coverage\r\n    // 2. Ignore rounded caps\r\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n    float coverage \x3d min(coverageX, coverageY);\r\n\r\n    return vec2(0.5 - coverage, 0.0);\r\n  }\r\n  else {\r\n    // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n  }\r\n}\r\n\r\nvoid main() {\r\n\r\n  float radius \x3d vRadius * calculateLinePressure();\r\n\r\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Use subpixel coverage computation when lines get subpixel widths\r\n  // so we still render them appropriately. Otherwise discard anything\r\n  // that is not fully within the line\r\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  if (coverage \x3c coverageLimit) {\r\n    discard;\r\n  }\r\n\r\n  discardBySlice(vWorldPosition);\r\n\r\n  float alpha \x3d vColor.a * coverage;\r\n\r\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\r\n}\r\n",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Transformations\r\nuniform mat4 uProj;\r\nuniform mat4 uView;\r\nuniform mat4 uModel;\r\nuniform vec3 uCameraPosition;\r\n\r\n// Line configuration\r\n\r\n// Conversion constants\r\nuniform vec2 uPixelToNDC;\r\nuniform vec2 uNDCToPixel;\r\nuniform float uPixelRatio;\r\n\r\n// Inputs\r\nattribute vec3 aPosition0;\r\nattribute vec3 aPosition1;\r\nattribute float aVariantOffset;\r\nattribute float aVariantStroke;\r\nattribute float aVariantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\nattribute vec3 aNormalA;\r\nattribute vec3 aNormalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\nattribute vec3 aNormal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 aSideness;\r\nattribute vec2 aPackedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\nvec2 sideness;\r\nvec2 sidenessNorm;\r\nfloat lineWidthPixels;\r\nfloat extensionLengthPixels;\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nfloat type;\r\n\r\n#endif\r\n};\r\n\r\n// Output required to compute color\r\nvarying vec4 vColor;\r\n\r\n// Output required to compute distance to line/caps\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vRadius;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\n\r\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\r\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\r\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\r\n#include \x3cedgeRenderer/util.glsl\x3e\r\n\r\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  vec2 sideness \x3d unpackedAttributes.sideness;\r\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\r\n\r\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n  vec4 projPosV0 \x3d uProj * viewPosV0;\r\n  vec4 projPosV1 \x3d uProj * viewPosV1;\r\n  vec4 projPos \x3d uProj * viewPos;\r\n\r\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\r\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\r\n\r\n  vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float aaPaddingPixels \x3d 1.0;\r\n\r\n  // Line size with padding\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n  // Line length with padding\r\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n  // coverage in the fragment shader\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  // Half line width in NDC including padding for anti aliasing\r\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n  // Compute screen space position of vertex, offsetting for line size and end caps\r\n  vec2 ndcOffset \x3d (\r\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n  );\r\n\r\n  projPos.xy +\x3d ndcOffset * projPos.w;\r\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n  // Line length with end caps\r\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n  // Position in pixels with origin at first vertex of line segment\r\n  vPosition \x3d vec3(\r\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n    pixelPositionAlongLine,\r\n    pixelPositionAlongLine / extendedLineLengthPixels\r\n  );\r\n\r\n  // The line width radius in pixels\r\n  vRadius \x3d lineWidthPixels * 0.5;\r\n  vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10, 10, 10, 1);\r\n  }\r\n\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  if (lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10, 10, 10, 1);\r\n  }\r\n\r\n#endif\r\n\r\n  return projPos;\r\n}\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n  float fType \x3d component.type;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  if (fType \x3c\x3d 0.0) {\r\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n  }\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\r\n}\r\n\r\n#else /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n\r\n#endif\r\n\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\r\n}\r\n\r\n#endif /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nvoid main() {\r\n  ComponentData component \x3d readComponentData();\r\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\r\n\r\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\r\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\r\n\r\n  vec4 viewPosV0 \x3d uView * worldPosV0;\r\n  vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  // General geometric computation for all types of edges\r\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n\r\n  // Component color\r\n  vColor \x3d component.color;\r\n\r\n  // Specific computation for different edge styles\r\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n}\r\n",
"lineAmplitude.glsl":"// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitudeSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeSolid();\r\n    }\r\n  }\r\n\r\n#endif\r\n",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffsetSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureSolid() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSolid();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetSolid();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureSolid();\r\n    }\r\n  }\r\n#endif\r\n",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform vec2 uStrokesTextureScale;\r\n  uniform float uStrokesLog2Resolution;\r\n  uniform float uStrokeVariants;\r\n\r\n  varying vec2 vStrokeUV;\r\n  varying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d aVariantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n#elif (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n#endif\r\n",
"util.glsl":"uniform float uDistanceFalloffFactor;\r\n\r\nfloat distanceBasedPerspectiveFactor(float distance) {\r\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n}\r\n\r\nuniform sampler2D uComponentDataTex;\r\nuniform vec2 uComponentDataTexInvDim;\r\n\r\nattribute float aComponentIndex;\r\n\r\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\r\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\r\n#define COMPONENT_FIELD_COUNT 2.0\r\n\r\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\r\n#define EXTENSION_LENGTH_OFFSET 128.0\r\n\r\n#define COMPONENT_TEX_WIDTH 4096.0\r\n\r\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\r\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\r\n\r\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\r\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\r\n\r\n  vec2 linearIndex \x3d vec2(\r\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\r\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\r\n  );\r\n\r\n  return linearIndex;\r\n}\r\n\r\nstruct ComponentData {\r\n  vec4 color;\r\n  float lineWidth;\r\n  float extensionLength;\r\n  float type;\r\n};\r\n\r\nComponentData readComponentData() {\r\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\r\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\r\n\r\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\r\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\r\n\r\n  return ComponentData(\r\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\r\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\r\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\r\n    -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\r\n  );\r\n}\r\n\r\nvec3 modelToWorldNormal(vec3 normal) {\r\n  return (uModel * vec4(normal, 0)).xyz;\r\n}\r\n\r\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n  return modelToWorldNormal(normalize(normalA + normalB));\r\n}\r\n\r\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n// fall-off exponentially\r\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\r\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n}\r\n\r\n#ifdef SILHOUETTE\r\n\r\n// #uniforms: uView, uModel\r\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\r\n  // transform the two face normals\r\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n  // compute the direction from the edge to the camera\r\n  vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n  // check which of the two faces are visible\r\n  // display the edge if exactly one of the two is visible\r\n  float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n  float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n  // 1 if exactly one face visible, 0 otherwise\r\n  return faceAVisible * faceBVisible \x3c 0.0;\r\n}\r\n\r\n#endif /* SILHOUETTE */\r\n"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\n// Light\r\nuniform vec3 v3LightDir;      // The direction vector to the light source\r\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n// Atmosphere\r\nconst float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\nconst float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n\r\n// Radii\r\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\r\n\r\nfloat fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\nfloat fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\nfloat fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\nfloat fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n// Atmosphere parameters:\r\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\r\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepth:      fScale / fScaleDepth\r\n// fOneOverScaleDepth:        1.0 / fScaleDepth\r\n\r\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\r\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\r\n\r\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\r\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\r\n\r\nfloat fScale \x3d v4AtmosParams1.x;\r\nvec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\nvec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\nvec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\r\nuniform float fInnerFadeDistance;\r\nuniform float fAltitudeFade;\r\n\r\nfloat g \x3d v4AtmosParams2.x;\r\nfloat g2 \x3d v4AtmosParams3.x;\r\nfloat fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\nfloat fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\nfloat fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n\r\n// Camera\r\nuniform vec3 v3CameraPos;     // The camera's current position\r\nuniform vec2 nearFar;\r\n\r\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\r\nfloat fCameraHeight \x3d v4SphereComp[0];  // The camera's current height\r\nfloat fCameraHeight2 \x3d v4SphereComp[1]; // fCameraHeight^2\r\nfloat fC \x3d v4SphereComp[2];             // fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\nfloat fCSur \x3d v4SphereComp[3];          // fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n\r\n// Camera HDR\r\n#ifdef HAZE\r\nconst float fExposure \x3d 1.5;\r\n#else\r\nconst float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n// Depth texture\r\nuniform sampler2D tDepth;\r\n#endif\r\n\r\n// Testing variables\r\nuniform float showTest;\r\n\r\n// Varyings\r\nvarying vec3 v3EyeDir;\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n// Loop constants for integral approximation\r\nconst float fSamples \x3d 5.0;\r\nconst int maxSamples \x3d 5;\r\n\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n// ToneMapping operators\r\nvec3 expTM(vec3 inputColor,float exposure){\r\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n}\r\n\r\n#ifndef HAZE\r\nvec3 reinhardTM(vec3 inputColor, float exposure){\r\n  vec3 intermediate \x3d inputColor *exposure;\r\n  intermediate /\x3d (1.0+intermediate);\r\n  return pow(intermediate, v3OneOverGamma);\r\n}\r\n#endif\r\n\r\n// Approximation for inner integral based on a radii ratio of 10.25:10\r\nfloat scale(float fCos){\r\n  float x \x3d 1.0 - fCos;\r\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\nvoid main() {\r\n  vec3 cameraPosition \x3d v3CameraPos;\r\n\r\n  // Debug variables\r\n  vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n  // Obtain ray from Camera\r\n  vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n  float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n  // idealized sphere intersection to discard early some pixels\r\n  float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n  // the minimal sample start position:\r\n  // at the camera by default, on the earth radius surface if the camera is underground.\r\n  float fMinRayStart \x3d 0.0;\r\n#ifndef HAZE\r\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\r\n  // based color. This is used to make sure we have a white background in underground\r\n  // mode (at noon).\r\n  float fSurfaceBlend \x3d 0.0;\r\n  vec4 surfaceColor \x3d vec4(0.0);\r\n  if (detSur \x3e\x3d 0.0) {\r\n    float nearSurfaceT \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\r\n    float farSurfaceT \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\r\n\r\n    if (nearSurfaceT \x3d\x3d 0.0) {\r\n      fMinRayStart \x3d farSurfaceT;\r\n    }\r\n\r\n    // Compute lighting at the point where the ray enters the earth surface\r\n    // Lighting computation is copied from the terrain shader.\r\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurfaceT;\r\n    float fLightAngle \x3d dot(v3LightDir, normalize(vPos));\r\n    float fBrightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\r\n\r\n    // Make the surface transparent based on altitude\r\n    surfaceColor \x3d vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\r\n\r\n    // Fade based on the distance the ray travels below the earth surface\r\n    float fRelDist \x3d (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\r\n\r\n    // early exit\r\n    if (fRelDist \x3e 1.0) {\r\n      gl_FragColor \x3d surfaceColor;\r\n      return;\r\n    }\r\n\r\n    fSurfaceBlend \x3d smoothstep(0.0, 1.0, fRelDist * fRelDist);\r\n  }\r\n#endif\r\n\r\n  // Inside Atmosphere\r\n  if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n    // only use red channel from depth texture.\r\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n    float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n    float zNear \x3d nearFar[0];\r\n    float zFar \x3d nearFar[1];\r\n\r\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n    float zNorm \x3d 2.0 * depthSample - 1.0;\r\n    float linDepth \x3d 2.0 * zNear * zFar /\r\n      (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n    float rayEndT;\r\n    float altitudeAlpha \x3d 1.0;\r\n\r\n    // find intersections with ground, but only between the near and far\r\n    // clipping planes.\r\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n      vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n      cameraSpaceRay *\x3d linDepth;\r\n\r\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n      vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n      float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n      // Handle tall structures:\r\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n      float transitionStart \x3d fInnerRadius + 20000.0;\r\n      float transitionHeight \x3d 25000.0;\r\n      float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n      float edge0 \x3d transitionStart * transitionStart;\r\n      float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n      altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n      rayEndT \x3d cameraSpaceRayLength;\r\n\r\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n        rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n      }\r\n    }\r\n#endif\r\n\r\n    float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n    float nearT \x3d abs(rayStartT);\r\n    float farT \x3d abs(rayEndT);\r\n#else\r\n    float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n    float fDistance; // calculate its scattering offset\r\n    // Calculate the ray's starting position\r\n    if (rayStartT \x3c fMinRayStart)\r\n    { // ray starts from camera or inner radius sphere to far\r\n      rayStartT \x3d fMinRayStart;\r\n#ifndef HAZE\r\n      // clamp to value at inner radius altitude\r\n      fDistance \x3d fScale * min(0.0, fInnerRadius - fCameraHeight);\r\n#endif\r\n    }\r\n#ifndef HAZE\r\n    else\r\n    { // outside atmosphere\r\n      fDistance \x3d -1.0;\r\n    }\r\n#endif\r\n\r\n    // Initialize the scattering loop variables\r\n    vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n    vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n    float fEndLength \x3d length(v3End);\r\n    float fAltitudeEnd \x3d fEndLength - fInnerRadius;\r\n    float fAltitudeStart \x3d length(v3Start) - fInnerRadius;\r\n\r\n    // for camera positions below altitude 0, invert the altitudes, to achieve\r\n    // a similar haze as above ground. Note that there is a small but visible change\r\n    // when the camera passes altitude 0.\r\n    if (fAltitudeStart \x3c 0.0) {\r\n      fAltitudeStart \x3d -fAltitudeStart;\r\n      fAltitudeEnd \x3d -fAltitudeEnd;\r\n    }\r\n\r\n    // computed for the original end point to get consistent light angles after possible inversions\r\n    float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n    if (nearT \x3e farT)\r\n    {\r\n      if (fAltitudeStart \x3c fAltitudeEnd)\r\n      {\r\n        // Switch positive slopes for flipped rays\r\n        v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n        v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n        worldSpaceRay *\x3d -1.0;\r\n        float fTmp \x3d fAltitudeStart;\r\n        fAltitudeStart \x3d fAltitudeEnd;\r\n        fAltitudeEnd \x3d fTmp;\r\n      }\r\n      else if (fAltitudeStart \x3d\x3d fAltitudeEnd)\r\n      { // create minuscule fake slope for integration if the slope is zero\r\n        fAltitudeStart +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n        // slope for the camera function\r\n      }\r\n    }\r\n\r\n    // Calculate its scattering offset\r\n    // Assumes camera constrains of WSV 3.8\r\n    float fCameraDepth;\r\n    float fCameraDepthBlue;\r\n    if (fAltitudeStart \x3e fOuterRadius - fInnerRadius)\r\n    { // outside atmosphere\r\n      fDistance \x3d fInnerRadius - fOuterRadius;\r\n    } else\r\n    {\r\n      fDistance \x3d fAltitudeEnd - fAltitudeStart;\r\n    }\r\n\r\n#endif\r\n    vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n    float fRayLength \x3d rayEndT - rayStartT;\r\n    float fSampleLength \x3d fRayLength / fSamples;\r\n    float fScaledLength \x3d fSampleLength * fScale;\r\n    vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n    vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n    float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / length(v3End);\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n    float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n    vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n    float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n    float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n    // Loop variables\r\n    vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n\r\n    // Now loop through the sample rays\r\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\r\n      float fHeight \x3d length(v3SamplePoint);\r\n      float fAltitude \x3d abs(fHeight - fInnerRadius);\r\n\r\n      vec2 v2Depth \x3d exp(-fAltitude * v2ScaleOverScaleDepth);\r\n#ifdef HAZE\r\n      vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n      float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n      float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n      float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n      vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n      v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n      v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n      v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n      v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n      v3SamplePoint +\x3d v3SampleRay;\r\n    }\r\n\r\n    // Phase computation\r\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n    float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n    float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n    vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n    // Scaled Length is only applied afterwards to save multiplications\r\n    vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n    vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n    vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n    float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n    // Calculate the attenuation factor for the ground\r\n    vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n    vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n\r\n    // HDR to LDR conversion\r\n    vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n    vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n    // mix reddish and blueish atmosphere\r\n    vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n    LDR *\x3d (1.0-fCameraAngle);\r\n    vec3 hsv \x3d rgb2hsv(LDR);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\r\n    LDR \x3d hsv2rgb(hsv);\r\n    vec3 finalColor \x3d LDR;\r\n    // when rendering we specify the blend functions such that\r\n    // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n    // reinhard tonemapper for looking upwards\r\n    vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n    LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n    // height dependent parameter to smooth out reddish atmosphere\r\n    float side \x3d (rayEndT+rayStartT)*0.5;\r\n    float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n    float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n    vec3 finalColor \x3d LDR*h2;\r\n    vec3 hsv \x3d rgb2hsv(finalColor);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\r\n    finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n\r\n#ifndef HAZE\r\n    float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n    gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n    if (fSurfaceBlend \x3e 0.0) {\r\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, fSurfaceBlend);\r\n    }\r\n#else\r\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n\r\n    // Debug variable overlay\r\n    if(showTest\x3e0.0){\r\n      gl_FragColor \x3d vec4(test,1.0);\r\n    }\r\n  } else { // Outside Atmosphere\r\n    gl_FragColor \x3d vec4(0.0);\r\n  }\r\n}\r\n",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Camera\r\nuniform vec2 halfSizeNearPlane;\r\nuniform vec3 v3CameraUp;\r\nuniform vec3 v3CameraRight;\r\nuniform vec3 v3CameraDir;\r\nuniform vec2 v2CameraCenterOffset;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\n// Varyings\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n#ifdef HAZE\r\nvarying vec3 v3EyeDir;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec3 v3Pos \x3d position;\r\n  vtc \x3d uv0;\r\n  vec2 rayvtc \x3d uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n  v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n  vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n  v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n  gl_Position \x3d vec4(v3Pos, 1.0);\r\n}\r\n",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\n#ifndef PANORAMIC\r\nuniform float altitudeFade;\r\nvarying float innerFactor;\r\n#endif\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n\r\n#ifdef PANORAMIC\r\n  gl_FragColor \x3d texColor * falloff;\r\n#else\r\n  vec4 atmosphereColor \x3d texColor * falloff;\r\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\r\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\r\n#endif\r\n}\r\n",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\nconst float TWICEPI \x3d 2.0*3.14159265;\r\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\nuniform vec3 silCircleCenter;\r\nuniform vec3 silCircleV1;\r\nuniform vec3 silCircleV2;\r\nuniform vec2 texV;\r\n\r\nuniform float innerScale;  // scale for inner rim\r\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\r\n#endif\r\n\r\nuniform vec3 lightDirection;\r\n\r\nattribute vec3 position;\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\nvoid main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n  vec3 pos \x3d position;\r\n  float ndotl \x3d lightDirection.z;\r\n  vtc \x3d vec2(0, position.z+0.05);\r\n\r\n#else\r\n\r\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\r\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\r\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\r\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\r\n\r\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\r\n\r\n#endif\r\n\r\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n}\r\n",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform float undergroundFadeAlpha;\r\n\r\nvarying vec4 color;\r\n\r\nvoid main(void) {\r\n  float ndotl \x3d dot(normalize(cameraPosition), lightDirection);\r\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\r\n\r\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\r\n}\r\n",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main() {\r\n  float cap \x3d 0.7;\r\n  float scale \x3d 1.0/cap;\r\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n  float intensity \x3d alpha*alpha*alpha;\r\n  if (vsize \x3c 3.0)\r\n    intensity *\x3d 0.5;\r\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n  gl_FragColor.xyz *\x3d vcolor.xyz;\r\n}\r\n",
"stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform vec4 viewport;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute float size;\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main(void) {\r\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\r\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  vcolor \x3d color / 1.2;\r\n  vsize \x3d size * 5.0 * pixelRatio;\r\n  gl_PointSize \x3d vsize;\r\n}\r\n"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec2 size;\r\nuniform vec4 color1;\r\nuniform vec4 color2;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n  vec2 uv \x3d fract(uvScaled - 0.25);\r\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n\r\n  gl_FragColor \x3d mix(color2, color1, t);\r\n}\r\n",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"},color:{"color.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\n#ifdef VERTEX_COLORS\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef VERTEX_COLORS\r\n  gl_FragColor \x3d vColor * eColor;\r\n#else\r\n  gl_FragColor \x3d eColor;\r\n#endif\r\n}\r\n",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n#ifdef VERTEX_COLORS\r\nattribute vec4 color;\r\n\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef VERTEX_COLORS\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n\r\n  if (texColor.a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1,1,1,1);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(vpos + localOrigin);\r\n#else\r\n  vec3 normal \x3d vec3(0,0,1);\r\n#endif\r\n#else\r\n#ifdef DOUBLESIDED\r\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n#elif defined(WINDINGORDERDOUBLESIDED)\r\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n#else\r\n  vec3 normal \x3d vnormal;\r\n#endif\r\n  normal \x3d normalize(normal);\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif defined(VIEWING_MODE_GLOBAL)\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n#if defined(VERTEXCOLORS)\r\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#else\r\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#endif\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n  if (opacity_ \x3c 0.001) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\n#ifdef INSTANCEDCOLOR\r\nattribute vec4 instanceColor;\r\n#endif\r\nattribute vec3 position;\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  return texture2D(uComponentColorTex, indexCoord);\r\n}\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vnormal \x3d normalize(modelNormal * localNormal().xyz);\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n  vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n  vcolorExt *\x3d instanceColor;\r\n#endif\r\n#ifdef VV_COLOR\r\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  return model * localPosition().xyz;\r\n#else\r\n  return (model * localPosition()).xyz;\r\n#endif\r\n}\r\n\r\n#ifdef VERTICAL_OFFSET\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#endif\r\n\r\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n  float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\r\n  float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n  vec3 worldNormal \x3d vec3(0, 0, 1);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n  return worldNormal * worldOffset;\r\n}\r\n#endif\r\n",
"commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nuniform vec3 viewOriginHi;\r\nuniform vec3 viewOriginLo;\r\n#endif\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nattribute vec3 modelOriginHi;\r\nattribute vec3 modelOriginLo;\r\nattribute mat3 model;\r\nattribute mat3 modelNormal;\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\nattribute mat4 model;\r\nattribute mat4 modelNormal;\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n#else /* INSTANCED */\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n#endif /* INSTANCED */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n#endif\r\n#endif\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vec4(vec3(0, 0, 0), 1.0); }\r\n# endif\r\n#endif\r\n","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\r\n# else\r\nvec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4(normal, 1.0); }\r\n# endif\r\n#endif\r\n",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\r\n#else\r\nvec4 localPosition() { return vec4(position, 1.0); }\r\n#endif\r\n","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vpos +\x3d modelOriginHi;\r\n  vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\n// based on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\r\nfloat coverageCorrectionFactor(vec2 uv) {\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  const float MipScale \x3d 0.25;\r\n  uv *\x3d texSize;\r\n#ifdef TEXTURE_ATLAS\r\n  uv *\x3d region.zw - region.xy;\r\n#endif\r\n  return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\r\n#else\r\n  return 1.0;\r\n#endif\r\n}\r\n\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  #define ALPHA_THRESHOLD 0.5\r\n#else\r\n  #define ALPHA_THRESHOLD 0.33\r\n#endif\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  vec4 texColor;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n"},
hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n}\r\n","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n  // do it for all highlight pixel based on the centroid occlusion. This\r\n  // is a temporary solution for:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n  if (voccluded \x3d\x3d 1.0) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  } else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n#else\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n#endif\r\n}\r\n",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\nuniform vec2 screenOffset;\r\nuniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspective;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\nattribute vec2 size;\r\nattribute vec4 auxpos2;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\nvoid main(void) {\r\n  ProjectHUDAux projectAux;\r\n  vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n  vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n  inputSize \x3d size;\r\n\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  // only use width (.xx) for proportional scaling\r\n  // (if no width was defined in vv, width\r\n  //  will be a copy of height vv)\r\n  inputSize *\x3d vvGetScale(auxpos2).xx;\r\n#endif\r\n\r\n  vec2 combinedSize \x3d inputSize * pixelRatio;\r\n  vec4 quadOffset \x3d vec4(0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n  bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvoccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n  if (visible) {\r\n#endif\r\n    // UV goes from 0 to 1.99999, where the integer part is used\r\n    // for the normalized vertex coordinates, and the fractional\r\n    // part is used for texture sampling\r\n    vec2 uv01 \x3d floor(uv0);\r\n    vec2 uv \x3d uv0 - uv01;\r\n\r\n    // Displace icon based on anchor position (normalized for size) and\r\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n    // SDF primitives might be scaled so that the SDF texture resolution does\r\n    // not match the resolution of the canvas, but we still want to render\r\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\r\n    // pixel border at the geometry center achieves this, since SDF textures\r\n    // always have power of 2 dimensions.\r\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n    posProj +\x3d quadOffset;\r\n\r\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\r\n    // border renders textures with pixel-perfect results. If the texture\r\n    // resolution does not match the canvas resolution then aligning is\r\n    // redundant.\r\n    if (inputSize.x \x3d\x3d size.x) {\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n    vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n    vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n  } else {\r\n    vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(0);\r\n#endif\r\n\r\n  }\r\n#endif\r\n\r\n  gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n  vcolor \x3d color / 255.0;\r\n#endif\r\n}\r\n",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 overrideColor;\r\nuniform vec4 outlineColor;\r\nuniform float outlineSize;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n",
"hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\r\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n  // Attempt to sample texel centers to avoid that thin cross outlines\r\n  // disappear with large symbol sizes.\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n  const float txSize \x3d 128.0;\r\n  const float texelSize \x3d 1.0 / txSize;\r\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\r\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\r\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\r\n\r\n  // Get distance and map it into [-0.5, 0.5]\r\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\r\n\r\n  // Distance in output units (i.e. pixels)\r\n  float dist \x3d d * vsize.x;\r\n\r\n  // Create smooth transition from the icon into its outline\r\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  if (outlineSize \x3e 0.25) {\r\n    vec4 outlinePixelColor \x3d outlineColor;\r\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n\r\n    // Create smooth transition around outline\r\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\r\n  }\r\n\r\n  // visualize SDF:\r\n  // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n  // fragment color. Input textures should already be pre-multiplied and so\r\n  // don't require adjustment, but the override and vertex colors must be\r\n  // modulated by their alpha values.\r\n\r\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\r\n#endif\r\n\r\n  if (gl_FragColor.a \x3c 0.1) {\r\n    discard;\r\n  }\r\n",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vec4 posProjCenter;\r\n\r\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n  // of clip space.\r\n  if (dot(position, position) \x3e 0.0) {\r\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n    // the marker color\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    vec3 vpos \x3d projectAux.posModel;\r\n    if (rejectBySlice(vpos)) {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n  }\r\n  else {\r\n    // Project out of clip space\r\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n  }\r\n\r\n  gl_Position \x3d posProjCenter;\r\n  gl_PointSize \x3d 1.0;\r\n}\r\n"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\nuniform vec4 borderColor;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main() {\r\n  // Mix between line and border coverage offsets depending on whether we need\r\n  // a border (based on the sidedness).\r\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n  // Mix between border and line color based on the line coverage (conceptually the line\r\n  // blends on top of the border background).\r\n  //\r\n  // Anti-alias by blending final result using the full (including optional border) coverage\r\n  // and the color alpha\r\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n  float colorAlpha \x3d color.a * coverage.x;\r\n\r\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n  if (finalAlpha \x3c 0.01) {\r\n    discard;\r\n  }\r\n\r\n#else\r\n\r\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n  // need to divide by finalAlpha). We avoid the division here by setting the\r\n  // appropriate blending function in the material.\r\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n}\r\n",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nattribute vec2 uv0;\r\n\r\nuniform float lineSize;\r\nuniform vec2 pixelToNDC;\r\nuniform float borderSize;\r\nuniform vec2 screenOffset;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main(void) {\r\n\r\n  ProjectHUDAux projectAux;\r\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n  vec3 vpos \x3d projectAux.posModel;\r\n  if (rejectBySlice(vpos)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    return;\r\n  }\r\n\r\n#ifdef OCCL_TEST\r\n  if (!testVisibilityHUD(endPoint)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    return;\r\n  }\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n  // used to get the correct depth value\r\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\r\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\r\n\r\n  // Apply screen offset to both start and end point\r\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n  // Align start and end to pixel origin\r\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\r\n\r\n  // The direction of the line in screen space\r\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n  float lineSizeScaled \x3d lineSize;\r\n  float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n  // Sub-pixel offset if we need to grow sub-pixels to the left\r\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n  float padding \x3d 1.0 + borderSizeScaled;\r\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n  // Offset x/y from the center of the line in screen space\r\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n  // Compute a coverage varying which we can use in the fragment shader to determine\r\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n  // This works by computing two coordinates that can be linearly interpolated and then\r\n  // subtracted to find out how far away from the line edge we are.\r\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\r\n\r\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n  coverageSampling \x3d vec4(\r\n    // Edge coordinate\r\n    outerEdgeCoverageSampler,\r\n\r\n    // Border edge coordinate\r\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n    // Line offset\r\n    halfPixelSize - 0.5,\r\n\r\n    // Border offset\r\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n  );\r\n\r\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n  gl_Position \x3d projectedPosition;\r\n}\r\n"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform float outlineSize;\r\nuniform vec4 outlineColor;\r\nuniform float stripeLength;\r\nuniform vec4 stripeEvenColor;\r\nuniform vec4 stripeOddColor;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\n#define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\nvec4 arrowColor(vec2 tc, float len) {\r\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n  d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n  if (d \x3c 0.0) {\r\n    return vec4(0.0);\r\n  } else if (d \x3c outlineSize) {\r\n    return outlineColor;\r\n  } else {\r\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n  }\r\n}\r\n\r\nvoid main(void) {\r\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n  if (color.a \x3d\x3d 0.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d color;\r\n}\r\n",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float width;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv0;\r\nattribute float auxpos1;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\nvoid main(void) {\r\n  vec3 bitangent \x3d normal;\r\n\r\n  vtc \x3d uv0;\r\n  vlength \x3d auxpos1;\r\n  vradius \x3d 0.5 * width;\r\n\r\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\r\n  gl_Position \x3d proj * pos;\r\n}\r\n"},
nativeLine:{"colorPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 color;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d color;\r\n}\r\n","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},ribbonLine:{"colorPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\nvarying vec4 vColor;\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d eColor * vColor;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","ribbonLine.vert":'#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float extLineWidth;\r\nuniform float nearPlane;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\n\r\nvarying vec2 vtc;\r\nvarying vec4 vColor;\r\nvarying vec3 vpos;\r\n\r\nattribute float size;\r\n\r\n#ifndef WALL\r\nuniform float miterLimit;\r\nattribute vec3 auxpos1;\r\nattribute vec3 auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\nuniform vec2 screenSize;\r\n\r\nvec4 toScreenCoords(vec3 vertex) {\r\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n  vClipSpace.xy *\x3d screenSize;\r\n  return vClipSpace/abs(vClipSpace.w);\r\n}\r\n\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\nfloat interp(float ncp, vec4 a, vec4 b) {\r\n  return (-ncp - a.z) / (b.z - a.z);\r\n}\r\n\r\n#ifdef SCREENSCALE\r\n\r\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n  float vnp \x3d nearPlane*0.99;\r\n\r\n  //We have four vertices per point on the line. Start and end vertices\r\n  //are treated differently --\x3e d \x3e 0, d \x3c 0\r\n  float d \x3d abs(uv0.y) - 1.1;\r\n\r\n  //current pos behind ncp --\x3e we need to clip\r\n  if(pos.z \x3e -nearPlane) {\r\n    if (d \x3c 0.0) {\r\n      //previous in front of ncp\r\n      if(prev.z \x3c -nearPlane) {\r\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n        next \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0, 0, 0, 1);\r\n      }\r\n    }\r\n    //next in front of ncp\r\n    if(d \x3e 0.0) {\r\n      if(next.z \x3c -nearPlane) {\r\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\r\n        prev \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0, 0, 0, 1);\r\n      }\r\n    }\r\n  } else {\r\n    //current position visible\r\n    //previous behind ncp\r\n    if (prev.z \x3e -nearPlane) {\r\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n    }\r\n    //next behind ncp\r\n    if (next.z \x3e -nearPlane) {\r\n      next \x3d mix(next, pos, interp(vnp, next, pos));\r\n    }\r\n  }\r\n\r\n  pos\x3d proj * pos;\r\n  pos.xy *\x3d screenSize;\r\n  pos /\x3d pos.w;\r\n\r\n  next \x3d proj * next;\r\n  next.xy *\x3d screenSize;\r\n  next /\x3d next.w;\r\n\r\n  prev \x3d proj * prev;\r\n  prev.xy *\x3d screenSize;\r\n  prev /\x3d prev.w;\r\n}\r\n\r\n#endif // SCREENSCALE\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n#ifdef SCREENSCALE\r\n// Check for special value of uv0.y which is used by the Renderer when graphics\r\n// are removed before the VBO is recompacted. If this is the case, then we just\r\n// project outside of clip space.\r\nif (uv0.y \x3d\x3d 0.0) {\r\n  // Project out of clip space\r\n  gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n}\r\nelse {\r\n#endif\r\n\r\nfloat lineWidth \x3d extLineWidth + size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n  vec4 pos \x3d toScreenCoords(position.xyz);\r\n  vec2 left \x3d (pos - toScreenCoords(auxpos1)).xy;\r\n  vec2 right \x3d (toScreenCoords(auxpos2) - pos).xy;\r\n#else\r\n  vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\r\n  vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\r\n  vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n  clipAndTransform(pos, prev, next);\r\n\r\n  vec2 left \x3d (pos - prev).xy;\r\n  vec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n  vec4 pos \x3d vec4(position, 1.0);\r\n#ifndef WALL\r\n  vec3 left \x3d position.xyz - auxpos1;\r\n  vec3 right \x3d auxpos2 - position.xyz;\r\n  vec3 up \x3d normalize(position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n  float displacementLen \x3d lineWidth;\r\n  vec3 displacementDir \x3d normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n  float leftLen \x3d length(left);\r\n  left \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n  float rightLen \x3d length(right);\r\n  right \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n  // determine if vertex is on the "outside or "inside" of the join\r\n  bool isOutside \x3d ISOUTSIDE;\r\n\r\n  // compute miter join position first\r\n  float displacementLen \x3d lineWidth;\r\n  VECTYPE displacementDir \x3d normalize(left + right);\r\n  displacementDir \x3d PERPENDICULAR(displacementDir);\r\n  if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n    float nDotSeg \x3d dot(displacementDir, left);\r\n    displacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n    // limit displacement of inner vertices\r\n    if (!isOutside) {\r\n      displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n    }\r\n  }\r\n\r\n  if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n    // convert to bevel join if miterLimit is exceeded\r\n    if (leftLen \x3c 0.001) {\r\n      displacementDir \x3d right;\r\n    }\r\n    else if (rightLen \x3c 0.001) {\r\n      displacementDir \x3d left;\r\n    }\r\n    else {\r\n      displacementDir \x3d (abs(uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n    }\r\n    displacementDir \x3d normalize(displacementDir);\r\n    displacementDir \x3d PERPENDICULAR(displacementDir);\r\n    displacementLen \x3d lineWidth;\r\n  }\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n  pos.xy +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos.xy /\x3d screenSize;\r\n#else\r\n  pos.xyz +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n  vtc \x3d uv0;\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  gl_Position \x3d pos;\r\n\r\n#ifdef SCREENSCALE\r\n  }\r\n#endif\r\n}\r\n'}},
misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec2 uv;\r\n\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color \x3d texture2D(tex, uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n}\r\n","blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nuniform float scale;\r\nuniform vec2 offset;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  uv \x3d uv0 * scale + offset;;\r\n}\r\n",
"showDepth.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n// gl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n   gl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n// gl_FragColor \x3d texture2D(depthTex, vtc);\r\n}\r\n","showDepth.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * vec4(position.x, position.y, .0, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n",
"simple.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simple.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n","texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 color;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n  gl_FragColor \x3d texColor * color;\r\n}\r\n",
"texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n"},pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n#ifdef DEPTH_PASS\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\r\n  float r2 \x3d dot(vOffset, vOffset);\r\n\r\n  if (r2 \x3e 0.25) {\r\n    discard;\r\n  }\r\n\r\n#ifdef DEPTH_PASS\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d vec4(vColor, 1.0);\r\n#endif\r\n}\r\n",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uModelViewMatrix;\r\nuniform mat4 uProjectionMatrix;\r\nuniform vec2 uScreenMinMaxSize;\r\nuniform vec2 uPointScale;\r\nuniform vec3 uClipMin;\r\nuniform vec3 uClipMax;\r\n\r\n#ifdef DEPTH_PASS\r\nuniform vec2 nearFar;\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n  // Move clipped points outside of clipspace\r\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\r\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  if (rejectBySlice(aPosition)) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  // Position in camera space\r\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\r\n\r\n  float pointSize \x3d uPointScale.x;\r\n  vec4 position \x3d uProjectionMatrix * camera;\r\n\r\n  // Calculate Size\r\n#ifdef DRAW_SCREEN_SIZE\r\n    float clampedScreenSize \x3d pointSize;\r\n#else\r\n    float pointRadius \x3d 0.5 * pointSize;\r\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\r\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\r\n    float radius \x3d abs(positionOffset.y - position.y);\r\n\r\n    float viewHeight \x3d uPointScale.y;\r\n\r\n    // screen diameter \x3d (2 * r / w) * (h / 2)\r\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\r\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\r\n\r\n    // Shift towards camera, to move rendered point out of terrain i.e. to\r\n    // the camera-facing end of the virtual point when considering it as a\r\n    // 3D sphere.\r\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\r\n    position \x3d uProjectionMatrix * camera;\r\n#endif\r\n\r\n  gl_PointSize \x3d clampedScreenSize;\r\n  gl_Position \x3d position;\r\n\r\n#ifdef DEPTH_PASS\r\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n#else\r\n  vColor \x3d aColor;\r\n#endif\r\n}\r\n"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Merging blurred outlines with source image, advanced version\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GRID_DEBUG (set or !set)\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform sampler2D origin;\r\n\r\nuniform vec4 color;\r\nuniform float outlineSize;\r\nuniform float blurSize;\r\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n    gl_FragColor \x3d vec4(uv, 0, 1.0);\r\n  #else\r\n    // Read the highlight intensity from the blurred highlight image\r\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n    float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n    // Discard all pixels which are not affected by highlight\r\n    if (highlightIntensity \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n\r\n    vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n    float outlineIntensity;\r\n    float fillIntensity;\r\n\r\n    // if occluded\r\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n      outlineIntensity \x3d color.w * opacities[1];\r\n      fillIntensity \x3d color.w * opacities[3];\r\n    }\r\n    // if unoccluded\r\n    else {\r\n      outlineIntensity \x3d color.w * opacities[0];\r\n      fillIntensity \x3d color.w * opacities[2];\r\n    }\r\n\r\n    float inner \x3d 1.0 - outlineSize / 9.0;\r\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n    //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    // I.e., color should not be premultiplied with alpha\r\n    gl_FragColor \x3d vec4(color.xyz, intensity);\r\n  #endif\r\n}\r\n",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  attribute vec2 uv0;\r\n  uniform sampler2D coverageTex;\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    #ifdef GRID_DEBUG\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block,\r\n      // or all pixels set, hide block\r\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n        return;\r\n      }\r\n      gl_Position \x3d vec4(position, .0, 1.0);\r\n      uv \x3d uv0;\r\n      return;\r\n    #else\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block, hide block\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n        return;\r\n      }\r\n    #endif\r\n  #endif\r\n\r\n  gl_Position \x3d vec4(position, .0, 1.0);\r\n  uv \x3d position.xy * .5 + vec2(.5);\r\n}\r\n",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Gaussian blur with linear sampling. Supports different number of samples, but\r\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\r\n// the number of samples taken.\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GAUSSIAN_SAMPLES (3,5,7)\r\n\r\n// This technique requires linear filtering on source texture\r\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform vec2 blurSize;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    vec2 uv \x3d blurCoordinate.xy;\r\n    vec4 center \x3d texture2D(tex, uv);\r\n\r\n    // do not blur if no pixel or all pixels in neighborhood are set\r\n    if (blurCoordinate.z \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d center;\r\n    }\r\n    else {\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.154164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    }\r\n  #else\r\n    vec4 sum \x3d vec4(0.0);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n    #endif\r\n\r\n    gl_FragColor \x3d sum;\r\n  #endif\r\n}\r\n",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform sampler2D coverageTex;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  uniform vec2 blurSize;\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(position, 0.0, 1.0);\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    // sample the coverage texture at the block center\r\n    // and if no coverage detected, create degenerate triangle\r\n    vec4 cov \x3d texture2D(coverageTex, uv0);\r\n    if (cov.r \x3d\x3d 0.0) {\r\n      gl_Position \x3d vec4(0,0,0,0);\r\n    }\r\n\r\n    // create texture coordinate for blur center\r\n    // encode information about fully inside block in z coordinate\r\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n  #else\r\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n    #endif\r\n  #endif\r\n}\r\n",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\r\n// screen region to check if none, any or all pixels were set.\r\n\r\n// The red channel is always ceiled after interpolating the 4 merged pixels.\r\n// This allows to evaluate:\r\n// any(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\n// none(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\n// The green and blue channels are set to floor(max(green, blue)).\r\n// This allows to evaluate:\r\n// all(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform vec2 invFramebufferDim;\r\n\r\nvoid main() {\r\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n  vec4 value \x3d texture2D(tex, coord);\r\n  float mx \x3d floor(max(value.g, value.b));\r\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n}\r\n",
"downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\r\n}\r\n"},laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n//--------------------------------------------------------------------------\r\n// Uniforms\r\n//--------------------------------------------------------------------------\r\n\r\nuniform sampler2D depthMap;\r\n\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 zScale;\r\nuniform float maxPixelDistance;\r\n\r\n// focus plane in camera space\r\nuniform vec4 focusPlane;\r\n\r\n// focus sphere in camera space\r\nuniform vec4 focusSphere;\r\n\r\n// segment plane in camera space\r\nuniform vec4 segmentPlane;\r\n\r\n// line segment\r\nuniform vec3 segmentStart;\r\nuniform vec3 segmentEnd;\r\n\r\n// styling\r\nuniform vec3 glowColor;\r\nuniform float glowWidth;\r\nuniform vec3 innerColor;\r\nuniform float innerWidth;\r\nuniform float globalAlpha;\r\n\r\n//--------------------------------------------------------------------------\r\n// Inputs\r\n//--------------------------------------------------------------------------\r\n\r\nvarying vec2 uv;\r\n\r\n//--------------------------------------------------------------------------\r\n// Defines\r\n//--------------------------------------------------------------------------\r\n\r\n#define INFINITY 100000.0\r\n\r\n\r\n\r\n// reconstruct depth value from linear depth map\r\nfloat linearDepth(vec2 uv) {\r\n  return -(rgba2float(texture2D(depthMap, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\r\n}\r\n\r\n// reconstruct position in view space\r\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\r\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\r\n}\r\n\r\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\r\n  // compute distance to plane\r\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\r\n  // compute distance to sphere\r\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\r\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\r\n\r\n  return vec4(\r\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\r\n    source.a + dest.a * oneMinusSourceAlpha\r\n  );\r\n}\r\n\r\nvec4 premultipliedColor(vec3 rgb, float alpha) {\r\n  return vec4(rgb * alpha, alpha);\r\n}\r\n\r\n// computes laser line color based on distance in pixels\r\nvec4 laserLineProfile(float dist) {\r\n  if (dist \x3e glowWidth) {\r\n    return vec4(0.0);\r\n  }\r\n\r\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\r\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\r\n\r\n  return blendPremultiplied(\r\n    premultipliedColor(innerColor, innerAlpha),\r\n    premultipliedColor(glowColor, glowAlpha)\r\n  );\r\n}\r\n\r\nvoid main() {\r\n  // do not draw laserline on background\r\n  float depth \x3d linearDepth(uv);\r\n  if (-depth \x3d\x3d nearFar[0]) {\r\n    discard;\r\n  }\r\n\r\n  // reconstruct position in view space\r\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\r\n\r\n  // empirical hack to fade out laser line in problematic areas:\r\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\r\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\r\n  // areas where depth valus have large variations in order to avoid this problem.\r\n  float ddepth \x3d fwidth(depth);\r\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\r\n\r\n  // reconstruct normal using derivatives\r\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\r\n\r\n  // distance to focus plane\r\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\r\n\r\n  // distance to focus sphere\r\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\r\n\r\n  // distance to segment plane\r\n  float segmentDistance \x3d INFINITY;\r\n  float segmentLength \x3d length(segmentEnd - segmentStart);\r\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\r\n  float t \x3d dot(segmentDir, pos - segmentStart);\r\n\r\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\r\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\r\n  }\r\n\r\n  // evaluate color profile for both planes and the sphere\r\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\r\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\r\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\r\n\r\n  // empirical hack to fade out laser line when planes are nearly parallel\r\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\r\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\r\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\r\n\r\n  // combine colors\r\n  vec4 color \x3d max(\r\n    focusPlaneColor * focusPlaneAlpha,\r\n    max(\r\n      focusSphereColor * focusSphereAlpha,\r\n      segmentColor * segmentAlpha\r\n    )\r\n  );\r\n\r\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\r\n}\r\n"},
occluded:{"combine.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D occludedColorMap;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\r\n  gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\r\n}\r\n"},offscreen:{"offscreen.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d texture2D(tex, vtc);\r\n}\r\n","offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n  vtc \x3d position.xy * 0.5 + 0.5;\r\n}\r\n",
"transparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\r\n}\r\n"},ssao:{"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3crenderer/ssao/common.glsl\x3e\r\n\r\n#ifndef RADIUS\r\n#define RADIUS 4\r\n#endif\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\nuniform sampler2D tex;\r\n\r\nuniform vec2 blurSize;\r\n\r\nuniform float g_BlurFalloff;\r\nuniform float projScale;\r\n\r\nuniform vec2    nearFar;\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2 uv;\r\n\r\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\r\n  float c \x3d texture2D(tex, uv).r;\r\n  float d \x3d getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  float ddiff \x3d d - center_d;\r\n\r\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n  w_total +\x3d w;\r\n\r\n  return w*c;\r\n}\r\n\r\nvoid main(void) {\r\n  float b \x3d 0.0;\r\n  float w_total \x3d 0.0;\r\n\r\n  float center_d \x3d  getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  float sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\r\n    float rf \x3d float(r);\r\n    vec2 uvOffset \x3d uv + rf*blurSize;\r\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n  }\r\n\r\n  gl_FragColor \x3d vec4(b/w_total);\r\n}\r\n",
"common.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\nfloat getDepthLinear(sampler2D depthMap, vec2 nearFar, vec2 ssC) {\r\n  return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n}\r\n","ssao.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3crenderer/ssao/common.glsl\x3e\r\n\r\n#ifndef SAMPLES\r\n#define SAMPLES 4\r\n#endif\r\n\r\nuniform mat4 projMatrixInv;\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\n\r\nuniform float intensity;\r\n\r\nuniform float projScale;\r\nuniform float radius;\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 screenDimensions;\r\n\r\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\nuniform vec3 pSphere[SAMPLES]; //tap position\r\nuniform vec2 rnmScale;\r\nuniform sampler2D rnm; //noise texture\r\n\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2  uv;\r\nvarying vec4  camPos;\r\n\r\nfloat fallOffFunction(float vv, float vn, float bias) {\r\n  float radius2 \x3d radius * radius;\r\n\r\n  // A: From the HPG12 paper\r\n  // Note large epsilon to avoid overdarkening within cracks\r\n  // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\r\n  // more computationally efficient and happens to be aesthetically pleasing.\r\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n  // D: Low contrast, no division operation\r\n  // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n}\r\n\r\n\r\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n  vec3 v \x3d Q - C;\r\n  float vv \x3d dot(v, v);\r\n  float vn \x3d dot(normalize(v), n_C);\r\n  return fallOffFunction(vv, vn, 0.1);\r\n}\r\n\r\n\r\n/**\r\n * Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n * pixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n * was placed!]\r\n *\r\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n */\r\nvec3 reconstructCSPosition(vec2 S, float z) {\r\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n}\r\n\r\nvoid main(void) {\r\n  //Hash function used in the HPG12 AlchemyAO paper\r\n  //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n  //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n  //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n  float currentPixelDepth \x3d getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n    gl_FragColor \x3d vec4(0);\r\n    return;\r\n  }\r\n\r\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n  // get the normal of current fragment\r\n  vec4 norm4 \x3d texture2D(normalMap, uv);\r\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n  bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n  float sum \x3d .0;\r\n\r\n  vec4 occluderFragment;\r\n  vec3 ray;\r\n\r\n  vec3 tapPixelPos;\r\n\r\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n  // bug or deviation from CE somewhere else?\r\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\r\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n    //float ssR;\r\n    //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n    // get the depth of the occluder fragment\r\n    //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n    //don't use current or very nearby samples\r\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n    vec2 tcTap \x3d tc/screenDimensions;\r\n    float occluderFragmentDepth \x3d getDepthLinear(depthMap, nearFar, tcTap);\r\n\r\n    if (isTerrain) {\r\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n      if (isTerrainTap) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n  }\r\n\r\n  // output the result\r\n\r\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\r\n\r\n  // Anti-tone map to reduce contrast and drag dark region farther\r\n  // (x^0.2 + 1.2 * x^4)/2.2\r\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n  //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n  //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n  //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n  gl_FragColor \x3d vec4(A);\r\n}\r\n"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#include \x3cutil/shadow.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 viewDirection;\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nstruct WireframeSettings {\r\n  float width;\r\n  float falloff;\r\n  float subdivision;\r\n  vec4 color;\r\n  float wireOpacity;\r\n  float surfaceOpacity;\r\n};\r\n\r\nuniform WireframeSettings wireframe;\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n#endif\r\n\r\nconst vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\nconst vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\nconst float diffuseHardness \x3d 2.5;\r\n\r\n#ifdef OVERLAY\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\nfloat lum(vec3 c) {\r\n  float max \x3d max(max(c.r, c.g), c.b);\r\n  float min \x3d min(min(c.r, c.g), c.b);\r\n  return (min + max) * 0.5;\r\n}\r\n\r\n#ifdef ATMOSPHERE\r\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n  vec3 surfaceColor   \x3d vec3(0.0);\r\n  vec3 fuzzySpecColor \x3d vec3(1.0);\r\n  vec3 subColor       \x3d vec3(0.0);\r\n  float rollOff       \x3d 1.0;\r\n\r\n  vec3 Ln \x3d normalize(lightPos);\r\n  vec3 Nn \x3d normalize(normal);\r\n  vec3 Hn \x3d normalize(view + Ln);\r\n\r\n  float ldn \x3d dot(Ln, Nn);\r\n  float diffComp \x3d max(0.0, ldn);\r\n  float vdn \x3d 1.0 - dot(view, Nn);\r\n  float ndv \x3d dot(view, Ln);\r\n\r\n  vec3 diffContrib \x3d surfaceColor * diffComp;\r\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n  vec3 subContrib \x3d subLamb * subColor;\r\n  vec3 vecColor \x3d vec3(vdn);\r\n\r\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n  return (diffContrib + specularContrib) * rollOff;\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n  vec3 a \x3d ambient;\r\n\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n  float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\r\n\r\n#ifdef OVERLAY\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  // tileColor and overlayTexCols have pre-multiplied alpha\r\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\r\n#endif\r\n\r\n  vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n  float ndotl \x3d max(0.0, min(1.0, vndl));\r\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n  atm *\x3d tileColor.a; // premultiply with tile alpha\r\n#endif\r\n\r\n  vec3 albedo \x3d atm + tileColor.rgb;\r\n  vec3 normal \x3d normalize(vnormal);\r\n\r\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  // This is only used for debug rendering the screenSize perspective\r\n\r\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n  if (perspectiveScale \x3c\x3d 0.25) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3c\x3d 0.5) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3e\x3d 0.99) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\r\n  }\r\n\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n  vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n  vec2 dVuv \x3d fwidth(vuvScaled);\r\n  dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n\r\n  vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME_TEXTURE\r\n  vec3 wireframeColor \x3d mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\r\n  float wireframeAlpha \x3d mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\r\n  gl_FragColor \x3d vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n  dVuv \x3d fwidth(vuv);\r\n  edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n  edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n\r\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec3 origin;\r\nuniform vec4 texOffsetAndScale;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nuniform vec3 lightDirection;\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n// these variables combine two possible overlays into one by using a vec4:\r\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\r\nuniform vec4 overlayTexOffset;\r\nuniform vec4 overlayTexScale;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\nvoid main(void) {\r\n  vpos \x3d position;\r\n\r\n#ifdef SPHERICAL\r\n  vnormal \x3d normalize(vpos + origin);\r\n#else\r\n  vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n#endif\r\n\r\nvec2 uv \x3d uv0;\r\nvpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\r\n\r\n#ifdef ATMOSPHERE\r\n  wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n  wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n  vuv \x3d uv;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n  screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\r\n\r\n#ifdef OVERLAY\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n#endif\r\n}\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 nearFar;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef SPHERICAL\r\n  vec3 normal \x3d normalize(position + origin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  if (overlayColor.a \x3d\x3d 0.0) {\r\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n    // the highlights which might have been written by skirts of other tiles.\r\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n    gl_FragColor \x3d vec4(0,0,0,0);\r\n    return;\r\n  }\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec4 overlayTexScale;\r\nuniform vec4 overlayTexOffset;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vpos;\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  #ifdef SPHERICAL\r\n    vec3 vnormal \x3d normalize(position + origin);\r\n  #else\r\n    vec3 vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n  #endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\r\n\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef SPHERICAL\r\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\r\n#else\r\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  vnormal \x3d normalize((viewNormal * normal).xyz);\r\n}\r\n",
"overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\r\n  vec4 color \x3d vec4(0, 0, 0, 0);\r\n\r\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\r\n    // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\r\n    color \x3d texture2D(overlay0Tex, texCoords.xy);\r\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\r\n    // sample from outer overlay\r\n    color \x3d texture2D(overlay1Tex, texCoords.zw);\r\n  }\r\n\r\n  return color * opacity;\r\n}\r\n",
"skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\r\n  float skirtLength \x3d 0.0;\r\n\r\n  if (uv.x \x3e\x3d 2.0) {\r\n    skirtLength \x3d uv.y * skirtScale;\r\n    // decode original uv-coordinates (see "encodeSkirtPos")\r\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\r\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\r\n  }\r\n\r\n  return vpos - vnormal * skirtLength;\r\n}\r\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1), bias towards right pixel edge\r\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel center\r\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n\r\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1),\r\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel border, (0 : 1)\r\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\r\n  return vec4(v.rgb * v.a, v.a);\r\n}\r\n\r\nvec3 rgb2hsv(vec3 c) {\r\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n  float d \x3d q.x - min(q.w, q.y);\r\n  float e \x3d 1.0e-10;\r\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c) {\r\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n",
"depth.glsl":"float calcFragDepth(const in float depth) {\r\n  //calc polygon offset\r\n  const float SLOPE_SCALE \x3d 2.0;\r\n  const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\r\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n  return clamp(result, .0, .999999);\r\n}\r\n","doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\r\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\r\n  vec3 t1 \x3d hiA + hiB;\r\n  vec3 e \x3d t1 - hiA;\r\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\r\n  return t1 + t2;\r\n}\r\n",
"enableExtensions.glsl":"\r\n#extension GL_OES_standard_derivatives : enable\r\n#extension GL_EXT_shader_texture_lod : enable\r\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\r\n// it is rgba2float(vec4(1)) inlined.\r\nconst float MAX_RGBA_FLOAT \x3d\r\n  255.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\nconst vec4 fixedPointFactors \x3d vec4(1, 256, 256 * 256, 256 * 256 * 256);\r\n\r\nvec4 float2rgba(const float value) {\r\n  // Make sure value is in the domain we can represent\r\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n  // Decompose value in 32bit fixed point parts represented as\r\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n  // by a power of 256 (this removes the bits that are represented in the previous\r\n  // component) and then converts the fractional part to 8bits.\r\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n  // Convert uint8 values (from 0 to 255) to floating point representation for\r\n  // the shader\r\n  const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n  return fixedPointU8 * toU8AsFloat;\r\n}\r\n\r\n// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n  255.0 / (256.0),\r\n  255.0 / (256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n);\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n#else\r\nprecision mediump float;\r\nprecision mediump sampler2D;\r\n#endif\r\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\r\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\r\n  if (fragCoord.z \x3e sceneDepth + 5e-6) {\r\n    return vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    return vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n}\r\n",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec4 auxpos1;\r\n\r\nuniform mat4 proj;\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform vec4 viewport;\r\n\r\nuniform vec3 camPos;\r\n\r\nuniform float polygonOffset;\r\nuniform float cameraGroundRelative;\r\nuniform float pixelRatio;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// [ divisor, offset, minPixelSize, paddingPixels ]\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\nuniform sampler2D hudVisibilityTexture;\r\n\r\n\r\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\nstruct ProjectHUDAux {\r\n  vec3 posModel;\r\n  vec3 posView;\r\n  vec3 vnormal;\r\n\r\n  float distanceToCamera;\r\n  float absCosAngle;\r\n};\r\n\r\n\r\n/**\r\n  * Apply the simulated polygon offset for HUD objects that improves\r\n  * issues with Z-fighting.\r\n  *\r\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n  *   and the view direction.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n  float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n  if (pointGroundSign \x3d\x3d 0.0) {\r\n    pointGroundSign \x3d 1.0;\r\n  }\r\n\r\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n  // view angle dependent part of polygon offset emulation\r\n  // we take the absolute value because the sign that is dropped is\r\n  // instead introduced using the ground-relative position of the symbol and the camera\r\n  if (polygonOffset \x3e .0) {\r\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n    // same side of the terrain\r\n    if (groundRelative \x3e 0.0) {\r\n      posView *\x3d factor;\r\n    }\r\n    // opposite sides of the terrain\r\n    else {\r\n      posView /\x3d factor;\r\n    }\r\n  }\r\n\r\n  return groundRelative;\r\n}\r\n\r\n/**\r\n  * Project the 3d position of a HUD object from world space to clip space. In addition\r\n  * to standard model view projection, it also emulates a polygon offset to\r\n  * help with points above/below ground and icon flickering. The resulting location\r\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n  * visibility of the HUD object. Note that the returned projected position is not\r\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - position: contains the point world position\r\n  *     - normal: contains the world normal pointing up at the point\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - model: the object -\x3e world transformation matrix\r\n  *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n  *     - view: the world -\x3e view transformation matrix\r\n  *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n  *     - proj: the view -\x3e clip projection matrix\r\n  *     - verticalOffset: a vec4 containing:\r\n  *         - the screen height of the vertical offset\r\n  *         - the screen height of the vertical offset as a fraction of camera distance.\r\n  *         - the minimum world size vertical offset.\r\n  *         - the maximum world size vertical offset.\r\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n  *     - screenSizePerspectiveAlignment: a vec3 containing\r\n  *         - the view distance dependent divisor\r\n  *         - the view distance dependent offset\r\n  *         - the minimum pixel size\r\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - camPos: the position of the camera in world space\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n  // centerOffset is in view space and is used to implement world size offsetting\r\n  // of labels with respect to objects. It also pulls the label towards the viewer\r\n  // so that the label is visible in front of the object.\r\n  vec3 centerOffset \x3d auxpos1.xyz;\r\n\r\n  // The pointGroundDistance is the distance of the geometry to the ground and is\r\n  // negative if the point is below the ground, or positive if the point is above\r\n  // ground.\r\n  float pointGroundDistance \x3d auxpos1.w;\r\n\r\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\r\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  // Note: keep this implementation in sync with the CPU implementation, see\r\n  //   - MaterialUtil.verticalOffsetAtDistance\r\n  //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n  aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n  aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n  aux.posModel +\x3d modelOffset;\r\n\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n  aux.posView +\x3d viewOffset;\r\n\r\n  // Since we elevate the object, we need to take that into account\r\n  // in the distance to ground\r\n  pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\r\n\r\n  // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n  // branch fragmentation and will save a normalization if it's not needed\r\n  if (centerOffset.z !\x3d 0.0) {\r\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n  }\r\n#endif\r\n\r\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n  float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n  // constant part of polygon offset emulation\r\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n  return posProj;\r\n}\r\n\r\nuniform float uRenderTransparentlyOccludedHUD;\r\n\r\n/**\r\n  * Test for visibility of a HUD object.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Uniforms:\r\n  *     - hudVisibilityTexture: the texture that contains the visibility information\r\n  *     - markerColor: the special marker color that is used to write visibility information\r\n  *     - viewport: the viewport\r\n  */\r\nbool testVisibilityHUD(vec4 posProj) {\r\n  // For occlusion testing, use the nearest pixel center to avoid\r\n  // subpixel filtering messing up the color we use to test for\r\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\r\n\r\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\r\n  // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\r\n  // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\r\n\r\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\r\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\r\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\r\n    // uRenderTransparentlyOccludedHUD \x3d 0.75\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\r\n  }\r\n  // and visible pixels that are not occluded by semi-transparent geometry here\r\n  else {\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\r\n  }\r\n\r\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n}\r\n",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n","quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\r\n  uv \x3d position * .5 + vec2(.5);\r\n}\r\n","sceneLighting.glsl":"// Scene Lighting Definitions:\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n// defines:\r\n//   - SH_ORDER: 1|2|3\r\n// input:\r\n//   - normal: vec3\r\n//   - albedo: vec3\r\n//   - shadow: float\r\n//   - ssao: float\r\n// return:\r\n//   - color: vec3\r\n\r\n// main light\r\n/////////////////////////////////////////\r\nuniform vec3 lightingMainDirection;\r\nuniform vec3 lightingMainIntensity;\r\n\r\n// ambient lighting\r\n/////////////////////////////////////////\r\n#ifndef SH_ORDER\r\n  #define SH_ORDER 2\r\n#endif\r\n\r\n#if SH_ORDER \x3d\x3d 0\r\n  uniform vec3 lightingAmbientSH0;\r\n#elif SH_ORDER \x3d\x3d 1\r\n  uniform vec4 lightingAmbientSH_R;\r\n  uniform vec4 lightingAmbientSH_G;\r\n  uniform vec4 lightingAmbientSH_B;\r\n#elif SH_ORDER \x3d\x3d 2\r\n  uniform vec3 lightingAmbientSH0;\r\n  uniform vec4 lightingAmbientSH_R1;\r\n  uniform vec4 lightingAmbientSH_G1;\r\n  uniform vec4 lightingAmbientSH_B1;\r\n  uniform vec4 lightingAmbientSH_R2;\r\n  uniform vec4 lightingAmbientSH_G2;\r\n  uniform vec4 lightingAmbientSH_B2;\r\n#endif\r\n\r\n// special tweaking\r\n//////////////////////////////////////////\r\nuniform float lightingFixedFactor;\r\nuniform float lightingGlobalFactor;\r\n\r\nuniform float ambientBoostFactor;\r\n\r\n// evaluation\r\n//////////////////////////////////////////\r\n\r\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n  // evaluate the main light\r\n  float dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\r\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n  // evaluate the sh ambient light\r\n  #if SH_ORDER \x3d\x3d 0\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n  #elif SH_ORDER \x3d\x3d 1\r\n    vec4 sh0 \x3d vec4(\r\n      0.282095,\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y\r\n    );\r\n    vec3 ambientLight \x3d vec3(\r\n      dot(lightingAmbientSH_R, sh0),\r\n      dot(lightingAmbientSH_G, sh0),\r\n      dot(lightingAmbientSH_B, sh0)\r\n    );\r\n  #elif SH_ORDER \x3d\x3d 2\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n    vec4 sh1 \x3d vec4(\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y,\r\n      1.092548 * normal.x * normal.y\r\n    );\r\n    vec4 sh2 \x3d vec4(\r\n      1.092548 * normal.y * normal.z,\r\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n      1.092548 * normal.x * normal.z,\r\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R1, sh1),\r\n      dot(lightingAmbientSH_G1, sh1),\r\n      dot(lightingAmbientSH_B1, sh1)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R2, sh2),\r\n      dot(lightingAmbientSH_G2, sh2),\r\n      dot(lightingAmbientSH_B2, sh2)\r\n    );\r\n  #endif\r\n  ambientLight *\x3d (1.0 - ssao);\r\n\r\n  // inverse gamma correction on the albedo color\r\n  float gamma \x3d 2.1;\r\n  vec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n  // physically correct BRDF normalizes by PI\r\n  const float PI \x3d 3.14159;\r\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n  // apply gamma correction to the computed color\r\n  outColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n  return outColor;\r\n}\r\n\r\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n  // heuristic lighting model originally used in the terrain shading\r\n  // now used to generated additional ambient light\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n#else\r\n    float vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\r\n#endif\r\n\r\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n}\r\n",
"screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n",
"shadow.glsl":'#include \x3cutil/encoding.glsl\x3e\r\n\r\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n// once IE11 is fine with it, const should probably be re-introduced\r\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n  //choose correct cascade\r\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n  if (i \x3e\x3d num) { return .0; }\r\n\r\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\r\n  lv.xy /\x3d lv.w;\r\n\r\n  //vertex completely outside? -\x3e no shadow\r\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\r\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\r\n\r\n  //calc coord in cascade texture\r\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n  float texSize \x3d .5 / halfPxSz;\r\n\r\n  //filter, offset by half pixels\r\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n}\r\n',
"slice.glsl":"#ifdef SLICE\r\nuniform vec3 slicePlaneOrigin;\r\nuniform vec3 slicePlaneBasis1;\r\nuniform vec3 slicePlaneBasis2;\r\n\r\nbool sliceByPlane(vec3 pos) {\r\n  vec3 rel \x3d pos - slicePlaneOrigin;\r\n\r\n  vec3 slicePlaneNormal \x3d cross(slicePlaneBasis1, slicePlaneBasis2);\r\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\r\n\r\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\r\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\r\n\r\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\r\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\r\n\r\n  return (dot(slicePlaneNormal, pos) + slicePlaneW) \x3c 0.0\r\n    \x26\x26 -basis1Dot - basis1Len2 \x3c 0.0\r\n    \x26\x26 basis1Dot - basis1Len2 \x3c 0.0\r\n    \x26\x26 -basis2Dot - basis2Len2 \x3c 0.0\r\n    \x26\x26 basis2Dot - basis2Len2 \x3c 0.0;\r\n}\r\n\r\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\r\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\r\n\r\n#else // SLICE\r\n\r\n#define rejectBySlice(_pos_) false\r\n#define discardBySlice(_pos_) {}\r\n\r\n#endif // SLICE\r\n",
"visualVariables.glsl":"#if defined(VV_SIZE)\r\n  #define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  uniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return vvSizeValue;\r\n  }\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n  }\r\n\r\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n    // Normal transform is the inverse transpose of model transform\r\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n",
"vsPrecision.glsl":"precision highp float;\r\nprecision highp sampler2D;\r\n"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(m,f){return function(){function k(e){this.readFile=e}k.prototype.resolveIncludes=function(e){return this.resolve(e)};k.prototype.resolve=function(e,g){var d=this;void 0===g&&(g=new Map);if(g.has(e))return g.get(e);var h=this.read(e);if(!h)throw Error("cannot find shader file "+e);for(var c=/^\h?#include\s+<(\S+)>\h?/gm,b=c.exec(h),a=
[];null!=b;)a.push({path:b[1],start:b.index,length:b[0].length}),b=c.exec(h);var l=0,k="";a.forEach(function(a){k+=h.slice(l,a.start);k+=g.has(a.path)?"":d.resolve(a.path,g);l=a.start+a.length});k+=h.slice(l);g.set(e,k);return k};k.prototype.read=function(e){return this.readFile(e)};return k}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(m,f,k){function e(e,d,h){h=h||{};h="function"===typeof d.shaders?d.shaders(h):d.shaders;return new k(e,h.vertexShader,
h.fragmentShader,d.attributes)}Object.defineProperty(f,"__esModule",{value:!0});f.glslifyDefineMap=function(e){var d="",h;for(h in e){var c=e[h];if("boolean"===typeof c)c&&(d+="#define "+h+"\n");else if("number"===typeof c)d+="#define "+h+" "+c.toFixed()+"\n";else if("object"===typeof c){var b=c.options,a=0,g;for(g in b)d+="#define "+b[g]+" "+(a++).toFixed()+"\n";d+="#define "+h+" "+b[c.value]+"\n"}}return d};m=function(){function g(d){this._programCacheByTemplate=new Map;this._rctx=d}g.prototype.dispose=
function(){this._programCacheByTemplate.forEach(function(d){d.programs.forEach(function(d){d.dispose()})});this._programCacheByTemplate=null};g.prototype.getProgram=function(d,h){var c=this;this._programCacheByTemplate.has(d)||this.addProgramTemplate(d,function(b){return e(c._rctx,d,b)});return this.getProgramTemplateInstance(d,h)};g.prototype.addProgramTemplate=function(d,e){this._programCacheByTemplate.set(d,{constructor:e,programs:new Map})};g.prototype.getProgramTemplateInstance=function(d,e){if(d=
this._programCacheByTemplate.get(d)){var c=e?JSON.stringify(e):"default";d.programs.has(c)||(e=d.constructor(e),d.programs.set(c,e));return d.programs.get(c)}return null};return g}();f.ProgramCache=m;f.createProgram=e})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(m,f,k,e,g,d){function h(a,d){if(!a)return null;var e=a.length/2,h=
c*e,e=Array(e),g=0;d=1===d;for(var l=0;l<a.length;l+=2){var k=(a[l]+a[l+1])/2;d?e[g++]=Math.min(h,1-(1-k)*b):e[g++]=Math.min(h,k*b)}return e}Object.defineProperty(f,"__esModule",{value:!0});f.generateStrokesTexture=function(a){for(var b=f.strokesDefinition.resolution,c=b/2,k=new Uint8Array(4*b*b),q=4*b*c,c=f.strokesDefinition.amplitude,m=2*c,t=4*b,w=e.log2(b)+1,u=f.strokesDefinition.strokes.length,x=(w-1)*u*t,v=0,z=f.strokesDefinition.strokes;v<z.length;v++){for(var y=z[v],A=y.distance,y=y.pressure,
B=x,C=0;C<w;C++){0!==C&&(A=h(A,0),y=h(y,1));for(var E=0;E<f.strokesDefinition.resolution;E++){var D=y?y[E%y.length]:1;g.packFloatRGBA((A?A[E%A.length]/m:0)+.5,k,B);g.packFloatRGBA(D,k,B+q);B+=4}B-=t*(u+1)}x+=t}a=new d(a,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:b,height:b,wrapMode:10497},k);return{resolution:b,texture:a,normalizationScale:m,amplitude:c,variants:u}};var c=.1,b=.5;f.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,
-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,
.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,
.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,
-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,
.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,
.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,
.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,
-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,
-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,
1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,
.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,
-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,
.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,
.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,
.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,
.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,
4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,
3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,
1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,
.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,
.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,
.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,
.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,
1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,
-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,
.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,
2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,
.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,
.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,
.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,
-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,
.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,
.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,
-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,
.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,
.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,
.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,
.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,
5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,
.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,
-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,
4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,
.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,
.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,
.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../support/buffer/typedArrayUtil"],function(m,f,
k,e){function g(d,e){var c=k.binaryIndexOf(d,e,!0);return-1===c?e<d[0]?0:d.length:c}Object.defineProperty(f,"__esModule",{value:!0});f.determineRequiresUberRenderer=function(d){if(0===d.length)return!1;for(var e=d[0].type,c=0;c<d.length;c++)if(e!==d[c].type)return!0;return!1};f.determineAllTransparent=function(d){if(0===d.length)return!0;for(var e=0;e<d.length;e++){var c=d[e].material;if(0<c.size*c.color[3]*c.opacity)return!1}return!0};f.cloneIndices=function(d){if(Uint16Array.from)return e.isUint16Array(d)?
Uint16Array.from(d):Uint32Array.from(d);for(var h=e.isUint16Array(d)?new Uint16Array(d.length):new Uint32Array(d.length),c=0;c<d.length;c++)h[c]=d[c];return h};f.estimateLengthAtDistance=function(d,e,c,b){return b/d*c*2*Math.tan(.5*e)};f.findLowerBoundIndex=g;f.computeEdgeCount=function(d,e,c){return d.length-g(d,e*c.minimumEdgeLength)};f.fillComponenBufferIndices=function(d,e,c,b){for(var a=0;a<d.length;a++){var h=d[a].index,g=e[a],k=e[a+1];if(b)for(;g<k;g++)c.set(b[g],h);else for(;g<k;g++)c.set(g,
h)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../lib/gl-matrix","./SphericalHarmonics"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});var g=k.vec3d.create();m=function(){function d(){this._renderLighting={main:{intensity:k.vec3d.create(),direction:k.vec3d.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=k.vec3d.create();this._oldSpecular=k.vec4d.create();this._oldDiffuse=
k.vec4d.create();this._oldAmbient=k.vec4d.create()}d.prototype.setUniforms=function(d,c){void 0===c&&(c=!1);c||d.getDefine("GROUND_NORMAL_SHADING")?d.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):d.setUniform1f("lightingFixedFactor",0);d.setUniform1f("lightingGlobalFactor",this._info.globalFactor);d.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);d.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);
d.setUniform1f("ambientBoostFactor",.4);c=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?d.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]):1===this._shOrder?(d.setUniform4f("lightingAmbientSH_R",c.r[0],c.r[1],c.r[2],c.r[3]),d.setUniform4f("lightingAmbientSH_G",c.g[0],c.g[1],c.g[2],c.g[3]),d.setUniform4f("lightingAmbientSH_B",c.b[0],c.b[1],c.b[2],c.b[3])):2===this._shOrder&&(d.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]),d.setUniform4f("lightingAmbientSH_R1",c.r[1],
c.r[2],c.r[3],c.r[4]),d.setUniform4f("lightingAmbientSH_G1",c.g[1],c.g[2],c.g[3],c.g[4]),d.setUniform4f("lightingAmbientSH_B1",c.b[1],c.b[2],c.b[3],c.b[4]),d.setUniform4f("lightingAmbientSH_R2",c.r[5],c.r[6],c.r[7],c.r[8]),d.setUniform4f("lightingAmbientSH_G2",c.g[5],c.g[6],c.g[7],c.g[8]),d.setUniform4f("lightingAmbientSH_B2",c.b[5],c.b[6],c.b[7],c.b[8]));d.setUniform3fv("lightDirection",this._oldDirection)};d.prototype.set=function(d){this._info=d;e.combineLights(d.lights,this._shOrder,this._renderLighting.main,
this._renderLighting.sphericalHarmonics);k.vec3d.negate(this._renderLighting.main.direction,this._oldDirection);d=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*d;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*d;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*d;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*d;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*d;
this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*d;this._oldDiffuse[3]=1;d=k.vec3d.set(this._oldDiffuse,g);k.vec3d.scale(d,.4*this._info.globalFactor);k.vec3d.add(this._oldAmbient,d)};Object.defineProperty(d.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});d.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return d}();f.SceneLighting=
m})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../lib/gl-matrix ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),function(m,f,k,e,g,d){function h(a){return(a+1)*(a+1)}function c(a){return e.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function b(a,b,c){var d=a[0],e=a[1];a=a[2];c=c||[];c.length=h(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*e);2<=b&&(c[4]=1.09254843059*d*e,c[5]=1.09254843059*
e*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-e*e));return c}function a(a,b){a=h(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function l(a,d){for(var e=c(d.r.length),h=0;h<a.length;h++){var l=a[h];k.vec3d.negate(l.direction,u);b(u,e,t);g.elementwiseProduct(t,x);g.scalarProduct(t,l.intensity[0],w);g.add(d.r,w);g.scalarProduct(t,l.intensity[1],w);g.add(d.g,w);g.scalarProduct(t,l.intensity[2],w);g.add(d.b,
w)}return d}function n(a,c){b(u,0,t);for(var d=0;d<a.length;d++){var e=a[d];c.r[0]+=t[0]*x[0]*e.intensity[0]*4*Math.PI;c.g[0]+=t[0]*x[0]*e.intensity[1]*4*Math.PI;c.b[0]+=t[0]*x[0]*e.intensity[2]*4*Math.PI}return c}Object.defineProperty(f,"__esModule",{value:!0});f.numberOfCoefficients=h;f.numberOfCoefficientsInBand=function(a){return 2*a+1};f.orderFromNumberOfCoefficients=c;f.computeCoefficients=b;f.initSHCoefficients=a;f.projectFillLights=l;f.projectAmbientLights=n;f.combineLights=function(b,c,e,
h){a(c,h.sh);k.vec3d.set3(0,0,0,e.intensity);var f=!1,m=p,u=q;c=r;m.length=0;u.length=0;for(var v=c.length=0;v<b.length;v++){var t=b[v];t instanceof d.MainLight&&!f?(k.vec3d.set(t.direction,e.direction),e.intensity[0]=t.intensity[0],e.intensity[1]=t.intensity[1],e.intensity[2]=t.intensity[2],e.castShadows=t.castShadows,f=!0):t instanceof d.MainLight||t instanceof d.FillLight?m.push(t):t instanceof d.AmbientLight?u.push(t):t instanceof d.SphericalHarmonicsLight&&c.push(t)}l(m,h.sh);n(u,h.sh);for(b=
0;b<c.length;b++)t=c[b],g.add(h.sh.r,t.sh.r),g.add(h.sh.g,t.sh.g),g.add(h.sh.b,t.sh.b)};var p=[],q=[],r=[],t=[0],w=[0],u=k.vec3d.create(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.dotProduct=function(k,e){for(var g=0,d=0;d<k.length;d++)g+=k[d]*e[d];return g};f.elementwiseProduct=function(k,e,g){g=g||k;g.length=
k.length;for(var d=0;d<k.length;d++)g[d]=k[d]*e[d];return g};f.scalarProduct=function(k,e,g){g=g||k;g.length=k.length;for(var d=0;d<k.length;d++)g[d]=k[d]*e;return g};f.add=function(k,e,g){g=g||k;g.length=k.length;for(var d=0;d<k.length;d++)g[d]=k[d]+e[d];return g}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/support/aaBoundingRect ../../lib/gl-matrix ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/HUDPrograms".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a,b){void 0===b&&(b=y);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var d=b;d[0]=c[0]*(a[2]-a[0])+a[0];d[1]=c[1]*(a[3]-a[1])+a[1]}else g.vec2d.set(a.anchorPos,b);return b}var u={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]};m=function(b){function c(a,c){c=b.call(this,c)||this;c._textureDirty=!1;c.params=r.copyParameters(a,
Q);"string"===typeof c.params.anchorPos&&(c.params.anchorPos=u[c.params.anchorPos]);c.bufferWriter=new K(c);return c}k(c,b);c.prototype.dispose=function(){};c.prototype.getParameterValues=function(){return r.copyParameters(this.params)};c.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&p.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.notifyDirty("matChanged")};c.prototype.getParams=function(){return this.params};
c.prototype.intersect=function(a,b,c,d,e,l,k,f){if(d.isSelection&&d.enableHUDSelection&&!h.isAllHidden(b.componentVisibilities,a.data.componentOffsets)){var q=a.data;a=this.params;e=b=1;g.mat4d.toMat3(c,F);if(f){e=f(I);b=e[0];e=e[5];f=F;l=f[0];var m=f[1],u=f[2],v=f[3],r=f[4],t=f[5],y=f[6],x=f[7],N=f[8],E=1/Math.sqrt(l*l+m*m+u*u),T=1/Math.sqrt(v*v+r*r+t*t),J=1/Math.sqrt(y*y+x*x+N*N);f[0]=l*E;f[1]=m*E;f[2]=u*E;f[3]=v*T;f[4]=r*T;f[5]=t*T;f[6]=y*J;f[7]=x*J;f[8]=N*J}f=q.getVertexAttr()[p.VertexAttrConstants.POSITION];
l=q.getVertexAttr()[p.VertexAttrConstants.SIZE];q=q.getVertexAttr()[p.VertexAttrConstants.NORMAL];p.assert(3<=f.size);m=d.point;u=d.camera;v=w(a);for(r=0;r<f.data.length/f.size;r++)t=r*f.size,g.vec3d.set3(f.data[t],f.data[t+1],f.data[t+2],A),g.mat4d.multiplyVec3(c,A,A),t=r*l.size,O[0]=l.data[t]*b,O[1]=l.data[t+1]*e,g.mat4d.multiplyVec3(u.viewMatrix,A),t=r*q.size,g.vec3d.set3(q.data[t],q.data[t+1],q.data[t+2],B),this.applyVerticalOffsetTransformation(A,B,F,u,z),u.applyProjection(A,C),-1<C[0]&&(t=Math.floor(C[0]),
x=Math.floor(C[1]),n.applyPrecomputedScaleFactorVec2(O,z.factor,O),t=t-G-(0<v[0]?O[0]*v[0]:0),y=t+O[0]+2*G,x=x-G-(0<v[1]?O[1]*v[1]:0),N=x+O[1]+2*G,a.textureIsSignedDistanceField&&(E=a.outlineSize/2,T=a.distanceFieldBoundingBox,t+=O[0]*T[0],x+=O[1]*T[1],y-=O[0]*(1-T[2]),N-=O[1]*(1-T[3]),t-=E,y+=E,x-=E,N+=E),m[0]>t&&m[0]<y&&m[1]>x&&m[1]<N&&(y=d.p0,x=d.p1,g.mat4d.multiplyVec3(g.mat4d.inverse(u.viewMatrix,M),A,D),C[0]=m[0],C[1]=m[1],u.unprojectPoint(C,A),t=g.vec3d.negate(d.getDirection(),g.vec3d.create()),
y=g.vec3d.dist(y,A)/g.vec3d.dist(y,x),k(y,t,-1,1,!0,D)))}};c.prototype.normalAndViewAngle=function(a,b,c,d){void 0===d&&(d=N);g.mat3d.multiplyVec3(b,a,d.normal);g.mat4d.multiplyVec3(c.viewInverseTransposeMatrix,d.normal);d.cosAngle=g.vec3d.dot(E,J);return d};c.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=n.precomputeScaleFactor(N.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=
0);b.screenSizePerspectiveAlignment?(a.scaleAlignment=n.precomputeScale(N.cosAngle,c,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};c.prototype.applyVerticalOffsetTransformation=function(a,b,c,d,e,h){var l=this.params;16===c.length&&(c=g.mat4d.toMat3(c,F));if(!l.verticalOffset||!l.verticalOffset.screenLength)return e&&(l.screenSizePerspective||l.screenSizePerspectiveAlignment)?
(d=this.normalAndViewAngle(b,c,d),l=g.vec3d.length(a),this.updateScaleInfo(e,d.cosAngle,l)):e&&(e.factor.scale=1,e.scaleAlignment=1),h?g.vec3d.set(a,h):a;b=this.normalAndViewAngle(b,c,d);c=g.vec3d.length(a);d=r.verticalOffsetAtDistance(d,c,l.verticalOffset,b.cosAngle,l.screenSizePerspectiveAlignment||l.screenSizePerspective);e&&this.updateScaleInfo(e,b.cosAngle,c);return g.vec3d.add(a,g.vec3d.scale(b.normal,d),h)};c.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:v}};c.prototype.getAllTextureIds=function(){return[this.params.textureId]};c.prototype.setTextureDirty=function(){this._textureDirty=!0};c.prototype.calculateRelativeScreenBounds=function(a,b,c){void 0===c&&(c=e.create());var d=this.params,h=c;void 0===h&&(h=y);g.vec2d.set(d.anchorPos,h);h[0]*=-a[0];h[1]*=-a[1];h[0]+=d.screenOffset[0]*b;h[1]+=d.screenOffset[1]*b;c[2]=c[0]+a[0];c[3]=c[1]+a[1];return c};c.prototype.calculateAnchorPosForRendering=function(a){return w(this.params,
a)};c.shouldRenderVisibilityDuringRenderPass=function(b){return b===a.MATERIAL||a.MATERIAL_HIGHLIGHT};return c}(b);c=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=r.copyParameters(b.getParams());c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?l.HUDMATERIAL2:l.HUDMATERIAL1};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};
b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};b.prototype.bindRender=function(a,b){var c=this.params,d=this.getProgram();this.bindTexture(a,d);d.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0);d.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===b.renderTransparentlyOccludedHUD?1:"notOccluded"===b.renderTransparentlyOccludedHUD?
0:.75);b=b.pixelRatio||1;d.setUniform4fv("overrideColor",c.color);d.setUniform1f("pixelRatio",b);c.textureIsSignedDistanceField&&(d.setUniform4fv("outlineColor",c.outlineColor),d.setUniform1f("outlineSize",c.outlineSize*b));c.vvSizeEnabled&&(d.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),d.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),d.setUniform3fv("vvSizeOffset",c.vvSizeOffset),d.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(d.setUniform1fv("vvColorValues",c.vvColorValues),
d.setUniform4fv("vvColorColors",c.vvColorColors));d.setUniform2fv("texScale",c.texCoordScale);d.setUniform2f("screenOffset",2*c.screenOffset[0]*b,2*c.screenOffset[1]*b);d.setUniform2fv("anchorPos",w(c));c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};b.prototype.bindProjection=function(a,b){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var c=b.cameraAboveGround?1:-1,d=this.getProgram(),
e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);r.bindVerticalOffset(e.verticalOffset,b,d);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);e.screenSizePerspective&&(r.bindScreenSizePerspective(e.screenSizePerspective,b,d,"screenSizePerspective"),r.bindScreenSizePerspective(e.screenSizePerspectiveAlignment||e.screenSizePerspective,b,d,"screenSizePerspectiveAlignment"))};b.prototype.releaseRender=
function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();r.bindView(a,b.view,c);r.bindCamPos(a,b.viewInvTransp,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return 4};return b}(c);var x=function(a){function b(b,c,d){b=a.call(this,
b,c,d)||this;b.isOcclusionSlot=!1;return b}k(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(t.occlusionPass,{verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.program=this.programRep.getProgram(t.colorPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,debugDrawBorder:!!a.debugDrawBorder})};b.prototype.getDrawMode=function(a){return this.isOcclusionSlot?0:4};b.prototype.release=function(a){a.setDepthFunction(513);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){this.bindProjection(a,b);var c=this.getProgram();a.setDepthTestEnabled(!0);a.setDepthFunction(515);this.isOcclusionSlot?(c.setUniform4f("color",
1,1,1,1),c.setUniform1f("pixelRatio",b.pixelRatio||1)):(this.bindRender(a,b),this.bindTexture(a,c))};b.prototype.bindView=function(b,c){a.prototype.bindView.call(this,b,c);b=this.getProgram();var d=this.params;this.isOcclusionSlot&&d.slicePlaneEnabled&&r.bindSlicePlane(c.origin,c.slicePlane,b)};b.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program};b.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]};b.prototype.beginSlot=
function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===l.OCCLUSION_PIXELS,a===l.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return b}(c),v=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(t.highlightPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,binaryHighlightOcclusion:a.binaryHighlightOcclusion})};b.prototype.bind=function(a,b){this.bindProjection(a,b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(c),z={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},y=[0,0],A=g.vec3d.create(),B=g.vec3d.create(),C=g.vec3d.create(),
E=g.vec3d.create(),D=g.vec3d.create(),F=g.mat3d.create(),M=g.mat4d.create(),N={normal:E,cosAngle:0},I=g.mat4d.create();g.mat4d.identity(I);var G=1,O=[0,0],J=[0,0,1],Q={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,
0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:u.center,shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},H=d.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec3f(p.VertexAttrConstants.NORMAL).vec2f(p.VertexAttrConstants.UV0).vec4u8(p.VertexAttrConstants.COLOR).vec2f(p.VertexAttrConstants.SIZE).vec4f(p.VertexAttrConstants.AUXPOS1).vec4f(p.VertexAttrConstants.AUXPOS2),
K=function(){function a(a){this.material=a;this.vertexBufferLayout=H}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[p.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d,e){c=this.material.getParameterValues();q.writePosition(b.indices[p.VertexAttrConstants.POSITION],b.vertexAttr[p.VertexAttrConstants.POSITION].data,a.transformation,d.position,e,6);q.writeNormal(b.indices[p.VertexAttrConstants.NORMAL],
b.vertexAttr[p.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,d.normal,e,6);a=b.vertexAttr[p.VertexAttrConstants.UV0].data;var h=void 0,g=void 0,l=void 0,k=void 0;null==a||4>a.length?(g=h=0,l=c.texCoordScale[0],k=c.texCoordScale[1]):(h=a[0],g=a[1],l=a[2],k=a[3]);var l=Math.min(1.99999,l+1),k=Math.min(1.99999,k+1),f=b.indices[p.VertexAttrConstants.POSITION].length,n=d.uv0;c=e;for(a=0;a<f;++a)n.set(c,0,h),n.set(c,1,g),c+=1,n.set(c,0,l),n.set(c,1,g),c+=1,n.set(c,0,l),n.set(c,1,k),c+=1,n.set(c,
0,l),n.set(c,1,k),c+=1,n.set(c,0,h),n.set(c,1,k),c+=1,n.set(c,0,h),n.set(c,1,g),c+=1;q.writeColor(b.indices[p.VertexAttrConstants.COLOR],b.vertexAttr[p.VertexAttrConstants.COLOR].data,4,d.color,e,6);h=b.indices[p.VertexAttrConstants.SIZE];g=b.vertexAttr[p.VertexAttrConstants.SIZE].data;l=h.length;k=d.size;c=e;for(a=0;a<l;++a)for(var f=g[2*h[a]],n=g[2*h[a]+1],m=0;6>m;++m)k.set(c,0,f),k.set(c,1,n),c+=1;b.indices[p.VertexAttrConstants.AUXPOS1]&&b.vertexAttr[p.VertexAttrConstants.AUXPOS1]&&q.writeBufferVec4(b.indices[p.VertexAttrConstants.AUXPOS1],
b.vertexAttr[p.VertexAttrConstants.AUXPOS1].data,d.auxpos1,e,6);b.indices[p.VertexAttrConstants.AUXPOS2]&&b.vertexAttr[p.VertexAttrConstants.AUXPOS2]&&q.writeBufferVec4(b.indices[p.VertexAttrConstants.AUXPOS2],b.vertexAttr[p.VertexAttrConstants.AUXPOS2].data,d.auxpos2,e,6)};return a}();return m})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./GLMaterial","../materials/internal/MaterialUtil"],function(m,f,k,e,
g){return function(d){function e(c,b,a,e,h){void 0===h&&(h=!1);c=d.call(this,c,b)||this;c.textureRep=a;c.textureId=e;c.initTransparent=h;c.glTextureRef=g.aquireIfNotUndefined(c.textureId,a,c.initTransparent);return c}k(e,d);e.prototype.dispose=function(){g.releaseIfNotUndefined(this.textureId,this.textureRep)};e.prototype.updateTexture=function(c){c!==this.textureId&&(g.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=c,this.glTextureRef=g.aquireIfNotUndefined(this.textureId,this.textureRep,
this.initTransparent))};e.prototype.renderTexture=function(c){(c=this.textureRep.getTexture(this.textureId))&&c.dirty&&c.redraw&&c.redraw()};e.prototype.bindTexture=function(c,b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),c.bindTexture(this.glTextureRef.getGLTexture()))};e.prototype.bindTextureSize=function(c,b){null!=this.glTextureRef&&(c=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",c.descriptor.width,c.descriptor.height))};return e}(e)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require",
"exports"],function(m,f){return function(){function k(e,g){this.material=e;this.programRep=g}k.prototype.dispose=function(){};Object.defineProperty(k.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0});
k.prototype.isVisible=function(){return this.material.isVisible()};k.prototype.getPrograms=function(){return[this.getProgram()]};return k}()})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen","./ModelContentType"],function(m,f,k,e){return function(){function g(d){this.supportsEdges=!1;this._parentStage=null;this._visible=!0;this._renderOccluded=!1;this._renderPriority=0;this.id=g._idGen.gen(d)}Object.defineProperty(g.prototype,"parentStage",{get:function(){return this._parentStage},
enumerable:!0,configurable:!0});g.prototype.addParentStage=function(d){this._parentStage=d};g.prototype.removeParentStage=function(d){this._parentStage=null};Object.defineProperty(g.prototype,"visible",{get:function(){return this._visible},set:function(d){d!==this._visible&&(this._visible=d,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(d){d!==this._renderOccluded&&(this._renderOccluded=
d,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(d){d!==this._renderPriority&&(this._renderPriority=d,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});g.prototype.isVisible=function(){return this._visible};g.prototype.notifyDirty=function(d){this.parentStage&&this.parentStage.notifyDirty(e.MATERIAL,this,d)};g._idGen=new k;return g}()})},"esri/views/3d/webgl-engine/materials/internal/bufferWriters":function(){define(["require",
"exports","../../../support/buffer/BufferView","../../lib/Util"],function(m,f,k,e){function g(a,b,c,d,e){var h=c.typedBuffer;c=c.typedBufferStride;var g=a.length;d*=c;if(null==e||1===e)for(var l=0;l<g;++l){var k=2*a[l];h[d]=b[k];h[d+1]=b[k+1];d+=c}else for(l=0;l<g;++l)for(var k=2*a[l],f=0;f<e;++f)h[d]=b[k],h[d+1]=b[k+1],d+=c}function d(a,b,c,d,e){var h=c.typedBuffer;c=c.typedBufferStride;var g=a.length;d*=c;if(null==e||1===e)for(var l=0;l<g;++l){var k=3*a[l];h[d]=b[k];h[d+1]=b[k+1];h[d+2]=b[k+2];
d+=c}else for(l=0;l<g;++l)for(var k=3*a[l],f=0;f<e;++f)h[d]=b[k],h[d+1]=b[k+1],h[d+2]=b[k+2],d+=c}function h(a,b,c,d,e){var h=c.typedBuffer;c=c.typedBufferStride;var g=a.length;d*=c;if(null==e||1===e)for(var l=0;l<g;++l){var k=4*a[l];h[d]=b[k];h[d+1]=b[k+1];h[d+2]=b[k+2];h[d+3]=b[k+3];d+=c}else for(l=0;l<g;++l)for(var k=4*a[l],f=0;f<e;++f)h[d]=b[k],h[d+1]=b[k+1],h[d+2]=b[k+2],h[d+3]=b[k+3],d+=c}function c(a,b,c,e,h,g){if(c){var l=e.typedBuffer;e=e.typedBufferStride;var k=a.length;h*=e;if(null==g||
1===g)for(var f=0;f<k;++f){var n=3*a[f],p=b[n],q=b[n+1],m=b[n+2];l[h]=c[0]*p+c[4]*q+c[8]*m+c[12];l[h+1]=c[1]*p+c[5]*q+c[9]*m+c[13];l[h+2]=c[2]*p+c[6]*q+c[10]*m+c[14];h+=e}else for(f=0;f<k;++f)for(var n=3*a[f],p=b[n],q=b[n+1],m=b[n+2],n=c[0]*p+c[4]*q+c[8]*m+c[12],r=c[1]*p+c[5]*q+c[9]*m+c[13],p=c[2]*p+c[6]*q+c[10]*m+c[14],q=0;q<g;++q)l[h]=n,l[h+1]=r,l[h+2]=p,h+=e}else d(a,b,e,h,g)}function b(a,b,c,e,h,g){if(c){var l=e.typedBuffer;e=e.typedBufferStride;var k=a.length;h*=e;if(null==g||1===g)for(var f=
0;f<k;++f){var n=3*a[f],p=b[n],q=b[n+1],m=b[n+2];l[h]=c[0]*p+c[4]*q+c[8]*m;l[h+1]=c[1]*p+c[5]*q+c[9]*m;l[h+2]=c[2]*p+c[6]*q+c[10]*m;h+=e}else for(f=0;f<k;++f)for(var n=3*a[f],p=b[n],q=b[n+1],m=b[n+2],n=c[0]*p+c[4]*q+c[8]*m,r=c[1]*p+c[5]*q+c[9]*m,p=c[2]*p+c[6]*q+c[10]*m,q=0;q<g;++q)l[h]=n,l[h+1]=r,l[h+2]=p,h+=e}else d(a,b,e,h,g)}function a(a,b,c,d,e,h){var g=d.typedBuffer;d=d.typedBufferStride;var l=a.length;e*=d;if(null==h||1===h)if(4===c)for(c=0;c<l;++c){var k=4*a[c];g[e]=b[k];g[e+1]=b[k+1];g[e+
2]=b[k+2];g[e+3]=b[k+3];e+=d}else{if(3===c)for(c=0;c<l;++c)k=3*a[c],g[e]=b[k],g[e+1]=b[k+1],g[e+2]=b[k+2],g[e+3]=255,e+=d}else if(4===c)for(c=0;c<l;++c)for(var k=4*a[c],f=0;f<h;++f)g[e]=b[k],g[e+1]=b[k+1],g[e+2]=b[k+2],g[e+3]=b[k+3],e+=d;else if(3===c)for(c=0;c<l;++c)for(k=3*a[c],f=0;f<h;++f)g[e]=b[k],g[e+1]=b[k+1],g[e+2]=b[k+2],g[e+3]=255,e+=d}function l(a,b,c,d,e,h,g){var l=e.typedBuffer;e=e.typedBufferStride;var k=a.length;h*=e;if(null==g||1===g)if(4===c)for(c=0;c<k;++c){var f=4*a[c];l[h]=b[f]*
d[0];l[h+1]=b[f+1]*d[1];l[h+2]=b[f+2]*d[2];l[h+3]=b[f+3]*d[3];h+=e}else{if(3===c){var n=255*d[3];for(c=0;c<k;++c)f=3*a[c],l[h]=b[f]*d[0],l[h+1]=b[f+1]*d[1],l[h+2]=b[f+2]*d[2],l[h+3]=n,h+=e}}else if(4===c)for(c=0;c<k;++c)for(var f=4*a[c],p=0;p<g;++p)l[h]=b[f]*d[0],l[h+1]=b[f+1]*d[1],l[h+2]=b[f+2]*d[2],l[h+3]=b[f+3]*d[3],h+=e;else if(3===c)for(n=255*d[3],c=0;c<k;++c)for(f=3*a[c],p=0;p<g;++p)l[h]=b[f]*d[0],l[h+1]=b[f+1]*d[1],l[h+2]=b[f+2]*d[2],l[h+3]=n,h+=e}Object.defineProperty(f,"__esModule",{value:!0});
f.writeBufferVec2=g;f.writeBufferVec3=d;f.writeBufferVec4=h;f.writePosition=c;f.writeNormal=b;f.writeColor=a;f.writeMultipliedColor=l;f.writeDefaultAttributes=function(d,f,q,m,t,w,u){var n=0;for(q=q.fieldNames;n<q.length;n++){var p=q[n],r=d.vertexAttr[p],y=d.indices[p];if(r&&y)switch(p){case e.VertexAttrConstants.POSITION:e.assert(3===r.size);(p=w.getField(p,k.BufferViewVec3f))&&c(y,r.data,m,p,u);break;case e.VertexAttrConstants.NORMAL:e.assert(3===r.size);(p=w.getField(p,k.BufferViewVec3f))&&b(y,
r.data,t,p,u);break;case e.VertexAttrConstants.UV0:e.assert(2===r.size);(p=w.getField(p,k.BufferViewVec2f))&&g(y,r.data,p,u);break;case e.VertexAttrConstants.REGION:e.assert(4===r.size);(p=w.getField(p,k.BufferViewVec4u16))&&h(y,r.data,p,u);break;case e.VertexAttrConstants.COLOR:e.assert(3===r.size||4===r.size);(p=w.getField(p,k.BufferViewVec4u8))&&(f&&f.color?l(y,r.data,r.size,f.color,p,u):a(y,r.data,r.size,p,u));break;case e.VertexAttrConstants.SYMBOLCOLOR:e.assert(3===r.size||4===r.size),(p=w.getField(p,
k.BufferViewVec4u8))&&a(y,r.data,r.size,p,u)}}}})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){return g.glslifyDefineMap({OCCL_TEST:d.occlTest,SIGNED_DISTANCE_FIELD:d.sdf,VV_SIZE:d.vvSize,VV_COLOR:d.vvColor,VERTICAL_OFFSET:d.verticalOffset,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,
CENTER_OFFSET_UNITS_SCREEN:d.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:d.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:d.binaryHighlightOcclusion})};f.colorPass={name:"hud-color",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/hud/hud.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/hud/colorPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"hud-highlight",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/hud/hud.vert"),fragmentShader:d(h)+
e.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:k.Default3D};f.occlusionPass={name:"hud-occlusion",shaders:function(d){return{vertexShader:g.glslifyDefineMap({VERTICAL_OFFSET:d.verticalOffset,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:d.centerOffsetUnitsScreen,SLICE:d.slice})+e.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:e.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:k.Default3D}})},"esri/views/webgl/Profiling":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.startMeasurement=function(e){return(e=e.capabilities.disjointTimerQuery)?new k(e):null};f.getTimestamp=function(e,g,d){void 0===d&&(d=50);var h=e.capabilities.disjointTimerQuery;if(!h||0>=h.timestampBits())return null;var c=h.createQuery();h.createTimestamp(c);var b=function(){var a=h.resultAvailable(c),e=h.disjoint();a&&!e?(a=h.getResult(c),g(a/1E6)):e?g():setTimeout(b,d)};b()};f.supportsTimestamps=function(e){e=e.capabilities.disjointTimerQuery;
if(!e)return!1;e=e.timestampBits();console.log({bits:e});return 0<e};var k=function(){function e(e){this.timer=e;this.query=e.createQuery();this.timer.beginTimeElapsed(this.query)}e.prototype.stop=function(e,d){void 0===d&&(d=50);this.cb=e;this.checkInterval=d;this.timer.endTimeElapsed();this.checkQueryResult()};e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),d=this.timer.disjoint();e&&!d?(e=this.timer.getResult(this.query),this.cb(e/1E6)):d?this.cb():setTimeout(this.checkQueryResult.bind(this),
this.checkInterval)};return e}()})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports"],function(m,f){var k={origin:[0,0,0],basis1:[0,0,0],basis2:[0,0,0]};return function(){function e(){this._worldPlane=k}Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e?e:k},enumerable:!0,configurable:!0});return e}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports ../../../lib/gl-matrix ../../lib/RenderSlot ./MaterialUtil ../../shaders/MiscPrograms".split(" "),
function(m,f,k,e,g,d){var h=k.vec4d.createFrom(1,1,1,1);return function(){function c(b,a,c,e,h){this.program=b.getProgram(d.texOnly);this.color=c;this.depthFunc=h;this.blend=e;this.texGLName=a}c.prototype.beginSlot=function(b){return b===e.INTERNAL_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.setColor=function(b){this.color=b};c.prototype.bind=function(b,a){b.bindProgram(this.program);this.program.setUniformMatrix4fv("model",g.IDENTITY);this.program.setUniformMatrix4fv("proj",
a.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:h);this.program.setUniform1i("tex",0);b.bindTexture(this.texGLName,0);this.blend&&(b.setBlendingEnabled(!0),b.setBlendFunctionSeparate(b.gl.SRC_ALPHA,b.gl.ONE_MINUS_SRC_ALPHA,b.gl.ONE,b.gl.ONE_MINUS_SRC_ALPHA));b.setDepthTestEnabled(!0);void 0!==this.depthFunc&&b.setDepthFunction(this.depthFunc)};c.prototype.release=function(b){void 0!==this.depthFunc&&b.setDepthFunction(513);this.blend&&b.setBlendingEnabled(!1)};c.prototype.bindView=
function(b,a){g.bindView(a.origin,a.view,this.program)};c.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};c.prototype.getDrawMode=function(b){return b.gl.TRIANGLES};return c}()})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.blendLayers={name:"blend-layers",shaders:{vertexShader:e.resolveIncludes("misc/blendLayers.vert"),
fragmentShader:e.resolveIncludes("misc/blendLayers.frag")},attributes:k.Default3D};f.simple={name:"simple",shaders:{vertexShader:e.resolveIncludes("misc/simple.vert"),fragmentShader:e.resolveIncludes("misc/simple.frag")},attributes:k.Default3D};f.texOnly={name:"tex-only",shaders:{vertexShader:e.resolveIncludes("misc/texOnly.vert"),fragmentShader:e.resolveIncludes("misc/texOnly.frag")},attributes:k.Default3D};f.showDepth={name:"show-depth",shaders:{vertexShader:e.resolveIncludes("misc/showDepth.vert"),
fragmentShader:e.resolveIncludes("misc/showDepth.frag")},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(m,f,k){var e=function(){function e(d){this.refCnt=0;this.glMaterial=d}e.prototype.incRefCnt=function(){++this.refCnt};e.prototype.decRefCnt=function(){--this.refCnt;k.assert(0<=this.refCnt)};e.prototype.getRefCnt=function(){return this.refCnt};e.prototype.getGLMaterial=function(){return this.glMaterial};return e}();
return function(){function g(d,e){this.textureRep=d;this.programRep=e;this.id2glMaterialRef={}}g.prototype.aquire=function(d){return this.aquireExt(d,"color")};g.prototype.aquireDepthShadowMap=function(d){return this.aquireExt(d,"depthShadowMap")};g.prototype.aquireDepth=function(d){return this.aquireExt(d,"depth")};g.prototype.aquireNormal=function(d){return this.aquireExt(d,"normal")};g.prototype.aquireHighlight=function(d){return this.aquireExt(d,"highlight")};g.prototype.aquireExt=function(d,
h){var c=d.id+"_"+h,b=this.id2glMaterialRef[c];null==b?(d=(b=d.getGLMaterials()[h])?new b(d,this.programRep,this.textureRep):void 0,b=new e(d),this.id2glMaterialRef[c]=b):d=b.getGLMaterial();b.incRefCnt();d&&this.increaseProgramReferences(d);return d};g.prototype.release=function(d){this.releaseExt(d,"color")};g.prototype.releaseDepth=function(d){this.releaseExt(d,"depth")};g.prototype.releaseNormal=function(d){this.releaseExt(d,"normal")};g.prototype.releaseDepthShadowMap=function(d){this.releaseExt(d,
"depthShadowMap")};g.prototype.releaseHighlight=function(d){this.releaseExt(d,"highlight")};g.prototype.releaseExt=function(d,e){d=d+"_"+e;e=this.id2glMaterialRef[d];e.decRefCnt();if(0===e.getRefCnt()){if(e=e.getGLMaterial())this.decreaseProgramReferences(e),e.dispose();delete this.id2glMaterialRef[d]}};g.prototype.updateMaterialParameters=function(d){var e=this.id2glMaterialRef[d+"_color"];e&&e.getGLMaterial()&&this.updateParamsForMat(e.getGLMaterial());(e=this.id2glMaterialRef[d+"_depth"])&&e.getGLMaterial()&&
this.updateParamsForMat(e.getGLMaterial());(e=this.id2glMaterialRef[d+"_depthShadowMap"])&&e.getGLMaterial()&&this.updateParamsForMat(e.getGLMaterial());(e=this.id2glMaterialRef[d+"_normal"])&&e.getGLMaterial()&&this.updateParamsForMat(e.getGLMaterial());(d=this.id2glMaterialRef[d+"_highlight"])&&d.getGLMaterial()&&this.updateParamsForMat(d.getGLMaterial())};g.prototype.updateParamsForMat=function(d){d.updateParameters&&(this.decreaseProgramReferences(d),d.updateParameters(),this.increaseProgramReferences(d))};
g.prototype.increaseProgramReferences=function(d){d=d.getPrograms();for(var e=this.programRep,c=0;c<d.length;c++)e.increaseRefCount(d[c])};g.prototype.decreaseProgramReferences=function(d){d=d.getPrograms();for(var e=this.programRep,c=0;c<d.length;c++)e.decreaseRefCount(d[c])};return g}()})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(m,f,k,e,g){var d=k.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),
h=function(){function c(b){this._glTexture=null;this._refCount=0;this._glTexture=b}c.prototype.incRefCnt=function(){++this._refCount};c.prototype.decRefCnt=function(){--this._refCount;e.assert(0<=this._refCount)};c.prototype.getRefCnt=function(){return this._refCount};c.prototype.setGLTexture=function(b){this._glTexture=b};c.prototype.getGLTexture=function(){return this._glTexture};return c}();return function(){function c(b,a,c,d){this.NUM_PARALLEL=8;this.textures=b;this._programRepository=a;this.getViewportToRestore=
c;this._rctx=d;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=d.capabilities.textureFilterAnisotropic)?d.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(b=0;b<this._fallbackTextureData.length;++b)this._fallbackTextureData[b]=255,this._fallbackTextureTransparentData[b]=
0!==(b+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}c.prototype.resetNeedsRender=function(){this._needsRender=!1};c.prototype.needsRender=function(){return this._needsRender};c.prototype.aquire=function(b,a,c){var l=this,k=this.id2textureRef[b];if(null==k){var f=this.textures[b];e.assert(void 0!==f);f.setUnloadFunc(this._unload.bind(this));a=!0===a;var m=this._createGLTextureDescription(f),k=new h(null);e.assert(null==
this.id2textureRef[b]);this.id2textureRef[b]=k;if(f.initializeThroughRender)b=f.initializeThroughRender(this._rctx,m),k.setGLTexture(b),c&&c(k);else if(f.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(b,m,c):this._queue.push([b,m,c]);else try{f.initializeThroughUpload(this._rctx,m,this._programRepository,this.getViewportToRestore(),function(a){k.setGLTexture(a);l._needsRender=!0;c&&c(k)})}catch(t){d.error("#aquire","Error loading texture: "+t.toString())}null==k.getGLTexture()&&
k.setGLTexture(a?new g(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new g(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));this._needsRender=!0}k.incRefCnt();return k};c.prototype.release=function(b){b=this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),e.assert(0<=b.getRefCnt()))};c.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};c.prototype.getTexture=function(b){return this.textures[b]};c.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};
c.prototype._unload=function(b){var a=this.id2textureRef[b];void 0!==a&&((a=a.getGLTexture())&&a.dispose(),delete this.id2textureRef[b]);this.next(b)};c.prototype._createGLTextureDescription=function(b){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&b.params&&b.params.mipmap&&!b.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:b.params&&b.params.wrapClamp?33071:void 0}};c.prototype.next=function(b){if(b in this.loading){delete this.loading[b];var a=Object.keys(this.id2textureRef),
c=Object.keys(this.loading);this.listeners.forEach(function(d){d(b,a,c)});this.processQueue()}};c.prototype._loadImage=function(b,a,c){var d=this;e.assert(null==this.loading[b]);this.loading[b]=!0;var h=this.textures[b];e.assert(void 0!==h);setTimeout(function(){var e=d.id2textureRef[b];e&&e.getRefCnt()&&h.initializeThroughUpload(d._rctx,a,d._programRepository,d.getViewportToRestore(),function(a){d.next(b);d._needsRender=!0;e&&e.getRefCnt()&&(e.setGLTexture(a),c&&c(e))})},0)};c.prototype.processQueue=
function(){for(var b=[],a=0;a<this._queue.length;++a){var c=this._queue[a][0],d=this.id2textureRef[c];void 0!==d&&(0===d.getRefCnt()?(d.getGLTexture().dispose(),delete this.id2textureRef[c]):b.push(this._queue[a]))}this._queue=b;b=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(a=0;a<b;++a)this._loadImage(this._queue[a][0],this._queue[a][1],this._queue[a][2]);this._queue.splice(0,b)};return c}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require",
"exports","./Util","../../../webgl/programUtils"],function(m,f,k,e){return function(){function g(d){this._programCacheByTemplate=new Map;this._globalOptions={viewingMode:"global"};this._rctx=d;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}Object.defineProperty(g.prototype,"globalOptions",{get:function(){return this._globalOptions},enumerable:!0,configurable:!0});g.prototype.dispose=
function(){this._programCacheByTemplate.forEach(function(d){d.programs.forEach(function(d){d.dispose()})});this._programRefCount=this._programCacheByTemplate=null};g.prototype.getProgram=function(d,h){var c=this;this._programCacheByTemplate.has(d)||this.addProgramTemplate(d,function(b){return e.createProgram(c._rctx,d,b)});return this.getProgramTemplateInstance(d,h)};g.prototype.addProgramTemplate=function(d,e){this._programCacheByTemplate.set(d,{constructor:e,programs:new Map})};g.prototype.getProgramTemplateInstance=
function(d,e){if(d=this._programCacheByTemplate.get(d)){var c=e?JSON.stringify(e):"default";d.programs.has(c)||(e=d.constructor(e),d.programs.set(c,e));return d.programs.get(c)}return null};g.prototype.getProgramsUsingUniform=function(d){return this._commonUniforms[d]||[]};g.prototype.increaseRefCount=function(d){var e=d.id;this._programRefCount[e]?this._programRefCount[e]++:(this._programRefCount[e]=1,this._findCommonUniforms(d))};g.prototype.decreaseRefCount=function(d){var e=d.id;1<this._programRefCount[e]?
this._programRefCount[e]--:(this._forgetCommonUniforms(d),this._programRefCount[e]=0)};g.prototype._findCommonUniforms=function(d){for(var e in this._commonUniforms)d.hasUniform(e)&&(k.assert(-1===this._commonUniforms[e].indexOf(d),"common uniforms of program have already been determined"),this._commonUniforms[e].push(d))};g.prototype._forgetCommonUniforms=function(d){for(var e in this._commonUniforms){var c=this._commonUniforms[e],b=c.indexOf(d);-1<b&&(c[b]=c[c.length-1],c.pop())}};return g}()})},
"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});var g=null,d=[];f.enabled=!1;f.begin=function(){f.enabled&&(g=[])};f.trace=function(d){f.enabled&&null!=g&&g.push(d)};f.end=function(){if(f.enabled){var e=g;g=null;e&&(d.forEach(function(c){return c(e)}),d.length=0);return e}};f.instrumentContext=function(d){return f.enabled?e.default(d)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),
d):k.makeDebugContext(d,void 0,function(c,b){f.enabled&&g&&g.push("gl."+c+"("+k.glFunctionArgsToString(c,b)+")")}):d};f.request=function(e){d.push(e)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function m(c){if(null==b){b={};a={};for(var d in c)"number"==typeof c[d]&&(b[c[d]]=d,a[d]=c[d])}}function f(){if(null==b)throw"WebGLDebugUtils.init(ctx) not called";}function k(a){f();var c=b[a];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function e(b,
d,e,h){b=c[b];if(void 0!==b&&(b=b[d],void 0!==b&&b[e])){if("object"===typeof b[e]&&void 0!==b[e].enumBitwiseOr){d=b[e].enumBitwiseOr;e=0;b=[];for(var g=0;g<d.length;++g){var l=a[d[g]];0!==(h&l)&&(e|=l,b.push(k(l)))}return e===h?b.join(" | "):k(h)}return k(h)}return null===h?"null":void 0===h?"undefined":h.toString()}function g(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function d(a,b,c,h){function l(a,d){return function(){c&&c(d,arguments);var e=
a[d].apply(a,arguments),g=h.getError();0!=g&&(f[g]=!0,b(g,d,arguments));return e}}h=h||a;m(a);b=b||function(a,b,c){for(var d="",h=c.length,g=0;g<h;++g)d+=(0==g?"":", ")+e(b,h,g,c[g]);a="WebGL error "+k(a)+" in "+b+"("+d+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var f={},n={},p;for(p in a)if("function"==typeof a[p])if("getExtension"!=p)n[p]=l(a,p);else{var q=l(a,p);n[p]=function(){var e=q.apply(a,arguments);return d(e,
b,c,h)}}else g(n,a,p);n.getError=function(){for(var b in f)if(f.hasOwnProperty(b)&&f[b])return f[b]=!1,b;return a.NO_ERROR};return n}function h(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),
a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);
a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);
a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var c={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},
vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},
bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},
depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},b=null,a=null;return{init:m,mightBeEnum:function(a){f();
return void 0!==b[a]},glEnumToString:k,glFunctionArgToString:e,glFunctionArgsToString:function(a,b){for(var c="",d=b.length,h=0;h<d;++h)c+=(0==h?"":", ")+e(a,d,h,b[h]);return c},makeDebugContext:d,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=Object.keys(M),b=0;b<a.length;++b)delete M[a]}function d(){++E;A||C==E&&a.loseContext()}function e(a,b){var c=a[b];return function(){d();if(!A)return c.apply(a,arguments)}}
function l(a){return{statusMessage:a,preventDefault:function(){D=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?m[b]=e(a,b):g(m,a,b);m.getError=function(){d();if(!A)for(var a;a=f.getError();)M[a]=!0;for(a in M)if(M[a])return delete M[a],a;return m.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var h=c[b];m[h]=function(b){return function(){d();if(A)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=
y;B.push(c);return c}}(a[h])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(b=0;b<c.length;++b)h=c[b],m[h]=function(b){return function(){d();return A?null:b.apply(a,arguments)}}(m[h]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");
for(b=0;b<c.length;++b)h=c[b],m[h]=function(b){return function(){d();return A?!1:b.apply(a,arguments)}}(m[h]);m.checkFramebufferStatus=function(b){return function(){d();return A?m.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(m.checkFramebufferStatus);m.getAttribLocation=function(b){return function(){d();return A?-1:b.apply(a,arguments)}}(m.getAttribLocation);m.getVertexAttribOffset=function(b){return function(){d();return A?0:b.apply(a,arguments)}}(m.getVertexAttribOffset);m.isContextLost=function(){return A};
return m}var f,m,v=[],z=[];m={};var y=1,A=!1,B=[],C=0,E=0,D=!1,F=0,M={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=f){if(f)throw"got different context";f=c;m=k(f)}return m}return c}}(a.getContext);(function(a){var c=a.addEventListener;a.addEventListener=function(d,e,h){switch(d){case "webglcontextlost":v.push(b(e));break;case "webglcontextrestored":z.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!A){A=
!0;C=0;for(++y;f.getError(););c();M[f.CONTEXT_LOST_WEBGL]=!0;var b=l("context lost"),d=v.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=F&&setTimeout(function(){a.restoreContext()},F)},0)}};a.restoreContext=function(){A&&z.length&&setTimeout(function(){if(!D)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var a=0;a<B.length;++a){var b=B[a];b instanceof WebGLBuffer?f.deleteBuffer(b):b instanceof WebGLFramebuffer?f.deleteFramebuffer(b):b instanceof
WebGLProgram?f.deleteProgram(b):b instanceof WebGLRenderbuffer?f.deleteRenderbuffer(b):b instanceof WebGLShader?f.deleteShader(b):b instanceof WebGLTexture&&f.deleteTexture(b)}h(f);A=!1;E=0;D=!1;for(var a=z.slice(),b=l("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(A)throw"You can not ask a lost contet to be lost";C=E+a};a.getNumCalls=function(){return E};a.setRestoreTimeout=function(a){F=a};return a},resetToInitialState:h}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.default=function(k){return window.WebGL2RenderingContext&&k instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports ../../../../core/has ../../lib/gl-matrix ../lib/Camera ../lib/PerformanceTimer ./Visualizer".split(" "),function(m,f,k,e,g,d,h){var c={fbo:null,lightDirection:null,camera:null,pixelRatio:1};return function(){function b(a,b,c,d,k){this._content=
new Map;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=k;this._gl=k.gl;this._visualizer=new h(a,b,c,d,this._rctx);this._camera=new g(e.vec3.createFrom(0,100,-100),e.vec3.createFrom(0,0,0))}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0});b.prototype.getCombinedStats=function(){var a={},b=this._visualizer.getCombinedStats(),
c;for(c in b)a[c]=b[c];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=this._gl.getUsedTextureMemoryStats(),
d;for(d in b)a["texMem type: "+d]=b[d]}return a};b.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};b.prototype.setLighting=function(a){this._visualizer.setLighting(a)};b.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};b.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};b.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()};b.prototype.modify=function(a,b,c,d){this._visualizer.modify(a,b,c,d);
this._content=this._visualizer.getContent()};b.prototype.getContent=function(){return this._content};b.prototype.setCamera=function(a){this._camera.copyFrom(a);this._needsRender=!0};b.prototype.getCamera=function(){return this._camera};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0});b.prototype.getFramebufferTexture=function(a){return this._visualizer.getFramebufferTexture(a)};b.prototype.render=function(a){c.camera=
a.camera||this._camera;c.fbo=a.fbo;c.lightDirection=a.lightDirection;c.pixelRatio=a.pixelRatio||1;this._visualizer.render(c)};b.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};return b}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Performance"],function(m,f,k){return function(){function e(e){this._filterSampleIndex=
0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(e);this.reset();this._filterSize=e}e.prototype.reset=function(){for(var e=this._filterSampleIndex=0;e<this._filterSize;e++)this._filterSamples[e]=NaN};e.prototype.start=function(){this._tsStart=k.now()};e.prototype.stop=function(){this._lastTime=k.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=
(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};e.prototype.getLast=function(){return this._lastTime};e.prototype.getLastFiltered=function(){for(var e=0,d=0;d<this._filterSamples.length;d++)e+=this._filterSamples[d];return e/this._filterSamples.length};e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};e.prototype.getTotal=function(){return this._totalTime};e.prototype.getNumMeasurements=function(){return this._numMeasurements};return e}()})},"esri/views/3d/webgl-engine/lib/Performance":function(){define(["require",
"exports","../../../../core/now"],function(m,f,k){return{now:k}})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../../../../core/TimeProfiler ../../lib/gl-matrix ../../support/debugFlags ../lib/depthRange ../lib/depthRangeUtils ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/Renderer ../lib/RenderOccludedHelper ../lib/RenderPass ../lib/ShadowMap ../lib/SliceHelper ../lib/SSAOHelper ../lib/Util".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){var w=
t.assert;return function(){function f(d,e,h,g,k){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content=new Map;this._stage=d;this._rctx=k;this._renderer=new a(e,h,g,this._rctx,!1);this._programRep=e;this._helpers={shadowMap:new p(e,this._rctx),ssao:new r(e,this._rctx,this.setNeedsRender.bind(this)),highlight:new c(e,this._rctx),renderOccluded:new l(e,this._rctx),slice:new q,offscreenRendering:new b(e,this._rctx)}}Object.defineProperty(f.prototype,"isLoadingResources",
{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});f.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};f.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.enabled=!1;this._helpers.shadowMap.dispose();this._helpers.ssao.enabled=!1;this._helpers.ssao.dispose();this._helpers.highlight.enabled=!1;this._helpers.renderOccluded.enabled=!1;this._helpers.offscreenRendering.enabled=!1};f.prototype.setLighting=function(a){this._renderer.setLighting(a)};
f.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._helpers.shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=a.shadowMapMaxCascades);this._helpers.highlight.enabled=!0;void 0!==a.ssao&&(this._helpers.ssao.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._helpers.ssao.attenuation=a.ssaoAttenuation);
void 0!==a.ssaoRadius&&(this._helpers.ssao.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._helpers.ssao.samples=a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._renderer.ssaoEnabled=this._helpers.ssao.enabled;void 0!==a.offscreenRendering&&
(this._helpers.offscreenRendering.enabled=a.offscreenRendering);a.background&&(this._helpers.offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);void 0!==a.slicePlane&&(this._helpers.slice.plane=
a.slicePlane);this._needsRender=!0};f.prototype.getRenderParams=function(){var a={};a.shadowMap=this._helpers.shadowMap.enabled;a.shadowMapResolution=this._helpers.shadowMap.textureResolution;a.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades;this._helpers.ssao.isSupported&&(a.ssao=this._helpers.ssao.enabled,a.ssaoAttenuation=this._helpers.ssao.attenuation,a.ssaoRadius=this._helpers.ssao.radius,a.ssaoFilterRadius=this._helpers.ssao.filterRadius,a.ssaoSamples=this._helpers.ssao.samples);return a};
f.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._helpers.offscreenRendering.colorTexture;case "hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(a)};f.prototype.modify=function(a,b,c,d){this._renderer.modify(a,b,c,d);for(d=0;d<b.length;++d)this._content.delete(b[d].uniqueName);for(d=0;d<a.length;++d)this._content.set(a[d].uniqueName,
a[d]);for(d=0;d<c.length;++d)w(this._content.get(c[d].renderGeometry.uniqueName)===c[d].renderGeometry)};f.prototype.getContent=function(){return this._content};f.prototype.getProjectionMatrix=function(a,b,c,d,h){b=t.fovx2fovy(b,a[2],a[3]);e.mat4d.perspective(180*b/Math.PI,a[2]/a[3],c,d,h)};Object.defineProperty(f.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});f.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};
f.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};f.prototype.setNeedsRender=function(){this._needsRender=!0};f.prototype.render=function(a){var b=a.camera,c=a.fbo,d=a.lightDirection,h=b.viewport;this._renderer.prepareRender(b);if(this._helpers.shadowMap.enabled){g.ENABLE_PROFILE_DEPTH_RANGE&&k.begin("depthRange");var l=this.computeDepthRange(b);g.ENABLE_PROFILE_DEPTH_RANGE&&k.end("depthRange");this._helpers.shadowMap.prepare(b,d,this._content,l);d=this._helpers.shadowMap.getCascades();
for(l=0;l<d.length;++l){var f=d[l];f.camera.setGLViewport(this._rctx);a.camera=f.camera;this._renderer.renderGeometryPass(n.MATERIAL_DEPTH_SHADOWMAP,a,null,null,this._helpers.slice)}a.camera=b;this._helpers.shadowMap.finish(c);b.setGLViewport(this._rctx)}this._helpers.shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(a,this._helpers);this._renderer.render(a,this._helpers);this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled&&(a=e.mat4d.ortho(h[0],h[2],h[1],h[3],-1,
1),this._helpers.shadowMap.drawDebugQuad(a));this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled&&(a=e.mat4d.ortho(h[0],h[2],h[1],h[3],-1,1),this._helpers.ssao.drawQuad(a))};f.prototype.getEdgeView=function(){return this._renderer.edgeView};f.prototype.computeDepthRange=function(a){var b=h.depthRangeFromScene(a,this._content,this._stage.getLayers());d.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=Math.min(a.far,b.far);return b};return f}()})},"esri/core/TimeProfiler":function(){define(["require",
"exports"],function(m,f){m=function(){function k(e,g){void 0===g&&(g=.9);this._alpha=.9;this._name=e;this._alpha=g;this.reset()}k.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(k.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"average",{get:function(){return 0<
this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});k.prototype.begin=function(){this._startTime=performance.now()};k.prototype.end=function(){var e=performance.now()-
this._startTime;this._count+=1;this._sum+=e;this._smooth=this._alpha*e+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,e);this._max=Math.max(this._max,e)};k.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return k}();(function(k){function e(c){c in d||(d[c]=new k(c));return d[c]}function g(c){console.log(e(c).toJSON())}var d={},h={};k.get=e;k.begin=function(c){e(c).begin()};k.end=function(c,b){void 0===
b&&(b=!0);e(c).end();var a=performance.now();!b||c in h&&!(a>=h[c]+1E3)||(g(c),h[c]=a)};k.log=g;k.logAll=function(){for(var c in d)g(c)}})(m||(m={}));return m})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../lib/gl-matrix ../../support/intersectionUtils ./ComponentUtils ./depthRange ./Util".split(" "),function(m,f,k,e,g,d,h,c){function b(b,c){var d=h.empty(),e=c.getObjects();c.getSpatialQueryAccelerator()?a(d,b,c.getSpatialQueryAccelerator()):
l(d,b,e);return d}function a(a,b,c){var d=b.eye,e=b.viewForward,g=b.frustumPlanes,l=function(a){return!a.areAllComponentsHidden()},k=c.objectCount;500>k?(h.set(x,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",x,function(c,d){n(a,b,c);x.far=a.near;d.setRange(x)},g,l),h.set(x,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,e,"back-to-front",x,function(c,d){n(a,b,c);x.near=a.far;d.setRange(x)},g,l)):(k=Math.max(Math.min(k,500),Math.ceil(.1*k)),d=c.findClosest(e,"front-to-back",
g,l,k),c=c.findClosest(e,"back-to-front",g,l,k),d&&c&&(q(a,b,d.getCenter(),d.getBSRadius()),q(a,b,c.getCenter(),c.getBSRadius())))}function l(a,b,c){v.clear();c.forEach(function(a){a.areAllComponentsHidden()||v.add(a)});v.empty||(v.sort(b),h.set(x,b.near,Math.min(a.near,b.far)),v.forEachInDepthRange(x,"front-to-back",function(c,d,e){d<a.near&&n(a,b,c)}),h.set(x,Math.max(a.far,b.near),b.far),v.forEachInDepthRange(x,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function n(a,b,c){if(!c.areAllComponentsHidden()&&
g.frustumSphere(b.frustumPlanes,c.getCenter(),c.getBSRadius())){var d=c.objectTransformation,h=u;c.geometryRecords.forEach(function(c){e.mat4d.multiply(d,c.getShaderTransformation(),h);var g=e.mat4d.maxScale(h);p(a,b,c.geometry.boundingInfo,h,g)})}}function p(a,b,c,d,h){var l=b.eye,k=b.viewForward;e.mat4d.multiplyVec3(d,c.center,w);l=k[0]*(w[0]-l[0])+k[1]*(w[1]-l[1])+k[2]*(w[2]-l[2]);k=c.bsRadius*h;if(!(l-k>a.near&&l+k<a.far)&&g.frustumSphere(b.frustumPlanes,w,k))if(100<c.bsRadius&&c.getChildren())for(c=
c.getChildren(),l=0;8>l;++l)c[l]&&p(a,b,c[l],d,h);else y.unionDepthRangeWithAABB(a,b.viewProjectionMatrix,d,c.bbMin,c.bbMax)}function q(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(f,"__esModule",{value:!0});f.depthRangeFromScene=function(a,c,d){if(1E4>c.size)return z.compute(a,c);c=h.empty();for(var e in d)h.union(c,b(a,d[e]));return c};f.depthRangeFromLayer=b;m=function(){function a(){this._items=
new k({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=
a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var r=
function(){function a(){this.view=e.mat4d.create();this.viewProj=e.mat4d.create();this.planes=[e.vec4d.create(),e.vec4d.create(),e.vec4d.create(),e.vec4d.create(),e.vec4d.create(),e.vec4d.create()];this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}a.prototype.compute=function(a,b){var c=this;this.reset();e.mat4d.set(a.viewMatrix,this.view);e.mat4d.multiply(a.projectionMatrix,this.view,this.viewProj);a.copyFrustumPlanes(this.planes);
a=this.view;var h=a[2],g=a[6],l=a[10],k=a[14];a=this.range;var f=0;b.forEach(function(a){if(!d.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,e;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),1,w),e=w):(b=a.bsRadius,e=a.center);e=h*e[0]+g*e[1]+l*e[2]+k;c.geometries[f]=a;c.near[f]=-(e+b);c.far[f]=-(e-b);++f}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),
2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var n=this.looseRange;n.near=Math.max(.5*a.near,2);n.far=2*a.far;var p=0,m=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=n.near?a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>a.far&&(this.far[b]<=n.far?a.far=this.far[b]:this.farCandidates[m++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?
1:0});this.farCandidates.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)n=this.nearCandidates[b],this.near[n]<a.near&&(n=this.geometries[n],p=n.boundingInfo,this.includeNearBoundingInfoRec(p,n.getShaderTransformation()));for(b=0;b<this.farCandidates.length;++b)n=this.farCandidates[b],this.far[n]>a.far&&(n=this.geometries[n],p=n.boundingInfo,this.includeFarBoundingInfoRec(p,n.getShaderTransformation()));return a};a.prototype.reset=function(){this.geometries.length=
0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};a.prototype.includeNearBoundingInfoRec=function(a,b){var c=a.getBSRadius(),d=a.getCenter();e.mat4d.multiplyVec3(b,d,w);var d=e.mat4d.maxScale(b),h=w[0],g=w[1],l=w[2],c=c*d;if(!(this.planes[0][0]*h+this.planes[0][1]*g+this.planes[0][2]*l+this.planes[0][3]>c||this.planes[1][0]*h+this.planes[1][1]*g+this.planes[1][2]*l+this.planes[1][3]>c||
this.planes[2][0]*h+this.planes[2][1]*g+this.planes[2][2]*l+this.planes[2][3]>c||this.planes[3][0]*h+this.planes[3][1]*g+this.planes[3][2]*l+this.planes[3][3]>c||(d=this.view[2]*h+this.view[6]*g+this.view[10]*l+this.view[14],h=d+c,2>-(d-c)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=-h;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeNearBoundingInfoRec(c[a],b);return}y.unionDepthRangeWithAABB(this.range,this.viewProj,b,a.getBBMin(),a.getBBMax())}};
a.prototype.includeFarBoundingInfoRec=function(a,b){var c=a.getBSRadius(),d=a.getCenter();e.mat4d.multiplyVec3(b,d,w);var d=e.mat4d.maxScale(b),h=w[0],g=w[1],l=w[2],c=c*d;if(!(this.planes[0][0]*h+this.planes[0][1]*g+this.planes[0][2]*l+this.planes[0][3]>c||this.planes[1][0]*h+this.planes[1][1]*g+this.planes[1][2]*l+this.planes[1][3]>c||this.planes[2][0]*h+this.planes[2][1]*g+this.planes[2][2]*l+this.planes[2][3]>c||this.planes[3][0]*h+this.planes[3][1]*g+this.planes[3][2]*l+this.planes[3][3]>c||(d=
this.view[2]*h+this.view[6]*g+this.view[10]*l+this.view[14]-c,-d<=this.range.far)))if(-d<this.looseRange.far)this.range.far=-d;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeFarBoundingInfoRec(c[a],b);return}y.unionDepthRangeWithAABB(this.range,this.viewProj,b,a.getBBMin(),a.getBBMax())}};return a}();f.DepthRangeFromRenderGeometries=r;f=function(){function a(){this.modelViewProj=e.mat4d.create();this.clipPosition=[e.vec4d.create(),e.vec4d.create(),e.vec4d.create(),
e.vec4d.create(),e.vec4d.create(),e.vec4d.create(),e.vec4d.create(),e.vec4d.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,h){var g=this.modelViewProj;e.mat4d.multiply(b,c,g);b=!1;for(c=0;8>c;++c){var l=this.clipPosition[c],k=0===c||3===c||4===c||7===c?d[0]:h[0],f=0===c||1===c||4===c||5===c?d[1]:h[1],n=4>c?d[2]:h[2];l[0]=g[0]*k+g[4]*f+g[8]*n+g[12];l[1]=g[1]*k+g[5]*f+g[9]*n+g[13];l[2]=g[2]*k+g[6]*f+g[10]*n+g[14];l[3]=g[3]*k+g[7]*f+g[11]*n+g[15]}for(c=0;12>c;++c){d=this.clipTriangle(this.clipPosition[t[c][0]],
this.clipPosition[t[c][1]],this.clipPosition[t[c][2]]);h=!0;for(g=0;g<d.length;++g)if(l=d[g][3],2<=l){h=!1;break}if(!h)for(b=!0,g=0;g<d.length;++g)l=d[g][3],l<a.near&&(a.near=l),l>a.far&&(a.far=l)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];c.assert(!1)};a.prototype.intersect=function(a,b,c){var d=0;0===c?d=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===c?d=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?
d=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===c&&(d=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return e.vec4d.lerp(a,b,d,e.vec4d.create())};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],h=c[(d+1)%c.length];this.inside(h,b)?(this.inside(e,b)||a.push(this.intersect(e,h,b)),a.push(h)):this.inside(e,b)&&a.push(this.intersect(e,h,b))}}return a};return a}();var t=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,
0],[1,0,5]],w=e.vec3d.create(),u=e.mat4d.create(),x=h.empty(),v=new m,z=new r,y=new f})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../lib/gl-matrix"],function(m,f,k){function e(c,b,a,d){var e=h;c?(a&&d&&(e.len=k.vec3d.dist(b,a)),k.vec3d.set(c,e.dir)):d?(e.len=k.vec3d.dist(b,a),k.vec3d.scale(k.vec3d.subtract(a,b,e.dir),1/e.len)):k.vec3d.normalize(k.vec3d.subtract(a,b,e.dir));return e}function g(c,b){return-k.vec3d.dot(b,c)-c[3]}function d(c,b,a,d){d.clip[0]=
0;d.clip[1]=a?d.len:Number.MAX_VALUE;for(a=0;a<c.length;a++){var e;var h=c[a],l=b;e=d;var f=k.vec3d.dot(h,e.dir),h=g(h,l);0>h&&0<=f?e=!1:-1E-6<f&&1E-6>f?e=0<h:!(0>h||0>f)||0>h&&0>f?(h/=f,0<f?h<e.clip[1]&&(e.clip[1]=h):h>e.clip[0]&&(e.clip[0]=h),e=e.clip[0]<=e.clip[1]):e=!0;if(!e)return!1}return!0}Object.defineProperty(f,"__esModule",{value:!0});f.planeSphere=function(c,b,a){return c[0]*b[0]+c[1]*b[1]+c[2]*b[2]+c[3]<a};f.frustumSphere=function(c,b,a){var d=b[0],e=b[1];b=b[2];return c[0][0]*d+c[0][1]*
e+c[0][2]*b+c[0][3]>a||c[1][0]*d+c[1][1]*e+c[1][2]*b+c[1][3]>a||c[2][0]*d+c[2][1]*e+c[2][2]*b+c[2][3]>a||c[3][0]*d+c[3][1]*e+c[3][2]*b+c[3][3]>a||c[4][0]*d+c[4][1]*e+c[4][2]*b+c[4][3]>a||c[5][0]*d+c[5][1]*e+c[5][2]*b+c[5][3]>a?!1:!0};f.frustumRay=function(c,b,a,h){a=e(h,b,a,!1);return d(c,b,null,a)};f.frustumPoint=function(c,b){for(var a=0;6>a;a++)if(0>g(c[a],b))return!1;return!0};f.frustumLineSegment=function(c,b,a,h){h=e(h,b,a,!0);return d(c,b,a,h)};f.closestPointOnRay=function(c,b,a,d){a=k.vec3d.dot(b,
k.vec3d.subtract(a,c,d));k.vec3d.add(c,k.vec3d.scale(b,a,d),d);return d};var h={dir:k.vec3d.create(),len:0,clip:k.vec2d.create()}})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../lib/gl-matrix ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),function(m,
f,k,e,g,d,h,c,b,a,l,n,p){return function(){function f(a,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=k.vec4d.create();this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=a.getProgram(b.blurPass,{gaussianSamples:5});
this.blurGridProgram=a.getProgram(b.blurPass,{gaussianSamples:5,gridOptimization:!0});this.applyProgram=a.getProgram(b.applyPass);this.applyGridProgram=a.getProgram(b.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=a.getProgram(b.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=a.getProgram(b.downsamplePass)}Object.defineProperty(f.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"profilingCallback",{get:function(){return e.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});f.prototype.setDefaultOptions=function(a){this.defaultOptions=a};f.prototype.render=function(a,b){var d=!e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=e.HIGHLIGHTS_VISUALIZE_BLOCKS,g=a.camera,l=a.fbo,f=this._rctx;c.assert(this.enabled);k.vec4d.set(g.fullViewport,this.viewportToRestore);var p=Math.ceil(b.width/1),m=Math.ceil(b.height/
1);this.blur0Fbo.resize(p,m);this.blur1Fbo.resize(p,m);f.bindVAO(this.quadVAO);f.setDepthWriteEnabled(!1);f.setDepthTestEnabled(!1);f.setBlendingEnabled(!1);var q=null,r=g=q=null;if(d){var t=this._grid;this._gridUpdateResources(b,32);this._gridComputeMipmap();g=t.vao;r=4;q=this.blurGridProgram;f.bindProgram(q);f.bindTexture(t.coverageMipmap[t.mipmapLevels].colorTexture,1);q.setUniform1i("coverageTex",1)}else g=this.quadVAO,r=5,q=this.blurProgram,f.bindProgram(q);f.bindVAO(g);f.bindFramebuffer(this.blur0Fbo);
f.setViewport(0,0,p,m);f.setClearColor(0,0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT);q.setUniform1i("tex",0);f.bindTexture(b.colorTexture,0);q.setUniform2f("blurSize",1/p,0);f.drawArrays(r,0,n.vertexCount(g,"geometry"));f.bindFramebuffer(this.blur1Fbo);f.clear(f.gl.COLOR_BUFFER_BIT);f.bindTexture(this.blur0Fbo.colorTexture,0);q.setUniform2f("blurSize",0,1/m);f.drawArrays(r,0,n.vertexCount(g,"geometry"));f.bindFramebuffer(l);f.setBlendingEnabled(!0);f.setBlendFunctionSeparate(770,771,1,771);f.setViewport(this.viewportToRestore[0],
this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);d?(q=h?this.applyGridDebugProgram:this.applyGridProgram,f.bindProgram(q),q.setUniform1i("coverageTex",2),f.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(q=this.applyProgram,f.bindProgram(q));q.setUniform1i("tex",0);f.bindTexture(this.blur1Fbo.colorTexture,0);q.setUniform1i("origin",1);f.bindTexture(b.colorTexture,1);a=a.pixelRatio||1;q.setUniform4fv("color",this.defaultOptions.color);
q.setUniform1f("outlineSize",8.6*a);q.setUniform1f("blurSize",.4*a);q.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);f.drawArrays(r,0,n.vertexCount(g,"geometry"));f.bindVAO(null);f.setDepthWriteEnabled(!0);f.setDepthTestEnabled(!0);f.setBlendingEnabled(!1)};f.prototype.enable=function(){if(!this.enabled){this.quadVAO=h.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,
width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=l.createWithAttachments(this._rctx,b,a);this.blur1Fbo=l.createWithAttachments(this._rctx,b,a)}};f.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};f.prototype._gridUpdateResources=function(b,c){var e=this._rctx,h=this._grid,k=!1;null===h.coverageMipmap&&(h.coverageMipmap=
[b],k=!0);if(h.viewportWidth!==b.width||h.viewportHeight!==b.height)k=!0,h.viewportWidth=b.width,h.viewportHeight=b.height;h.coverageMipmap[0]=b;h.cellPixelSize!==c&&(h.cellPixelSize=c,k=!0);if(k){for(c=1;c<h.coverageMipmap.length;c++)h.coverageMipmap[c].dispose();h.mipmapLevels=Math.ceil(Math.log(h.cellPixelSize)*Math.LOG2E);h.coverageMipmap.length=h.mipmapLevels+1;for(c=0;c<h.mipmapLevels;c++)k=h.coverageMipmap[c],k=l.createWithAttachments(e,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,
wrapMode:33071,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)}),h.coverageMipmap[c+1]=k}var k=Math.ceil(b.height/h.cellPixelSize),f=Math.ceil(b.width/h.cellPixelSize);if(!h.vao||h.verticalCellCount!==k||h.horizontalCellCount!==f){h.verticalCellCount=k;h.horizontalCellCount=f;b=k+1;c=f+1;for(var k=1/k,f=1/f,n=new Float32Array(24*b*c),m=0,q=0;q<b;q++)for(var r=0;r<c;r++)n[m+0]=(r-.5)*f*2-1,n[m+1]=(q-
.5)*k*2-1,n[m+2]=r*f,n[m+3]=q*k,n[m+4]=(r+.5)*f*2-1,n[m+5]=(q-.5)*k*2-1,n[m+6]=r*f,n[m+7]=q*k,n[m+8]=(r-.5)*f*2-1,n[m+9]=(q+.5)*k*2-1,n[m+10]=r*f,n[m+11]=q*k,n[m+12]=(r-.5)*f*2-1,n[m+13]=(q+.5)*k*2-1,n[m+14]=r*f,n[m+15]=q*k,n[m+16]=(r+.5)*f*2-1,n[m+17]=(q-.5)*k*2-1,n[m+18]=r*f,n[m+19]=q*k,n[m+20]=(r+.5)*f*2-1,n[m+21]=(q+.5)*k*2-1,n[m+22]=r*f,n[m+23]=q*k,m+=24;h.vao&&h.vao.dispose(!0);h.vao=new p(e,g.Default3D,{geometry:d.Pos2Tex},{geometry:a.createVertex(e,35044,n)})}};f.prototype._gridComputeMipmap=
function(){var a=this._rctx,b=this._grid,c=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,h=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/h);a.setViewport(0,0,e,h);a.drawArrays(5,0,n.vertexCount(this.quadVAO,"geometry"))}};return f}()})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(c){return g.glslifyDefineMap({GRID_OPTIMIZATION:c.gridOptimization,GAUSSIAN_SAMPLES:c.gaussianSamples})},h=function(c){return g.glslifyDefineMap({GRID_OPTIMIZATION:c.gridOptimization,GRID_DEBUG:c.gridDebug})};f.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:e.resolveIncludes("renderer/highlight/downsample.vert"),
fragmentShader:e.resolveIncludes("renderer/highlight/downsample.frag")},attributes:k.Default3D};f.blurPass={name:"highlight-blur",shaders:function(c){return{vertexShader:d(c)+e.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:d(c)+e.resolveIncludes("renderer/highlight/blur.frag")}},attributes:k.Default3D};f.applyPass={name:"highlight-apply",shaders:function(c){return{vertexShader:h(c)+e.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:h(c)+e.resolveIncludes("renderer/highlight/apply.frag")}},
attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/Util".split(" "),function(m,f,k,e,g,d,h){var c=[0,0,0,0],b=[0,1,0,1];return function(){function a(a,b){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._rctx=b;b=this.renderTargetHelper=new e.RenderTargetHelper(b);this.mainColor=b.registerColorTarget({name:"mainColor"});
this.mainDepth=b.registerDepthTarget({name:"mainDepth"});this.hudVisibility=b.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=b.registerColorTarget({name:"tmpColor"});this.tmpDepth=b.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=a.getProgram(d.compositePass);this._compositeTransparentToHUDVisibilityProgram=a.getProgram(d.compositeTransparentToHUDVisibilityPass)}Object.defineProperty(a.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"framebuffer",
{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hudVisibilityTexture",
{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});a.prototype.initializeFrame=function(a,b){g.assert(this.enabled);var c=this._rctx,d=c.gl;a=a.fullViewport;this.dimensions.width=a[2];this.dimensions.height=a[3];this.mainFbo=b;this.bindTarget(this.mainColor,this.mainDepth);c.setClearStencil(0);b=this._background.color;c.setClearColor(b[0]*b[3],b[1]*b[3],b[2]*b[3],b[3]);c.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT)};a.prototype.renderSeparateAndComposite=
function(a,b,d){void 0===b&&(b=c);void 0===d&&(d="none");this.renderToTargets(a,this.tmpColor,this.mainDepth,b);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,d)};a.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,b)};a.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var c=a._compositeTransparentToHUDVisibilityProgram;b.bindProgram(c);c.setUniform1i("tex",
1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!1);b.setColorMask(!1,!0,!1,!1);b.bindVAO(a.quadVAO);b.drawArrays(5,0,h.vertexCount(a.quadVAO,"geometry"));b.setColorMask(!0,!0,!0,!0);b.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)};a.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
a.prototype.renderDepthDetached=function(a){this.bindTarget(this.mainColor);a();this.bindTarget(this.mainColor,this.mainDepth)};a.prototype.composite=function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=this.mainFbo);void 0===c&&(c="none");var d=this._rctx,e=this._compositeProgram;d.bindFramebuffer(b);d.setDepthTestEnabled(!1);d.bindProgram(e);e.setUniform1i("tex",1);d.bindTexture(a,1);switch(c){case "none":d.setBlendingEnabled(!1);break;case "alpha":d.setBlendFunctionSeparate(770,
771,1,771);d.setBlendingEnabled(!0);break;case "premultiplied-alpha":d.setBlendFunction(1,771),d.setBlendingEnabled(!0)}d.bindVAO(this.quadVAO);d.drawArrays(5,0,h.vertexCount(this.quadVAO,"geometry"));d.setDepthTestEnabled(!0);d.setBlendingEnabled(!1)};a.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=k.createQuadVAO(this._rctx))};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=
null)};a.prototype.renderToTargets=function(a,b,c,d,e){var h=this._rctx,g=h.gl;this.bindTarget(b,c);b=0;d&&(h.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),b|=g.COLOR_BUFFER_BIT);e&&(b|=g.DEPTH_BUFFER_BIT);h.clear(b);a();g.flush();this.bindTarget(this.mainColor,this.mainDepth)};a.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a)};a.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,
this.dimensions)};return a}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});var h={dataType:5121},c={};m=function(){function b(a){this.rctx=a;this.framebuffers=new Map;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.nextId=
1;this.depthTextureSupported=a.capabilities.depthTexture}b.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};b.prototype.getDepthTexture=function(a,b){if(this.depthTextureSupported){var c=this.depthTextures.get(a.id);!c||c.descriptor.width===b.width&&
c.descriptor.height===b.height||(c.dispose(),c=void 0);c||(c=new d(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:b.width,height:b.height}),this.depthTextures.set(a.id,c));return c}};b.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var c=this.depthBuffers.get(a.id);c?c.descriptor.width===b.width&&c.descriptor.height===b.height||c.resize(b.width,b.height):(c=new g(this.rctx,k({internalFormat:34041},b)),this.depthBuffers.set(a.id,
c));return c}};b.prototype.getColorTexture=function(a,b){var c=this.colorTextures.get(a.id);!c||c.descriptor.width===b.width&&c.descriptor.height===b.height||(c.dispose(),c=void 0);c||(c=new d(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:b.width,height:b.height}),this.colorTextures.set(a.id,c));return c};b.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return k({id:b},c,a)};b.prototype.registerColorTarget=function(a){void 0===
a&&(a={});var b=this.nextId++;return k({id:b},h,a)};b.prototype.getFramebuffer=function(a,b,c){var d=this.getKey(b,c),h=this.framebuffers.get(d);b=this.getColorTexture(b,a);if(this.depthTextureSupported){var g=c?this.getDepthTexture(c,a):void 0;if(!h)return h=c?e.createWithAttachments(this.rctx,b,{colorTarget:0,depthStencilTarget:4},g):e.createWithAttachments(this.rctx,b,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(d,h),h;if(c=h.width!==a.width||h.height!==a.height||h.colorTexture!==
b||h.depthStencilTexture!==g)h.detachColorTexture(),h.detachDepthStencilTexture(),h.resize(a.width,a.height),h.attachColorTexture(b),h.attachDepthStencilTexture(g)}else{g=c?this.getDepthBuffer(c,a):void 0;if(!h)return h=e.createWithAttachments(this.rctx,b,{colorTarget:0,depthStencilTarget:c?3:0},g),this.framebuffers.set(d,h),h;if(c=h.width!==a.width||h.height!==a.height||h.colorTexture!==b)h.detachColorTexture(),h.detachDepthStencilBuffer(),h.resize(a.width,a.height),h.attachColorTexture(b),h.attachDepthStencilBuffer(g)}return h};
b.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};return b}();f.RenderTargetHelper=m})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.compositePass={name:"offscreen-composite",shaders:{vertexShader:e.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:e.resolveIncludes("renderer/offscreen/offscreen.frag")},
attributes:k.Default3D};f.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:e.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:e.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports ../../lib/gl-matrix ./glUtil3D ./Util ../shaders/OccludedPrograms ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(m,f,k,e,g,d,h,c){return function(){function b(a,b){this._quadVAO=null;this._rctx=b;this._colorFBO=void 0;this._viewportToRestore=k.vec4d.create();this._combineProgram=a.getProgram(d.combinePass)}Object.defineProperty(b.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});b.prototype.setupFBOs=function(a){g.assert(this.enabled);this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=
a[3];this._rctx.setViewport(0,0,this._width,this._height)};b.prototype.prepareColorPass=function(){g.assert(this.enabled);var a=this._rctx,b=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};b.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])};b.prototype.apply=
function(){var a=this._rctx,b=this._combineProgram;a.bindProgram(b);a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);b.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,c.vertexCount(this._quadVAO,"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)};b.prototype.enable=function(){this.enabled||(this._quadVAO=e.createQuadVAO(this._rctx),
this._colorFBO=h.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};b.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)};return b}()})},"esri/views/3d/webgl-engine/shaders/OccludedPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(m,
f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.combinePass={name:"occluded-combine",shaders:{vertexShader:e.resolveIncludes("util/quad.vert"),fragmentShader:e.resolveIncludes("renderer/occluded/combine.frag")},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../lib/gl-matrix ../../support/mathUtils ./Camera ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/MiscPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){function t(a,b){k.vec3d.set3(a[b],a[b+3],a[b+6],X);return X}var w=function(){return function(){this.camera=new g;this.lightMat=k.mat4d.create()}}();m=function(){function g(a,b){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.programRep=a;this.rctx=b;this.emptyTexture=c.createEmptyTexture(b);for(a=0;4>a;++a)this.cascades.push(new w)}g.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(g.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=e.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});g.prototype.getDepthTexture=function(){return this.depthTexture};g.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)G[a]=this.cascades[a];G.length=this.numCascades;return G};g.prototype.prepare=function(a,c,d,e){b.assert(this.enabled);k.mat4d.multiply(a.projectionMatrix,a.viewMatrix,x);var h=e.near,g=e.far;2>h&&(h=2);2>g&&(g=2);h>=g&&(h=2,g=4);this.numCascades=Math.min(1+Math.floor(b.logWithBase(g/h,4)),this.maxNumCascades);d=Math.pow(g/h,1/this.numCascades);
for(e=0;e<this.numCascades+1;++e)this.cascadeDistances[e]=h*Math.pow(d,e);k.mat4d.inverse(x,v);k.mat4d.lookAt([0,0,0],[-c[0],-c[1],-c[2]],[0,1,0],N);d=a.viewMatrix;a=a.projectionMatrix;for(e=0;e<this.numCascades;++e){var l=this.cascades[e],g=-this.cascadeDistances[e],h=-this.cascadeDistances[e+1],g=(a[10]*g+a[14])/Math.abs(a[11]*g+a[15]),h=(a[10]*h+a[14])/Math.abs(a[11]*h+a[15]);b.assert(g<h);for(var f=0;8>f;++f){k.vec4d.set4(0===f%4||3===f%4?-1:1,0===f%4||1===f%4?-1:1,4>f?g:h,1,z);k.mat4d.multiplyVec4(v,
z,y[f]);for(var n=0;3>n;++n)y[f][n]/=y[f][3]}k.vec3d.negate(y[0],I);k.mat4d.translate(N,I,u);l.camera.viewMatrix=u;for(f=0;8>f;++f)k.mat4d.multiplyVec3(l.camera.viewMatrix,y[f]);k.vec3d.set(y[0],A);k.vec3d.set(y[0],B);for(f=1;8>f;++f)for(n=0;3>n;++n)A[n]=Math.min(A[n],y[f][n]),B[n]=Math.max(B[n],y[f][n]);A[2]-=200;B[2]+=200;l.camera.near=-B[2];l.camera.far=-A[2];h=1/y[0][3];g=1/y[4][3];b.assert(h<g);var n=h+Math.sqrt(h*g),f=Math.sin(Math.acos(d[2]*c[0]+d[6]*c[1]+d[10]*c[2])),n=n/f,h=y,p=n,m=f,f=C,
q=E,r=D,w=F,n=M;k.vec2d.set2(0,0,Q);for(var G=0;4>G;++G)k.vec2d.add(Q,h[G],Q);k.vec2d.scale(Q,.25);k.vec2d.set2(0,0,H);for(G=4;8>G;++G)k.vec2d.add(H,h[G],H);k.vec2d.scale(H,.25);k.vec2d.lerp(h[4],h[5],.5,K[0]);k.vec2d.lerp(h[5],h[6],.5,K[1]);k.vec2d.lerp(h[6],h[7],.5,K[2]);k.vec2d.lerp(h[7],h[4],.5,K[3]);for(var O=0,J=k.vec2d.dist2(K[0],Q),G=1;4>G;++G){var X=k.vec2d.dist2(K[G],Q);X<J&&(J=X,O=G)}k.vec2d.subtract(K[O],h[O+4],R);G=R[0];R[0]=-R[1];R[1]=G;k.vec2d.subtract(H,Q,P);k.vec2d.lerp(R,P,m);k.vec2d.normalize(R);
O=m=void 0;m=O=k.vec2d.dot(k.vec2d.subtract(h[0],Q,L),R);for(G=1;8>G;++G)J=k.vec2d.dot(k.vec2d.subtract(h[G],Q,L),R),J<m?m=J:J>O&&(O=J);k.vec2d.set(Q,f);k.vec2d.scale(R,m-p,L);k.vec2d.add(f,L,f);for(var X=-1,ba=1,G=p=J=0;8>G;++G){k.vec2d.subtract(h[G],f,T);k.vec2d.normalize(T);var ga=R[0]*T[1]-R[1]*T[0];0<ga?ga>X&&(X=ga,J=G):ga<ba&&(ba=ga,p=G)}b.verify(0<X,"leftArea");b.verify(0>ba,"rightArea");k.vec2d.scale(R,m,S);k.vec2d.add(S,Q,S);k.vec2d.scale(R,O,W);k.vec2d.add(W,Q,W);Y[0]=-R[1];Y[1]=R[0];q=
b.rayRay2D(f,h[p],W,k.vec2d.add(W,Y,L),1,q);r=b.rayRay2D(f,h[J],W,L,1,r);w=b.rayRay2D(f,h[J],S,k.vec2d.add(S,Y,L),1,w);h=b.rayRay2D(f,h[p],S,L,1,n);b.verify(q,"rayRay");b.verify(r,"rayRay");b.verify(w,"rayRay");b.verify(h,"rayRay");r=C;h=E;f=F;w=M;n=l.camera.projectionMatrix;k.vec2d.scale(k.vec2d.subtract(f,w,aa),.5);U[0]=aa[0];U[1]=aa[1];U[2]=0;U[3]=aa[1];U[4]=-aa[0];U[5]=0;U[6]=aa[0]*aa[0]+aa[1]*aa[1];U[7]=aa[0]*aa[1]-aa[1]*aa[0];U[8]=1;U[6]=-k.vec2d.dot(t(U,0),r);U[7]=-k.vec2d.dot(t(U,1),r);r=
k.vec2d.dot(t(U,0),f)+U[6];q=k.vec2d.dot(t(U,1),f)+U[7];G=k.vec2d.dot(t(U,0),w)+U[6];w=k.vec2d.dot(t(U,1),w)+U[7];r=-(r+G)/(q+w);U[0]+=U[1]*r;U[3]+=U[4]*r;U[6]+=U[7]*r;r=1/(k.vec2d.dot(t(U,0),f)+U[6]);q=1/(k.vec2d.dot(t(U,1),f)+U[7]);U[0]*=r;U[3]*=r;U[6]*=r;U[1]*=q;U[4]*=q;U[7]*=q;U[2]=U[1];U[5]=U[4];U[8]=U[7];U[7]+=1;r=k.vec2d.dot(t(U,1),h)+U[7];q=k.vec2d.dot(t(U,2),h)+U[8];G=k.vec2d.dot(t(U,1),f)+U[7];w=k.vec2d.dot(t(U,2),f)+U[8];r=-.5*(r/q+G/w);U[1]+=U[2]*r;U[4]+=U[5]*r;U[7]+=U[8]*r;r=k.vec2d.dot(t(U,
1),h)+U[7];q=k.vec2d.dot(t(U,2),h)+U[8];G=-q/r;U[1]*=G;U[4]*=G;U[7]*=G;n[0]=U[0];n[1]=U[1];n[2]=0;n[3]=U[2];n[4]=U[3];n[5]=U[4];n[6]=0;n[7]=U[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=U[6];n[13]=U[7];n[14]=0;n[15]=U[8];l.camera.projectionMatrix[10]=2/(A[2]-B[2]);l.camera.projectionMatrix[14]=-(A[2]+B[2])/(A[2]-B[2]);k.mat4d.multiply(l.camera.projectionMatrix,l.camera.viewMatrix,l.lightMat);h=this.textureRes/2;l.camera.viewport[0]=0===e%2?0:h;l.camera.viewport[1]=0===Math.floor(e/2)?0:h;l.camera.viewport[2]=
h;l.camera.viewport[3]=h}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*g;c=this.rctx;e=c.gl;c.bindFramebuffer(this.fbo);c.bindTexture(null,7);c.setClearColor(1,1,1,1);c.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);c.setBlendingEnabled(!1)};g.prototype.finish=function(a){b.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};g.prototype.bind=function(a){var b=this.rctx,c=this.enabled;b.bindTexture(c?this.depthTexture:
this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};g.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};g.prototype.bindView=function(a,b){if(this.enabled){var c=this.lastOrigin;
if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||k.vec3d.create(),k.vec3d.set(b,this.lastOrigin),c=0;c<this.numCascades;++c){k.mat4d.translate(this.cascades[c].lightMat,b,O);for(var d=0;16>d;++d)J[16*c+d]=O[d]}a.setUniformMatrix4fv("shadowMapMatrix",J)}};g.prototype.drawDebugQuad=function(c){b.assert(this.enabled);var e=this.rctx,g=e.gl;if(!this.debugQuadVAO){var k=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new r(e,d.Default3D,{geometry:h.Pos2Tex},
{geometry:l.createVertex(e,g.STATIC_DRAW,k)})}var k=this.programRep.getProgram(a.showDepth),f=this.debugQuadVAO;e.setDepthTestEnabled(!1);e.bindProgram(k);k.setUniformMatrix4fv("proj",c);k.setUniform1i("depthTex",0);e.bindTexture(this.depthTexture,0);e.bindVAO(f);q.assertCompatibleVertexAttributeLocations(f,k);e.drawArrays(g.TRIANGLE_STRIP,0,q.vertexCount(f,"geometry"));e.setDepthTestEnabled(!0)};g.prototype.enable=function(){if(!this.enabled){var a=this.rctx.gl;this.depthTexture=new p(this.rctx,
{target:a.TEXTURE_2D,pixelFormat:a.RGBA,dataType:a.UNSIGNED_BYTE,wrapMode:a.CLAMP_TO_EDGE,samplingMode:a.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes});this.fbo=n.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}};g.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};return g}();var u=k.mat4d.create(),x=k.mat4d.create(),v=k.mat4d.create(),z=
k.vec4d.create(),y=[];for(f=0;8>f;++f)y.push(k.vec4d.create());var A=k.vec3d.create(),B=k.vec3d.create(),C=k.vec2d.create(),E=k.vec2d.create(),D=k.vec2d.create(),F=k.vec2d.create(),M=k.vec2d.create(),N=k.mat4d.create(),I=k.vec3d.create(),G=[],O=k.mat4d.create(),J=new Float32Array(64),Q=k.vec2d.create(),H=k.vec2d.create(),K=[k.vec2d.create(),k.vec2d.create(),k.vec2d.create(),k.vec2d.create()],R=k.vec2d.create(),P=k.vec2d.create(),L=k.vec2d.create(),T=k.vec2d.create(),S=k.vec2d.create(),W=k.vec2d.create(),
Y=k.vec2d.create(),X=k.vec3d.create(),aa=k.vec2d.create(),U=k.mat3d.create();return m})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../lib/gl-matrix ../../support/imageUtils ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/MiscPrograms ../shaders/SSAOPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){var w=k.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");f=function(){function k(a,b,d){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=e.vec4d.create();this._rctx=b;this._programRep=a;this._requestRender=d;this._emptyTexture=c.createEmptyTexture(b)}k.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(k.prototype,"isSupported",{get:function(){var a=
this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});k.prototype.computeSSAO=function(a,d,h,g){if(this._noiseTexture){b.assert(this.enabled);var l=this._rctx,
k=h.width,f=h.height,n=k/this._BLUR_F,p=f/this._BLUR_F;this._ssaoFBO.resize(k,f);this._blur0FBO.resize(n,p);this._blur1FBO.resize(n,p);n=1*k;p=1*f;l.bindFramebuffer(this._ssaoFBO);e.vec4d.set(a.fullViewport,this._viewportToRestore);l.setViewport(0,0,k,f);var m=this._ssaoProgram,q=this._blurProgram;m.setUniform2f("rnmScale",k/this._noiseTexture.descriptor.width,f/this._noiseTexture.descriptor.height);m.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);l.bindProgram(m);k=this._data.minDiscrepancy;m.setUniform1f("numSpiralTurns",this._samples<k.length?k[this._samples]:5779);k=x;f=u;b.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,k,f);m.setUniform4fv("projInfo",k);m.setUniform2fv("zScale",f);m.setUniform2f("nearFar",a.near,a.far);k=1/a.computePixelSizeAtDist(1);m.setUniform1f("projScale",1*k);m.setUniform2f("screenDimensions",n,p);var v=2*this._radius,f=e.vec3d.dist(a.eye,
a.center),v=20*a.computePixelSizeAtDist(f),v=Math.max(.1,v);m.setUniform1f("radius",v);m.setUniform1f("intensity",4*this._attenuation/Math.pow(v,6));m.setUniform1i("rnm",0);m.setUniform1i("normalMap",1);m.setUniform1i("depthMap",2);l.bindTexture(this._noiseTexture,0);l.bindTexture(g.colorTexture,1);l.bindTexture(h.colorTexture,2);h=c.createQuadVAO(this._rctx);l.bindVAO(h);l.drawArrays(5,0,r.vertexCount(h,"geometry"));l.bindTexture(this._ssaoFBO.colorTexture,0);l.setViewport(0,0,n/this._BLUR_F,p/this._BLUR_F);
l.bindFramebuffer(this._blur0FBO);q.setUniform2f("screenDimensions",n,p);q.setUniform1i("tex",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);q.setUniform2f("blurSize",0,1*this._BLUR_F/p);q.setUniform1i("radius",4);q.setUniform1f("g_BlurFalloff",.08);q.setUniform2f("nearFar",a.near,a.far);5E4<f&&(k=Math.max(0,k-(f-5E4)));q.setUniform1f("projScale",k);q.setUniform2f("zScale",1,0);l.drawArrays(5,0,r.vertexCount(h,"geometry"));q.setUniform2f("blurSize",1*this._BLUR_F/n,0);l.bindFramebuffer(this._blur1FBO);
l.bindTexture(this._blur0FBO.colorTexture,0);l.drawArrays(5,0,r.vertexCount(h,"geometry"));l.bindFramebuffer(d);l.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};k.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],
this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};k.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};k.prototype.drawQuad=function(a){b.assert(this.enabled);var c=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new t(this._rctx,d.Default3D,{geometry:h.Pos2Tex},{geometry:n.createVertex(this._rctx,35044,v)}));var e=this._rctx;e.setDepthTestEnabled(!1);
c.setUniformMatrix4fv("proj",new Float32Array(a));c.setUniform1i("depthTex",0);e.bindTexture(this._ssaoFBO.colorTexture,0);e.bindVAO(this._debugQuadVAO);e.drawArrays(5,0,r.vertexCount(this._debugQuadVAO,"geometry"));e.setDepthTestEnabled(!0)};k.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(l.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(l.blurPass,{radius:4});this._showDepthProgram=
this._programRep.getProgram(a.showDepth)};k.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):w.warn("SSAO is not supported for this browser or hardware"))};k.prototype.loadResources=function(a){var b=this;this._data?a():m(["./SSAOHelperData"],function(c){b._data=c;a()})};k.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,
height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=p.createWithAttachments(this._rctx,b,c);this._blur0FBO=p.createWithAttachments(this._rctx,b,c);this._blur1FBO=p.createWithAttachments(this._rctx,b,c);g.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new q(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};k.prototype.disable=function(){this.enabled&&(this._enabled=
!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};return k}();var u=e.vec2d.create(),x=e.vec4d.create(),v=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return f})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.ssaoPass={name:"ssao",shaders:function(g){return{vertexShader:e.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+g.samples+"\n"+e.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:k.Default3D};f.blurPass={name:"ssao-blur",shaders:function(g){return{vertexShader:e.resolveIncludes("util/quad.vert"),fragmentShader:"#define RADIUS "+g.radius+
"\n"+e.resolveIncludes("renderer/ssao/blur.frag")}},attributes:k.Default3D}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(m,f,k,e,g,d,h){return function(){function c(b,a){this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};
this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=
1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=d.default(b)?"webgl2":"webgl";this.gl=b;b instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=
h.loadCapabilities(b,a);b=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:b[0],y:b[1],width:b[2],height:b[3]};b=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:b?this.gl.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};
this.enforceState()}Object.defineProperty(c.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};c.prototype.setBlendingEnabled=function(b){this._blendEnabled!==b&&(!0===b?this.gl.enable(this.gl.BLEND):
this.gl.disable(this.gl.BLEND),this._blendEnabled=b)};c.prototype.setBlendColor=function(b,a,c,d){if(b!==this._blendColorState.r||a!==this._blendColorState.g||c!==this._blendColorState.b||d!==this._blendColorState.a)this.gl.blendColor(b,a,c,d),this._blendColorState.r=b,this._blendColorState.g=a,this._blendColorState.b=c,this._blendColorState.a=d};c.prototype.setBlendFunction=function(b,a){if(b!==this._blendFunctionState.srcRGB||a!==this._blendFunctionState.dstRGB)this.gl.blendFunc(b,a),this._blendFunctionState.srcRGB=
b,this._blendFunctionState.srcAlpha=b,this._blendFunctionState.dstRGB=a,this._blendFunctionState.dstAlpha=a};c.prototype.setBlendFunctionSeparate=function(b,a,c,d){if(this._blendFunctionState.srcRGB!==b||this._blendFunctionState.srcAlpha!==c||this._blendFunctionState.dstRGB!==a||this._blendFunctionState.dstAlpha!==d)this.gl.blendFuncSeparate(b,a,c,d),this._blendFunctionState.srcRGB=b,this._blendFunctionState.srcAlpha=c,this._blendFunctionState.dstRGB=a,this._blendFunctionState.dstAlpha=d};c.prototype.setBlendEquation=
function(b){this._blendEquationState.mode!==b&&(this.gl.blendEquation(b),this._blendEquationState.mode=b,this._blendEquationState.modeAlpha=b)};c.prototype.setBlendEquationSeparate=function(b,a){if(this._blendEquationState.mode!==b||this._blendEquationState.modeAlpha!==a)this.gl.blendEquationSeparate(b,a),this._blendEquationState.mode=b,this._blendEquationState.modeAlpha=a};c.prototype.setColorMask=function(b,a,c,d){if(this._colorMaskState.r!==b||this._colorMaskState.g!==a||this._colorMaskState.b!==
c||this._colorMaskState.a!==d)this.gl.colorMask(b,a,c,d),this._colorMaskState.r=b,this._colorMaskState.g=a,this._colorMaskState.b=c,this._colorMaskState.a=d};c.prototype.setClearColor=function(b,a,c,d){if(this._clearColor.r!==b||this._clearColor.g!==a||this._clearColor.b!==c||this._clearColor.a!==d)this.gl.clearColor(b,a,c,d),this._clearColor.r=b,this._clearColor.g=a,this._clearColor.b=c,this._clearColor.a=d};c.prototype.setFaceCullingEnabled=function(b){this._polygonCullingEnabled!==b&&(!0===b?this.gl.enable(this.gl.CULL_FACE):
this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=b)};c.prototype.setPolygonOffsetFillEnabled=function(b){this._polygonOffsetFillEnabled!==b&&(!0===b?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=b)};c.prototype.setPolygonOffset=function(b,a){if(this._polygonOffset[0]!==b||this._polygonOffset[1]!==a)this._polygonOffset[0]=b,this._polygonOffset[1]=a,this.gl.polygonOffset(b,a)};c.prototype.setCullFace=function(b){this._cullFace!==
b&&(this.gl.cullFace(b),this._cullFace=b)};c.prototype.setFrontFace=function(b){this._frontFace!==b&&(this.gl.frontFace(b),this._frontFace=b)};c.prototype.setScissorTestEnabled=function(b){this._scissorTestEnabled!==b&&(!0===b?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=b)};c.prototype.setScissorRect=function(b,a,c,d){if(this._scissorRect.x!==b||this._scissorRect.y!==a||this._scissorRect.width!==c||this._scissorRect.height!==d)this.gl.scissor(b,
a,c,d),this._scissorRect.x=b,this._scissorRect.y=a,this._scissorRect.width=c,this._scissorRect.height=d};c.prototype.setDepthTestEnabled=function(b){this._depthTestEnabled!==b&&(!0===b?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=b)};c.prototype.setClearDepth=function(b){this._clearDepth!==b&&(this.gl.clearDepth(b),this._clearDepth=b)};c.prototype.setDepthFunction=function(b){this._depthFunction!==b&&(this.gl.depthFunc(b),this._depthFunction=b)};c.prototype.setDepthWriteEnabled=
function(b){this._depthWriteEnabled!==b&&(this.gl.depthMask(b),this._depthWriteEnabled=b)};c.prototype.setDepthRange=function(b,a){if(this._depthRange.zNear!==b||this._depthRange.zFar!==a)this.gl.depthRange(b,a),this._depthRange.zNear=b,this._depthRange.zFar=a};c.prototype.setStencilTestEnabled=function(b){this._stencilTestEnabled!==b&&(!0===b?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=b)};c.prototype.setClearStencil=function(b){b!==this._clearStencil&&
(this.gl.clearStencil(b),this._clearStencil=b)};c.prototype.setStencilFunction=function(b,a,c){if(this._stencilFunction.func!==b||this._stencilFunction.ref!==a||this._stencilFunction.mask!==c)this.gl.stencilFunc(b,a,c),this._stencilFunction.face=1032,this._stencilFunction.func=b,this._stencilFunction.ref=a,this._stencilFunction.mask=c};c.prototype.setStencilFunctionSeparate=function(b,a,c,d){if(this._stencilFunction.face!==b||this._stencilFunction.func!==a||this._stencilFunction.ref!==c||this._stencilFunction.mask!==
d)this.gl.stencilFuncSeparate(b,a,c,d),this._stencilFunction.face=b,this._stencilFunction.func=a,this._stencilFunction.ref=c,this._stencilFunction.mask=d};c.prototype.setStencilWriteMask=function(b){this._stencilWriteMask!==b&&(this.gl.stencilMask(b),this._stencilWriteMask=b)};c.prototype.setStencilOp=function(b,a,c){if(this._stencilOperation.fail!==b||this._stencilOperation.zFail!==a||this._stencilOperation.zPass!==c)this.gl.stencilOp(b,a,c),this._stencilOperation.face=1032,this._stencilOperation.fail=
b,this._stencilOperation.zFail=a,this._stencilOperation.zPass=c};c.prototype.setStencilOpSeparate=function(b,a,c,d){if(this._stencilOperation.face!==b||this._stencilOperation.fail!==a||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==d)this.gl.stencilOpSeparate(b,a,c,d),this._stencilOperation.face=b,this._stencilOperation.face=b,this._stencilOperation.fail=a,this._stencilOperation.zFail=c,this._stencilOperation.zPass=d};c.prototype.setLineWidth=function(b){var a=this._lineWidth;this._lineWidth!==
b&&(this.gl.lineWidth(b),this._lineWidth=b);return a};c.prototype.setActiveTexture=function(b){var a=this._activeTextureUnit;0<=b&&b!==this._activeTextureUnit&&(this.gl.activeTexture(e.BASE_TEXTURE_UNIT+b),this._activeTextureUnit=b);return a};c.prototype.clear=function(b){b&&this.gl.clear(b)};c.prototype.drawArrays=function(b,a,c){this.gl.drawArrays(b,a,c)};c.prototype.drawElements=function(b,a,c,d){5123===c?this.gl.drawElements(b,a,c,d):5125===c&&this.gl.drawElements(b,a,c,d)};c.prototype.logIno=
function(){};Object.defineProperty(c.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});c.prototype.setViewport=function(b,a,c,d){var e=this._viewport;if(e.x!==b||e.y!==a||e.width!==c||e.height!==d)e.x=b,e.y=a,e.width=c,e.height=d,this.gl.viewport(b,a,c,d)};c.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.prototype.bindProgram=function(b){b?this._activeShaderProgram!==
b&&(b.initialize(),this.gl.useProgram(b.glName),this._activeShaderProgram=b):(this.gl.useProgram(null),this._activeShaderProgram=null)};c.prototype.bindTexture=function(b,a){void 0===a&&(a=0);-1===c._MAX_TEXTURE_IMAGE_UNITS&&(c._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(a>=c._MAX_TEXTURE_IMAGE_UNITS||0>a)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[a];this.setActiveTexture(a);null==b||null==b.glName?(null!=
d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(a,!1)),this._textureUnitMap[a]=null):d&&d.id===b.id?b.applyChanges():(this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(a,!0),b.applyChanges(),this._textureUnitMap[a]=b)};c.prototype.bindFramebuffer=function(b){b?this._activeFramebuffer!==b&&(b.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,b.glName),this._activeFramebuffer=b):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};
c.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=c._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};c.prototype.bindRenderbuffer=function(b){var a=this.gl;b||(a.bindRenderbuffer(a.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==b&&(a.bindRenderbuffer(a.RENDERBUFFER,b.glName),this._activeRenderbuffer=b)};c.prototype.unbindBuffer=function(b){34962===
b?this._activeVertexBuffer=c._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};c.prototype.bindVAO=function(b){b?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===b.id||(b.bind(),this._activeVertexArrayObject=b):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};c.prototype.getBoundTexture=function(b){return this._textureUnitMap[b]};c.prototype.getBoundFramebufferObject=
function(){return this._activeFramebuffer};c.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};c.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var b=0;b<this.parameters.maxTextureImageUnits;b++)this.bindTexture(null,b);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);
this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);
this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.prototype.enforceState=function(){var b=this.gl,a=this._capabilities.vao;a&&a.bindVertexArray(null);for(var c=0;c<this.parameters.maxVertexAttributes;c++)b.disableVertexAttribArray(c);this._activeVertexBuffer?b.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):b.bindBuffer(34962,null);this._activeIndexBuffer?b.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):
b.bindBuffer(34963,null);if(a&&this._activeVertexArrayObject){if(a=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(a)}b.bindFramebuffer(b.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);b.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);b.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);b.bindRenderbuffer(b.RENDERBUFFER,
this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?b.enable(this.gl.BLEND):b.disable(this.gl.BLEND);b.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);b.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);b.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);b.clearDepth(this._clearDepth);b.clearStencil(this._clearStencil);
b.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);b.cullFace(this._cullFace);b.depthFunc(this._depthFunction);b.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);b.depthMask(this._depthWriteEnabled);b.frontFace(this._frontFace);b.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);b.polygonOffset(this._polygonOffset[0],
this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL);b.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST);b.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);b.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,
this._stencilOperation.zPass);!0===this._stencilTestEnabled?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);b.stencilMask(this._stencilWriteMask);for(a=0;a<this.parameters.maxTextureImageUnits;a++)b.activeTexture(e.BASE_TEXTURE_UNIT+a),b.bindTexture(3553,null),(c=this._textureUnitMap[a])&&b.bindTexture(c.descriptor.target,c.glName);b.activeTexture(e.BASE_TEXTURE_UNIT+this._activeTextureUnit);b.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};c._bindBuffer=
function(b,a,c,d){if(!a)return b.bindBuffer(c,null),null;if(d===a)return d;b.bindBuffer(c,a.glName);return a};c._MAX_TEXTURE_IMAGE_UNITS=-1;return c}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(m,f){return function(){function k(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,
framebufferCount:0,renderBufferCount:0}}k.prototype.incrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};k.prototype.decrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;
break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};k.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+
this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return k}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(m,f,k,e,g,d){function h(c,b,a,d,e){if(d&&g.default(c))return!0;if(b[a])return!1;for(b=0;b<e.length;b++)if(c.getExtension(e[b]))return!0;return!1}Object.defineProperty(f,"__esModule",{value:!0});f.loadCapabilities=
function(c,b){b=b&&b.disabledExtensions||{};h(c,b,"standardDerivatives",!0,["OES_standard_derivatives"]);var a=e.load(c),l=d.load(c,b),f;f=b.compressedTextureS3TC?null:(f=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:f.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:f.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:f.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:f.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var p;p=b.textureFilterAnisotropic?null:(p=c.getExtension("EXT_texture_filter_anisotropic")||
c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:p.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:p.TEXTURE_MAX_ANISOTROPY_EXT}:null;var m=k.load(c,b),r;if(g.default(c))r=b.colorBufferFloat||!c.getExtension("EXT_color_buffer_float")?null:{R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F};else if(c instanceof WebGLRenderingContext){r=
!b.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float");var t=!b.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float");r=r||t?{RGBA16F:r?r.RGBA16F_EXT:void 0,RGBA32F:t?t.RGBA32F_EXT:void 0}:null}else r=void 0;t=g.default(c)?{MIN:c.MIN,MAX:c.MAX}:b.blendMinMax?null:(t=c.getExtension("EXT_blend_minmax"))?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null;return{instancing:a,vao:l,compressedTextureS3TC:f,textureFilterAnisotropic:p,disjointTimerQuery:m,colorBufferFloat:r,blendMinMax:t,depthTexture:h(c,
b,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:h(c,b,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:h(c,b,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:h(c,b,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});
f.load=function(e,g){if(g.disjointTimerQuery)return null;var d=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return d?k.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(d){return e.getQueryParameter(d,e.QUERY_RESULT_AVAILABLE)},getResult:function(d){return e.getQueryParameter(d,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(d.GPU_DISJOINT_EXT)},beginTimeElapsed:function(h){return e.beginQuery(d.TIME_ELAPSED_EXT,
h)},endTimeElapsed:function(){return e.endQuery(d.TIME_ELAPSED_EXT)},createTimestamp:function(e){return d.queryCounterEXT(e,d.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return d.createQueryEXT()},resultAvailable:function(e){return d.getQueryObjectEXT(e,d.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return d.getQueryObjectEXT(e,d.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(d.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(e){return d.beginQueryEXT(d.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return d.endQueryEXT(d.TIME_ELAPSED_EXT)},createTimestamp:function(e){return d.queryCounterEXT(e,d.TIMESTAMP_EXT)},timestampBits:function(){return d.getQueryEXT(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.load=function(e){return k.default(e)?
{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)}:(e=e.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(m,
f,k){Object.defineProperty(f,"__esModule",{value:!0});f.load=function(e,g){return k.default(e)?{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)}:g.vao?null:(e=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:e.createVertexArrayOES.bind(e),deleteVertexArray:e.deleteVertexArrayOES.bind(e),bindVertexArray:e.bindVertexArrayOES.bind(e)}:
null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/Logger ../../../../core/scheduling ./constants ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/mathUtils ../../support/PromiseLightweight".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}var r=new c,
t=g.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),w={mode:"on-the-ground",offset:0,unit:"meters"},u={mode:"absolute-height",offset:0,unit:"meters"};return function(g){function f(a,b,d,e){var h=g.call(this)||this;h._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};h.symbolContainer=a;h.symbol=b;h._context=d;h._symbolLayerOrder=d.layerOrder;h._symbolLayerOrderDelta=d.layerOrderDelta;h._elevationContext=new c;h._material=null;h._geometryCreationWarningHandle=null;
h._updateDrivenProperties(e);h._updateElevationContext();h._prepareResources();return h}k(f,g);f.prototype._logWarning=function(a){t.warn(a)};f.prototype._logGeometryCreationWarnings=function(a,b,c,e){var h=this;if(null==this._geometryCreationWarningHandle){var g=a.geometryData&&a.geometryData.polygons;e+=" geometry failed to be created";var l=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?l=e+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?b.some(function(a){return 1===
a.length})?l=e+" ("+c+" should contain at least 2 vertices)":g&&0===g.length&&"rings"===c&&(l=e+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):l=e+" ("+c+" should be defined as a 2D array)":l=e+" (failed to project geometry to view spatial reference)";l&&(this._geometryCreationWarningHandle=d.schedule(function(){return h._onNextTick()}),this._logWarning(l))}};f.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};f.prototype._validateGeometry=
function(a){return"point"!==a.type||n.isFinite(a.x)&&n.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};f.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};f.prototype._defaultElevationInfoNoZ=function(){return w};f.prototype._defaultElevationInfoZ=function(){return u};f.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);
(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};f.prototype.getGraphicElevationContext=function(c){var d=c.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();r.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:d.unit);r.mode=this._elevationContext.mode||d.mode;r.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:
d.offset);r.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;r.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==r.mode||(r.mode="relative-to-ground",r.setOffsetMeters(0),r.featureExpressionInfoContext=b.zeroContext);d=b.createFeature(c,this._context.layer);b.setContextFeature(r.featureExpressionInfoContext,d);a.needsOffsetAdjustment(r,this._elevationOptions,c.geometry,this.symbolContainer)&&(r.setOffsetRenderUnits(h.defaultIconElevationOffset),
r.hasOffsetAdjustment=!0);return r};f.prototype._getDrapedZ=function(){return-2};f.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.colors)for(var c=0;c<a.colors.length;c++){var d=a.colors[c];d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}if(a.stops)for(c=
0;c<a.stops.length;c++)(d=a.stops[c].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0);break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b};f.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};f.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};
f.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};f.prototype._getMaterialOpacityAndColor=function(){var a=this.symbol&&this.symbol.material,b=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?e.toUnitRGB(a.color):null;return l.mixinColorAndOpacity(a,b)};f.prototype._getVertexOpacityAndColor=function(a,b,c){var d=this._isPropertyDriven("color")?
a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=l.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):d};f.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};f.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};f.prototype.updateSymbolLayerOrder=function(a,b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};f.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,
b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};f.prototype.createGraphics3DGraphic=function(a){for(var b=1;b<arguments.length;b++);throw Error("This is an abstract base class");};f.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};f.prototype.layerPropertyChanged=function(a,b,c){return!1};f.prototype.applyRendererDiff=function(a,b,c,d){return!1};f.prototype.getFastUpdateAttrValues=
function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?q(b.size.field,a):0;a=b.color?q(b.color.field,a):0;return[c,a,0,0]};return f}(p.Promise)})},"esri/views/3d/support/PromiseLightweight":function(){(function(m){function f(e){this._callbacks=[];this._errbacks=[];this._cancelCallback=e;this._iserr=this._isdone=this._iscancelled=!1}function k(e,d){var h=new f;0===e.length?h.done.apply(h,d):e[0].apply(null,d).then(function(){e.splice(0,1);k(e,arguments).then(function(){h.done.apply(h,
arguments)})});return h}f.prototype.cancel=function(e){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(e)};f.prototype.then=function(e,d,h){var c;if(!this._iscancelled)return this._isdone?c=e.apply(h,this.result):this._iserr&&d?c=d.apply(h,this.result):(this._callbacks.push(function(){return e.apply(h,arguments)}),d&&this._errbacks.push(function(){return d.apply(h,arguments)})),c};f.prototype.done=function(){this.result=arguments;this._isdone=!0;
for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[];this._errbacks=[]};f.prototype.resolve=f.prototype.done;f.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var e=0;e<this._errbacks.length;e++)this._errbacks[e].apply(null,arguments);this._callbacks=[];this._errbacks=[]}};f.prototype.isRejected=function(){return this._iserr};f.prototype.isFulfilled=function(){return this._isdone||this._iserr};f.prototype.isResolved=
function(){return this._isdone};f.prototype.isCancelled=function(){return this._iscancelled};var e={Promise:f,join:function(e){function d(d,e){return function(){e&&(g=!0);b+=1;a[d]=Array.prototype.slice.call(arguments);b===c&&(g?h.reject():h.done(a))}}for(var h=new f,c=e.length,b=0,a=[],g=!1,k=0;k<c;k++)e[k].then(d(k,!1),d(k,!0));0===e.length&&h.done();return h},chain:k};"function"===typeof define&&define.amd?define(function(){return e}):m.promise=e})(this)},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),
function(m,f,k,e,g,d,h,c){return function(){function b(a,c,d){this.singleUse=!1;this._componentAABB=this._boundingInfo=null;this.id=b.__idGen.gen(c);this._data=a;this._boundingInfo=d}Object.defineProperty(b.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentCount",{get:function(){return e.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingInfo",{get:function(){null==
this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});b.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null};b.prototype.getComponentAABB=function(a,b){null==this._componentAABB&&(this._componentAABB=this._computeComponentAABB());for(var c=0;6>c;c++)b[c]=this._componentAABB[6*a+c];return b};b.prototype._computeComponentAABB=function(){for(var a=this.componentCount,b=new Float32Array(6*a),c=0;c<a;c++)this._calculateAABB(c,
b,6*c);return b};b.prototype._calculateAABB=function(a,b,d){void 0===d&&(d=0);var e=this.data.getIndices(c.VertexAttrConstants.POSITION),h=this.data.getAttribute(c.VertexAttrConstants.POSITION),g=this.data.componentOffsets,l=g.length?g[a+1]:e.length,k=Infinity,f=Infinity,n=Infinity,m=-Infinity,z=-Infinity,y=-Infinity,A=h.offsetIdx,B=h.strideIdx;for(a=g.length?g[a]:0;a<l;a++)var C=A+B*e[a],g=h.data[C],E=h.data[C+1],C=h.data[C+2],k=Math.min(k,g),f=Math.min(f,E),n=Math.min(n,C),m=Math.max(m,g),z=Math.max(z,
E),y=Math.max(y,C);b?(b[d]=k,b[d+1]=f,b[d+2]=n,b[d+3]=m,b[d+4]=z,b[d+5]=y):b=[k,f,n,m,z,y];return b};b.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(c.VertexAttrConstants.POSITION),b=this.data.getAttribute(c.VertexAttrConstants.POSITION),d="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(d),e=0;e<d;++e)a[e]=e;e=a.length;h.assert(0===e%d);e=g.generateDefaultIndexArray(e/d);return new k(e,d,a,b)};b.__idGen=new d;return b}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require",
"exports","../../../../core/PooledArray","../../lib/gl-matrix","./Util"],function(m,f,k,e,g){m=function(){function h(c,b,a,h){g.assert(1<=c.length);g.assert(0===a.length%b);g.assert(a.length>=c.length*b);g.assert(3===h.size||4===h.size);this.primitiveIndices=c;this.indices=a;this._position=h;this._numIndexPerPrimitive=b;var l=h.data,k=h.offsetIdx,f=h.strideIdx;h=0;var m=c.length,t=k+f*a[b*c[h]];d.clear();d.push(t);this.bbMin=e.vec3d.createFrom(l[t],l[t+1],l[t+2]);for(this.bbMax=e.vec3d.create(this.bbMin);h<
m;++h)for(var w=b*c[h],u=0;u<b;++u){t=k+f*a[w+u];d.push(t);var x=l[t];this.bbMin[0]=Math.min(x,this.bbMin[0]);this.bbMax[0]=Math.max(x,this.bbMax[0]);x=l[t+1];this.bbMin[1]=Math.min(x,this.bbMin[1]);this.bbMax[1]=Math.max(x,this.bbMax[1]);x=l[t+2];this.bbMin[2]=Math.min(x,this.bbMin[2]);this.bbMax[2]=Math.max(x,this.bbMax[2])}this.center=e.vec3d.create();e.vec3d.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-
this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(h=0;h<d.length;++h)t=d.data[h],b=l[t]-this.center[0],a=l[t+1]-this.center[1],t=l[t+2]-this.center[2],k=b*b+a*a+t*t,k<=c||(k=Math.sqrt(k),f=.5*(k-this.bsRadius),this.bsRadius+=f,c=this.bsRadius*this.bsRadius,k=f/k,this.center[0]+=b*k,this.center[1]+=a*k,this.center[2]+=t*k);d.clear()}h.prototype.getCenter=function(){return this.center};h.prototype.getBSRadius=function(){return this.bsRadius};h.prototype.getBBMin=function(){return this.bbMin};h.prototype.getBBMax=
function(){return this.bbMax};h.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};h.prototype.getIndices=function(){return this.indices};h.prototype.getPosition=function(){return this._position};h.prototype.getChildren=function(){if(this.children)return this.children;if(1<e.vec3d.dist2(this.bbMin,this.bbMax)){for(var c=e.vec3d.lerp(this.bbMin,this.bbMax,.5,e.vec3d.create()),b=this.primitiveIndices.length,a=new Uint8Array(b),d=Array(8),g=0;8>g;++g)d[g]=0;for(var g=this._position,
k=g.data,f=g.offsetIdx,m=g.strideIdx,g=0;g<b;++g){for(var t=0,w=this._numIndexPerPrimitive*this.primitiveIndices[g],u=f+m*this.indices[w],x=k[u],v=k[u+1],z=k[u+2],y=1;y<this._numIndexPerPrimitive;++y){var u=f+m*this.indices[w+y],A=k[u],B=k[u+1],u=k[u+2];A<x&&(x=A);B<v&&(v=B);u<z&&(z=u)}x<c[0]&&(t|=1);v<c[1]&&(t|=2);z<c[2]&&(t|=4);a[g]=t;++d[t]}for(g=c=0;8>g;++g)0<d[g]&&++c;if(2>c)return;c=Array(8);for(g=0;8>g;++g)c[g]=0<d[g]?new Uint32Array(d[g]):void 0;for(g=0;8>g;++g)d[g]=0;for(g=0;g<b;++g)t=a[g],
c[t][d[t]++]=this.primitiveIndices[g];this.children=Array(8);for(g=0;8>g;++g)void 0!==c[g]&&(this.children[g]=new h(c[g],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return h}();var d=new k;return m})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(m,f,k,e,g){return function(){function d(h,c,b,a){void 0===c&&(c=d.DefaultIndices);void 0===b&&(b=d.DefaultOffsets);void 0===
a&&(a="triangle");this.preinterleaved=!1;var l={},f;for(f in h){var p=h[f],m=p.size;l[f]={data:p.data,size:m,offsetIdx:0,strideIdx:m}}if(c===d.DefaultIndices){c=g.getFirstObjectValue(l);h=e.generateDefaultIndexArray(c.data.length/c.size);c={};for(var r in l)c[r]=h}this._id=e.getNewId();this._vertexAttributes=l;this._indices=c;this._componentOffsets=k.createOffsets(b);this._primitiveType=a}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexCount",{get:function(){return g.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});d.prototype.getVertexAttr=function(){return this.vertexAttributes};d.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};d.prototype.getIndices=function(d){return this._indices[d]};d.prototype.getAttribute=function(d){return this._vertexAttributes[d]};d.prototype.estimateGpuMemoryUsage=function(){var d=0;this._indices.position&&
(d+=12*this._indices.position.length);this._indices.normal&&(d+=12*this._indices.normal.length);this._indices.uv0&&(d+=8*this._indices.uv0.length);this._indices.color&&(d+=4*this._indices.color.length);return d};d.DefaultIndices={};d.DefaultOffsets=new Uint32Array(0);return d}()})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/LineCalloutPrograms".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){function n(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}m=function(b){function c(d,e){e=b.call(this,e)||this;e.bufferWriter=new w;e.params=a.copyParameters(d,q);e._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(e.params);return e}k(c,b);Object.defineProperty(c.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});c.prototype.dispose=function(){};c.prototype.getGLMaterials=
function(){return{color:p,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};c.prototype.intersect=function(a,b,c,d,e,h,g,l){};c.prototype.getParameterValues=function(){return a.copyParameters(this.params)};c.prototype.setParameterValues=function(b){a.updateParameters(this.params,b)&&(this._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};c.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||
[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return c}(d);var p=function(b){function c(a,c,d){a=b.call(this,a,c)||this;a.isRenderSlot=!0;a.updateParameters();return a}k(c,b);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getProgram(l.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,
depthHud:!1,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(l.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled})};c.prototype.beginSlot=function(a){switch(a){case h.LINE_CALLOUTS:return this.isRenderSlot=
!0;case h.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(c.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});c.prototype.getProgram=function(){return this.program};c.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};c.prototype.getDrawMode=function(a){return 4};c.prototype.bind=function(b,c){var d=c.cameraAboveGround?1:-1,e=this.program,h=this.params;
b.bindProgram(e);e.setUniform1f("cameraGroundRelative",d);e.setUniform1f("polygonOffset",h.shaderPolygonOffset);e.setUniform4fv("viewport",c.viewport);e.setUniformMatrix4fv("viewNormal",c.viewInvTransp);e.setUniform1i("hudVisibilityTexture",0);b.bindTexture(c.hudVisibilityTexture,0);n(e,"color",h.color);d=c.pixelRatio||1;e.setUniform1f("pixelRatio",d);e.setUniform2f("screenOffset",h.screenOffset[0]*d,h.screenOffset[1]*d);this.bindBorder(b,c);a.bindVerticalOffset(h.verticalOffset,c,e);this.bindSizing(b,
c);a.bindScreenSizePerspective(h.screenSizePerspective,c,e);this.isRenderSlot?this.bindRender(b,c):this.bindHUDDepth(b,c)};c.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};c.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};c.prototype.bindView=function(b,c){b=this.program;var d=this.params;a.bindView(c.origin,c.view,b);a.bindCamPos(c.origin,
c.viewInvTransp,b);d.slicePlaneEnabled&&a.bindSlicePlane(c.origin,c.slicePlane,b)};c.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};c.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,b):this.releaseHUDDepth(a,b)};c.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};c.prototype.releaseHUDDepth=function(a,
b){a.setColorMask(!0,!0,!0,!0)};c.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size)*(b.pixelRatio||1))};c.prototype.bindBorder=function(a,b){a=this.program;var c=this.params;b=b.pixelRatio||1;null!==c.borderColor?(n(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",b)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return c}(g),q={verticalOffset:null,
screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},r=e.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec3f(c.VertexAttrConstants.NORMAL).vec2f(c.VertexAttrConstants.UV0).vec4f(c.VertexAttrConstants.AUXPOS1),t=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]],w=function(){function a(){this.vertexBufferLayout=r}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[c.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,d,e,h,g){b.writePosition(d.indices[c.VertexAttrConstants.POSITION],d.vertexAttr[c.VertexAttrConstants.POSITION].data,a.transformation,h.position,g,6);b.writeNormal(d.indices[c.VertexAttrConstants.NORMAL],d.vertexAttr[c.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,h.normal,g,6);b.writeBufferVec4(d.indices[c.VertexAttrConstants.AUXPOS1],d.vertexAttr[c.VertexAttrConstants.AUXPOS1].data,
h.auxpos1,g,6);for(a=0;a<t.length;++a)h.uv0.setVec(g+a,t[a])};return a}();return m})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){return g.glslifyDefineMap({OCCL_TEST:d.occlTest,VERTICAL_OFFSET:d.verticalOffset,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,DEPTH_HUD:d.depthHud,
DEPTH_HUD_ALIGN_START:d.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:d.centerOffsetUnitsScreen,SLICE:d.slice})};f.program={name:"line-callout",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory ../../support/PromiseLightweight".split(" "),
function(m,f,k,e,g,d){return function(d){function c(b,a,c){var e=d.call(this)||this;e.symbol=b;b=b.symbolLayers;c&&(b=c.concat(b));c=b.length;e.childGraphics3DSymbols=Array(b.length);e.childGraphics3DSymbolPromises=Array(b.length);for(var h=a.layerOrder,l=0,k=0,f=!1,m=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,k++);l--;!this.isRejected()&&f&&1>l&&(0<k?this.resolve():this.reject())},u=0;u<c;u++){var x=b.getItemAt(u);!1!==x.enabled&&(a.layerOrder=h+(1-(1+u)/c),a.layerOrderDelta=1/c,x=g.make(e.symbol,
x,a,x._ignoreDrivers))&&(l++,e.childGraphics3DSymbolPromises[u]=x,x.then(m.bind(e,u,x),m.bind(e,u,null)))}a.layerOrder=h;f=!0;!e.isRejected()&&1>l&&e.resolve();return e}k(c,d);c.prototype.createGraphics3DGraphic=function(b,a){for(var c=b.graphic,d=Array(this.childGraphics3DSymbols.length),h=0;h<this.childGraphics3DSymbols.length;h++){var g=this.childGraphics3DSymbols[h];g&&(d[h]=g.createGraphics3DGraphic(b))}return new e(c,a||this,d,b.layer)};Object.defineProperty(c.prototype,"numberOfVertices",{get:function(){for(var b=
0,a=0;a<this.childGraphics3DSymbols.length;++a){var c=this.childGraphics3DSymbols[a];c&&(b+=c.numberOfVertices)}return b},enumerable:!0,configurable:!0});c.prototype.layerPropertyChanged=function(b,a){for(var c=this.childGraphics3DSymbols.length,d=function(c){var d=e.childGraphics3DSymbols[c],h=function(a){return a._graphics[c]};if(d&&!d.layerPropertyChanged(b,a,h))return{value:!1}},e=this,h=0;h<c;h++){var g=d(h);if("object"===typeof g)return g.value}return!0};c.prototype.applyRendererDiff=function(b,
a,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(d,e,h){return d&&(!e||e.applyRendererDiff(b,a,c,h))},!0):!1};c.prototype.getFastUpdateStatus=function(){var b=0,a=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(d){d&&!d.isFulfilled()?b++:d&&d.isFastUpdatesEnabled()?c++:d&&a++});return{loading:b,slow:a,fast:c}};c.prototype.setDrawOrder=function(b,a){for(var c=this.childGraphics3DSymbols.length,d=1/c,e=0;e<c;e++){var h=this.childGraphics3DSymbols[e];h&&h.setDrawOrder(b+
(1-(1+e)/c),d,a)}};c.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var b=0;b<this.childGraphics3DSymbolPromises.length;b++)this.childGraphics3DSymbolPromises[b]&&this.childGraphics3DSymbolPromises[b].destroy()};return c}(d.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/has ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DObjectSymbolLayerLod ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){Object.defineProperty(f,"__esModule",{value:!0});var q=e.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");f.make=function(a,b,c,d){var e=t[a.type]&&t[a.type][b.type]||r[b.type];return e?new e(a,b,c,d):(q.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var r={icon:d,object:k("enable-feature:skallweit/lod-rendering")?a:b,line:h,path:l,fill:n,extrude:g,text:p},t={"mesh-3d":{fill:c}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/earcut/earcut ../../../../geometry/Point ../../../../geometry/Polygon ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){function v(a,b,c,d,e,h,g,l,k,f,p,m,q,r){var u=c.length/3,v=0;p+=2*d.count;var t=d.index,w=d.count,z=k,x=p;n.vec3d.set(q,B);var A=0<m?1:-1,t=3*t,N=z;q=3*N;for(var I=z+w,z=3*I,D=0;D<w;++D)r&&(B[0]=a[t+0],B[1]=a[t+1],B[2]=a[t+2],n.vec3d.normalize(B)),e[q+0]=a[t+0],e[q+1]=a[t+1],e[q+2]=a[t+2],h[q+0]=b[t+0],h[q+1]=b[t+1],h[q+2]=b[t+2],g[q+0]=-A*B[0],g[q+1]=-A*B[1],g[q+2]=-A*B[2],l[N]=0,e[z+0]=a[t+0]+m*B[0],e[z+1]=a[t+1]+m*B[1],e[z+2]=a[t+2]+m*B[2],h[z+0]=
b[t+0],h[z+1]=b[t+1],h[z+2]=b[t+2],g[z+0]=A*B[0],g[z+1]=A*B[1],g[z+2]=A*B[2],l[I]=m,q+=3,z+=3,t+=3,N+=1,I+=1;t=0;q=3*x;z=3*(x+u);q=3*(x+u);z=3*x;a=C;b=E;0>m&&(a=E,b=C);for(D=0;D<u;++D)f[q+0]=c[t+a[0]],f[q+1]=c[t+a[1]],f[q+2]=c[t+a[2]],f[z+0]=c[t+b[0]]+w,f[z+1]=c[t+b[1]]+w,f[z+2]=c[t+b[2]]+w,q+=3,z+=3,t+=3;k+=2*d.count;p=p+2*u-(2*d.count+2*u);y(e,h,l,g,v,d.pathLengths[0],d.count,k,f,p,m);k+=4*d.pathLengths[0];p+=2*d.pathLengths[0];v+=d.pathLengths[0];for(c=1;c<d.pathLengths.length;++c)y(e,h,l,g,v,
d.pathLengths[c],d.count,k,f,p,m),k+=4*d.pathLengths[c],p+=2*d.pathLengths[c],v+=d.pathLengths[c]}function z(a,b,c,d,e,h,g){d[h]=d[g];g*=3;h*=3;a[h+0]=a[g+0];a[h+1]=a[g+1];a[h+2]=a[g+2];b[h+0]=b[g+0];b[h+1]=b[g+1];b[h+2]=b[g+2];c[h+0]=e[0];c[h+1]=e[1];c[h+2]=e[2]}function y(a,b,c,d,e,h,g,l,k,f,p){var m=e,q=e+1,r=e+g,u=e+g+1,v=l,t=l+1,w=l+2*h;l=l+2*h+1;0>p&&(m=e+g+1,u=e);f*=3;for(var y=0;y<h;++y){y===h-1&&(0<p?(q=e,u=e+g):(q=e,m=e+g));var x=a,A=m,C=q,B=r,E=M,A=3*A,C=3*C,B=3*B;n.vec3d.set3(x[A++],x[A++],
x[A++],N);n.vec3d.set3(x[C++],x[C++],x[C++],I);n.vec3d.set3(x[B++],x[B++],x[B++],G);n.vec3d.subtract(I,N,O);n.vec3d.subtract(G,N,J);n.vec3d.cross(J,O,E);n.vec3d.normalize(E,E);z(a,b,d,c,M,v,m);z(a,b,d,c,M,t,q);z(a,b,d,c,M,w,r);z(a,b,d,c,M,l,u);k[f++]=v;k[f++]=w;k[f++]=l;k[f++]=v;k[f++]=l;k[f++]=t;m++;q++;r++;u++;v+=2;t+=2;w+=2;l+=2}}var A=n.vec3d.create(),B=n.vec3d.create(),C=[0,2,1],E=[0,1,2],D=new g,F={verticalDistanceToGround:0,terrainElevation:0};m=function(b){function g(){var a=null!==b&&b.apply(this,
arguments)||this;a._edgeStageObjects=new Set;return a}k(g,b);g.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var b=a.validateSymbolLayerSize(this._getSymbolSize());if(b){this._logWarning(b);this.reject();return}}var b=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),d=n.vec3d.create(c),c=c[3],d={diffuse:d,ambient:d,opacity:c,transparent:1>c||this._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new x(d,
b+"_3dlinemat");this._context.stage.add(q.ModelContentType.MATERIAL,this._material);this.resolve()};g.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(q.ModelContentType.MATERIAL,this._material.id)};g.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+c.type),
null;if(!this._validateGeometry(c))return null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b,Float32Array,255),h=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,e,h,d,a.uid)};g.prototype.layerPropertyChanged=function(a,b,d){if("opacity"===a){b=this._getMaterialOpacity();d=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:b,transparent:d});if(0<this._edgeStageObjects.size){var e=
this._context.stage.view.getEdgeView(),h=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){e.updateAllComponentOpacities(a,[h])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var l=b[g];if(a=d(l))l=this.getGraphicElevationContext(l.graphic),a.needsElevationUpdates=c.needsElevationUpdates3D(l.mode),a.elevationContext.set(l)}return!0}return!1};Object.defineProperty(g.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});
g.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?c.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};g.prototype._getSymbolSize=function(){return this.symbol.size||1};g.prototype._createAs3DShape=function(a,b,g,k,f,m,q){var t=this,z=a.geometry;"extent"===z.type&&(z=d.fromExtent(z));a=z[b];var y=[],x=[],C=[],N=n.vec3d.create(),B=Array(6),I=this._context.renderSpatialReference===p.SphericalECEFSpatialReference,
E=this._getExtrusionSize(g),M=n.vec3d.create();I||this._context.renderCoordsHelper.worldUpAtPosition(null,M);g=c.getGeometryVertexData3D(a,z.hasZ,z.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(g,a,b,"ExtrudeSymbol3DLayer");if(0<a.length){var G=g.geometryData.polygons,O=g.eleVertexData,T=g.vertexData;b=T.length/3;var J=new Float64Array(18*b),X=new Float64Array(18*b),L=new Float64Array(18*
b),S=new Float64Array(6*b),K=0;b=function(a){var b=G[a],d=b.count,h=b.index;if(R._context.clippingExtent&&(c.computeBoundingBox(O,h,d,B),c.boundingBoxClipped(B,R._context.clippingExtent)))return"continue";var g=new Float64Array(O.buffer,3*h*J.BYTES_PER_ELEMENT,3*d),l=b.holeIndices.map(function(a){return a-h}),g=e(g,l,3);if(0<g.length){c.chooseOrigin(T,h,d,N);var l=new Uint32Array(6*d+2*g.length),f=6*d,p=new Float64Array(J.buffer,3*K*J.BYTES_PER_ELEMENT,3*f),q=new Float64Array(X.buffer,3*K*X.BYTES_PER_ELEMENT,
3*f),u=new Float64Array(L.buffer,3*K*L.BYTES_PER_ELEMENT,3*f),t=new Float64Array(S.buffer,1*K*S.BYTES_PER_ELEMENT,1*f);v(T,O,g,b,p,u,q,t,0,l,0,E,M,I);c.subtractCoordinates(p,0,f,N);K+=6*d;b=R._createExtrudeGeometry(l,{positions:p,elevation:u,normals:q,heights:t},k);a=new r(b,m+"path"+a);a.singleUse=!0;y.push(a);x.push([R._material]);a=n.mat4d.identity();n.mat4d.translate(a,N,a);C.push(a)}};var R=this;for(a=0;a<G.length;++a)b(a);if(0<y.length){var P=new w({geometries:y,materials:x,transformations:C,
castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:q},idHint:m}),Y=function(a){var b=t._context.stage.view.getEdgeView();if(b){b.removeObject(a);t._edgeStageObjects.delete(a);var c={opacity:t._getLayerOpacity(),slicePlaneEnabled:t._context.slicePlaneEnabled};if(c=l.createMaterial(b,t.symbol,c))t._edgeStageObjects.add(a),b.addObject(a,[c])}};Y(P);q=new h(this,P,y,null,null,function(a,b,d,e){a=a.stageObject;var h=e.setAltitude;D.spatialReference=d.spatialReference;for(var g=a.getGeometryRecords(),
l=g.length,k="absolute-height"!==b.mode,f=0,n=0;n<l;n++){var p=g[n].geometry,m=g[n].transformation;H[0]=m[12];H[1]=m[13];H[2]=m[14];p.invalidateBoundingInfo();for(var q=p.data.getVertexAttr(),p=q[u.VertexAttrConstants.POSITION].data,m=q[u.VertexAttrConstants.SIZE].data,q=q.mapPos.data,r=p.length/3,v=0,t=0,w=!1,z=0,y=0;y<r;y++){D.x=q[t];D.y=q[t+1];D.z=q[t+2];Q[0]=p[v];Q[1]=p[v+1];Q[2]=p[v+2];var x=c.computeElevation(d,D,b,e,k?F:null);k&&(z+=F.terrainElevation);A[0]=p[v]+H[0];A[1]=p[v+1]+H[1];A[2]=
p[v+2]+H[2];h(x+m[v/3],A);p[v]=A[0]-H[0];p[v+1]=A[1]-H[1];p[v+2]=A[2]-H[2];x=.01/e.unitInMeters;if(Math.abs(Q[0]-p[v])>x||Math.abs(Q[1]-p[v+1])>x||Math.abs(Q[2]-p[v+2])>x)w=!0;t+=3;v+=3}w&&a.geometryVertexAttrsUpdated(n);f+=z/r}b=f/l;Y(P);return b},f);q.alignedTerrainElevation=g.terrainElevation;q.needsElevationUpdates=c.needsElevationUpdates3D(f.mode);return q}}return null};g.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),h=0;h<d;h++)e[h]=0;d={};h={};d[u.VertexAttrConstants.POSITION]=
a;d[u.VertexAttrConstants.NORMAL]=a;d[u.VertexAttrConstants.COLOR]=e;h[u.VertexAttrConstants.POSITION]={size:3,data:b.positions};h[u.VertexAttrConstants.NORMAL]={size:3,data:b.normals};h[u.VertexAttrConstants.COLOR]={size:4,data:c};h[u.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(h.mapPos={size:3,data:b.elevation},d.mapPos=a);return new t(h,d)};return g}(b);var M=n.vec3d.create(),N=n.vec3d.create(),I=n.vec3d.create(),G=n.vec3d.create(),O=n.vec3d.create(),J=n.vec3d.create(),Q=n.vec3d.create(),
H=n.vec3d.create();return m})},"esri/views/3d/layers/support/edgeUtils":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(m,f,k,e){function g(d,h,c){if(!h)return null;var b=k.toUnitRGBA(h.color),a=c.opacity;c=c.slicePlaneEnabled;switch(h.type){case "solid":return d.createSolidEdgeMaterial({color:b,size:e.pt2px(h.size),extensionLength:e.pt2px(h.extensionLength),opacity:a,slicePlaneEnabled:c});case "sketch":return d.createSketchEdgeMaterial({color:b,
size:e.pt2px(h.size),extensionLength:e.pt2px(h.extensionLength),opacity:a,slicePlaneEnabled:c})}}Object.defineProperty(f,"__esModule",{value:!0});f.createMaterial=function(d,e,c){return g(d,e&&e.enabled&&e.edges||null,c)};f.createMaterialFromEdges=g})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../layers/graphics/graphicUtils ../../lib/gl-matrix ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ../shaders/DefaultPrograms".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){function t(a,b,c){c=b.slicePlaneEnabled?!1:b.cullFace?"none"!==b.cullFace:!b.transparent&&!b.doubleSided;c?(a.setFaceCullingEnabled(!0),"front"===b.cullFace?a.setCullFace(1028):a.setCullFace(1029)):a.setFaceCullingEnabled(!1)}function w(b,c){return b?a.TRANSPARENT_MATERIAL:c?a.STENCIL_MATERIAL:a.OPAQUE_MATERIAL}function u(a,b){var c=b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),
a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):c&&a.setUniform3fv("vvSizeValue",b.vvSizeValue);c&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),g.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],d.mat4d.identity(M)),a.setUniformMatrix3fv("vvSymbolRotation",d.mat4d.toMat3(M,F)));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}var x=l.assert;
m=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.params=q.copyParameters(c,C);d.instanced=!!c.instanced;d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=d.instanced?b.getInstanceBufferLayout(d.params):null;d.bufferWriter=new E(d.vertexBufferLayout,d.instanceBufferLayout);return d}k(b,a);b.prototype.isVisible=function(){var b=this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.instanced,d=b.vertexColors,e=b.symbolColors,
c=!!c&&-1<c.indexOf("color"),h=b.vvColorEnabled,g="replace"===b.colorMixMode,l=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&(c||h||e)?g?!0:l:d?g?b:l:c||h||e?g?!0:l:g?b:l};b.prototype.getParams=function(){return this.params};b.prototype.getParameterValues=function(){return q.copyParameters(this.params)};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&x(b.textureId,"Can only change texture of material that already has a texture"),"castShadows"===
c&&x(a.castShadows===b.castShadows,"Can not change shadow casting behavior."),b[c]=a[c];this.notifyDirty("matChanged")};b.prototype.intersect=function(a,b,c,e,h,g,l,k){if(null!==this.params.verticalOffset){k=e.camera;d.vec3d.set3(c[12],c[13],c[14],Q);var f=d.vec3d.subtract(Q,k.eye,H),n=d.vec3d.length(f),p=d.vec3d.scale(f,1/n),m=null,f=null;switch(e.viewingMode){case "global":f=d.vec3d.normalize(Q,O);break;case "local":f=d.vec3d.set(G,O)}this.params.screenSizePerspective&&(m=d.vec3d.dot(f,p));k=q.verticalOffsetAtDistance(k,
n,this.params.verticalOffset,m,this.params.screenSizePerspective);d.vec3d.scale(f,k);d.mat3d.multiplyVec3(e.transformInverseRotation,f,J);h=d.vec3d.subtract(h,J,N);g=d.vec3d.subtract(g,J,I)}q.intersectTriangleGeometry(a,b,c,e,h,g,l)};b.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:this.params.castShadows?y:null,normal:A,depth:z,highlight:B}};b.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]};b.getVertexBufferLayout=function(a){var b=
h.newLayout().vec3f("position");a.groundNormalShading||(b=a.compressedNormals?b.vec2i16("normalCompressed",{glNormalized:!0}):b.vec3f("normal"));a.textureId&&(b=b.vec2f("uv0"),a.atlasRegions&&(b=b.vec4u16("region",{glNormalized:!0})));a.vertexColors&&(b=b.vec4u8("color"));a.symbolColors&&(b=b.vec4u8("symbolColor"));a.componentIndices&&(b=b.u16("componentIndex").u16("_padding",{glPadding:!0}));return b};b.getInstanceBufferLayout=function(a){var b=h.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):
b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return b};return b}(b);var v=function(a){function b(b,c,d){var e=this,h=b.getParams(),e=a.call(this,b,c,d,h.textureId,h.textureInitTransparent)||this;e.params=q.copyParameters(h);b=e.params;e.slot=w(b.transparent,b.writeStencil);e.texturing=b.textureId?b.atlasRegions?"AtlasTextured":"Textured":
"none";b=b.instanced;e.instanced=!!b;e.instancedColor=!!b&&-1<b.indexOf("color");e._createPrograms();return e}k(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=p.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(r.colorPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:b.vertexColors,symbolColors:b.symbolColors,
flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:b.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,groundNormalShading:b.groundNormalShading,
compressedNormals:b.compressedNormals,componentColor:null!=b.componentColorBuffer,transparencyDiscard:b.transparent,alphaCoverageCorrection:D})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return p.BindParametersMap.programs(this.programs)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.slot=w(this.params.transparent,this.params.writeStencil);
this.updateTexture(this.params.textureId);this._createPrograms()};b.prototype.bind=function(a,b){var c=this.params,d=this.program=p.BindParametersMap.lookup(this.programs,b);a.bindProgram(d);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",c.specular);d.setUniform4fv("externalColor",c.externalColor);d.setUniform1i("colorMixMode",q.colorMixModes[c.colorMixMode]);d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);q.bindVerticalOffset(c.verticalOffset,
b,d);q.bindScreenSizePerspective(c.screenSizePerspective,b,d);u(d,c);this.bindTexture(a,d);"none"!==this.texturing&&this.bindTextureSize(a,d);a.setBlendFunctionSeparate(770,771,1,771);c.inverseWindingOrder&&a.setFrontFace(2304);c.transparent?(a.setBlendingEnabled(!0),c.blendModeOneOne?(a.setBlendFunction(1,1),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(770,771,1,771)):a.setBlendingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));t(a,c,b);a.setDepthTestEnabled(!0);
c.componentIndices&&c.componentColorBuffer&&(c.componentColorBuffer.updateTexture(),c.componentColorBuffer.bind(d,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}))};b.prototype.release=function(a,b){a.setPolygonOffsetFillEnabled(!1);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthWriteEnabled(!0);a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program=p.BindParametersMap.lookup(this.programs,b);var c=
this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;q.bindView(d,b.view,a);q.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&q.bindViewOriginDouble(d,a);c.slicePlaneEnabled&&q.bindSlicePlane(d,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=
function(a){return 4};return b}(c),z=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=q.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.biased=e;c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};
b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,
alphaCoverageCorrection:D})};b.prototype.selectSlot=function(){this.slot=w(this.params.transparent,this.params.writeStencil)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform2fv("nearFar",b.nearFar);d.inverseWindingOrder&&a.setFrontFace(2304);q.bindVerticalOffset(d.verticalOffset,b,c);q.bindScreenSizePerspective(d.screenSizePerspective,
b,c);u(c,d);this.bindTexture(a,c);t(a,d,b);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;q.bindView(d,b.view,a);c.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&q.bindCamPos(d,b.viewInvTransp,
a);c.instancedDoublePrecision&&q.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 4};return b}(c),y=function(a){function b(b,c,d){return a.call(this,b,c,d,!0)||this}k(b,a);return b}(z),A=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=q.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?
c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,
verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:D})};b.prototype.selectSlot=function(){this.slot=w(this.params.transparent,this.params.writeStencil)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};
b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);this.bindTexture(a,c);q.bindVerticalOffset(d.verticalOffset,b,c);q.bindScreenSizePerspective(d.screenSizePerspective,b,c);u(c,d);t(a,d,b);d.inverseWindingOrder&&a.setFrontFace(2304);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?
[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;q.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&q.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&q.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=
function(a){return 4};return b}(c),B=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=q.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=
function(){this.program=this.programRep.getProgram(r.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:D})};
b.prototype.selectSlot=function(){this.slot=w(this.params.transparent,this.params.writeStencil)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);this.bindTexture(a,c);q.bindVerticalOffset(d.verticalOffset,b,c);q.bindScreenSizePerspective(d.screenSizePerspective,b,c);u(c,d);t(a,d,b);d.inverseWindingOrder&&
a.setFrontFace(2304);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2304)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;q.bindView(d,b.view,a);c.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&q.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&
q.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return 4};return b}(c),C={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,
componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,
0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},E=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,d,e){n.writeDefaultAttributes(b,c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,
d,e)};return a}(),D=!!e("enable-feature:skallweit/lod-rendering"),F=d.mat3d.create(),M=d.mat4d.create(),N=d.vec3d.create(),I=d.vec3d.create(),G=d.vec3d.createFrom(0,0,1),O=d.vec3d.create(),J=d.vec3d.create(),Q=d.vec3d.create(),H=d.vec3d.create();return m})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});
var d=function(d){return g.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===d.viewingMode,VIEWING_MODE_LOCAL:"local"===d.viewingMode,TEXTURING:"none"!==d.textureMode,TEXTURE_ATLAS:"AtlasTextured"===d.textureMode,VERTEXCOLORS:d.vertexColors,SYMBOLVERTEXCOLORS:d.symbolColors,FLIPV:d.flipV,DOUBLESIDED:d.doubleSided,WINDINGORDERDOUBLESIDED:d.windowOrderDoubleSided,INSTANCED:d.instanced,INSTANCED_DOUBLE_PRECISION:d.instancedDoublePrecision,INSTANCEDCOLOR:d.instancedColor,RECEIVE_SHADOWS:d.receiveShadows,
RECEIVE_SSAO:d.receiveSSAO,VV_SIZE:d.vvSize,VV_COLOR:d.vvColor,VERTICAL_OFFSET:d.verticalOffset,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,SLICE:d.slice,GROUND_NORMAL_SHADING:d.groundNormalShading,COMPRESSED_NORMALS:d.compressedNormals,COMPONENTCOLORS:d.componentColor,TRANSPARENCY_DISCARD:d.transparencyDiscard,ALPHA_COVERAGE_CORRECTION:d.alphaCoverageCorrection,BIAS_SHADOWMAP:d.shadowMap})};f.colorPass={name:"default-color",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/defaultMaterial/colorPass.vert"),
fragmentShader:d(h)+e.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:k.Default3D};f.depthPass={name:"default-depth",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:k.Default3D};f.normalPass={name:"default-normal",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/defaultMaterial/normalPass.vert"),
fragmentShader:d(h)+e.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"default-highlight",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper dojo/when dojo/errors/CancelError ../../../../Color ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/screenUtils ../../../../core/urlUtils ../../../../symbols/support/symbolUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./SignedDistanceFunctions ../support/FastSymbolUpdates ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M){function N(a){return"cross"===a||"x"===a}function I(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case P.PRIM_CIRCLE:b=v.computeSignedDistancefieldCicle(128,64);break;case P.PRIM_SQUARE:b=v.computeSignedDistancefieldSquare(128,64,!1);break;case P.PRIM_KITE:b=v.computeSignedDistancefieldSquare(128,64,!0);break;case P.PRIM_CROSS:b=v.computeSignedDistancefieldCrossAndX(128,64,!1);break;case P.PRIM_X:b=v.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new F(b,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var G=y.mat4d.identity(),O=[0,0,1],J=[0,0,0,0],Q=[0,0,0],H=[1,1,1],K="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),R=[.25,.25,.75,.75],P={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},L=[64,64];m=function(f){function m(){var a=null!==f&&f.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};
return a}e(m,f);m.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?l.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var c=this._getStageIdHint();if(!this._isPropertyDriven("size")){var d=x.validateSymbolLayerSize(b);if(d){this._logWarning(d);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var e=a.resource||{primitive:"circle",href:void 0},d={anchorPos:this._getAnchorPos(a)},h=this.symbolContainer;if(this._hasVisibleVerticalOffset(h)){var h=
h.verticalOffset,g=h.minWorldLength,k=h.maxWorldLength;d.verticalOffset={screenLength:l.pt2px(h.screenLength),minWorldLength:g||0,maxWorldLength:null!=k?k:Infinity}}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);e.href?(this._outlineSize=this._getOutlineSize(a,null),d.color=this._getFillColor(a,null),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,d.textureIsSignedDistanceField=!1,this._prepareImageResources(b,
d,c)):(e=e.primitive||"circle",h="primitive:"+e,this._primitive=e,this._outlineSize=this._getOutlineSize(a,e),d.color=this._getFillColor(a,e),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,N(e)&&0===d.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(h,I),this._textureURI=h,d.textureIsSignedDistanceField=!0,d.distanceFieldBoundingBox=R,d.textureId=this.texture.id,this._size=[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(d,
this._context.stage,c),this.resolve()))};m.prototype._getOutlineSize=function(a,b){var c=0,c=a.outline&&null!=a.outline.size?l.pt2px(a.outline.size):N(b)?1.5:0;return Math.max(c,0)};m.prototype._getOutlineColor=function(a){var b=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var c=h.toUnitRGB(a.outline.color);return[c[0],c[1],c[2],a.outline.color.a*b]}return[0,0,0,b]};m.prototype._getFillColor=function(a,b){return N(b)?J:this._getMaterialOpacityAndColor()};m.prototype._getAnchorPos=
function(a){return-1<K.indexOf(a.anchor)?a.anchor:"center"};m.prototype._prepareImageResources=function(a,e,h){var l=this,k=p.getIconHref(this.symbolContainer,this.symbol);!b("esri-canvas-svg-support")&&n.isSVG(k)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new c("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(g(this._context.sharedResources.textures.acquire(k,null,a),function(b){if(!l.isRejected()){var c=
b.params,d=c.width/c.height;l._size=a?1<d?[a,Math.round(a/d)]:[Math.round(a*d),a]:[c.width,c.height];e.textureId=b.id;l._createMaterialsAndAddToStage(e,l._context.stage,h);l.resolve()}},function(a){a instanceof d?l.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+k+")",l._logWarning(a),l.reject(new c("Request Failed",a)))}),this._textureURI=k)};m.prototype._createMaterialsAndAddToStage=function(b,c,d){this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&a.mixin(b,this._fastUpdates.materialParameters);var e=k({},b);e.verticalOffset=null;e.screenSizePerspective=null;e.occlusionTest=!1;e.slicePlaneEnabled=!1;e.shaderPolygonOffset=0;this._drapedMaterial=new M(e,d+"_iconDraped");c.add(B.ModelContentType.MATERIAL,this._drapedMaterial);b.occlusionTest=!0;b.slicePlaneEnabled=this._context.slicePlaneEnabled;this._material=new M(b,d+"_icon");c.add(B.ModelContentType.MATERIAL,this._material)};
m.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(B.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(B.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};m.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&
a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=l.pt2px(c))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};m.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;if(!this._validateGeometry(a.geometry))return null;var c=w.placePointOnGeometry(a.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+
a.geometry.type),null;var d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b),h=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(h=this._getScaleFactor(b));h*=this._symbolTextureRatio;b=[this._size[0]*h,this._size[1]*h];h=this.getGraphicElevationContext(a);return"on-the-ground"===h.mode?this._createAsOverlay(a,c,e,b,h,d,a.uid):this._createAs3DShape(a,c,e,b,h,d,a.uid)};m.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),
this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=w.needsElevationUpdates2D(d)||
"absolute-height"===d;for(var e in b){var h=b[e];(d=c(h))&&"object3d"===d.type&&(h=this.getGraphicElevationContext(h.graphic),d.needsElevationUpdates=a,d.elevationContext.set(h))}return!0}return!1};m.prototype.applyRendererDiff=function(a,b,c,d){for(var e in a.diff)switch(e){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);
else return!1;break;default:return!1}return!0};m.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,c.add(this._drapedMaterial.id))};Object.defineProperty(m.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});m.prototype._defaultElevationInfoNoZ=function(){return T};m.prototype._createAs3DShape=function(a,b,c,d,e,h,g){var l=this,k=this.getFastUpdateAttrValues(a);a=k?function(a){return z.evaluateModelTransform(l._fastUpdates.materialParameters,
k,a)}:null;c=E.createPointGeometry(O,null,c,d,S,null,k);c=[new C(c,h)];h=w.createStageObjectForPoint.call(this,b,c,[[this._material]],null,null,e,h,this._context.layer.uid,g,!0,a);if(null===h)return null;var f=new t(this,h.object,c,null,null,q.perObjectElevationAligner,e);f.alignedTerrainElevation=h.terrainElevation;f.needsElevationUpdates=w.needsElevationUpdates2D(e.mode)||"absolute-height"===e.mode;f.getScreenSize=this._createScreenSizeGetter(d,a);f.calculateRelativeScreenBounds=function(a){return l._material.calculateRelativeScreenBounds(f.getScreenSize(),
1,a)};w.extendPointGraphicElevationContext(f,b,this._context.elevationProvider);return f};m.prototype._createAsOverlay=function(a,b,c,d,e,h,g){var l=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;e=y.vec3d.create();A.pointToVector(b,e,this._context.overlaySR);e[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!w.pointInBox2D(e,b))return null;var k=this.getFastUpdateAttrValues(a);a=k?function(a){return z.evaluateModelTransform(l._fastUpdates.materialParameters,k,a)}:null;
c=E.createPointGeometry(O,e,c,d,null,null,k);b=new D(c);b.material=this._drapedMaterial;b.center=e;b.bsRadius=0;b.transformation=G;b.name=h;b.uniqueName=h+"#"+c.id;var f=new r(this,[b],null);f.getScreenSize=this._createScreenSizeGetter(d,a);f.calculateRelativeScreenBounds=function(a){return l._drapedMaterial.calculateRelativeScreenBounds(f.getScreenSize(),1,a)};return f};m.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,
e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=Array(2));var h=b(G);a[0]=h[0]*d+c;a[1]=h[5]*e+c;return a}}var h=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=Array(2));a[0]=h;a[1]=g;return a}};m.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],c=l.px2pt(1),a=a*c;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:c,transformation:{anchor:Q,scale:H,rotation:Q}}};
m.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};m.PRIMITIVE_SIZE=L;m.VALID_ANCHOR_STRINGS=K;return m}(u);var T={mode:"relative-to-ground",offset:0},S=y.vec4d.createFrom(0,0,0,1);return m})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/has"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.isVolumetricSymbol=function(e){return(e=
e&&e.symbolLayers)?e.some(function(d){d=d.type;return"object"===d||"path"===d||"extrude"===d}):!1};f.getIconHref=function(g,d){d=d.resource.href;return!k("esri-canvas-svg-support")&&g.styleOrigin&&e.test(d)?d.replace(e,"/resource/png/$1.png"):d};var e=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(m,f,k,e,g,d,h,c){m=function(){function h(a,b,c){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}h.prototype.initialize=function(a,b){this.stage=b};h.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),!0):
!1};h.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null};h.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};h.prototype.getCenterObjectSpace=function(){return[0,0,0]};h.prototype.addHighlight=function(a,b){var c=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(d){var e=c.addRenderGeometryHighlight(d,
b);a.addRenderGeometry(d,c,e)})};h.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};h.prototype.getProjectedBoundingBox=function(a,h,k,f){return g(this,void 0,void 0,function(){var g,n,p,m;return e(this,function(e){switch(e.label){case 0:d.empty(k);for(g=0;g<this.renderGeometries.length;g++)n=this.renderGeometries[g],this._getRenderGeometryProjectedBoundingRect(n,b,a,f),d.expand(k,b);if(!h)return[3,5];d.center(k,l);p=void 0;m=c.demResolutionForBoundingBox(k,
h);e.label=1;case 1:return e.trys.push([1,3,,4]),[4,h.service.queryElevation(l[0],l[1],m)];case 2:return p=e.sent(),[3,4];case 3:return e.sent(),p=null,[3,4];case 4:null!=p&&(k[2]=Math.min(k[2],p),k[5]=Math.max(k[5],p)),e.label=5;case 5:return[2,k]}})})};h.prototype._getRenderGeometryProjectedBoundingRect=function(b,c,e,h){if(this.boundingBox)d.set(a,this.boundingBox);else{var g=b.center;b=b.bsRadius;a[0]=g[0]-b;a[1]=g[1]-b;a[2]=g[2]-b;a[3]=g[0]+b;a[4]=g[1]+b;a[5]=g[2]+b}e(a,0,2);this.calculateRelativeScreenBounds&&
h.push({location:d.center(a),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return d.toRect(a,c)};return h}();var b=h.create(),a=d.create(),l=[0,0,0];return m})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.computeSignedDistancefieldCicle=function(e,g){var d=new Uint8Array(4*e*e),h=e/2-.5;g/=2;for(var c=0;c<e;c++)for(var b=0;b<e;b++){var a=
b+e*c,l=b-h,f=c-h,l=Math.sqrt(l*l+f*f)-g,l=l/e+.5;k.packFloatRGBA(l,d,4*a)}return d};f.computeSignedDistancefieldSquare=function(e,g,d){d&&(g/=Math.SQRT2);for(var h=new Uint8Array(4*e*e),c=0;c<e;c++)for(var b=0;b<e;b++){var a=b-.5*(e-.5),l=c-.5*(e-.5),f=c*e+b;if(d)var p=(a+l)/Math.SQRT2,l=(l-a)/Math.SQRT2,a=p;a=Math.max(Math.abs(a),Math.abs(l))-.5*g;a=a/e+.5;k.packFloatRGBA(a,h,4*f)}return h};f.computeSignedDistancefieldCrossAndX=function(e,g,d){d&&(g*=Math.SQRT2);g*=.5;for(var h=new Uint8Array(4*
e*e),c=0;c<e;c++)for(var b=0;b<e;b++){var a=b-.5*e,l=c-.5*e,f=c*e+b;if(d)var p=(a+l)/Math.SQRT2,l=(l-a)/Math.SQRT2,a=p;p=void 0;a=Math.abs(a);l=Math.abs(l);p=a>l?a>g?Math.sqrt((a-g)*(a-g)+l*l):l:l>g?Math.sqrt(a*a+(l-g)*(l-g)):a;p=p/e+.5;k.packFloatRGBA(p,h,4*f)}return h}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../graphics/graphicUtils","../../lib/gl-matrix"],function(m,f,k,e,g){function d(a){return null!==a&&
void 0!==a}function h(a){return"number"===typeof a}function c(a,b){a&&a.push(b)}function b(b,e,g,l,f){var n=b.minSize,p=b.maxSize;if(b.expression)return c(f,"Could not convert size info: expression not supported"),!1;if(b.useSymbolValue)return b=l.symbolSize[g],e.minSize[g]=b,e.maxSize[g]=b,e.offset[g]=e.minSize[g],e.factor[g]=0,e.type[g]=1,!0;if(d(b.field)){if(d(b.stops)){if(2===b.stops.length&&h(b.stops[0].size)&&h(b.stops[1].size))return a(b.stops[0].size,b.stops[1].size,b.stops[0].value,b.stops[1].value,
e,g),e.type[g]=1,!0;c(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(h(n)&&h(p)&&d(b.minDataValue)&&d(b.maxDataValue))return a(n,p,b.minDataValue,b.maxDataValue,e,g),e.type[g]=1,!0;if(null!=k.meterIn[b.valueUnit])return e.minSize[g]=-Infinity,e.maxSize[g]=Infinity,e.offset[g]=0,e.factor[g]=1/k.meterIn[b.valueUnit],e.type[g]=1,!0;"unknown"===b.valueUnit?c(f,"Could not convert size info: proportional size not supported"):c(f,"Could not convert size info: scale-dependent size not supported");
return!1}if(!d(b.field)){if(b.stops&&b.stops[0]&&h(b.stops[0].size))return e.minSize[g]=b.stops[0].size,e.maxSize[g]=b.stops[0].size,e.offset[g]=e.minSize[g],e.factor[g]=0,e.type[g]=1,!0;if(h(n))return e.minSize[g]=n,e.maxSize[g]=n,e.offset[g]=n,e.factor[g]=0,e.type[g]=1,!0}c(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function a(a,b,c,d,e,h){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[h]=0<d?a:b;e.maxSize[h]=0<d?b:a;e.offset[h]=a-c*d;e.factor[h]=d}function l(a,d,e,h){if(a.normalizationField||
a.valueRepresentation)return c(h,"Could not convert size info: unsupported property"),null;var g=a.field;if(null!=g&&"string"!==typeof g)return c(h,"Could not convert size info: field is not a string"),null;if(!d.size)d.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!d.size.field)d.size.field=a.field;else if(a.field!==d.size.field)return c(h,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(g=
b(a,d.size,0,e,h))?d:null;case "height":return(g=b(a,d.size,2,e,h))?d:null;case "depth":return(g=b(a,d.size,1,e,h))?d:null;case "width-and-depth":return(g=b(a,d.size,0,e,h))&&b(a,d.size,1,e,h),g?d:null;case null:case void 0:case "all":return(g=(g=(g=b(a,d.size,0,e,h))&&b(a,d.size,1,e,h))&&b(a,d.size,2,e,h))?d:null;default:return c(h,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function n(a,b,d){for(var e=0;3>e;++e){var h=b.unitInMeters;1===a.type[e]&&(h*=b.modelSize[e],a.type[e]=
2);a.minSize[e]/=h;a.maxSize[e]/=h;a.offset[e]/=h;a.factor[e]/=h}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return c(d,"No size axis contains a valid size or scale"),!1;for(e=0;3>e;++e)0===a.type[e]&&(a.minSize[e]=a.minSize[b],a.maxSize[e]=a.maxSize[b],a.offset[e]=a.offset[b],a.factor[e]=a.factor[b],a.type[e]=a.type[b]);return!0}function p(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function q(a,b,e){if(a.normalizationField)return c(e,
"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return c(e,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(e=0;8>e;++e){var h=a[Math.min(e,a.length-1)];b.color.values[e]=h.value;p(b.color.colors,e,h.color)}}else if(a.colors){if(!d(a.minDataValue)||!d(a.maxDataValue))return c(e,"Could not convert color info: missing data values"),
null;if(2!==a.colors.length)return c(e,"Could not convert color info: invalid colors array"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b.color.values[0]=a.minDataValue;p(b.color.colors,0,a.colors[0]);b.color.values[1]=a.maxDataValue;p(b.color.colors,1,a.colors[1]);for(e=2;8>e;++e)b.color.values[e]=a.maxDataValue,p(b.color.colors,e,a.colors[1])}else return c(e,"Could not convert color info: missing stops or colors"),
null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},e=0;8>e;e++)b.color.values[e]=Infinity,p(b.color.colors,e,a);else return c(e,"Could not convert color info: no field and no colors/stops"),null;return b}function r(a,b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;
b.type[c]=1}function t(a,b,d){if("string"!==typeof a.field)return c(d,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return c(d,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return r(a,b.rotation,0,d),b;case "roll":return r(a,b.rotation,1,d),b;case null:case void 0:case "heading":return r(a,
b.rotation,2,d),b;default:return c(d,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function w(a,b,d){if(!a)return null;var e=!b.supportedTypes||!!b.supportedTypes.size,h=!b.supportedTypes||!!b.supportedTypes.color,g=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,k){if(!a)return a;if(k.valueExpression)return c(d,"Could not convert visual variables: arcade expressions not supported"),null;switch(k.type){case "size":return e?l(k,a,b,d):a;case "color":return h?
q(k,a,d):a;case "rotation":return g?t(k,a,d):a;default:return c(d,"Could not convert visual variables: unsupported type "+k.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!n(a.size,b,d)?null:a}function u(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function x(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,
vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=
a.color.colors);return c}Object.defineProperty(f,"__esModule",{value:!0});f.convertVisualVariables=w;f.initFastSymbolUpdatesState=function(a,b){return!a||a.disableFastUpdates?{enabled:!1}:(a=w(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:x(a,b),customTransformation:a&&null!=a.size}:{enabled:!1}};f.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=w(b.visualVariables,c);if(!(b&&u(d.size,b.size,"size")&&u(d.color,b.color,"color")&&
u(d.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=x(b,c);a.customTransformation=b&&null!=b.size;return!0};f.getMaterialParams=x;var v;(function(a){var b=g.mat4d.create(),c=g.vec3d.create();a.evaluateModelTransform=function(a,d,h){if(!a.vvSizeEnabled)return h;g.mat4d.set(h,b);e.computeObjectRotation(a.vvSymbolRotation[2],a.vvSymbolRotation[0],a.vvSymbolRotation[1],b);if(a.vvSizeEnabled){for(h=0;3>h;++h){var l=a.vvSizeOffset[h]+d[0]*a.vvSizeFactor[h],k=h;var f=a.vvSizeMinSize[h],
n=a.vvSizeMaxSize[h],l=l<f?f:l>n?n:l;c[k]=l}g.mat4d.scale(b,c,b)}else g.mat4d.scale(b,a.vvSizeValue,b);g.mat4d.translate(b,a.vvSymbolAnchor,b);return b}})(v||(v={}));f.evaluateModelTransform=v.evaluateModelTransform})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../lib/gl-matrix ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),function(m,f,k,e,g,d,h){function c(a,b,c,d,e){if(Math.abs(k.vec3.dot(b,a))>e)return!1;k.vec3.cross(a,
b,c);k.vec3.normalize(c);k.vec3.cross(c,a,d);k.vec3.normalize(d);return!0}var b=g.Vec3Compact,a;(function(a){for(var b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],c=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],e=[0,0,1,0,1,1,0,1],g=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],l=Array(36),k=0;6>k;k++)for(var f=0;6>f;f++)l[6*k+f]=k;for(var n=Array(36),k=0;6>k;k++)n[6*k+0]=0,n[6*k+1]=1,n[6*k+2]=2,n[6*k+3]=2,n[6*k+4]=3,
n[6*k+5]=0;a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var k=new Float32Array(24),f=0;8>f;f++)k[3*f]=b[f][0]*a[0],k[3*f+1]=b[f][1]*a[1],k[3*f+2]=b[f][2]*a[2];a={};a[h.VertexAttrConstants.POSITION]=new Uint32Array(g);a[h.VertexAttrConstants.NORMAL]=new Uint32Array(l);a[h.VertexAttrConstants.UV0]=new Uint32Array(n);f={};f[h.VertexAttrConstants.POSITION]={size:3,data:k};f[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(c)};f[h.VertexAttrConstants.UV0]={size:2,data:new Float32Array(e)};
return new d(f,a)}})(a||(a={}));var l;(function(a){var b=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],c=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],e=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],g=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var l=new Float32Array(18),k=0;6>k;k++)l[3*k]=b[k][0]*a[0],l[3*k+1]=b[k][1]*a[1],l[3*k+2]=b[k][2]*a[2];a={};a[h.VertexAttrConstants.POSITION]=new Uint32Array(e);
a[h.VertexAttrConstants.NORMAL]=new Uint32Array(g);k={};k[h.VertexAttrConstants.POSITION]={size:3,data:l};k[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(c)};return new d(k,a)}})(l||(l={}));var n;(function(a){var b=k.vec3.createFrom(-.5,0,-.5),c=k.vec3.createFrom(.5,0,-.5),e=k.vec3.createFrom(0,0,.5),g=k.vec3.createFrom(0,.5,0),l=k.vec3.create(),f=k.vec3.create(),n=k.vec3.create(),p=k.vec3.create(),m=k.vec3.create();k.vec3.subtract(b,g,l);k.vec3.subtract(b,c,f);k.vec3.cross(l,f,n);k.vec3.normalize(n,
n);k.vec3.subtract(c,g,l);k.vec3.subtract(c,e,f);k.vec3.cross(l,f,p);k.vec3.normalize(p,p);k.vec3.subtract(e,g,l);k.vec3.subtract(e,b,f);k.vec3.cross(l,f,m);k.vec3.normalize(m,m);var q=[b,c,e,g],r=[0,-1,0,n[0],n[1],n[2],p[0],p[1],p[2],m[0],m[1],m[2]],t=[0,1,2,3,1,0,3,2,1,3,0,2],w=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var b=new Float32Array(12),c=0;4>c;c++)b[3*c]=q[c][0]*a[0],b[3*c+1]=q[c][1]*a[1],b[3*c+2]=q[c][2]*a[2];a={};a[h.VertexAttrConstants.POSITION]=
new Uint32Array(t);a[h.VertexAttrConstants.NORMAL]=new Uint32Array(w);c={};c[h.VertexAttrConstants.POSITION]={size:3,data:b};c[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(r)};return new d(c,a)}})(n||(n={}));var p;(function(f){f.createBoxGeometry=a.createGeometry;f.createDiamondGeometry=l.createGeometry;f.createTetrahedronGeometry=n.createGeometry;f.createSphereGeometry=function(a,b,c,e,g,l,k){a=a||50;e=void 0!==e?e:-Math.PI;g=void 0!==g?g:2*Math.PI;l=void 0!==l?l:.5*-Math.PI;k=void 0!==
k?k:Math.PI;var f=Math.max(3,Math.floor(b)||8),n=Math.max(2,Math.floor(c)||6),p=(f+1)*(n+1);c=new Float32Array(3*p);b=new Float32Array(3*p);for(var p=new Float32Array(2*p),m=[],q=0,r=0;r<=n;r++){for(var u=[],v=r/n,t=l+v*k,w=Math.cos(t),x=0;x<=f;x++){var y=x/f,z=e+y*g,A=Math.cos(z)*w,B=Math.sin(t),z=-Math.sin(z)*w;c[3*q]=A*a;c[3*q+1]=B*a;c[3*q+2]=z*a;b[3*q]=A;b[3*q+1]=B;b[3*q+2]=z;p[2*q]=y;p[2*q+1]=v;u.push(q);++q}m.push(u)}a=new Uint32Array(2*f*(n-1)*3);for(r=q=0;r<n;r++)for(x=0;x<f;x++)e=m[r][x],
g=m[r][x+1],l=m[r+1][x+1],k=m[r+1][x],0===r?(a[q++]=e,a[q++]=l,a[q++]=k):r===n-1?(a[q++]=e,a[q++]=g,a[q++]=l):(a[q++]=e,a[q++]=g,a[q++]=l,a[q++]=l,a[q++]=k,a[q++]=e);h.assert(q===a.length);f={};f[h.VertexAttrConstants.POSITION]=a;f[h.VertexAttrConstants.NORMAL]=a;f[h.VertexAttrConstants.UV0]=a;n={};n[h.VertexAttrConstants.POSITION]={size:3,data:c};n[h.VertexAttrConstants.NORMAL]={size:3,data:b};n[h.VertexAttrConstants.UV0]={size:2,data:p};return new d(n,f)};f.createPolySphereGeometry=function(a,c,
e){function g(c,d){c>d&&(d=[d,c],c=d[0],d=d[1]);var e=c.toString()+"."+d.toString();if(f[e])return f[e];var h=l.length;l.length+=3;b.add(l,3*c,l,3*d,l,h);b.scale(l,h,a/b.length(l,h));h/=3;return f[e]=h}var l;e?(l=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],e=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(e=a*(1+Math.sqrt(5))/2,l=[-a,e,0,a,e,0,-a,-e,0,a,-e,0,0,-a,e,0,a,e,0,-a,-e,0,a,-e,e,0,-a,e,0,a,-e,0,-a,-e,0,a],e=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,
11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var k=0;k<l.length;k+=3)b.scale(l,k,a/b.length(l,k));for(var f={},k=0;k<c;k++){for(var n=e.length,p=new Uint32Array(4*n),m=0;m<n;m+=3){var q=e[m],r=e[m+1],u=e[m+2],v=g(q,r),t=g(r,u),w=g(u,q),x=4*m;p[x]=q;p[x+1]=v;p[x+2]=w;p[x+3]=r;p[x+4]=t;p[x+5]=v;p[x+6]=u;p[x+7]=w;p[x+8]=t;p[x+9]=v;p[x+10]=t;p[x+11]=w}e=p;f={}}c=new Float32Array(l);for(k=0;k<c.length;k+=3)b.normalize(c,k);k={};k[h.VertexAttrConstants.POSITION]=
e;k[h.VertexAttrConstants.NORMAL]=e;e={};e[h.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(l)};e[h.VertexAttrConstants.NORMAL]={size:3,data:c};return new d(e,k)};f.createPointGeometry=function(a,b,c,e,g,l,k){b=b?new Float32Array([b[0],b[1],b[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);l=l?new Float32Array(l):new Float32Array([0,0]);var f=c?new Uint8Array([255*c[0],255*c[1],255*c[2],3<c.length?255*c[3]:255]):new Uint8Array([255,255,
255,255]),n=null!=e&&2===e.length?new Float32Array(e):new Float32Array([1,1]);e=new Uint32Array([0]);c={};c[h.VertexAttrConstants.POSITION]=e;c[h.VertexAttrConstants.NORMAL]=e;c[h.VertexAttrConstants.UV0]=e;c[h.VertexAttrConstants.COLOR]=e;c[h.VertexAttrConstants.SIZE]=e;var p={};p[h.VertexAttrConstants.POSITION]={size:3,data:b};p[h.VertexAttrConstants.NORMAL]={size:3,data:a};p[h.VertexAttrConstants.UV0]={size:l.length,data:l};p[h.VertexAttrConstants.COLOR]={size:4,data:f};p[h.VertexAttrConstants.SIZE]=
{size:2,data:n};null!=g&&(g=new Float32Array([g[0],g[1],g[2],g[3]]),c[h.VertexAttrConstants.AUXPOS1]=e,p[h.VertexAttrConstants.AUXPOS1]={size:4,data:g});null!=k&&(k=new Float32Array([k[0],k[1],k[2],k[3]]),c[h.VertexAttrConstants.AUXPOS2]=e,p[h.VertexAttrConstants.AUXPOS2]={size:4,data:k});return new d(p,c,d.DefaultOffsets,"point")};f.createPointArrayGeometry=function(a,b){for(var c=new Float32Array(3*a.length),e=new Float32Array(b?3*a.length:3),g=new Uint32Array(a.length),l=new Uint32Array(a.length),
k=0;k<a.length;k++)c[3*k]=a[k][0],c[3*k+1]=a[k][1],c[3*k+2]=a[k][2],b&&(e[3*k]=b[k][0],e[3*k+1]=b[k][1],e[3*k+2]=b[k][2]),g[k]=k,l[k]=0;b||(e[0]=0,e[1]=1,e[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;k={};k[h.VertexAttrConstants.POSITION]=g;k[h.VertexAttrConstants.NORMAL]=b?g:l;k[h.VertexAttrConstants.UV0]=l;b={};b[h.VertexAttrConstants.POSITION]={size:3,data:c};b[h.VertexAttrConstants.NORMAL]={size:3,data:e};b[h.VertexAttrConstants.UV0]={size:2,data:a};return new d(b,k,d.DefaultOffsets,"point")};f.createTriangleGeometry=
function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),b=new Uint32Array([0,1,2]),c=new Float32Array([0,1,0]),e=new Uint32Array([0,0,0]),g=new Float32Array([0,0]),l=new Uint32Array([0,0,0]),k={};k[h.VertexAttrConstants.POSITION]=b;k[h.VertexAttrConstants.NORMAL]=e;k[h.VertexAttrConstants.UV0]=l;b={};b[h.VertexAttrConstants.POSITION]={size:3,data:a};b[h.VertexAttrConstants.NORMAL]={size:3,data:c};b[h.VertexAttrConstants.UV0]={size:2,data:g};return new d(b,k)};f.createSquareGeometry=function(a){var b=
new Float32Array(12);if(a)for(var c=0;4>c;c++)for(var e=0;3>e;e++)b[3*c+e]=a[c][e];else b[0]=-1,b[1]=-1,b[2]=0,b[3]=1,b[4]=-1,b[5]=0,b[6]=1,b[7]=1,b[8]=0,b[9]=-1,b[10]=1,b[11]=0;var g=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var l=new Uint32Array([0,0,0,0,0,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),e=new Uint8Array([255,255,255,255]),k={};k[h.VertexAttrConstants.POSITION]=g;k[h.VertexAttrConstants.NORMAL]=l;k[h.VertexAttrConstants.UV0]=g;k[h.VertexAttrConstants.COLOR]=l;g={};g[h.VertexAttrConstants.POSITION]=
{size:3,data:b};g[h.VertexAttrConstants.NORMAL]={size:3,data:a};g[h.VertexAttrConstants.UV0]={size:2,data:c};g[h.VertexAttrConstants.COLOR]={size:4,data:e};return new d(g,k)};f.createConeGeometry=function(a,b,c,e){var g=0,l=k.vec3.createFrom(0,g,0),f=k.vec3.createFrom(0,g+a,0),n=k.vec3.createFrom(0,-1,0),p=k.vec3.createFrom(0,1,0);e&&(g=a,f=k.vec3.createFrom(0,0,0),l=k.vec3.createFrom(0,g,0),n=k.vec3.createFrom(0,1,0),p=k.vec3.createFrom(0,-1,0));l=[f,l];n=[n,p];p=c+2;f=Math.sqrt(a*a+b*b);if(e)for(e=
c-1;0<=e;e--)m=2*Math.PI/c*e,q=k.vec3.createFrom(Math.cos(m)*b,g,Math.sin(m)*b),l.push(q),m=k.vec3.createFrom(a*Math.cos(m)/f,-b/f,a*Math.sin(m)/f),n.push(m);else for(e=0;e<c;e++){var m=2*Math.PI/c*e,q=k.vec3.createFrom(Math.cos(m)*b,g,Math.sin(m)*b);l.push(q);m=k.vec3.createFrom(a*Math.cos(m)/f,b/f,a*Math.sin(m)/f);n.push(m)}a=new Uint32Array(6*(c+2));c=new Uint32Array(6*(c+2));g=b=0;for(e=3;e<l.length;e++)a[b++]=1,a[b++]=e-1,a[b++]=e,c[g++]=0,c[g++]=0,c[g++]=0;a[b++]=l.length-1;a[b++]=2;a[b++]=
1;c[g++]=0;c[g++]=0;c[g++]=0;for(e=3;e<l.length;e++)a[b++]=e,a[b++]=e-1,a[b++]=0,c[g++]=e,c[g++]=e-1,c[g++]=1;a[b++]=0;a[b++]=2;a[b++]=l.length-1;c[g++]=1;c[g++]=2;c[g++]=n.length-1;b=new Float32Array(3*p);for(e=0;e<p;e++)b[3*e]=l[e][0],b[3*e+1]=l[e][1],b[3*e+2]=l[e][2];l=new Float32Array(3*p);for(e=0;e<p;e++)l[3*e]=n[e][0],l[3*e+1]=n[e][1],l[3*e+2]=n[e][2];n={};n[h.VertexAttrConstants.POSITION]=a;n[h.VertexAttrConstants.NORMAL]=c;p={};p[h.VertexAttrConstants.POSITION]={size:3,data:b};p[h.VertexAttrConstants.NORMAL]=
{size:3,data:l};return new d(p,n)};f.createCylinderGeometry=function(a,b,c,e,g,l){e=e?k.vec3.create(e):k.vec3.createFrom(1,0,0);g=g?k.vec3.create(g):k.vec3.createFrom(0,0,0);l=void 0===l?!0:l;var f=k.vec3.create();k.vec3.normalize(e,f);e=k.vec3.create();k.vec3.scale(f,Math.abs(a),e);var n=k.vec3.create();k.vec3.scale(e,-.5,n);k.vec3.add(n,g);var p=k.vec3.createFrom(0,1,0);.2>Math.abs(1-k.vec3.dot(f,p))&&k.vec3.set3(0,0,1,p);var m=k.vec3.create();k.vec3.cross(f,p,m);k.vec3.normalize(m);k.vec3.cross(m,
f,p);var q=2*c+(l?2:0),r=c+(l?2:0);a=new Float32Array(3*q);g=new Float32Array(3*r);var u=new Float32Array(2*q),v=new Uint32Array(3*c*(l?4:2)),t=new Uint32Array(3*c*(l?4:2));l&&(a[3*(q-2)+0]=n[0],a[3*(q-2)+1]=n[1],a[3*(q-2)+2]=n[2],u[2*(q-2)]=0,u[2*(q-2)+1]=0,a[3*(q-1)+0]=a[3*(q-2)+0]+e[0],a[3*(q-1)+1]=a[3*(q-2)+1]+e[1],a[3*(q-1)+2]=a[3*(q-2)+2]+e[2],u[2*(q-1)]=1,u[2*(q-1)+1]=1,g[3*(r-2)+0]=-f[0],g[3*(r-2)+1]=-f[1],g[3*(r-2)+2]=-f[2],g[3*(r-1)+0]=f[0],g[3*(r-1)+1]=f[1],g[3*(r-1)+2]=f[2]);for(var f=
function(a,b,c){v[a]=b;t[a]=c},w=0,x=k.vec3.create(),y=k.vec3.create(),z=0;z<c;z++){var A=2*Math.PI/c*z;k.vec3.scale(p,Math.sin(A),x);k.vec3.scale(m,Math.cos(A),y);k.vec3.add(x,y);g[3*z+0]=x[0];g[3*z+1]=x[1];g[3*z+2]=x[2];k.vec3.scale(x,b);k.vec3.add(x,n);a[3*z+0]=x[0];a[3*z+1]=x[1];a[3*z+2]=x[2];u[2*z+0]=z/c;u[2*z+1]=0;a[3*(z+c)+0]=a[3*z+0]+e[0];a[3*(z+c)+1]=a[3*z+1]+e[1];a[3*(z+c)+2]=a[3*z+2]+e[2];u[2*(z+c)+0]=z/c;u[2*z+1]=1;A=(z+1)%c;f(w++,z,z);f(w++,z+c,z);f(w++,A,A);f(w++,A,A);f(w++,z+c,z);f(w++,
A+c,A)}if(l){for(z=0;z<c;z++)A=(z+1)%c,f(w++,q-2,r-2),f(w++,z,r-2),f(w++,A,r-2);for(z=0;z<c;z++)A=(z+1)%c,f(w++,z+c,r-1),f(w++,q-1,r-1),f(w++,A+c,r-1)}b={};b[h.VertexAttrConstants.POSITION]=v;b[h.VertexAttrConstants.NORMAL]=t;b[h.VertexAttrConstants.UV0]=v;c={};c[h.VertexAttrConstants.POSITION]={size:3,data:a};c[h.VertexAttrConstants.NORMAL]={size:3,data:g};c[h.VertexAttrConstants.UV0]={size:2,data:u};return new d(c,b)};f.createTubeGeometry=function(a,b,c,d,e){c=c||10;d=null!=d?d:!0;h.assert(1<a.length);
for(var g=[],l=[],k=0;k<c;k++){g.push([0,-k-1,-((k+1)%c)-1]);var n=k/c*2*Math.PI;l.push([Math.cos(n)*b,Math.sin(n)*b])}return f.createPathExtrusionGeometry(l,a,[[0,0,0]],g,d,e)};f.createPathExtrusionGeometry=function(a,b,g,l,f,n){var p=a.length,m=new Float32Array(b.length*p*3+(6*g.length||0)),r=new Float32Array(b.length*p+(2*g.length||0)),u=new Float32Array(b.length*p*3+(g?6:0)),v=(b.length-1)*p*6+6*l.length,t=new Uint32Array(v),v=new Uint32Array(v),w=0,x=0,y=0,z=0,A=0,Q=k.vec3.create(),H=k.vec3.create(),
K=k.vec3.create(),R=k.vec3.create(),P=k.vec3.create(),L=k.vec3.create(),T=k.vec3.create(),S=k.vec3.create(),W=k.vec3.create(),Y=k.vec3.create(),X=k.vec3.create(),aa=k.vec3.create(),U=k.vec3.create(),ha=e.plane.create();k.vec3.set3(0,1,0,W);k.vec3.subtract(b[1],b[0],H);k.vec3.normalize(H);f?(k.vec3.add(b[0],n,S),k.vec3.normalize(S,K)):k.vec3.set3(0,0,1,K);var Z=q;c(H,K,P,K,Z)||c(H,W,P,K,Z)||c(H,W,P,K,Z);k.vec3.set(K,R);k.vec3.set(P,aa);for(var ba=0;ba<g.length;ba++)k.vec3.scale(P,g[ba][0],L),k.vec3.scale(K,
g[ba][2],S),k.vec3.add(L,S),k.vec3.add(L,b[0]),m[w++]=L[0],m[w++]=L[1],m[w++]=L[2],r[y++]=0;u[x++]=-H[0];u[x++]=-H[1];u[x++]=-H[2];for(ba=0;ba<l.length;ba++)t[z++]=0<l[ba][0]?l[ba][0]:-l[ba][0]-1+g.length,t[z++]=0<l[ba][1]?l[ba][1]:-l[ba][1]-1+g.length,t[z++]=0<l[ba][2]?l[ba][2]:-l[ba][2]-1+g.length,v[A++]=0,v[A++]=0,v[A++]=0;for(var Z=g.length,ba=g.length-1,ka=0;ka<b.length;ka++){var ga=!1;if(0<ka){k.vec3.set(H,Q);ka<b.length-1?(k.vec3.subtract(b[ka+1],b[ka],H),k.vec3.normalize(H)):ga=!0;k.vec3.add(Q,
H,Y);k.vec3.normalize(Y);k.vec3.add(b[ka-1],R,X);e.plane.fromPositionAndNormal(b[ka],Y,ha);if(e.plane.intersectRay(ha,X,Q,S))k.vec3.subtract(S,b[ka]),k.vec3.normalize(S,K),k.vec3.cross(Y,K,P),k.vec3.normalize(P);else{var ia=Y,na=aa,wa=W,za=P,Aa=K,sa=q;c(ia,R,za,Aa,sa)||c(ia,na,za,Aa,sa)||c(ia,wa,za,Aa,sa)}k.vec3.set(K,R);k.vec3.set(P,aa)}f&&(k.vec3.add(b[ka],n,S),k.vec3.normalize(S,U));for(ia=0;ia<p;ia++)if(k.vec3.scale(P,a[ia][0],L),k.vec3.scale(K,a[ia][1],S),k.vec3.add(L,S),k.vec3.normalize(L,T),
u[x++]=T[0],u[x++]=T[1],u[x++]=T[2],f?r[y++]=k.vec3.dot(L,U):r[y++]=L[2],k.vec3.add(L,b[ka]),m[w++]=L[0],m[w++]=L[1],m[w++]=L[2],!ga)for(na=(ia+1)%p,t[z++]=Z+ia,t[z++]=Z+p+ia,t[z++]=Z+na,t[z++]=Z+na,t[z++]=Z+p+ia,t[z++]=Z+p+na,na=0;6>na;na++)v[A++]=t[z-6+na]-ba;Z+=p}a=b[b.length-1];for(ba=0;ba<g.length;ba++)k.vec3.scale(P,g[ba][0],L),k.vec3.scale(K,g[ba][1],S),k.vec3.add(L,S),k.vec3.add(L,a),m[w++]=L[0],m[w++]=L[1],m[w++]=L[2],r[y++]=0;g=x/3;u[x++]=H[0];u[x++]=H[1];u[x++]=H[2];p=Z-p;for(ba=0;ba<l.length;ba++)t[z++]=
0<=l[ba][0]?Z+l[ba][0]:-l[ba][0]-1+p,t[z++]=0<=l[ba][2]?Z+l[ba][2]:-l[ba][2]-1+p,t[z++]=0<=l[ba][1]?Z+l[ba][1]:-l[ba][1]-1+p,v[A++]=g,v[A++]=g,v[A++]=g;l={};l[h.VertexAttrConstants.POSITION]=t;l[h.VertexAttrConstants.NORMAL]=v;t={};t[h.VertexAttrConstants.POSITION]={size:3,data:m};t.zOffset={size:1,data:r};t[h.VertexAttrConstants.NORMAL]={size:3,data:u};return new d(t,l)};f.createPolylineGeometry=function(a,b){h.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");h.assert(3===
a[0].length,"createPolylineGeometry(): malformed vertex");h.assert(void 0===b||b.length===a.length,"createPolylineGeometry: need same number of points and normals");h.assert(void 0===b||3===b[0].length,"createPolylineGeometry(): malformed normal");for(var c=new Float32Array(3*a.length),e=new Uint32Array(2*(a.length-1)),g=0,l=0,k=0;k<a.length;k++){for(var f=0;3>f;f++)c[g++]=a[k][f];0<k&&(e[l++]=k-1,e[l++]=k)}g={};l={};g[h.VertexAttrConstants.POSITION]=e;l[h.VertexAttrConstants.POSITION]={size:3,data:c};
if(b){for(var c=new Float32Array(3*b.length),n=0,k=0;k<a.length;k++)for(f=0;3>f;f++)c[n++]=b[k][f];g[h.VertexAttrConstants.NORMAL]=e;l[h.VertexAttrConstants.NORMAL]={size:3,data:c}}return new d(l,g,d.DefaultOffsets,"line")};f.addVertexColors=function(a,b){var c=b||[1,1,1,1];b=new Uint8Array(4);b[0]=255*c[0];b[1]=255*c[1];b[2]=255*c[2];b[3]=255*(3<c.length?c[3]:1);var c={},e=a.getVertexAttr(),g;for(g in e)c[g]=e[g];c[h.VertexAttrConstants.COLOR]={size:4,data:b};b={};for(g in a.indices)b[g]=a.indices[g];
b[h.VertexAttrConstants.COLOR]=new Uint32Array(b[h.VertexAttrConstants.POSITION].length);return a=new d(c,b,a.componentOffsets,a.primitiveType)};f.addNormals=function(a){var b=a.getVertexAttr();a=a.indices;for(var c=g.Vec3Compact.subtract,d=new Float32Array(a.position.length/3*3),e=b.position.data,l=0,f=a.position,n=new Uint32Array(f.length),p=0;p<f.length;p+=3){c(e,3*f[p],e,3*f[p+2],t,0);c(e,3*f[p],e,3*f[p+1],r,0);k.vec3d.cross(r,t);k.vec3d.normalize(r);var m=l/3;d[l++]=r[0];d[l++]=r[1];d[l++]=r[2];
n[p]=m;n[p+1]=m;n[p+2]=m}b[h.VertexAttrConstants.NORMAL]={size:3,data:d,offsetIdx:0,strideIdx:3};a[h.VertexAttrConstants.NORMAL]=n};f.cgToGIS=function(a,b){void 0===b&&(b=a);var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,d=b.getVertexAttr(),e=d.position.data,d=d.normal.data;if(c)for(var h=0;h<c.length;h+=3){var g=c[h+1];d[h+1]=-c[h+2];d[h+2]=g}if(a)for(h=0;h<a.length;h+=3)g=a[h+1],e[h+1]=-a[h+2],e[h+2]=g;return b}})(p||(p={}));var q=.99619469809,r=k.vec3.create(),t=k.vec3.create();
return p})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/Logger ../../lib/gl-matrix ../../support/imageUtils ../../support/mathUtils ../../support/buffer/typedArrayUtil ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a,b,c,e,h,l,k){k=!1!==k;g.requestImage(b).then(function(b){n.assert(1<=
b.width&&1<=b.height);c.samplingMode=k?9987:9729;c.hasMipmap=k;!k&&33071===c.wrapMode||d.isPowerOfTwo(b.width)&&d.isPowerOfTwo(b.height)?(c.width=b.width,c.height=b.height,b=new r(a,c,b)):b=u(a,b,c,e,h);a.bindTexture(b);l(b)}).catch(function(a){var c=200<b.length?b.slice(0,100)+"..."+b.slice(b.length-100):b;x.error("Failed to load image from uri",c,a);l(null)})}function u(c,h,g,l,k){var f=d.nextHighestPowerOfTwo(h.width),m=d.nextHighestPowerOfTwo(h.height);n.assert(f!==h.width||m!==h.height);g.width=
f;g.height=m;var u=new r(c,g),v=q.createWithAttachments(c,u,{colorTarget:0,depthStencilTarget:0});h=new r(c,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!g.flipped,maxAnisotropy:8,preMultiplyAlpha:g.preMultiplyAlpha},h);c.bindFramebuffer(v);void 0===k&&(k=c.getViewport(),k=[k.x,k.y,k.width,k.height]);c.setViewport(0,0,f,m);l=l.getProgram(p.texOnly);f=e.mat4d.identity();c.bindProgram(l);l.setUniformMatrix4fv("model",f);l.setUniformMatrix4fv("view",f);l.setUniformMatrix4fv("proj",
f);l.setUniform4f("color",1,1,1,1);l.setUniform1i("tex",0);l=a.createQuadVAO(c,b.Pos3Tex);c.bindTexture(h,0);c.bindVAO(l);c.setDepthTestEnabled(!1);c.setBlendingEnabled(!1);c.drawArrays(5,0,t.vertexCount(l,"geometry"));c.setDepthTestEnabled(!0);c.bindFramebuffer(null);c.setViewport(k[0],k[1],k[2],k[3]);l.dispose(!0);h.dispose();c.bindFramebuffer(null);v.detachColorTexture();v.dispose();g.hasMipmap&&u.generateMipmap();return u}var x=k.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function a(b,
c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequired=a.estimateTexMemRequired(this.data,this.params)}a.estimateTexMemRequired=function(a,b){return null==a?0:h.isArrayBuffer(a)||h.isUint8Array(a)?a.byteLength:a instanceof Image||a instanceof
ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*4:(b.mipmap?4/3:1)*b.width*b.height*4||0};a.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=function(){return"string"===typeof this.data};a.prototype.getWidth=function(){return this.params.width};a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=function(b,e,g,l,k){var f=
this.data;e.flipped=!this.params.noUnpackFlip;e.samplingMode=this.params.mipmap?9987:9729;e.hasMipmap=this.params.mipmap;e.wrapMode=this.params.wrapClamp?33071:10497;e.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof f)w(b,f,e,g,l,k,this.params.mipmap);else{if(f instanceof Image||f instanceof ImageData||f instanceof HTMLCanvasElement)this.params.width=f.width,this.params.height=f.height,!this.params.mipmap&&this.params.wrapClamp||d.isPowerOfTwo(f.width)&&d.isPowerOfTwo(f.height)?
(e.width=f.width,e.height=f.height,e=new r(b,e,f)):e=u(b,f,e,g,l);else if(h.isArrayBuffer(f)&&this.params.encoding===a.DDS_ENCODING)e=c.createDDSTexture(b,e,f,this.params.mipmap);else if(h.isUint8Array(f)&&this.params.encoding===a.DDS_ENCODING)e=c.createDDSTexture(b,e,f.buffer,this.params.mipmap);else if(h.isUint8Array(f))n.assert(0<this.params.width&&0<this.params.height),e.pixelFormat=1===this.params.components?6409:6408,e.width=this.params.width,e.height=this.params.height,e=new r(b,e,f);else{if(null!==
f)throw console.warn("Unsupported image data"),Error("Unsupported image data");e=new r(b,e,null)}b.bindTexture(e);k(e)}this.data=void 0};a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=function(b){void 0===b&&(b="emptyTexture");return new a(new Uint8Array([0,0,0,0]),b,{width:1,height:1,wrapClamp:!0})};a.idGen=new l;a.DDS_ENCODING="image/vnd-ms.dds";return a}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require",
"exports","../../../webgl/Texture"],function(m,f,k){function e(c){return c.charCodeAt(0)+(c.charCodeAt(1)<<8)+(c.charCodeAt(2)<<16)+(c.charCodeAt(3)<<24)}Object.defineProperty(f,"__esModule",{value:!0});var g=e("DXT1"),d=e("DXT3"),h=e("DXT5");f.createDDSTexture=function(c,b,a,e){var l=new Int32Array(a,0,31);if(542327876!==l[0])return console.error("Invalid magic number in DDS header"),null;if(!(l[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var f=l[21],m;switch(f){case g:f=
8;m=33776;break;case d:f=16;m=33778;break;case h:f=16;m=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255)),null}var r=1;l[2]&131072&&!1!==e&&(r=Math.max(1,l[7]));e=l[4];for(var t=l[3],w=l[1]+4,u,x,v=[],z=0;z<r;++z)x=Math.floor((e+3)/4)*Math.floor((t+3)/4)*f,u=new Uint8Array(a,w,x),v.push(u),w+=x,e=Math.max(1,e>>1),t=Math.max(1,t>>1);b.samplingMode=1<r?9987:9729;b.hasMipmap=1<r;b.width=l[4];b.height=l[3];b.internalFormat=m;b=
new k(c,b,{type:"compressed",levels:v});c.bindTexture(b);return b}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/gl-matrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){return function(l){function f(){return null!==l&&l.apply(this,arguments)||this}k(f,l);f.prototype._prepareResources=function(){var a=this.symbol,b=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),c=this._getStageIdHint();a=null!=a.size?e.pt2px(a.size):1;c={idHint:c,width:a,color:this._getMaterialOpacityAndColor(),slicePlaneEnabled:this._context.slicePlaneEnabled};if(!this._isPropertyDriven("size")&&(a=
n.validateSymbolLayerSize(c.width))){this._logWarning(a);this.reject();return}if(b||1.5<=c.width)this._isPropertyDriven("size")&&(c.width=0),this._material=p.createRibbonMaterial(c);else if(0<c.width)this._material=p.createNativeMaterial(c);else{this.reject();return}this._context.stage.add(r.ModelContentType.MATERIAL,this._material);this.resolve()};f.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(r.ModelContentType.MATERIAL,
this._material.id),this._material=null)};f.prototype.createGraphics3DGraphic=function(b){var c=b.renderingInfo;b=b.graphic;var d=b.geometry;if("polyline"!==d.type&&"polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for line symbol: "+d.type),null;if(!this._validateGeometry(d))return null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",h="graphic"+b.uid,g=this._getVertexOpacityAndColor(c,Float32Array,255),l=0;c.size&&this._isPropertyDriven("size")&&
(l=a.getSingleSizeDriver(c.size),l=e.pt2px(l));c=this.getGraphicElevationContext(b);return"on-the-ground"===c.mode?this._createAsOverlay(b,d,g,l,c,h):this._createAs3DShape(b,d,g,l,c,h,b.uid)};f.prototype.layerPropertyChanged=function(b,c,d){if("opacity"===b)return c=this._material.getColor(),this._material.setColor([c[0],c[1],c[2],this._getMaterialOpacity()]),!0;if("elevationInfo"===b){b=this._elevationContext.mode;this._updateElevationContext();var e=this._elevationContext.mode;if(null==b||null==
e)return!1;if("on-the-ground"===b&&"on-the-ground"===e)return!0;if(b!==e&&("on-the-ground"===b||"on-the-ground"===e))return!1;b=a.needsElevationUpdates2D(e);for(var h in c){var g=c[h];(e=d(g))&&"object3d"===e.type&&(g=g.graphic,e.needsElevationUpdates=b,e.elevationContext.set(this.getGraphicElevationContext(g)))}return!0}return!1};Object.defineProperty(f.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});f.prototype._getOutlineGeometry=function(a,b){return b};f.prototype._getGeometry=
function(a){a=a.geometry;"extent"===a.type&&(a=g.fromExtent(a));return a};f.prototype._createAs3DShape=function(c,d,e,g,l,k,f){var n=this._getGeometry(c),m=n[d],r=this._getOutlineGeometry(n,m);c=[];var u=[],v=[],x=q.vec3d.create(),y=Array(6),n=a.getGeometryVertexData3D(r,n.hasZ,n.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,l);this._logGeometryCreationWarnings(n,m,d,"LineSymbol3DLayer");if(0<r.length){for(var m=n.geometryData.outlines,
r=n.eleVertexData,z=n.vertexData,A=0;A<m.length;++A){var C=m[A];if(!(1>=C.count)){var D=C.index,E=C.count;if(this._context.clippingExtent&&(a.computeBoundingBox(r,D,E,y),a.boundingBoxClipped(y,this._context.clippingExtent)))continue;a.chooseOrigin(z,D,E,x);a.subtractCoordinates(z,D,E,x);C=new Float64Array(r.buffer,3*D*r.BYTES_PER_ELEMENT,3*E);D=new Float64Array(z.buffer,3*D*z.BYTES_PER_ELEMENT,3*E);D=p.createPolylineGeometry(D,C,"rings"===d,e,g);D=new t(D,k+"path"+A);D.singleUse=!0;c.push(D);u.push([this._material]);
D=q.mat4d.identity();q.mat4d.translate(D,x,D);v.push(D)}}if(0<c.length)return d=new w({geometries:c,materials:u,transformations:v,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:k}),d=new b(this,d,c,null,null,h.perVertexElevationAligner,l),d.alignedTerrainElevation=n.terrainElevation,d.needsElevationUpdates=a.needsElevationUpdates2D(l.mode),d}return null};f.prototype._createAsOverlay=function(b,e,h,g,l,k){var f=this._getGeometry(b);this._material.renderPriority=this._symbolLayerOrder;
var n=f[e],m=this._getOutlineGeometry(f,n);b=[];l=Array(6);var r=d.empty(),t=q.vec3d.create(),f=a.getGeometryVertexDataDraped(m,f.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(f,n,e,"LineSymbol3DLayer");if(0<m.length){n=f.vertexData;m=f.geometryData.outlines;for(f=0;f<m.length;++f){var v=m[f],w=v.index,v=v.count;a.computeBoundingBox(n,w,v,l);if(!a.boundingBoxClipped(l,this._context.clippingExtent)){d.expand(r,l);a.chooseOrigin(n,w,v,t);a.subtractCoordinates(n,w,v,t);
a.setZ(n,w,v,this._getDrapedZ());v=new Float64Array(n.buffer,3*w*n.BYTES_PER_ELEMENT,3*v);w=q.mat4d.identity();q.mat4d.translate(w,t,w);var v=p.createPolylineGeometry(v,null,"rings"===e,h,g),x=new u(v);x.material=this._material;x.center=[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0];x.bsRadius=.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]));x.transformation=w;x.name=k;x.uniqueName=k+"#"+v.id;b.push(x)}}return new c(this,b,r)}return null};return f}(l)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(m,f,k,e,g,d){function h(b){var a=b.length;return b[0]===b[a-3]&&b[1]===b[a-2]&&b[2]===b[a-1]}Object.defineProperty(f,"__esModule",{value:!0});var c=e.VertexAttrConstants;f.createRibbonMaterial=function(b){var a={width:b.width,color:b.color,miterLimit:b.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:b.slicePlaneEnabled};"miter"===b.join||"bevel"===b.join?a.join=b.join:b.join&&console.warn("unsupported join type for line symbol: "+b.join);return new d(a,b.idHint+"_ribbonlinemat")};
f.createNativeMaterial=function(b){return new g({color:b.color,slicePlaneEnabled:b.slicePlaneEnabled},b.idHint+"_nativelinemat")};f.isClosed=h;f.createPolylineGeometry=function(b,a,d,e,g){var l,f,n;if(d=d&&!h(b)){d=new Float32Array(b.length+3);for(f=0;f<b.length;f++)d[f]=b[f];f=d.length;d[f-3]=b[0];d[f-2]=b[1];d[f-1]=b[2];l=b.length/3+1;f=new Uint32Array(2*(l-1));n=new Uint32Array(2*(l-1))}else l=b.length/3,f=new Uint32Array(2*(l-1)),n=new Uint32Array(2*(l-1)),d=b;b=new Float32Array(1);b[0]=g;for(var p=
g=0,m=0;m<l-1;m++)f[g++]=m,f[g++]=m+1,n[p++]=0,n[p++]=0;g={};l={};g[c.POSITION]=f;g[c.COLOR]=n;g[c.SIZE]=n;l[c.POSITION]={size:3,data:d,offsetIdx:0,strideIdx:3};l[c.COLOR]={size:4,data:e,offsetIdx:0,strideIdx:4};l[c.SIZE]={size:1,data:b,offsetIdx:0,strideIdx:1};a&&(g.mapPos=f,l.mapPos={size:3,data:a,offsetIdx:0,strideIdx:3});return new k(l,g,k.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../lib/gl-matrix ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/NativeLinePrograms".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t=e.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");m=function(a){function b(b,c){c=a.call(this,c)||this;c.bufferWriter=new y;c.canBeMerged=!0;c.params=q.copyParameters(b,x);return c}k(b,a);b.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};b.prototype.getParameterValues=function(){return q.copyParameters(this.params)};b.prototype.intersect=function(a,
b,e,h,l,k,f,p){if(h.isSelection&&!c.isAllHidden(b.componentVisibilities,a.data.componentOffsets))if(n.isTranslationMatrix(e)){b=a.data.getVertexAttr().position.data;l=h.camera;k=h.point;g.vec3d.set3(k[0]-2,k[1]+2,0,G[0]);g.vec3d.set3(k[0]+2,k[1]+2,0,G[1]);g.vec3d.set3(k[0]+2,k[1]-2,0,G[2]);g.vec3d.set3(k[0]-2,k[1]-2,0,G[3]);for(p=0;4>p;p++)l.unprojectPoint(G[p],O[p]);d.plane.fromPoints(l.eye,O[0],O[1],J);d.plane.fromPoints(l.eye,O[1],O[2],Q);d.plane.fromPoints(l.eye,O[2],O[3],H);d.plane.fromPoints(l.eye,
O[3],O[0],K);a=Number.MAX_VALUE;for(p=0;p<b.length-5;p+=3)if(A[0]=b[p]+e[12],A[1]=b[p+1]+e[13],A[2]=b[p+2]+e[14],B[0]=b[p+3]+e[12],B[1]=b[p+4]+e[13],B[2]=b[p+5]+e[14],!(0>d.plane.distance(J,A)&&0>d.plane.distance(J,B)||0>d.plane.distance(Q,A)&&0>d.plane.distance(Q,B)||0>d.plane.distance(H,A)&&0>d.plane.distance(H,B)||0>d.plane.distance(K,A)&&0>d.plane.distance(K,B))){l.projectPoint(A,D);l.projectPoint(B,F);if(0>D[2]&&0<F[2]){g.vec3d.subtract(A,B,C);var m=l.frustumPlanes,q=-d.plane.distance(m[4],A),
m=q/g.vec3d.dot(C,m[4]);g.vec3d.scale(C,m,C);g.vec3d.add(A,C,A);l.projectPoint(A,D)}else if(0<D[2]&&0>F[2])g.vec3d.subtract(B,A,C),m=l.frustumPlanes,q=-d.plane.distance(m[4],B),m=q/g.vec3d.dot(C,m[4]),g.vec3d.scale(C,m,C),g.vec3d.add(B,C,B),l.projectPoint(B,F);else if(0>D[2]&&0>F[2])continue;m=n.pointLineSegmentDistanceSquared2D(D,F,k);m<a&&(a=m,g.vec3d.set(A,M),g.vec3d.set(B,N))}e=h.p0;h=h.p1;4>a&&(a=n.lineLineDistanceSquared3D(M,N,e,h,I),b=Number.MAX_VALUE,a.success&&(g.vec3d.subtract(a.pa,e,E),
a=g.vec3d.length(E),g.vec3d.scale(E,1/a),b=a/g.vec3d.dist(e,h)),f(b,E))}else t.error("intersection assumes a translation-only matrix")};b.prototype.getGLMaterials=function(){return{color:w,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:u}};b.prototype.getAllTextureIds=function(){return[]};return b}(a);var w=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};
b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.colorPass,{slice:this.params.slicePlaneEnabled})};b.prototype.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("color",c.color);a.setBlendingEnabled(1>c.color[3]);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){1>this.params.color[3]&&
a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 1};return b}(b),u=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();
this.selectProgram()};b.prototype.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.highlightPass,{slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&
q.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 1};return b}(b),x={color:[1,1,1,1],slicePlaneEnabled:!1},v=h.newLayout().vec3f(n.VertexAttrConstants.POSITION),z,y=function(){function a(){this.vertexBufferLayout=v}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[n.VertexAttrConstants.POSITION].length};
a.prototype.write=function(a,b,c,d,e){var h=c=b.vertexAttr[n.VertexAttrConstants.POSITION].data;if(a=a.transformation){if(!z||z.length<c.length)z=new Float32Array(c.length);for(var h=z,g=0;g<c.length;g+=3){var l=c[g],k=c[g+1],f=c[g+2];h[g]=a[0]*l+a[4]*k+a[8]*f+a[12];h[g+1]=a[1]*l+a[5]*k+a[9]*f+a[13];h[g+2]=a[2]*l+a[6]*k+a[10]*f+a[14]}}p.writeBufferVec3(b.indices[n.VertexAttrConstants.POSITION],h,d.position,e)};return a}(),A=g.vec3d.create(),B=g.vec3d.create(),C=g.vec3d.create(),E=g.vec3d.create(),
D=g.vec3d.create(),F=g.vec3d.create(),M=g.vec3d.create(),N=g.vec3d.create(),I={success:!1,dist2:0,pa:g.vec3d.create(),pb:g.vec3d.create()},G=[g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],O=[g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],J=d.plane.create(),Q=d.plane.create(),H=d.plane.create(),K=d.plane.create();return m})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations",
"./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.colorPass={name:"native-line-color",shaders:function(d){return{vertexShader:e.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:g.glslifyDefineMap({SLICE:d.slice})+e.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"native-line-highlight",shaders:function(d){return{vertexShader:e.resolveIncludes("materials/nativeLine/nativeLine.vert"),
fragmentShader:g.glslifyDefineMap({SLICE:d.slice})+e.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../lib/gl-matrix ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/MaterialUtil ../shaders/RibbonLinePrograms".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){var r=e.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");m=function(a){function b(b,c){c=a.call(this,c)||this;c.params=p.copyParameters(b,u);"miter"!==c.params.join&&(c.params.miterLimit=0);c.numVertsAtJoin="wall"===c.params.type?2:4;c.numVertsAtCap=2;c.canBeMerged="screen"===c.params.type&&null==c.params.stippleLength;c.bufferWriter="wall"===c.params.type?new y:new v(c.canBeMerged);return c}k(b,a);b.prototype.setColor=function(a){this.params.color=
a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};b.prototype.dispose=function(){};b.prototype.getParams=function(){return this.params};b.prototype.getParameterValues=function(){var a=p.copyParameters(this.params);a.miterLimit="miter"===a.join?a.miterLimit:0;return a};b.prototype.setParameterValues=function(a){for(var b in a)n.assert("type"!==b,"RibbonLineMaterial: type cannot be changed after creation"),n.assert("stippleLength"!==b||null!=a[b]===(null!=this.params[b]),
"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};b.prototype.intersect=function(a,b,e,h,l,k,f,p){if(h.isSelection&&!c.isAllHidden(b.componentVisibilities,a.data.componentOffsets))if(n.isTranslationMatrix(e)){b=a.data;a=b.getVertexAttr()[n.VertexAttrConstants.POSITION].data;b=b.getVertexAttr()[n.VertexAttrConstants.SIZE];k=h.camera;p=h.point;b=((b&&b.data[0])+this.params.width)/
2+4;g.vec3d.set3(p[0]-b,p[1]+b,0,J[0]);g.vec3d.set3(p[0]+b,p[1]+b,0,J[1]);g.vec3d.set3(p[0]+b,p[1]-b,0,J[2]);g.vec3d.set3(p[0]-b,p[1]-b,0,J[3]);for(var m=0;4>m;m++)k.unprojectPoint(J[m],Q[m]);d.plane.fromPoints(k.eye,Q[0],Q[1],H);d.plane.fromPoints(k.eye,Q[1],Q[2],K);d.plane.fromPoints(k.eye,Q[2],Q[3],R);d.plane.fromPoints(k.eye,Q[3],Q[0],P);l=Number.MAX_VALUE;for(m=0;m<a.length-5;m+=3)if(C[0]=a[m]+e[12],C[1]=a[m+1]+e[13],C[2]=a[m+2]+e[14],E[0]=a[m+3]+e[12],E[1]=a[m+4]+e[13],E[2]=a[m+5]+e[14],!(0>
d.plane.distance(H,C)&&0>d.plane.distance(H,E)||0>d.plane.distance(K,C)&&0>d.plane.distance(K,E)||0>d.plane.distance(R,C)&&0>d.plane.distance(R,E)||0>d.plane.distance(P,C)&&0>d.plane.distance(P,E))){k.projectPoint(C,M);k.projectPoint(E,N);if(0>M[2]&&0<N[2]){g.vec3d.subtract(C,E,D);var q=k.frustumPlanes,u=-d.plane.distance(q[4],C),q=u/g.vec3d.dot(D,q[4]);g.vec3d.scale(D,q,D);g.vec3d.add(C,D,C);k.projectPoint(C,M)}else if(0<M[2]&&0>N[2])g.vec3d.subtract(E,C,D),q=k.frustumPlanes,u=-d.plane.distance(q[4],
E),q=u/g.vec3d.dot(D,q[4]),g.vec3d.scale(D,q,D),g.vec3d.add(E,D,E),k.projectPoint(E,N);else if(0>M[2]&&0>N[2])continue;q=n.pointLineSegmentDistanceSquared2D(M,N,p);q<l&&(l=q,g.vec3d.set(C,I),g.vec3d.set(E,G))}e=h.p0;h=h.p1;l<b*b&&(a=n.lineLineDistanceSquared3D(I,G,e,h,O),b=Number.MAX_VALUE,a.success&&(g.vec3d.subtract(a.pa,e,F),a=g.vec3d.length(F),g.vec3d.scale(F,1/a),b=a/g.vec3d.dist(e,h)),f(b,F))}else r.error("intersection assumes a translation-only matrix")};b.prototype.getGLMaterials=function(){return{color:t,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:w}};b.prototype.getAllTextureIds=function(){return[]};return b}(a);var t=function(a){function b(b,c){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===l.TRANSPARENT_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=
this.programRep.getProgram(q.colorPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*
b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setBlendingEnabled(!1);
a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;p.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&p.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 5};return b}(b),w=function(a){function b(b,c){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();
this.selectProgram()};b.prototype.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(q.highlightPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",
d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};
b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;p.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&p.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 5};return b}(b),u={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,
polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},x=h.newLayout().vec3f(n.VertexAttrConstants.POSITION).vec2f(n.VertexAttrConstants.UV0).vec3f(n.VertexAttrConstants.AUXPOS1).vec3f(n.VertexAttrConstants.AUXPOS2).vec4f(n.VertexAttrConstants.COLOR).f32(n.VertexAttrConstants.SIZE),v=function(){function a(a){this.canBeMerged=a;this.vertexBufferLayout=x;this.numVertsAtJoin=4;this.numVertsAtCap=2}a.prototype.allocate=function(a){return x.createBuffer(a)};a.prototype.elementCount=function(a){a=(a.indices[n.VertexAttrConstants.POSITION].length/
2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a};a.prototype.write=function(a,b,c,d,e){c=b.vertexAttr[n.VertexAttrConstants.POSITION].data;var h=b.indices&&b.indices[n.VertexAttrConstants.POSITION];h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");h=b.vertexAttr[n.VertexAttrConstants.COLOR]?b.vertexAttr[n.VertexAttrConstants.COLOR].data:A;b=b.vertexAttr[n.VertexAttrConstants.SIZE]?b.vertexAttr[n.VertexAttrConstants.SIZE].data:
B;var g=c.length/3;a=a.transformation;d=d.position.typedBuffer;var l=0,k=this.vertexBufferLayout.stride/4,f=e*=k;this.canBeMerged&&(e+=k);var p=c[0],m=c[1],q=c[2];if(a)var r=p,u=m,t=q,p=a[0]*r+a[4]*u+a[8]*t+a[12],m=a[1]*r+a[5]*u+a[9]*t+a[13],q=a[2]*r+a[6]*u+a[10]*t+a[14];var v=c[3],w=c[4],t=c[5];a&&(r=v,u=w,v=a[0]*r+a[4]*u+a[8]*t+a[12],w=a[1]*r+a[5]*u+a[9]*t+a[13],t=a[2]*r+a[6]*u+a[10]*t+a[14]);for(var x=p,y=m,z=q,C=0;C<g;C++)r=3*C,C<g-1&&(v=c[r+3],w=c[r+4],t=c[r+5],a&&(r=v,u=w,v=a[0]*r+a[4]*u+a[8]*
t+a[12],w=a[1]*r+a[5]*u+a[9]*t+a[13],t=a[2]*r+a[6]*u+a[10]*t+a[14])),l+=Math.sqrt((x-p)*(x-p)+(y-m)*(y-m)+(z-q)*(z-q)),d[e++]=x,d[e++]=y,d[e++]=z,d[e++]=l,d[e++]=0===C?-1.2:-1,d[e++]=p,d[e++]=m,d[e++]=q,d[e++]=v,d[e++]=w,d[e++]=t,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0],d[e++]=x,d[e++]=y,d[e++]=z,d[e++]=l,d[e++]=0===C?1.2:1,d[e++]=p,d[e++]=m,d[e++]=q,d[e++]=v,d[e++]=w,d[e++]=t,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0],0<C&&C<g-1&&(d[e++]=x,d[e++]=y,d[e++]=z,d[e++]=
l,d[e++]=-1.2,d[e++]=p,d[e++]=m,d[e++]=q,d[e++]=v,d[e++]=w,d[e++]=t,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0],d[e++]=x,d[e++]=y,d[e++]=z,d[e++]=l,d[e++]=1.2,d[e++]=p,d[e++]=m,d[e++]=q,d[e++]=v,d[e++]=w,d[e++]=t,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0]),p=x,m=y,q=z,x=v,y=w,z=t;if(this.canBeMerged){for(C=f;C<f+k;C++)d[C]=d[C+k];c=e-k;for(C=0;C<k;C++)d[e++]=d[c++]}};return a}(),z=h.newLayout().vec3f(n.VertexAttrConstants.POSITION).vec2f(n.VertexAttrConstants.UV0),
y=function(){function a(){this.vertexBufferLayout=z;this.numVertsAtCap=this.numVertsAtJoin=2;this.tmpCurrent=g.vec3d.create();this.tmpLast=g.vec3d.create()}a.prototype.allocate=function(a){return x.createBuffer(a)};a.prototype.elementCount=function(a){return(a.indices[n.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap};a.prototype.write=function(a,b,c,d,e){c=b.vertexAttr[n.VertexAttrConstants.POSITION].data;(b=b.indices&&b.indices[n.VertexAttrConstants.POSITION])&&
b.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");b=c.length/3;a=a.transformation;var h=0,l=this.tmpCurrent,k=this.tmpLast;g.vec3d.set3(c[0],c[1],c[2],l);for(var f=0;f<b;f++){var p=3*f;g.vec3d.set(l,k);g.vec3d.set3(c[p],c[p+1],c[p+2],l);a&&g.mat4d.multiplyVec3(a,l,l);h+=g.vec3d.dist2(k,l);d.position.setVec(e,l);d.uv0.set(e,0,h);d.uv0.set(e,1,-1);++e;d.position.setVec(e,l);d.uv0.set(e,0,h);d.uv0.set(e,1,1);++e}};return a}(),A=[255,255,255,255],B=[0,0,0,0],C=g.vec3d.create(),
E=g.vec3d.create(),D=g.vec3d.create(),F=g.vec3d.create(),M=g.vec3d.create(),N=g.vec3d.create(),I=g.vec3d.create(),G=g.vec3d.create(),O={success:!1,dist2:0,pa:g.vec3d.create(),pb:g.vec3d.create()},J=[g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],Q=[g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],H=d.plane.create(),K=d.plane.create(),R=d.plane.create(),P=d.plane.create();return m})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){return g.glslifyDefineMap({WALL:d.wall,SCREENSCALE:d.screenScale,STIPPLE:d.stipple,SLICE:d.slice})};f.colorPass={name:"ribbon-line-color",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/ribbonLine/colorPass.frag")}},
attributes:k.Default3D};f.highlightPass={name:"ribbon-line-highlight",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../lib/gl-matrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){var E=A.VertexAttrConstants;m=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};return a}k(g,d);g.prototype._prepareResources=function(){t.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new C({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new C({color:[0,1,1,1]},"debugFAceNormal"));this.resolve()};g.prototype.destroy=function(){d.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(u.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(u.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("mesh"!==b.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;
var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};g.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getLayerOpacity();for(var d in this._materials){c=this._materials[d];c.material.setParameterValues({layerOpacity:b});var e=c.material.getParameterValues();this._setMaterialTransparentParameter(e,c.isComponentTransparent);c.material.setParameterValues({transparent:e.transparent})}if(0<this._edgeStageObjects.size){var h=
this._context.stage.view.getEdgeView(),g=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){h.updateAllComponentOpacities(a,[g])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(e in b)if(a=b[e],d=c(a))a=this.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=l.needsElevationUpdates3D(a.mode),d.elevationContext.set(a);return!0}return!1};Object.defineProperty(g.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});g.prototype._requiresSymbolVertexColors=
function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};g.prototype._colorUid=function(a){a=a.material&&a.material.color;if(!a)return"-";if(a)switch(a.type){case "value":return a.value.toHex();case "image":return a.uid}};g.prototype._materialProperties=function(a,b,c){var d=this._requiresSymbolVertexColors(),e=b.material&&b.material.color;b=this._colorUid(b);a=!!a.vertexAttributes.color;return{hasSymbolVertexColors:d,hasVertexColors:a,color:e,uid:"vc:"+a+",vct"+c+",svc:"+
d+",cmuid:"+b}};g.prototype._setInternalColorValueParameters=function(a,b){b.diffuse=e.toUnitRGB(a.value);b.opacity=a.value.a};g.prototype._getLoadableTextureResource=function(a){return a.data?a.data instanceof HTMLImageElement?a.data.complete?a.data:a.data.src:a.data:a.url};g.prototype._setInternalColorImageParameters=function(a,b,c){var d=this._getLoadableTextureResource(a);if(d){var e=this._textures[a.uid];e||(e=new y(d,b+"_"+a.uid+"_tex",{mipmap:!0,wrapClamp:!1,noUnpackFlip:!0}),this._textures[a.uid]=
e,this._context.stage.add(u.ModelContentType.TEXTURE,e));c.textureId=e.id}};g.prototype._setInternalMaterialParameters=function(a,b,c){if(a=a.material&&a.material.color)switch(a.type){case "value":this._setInternalColorValueParameters(a,c);break;case "image":this._setInternalColorImageParameters(a,b,c)}};g.prototype._setExternalMaterialParameters=function(a){if(this._isPropertyDriven("color"))a.externalColor=F;else{var b=this.symbol.material?e.toUnitRGBA(this.symbol.material.color):F;a.externalColor=
b}if(b=this.symbol.material&&this.symbol.material.colorMixMode)a.colorMixMode=b};g.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};g.prototype._getOrCreateMaterial=function(a,b){var c=this._hasTransparentVertexColors(a)||!!b.get("material.color.transparent");a=this._materialProperties(a,b,c);var d=this._materials[a.uid];if(d)return d.material;var d=this._getStageIdHint(),e={specular:M,vertexColors:a.hasVertexColors,
symbolColors:a.hasSymbolVertexColors,ambient:M,diffuse:D,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};this._setInternalMaterialParameters(b,d,e);this._setExternalMaterialParameters(e);this._setMaterialTransparentParameter(e,c);b=new B(e,d+"_"+a.uid+"_mat");this._materials[a.uid]={material:b,isComponentTransparent:c};this._context.stage.add(u.ModelContentType.MATERIAL,
b);return b};g.prototype._setMaterialTransparentParameter=function(a,b){var c=this._isPropertyDriven("opacity");a.transparent=c||b||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3]};g.prototype._addDebugNormals=function(a,b,c,d){var e,h,g,l,k=b.length,f=a.spatialReference.isWGS84?20015077/180:1,n=.1*Math.max(a.extent.width*f,a.extent.height*f,a.extent.zmax-a.extent.zmin),p=[],m=[];a=[];for(var f=[],q=0;q<k;q++)for(var u=b[q],t=u.data.getAttribute(E.POSITION),w=u.data.getAttribute(E.NORMAL),
y=u.data.getIndices(E.POSITION),u=u.data.getIndices(E.NORMAL),t=t.data,w=w.data,z=0;z<y.length;z++){for(var A=3*y[z],C=3*u[z],N=0;3>N;N++)p.push(t[A+N]);for(N=0;3>N;N++)p.push(t[A+N]+w[C+N]*n);m.push(m.length);m.push(m.length);if(0===z%3){this._calculateFaceNormal(t,y,z,J);this._getFaceVertices(t,y,z,I,G,O);r.vec3d.add(I,G);r.vec3d.add(I,O);r.vec3d.scale(I,1/3);for(N=0;3>N;N++)a.push(I[N]);for(N=0;3>N;N++)a.push(I[N]+J[N]*n);f.push(f.length);f.push(f.length)}}k=(e={},e[E.POSITION]={data:new Float64Array(p),
size:3},e);e=(h={},h[E.POSITION]=new Uint32Array(m),h);h=new v(k,e,void 0,"line");h=new x(h,"debugVertexNormal");h.singleUse=!0;b.push(h);c.push([this._debugVertexNormalMaterial]);d.push(r.mat4d.create(d[0]));k=(g={},g[E.POSITION]={data:new Float64Array(a),size:3},g);e=(l={},l[E.POSITION]=new Uint32Array(f),l);h=new v(k,e,void 0,"line");h=new x(h,"debugFaceNormal");h.singleUse=!0;b.push(h);c.push([this._debugFaceNormalMaterial]);d.push(r.mat4d.create(d[0]))};g.prototype._createAs3DShape=function(c,
d,e,h,g){var k=this;c=c.geometry;if("mesh"!==c.type)return null;var f=this._createGeometryInfo(c,d,h);if(!f)return null;d=f.geometries;var n=f.materials,m=f.transformations,f=f.objectTransformation;t.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(c,d,n,m);var q=new z({geometries:d,materials:n,transformations:m,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:g},idHint:h});q.setObjectTransformation(f);var r=function(a){var b=k._context.stage.view.getEdgeView();if(b){b.removeObject(a);
k._edgeStageObjects.delete(a);var c={opacity:k._getLayerOpacity(),slicePlaneEnabled:k._context.slicePlaneEnabled};if(c=p.createMaterial(b,k.symbol,c))k._edgeStageObjects.add(a),b.addObject(a,[c],{mergeGeometries:!0})}};r(q);h=function(a,c,d,e,h){a=b.perObjectElevationAligner(a,c,d,e,h);r(q);return a};g=new a(this,q,d,null,null,h,e);g.needsElevationUpdates=l.needsElevationUpdates3D(e.mode);e=c.extent.center.clone();e.z=0;g.elevationContext.centerPointInElevationSR=e;g.alignedTerrainElevation=h(g,g.elevationContext,
this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return g};g.prototype._createComponentNormals=function(a,b,c,d){switch(c.shading||"flat"){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,c,d);case "smooth":return this._createComponentNormalsSmooth(a,c,d)}};g.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,c,d);
c=!1;for(var e=0;e<d.length;e+=3){this._calculateFaceNormal(a,d,e,J);for(var h=0;3>h;h++){var g=3*d[e+h];I[0]=b[g+0];I[1]=b[g+1];I[2]=b[g+2];0>r.vec3d.dot(J,I)&&(b[g+0]=-b[g+0],b[g+1]=-b[g+1],b[g+2]=-b[g+2],c=!0)}}return{normals:b,indices:d,didFlipNormals:c}};g.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var h=this._calculateFaceNormal(a,c,e,J),g=0;3>g;g++)b[e+g]=h[g],d[e+g]=e/3;return{normals:b,indices:d,
didFlipNormals:!1}};g.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var d=0;d<c.length;d+=3)for(var e=this._calculateFaceNormal(a,c,d,J),h=0;3>h;h++){var g=c[d+h],l=b[g];l||(l={normal:r.vec3d.create(),count:0},b[g]=l);r.vec3d.add(l.normal,e);l.count++}a=new Float32Array(3*c.length);e=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){g=c[d];l=b[g];1!==l.count&&(r.vec3d.normalize(r.vec3d.scale(l.normal,1/l.count)),l.count=1);for(h=0;3>h;h++)a[3*d+h]=l.normal[h];e[d]=d}return{normals:a,
indices:e,didFlipNormals:!1}};g.prototype._getFaceVertices=function(a,b,c,d,e,h){var g=3*b[c+0],l=3*b[c+1];b=3*b[c+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[l+0];e[1]=a[l+1];e[2]=a[l+2];h[0]=a[b+0];h[1]=a[b+1];h[2]=a[b+2]};g.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,I,G,O);r.vec3d.subtract(G,I);r.vec3d.subtract(O,I);r.vec3d.cross(G,O,I);r.vec3d.normalize(I,d);return d};g.prototype._getOrCreateComponents=function(a){return a.components?a.components:R};g.prototype._createPositionBuffer=
function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);l.reproject(a.vertexAttributes.position,0,a.spatialReference,c,0,this._context.renderSpatialReference,b.length/3);return c};g.prototype._createNormalBuffer=function(a,b){var d=a.vertexAttributes.normal;if(!d)return null;if("local"===this._context.layerView.view.viewingMode)return d;var e=a.vertexAttributes.position,h=new Float32Array(d.length);return c.projectNormalToECEF(d,e,b,a.spatialReference,h)};g.prototype._createColorBuffer=
function(a){return a.vertexAttributes.color};g.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var b=this.symbol.material&&this.symbol.material.colorMixMode||null,c=new Uint8Array(4);q.encodeSymbolColor(a,b,c);return c}return null};g.prototype._createColorIndices=function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};g.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;
if(!c)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv;if(d&&d.length!==c.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);d=this._createColorBuffer(a);
b=this._createSymbolColorBuffer(b);var h=this._createNormalBuffer(a,c);a=this._transformCenterLocal(a,c,h);return{positionBuffer:c,normalBuffer:h,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};g.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,e=this._context.renderSpatialReference;N[0]=d.x;N[1]=d.y;N[2]=0;d=r.mat4d.create();w.computeLinearTransformation(a.spatialReference,N,d,e);r.mat4d.inverse(d,Q);for(a=0;a<b.length;a+=3)I[0]=b[a+0],I[1]=b[a+1],I[2]=
b[a+2],r.mat4d.multiplyVec3(Q,I),b[a+0]=I[0],b[a+1]=I[1],b[a+2]=I[2];if(c)for(r.mat4d.toMat3(d,H),r.mat3d.transpose(H,H),a=0;a<c.length;a+=3)I[0]=c[a+0],I[1]=c[a+1],I[2]=c[a+2],r.mat3d.multiplyVec3(H,I),c[a+0]=I[0],c[a+1]=I[1],c[a+2]=I[2];return d};g.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this._logWarning("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==
a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};g.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};g.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;
var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),l.reproject(a.vertexAttributes.position,0,a.spatialReference,b,0,c,d));l.computeBoundingBox(b,0,d,K);return l.boundingBoxClipped(K,this._context.clippingExtent)};g.prototype._createGeometryInfo=function(a,b,c){var d,e;if(!h.canProject(a,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;
if(this._isOutsideClippingArea(a))return null;var g=this._createBuffers(a,b);if(!g)return null;b=g.positionBuffer;for(var l=g.uvBuffer,k=g.colorBuffer,f=g.symbolColorBuffer,n=g.normalBuffer,g=g.objectTransformation,p=[],m=[],q=[],u=!1,t=0,w=this._getOrCreateComponents(a);t<w.length;t++){var y=w[t];if(!this._validateFaces(a,y))return null;var z=this._getOrCreateFaces(a,y);if(0!==z.length){var A=this._createComponentNormals(b,n,y,z);A.didFlipNormals&&(u=!0);var C=(d={},d[E.POSITION]={size:3,data:b},
d[E.NORMAL]={size:3,data:A.normals},d),A=(e={},e[E.POSITION]=z,e[E.NORMAL]=A.indices,e);k&&(C[E.COLOR]={size:4,data:k},A[E.COLOR]=z);f&&(C[E.SYMBOLCOLOR]={size:4,data:f},A[E.SYMBOLCOLOR]=this._createColorIndices(y,z));a.vertexAttributes.uv&&(C[E.UV0]={size:2,data:l},A[E.UV0]=z);z=new v(C,A);z=new x(z,c+"_mesh");z.singleUse=!0;p.push(z);m.push(r.mat4d.identity());q.push([this._getOrCreateMaterial(a,y)])}}u&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:p,transformations:m,materials:q,objectTransformation:g}};return g}(n);var D=[1,1,1],F=[1,1,1,1],M=[0,0,0],N=r.vec3d.create(),I=r.vec3d.create(),G=r.vec3d.create(),O=r.vec3d.create(),J=r.vec3d.create(),Q=r.mat4d.create(),H=r.mat3d.create(),K=g.create(),R=[new d];return m})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.encodeSymbolColor=function(d,c,b,a){void 0===a&&(a=0);null==
d||"ignore"===c?(b[a+0]=255,b[a+1]=255,b[a+2]=255,b[a+3]=255):(b[a+0]=Math.floor(255*d[0]),b[a+1]=Math.floor(255*d[1]),b[a+2]=Math.floor(255*d[2]),d=Math.floor(d[3]*k),b[a+3]=0===d?0:"tint"===c?d:"replace"===c?d+e:d+g)};f.isOpaqueSymbolColor=function(h,c){void 0===c&&(c=0);h=h[c+3];return h===e||h===g||h===d};var k=85,e=k,g=2*k,d=3*k})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ../support/FastSymbolUpdates ../../lib/gl-matrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){var B=[v.ModelContentType.MATERIAL,v.ModelContentType.TEXTURE,v.ModelContentType.GEOMETRY],C=[1,1,1],E=[1,1,1,1],D=[0,0,0];return function(f){function m(){return null!==f&&f.apply(this,arguments)||this}k(m,f);m.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();if(!this._isPropertyDriven("size")){var c=r.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);this.reject();return}}a.resource&&a.resource.href?
this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};m.prototype._preparePrimitiveResources=function(a,d){if(w.isValidPrimitive(a)){var e=this.symbol;this._geometry=new z(w.primitiveGeometryData(a),d);this._context.stage.add(v.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=w.primitiveBoundingBox(a);this._resourceSize=b.size(this._resourceBoundingBox);this._symbolSize=r.computeSizeWithResourceSize(this._resourceSize,
e);a=this._getMaterialOpacity();a={specular:[0,0,0],opacity:a,transparent:1>a||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:C,diffuse:C};var l=this.symbolContainer;if("point-3d"===l.type&&l.verticalOffset){var l=l.verticalOffset,k=l.minWorldLength,f=l.maxWorldLength;a.verticalOffset={screenLength:c.pt2px(l.screenLength),minWorldLength:k||0,maxWorldLength:null!=f?f:Infinity};a.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
this._isPropertyDriven("color")?a.externalColor=E:(e=e.material?g.toUnitRGBA(e.material.color):E,a.externalColor=e);this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(h.mixin(a,this._fastUpdates.materialParameters),a.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&a.instanced.push("color");a.slicePlaneEnabled=this._context.slicePlaneEnabled;this._material=new A(a,d+"_objectmat");this._context.stage.add(v.ModelContentType.MATERIAL,
this._material);this.resolve()}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};m.prototype._prepareModelResources=function(a,g){var l=this,k=["transformation"];g={materialParamsMixin:{instanced:k},idHint:g,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(h.mixin(g.materialParamsMixin,this._fastUpdates.materialParameters),k.push("featureAttribute")):
this._hasPerInstanceColor()&&k.push("color");k=this.symbolContainer;if("point-3d"===k.type&&k.verticalOffset){var k=k.verticalOffset,f=k.minWorldLength,n=k.maxWorldLength;g.materialParamsMixin.verticalOffset={screenLength:c.pt2px(k.screenLength),minWorldLength:f||0,maxWorldLength:null!=n?n:Infinity};g.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=d.safeCast(t.fetch(a,g));this._symbolLoaderPromise.then(function(a){l._symbolLoaderPromise=null;if(!l.isRejected()){var c=l._context,d=a.stageResources,
e=c.stage,h=l._getExternalColorParameters(l.symbol.material),g=l._getMaterialOpacity(),k=l._isPropertyDriven("opacity"),f=d[v.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(f.length);f.forEach(function(b,d){var e=b.getParameterValues();b.setParameterValues(h);a.originalMaterialOpacities[d]=e.opacity;d=e.opacity*g;b.setParameterValues({opacity:d,transparent:1>d||k||e.transparent});c.screenSizePerspectiveEnabled&&b.setParameterValues({screenSizePerspective:c.sharedResources.screenSizePerspectiveSettings})});
B.forEach(function(a){for(var b=d[a],c=0;b&&c<b.length;c++)e.add(a,b[c])});l._resourceBoundingBox=t.computeBoundingBox(a);l._resourceSize=b.size(l._resourceBoundingBox);l._pivotOffset=a.pivotOffset;l._symbolSize=r.computeSizeWithResourceSize(l._resourceSize,l.symbol);l._i3sModel=a;u.updateFastSymbolUpdatesState(l._fastUpdates,l._context.renderer,l._fastVisualVariableConvertOptions())&&f.forEach(function(a){return a.setParameterValues(l._fastUpdates.materialParameters)});l.resolve()}},function(a){l._symbolLoaderPromise=
null;if(!l.isFulfilled()){if(!(a instanceof e)){var b="ObjectSymbol3DLayer failed to load";a&&a.message&&(b+=" ("+a.message+")");l._logWarning(b)}l.reject()}})};m.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[v.ModelContentType.MATERIAL].forEach(a):a(this._material)};m.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=E:a&&a.color?b.externalColor=g.toUnitRGBA(a.color):(b.externalColor=E,b.colorMixMode="ignore");
return b};m.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;B.forEach(function(c){for(var d=b[c],e=0;d&&e<d.length;e++)a.remove(c,d[e].id)})}else this._material&&a.remove(v.ModelContentType.MATERIAL,this._material.id),this._geometry&&a.remove(v.ModelContentType.GEOMETRY,this._geometry.id)};m.prototype.createGraphics3DGraphic=
function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=p.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,d,b.uid)};m.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var e=this._isPropertyDriven("opacity");if(this._i3sModel){var h=this._getMaterialOpacity();
this._i3sModel.stageResources[v.ModelContentType.MATERIAL].forEach(function(a,b){b=d._i3sModel.originalMaterialOpacities[b]*h;a.setParameterValues({opacity:b,transparent:1>b||e})})}else b=this._getMaterialOpacity(),this._material.setParameterValues({opacity:b,transparent:1>b||e});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var l=b[g];if(a=c(l))l=this.getGraphicElevationContext(l.graphic),a.needsElevationUpdates=p.needsElevationUpdates3D(l.mode),a.elevationContext.set(l)}return!0}return!1};
m.prototype.applyRendererDiff=function(a,b,c,d){var e=this,h;for(h in a.diff)switch(h){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};Object.defineProperty(m.prototype,"numberOfVertices",{get:function(){return this._i3sModel?this._i3sModel.numberOfVertices:this._geometry.data.getIndices(y.VertexAttrConstants.POSITION).length},
enumerable:!0,configurable:!0});m.prototype._createAs3DShape=function(a,b,c,d,e,h){var g=this,k=null,f=null,m=this.getFastUpdateAttrValues(a);m&&(k={featureAttribute:m},f=function(a){return u.evaluateModelTransform(g._fastUpdates.materialParameters,m,a)});!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(k=k||{},k.color=r.mixinColorAndOpacity(c.color,c.opacity));a=this._context.layer.uid;var q=x.mat4d.identity();this._applyObjectRotation(c,q);this._applyObjectRotation(this.symbol,q);this._applyObjectScale(c,
q);this._applyAnchor(q);if(this._i3sModel){c=this._i3sModel.stageResources[v.ModelContentType.GEOMETRY];for(var t=this._i3sModel.materialsByComponent,w=Array(c.length),z=0;z<w.length;z++)w[z]=q;e=p.createStageObjectForPoint.call(this,b,c,t,w,k,d,e,a,h,null,f)}else e=p.createStageObjectForPoint.call(this,b,[this._geometry],[[this._material]],[q],k,d,e,a,h,null,f);if(null===e)return null;if(this._fastUpdates.enabled){var y=u.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());
this._forEachMaterial(function(a){return a.setParameterValues(y)})}e.object.setCastShadow(!0);h=new n(this,e.object,null,null,null,l.perObjectElevationAligner,d,n.VisibilityModes.REMOVE_OBJECT);h.alignedTerrainElevation=e.terrainElevation;h.needsElevationUpdates=p.needsElevationUpdates3D(d.mode);p.extendPointGraphicElevationContext(h,b,this._context.elevationProvider);return h};m.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=r.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||x.mat4d.scale(b,a))};m.prototype._applyObjectRotation=function(b,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&b instanceof a))return r.computeObjectRotation(b.heading,b.tilt,b.roll,c)};m.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return x.vec3d.scale(b.center(this._resourceBoundingBox),
-1);case "top":var a=b.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=b.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?x.vec3d.scale(this._pivotOffset,-1,Array(3)):D}};m.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&x.mat4d.translate(a,b)}};m.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||
this._isPropertyDriven("opacity")};m.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?b.size(this._resourceBoundingBox):C,c=this._resourceBoundingBox?this._computeAnchor():D,d=this._context.renderCoordsHelper.unitInMeters,e=r.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,d);return{modelSize:a,symbolSize:this._symbolSize||C,unitInMeters:d,transformation:{anchor:c,scale:e,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||
0]}}};return m}(q)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/loader ../../lib/gl-matrix ../../support/imageUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){function E(a,b){b.lods&&b.lods.length===a.length&&a.forEach(function(a,c){a.lodMetrics=b.lods[c].metrics});return a}function D(a,b){b=b||{};var c=b.streamDataSupplier;if(c){var e=c.request(a,"json");return p.create(function(a,b){e.then(function(b,c){a(c)},function(a){b(a instanceof d?a:F(a))})},function(){c.cancelRequest(e)})}var g=h(a);return p.create(function(a,b){g.then(function(b){a(b.data)},function(a){b(a instanceof d?a:F(a))})},function(){g.cancel()})}
function F(a){return new b("","Request for object resource failed: "+a)}function M(b,c){return g(this,void 0,void 0,function(){var d,h,g,k,f,n,p,m,q,u,t,v,w,x,z,D,E,B,M,F,O,J,Aa,sa,ma,Ea,Ha,Na,xa,ya,Ga,Ca,Pa,Ja;return e(this,function(e){switch(e.label){case 0:return g=[],k=[],f=[],n=[],p=[],m=r.Version.parse(b.version||"1.0","wosr"),G.validate(m),q="meshsymbol_"+b.model.name,u=b.textureDefinitions,[4,N(q,u,c)];case 1:t=e.sent();for(v in t)p.push(t[v].engineTexObj);w=b.model.geometries;x=b.materialDefinitions;
for(D=z=0;D<w.length;D++){var Q=E=w[D],H=Q.params,X=H.topology;e=!0;H.vertexAttributes||(I.warn("Geometry must specify vertex attributes"),e=!1);switch(H.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:X=H.faces;if(!X)I.warn("Indexed geometries must specify faces"),e=!1;else if(H.vertexAttributes){var T=void 0;for(T in H.vertexAttributes)(H=X[T])&&H.values?(null!=H.valueType&&"UInt32"!==H.valueType&&(I.warn("Unsupported indexed geometry indices type '"+H.valueType+"', only UInt32 is currently supported"),
e=!1),null!=H.valuesPerElement&&1!==H.valuesPerElement&&(I.warn("Unsupported indexed geometry values per element '"+H.valuesPerElement+"', only 1 is currently supported"),e=!1)):(I.warn("Indexed geometry does not specify face indices for '"+T+"' attribute"),e=!1)}break;default:I.warn("Unsupported topology '"+X+"'"),e=!1}Q.params.material||(I.warn("Geometry requires material"),e=!1);Q=Q.params.vertexAttributes;H=void 0;for(H in Q)Q[H].values||(I.warn("Geometries with externally defined attributes are not yet supported"),
e=!1);if(e){e=E.params;d=e.material;h=e.texture;B=E.params.vertexAttributes;M={};for(F in B)O=B[F],J=O.values,M[F]={data:J,size:O.valuesPerElement};f.push([]);Aa={};if("PerAttributeArray"===E.params.topology){e=sa=M.position.data.length/M.position.size;Q=new Uint32Array(e);for(H=0;H<e;H++)Q[H]=H;ma=Q;for(Ea in M)Aa[Ea]=ma}else for(Na in Ha=E.params.faces,Ha)Aa[Na]=new Uint32Array(Ha[Na].values);xa=h?t[h]:null;ya=n[d]?n[d][h]:null;ya||(Ga=d.substring(d.lastIndexOf("/")+1),Ca=x[Ga].params,1===Ca.transparency&&
(Ca.transparency=0),Pa={ambient:Ca.diffuse,diffuse:Ca.diffuse,specular:[0,0,0],opacity:1-(Ca.transparency||0),transparent:0<Ca.transparency,textureId:xa?xa.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:Ca.externalColorMixMode||"tint"},a("enable-feature:jkieboom/alpha-channel-usage")&&xa&&("transparency"===xa.alphaChannelUsage||"maskAndTransparency"===xa.alphaChannelUsage)&&(Pa.transparent=!0),c&&c.materialParamsMixin&&l.mixin(Pa,c.materialParamsMixin),
ya=new C(Pa,q),n[d]||(n[d]={}),n[d][h]=ya,k.push(ya));f[D].push(ya);Ja=new y(new A(M,Aa),q);z+=Aa.position?Aa.position.length:0;g.push(Ja)}}return[2,{stageResources:{textures:p,materials:k,geometries:g},materialsByComponent:f,pivotOffset:b.model.pivotOffset,numberOfVertices:z}]}})})}function N(b,c,d){return g(this,void 0,void 0,function(){var h,g,l,k,f,n,m,q;return e(this,function(e){switch(e.label){case 0:h=[];g=function(e){var g=c[e],l=g.images[0].data;if(!l)return I.warn("Externally referenced texture data is not yet supported"),
"continue";var l=g.encoding+";base64,"+l,k="/textureDefinitions/"+e,f={noUnpackFlip:!0,wrapClamp:!1};a("enable-feature:jkieboom/alpha-channel-usage")&&(f.wrapClamp=!0);e=d&&d.disablePreloadTextures?p.resolve(l):v.requestImage(l);h.push(e.then(function(a){return{refId:k,engineTexObj:new B(a,b,f),alphaChannelUsage:"rgba"===g.channels?g.alphaChannelUsage||"transparency":"none"}}))};for(l in c)g(l);return[4,p.all(h)];case 1:k=e.sent();f={};n=0;for(m=k;n<m.length;n++)q=m[n],f[q.refId]=q;return[2,f]}})})}
Object.defineProperty(f,"__esModule",{value:!0});var I=n.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),G=new r.Version(1,2,"wosr");f.fetch=function(a,b){void 0===b&&(b={});return g(this,void 0,void 0,function(){var c,d;return e(this,function(e){switch(e.label){case 0:if(!l.endsWith(a,".gltf")&&!l.endsWith(a,".glb"))return[3,2];c=new w.DefaultLoadingContext(b.streamDataSupplier);return[4,u.load(c,a)];case 1:return[2,e.sent()];case 2:return[4,D(a,b)];case 3:return d=e.sent(),[4,M(d,
b)];case 4:return[2,e.sent()]}})})};f.fetchLod=function(a,b){return g(this,void 0,void 0,function(){var d,h,l,k,f,n=this;return e(this,function(m){switch(m.label){case 0:return d=q.removeFile(a),[4,D(a,b)];case 1:return h=m.sent(),h.lods?[4,p.all(h.lods.map(function(a){return a.href?D(q.makeAbsolute(a.href,d)):h}))]:[3,4];case 2:return l=m.sent(),k=E,[4,c.map(l,function(a){return g(n,void 0,void 0,function(){return e(this,function(c){switch(c.label){case 0:return[4,M(a,b)];case 1:return[2,c.sent()]}})})})];
case 3:return[2,k.apply(void 0,[m.sent(),h])];case 4:return f=E,[4,M(h,b)];case 5:return[2,f.apply(void 0,[[m.sent()],h])]}})})};f.computeBoundingBox=function(a){a=a.stageResources[z.ModelContentType.GEOMETRY];for(var b=t.empty(),c=[0,0,0],d=[0,0,0],e=0;e<a.length;e++){var h=a[e].boundingInfo;x.vec3d.set(h.getBBMin(),c);x.vec3d.set(h.getBBMax(),d);for(h=0;3>h;++h)b[h]=Math.min(b[h],c[h]),b[h+3]=Math.max(b[h+3],d[h])}return b};f.createStageResources=M;f.createTextureResources=N})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d,h){void 0===h&&(h="");this.major=e;this.minor=d;this._context=h}e.prototype.lessThan=function(e,d){return this.major<e||e===this.major&&this.minor<d};e.prototype.since=function(e,d){return!this.lessThan(e,d)};e.prototype.validate=function(e){if(this.major!==e.major)throw new k((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:e});};e.prototype.clone=function(){return new e(this.major,this.minor,this._context)};e.parse=function(g,d){void 0===d&&(d="");var h=g.split("."),c=h[0],h=h[1],b=/^\s*\d+\s*$/;if(!c||!c.match||!c.match(b))throw new k((d&&d+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:g});if(!h||!h.match||!h.match(b))throw new k((d&&d+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:g});g=parseInt(c,10);c=parseInt(h,10);return new e(g,c,d)};return e}();f.Version=m})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper dojo/errors/CancelError ../../../request ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function g(a){this.streamDataSupplier=
a}g.prototype.loadJson=function(a){return k(this,void 0,void 0,function(){return e(this,function(b){return[2,this.load("json",a)]})})};g.prototype.loadBinary=function(b){return k(this,void 0,void 0,function(){return e(this,function(c){return a.isDataProtocol(b)?[2,a.dataToArrayBuffer(b)]:[2,this.load("binary",b)]})})};g.prototype.loadImage=function(a){return k(this,void 0,void 0,function(){return e(this,function(b){return[2,this.load("image",a)]})})};g.prototype.load=function(a,g){return k(this,void 0,
void 0,function(){var k,f,n=this;return e(this,function(e){switch(e.label){case 0:if(!this.streamDataSupplier)return[3,1];k=this.streamDataSupplier.request(g,a);return[2,b.create(function(a,b){k.then(function(b,c){a(c)},function(a){b(a instanceof d?a:new c("","Request for resource failed: "+a))})},function(){n.streamDataSupplier.cancelRequest(k)})];case 1:return[4,h(g,l[a])];case 2:return f=e.sent(),[2,f.data]}})})};return g}();f.DefaultLoadingContext=m;var l={image:{responseType:"image"},binary:{responseType:"array-buffer"},
json:void 0}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/arrayUtils ./DefaultErrorContext ./internal/Resource ../support/buffer/BufferView ../support/buffer/bufferViewUtil ../support/buffer/glUtil ../support/buffer/math ../webgl-engine/lib/Geometry ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/materials/DefaultMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a,b){return k(this,void 0,void 0,function(){var c,d,h,g,l,k,f,n;return e(this,function(e){switch(e.label){case 0:c=a.json,d=0,e.label=1;case 1:if(!(d<c.nodes.length))return[3,6];h=c.nodes[d];g=a.getNodeTransform(d);x.warnUnsupportedIf(null!=h.weights,"Morph targets are not supported.");if(null==h.mesh)return[3,5];l=c.meshes[h.mesh];k=0;f=l.primitives;e.label=2;case 2:if(!(k<f.length))return[3,5];n=f[k];return[4,b(n,g)];case 3:e.sent(),e.label=4;
case 4:return k++,[3,2];case 5:return d++,[3,1];case 6:return[2]}})})}function u(a,b){if(a.materials.has(b))return a.materials.get(b);var c;if(null!=b.colorTexture&&(c=a.textures.get(b.colorTexture),!c)){var d=b.colorTexture;c=new r(d.data,d.name,{wrapClamp:33071===d.wrapS||33071===d.wrapT,mipmap:v.some(function(a){return a===d.minFilter}),preMultiplyAlpha:!0,noUnpackFlip:!0});a.textures.set(b.colorTexture,c)}c=new t({transparent:"OPAQUE"!==b.alphaMode,diffuse:[b.color[0],b.color[1],b.color[2]],ambient:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],doubleSided:b.doubleSided,doubleSidedType:"winding-order",vertexColors:b.vertexColors,castShadows:!0,receiveSSAO:!0,textureId:c?c.id:void 0},b.name||"");a.materials.set(b,c);return c}Object.defineProperty(f,"__esModule",{value:!0});f.load=function(h,g){return k(this,void 0,void 0,function(){var f,m,r,v,y=this;return e(this,function(A){switch(A.label){case 0:return[4,c.Resource.load(h,x,g)];case 1:return f=A.sent(),m={textures:new Map,materials:new Map,geometries:[],
materialsByComponent:[],numberOfVertices:0},r=0,[4,w(f,function(c,d){return k(y,void 0,void 0,function(){var h,g,k,v,w,y,A,C,N,I,D,E,B,M;return e(this,function(e){switch(e.label){case 0:return h="gltf_"+r++,g=c.mode||4,4!==g?(x.warnUnsupported("Unsupported primitive mode ("+z[g]+"). Skipping primitive."),[2]):c.attributes.NORMAL?[4,f.getMaterial(c)]:(x.warnUnsupported("Vertex normals are required. Skipping primitive."),[2]);case 1:return k=e.sent(),v=u(m,k),w=t.getVertexBufferLayout(v.getParams()),
[4,f.getIndexData(c)];case 2:return y=e.sent(),[4,f.getPositionData(c)];case 3:return A=e.sent(),C=w.createBuffer(A.count),n.vec3.transformMat4(C.position,A,d),(N=C.getField("normal",b.BufferViewVec3f))?[4,f.getNormalData(c)]:[3,5];case 4:I=e.sent(),n.vec3.transformMat4(N,I,d),e.label=5;case 5:return(D=C.getField("uv0",b.BufferViewVec2f))?[4,f.getTextureCoordinates(c)]:[3,7];case 6:E=e.sent(),a.unrolledCopyVec2(D,E),e.label=7;case 7:return(B=C.getField("color",b.BufferViewVec4u8))?[4,f.getVertexColors(c)]:
[3,9];case 8:M=e.sent(),M instanceof b.BufferViewVec4f?n.vec4.scale(B,M,255):a.unrolledCopyVec4(B,M),e.label=9;case 9:return m.numberOfVertices+=C.count,m.materialsByComponent.push([v]),m.geometries.push(new p(new q(new Float32Array(C.buffer),l.glLayout(w),void 0,void 0,y,!1),h)),[2]}})})})];case 2:return A.sent(),v={stageResources:{textures:d.fromMapValues(m.textures),materials:d.fromMapValues(m.materials),geometries:m.geometries},materialsByComponent:m.materialsByComponent,numberOfVertices:m.numberOfVertices,
pivotOffset:void 0},[2,v]}})})};var x=new h.DefaultErrorContext,v=[9987,9985],z="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Logger"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});var e=k.getLogger("esri.views.3d.glTF");m=function(){function g(){}g.prototype.error=function(d){throw Error("[glTF loader]"+d);};g.prototype.errorUnsupported=function(d){this.error("[Unsupported Feature] "+
d)};g.prototype.errorUnsupportedIf=function(d,e){d&&this.error("[Unsupported Feature] "+e)};g.prototype.assert=function(d,e){d||this.error(e)};g.prototype.warn=function(d){e.warn(d)};g.prototype.warnUnsupported=function(d){this.warn("[Unsupported Feature] "+d)};g.prototype.warnUnsupportedIf=function(d,e){d&&this.warnUnsupported(e)};return g}();f.DefaultErrorContext=m})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ./BinaryStreamReader ./fillDefaults ./pathUtils ../../lib/gl-matrix ../../support/buffer/BufferView ../../support/buffer/bufferViewUtil".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){function t(a){return k(this,void 0,void 0,function(){return e(this,function(b){return[2,h.create(function(b,c){var d=new Blob([a]),e=new FileReader;e.onload=function(){b(JSON.parse(e.result))};e.onerror=function(a){c(a)};e.readAsText(d)})]})})}function w(a,b){return k(this,void 0,void 0,function(){return e(this,function(c){return[2,h.create(function(c,d){var e=new Blob([a],{type:b}),h=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(h);
c(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(h);d(a)});g.src=h})]})})}Object.defineProperty(f,"__esModule",{value:!0});var u;m=function(){function h(a,b,c,d,e){this.context=a;this.errorContext=b;this.uri=c;this.json=d;this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=n.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();
b.errorUnsupportedIf(null==d.scene,"A scene must be defined.");b.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}h.load=function(a,b,c){return k(this,void 0,void 0,function(){var g,l,k;return e(this,function(e){switch(e.label){case 0:return d.endsWith(c,".gltf")?[4,a.loadJson(c)]:[3,2];case 1:return g=e.sent(),[2,new h(a,b,c,g)];case 2:return d.endsWith(c,
".glb")?[4,a.loadBinary(c)]:[3,5];case 3:return l=e.sent(),[4,h.parseGLB(b,l)];case 4:return k=e.sent(),[2,new h(a,b,c,k.json,k.binaryData)];case 5:b.error('URI needs to end in ".gltf" or ".glb"'),e.label=6;case 6:return[2]}})})};h.parseGLB=function(b,c){return k(this,void 0,void 0,function(){var d,h,g,l,k,f,n,m,p;return e(this,function(e){switch(e.label){case 0:d=new a.BinaryStreamReader(c),b.assert(12<=d.remainingBytes(),"GLB binary data is insufficiently large."),h=d.readUint32(),g=d.readUint32(),
l=d.readUint32(),b.assert(1179937895===h,"Magic first 4 bytes do not fit to expected GLB value."),b.assert(c.byteLength>=l,"GLB binary data is smalller than header specifies."),b.errorUnsupportedIf(2!==g,"Only GLB container version 2 is supported."),k=0,e.label=1;case 1:if(!(8<=d.remainingBytes()))return[3,5];m=d.readUint32();p=d.readUint32();if(0!==k)return[3,3];b.assert(1313821514===p,"First GLB chunck must be JSON.");b.assert(0<=m,"No JSON data found.");return[4,t(d.readUint8Array(m))];case 2:return f=
e.sent(),[3,4];case 3:1===k?(b.errorUnsupportedIf(5130562!==p,"Second GLB chunck expected to be BIN."),n=d.readUint8Array(m)):b.warnUnsupported("More than 2 GLB chunks detected. Skipping."),e.label=4;case 4:return k+=1,[3,1];case 5:return f||b.error("No GLB JSON chunk detected."),[2,{json:f,binaryData:n}]}})})};h.prototype.getBuffer=function(a){return k(this,void 0,void 0,function(){var b,c,d,h;return e(this,function(e){switch(e.label){case 0:return b=this.json.buffers[a],c=this.errorContext,null==
b.uri?(c.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(d=this.bufferCache.get(a))?[3,2]:[4,this.context.loadBinary(this.resolveUri(b.uri))];case 1:h=e.sent(),d=new Uint8Array(h),this.bufferCache.set(a,d),c.assert(d.byteLength===b.byteLength,"Buffer byte lengths should match."),e.label=2;case 2:return[2,d]}})})};h.prototype.getAccessor=function(a){return k(this,void 0,void 0,function(){var b,c,d,h,g,l,k,f;return e(this,function(e){switch(e.label){case 0:return b=this.json.accessors[a],
c=this.errorContext,c.errorUnsupportedIf(null==b.bufferView,"An accessor bufferView is required."),c.errorUnsupportedIf(b.type in["MAT2","MAT3","MAT4"],"AttributeType "+b.type+" is not supported"),d=this.json.bufferViews[b.bufferView],[4,this.getBuffer(d.buffer)];case 1:return h=e.sent(),g=y[b.type],l=A[b.componentType],k=g*l,f=d.byteStride||k,[2,{raw:h.buffer,byteStride:f,byteOffset:h.byteOffset+(d.byteOffset||0)+(b.byteOffset||0),entryCount:b.count,isDenselyPacked:f===k,componentCount:g,componentByteSize:l,
componentType:b.componentType,min:b.min,max:b.max}]}})})};h.prototype.getIndexData=function(a){return k(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:if(null==a.indices)return[2,null];b=this.errorContext;return[4,this.getAccessor(a.indices)];case 1:c=d.sent();b.errorUnsupportedIf(5121===c.componentType,"uint8 indices are not supported.");if(c.isDenselyPacked)switch(c.componentType){case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,
new Uint32Array(c.raw,c.byteOffset,c.entryCount)]}else switch(c.componentType){case 5123:return[2,r.makeDenseSingle(new q.BufferViewUint16(c.raw,c.byteOffset,c.byteOffset+c.byteStride,c.byteStride*c.entryCount))];case 5125:return[2,r.makeDenseSingle(new q.BufferViewUint32(c.raw,c.byteOffset,c.byteOffset+c.byteStride,c.byteStride*c.entryCount))]}return[2]}})})};h.prototype.getPositionData=function(a){return k(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:return b=
this.errorContext,b.errorUnsupportedIf(null==a.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(a.attributes.POSITION)];case 1:return c=d.sent(),b.errorUnsupportedIf(5126!==c.componentType,"[POSITION attribute] Expected type FLOAT, found "+B[c.componentType]),b.errorUnsupportedIf(3!==c.componentCount,"POSITION attribute must have 3 components."),[2,new q.BufferViewVec3f(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)]}})})};h.prototype.getNormalData=
function(a){return k(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(a.attributes.NORMAL)];case 1:return c=d.sent(),b.errorUnsupportedIf(5126!==c.componentType,"[NORMAL attribute] Expected type FLOAT, found "+B[c.componentType]),b.errorUnsupportedIf(3!==c.componentCount,"NORMAL attribute must have 3 components."),[2,new q.BufferViewVec3f(c.raw,
c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)]}})})};h.prototype.getTextureCoordinates=function(a){return k(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(a.attributes.TEXCOORD_0)];case 1:return c=d.sent(),b.errorUnsupportedIf(5126!==c.componentType,"[TEXCOORD_0 attribute] Expected type FLOAT, found "+B[c.componentType]),
b.errorUnsupportedIf(2!==c.componentCount,"TEXCOORD_0 attribute must have 2 components."),[2,new q.BufferViewVec2f(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)]}})})};h.prototype.getVertexColors=function(a){return k(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:return b=this.errorContext,b.errorUnsupportedIf(null==a.attributes.COLOR_0,"COLOR_0 vertex data is required."),[4,this.getAccessor(a.attributes.COLOR_0)];case 1:c=d.sent();
b.errorUnsupportedIf(4!==c.componentCount,"COLOR_0 attribute must have 4 components.");if(5126===c.componentType)return[2,new q.BufferViewVec4f(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)];if(5121===c.componentType)return[2,new q.BufferViewVec4u8(c.raw,c.byteOffset,c.byteStride,c.byteOffset+c.byteStride*c.entryCount)];b.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+B[c.componentType]);return[2]}})})};h.prototype.getMaterial=function(a){return k(this,
void 0,void 0,function(){var b,c,d,h,g,k;return e(this,function(e){switch(e.label){case 0:b=this.errorContext;if(c=this.materialCache.get(a.material))return[3,3];d=l.material(this.json.materials[a.material]);h=d.pbrMetallicRoughness;g=!!a.attributes.COLOR_0;k=void 0;if(!h.baseColorTexture)return[3,2];b.errorUnsupportedIf(0!==(h.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported");return[4,this.getTexture(h.baseColorTexture.index)];case 1:k=e.sent(),e.label=2;case 2:c={alphaMode:d.alphaMode,
color:h.baseColorFactor,doubleSided:!!d.doubleSided,colorTexture:k,name:d.name,vertexColors:g},e.label=3;case 3:return[2,c]}})})};h.prototype.getTexture=function(a){return k(this,void 0,void 0,function(){var b,c,d,h,g,k,f,n;return e(this,function(e){switch(e.label){case 0:b=this.errorContext;c=this.json.textures[a];d=l.textureSampler(c.sampler);b.errorUnsupportedIf(null==c.source,"source must be defined for a texture");h=this.json.images[c.source];if(g=this.textureCache.get(a))return[3,6];k=void 0;
return h.uri?[4,this.context.loadImage(this.resolveUri(h.uri))]:[3,2];case 1:return k=e.sent(),[3,5];case 2:return b.errorUnsupportedIf(null==h.bufferView,"Image bufferView must be defined."),b.errorUnsupportedIf(null==h.mimeType,"Image mimeType must be defined."),f=this.json.bufferViews[h.bufferView],[4,this.getBuffer(f.buffer)];case 3:return n=e.sent(),b.errorUnsupportedIf(null!=f.byteStride,"byteStride not supported for image buffer"),[4,w(new Uint8Array(n.buffer,n.byteOffset+(f.byteOffset||0),
f.byteLength),h.mimeType)];case 4:k=e.sent(),e.label=5;case 5:g={data:k,wrapS:d.wrapS,wrapT:d.wrapT,minFilter:d.minFilter,name:h.name},this.textureCache.set(a,g),e.label=6;case 6:return[2,g]}})})};h.prototype.getNodeTransform=function(a){if(void 0===a)return v;var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),c=this.json.nodes[a];if(c.matrix)b=p.mat4d.multiply(b,c.matrix,p.mat4d.create());else if(c.translation||c.rotation||c.scale)b=p.mat4d.create(b),c.translation&&
p.mat4d.translate(b,c.translation,b),c.rotation&&(p.quat4d.toAngleAxis(c.rotation,z),p.mat4d.rotate(b,z[3],z,b)),c.scale&&p.mat4d.scale(b,c.scale,b);this.nodeTransformCache.set(a,b)}return b};h.prototype.resolveUri=function(a){return c.isDataProtocol(a)?a:this.baseUri+a};h.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};h.prototype.checkVersionSupported=function(){b.Version.parse(this.json.asset.version,"glTF").validate(x)};h.prototype.checkRequiredExtensionsSupported=function(){var a=
this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupportedIf(!0,"Extensions: "+a.extensionsRequired.join(", "))};h.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};return h}();f.Resource=m;var x=new b.Version(2,0,"glTF"),v=p.mat4d.rotateX(p.mat4d.identity(),Math.PI/2),z=p.quat4d.create(),y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},A=(u={},u[5120]=1,u[5121]=
1,u[5122]=2,u[5123]=2,u[5126]=4,u[5125]=4,u),B={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function k(e){this.data=e;this.offset4=0;this.dataUint32=new Uint32Array(this.data)}k.prototype.readUint32=function(){var e=this.offset4;this.offset4+=1;return this.dataUint32[e]};k.prototype.readUint8Array=
function(e){var g=4*this.offset4;this.offset4+=e/4;return new Uint8Array(this.data,g,e)};k.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return k}();f.BinaryStreamReader=m})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});var e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},g={pbrMetallicRoughness:e,emissiveFactor:[0,
0,0],alphaMode:"OPAQUE",alphaCutOff:.5,doubleSided:!1};f.material=function(d){void 0===d&&(d={});var c=k({},e,d?d.pbrMetallicRoughness:void 0);return k({},g,d,{pbrMetallicRoughness:c})};var d={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};f.textureSampler=function(e){return k({},d,e)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.splitURI=function(k){var e,g;k.replace(/^(.*\/)?([^/]*)$/,
function(d,h,c){e=h;g=c;return""});return{dirPart:e,filePart:g}}})},"esri/views/3d/support/buffer/math":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});(function(k){k.transformMat4=function(e,g,d){if(e.count!==g.count)console.error("input and output buffers need to have the same number of elements");else{var h=e.count,c=d[0],b=d[1],a=d[2],l=d[3],k=d[4],f=d[5],m=d[6],r=d[7],t=d[8],w=d[9],u=d[10],x=d[11],v=d[12],z=d[13],y=d[14];d=d[15];for(var A=
0;A<h;A++){var B=g.get(A,0),C=g.get(A,1),E=g.get(A,2),D=l*B+r*C+x*E+d,D=D||1;e.set(A,0,(c*B+k*C+t*E+v)/D);e.set(A,1,(b*B+f*C+w*E+z)/D);e.set(A,2,(a*B+m*C+u*E+y)/D)}}};k.transformMat3=function(e,g,d){if(e.count!==g.count)console.error("input and output buffers need to have the same number of elements");else{var h=e.count,c=d[0],b=d[1],a=d[2],l=d[3],k=d[4],f=d[5],m=d[6],r=d[7];d=d[8];for(var t=0;t<h;t++){var w=g.get(t,0),u=g.get(t,1),x=g.get(t,2);e.set(t,0,c*w+l*u+m*x);e.set(t,1,b*w+k*u+r*x);e.set(t,
2,a*w+f*u+d*x)}}}})(f.vec3||(f.vec3={}));(function(k){k.scale=function(e,g,d){for(var h=Math.min(e.count,g.count),c=0;c<h;c++)e.set(c,0,g.get(c,0)*d),e.set(c,1,g.get(c,1)*d),e.set(c,2,g.get(c,2)*d),e.set(c,3,g.get(c,3)*d)}})(f.vec4||(f.vec4={}))})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil"],function(m,f,k,e,g){Object.defineProperty(f,
"__esModule",{value:!0});var d=k.fromValues(-.5,-.5,-.5,.5,.5,.5),h=k.fromValues(-.5,-.5,0,.5,.5,1),c=k.fromValues(-.5,-.5,0,.5,.5,.5);f.isValidPrimitive=function(b){switch(b){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};f.primitiveBoundingBox=function(b){switch(b){case "sphere":case "cube":case "diamond":return d;case "cylinder":case "cone":case "inverted-cone":return h;case "tetrahedron":return c}};f.primitiveGeometryData=
function(b){switch(b){case "sphere":return g.createPolySphereGeometry(.5,2,!0);case "cube":return g.createBoxGeometry(1);case "cylinder":return g.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return g.cgToGIS(g.createConeGeometry(1,.5,15,!1));case "inverted-cone":return g.cgToGIS(g.createConeGeometry(1,.5,15,!0));case "tetrahedron":return g.cgToGIS(g.createTetrahedronGeometry(1));case "diamond":return g.cgToGIS(g.createDiamondGeometry(1))}};f.primitiveLodResources=function(b,a,c){var d=
function(b,d,h){void 0===h&&(h=!1);return{levels:b.map(function(b,l){var k=d(b.tesselation);h&&g.cgToGIS(k);return{components:[{geometry:new e(k,c+("_lod"+l)),material:a}],faceCount:k.indexCount/3,minScreenSpaceRadius:b.minScreenSpaceRadius}})}};switch(b){case "sphere":return d([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:5},{tesselation:2,minScreenSpaceRadius:15}],function(a){return g.createPolySphereGeometry(.5,a,!0)});case "cube":return d([{tesselation:0,minScreenSpaceRadius:0}],
function(a){return g.createBoxGeometry(1)});case "cone":return d([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(a){return g.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return d([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(a){return g.createConeGeometry(1,.5,a,!0)},!0);case "cylinder":return d([{tesselation:4,minScreenSpaceRadius:0},
{tesselation:8,minScreenSpaceRadius:10},{tesselation:32,minScreenSpaceRadius:20}],function(a){return g.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return d([{tesselation:0,minScreenSpaceRadius:0}],function(a){return g.createTetrahedronGeometry(1)},!0);case "diamond":return d([{tesselation:0,minScreenSpaceRadius:0}],function(a){return g.createDiamondGeometry(1)},!0)}}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayerLod":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./primitiveObjectSymbolUtils ../support/FastSymbolUpdates ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){m=function(f){function m(){var a=null!==f&&f.apply(this,arguments)||this;a._instanceIndexToGraphicUid={};return a}k(m,f);Object.defineProperty(m.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});m.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();this._optionalFields=[];if(!this._isPropertyDriven("size")){var c=r.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);
this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};m.prototype._preparePrimitiveResources=function(a,d){if(w.isValidPrimitive(a)){var e=this.symbol,l=this._getMaterialOpacity(),l={specular:[0,0,0],opacity:l,transparent:1>l||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:E,diffuse:E},k=this.symbolContainer;if("point-3d"===k.type&&k.verticalOffset){var k=
k.verticalOffset,f=k.minWorldLength,n=k.maxWorldLength;l.verticalOffset={screenLength:c.pt2px(k.screenLength),minWorldLength:f||0,maxWorldLength:null!=n?n:Infinity};l.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?l.externalColor=D:(k=e.material?g.toUnitRGBA(e.material.color):D,l.externalColor=k);this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled?(h.mixin(l,this._fastUpdates.materialParameters),l.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(l.instanced.push("color"),this._optionalFields.push("color"));l=new C(l,d+"_objectmat");(this._lodResources=w.primitiveLodResources(a,l,d))?(this._resourceBoundingBox=b.create(w.primitiveBoundingBox(a)),this._resourceSize=b.size(this._resourceBoundingBox),this._symbolSize=r.computeSizeWithResourceSize(this._resourceSize,
e),this.finalizeSymbolResources(),this.initializeLodRenderer(),this.resolve()):(this._logWarning("Unknown object symbol primitive: "+a),this.reject())}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};m.prototype._prepareModelResources=function(a,g){var l=this,k=["transformation"];g={materialParamsMixin:{instanced:k},idHint:g,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled?(h.mixin(g.materialParamsMixin,this._fastUpdates.materialParameters),k.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(k.push("color"),this._optionalFields.push("color"));k=this.symbolContainer;if("point-3d"===k.type&&k.verticalOffset){var k=k.verticalOffset,f=k.minWorldLength,n=k.maxWorldLength;g.materialParamsMixin.verticalOffset={screenLength:c.pt2px(k.screenLength),minWorldLength:f||0,maxWorldLength:null!=n?n:Infinity};
g.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=d.safeCast(t.fetchObjectLodResources(a,g));this._symbolLoaderPromise.then(function(a){l._symbolLoaderPromise=null;if(!l.isRejected()){t.fillEstimatedMinScreenSpaceRadius(a);l._lodResources=a;var c=l._context,d=l._getExternalColorParameters(l.symbol.material),e=l._getMaterialOpacity(),h=l._isPropertyDriven("opacity");a=B.materialsFromLodResources(l._lodResources);l._originalOpacities=a.map(function(a){return a.getParameterValues().opacity||
1});a.forEach(function(a){var b=a.getParameterValues();a.setParameterValues(d);var g=b.opacity*e;a.setParameterValues({opacity:g,transparent:1>g||h||b.transparent});c.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:c.sharedResources.screenSizePerspectiveSettings})});l._resourceBoundingBox=B.computeBoundingBox(l._lodResources.levels[0]);l._resourceSize=b.size(l._resourceBoundingBox);l._pivotOffset=l._lodResources.levels[0].pivotOffset;l._symbolSize=r.computeSizeWithResourceSize(l._resourceSize,
l.symbol);l.finalizeSymbolResources();l.initializeLodRenderer();u.updateFastSymbolUpdatesState(l._fastUpdates,l._context.renderer,l._fastVisualVariableConvertOptions())&&l._materials.forEach(function(a){return a.setParameterValues(l._fastUpdates.materialParameters)});l.resolve()}},function(a){l._symbolLoaderPromise=null;if(!l.isFulfilled()){if(!(a instanceof e)){var b="ObjectSymbol3DLayer failed to load";a&&a.message&&(b+=" ("+a.message+")");l._logWarning(b)}l.reject()}})};m.prototype.finalizeSymbolResources=
function(){var a=this._context.stage;this._materials=B.materialsFromLodResources(this._lodResources);this._originalOpacities||(this._originalOpacities=this._materials.map(function(a){return a.getParameterValues().opacity||1}));this._materials.forEach(function(b){a.add(z.ModelContentType.MATERIAL,b)});this._textures=B.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(z.ModelContentType.TEXTURE,b)});this._geometries=B.geometriesFromLodResources(this._lodResources);
this._geometries.forEach(function(b){a.add(z.ModelContentType.GEOMETRY,b)})};m.prototype.initializeLodRenderer=function(){var a=this,b=this._context.stage;this._lodRenderer=new A.LodRenderer(this._lodResources,this._optionalFields,function(b){return{layerUid:a._context.layer.uid,graphicUid:a._instanceIndexToGraphicUid[b]}});b.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};m.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=D:a&&
a.color?b.externalColor=g.toUnitRGBA(a.color):(b.externalColor=D,b.colorMixMode="ignore");return b};m.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(z.ModelContentType.MATERIAL,b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(z.ModelContentType.TEXTURE,
b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(z.ModelContentType.GEOMETRY,b.id)})};m.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=p.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,d,b.uid)};m.prototype.notifyDestroyGraphicLayer=
function(a){delete this._instanceIndexToGraphicUid[a.instanceIndex]};m.prototype.graphicLayerToGraphicId=function(a){return 0};m.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var e=this._isPropertyDriven("opacity");this._materials.forEach(function(a,b){b=d._getMaterialOpacity()*d._originalOpacities[b];a.setParameterValues({opacity:b,transparent:1>b||e})});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var h in b){var g=b[h];if(a=c(g))g=this.getGraphicElevationContext(g.graphic),
a.needsElevationUpdates=p.needsElevationUpdates3D(g.mode),a.elevationContext.set(g)}return!0}return!1};m.prototype.applyRendererDiff=function(a,b,c,d){var e=this,h;for(h in a.diff)switch(h){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};Object.defineProperty(m.prototype,"numberOfVertices",
{get:function(){return B.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(y.VertexAttrConstants.POSITION).length},0)},enumerable:!0,configurable:!0});m.prototype._createAs3DShape=function(a,b,c,d,e,h){var g=this,k=this.getFastUpdateAttrValues(a);a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?r.mixinColorAndOpacity(c.color,c.opacity):null;k?function(a){return u.evaluateModelTransform(g._fastUpdates.materialParameters,k,a)}:null;
e=this._context.clippingExtent;v.pointToVector(b,M,this._context.elevationProvider.spatialReference);if(e&&!p.pointInBox2D(M,e))return null;v.pointToVector(b,M,this._context.renderSpatialReference);e="absolute-height"!==d.mode;var f=p.computeElevation(this._context.elevationProvider,b,d,this._context.renderCoordsHelper,e?G:null),m=N,q=I;x.mat4d.identity(N);this._applyObjectRotation(c,m);this._applyObjectRotation(this.symbol,m);this._applyObjectScale(c,m);this._applyAnchor(m);M[0]=b.x;M[1]=b.y;M[2]=
f;v.computeLinearTransformation(b.spatialReference,M,q,this._context.renderSpatialReference)||console.warn("Could not locate symbol object properly, it might be misplaced");c=this._lodRenderer.instanceData;x.mat4d.multiply(q,m,q);m=c.addInstance();this._instanceIndexToGraphicUid[m]=h;c.setTransform(m,q);k&&c.setFeatureAttribute(m,k);a&&c.setColor(m,a);h=new n(this,m,l.perLodInstanceElevationAligner,d);e&&(h.alignedTerrainElevation=G.terrainElevation);h.needsElevationUpdates=p.needsElevationUpdates3D(d.mode);
p.extendPointGraphicElevationContext(h,b,this._context.elevationProvider);return h};m.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=r.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||x.mat4d.scale(b,a))};m.prototype._applyObjectRotation=function(b,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&
b instanceof a))return r.computeObjectRotation(b.heading,b.tilt,b.roll,c)};m.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return x.vec3d.scale(b.center(this._resourceBoundingBox),-1);case "top":var a=b.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=b.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?x.vec3d.scale(this._pivotOffset,-1,Array(3)):F}};
m.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&x.mat4d.translate(a,b)}};m.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};m.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?b.size(this._resourceBoundingBox):E,c=this._resourceBoundingBox?this._computeAnchor():F,d=this._context.renderCoordsHelper.unitInMeters,
e=r.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,d);return{modelSize:a,symbolSize:this._symbolSize||E,unitInMeters:d,transformation:{anchor:c,scale:e,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};return m}(q);var E=[1,1,1],D=[1,1,1,1],F=[0,0,0],M=x.vec3d.create(),N=x.mat4d.create(),I=x.mat4d.create(),G={verticalDistanceToGround:0,terrainElevation:0};return m})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/gl-matrix ../../webgl-engine/lib/HighlightUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){m=function(){function k(a,b,d,e){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=d;this.elevationContext=new c(e)}k.prototype.initialize=function(a,b){};k.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};k.prototype.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};k.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(h.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};k.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getScaleFactor(this.instanceIndex)};
k.prototype.getCenterObjectSpace=function(){return this.lodRenderer.baseBoundingSphere.center};k.prototype.getBoundingBoxObjectSpace=function(a){a=a||d.create();d.set(a,this.lodRenderer.baseBoundingBox);return a};k.prototype.getProjectedBoundingBox=function(c,h,l,k){return g(this,void 0,void 0,function(){var g,f,m,u,v,w,x,z,N;return e(this,function(e){switch(e.label){case 0:g=this.getBoundingBoxObjectSpace(l);f=r;m=d.isPoint(g)?1:f.length;this.lodRenderer.instanceData.getTransform(this.instanceIndex,
t);for(u=0;u<m;u++)v=f[u],p[0]=g[v[0]],p[1]=g[v[1]],p[2]=g[v[2]],a.mat4d.multiplyVec3(t,p),n[3*u+0]=p[0],n[3*u+1]=p[1],n[3*u+2]=p[2];if(!c(n,0,m))return[2,null];d.empty(g);w=null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(u=0;u<3*m;u+=3){for(x=0;3>x;x++)g[x]=Math.min(g[x],n[u+x]),g[x+3]=Math.max(g[x+3],n[u+x]);w&&k.push({location:n.slice(u,u+3),screenSpaceBoundingRect:w})}if(!h)return[3,5];d.center(g,q);if("absolute-height"===this.elevationContext.mode)return[3,
5];z=void 0;N=b.demResolutionForBoundingBox(g,h);e.label=1;case 1:return e.trys.push([1,3,,4]),[4,h.service.queryElevation(q[0],q[1],N)];case 2:return z=e.sent(),[3,4];case 3:return e.sent(),z=null,[3,4];case 4:null!=z&&d.offset(g,0,0,-this.alignedTerrainElevation+z),e.label=5;case 5:return[2,g]}})})};k.prototype.addHighlight=function(a,b){var c=this;this.highlightId=l.generateHighlightId();this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0);a.addExternal(function(a){c.lodRenderer.instanceData.setHighlight(c.instanceIndex,
!1);c.highlightId=null},this.highlightId)};k.prototype.removeHighlight=function(a){this.highlightId&&a.remove(this.highlightId)};Object.defineProperty(k.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return k}();var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=a.vec3d.create(),q=a.vec3d.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=a.mat4d.create();return m})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./objectResourceUtils ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(m,f,k,e,g,d){function h(a){var b=[];a.stageResources.geometries.forEach(function(c,d){b.push({material:a.materialsByComponent[d][0],geometry:c,textures:a.stageResources.textures})});return{components:b,faceCount:a.lodMetrics?a.lodMetrics.faceCount:null,minScreenSpaceRadius:null,pivotOffset:a.pivotOffset}}function c(a){return{levels:a.map(function(a){return h(a)})}}function b(b,c){void 0===c&&(c=a);b=d.computeFaceCount(b);return Math.sqrt(b/(c*Math.PI))}Object.defineProperty(f,"__esModule",
{value:!0});f.makeLodLevelResources=h;f.makeLodResources=c;f.fetchObjectLodResources=function(a,b){return e(this,void 0,void 0,function(){var d;return k(this,function(e){switch(e.label){case 0:return[4,g.fetchLod(a,b)];case 1:return d=e.sent(),[2,c(d)]}})})};f.estimateMinScreenSpaceRadius=b;f.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius=b(a)});a.levels[0].minScreenSpaceRadius=Math.min(2,a.levels[0].minScreenSpaceRadius)};var a=.05})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils","../../../../../geometry/support/aaBoundingBox"],function(m,f,k,e){function g(d){var e=[];d.components.forEach(function(c){e.push(c.geometry)});return k.unique(e)}Object.defineProperty(f,"__esModule",{value:!0});f.materialsFromLodResources=function(d){var e=[];d.levels.forEach(function(c){c.components.forEach(function(b){e.push(b.material)})});return k.unique(e)};f.texturesFromLodResources=function(d){var e=[];d.levels.forEach(function(c){c.components.forEach(function(b){b.textures&&
e.push.apply(e,b.textures)})});return k.unique(e)};f.geometriesFromLodLevelResources=g;f.geometriesFromLodResources=function(d){var e=[];d.levels.forEach(function(c){c.components.forEach(function(b){e.push(b.geometry)})});return k.unique(e)};f.computeBoundingBox=function(d){var h=e.empty();g(d).forEach(function(c){c=c.boundingInfo;e.expand(h,c.getBBMin());e.expand(h,c.getBBMax())});return h};f.computeFaceCount=function(d){var e=0;g(d).forEach(function(c){e+=c.data.indexCount/3});return e}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../geometry/support/aaBoundingBox ../../../lib/gl-matrix ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../RenderSlot ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){function x(a,b,c,d){q.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);a.model.getMat(b,C);c.model.setMat(d,C);a.modelNormal.getMat(b,C);c.modelNormal.setMat(d,C);a.color&&c.color&&(a.color.getVec(b,B),c.color.setVec(d,B));a.featureAttribute&&c.featureAttribute&&(a.featureAttribute.getVec(b,B),c.featureAttribute.setVec(d,B))}Object.defineProperty(f,"__esModule",{value:!0});var v=w.assert,z=function(){function a(a,b){this.glMaterials=
{};var e=a.rctx,h=b.geometry;b=b.material;var g=h.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.bufferWriter;var l=a.vertexBufferLayout,k=a.elementCount(g),f=a.allocate(k);a.write({},g,void 0,f,0);this.geometry=h;this.material=b;this.glMaterials=q.acquireGLMaterials(b,this.materialRep);this.vertexBufferLayout=l;this.vbo=t.createVertex(e,35044,f.buffer);this.vao=new u(e,c.Default3D,{geometry:d.glLayout(l)},{geometry:this.vbo});this.vertexCount=
k}a.prototype.destroy=function(){q.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});a.prototype.intersect=function(a,b,c,d,e){var h=this.geometry.id,g=d.toString();this.material.intersect(this.geometry,null,
F,a,b,c,function(b,c,l,k,f,n){if(0<=b){f={type:"external",metadata:e(d)};if(null==a.minResult.priority||k>=a.minResult.priority)if(null==a.minResult.dist||b<a.minResult.dist)a.minResult.set(f,g,b,c,k,null,h,l),a.minResult.setIntersector("LodRenderer");if(null==a.maxResult.priority||k>=a.maxResult.priority)if(null==a.maxResult.dist||b>a.maxResult.dist)a.maxResult.set(f,g,b,c,k,null,h,l),a.minResult.setIntersector("LodRenderer")}},null)};return a}();f.LodComponentData=z;var y=function(){function a(a,
b){var c=this;this.components=[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new z(a,b))})}a.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};a.prototype.intersect=function(a,b,c,d,e){this.components.forEach(function(h){h.intersect(a,b,c,d,e)})};Object.defineProperty(a.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=e.empty();this.components.forEach(function(b){e.expand(a,b.boundingInfo.bbMin);
e.expand(a,b.boundingInfo.bbMax)});this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var a=this.boundingBox,b=g.vec3d.create();e.center(a,b);this._boundingSphere={center:b,radius:.5*e.diameter(a)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},
0)},enumerable:!0,configurable:!0});return a}();f.LodLevelData=y;m=function(){function e(b,c,e){var g=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._lastCamera=new h;this._updateCyclesWithStaticCamera=-1;this.didRender=this._needFullCycle=!1;this._symbol=b;this._optionalFields=c;this._instanceToMetadata=e;this._instanceBufferLayout=r.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:c});this._glInstanceBufferLayout=d.glLayout(this._instanceBufferLayout,
{divisor:1});this._instanceData=new a.InstanceData(this._optionalFields);this._instanceData.on("instance-added",function(a){g.resetUpdateCycle()});this._instanceData.on("instance-removed",function(a){g.resetUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){g.resetUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){g.resetUpdateCycle();g.requestFullCycle()});this._instanceData.on("instance-highlight-changed",function(a){g.resetUpdateCycle();
g.requestFullCycle()});f.lodRenderers.push(this);window.lodRenderer=this}e.prototype.destroy=function(){f.lodRenderers.splice(f.lodRenderers.indexOf(this),1)};Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[0].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[0].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+
a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});e.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new y(a,d));b._renderInstanceData.push(new p.RenderInstanceData(c,
b._optionalFields,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new p.RenderInstanceData(c,b._optionalFields,b._instanceBufferLayout))});var d=this._levels[0].boundingSphere.radius,e=this._levels.map(function(a){return a.minScreenSpaceRadius});this._levelSelector=new n.LevelSelector(d,e);this._octree=new l.InstanceOctree(this._instanceData,this._levels[0].boundingSphere)};e.prototype.uninitializeRenderContext=function(a){this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});
this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(e.prototype,"slots",{get:function(){return[b.OPAQUE_EXTERNAL,b.TRANSPARENT_EXTERNAL]},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"needsRender",{get:function(){return 1>this._updateCyclesWithStaticCamera},
enumerable:!0,configurable:!0});e.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)};e.prototype.prepareRender=function(a){var b=a.equivalent(this._lastCamera);this._lastCamera.copyFrom(a);b||this.resetUpdateCycle();b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b)};e.prototype.render=function(a){var c=a.slot===b.OPAQUE_EXTERNAL?b.OPAQUE_MATERIAL:a.slot===b.TRANSPARENT_EXTERNAL?b.TRANSPARENT_MATERIAL:null;if(c){var d={view:a.camera.viewMatrix,
proj:a.camera.projectionMatrix,origin:[0,0,0],viewInvTransp:a.camera.viewInverseTransposeMatrix,lightingData:a.lightingData,viewport:a.camera.viewport,fovY:a.camera.fovY,nearFar:[a.camera.near,a.camera.far],framebufferTex:a.offscreenRenderingHelper?a.offscreenRenderingHelper.colorTexture:null,shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:a.pixelRatio,cameraAboveGround:a.camera.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?
a.offscreenRenderingHelper.hudVisibilityTexture:null};a.rctx.bindVAO();if(a.isHighlightPass)for(var e=0;e<this._levels.length;++e)this.renderLevel(a,c,d,this._highlightRenderInstanceData[e],this._levels[e]);else for(e=0;e<this._levels.length;++e)this.renderLevel(a,c,d,this._renderInstanceData[e],this._levels[e]);return!0}};e.prototype.intersect=function(b,c,d,e){var h=this;e=g.vec3d.create();g.vec3d.subtract(d,c,e);this._octree.forEachAlongRay(c,e,function(e){h._instanceData.getTranslation(e,A);h._instanceData.getModel(e,
C);g.vec3d.subtract(c,A,E);g.vec3d.subtract(d,A,D);g.mat3d.inverse(C,C);g.mat3d.multiplyVec3(C,E);g.mat3d.multiplyVec3(C,D);var l=h._instanceData.getState(e),k=h._instanceData.getLodLevel(e);v(l&a.StateFlags.ACTIVE,"invalid instance state");v(0<=k&&k<h._levels.length,"invaid lod level");h._levels[k].intersect(b,E,D,e,h._instanceToMetadata)})};e.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};e.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,d=this._octree.findClosest(c,
"front-to-back",a.frustumPlanes),e=this._octree.findClosest(c,"back-to-front",a.frustumPlanes);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,B),g.vec3d.subtract(B,b),d=g.vec3d.dot(B,c)-B[3],this._instanceData.view.boundingSphere.getVec(e,B),g.vec3d.subtract(B,b),b=g.vec3d.dot(B,c)+B[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};e.prototype.updateInstances=function(b,c){var d=this._levelSelector;d.updateCamera(b);this._renderInstanceData.forEach(function(a){a.beginUpdate()});
this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});b=this._instanceData;var e=this._instanceData.view,h=b.capacity,g=this._instanceIndex;c=Math.min(b.size,c);for(var l=0;l<c;++l){0===g&&this.startUpdateCycle();var k=e.state.get(g),f=0;if(k&a.StateFlags.ALLOCATED){var n=e.lodLevel.get(g);k&a.StateFlags.ACTIVE&&this._renderInstanceData[n].freeTail();k&a.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[n].freeTail();if(k&a.StateFlags.REMOVE)b.notifyRemoved(g);else if(k&
a.StateFlags.VISIBLE){e.modelOrigin.getVec(g,A);n=d.selectLevel(A,e.modelScaleFactor.get(g));f=k&~(a.StateFlags.ACTIVE|a.StateFlags.HIGHLIGHT_ACTIVE|a.StateFlags.TRANSFORM_CHANGED);if(0<=n){var m=this._renderInstanceData[n],p=m.allocateHead();x(e,g,m.view,p);f|=a.StateFlags.ACTIVE;k&a.StateFlags.HIGHLIGHT&&(m=this._highlightRenderInstanceData[n],p=m.allocateHead(),x(e,g,m.view,p),f|=a.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(g,f);e.lodLevel.set(g,n)}else f=k&~(a.StateFlags.ACTIVE|a.StateFlags.HIGHLIGHT_ACTIVE|
a.StateFlags.TRANSFORM_CHANGED),e.state.set(g,f);n=!!(k&a.StateFlags.ACTIVE);f=!!(f&a.StateFlags.ACTIVE);!n&&f?this._octree.addInstance(g):n&&!f?this._octree.removeInstance(g):n&&f&&k&a.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g));g=(g+1)%h}else g=(g+1)%h,c++}this._instanceIndex=g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;
this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()})};e.prototype.resetUpdateCycle=function(){this._updateCyclesWithStaticCamera=-1};e.prototype.requestFullCycle=function(){this._needFullCycle=!0};e.prototype.renderLevel=function(a,b,c,d,e){var h=this;e.components.forEach(function(e){h.renderComponent(a,b,c,d,e)})};e.prototype.renderComponent=function(a,d,e,h,g){var l=g.glMaterials[a.pass];if(l&&l.beginSlot(d)&&
l.isVisible&&0!==h.size){var k=a.rctx,f=k.capabilities.instancing,n=l.getDrawMode(k);e.origin=[0,0,0];d===b.STENCIL_MATERIAL&&(a.stencilRenderingHelper.enabled=!0,a.stencilRenderingHelper.prepareStencilWritePass());l.bind(k,e);k.bindVAO(g.vao);d=l.getProgram();w.assertCompatibleVertexAttributeLocations(g.vao,d);a.isHighlightPass&&(k.bindTexture(a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,5),d.setUniform1i("depthTex",5),d.setUniform4f("highlightViewportPixelSz",0,0,1/e.viewport[2],
1/e.viewport[3]));l.bindView(k,e);a=h.capacity;d=h.headIndex;var m=h.tailIndex,p=h.firstIndex,q=this._glInstanceBufferLayout,r=function(a,b){w.bindVertexBufferLayout(k,c.Default3D,h.buffer,q,a);f.drawArraysInstanced(n,0,g.vertexCount,b-a);w.unbindVertexBufferLayout(k,c.Default3D,h.buffer,q)};g.material.getParams().transparent&&null!=p?d>m?(v(p>=m&&p<=d,"invalid firstIndex"),r(p,d),r(m,p)):d<m&&(p<=d?(v(0<=p&&p<=d,"invalid firstIndex"),r(p,d),r(m,a),r(0,p)):(v(p>=m&&p<=a,"invalid firstIndex"),r(p,
a),r(0,d),r(m,p))):d>m?r(m,d):d<m&&(r(0,d),r(m,a));k.bindVAO(null);l.release(k,e)}};return e}();f.LodRenderer=m;f.lodRenderers=[];var A=g.vec3d.create(),B=g.vec4d.create(),C=g.mat3d.create(),E=g.vec3d.create(),D=g.vec3d.create(),F=g.mat4d.identity()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ../../../support/Evented ../../../support/buffer/BufferView ../../../../webgl/Util".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});var c=h.assert,b;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(b=f.StateFlags||(f.StateFlags={}));var a=function(){return function(a,b,c){var e=0;this.modelOrigin=new d.BufferViewVec3f64(a,e,c);e+=24;this.model=new d.BufferViewMat3f(a,e,c);
e+=36;this.modelNormal=new d.BufferViewMat3f(a,e,c);e+=36;this.modelScaleFactor=new d.BufferViewFloat(a,e,c);e+=4;this.boundingSphere=new d.BufferViewVec4f(a,e,c);e+=16;0<=b.indexOf("color")&&(this.color=new d.BufferViewVec4f(a,e,c),e+=16);0<=b.indexOf("featureAttribute")&&(this.featureAttribute=new d.BufferViewVec4f(a,e,c),e+=16);this.state=new d.BufferViewUint8(a,e,c);this.lodLevel=new d.BufferViewUint8(a,e+1,c)}}();f.View=a;m=function(d){function h(a){var b=d.call(this)||this;b._capacity=0;b._size=
0;b._next=0;b._optionalFields=a;b._elementSize=h.BASE_ELEMENT_SIZE;0<=b._optionalFields.indexOf("color")&&(b._elementSize+=16);0<=b._optionalFields.indexOf("featureAttribute")&&(b._elementSize+=16);return b}k(h,d);Object.defineProperty(h.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"size",{get:function(){return this._size},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});h.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,b.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};h.prototype.removeInstance=function(a){var d=this._view.state;
c(0<=a&&a<this._capacity&&d.get(a)&b.ALLOCATED,"invalid instance handle");this.getStateFlag(a,b.ACTIVE)?this.setStateFlags(a,b.REMOVE):this.notifyRemoved(a)};h.prototype.notifyRemoved=function(a){var d=this._view.state;c(0<=a&&a<this._capacity&&d.get(a)&b.ALLOCATED,"invalid instance handle");d.set(a,0);this._size--;this.emit("instance-removed",{index:a})};h.prototype.setTransform=function(a,c){var d=this._view,h=p,g=q;e.vec3d.set3(c[12],c[13],c[14],h);d.modelOrigin.setVec(a,h);e.mat4d.toMat3(c,g);
d.model.setMat(a,g);d.modelScaleFactor.set(a,e.mat4d.maxScale(c));e.mat3d.inverse(g,g);e.mat3d.transpose(g,g);d.modelNormal.setMat(a,g);this.setStateFlags(a,b.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:a})};h.prototype.getTransform=function(a,b){var c=this._view;c.model.getMat(a,q);c.modelOrigin.getVec(a,p);b[0]=q[0];b[1]=q[1];b[2]=q[2];b[3]=0;b[4]=q[3];b[5]=q[4];b[6]=q[5];b[7]=0;b[8]=q[6];b[9]=q[7];b[10]=q[8];b[11]=0;b[12]=p[0];b[13]=p[1];b[14]=p[2];b[15]=0};h.prototype.setTranslation=
function(a,b){this._view.modelOrigin.setVec(a,b);this.emit("instance-transform-changed",{index:a})};h.prototype.getTranslation=function(a,b){this._view.modelOrigin.getVec(a,b)};h.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};h.prototype.getScaleFactor=function(a){return this._view.modelScaleFactor.get(a)};h.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};h.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};h.prototype.getColor=function(a,
b){this._view.color.getVec(a,b)};h.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};h.prototype.setVisible=function(a,c){c!==this.getVisible(a)&&(this.setStateFlag(a,b.VISIBLE,c),this.emit("instance-visibility-changed",{index:a}))};h.prototype.getVisible=function(a){return this.getStateFlag(a,b.VISIBLE)};h.prototype.setHighlight=function(a,c){c!==this.getHighlight(a)&&(this.setStateFlag(a,b.HIGHLIGHT,c),this.emit("instance-highlight-changed",{index:a}))};h.prototype.getHighlight=
function(a){return this.getStateFlag(a,b.HIGHLIGHT)};h.prototype.getState=function(a){return this._view.state.get(a)};h.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};h.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};h.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};h.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};h.prototype.setStateFlag=function(a,
b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};h.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&b)};h.prototype.grow=function(){var b=Math.max(l,Math.floor(this._capacity*n)),c=new ArrayBuffer(b*this.elementSize);if(this._buffer){var d=new Uint8Array(this._buffer);(new Uint8Array(c)).set(d)}this._capacity=b;this._buffer=c;this._view=new a(this._buffer,this._optionalFields,this.elementSize)};h.prototype.findSlot=function(){for(var a=this._view.state,c=this._next;a.get(c)&
b.ALLOCATED;)c=(c+1)%this._capacity;this._next=(c+1)%this._capacity;return c};h.BASE_ELEMENT_SIZE=120;return h}(g.Evented);f.InstanceData=m;var l=1024,n=2,p=e.vec3d.create(),q=e.mat3d.create()})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function k(){this._listeners={}}k.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&0<this._listeners[e].size};k.prototype.on=function(e,
g){var d=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var h={};this._listeners[e].set(h,g);return{remove:function(){return d._listeners[e].delete(h)}}};k.prototype.emit=function(e,g){null!=this._listeners[e]&&this._listeners[e].forEach(function(d){return d(g)})};return k}();f.Evented=m})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/gl-matrix","../Octree"],function(m,f,
k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function h(c,b){var a=d.call(this,[0,0,0],1,{getCenter:function(b){var c=a._instanceData.view.boundingSphere,d=a._tmpCenter;d[0]=c.get(b,0);d[1]=c.get(b,1);d[2]=c.get(b,2);return d},getRadius:function(b){return a._instanceData.view.boundingSphere.get(b,3)}},{maximumDepth:25})||this;a._instanceData=c;a._boundingSphere=b;a._tmpCenter=e.vec3d.create();a._tmpTranslation=e.vec3d.create();a._tmpModel=e.mat3d.create();return a}k(h,d);
h.prototype.addInstance=function(c){var b=this._instanceData.view.boundingSphere,a=this._tmpCenter;this._instanceData.getModel(c,this._tmpModel);e.mat3d.multiplyVec3(this._tmpModel,this._boundingSphere.center,a);this._instanceData.getTranslation(c,this._tmpTranslation);e.vec3d.add(a,this._tmpTranslation);var d=this._boundingSphere.radius*this._instanceData.getScaleFactor(c);b.set(c,0,a[0]);b.set(c,1,a[1]);b.set(c,2,a[2]);b.set(c,3,d);this.add(c)};h.prototype.removeInstance=function(c){this.remove(c)};
return h}(g);f.InstanceOctree=m})},"esri/views/3d/webgl-engine/lib/Octree":function(){define(["require","exports","../../../../core/PooledArray","../../lib/gl-matrix","./Util"],function(m,f,k,e,g){function d(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function h(a,b,c){var d=a[0],e=a[1];a=a[2];return c[0][0]*d+c[0][1]*e+c[0][2]*a+c[0][3]>b||c[1][0]*d+c[1][1]*e+c[1][2]*a+c[1][3]>b||c[2][0]*d+c[2][1]*e+c[2][2]*a+c[2][3]>b||c[3][0]*d+c[3][1]*e+c[3][2]*a+c[3][3]>b||c[4][0]*d+c[4][1]*e+
c[4][2]*a+c[4][3]>b||c[5][0]*d+c[5][1]*e+c[5][2]*a+c[5][3]>b}function c(b,c,d){if(!D.length)for(var e=0;8>e;++e)D[e]={index:0,distance:0};for(e=0;8>e;++e){var h=p[e];D[e].index=e;D[e].distance=a(b,c,h)}D.sort(function(a,b){return a.distance-b.distance});for(e=0;8>e;++e)d[e]=D[e].index;return d}function b(b,c){for(var d=Infinity,e=null,h=0;8>h;++h){var g=a(b,c,q[h]);g<d&&(d=g,e=q[h])}return e}function a(a,b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}m=function(){function f(a,b,c,d){this._maximumObjectsPerNode=
10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=c;d&&(void 0!==d.maximumObjectsPerNode&&(this._maximumObjectsPerNode=d.maximumObjectsPerNode),void 0!==d.maximumDepth&&(this._maximumDepth=d.maximumDepth));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(b)?this._root=new l(null,e.vec3d.createFrom(0,0,0),.5):this._root=new l(null,a,b/2)}Object.defineProperty(f.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});f.prototype.add=function(a,b){a=this._objectOrObjectsArray(a);b=null==b?a.length:b;this._objectCount+=b;this._grow(a);for(var c=l.acquire(),d=0;d<b;d++){var e=a[d];c.init(this._root);this._isDegenerate(e)?this._degenerateObjects.add(e):this._add(e,c)}l.release(c)};f.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var c=l.acquire(),d=0;d<a.length;d++){var e=a[d],h=
b||this._boundingSphereFromObject(e,y);this._isValidRadius(h.radius)?(c.init(this._root),this._remove(e,h,c)):this._degenerateObjects.delete(e)}l.release(c);this._shrink()};f.prototype.update=function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};f.prototype.forEachAlongRay=function(a,b,c){var d=this;this._forEachNode(this._root,function(e){if(!d._intersectsNode(a,b,e))return!1;e=e.node;e.terminals.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});
null!==e.residents&&e.residents.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});return!0})};f.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};f.prototype.findClosest=function(a,b,c,d,e){return this._findClosest(a,"front-to-back"===b?n.FRONT_TO_BACK:n.BACK_TO_FRONT,c,d,e)};f.prototype.forEachInDepthRange=function(a,b,c,d,e,h,g,l){this._forEachInDepthRange(a,b,"front-to-back"===c?n.FRONT_TO_BACK:n.BACK_TO_FRONT,d,e,h,g,l)};f.prototype.forEachNode=function(a){this._forEachNode(this._root,
function(b){return a(b.node,b.center,2*b.halfSize)})};f.prototype._intersectsNode=function(a,b,c){d(c.center,2*-c.halfSize,x);d(c.center,2*c.halfSize,v);return g.rayBoxTest(a,b,x,v)};f.prototype._intersectsObject=function(a,b,c){var d=this._objectToBoundingSphere.getRadius(c);return 0<d?g.raySphere(a,b,this._objectToBoundingSphere.getCenter(c),d):!0};f.prototype._forEachNode=function(a,b){a=l.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&
c.push(l.acquire().init(a).advance(d));l.release(a)}};f.prototype._forEachNodeDepthOrdered=function(a,b,d,e){void 0===e&&(e=n.FRONT_TO_BACK);a=l.acquire().init(a);var h=[a];for(d=c(d,e,F);0!==h.length;){a=h.pop();if(b(a)&&!a.isLeaf())for(e=7;0<=e;--e){var g=d[e];g>=a.node.children.length||a.node.children[g]&&h.push(l.acquire().init(a).advance(g))}l.release(a)}};f.prototype._findClosest=function(c,d,g,l,k){var f=this,n=Infinity,m=Infinity,p=null,q=b(c,d),t=0,v=function(b){++t;if(!l||l(b)){var e=f._objectToBoundingSphere.getCenter(b),
k=f._objectToBoundingSphere.getRadius(b);if(!g||!h(e,k,g)){var e=a(c,d,e),q=e-k;q<n&&(n=q,m=e+k,p=b)}}};this._forEachNodeDepthOrdered(this._root,function(b){if(null!=k&&t>=k||g&&h(b.center,b.halfSize*r,g))return!1;e.vec3d.scale(q,b.halfSize,u);e.vec3d.add(u,b.center);if(a(c,d,u)>m)return!1;b=b.node;b.terminals.forEach(function(a){v(a)});null!==b.residents&&b.residents.forEach(function(a){v(a)});return!0},c,d);return p};f.prototype._forEachInDepthRange=function(c,d,g,l,k,f,m,p){var q=this,t=-Infinity,
v=Infinity,w={setRange:function(a){g===n.FRONT_TO_BACK?(t=Math.max(t,a.near),v=Math.min(v,a.far)):(t=Math.max(t,-a.far),v=Math.min(v,-a.near))}};w.setRange(l);var x=a(d,g,c),z=b(d,g),y=b(d,-1*g),A=0,C=function(b){++A;if(!m||m(b)){var c=q._objectToBoundingSphere.getCenter(b),e=q._objectToBoundingSphere.getRadius(b),l=a(d,g,c)-x;l-e>v||l+e<t||f&&h(c,e,f)||k(b,w)}};this._forEachNodeDepthOrdered(this._root,function(b){if(null!=p&&A>=p||f&&h(b.center,b.halfSize*r,f))return!1;e.vec3d.scale(z,b.halfSize,
u);e.vec3d.add(u,b.center);if(a(d,g,u)-x>v)return!1;e.vec3d.scale(y,b.halfSize,u);e.vec3d.add(u,b.center);if(a(d,g,u)-x<t)return!1;b=b.node;b.terminals.forEach(function(a){C(a)});null!==b.residents&&b.residents.forEach(function(a){C(a)});return!0},d,g)};f.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;t[0]=a;return t};f.prototype._remove=function(a,b,c){z.length=0;b=c.advanceTo(b,function(a,b){z.push(a.node,b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===
b.length)for(a=z.length-2;0<=a&&this._purge(z[a],z[a+1]);a-=2);};f.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};f.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new k({shrink:!0})),!0):!1};f.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,y))?b.node.terminals.push(a):
(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};f.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=l.acquire().init(a);this._add(b.data[c],d);l.release(d)}};f.prototype._grow=function(a){var b=this;if(0!==a.length&&(a=this._boundingSphereFromObjects(a,function(a,c){return b._boundingSphereFromObject(a,c)},A),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))e.vec3d.set(a.center,
this._root.center),this._root.halfSize=1.25*a.radius;else{var c=l.acquire();this._rootBoundsForRootAsSubNode(a,c);this._placingRootViolatesMaxDepth(c)?this._rebuildTree(a,c):this._growRootAsSubNode(c);l.release(c)}};f.prototype._rebuildTree=function(a,b){var c=this;e.vec3d.set(b.center,B.center);B.radius=b.halfSize;a=this._boundingSphereFromObjects([a,B],function(a){return a},C);b=l.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,function(a){c.add(a.node.terminals.data,
a.node.terminals.length);null!==a.node.residents&&c.add(a.node.residents.data,a.node.residents.length);return!0});l.release(b)};f.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};f.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,h=this._root.halfSize,g=0;3>g;g++){var l=
Math.max(0,Math.ceil((e[g]-h-(d[g]-c))/(2*h))),k=Math.max(0,Math.ceil((d[g]+c-(e[g]+h))/(2*h)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(l+k)*Math.LOG2E)));E[g].min=l;E[g].max=k}for(g=0;3>g;g++)l=E[g].min,k=E[g].max,c=(a-(l+k))/2,l+=Math.ceil(c),k+=Math.floor(c),w[g]=e[g]-h-l*h*2+(k+l)*h;return b.initFrom(null,w,a*h,0)};f.prototype._growRootAsSubNode=function(a){var b=this._root.node;e.vec3d.set(this._root.center,A.center);A.radius=this._root.halfSize;this._root.init(a);a.advanceTo(A,null,!0);
a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};f.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};f.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};f.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);
return!this._isValidRadius(a)};f.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};f.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};f.prototype._boundingSphereFromObject=function(a,b){e.vec3d.set(this._objectToBoundingSphere.getCenter(a),b.center);b.radius=this._objectToBoundingSphere.getRadius(a);return b};f.prototype._boundingSphereFromObjects=
function(a,b,c){if(1===a.length){var d=b(a[0],A);e.vec3d.set(d.center,c.center);c.radius=d.radius}else{x[0]=Infinity;x[1]=Infinity;x[2]=Infinity;v[0]=-Infinity;v[1]=-Infinity;v[2]=-Infinity;for(var h=0;h<a.length;h++)if(d=b(a[h],A),this._isValidRadius(d.radius)){var g=x,l=d.center,k=d.radius;g[0]=Math.min(g[0],l[0]-k);g[1]=Math.min(g[1],l[1]-k);g[2]=Math.min(g[2],l[2]-k);g=v;l=d.center;d=d.radius;g[0]=Math.max(g[0],l[0]+d);g[1]=Math.max(g[1],l[1]+d);g[2]=Math.max(g[2],l[2]+d)}e.vec3d.scale(e.vec3d.add(x,
v,c.center),.5);c.radius=Math.max(v[0]-x[0],v[1]-x[1],v[2]-x[2])/2}return c};return f}();var l=function(){function a(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=0);this.center=e.vec3d.create();this.initFrom(a,b,c,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(b,c,d,h){void 0===b&&(b=null);void 0===d&&(d=this.halfSize);void 0===h&&(h=this.depth);this.node=b||a.createEmptyNode();c&&e.vec3d.set(c,this.center);this.halfSize=d;this.depth=
h;return this};a.prototype.advance=function(b){var c=this.node.children[b];c||(c=a.createEmptyNode(),this.node.children[b]=c);this.node=c;this.halfSize/=2;this.depth++;b=p[b];this.center[0]+=b[0]*this.halfSize;this.center[1]+=b[1]*this.halfSize;this.center[2]+=b[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);
b&&b(this,d);this.advance(d)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new k({shrink:!0}),residents:new k({shrink:!0})}};a.acquire=function(){if(0===this._pool.length)return new a;var b=this._pool[this._pool.length-
1];this._pool.length--;return b};a.release=function(a){this._pool.push(a)};a._pool=[];return a}(),n;(function(a){a[a.FRONT_TO_BACK=1]="FRONT_TO_BACK";a[a.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(n||(n={}));var p=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],q=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],r=Math.sqrt(3),t=[null],w=e.vec3d.create(),u=e.vec3d.create(),x=e.vec3d.create(),v=e.vec3d.create(),z=[],y={center:e.vec3d.create(),radius:0},
A={center:e.vec3d.create(),radius:0},B={center:e.vec3d.create(),radius:0},C={center:e.vec3d.create(),radius:0},E=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],D=[],F=[];return m})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d){this._camera=new k;this._worldSpaceRadius=e;this._thresholds=d.map(function(d){return d})}e.prototype.updateCamera=function(e){this._camera.copyFrom(e)};
e.prototype.selectLevel=function(e,d){e=this._camera.computePixelSizeAt(e);d=this._worldSpaceRadius*d/e;e=this._thresholds;for(var h=-1,c=0;c<e.length;++c)d>=e[c]&&(h=c);return h};return e}();f.LevelSelector=m})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","./BackedBufferObject","../../../../webgl/Util"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=g.assert,h=function(){return function(a,
b,c){var d=0;this.modelOriginHi=new k.BufferViewVec3f(a,d,c);d+=12;this.modelOriginLo=new k.BufferViewVec3f(a,d,c);d+=12;this.model=new k.BufferViewMat3f(a,d,c);d+=36;this.modelNormal=new k.BufferViewMat3f(a,d,c);d+=36;0<=b.indexOf("color")&&(this.color=new k.BufferViewVec4f(a,d,c),d+=16);0<=b.indexOf("featureAttribute")&&(this.featureAttribute=new k.BufferViewVec4f(a,d,c),d+=16)}}();f.View=h;m=function(){function g(a,b,c){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=
!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._optionalFields=b;this._elementSize=c.stride;this._capacity=1}g.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(g.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"capacity",{get:function(){return this._capacity},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});g.prototype.reset=function(){this._tailIndex=
this._headIndex=0;this._firstIndex=null};g.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};g.prototype.beginUpdate=function(){d(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};g.prototype.endUpdate=function(){d(this._updating,"not updating");this.size<a*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};g.prototype.allocateHead=
function(){d(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();d(this._headIndex!==this._tailIndex,"invalid pointers");return a};g.prototype.freeTail=function(){d(this._updating,"not updating");d(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};g.prototype.grow=function(){this.resize(Math.max(c,Math.floor(this._capacity*
b)))};g.prototype.shrink=function(){n&&this.resize(Math.max(c,Math.floor(this._capacity*l)))};g.prototype.resize=function(a){d(this._updating,"not updating");if(a!==this._capacity){var b=new e(this._rctx,34962,35044,this._elementSize,a);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var c=this.size,g=this.compactInstances(b);d(g===c,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=g;this._prevHeadIndex=
0}this._resized=!0;this._capacity=a;this._buffer=b;this._view=new h(this._buffer.array,this._optionalFields,this._elementSize)}};g.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};g.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};g.prototype.incrementTail=
function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};g.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return g}();f.RenderInstanceData=m;var c=1024,b=2,a=.3,l=.5,n=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(m,f,k){return function(){function e(e,
d,h,c,b){this._elementSize=c;this._buffer=new k(e,d,h);this.resize(b)}e.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(e.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});e.prototype.copyRange=function(e,d,h,c){void 0===c&&(c=0);e=new Uint8Array(this.array,e*this.elementSize,(d-e)*this.elementSize);(new Uint8Array(h.array,c*this.elementSize)).set(e)};e.prototype.transferAll=function(){this._buffer.setData(this._array)};
e.prototype.transferRange=function(e,d){e*=this._elementSize;this._buffer.setSubData(this._array,e,e,d*this._elementSize)};e.prototype.resize=function(e){var d=e*this._elementSize,h=new ArrayBuffer(d);this._array&&(e>=this._capacity?(new Uint8Array(h)).set(new Uint8Array(this._array)):(new Uint8Array(h)).set((new Uint8Array(this._array)).subarray(0,e*this._elementSize)));this._array=h;this._buffer.setData(d);this._capacity=e};return e}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require",
"exports","../doublePrecisionUtils","../RenderPass"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.acquireGLMaterials=function(d,c){var b={};b[e.MATERIAL]=c.aquire(d);b[e.MATERIAL_DEPTH_SHADOWMAP]=c.aquireDepthShadowMap(d);b[e.MATERIAL_NORMAL]=c.aquireNormal(d);b[e.MATERIAL_DEPTH]=c.aquireDepth(d);b[e.MATERIAL_HIGHLIGHT]=c.aquireHighlight(d);return b};f.releaseGLMaterials=function(d,c){c.release(d.id);c.releaseDepthShadowMap(d.id);c.releaseNormal(d.id);c.releaseDepth(d.id);
c.releaseHighlight(d.id)};f.encodeDoubleVec3=function(e,c,b,a,l){g[0]=e.get(c,0);g[1]=e.get(c,1);g[2]=e.get(c,2);k.encodeDoubleArray(g,d,3);b.set(l,0,d[0]);a.set(l,0,d[1]);b.set(l,1,d[2]);a.set(l,1,d[3]);b.set(l,2,d[4]);a.set(l,2,d[5])};var g=new Float64Array(3),d=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/Point ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a,b,c,e){a=a.stageObject;for(var h=a.getGeometryRecords(),g=h.length,l="absolute-height"!==b.mode,k=0,f=0;f<g;f++){var n=h[f].geometry,m=[h[f].transformation[12],h[f].transformation[13],h[f].transformation[14]],p=n.data.getVertexAttr(),q=p[x.POSITION].data,r=p.zOffset.data,p=p.mapPos.data,t=p.length/3;u(q.length/3===t*A+2,"unexpected tube geometry");var w=0,C=0;z.spatialReference=c.spatialReference;for(var D=0,E=0;E<t;E++){z.x=p[3*E];z.y=p[3*E+
1];z.z=p[3*E+2];var B=d.computeElevation(c,z,b,e,l?y:null);l&&(D+=y.terrainElevation);var Y=A;0!==E&&E!==t-1||Y++;for(var X=0;X<Y;X++)v[0]=q[w]+m[0],v[1]=q[w+1]+m[1],v[2]=q[w+2]+m[2],e.setAltitude(B+r[C],v),q[w]=v[0]-m[0],q[w+1]=v[1]-m[1],q[w+2]=v[2]-m[2],w+=3,C+=1;n.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(f);k+=D/t}return k/g}var u=r.assert;m=function(e){function h(){return null!==e&&e.apply(this,arguments)||this}k(h,e);h.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
c.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),d=this._getMaterialOpacityAndColor(),e=b.vec3d.create(d),d=d[3],e={diffuse:e,ambient:e,opacity:d,transparent:1>d||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new t(e,a+"_3dlinemat");this._context.stage.add(l.ModelContentType.MATERIAL,this._material);
this.resolve()};h.prototype.destroy=function(){e.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,this._material.id),this._material=null)};h.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);
return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};h.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getMaterialOpacity(),c=1>b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:c}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var e in b){var h=b[e];if(a=c(h))h=this.getGraphicElevationContext(h.graphic),a.needsElevationUpdates=d.needsElevationUpdates3D(h.mode),a.elevationContext.set(h)}return!0}return!1};
Object.defineProperty(h.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});h.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?d.getSingleSizeDriver(a.size):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};h.prototype._getSymbolSize=function(){return this.symbol.size||1};h.prototype._createAs3DShape=function(c,e,h,l,k){var f=c.geometry,m=f.paths;c=[];var r=[],u=[],t=b.vec3d.create(),v=this._context.renderSpatialReference===
a.SphericalECEFSpatialReference,x=Array(6),z=this._getPathSize(e),f=d.getGeometryVertexData3D(m,f.hasZ,f.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,h);this._logGeometryCreationWarnings(f,m,"paths","PathSymbol3DLayer");if(0<m.length){for(var m=f.geometryData.outlines,y=f.eleVertexData,C=f.vertexData,B=0;B<m.length;++B){var E=m[B];if(!(1>=E.count)){var D=E.index,N=E.count;if(this._context.clippingExtent&&(d.computeBoundingBox(y,
D,N,x),d.boundingBoxClipped(x,this._context.clippingExtent)))continue;d.chooseOrigin(C,D,N,t);d.subtractCoordinates(C,D,N,t);E=new Float64Array(y.buffer,3*D*y.BYTES_PER_ELEMENT,3*N);D=d.flatArrayToArrayOfArrays(C,D,N);D=p.createTubeGeometry(D,.5*z,A,v,t);D.getVertexAttr().mapPos={size:3,data:E,offsetIdx:0,strideIdx:3};this._material.getParams().vertexColors&&(E=this._getVertexOpacityAndColor(e),D=p.addVertexColors(D,E));E=new n(D,l+"path"+B);E.singleUse=!0;c.push(E);r.push([this._material]);E=b.mat4d.identity();
b.mat4d.translate(E,t,E);u.push(E)}}if(0<c.length)return e=new q({geometries:c,materials:r,transformations:u,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:k},idHint:l}),e=new g(this,e,c,null,null,w,h),e.alignedTerrainElevation=f.terrainElevation,e.needsElevationUpdates=d.needsElevationUpdates3D(h.mode),e}return null};return h}(h);var x=r.VertexAttrConstants,v=b.vec3d.create(),z=new e,y={verticalDistanceToGround:0,terrainElevation:0},A=10;return m})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/gl-matrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){m=function(f){function m(){var a=null!==f&&f.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}k(m,f);m.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};m.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),
polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new A(b,a+"_colormat");this._context.stage.add(w.ModelContentType.MATERIAL,this._material)};m.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:g.pt2px(a.size),slicePlaneEnabled:this._context.slicePlaneEnabled},this._outlineMaterial=1.5<=a.width?r.createRibbonMaterial(a):
r.createNativeMaterial(a),this._context.stage.add(w.ModelContentType.MATERIAL,this._outlineMaterial)};m.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};m.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,
c=b.geometry.type;if("polyline"!==c&&"polygon"!==c&&"extent"!==c)return this._logWarning("unsupported geometry type for fill symbol: "+c),null;if(!this._validateGeometry(b.geometry))return null;c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,d,c):this._createAs3DShape(b,a,d,c,b.uid)};m.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),
c=this._getMaterialOpacity(),this._material.setColor([b[0],b[1],b[2],c]),this._material.setTransparent(1>c||this._isPropertyDriven("opacity")),this._outlineMaterial&&(b=this._outlineMaterial.getColor(),this._outlineMaterial.setColor([b[0],b[1],b[2],this._getOutlineOpacity()])),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===
a||"on-the-ground"===d))return!1;a=n.needsElevationUpdates2D(d);for(var e in b){var h=b[e];(d=c(h))&&"object3d"===d.type&&(h=h.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(h)))}return!0}return!1};m.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};m.prototype._createAs3DShape=
function(a,c,d,e,h){var g=this._getPolyGeometry(a);a=g.rings;var k=this._getOutlineGeometry(g,a),g=n.getGeometryVertexData3D(k,g.hasZ,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,d);D.idHint=e;D.color=c;D.data=g;var f;this._hasOutline&&(f=new g.vertexData.constructor(g.vertexData));D.outNum=0;D.outGeometries=[];D.outTransforms=[];D.outMaterials=[];this._createAs3DShapeFill(D);D.data.vertexData=f;this._createAs3DShapeOutline(D);
this._logGeometryCreationWarnings(D.data,a,"rings","FillSymbol3DLayer");if(0===D.outNum)return null;c=new v({geometries:D.outGeometries,materials:D.outMaterials,transformations:D.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:h},idHint:e});c=new l(this,c,D.outGeometries,null,null,b.perVertexElevationAligner,d);c.alignedTerrainElevation=g.terrainElevation;c.needsElevationUpdates=n.needsElevationUpdates2D(d.mode);return c};m.prototype._createAs3DShapeFill=function(a){for(var b=
a.data.geometryData.polygons,c=a.data.eleVertexData,e=a.data.vertexData,h=function(h){var l=b[h];h=l.count;var k=l.index;if(g._context.clippingExtent&&(n.computeBoundingBox(c,k,h,B),n.boundingBoxClipped(B,g._context.clippingExtent)))return"continue";var f=new Float64Array(c.buffer,3*k*c.BYTES_PER_ELEMENT,3*h),m=new Float64Array(e.buffer,3*k*e.BYTES_PER_ELEMENT,3*h),l=l.holeIndices.map(function(a){return a-k}),l=d(f,l,3);if(0===l.length)return"continue";n.chooseOrigin(e,k,h,C);n.subtractCoordinates(e,
k,h,C);h=g._createFillGeometry(l,0,m,f,a.color);h=new u(h,a.idHint);h.singleUse=!0;f=t.mat4d.identity();t.mat4d.translate(f,C,f);a.outGeometries.push(h);a.outMaterials.push([g._material]);a.outTransforms.push(f);a.outNum++},g=this,l=0;l<b.length;++l)h(l)};m.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,d=a.data.vertexData,e=0;e<b.length;++e){var h=b[e],g=h.index,l=h.count;if(this._context.clippingExtent&&(n.computeBoundingBox(c,
g,l,B),n.boundingBoxClipped(B,this._context.clippingExtent)))continue;n.chooseOrigin(d,g,l,C);n.subtractCoordinates(d,g,l,C);h=new Float64Array(c.buffer,3*g*c.BYTES_PER_ELEMENT,3*l);g=new Float64Array(d.buffer,3*g*d.BYTES_PER_ELEMENT,3*l);g=r.createPolylineGeometry(g,h,a.isRings,E,0);g=new u(g,a.idHint+"outline"+e);g.singleUse=!0;h=t.mat4d.identity();t.mat4d.translate(h,C,h);a.outGeometries.push(g);a.outMaterials.push([this._outlineMaterial]);a.outTransforms.push(h);a.outNum++}};m.prototype._createAsOverlay=
function(b,d,e,h){e=this._getPolyGeometry(b);b=e.rings;var g=this._getOutlineGeometry(e,b);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);e=n.getGeometryVertexDataDraped(g,e.spatialReference,this._context.overlaySR);D.idHint=h;D.color=d;D.data=e;var l;this._hasOutline&&(l=new e.vertexData.constructor(e.vertexData));D.outNum=0;D.outGeometries=[];D.outBoundingBox=c.empty();this._createAsOverlayFill(D);
D.data.vertexData=l;this._createAsOverlayOutline(D);this._logGeometryCreationWarnings(D.data,b,"rings","FillSymbol3DLayer");return 0<D.outNum?new a(this,D.outGeometries,D.outBoundingBox):null};m.prototype._createAsOverlayFill=function(a){for(var b=a.data.vertexData,e=a.data.geometryData.polygons,h=function(h){var l=e[h];h=l.count;var k=l.index,f=new Float64Array(b.buffer,3*k*b.BYTES_PER_ELEMENT,3*h),l=l.holeIndices.map(function(a){return a-k}),f=d(f,l,3);if(0===f.length)return"continue";n.computeBoundingBox(b,
k,h,B);if(n.boundingBoxClipped(B,g._context.clippingExtent))return"continue";c.expand(a.outBoundingBox,B);n.chooseOrigin(b,k,h,C);n.subtractCoordinates(b,k,h,C);n.setZ(b,k,h,g._getDrapedZ());h=t.mat4d.identity();t.mat4d.translate(h,C,h);f=g._createFillGeometry(f,k,b,null,a.color);l=new z(f);l.material=g._material;var m=B;l.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0];l.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]));l.transformation=h;l.name=a.idHint;l.uniqueName=a.idHint+"#"+f.id;
a.outGeometries.push(l);a.outNum++},g=this,l=0;l<e.length;++l)h(l)};m.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.data.vertexData,d=a.data.geometryData.outlines,e=0;e<d.length;++e){var h=d[e],g=h.index,h=h.count;n.computeBoundingBox(b,g,h,B);if(!n.boundingBoxClipped(B,this._context.clippingExtent)){c.expand(a.outBoundingBox,B);n.chooseOrigin(b,g,h,C);n.subtractCoordinates(b,g,h,C);n.setZ(b,g,h,this._getDrapedZ());h=new Float64Array(b.buffer,3*g*b.BYTES_PER_ELEMENT,
3*h);g=t.mat4d.identity();t.mat4d.translate(g,C,g);var h=r.createPolylineGeometry(h,null,!0,E,0),l=new z(h);l.material=this._outlineMaterial;var k=B;l.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0];l.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));l.transformation=g;l.name=a.idHint+"outline";l.uniqueName=a.idHint+"outline#"+h.id;a.outGeometries.push(l);a.outNum++}}};m.prototype._getOutlineGeometry=function(a,b){return b};m.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*
this.symbol.outline.color.a};m.prototype._getOutlineColor=function(){var a=this.symbol.outline.color,b=this._getOutlineOpacity();return q.mixinColorAndOpacity(e.toUnitRGB(a),b)};m.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?h.fromExtent(a):a};m.prototype._createFillGeometry=function(a,b,c,d,e){for(var h=a.length,g=new Uint32Array(h),l=new Uint32Array(h),k=0;k<h;k++)g[k]=a[k]+b,l[k]=0;a={};b={};a[y.VertexAttrConstants.POSITION]=g;a[y.VertexAttrConstants.COLOR]=l;b[y.VertexAttrConstants.POSITION]=
{size:3,data:c};b[y.VertexAttrConstants.COLOR]={size:4,data:e};d&&(b.mapPos={size:3,data:d},a.mapPos=g);return new x(b,a)};Object.defineProperty(m.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});return m}(p);var B=c.create(),C=t.vec3d.create(),E=new Float32Array([255,255,255,255]),D={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return m})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/ColorPrograms".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){m=function(b){function c(c,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.bufferWriter=new t;d.params=a.copyParameters(c,q);return d}k(c,b);c.prototype.getParams=function(){return this.params};c.prototype.getParameterValues=function(){return a.copyParameters(this.params)};c.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};c.prototype.getColor=function(){return this.params.color};c.prototype.setTransparent=function(a){this.params.transparent=
a;this.notifyDirty("matChanged")};c.prototype.getTransparent=function(){return this.params.transparent};c.prototype.intersect=function(b,c,d,e,h,g,l,k){a.intersectTriangleGeometry(b,c,d,e,h,g,l)};c.prototype.getGLMaterials=function(){return{color:n,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:p}};c.prototype.getAllTextureIds=function(){return[]};return c}(d);var n=function(b){function c(a,c,d){a=b.call(this,a,c)||this;a.updateParameters();return a}k(c,b);c.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){this.program=this.programRep.getProgram(l.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})};c.prototype.beginSlot=function(a){return a===(1>this.params.color[3]?h.TRANSPARENT_MATERIAL:h.OPAQUE_MATERIAL)};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",
c.color);a.setFaceCullingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));c.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(770,771,1,771));a.setDepthTestEnabled(!0)};c.prototype.release=function(a){var b=this.params;a.setPolygonOffsetFillEnabled(!1);b.transparent&&a.setBlendingEnabled(!1)};c.prototype.bindView=function(b,c){b=this.program;var d=this.params;a.bindView(c.origin,c.view,b);d.slicePlaneEnabled&&a.bindSlicePlane(c.origin,c.slicePlane,
b)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=function(a){return 4};return c}(g),p=function(b){function c(a,c,d){a=b.call(this,a,c)||this;a.updateParameters();return a}k(c,b);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){this.program=this.programRep.getProgram(l.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})};
c.prototype.beginSlot=function(a){return a===h.OPAQUE_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);a.setFaceCullingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};c.prototype.release=function(a){a.setPolygonOffsetFillEnabled(!1)};c.prototype.bindView=function(b,c){b=this.program;var d=this.params;a.bindView(c.origin,c.view,
b);d.slicePlaneEnabled&&a.bindSlicePlane(c.origin,c.slicePlane,b)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=function(a){return 4};return c}(g),q={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1},r=e.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec4u8(c.VertexAttrConstants.COLOR),t=function(){function a(){this.vertexBufferLayout=r}a.prototype.allocate=function(a){return r.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices[c.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,d,e,h){b.writeDefaultAttributes(c,d,r,a.transformation,a.invTranspTransformation,e,h)};return a}();return m})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){return g.glslifyDefineMap({VERTEX_COLORS:d.vertexColors,
SLICE:d.slice})};f.colorPass={name:"color-color",shaders:function(h){return{vertexShader:d(h)+e.resolveIncludes("materials/color/color.vert"),fragmentShader:d(h)+e.resolveIncludes("materials/color/color.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t=[1,1,1,1],w=[0,0,1],u={mode:"relative-to-ground",offset:0},x=[0,0,0,1];return function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return b}k(f,a);f.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=l.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};f.prototype.destroy=
function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject()};f.prototype.createGraphics3DGraphic=function(a,c,d,e){void 0===c&&(c={});a=a.graphic;var h=b.placePointOnGeometry(a.geometry);if(!h)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var g=c.text||this.symbol.text;if(!g||1>g.length)return null;null!=c.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=c.needsOffsetAdjustment);var l=this.getGraphicElevationContext(a,
c.elevationOffset||0);return this._createAs3DShape(this.symbol,h,g,l,this._context.layer.id+"_label_"+a.uid,a.uid,c,d,e,"polyline"===a.geometry.type)};f.prototype.getGraphicElevationContext=function(b,c){void 0===c&&(c=0);b=a.prototype.getGraphicElevationContext.call(this,b);b.addOffsetRenderUnits(c);return b};f.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationContext();
if(b)for(var d in b){a=b[d];var e=c(a);e&&this.updateGraphicElevationContext(a.graphic,e)}return!0}return!1};f.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);c.needsElevationUpdates=b.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};Object.defineProperty(f.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});f.prototype._defaultElevationInfoNoZ=function(){return u};
f.prototype._createAs3DShape=function(a,l,k,f,m,u,v,z,N,I){var y=v.centerOffset||x,A=v.screenOffset||[0,0],C=v.debugDrawBorder||!1,B=v.translation||[0,0,0],D=v.anchor||this._anchor||"center";this._anchor=D;var E=a.material?e.toUnitRGBA(a.material.color):t,F=a.halo&&a.halo.color&&0<a.halo.size,M=F?e.toUnitRGBA(a.halo.color):t,F=F?g.pt2px(a.halo.size):0,L=this._getTextSize(a),T=new q(k,{size:L,color:E,font:{family:a.font&&a.font.family?a.font.family:"sans-serif",weight:a.font&&a.font.weight?a.font.weight:
"normal",style:a.font&&a.font.style?a.font.style:"normal"},halo:{size:F,color:M}},m),S;z?S=v:d.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(S=this.symbolContainer);a={textureId:N?N.textureId:T.id,texCoordScale:N?[1,1]:T.texcoordScale,occlusionTest:!0,screenOffset:A,anchorPos:D,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:v.centerOffsetUnits,debugDrawBorder:C,drawInSecondSlot:!0};S&&S.verticalOffset&&(S=S.verticalOffset,A=S.minWorldLength,C=S.maxWorldLength,
a.verticalOffset={screenLength:g.pt2px(S.screenLength),minWorldLength:A||0,maxWorldLength:null!=C?C:Infinity});this._context.screenSizePerspectiveEnabled&&(S=this._context.sharedResources,A=S.screenSizePerspectiveSettings,a.screenSizePerspective=S.screenSizePerspectiveSettingsLabels.overridePadding(F),a.screenSizePerspectiveAlignment=A);I&&(a.shaderPolygonOffset=1E-4);a.slicePlaneEnabled=this._context.slicePlaneEnabled;I=null;F=JSON.stringify(a);null!=z?(I=z.getMaterial(F),null==I&&(I=new r(a,m),
z.addMaterial(F,I))):I=new r(a,m);I=[I];y=p.createPointGeometry(w,B,void 0,N?[0,0]:[T.textWidth,T.textHeight],y,N?[0,0]:null);y=[new n(y,m)];m=b.createStageObjectForPoint.call(this,l,y,[I],null,null,f,m,this._context.layer.uid,u,!0);if(null===m)return null;z=new c(this,m.object,y,null==z?I:null,N?null:[T],h.perObjectElevationAligner,f);z.alignedTerrainElevation=m.terrainElevation;z.needsElevationUpdates=b.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode;z.getScreenSize=function(a){void 0===
a&&(a=Array(2));a[0]=N?T.textWidth:T.width;a[1]=N?T.textHeight:T.height;return a};z.metadata={labelText:k,elevationOffset:v.elevationOffset||0};b.extendPointGraphicElevationContext(z,l,this._context.elevationProvider);return z};f.prototype._getTextSize=function(a){return g.pt2px((a||this.symbol).size)||12};return f}(a)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../support/mathUtils ./Texture ./Util ../../../webgl/Texture".split(" "),function(m,f,k,e,g,d){function h(){var a=
document.createElement("canvas");a.width=512;a.height=512;return a}function c(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function b(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}m=function(){function l(a,b,c,d){void 0===d&&(d=!0);this._idHint=c;this._text=a;this._textLines=a.split(/\r?\n/);this._params=b;this._haloSize=Math.round(this._params.halo.size);this._autoScale=d}Object.defineProperty(l.prototype,
"id",{get:function(){null==this._id&&(this._id=e.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});l.prototype.getParams=function(){return this._params};l.prototype.getText=function(){return this._text};l.prototype.deferredLoading=function(){return!1};Object.defineProperty(l.prototype,"width",{get:function(){this._width||(this._width=k.nextHighestPowerOfTwo(this.renderedWidth));return this._width},enumerable:!0,configurable:!0});l.prototype.getWidth=function(){return this.width};
Object.defineProperty(l.prototype,"height",{get:function(){this._height||(this._height=k.nextHighestPowerOfTwo(this.renderedHeight));return this._height},enumerable:!0,configurable:!0});l.prototype.getHeight=function(){return this.height};Object.defineProperty(l.prototype,"lineHeight",{get:function(){this._lineHeight||(this._lineHeight=this._computeLineHeight());return this._lineHeight},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"textWidth",{get:function(){this._textWidth||
(this._textWidth=this._computeTextWidth());return this._textWidth},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"textHeight",{get:function(){this._textHeight||(this._textHeight=this._computeTextHeight());return this._textHeight},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"renderedWidth",{get:function(){this._renderedWidth||(this._renderedWidth=Math.round(this.textWidth*this.scaleFactor));return this._renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,
"renderedHeight",{get:function(){this._renderedHeight||(this._renderedHeight=Math.round(this.textHeight*this.scaleFactor));return this._renderedHeight},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"scaleFactor",{get:function(){this._scaleFactor||(this._scaleFactor=this._autoScale?Math.min(1,Math.min(2048/this.textWidth,2048/this.textHeight)):1,this._autoScale&&g.assert(2048>=this.renderedWidth&&2048>=this.renderedHeight));return this._scaleFactor},enumerable:!0,configurable:!0});
Object.defineProperty(l.prototype,"texcoordScale",{get:function(){return[this.renderedWidth/this.width,this.renderedHeight/this.height]},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"fillStyle",{get:function(){this._fillStyle||(this._fillStyle=b(this._params.color));return this._fillStyle},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"haloStyle",{get:function(){this._haloStyle||(this._haloStyle=c(this._params.halo.color));return this._haloStyle},enumerable:!0,
configurable:!0});l.prototype.initializeThroughRender=function(a,b){var c=this._getTextCanvas();c.width=this._width;c.height=this._height;var e=c.getContext("2d");e.save();b.samplingMode=9987;b.wrapMode=33071;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,e,0,this._height-this._renderedHeight);a=new d(a,b,c);e.restore();return a};l.prototype.setUnloadFunc=function(a){this._unloadFunc=a};l.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),
this._unloadFunc=null)};l.prototype.renderText=function(b,c,d,e,h){void 0===e&&(e=0);void 0===h&&(h=0);c=this.lineHeight*this.scaleFactor;var g=this._haloSize,l=d.textAlign;b=("center"===l?.5*b:"right"===l?b:0)+g;d.save();var k=3>g;if(0<g){var l=g,f=this._getHaloCanvas();f.width=Math.max(512,this.renderedWidth);f.height=Math.max(512,this.renderedHeight);var n=f.getContext("2d");n.clearRect(0,0,f.width,f.height);this._setFontProperties(n,this._params.size*this.scaleFactor);n.fillStyle=this.haloStyle;
n.strokeStyle=this.haloStyle;n.lineJoin=k?"miter":"round";if(k)for(var m=0,p=this._textLines;m<p.length;m++){for(var k=p[m],q=0,r=a;q<r.length;q++){var t=r[q];n.fillText(k,b+g*t[0],g+g*t[1])}l+=c}else for(m=0,p=this._textLines;m<p.length;m++){k=p[m];q=2*g;for(r=0;5>r;r++)n.lineWidth=(.6+.1*r)*q,n.strokeText(k,b,l);l+=c}d.globalAlpha=this._params.halo.color[3];d.drawImage(f,e,h);f.width=512;f.height=512;d.globalAlpha=1}this._setFontProperties(d,this._params.size*this._scaleFactor);l=h+g;h=0;for(g=
this._textLines;h<g.length;h++)k=g[h],d.globalCompositeOperation="destination-out",d.fillStyle="rgb(0, 0, 0)",d.fillText(k,e+b,l),d.globalCompositeOperation="source-over",d.fillStyle=this.fillStyle,d.fillText(k,e+b,l),l+=c;d.restore()};l.preferredAtlasSize=function(){return 512};l.prototype._getTextCanvas=function(){null==l._textCanvas2D&&(l._textCanvas2D=h());return l._textCanvas2D};l.prototype._getHaloCanvas=function(){null==l._haloCanvas2D&&(l._haloCanvas2D=h());return l._haloCanvas2D};l.prototype._setFontProperties=
function(a,b){var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family;a.textAlign="left";a.textBaseline="top"};l.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var b=0,c=0,d=this._textLines;c<d.length;c++){var e=a.measureText(d[c]).width;e>b&&(b=e)}c=this._params.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&
600<c.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};l.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};l.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length};return l}();var a=[];for(f=0;360>f;f+=22.5)a.push([Math.cos(Math.PI*f/180),Math.sin(Math.PI*f/180)]);return m})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"../../support/PromiseLightweight"],function(m,f,k,e){return function(e){function d(d,c){var b=e.call(this)||this;b.symbol=d;b.graphics3DSymbol=null;d.fetchSymbol().then(function(a){if(b.isRejected())throw Error();a.id=b.symbol.id;b.graphics3DSymbol=c(a)}).then(function(){if(b.isRejected())throw Error();b.graphics3DSymbol.then(function(){b.isRejected()||b.resolve()},function(a){b.isRejected()||b.reject(a)})}).catch(function(a){b.isRejected()||b.reject(a)});return b}k(d,e);d.prototype.createGraphics3DGraphic=
function(d){return this.graphics3DSymbol.createGraphics3DGraphic(d,this)};Object.defineProperty(d.prototype,"numberOfVertices",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.numberOfVertices:0},enumerable:!0,configurable:!0});d.prototype.layerPropertyChanged=function(d,c){return this.graphics3DSymbol.layerPropertyChanged(d,c)};d.prototype.applyRendererDiff=function(d,c,b){return this.graphics3DSymbol.applyRendererDiff(d,c,b)};d.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};d.prototype.setDrawOrder=function(d,c){if(this.graphics3DSymbol)return this.graphics3DSymbol.setDrawOrder(d,c)};d.prototype.destroy=function(){this.isFulfilled()||this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return d}(e.Promise)})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(m,f,k,e){Object.defineProperty(f,
"__esModule",{value:!0});m=function(){function g(d,h){var c=this;this.owner=h;this.properties={};this.afterDispatchHandle=null;for(var b in d)h=new k(d[b],null,null,2,2),this.properties[b]={pool:h,acquired:[]};this.afterDispatchHandle=e.afterDispatch(function(){return c.release()})}g.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null};g.prototype.get=function(d){var e=this.owner._get(d);d=this.properties[d];var c=
d.pool.acquire();for(d.acquired.push(c);c===e;)d.acquired.push(c),c=d.pool.acquire();return c};g.prototype.release=function(){for(var d in this.properties){for(var h=this.properties[d],c=0,b=0,a=h.acquired;b<a.length;b++){var g=a[b];e.isValueInUse(g)?h.acquired[c++]=g:h.pool.release(g)}h.acquired.length=c}};return g}();f.PropertiesPool=m;f.default=m})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require","exports","../../lib/gl-matrix"],function(m,f,k){m=function(){function g(d,
e){this._origins=[];this._boxSize=d;this._maxNumOrigins=e}g.prototype.getOrigin=function(d){for(var h=this._origins.length,c,b=!1,a=Number.MAX_VALUE,l=0;l<h;l++){var f=this._origins[l];k.vec3d.subtract(d,f.vec3,e);e[0]=Math.abs(e[0]);e[1]=Math.abs(e[1]);e[2]=Math.abs(e[2]);var m=e[0]+e[1]+e[2];m<a&&(c=f,a=m,b=e[0]<this._boxSize&&e[1]<this._boxSize&&e[2]<this._boxSize)}b||c&&null!=this._maxNumOrigins&&!(this._origins.length<this._maxNumOrigins)||(h=g.OFFSET,f=[d[0]+h,d[1]+h,d[2]+h],c={vec3:f,id:this.getOriginId(f)},
this._origins.push(c));return c};g.prototype.getOriginId=function(d){return""+g.ORIGIN_PREFIX+d[0]+"/"+d[1]+"/"+d[2]};g.OFFSET=1.11;g.ORIGIN_PREFIX="fb_";return g}();var e=k.vec3d.create();return m})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ../../lib/gl-matrix ./IdGen ./ModelContentType ./Octree".split(" "),function(m,f,k,e,g,d,h){return function(){function c(b,a,d){this._parentStages=[];this._children=new Set;this.id=c._idGen.gen(d);this.name=
b;a=a||{};this.group=a.group||"";this.isPickable=null!=a.isPickable?a.isPickable:!0;this.translation=e.vec3d.create(a.translation);this._extent=[e.vec3d.createFrom(0,0,0),e.vec3d.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}c.prototype.getParentStages=function(){return this._parentStages};c.prototype.addParentStage=function(b){-1===this._parentStages.indexOf(b)&&this._parentStages.push(b)};c.prototype.removeParentStage=function(b){b=this._parentStages.indexOf(b);-1<b&&this._parentStages.splice(b,
1)};c.prototype.getName=function(){return this.name};c.prototype.getGroup=function(){return this.group};c.prototype.getTranslation=function(){return this.translation};c.prototype.getObjectIds=function(){return k.keysOfSet(this._children,function(b){return b.id})};c.prototype.getObjects=function(){return k.keysOfSet(this._children)};c.prototype.getExtent=function(){this._updateExtent();return this._extent};c.prototype.addObject=function(b){this._children.add(b);b.addParentLayer(this);this.notifyDirty("layObjectAdded",
b);this._invalidateExtent();this._octree&&this._octree.add(b)};c.prototype.hasObject=function(b){return this._children.has(b)};c.prototype.removeObject=function(b){return this._children.delete(b)?(b.removeParentLayer(this),this.notifyDirty("layObjectRemoved",b),this._invalidateExtent(),this._octree&&this._octree.remove(b),!0):!1};c.prototype.notifyObjectBBChanged=function(b,a){this._octree&&this._octree.update(b,a)};c.prototype.getCenter=function(){this._updateExtent();var b=e.vec3d.create();return e.vec3d.lerp(this._extent[0],
this._extent[1],.5,b)};c.prototype.getBSRadius=function(){this._updateExtent();return.5*e.vec3d.dist(this._extent[0],this._extent[1])};c.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};c.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};c.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null};c.prototype.notifyDirty=function(b,a,c,e){c=c||d.LAYER;
e=e||this;for(var h=0;h<this._parentStages.length;h++)this._parentStages[h].notifyDirty(c,e,b,a)};c.prototype._createOctree=function(){for(var b=this.getExtent(),a=0,c=0;3>c;c++)a=Math.max(a,b[1][c]-b[0][c]);c=e.vec3d.create();e.vec3d.lerp(b[0],b[1],.5,c);this._octree=new h(c,1.2*a,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(k.keysOfSet(this._children))};c.prototype._invalidateExtent=function(){this._extentDirty=!0};c.prototype._updateExtent=
function(){var b=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var a=null;this._children.forEach(function(c){var d=c.getBBMin();c=c.getBBMax();if(a)for(var h=0;3>h;++h)b._extent[0][h]=Math.min(b._extent[0][h],d[h]),b._extent[1][h]=Math.max(b._extent[1][h],c[h]);else a=[e.vec3d.create(d),e.vec3d.create(c)]});this._extent=a}};c._idGen=new g;return c}()})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect".split(" "),
function(m,f,k,e,g,d,h,c){var b=function(){function a(){this.extents=new d({initialSize:32,allocator:function(){return c.create()}});this.tempExtent=c.create()}Object.defineProperty(a.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"area",{get:function(){var a=0;this.extents.forEach(function(b){a+=c.area(b)});return a},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||
(this.removeContained(a),c.set(this.extents.pushNew(),a))};a.prototype.pop=function(){return this.extents.pop()};a.prototype.forEach=function(a){this.extents.forEach(function(b){return a(b)})};a.prototype.mergeAll=function(){for(;1<this.extents.length;){var a=this.extents.length-1;c.expand(this.extents.data[a-1],this.extents.data[a]);this.extents.pop()}};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,d=!1;!d;)for(var d=!0,e=0;e<a.length;++e){for(var h=e,g=a.data[h],k=c.area(g),
f=!1,m=a.length-1;m>h;--m){var v=a.data[m],z=c.area(v);c.expand(g,v,b);v=k+z;.05>(c.area(b)-v)/v&&(c.set(g,b),k=c.area(g),a.swapElements(m,a.length-1),a.pop(),f=!0)}if(f){d=!1;break}}};a.prototype.toArray=function(){return this.extents.toArray()};a.prototype.contains=function(a){return this.extents.some(function(b){return c.contains(b,a)})};a.prototype.removeContained=function(a){for(var b=this.extents.length-1;0<=b;--b)c.contains(a,this.extents.data[b])&&(this.extents.swapElements(b,this.extents.length-
1),this.extents.pop())};return a}();return function(a){function c(){var c=a.call(this)||this;c.dirtyExtents=new b;c.globalDirty=!1;c.dirtyGraphicsQueue=new d;c.elevationUpdateEventHandle=null;c.eventHandles=[];c.updateElevation=!1;c.layerView=null;c.graphicsCore=null;return c}k(c,a);Object.defineProperty(c.prototype,"updating",{get:function(){return this.hasPendingOperations()},enumerable:!0,configurable:!0});c.prototype.setup=function(a,b,c,d){var e=this;this.layerView=a;this.graphicsCore=c;this.elevationProvider=
d;this.queryGraphicUIDsInExtent=b;this.elevationUpdateEventHandle=d.on("elevation-change",function(a){return e.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",function(){return e.suspendedChange()}))};c.prototype.destroy=function(){this.dirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.queryGraphicUIDsInExtent=this.graphicsCore=
this.layerView=this.eventHandles=null};c.prototype.clear=function(){this.dirtyGraphicsQueue.clear();this.notifyChange("updating")};c.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};c.prototype.elevationInfoChange=function(){this.markAllGraphicsElevationDirty()};c.prototype.needsIdleUpdate=function(){return this.hasPendingOperations()};c.prototype.idleUpdate=function(a){var b=
this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1);for(var c=this.layerView.view,d=this.graphicsCore.stageLayer.id,e=this.graphicsCore.labelsEnabled?c.labeler.labelStageLayerId:null,h=!1;this.hasPendingOperations()&&!a.done();){for(;0<this.dirtyGraphicsQueue.length&&!a.done();){for(var g=Math.min(this.dirtyGraphicsQueue.length,100),l=0;l<g;l++){var k=this.dirtyGraphicsQueue.pop();(k=this.graphicsCore.graphics[k])&&k.alignWithElevation(this.elevationProvider,c.renderCoordsHelper)}c._stage.processDirtyLayer(d);
null!=e&&c._stage.processDirtyLayer(e)}for(;0<this.dirtyExtents.count&&100>this.dirtyGraphicsQueue.length&&!a.done();)h||(this.dirtyExtents.mergeTight(),h=!0),g=this.dirtyExtents.pop(),this.queryGraphicUIDsInExtent(g,this.spatialReference,function(a){var c=b.graphicsCore.graphics[a];c&&c.needsElevationUpdates()&&b.dirtyGraphicsQueue.push(a)})}c.deconflictor.setDirty();c.labeler.setDirty();this.notifyChange("updating")};c.prototype.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();
this.dirtyGraphicsQueue.clear();for(var a in this.graphicsCore.graphics)this.dirtyGraphicsQueue.push(+a);this.notifyChange("updating")};c.prototype.hasPendingOperations=function(){return 0<this.dirtyGraphicsQueue.length||0<this.dirtyExtents.count||this.globalDirty};c.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===
b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};e([h.property({readOnly:!0})],c.prototype,"updating",null);return c=e([h.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)}(h.declared(g))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection".split(" "),
function(m,f,k,e,g,d,h,c,b,a){var l=-.3*b.earthRadius;return function(b){function g(){var a=b.call(this)||this;a.suspended=!0;a._frustumVisibilityDirty=!0;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new d;a.layerView=null;return a}k(g,b);Object.defineProperty(g.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(a){a!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=a,this.notifyChange("updating"))},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0});g.prototype.setup=function(b){var c=this;this.layerView=b;this.extentIntersection=new a.FrustumExtentIntersection({renderCoordsHelper:b.view.renderCoordsHelper});b=b.view;var d=b.basemapTerrain;this.handles.add([b.on("resize",function(){return c.viewChange()}),b.state.watch("camera",function(){return c.viewChange()},!0),d.on("elevation-bounds-change",
function(){return c.elevationBoundsChange()})]);"local"===b.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(h.init(d,["opacity","wireframe"],function(){return c.isVisibleBelowSurface=d.isSeeThrough()}))};g.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty};g.prototype.setExtent=function(a){this.extent=a;this.frustumVisibilityDirty=
this.extentIntersectionDirty=!0};g.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};g.prototype.elevationBoundsChange=function(){this.extentIntersectionDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(g.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentIntersectionDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});g.prototype.idleUpdate=function(a){!a.done()&&this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),
this.frustumVisibilityDirty=!1)};g.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=l;else{b=a.basemapTerrain.getElevationBounds();var c=b[0];b=c-Math.max(1,(b[1]-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};g.prototype.updateSuspendFrustumVisible=function(){this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):
this._set("suspended",!1)};e([c.property({readOnly:!0})],g.prototype,"suspended",void 0);e([c.property({readOnly:!0})],g.prototype,"updating",null);return g=e([c.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],g)}(c.declared(g))})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});m=.5*Math.PI;var l=m/Math.PI*180,n=m*d.earthRadius,p=.9*d.earthRadius;d=function(){function d(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:g.vec3d.create(),direction:g.vec3d.create()};for(a=0;4>a;a++)this.extent[a]={origin:g.vec3d.create(),direction:g.vec3d.create(),cap:{next:null,direction:g.vec3d.create()}},this.planes[a]=h.plane.create();
this.planes[4]=h.plane.create();this.planes[5]=h.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}d.prototype.update=function(a,b,c,d){void 0===d&&(d=!0);var e=this.extent;this.toRenderBoundingExtent(a,b,c);g.vec3d.add(e[0].origin,e[2].origin,this.center.origin);g.vec3d.scale(this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);d||g.vec3d.scale(this.center.direction,-1);for(c=0;4>c;c++){var l=e[c];this.renderCoordsHelper.worldUpAtPosition(l.origin,
l.direction);var k=e[3===c?0:c+1];l.cap.next=k.origin;g.vec3d.direction(k.origin,l.origin,l.cap.direction);h.plane.fromVectorsAndPoint(l.direction,l.cap.direction,l.origin,this.planes[c]);d||g.vec3d.scale(l.direction,-1)}h.plane.fromVectorsAndPoint(e[0].cap.direction,e[1].cap.direction,e[0].origin,this.planes[4]);d?h.plane.negate(this.planes[4],this.planes[5]):(h.plane.set(this.planes[5],this.planes[4]),h.plane.negate(this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));
this.maxSpanSpatialReference=b};d.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?l:n))return!0;if(a.altitude>=p)return this.isVisibleInFrustumGlobal(a)}for(var d=0;d<this.extent.length;d++){var e=this.extent[d];if(!b&&a.intersectsRay(e.origin,null,e.direction)||a.intersectsLineSegment(e.origin,e.cap.next,e.cap.direction))return!0}b=b?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(e=
a.lines[d],c.frustumLineSegment(b,e.origin,e.endpoint,e.direction))return!0;return!1};d.prototype.toRenderBoundingExtentGlobal=function(c,d,h){e.center(c,r);r[2]=h;a.computeLinearTransformation(d,r,t,this.renderCoordsHelper.spatialReference);g.mat4d.inverse(t,w);k.empty(u);for(var l=0,f=q;l<f.length;l++)for(var n=f[l],m=n.x0,p=n.x1,v=n.y0,n=n.y1,x=0;5>x;x++){var z=x/4;r[0]=b.lerp(c[m],c[p],z);r[1]=b.lerp(c[v],c[n],z);r[2]=h;a.vectorToVector(r,d,r,this.renderCoordsHelper.spatialReference);g.mat4d.multiplyVec3(w,
r);k.expandPointInPlace(u,r)}g.mat4d.multiplyVec3(t,g.vec3d.set3(u[0],u[1],u[2],this.extent[0].origin));g.mat4d.multiplyVec3(t,g.vec3d.set3(u[3],u[1],u[2],this.extent[1].origin));g.mat4d.multiplyVec3(t,g.vec3d.set3(u[3],u[4],u[2],this.extent[2].origin));g.mat4d.multiplyVec3(t,g.vec3d.set3(u[0],u[4],u[2],this.extent[3].origin))};d.prototype.toRenderBoundingExtentLocal=function(a,b,c){g.vec3d.set3(a[0],a[1],c,this.extent[0].origin);g.vec3d.set3(a[2],a[1],c,this.extent[1].origin);g.vec3d.set3(a[2],a[3],
c,this.extent[2].origin);g.vec3d.set3(a[0],a[3],c,this.extent[3].origin)};d.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c)}};d.prototype.isVisibleInFrustumGlobal=function(a){if(0>g.vec3d.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>g.vec3d.dot(this.extent[b].direction,a.direction))return!0;return!1};return d}();f.FrustumExtentIntersection=
d;var q=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],r=g.vec3d.create(),t=g.mat4d.create(),w=g.mat4d.create(),u=k.create();f.default=d})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(m,f,k){return function(){function e(){this.graphicsCore=null;this.highlights=[]}e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()});this.highlights=
null};e.prototype.setup=function(e){this.graphicsCore=e};e.prototype.acquireSet=function(e,d){var h=this,c=new k(e,d);this.highlights.push(c);return{set:c,handle:{remove:function(){return h.releaseSet(c)}}}};e.prototype.releaseSet=function(e){e.highlightSet.removeAll();e=this.highlights?this.highlights.indexOf(e):-1;-1!==e&&this.highlights.splice(e,1)};e.prototype.setUids=function(e,d){var h=this.graphicsCore.graphics;d.forEach(function(c){e.ids.add(c);(c=h[c])&&c.addHighlight(e.highlightSet,e.options)})};
e.prototype.setObjectIds=function(e,d){var h=this.graphicsCore.graphics;d.forEach(function(b){return e.ids.add(b)});for(var c in h)(d=h[c])&&e.hasGraphic(d)&&d.addHighlight(e.highlightSet,e.options)};e.prototype.graphicCreated=function(e){this.highlights.forEach(function(d){d.hasGraphic(e)&&e.addHighlight(d.highlightSet,d.options)})};e.prototype.graphicDeleted=function(e){this.highlights.forEach(function(d){d.hasGraphic(e)&&e.removeHighlight(d.highlightSet)})};e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})};
return e}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(m,f,k){return function(){function e(e,d){this.highlightSet=new k;this.ids=new Set;this.options=e;this.objectIdField=d}e.prototype.hasGraphic=function(e){return this.objectIdField?this.ids.has(e.graphic.attributes[this.objectIdField]):this.ids.has(e.graphic.uid)};return e}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require",
"exports"],function(m,f){return function(){function k(){this.items=[]}k.prototype.addObject=function(e,g){this.items.push({type:"object",highlightId:g,object:e})};k.prototype.addRenderGeometry=function(e,g,d){this.items.push({type:"renderGeometry",highlightId:d,renderGeometry:e,renderer:g})};k.prototype.addExternal=function(e,g){this.items.push({type:"external",highlightId:g,remove:e})};k.prototype.remove=function(e){for(var g=this.items.length-1;0<=g;--g){var d=this.items[g];d.highlightId===e&&(this.removeHighlight(d),
this.items.splice(g,1))}};k.prototype.removeObject=function(e){for(var g=this.items.length-1;0<=g;--g){var d=this.items[g];"object"===d.type&&d.object===e&&(this.removeHighlight(d),this.items.splice(g,1))}};k.prototype.removeRenderGeometry=function(e){for(var g=this.items.length-1;0<=g;--g){var d=this.items[g];"renderGeometry"===d.type&&d.renderGeometry===e&&(this.removeHighlight(d),this.items.splice(g,1))}};k.prototype.removeAll=function(){var e=this;this.items.forEach(function(g){e.removeHighlight(g)});
this.items=[]};k.prototype.removeHighlight=function(e){switch(e.type){case "object":e.object.removeHighlights(e.highlightId);break;case "renderGeometry":e.renderer.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case "external":e.remove(e.highlightId)}};return k}()})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){function h(c,b){return null!==c&&0<c&&8E7>c||50<b}return function(c){function b(){var a=c.call(this)||this;a._scaleRangeActive=!1;a._layerScaleRangeVisibilityDirty=!0;a.layerScaleRangeVisibilityQuery=!1;a.scaleChangeEventHandle=null;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.suspended=!1;return a}k(b,c);Object.defineProperty(b.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},
set:function(a){this._layerScaleRangeVisibilityDirty!==a&&(this._layerScaleRangeVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0});b.prototype.setup=function(a,b,c,d,e){this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=d;this.basemapTerrain=e;this.updateScaleRangeActive()};
b.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=null};b.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};b.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};b.prototype.idleUpdate=function(a){this.layerView.view.basemapTerrain&&!a.done()&&
this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1)};b.prototype.scaleRangeActive=function(){return this._scaleRangeActive};b.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=!1;b.labelingInfo&&(c=c||b.labelingInfo.some(function(a){return a&&h(a.minScale,a.maxScale)}));c=c||h(b.minScale,b.maxScale);b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=
this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};b.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a)};b.prototype.updateSuspendScaleVisible=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};b.prototype.visibleAtScale=function(a,b,c){return null==a?!0:a>c&&(!b||a<b)};b.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};b.prototype.visibleAtLabelScale=function(a,b){return this.visibleAtScale(a,b.minScale,b.maxScale)};b.prototype.graphicScale=function(a){var b;
a.centroid?b=a.centroid:"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};b.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};b.prototype.updateGraphicScaleVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b)}return!1};b.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};b.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};b.prototype.scaleUpdateHandler=
function(a){var b=this;if(!this.layerView.suspended){var c=a.extent,d=a.scale,e=this.visibleAtLayerScale(d),h=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var g=a.centroid;g&&(c[0]>g.x||c[1]>g.y||c[2]<g.x||c[3]<g.y)||(g=!1,a.setVisibilityFlag(1,e)&&(g=!0),b.updateLabelScaleVisibility(a,d)&&(g=!0),g&&(h=!0))}});h&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=
!0};b.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(1,void 0)}));this.layerScaleRangeVisibilityDirty=!0};e([d.property({readOnly:!0})],b.prototype,"suspended",void 0);e([d.property({readOnly:!0})],b.prototype,"updating",null);return b=e([d.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],b)}(d.declared(g))})},
"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush".split(" "),function(m,f,k,e,g,d,h,c,b){m=function(h){function g(a){a=h.call(this)||this;a.index=new b.default(9,d("csp-restrictions")?function(a){return{minX:a.extent[0],
minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.spatialReference=null;return a}k(g,h);g.prototype.destroy=function(){this.index.clear();this.index=null};g.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(l.minX=a[0],l.minY=a[1],l.maxX=a[2],l.maxY=a[3],this.index.search(l,function(a){c(a.graphic.uid)}))};g.prototype.add=function(a){!a.addedToSpatialIndex&&a.computeExtent(this.spatialReference)&&(this.index.insert(a),
a.addedToSpatialIndex=!0)};g.prototype.addMany=function(b,c){void 0===c&&(c=b.length);a.clear();for(var d=0;d<c;d++){var e=b[d];!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(a.push(e),e.addedToSpatialIndex=!0)}this.index.load(a.data,a.length)};g.prototype.remove=function(a){a.addedToSpatialIndex&&(a.addedToSpatialIndex=!1,this.index.remove(a))};g.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.remove(a[b])};g.prototype.clear=function(){this.index.clear()};e([c.property({constructOnly:!0})],
g.prototype,"spatialReference",void 0);return g=e([c.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],g)}(c.declared(g));var a=new h({initialSize:50}),l={minX:0,minY:0,maxX:0,maxY:0};return m})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(m,f,k,e){function g(a,b){d(a,0,a.children.length,b,a)}function d(a,b,c,d,e){e||(e=q(null,!0));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;
for(var g=void 0;b<c;b++)g=a.children[b],h(e,a.leaf?d(g):g);return e}function h(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-b.minX}function b(a,b){return a.minY-b.minY}function a(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function l(a){return a.maxX-a.minX+(a.maxY-a.minY)}function n(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function p(a,b){return b.minX<=
a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function q(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function r(a,b,c,d,h){for(var g=[b,c];g.length;)if(c=g.pop(),b=g.pop(),!(c-b<=d)){var l=b+Math.ceil((c-b)/d/2)*d;e(a,l,b,c,h);g.push(b,l,l,c)}}Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(a,d){void 0===a&&(a=9);this.compareMinX=c;this.compareMinY=b;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,
a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));d&&("function"===typeof d?this.toBBox=d:this._initFormat(d));this.clear()}e.prototype.all=function(a){this._all(this.data,a)};e.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(p(a,c))for(t.clear();c;){for(var e=0,h=c.children.length;e<h;e++){var g=c.children[e],l=c.leaf?d(g):g;p(a,l)&&(c.leaf?b(g):n(a,l)?this._all(g,b):t.push(g))}c=t.pop()}};e.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!p(a,b))return!1;
for(t.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var h=b.children[d],g=b.leaf?c(h):h;if(p(a,g)){if(b.leaf||n(a,g))return!0;t.push(h)}}b=t.pop()}return!1};e.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,
this.data.height-a.height-1,!0)):this.data=a;return this};e.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};e.prototype.clear=function(){this.data=q([],!0);return this};e.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,e,h,g,l=this.toBBox(a);u.clear();for(x.clear();c||u.length;){c||(c=u.pop(),d=u.data[u.length-1],e=x.pop(),h=!0);if(c.leaf){a:{g=a;var k=c.children,f=b;if(f){for(var m=0;m<k.length;m++)if(f(g,k[m])){g=m;break a}g=-1}else g=k.indexOf(g)}if(-1!==
g){c.children.splice(g,1);u.push(c);this._condense(u);break}}h||c.leaf||!n(c,l)?d?(e++,c=d.children[e],h=!1):c=null:(u.push(c),x.push(e),e=0,d=c,c=c.children[0])}return this};e.prototype.toJSON=function(){return this.data};e.prototype.fromJSON=function(a){this.data=a;return this};e.prototype._all=function(a,b){for(w.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else w.pushArray(a.children);a=w.pop()}};e.prototype._build=function(a,b,c,d){var e=c-b+1,h=this._maxEntries,
l;if(e<=h)return l=q(a.slice(b,c+1),!0),g(l,this.toBBox),l;d||(d=Math.ceil(Math.log(e)/Math.log(h)),h=Math.ceil(e/Math.pow(h,d-1)));l=q([],!1);l.height=d;e=Math.ceil(e/h);h=e*Math.ceil(Math.sqrt(h));for(r(a,b,c,h,this.compareMinX);b<=c;b+=h){var k=Math.min(b+h-1,c);r(a,b,k,e,this.compareMinY);for(var f=b;f<=k;f+=e)l.children.push(this._build(a,f,Math.min(f+e-1,k),d-1))}g(l,this.toBBox);return l};e.prototype._chooseSubtree=function(b,c,d,e){for(;;){e.push(c);if(!0===c.leaf||e.length-1===d)break;for(var h=
Infinity,g=Infinity,l=void 0,k=0,f=c.children.length;k<f;k++){var n=c.children[k],m=a(n),p=(Math.max(n.maxX,b.maxX)-Math.min(n.minX,b.minX))*(Math.max(n.maxY,b.maxY)-Math.min(n.minY,b.minY))-m;p<g?(g=p,h=m<h?m:h,l=n):p===g&&m<h&&(h=m,l=n)}c=l||c.children[0]}return c};e.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);u.clear();d=this._chooseSubtree(c,this.data,b,u);d.children.push(a);for(h(d,c);0<=b;)if(u.data[b].children.length>this._maxEntries)this._split(u,b),b--;else break;this._adjustParentBBoxes(c,
u,b)};e.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=q(c.children.splice(d,c.children.length-d),c.leaf);d.height=c.height;g(c,this.toBBox);g(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};e.prototype._splitRoot=function(a,b){this.data=q([a,b],!1);this.data.height=a.height+1;g(this.data,this.toBBox)};e.prototype._chooseSplitIndex=function(b,c,e){var h,g,l;h=g=Infinity;for(var k=
c;k<=e-c;k++){var f=d(b,0,k,this.toBBox),n=d(b,k,e,this.toBBox),m;m=Math.max(0,Math.min(f.maxX,n.maxX)-Math.max(f.minX,n.minX))*Math.max(0,Math.min(f.maxY,n.maxY)-Math.max(f.minY,n.minY));f=a(f)+a(n);m<h?(h=m,l=k,g=f<g?f:g):m===h&&f<g&&(g=f,l=k)}return l};e.prototype._chooseSplitAxis=function(a,d,e){var h=a.leaf?this.compareMinX:c,g=a.leaf?this.compareMinY:b,l=this._allDistMargin(a,d,e,h);d=this._allDistMargin(a,d,e,g);l<d&&a.children.sort(h)};e.prototype._allDistMargin=function(a,b,c,e){a.children.sort(e);
e=this.toBBox;for(var g=d(a,0,b,e),k=d(a,c-b,c,e),f=l(g)+l(k),n=b;n<c-b;n++){var m=a.children[n];h(g,a.leaf?e(m):m);f+=l(g)}for(n=c-b-1;n>=b;n--)m=a.children[n],h(k,a.leaf?e(m):m),f+=l(k);return f};e.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)h(b.data[c],a)};e.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():g(a.data[b],this.toBBox)};e.prototype._initFormat=
function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return e}();f.PooledRBush=m;var t=new k({initialSize:50}),w=new k({initialSize:50}),u=new k({initialSize:10}),x=new k({initialSize:10});f.default=m})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function m(e,g,d,h,c){for(;h>
d;){if(600<h-d){var b=h-d+1,a=g-d+1,l=Math.log(b),k=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*k*(b-k)/b)*(0>a-b/2?-1:1);m(e,g,Math.max(d,Math.floor(g-a*k/b+l)),Math.min(h,Math.floor(g+(b-a)*k/b+l)),c)}b=e[g];a=d;k=h;f(e,d,g);for(0<c(e[h],b)&&f(e,d,h);a<k;){f(e,a,k);a++;for(k--;0>c(e[a],b);)a++;for(;0<c(e[k],b);)k--}0===c(e[d],b)?f(e,d,k):(k++,f(e,k,h));k<=g&&(d=k+1);g<=k&&(h=k-1)}}function f(e,g,d){var h=e[g];e[g]=e[d];e[d]=h}function k(e,g){return e<g?-1:e>g?1:0}return function(e,g,d,h,c){m(e,g,d||0,h||
e.length-1,c||k)}})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.attributeLookup=function(k,e){e=e.toLowerCase();for(var g=0,d=Object.keys(k);g<d.length;g++){var h=d[g];if(h.toLowerCase()===e)return k[h]}return null}})},"esri/views/3d/layers/graphics/stats":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.stats=function(k,e){var g=e.graphics3DGraphics,
d="null",h=k.suspendResumeExtent;h&&(d=[h[0],h[1],h[2],h[3]].map(function(b){return b.toPrecision(4)}).join(", "));var h="null",c=e.computedExtent;c&&(h=[c.xmin,c.ymin,c.xmax,c.ymax].map(function(b){return b.toPrecision(4)}).join(", "));return{numCollection:k.loadedGraphics.length,numGraphics:Object.keys(g).length,graphicsUpdating:e.updating,resumeExtent:d,computedExtent:h,updating:k.updating,suspended:k.suspended}}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require",
"exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.toViewIfLocal=function(d){var h=d.view.spatialReference,c=d.layer.fullExtent,b=c&&c.spatialReference;return b?b.equals(h)?k.resolve(c.clone()):e.canProject(b,h)?k.resolve(e.project(c,h)):d.view.state.isLocal?g.projectGeometry(c,h,d.layer.portalItem).then(function(a){if(!d.destroyed&&a)return a}).catch(function(){return null}):
k.resolve(null):k.resolve(null)}})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../config ../../core/Error ../../core/promiseUtils ../Portal ../PortalItem ../../tasks/GeometryService ../../tasks/support/ProjectParameters".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a){void 0===a&&(a=null);if(k.geometryServiceUrl)return g.resolve(new c({url:k.geometryServiceUrl}));if(!a)return g.reject(new e("internal:geometry-service-url-not-configured"));var b;a.isInstanceOf(h)?
b=a.portal||d.getDefault():a.isInstanceOf(d)&&(b=a);return b.load().then(function(a){if(a.helperServices&&a.helperServices.geometry&&a.helperServices.geometry.url)return g.resolve(new c({url:a.helperServices.geometry.url}));throw new e("internal:geometry-service-url-not-configured");})}Object.defineProperty(f,"__esModule",{value:!0});f.create=a;f.projectGeometry=function(c,d,e){void 0===e&&(e=null);return a(e).then(function(a){var e=new b;e.geometries=[c];e.outSpatialReference=d;return a.project(e)}).then(function(a){return a&&
Array.isArray(a)&&1===a.length?a[0]:g.reject()})}})},"esri/portal/PortalItem":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/JSONSupport ../core/lang ../core/Loadable ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ./Portal ./PortalRating".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){return function(c){function d(a){a=c.call(this)||this;a.access=null;a.accessInformation=
null;a.applicationProxies=null;a.avgRating=null;a.categories=null;a.created=null;a.culture=null;a.description=null;a.extent=null;a.groupCategories=null;a.id=null;a.itemControl=null;a.licenseInfo=null;a.modified=null;a.name=null;a.numComments=null;a.numRatings=null;a.numViews=null;a.owner=null;a.portal=null;a.screenshots=null;a.size=null;a.snippet=null;a.tags=null;a.title=null;a.type=null;a.typeKeywords=null;a.url=null;return a}k(d,c);f=d;Object.defineProperty(d.prototype,"displayName",{get:function(){var a=
this.type,b=this.typeKeywords||[],c=a;"Feature Service"===a||"Feature Collection"===a?c=-1<b.indexOf("Table")?"Table":-1<b.indexOf("Route Layer")?"Route Layer":-1<b.indexOf("Markup")?"Markup":"Feature Layer":"Image Service"===a?c=-1<b.indexOf("Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?c="Scene Layer":"Scene Package"===a?c="Scene Layer Package":"Stream Service"===a?c="Feature Layer":"Geoprocessing Service"===a&&this.portal&&this.portal.isPortal?c=-1<b.indexOf("Web Tool")?
"Tool":"Geoprocessing Service":"Geocoding Service"===a?c="Locator":"Microsoft Powerpoint"===a?c="Microsoft PowerPoint":"GeoJson"===a?c="GeoJSON":"Globe Service"===a?c="Globe Layer":"Vector Tile Service"===a?c="Tile Layer":"netCDF"===a?c="NetCDF":"Map Service"===a?c=-1===b.indexOf("Spatiotemporal")&&(-1<b.indexOf("Hosted Service")||-1<b.indexOf("Tiled"))?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")?c=a.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===a&&(c="Big Data File Share");
return c},enumerable:!0,configurable:!0});d.prototype.readExtent=function(a){return a&&a.length?new n(a[0][0],a[0][1],a[1][0],a[1][1]):null};Object.defineProperty(d.prototype,"iconUrl",{get:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],c=!1,d=!1,e=!1,h=!1,g=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a||"wfs"===a?(c=-1<b.indexOf("Hosted Service"),"feature service"===a||"feature collection"===a||"kml"===a||"wfs"===a?(d=-1<b.indexOf("Table"),
e=-1<b.indexOf("Route Layer"),h=-1<b.indexOf("Markup"),a=(g=-1!==b.indexOf("Spatiotemporal"))&&d?"spatiotemporaltable":d?"table":e?"routelayer":h?"markup":g?"spatiotemporal":c?"featureshosted":"features"):a="map service"===a||"wms"===a||"wmts"===a?c||-1<b.indexOf("Tiled")||"wmts"===a?"maptiles":"mapimages":"scene service"===a?-1<b.indexOf("Line")?"sceneweblayerline":-1<b.indexOf("3DObject")?"sceneweblayermultipatch":-1<b.indexOf("Point")?"sceneweblayerpoint":-1<b.indexOf("IntegratedMesh")?"sceneweblayermesh":
-1<b.indexOf("PointCloud")?"sceneweblayerpointcloud":-1<b.indexOf("Polygon")?"sceneweblayerpolygon":"sceneweblayer":"image service"===a?-1<b.indexOf("Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===a?"datastorecollection":"geocoding service"===a?"geocodeservice":"geoprocessing service"===a?-1<b.indexOf("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"layers"):a="web map"===a||"cityengine web scene"===
a?"maps":"web scene"===a?-1<b.indexOf("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<b.indexOf("ArcGIS Pro")||
"explorer map"===a&&b.indexOf("Explorer Document")?"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a||"360 vr experience"===a||"netcdf"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"arcgis pro add in"===a||"arcgis pro configuration"===a?"addindesktop":"rule package"===a||"file geodatabase"===a||"sqlite geodatabase"===a||"csv collection"===a||"kml collection"===
a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"explorer map"===a&&-1<b.indexOf("Explorer Mapping Application")||-1<b.indexOf("Document")?"datafilesgray":"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===
a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"scene package"===a?"scenepackage":"mobile scene package"===a?"mobilescenepackage":"tile package"===a?"tilepackage":"task file"===a?"taskfile":"report template"===a?"report-template":"statistical data collection"===a?"statisticaldatacollection":"insights workbook"===a?"workbook":"insights model"===a?"insightsmodel":"insights page"===a?
"insightspage":"insights theme"===a?"insightstheme":"hub initiative"===a?"hubinitiative":"hubpage"===a?"hubpage":"hub site application"===a?"hubsite":"relational database connection"===a?"relationaldatabaseconnection":"big data file share"===a?"datastorecollection":"image collection"===a?"imagecollection":"style"===a?"style":"desktop style"===a?"desktopstyle":"dashboard"===a?"dashboard":"raster function template"===a?"rasterprocessingtemplate":"vector tile package"===a?"vectortilepackage":"ortho mapping project"===
a?"orthomappingproject":"ortho mapping template"===a?"orthomappingtemplate":"solution"===a?"solutions":"maps";return a?m.toUrl("../images/portal/"+a+"16.png"):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isLayer",{get:function(){return-1<"Map Service;Feature Service;Feature Collection;Scene Service;Image Service;Stream Service;Vector Tile Service;WMTS;WMS".split(";").indexOf(this.type)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"itemUrl",{get:function(){var a=
this.get("portal.restUrl");return a?a+"/content/items/"+this.id:null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"thumbnailUrl",{get:function(){var a=this.itemUrl,b=this.thumbnail;return a&&b?this.portal._normalizeUrl(a+"/info/"+b+"?f\x3djson"):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"userItemUrl",{get:function(){var a=this.get("portal.restUrl");if(!a)return null;var b=this.owner||this.get("portal.user.username");return b?a+"/content/users/"+
(this.ownerFolder?b+"/"+this.ownerFolder:b)+"/items/"+this.id:null},enumerable:!0,configurable:!0});d.prototype.load=function(){var a=this;this.portal||(this.portal=p.getDefault());var b=this.portal.load().then(function(){return a.resourceInfo?a.resourceInfo:a.id&&a.itemUrl?a.portal._request(a.itemUrl):{}}).then(function(b){a.resourceInfo=b;a.read(b)});this.addResolvingPromise(b);return this.when()};d.prototype.addRating=function(a){var b={method:"post",query:{}};a instanceof q&&(a=a.rating);isNaN(a)||
"number"!==typeof a||(b.query.rating=a);return this.portal._request(this.itemUrl+"/addRating",b).then(function(){return new q({rating:a,created:new Date})})};d.prototype.deleteRating=function(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(function(){})};d.prototype.fetchData=function(a){void 0===a&&(a="json");return this.portal._request(this.itemUrl+"/data",{responseType:a})};d.prototype.fetchRating=function(){return this.portal._request(this.itemUrl+"/rating").then(function(a){return null!=
a.rating?(a.created=new Date(a.created),new q(a)):null})};d.prototype.fetchRelatedItems=function(a){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:a},"PortalItem")};d.prototype.getThumbnailUrl=function(a){var b=this.thumbnailUrl;b&&a&&(b+="\x26w\x3d"+a);return b};d.prototype.update=function(a){var c=this;return this.id?this.load().then(function(){return c.portal._signIn()}).then(function(){var b=a&&a.data,d={method:"post"};d.query=c._getPostQuery();for(var e in d.query)null===
d.query[e]&&(d.query[e]="");d.query.clearEmptyFields=!0;null!=b&&("string"===typeof b?d.query.text=b:"object"===typeof b&&(d.query.text=JSON.stringify(b)));return c.portal._request(c.userItemUrl+"/update",d).then(function(){return c._reload()})}):b.reject(new g("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))};d.prototype.updateThumbnail=function(c){var d=this;return this.id?this.load().then(function(){return d.portal._signIn()}).then(function(){var b=c.thumbnail,
e={method:"post"};if("string"===typeof b)a.isDataProtocol(b)?e.query={data:b}:e.query={url:a.makeAbsolute(b)};else{var h=new FormData;h.append("file",b);e.body=h}return d.portal._request(d.userItemUrl+"/updateThumbnail",e).then(function(){return d._reload()})}):b.reject(new g("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))};d.prototype.toJSON=function(){var a=this.extent,a={created:this.created&&this.created.getTime(),description:this.description,extent:a&&[[a.xmin,
a.ymin],[a.xmax,a.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return h.fixJson(a)};d.fromJSON=function(a){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");return new f({resourceInfo:a})};d.prototype._reload=function(){var a=this;return this.portal._request(this.itemUrl,
{query:{_ts:(new Date).getTime()}}).then(function(b){a.resourceInfo=b;a.read(b);return a})};d.prototype._getPostQuery=function(){var a=this.toJSON(),b;for(b in a)"tags"===b&&null!==a[b]&&(a[b]=a[b].join(", ")),"typeKeywords"===b&&null!==a[b]&&(a[b]=a[b].join(", "));return a};var f;e([l.property()],d.prototype,"access",void 0);e([l.property()],d.prototype,"accessInformation",void 0);e([l.property({json:{read:{source:"appProxies"}}})],d.prototype,"applicationProxies",void 0);e([l.property()],d.prototype,
"avgRating",void 0);e([l.property()],d.prototype,"categories",void 0);e([l.property({type:Date})],d.prototype,"created",void 0);e([l.property()],d.prototype,"culture",void 0);e([l.property()],d.prototype,"description",void 0);e([l.property({dependsOn:["type","typeKeywords"],readOnly:!0})],d.prototype,"displayName",null);e([l.property({type:n})],d.prototype,"extent",void 0);e([l.reader("extent")],d.prototype,"readExtent",null);e([l.property()],d.prototype,"groupCategories",void 0);e([l.property({dependsOn:["type",
"typeKeywords"],readOnly:!0})],d.prototype,"iconUrl",null);e([l.property()],d.prototype,"id",void 0);e([l.property({dependsOn:["type"],readOnly:!0})],d.prototype,"isLayer",null);e([l.property()],d.prototype,"itemControl",void 0);e([l.property({dependsOn:["portal.restUrl","id"],readOnly:!0})],d.prototype,"itemUrl",null);e([l.property()],d.prototype,"licenseInfo",void 0);e([l.property({type:Date})],d.prototype,"modified",void 0);e([l.property()],d.prototype,"name",void 0);e([l.property()],d.prototype,
"numComments",void 0);e([l.property()],d.prototype,"numRatings",void 0);e([l.property()],d.prototype,"numViews",void 0);e([l.property()],d.prototype,"owner",void 0);e([l.property()],d.prototype,"ownerFolder",void 0);e([l.property({type:p})],d.prototype,"portal",void 0);e([l.property()],d.prototype,"resourceInfo",void 0);e([l.property()],d.prototype,"screenshots",void 0);e([l.property()],d.prototype,"size",void 0);e([l.property()],d.prototype,"snippet",void 0);e([l.property()],d.prototype,"tags",void 0);
e([l.property()],d.prototype,"thumbnail",void 0);e([l.property({dependsOn:["itemUrl","thumbnail","portal.credential.token"],readOnly:!0})],d.prototype,"thumbnailUrl",null);e([l.property()],d.prototype,"title",void 0);e([l.property()],d.prototype,"type",void 0);e([l.property()],d.prototype,"typeKeywords",void 0);e([l.property()],d.prototype,"url",void 0);e([l.property({dependsOn:["portal.restUrl","portal.user.username","owner","ownerFolder","id"],readOnly:!0})],d.prototype,"userItemUrl",null);return d=
f=e([l.subclass("esri.portal.PortalItem")],d)}(l.declared(d,c))})},"esri/portal/PortalRating":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(h){function c(b){b=h.call(this)||this;b.created=null;b.rating=null;return b}k(c,h);e([d.property()],c.prototype,"created",void 0);e([d.property()],c.prototype,"rating",void 0);return c=e([d.subclass("esri.portal.PortalRating")],
c)}(d.declared(g))})},"esri/tasks/GeometryService":function(){define("../core/lang ../core/kebabDictionary ../core/accessorSupport/ensureType ../geometry/Extent ../geometry/Multipoint ../geometry/Polyline ../geometry/Polygon ../geometry/support/jsonUtils ../request ./Task ./support/ProjectParameters".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){var n=f({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),p=k.ensureType(l);f=a.createSubclass({declaredClass:"esri.tasks.GeometryService",
areasAndLengths:function(a,c){a={query:m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/areasAndLengths",a).then(function(a){return a.data})},autoComplete:function(a,c,d){var e=a[0].spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),polygons:JSON.stringify(this._encodeGeometries(a).geometries),polylines:JSON.stringify(this._encodeGeometries(c).geometries)})};
if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/autoComplete",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new h({spatialReference:e,rings:a.rings})})})},buffer:function(a,c){var d=m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),e=a.outSpatialReference||a.geometries[0].spatialReference;a={query:d};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/buffer",a).then(function(a){return(a.data.geometries||
[]).map(function(a){return new h({spatialReference:e,rings:a.rings})})})},cut:function(a,d,e){var h=a[0].spatialReference,g=a.map(function(a){return a.toJSON()});a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),target:JSON.stringify({geometryType:c.getJsonType(a[0]),geometries:g}),cutter:JSON.stringify(d.toJSON())})};if(this.requestOptions||e)a=m.mixin({},this.requestOptions,e,a);return b(this.parsedUrl.path+"/cut",a).then(function(a){a=a.data;return{cutIndexes:a.cutIndexes,
geometries:(a.geometries||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})}})},convexHull:function(a,d){var e=a[0].spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))})};if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/convexHull",a).then(function(a){return c.fromJSON(a.data.geometry).set("spatialReference",e)})},densify:function(a,d){var e=
m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),h=a.geometries[0].spatialReference;a={query:e};if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/densify",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})})},difference:function(a,d,e){var h=a[0].spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),
geometry:JSON.stringify({geometryType:c.getJsonType(d),geometry:d.toJSON()})})};if(this.requestOptions||e)a=m.mixin({},this.requestOptions,e,a);return b(this.parsedUrl.path+"/difference",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})})},distance:function(a,c){a={query:m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/distance",a).then(this._handleDistanceResponse)},
fromGeoCoordinateString:function(a,c){var d={};d.sr=null!=a.sr&&"object"===typeof a.sr?a.sr.wkid||JSON.stringify(a.sr):a.sr;d.strings=JSON.stringify(a.strings);d.conversionType=n.toJSON(a.conversionType||"mgrs");d.conversionMode=a.conversionMode;a={query:m.mixin({},this.parsedUrl.query,{f:"json"},d)};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/fromGeoCoordinateString",a).then(this._handleFromGeoCoordinateResponse)},generalize:function(a,d){var e=
m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),h=a.geometries[0].spatialReference;a={query:e};if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/generalize",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})})},intersect:function(a,d,e){var h=a[0].spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),
geometry:JSON.stringify({geometryType:c.getJsonType(d),geometry:d.toJSON()})})};if(this.requestOptions||e)a=m.mixin({},this.requestOptions,e,a);return b(this.parsedUrl.path+"/intersect",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})})},lengths:function(a,c){a={query:m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/lengths",a).then(function(a){return a.data})},
labelPoints:function(a,d){var e=a.map(function(a){return a.toJSON()}),h=a[0].spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:h.wkid?h.wkid:JSON.stringify(h.toJSON()),polygons:JSON.stringify(e)})};if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/labelPoints",a).then(function(a){return(a.data.labelPoints||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})})},offset:function(a,d){var e=m.mixin({},this.parsedUrl.query,
{f:"json"},a.toJSON()),h=a.geometries[0].spatialReference;a={query:e};if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/offset",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set("spatialReference",h)})})},project:function(a,d){a=p(a);var e=m.mixin({},a.toJSON(),this.parsedUrl.query,{f:"json"}),h=a.outSpatialReference,g=c.getJsonType(a.geometries[0]),l=this._decodeGeometries;a={query:e};if(this.requestOptions||d)a=
m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/project",a).then(function(a){return l(a.data,g,h)})},relation:function(a,c){a={query:m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON())};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/relation",a).then(this._handleRelationResponse)},reshape:function(a,d,e){var h=a.spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),target:JSON.stringify({geometryType:c.getJsonType(a),
geometry:a.toJSON()}),reshaper:JSON.stringify(d.toJSON())})};if(this.requestOptions||e)a=m.mixin({},this.requestOptions,e,a);return b(this.parsedUrl.path+"/reshape",a).then(function(a){return c.fromJSON(a.data.geometry).set("spatialReference",h)})},simplify:function(a,d){var e=a[0].spatialReference,h=m.mixin({},this.parsedUrl.query,{f:"json",sr:e.wkid?e.wkid:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))}),g=c.getJsonType(a[0]),l=this._decodeGeometries;a={query:h};
if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/simplify",a).then(function(a){return l(a.data,g,e)})},toGeoCoordinateString:function(a,c){var d={};d.sr=null!=a.sr&&"object"===typeof a.sr?a.sr.wkid||JSON.stringify(a.sr):a.sr;d.coordinates=JSON.stringify(a.coordinates);d.conversionType=n.toJSON(a.conversionType||"mgrs");d.conversionMode=a.conversionMode;d.numOfDigits=a.numOfDigits;d.rounding=a.rounding;d.addSpaces=a.addSpaces;a={query:m.mixin({},this.parsedUrl.query,
{f:"json"},d)};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/toGeoCoordinateString",a).then(this._handleToGeoCoordinateResponse)},trimExtend:function(a,c){var e=m.mixin({},this.parsedUrl.query,{f:"json"},a.toJSON()),h=a.sr;a={query:e};if(this.requestOptions||c)a=m.mixin({},this.requestOptions,c,a);return b(this.parsedUrl.path+"/trimExtend",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new d({spatialReference:h,paths:a.paths})})})},
union:function(a,d){var e=a[0].spatialReference;a={query:m.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))})};if(this.requestOptions||d)a=m.mixin({},this.requestOptions,d,a);return b(this.parsedUrl.path+"/union",a).then(function(a){return c.fromJSON(a.data.geometry).set("spatialReference",e)})},_handleRelationResponse:function(a){return a.data.relations},_handleDistanceResponse:function(a){return(a=a.data)&&a.distance},_handleToGeoCoordinateResponse:function(a){return a.data.strings},
_handleFromGeoCoordinateResponse:function(a){return a.data.coordinates},_encodeGeometries:function(a){var b=[],d,e=a.length;for(d=0;d<e;d++)b.push(a[d].toJSON());return{geometryType:c.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,d){var e=c.getGeometryType(b);a=a.geometries;var h=[],g={spatialReference:d.toJSON()},l=m.mixin;a.forEach(function(a,b){h[b]=new e(l(a,g))});return h},_toProjectGeometry:function(a){var b=a.spatialReference.toJSON();return a instanceof e?new h({rings:[[[a.xmin,
a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:b}):new d({paths:[[].concat(a.points)],spatialReference:b})},_fromProjectedGeometry:function(a,b,c){return"extent"===b?(a=a.rings[0],new e(a[0][0],a[0][1],a[2][0],a[2][1],c)):new g({points:a.paths[0],spatialReference:c.toJSON()})}});m.mixin(f,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});return f})},"esri/tasks/Task":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/tsSupport/assignHelper ../core/Accessor ../core/urlUtils ../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function h(b){b=a.call(this)||this;b.requestOptions=null;b.url=null;return b}k(h,a);h.prototype.normalizeCtorArgs=function(a,b){return"string"!==typeof a?a:d({url:a},b)};Object.defineProperty(h.prototype,"parsedUrl",{get:function(){return this._parseUrl(this.url)},enumerable:!0,configurable:!0});h.prototype._parseUrl=function(a){return a?c.urlToObject(a):null};h.prototype._encode=function(a,b,c){var d={},e;for(e in a)if("declaredClass"!==e){var h=a[e];
if(null!=h&&"function"!==typeof h)if(Array.isArray(h)){d[e]=[];for(var g=0;g<h.length;g++)d[e][g]=this._encode(h[g])}else"object"===typeof h?h.toJSON&&(h=h.toJSON(c&&c[e]),d[e]=b?h:JSON.stringify(h)):d[e]=h}return d};e([b.property({readOnly:!0,dependsOn:["url"]})],h.prototype,"parsedUrl",null);e([b.property()],h.prototype,"requestOptions",void 0);e([b.property({type:String})],h.prototype,"url",void 0);return h=e([b.subclass("esri.tasks.Task")],h)}(b.declared(h))})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(m,f,k,e,g,d,h,c){var b=d.getLogger("esri.tasks.support.ProjectParameters");return function(a){function d(b){b=a.call(this)||this;b.geometries=null;b.outSpatialReference=null;b.transformation=null;b.transformForward=null;return b}k(d,a);Object.defineProperty(d.prototype,"outSR",{get:function(){b.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){b.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});d.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),b=this.geometries[0],d={};d.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());d.inSR=b.spatialReference.wkid||JSON.stringify(b.spatialReference.toJSON());d.geometries=JSON.stringify({geometryType:c.getJsonType(b),geometries:a});this.transformation&&(d.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(d.transformForward=this.transformForward);return d};e([h.property()],d.prototype,"geometries",void 0);e([h.property({json:{read:{source:"outSR"}}})],d.prototype,"outSpatialReference",void 0);e([h.property({json:{read:!1}})],d.prototype,"outSR",null);e([h.property()],d.prototype,"transformation",void 0);e([h.property()],d.prototype,"transformForward",void 0);return d=e([h.subclass("esri.tasks.support.ProjectParameters")],d)}(h.declared(g))})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){return function(h){function c(){var b=null!==h&&h.apply(this,arguments)||this;b.refreshTimestamp=null;return b}k(c,h);c.prototype.refresh=function(b){void 0===b&&(b=Date.now());this._set("refreshTimestamp",b);this.doRefresh&&this.doRefresh()};e([d.property()],c.prototype,"layer",void 0);e([d.aliasOf("layer.refreshInterval")],c.prototype,"refreshInterval",void 0);e([d.property({readOnly:!0})],c.prototype,"refreshTimestamp",void 0);return c=e([d.subclass("esri.layers.mixins.RefreshableLayerView")],
c)}(d.declared(g))})},"webSceneViewer/AppState":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/core/Accessor esri/core/Evented ./support/AddLayerState ./support/RunningTasks ./support/UrlParameters ./support/Device esri/views/3d/support/DisplayQualityProfile".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n){var p=function(){return function(){this.extent=null}}(),q=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}k(b,a);b.prototype.error=function(a){this.emit("error",a)};return b=e([g.subclass("webSceneViewer.Errors")],b)}(g.declared(h));return function(d){function h(){var c=null!==d&&d.apply(this,arguments)||this;c.urlParameters=new a;c.runningTasks=new b;c.extraLayerData={};c.errors=new q;c.config={initialLoadTimeout:2E4};c.authoringMode="";c.anonymousAuthoringEnabled=!1;c.initialDialogsOpened=!1;c.warningsToConsole=!1;c.device=new l;return c}k(h,d);h.prototype.initialize=
function(){var a=this;this.addLayerState=new c;this.watch("view.map",function(){return a.clearExtraLayerData()});for(var b=function(b){null!=d.urlParameters[b]&&Object.keys(n.profiles).forEach(function(c){n.profiles[c][b]=a.urlParameters[b]})},d=this,e=0,h=["gpuMemoryLimit","additionalCacheMemory"];e<h.length;e++)b(h[e])};h.prototype.ensureExtraLayerData=function(a){this.extraLayerData[a.uid]||(this.extraLayerData[a.uid]=new p);return this.extraLayerData[a.uid]};h.prototype.clearExtraLayerData=function(){this.extraLayerData=
{}};e([g.property()],h.prototype,"view",void 0);e([g.property()],h.prototype,"portal",void 0);e([g.property()],h.prototype,"urlParameters",void 0);e([g.property({readOnly:!0})],h.prototype,"runningTasks",void 0);e([g.property()],h.prototype,"appVersion",void 0);e([g.property()],h.prototype,"errors",void 0);e([g.property()],h.prototype,"addLayerState",void 0);e([g.property()],h.prototype,"telemetry",void 0);e([g.property()],h.prototype,"config",void 0);e([g.property()],h.prototype,"authoringMode",
void 0);e([g.property()],h.prototype,"anonymousAuthoringEnabled",void 0);e([g.property()],h.prototype,"initialDialogsOpened",void 0);e([g.property()],h.prototype,"warningsToConsole",void 0);e([g.property({readOnly:!0})],h.prototype,"device",void 0);return h=e([g.subclass("webSceneViewer.AppState")],h)}(g.declared(d))})},"webSceneViewer/support/AddLayerState":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/core/Accessor esri/core/Collection esri/core/promiseUtils".split(" "),
function(m,f,k,e,g,d,h,c){m=function(a){function c(c){c=a.call(this)||this;c.layersBeingAdded=new h;c.mutex=new b;return c}k(c,a);e([g.property({readOnly:!0})],c.prototype,"layersBeingAdded",void 0);e([g.property({readOnly:!0})],c.prototype,"mutex",void 0);return c=e([g.subclass("webSceneViewer.support.AddLayerState")],c)}(g.declared(d));var b=function(){function a(){this.locked=!1;this.queue=[]}a.prototype.doExclusive=function(a){var b=this;return c.create(function(c,d){var e=function(){b._lock();
a().then(function(a){b._unlock();c(a)},function(a){b._unlock();d(a)})};b.locked?b.queue.push(e):e()})};a.prototype._lock=function(){this.locked=!0};a.prototype._unlock=function(){this.locked=!1;0!==this.queue.length&&this.queue.shift()()};return a}();return m})},"webSceneViewer/support/RunningTasks":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/core/Accessor".split(" "),function(m,f,k,e,g,d){var h=
function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.task={};return a}k(b,c);b.prototype.replace=function(a){var b={};this.task=b;return a?a(this.isRunning.bind(this,b),b):{task:b,isRunning:this.isRunning.bind(this,b)}};b.prototype.isRunning=function(a){return a===this.task};return b=e([g.subclass("webSceneViewer.RunningTask")],b)}(g.declared(d));return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.goToInitial=new h;return a}k(b,c);e([g.property({readOnly:!0})],
b.prototype,"goToInitial",void 0);return b=e([g.subclass("webSceneViewer.RunningTasks")],b)}(g.declared(d))})},"webSceneViewer/support/UrlParameters":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators dojo/topic dojo/hash esri/core/Accessor ./urlUtils".split(" "),function(m,f,k,e,g,d,h,c,b){h;return function(a){function c(c){c=a.call(this)||this;var e=b.urlParams();c._readParametersFromHashMap(e);d.subscribe("/dojo/hashchange",
c._updateSlideNumber.bind(c));c._updateSlideNumber();return c}k(c,a);h=c;Object.defineProperty(c.prototype,"noUrlParams",{get:function(){return null==this.antialias&&null==this.gpuMemoryLimit&&null==this.additionalCacheMemory&&(null==this.layers||0===this.layers.length)&&null==this.ui&&null==this.url&&null==this.viewingmode&&null==this.viewpoint&&null==this.webscene&&null==this.noView&&null==this.slideNumber},enumerable:!0,configurable:!0});c.prototype._updateSlideNumber=function(){var a=window.location.hash,
b=null;a&&(a=h._parseNumber(a.slice(1)),null!=a&&(b=a-1));this._set("slideNumber",b)};c.prototype._readParametersFromHashMap=function(a){this._set("antialias",h._parseBoolean(a.antialias));this._set("gpuMemoryLimit",h._parseNumber(a.gpuMemoryLimit));this._set("additionalCacheMemory",h._parseNumber(a.additionalCacheMemory));this._set("layers",h._parseList(a.layers));this._set("portal",a.portal);this._set("ui",a.ui);this._set("url",a.url);this._set("viewingmode",a.viewingmode);this._set("viewpoint",
a.viewpoint);this._set("webscene",a.webscene);this._set("noView",a.noView)};c._parseBoolean=function(a){return"true"===a?!0:"false"===a?!1:null};c._parseNumber=function(a){a=parseFloat(a);return isNaN(a)?null:a};c._parseList=function(a){return"string"===typeof a&&(a=a.split(",").filter(function(a){return 0<a.length}),0<a.length)?a:null};c.prototype.getViewpointObject=function(){return this.viewpoint?b.viewpointFromUrlParameter(this.viewpoint):null};var h;e([g.property({readOnly:!0})],c.prototype,
"antialias",void 0);e([g.property({readOnly:!0})],c.prototype,"gpuMemoryLimit",void 0);e([g.property({readOnly:!0})],c.prototype,"additionalCacheMemory",void 0);e([g.property({readOnly:!0})],c.prototype,"layers",void 0);e([g.property({readOnly:!0})],c.prototype,"portal",void 0);e([g.property({readOnly:!0})],c.prototype,"ui",void 0);e([g.property({readOnly:!0})],c.prototype,"url",void 0);e([g.property({readOnly:!0})],c.prototype,"viewingmode",void 0);e([g.property({readOnly:!0})],c.prototype,"viewpoint",
void 0);e([g.property({readOnly:!0})],c.prototype,"webscene",void 0);e([g.property({readOnly:!0})],c.prototype,"noView",void 0);e([g.property({readOnly:!0})],c.prototype,"slideNumber",void 0);e([g.property({readOnly:!0,dependsOn:"antialias gpuMemoryLimit additionalCacheMemory layers portal ui url viewingmode viewpoint webscene noView slideNumber".split(" ")})],c.prototype,"noUrlParams",null);return c=h=e([g.subclass("webSceneViewer.support.UrlParameters")],c)}(g.declared(c))})},"dojo/hash":function(){define("./_base/kernel require ./_base/config ./aspect ./_base/lang ./topic ./domReady ./sniff".split(" "),
function(m,f,k,e,g,d,h,c){function b(a,b){b=a.indexOf(b);return 0<=b?a.substring(b+1):""}function a(){return b(location.href,"#")}function l(){d.publish("/dojo/hashchange",a())}function n(){a()!==r&&(r=a(),l())}function p(a){if(t)if(t.isTransitioning())setTimeout(g.hitch(null,p,a),u);else{var b=t.iframe.location.href,c=b.indexOf("?");t.iframe.location.replace(b.substring(0,c)+"?"+a)}else b=location.href.replace(/#.*/,""),location.replace(b+"#"+a),!w&&n()}function q(){function c(){r=a();h=t?r:b(w.href,
"?");n=!1;p=null}var d=document.createElement("iframe"),e=k.dojoBlankHtmlUrl||f.toUrl("./resources/blank.html");k.useXDomain&&!k.dojoBlankHtmlUrl&&console.warn("dojo/hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html");d.id="dojo-hash-iframe";d.src=e+"?"+a();d.style.display="none";document.body.appendChild(d);this.iframe=m.global["dojo-hash-iframe"];var h,n,p,q,t,w=this.iframe.location;
this.isTransitioning=function(){return n};this.pollLocation=function(){if(!t)try{var k=b(w.href,"?");document.title!=q&&(q=this.iframe.document.title=document.title)}catch(N){t=!0,console.error("dojo/hash: Error adding history entry. Server unreachable.")}var f=a();if(n&&r===f)if(t||k===p)c(),l();else{setTimeout(g.hitch(this,this.pollLocation),0);return}else if(r!==f||!t&&h!==k){if(r!==f){r=f;n=!0;p=f;d.src=e+"?"+p;t=!1;setTimeout(g.hitch(this,this.pollLocation),0);return}t||(location.href="#"+w.search.substring(1),
c(),l())}setTimeout(g.hitch(this,this.pollLocation),u)};c();setTimeout(g.hitch(this,this.pollLocation),u)}m.hash=function(b,c){if(!arguments.length)return a();"#"==b.charAt(0)&&(b=b.substring(1));c?p(b):location.hash="#"+b;return b};var r,t,w,u=k.hashPollFrequency||100;h(function(){"onhashchange"in m.global&&(!c("ie")||8<=c("ie")&&"BackCompat"!=document.compatMode)?w=e.after(m.global,"onhashchange",l,!0):document.addEventListener?(r=a(),setInterval(n,u)):document.attachEvent&&(t=new q)});return m.hash})},
"webSceneViewer/support/urlUtils":function(){define("require exports dojo/io-query esri/Viewpoint esri/Camera esri/request esri/core/promiseUtils esri/geometry/Point esri/geometry/SpatialReference ./geowConfig".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a,b){b=Math.pow(10,b);return Math.round(a*b)/b}function n(){return a.available&&!!a.bitlyUrl}function p(){var a=k.queryToObject(window.location.search.replace(/^\?/,"")),a=a||{},b;for(b in a)a.hasOwnProperty(b)&&"string"===typeof a[b]&&(a[b]=
a[b].replace(/(&lt;|&gt;|<|>|%3C|%3E)/g,""));return a}Object.defineProperty(f,"__esModule",{value:!0});f.SUPPORTED_SERVICE_URL_REGEXP="^https?://[^/]+/([^/]+/)*(((SceneServer|MapServer|FeatureServer|ImageServer|VectorTileServer)((/layers)?/[0-9]+)?/?)|(SceneServerLocal(/([^/]+/?)*)?))$";f.viewpointFromUrlParameter=function(a){var d=a.split(";"),h=null;if(0<d.length){var l="";a="";for(var k=0;k<d.length;k++)-1!==d[k].indexOf("cam:")?l=d[k]:a=d[k];if(""!==l&&(l=l.substr(4,l.length-4),d=l.split(","),
3<=d.length)){var h=parseFloat(d[0]),l=parseFloat(d[1]),k=parseFloat(d[2]),f=b.WGS84;4===d.length&&(f=new b(parseInt(d[3],10)));d=new c(h,l,k,f);l=h=0;a&&(a=a.split(","),h=parseFloat(a[0]),1<a.length&&(l=parseFloat(a[1])));h=new e({camera:new g({position:d,heading:h,tilt:l})})}}return h};f.encodeCamera=function(a,b){void 0===b&&(b=!1);b=a.position.spatialReference.isWebMercator&&!b;var c=l(b?a.position.longitude:a.position.x,8),d=l(b?a.position.latitude:a.position.y,8),e=l(a.position.z,3),h=l(a.heading,
3),g=l(a.tilt,3);return"cam:"+c+","+d+","+e+(b?"":","+a.position.spatialReference.wkid)+";"+h+","+g};f.supportsShortUrl=n;f.createShortUrl=function(b){if(!n())return h.reject();var c=a.bitlyUrl;"https:"===document.location.protocol&&(c=a.bitlyUrlSSL);return d(c,{query:{f:"json",format:"json",longUrl:b}}).then(function(a){return(a=a&&a.data&&a.data.data)&&a.url})};f.urlParams=p;f.urlWithoutParams=function(a){var b=a.indexOf("?");return-1!==b?a.slice(0,b):a};f.cleanUrl=function(){var a=k.queryToObject(window.location.search.replace(/^\?/,
"")),a=a||{},b=p();if(b.hasOwnProperty("locale")){delete a.locale;var c=decodeURIComponent(k.objectToQuery(a));window.history.pushState(null,null,location.pathname+"?"+c)}b.hasOwnProperty("viewingmode")&&(b.hasOwnProperty("layers")||b.hasOwnProperty("url")||b.hasOwnProperty("webscene"))&&(delete a.viewingmode,c=decodeURIComponent(k.objectToQuery(a)),window.history.pushState(null,null,location.pathname+"?"+c))};f.parseTitleFromLayerUrl=function(a){var b=new RegExp(f.SUPPORTED_SERVICE_URL_REGEXP);b.test(a)?
a=(a=a.replace(b,"$1"))&&a.replace(/_/g," ").replace(/\/$/,""):(a=new URL(a),a=a.pathname.length<a.hostname.length?a.pathname.replace("/","_"):a.hostname.replace(".","_"));return a.charAt(0).toUpperCase()+a.slice(1)};f.emptySceneUrl=function(){var a=k.queryToObject(window.location.search.replace(/^\?/,""));delete a.webscene;delete a.url;delete a.layers;var b=window.location.origin+window.location.pathname;Object.keys(a).length&&(b+="?"+decodeURIComponent(k.objectToQuery(a)));return b}})},"esri/Viewpoint":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./Camera ./core/JSONSupport ./core/accessorSupport/decorators ./geometry/support/jsonUtils ./geometry/support/typeUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(){return{enabled:!this.camera}}return function(d){function l(a){a=d.call(this)||this;a.rotation=0;a.scale=0;a.targetGeometry=null;a.camera=null;return a}k(l,d);f=l;l.prototype.castRotation=function(a){a%=360;0>a&&(a+=360);return a};l.prototype.clone=function(){return new f({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry?this.targetGeometry.clone():null,camera:this.camera?this.camera.clone():null})};var f;e([h.property({type:Number,
json:{write:!0,origins:{"web-scene":{write:{overridePolicy:a}}}}})],l.prototype,"rotation",void 0);e([h.cast("rotation")],l.prototype,"castRotation",null);e([h.property({type:Number,json:{write:!0,origins:{"web-scene":{write:{overridePolicy:a}}}}})],l.prototype,"scale",void 0);e([h.property({types:b.types,json:{read:c.fromJSON,write:!0,origins:{"web-scene":{read:c.fromJSON,write:{overridePolicy:a}}}}})],l.prototype,"targetGeometry",void 0);e([h.property({type:g,json:{write:!0}})],l.prototype,"camera",
void 0);return l=f=e([h.subclass("esri.Viewpoint")],l)}(h.declared(d))})},"esri/Camera":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/JSONSupport ./core/accessorSupport/decorators ./geometry/Point ./views/3d/support/mathUtils".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a,c,d,e){a=b.call(this)||this;a.position=null;a.heading=0;a.tilt=0;a.fov=55;return a}k(a,b);g=a;a.prototype.getDefaults=function(a){if(!a.position)return{position:new h([0,
0,0])}};a.prototype.normalizeCtorArgs=function(a,b,c,d){a&&"object"===typeof a&&("x"in a||Array.isArray(a))&&(a={position:a},null!=b&&(a.heading=b),null!=c&&(a.tilt=c),null!=d&&(a.fov=d));return a};a.prototype.equals=function(a){return a?this.tilt===a.tilt&&this.heading===a.heading&&this.fov===a.fov&&this.position.equals(a.position):!1};a.prototype.clone=function(){return new g({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})};var g;e([d.property({type:h,json:{write:{isRequired:!0}}})],
a.prototype,"position",void 0);e([d.property({type:Number,json:{write:{isRequired:!0}}}),d.cast(function(a){return c.cyclicalDeg.normalize(a)})],a.prototype,"heading",void 0);e([d.property({type:Number,json:{write:{isRequired:!0}}}),d.cast(function(a){return c.clamp(a,-180,180)})],a.prototype,"tilt",void 0);e([d.property({json:{read:!1,write:!1}})],a.prototype,"fov",void 0);return a=g=e([d.subclass("esri.Camera")],a)}(d.declared(g))})},"webSceneViewer/support/geowConfig":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=window.esriGeowConfig||{};f.available=null!=window.esriGeowConfig;f.restBaseUrl=m.restBaseUrl;f.baseUrl=m.baseUrl;f.proxyServer=m.proxyServer;f.httpsDomains=m.httpsDomains;f.showSocialMediaLinks=m.showSocialMediaLinks;f.bitlyUrl=m.bitlyUrl;f.bitlyUrlSSL=m.bitlyUrlSSL;f.restrictOrganizationPageToAdmin=m.restrictOrganizationPageToAdmin;f.esriCommunityLink=m.esriCommunityLink;f.myEsriLink=m.myEsriLink;f.isDebug=m.isDebug;f.bridgeUrl=
m.bridgeUrl;f.webAppBuilderEnabled=m.webAppBuilderEnabled;f.usageTrackingEnabled=f.available&&m.hasOwnProperty("usageTrackingEnabled")?m.usageTrackingEnabled:!0})},"webSceneViewer/support/Device":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/core/Accessor dojo/has dojo/_base/window dojo/dom-class".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function d(){var b=null!==a&&a.apply(this,
arguments)||this;b.orientation="landscape";return b}k(d,a);Object.defineProperty(d.prototype,"isMobile",{get:function(){return h("ui-mode:phone")||h("ui-mode:tablet")?!0:/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(navigator.userAgent)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isPhoneSize",{get:function(){var a=Math.min(window.screen.availHeight?window.screen.availHeight:window.screen.height,window.screen.availWidth?window.screen.availWidth:window.screen.width);
h("ui-mode:phone")&&(a=600);return this.isMobile&&610>a},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.isMobile&&(this._updateOrientation(),window.addEventListener("orientationchange",function(){a._updateOrientation()}),this._initSafariWorkarounds(),document.addEventListener("touchend",function(a){null!=document.activeElement&&a.target!==document.activeElement&&a.target!==document.body&&b.contains(document.activeElement,"esri-blur-touch")&&document.activeElement.blur()}))};
d.prototype._initSafariWorkarounds=function(){var a=function(){var a=c.body();a.scrollTo(0,0);a.style.height=window.innerHeight+"px"};h("safari")&&(a(),window.addEventListener("resize",function(){a()}))};d.prototype._updateOrientation=function(){var a=screen;h("orientation:portrait")||h("orientation:landscape")?this._set("orientation",h("orientation:portrait")?"portrait":"landscape"):this._set("orientation",this.isMobile&&(0===window.orientation||a&&a.orientation&&0===a.orientation.angle)?"portrait":
"landscape")};e([g.property({readOnly:!0})],d.prototype,"orientation",void 0);e([g.property({readOnly:!0})],d.prototype,"isMobile",null);e([g.property({readOnly:!0,dependsOn:["isMobile"]})],d.prototype,"isPhoneSize",null);return d=e([g.subclass("webSceneViewer.Device")],d)}(g.declared(d))})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(m,f,k){var e=k("esri-mobile"),g=k("esri-iPhone");m=function(){function d(){}d.isValidProfile=
function(e){return e in d.profiles};d.getDefaultProfile=function(){return k("trident")||g?"low":"medium"};d.apply=function(e,c){e=d.profiles[e];c.graphics3D.maxTotalNumberOfFeatures=e.graphics3D.maxTotalNumberOfFeatures;c.graphics3D.maxTotalNumberOfVertices=e.graphics3D.maxTotalNumberOfVertices;c.sceneService["3dObject"].lodFactor=e.sceneService["3dObject"].lodFactor;c.sceneService.point.lodFactor=e.sceneService.point.lodFactor;c.sceneService.integratedMesh.lodFactor=e.sceneService.integratedMesh.lodFactor;
c.sceneService.pointCloud.lodFactor=e.sceneService.pointCloud.lodFactor;c.sceneService.uncompressedTextureDownsamplingEnabled=e.sceneService.uncompressedTextureDownsamplingEnabled;c.tiledSurface.lodBias=e.tiledSurface.lodBias;c.tiledSurface.angledSplitBias=e.tiledSurface.angledSplitBias;c.antialiasingEnabled=e.antialiasingEnabled;c.gpuMemoryLimit=e.gpuMemoryLimit;c.additionalCacheMemory=e.additionalCacheMemory;c.frameRate=e.frameRate};return d}();(function(d){d.profiles={low:{graphics3D:{maxTotalNumberOfFeatures:25E3,
maxTotalNumberOfVertices:25E5},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200,additionalCacheMemory:0,frameRate:0},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfVertices:5E6},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},
uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:e?400:500,additionalCacheMemory:e?0:100,frameRate:0},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfVertices:5E6},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:e?600:1E3,
additionalCacheMemory:0,frameRate:0}}})(m||(m={}));return m})},"webSceneViewer/View":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators dojo/_base/lang dojo/dom-class dojo/_base/window dojo/window dojo/query esri/core/Error esri/core/promiseUtils esri/core/watchUtils esri/geometry/SpatialReference esri/layers/FeatureLayer esri/layers/ImageryLayer esri/layers/MapImageLayer esri/layers/WMSLayer esri/views/SceneView ./Scene esri/views/support/DefaultsFromMap ./support/layerUtils ./support/errorUtils ./support/persistedSettingsUtils ./support/spatialReferenceUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){var E=z.DefaultMapCollectionPaths.slice();E.unshift("prioritySpatialReferenceLayers");return function(f){function m(a){a=f.call(this)||this;a.adjustMonthForLightingAtLatitudeEnabled=!0;a.handleInitialErrors=function(){return n.resolve()};a.defaultsFromMap=new z({view:a,mapCollectionPaths:E,defaultSpatialReference:q.WebMercator});return a}k(m,f);x=m;Object.defineProperty(m.prototype,"initialExtentRequired",{get:function(){return!1},enumerable:!0,
configurable:!0});Object.defineProperty(m.prototype,"initialExtent",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"qualityMode",{get:function(){return"low"===this.qualityProfile?"low":this.get("environment.atmosphereEnabled")&&"low"!==this.get("environment.atmosphere.quality")&&this.get("environment.lighting.ambientOcclusionEnabled")?"high":"medium"},set:function(a){var b=this;if("low"===a||"medium"===a||"high"===a)this.qualityProfile=a,B.set("qualityMode",
a),p.whenOnce(this,"ready",function(){switch(a){case "low":case "medium":b.environment.atmosphere.quality="low";b.environment.lighting.ambientOcclusionEnabled=!1;break;case "high":b.environment.atmosphere.quality="high",b.environment.lighting.ambientOcclusionEnabled=!0}b.notifyChange("qualityMode")})},enumerable:!0,configurable:!0});m.prototype.getDefaults=function(){var a=d.mixin(this.inherited(arguments),{ui:{components:[]},container:"webscene-map"});a.popup=a.popup||{};a.popup.dockOptions={buttonEnabled:!1,
breakpoint:!1};a.popup.autoCloseEnabled=!0;a.popup.dockEnabled=!1;var b=B.get("qualityMode");null!=b&&(a.qualityMode=b,a.qualityProfile="low"===b||"medium"===b||"high"===b?b:"medium");return a};m.prototype.initialize=function(){var a=this;p.when(this,"ready",function(){a.map.ground.navigationConstraint||(a.map.ground.navigationConstraint={type:"global"===a.viewingMode?"stay-above":"none"})})};m.prototype.isSpatialReferenceSupported=function(a,b){return b&&(b.isInstanceOf(r)||b.isInstanceOf(t)||b.isInstanceOf(w)||
b.isInstanceOf(u))?!1:this.inherited(arguments)};m.prototype.adjustMonthForLightingAtLatitude=function(a){var b=this;if(!this.adjustMonthForLightingAtLatitudeEnabled)return n.resolve();a=C.projectGeometries([a],q.WGS84);return n.eachAlways([p.whenOnce(this,"ready"),a]).then(function(a){if(a=a[1].value[0]){var c=b.environment.lighting,d=c.date.getMonth();a=a.latitude;if(66<a&&(4>d||6<d))d=5;else if(-66>a&&10>d&&0<d)d=11;else return;return p.whenNotOnce(b,"environmentManager.updating").then(function(){var a=
new Date(c.date.getTime());a.getMonth()!==d&&(a.setMonth(d),b.environment.lighting.date=a)})}})};m.createFromAppState=function(a,b){var c=v.createFromAppState(a);a.config&&null!=a.config.initialLoadTimeout&&(c=n.timeout(c,a.config.initialLoadTimeout,new l("wsv:initialize-timeout","Initialize timeout")));return c.then(function(c){var e=c.scene,h=c.isDefault,g=c.layers,l=c.warningsToConsole;b=d.mixin({},b,{map:e});!1===a.urlParameters.antialias&&(b.antialias=!1);var k=new x(b);c=x.adjustInitialViewWhenReady(k,
{appState:a,scene:e,isDefault:h,layers:g}).always(function(){h&&(e.initialViewProperties.viewpoint=k.viewpoint.clone());k._handlePopupDocking(a);e.get("initialViewProperties.environment.lighting.date")||k.adjustMonthForLightingAtLatitude(k.center.clone());return k});a.urlParameters.watch("slideNumber",function(a){var b=k.map.presentation.slides.getItemAt(a);b&&k.when(function(){b.applyTo(k)})});k.handleInitialErrors=function(){a.warningsToConsole=!!l;return x.handleLayerErrors(k,{appState:a,scene:e,
isDefault:h,layers:g}).then(function(){a.warningsToConsole=!1})};return c})};m.prototype._handlePopupDocking=function(a){var b=this,d=h.contains(c.doc.body.parentNode,"esriRtl");a.device&&a.device.isPhoneSize?(p.init(a.device,"orientation",function(){var c="landscape"===a.device.orientation;b.popup.dockOptions={position:function(){return c?d?"top-left":"top-right":"bottom-center"},buttonEnabled:!1};b.popup.dockEnabled=!0;b.padding=null;p.once(a,"view.resizing",function(){b.popup.visible&&(b.padding=
b._getViewPadding(!0,a,d))})}),p.init(this.popup,"visible",function(c){b.padding=b._getViewPadding(c,a,d)})):this.popup&&(this.popup.dockEnabled=!1)};m.prototype._getViewPadding=function(c,d,e){d="landscape"===d.device.orientation;return c&&this._needViewPadding(this.popup.location,e,d)?(a(".esri-ui").addClass(d?"landscape":"portrait"),d?e?{left:b.getBox().w/2}:{right:b.getBox().w/2}:{bottom:b.getBox().h/3}):null};m.prototype._needViewPadding=function(a,c,d){if(null==a)return!1;a=this.toScreen(a);
return d?c?a.x-10<b.getBox().w/2:a.x+10>b.getBox().w/2:a.y+10>2*b.getBox().h/3};m.handleLayerErrors=function(a,b){return a.when(function(){if(a.map===b.scene)return n.eachAlways([x.handleBasemapLayerErrors(a,b),x.handleGroundLayerErrors(a,b),x.handleOperationalLayerErrors(a,b)]).then(function(){})})};m.handleBasemapLayerErrors=function(a,b){var c=b.appState,d=b.scene,e=b.isDefault;return d.basemap?d.basemap.load().then(function(){return y.collectErrors(a,d.basemap.baseLayers.concat(d.basemap.referenceLayers),
e)}).then(function(b){b.length&&(b=new l("wsv-view:basemap-failure","Basemap failed to load",{errors:b.map(function(a){return new l("wsv-view:basemap-layer-failure","Basemap layer failed to load",a)})}),c.errors.error(A.basemapError(b,e?"warning":"error",a)))}).catch(function(){}):n.resolve()};m.handleGroundLayerErrors=function(a,b){var c=b.appState,d=b.scene,e=b.isDefault;b=d.ground.layers.filter(function(a){return d.isDefaultGroundLayer(a)});return y.collectErrors(a,b,e).then(function(b){b.length&&
!e&&(b=new l("wsv-view:ground-failure","Ground failed to load",{errors:b.map(function(a){return new l("wsv-view:ground-layer-failure","Ground layer failed to load",a)})}),c.errors.error(A.groundError(b,"error",a)))})};m.handleOperationalLayerErrors=function(a,b){var c=b.appState,d=b.scene,e=b.isDefault,h=b.layers;b=d.ground.layers.filter(function(a){return!d.isDefaultGroundLayer(a)});return n.eachAlways([y.collectErrors(a,d.layers.concat(b),e,function(b){b=h&&-1!==h.indexOf(b.layer)?A.layerAddError(b.layer,
b.error,a,!1):A.layerLoadError(b.layer,b.error,a,!1);c.errors.error(b)}),y.collectWarnings(a,d.layers.concat(b),function(a){var b;a.map(function(a){b=A.layerWarning(a.layer,a.error,!1);c.errors.error(b)})})]).then(function(){})};m.adjustInitialViewWhenReady=function(a,b){return a.when(function(){if(a.map===b.scene){var c=b.appState.urlParameters.getViewpointObject();if(c)return a.goTo(c,{animate:!1});c=b.appState.urlParameters.slideNumber;if(null!=c&&0<=c&&c<b.scene.presentation.slides.length)return b.scene.presentation.slides.getItemAt(c).applyTo(a,
{animate:!1});if(b.isDefault&&(c={target:{},options:{animate:!1}},"local"===a.viewingMode&&(c.target.tilt=50,a.goTo(c.target,c.options)),b.layers&&b.layers.length))return y.goToInitial(b.appState,a,b.layers,c).catch(function(){})}})};var x;e([g.property()],m.prototype,"initialExtentRequired",null);e([g.property()],m.prototype,"initialExtent",null);e([g.property()],m.prototype,"adjustMonthForLightingAtLatitudeEnabled",void 0);e([g.property({dependsOn:["qualityProfile","environment.atmosphereEnabled",
"environment.atmosphere.quality","environment.lighting.ambientOcclusionEnabled"]})],m.prototype,"qualityMode",null);return m=x=e([g.subclass("webSceneViewer.View")],m)}(g.declared(x))})},"esri/layers/FeatureLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../Graphic ../PopupTemplate ../renderers ../request ../symbols ../core/Collection ../core/Error ../core/Handles ../core/has ../core/kebabDictionary ../core/lang ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/normalizeUtils ./Layer ./graphics/sources/MemorySource ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/arcgisLayerUrl ./support/commonProperties ./support/FeatureIndex ./support/FeatureProcessing ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FeatureTemplate ./support/FeatureType ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/layerSourceUtils ./support/Relationship ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../symbols/support/jsonUtils ../tasks/support/AttachmentQuery ../tasks/support/FeatureSet ../tasks/support/Query ../tasks/support/RelationshipQuery".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O,J,Q,H,K,R,P,L,T,S,W,Y,X,aa,U,ha,Z,ba,ka,ga,ia,na,wa,za){function Aa(a){return a&&null!=a.applyEdits}function sa(a){return a&&a.isInstanceOf&&a.isInstanceOf(n)}function ma(a,b,c){return!(a&&a.hasOwnProperty(b)?!a[b]:!c)}var Ea=t({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Ha=u.getLogger("esri.layers.FeatureLayer");
return function(f){function t(a){a=f.call(this)||this;a._handles=new q;a.featureReduction=null;a.capabilities=null;a.copyright=null;a.displayField=null;a.definitionExpression=null;a.dynamicDataSource=null;a.editFieldsInfo=null;a.elevationInfo=null;a.fields=null;a.fullExtent=null;a.gdbVersion=null;a.geometryType=null;a.hasM=void 0;a.hasZ=void 0;a.heightModelInfo=null;a.historicMoment=null;a.isTable=!1;a.labelsVisible=!0;a.labelingInfo=null;a.layerId=void 0;a.legendEnabled=!0;a.maxRecordCount=void 0;
a.tileMaxRecordCount=void 0;a.minScale=0;a.maxScale=0;a.objectIdField=null;a.operationalLayerType="ArcGISFeatureLayer";a.popupEnabled=!0;a.popupTemplate=null;a.relationships=null;a.returnM=void 0;a.returnZ=void 0;a.screenSizePerspectiveEnabled=!0;a.serviceDefinitionExpression=null;a.spatialReference=C.WGS84;a.templates=null;a.timeInfo=null;a.title=null;a.sublayerTitleMode="item-title";a.trackIdField=null;a.type="feature";a.typeIdField=null;a.types=null;a.indexes=new (n.ofType(H.FeatureIndex));a.userIsAdmin=
!1;a.version=void 0;a.visible=!0;return a}e(t,f);t.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};t.prototype.load=function(){var a=this;if(this.portalItem&&this.portalItem.loaded&&this.source)this.addResolvingPromise(this.createGraphicsSource().then(function(b){return a._initLayerProperties(b)}));else{var b=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]}).always(function(){if(a.url&&null==a.layerId&&/FeatureServer|MapServer\/*$/i.test(a.url))return a._fetchFirstLayerId().then(function(b){null!=
b&&(a.layerId=b)})}).then(function(){if(!a.url&&!a._hasMemorySource())throw new p("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return a.createGraphicsSource().then(function(b){return a._initLayerProperties(b)})});this.addResolvingPromise(b);return this.when()}};Object.defineProperty(t.prototype,"allRenderers",{get:function(){return this._getAllRenderers(this.renderer)},enumerable:!0,configurable:!0});t.prototype.readCapabilities=function(a,b){b=
b.layerDefinition||b;return{data:this._readDataCapabilities(b),operations:this._readOperationsCapabilities(b.capabilities||a,b),query:this._readQueryCapabilities(b),queryRelated:this._readQueryRelatedCapabilities(b),editing:this._readEditingCapabilities(b)}};Object.defineProperty(t.prototype,"hasAttachments",{get:function(){Ha.warn("FeatureLayer.hasAttachments is deprecated. Use FeatureLayer.capabilities.data.supportsAttachment instead.");return this.hasService&&this._get("hasAttachments")||!1},enumerable:!0,
configurable:!0});t.prototype.readIsTable=function(a,b){b=b&&b.layerDefinition||b;return"Table"===b.type};Object.defineProperty(t.prototype,"hasService",{get:function(){return!this._hasMemorySource()},enumerable:!0,configurable:!0});t.prototype.readMinScale=function(a,b){return b.effectiveMinScale||a||0};t.prototype.readMaxScale=function(a,b){return b.effectiveMaxScale||a||0};t.prototype.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(a=
0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeOID"===c.type)return c.name}};Object.defineProperty(t.prototype,"outFields",{get:function(){var a=this,b=this._userOutFields,c=this.requiredFields,b=b&&b.slice(0),c=c&&c.slice(0);b?-1===b.indexOf("*")&&c.forEach(function(a){-1===b.indexOf(a)&&b.push(a)}):b=c;-1!==b.indexOf("*")?b=["*"]:this.loaded&&(b=b.filter(function(b){var c=!!a.getField(b);b&&!c&&Ha.error("[outFields] Invalid field: ",b);return c},this),b=b.map(function(b){return a.getField(b).name},
this),b=b.filter(function(a,b,c){return c.indexOf(a)===b}));return b},set:function(a){var b=this,c=this.requiredFields&&this.requiredFields.slice(0);a?-1===a.indexOf("*")&&c.forEach(function(b){-1===a.indexOf(b)&&a.push(b)}):a=c;this.loaded&&(a=a.filter(function(a){var c="*"===a||!!b.getField(a,b.fields);a&&!c&&Ha.error("[outFields] Invalid field: ",a);return c},this),a=a.map(function(a){return"*"===a?a:b.getField(a,b.fields).name},this));this._userOutFields=a},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,
"parsedUrl",{get:function(){var a=this.url?z.urlToObject(this.url):null;if(null!=a)if(null!=this.layerId)a.path=z.join(a.path,this.layerId.toString());else if(null!=this.dynamicDataSource){var b={source:aa.sourceToJSON(this.dynamicDataSource)};a.query={layer:JSON.stringify(b)}}return a},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"renderer",{set:function(a){var b=this._getAllRenderers(a);W.fixRendererFields(b,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});
t.prototype.readRenderer=function(a,c,d){c=c.layerDefinition||c;var e=c.drawingInfo&&c.drawingInfo.renderer||void 0,h,g;if(e)(h=ha.read(e,c,d)||void 0)||Ha.error("Failed to create renderer",{rendererDefinition:c.drawingInfo.renderer,layer:this,context:d});else if(c.defaultSymbol)ga.read(c.defaultSymbol,c,d),c.types&&c.types.length?(h=new b.UniqueValueRenderer({defaultSymbol:g,field:c.typeIdField}),c.types.forEach(function(a){e.addUniqueValueInfo(a.id,ga.read(a.symbol,a,d))})):h=new b.SimpleRenderer({symbol:g});
else if("Table"!==c.type){switch(c.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":g=new l.SimpleMarkerSymbol;break;case "esriGeometryPolyline":g=new l.SimpleLineSymbol;break;case "esriGeometryPolygon":g=new l.SimpleFillSymbol}h=g&&new b.SimpleRenderer({symbol:g})}return h};t.prototype.writeRenderer=function(a,b,c,d){ha.writeTarget(a,b,c,d)};Object.defineProperty(t.prototype,"requiredFields",{get:function(){var a=this.timeInfo,b=[],c=[],a=[this.objectIdField,this.typeIdField,
this.editFieldsInfo&&this.editFieldsInfo.creatorField,this.editFieldsInfo&&this.editFieldsInfo.creationDateField,this.editFieldsInfo&&this.editFieldsInfo.editorField,this.editFieldsInfo&&this.editFieldsInfo.editDateField,a&&a.startTimeField,a&&a.endTimeField,this.trackIdField];this.allRenderers.forEach(function(a){b=b.concat(a.requiredFields)});this.labelingInfo&&this.labelingInfo.length&&this.labelingInfo.forEach(function(a){c=c.concat(a.requiredFields)});var c=c.map(function(a){return a.replace(/['"]+/g,
"")}),a=a.concat(b),a=a.concat(c),d=this.elevationInfo&&this.elevationInfo.featureExpressionInfo;d&&(a=a.concat(d.requiredFields));this.popupTemplate&&(a=a.concat(this.popupTemplate.requiredFields));return a.filter(function(a,b,c){return!!a&&c.indexOf(a)===b&&"function"!==typeof a})},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"source",{set:function(a){var b=this._get("source");b!==a&&(b&&sa(b)&&this._resetMemorySource(b),a&&sa(a)&&this._initMemorySource(a),this._set("source",
a))},enumerable:!0,configurable:!0});t.prototype.castSource=function(a){return a?Array.isArray(a)||sa(a)?new F.default({layer:this,items:a}):a:null};t.prototype.readSource=function(a,b){a=na.fromJSON(b.featureSet);return new F.default({layer:this,items:a&&a.features||[]})};t.prototype.readTemplates=function(a,b){var c=b.editFieldsInfo;b=c&&c.creatorField;c=c&&c.editorField;a=a&&a.map(function(a){return L.fromJSON(a)});this._fixTemplates(a,b);this._fixTemplates(a,c);return a};t.prototype.readTitle=
function(a,b){a=b.layerDefinition&&b.layerDefinition.name||b.name;b=b.title||b.layerDefinition&&b.layerDefinition.title;if(a){b=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?J.titleFromUrlAndName(this.url,a):a;if(a=a||this.url&&J.parse(this.url).title)return"item-title-and-service-name"===this.sublayerTitleMode&&b&&(a=b+" - "+a),J.cleanTitle(a)}else if("item-title"===this.sublayerTitleMode&&b)return b};t.prototype.readTitleFromWebMap=function(a,b){return b.title||
b.layerDefinition&&b.layerDefinition.name};t.prototype.readTypeIdField=function(a,b){b=b.layerDefinition||b;if(a=b.typeIdField)if(b=this.getField(a,b.fields))a=b.name;return a};t.prototype.readTypes=function(a,b){var c=this;b=b.layerDefinition||b;a=b.types;var d=(b=b.editFieldsInfo)&&b.creatorField,e=b&&b.editorField;return a&&a.map(function(a){a=T.fromJSON(a);c._fixTemplates(a.templates,d);c._fixTemplates(a.templates,e);return a})};Object.defineProperty(t.prototype,"url",{set:function(a){a=J.sanitizeUrlWithLayerId(this,
a,Ha);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});t.prototype.writeUrl=function(a,b,c,d){J.writeUrlWithLayerId(this,a,b)};t.prototype.readVersion=function(a,b){b=b.layerDefinition||b;return b.currentVersion?b.currentVersion:b.hasOwnProperty("capabilities")||b.hasOwnProperty("drawingInfo")||b.hasOwnProperty("hasAttachments")||b.hasOwnProperty("htmlPopupType")||b.hasOwnProperty("relationships")||b.hasOwnProperty("timeInfo")||b.hasOwnProperty("typeIdField")||
b.hasOwnProperty("types")?10:9.3};t.prototype.readVisible=function(a,b){if(b.layerDefinition&&null!=b.layerDefinition.defaultVisibility)return!!b.layerDefinition.defaultVisibility;if(null!=b.visibility)return!!b.visibility};t.prototype.addAttachment=function(a,b){var c=this;return this.load().then(function(){return c._checkAttachmentSupport(a)}).then(function(){return"addAttachment"in c.source?c.source.addAttachment(a,b):v.reject(new p("FeatureLayer","Layer source does not support addAttachment capability"))})};
t.prototype.updateAttachment=function(a,b,c){var d=this;return this.load().then(function(){return d._checkAttachmentSupport(a)}).then(function(){return"updateAttachment"in d.source?d.source.updateAttachment(a,b,c):v.reject(new p("FeatureLayer","Layer source does not support updateAttachment capability"))})};t.prototype.applyEdits=function(a){var b=this,c,d,e={edits:a,result:v.create(function(a,b){c=a;d=b})};this.emit("apply-edits",e);return this.load().then(function(){return Aa(b.source)?b._processApplyEditsParams(a):
v.reject(new p("FeatureLayer","Layer source does not support applyEdits capability"))}).then(function(a){if(Aa(b.source))return b.source.applyEdits(a).then(function(a){var d=function(a){return a.filter(function(a){return!a.error}).map(w.clone)},d={addedFeatures:d(a.addFeatureResults),updatedFeatures:d(a.updateFeatureResults),deletedFeatures:d(a.deleteFeatureResults)};(d.addedFeatures.length||d.updatedFeatures.length||d.deletedFeatures.length)&&b.emit("edits",d);c(d);return a})}).catch(function(a){d(a);
throw a;})};t.prototype.on=function(a,b){return this.inherited(arguments)};t.prototype.createGraphicsSource=function(){var a=this;return this._hasMemorySource()?(this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.load()):v.create(function(a){return m(["./graphics/sources/FeatureLayerSource"],a)}).then(function(b){return(new b.default({layer:a})).load()}).then(function(b){a.emit("graphics-source-create",{graphicsSource:b});return b})};t.prototype.createGraphicsController=
function(a){var b=this,c=a.layerView,d=n.ofType(h),e=this.source,g=e&&sa(e),l=k({},a.options,{layer:this,layerView:c,graphics:g?e:new d});return(g?v.create(function(a){return m(["./graphics/controllers/MemoryController"],a)}):"2d"===c.view.type?v.create(function(a){return m(["./graphics/controllers/AutoController2D"],a)}):v.create(function(a){return m(["./graphics/controllers/SnapshotController"],a)})).then(function(a){return new a(l)}).then(function(a){b.emit("graphics-controller-create",{graphicsController:a});
return a.when()})};t.prototype.createQuery=function(){var a=new wa,b=this.get("capabilities.data");a.gdbVersion=this.gdbVersion;a.historicMoment=this.historicMoment;a.returnGeometry=!0;b&&(b.supportsZ&&null!=this.returnZ&&(a.returnZ=this.returnZ),b.supportsM&&null!=this.returnM&&(a.returnM=this.returnM));a.outFields=this.outFields;a.where=this.definitionExpression||"1\x3d1";a.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null;return a};t.prototype.deleteAttachments=function(a,b){var c=
this;return this.load().then(function(){return c._checkAttachmentSupport(a)}).then(function(){return"deleteAttachments"in c.source?c.source.deleteAttachments(a,b):v.reject(new p("FeatureLayer","Layer source does not support deleteAttachments capability"))})};t.prototype.getFeatureType=function(a){var b=this.typeIdField;if(!b||!a)return null;var c=a.attributes?a.attributes[b]:void 0;if(null==c)return null;var d=null;this.types.some(function(a){var b=a.id;if(null==b)return!1;b.toString()===c.toString()&&
(d=a);return!!d});return d};t.prototype.getFieldDomain=function(a,b){var c=this,d,e=!1;b=(b=b&&b.feature)&&b.attributes;var h=this.typeIdField&&b&&b[this.typeIdField];null!=h&&this.types&&(e=this.types.some(function(b){return b.id==h?((d=b.domains&&b.domains[a])&&"inherited"===d.type&&(d=c._getLayerDomain(a)),!0):!1}));e||d||(d=this._getLayerDomain(a));return d};t.prototype.getField=function(a,b){var c=this.processing?this.fields.concat(this.processing.fields):this.fields;return W.getField(a,b||c)};
t.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};t.prototype.queryAttachments=function(a){var b=this;return this.load().then(function(){if(!b.get("capabilities.data.supportsAttachment"))return v.reject(new p("FeatureLayer","this layer doesn't support attachments"));var c=a.attachmentTypes,d=a.objectIds,e=a.globalIds,h=a.num,g=a.size,l=a.start,k=a.definitionExpression;return!b.get("capabilities.query.supportsAttachments")&&(c=c&&c.length,e=e&&e.length,g=g&&g.length,d&&1<d.length||
c||e||g||h||l||k)?v.reject(new p("FeatureLayer","when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",a)):d&&d.length||k?"queryAttachments"in b.source?b.source.queryAttachments(a):v.reject(new p("FeatureLayer","Layer source does not support queryAttachments capability",a)):v.reject(new p("FeatureLayer","objectIds or definitionExpression are required to perform attachment query",a))})};t.prototype.queryFeatures=function(a,b){var c=this;return this.load().then(function(){return c.source.queryFeatures(a||
c.createQuery(),b)}).then(function(a){if(a&&a.features)for(var b=0,d=a.features;b<d.length;b++){var e=d[b];e.layer=e.sourceLayer=c}return a})};t.prototype.queryFeaturesJSON=function(a,b){var c=this;return this.load().then(function(){if(!c.source.queryFeaturesJSON)return v.reject(new p("FeatureLayer","Layer source does not support queryFeaturesJSON capability"))}).then(function(){return c.source.queryFeaturesJSON(a||c.createQuery(),b)})};t.prototype.queryObjectIds=function(a,b){var c=this;return this.load().then(function(){return c.source.queryObjectIds?
c.source.queryObjectIds(a||c.createQuery(),b):v.reject(new p("FeatureLayer","Layer source does not support queryObjectIds capability"))})};t.prototype.queryFeatureCount=function(a,b){var c=this;return this.load().then(function(){return c.source.queryFeatureCount?c.source.queryFeatureCount(a||c.createQuery(),b):v.reject(new p("FeatureLayer","Layer source does not support queryFeatureCount capability"))})};t.prototype.queryExtent=function(a,b){var c=this;return this.load().then(function(){return c.source.queryExtent?
c.source.queryExtent(a||c.createQuery(),b):v.reject(new p("FeatureLayer","Layer source does not support queryExtent capability"))})};t.prototype.queryRelatedFeatures=function(a){var b=this;return this.load().then(function(){return"queryRelatedFeatures"in b.source?b.source.queryRelatedFeatures(a):v.reject(new p("FeatureLayer","Layer source does not support queryRelatedFeatures capability"))})};t.prototype.read=function(a,b){var c=a.featureCollection;if(c){var d=c.layers;d&&1===d.length&&(this.inherited(arguments,
[d[0],b]),null!=c.showLegend&&this.inherited(arguments,[{showLegend:c.showLegend},b]))}this.inherited(arguments,[a,b]);return this};t.prototype.write=function(a,b){if(b&&"web-scene"===b.origin&&b.messages){if(!this.url)return b.messages.push(new p("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' require a url to a service to be written to web scenes",{layer:this})),null;if(this.isTable)return b.messages.push(new p("layer:unsupported","Layers ("+this.title+
", "+this.id+") of type '"+this.declaredClass+"' using a Table source cannot written to web scenes",{layer:this})),null}return this.inherited(arguments)};t.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return r("esri-featurelayer-webgl")&&r("esri-webgl")?v.create(function(a){return m(["../views/2d/layers/FeatureLayerView2D"],a)}):v.create(function(a){return m(["../views/2d/layers/FeatureLayerView2DLegacy"],a)});case "3d":return v.create(function(a){return m(["../views/3d/layers/FeatureLayerView3D"],
a)})}};t.prototype._checkAttachmentSupport=function(a){var b=a.attributes,c=this.objectIdField;if(!this.get("capabilities.data.supportsAttachment"))return v.reject(new p("FeatureLayer","this layer doesn't support attachments"));if(!a)return v.reject(new p("FeatureLayer","A feature is required to add/delete/update attachments"));if(!b)return v.reject(new p("FeatureLayer","'attributes' are required on a feature to query attachments"));if(!b[c])return v.reject(new p("FeatureLayer","feature is missing the identifying attribute "+
c))};t.prototype._getLayerDomain=function(a){if(!this.fields)return null;var b=null;this.fields.some(function(c){c.name===a&&(b=c.domain);return!!b});return b};t.prototype._fetchFirstLayerId=function(){return a(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if((a=a.data)&&Array.isArray(a.layers)&&0<a.layers.length)return a.layers[0].id})};t.prototype._initLayerProperties=function(a){this._set("source",a);a.layerDefinition&&this.read(a.layerDefinition,{origin:"service",url:this.parsedUrl});
this._verifySource();this._verifyFields();W.fixRendererFields(this._getAllRenderers(this.renderer),this.fields);return Z.loadStyleRenderer(this,{origin:"service"})};t.prototype._getAllRenderers=function(a){if(!a)return[];var b=[];[a,a.trackRenderer,a.observationRenderer,a.latestObservationRenderer].forEach(function(a){a&&(b.push(a),a.rendererInfos&&a.rendererInfos.forEach(function(a){a.renderer&&b.push(a.renderer)}))});return b};t.prototype._verifyFields=function(){var a=this.parsedUrl&&this.parsedUrl.path||
"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+a+")");this.isTable||this._hasMemorySource()||-1!==a.search(/\/FeatureServer\//i)||this.fields&&this.fields.some(function(a){return"geometry"===a.type})||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+a+")")};t.prototype._fixTemplates=function(a,b){a&&a.forEach(function(a){(a=
a.prototype&&a.prototype.attributes)&&b&&delete a[b]})};t.prototype._verifySource=function(){if(this._hasMemorySource()){if(this.url)throw new p("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url");}else{if(this.isTable)throw new p("feature-layer:source-type-not-supported","The table feature service type is not yet supported",{sourceType:"Table"});if(!this.url)throw new p("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source");
}};t.prototype._initMemorySource=function(a){var b=this;a.forEach(function(a){a.layer=b;a.sourceLayer=b});this._handles.add([a.on("after-add",function(a){a.item.layer=b;a.item.sourceLayer=b}),a.on("after-remove",function(a){a.item.layer=null;a.item.sourceLayer=null})],"fl-source")};t.prototype._resetMemorySource=function(a){a.forEach(function(a){a.layer=null;a.sourceLayer=null});this._handles.remove("fl-source")};t.prototype._hasMemorySource=function(){return!(this.url||!this.source)};t.prototype._readDataCapabilities=
function(a){return{supportsAttachment:ma(a,"hasAttachments",!1),supportsM:ma(a,"hasM",!1),supportsZ:ma(a,"hasZ",!1)}};t.prototype._readOperationsCapabilities=function(a,b){a=a?a.toLowerCase().split(",").map(function(a){return a.trim()}):[];var c=-1!==a.indexOf("editing"),d=c&&-1!==a.indexOf("create"),e=c&&-1!==a.indexOf("delete"),h=c&&-1!==a.indexOf("update");!c||d||e||h||(d=e=h=!0);return{supportsCalculate:ma(b,"supportsCalculate",!1),supportsTruncate:ma(b,"supportsTruncate",!1),supportsValidateSql:ma(b,
"supportsValidateSql",!1),supportsAdd:d,supportsDelete:e,supportsEditing:c,supportsQuery:-1!==a.indexOf("query"),supportsResizeAttachments:ma(b,"supportsAttachmentsResizing",!1),supportsUpdate:h}};t.prototype._readQueryCapabilities=function(a){var b=a.advancedQueryCapabilities,c=a.ownershipBasedAccessControlForFeatures,d=a.archivingInfo,e=(a.supportedQueryFormats||"").split(",").reduce(function(a,b){(b=b.toLowerCase().trim())&&a.add(b);return a},new Set);return{supportsAttachments:ma(b,"supportsQueryAttachments",
!1),supportsStatistics:ma(b,"supportsStatistics",a.supportsStatistics),supportsCentroid:ma(b,"supportsReturningGeometryCentroid",!1),supportsDistance:ma(b,"supportsQueryWithDistance",!1),supportsDistinct:ma(b,"supportsDistinct",a.supportsAdvancedQueries),supportsExtent:ma(b,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ma(b,"supportsReturningGeometryProperties",!1),supportsHavingClause:ma(b,"supportsHavingClause",!1),supportsOrderBy:ma(b,"supportsOrderBy",a.supportsAdvancedQueries),
supportsPagination:ma(b,"supportsPagination",!1),supportsQuantization:ma(a,"supportsCoordinatesQuantization",!1),supportsResultType:ma(b,"supportsQueryWithResultType",!1),supportsSqlExpression:ma(b,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ma(a,"useStandardizedQueries",!1),supportsQueryByOthers:ma(c,"allowOthersToQuery",!0),supportsHistoricMoment:ma(d,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:e.has("pbf")}};t.prototype._readQueryRelatedCapabilities=function(a){a=a.advancedQueryCapabilities;
var b=ma(a,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ma(a,"supportsQueryRelatedPagination",!1),supportsCount:b,supportsOrderBy:b}};t.prototype._readEditingCapabilities=function(a){var b=a.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ma(a,"allowGeometryUpdates",!0),supportsGlobalId:ma(a,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:ma(a,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ma(a,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ma(a,
"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ma(b,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ma(b,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ma(b,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ma(b,"allowOthersToUpdate",!0)}};t.prototype._processApplyEditsParams=function(a){if(!a)return v.reject(new p("feature-layer:missing-parameters","'addFeatures', 'updateFeatures' or 'deleteFeatures' parameter is required"));a=k({},a);a.addFeatures=a.addFeatures||[];a.updateFeatures=
a.updateFeatures||[];a.deleteFeatures=a.deleteFeatures||[];if(a.addFeatures.length||a.updateFeatures.length||a.deleteFeatures.length){var b=function(a){var b=new h;b.geometry=a.geometry;b.attributes=a.attributes;return b};a.addFeatures=a.addFeatures.map(b);a.updateFeatures=a.updateFeatures.map(b);return this._normalizeGeometries(a)}return v.reject(new p("feature-layer:missing-parameters","'addFeatures', 'updateFeatures' or 'deleteFeatures' parameter is required"))};t.prototype._normalizeGeometries=
function(a){var b=a.addFeatures,c=a.updateFeatures,d=b.concat(c).map(function(a){return a.geometry});return E.normalizeCentralMeridian(d).then(function(d){var e=b.length,h=c.length;d.slice(0,e).forEach(function(b,c){a.addFeatures[c].geometry=b});d.slice(e,e+h).forEach(function(b,c){a.updateFeatures[c].geometry=b});return a})};g([y.property({types:{key:"type",base:R.default,typeMap:{selection:P.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],
t.prototype,"featureReduction",void 0);g([y.property({readOnly:!0,dependsOn:["loaded","renderer","fields"]})],t.prototype,"allRenderers",null);g([y.property({readOnly:!0})],t.prototype,"capabilities",void 0);g([y.reader("service","capabilities","advancedQueryCapabilities archivingInfo supportsStatistics supportsAdvancedQueries hasAttachments hasM hasZ supportsAttachmentsResizing supportsCalculate supportsTruncate supportsValidateSql supportsCoordinatesQuantization useStandardizedQueries ownershipBasedAccessControlForFeatures allowGeometryUpdates supportsApplyEditsWithGlobalIds supportsRollbackOnFailureParameter allowUpdateWithoutMValues supportsAttachmentsByUploadId capabilities supportedQueryFormats".split(" "))],
t.prototype,"readCapabilities",null);g([y.property({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0);g([y.property({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0);g([y.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],
t.prototype,"definitionExpression",void 0);g([y.property({readOnly:!0,json:{read:ga.read}})],t.prototype,"defaultSymbol",void 0);g([y.property()],t.prototype,"dynamicDataSource",void 0);g([y.property({readOnly:!0})],t.prototype,"editFieldsInfo",void 0);g([y.property({type:ka,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",void 0);
g([y.property({type:[S],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.fields"}}})],t.prototype,"fields",void 0);g([y.property({type:A,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],t.prototype,"fullExtent",void 0);g([y.property()],t.prototype,"gdbVersion",void 0);g([y.property({json:{origins:{service:{read:Ea.read}},read:{source:"layerDefinition.geometryType",reader:Ea.read}}})],t.prototype,"geometryType",void 0);g([y.property({readOnly:!0,
dependsOn:["loaded"],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasAttachments"}}})],t.prototype,"hasAttachments",null);g([y.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],t.prototype,"hasM",void 0);g([y.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],t.prototype,"hasZ",void 0);g([y.property({readOnly:!0,type:B})],t.prototype,"heightModelInfo",void 0);g([y.property({type:Date})],
t.prototype,"historicMoment",void 0);g([y.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],t.prototype,"id",void 0);g([y.property({readOnly:!0})],t.prototype,"isTable",void 0);g([y.reader("service","isTable",["type"]),y.reader("isTable",["layerDefinition.type"])],t.prototype,"readIsTable",null);g([y.property({dependsOn:["loaded","url","source"],readOnly:!0})],t.prototype,"hasService",null);g([y.property(Q.labelsVisible)],t.prototype,"labelsVisible",void 0);g([y.property({type:[Y],
json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:X.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:X.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0);g([y.property({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],t.prototype,"layerId",void 0);g([y.property({type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"}}})],
t.prototype,"legendEnabled",void 0);g([y.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.maxRecordCount"}}})],t.prototype,"maxRecordCount",void 0);g([y.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.tileMaxRecordCount"}}})],t.prototype,"tileMaxRecordCount",void 0);g([y.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],
t.prototype,"minScale",void 0);g([y.reader("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null);g([y.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],t.prototype,"maxScale",void 0);g([y.reader("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null);g([y.property({type:String})],t.prototype,"objectIdField",void 0);g([y.reader("objectIdField",
["layerDefinition.objectIdField","layerDefinition.fields"]),y.reader("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null);g([y.property()],t.prototype,"operationalLayerType",void 0);g([y.property({dependsOn:["requiredFields"]})],t.prototype,"outFields",null);g([y.property({readOnly:!0,dependsOn:["layerId"]})],t.prototype,"parsedUrl",null);g([y.property(Q.popupEnabled)],t.prototype,"popupEnabled",void 0);g([y.property({type:c,json:{read:{source:"popupInfo"},
write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0);g([y.property({type:K})],t.prototype,"processing",void 0);g([y.property({type:[U],readOnly:!0})],t.prototype,"relationships",void 0);g([y.property({types:ba.types,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],t.prototype,"renderer",null);g([y.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),y.reader("renderer",["layerDefinition.drawingInfo.renderer",
"layerDefinition.defaultSymbol","layerDefinition.type"])],t.prototype,"readRenderer",null);g([y.writer("renderer")],t.prototype,"writeRenderer",null);g([y.property({readOnly:!0,dependsOn:["allRenderers","labelingInfo","elevationInfo.featureExpressionInfo","popupTemplate.requiredFields"]})],t.prototype,"requiredFields",null);g([y.property({type:Boolean})],t.prototype,"returnM",void 0);g([y.property({type:Boolean})],t.prototype,"returnZ",void 0);g([y.property(Q.screenSizePerspectiveEnabled)],t.prototype,
"screenSizePerspectiveEnabled",void 0);g([y.property()],t.prototype,"source",null);g([y.cast("source")],t.prototype,"castSource",null);g([y.reader("portal-item","source",["featureSet"]),y.reader("web-map","source",["featureSet"])],t.prototype,"readSource",null);g([y.property({readOnly:!0,json:{origins:{service:{read:{source:"definitionExpression"}}}}})],t.prototype,"serviceDefinitionExpression",void 0);g([y.property({type:C,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],
t.prototype,"spatialReference",void 0);g([y.property({type:[L]})],t.prototype,"templates",void 0);g([y.reader("templates",["editFieldsInfo","creatorField","editorField","templates"])],t.prototype,"readTemplates",null);g([y.property()],t.prototype,"timeInfo",void 0);g([y.property()],t.prototype,"title",void 0);g([y.reader("service","title",["name"]),y.reader("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],t.prototype,"readTitle",null);g([y.reader("web-map","title",
["layerDefinition.name","title"])],t.prototype,"readTitleFromWebMap",null);g([y.property({type:String})],t.prototype,"sublayerTitleMode",void 0);g([y.property({type:String,readOnly:!0,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0);g([y.property({json:{read:!1}})],t.prototype,"type",void 0);g([y.property({type:String,readOnly:!0})],t.prototype,"typeIdField",void 0);g([y.reader("service","typeIdField"),y.reader("typeIdField",["layerDefinition.typeIdField"])],t.prototype,
"readTypeIdField",null);g([y.property({type:[T]})],t.prototype,"types",void 0);g([y.reader("service","types",["types"]),y.reader("types",["layerDefinition.types"])],t.prototype,"readTypes",null);g([y.property({type:n.ofType(H.FeatureIndex),readOnly:!0})],t.prototype,"indexes",void 0);g([y.property({type:String})],t.prototype,"url",null);g([y.writer("url")],t.prototype,"writeUrl",null);g([y.property({readOnly:!0})],t.prototype,"userIsAdmin",void 0);g([y.property({json:{origins:{"portal-item":{read:!1}}}})],
t.prototype,"version",void 0);g([y.reader("service","version","currentVersion capabilities drawingInfo hasAttachments htmlPopupType relationships timeInfo typeIdField types".split(" ")),y.reader("version","layerDefinition.currentVersion layerDefinition.capabilities layerDefinition.drawingInfo layerDefinition.hasAttachments layerDefinition.htmlPopupType layerDefinition.typeIdField layerDefinition.types".split(" "))],t.prototype,"readVersion",null);g([y.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],
t.prototype,"visible",void 0);g([y.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],t.prototype,"readVisible",null);g([d(0,y.cast(ia))],t.prototype,"queryAttachments",null);g([d(0,y.cast(wa))],t.prototype,"queryFeatures",null);g([d(0,y.cast(wa))],t.prototype,"queryFeaturesJSON",null);g([d(0,y.cast(wa))],t.prototype,"queryObjectIds",null);g([d(0,y.cast(wa))],t.prototype,"queryFeatureCount",null);g([d(0,y.cast(wa))],t.prototype,"queryExtent",null);g([d(0,y.cast(za))],
t.prototype,"queryRelatedFeatures",null);return t=g([y.subclass("esri.layers.FeatureLayer")],t)}(y.declared(D,N,I,O,G,M,x))})},"esri/core/MultiOriginJSONSupport":function(){define("require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper ./Accessor ./accessorSupport/decorators ./accessorSupport/MultiOriginStore ./accessorSupport/PropertyOrigin ./accessorSupport/read ./accessorSupport/utils ./accessorSupport/write".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){function n(b){return a.getProperties(b).store}
return function(g){function f(){var b=g.call(this)||this,d=a.getProperties(b),e=d.metadatas,l=d.store,k=new h.default;d.store=k;l.keys().forEach(function(a){k.set(a,l.get(a),c.OriginId.DEFAULTS)});Object.keys(e).forEach(function(a){d.internalGet(a)&&k.set(a,d.internalGet(a),c.OriginId.DEFAULTS)});return b}k(f,g);f.prototype.clear=function(a,b){void 0===b&&(b="user");return n(this).clear(a,c.nameToId(b))};f.prototype.read=function(a,c){b.default(this,a,c);return this};f.prototype.write=function(a,
b){a=a||{};l.default(this,a,b);return a};f.prototype.getAtOrigin=function(a,b){var d=n(this),e=c.nameToId(b);if("string"===typeof a)return d.get(a,e);var h={};a.forEach(function(a){h[a]=d.get(a,e)});return h};f.prototype.originOf=function(a){var b=n(this);if("string"===typeof a)return c.idToName(b.originOf(a));a.forEach(function(a){c.idToName(b.originOf(a))})};f.prototype.revert=function(b,d){var e=n(this),h=c.nameToId(d),g=a.getProperties(this);("string"===typeof b?"*"===b?Object.keys(e.getAll(h)):
[b]:b).forEach(function(a){g.propertyInvalidated(a);e.revert(a,h);g.propertyCommitted(a)})};f.prototype.removeOrigin=function(a){var b=n(this);a=c.nameToId(a);var d=b.getAll(a),e;for(e in d)b.originOf(e)===a&&b.set(e,d[e],c.OriginId.USER)};f.prototype.updateOrigin=function(a,b){var d=n(this);b=c.nameToId(b);var e=this.get(a);d.clear(a);d.set(a,e,b)};return f=e([d.subclass("esri.core.MultiOriginJSONSupport")],f)}(d.declared(g))})},"esri/core/accessorSupport/MultiOriginStore":function(){define(["require",
"exports","./PropertyOrigin"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(){this._propertyOriginMap={};this._originStores=Array(k.OriginId.NUM);this._values={}}e.prototype.get=function(e,d){return(d=void 0===d?this._values:this._originStores[d])?d[e]:void 0};e.prototype.keys=function(){return Object.keys(this._values)};e.prototype.set=function(e,d,h){void 0===h&&(h=k.OriginId.USER);var c=this._originStores[h];c||(c={},this._originStores[h]=c);c[e]=d;return!(e in
this._values)||this._propertyOriginMap[e]<=h?(c=this._values[e],this._values[e]=d,this._propertyOriginMap[e]=h,c!==d):!1};e.prototype.clear=function(e,d){void 0===d&&(d=k.OriginId.USER);var h=this._originStores[d];if(h){var c=h[e];delete h[e];if(e in this._values&&this._propertyOriginMap[e]===d)for(delete this._values[e],--d;0<=d;d--)if((h=this._originStores[d])&&e in h){this._values[e]=h[e];this._propertyOriginMap[e]=d;break}return c}};e.prototype.has=function(e,d){return(d=void 0===d?this._values:
this._originStores[d])?e in d:!1};e.prototype.revert=function(e,d){for(;0<d&&!this.has(e,d);)--d;var h=this._originStores[d],h=h&&h[e],c=this._values[e];this._values[e]=h;this._propertyOriginMap[e]=d;return c!==h};e.prototype.originOf=function(e,d){return this._propertyOriginMap[e]||k.OriginId.DEFAULTS};e.prototype.getAll=function(e){return this._originStores[e]};return e}();f.default=m})},"esri/geometry/support/normalizeUtils":function(){define("require exports ../../config ../../core/Error ../../core/Logger ../../core/promiseUtils ../Polygon ../Polyline ../SpatialReference ./spatialReferenceUtils ./webMercatorUtils ../../tasks/GeometryService".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){function p(a){return"polygon"===a.type?a.rings:a.paths}function q(a,b){return Math.ceil((a-b)/(2*b))}function r(a,b){for(var c=0,d=p(a);c<d.length;c++)for(var e=0,h=d[c];e<h.length;e++)h[e][0]+=b;return a}function t(a){for(var b=[],c=0,d=0,e=0;e<a.length;e++){for(var h=a[e],g=null,l=0;l<h.length;l++)g=h[l],b.push(g),0===l?d=c=g[0]:(c=Math.min(c,g[0]),d=Math.max(d,g[0]));g&&b.push([(c+d)/2,0])}return b}function w(a,b){if(!(a instanceof c||a instanceof h))throw y.error("straightLineDensify: the input geometry is neither polyline nor polygon"),
new e("straightLineDensify: the input geometry is neither polyline nor polygon");for(var d=[],g=0,l=p(a);g<l.length;g++){var k=l[g],f=[];d.push(f);f.push([k[0][0],k[0][1]]);for(var n=0;n<k.length-1;n++){var m=k[n][0],q=k[n][1],r=k[n+1][0],t=k[n+1][1],v=Math.sqrt((r-m)*(r-m)+(t-q)*(t-q)),u=(t-q)/v,w=(r-m)/v,x=v/b;if(1<x){for(var z=1;z<=x-1;z++){var A=z*b;f.push([w*A+m,u*A+q])}v=(v+Math.floor(x-1)*b)/2;f.push([w*v+m,u*v+q])}f.push([r,t])}}return"polygon"===a.type?new h({rings:d,spatialReference:a.spatialReference}):
new c({paths:d,spatialReference:a.spatialReference})}function u(a,b,c){b&&(a=w(a,1E6),a=l.webMercatorToGeographic(a,!0));c&&(a=r(a,c));return a}function x(a,b,c){if(Array.isArray(a)){var d=a[0];if(d>b){var e=q(d,b);a[0]=d+-2*e*b}else d<c&&(e=q(d,c),a[0]=d+-2*e*c)}else d=a.x,d>b?(e=q(d,b),a=a.clone().offset(-2*e*b,0)):d<c&&(e=q(d,c),a=a.clone().offset(-2*e*c,0));return a}function v(a,b){for(var c=-1,d=function(d){var e=b.cutIndexes[d],h=b.geometries[d],g=p(h);d=function(a){var b=g[a];b.some(function(c){if(!(180>
c[0])){for(var d=c=0;d<b.length;d++){var e=b[d][0];c=e>c?e:c}c=Number(c.toFixed(9));c=-360*q(c,180);for(d=0;d<b.length;d++)e=h.getPoint(a,d),h.setPoint(a,d,e.clone().offset(c,0))}return!0})};for(var l=0;l<g.length;l++)d(l);if(e===c)if("polygon"===a[0].type)for(d=0,l=p(h);d<l.length;d++)a[e]=a[e].addRing(l[d]);else{if("polyline"===a[0].type)for(d=0,l=p(h);d<l.length;d++)a[e]=a[e].addPath(l[d])}else c=e,a[e]=h},e=0;e<b.cutIndexes.length;e++)d(e);return a}function z(b,e,g){if(!Array.isArray(b))return z([b],
e);e||(B||(B=new n({url:k.geometryServiceUrl})),e=B);for(var f,m,p,t,w,y,C,D=0,E=[],K=[],R=0;R<b.length;R++){var P=b[R];if(P)if(f||(f=P.spatialReference,m=a.getInfo(f),y=(p=f.isWebMercator)?102100:4326,t=A[y].maxX,w=A[y].minX,C=A[y].plus180Line,y=A[y].minus180Line),m)if("mesh"===P.type)K.push(P);else if("point"===P.type)K.push(x(P.clone(),t,w));else if("multipoint"===P.type)P=P.clone(),P.points=P.points.map(function(a){return x(a,t,w)}),K.push(P);else if("extent"===P.type){var L=P.clone(),P=L._normalize(!1,
!1,m);K.push(P.rings?new h(P):P)}else if(P.extent){var L=P.extent,T=2*q(L.xmin,w)*t,P=0===T?P.clone():r(P.clone(),T);L.offset(T,0);L.intersects(C)&&L.xmax!==t?(D=L.xmax>D?L.xmax:D,P=u(P,p),E.push(P),K.push("cut")):L.intersects(y)&&L.xmin!==w?(D=2*L.xmax*t>D?2*L.xmax*t:D,P=u(P,p,360),E.push(P),K.push("cut")):K.push(P)}else K.push(P.clone());else K.push(P);else K.push(P)}f=q(D,t);m=-90;C=f;for(D=new c;0<f;)R=-180+360*f,D.addPath([[R,m],[R,-1*m]]),m*=-1,f--;if(0<E.length&&0<C)return e.cut(E,D,g).then(function(a){return v(E,
a)}).then(function(a){for(var c=[],d=[],h=0;h<K.length;h++){var k=K[h];if("cut"!==k)d.push(k);else{var k=a.shift(),f=b[h];"polygon"===f.type&&f.rings&&1<f.rings.length&&k.rings.length>=f.rings.length?(c.push(k),d.push("simplify")):d.push(p?l.geographicToWebMercator(k):k)}}return c.length?e.simplify(c,g).then(function(a){for(var b=[],c=0;c<d.length;c++){var e=d[c];"simplify"!==e?b.push(e):b.push(p?l.geographicToWebMercator(a.shift()):a.shift())}return b}):d});f=[];for(m=0;m<K.length;m++)C=K[m],"cut"!==
C?f.push(C):(C=E.shift(),f.push(!0===p?l.geographicToWebMercator(C):C));return d.resolve(f)}Object.defineProperty(f,"__esModule",{value:!0});var y=g.getLogger("esri.geometry.support.normalizeUtils"),A={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new c({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:b.WebMercator}),minus180Line:new c({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,
2.0037508342788905E7]]],spatialReference:b.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new c({paths:[[[180,-180],[180,180]]],spatialReference:b.WebMercator}),minus180Line:new c({paths:[[[-180,-180],[-180,180]]],spatialReference:b.WebMercator})}};f.straightLineDensify=w;var B;f.normalizeCentralMeridian=z;f.getDenormalizedExtent=function(b){var c;if(!b)return null;var d=b.extent;if(!d)return null;var e=b.spatialReference&&a.getInfo(b.spatialReference);if(!e)return d;var e=e.valid,h=e[0],e=e[1],
g=d.width,l=d.xmin;c=d.xmax;c=[c,l];l=c[0];c=c[1];if("extent"===b.type||0===g||g<=e||g>2*e||l<h||c>e)return d;var k;switch(b.type){case "polygon":if(1<b.rings.length)k=t(b.rings);else return d;break;case "polyline":if(1<b.paths.length)k=t(b.paths);else return d;break;case "multipoint":k=b.points}b=d.clone();for(h=0;h<k.length;h++){var f=k[h][0];0>f?(f+=e,c=Math.max(f,c)):(f-=e,l=Math.min(f,l))}b.xmin=l;b.xmax=c;return b.width<g?(b.xmin-=e,b.xmax-=e,b):d}})},"esri/layers/mixins/ArcGISService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/accessorSupport/decorators ../support/arcgisLayerUrl".split(" "),
function(m,f,k,e,g,d,h,c){var b=g.getLogger("esri.layers.mixins.ArcGISService");return function(a){function d(){return null!==a&&a.apply(this,arguments)||this}k(d,a);Object.defineProperty(d.prototype,"title",{get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var a=c.parse(this.url);if(a&&a.title)return a.title}return this._get("title")||""},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"url",{set:function(a){this._set("url",c.sanitizeUrl(a,b))},enumerable:!0,configurable:!0});e([h.property({dependsOn:["url"]})],d.prototype,"title",null);e([h.property({type:String})],d.prototype,"url",null);return d=e([h.subclass("esri.layers.mixins.ArcGISService")],d)}(h.declared(d))})},"esri/layers/mixins/OperationalLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Error ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/read ../../core/accessorSupport/write ../../webdoc/support/opacityUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){f=function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a.title="Layer";return a}k(h,c);g=h;h.prototype.writeListMode=function(a,b,c,d){d&&"ground"===d.layerContainerType?b[c]=a:a&&n.willPropertyWrite(this,c,{},d)&&(b[c]=a)};h.prototype.writeTitle=function(a,b){b.title=a||"Layer"};h.prototype.writeOperationalLayerType=function(a,b){a&&(b.layerType=a)};h.prototype.readOpacity=function(a,b,c){if(void 0!==b.opacity&&(!c||"web-map"===c.origin||"web-scene"===
c.origin))return b.opacity;if((!c||"service"===c.origin)&&b.drawingInfo&&void 0!==b.drawingInfo.transparency)return p.transparencyToOpacity(b.drawingInfo.transparency);if(b.layerDefinition&&b.layerDefinition.drawingInfo&&void 0!==b.layerDefinition.drawingInfo.transparency)return p.transparencyToOpacity(b.layerDefinition.drawingInfo.transparency)};h.prototype.readVisible=function(a,b){return!!b.visibility};h.prototype.read=function(a,b){var c=this,d=arguments;b&&(b.layer=this);l.readLoadable(this,
a,function(b){return c.inherited(d,[a,b])},b);return this};h.prototype.write=function(a,b){if(b&&b.origin){var c=b.origin+"/"+(b.layerContainerType||"operational-layers"),e=g.supportedTypes[c],e=e&&e[this.operationalLayerType];if("write"!==e&&"readwrite"!==e)return b.messages&&b.messages.push(new d("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+c+"'",{layer:this})),null;if(!this.url&&!q[this.operationalLayerType])return b.messages&&
b.messages.push(new d("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' require a url to a service to be written to a '"+b.origin+"'",{layer:this})),null}return this.inherited(arguments,[a,b])};var g;e([a.property({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],h.prototype,"id",void 0);e([a.property({type:String,json:{write:{ignoreOrigin:!0}}})],h.prototype,"listMode",void 0);e([a.writer("listMode")],
h.prototype,"writeListMode",null);e([a.property({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}}}}})],h.prototype,"title",void 0);e([a.writer("title")],h.prototype,"writeTitle",null);e([a.property({type:String,json:{write:{ignoreOrigin:!0,writer:b.writeOperationalLayerUrl}}})],h.prototype,"url",void 0);e([a.property({type:String,json:{write:{target:"layerType",ignoreOrigin:!0}}})],h.prototype,"operationalLayerType",void 0);e([a.writer("operationalLayerType")],
h.prototype,"writeOperationalLayerType",null);e([a.property({type:Number,json:{write:{ignoreOrigin:!0}}})],h.prototype,"opacity",void 0);e([a.reader("opacity",["opacity","layerDefinition.drawingInfo.transparency","drawingInfo.transparency"])],h.prototype,"readOpacity",null);e([a.property({type:Boolean,json:{write:{target:"visibility",ignoreOrigin:!0}}})],h.prototype,"visible",void 0);e([a.reader("visible",["visibility"])],h.prototype,"readVisible",null);return h=g=e([a.subclass("esri.layers.mixins.OperationalLayer")],
h)}(a.declared(g,h));var q={GroupLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,ArcGISFeatureLayer:!0,CSV:!0,VectorTileLayer:!0,KML:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0};(function(a){a.typeModuleMap={ArcGISFeatureLayer:function(){return c.create(function(a){return m(["../FeatureLayer"],a)})},ArcGISImageServiceLayer:function(){return c.create(function(a){return m(["../ImageryLayer"],a)})},ArcGISImageServiceVectorLayer:function(){return c.resolve(null)},ArcGISMapServiceLayer:function(){return c.create(function(a){return m(["../MapImageLayer"],
a)})},ArcGISSceneServiceLayer:function(){return c.create(function(a){return m(["../SceneLayer"],a)})},ArcGISStreamLayer:function(){return c.create(function(a){return m(["../StreamLayer"],a)})},ArcGISTiledElevationServiceLayer:function(){return c.create(function(a){return m(["../ElevationLayer"],a)})},ArcGISTiledImageServiceLayer:function(){return c.create(function(a){return m(["../TileLayer"],a)})},ArcGISTiledMapServiceLayer:function(){return c.create(function(a){return m(["../TileLayer"],a)})},BingMapsAerial:function(){return c.create(function(a){return m(["../BingMapsLayer"],
a)})},BingMapsRoad:function(){return c.create(function(a){return m(["../BingMapsLayer"],a)})},BingMapsHybrid:function(){return c.create(function(a){return m(["../BingMapsLayer"],a)})},CSV:function(){return c.create(function(a){return m(["../CSVLayer"],a)})},GeoRSS:function(){return c.create(function(a){return m(["../GeoRSSLayer"],a)})},GroupLayer:function(){return c.create(function(a){return m(["../GroupLayer"],a)})},IntegratedMeshLayer:function(){return c.create(function(a){return m(["../IntegratedMeshLayer"],
a)})},KML:function(){return c.create(function(a){return m(["../KMLLayer"],a)})},OpenStreetMap:function(){return c.create(function(a){return m(["../OpenStreetMapLayer"],a)})},PointCloudLayer:function(){return c.create(function(a){return m(["../PointCloudLayer"],a)})},VectorTileLayer:function(){return c.create(function(a){return m(["../VectorTileLayer"],a)})},WebTiledLayer:function(){return c.create(function(a){return m(["../WebTileLayer"],a)})},WMS:function(){return c.create(function(a){return m(["../WMSLayer"],
a)})}};a.supportedTypes={"web-scene/operational-layers":{ArcGISFeatureLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISSceneServiceLayer:"readwrite",ArcGISTiledElevationServiceLayer:"read",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",GroupLayer:"readwrite",IntegratedMeshLayer:"readwrite",PointCloudLayer:"readwrite",WebTiledLayer:"readwrite",CSV:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite"},"web-scene/basemap":{ArcGISTiledImageServiceLayer:"readwrite",
ArcGISTiledMapServiceLayer:"readwrite",WebTiledLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",ArcGISImageServiceLayer:"readwrite",WMS:"readwrite",ArcGISMapServiceLayer:"readwrite"},"web-scene/ground":{ArcGISTiledElevationServiceLayer:"readwrite"},"web-map/operational-layers":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISStreamLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",
ArcGISFeatureLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite",CSV:"readwrite",GeoRSS:"readwrite",KML:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",WebTiledLayer:"readwrite"},"web-map/basemap":{ArcGISImageServiceLayer:"readwrite",ArcGISImageServiceVectorLayer:"readwrite",ArcGISMapServiceLayer:"readwrite",ArcGISTiledImageServiceLayer:"readwrite",ArcGISTiledMapServiceLayer:"readwrite",OpenStreetMap:"readwrite",VectorTileLayer:"readwrite",WMS:"readwrite",
WebTiledLayer:"readwrite",BingMapsAerial:"readwrite",BingMapsRoad:"readwrite",BingMapsHybrid:"readwrite"}}})(f||(f={}));return f})},"esri/layers/mixins/PortalLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../portal/Portal ../../portal/PortalItem".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,
n){var p=h.getLogger("esri.layers.mixins.PortalLayer");return function(h){function g(){return null!==h&&h.apply(this,arguments)||this}k(g,h);Object.defineProperty(g.prototype,"portalItem",{set:function(a){a!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",a))},enumerable:!0,configurable:!0});g.prototype.writePortalItem=function(a,b,c){a&&a.id&&(b.itemId=a.id)};g.prototype.loadFromPortal=function(a){var b=this;return this.portalItem&&this.portalItem.id?c.create(function(a){return m(["../../portal/support/layersLoader"],
a)}).then(function(c){return c.load({instance:b,supportedTypes:a.supportedTypes,validateItem:a.validateItem,supportsData:a.supportsData}).catch(function(a){p.warn("Failed to load layer ("+b.title+", "+b.id+") portal item ("+b.portalItem.id+")\n  "+a);throw a;})}):c.resolve()};g.prototype.read=function(a,b){b&&(b.layer=this);return this.inherited(arguments)};g.prototype.write=function(a,c){var e=c&&c.portal,h=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||l.getDefault());return e&&h&&
!b.hasSamePortal(h.restUrl,e.restUrl)?(c.messages&&c.messages.push(new d("layer:cross-portal","The layer '"+this.title+" ("+this.id+")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer",{layer:this})),null):this.inherited(arguments)};e([a.property({type:n})],g.prototype,"portalItem",null);e([a.writer("portalItem",{itemId:{type:String}})],
g.prototype,"writePortalItem",null);return g=e([a.subclass("esri.layers.mixins.PortalLayer")],g)}(a.declared(g))})},"esri/layers/mixins/RefreshableLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(h){function c(){var b=null!==h&&h.apply(this,arguments)||this;b.refreshInterval=0;return b}k(c,h);c.prototype.refresh=function(){this.emit("refresh")};
e([d.property({type:Number,cast:function(b){return.1<=b?b:0>=b?0:.1},json:{write:!0}})],c.prototype,"refreshInterval",void 0);return c=e([d.subclass("esri.layers.mixins.RefreshableLayer")],c)}(d.declared(g))})},"esri/layers/mixins/ScaleRangeLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(h){function c(){var b=null!==h&&
h.apply(this,arguments)||this;b.minScale=0;b.maxScale=0;return b}k(c,h);e([d.property({type:Number,json:{write:!0}})],c.prototype,"minScale",void 0);e([d.property({type:Number,json:{write:!0}})],c.prototype,"maxScale",void 0);return c=e([d.subclass("esri.layers.mixins.ScaleRangeLayer")],c)}(d.declared(g))})},"esri/layers/support/commonProperties":function(){define(["require","exports","../../core/accessorSupport/PropertyOrigin","../../core/accessorSupport/utils","../../core/accessorSupport/write"],
function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(d,h){if(null==h.screenSizePerspective&&"defaults"===this.originOf("screenSizePerspectiveEnabled"))e.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,k.OriginId.DEFAULTS);else return h.screenSizePerspective}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(d,e,
c,b){"defaults"===this.originOf("screenSizePerspectiveEnabled")&&d?e[c]=d:g.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},b)&&(e[c]=d)}}}}}};f.popupEnabled={type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(d,e){return!e.disablePopup}},write:{target:"disablePopup",writer:function(d,e,c){e[c]=!d}}}};f.labelsVisible={type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}}})},"esri/layers/support/FeatureIndex":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function c(a){return h.call(this,a)||this}k(c,h);b=c;c.prototype.clone=function(){return new b({name:this.name,fields:this.fields,isAscending:this.isAscending,isUnique:this.isUnique,description:this.description})};var b;e([d.property({constructOnly:!0})],c.prototype,"name",void 0);e([d.property({constructOnly:!0})],c.prototype,"fields",void 0);e([d.property({constructOnly:!0})],c.prototype,"isAscending",void 0);e([d.property({constructOnly:!0})],
c.prototype,"isUnique",void 0);e([d.property({constructOnly:!0})],c.prototype,"description",void 0);return c=b=e([d.subclass("esri.layers.support.FeatureIndex")],c)}(d.declared(g));f.FeatureIndex=m;f.default=m})},"esri/layers/support/FeatureProcessing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/accessorSupport/decorators ./Field ./fieldUtils".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function g(){return null!==
a&&a.apply(this,arguments)||this}k(g,a);f=g;g.fromWorker=function(a){if(!a)return null;a=JSON.parse(a);var b=new f;b.fields=a.fields&&a.fields.map(function(a){return c.fromJSON(a)});b.options=a.options;b.process=new (Function.bind.apply(Function,[void 0].concat(a.process.args,[a.process.body])));return b};Object.defineProperty(g.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new f(d.clone({fields:this.fields,
options:this.options,process:this.process}))};g.prototype.getField=function(a){return b.getField(a,this.fields)};g.prototype.refresh=function(){this.notifyChange("version")};g.prototype.toWorker=function(){var a=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:a.substring(a.indexOf("{")+1,a.lastIndexOf("}")),args:a.slice(a.indexOf("(")+1,a.indexOf(")")).match(/([^\s,]+)/g)}})};var f;e([h.property({type:[c]})],g.prototype,"fields",void 0);e([h.property()],
g.prototype,"options",void 0);e([h.property()],g.prototype,"process",void 0);e([h.property({readOnly:!0,dependsOn:["process","options","fields"]})],g.prototype,"version",null);return g=f=e([h.subclass("esri.layers.support.FeatureProcessing")],g)}(h.declared(g))})},"esri/layers/support/fieldUtils":function(){define(["require","exports","@dojo/framework/shim/Set","../../core/object","./domains"],function(m,f,k,e,g){function d(a,b,c){if(a)for(var d=0;d<a.length;d++){var g=a[d],l=e.getDeepValue(g,b);
(l=l&&"function"!==typeof l&&h(l,c))&&e.setDeepValue(g,l.name,b)}}function h(a,b){if("string"!==typeof a)return null;if(null!=b){a=a.toLowerCase();for(var c=0;c<b.length;c++){var d=b[c];if(d&&d.name.toLowerCase()===a)return d}}return null}function c(a){return"number"===typeof a&&!isNaN(a)&&isFinite(a)}function b(a){return null===a||c(a)}function a(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a}function l(b){return null===b||a(b)}function n(a){return null!=a&&"string"===typeof a}function p(a){return null===
a||n(a)}function q(a){return!0}function r(d,e){var h;switch(d.type){case "date":case "integer":case "long":case "small-integer":case "esriFieldTypeDate":case "esriFieldTypeInteger":case "esriFieldTypeLong":case "esriFieldTypeSmallInteger":h=d.nullable?l:a;break;case "double":case "single":case "esriFieldTypeSingle":case "esriFieldTypeDouble":h=d.nullable?b:c;break;case "string":case "esriFieldTypeString":h=d.nullable?p:n;break;default:h=q}return 1===arguments.length?h:h(e)}function t(a){return null!=
a&&v.has(a.type)}function w(a,b){return a.nullable&&null===b?null:t(a)&&!u(a.type,b)?z.OUT_OF_RANGE:r(a,b)?a.domain?g.validateDomainValue(a.domain,b):null:y.INVALID_TYPE}function u(a,b){return(a=x(a))?b>=a.min&&b<=a.max:!1}function x(a){switch(a){case "esriFieldTypeSmallInteger":case "small-integer":return{min:-32768,max:32767};case "esriFieldTypeInteger":case "integer":return{min:-2147483648,max:2147483647};case "esriFieldTypeSingle":case "single":return{min:-3.4E38,max:1.2E38};case "esriFieldTypeDouble":case "double":return{min:-Number.MAX_VALUE,
max:Number.MAX_VALUE}}}Object.defineProperty(f,"__esModule",{value:!0});f.fixRendererFields=function(a,b){if(null!=a&&null!=b){var c=0;for(a=Array.isArray(a)?a:[a];c<a.length;c++){var e=a[c];d(f.rendererFields,e,b);if(e.visualVariables)for(var h=0,e=e.visualVariables;h<e.length;h++)d(f.visualVariableFields,e[h],b)}}};f.getField=h;f.getFieldDefaultValue=function(a){var b=a.defaultValue;if(void 0!==b&&r(a,b))return b;if(a.nullable)return null};f.isValueMatchingFieldType=r;f.rendererFields="field field2 field3 normalizationField rotationInfo.field proportionalSymbolInfo.field proportionalSymbolInfo.normalizationField colorInfo.field colorInfo.normalizationField".split(" ");
f.visualVariableFields=["field","normalizationField"];f.numericTypes=["integer","small-integer","single","double"];var v=new k.default(f.numericTypes.concat(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]));f.isNumericField=t;f.isStringField=function(a){return null!=a&&("string"===a.type||"esriFieldTypeString"===a.type)};f.isDateField=function(a){return null!=a&&("date"===a.type||"esriFieldTypeDate"===a.type)};f.isValidFieldValue=function(a,b){return null===
w(a,b)};var z;(z=f.NumericRangeValidationError||(f.NumericRangeValidationError={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range";var y;(y=f.TypeValidationError||(f.TypeValidationError={})).INVALID_TYPE="type-validation-error::invalid-type";f.validateFieldValue=w;f.isNumberInRange=u;f.getFieldRange=function(a){var b=g.getDomainRange(a.domain);if(b)return b;if(t(a))return x(a.type)};f.validationErrorToString=function(a,b,c){switch(a){case g.DomainValidationError.INVALID_CODED_VALUE:return"Value "+
c+" is not in the coded domain - field: "+b.name+", domain: "+JSON.stringify(b.domain);case g.DomainValidationError.VALUE_OUT_OF_RANGE:return"Value "+c+" is out of the range of valid values - field: "+b.name+", domain: "+JSON.stringify(b.domain);case y.INVALID_TYPE:return"Value "+c+" is not a valid value for the field type - field: "+b.name+", type: "+b.type+", nullable: "+b.nullable;case z.OUT_OF_RANGE:return a=x(b.type),"Value "+c+" is out of range for the number type - field: "+b.name+", type: "+
b.type+", value range is "+a.min+" to "+a.max}}})},"@dojo/framework/shim/Set":function(){(function(m){"object"===typeof module&&"object"===typeof module.exports?(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define("require exports tslib ./global ./iterator ./support/has ./Symbol".split(" "),m)})(function(m,f){Object.defineProperty(f,"__esModule",{value:!0});var k=m("tslib"),e=m("./global"),g=m("./iterator"),d=m("./support/has");m("./Symbol");f.Set=e.default.Set;
d.default("es6-set")||(f.Set=(h=function(){function c(b){this._setData=[];this[Symbol.toStringTag]="Set";if(b)if(g.isArrayLike(b))for(var a=0;a<b.length;a++)this.add(b[a]);else try{for(var a=k.__values(b),c=a.next();!c.done;c=a.next())this.add(c.value)}catch(q){d={error:q}}finally{try{c&&!c.done&&(e=a.return)&&e.call(a)}finally{if(d)throw d.error;}}var d,e}c.prototype.add=function(b){if(this.has(b))return this;this._setData.push(b);return this};c.prototype.clear=function(){this._setData.length=0};
c.prototype.delete=function(b){b=this._setData.indexOf(b);if(-1===b)return!1;this._setData.splice(b,1);return!0};c.prototype.entries=function(){return new g.ShimIterator(this._setData.map(function(b){return[b,b]}))};c.prototype.forEach=function(b,a){for(var c=this.values(),d=c.next();!d.done;)b.call(a,d.value,d.value,this),d=c.next()};c.prototype.has=function(b){return-1<this._setData.indexOf(b)};c.prototype.keys=function(){return new g.ShimIterator(this._setData)};Object.defineProperty(c.prototype,
"size",{get:function(){return this._setData.length},enumerable:!0,configurable:!0});c.prototype.values=function(){return new g.ShimIterator(this._setData)};c.prototype[Symbol.iterator]=function(){return new g.ShimIterator(this._setData)};return c}(),h[Symbol.species]=h,h));f.default=f.Set;var h})},"tslib/tslib":function(){var m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x;(function(a){function b(a,b){a!==c&&("function"===typeof Object.create?Object.defineProperty(a,"__esModule",{value:!0}):a.__esModule=!0);
return function(c,d){return a[c]=b?b(c,d):d}}var c="object"===typeof global?global:"object"===typeof self?self:"object"===typeof this?this:{};"function"===typeof define&&define.amd?define("tslib",["exports"],function(d){a(b(c,b(d)))}):"object"===typeof module&&"object"===typeof module.exports?a(b(c,b(module.exports))):a(b(c))})(function(v){var z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};m=function(a,
b){function c(){this.constructor=a}z(a,b);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};f=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};k=function(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"===typeof Object.getOwnPropertySymbols){var e=0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>
b.indexOf(d[e])&&(c[d[e]]=a[d[e]])}return c};e=function(a,b,c,d){var e=arguments.length,h=3>e?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(a,b,c,d);else for(var l=a.length-1;0<=l;l--)if(g=a[l])h=(3>e?g(h):3<e?g(b,c,h):g(b,c))||h;return 3<e&&h&&Object.defineProperty(b,c,h),h};g=function(a,b){return function(c,d){b(c,d,a)}};d=function(a,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(a,
b)};h=function(a,b,c,d){return new (c||(c=Promise))(function(e,h){function g(a){try{k(d.next(a))}catch(G){h(G)}}function l(a){try{k(d["throw"](a))}catch(G){h(G)}}function k(a){a.done?e(a.value):(new c(function(b){b(a.value)})).then(g,l)}k((d=d.apply(a,b||[])).next())})};c=function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(h)throw new TypeError("Generator is already executing.");for(;e;)try{if(h=1,g&&(l=c[0]&2?g["return"]:c[0]?g["throw"]||((l=g["return"])&&l.call(g),0):
g.next)&&!(l=l.call(g,c[1])).done)return l;if(g=0,l)c=[c[0]&2,l.value];switch(c[0]){case 0:case 1:l=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++;g=c[1];c=[0];continue;case 7:c=e.ops.pop();e.trys.pop();continue;default:if(!(l=e.trys,l=0<l.length&&l[l.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!l||c[1]>l[0]&&c[1]<l[3]))e.label=c[1];else if(6===c[0]&&e.label<l[1])e.label=l[1],l=c;else if(l&&e.label<l[2])e.label=l[2],e.ops.push(c);else{l[2]&&e.ops.pop();e.trys.pop();
continue}}c=b.call(a,e)}catch(G){c=[6,G],g=0}finally{h=l=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},h,g,l,k;return k={next:c(0),"throw":c(1),"return":c(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k};b=function(a,b){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])};a=function(a){var b="function"===typeof Symbol&&a[Symbol.iterator],c=0;return b?b.call(a):{next:function(){a&&
c>=a.length&&(a=void 0);return{value:a&&a[c++],done:!a}}}};l=function(a,b){var c="function"===typeof Symbol&&a[Symbol.iterator];if(!c)return a;a=c.call(a);var d,e=[],h;try{for(;(void 0===b||0<b--)&&!(d=a.next()).done;)e.push(d.value)}catch(F){h={error:F}}finally{try{d&&!d.done&&(c=a["return"])&&c.call(a)}finally{if(h)throw h.error;}}return e};n=function(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(l(arguments[b]));return a};p=function(a){return this instanceof p?(this.v=a,this):new p(a)};
q=function(a,b,c){function d(a){k[a]&&(f[a]=function(b){return new Promise(function(c,d){1<n.push([a,b,c,d])||e(a,b)})})}function e(a,b){try{var c=k[a](b);c.value instanceof p?Promise.resolve(c.value.v).then(h,g):l(n[0][2],c)}catch(H){l(n[0][3],H)}}function h(a){e("next",a)}function g(a){e("throw",a)}function l(a,b){(a(b),n.shift(),n.length)&&e(n[0][0],n[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var k=c.apply(a,b||[]),f,n=[];return f={},d("next"),
d("throw"),d("return"),f[Symbol.asyncIterator]=function(){return this},f};r=function(a){function b(b,e){c[b]=a[b]?function(c){return(d=!d)?{value:p(a[b](c)),done:"return"===b}:e?e(c):c}:e}var c,d;return c={},b("next"),b("throw",function(a){throw a;}),b("return"),c[Symbol.iterator]=function(){return this},c};t=function(b){function c(a){h[a]=b[a]&&function(c){return new Promise(function(e,h){c=b[a](c);d(e,h,c.done,c.value)})}}function d(a,b,c,d){Promise.resolve(d).then(function(b){a({value:b,done:c})},
b)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=b[Symbol.asyncIterator],h;return e?e.call(b):(b="function"===typeof a?a(b):b[Symbol.iterator](),h={},c("next"),c("throw"),c("return"),h[Symbol.asyncIterator]=function(){return this},h)};w=function(a,b){Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b;return a};u=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b["default"]=
a;return b};x=function(a){return a&&a.__esModule?a:{"default":a}};v("__extends",m);v("__assign",f);v("__rest",k);v("__decorate",e);v("__param",g);v("__metadata",d);v("__awaiter",h);v("__generator",c);v("__exportStar",b);v("__values",a);v("__read",l);v("__spread",n);v("__await",p);v("__asyncGenerator",q);v("__asyncDelegator",r);v("__asyncValues",t);v("__makeTemplateObject",w);v("__importStar",u);v("__importDefault",x)})},"@dojo/framework/shim/global":function(){(function(m){"object"===typeof module&&
"object"===typeof module.exports?(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define(["require","exports"],m)})(function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof global)return global}();f.default=m})},"@dojo/framework/shim/iterator":function(){(function(m){"object"===typeof module&&"object"===typeof module.exports?
(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define(["require","exports","./Symbol","./string"],m)})(function(m,f){function k(b){return b&&"function"===typeof b[Symbol.iterator]}function e(b){return b&&"number"===typeof b.length}function g(b){if(k(b))return b[Symbol.iterator]();if(e(b))return new c(b)}Object.defineProperty(f,"__esModule",{value:!0});m("./Symbol");var d=m("./string"),h={done:!0,value:void 0},c=function(){function b(a){this._nextIndex=
-1;k(a)?this._nativeIterator=a[Symbol.iterator]():this._list=a}b.prototype.next=function(){return this._nativeIterator?this._nativeIterator.next():this._list?++this._nextIndex<this._list.length?{done:!1,value:this._list[this._nextIndex]}:h:h};b.prototype[Symbol.iterator]=function(){return this};return b}();f.ShimIterator=c;f.isIterable=k;f.isArrayLike=e;f.get=g;f.forOf=function(b,a,c){function h(){l=!0}var l=!1;if(e(b)&&"string"===typeof b)for(var k=b.length,f=0;f<k;++f){var m=b[f];if(f+1<k){var w=
m.charCodeAt(0);w>=d.HIGH_SURROGATE_MIN&&w<=d.HIGH_SURROGATE_MAX&&(m+=b[++f])}a.call(c,m,b,h);if(l)break}else if(k=g(b))for(f=k.next();!f.done;){a.call(c,f.value,b,h);if(l)break;f=k.next()}}})},"@dojo/framework/shim/Symbol":function(){(function(m){"object"===typeof module&&"object"===typeof module.exports?(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define(["require","exports","./support/has","./global","./support/util"],m)})(function(m,f){function k(a){return a&&
("symbol"===typeof a||"Symbol"===a["@@toStringTag"])||!1}Object.defineProperty(f,"__esModule",{value:!0});var e=m("./support/has"),g=m("./global"),d=m("./support/util");f.Symbol=g.default.Symbol;if(!e.default("es6-symbol")){var h=function(a){if(!k(a))throw new TypeError(a+" is not a symbol");return a},c=Object.defineProperties,b=Object.defineProperty,a=Object.create,l=Object.prototype,n={},p=function(){var c=a(null);return function(a){for(var e=0,h;c[String(a)+(e||"")];)++e;a+=String(e||"");c[a]=
!0;h="@@"+a;Object.getOwnPropertyDescriptor(l,h)||b(l,h,{set:function(a){b(this,h,d.getValueDescriptor(a))}});return h}}(),q=function t(a){if(this instanceof q)throw new TypeError("TypeError: Symbol is not a constructor");return t(a)};f.Symbol=g.default.Symbol=function w(a){if(this instanceof w)throw new TypeError("TypeError: Symbol is not a constructor");var b=Object.create(q.prototype);a=void 0===a?"":String(a);return c(b,{__description__:d.getValueDescriptor(a),__name__:d.getValueDescriptor(p(a))})};
b(f.Symbol,"for",d.getValueDescriptor(function(a){return n[a]?n[a]:n[a]=f.Symbol(String(a))}));c(f.Symbol,{keyFor:d.getValueDescriptor(function(a){var b;h(a);for(b in n)if(n[b]===a)return b}),hasInstance:d.getValueDescriptor(f.Symbol.for("hasInstance"),!1,!1),isConcatSpreadable:d.getValueDescriptor(f.Symbol.for("isConcatSpreadable"),!1,!1),iterator:d.getValueDescriptor(f.Symbol.for("iterator"),!1,!1),match:d.getValueDescriptor(f.Symbol.for("match"),!1,!1),observable:d.getValueDescriptor(f.Symbol.for("observable"),
!1,!1),replace:d.getValueDescriptor(f.Symbol.for("replace"),!1,!1),search:d.getValueDescriptor(f.Symbol.for("search"),!1,!1),species:d.getValueDescriptor(f.Symbol.for("species"),!1,!1),split:d.getValueDescriptor(f.Symbol.for("split"),!1,!1),toPrimitive:d.getValueDescriptor(f.Symbol.for("toPrimitive"),!1,!1),toStringTag:d.getValueDescriptor(f.Symbol.for("toStringTag"),!1,!1),unscopables:d.getValueDescriptor(f.Symbol.for("unscopables"),!1,!1)});c(q.prototype,{constructor:d.getValueDescriptor(f.Symbol),
toString:d.getValueDescriptor(function(){return this.__name__},!1,!1)});c(f.Symbol.prototype,{toString:d.getValueDescriptor(function(){return"Symbol ("+h(this).__description__+")"}),valueOf:d.getValueDescriptor(function(){return h(this)})});b(f.Symbol.prototype,f.Symbol.toPrimitive,d.getValueDescriptor(function(){return h(this)}));b(f.Symbol.prototype,f.Symbol.toStringTag,d.getValueDescriptor("Symbol",!1,!1,!0));b(q.prototype,f.Symbol.toPrimitive,d.getValueDescriptor(f.Symbol.prototype[f.Symbol.toPrimitive],
!1,!1,!0));b(q.prototype,f.Symbol.toStringTag,d.getValueDescriptor(f.Symbol.prototype[f.Symbol.toStringTag],!1,!1,!0))}f.isSymbol=k;"hasInstance isConcatSpreadable iterator species replace search split match toPrimitive toStringTag unscopables observable".split(" ").forEach(function(a){f.Symbol[a]||Object.defineProperty(f.Symbol,a,d.getValueDescriptor(f.Symbol.for(a),!1,!1))});f.default=f.Symbol})},"@dojo/framework/shim/support/has":function(){(function(m){"object"===typeof module&&"object"===typeof module.exports?
(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define("require exports tslib ../../has/has ../global ../../has/has".split(" "),m)})(function(m,f){Object.defineProperty(f,"__esModule",{value:!0});var k=m("tslib"),e=m("../../has/has"),g=m("../global");f.default=e.default;k.__exportStar(m("../../has/has"),f);e.add("es6-array",function(){return["from","of"].every(function(d){return d in g.default.Array})&&["findIndex","find","copyWithin"].every(function(d){return d in
g.default.Array.prototype})},!0);e.add("es6-array-fill",function(){return"fill"in g.default.Array.prototype?1===[1].fill(9,Number.POSITIVE_INFINITY)[0]:!1},!0);e.add("es7-array",function(){return"includes"in g.default.Array.prototype},!0);e.add("es6-map",function(){if("function"===typeof g.default.Map)try{var d=new g.default.Map([[0,1]]);return d.has(0)&&"function"===typeof d.keys&&e.default("es6-symbol")&&"function"===typeof d.values&&"function"===typeof d.entries}catch(c){}return!1},!0);e.add("es6-math",
function(){return"clz32 sign log10 log2 log1p expm1 cosh sinh tanh acosh asinh atanh trunc fround cbrt hypot".split(" ").every(function(d){return"function"===typeof g.default.Math[d]})},!0);e.add("es6-math-imul",function(){return"imul"in g.default.Math?-5===Math.imul(4294967295,5):!1},!0);e.add("es6-object",function(){return e.default("es6-symbol")&&["assign","is","getOwnPropertySymbols","setPrototypeOf"].every(function(d){return"function"===typeof g.default.Object[d]})},!0);e.add("es2017-object",
function(){return["values","entries","getOwnPropertyDescriptors"].every(function(d){return"function"===typeof g.default.Object[d]})},!0);e.add("es-observable",function(){return"undefined"!==typeof g.default.Observable},!0);e.add("es6-promise",function(){return"undefined"!==typeof g.default.Promise&&e.default("es6-symbol")},!0);e.add("es6-set",function(){if("function"===typeof g.default.Set){var d=new g.default.Set([1]);return d.has(1)&&"keys"in d&&"function"===typeof d.keys&&e.default("es6-symbol")}return!1},
!0);e.add("es6-string",function(){return["fromCodePoint"].every(function(d){return"function"===typeof g.default.String[d]})&&"codePointAt normalize repeat startsWith endsWith includes".split(" ").every(function(d){return"function"===typeof g.default.String.prototype[d]})},!0);e.add("es6-string-raw",function(){function e(b){for(var a=1;a<arguments.length;a++);a=k.__spread(b);a.raw=b.raw;return a}if("raw"in g.default.String){var c=e(d||(d=k.__makeTemplateObject(["a\n",""],["a\\n",""])),1);c.raw=["a\\n"];
return"a:\\n"===g.default.String.raw(c,42)}return!1},!0);e.add("es2017-string",function(){return["padStart","padEnd"].every(function(d){return"function"===typeof g.default.String.prototype[d]})},!0);e.add("es6-symbol",function(){return"undefined"!==typeof g.default.Symbol&&"symbol"===typeof Symbol()},!0);e.add("es6-weakmap",function(){if("undefined"!==typeof g.default.WeakMap){var d={},c={},b=new g.default.WeakMap([[d,1]]);Object.freeze(d);return 1===b.get(d)&&b.set(c,2)===b&&e.default("es6-symbol")}return!1},
!0);e.add("microtasks",function(){return e.default("es6-promise")||e.default("host-node")||e.default("dom-mutationobserver")},!0);e.add("postmessage",function(){return"undefined"!==typeof g.default.window&&"function"===typeof g.default.postMessage},!0);e.add("raf",function(){return"function"===typeof g.default.requestAnimationFrame},!0);e.add("setimmediate",function(){return"undefined"!==typeof g.default.setImmediate},!0);e.add("dom-mutationobserver",function(){if(e.default("host-browser")&&(g.default.MutationObserver||
g.default.WebKitMutationObserver)){var d=document.createElement("div"),c=new (g.default.MutationObserver||g.default.WebKitMutationObserver)(function(){});c.observe(d,{attributes:!0});d.style.setProperty("display","block");return!!c.takeRecords().length}return!1},!0);e.add("dom-webanimation",function(){return e.default("host-browser")&&void 0!==g.default.Animation&&void 0!==g.default.KeyframeEffect},!0);e.add("abort-controller",function(){return"undefined"!==typeof g.default.AbortController});e.add("abort-signal",
function(){return"undefined"!==typeof g.default.AbortSignal});var d})},"@dojo/framework/has/has":function(){(function(m){"object"===typeof module&&"object"===typeof module.exports?(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define(["require","exports"],m)})(function(m,f){function k(b){b=b.toLowerCase();return!!(b in c||b in f.testCache||f.testFunctions[b])}function e(b,a,e){void 0===e&&(e=!1);var h=b.toLowerCase();if(k(h)&&!e&&!(h in c))throw new TypeError('Feature "'+
b+'" exists and overwrite not true.');"function"===typeof a?f.testFunctions[h]=a:a&&a.then?d[b]=a.then(function(a){f.testCache[b]=a;delete d[b]},function(){delete d[b]}):(f.testCache[h]=a,delete f.testFunctions[h])}function g(b){var a=b.toLowerCase();if(a in c)b=c[a];else if(f.testFunctions[a])b=f.testCache[a]=f.testFunctions[a].call(null),delete f.testFunctions[a];else if(a in f.testCache)b=f.testCache[a];else{if(b in d)return!1;throw new TypeError('Attempt to detect unregistered has feature "'+
b+'"');}return b}Object.defineProperty(f,"__esModule",{value:!0});f.testCache={};f.testFunctions={};var d={};m="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};var h=(m.DojoHasEnvironment||{}).staticFeatures;"DojoHasEnvironment"in m&&delete m.DojoHasEnvironment;var c=h?"function"===typeof h?h.apply(m):h:{};f.load=function(b,a,c,d){b?a([b],c):c()};f.normalize=function(b,a){function c(a){var b=d[e++];if(":"===b)return null;if("?"===d[e++]){if(!a&&
g(b))return c();c(!0);return c(a)}return b}var d=b.match(/[\?:]|[^:\?]*/g)||[],e=0;return(b=c())&&a(b)};f.exists=k;f.add=e;f.default=g;e("debug",!0);e("host-browser","undefined"!==typeof document&&"undefined"!==typeof location);e("host-node",function(){if("object"===typeof process&&process.versions&&process.versions.node)return process.versions.node})})},"@dojo/framework/shim/support/util":function(){(function(m){"object"===typeof module&&"object"===typeof module.exports?(m=m(require,exports),void 0!==
m&&(module.exports=m)):"function"===typeof define&&define.amd&&define(["require","exports"],m)})(function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.getValueDescriptor=function(k,e,g,d){void 0===e&&(e=!1);void 0===g&&(g=!0);void 0===d&&(d=!0);return{value:k,enumerable:e,writable:g,configurable:d}};f.wrapNative=function(k){return function(e){for(var g=[],d=1;d<arguments.length;d++)g[d-1]=arguments[d];return k.apply(e,g)}}})},"@dojo/framework/shim/string":function(){(function(m){"object"===
typeof module&&"object"===typeof module.exports?(m=m(require,exports),void 0!==m&&(module.exports=m)):"function"===typeof define&&define.amd&&define("require exports tslib ./global ./support/has ./support/util".split(" "),m)})(function(m,f){Object.defineProperty(f,"__esModule",{value:!0});var k=m("tslib"),e=m("./global"),g=m("./support/has");m=m("./support/util");f.HIGH_SURROGATE_MIN=55296;f.HIGH_SURROGATE_MAX=56319;f.LOW_SURROGATE_MIN=56320;f.LOW_SURROGATE_MAX=57343;if(g.default("es6-string")&&g.default("es6-string-raw"))f.fromCodePoint=
e.default.String.fromCodePoint,f.raw=e.default.String.raw,f.codePointAt=m.wrapNative(e.default.String.prototype.codePointAt),f.endsWith=m.wrapNative(e.default.String.prototype.endsWith),f.includes=m.wrapNative(e.default.String.prototype.includes),f.normalize=m.wrapNative(e.default.String.prototype.normalize),f.repeat=m.wrapNative(e.default.String.prototype.repeat),f.startsWith=m.wrapNative(e.default.String.prototype.startsWith);else{var d=function(d,c,b,a,e){void 0===e&&(e=!1);if(null==c)throw new TypeError("string."+
d+" requires a valid string to search against.");d=c.length;return[c,String(b),Math.min(Math.max(a!==a?e?d:0:a,0),d)]};f.fromCodePoint=function(){for(var d=0;d<arguments.length;d++);d=arguments.length;if(!d)return"";for(var c=String.fromCharCode,b=[],a=-1,e="";++a<d;){var g=Number(arguments[a]);if(!(isFinite(g)&&Math.floor(g)===g&&0<=g&&1114111>=g))throw RangeError("string.fromCodePoint: Invalid code point "+g);65535>=g?b.push(g):(g-=65536,b.push((g>>10)+f.HIGH_SURROGATE_MIN,g%1024+f.LOW_SURROGATE_MIN));
if(a+1===d||16384<b.length)e+=c.apply(null,b),b.length=0}return e};f.raw=function(d){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];var b=d.raw,a="",e=c.length;if(null==d||null==d.raw)throw new TypeError("string.raw requires a valid callSite object with a raw value");for(var h=0,g=b.length;h<g;h++)a+=b[h]+(h<e&&h<g-1?c[h]:"");return a};f.codePointAt=function(d,c){void 0===c&&(c=0);if(null==d)throw new TypeError("string.codePointAt requries a valid string.");var b=d.length;c!==c&&(c=0);
if(!(0>c||c>=b)){var a=d.charCodeAt(c);return a>=f.HIGH_SURROGATE_MIN&&a<=f.HIGH_SURROGATE_MAX&&b>c+1&&(d=d.charCodeAt(c+1),d>=f.LOW_SURROGATE_MIN&&d<=f.LOW_SURROGATE_MAX)?1024*(a-f.HIGH_SURROGATE_MIN)+d-f.LOW_SURROGATE_MIN+65536:a}};f.endsWith=function(e,c,b){null==b&&(b=e.length);b=k.__read(d("endsWith",e,c,b,!0),3);e=b[0];c=b[1];b=b[2];var a=b-c.length;return 0>a?!1:e.slice(a,b)===c};f.includes=function(e,c,b){void 0===b&&(b=0);b=k.__read(d("includes",e,c,b),3);e=b[0];c=b[1];b=b[2];return-1!==
e.indexOf(c,b)};f.repeat=function(d,c){void 0===c&&(c=0);if(null==d)throw new TypeError("string.repeat requires a valid string.");c!==c&&(c=0);if(0>c||Infinity===c)throw new RangeError("string.repeat requires a non-negative finite count.");for(var b="";c;)c%2&&(b+=d),1<c&&(d+=d),c>>=1;return b};f.startsWith=function(e,c,b){void 0===b&&(b=0);c=String(c);b=k.__read(d("startsWith",e,c,b),3);e=b[0];c=b[1];b=b[2];var a=b+c.length;return a>e.length?!1:e.slice(b,a)===c}}g.default("es2017-string")?(f.padEnd=
m.wrapNative(e.default.String.prototype.padEnd),f.padStart=m.wrapNative(e.default.String.prototype.padStart)):(f.padEnd=function(d,c,b){void 0===b&&(b=" ");if(null===d||void 0===d)throw new TypeError("string.repeat requires a valid string.");if(Infinity===c)throw new RangeError("string.padEnd requires a non-negative finite count.");if(null===c||void 0===c||0>c)c=0;d=String(d);c-=d.length;0<c&&(d+=f.repeat(b,Math.floor(c/b.length))+b.slice(0,c%b.length));return d},f.padStart=function(d,c,b){void 0===
b&&(b=" ");if(null===d||void 0===d)throw new TypeError("string.repeat requires a valid string.");if(Infinity===c)throw new RangeError("string.padStart requires a non-negative finite count.");if(null===c||void 0===c||0>c)c=0;d=String(d);c-=d.length;0<c&&(d=f.repeat(b,Math.floor(c/b.length))+b.slice(0,c%b.length)+d);return d})})},"esri/layers/support/FeatureReduction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function c(){var b=null!==h&&h.apply(this,arguments)||this;b.type=null;return b}k(c,h);e([d.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);return c=e([d.subclass("esri.layers.support.FeatureReduction")],c)}(d.declared(g));f.FeatureReduction=m;f.default=m})},"esri/layers/support/FeatureReductionSelection":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./FeatureReduction".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function c(){var b=null!==d&&d.apply(this,arguments)||this;b.type="selection";return b}k(c,d);e([g.property()],c.prototype,"type",void 0);return c=e([g.subclass("esri.layers.support.FeatureReductionSelection")],c)}(g.declared(d.default));f.FeatureReductionSelection=m;f.default=m})},"esri/layers/support/FeatureTemplate":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/lang ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h,c){var b=d({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",
esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});return function(a){function d(b){b=a.call(this,b)||this;b.name=null;b.description=null;b.drawingTool=null;b.prototype=null;b.thumbnail=null;return b}k(d,a);d.prototype.writeDrawingTool=function(a,c){c.drawingTool=b.toJSON(a)};d.prototype.writePrototype=function(a,b){b.prototype=h.fixJson(h.clone(a),!0)};d.prototype.writeThumbnail=function(a,b){b.thumbnail=h.fixJson(h.clone(a))};e([c.property({json:{write:!0}})],d.prototype,
"name",void 0);e([c.property({json:{write:!0}})],d.prototype,"description",void 0);e([c.property({json:{read:b.read,write:b.write}})],d.prototype,"drawingTool",void 0);e([c.writer("drawingTool")],d.prototype,"writeDrawingTool",null);e([c.property({json:{write:!0}})],d.prototype,"prototype",void 0);e([c.writer("prototype")],d.prototype,"writePrototype",null);e([c.property({json:{write:!0}})],d.prototype,"thumbnail",void 0);e([c.writer("thumbnail")],d.prototype,"writeThumbnail",null);return d=e([c.subclass("esri.layers.support.FeatureTemplate")],
d)}(c.declared(g))})},"esri/layers/support/FeatureType":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./domains ./FeatureTemplate".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function g(b){b=a.call(this,b)||this;b.id=null;b.name=null;b.domains=null;b.templates=null;return b}k(g,a);g.prototype.readDomains=function(a){var b={},d;for(d in a)if(a.hasOwnProperty(d)){var e=
a[d];switch(e.type){case "range":b[d]=c.RangeDomain.fromJSON(e);break;case "codedValue":b[d]=c.CodedValueDomain.fromJSON(e);break;case "inherited":b[d]=c.InheritedDomain.fromJSON(e)}}return b};g.prototype.writeDomains=function(a,b){var c={},e;for(e in a)a.hasOwnProperty(e)&&(c[e]=a[e]&&a[e].toJSON());d.fixJson(c);b.domains=c};g.prototype.readTemplates=function(a){return a&&a.map(function(a){return new b(a)})};g.prototype.writeTemplates=function(a,b){b.templates=a&&a.map(function(a){return a.toJSON()})};
e([h.property({json:{write:!0}})],g.prototype,"id",void 0);e([h.property({json:{write:!0}})],g.prototype,"name",void 0);e([h.property({json:{write:!0}})],g.prototype,"domains",void 0);e([h.reader("domains")],g.prototype,"readDomains",null);e([h.writer("domains")],g.prototype,"writeDomains",null);e([h.property({json:{write:!0}})],g.prototype,"templates",void 0);e([h.reader("templates")],g.prototype,"readTemplates",null);e([h.writer("templates")],g.prototype,"writeTemplates",null);return g=e([h.subclass("esri.layers.support.FeatureType")],
g)}(h.declared(g))})},"esri/layers/support/LabelClass":function(){define("../../core/date ../../core/JSONSupport ../../core/lang ../../core/kebabDictionary dojo/number ./LabelExpressionInfo ./labelUtils ./types ../../support/arcadeUtils ../../arcade/Feature ../../symbols/support/jsonUtils ../../symbols/support/typeUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n){function p(a){a=(a=b.createSyntaxTree(a))&&a.body&&a.body[0]&&a.body[0].body&&a.body[0].body.body;if(!a||1!==a.length)return null;a="ExpressionStatement"===
a[0].type&&a[0].expression;if(!a||"MemberExpression"!==a.type)return null;var c=a.object;if(!c||"Identifier"!==c.type||"$feature"!==c.name)return null;a=a.property;if(!a)return null;switch(a.type){case "Literal":return a.value;case "Identifier":return a.name}return null}function q(a){return a?"service"===a.origin?!1:!a.layer||!c.isOfType(a.layer,"map-image"):!0}e=e({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",
esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",
esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",
esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});var r=new a,t=f.createSubclass({declaredClass:"esri.layers.support.LabelClass",properties:{name:{type:String,value:null,json:{write:!0}},labelExpression:{type:String,value:null,json:{read:function(a,b,c,d){b=b.labelExpressionInfo;if(!b||!b.value&&!b.expression)return a},write:{allowNull:!0,writer:function(a,b,c,d){this.labelExpressionInfo&&q(d)&&(null!=this.labelExpressionInfo.value?a=this._templateStringToSql(this.labelExpressionInfo.value):
null!=this.labelExpressionInfo.expression&&(d=p(this.labelExpressionInfo.expression))&&(a="["+d+"]"));null!=a&&(b[c]=a)}}}},labelExpressionInfo:{value:null,type:d,json:{write:{overridePolicy:function(a,b,c){return q(c)?{allowNull:!0}:{enabled:!1}},writer:function(a,b,c,e){if(null==a&&null!=this.labelExpression&&q(e))a=new d({expression:this.getLabelExpressionArcade()});else if(!a)return;a=a.toJSON(e);a.expression&&(b[c]=a)}}}},labelPlacement:{type:e.apiValues,value:null,json:{type:e.jsonValues,read:e.read,
write:e.write}},maxScale:{type:Number,value:0,json:{write:function(a,b){if(a||this.minScale)b.maxScale=a}}},minScale:{type:Number,value:0,json:{write:function(a,b){if(a||this.maxScale)b.minScale=a}}},requiredFields:{readOnly:!0,dependsOn:["labelExpression","labelExpressionInfo","where"],get:function(){var a=Object.create(null);this._collectRequiredFields(a);return Object.keys(a)}},symbol:{value:null,types:n.labelTypes,json:{origins:{"web-scene":{read:l.read,write:{target:{symbol:{types:n.labelTypes3D}},
writer:l.writeTarget}}},read:l.read,write:l.writeTarget}},useCodedValues:{type:Boolean,value:null,json:{write:!0}},where:{type:String,value:null,json:{write:!0}}},getLabelExpression:function(){var a={expression:"",type:"none"};this.labelExpressionInfo?this.labelExpressionInfo.value?(a.expression=this.labelExpressionInfo.value,a.type="conventional"):this.labelExpressionInfo.expression&&(a.expression=this.labelExpressionInfo.expression,a.type="arcade"):null!=this.labelExpression&&(a.expression=this._sqlToTemplateString(this.labelExpression),
a.type="conventional");return a},getLabelExpressionArcade:function(){var a=this.getLabelExpression();if(!a)return null;switch(a.type){case "conventional":return h.convertTemplatedStringToArcade(a.expression);case "arcade":return a.expression}return null},getOptions:function(a){a={spatialReference:a};var c=this.labelExpressionInfo;if(c){var d=c.expression;d&&!c.value&&(a.hasArcadeExpression=!0,a.compiledArcadeFunc=b.createFunction(d))}return a},getLabelExpressionSingleField:function(){var a=this.getLabelExpression();
if(!a)return null;switch(a.type){case "conventional":return(a=a.expression.match(w))&&a[1].trim()||null;case "arcade":return p(a.expression)}return null},clone:function(){return new t({labelExpression:this.labelExpression,labelExpressionInfo:k.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:this.symbol.clone(),where:this.where,useCodedValues:this.useCodedValues})},_collectRequiredFields:function(a){this._collectLabelExpressionRequiredFields(this.getLabelExpression(),
a);this._collectWhereRequiredFields(this.where,a)},_sqlToTemplateString:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_templateStringToSql:function(a){return a.replace(/\{/g,"[").replace(/\}/g,"]")},_collectWhereRequiredFields:function(a,b){null!=a&&(a=a.split(" "),3===a.length&&(b[a[0]]=!0),7===a.length&&(b[a[0]]=!0,b[a[4]]=!0))},_collectLabelExpressionRequiredFields:function(a,c){"arcade"===a.type?b.extractFieldNames(a.expression).forEach(function(a){c[a]=!0}):(a=a.expression.match(/{[^}]*}/g))&&
a.forEach(function(a){c[a.slice(1,-1)]=!0})}});t.evaluateWhere=function(a,b){var c=function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1};try{if(null==a)return!0;var d=a.split(" ");if(3===d.length)return c(b[d[0]],d[1],d[2]);if(7===d.length){var e=c(b[d[0]],d[1],d[2]),h=d[3],g=c(b[d[4]],d[5],d[6]);switch(h){case "AND":return e&&
g;case "OR":return e||g}}return!1}catch(C){console.log("Error.: can't parse \x3d "+a)}};t.buildLabelText=function(a,c,d,e){var h="";if(e&&e.hasArcadeExpression)e.compiledArcadeFunc&&(r.repurposeFromGraphicLikeObject(c.geometry,c.attributes,{fields:d}),a=b.executeFunction(e.compiledArcadeFunc,{vars:{$feature:r},spatialReference:e.spatialReference}),null!=a&&(h=a.toString()));else var g=c&&c.attributes||{},h=a.replace(/{[^}]*}/g,function(a){return t.formatField(a.slice(1,-1),a,g,d,e)});return h};t.formatField=
function(a,b,c,d,e){var h=a.toLowerCase();for(a=0;a<d.length;a++)if(d[a].name.toLowerCase()===h){b=c[d[a].name];var l=d[a].domain;if(l&&"object"===typeof l){if("codedValue"==l.type)for(c=0;c<l.codedValues.length;c++)l.codedValues[c].code==b&&(b=l.codedValues[c].name);else"range"==l.type&&l.minValue<=b&&b<=l.maxValue&&(b=l.name);break}l=d[a].type;"date"==l?(l=m.fromJSON(e&&e.dateFormat||"shortDate"),(l="DateFormat"+m.getFormat(l))&&(b=k.substitute({myKey:b},"{myKey:"+l+"}"))):("integer"==l||"small-integer"==
l||"long"==l||"double"==l)&&e&&e.numberFormat&&e.numberFormat.digitSeparator&&e.numberFormat.places&&(b=g.format(b,{places:e.numberFormat.places}))}return null==b?"":b};var w=/^\s*\{([^}]+)\}\s*$/i;return t})},"esri/layers/support/LabelExpressionInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./labelUtils".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(){var a=
null!==c&&c.apply(this,arguments)||this;a.value=null;a.expression=null;return a}k(b,c);a=b;b.prototype.readExpression=function(a,b){return b.value?h.convertTemplatedStringToArcade(b.value):a};b.prototype.writeExpression=function(a,b,c){null!=this.value&&(a=h.convertTemplatedStringToArcade(this.value));b[c]=a};b.prototype.clone=function(){return new a({value:this.value,expression:this.expression})};var a;e([d.property({json:{read:!1,write:!1}})],b.prototype,"value",void 0);e([d.property({json:{write:{allowNull:!0}}})],
b.prototype,"expression",void 0);e([d.reader("expression",["expression","value"])],b.prototype,"readExpression",null);e([d.writer("expression")],b.prototype,"writeExpression",null);return b=a=e([d.subclass("esri.layers.support.LabelExpressionInfo")],b)}(d.declared(g))})},"esri/layers/support/labelUtils":function(){define(["require","exports","../../core/string"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});var e=/__begin__/ig,g=/__end__/ig,d=/^__begin__/i,h=/__end__$/i;f.convertTemplatedStringToArcade=
function(c){c?(c=k.replace(c,function(b,a){return'__begin__$feature["'+a+'"]__end__'}),c=d.test(c)?c.replace(d,""):'"'+c,c=h.test(c)?c.replace(h,""):c+'"',c=c.replace(e,'" + ').replace(g,' + "')):c='""';return c}})},"esri/core/string":function(){define(["require","exports","./object"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.replace=function(e,g,d){void 0===d&&(d=/\{([^\}]+)\}/g);return e.replace(d,"function"===typeof g?g:function(d,c){return k.getDeepValue(c,g)})}})},"esri/layers/support/types":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.isOfType=function(k,e){k=k.constructor._meta;if(!k||!k.bases)return!1;k=k.bases;var g=Array.isArray(e);return k.some(function(d){d=d.__accessorMetadata__;if(!d)return!1;d=d.properties;if(!d||!d.type||!d.type.value)return!1;d=d.type.value;return g?-1!==e.indexOf(d):d===e})}})},"esri/layers/support/labelingInfo":function(){define(["require","exports","./LabelClass"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});
var e=/\[([^\[\]]+)\]/gi;f.reader=function(g,d,h){var c=this;return g?g.map(function(b){var a=new k;a.read(b,h);if(a.labelExpression){var g=d.fields||d.layerDefinition&&d.layerDefinition.fields||c.fields;a.labelExpression=a.labelExpression.replace(e,function(a,b){a:if(g){a=b.toLowerCase();for(var c=0;c<g.length;c++){var d=g[c].name;if(d.toLowerCase()===a){b=d;break a}}}return"["+b+"]"})}return a}):null}})},"esri/layers/support/layerSourceUtils":function(){define(["require","exports","../../core/kebabDictionary",
"../../core/lang"],function(m,f,k,e){function g(a){return null!=a&&a.hasOwnProperty("mapLayerId")}function d(a){return null!=a&&a.hasOwnProperty("dataSource")}function h(a){if(!a)return a;g(a)&&(a.type=f.MAPLAYER);if(d(a)&&(a.type=f.DATALAYER,!a.dataSource.type)){var b=a.dataSource;b.workspaceId?b.type=b.gdbVersion?"table":b.query||b.oidFields?"query-table":"raster":b.leftTableKey&&b.rightTableKey&&b.leftTableSource&&b.rightTableSource&&(b.type="join-table",b.leftTableSource=h(b.leftTableSource),
b.rightTableSource=h(b.rightTableSource))}return a}function c(b){var d={};if(b.type===f.MAPLAYER)d.mapLayerId=b.mapLayerId,b.gdbVersion&&(d.gdbVersion=b.gdbVersion);else if(b.type===f.DATALAYER){b.fields&&(d.fields=b.fields);var h;h=b.dataSource;var g;switch(h.type){case "table":g={dataSourceName:h.dataSourceName,workspaceId:h.workspaceId,gdbVersion:h.gdbVersion};break;case "query-table":g={geometryType:a.toJSON(h.geometryType),workspaceId:h.workspaceId,query:h.query,oidFields:h.oidFields,spatialReference:h.spatialReference};
break;case "join-table":g={leftTableSource:c(h.leftTableSource),rightTableSource:c(h.rightTableSource),leftTableKey:h.leftTableKey,rightTableKey:h.rightTableKey,joinType:p.toJSON(h.joinType)};break;case "raster":g={workspaceId:h.workspaceId,dataSourceName:h.dataSourceName}}g.type=n.toJSON(h.type);h=e.fixJson(g);d.dataSource=h}d.type=l.toJSON(b.type);return e.fixJson(d)}function b(c){var d={};if(l.fromJSON(c.type)===f.MAPLAYER)d.mapLayerId=c.mapLayerId,c.gdbVersion&&(d.gdbVersion=c.gdbVersion);else if(l.fromJSON(c.type)===
f.DATALAYER){c.fields&&(d.fields=c.fields);var h;h=c.dataSource;var g;switch(h.type){case "table":g={dataSourceName:h.dataSourceName,workspaceId:h.workspaceId,gdbVersion:h.gdbVersion};break;case "queryTable":g={geometryType:a.fromJSON(h.geometryType),workspaceId:h.workspaceId,query:h.query,oidFields:h.oidFields,spatialReference:h.spatialReference};break;case "joinTable":g={leftTableSource:b(h.leftTableSource),rightTableSource:b(h.rightTableSource),leftTableKey:h.leftTableKey,rightTableKey:h.rightTableKey,
joinType:p.fromJSON(h.joinType)};break;case "raster":g={workspaceId:h.workspaceId,dataSourceName:h.dataSourceName}}g.type=n.fromJSON(h.type);h=e.fixJson(g);d.dataSource=h}d.type=l.fromJSON(c.type);return e.fixJson(d)}Object.defineProperty(f,"__esModule",{value:!0});f.MAPLAYER="map-layer";f.DATALAYER="data-layer";var a=k({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),l=k({mapLayer:f.MAPLAYER,
dataLayer:f.DATALAYER}),n=k({joinTable:"join-table",queryTable:"query-table"}),p=k({esriLeftOuterJoin:"left-outer-join",esriLeftInnerJoin:"left-inner-join"});f.isMapLayerSource=g;f.isDataLayerSource=d;f.castSource=h;f.sourceToJSON=c;f.sourceFromJSON=b})},"esri/layers/support/Relationship":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){var c=d({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"});return function(b){function a(a){a=b.call(this,a)||this;a.cardinality=null;a.id=null;a.keyField=null;a.name=null;a.relatedTableId=null;return a}k(a,b);e([h.property({json:{read:c.read,write:c.write}})],a.prototype,"cardinality",void 0);e([h.property({json:{read:!0,write:!0}})],a.prototype,"id",void 0);e([h.property({json:{read:!0,write:!0}})],
a.prototype,"keyField",void 0);e([h.property({json:{read:!0,write:!0}})],a.prototype,"name",void 0);e([h.property({json:{read:!0,write:!0}})],a.prototype,"relatedTableId",void 0);return a=e([h.subclass("esri.layers.support.Relationship")],a)}(h.declared(g))})},"esri/renderers/support/styleUtils":function(){define(["require","exports","../../core/promiseUtils","../../core/Warning"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.loadStyleRenderer=function(g,d){var h=g&&g.getAtOrigin&&
g.getAtOrigin("renderer",d.origin);return h&&"unique-value"===h.type&&h.styleOrigin?h.populateFromStyle().catch(function(c){d&&d.messages&&d.messages.push(new e("renderer:style-reference","Failed to create unique value renderer from style reference: "+c.message,{error:c,context:d}));g.clear("renderer",d.origin)}).then(function(){return null}):k.resolve(null)}})},"esri/renderers/support/typeUtils":function(){define("require exports ../ClassBreaksRenderer ../HeatmapRenderer ../Renderer ../SimpleRenderer ../UniqueValueRenderer".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});f.types={key:"type",base:g,typeMap:{heatmap:e,simple:d,"unique-value":h,"class-breaks":k}}})},"esri/tasks/support/AttachmentQuery":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,a)||this;a.attachmentTypes=
null;a.definitionExpression=null;a.globalIds=null;a.num=null;a.objectIds=null;a.size=null;a.start=null;return a}k(b,c);a=b;b.prototype.writeStart=function(a,b,c){b.resultOffset=this.start;b.resultRecordCount=this.num||10};b.prototype.clone=function(){return new a(d.clone({attachmentTypes:this.attachmentTypes,definitionExpression:this.definitionExpression,globalIds:this.globalIds,num:this.num,objectIds:this.objectIds,size:this.size,start:this.start}))};var a;e([h.property({type:[String],json:{write:!0}})],
b.prototype,"attachmentTypes",void 0);e([h.property({type:String,json:{write:!0}})],b.prototype,"definitionExpression",void 0);e([h.property({type:[Number],json:{write:!0}})],b.prototype,"globalIds",void 0);e([h.property({type:Number,json:{read:{source:"resultRecordCount"}}})],b.prototype,"num",void 0);e([h.property({type:[Number],json:{write:!0}})],b.prototype,"objectIds",void 0);e([h.property({type:[Number],json:{write:!0}})],b.prototype,"size",void 0);e([h.property({type:Number,json:{read:{source:"resultOffset"}}})],
b.prototype,"start",void 0);e([h.writer("start"),h.writer("num")],b.prototype,"writeStart",null);return b=a=e([h.subclass("esri.tasks.support.AttachmentQuery")],b)}(h.declared(g))})},"esri/tasks/support/RelationshipQuery":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this,
a)||this;a.definitionExpression=null;a.gdbVersion=null;a.geometryPrecision=void 0;a.historicMoment=null;a.maxAllowableOffset=void 0;a.objectIds=null;a.outFields=null;a.outSpatialReference=null;a.relationshipId=void 0;a.returnGeometry=!1;a.source=null;return a}k(a,b);d=a;a.prototype._writeHistoricMoment=function(a,b){b.historicMoment=a&&a.getTime()};a.prototype.clone=function(){return new d(h.clone({definitionExpression:this.definitionExpression,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,
historicMoment:this.historicMoment&&this.historicMoment.getTime(),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,source:this.source}))};var d;e([c.property({type:String,json:{write:!0}})],a.prototype,"definitionExpression",void 0);e([c.property({type:String,json:{write:!0}})],a.prototype,"gdbVersion",void 0);e([c.property({type:Number,json:{write:!0}})],
a.prototype,"geometryPrecision",void 0);e([c.property({type:Date})],a.prototype,"historicMoment",void 0);e([c.writer("historicMoment")],a.prototype,"_writeHistoricMoment",null);e([c.property({type:Number,json:{write:!0}})],a.prototype,"maxAllowableOffset",void 0);e([c.property({type:[Number],json:{write:!0}})],a.prototype,"objectIds",void 0);e([c.property({type:[String],json:{write:!0}})],a.prototype,"outFields",void 0);e([c.property({type:g.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],
a.prototype,"outSpatialReference",void 0);e([c.property({json:{write:!0}})],a.prototype,"relationshipId",void 0);e([c.property({json:{write:!0}})],a.prototype,"returnGeometry",void 0);e([c.property({json:{write:!0}})],a.prototype,"source",void 0);return a=d=e([c.subclass("esri.tasks.support.RelationshipQuery")],a)}(c.declared(d))})},"esri/layers/ImageryLayer":function(){define("require ../core/lang ../core/promiseUtils ./Layer ./mixins/ArcGISImageService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/RefreshableLayer ./support/commonProperties".split(" "),
function(m,f,k,e,g,d,h,c,b,a){var l={canvas2D:"2d",webGL:"webgl",expWebGL:"experimental-webgl",webGL2:"webgl2",expWebGL2:"experimental-webgl2"};return e.createSubclass([g,d,h,c,b],{declaredClass:"esri.layers.ImageryLayer",normalizeCtorArgs:function(a,b){return"string"===typeof a?f.mixin({},{url:a},b):a},load:function(){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]}).always(this._fetchService.bind(this)))},properties:{drawMode:!0,drawType:{value:l.canvas2D,cast:function(a){return a in
l?a:l.canvas2D}},legendEnabled:{json:{read:{source:["showLegend"],reader:function(a,b){return null!=b.showLegend?b.showLegend:!0}},write:function(a,b){b.showLegend=!!a}}},operationalLayerType:"ArcGISImageServiceLayer",popupEnabled:a.popupEnabled,pixelFilter:null,type:{value:"imagery",json:{read:!1}}},redraw:function(){this.emit("redraw")},importLayerViewModule:function(a){switch(a.type){case "2d":return k.create(function(a){m(["../views/2d/layers/ImageryLayerView2D"],a)});case "3d":return k.create(function(a){m(["../views/3d/layers/ImageryLayerView3D"],
a)})}}})})},"esri/layers/mixins/ArcGISImageService":function(){define("./ArcGISService ../support/Field ../support/Raster ../support/PixelBlock ../support/MosaicRule ../support/RasterFunction ../support/DimensionalDefinition ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../tasks/QueryTask ../../tasks/ImageServiceIdentifyTask ../../tasks/support/ImageServiceIdentifyParameters ../../request ../../Graphic ../../PopupTemplate ../../core/lang ../../core/Accessor ../../core/kebabDictionary ../../core/promiseUtils ../../core/Logger".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){x=x({S8:"s8",S16:"s16",S32:"s32",U8:"u8",U16:"u16",U32:"u32",F32:"f32",F64:"f64"});var y=z.getLogger("esri.layers.mixins.ArcGISImageService");u=u.createSubclass({properties:{layer:{},mosaicRule:{dependsOn:["layer.mosaicRule"],get:function(){return this.get("layer.mosaicRule")||null}},version:{value:0,dependsOn:"layer.bandIds layer.format layer.compressionQuality layer.compressionTolerance layer.interpolation layer.noData layer.noDataInterpretation layer.mosaicRule layer.renderingRule layer.adjustAspectRatio layer.pixelFilter".split(" "),
get:function(){var a=this.layer;a.bandIds;a.format;a.compressionQuality;a.compressionTolerance;a.interpolation;a.noData;a.noDataInterpretation;a.mosaicRule;a.renderingRule;a.adjustAspectRatio;a.pixelFilter;return this._get("version")+1}}},toJSON:function(){var a=this.layer;return{bandIds:a.bandIds?a.bandIds.join(","):null,format:a.format,compressionQuality:a.compressionQuality,compressionTolerance:a.compressionTolerance,interpolation:a.interpolation,noData:a.noData,noDataInterpretation:a.noDataInterpretation,
mosaicRule:this.mosaicRule?JSON.stringify(this.mosaicRule.toJSON()):null,renderingRule:a.renderingRule?JSON.stringify(a.renderingRule.toJSON()):null,adjustAspectRatio:a.adjustAspectRatio}}});return m.createSubclass({declaredClass:"esri.layers.mixins.ArcGISImageService",getDefaults:function(){return w.mixin(this.inherited(arguments),{exportImageServiceParameters:{layer:this}})},_raster:null,properties:{adjustAspectRatio:{},bandCount:{},bandIds:{type:[Number],json:{write:!0}},capabilities:{json:{read:function(a){return a&&
a.split(",").map(function(a){return a.trim()})}}},compressionQuality:{type:Number,json:{write:!0}},compressionTolerance:.01,copyright:{json:{read:{source:["copyrightText"],reader:function(a,b){return b.copyrightText}}}},definitionExpression:{get:function(){return this.mosaicRule?this.mosaicRule.where:null},set:function(a){var b=this.mosaicRule||new g;b.where=a;this._set("mosaicRule",b)},json:{read:{source:["definitionExpression","layerDefinition.definitionExpression"],reader:function(a,b){return a||
b.layerDefinition&&b.layerDefinition.definitionExpression||void 0}}}},domainFields:{value:null,type:[f],dependsOn:["fields"],get:function(){return this.fields&&this.fields.filter(function(a){return null!=a.domain})||[]}},exportImageServiceParameters:{readOnly:!0,type:u},fields:{type:[f]},fullExtent:{type:c,json:{read:{source:["extent"],reader:function(a,b){return c.fromJSON(b.extent)}}}},format:{type:String,dependsOn:["pixelFilter"],get:function(){return null!=this.pixelFilter?"lerc":"jpgpng"},json:{write:!0}},
hasRasterAttributeTable:{},hasMultidimensions:{},imageMaxHeight:{value:4100,json:{origins:{service:{read:{source:"maxImageHeight"}}}}},imageMaxWidth:{value:15E3,json:{origins:{service:{read:{source:"maxImageWidth"}}}}},interpolation:{type:String,json:{write:!0}},mosaicRule:{value:null,type:g,json:{origins:{service:{read:{source:["defaultMosaicMethod"],reader:function(a,b){return g.fromJSON(b)}}}},write:!0}},multidimensionalInfo:null,noData:{type:Number,json:{write:!0}},noDataInterpretation:{type:String,
json:{write:!0}},objectIdField:{json:{read:{source:["fields"],reader:function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a}}}},pixelFilter:{},pixelType:{type:String,value:null,json:{read:x.read,write:x.write}},pixelSizeX:{value:0},pixelSizeY:{value:0},popupTemplate:{value:null,type:t,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}},queryTask:{readOnly:!0,dependsOn:["url"],get:function(){return new l({url:this.url})}},renderer:{json:{origins:{service:{read:!1}},
read:{source:"layerDefinition.drawingInfo.renderer",reader:function(){y.warn("Client side renderer configuration on ImageryLayer (id: "+this.id+", title: "+this.title+") is not yet supported. Visualization of the layer data may differ from what is expected.")}},write:!1}},rasterAttributeTable:null,rasterAttributeTableFieldPrefix:"Raster.",rasterFields:{value:null,dependsOn:["fields","rasterAttributeTable","rasterAttributeTableFieldPrefix"],get:function(){var a=this.rasterAttributeTableFieldPrefix,
b={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"},c=this.fields?w.clone(this.fields):[],d=c.length;c[d]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"};if(this.capabilities&&-1<this.capabilities.indexOf("Catalog")||this.fields&&0<this.fields.length)c[d+1]=b;null==this.pixelFilter||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==
this.serviceDataType||(c[d+2]={name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"},c[d+3]={name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"});(b=this.rasterAttributeTable&&this.rasterAttributeTable.fields||null)&&0<b.length&&(b=b.filter(function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}).map(function(b){var c=w.clone(b);c.name=a+b.name;return c}),c=c.concat(b));return c}},renderingRule:{value:null,type:d,json:{origins:{service:{read:{source:["rasterFunctionInfos"],
reader:function(a,b){a=b.rasterFunctionInfos;return b.renderingRule||a&&a.length&&"None"!==a[0].name?d.fromJSON(b.renderingRule||{rasterFunctionInfos:b.rasterFunctionInfos}):null}}}},write:!0}},serviceDataType:{},spatialReference:{value:null,readOnly:!0,json:{read:{source:["extent"],reader:function(b,c){return(b=c.extent&&c.extent.spatialReference)&&a.fromJSON(b)}}}},url:{},version:{value:null,readOnly:!0,json:{read:{source:["currentVersion","fields","timeInfo"],reader:function(a,b){(a=b.currentVersion)||
(a=b.hasOwnProperty("fields")||b.hasOwnProperty("objectIdField")||b.hasOwnProperty("timeInfo")?10:9.3);return a}}}}},applyFilter:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);return a},fetchImage:function(a,b,c,d){d=d||{};if(null==this._raster||null==a||null==b||null==c)return v.reject(Error("Insufficient parameters for requesting an image. A valid extent, width and height values are required."));a={imageServiceParameters:this.getExportImageServiceParameters(a,b,c,d),
nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,requestAsImageElement:d.requestAsImageElement&&!this.pixelFilter||!1};return this._raster.read(a)},fetchKeyProperties:function(){return q(this.parsedUrl.path+"/keyProperties",{query:w.mixin({f:"json"}),responseType:"json"}).then(function(a){return a.data})},getExportImageServiceParameters:function(a,b,c,d){d=(d=(a=a.clone().shiftCentralMeridian())&&a.spatialReference)&&(d.wkid||JSON.stringify(d.toJSON()));return w.mixin({bbox:a&&a.xmin+","+
a.ymin+","+a.xmax+","+a.ymax,bboxSR:d,imageSR:d,size:b+","+c},this.exportImageServiceParameters.toJSON())},queryRasters:function(a){return this.queryTask.execute(a)},queryVisibleRasters:function(a,c){this._visibleRasters=[];var d=!1,e=this.popupTemplate;e&&e.fieldInfos&&0<e.fieldInfos.length&&(d=1<e.fieldInfos.length||"raster.servicepixelvalue"!==e.fieldInfos[0].toLowerCase());e&&!d&&this.rasterFields&&(d=this.rasterFields.some(function(a){return(a=a&&a.name?a.name.toLowerCase():null)&&"raster.servicepixelvalue"!==
a&&(e.title&&-1<e.title.toLowerCase().indexOf(a)||e.content&&-1<e.content.toLowerCase().indexOf(a))}));var h,g,l;c.layerView&&c.layerView.view&&(g=c.layerView.view,"2d"===g.type&&(g=g.state),h=g.spatialReference.clone(),(g=g.resolution)&&(l=new b(.5*g,.5*g,h)),g=h.equals(this.spatialReference));a=new p({geometry:a.geometry,returnCatalogItems:d,timeExtent:a.timeExtent,mosaicRule:this.mosaicRule||null,renderingRule:this.renderingRule||null,returnGeometry:g,outSpatialReference:h,pixelSize:l});return(new n({url:this.url})).execute(a).then(function(a){return this._processVisibleRastersResponse(a,
c)}.bind(this)).catch(function(a){throw Error("Error querying for visible rasters");})},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_fetchService:function(){return v.resolve().then(function(){return this.resourceInfo||q(this.parsedUrl.path,{query:w.mixin({f:"json"},this.parsedUrl.query),responseType:"json"})}.bind(this)).then(function(a){a.ssl&&
(this.url=this.url.replace(/^http:/i,"https:"));this.read(a.data,{origin:"service",url:this.parsedUrl});this._raster=new k({url:this.url})}.bind(this)).then(function(){if(10<this.version&&this.hasRasterAttributeTable)return q(this.parsedUrl.path+"/rasterAttributeTable",{query:{f:"json"},responseType:"json"}).then(function(a){(a=a.data)&&a.features&&a.fields&&this.read({rasterAttributeTable:a},{origin:"service",url:this.parsedUrl})}.bind(this))}.bind(this)).then(function(){if(10.3<=this.version&&this._isScientificData()&&
this.hasMultidimensions)return q(this.parsedUrl.path+"/multiDimensionalInfo",{query:{f:"json"},responseType:"json"}).then(function(a){(a=a.data)&&a.multidimensionalInfo&&(this._updateMultidimensionalDefinition(a.multidimensionalInfo),this.multidimensionalInfo=a.multidimensionalInfo)}.bind(this))}.bind(this))},_updateMultidimensionalDefinition:function(a){var b=a.variables[0].dimensions,c;a=[];for(c in b)if(b.hasOwnProperty(c)){var d=b[c],e=!0,l=d.extent,k=[l[0]];d.hasRanges&&!0===d.hasRanges?(e=!1,
k=[d.values[0]]):"stdz"===d.name.toLowerCase()&&Math.abs(l[1])<=Math.abs(l[0])&&(k=[l[1]]);a.push(new h({variableName:"",dimensionName:b[c].name,isSlice:e,values:k}))}0<a.length&&(this.mosaicRule=this.mosaicRule||new g,c=this.mosaicRule.multidimensionalDefinition,!c||c&&0>=c.length)&&(this.mosaicRule.multidimensionalDefinition=a)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=a.extent.clone());a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=
a.clone();return b},_processVisibleRastersResponse:function(a,b){var d=a.value,e,h,g=0,l=this.objectIdField,k,f=a.catalogItems&&a.catalogItems.features&&a.catalogItems.features.length||0;if(f){var m=0,n,p;n=0;h=[f];e=[f];k=[f];for(g=0;g<f;g++)-1<a.properties.Values[g].toLowerCase().indexOf("nodata")&&n++;n=f-n;for(g=0;g<f;g++)p=-1<a.properties.Values[g].toLowerCase().indexOf("nodata")?n++:m++,h[p]=a.catalogItems.features[g],e[p]=a.properties.Values[g],k[p]=h[p].attributes[l]}this._visibleRasters=
[];g=-1<d.toLowerCase().indexOf("nodata");!d||h||g||(l="ObjectId",h=[],a=new r(new c(this.fullExtent),null,{ObjectId:0}),a.sourceLayer=this,h.push(a));l=[];if(!h)return l;k=b&&b.returnDomainValues||!1;g=0;for(b=h.length;g<b;g++)a=h[g],a.sourceLayer=this,d&&(f=d,e&&e.length>=g&&(f=e[g],f=f.replace(/ /gi,", ")),a.attributes["Raster.ItemPixelValue"]=f,a.attributes["Raster.ServicePixelValue"]=d,this._updateFeatureWithMagDirValues(a,f),this._updateFeatureWithRasterAttributeTableValues(a,f)),k&&this._updateFeatureWithDomainValues(a),
l.push(a);return l},_updateFeatureWithRasterAttributeTableValues:function(a,b){var c=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(c&&!(1>c.length)&&this.rasterAttributeTableFieldPrefix){var d=null;c.forEach(function(a){a&&a.attributes&&(a.attributes.Value==b||a.attributes.VALUE==b)&&(d=a)});if(d){var c={},e,h;for(e in d.attributes)d.attributes.hasOwnProperty(e)&&(h=this.rasterAttributeTableFieldPrefix+e,c[h]=d.attributes[e]);a.attributes=w.mixin(a.attributes,c)}}},_updateFeatureWithMagDirValues:function(a,
b){if(this.pixelFilter&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)){b=b.replace(" ","").split(",");var d=new e({height:1,width:1,pixelType:"f32",pixels:[],statistics:[]});b.forEach(function(a){d.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:d,extent:new c(0,0,0,0,this.spatialReference)});a.attributes["Raster.Magnitude"]=d.pixels[0][0];a.attributes["Raster.Direction"]=
d.pixels[1][0]}},_updateFeatureWithDomainValues:function(a){var b=this.domainFields;null!=b&&b.forEach(function(b){if(b){var c=a.attributes[b.name];null!=c&&(c=this._findMatchingDomainValue(b.domain,c),null!=c&&(a.attributes[b.name]=c))}},this)},_findMatchingDomainValue:function(a,b){if(a=a&&a.codedValues){var c;a.some(function(a){return a.code===b?(c=a.name,!0):!1});return c}}})})},"esri/layers/support/Raster":function(){define("../../core/Accessor ../../core/lang ../../core/urlUtils ../../core/promiseUtils ../../request ../../geometry/Extent ../../geometry/SpatialReference ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/JpgPlus ./rasterFormats/Png ./rasterFormats/Raw".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){return m.createSubclass({declaredClass:"esri.layers.support.Raster",validPixelTypes:"u1 u2 u4 u8 u16 u32 s8 s16 s32 f32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq".split(" "),properties:{parsedUrl:{readOnly:!0,dependsOn:["url"],get:function(){return this.url?k.urlToObject(this.url):null}},url:null},read:function(a){if(!a.imageServiceParameters||!a.nBands)return e.reject(Error("Insufficient parameters to read data"));var b=f.clone(a.imageServiceParameters),
c=a.nBands,d=a.pixelType||"f32";a=a.requestAsImageElement;-1>=this.validPixelTypes.indexOf(d.toUpperCase())&&(b.pixelType="f32");b.format=b.format||"lerc";-1>=this.validFormats.indexOf(b.format.toLowerCase())&&(b.format="lerc");this._prepareGetImageParameters(b);var h=f.clone(b);this._cleanupRequestParams(h);return this._requestArrayBuffer(b,h,c,d,a)},_requestArrayBuffer:function(a,b,c,d,h){return g(this.parsedUrl.path+"/exportImage",{responseType:"array-buffer",query:f.mixin(b,{f:"image"})}).then(function(b){b=
b.data;if(!this._isDataValid(b))return b=Error(String.fromCharCode.apply(null,new Uint8Array(b))),e.reject(b);var g=a.format.toUpperCase(),l=g;"BSQ"!==l&&"BIP"!==l&&(l=this._getFormat(b));if(-1>=this.validFormats.indexOf(l.toLowerCase()))return e.reject(Error("Cannot decode the pixelBlock. Unsupported Format: "+l));if(!("PNG"!==g&&"JPGPNG"!==g||"PNG"!==l&&"JPEG"!==l)&&h){b=new Blob([b],{type:"image/"+("PNG"===l?"png":"jpeg")});var k=URL.createObjectURL(b),f=new Image;b=e.createResolver();g=b.promise;
f.addEventListener("load",b);f.addEventListener("error",b.reject);f.src=k;return g.then(function(){URL.revokeObjectURL(k);return{imageElement:f,params:a}},function(a){URL.revokeObjectURL(k);return e.reject(Error("Failed to load raster"))})}try{return{pixelData:{pixelBlock:this._decodePixelBlock(b,{width:a.width,height:a.height,planes:c,pixelType:d,noDataValue:a.noData,format:l}),extent:a.extent},params:a}}catch(A){return e.reject(A)}}.bind(this))},_prepareGetImageParameters:function(a){if(a.size&&
a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new d(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new h(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw Error("Incorrect Image Dimensions");if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw Error("Incorrect extent");var b=a.extent,c=b.spatialReference.wkid||JSON.stringify(b.spatialReference.toJSON());
delete a._ts;f.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:Date.now()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:a.xmax=a.xmin+d*c/b;return a},_cleanupRequestParams:function(a){if(!a)return a;var b=["width","height","extent"],c;for(c in b)a.hasOwnProperty(b[c])&&delete a[b[c]];return a},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===
a[1]?b="JPEG":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="PNG":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="LERC":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="ERROR");return b},_isDataValid:function(a){a=new Uint8Array(a,0,10);return-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")?!1:!0},_calculateBandStatistics:function(a){var b=Infinity,c=-Infinity,d=a.length,e,h=0;for(e=0;e<
d;e++)h=a[e],b=h<b?h:b,c=h>c?h:c;return{minValue:b,maxValue:c}},_verifyResult:function(a,b){return a&&a.height===b.height&&a.width===b.width?!0:!1},_getPixelTypeAndNoData:function(a){var b=a.noDataValue;a=a.pixelType;var c;"u1"===a||"u2"===a||"u4"===a||"u8"===a?(a="u8",b=Math.pow(2,8)-1,c=Uint8Array):"u16"===a?(b=b||Math.pow(2,16)-1,c=Uint16Array):"u32"===a?(b=b||Math.pow(2,32)-1,c=Uint32Array):"s8"===a?(b=b||0-Math.pow(2,7),c=Int8Array):"s16"===a?(b=b||0-Math.pow(2,15),c=Int16Array):"s32"===a?(b=
b||0-Math.pow(2,31),c=Int32Array):c=Float32Array;return{pixelType:a,pixelDataType:c,noDataValue:b}},_decodePixelBlock:function(a,b){if(!a||!b)throw Error("Cannot decode the pixelBlock. Invalid parameters provided for decoding.");if(!b.height||Math.floor(b.height)!==b.height)throw Error("Cannot decode the pixelBlock. Height is not provided.");if(!b.width||Math.floor(b.width)!==b.width)throw Error("Cannot decode the pixelBlock. Width is not provided.");var d=this._decodeLerc;switch(b.format.toUpperCase()){case "JPEG":d=
this._decodeJpeg;break;case "PNG":d=this._decodePng;break;case "BSQ":d=this._decodeBsq;break;case "BIP":d=this._decodeBip}d=d.bind(this);a=d(a,b);var d=a.statistics||[],e,h;if(0>=d.length)for(e=0;e<a.pixels.length;e++)h=a.pixels[e],d.push(this._calculateBandStatistics(h));return new c({width:b.width,height:b.height,pixels:a.pixels,pixelType:b.pixelType,mask:a.mask,statistics:d})},_decodeJpeg:function(b,c){if(!a)throw Error("The jpeg decoder module is not loaded.");b=(new a).decode(b);if(!this._verifyResult(b,
c))throw Error("Error in decoding the image. The decoded image dimensions are incorrect.");c.width=b.width;c.height=b.height;c.pixelType="U8";return b},_decodePng:function(a,b){if(!l)throw Error("The png decoder module is not loaded.");a=new Uint8Array(a);var c=new l(a);a=new Uint8Array(b.width*b.height*4);c.copyToImageData(a,c.decodePixels());for(var d=c=0,e,d=new Uint8Array(b.width*b.height),c=0;c<b.width*b.height;c++)d[c]=a[4*c+3];for(var h={pixels:[],mask:d},c=0;3>c;c++){e=new Uint8Array(b.width*
b.height);for(d=0;d<b.width*b.height;d++)e[d]=a[4*d+c];h.pixels.push(e)}b.pixelType="U8";return h},_decodeBsq:function(a,b){if(!n)throw Error("The bsq decoder module is not loaded.");var c=this._getPixelTypeAndNoData(b);return n.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:c.pixelDataType,noDataValue:c.noDataValue})},_decodeBip:function(a,b){if(!n)throw Error("The bsq decoder module is not loaded.");var c=this._getPixelTypeAndNoData(b);return n.decodeBIP(a,{bandCount:b.planes,
width:b.width,height:b.height,pixelType:c.pixelDataType,noDataValue:c.noDataValue})},_decodeLerc:function(a,c){var d=this._getPixelTypeAndNoData(c);c.pixelType=d.pixelType;for(var e=0,h,g=0,l=a.byteLength-10,k={pixels:[],statistics:[]};g<l;){var f=b.decode(a,{inputOffset:g,encodedMaskData:h,returnMask:0===e?!0:!1,returnEncodedMask:0===e?!0:!1,returnFileInfo:!0,pixelType:d.pixelDataType,noDataValue:d.noDataValue}),g=f.fileInfo.eofOffset;0===e&&(h=f.encodedMaskData,k.mask=f.maskData);e++;if(!this._verifyResult(f,
c))throw Error("Error in decoding the image. The decoded image dimensions are incorrect.");k.pixels.push(f.pixelData);k.statistics.push({minValue:f.minValue,maxValue:f.maxValue,noDataValue:f.noDataValue})}return k}})})},"esri/layers/support/PixelBlock":function(){define(["../../core/Accessor","../../core/lang"],function(m,f){return m.createSubclass({declaredClass:"esri.layers.support.PixelBlock",normalizeCtorArgs:function(k){if(!k.width||Math.floor(k.width)!==k.width)throw"PixelBlock: incorrect width";
if(!k.height||Math.floor(k.height)!==k.height)throw"PixelBlock: incorrect height";if(!k.pixels||!k.statistics)throw"PixelBlock: pixel data or statistics not present";},properties:{height:null,mask:null,pixels:[],pixelType:null,planes:null,statistics:[],width:null},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(k){if(!k.pixels||!k.statistics)throw"Pixel data or statistics are not present";
if(k.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(k.statistics);this.pixels.push(k.pixels)},getAsRGBA:function(){var k=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(k);break;default:this._fillFrom8Bit(k)}return new Uint8ClampedArray(k)},getAsRGBAFloat:function(){var k=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(k);
return k},clone:function(){var k=new this.constructor;k.width=this.width;k.height=this.height;k.pixelType=this.pixelType;this.mask&&(k.mask=new Uint8Array(this.mask));var e,g;if(this.pixels)for(k.pixels=[],g=this.pixels.length,e=0;e<g;e++)k.pixels[e]=new Float32Array(this.pixels[e]);if(this.statistics)for(k.statistics=[],g=this.statistics.length,e=0;e<g;e++)k.statistics[e]=f.clone(this.statistics[e]);return k},_fillFrom8Bit:function(k){var e=this.pixels,g=this.mask;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var d,h,c;d=h=c=e[0];3<=e.length&&(h=e[1],c=e[2]);var e=new Uint32Array(k),b=this.width*this.height;if(d.length!==b)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(g&&g.length===b)for(k=0;k<b;k++)g[k]&&(e[k]=-16777216|c[k]<<16|h[k]<<8|d[k]);else for(k=0;k<b;k++)e[k]=-16777216|c[k]<<16|h[k]<<8|d[k]},_fillFromNon8Bit:function(k){var e=this.pixels,g=this.mask,d=this.statistics;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var h=1,c=0;d&&0<d.length?(c=d[0].minValue,h=255/(d[0].maxValue-d[0].minValue)):(h=255,"s8"===this.pixelType?(c=-128,h=127):"u16"===this.pixelType?h=65535:"s16"===this.pixelType?(c=-32768,h=32767):"u32"===this.pixelType?h=4294967295:"s32"===this.pixelType?(c=-2147483648,h=2147483647):"f32"===this.pixelType?(c=-3.4*1E39,h=3.4*1E39):"f64"===this.pixelType&&(c=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-c));k=new Uint32Array(k);var d=this.width*this.height,b,a,l;b=e[0];if(b.length!==d)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=e.length)if(a=e[1],l=e[2],g&&g.length===d)for(e=0;e<d;e++)g[e]&&(k[e]=-16777216|(l[e]-c)*h<<16|(a[e]-c)*h<<8|(b[e]-c)*h);else for(e=0;e<d;e++)k[e]=-16777216|(l[e]-c)*h<<16|(a[e]-c)*h<<8|(b[e]-c)*h;else if(g&&g.length===d)for(e=0;e<d;e++)a=(b[e]-c)*h,g[e]&&(k[e]=-16777216|a<<16|a<<8|a);else for(e=0;e<d;e++)a=(b[e]-c)*h,k[e]=-16777216|a<<16|a<<8|a},_fillFrom32Bit:function(k){var e=this.pixels,g=this.mask;if(!k||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var d,h,c;d=h=c=e[0];3<=e.length&&(h=e[1],c=e[2]);var b=this.width*this.height;if(d.length!==b)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var a=0;if(g&&g.length===b)for(e=0;e<b;e++)k[a++]=d[e],k[a++]=h[e],k[a++]=c[e],k[a++]=g[e];else for(e=0;e<b;e++)k[a++]=d[e],k[a++]=h[e],k[a++]=c[e],k[a++]=255}})})},"esri/layers/support/rasterFormats/LercCodec":function(){define([],function(){var m={defaultNoDataValue:-3.4027999387901484E38,decode:function(k,e){var g;e=e||{};var d=
e.inputOffset||0,h=e.encodedMaskData||null===e.encodedMaskData,c={},b=new Uint8Array(k,d,10);c.fileIdentifierString=String.fromCharCode.apply(null,b);if("CntZImage"!=c.fileIdentifierString.trim())throw"Unexpected file identifier string: "+c.fileIdentifierString;d+=10;b=new DataView(k,d,24);c.fileVersion=b.getInt32(0,!0);c.imageType=b.getInt32(4,!0);c.height=b.getUint32(8,!0);c.width=b.getUint32(12,!0);c.maxZError=b.getFloat64(16,!0);d+=24;if(!h)if(b=new DataView(k,d,16),c.mask={},c.mask.numBlocksY=
b.getUint32(0,!0),c.mask.numBlocksX=b.getUint32(4,!0),c.mask.numBytes=b.getUint32(8,!0),c.mask.maxValue=b.getFloat32(12,!0),d+=16,0<c.mask.numBytes){var h=new Uint8Array(Math.ceil(c.width*c.height/8)),b=new DataView(k,d,c.mask.numBytes),a=b.getInt16(0,!0),l=2,n=0;do{if(0<a)for(;a--;)h[n++]=b.getUint8(l++);else for(var p=b.getUint8(l++),a=-a;a--;)h[n++]=p;a=b.getInt16(l,!0);l+=2}while(l<c.mask.numBytes);if(-32768!==a||n<h.length)throw"Unexpected end of mask RLE encoding";c.mask.bitset=h;d+=c.mask.numBytes}else 0===
(c.mask.numBytes|c.mask.numBlocksY|c.mask.maxValue)&&(h=new Uint8Array(Math.ceil(c.width*c.height/8)),c.mask.bitset=h);b=new DataView(k,d,16);c.pixels={};c.pixels.numBlocksY=b.getUint32(0,!0);c.pixels.numBlocksX=b.getUint32(4,!0);c.pixels.numBytes=b.getUint32(8,!0);c.pixels.maxValue=b.getFloat32(12,!0);d+=16;h=c.pixels.numBlocksX;b=c.pixels.numBlocksY;h+=0<c.width%h?1:0;a=b+(0<c.height%b?1:0);c.pixels.blocks=Array(h*a);l=1E9;for(p=n=0;p<a;p++)for(var q=0;q<h;q++){var r=0,b=new DataView(k,d,Math.min(10,
k.byteLength-d)),t={};c.pixels.blocks[n++]=t;var w=b.getUint8(0);r++;t.encoding=w&63;if(3<t.encoding)throw"Invalid block encoding ("+t.encoding+")";if(2===t.encoding)d++,l=Math.min(l,0);else{if(0!==w&&2!==w){w>>=6;t.offsetType=w;if(2===w)t.offset=b.getInt8(1),r++;else if(1===w)t.offset=b.getInt16(1,!0),r+=2;else if(0===w)t.offset=b.getFloat32(1,!0),r+=4;else throw"Invalid block offset type";l=Math.min(t.offset,l);if(1===t.encoding)if(w=b.getUint8(r),r++,t.bitsPerPixel=w&63,w>>=6,t.numValidPixelsType=
w,2===w)t.numValidPixels=b.getUint8(r),r++;else if(1===w)t.numValidPixels=b.getUint16(r,!0),r+=2;else if(0===w)t.numValidPixels=b.getUint32(r,!0),r+=4;else throw"Invalid valid pixel count type";}d+=r;if(3!=t.encoding)if(0===t.encoding){b=(c.pixels.numBytes-1)/4;if(b!==Math.floor(b))throw"uncompressed block has invalid length";r=new ArrayBuffer(4*b);w=new Uint8Array(r);w.set(new Uint8Array(k,d,4*b));r=new Float32Array(r);for(w=0;w<r.length;w++)l=Math.min(l,r[w]);t.rawData=r;d+=4*b}else 1===t.encoding&&
(b=Math.ceil(t.numValidPixels*t.bitsPerPixel/8),r=new ArrayBuffer(4*Math.ceil(b/4)),w=new Uint8Array(r),w.set(new Uint8Array(k,d,b)),t.stuffedData=new Uint32Array(r),d+=b)}}c.pixels.minValue=l;c.eofOffset=d;k=null!=e.noDataValue?e.noDataValue:m.defaultNoDataValue;var h=e.encodedMaskData,t=e.returnMask,b=0,a=c.pixels.numBlocksX,l=c.pixels.numBlocksY,n=Math.floor(c.width/a),p=Math.floor(c.height/l),q=2*c.maxZError,h=h||(c.mask?c.mask.bitset:null),u,d=new (e.pixelType||Float32Array)(c.width*c.height);
t&&h&&(u=new Uint8Array(c.width*c.height));for(var t=new Float32Array(n*p),x,v,r=0;r<=l;r++)if(w=r!==l?p:c.height%l,0!==w)for(var z=0;z<=a;z++){var y=z!==a?n:c.width%a;if(0!==y){var A=r*c.width*p+z*n,B=c.width-y,C=c.pixels.blocks[b],E,D;if(2>C.encoding){if(0===C.encoding)E=C.rawData;else{E=C.stuffedData;D=C.bitsPerPixel;x=C.numValidPixels;v=C.offset;var F=q,M=t,N=c.pixels.maxValue,I=(1<<D)-1,G=0,O=void 0,J=0,Q=void 0,H=void 0,K=Math.ceil((N-v)/F);E[E.length-1]<<=8*(4*E.length-Math.ceil(D*x/8));for(O=
0;O<x;O++)0===J&&(H=E[G++],J=32),J>=D?(Q=H>>>J-D&I,J-=D):(J=D-J,Q=(H&I)<<J&I,H=E[G++],J=32-J,Q+=H>>>J),M[O]=Q<K?v+Q*F:N;E=t}D=0}else g=2===C.encoding?0:C.offset;var R;if(h)for(v=0;v<w;v++){A&7&&(R=h[A>>3],R<<=A&7);for(x=0;x<y;x++)A&7||(R=h[A>>3]),R&128?(u&&(u[A]=1),d[A++]=2>C.encoding?E[D++]:g):(u&&(u[A]=0),d[A++]=k),R<<=1;A+=B}else if(2>C.encoding)for(v=0;v<w;v++){for(x=0;x<y;x++)d[A++]=E[D++];A+=B}else for(v=0;v<w;v++)if(d.fill)d.fill(g,A,A+y),A+=y+B;else{for(x=0;x<y;x++)d[A++]=g;A+=B}if(1===C.encoding&&
D!==C.numValidPixels)throw"Block and Mask do not match";b++}}g=u;u={width:c.width,height:c.height,pixelData:d,minValue:c.pixels.minValue,maxValue:c.pixels.maxValue,noDataValue:k};g&&(u.maskData=g);e.returnEncodedMask&&c.mask&&(u.encodedMaskData=c.mask.bitset?c.mask.bitset:null);if(e.returnFileInfo&&(u.fileInfo=f(c),e.computeUsedBitDepths)){e=u.fileInfo;g=c.pixels.numBlocksX*c.pixels.numBlocksY;R={};for(E=0;E<g;E++)D=c.pixels.blocks[E],0===D.encoding?R.float32=!0:1===D.encoding?R[D.bitsPerPixel]=!0:
R[0]=!0;c=Object.keys(R);e.bitDepths=c}return u}},f=function(k){return{fileIdentifierString:k.fileIdentifierString,fileVersion:k.fileVersion,imageType:k.imageType,height:k.height,width:k.width,maxZError:k.maxZError,eofOffset:k.eofOffset,mask:k.mask?{numBlocksX:k.mask.numBlocksX,numBlocksY:k.mask.numBlocksY,numBytes:k.mask.numBytes,maxValue:k.mask.maxValue}:null,pixels:{numBlocksX:k.pixels.numBlocksX,numBlocksY:k.pixels.numBlocksY,numBytes:k.pixels.numBytes,maxValue:k.pixels.maxValue,minValue:k.pixels.minValue,
noDataValue:this.noDataValue}}};return m})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(m,f,k){return m(null,{constructor:function(){},decode:function(e){var g=new Uint8Array(e);e=new k;e.parse(g);var d=e.numComponents,h=e.getData(e.width,e.height,!0),c,b=e.width*e.height,a=e.eof,l=0,m=0,p=0;if(a<g.length-1)for(m=(new f(g.subarray(a))).getBytes(),c=new Uint8Array(b),l=g=0;l<m.length;l++)for(p=7;0<=p;p--)c[g++]=m[l]>>p&1;g=[];if(1===
d)g=[h,h,h];else{for(l=0;3>l;l++)d=new Uint8Array(b),g.push(d);for(m=p=0;m<b;m++)for(l=0;3>l;l++)g[l][m]=h[p++]}return{width:e.width,height:e.height,pixels:g,mask:c}}})})},"esri/layers/support/rasterFormats/Zlib":function(){define([],function(){var m=function(){function f(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}f.prototype={ensureBuffer:function(k){var e=this.buffer,g=e?e.byteLength:0;if(k<g)return e;for(var d=512;d<k;)d<<=1;k=new Uint8Array(d);for(d=0;d<g;++d)k[d]=e[d];return this.buffer=
k},getByte:function(){for(var k=this.pos;this.bufferLength<=k;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(k){var e=this.pos;if(k){this.ensureBuffer(e+k);for(k=e+k;!this.eof&&this.bufferLength<k;)this.readBlock();var g=this.bufferLength;k>g&&(k=g)}else{for(;!this.eof;)this.readBlock();k=this.bufferLength}this.pos=k;return this.buffer.subarray(e,k)},lookChar:function(){for(var k=this.pos;this.bufferLength<=k;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},
getChar:function(){for(var k=this.pos;this.bufferLength<=k;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(k,e,g){for(var d=k+e;this.bufferLength<=d&&!this.eof;)this.readBlock();return new Stream(this.buffer,k,e,g)},skip:function(k){k||(k=1);this.pos+=k},reset:function(){this.pos=0}};return f}();return function(){function f(b){throw Error(b);}function k(b){var a=0,c=b[a++],d=b[a++];-1!=c&&-1!=d||f("Invalid header in flate stream");
8!=(c&15)&&f("Unknown compression method in flate stream");0!=((c<<8)+d)%31&&f("Bad FCHECK in flate stream");d&32&&f("FDICT bit set in flate stream");this.bytes=b;this.bytesPos=a;this.codeBuf=this.codeSize=0;m.call(this)}var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),d=new Uint32Array([1,2,
3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),h=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,
589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,
589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,
590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,
524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,
589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,
589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,
590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],c=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];
k.prototype=Object.create(m.prototype);k.prototype.getBits=function(b){for(var a=this.codeSize,c=this.codeBuf,d=this.bytes,e=this.bytesPos,h;a<b;)"undefined"==typeof(h=d[e++])&&f("Bad encoding in flate stream"),c|=h<<a,a+=8;this.codeBuf=c>>b;this.codeSize=a-=b;this.bytesPos=e;return c&(1<<b)-1};k.prototype.getCode=function(b){var a=b[0],c=b[1];b=this.codeSize;for(var d=this.codeBuf,e=this.bytes,h=this.bytesPos;b<c;){var g;"undefined"==typeof(g=e[h++])&&f("Bad encoding in flate stream");d|=g<<b;b+=
8}c=a[d&(1<<c)-1];a=c>>16;c&=65535;(0==b||b<a||0==a)&&f("Bad encoding in flate stream");this.codeBuf=d>>a;this.codeSize=b-a;this.bytesPos=h;return c};k.prototype.generateHuffmanTable=function(b){for(var a=b.length,c=0,d=0;d<a;++d)b[d]>c&&(c=b[d]);for(var e=1<<c,h=new Uint32Array(e),g=1,k=0,f=2;g<=c;++g,k<<=1,f<<=1)for(var m=0;m<a;++m)if(b[m]==g){for(var x=0,v=k,d=0;d<g;++d)x=x<<1|v&1,v>>=1;for(d=x;d<e;d+=f)h[d]=g<<16|m;++k}return[h,c]};k.prototype.readBlock=function(){function b(a,b,c,d,e){for(a=
a.getBits(c)+d;0<a--;)b[t++]=e}var a=this.getBits(3);a&1&&(this.eof=!0);a>>=1;if(0==a){var l=this.bytes,k=this.bytesPos,m;"undefined"==typeof(m=l[k++])&&f("Bad block header in flate stream");var q=m;"undefined"==typeof(m=l[k++])&&f("Bad block header in flate stream");q|=m<<8;"undefined"==typeof(m=l[k++])&&f("Bad block header in flate stream");a=m;"undefined"==typeof(m=l[k++])&&f("Bad block header in flate stream");(a|m<<8)!=(~q&65535)&&f("Bad uncompressed block length in flate stream");this.codeSize=
this.codeBuf=0;m=this.bufferLength;a=this.ensureBuffer(m+q);this.bufferLength=q=m+q;for(var r=m;r<q;++r){if("undefined"==typeof(m=l[k++])){this.eof=!0;break}a[r]=m}this.bytesPos=k}else{if(1==a)k=h,m=c;else if(2==a){a=this.getBits(5)+257;m=this.getBits(5)+1;for(var l=this.getBits(4)+4,k=Array(e.length),t=0;t<l;)k[e[t++]]=this.getBits(3);k=this.generateHuffmanTable(k);t=l=0;m=a+m;for(q=Array(m);t<m;)r=this.getCode(k),16==r?b(this,q,2,3,l):17==r?b(this,q,3,3,l=0):18==r?b(this,q,7,11,l=0):q[t++]=l=r;
k=this.generateHuffmanTable(q.slice(0,a));m=this.generateHuffmanTable(q.slice(a,m))}else f("Unknown block type in flate stream");q=(a=this.buffer)?a.length:0;for(r=this.bufferLength;;){var w=this.getCode(k);if(256>w)r+1>=q&&(a=this.ensureBuffer(r+1),q=a.length),a[r++]=w;else{if(256==w){this.bufferLength=r;break}var w=w-257,w=g[w],u=w>>16;0<u&&(u=this.getBits(u));l=(w&65535)+u;w=this.getCode(m);w=d[w];u=w>>16;0<u&&(u=this.getBits(u));w=(w&65535)+u;r+l>=q&&(a=this.ensureBuffer(r+l),q=a.length);for(u=
0;u<l;++u,++r)a[r]=a[r-w]}}}};return k}()})},"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){return function(){function m(){}function f(d,c){for(var b=0,a=[],e,h,g=16;0<g&&!d[g-1];)g--;a.push({children:[],index:0});var k=a[0],f;for(e=0;e<g;e++){for(h=0;h<d[e];h++){k=a.pop();for(k.children[k.index]=c[b];0<k.index;)k=a.pop();k.index++;for(a.push(k);a.length<=e;)a.push(f={children:[],index:0}),k.children[k.index]=f.children,k=f;b++}e+1<g&&(a.push(f={children:[],index:0}),k.children[k.index]=
f.children,k=f)}return a[0].children}function k(e,c,b,a,g,k,f,m,r){function h(){if(0<F)return F--,D>>F&1;D=e[c++];if(255===D){var a=e[c++];if(a)throw"unexpected marker: "+(D<<8|a).toString(16);}F=7;return D>>>7}function l(a){for(;;){a=a[h()];if("number"===typeof a)return a;if("object"!==typeof a)throw"invalid huffman sequence";}}function n(a){for(var b=0;0<a;)b=b<<1|h(),a--;return b}function p(a){if(1===a)return 1===h()?1:-1;var b=n(a);return b>=1<<a-1?b:b+(-1<<a)+1}function q(a,b){var c=l(a.huffmanTableDC),
c=0===c?0:p(c);a.blockData[b]=a.pred+=c;for(c=1;64>c;){var e=l(a.huffmanTableAC),h=e&15,e=e>>4;if(0===h){if(15>e)break;c+=16}else c+=e,a.blockData[b+d[c]]=p(h),c++}}function z(a,b){var c=l(a.huffmanTableDC),c=0===c?0:p(c)<<r;a.blockData[b]=a.pred+=c}function y(a,b){a.blockData[b]|=h()<<r}function A(a,b){if(0<M)M--;else for(var c=k;c<=f;){var e=l(a.huffmanTableAC),h=e&15,e=e>>4;if(0===h){if(15>e){M=n(e)+(1<<e)-1;break}c+=16}else c+=e,a.blockData[b+d[c]]=p(h)*(1<<r),c++}}function B(a,b){for(var c=k,
e=0,g;c<=f;){g=d[c];switch(N){case 0:e=l(a.huffmanTableAC);g=e&15;e>>=4;if(0===g)15>e?(M=n(e)+(1<<e),N=4):(e=16,N=1);else{if(1!==g)throw"invalid ACn encoding";I=p(g);N=e?2:3}continue;case 1:case 2:a.blockData[b+g]?a.blockData[b+g]+=h()<<r:(e--,0===e&&(N=2===N?3:0));break;case 3:a.blockData[b+g]?a.blockData[b+g]+=h()<<r:(a.blockData[b+g]=I<<r,N=0);break;case 4:a.blockData[b+g]&&(a.blockData[b+g]+=h()<<r)}c++}4===N&&(M--,0===M&&(N=0))}var C=b.mcusPerLine,E=c,D=0,F=0,M=0,N=0,I,G=a.length,O,J,Q,H,K;m=
b.progressive?0===k?0===m?z:y:0===m?A:B:q;var R=0;b=1===G?a[0].blocksPerLine*a[0].blocksPerColumn:C*b.mcusPerColumn;g||(g=b);for(var P,L;R<b;){for(J=0;J<G;J++)a[J].pred=0;M=0;if(1===G)for(O=a[0],K=0;K<g;K++)m(O,64*((O.blocksPerLine+1)*(R/O.blocksPerLine|0)+R%O.blocksPerLine)),R++;else for(K=0;K<g;K++){for(J=0;J<G;J++)for(O=a[J],P=O.h,L=O.v,Q=0;Q<L;Q++)for(H=0;H<P;H++)m(O,64*((O.blocksPerLine+1)*((R/C|0)*O.v+Q)+(R%C*O.h+H)));R++}F=0;O=e[c]<<8|e[c+1];if(65280>=O)throw"marker was not found";if(65488<=
O&&65495>=O)c+=2;else break}return c-E}function e(d,c){d=c.blocksPerLine;for(var b=c.blocksPerColumn,a=new Int16Array(64),e=0;e<b;e++)for(var h=0;h<d;h++){for(var g=64*((c.blocksPerLine+1)*e+h),k=a,f=c.quantizationTable,m=c.blockData,w=void 0,u=void 0,x=void 0,v=void 0,z=void 0,y=void 0,A=void 0,B=void 0,C=void 0,E=B=void 0,D=A=u=y=void 0,F=void 0,C=void 0,M=0;64>M;M+=8)C=m[g+M],B=m[g+M+1],E=m[g+M+2],y=m[g+M+3],u=m[g+M+4],A=m[g+M+5],D=m[g+M+6],F=m[g+M+7],C*=f[M],0===(B|E|y|u|A|D|F)?(C=5793*C+512>>
10,k[M]=C,k[M+1]=C,k[M+2]=C,k[M+3]=C,k[M+4]=C,k[M+5]=C,k[M+6]=C,k[M+7]=C):(B*=f[M+1],E*=f[M+2],y*=f[M+3],u*=f[M+4],A*=f[M+5],D*=f[M+6],F*=f[M+7],w=5793*C+128>>8,u=5793*u+128>>8,x=E,v=D,z=2896*(B-F)+128>>8,B=2896*(B+F)+128>>8,y<<=4,A<<=4,w=w+u+1>>1,u=w-u,C=3784*x+1567*v+128>>8,x=1567*x-3784*v+128>>8,v=C,z=z+A+1>>1,A=z-A,B=B+y+1>>1,y=B-y,w=w+v+1>>1,v=w-v,u=u+x+1>>1,x=u-x,C=2276*z+3406*B+2048>>12,z=3406*z-2276*B+2048>>12,B=C,C=799*y+4017*A+2048>>12,y=4017*y-799*A+2048>>12,A=C,k[M]=w+B,k[M+7]=w-B,k[M+
1]=u+A,k[M+6]=u-A,k[M+2]=x+y,k[M+5]=x-y,k[M+3]=v+z,k[M+4]=v-z);for(f=0;8>f;++f)C=k[f],B=k[f+8],E=k[f+16],y=k[f+24],u=k[f+32],A=k[f+40],D=k[f+48],F=k[f+56],0===(B|E|y|u|A|D|F)?(C=5793*C+8192>>14,C=-2040>C?0:2024<=C?255:C+2056>>4,m[g+f]=C,m[g+f+8]=C,m[g+f+16]=C,m[g+f+24]=C,m[g+f+32]=C,m[g+f+40]=C,m[g+f+48]=C,m[g+f+56]=C):(w=5793*C+2048>>12,u=5793*u+2048>>12,x=E,v=D,z=2896*(B-F)+2048>>12,B=2896*(B+F)+2048>>12,w=(w+u+1>>1)+4112,u=w-u,C=3784*x+1567*v+2048>>12,x=1567*x-3784*v+2048>>12,v=C,z=z+A+1>>1,A=
z-A,B=B+y+1>>1,y=B-y,w=w+v+1>>1,v=w-v,u=u+x+1>>1,x=u-x,C=2276*z+3406*B+2048>>12,z=3406*z-2276*B+2048>>12,B=C,C=799*y+4017*A+2048>>12,y=4017*y-799*A+2048>>12,A=C,C=w+B,F=w-B,B=u+A,D=u-A,E=x+y,A=x-y,y=v+z,u=v-z,C=16>C?0:4080<=C?255:C>>4,B=16>B?0:4080<=B?255:B>>4,E=16>E?0:4080<=E?255:E>>4,y=16>y?0:4080<=y?255:y>>4,u=16>u?0:4080<=u?255:u>>4,A=16>A?0:4080<=A?255:A>>4,D=16>D?0:4080<=D?255:D>>4,F=16>F?0:4080<=F?255:F>>4,m[g+f]=C,m[g+f+8]=B,m[g+f+16]=E,m[g+f+24]=y,m[g+f+32]=u,m[g+f+40]=A,m[g+f+48]=D,m[g+
f+56]=F)}return c.blockData}function g(d){return 0>=d?0:255<=d?255:d}var d=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);m.prototype={parse:function(h){function c(){var a=h[g]<<8|h[g+1];g+=2;return a}function b(){var a=c(),a=h.subarray(g,g+a-2);g+=a.length;return a}function a(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/
8/a.maxV),d=0;d<a.components.length;d++){E=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*E.h/a.maxH),h=Math.ceil(Math.ceil(a.scanLines/8)*E.v/a.maxV);E.blockData=new Int16Array(64*c*E.v*(b*E.h+1));E.blocksPerLine=e;E.blocksPerColumn=h}a.mcusPerLine=b;a.mcusPerColumn=c}var g=0,m=null,p=null,q,r,t=[],w=[],u=[],x=c();if(65496!==x)throw"SOI not found";for(x=c();65497!==x;){var v,z;switch(x){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:v=
b();65504===x&&74===v[0]&&70===v[1]&&73===v[2]&&70===v[3]&&0===v[4]&&(m={version:{major:v[5],minor:v[6]},densityUnits:v[7],xDensity:v[8]<<8|v[9],yDensity:v[10]<<8|v[11],thumbWidth:v[12],thumbHeight:v[13],thumbData:v.subarray(14,14+3*v[12]*v[13])});65518===x&&65===v[0]&&100===v[1]&&111===v[2]&&98===v[3]&&101===v[4]&&(p={version:v[5]<<8|v[6],flags0:v[7]<<8|v[8],flags1:v[9]<<8|v[10],transformCode:v[11]});break;case 65499:for(var x=c()+g-2,y;g<x;){var A=h[g++],B=new Uint16Array(64);if(0===A>>4)for(v=
0;64>v;v++)y=d[v],B[y]=h[g++];else if(1===A>>4)for(v=0;64>v;v++)y=d[v],B[y]=c();else throw"DQT: invalid table spec";t[A&15]=B}break;case 65472:case 65473:case 65474:if(q)throw"Only single frame JPEGs supported";c();q={};q.extended=65473===x;q.progressive=65474===x;q.precision=h[g++];q.scanLines=c();q.samplesPerLine=c();q.components=[];q.componentIds={};v=h[g++];for(x=B=A=0;x<v;x++){y=h[g];z=h[g+1]>>4;var C=h[g+1]&15;A<z&&(A=z);B<C&&(B=C);z=q.components.push({h:z,v:C,quantizationTable:t[h[g+2]]});
q.componentIds[y]=z-1;g+=3}q.maxH=A;q.maxV=B;a(q);break;case 65476:y=c();for(x=2;x<y;){A=h[g++];B=new Uint8Array(16);for(v=z=0;16>v;v++,g++)z+=B[v]=h[g];C=new Uint8Array(z);for(v=0;v<z;v++,g++)C[v]=h[g];x+=17+z;(0===A>>4?u:w)[A&15]=f(B,C)}break;case 65501:c();r=c();break;case 65498:c();y=h[g++];v=[];for(var E,x=0;x<y;x++)A=q.componentIds[h[g++]],E=q.components[A],A=h[g++],E.huffmanTableDC=u[A>>4],E.huffmanTableAC=w[A&15],v.push(E);x=h[g++];y=h[g++];A=h[g++];x=k(h,g,q,v,r,x,y,A>>4,A&15);g+=x;break;
case 65535:255!==h[g]&&g--;break;default:if(255===h[g-3]&&192<=h[g-2]&&254>=h[g-2])g-=3;else throw"unknown JPEG marker "+x.toString(16);}x=c()}this.width=q.samplesPerLine;this.height=q.scanLines;this.jfif=m;this.eof=g;this.adobe=p;this.components=[];for(x=0;x<q.components.length;x++)E=q.components[x],this.components.push({output:e(q,E),scaleX:E.h/q.maxH,scaleY:E.v/q.maxV,blocksPerLine:E.blocksPerLine,blocksPerColumn:E.blocksPerColumn});this.numComponents=this.components.length},_getLinearizedBlockData:function(d,
c){var b=this.width/d,a=this.height/c,e,h,g,k,f,m,w=0,u,x=this.components.length,v=d*c*x,z=new Uint8Array(v),y=new Uint32Array(d);for(m=0;m<x;m++){e=this.components[m];h=e.scaleX*b;g=e.scaleY*a;w=m;u=e.output;k=e.blocksPerLine+1<<3;for(f=0;f<d;f++)e=0|f*h,y[f]=(e&4294967288)<<3|e&7;for(h=0;h<c;h++)for(e=0|h*g,e=k*(e&4294967288)|(e&7)<<3,f=0;f<d;f++)z[w]=u[e+y[f]],w+=x}if(c=this.decodeTransform)for(m=0;m<v;)for(d=e=0;e<x;e++,m++,d+=2)z[m]=(z[m]*c[d]>>8)+c[d+1];return z},_isColorConversionNeeded:function(){return this.adobe&&
this.adobe.transformCode?!0:3===this.numComponents?!0:!1},_convertYccToRgb:function(d){for(var c,b,a,e=0,h=d.length;e<h;e+=3)c=d[e],b=d[e+1],a=d[e+2],d[e]=g(c-179.456+1.402*a),d[e+1]=g(c+135.459-.344*b-.714*a),d[e+2]=g(c-226.816+1.772*b);return d},_convertYcckToRgb:function(d){for(var c,b,a,e,h=0,k=0,f=d.length;k<f;k+=4){c=d[k];b=d[k+1];a=d[k+2];e=d[k+3];var m=-122.67195406894+b*(-6.60635669420364E-5*b+4.37130475926232E-4*a-5.4080610064599E-5*c+4.8449797120281E-4*e-.154362151871126)+a*(-9.57964378445773E-4*
a+8.17076911346625E-4*c-.00477271405408747*e+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*e+.48357088451265)+e*(-3.36197177618394E-4*e+.484791561490776),t=107.268039397724+b*(2.19927104525741E-5*b-6.40992018297945E-4*a+6.59397001245577E-4*c+4.26105652938837E-4*e-.176491792462875)+a*(-7.78269941513683E-4*a+.00130872261408275*c+7.70482631801132E-4*e-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*e+.25802910206845)+e*(-3.18913117588328E-4*e-.213742400323665);c=-20.810012546947+
b*(-5.70115196973677E-4*b-2.63409051004589E-5*a+.0020741088115012*c-.00288260236853442*e+.814272968359295)+a*(-1.53496057440975E-5*a-1.32689043961446E-4*c+5.60833691242812E-4*e-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*e+.116935020465145)+e*(-3.43531996510555E-4*e+.24165260232407);d[h++]=g(m);d[h++]=g(t);d[h++]=g(c)}return d},_convertYcckToCmyk:function(d){for(var c,b,a,e=0,h=d.length;e<h;e+=4)c=d[e],b=d[e+1],a=d[e+2],d[e]=g(434.456-c-1.402*a),d[e+1]=g(119.541-c+.344*b+.714*a),
d[e+2]=g(481.816-c-1.772*b);return d},_convertCmykToRgb:function(d){for(var c,b,a,e,h=0,g=1/255/255,k=0,f=d.length;k<f;k+=4){c=d[k];b=d[k+1];a=d[k+2];e=d[k+3];var m=c*(-4.387332384609988*c+54.48615194189176*b+18.82290502165302*a+212.25662451639585*e-72734.4411664936)+b*(1.7149763477362134*b-5.6096736904047315*a-17.873870861415444*e-1401.7366389350734)+a*(-2.5217340131683033*a-21.248923337353073*e+4465.541406466231)-e*(21.86122147463605*e+48317.86113160301),w=c*(8.841041422036149*c+60.118027045597366*
b+6.871425592049007*a+31.159100130055922*e-20220.756542821975)+b*(-15.310361306967817*b+17.575251261109482*a+131.35250912493976*e-48691.05921601825)+a*(4.444339102852739*a+9.8632861493405*e-6341.191035517494)-e*(20.737325471181034*e+47890.15695978492);c=c*(.8842522430003296*c+8.078677503112928*b+30.89978309703729*a-.23883238689178934*e-3616.812083916688)+b*(10.49593273432072*b+63.02378494754052*a+50.606957656360734*e-28620.90484698408)+a*(.03296041114873217*a+115.60384449646641*e-49363.43385999684)-
e*(22.33816807309886*e+45932.16563550634);d[h++]=0<=m?255:-16581375>=m?0:255+m*g|0;d[h++]=0<=w?255:-16581375>=w?0:255+w*g|0;d[h++]=0<=c?255:-16581375>=c?0:255+c*g|0}return d},getData:function(d,c,b){if(4<this.numComponents)throw"Unsupported color mode";d=this._getLinearizedBlockData(d,c);if(3===this.numComponents)return this._convertYccToRgb(d);if(4===this.numComponents){if(this._isColorConversionNeeded())return b?this._convertYcckToRgb(d):this._convertYcckToCmyk(d);if(b)return this._convertCmykToRgb(d)}return d}};
return m}()})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(m){return function(){function f(d){var e,c,b,a;this.data=d;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(b=null;;){e=this.readUInt32();a=d=void 0;a=[];for(d=0;4>d;++d)a.push(String.fromCharCode(this.data[this.pos++]));d=a.join("");switch(d){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=
this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(e);break;case "fcTL":b&&this.animation.frames.push(b);this.pos+=4;b={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};d=this.readUInt16();e=this.readUInt16()||
100;b.delay=1E3*d/e;b.disposeOp=this.data[this.pos++];b.blendOp=this.data[this.pos++];b.data=[];break;case "IDAT":case "fdAT":"fdAT"===d&&(this.pos+=4,e-=4);d=(null!=b?b.data:void 0)||this.imgData;for(a=0;0<=e?a<e:a>e;0<=e?++a:--a)d.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(e);e=255-this.transparency.indexed.length;if(0<e)for(d=0;0<=e?d<e:d>e;0<=e?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=
this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case "tEXt":a=this.read(e);e=a.indexOf(0);d=String.fromCharCode.apply(String,a.slice(0,e));this.text[d]=String.fromCharCode.apply(String,a.slice(e+1));break;case "IEND":b&&this.animation.frames.push(b);a:{switch(this.colorType){case 0:case 3:case 4:b=1;break a;case 2:case 6:b=3;break a}b=void 0}this.colors=b;this.hasAlphaChannel=4===(c=this.colorType)||6===c;c=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*
c;a:{switch(this.colors){case 1:c="DeviceGray";break a;case 3:c="DeviceRGB";break a}c=void 0}this.colorSpace=c;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=e}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}var k,e,g;f.load=function(d,e,c){var b;"function"===typeof e&&(c=e);b=new XMLHttpRequest;b.open("GET",d,!0);b.responseType="arraybuffer";b.onload=function(){var a;a=new Uint8Array(b.response||b.mozResponseArrayBuffer);a=new f(a);"function"===
typeof(null!=e?e.getContext:void 0)&&a.render(e);return"function"===typeof c?c(a):void 0};return b.send(null)};f.prototype.read=function(d){var e,c;c=[];for(e=0;0<=d?e<d:e>d;0<=d?++e:--e)c.push(this.data[this.pos++]);return c};f.prototype.readUInt32=function(){var d,e,c,b;d=this.data[this.pos++]<<24;e=this.data[this.pos++]<<16;c=this.data[this.pos++]<<8;b=this.data[this.pos++];return d|e|c|b};f.prototype.readUInt16=function(){var d,e;d=this.data[this.pos++]<<8;e=this.data[this.pos++];return d|e};
f.prototype.decodePixels=function(d){var e,c,b,a,g,k,f,q,r,t,w,u,x,v,z;null==d&&(d=this.imgData);if(0===d.length)return new Uint8Array(0);d=new m(d);d=d.getBytes();q=this.pixelBitlength/8;u=q*this.width;r=new Uint8Array(u*this.height);k=d.length;for(c=t=w=0;t<k;){switch(d[t++]){case 0:for(a=e=0;e<u;a=e+=1)r[c++]=d[t++];break;case 1:for(a=x=0;x<u;a=x+=1)e=d[t++],g=a<q?0:r[c-q],r[c++]=(e+g)%256;break;case 2:for(a=g=0;g<u;a=g+=1)e=d[t++],b=(a-a%q)/q,x=w&&r[(w-1)*u+b*q+a%q],r[c++]=(x+e)%256;break;case 3:for(a=
z=0;z<u;a=z+=1)e=d[t++],b=(a-a%q)/q,g=a<q?0:r[c-q],x=w&&r[(w-1)*u+b*q+a%q],r[c++]=(e+Math.floor((g+x)/2))%256;break;case 4:for(a=z=0;z<u;a=z+=1)e=d[t++],b=(a-a%q)/q,g=a<q?0:r[c-q],0===w?x=v=0:(x=r[(w-1)*u+b*q+a%q],v=b&&r[(w-1)*u+(b-1)*q+a%q]),f=g+x-v,a=Math.abs(f-g),b=Math.abs(f-x),f=Math.abs(f-v),g=a<=b&&a<=f?g:b<=f?x:v,r[c++]=(e+g)%256;break;default:throw Error("Invalid filter algorithm: "+d[t-1]);}w++}return r};f.prototype.decodePalette=function(){var d,e,c,b,a,g,k,f,m;c=this.palette;g=this.transparency.indexed||
[];a=new Uint8Array((g.length||0)+c.length);e=k=d=b=0;for(f=c.length;k<f;e=k+=3)a[b++]=c[e],a[b++]=c[e+1],a[b++]=c[e+2],a[b++]=null!=(m=g[d++])?m:255;return a};f.prototype.copyToImageData=function(d,e){var c,b,a,h,g,k,f;b=this.colors;f=null;c=this.hasAlphaChannel;this.palette.length&&(f=null!=(a=this._decodedPalette)?a:this._decodedPalette=this.decodePalette(),b=4,c=!0);d=d.data||d;k=d.length;h=f||e;a=g=0;if(1===b)for(;a<k;)b=f?4*e[a/4]:g,g=h[b++],d[a++]=g,d[a++]=g,d[a++]=g,d[a++]=c?h[b++]:this.transparency.grayscale&&
this.transparency.grayscale===g?0:255,g=b;else for(;a<k;)b=f?4*e[a/4]:g,d[a++]=h[b++],d[a++]=h[b++],d[a++]=h[b++],d[a++]=c?h[b++]:this.transparency.rgb&&this.transparency.rgb[1]===h[b-3]&&this.transparency.rgb[3]===h[b-2]&&this.transparency.rgb[5]===h[b-1]?0:255,g=b};f.prototype.decode=function(){var d;d=new Uint8Array(this.width*this.height*4);this.copyToImageData(d,this.decodePixels());return d};e=document.createElement("canvas");g=e.getContext("2d");k=function(d){g.width=d.width;g.height=d.height;
g.clearRect(0,0,d.width,d.height);g.putImageData(d,0,0);d=new Image;d.src=e.toDataURL();return d};f.prototype.decodeFrames=function(d){var e,c,b,a,g,f,m;if(this.animation){f=this.animation.frames;m=[];e=a=0;for(g=f.length;a<g;e=++a)e=f[e],c=d.createImageData(e.width,e.height),b=this.decodePixels(new Uint8Array(e.data)),this.copyToImageData(c,b),e.imageData=c,m.push(e.image=k(c));return m}};f.prototype.renderFrame=function(d,e){var c,b;b=this.animation.frames;c=b[e];b=b[e-1];0===e&&d.clearRect(0,0,
this.width,this.height);1===(null!=b?b.disposeOp:void 0)?d.clearRect(b.xOffset,b.yOffset,b.width,b.height):2===(null!=b?b.disposeOp:void 0)&&d.putImageData(b.imageData,b.xOffset,b.yOffset);0===c.blendOp&&d.clearRect(c.xOffset,c.yOffset,c.width,c.height);return d.drawImage(c.image,c.xOffset,c.yOffset)};f.prototype.animate=function(d){var e,c,b,a,g,k,f=this;c=0;k=this.animation;a=k.numFrames;b=k.frames;g=k.numPlays;return(e=function(){var h,l;h=c++%a;l=b[h];f.renderFrame(d,h);if(1<a&&c/a<g)return f.animation._timeout=
setTimeout(e,l.delay)})()};f.prototype.stopAnimation=function(){var d;return clearTimeout(null!=(d=this.animation)?d._timeout:void 0)};f.prototype.render=function(d){var e;d._png&&d._png.stopAnimation();d._png=this;d.width=this.width;d.height=this.height;d=d.getContext("2d");if(this.animation)return this.decodeFrames(d),this.animate(d);e=d.createImageData(this.width,this.height);this.copyToImageData(e,this.decodePixels());return d.putImageData(e,0,0)};return f}()})},"esri/layers/support/rasterFormats/Raw":function(){define([],
function(){return{decodeBIP:function(m,f){var k=f.pixelType,e=f.bandCount,g=[],d=f.width*f.height,h=this.getBandCount(m,f),e=e||h,c=m.byteLength-m.byteLength%(d*this._getPixelLength(k)),b=new k(m,0,d*h),a,l,n,p;for(a=0;a<e;a++){p=new k(d);for(l=0;l<d;l++)p[l]=b[l*h+a];g.push(p)}c<m.byteLength-1&&(n=this._decodeMask(m.slice(c),f));return{pixels:g,mask:n}},decodeBSQ:function(m,f){var k=f.pixelType,e=f.bandCount;if(void 0===e||null===e)e=this.getBandCount(m,f);for(var g=[],d=f.width*f.height,h=d*e,c=
m.byteLength-m.byteLength%(d*this._getPixelLength(k)),k=new k(m,0,h),b,h=0;h<e;h++)g.push(k.subarray(h*d,(h+1)*d));c<m.byteLength-1&&(b=this._decodeMask(m.slice(c),f));return{pixels:g,mask:b}},getBandCount:function(m,f){return Math.floor(m.byteLength/(f.width*f.height*this._getPixelLength(f.pixelType)))},_getPixelLength:function(m){var f=1;switch(m){case Uint8Array:case Int8Array:case Uint8ClampedArray:f=1;break;case Uint16Array:case Int16Array:f=2;break;case Uint32Array:case Int32Array:case Float32Array:f=
4;break;case Float64Array:f=8}return f},_decodeMask:function(m,f){var k=f.width*f.height;if(8*m.byteLength<k)return null;m=new Uint8Array(m,0,Math.ceil(k/8));f=new Uint8Array(f.width*f.height);for(var e=0,g=0,d=0,h=0,d=0;d<m.length-1;d++)for(g=m[d],h=7;0<=h;h--)f[e++]=g>>h&1;for(h=7;e<k-1;)g=m[m.length-1],f[e++]=g>>h&1,h--;return f}}})},"esri/layers/support/MosaicRule":function(){define(["../../core/kebabDictionary","../../core/JSONSupport","../../core/lang","../../geometry/Point"],function(m,f,k,
e){var g=m({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),d=m({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"}),h=f.createSubclass({declaredClass:"esri.layers.support.MosaicRule",properties:{ascending:{value:!0},lockRasterIds:{value:null},method:{value:null,
json:{read:{source:["mosaicMethod","defaultMosaicMethod"],reader:function(c,b){c=b.mosaicMethod||b.defaultMosaicMethod;"byattribute"===c.toLowerCase()?c="attribute":"lockraster"===c.toLowerCase()&&(c="lock-raster");return d.fromJSON(c)}}}},multidimensionalDefinition:{value:[]},objectIds:{value:null,json:{read:{source:["fids"],reader:function(c,b){return b.fids}}}},operation:{value:null,json:{read:{source:["mosaicOperation","mosaicOperator"],reader:function(c,b){return g.fromJSON(b.mosaicOperation||
b.mosaicOperator.toLowerCase())}}}},sortField:{value:null},sortValue:{value:null},viewpoint:{value:null,type:e},where:{value:null}},clone:function(){return h.fromJSON(this.toJSON())},toJSON:function(){var c=null,b=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(b)for(var c=[],a=0;a<b;a++)c.push("esri.layers.support.DimensionalDefinition"===this.multidimensionalDefinition[a].declaredClass?this.multidimensionalDefinition[a].toJSON():this.multidimensionalDefinition[a]);b=
this.ascending?null:!1;c={mosaicMethod:this.method?d.toJSON(this.method.toLowerCase()):null,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:b,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJSON():null,fids:this.objectIds,mosaicOperation:this.operation?g.toJSON(this.operation.toLowerCase()):null,multidimensionalDefinition:c};return k.filter(c,function(a){return null!=a})}});return h})},"esri/layers/support/RasterFunction":function(){define(["../../core/kebabDictionary",
"../../core/JSONSupport","../../core/lang"],function(m,f,k){var e=m({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"}),g=f.createSubclass({declaredClass:"esri.layers.support.RasterFunction",properties:{functionArguments:{value:null,json:{read:{source:["rasterFunctionArguments"],reader:function(d,e){return this._resolveFunctionArguments(k.clone(e.rasterFunctionArguments))}}}},functionName:{value:null,json:{read:{source:["rasterFunction",
"rasterFunctionInfos"],reader:function(d,e){d=e.rasterFunction;(e=e.rasterFunctionInfos)&&e.length&&"None"!==e[0].name&&(d=e[0].name);return d}}}},outputPixelType:{value:"unknown"},variableName:{value:null}},clone:function(){return g.fromJSON(this.toJSON())},toJSON:function(){var d=k.clone(this.functionArguments),g=function(a){return a&&"esri.layers.support.RasterFunction"===a.declaredClass?a.toJSON():a};if(d&&(d.Raster=g(d.Raster),d.Raster2=g(d.Raster2),d.DEM=g(d.DEM),d.FillRaster=g(d.FillRaster),
d.Rasters&&d.Rasters.length)){var c,b=[];for(c=0;c<d.Rasters.length;c++)b.push(g(d.Rasters[c]));d.Rasters=b}g=e.toJSON(this.outputPixelType);return k.filter({rasterFunction:this.functionName,rasterFunctionArguments:d,variableName:this.variableName,outputPixelType:"UNKNOWN"!==g?g:null},function(a){return null!=a})},_resolveFunctionArguments:function(d){var e=function(b){return b&&b.rasterFunction?g.fromJSON(b):b};if(d&&(d.Raster=e(d.Raster),d.Raster2=e(d.Raster2),d.DEM=e(d.DEM),d.FillRaster=e(d.FillRaster),
d.Rasters&&d.Rasters.length))for(var c=0;c<d.Rasters.length;c++)d.Rasters[c]=e(d.Rasters[c]);return d}});return g})},"esri/layers/support/DimensionalDefinition":function(){define(["../../core/declare","../../core/lang"],function(m,f){return m(null,{declaredClass:"esri.layers.support.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(k){k&&"object"===typeof k&&f.mixin(this,k)},toJSON:function(){return f.filter({variableName:this.variableName,dimensionName:this.dimensionName,
values:this.values,isSlice:this.isSlice},function(k){return null!==k})}})})},"esri/tasks/QueryTask":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/tsSupport/assignHelper ../geometry ../core/accessorSupport/decorators ./Task ./operations/query ./operations/queryAttachments ./operations/queryRelatedRecords ./support/AttachmentQuery ./support/FeatureSet ./support/Query ./support/RelationshipQuery".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){return function(b){function f(a){a=b.call(this,a)||this;a.gdbVersion=null;a.source=null;return a}k(f,b);f.prototype.execute=function(a,b){return this.executeJSON(a,b).then(function(a){return q.fromJSON(a)})};f.prototype.executeJSON=function(b,c){return a.executeQuery(this.parsedUrl,this._normalizeQuery(b),d({},this.requestOptions,c)).then(function(a){return a.data})};f.prototype.executeForCount=function(b,c){return a.executeQueryForCount(this.parsedUrl,this._normalizeQuery(b),
d({},this.requestOptions,c)).then(function(a){return a.data.count})};f.prototype.executeForExtent=function(b,c){return a.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(b),d({},this.requestOptions,c)).then(function(a){return{count:a.data.count,extent:h.Extent.fromJSON(a.data.extent)}})};f.prototype.executeForIds=function(b,c){return a.executeQueryForIds(this.parsedUrl,this._normalizeQuery(b),d({},this.requestOptions,c)).then(function(a){return a.data.objectIds})};f.prototype.executeRelationshipQuery=
function(a,b){if(this.gdbVersion||this.source)a=a.clone().set({gdbVersion:this.gdbVersion||a.gdbVersion,source:this.source||a.source});return n.executeRelationshipQuery(this.parsedUrl,a,d({},this.requestOptions,b)).then(function(a){var b=a.data,c={};Object.keys(b).forEach(function(a){return c[a]=q.fromJSON(b[a])});return c})};f.prototype.executeAttachmentQuery=function(a,b){var c=this,e=b&&b.query&&b.query.token;return l.executeAttachmentQuery(this.parsedUrl,a,d({},this.requestOptions,b)).then(function(a){return l.processAttachmentQueryResult(a.data.attachmentGroups,
c.parsedUrl.path,e)})};f.prototype._normalizeQuery=function(a){return this.gdbVersion||this.source?a.clone().set({gdbVersion:this.gdbVersion||a.gdbVersion,source:this.source||a.source}):a};e([c.property()],f.prototype,"gdbVersion",void 0);e([c.property()],f.prototype,"source",void 0);e([g(0,c.cast(r))],f.prototype,"execute",null);e([g(0,c.cast(r))],f.prototype,"executeJSON",null);e([g(0,c.cast(r))],f.prototype,"executeForCount",null);e([g(0,c.cast(r))],f.prototype,"executeForExtent",null);e([g(0,
c.cast(r))],f.prototype,"executeForIds",null);e([g(0,c.cast(t))],f.prototype,"executeRelationshipQuery",null);e([g(0,c.cast(p))],f.prototype,"executeAttachmentQuery",null);return f=e([c.subclass("esri.tasks.QueryTask")],f)}(c.declared(b))})},"esri/tasks/operations/query":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ../../geometry/support/normalizeUtils ./pbfQueryUtils ./urlUtils".split(" "),function(m,f,k,e,
g,d,h,c,b){function a(a,b){var c=a.geometry;a=a.toJSON();c&&(a.geometry=JSON.stringify(c),a.geometryType=d.getJsonType(c),a.inSR=c.spatialReference.wkid||JSON.stringify(c.spatialReference));a.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=a.groupByFieldsForStatistics.join(","));a.objectIds&&(a.objectIds=a.objectIds.join(","));a.orderByFields&&(a.orderByFields=a.orderByFields.join(","));!a.outFields||b&&(b.returnCountOnly||b.returnExtentOnly||b.returnIdsOnly)?delete a.outFields:-1!==a.outFields.indexOf("*")?
a.outFields="*":a.outFields=a.outFields.join(",");a.outSR?a.outSR=a.outSR.wkid||JSON.stringify(a.outSR):c&&(a.returnGeometry||a.returnCentroid)&&(a.outSR=a.inSR);a.returnGeometry&&delete a.returnGeometry;a.outStatistics&&(a.outStatistics=JSON.stringify(a.outStatistics));a.pixelSize&&(a.pixelSize=JSON.stringify(a.pixelSize));a.quantizationParameters&&(a.quantizationParameters=JSON.stringify(a.quantizationParameters));a.source&&(a.layer=JSON.stringify({source:a.source}),delete a.source);a.timeExtent&&
(b=a.timeExtent,a.time=[null!=b.startTime?b.startTime:"null",null!=b.endTime?b.endTime:"null"],delete a.timeExtent);return a}function l(c,d,l,f,m){void 0===f&&(f={});var n="string"===typeof c?g.urlToObject(c):c;c=d.geometry?[d.geometry]:[];f.responseType="pbf"===l?"array-buffer":"json";return h.normalizeCentralMeridian(c,null,f).then(function(c){if(c=c&&c[0])d=d.clone(),d.geometry=c;c=b.mapParameters(k({},n.query,{f:l},m,a(d,m)));return e(n.path+"/query",k({},f,{query:c}))})}Object.defineProperty(f,
"__esModule",{value:!0});f.queryToQueryStringParameters=a;f.executeQuery=function(a,b,c){return l(a,b,"json",c)};f.executeQueryPBF=function(a,b,d){return l(a,b,"pbf",d).then(function(a){var b=c.parsePBFFeatureQuery(a.data);a.data=b;return a})};f.executeQueryForIds=function(a,b,c){return l(a,b,"json",c,{returnIdsOnly:!0})};f.executeQueryForCount=function(a,b,c){return l(a,b,"json",c,{returnIdsOnly:!0,returnCountOnly:!0})};f.executeQueryForExtent=function(a,b,c){return l(a,b,"json",c,{returnExtentOnly:!0,
returnCountOnly:!0}).then(function(a){var b=a.data;if(!b.hasOwnProperty("extent")){if(b.features)throw Error("Layer does not support extent calculation.");if(b.hasOwnProperty("count"))throw Error("Layer does not support extent calculation.");}return a})}})},"esri/tasks/operations/pbfQueryUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../layers/graphics/OptimizedFeatureSet ./pbfFeatureServiceParser".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",
{value:!0});var h=e.getLogger("esri.tasks.operations.pbfQueryUtils");f.parsePBFFeatureQuery=function(c){try{var b=d.parseFeatureQuery(c).queryResult.featureResult;if(b&&b.features&&b.features.length&&b.objectIdFieldName){var a=b.objectIdFieldName;c=0;for(var e=b.features;c<e.length;c++){var f=e[c];f.attributes&&(f.objectId=f.attributes[a])}}return b}catch(p){return b=new k("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:p}),h.error(b),new g.default}}})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){return function(){this.spatialReference=this.geometryType=this.geometryProperties=this.geohashFieldName=this.globalIdFieldName=this.objectIdFieldName=null;this.hasM=this.hasZ=!1;this.features=[];this.fields=[];this.transform=null;this.exceededTransferLimit=!1}}();f.default=m})},"esri/tasks/operations/pbfFeatureServiceParser":function(){define("require exports ../../core/pbf ../../layers/graphics/OptimizedFeature ../../layers/graphics/OptimizedFeatureSet ../../layers/graphics/OptimizedGeometry".split(" "),
function(m,f,k,e,g,d){function h(a){for(;a.next();)switch(a.tag()){case 1:return a.getString();case 2:return a.getFloat();case 3:return a.getDouble();case 4:return a.getSInt32();case 5:return a.getUInt32();case 6:return a.getInt64();case 7:return a.getUInt64();case 8:return a.getSInt64();case 9:return a.getBool();default:return a.skip(),null}return null}function c(b){for(var c={type:0>=a.length?null:a[0]};b.next();)switch(b.tag()){case 1:c.name=b.getString();break;case 2:var d=b.getEnum();c.type=
d>=a.length?null:a[d];break;case 3:c.alias=b.getString();break;case 4:d=b.getEnum();d=d>=l.length?null:l[d];c.sqlType=d;break;default:b.skip()}return c}function b(a,b){for(var c=new e.default,g=0;a.next();)switch(a.tag()){case 1:var l=a.getMessage(),k=b[g++].name;c.attributes[k]=h(l);break;case 2:for(var l=a.getMessage(),k=new d.default,f=k.coords,m=k.lengths;l.next();)switch(l.tag()){case 2:for(var n=l.getUInt32(),n=l.pos()+n;l.pos()<n;)m.push(l.getUInt32());break;case 3:for(var n=l.getUInt32(),
n=l.pos()+n,p=0;l.pos()<n;)f[p++]=l.getSInt64();break;default:l.skip()}c.geometry=k;break;case 4:l=a.getMessage();k=new d.default;for(f=k.coords;l.next();)switch(l.tag()){case 3:m=l.getUInt32();m=l.pos()+m;for(n=0;l.pos()<m;)f[n++]=l.getSInt64();break;default:l.skip()}c.centroid=k;break;default:a.skip()}return c}Object.defineProperty(f,"__esModule",{value:!0});var a="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML".split(" "),
l="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),n=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],p=["upperLeft",
"lowerLeft"];f.parseFeatureQuery=function(a){a=new k(new Uint8Array(a),new DataView(a));for(var d={};a.next();)switch(a.tag()){case 2:for(var e=a.getMessage(),h={};e.next();)switch(e.tag()){case 1:var l=e.getMessage(),f=new g.default;for(f.geometryType=0>=n.length?null:n[0];l.next();)switch(l.tag()){case 1:f.objectIdFieldName=l.getString();break;case 3:f.globalIdFieldName=l.getString();break;case 4:f.geohashFieldName=l.getString();break;case 5:for(var m=l.getMessage(),q={};m.next();)switch(m.tag()){case 1:q.shapeAreaFieldName=
m.getString();break;case 2:q.shapeLengthFieldName=m.getString();break;case 3:q.units=m.getString();break;default:m.skip()}f.geometryProperties=q;break;case 7:m=l.getEnum();f.geometryType=m>=n.length?null:n[m];break;case 8:m=l.getMessage();for(q={};m.next();)switch(m.tag()){case 1:q.wkid=m.getUInt32();break;case 5:q.wkt=m.getString();break;default:m.skip()}f.spatialReference=q;break;case 10:f.hasZ=l.getBool();break;case 11:f.hasM=l.getBool();break;case 12:m=l.getMessage();for(q={originPosition:0>=
p.length?null:p[0]};m.next();)switch(m.tag()){case 1:var y=m.getEnum();q.originPosition=y>=p.length?null:p[y];break;case 2:for(var y=m.getMessage(),A=[0,0];y.next();)switch(y.tag()){case 1:A[0]=y.getDouble();break;case 2:A[1]=y.getDouble();break;case 3:A.push(y.getDouble());break;case 4:A.push(y.getDouble());break;default:y.skip()}q.scale=A;break;case 3:y=m.getMessage();for(A=[0,0];y.next();)switch(y.tag()){case 1:A[0]=y.getDouble();break;case 2:A[1]=y.getDouble();break;case 3:A.push(y.getDouble());
break;case 4:A.push(y.getDouble());break;default:y.skip()}q.translate=A;break;default:m.skip()}f.transform=q;break;case 9:m=l.getBool();f.exceededTransferLimit=m;break;case 13:m=l.getMessage();f.fields.push(c(m));break;case 15:m=l.getMessage();f.features.push(b(m,f.fields));break;default:l.skip()}h.featureResult=f;break;default:e.skip()}d.queryResult=h;break;default:a.skip()}return d}})},"esri/core/pbf":function(){define(["require","exports"],function(m,f){return function(){function k(e,g,d,h){this._tag=
0;this._dataType=99;this._data=e;this._dataView=g;this._pos=d||0;this._end=h||e.byteLength}k.prototype.clone=function(){return new k(this._data,this._dataView,this._pos,this._end)};k.prototype.pos=function(){return this._pos};k.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var g=this._decodeVarint();this._tag=g>>3;this._dataType=g&7;if(!e||e===this._tag)break;this.skip()}return!0};k.prototype.empty=function(){return this._pos>=this._end};k.prototype.tag=function(){return this._tag};
k.prototype.getInt32=function(){return this._decodeVarint()};k.prototype.getInt64=function(){return this._decodeVarint()};k.prototype.getUInt32=function(){var e=4294967295,e=(this._data[this._pos]&127)>>>0;if(128>this._data[this._pos++])return e;e=(e|(this._data[this._pos]&127)<<7)>>>0;if(128>this._data[this._pos++])return e;e=(e|(this._data[this._pos]&127)<<14)>>>0;if(128>this._data[this._pos++])return e;e=(e|(this._data[this._pos]&127)<<21)>>>0;if(128>this._data[this._pos++])return e;e=(e|(this._data[this._pos]&
15)<<28)>>>0;if(128>this._data[this._pos++])return e};k.prototype.getUInt64=function(){return this._decodeVarint()};k.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(e&1)|0};k.prototype.getSInt64=function(){return this._decodeSVarint()};k.prototype.getBool=function(){var e=0!==this._data[this._pos];this._skip(1);return e};k.prototype.getEnum=function(){return this._decodeVarint()};k.prototype.getFixed64=function(){var e=this._dataView,g=this._pos,e=e.getUint32(g,!0)+4294967296*
e.getUint32(g+4,!0);this._skip(8);return e};k.prototype.getSFixed64=function(){var e=this._dataView,g=this._pos,e=e.getUint32(g,!0)+4294967296*e.getInt32(g+4,!0);this._skip(8);return e};k.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);this._skip(8);return e};k.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);this._skip(4);return e};k.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);this._skip(4);return e};k.prototype.getFloat=
function(){var e=this._dataView.getFloat32(this._pos,!0);this._skip(4);return e};k.prototype.getString=function(){var e=this._getLength(),g=this._pos,g=this._toString(this._data,g,g+e);this._skip(e);return g};k.prototype.getBytes=function(){var e=this._getLength(),g=this._pos,g=this._toBytes(this._data,g,g+e);this._skip(e);return g};k.prototype.getMessage=function(){var e=this._getLength(),g=this._pos,g=new k(this._data,this._dataView,g,g+e);this._skip(e);return g};k.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();
break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw Error("Invalid data type!");}};k.prototype._skip=function(e){if(this._pos+e>this._end)throw Error("Attempt to skip past the end of buffer!");this._pos+=e};k.prototype._decodeVarint=function(){var e=this._data,g=this._pos,d=0,h;if(10<=this._end-g){if(h=e[g++],d|=h&127,0!==(h&128)&&(h=e[g++],d|=(h&127)<<7,0!==(h&128)&&(h=e[g++],d|=(h&127)<<14,0!==(h&128)&&(h=e[g++],d|=(h&127)<<21,0!==
(h&128)&&(h=e[g++],d+=268435456*(h&127),0!==(h&128)&&(h=e[g++],d+=34359738368*(h&127),0!==(h&128)&&(h=e[g++],d+=4398046511104*(h&127),0!==(h&128)&&(h=e[g++],d+=562949953421312*(h&127),0!==(h&128)&&(h=e[g++],d+=72057594037927936*(h&127),0!==(h&128)&&(h=e[g++],d+=0x7fffffffffffffff*(h&127),0!==(h&128)))))))))))throw Error("Varint too long!");}else{for(var c=1;g!==this._end;){h=e[g];if(0===(h&128))break;++g;d+=(h&127)*c;c*=128}if(g===this._end)throw Error("Varint overrun!");++g;d+=h*c}this._pos=g;return d};
k.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2};k.prototype._getLength=function(){if(2!==this._dataType)throw Error("Not a delimited data type!");return this._decodeVarint()};k.prototype._toString=function(e,g,d){var h="",c="";for(d=Math.min(this._end,d);g<d;++g){var b=e[g];b&128?c+="%"+b.toString(16):(h+=decodeURIComponent(c)+String.fromCharCode(b),c="")}c.length&&(h+=decodeURIComponent(c));return h};k.prototype._toBytes=function(e,g,d){d=Math.min(this._end,
d);return new Uint8Array(e.buffer,g,d-g)};return k}()})},"esri/layers/graphics/OptimizedFeature":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){return function(k,e,g,d){void 0===k&&(k=null);void 0===e&&(e={});this.geometry=k;this.attributes=e;g&&(this.centroid=g);null!=d&&(this.objectId=d)}}();f.default=m})},"esri/layers/graphics/OptimizedGeometry":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",
{value:!0});m=function(){return function(k,e){void 0===k&&(k=[]);void 0===e&&(e=[]);this.lengths=k;this.coords=e}}();f.default=m})},"esri/tasks/operations/urlUtils":function(){define(["require","exports"],function(m,f){function k(e){var g={},d;for(d in e)if("declaredClass"!==d){var h=e[d];if(null!=h&&"function"!==typeof h)if(Array.isArray(h)){g[d]=[];for(var c=0;c<h.length;c++)g[d][c]=k(h[c])}else"object"===typeof h?h.toJSON&&(g[d]=JSON.stringify(h)):g[d]=h}return g}Object.defineProperty(f,"__esModule",
{value:!0});f.mapParameters=k})},"esri/tasks/operations/queryAttachments":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/urlUtils ./urlUtils".split(" "),function(m,f,k,e,g,d){function h(c){c=c.toJSON();c.attachmentTypes&&(c.attachmentTypes=c.attachmentTypes.join(","));c.globalIds&&(c.globalIds=c.globalIds.join(","));c.objectIds&&(c.objectIds=c.objectIds.join(","));c.size&&(c.size=c.size.join(","));return c}Object.defineProperty(f,"__esModule",{value:!0});
f.processAttachmentQueryResult=function(c,b,a){for(var d={},e=0;e<c.length;e++)for(var h=c[e],f=h.parentObjectId,m=0,h=h.attachmentInfos;m<h.length;m++){var t=h[m],w=g.addProxy(b+"/"+f+"/attachments/"+t.id+(a?"?token\x3d"+a:"")),t=k({},t,{parentObjectId:f,url:w});d[f]?d[f].push(t):d[f]=[t]}return d};f.executeAttachmentQuery=function(c,b,a){b={query:d.mapParameters(k({},c.query,{f:"json"},h(b)))};a&&(b=k({},a,b));return e(c.path+"/queryAttachments",b)}})},"esri/tasks/operations/queryRelatedRecords":function(){define(["require",
"exports","../../core/tsSupport/assignHelper","../../request","./urlUtils"],function(m,f,k,e,g){function d(d){d=d.toJSON();d.objectIds&&(d.objectIds=d.objectIds.join(","));d.outFields&&(d.outFields=d.outFields.join(","));d.outSpatialReference&&(d.outSR=d.outSR.wkid||JSON.stringify(d.outSR.toJSON()),delete d.outSpatialReference);d.source&&(d.layer=JSON.stringify({source:d.source}),delete d.source);return d}Object.defineProperty(f,"__esModule",{value:!0});f.toQueryStringParameters=d;f.executeRelationshipQuery=
function(h,c,b){c={query:g.mapParameters(k({},h.query,{f:"json"},d(c)))};b&&(c=k({},b,c));return e(h.path+"/queryRelatedRecords",c).then(function(a){for(var b=a.data,c=b.geometryType,d=b.spatialReference,e={},g=0,b=b.relatedRecordGroups;g<b.length;g++){var h=b[g],k={fields:void 0,objectIdFieldName:void 0,geometryType:c,spatialReference:d,features:h.relatedRecords};if(null!=h.objectId)e[h.objectId]=k;else for(var f in h)h.hasOwnProperty(f)&&"relatedRecords"!==f&&(e[h[f]]=k)}a.data=e;return a})}})},
"esri/tasks/ImageServiceIdentifyTask":function(){define(["../request","../core/lang","../geometry/support/normalizeUtils","./Task","./support/ImageServiceIdentifyResult"],function(m,f,k,e,g){return e.createSubclass({declaredClass:"esri.tasks.ImageServiceIdentifyTask",properties:{parsedUrl:{get:function(){var d=this._parseUrl(this.url);d.path+="/identify";return d}},url:{}},execute:function(d,e){return k.normalizeCentralMeridian(d.geometry?[d.geometry]:[]).then(function(c){c={query:this._encode(f.mixin({},
this.parsedUrl.query,{f:"json"},d.toJSON({geometry:c&&c[0]})))};if(this.requestOptions||e)c=f.mixin({},this.requestOptions,e,c);return m(this.parsedUrl.path,c)}.bind(this)).then(this._handleExecuteResponse)},_handleExecuteResponse:function(d){return g.fromJSON(d.data)}})})},"esri/tasks/support/ImageServiceIdentifyResult":function(){define(["../../core/JSONSupport","../../geometry/Point","./FeatureSet"],function(m,f,k){return m.createSubclass({declaredClass:"esri.tasks.support.ImageServiceIdentifyResult",
properties:{catalogItemVisibilities:null,catalogItems:{value:null,type:k},location:{value:null,type:f},name:null,objectId:null,properties:null,value:null}})})},"esri/tasks/support/ImageServiceIdentifyParameters":function(){define(["../../core/Accessor","../../geometry/support/jsonUtils"],function(m,f){return m.createSubclass({declaredClass:"esri.tasks.support.ImageServiceIdentifyParameters",properties:{geometry:null,mosaicRule:null,noData:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,
returnGeometry:!1,returnCatalogItems:!0,timeExtent:null},toJSON:function(k){var e=k&&k.geometry||this.geometry;k={geometry:e,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?JSON.stringify(this.mosaicRule.toJSON()):null,renderingRule:this.renderingRule?JSON.stringify(this.renderingRule.toJSON()):null};e&&(k.geometryType=f.getJsonType(e));e=this.timeExtent;k.time=e?e.toJSON().join(","):null;null!=this.pixelSizeX&&null!=this.pixelSizeY?k.pixelSize=
JSON.stringify({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(k.pixelSize=this.pixelSize?JSON.stringify(this.pixelSize.toJSON()):null);return k}})})},"esri/layers/MapImageLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper dojo/io-query ../config ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ./DynamicLayer ./mixins/ArcGISDynamicMapService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v){return function(f){function m(a,b){a=f.call(this)||this;a.alwaysRefetch=!1;a.labelsVisible=!1;a.operationalLayerType="ArcGISMapServiceLayer";a.sublayers=null;a.type="map-image";return a}e(m,f);m.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};m.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]}).then(function(){return a._fetchService()}));return this.when()};
m.prototype.getImageUrl=function(d,e,g,f){var m=this,n=this.parsedUrl.path+"/export";d=k({},this.parsedUrl.query,this.createExportImageParameters(d,e,g,f),{f:"image",token:this.token,_ts:this.alwaysRefetch?(new Date).getTime():null});if(null!=d.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return l.reject(new a("mapimagelayer:dynamiclayer-not-supported","service "+this.url+" doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.",
{query:d}));e=n+"?"+h.objectToQuery(d);return e.length>c.request.maxUrlLength?(d.f="json",b(n,{query:d,responseType:"json"}).then(function(a){if("imageData"in a.data)return a=a.data,"data:"+(a.contentType||"image")+";base64,"+a.imageData;a=a.data.href;return m.token?a+(-1===a.indexOf("?")?"?token\x3d"+m.token:"\x26token\x3d"+m.token):a})):e};m.prototype._fetchService=function(){var a=this;return l.resolve().then(function(){return a.resourceInfo?{ssl:!1,data:a.resourceInfo}:b(a.parsedUrl.path,{query:k({f:"json"},
a.parsedUrl.query),responseType:"json"})}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(b.data,{origin:"service",url:a.parsedUrl})})};g([n.property()],m.prototype,"alwaysRefetch",void 0);g([n.property({json:{read:!1,write:!1}})],m.prototype,"labelsVisible",void 0);g([n.property({json:{type:["ArcGISMapServiceLayer"]}})],m.prototype,"operationalLayerType",void 0);g([n.property()],m.prototype,"sublayers",void 0);g([n.property({json:{read:!1},readOnly:!0,value:"map-image"})],
m.prototype,"type",void 0);g([d(0,n.cast(p))],m.prototype,"getImageUrl",null);return m=g([n.subclass("esri.layers.MapImageLayer")],m)}(n.declared(q,v.default,r,t,w,u,x))})},"esri/layers/DynamicLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ./Layer".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function b(){return null!==a&&a.apply(this,arguments)||
this}k(b,a);b.prototype.getImageUrl=function(a,b,c,e){throw new d("dynamiclayer:getImageUrl-not-implemented","getImageUrl() is not implemented");};b.prototype.fetchImage=function(a,b,c,e){a=this.getImageUrl(a,b,c,e);var l={responseType:"image"};e&&e.timestamp&&(l.query={_ts:e.timestamp});var k;"string"===typeof a?(k=a,e=g(a,l)):e=a.then(function(a){k=a;return g(k,l)});return e.then(function(a){return a.data}).catch(function(a){return a&&"cancel"===a.dojoType?h.reject(a):k?h.reject(new d("dynamiclayer:image-fetch-error",
"Unable to load image: "+k,{error:a})):h.reject(new d("dynamiclayer:getImageUrl-error","Unable to create image url",{error:a}))})};b.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return h.create(function(a){return m(["../views/2d/layers/MapImageLayerView2D"],a)});case "3d":return h.create(function(a){return m(["../views/3d/layers/MapImageLayerView3D"],a)})}};return b=e([c.subclass("esri.layers.DynamicLayer")],b)}(c.declared(b))})},"esri/layers/mixins/ArcGISDynamicMapService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../geometry/support/scaleUtils ./ArcGISMapService ./ScaleRangeLayer ../support/ExportImageParameters".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(b){function c(){var a=b.call(this)||this;a.dpi=96;a.gdbVersion=null;a.imageFormat="png24";a.imageMaxHeight=2048;a.imageMaxWidth=2048;a.imageTransparency=!0;a.loaded=!1;return a}e(c,b);c.prototype.readImageFormat=function(a,b){return(a=b.supportedImageFormatTypes)&&-1<a.indexOf("PNG32")?"png32":"png24"};c.prototype.createExportImageParameters=function(b,c,d,e){b&&10<=this.version&&(b=b.clone().shiftCentralMeridian());var g=new a({layer:this,scale:h.getScale({extent:b,
width:c})}),l=g.toJSON();g.layer=null;g.destroy();var g=!e||!e.rotation||10.3>this.version?{}:{rotation:-e.rotation},f=b&&b.spatialReference,f=f.wkid||JSON.stringify(f.toJSON());e&&null!=e.pixelRatio&&(l.dpi*=e.pixelRatio);return k({bbox:b&&b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,bboxSR:f,imageSR:f,size:c+","+d},l,g)};g([d.property()],c.prototype,"dpi",void 0);g([d.property()],c.prototype,"gdbVersion",void 0);g([d.property()],c.prototype,"imageFormat",void 0);g([d.reader("imageFormat",["supportedImageFormatTypes"])],
c.prototype,"readImageFormat",null);g([d.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],c.prototype,"imageMaxHeight",void 0);g([d.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],c.prototype,"imageMaxWidth",void 0);g([d.property()],c.prototype,"imageTransparency",void 0);g([d.property()],c.prototype,"loaded",void 0);return c=g([d.subclass("esri.layers.mixins.ArcGISDynamicMapService")],c)}(d.declared(c,b))})},"esri/layers/mixins/ArcGISMapService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ./ArcGISService ../support/commonProperties".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.capabilities=void 0;b.copyright=null;b.fullExtent=null;b.legendEnabled=!0;b.spatialReference=null;b.version=null;return b}k(c,a);c.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!c)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};
a=this.type;var d=-1!==c.indexOf("query"),e=-1!==c.indexOf("map"),g=!!b.exportTilesAllowed,c=-1!==c.indexOf("tilemap"),h="tile"!==a&&!!b.supportsDynamicLayers,l="tile"!==a&&(!b.tileInfo||h),k="tile"!==a&&(!b.tileInfo||h);return{operations:{supportsQuery:d,supportsExportMap:e,supportsExportTiles:g,supportsTileMap:c},exportMap:e?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:h,supportsSublayerVisibility:l,supportsSublayerDefinitionExpression:k}:null,exportTiles:g?{maxExportTilesCount:+b.maxExportTilesCount}:
null}};c.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};e([g.property({readOnly:!0})],c.prototype,"capabilities",void 0);e([g.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],c.prototype,"readCapabilities",null);e([g.property({json:{read:{source:"copyrightText"}}})],c.prototype,
"copyright",void 0);e([g.property({type:d})],c.prototype,"fullExtent",void 0);e([g.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],c.prototype,"id",void 0);e([g.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],c.prototype,"legendEnabled",void 0);e([g.property(b.popupEnabled)],c.prototype,"popupEnabled",void 0);e([g.property({type:h})],c.prototype,"spatialReference",void 0);e([g.property()],c.prototype,
"version",void 0);e([g.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],c.prototype,"readVersion",null);return c=e([g.subclass("esri.layers.mixins.ArcGISMapService")],c)}(g.declared(c))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),
function(m,f,k,e,g,d,h,c){var b={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};return function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.scale=0;return b}e(d,a);Object.defineProperty(d.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;
var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasDynamicLayers",{get:function(){return c.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layer",{set:function(a){var c=this;this._get("layer")!==a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),
this._layerHandles.length=0),a&&(this._layerHandles=[a.allSublayers.on("change",function(){return c.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return c.notifyChange(b[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layerDefs",{get:function(){var a=
this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,b){a[b.id]=b.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visibleSublayers",{get:function(){var a=this,b=this.layer.sublayers,c=[],d=function(b){var e=
a.scale,g=0===b.minScale||e<=b.minScale,h=0===b.maxScale||e>=b.maxScale;b.visible&&(0===e||g&&h)&&(b.sublayers?b.sublayers.forEach(d):c.unshift(b))};b&&b.forEach(d);return c},enumerable:!0,configurable:!0});d.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:a=k({},a,{layers:this.layers,layerDefs:this.layerDefs});return a};g([h.property({readOnly:!0,
dependsOn:["hasDynamicLayers","visibleSublayers"]})],d.prototype,"dynamicLayers",null);g([h.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],d.prototype,"hasDynamicLayers",null);g([h.property()],d.prototype,"layer",null);g([h.property({readOnly:!0,dependsOn:["visibleSublayers"]})],d.prototype,"layers",null);g([h.property({readOnly:!0,dependsOn:["visibleSublayers"]})],d.prototype,"layerDefs",null);g([h.property({type:Number})],d.prototype,"scale",
void 0);g([h.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],d.prototype,"version",null);g([h.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],d.prototype,"visibleSublayers",null);return d=g([h.subclass("esri.layers.mixins.ExportImageParameters")],d)}(h.declared(d))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(m,f,k){function e(e,d){function g(a){var b=
a.sublayers;c.unshift(a.id);b&&b.forEach(g)}if(!e||!e.length)return!0;var c=[];d.forEach(g);if(e.length>c.length)return!1;d=0;for(var b=c.length,a=0;a<e.length;a++){for(var l=e[a].id;d<b&&c[d]!==l;)d++;if(d>=b)return!1}return!0}Object.defineProperty(f,"__esModule",{value:!0});f.isExportDynamic=function(g,d,h){return g.some(function(c){var b=c.source;return!(!b||b.type===k.MAPLAYER&&b.mapLayerId===c.id&&(!b.gdbVersion||b.gdbVersion===h.gdbVersion))||null!=c.renderer||null!=c.labelingInfo||c.hasOwnProperty("opacity")&&
null!=c.opacity||c.hasOwnProperty("labelsVisible")&&null!=c.labelsVisible})?!0:!e(g,d)};f.sameStructureAsService=function(e,d){return d.flatten(function(d){return(d=d.sublayers)&&d.toArray().reverse()}).toArray().reverse().every(function(d,c){return(c=e[c])&&d.id===c.id&&(null==d.sublayers&&null==c.sublayers||null!=d.sublayers&&null!=c.sublayers&&d.sublayers.map(function(b){return b.id}).join(",")===c.sublayers.map(function(b){return b.id}).join(","))})}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a,b,c){var d=[],e={};a.forEach(function(a){var g=new r;g.read(a,b);c&&(-1===c.indexOf(g.id)?g.visible=!1:g.visible=!0);e[g.id]=g;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(g)):d.unshift(g)});return d}function u(b,c){var d=c.get(b.id);d?(a.mixin(b.__accessor__.store._values,d.__accessor__.store._values),d.__accessor__.overridden&&(b.__accessor__.overridden=a.mixin(b.__accessor__.overridden||
{},d.__accessor__.overridden)),d.sublayers&&(b.sublayers=d.sublayers.map(function(a){return u(a,c)}))):b.sublayers&&b.sublayers.forEach(function(a){return u(a,c)});return b}Object.defineProperty(f,"__esModule",{value:!0});var x=l.getLogger("esri.layers.TileLayer");m=function(a){function d(){var b=a.call(this)||this;b.allSublayers=new c({root:b,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});b.watch("sublayers",function(a,c){return b._handleSublayersChange(a,
c)},!0);return b}e(d,a);d.prototype.readServiceSublayers=function(a,b,c){return w(b.layers,c)};d.prototype.readSublayersFromItemOrWebMap=function(a,b,c){return!b.layers&&b.visibleLayers?b.visibleLayers.map(function(a){return{id:a}}):w(b.layers,c,b.visibleLayers)};d.prototype.readSublayers=function(a,b,c){a=w(b.layers,c);this._updateSublayersForOrigin(q.OriginId.PORTAL_ITEM,a);this._updateSublayersForOrigin(q.OriginId.WEB_MAP,a);this._updateSublayersForOrigin(q.OriginId.WEB_SCENE,a);return a};d.prototype.writeSublayers=
function(a,b,c,d){a=a.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reverse();var e=this.serviceSublayers.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reduce(function(a,b){a.set(b.id,b);return a},new Map),g=!1,h=!0;this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers?(g=t.isExportDynamic(a,this.serviceSublayers,this),h=!g&&t.sameStructureAsService(a,this.serviceSublayers)):
h=t.sameStructureAsService(a,this.serviceSublayers);b.layers=[];a.forEach(function(a){var c=e.get(a.id),c=k({writeAsDynamic:g,writeOverridesOnly:h,serviceSublayer:c},d);a=a.write({},c);(!h||h&&1<Object.keys(a).length)&&b.layers.push(a)});b.visibleLayers=a.filter(function(a){return a.visible}).map(function(a){return a.id})};d.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===a})};d.prototype.createServiceSublayers=function(){return this.serviceSublayers.map(function(a){return a.clone()})};
d.prototype._updateSublayersForOrigin=function(a,b){var c=this.__accessor__.store;if(c.has("sublayers",a)){var d=c.get("sublayers",a).flatten(function(a){return a.sublayers});if(d.every(function(a){return!a.__accessor__.store._values.hasOwnProperty("minScale")})){var e=d.reduce(function(a,b){a.set(b.id,b);return a},new Map);b=b.map(function(a){return u(a.clone(),e)});c.set("sublayers",new (h.ofType(r))(b),a)}}};d.prototype._handleSublayersChange=function(a,c){var d=this;c&&(c.forEach(function(a){a.parent=
null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=d;a.layer=d}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=d;a.layer=d}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"tile"===this.type&&this._sublayersHandles.push(a.on("before-changes",function(a){x.error(new b("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",
{layer:d}));a.preventDefault()})))};g([n.property({readOnly:!0})],d.prototype,"allSublayers",void 0);g([n.property({readOnly:!0,type:h.ofType(r)})],d.prototype,"serviceSublayers",void 0);g([n.reader("service","serviceSublayers",["layers"])],d.prototype,"readServiceSublayers",null);g([n.property({value:null,type:h.ofType(r),json:{type:[Number],write:{target:"subLayerIds",allowNull:!0}}})],d.prototype,"sublayers",void 0);g([n.reader(["web-map","web-scene","portal-item"],"sublayers",["layers","visibleLayers"])],
d.prototype,"readSublayersFromItemOrWebMap",null);g([n.reader("service","sublayers",["layers"])],d.prototype,"readSublayers",null);g([n.writer(["web-map","web-scene","portal-item"],"sublayers",{layers:{type:[r]},visibleLayers:{type:[p.Integer]}})],d.prototype,"writeSublayers",null);return d=g([n.subclass("esri.layers.mixins.SublayersOwner")],d)}(n.declared(d));f.default=m})},"esri/core/CollectionFlattener":function(){define("require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper ./Collection ./Handles ./accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a._handles=new d;a.root=null;a.refresh=a.refresh.bind(a);a.updateCollections=a.updateCollections.bind(a);return a}k(b,c);b.prototype.initialize=function(){var a=this;this._handles.add(this.rootCollectionNames.map(function(b){return a.watch("root."+b,a.updateCollections,!0)}));this.updateCollections()};b.prototype.destroy=function(){this.root=null;this.refresh();this._handles.destroy();this._handles=null};b.prototype.updateCollections=
function(){var a=this;this._collections=this.rootCollectionNames.map(function(b){return a.get("root."+b)}).filter(function(a){return null!=a});this.refresh()};b.prototype.refresh=function(){var a=this._handles;a.remove("collections");this.removeAll();for(var b=this._collections.slice(),c=0,d=this._collections;c<d.length;c++)this._processCollection(b,this,d[c]);for(c=0;c<b.length;c++)a.add(b[c].on("after-changes",this.refresh),"collections")};b.prototype._createNewInstance=function(a){return new g(a)};
b.prototype._processCollection=function(a,b,c){var d=this;c&&(a.push(c),c.forEach(function(c){c&&(b.push(c),d._processCollection(a,b,d.getChildrenFunction(c)))}))};e([h.property()],b.prototype,"rootCollectionNames",void 0);e([h.property()],b.prototype,"root",void 0);e([h.property()],b.prototype,"getChildrenFunction",void 0);return b=e([h.subclass("esri.core.CollectionFlattener")],b)}(h.declared(g))})},"esri/layers/support/Sublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper dojo/io-query ../../PopupTemplate ../../core/Collection ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/write ../FeatureLayer ./commonProperties ./LabelClass ./layerSourceUtils ../../renderers/support/jsonUtils ../../renderers/support/typeUtils ../../symbols/Symbol3D ../../tasks/QueryTask ../../tasks/support/Query".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B){var C=n.getLogger("esri.layers.support.Sublayer"),E=0;return function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b._sublayersHandles=null;return b}k(f,a);m=f;Object.defineProperty(f.prototype,"definitionExpression",{get:function(){return this._get("definitionExpression")},set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"id",{get:function(){var a=
this._get("id");return null==a?E++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id"):this._set("id",a))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"labelingInfo",{get:function(){return this._get("labelingInfo")},set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});f.prototype.writeLabelingInfo=function(a,b,c,d){(!d||d.writeAsDynamic)&&a&&a.length&&(b.layerDefinition=
{drawingInfo:{labelingInfo:a.map(function(a){return a.write({},d)})}})};Object.defineProperty(f.prototype,"labelsVisible",{get:function(){return this._get("labelsVisible")},set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});f.prototype.writeLabelsVisible=function(a,b,c,d){if(!d||d.writeAsDynamic)b.showLabels=a};Object.defineProperty(f.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"legendEnabled",{get:function(){return this._get("legendEnabled")},set:function(a){this._set("legendEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"minScale",{get:function(){return this._get("minScale")},set:function(a){this._setAndNotifyLayer("minScale",a)},enumerable:!0,configurable:!0});f.prototype.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};f.prototype.writeMinScale=
function(a,b,c,d){if(d&&d.writeOverridesOnly&&(c=d&&d.serviceSublayer)&&c.minScale===a&&c.maxScale===this.maxScale)return;b.minScale=a};Object.defineProperty(f.prototype,"maxScale",{get:function(){return this._get("maxScale")},set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!0,configurable:!0});f.prototype.readMaxScale=function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};f.prototype.writeMaxScale=function(a,b,c,d){if(d&&d.writeOverridesOnly&&(c=d&&d.serviceSublayer)&&
c.maxScale===a&&c.minScale===this.minScale)return;b.maxScale=a};Object.defineProperty(f.prototype,"opacity",{get:function(){return this._get("opacity")},set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!0,configurable:!0});f.prototype.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};f.prototype.writeOpacity=function(a,b,c,d){if(!d||d.writeAsDynamic)b.layerDefinition={drawingInfo:{transparency:100-100*a}}};
f.prototype.writeParent=function(a,b,c,d){d&&d.writeOverridesOnly||(b.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1)};Object.defineProperty(f.prototype,"popupEnabled",{get:function(){return this._get("popupEnabled")},set:function(a){this._set("popupEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"popupTemplate",{get:function(){return this._get("popupTemplate")},set:function(a){this._set("popupTemplate",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"renderer",{get:function(){return this._get("renderer")},set:function(a){if(a)for(var b=0,c=a.getSymbols();b<c.length;b++)if(c[b].isInstanceOf(y)){C.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)},enumerable:!0,configurable:!0});f.prototype.readRenderer=function(a,b,c){if(a=b.layerDefinition.drawingInfo.renderer||void 0)(a=v.read(a,b,c)||void 0)||C.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,layer:this,context:c});return a};
f.prototype.writeRenderer=function(a,b,c,d){if(!d||d.writeAsDynamic)b.layerDefinition={drawingInfo:{renderer:a.toJSON()}}};Object.defineProperty(f.prototype,"source",{get:function(){return this._get("source")||{mapLayerId:this.id,type:x.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!0,configurable:!0});f.prototype.writeSource=function(a,b,c,d){d&&!d.writeAsDynamic&&d.writeOverridesOnly||(b.layerDefinition={source:x.sourceToJSON(a)})};Object.defineProperty(f.prototype,
"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!0,configurable:!0});f.prototype.castSublayers=function(a){return q.default(c.ofType(m),a)};f.prototype.writeSublayers=function(a,b,c,d){d&&d.writeOverridesOnly||(b[c]=this.get("sublayers.length")?this.sublayers.map(function(a){return a.id}).toArray().reverse():null)};Object.defineProperty(f.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",
a)},enumerable:!0,configurable:!0});f.prototype.writeTitle=function(a,b,c,d){if(d&&d.writeOverridesOnly&&(d=d&&d.serviceSublayer)&&d.title===a)return;b[c]=a};Object.defineProperty(f.prototype,"url",{get:function(){var a=this.layer,b=this.source;if(!a)return null;if(x.isMapLayerSource(b))return a.parsedUrl.path+"/"+b.mapLayerId;b={layer:JSON.stringify({source:x.sourceToJSON(this.source)})};return a.parsedUrl.path+"/dynamicLayer?"+d.objectToQuery(b)},set:function(a){a?this._override("url",a):this._clearOverride("url")},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!0,configurable:!0});f.prototype.writeVisible=function(a,b,c,d){if(d&&d.writeOverridesOnly&&(d=d&&d.serviceSublayer)&&d.visible===a)return;b[c]=a};f.prototype.clone=function(){var a=new m;this.hasOwnProperty("definitionExpression")&&(a.definitionExpression=this.definitionExpression);this.hasOwnProperty("id")&&(a.id=
this.id);this.hasOwnProperty("labelingInfo")&&(a.labelingInfo=l.clone(this.labelingInfo));this.hasOwnProperty("labelsVisible")&&(a.labelsVisible=this.labelsVisible);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("minScale")&&(a.minScale=this.minScale);this.hasOwnProperty("maxScale")&&(a.maxScale=this.maxScale);this.hasOwnProperty("opacity")&&(a.opacity=
this.opacity);this.hasOwnProperty("parent")&&(a.parent=this.parent);this.hasOwnProperty("popupEnabled")&&(a.popupEnabled=this.popupEnabled);this.hasOwnProperty("popupTemplate")&&(a.popupTemplate=this.popupTemplate?this.popupTemplate.clone():this.popupTemplate);this.hasOwnProperty("renderer")&&(a.renderer=this.renderer?this.renderer.clone():this.renderer);this.hasOwnProperty("source")&&(a.source=l.clone(this.source));this.hasOwnProperty("sublayers")&&(a.sublayers=this.sublayers?this.sublayers.clone():
this.sublayers);this.hasOwnProperty("title")&&(a.title=this.title);return a};f.prototype.createQuery=function(){return new B({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};f.prototype.createFeatureLayer=function(){if(this.hasOwnProperty("sublayers"))return null;var a=this.layer&&this.layer.parsedUrl,b=this.source,c=null;a&&(c=x.isMapLayerSource(b)?a.path+"/"+b.mapLayerId:a.path+"/dynamicLayer");a=new t({url:c});this.hasOwnProperty("definitionExpression")&&(a.definitionExpression=
this.definitionExpression);this.hasOwnProperty("labelingInfo")&&(a.labelingInfo=l.clone(this.labelingInfo));this.hasOwnProperty("labelsVisible")&&(a.labelsVisible=this.labelsVisible);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("minScale")&&(a.minScale=this.minScale);this.hasOwnProperty("maxScale")&&(a.maxScale=this.maxScale);this.hasOwnProperty("opacity")&&(a.opacity=this.opacity);this.hasOwnProperty("popupTemplate")&&
(a.popupTemplate=this.popupTemplate?this.popupTemplate.clone():this.popupTemplate);this.hasOwnProperty("renderer")&&(a.renderer=this.renderer?this.renderer.clone():this.renderer);this.hasOwnProperty("source")&&x.isDataLayerSource(this.source)&&(a.dynamicDataSource=l.clone(this.source));this.hasOwnProperty("title")&&(a.title=this.title);return a};f.prototype.queryFeatures=function(a){var b=this;void 0===a&&(a=this.createQuery());return(new A({url:this.url})).execute(a).then(function(a){a&&a.features&&
a.features.forEach(function(a){a.sourceLayer=b});return a})};f.prototype.toExportImageJSON=function(){var a={id:this.id,source:x.sourceToJSON(this.source)};this.definitionExpression&&(a.definitionExpression=this.definitionExpression);if(this.renderer||this.labelingInfo||null!=this.opacity||null!=this.labelsVisible){var b=a.drawingInfo={};this.renderer&&(b.renderer=this.renderer.toJSON());null!=this.labelsVisible&&(b.showLabels=this.labelsVisible);!1!==this.labelsVisible&&this.labelingInfo&&(b.labelingInfo=
this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}),b.showLabels=!0);null!=this.opacity&&(b.transparency=100-100*this.opacity)}return a};f.prototype._setAndNotifyLayer=function(a,b){var c=this.layer,d=this._get(a),e;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":e="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers"}e&&
!1===this.get("layer.capabilities.exportMap."+e)?this._logLockedError(a):(this._set(a,b),d!==b&&c&&c.emit&&c.emit("sublayer-update",{propertyName:a}))};f.prototype._handleSublayersChange=function(a,c){var d=this;c&&(c.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=d;a.layer=d.layer}),this._sublayersHandles=[a.on("after-add",function(a){a=a.item;a.parent=d;a.layer=d.layer}),
a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null}),a.on("before-changes",function(a){var c=d.get("layer.capabilities.exportMap.supportsSublayersChanges");null==c||c||(C.error(new b("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:d})),a.preventDefault())})])};f.prototype._logLockedError=function(a){C.error(new b("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{sublayer:this,
layer:this.layer}))};var m;e([p.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],f.prototype,"definitionExpression",null);e([p.property({type:Number,json:{write:{ignoreOrigin:!0}}})],f.prototype,"id",null);e([p.property({value:null,type:[u],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],f.prototype,"labelingInfo",null);e([p.writer("labelingInfo")],
f.prototype,"writeLabelingInfo",null);e([p.property({type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}})],f.prototype,"labelsVisible",null);e([p.writer("labelsVisible")],f.prototype,"writeLabelsVisible",null);e([p.property({value:null})],f.prototype,"layer",null);e([p.property({type:Boolean,value:!0,json:{read:{source:"showLegend"},write:{target:"showLegend"}}})],f.prototype,"legendEnabled",null);e([p.property({type:Number,value:0,json:{write:{overridePolicy:function(a,b,
c){if(r.willPropertyWrite(this,"maxScale",{},c))return{ignoreOrigin:!0}}}}})],f.prototype,"minScale",null);e([p.reader("portal-item","minScale",["minScale","layerDefinition.minScale"])],f.prototype,"readMinScale",null);e([p.writer("minScale")],f.prototype,"writeMinScale",null);e([p.property({type:Number,value:0,json:{write:{overridePolicy:function(a,b,c){if(r.willPropertyWrite(this,"minScale",{},c))return{ignoreOrigin:!0}}}}})],f.prototype,"maxScale",null);e([p.reader("portal-item","maxScale",["maxScale",
"layerDefinition.maxScale"])],f.prototype,"readMaxScale",null);e([p.writer("maxScale")],f.prototype,"writeMaxScale",null);e([p.property({type:Number,json:{write:{target:"layerDefinition.drawingInfo.transparency"}}})],f.prototype,"opacity",null);e([p.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],f.prototype,"readOpacity",null);e([p.writer("opacity")],f.prototype,"writeOpacity",null);e([p.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0}}})],
f.prototype,"parent",void 0);e([p.writer("parent")],f.prototype,"writeParent",null);e([p.property(w.popupEnabled)],f.prototype,"popupEnabled",null);e([p.property({value:null,type:h,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],f.prototype,"popupTemplate",null);e([p.property({types:z.types,value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],f.prototype,"renderer",null);e([p.reader("renderer",["layerDefinition.drawingInfo.renderer"])],f.prototype,"readRenderer",
null);e([p.writer("renderer")],f.prototype,"writeRenderer",null);e([p.property({cast:x.castSource,json:{read:{source:"layerDefinition.source",reader:x.sourceFromJSON},write:{target:"layerDefinition.source"}}})],f.prototype,"source",null);e([p.writer("source")],f.prototype,"writeSource",null);e([p.property({value:null,json:{type:[q.Integer],write:{target:"subLayerIds",allowNull:!0}}})],f.prototype,"sublayers",null);e([p.cast("sublayers")],f.prototype,"castSublayers",null);e([p.writer("sublayers")],
f.prototype,"writeSublayers",null);e([p.property({type:String,value:null,json:{read:{source:"name"},write:{target:"name",allowNull:!0,ignoreOrigin:!0}}})],f.prototype,"title",null);e([p.writer("title")],f.prototype,"writeTitle",null);e([p.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],f.prototype,"url",null);e([p.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},
write:{target:"defaultVisibility"}}})],f.prototype,"visible",null);e([p.writer("visible")],f.prototype,"writeVisible",null);e([g(0,p.cast(B))],f.prototype,"queryFeatures",null);return f=m=e([p.subclass("esri.layers.support.Sublayer")],f)}(p.declared(a))})},"esri/layers/WMSLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/url ../config ../Graphic ../PopupTemplate ../request ../core/Collection ../core/CollectionFlattener ../core/Handles ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/write ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/ExportWMSImageParameters ./support/WMSSublayer ./support/wmsUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E){function D(a,b){return a.some(function(a){for(var c in a)if(t.willPropertyWrite(a,c,null,b))return!0;return!1})}function F(a,b,c){var d=[],e=new Map;a.forEach(function(a){var g=new C;g.read(a,b);c&&-1===c.indexOf(g.name)&&(g.visible=!1);e[g.id]=g;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(g)):d.unshift(g)});return d}return function(f){function t(a,b){var c=f.call(this)||
this;c._sublayersHandles=new p;c.allSublayers=new n({root:c,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});c.customParameters=null;c.customLayerParameters=null;c.copyright=null;c.description=null;c.fullExtent=null;c.fullExtents=null;c.featureInfoFormat=null;c.featureInfoUrl=null;c.imageFormat=null;c.imageMaxHeight=2048;c.imageMaxWidth=2048;c.imageTransparency=!0;c.legendEnabled=!0;c.mapUrl=null;c.operationalLayerType="WMS";c.spatialReference=null;c.spatialReferences=
null;c.sublayers=null;c.type="wms";c.version=null;c.watch("sublayers",function(a,b){b&&(b.forEach(function(a){a.layer=null}),c._sublayersHandles.removeAll(),c._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=c;a.layer=c}),c._sublayersHandles||(c._sublayersHandles=new p),c._sublayersHandles.add([a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]))},!0);return c}e(t,f);t.prototype.normalizeCtorArgs=function(a,
b){return"string"===typeof a?k({url:a},b):a};t.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]}).then(function(){return a._fetchService()}));return this.when()};t.prototype.readFullExtentFromItemOrMap=function(a,b,c){a=b.extent;return(b=b.spatialReferences)&&0<b.length?new w({xmin:a[0][0],ymin:a[0][1],xmax:a[1][0],ymax:a[1][1],spatialReference:b[0]}):new w({xmin:a[0][0],ymin:a[0][1],xmax:a[1][0],ymax:a[1][1]})};t.prototype.writeFullExtent=
function(a,b,c,d){b.extent=[[a.xmin,a.ymin],[a.xmax,a.ymax]]};t.prototype.readImageFormat=function(a,b){return(a=b.supportedImageFormatTypes)&&-1<a.indexOf("image/png")?"image/png":a&&a[0]};t.prototype.readSpatialReferenceFromItemOrDocument=function(a,b,c){return new u(b.spatialReferences[0])};t.prototype.writeSpatialReferences=function(a,b,c,d){var e=this.spatialReference&&this.spatialReference.wkid;a&&e?(b.spatialReferences=a.filter(function(a){return a!==e}),b.spatialReferences.unshift(e)):b.spatialReferences=
a};t.prototype.readSublayersFromItemOrMap=function(a,b,c){return F(b.layers,c,b.visibleLayers)};t.prototype.readSublayers=function(a,b,c){return F(b.layers,c)};t.prototype.writeSublayers=function(a,b,c,d){b.layers=[];var e=new Map;a=a.flatten(function(a){return(a=a.sublayers)&&a.toArray()}).toArray();a.forEach(function(a){"number"===typeof a.parent.id&&(e.has(a.parent.id)?e.get(a.parent.id).push(a.id):e.set(a.parent.id,[a.id]))});a.forEach(function(a){var c=k({sublayer:a},d),g=a.write({parentLayerId:"number"===
typeof a.parent.id?a.parent.id:-1},c);e.has(a.id)&&(g.sublayerIds=e.get(a.id));!a.sublayers&&a.name&&(a=a.write({},c),delete a.id,b.layers.push(a))});b.visibleLayers=a.filter(function(a){return a.visible&&!a.sublayers}).map(function(a){return a.name})};t.prototype.createExportImageParameters=function(a){this._exportWMSImageParameters=new B({layer:this,extent:a});return this._exportWMSImageParameters.toJSON()};t.prototype.fetchImage=function(b,c,d,e){var g=this.mapUrl;b={responseType:"image",query:this._mixCustomParameters(k({width:c,
height:d},this.createExportImageParameters(b)))};e&&e.timestamp&&(b.query=k({_ts:e.timestamp},b.query));return a(g,b).then(function(a){return a.data})};t.prototype.fetchFeatureInfo=function(d,e,g,h,l){var f=this,m=E.getPopupLayers(this._exportWMSImageParameters.visibleSublayers);if(!this.featureInfoUrl||!m)return null;e=k({query_layers:m,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:e,height:g},"1.3.0"===this.version?{I:h,J:l}:{x:h,y:l});var n=k({},this.createExportImageParameters(d),
e),n=this._mixCustomParameters(n);return a(this.featureInfoUrl,{query:n,responseType:"text"}).then(function(a){var d=f.featureInfoUrl,d=d+(-1===d.indexOf("?")?"?":""),e;for(e in n)d+="?"===d.substring(d.length-1,d.length)?"":"\x26",d+=e+"\x3d"+n[e];return new c({sourceLayer:f,popupTemplate:new b({title:f.title,content:'\x3ciframe src\x3d"'+d+'" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0"\x3e'+a.data+"\x3c/iframe\x3e"})})})};t.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===
a})};t.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return q.create(function(a){return m(["../views/2d/layers/WMSLayerView2D"],a)});case "3d":return q.create(function(a){return m(["../views/3d/layers/WMSLayerView3D"],a)})}};t.prototype._fetchService=function(){var b=this;return q.resolve().then(function(){if(b.resourceInfo)return{data:b.resourceInfo};b.parsedUrl.query&&b.parsedUrl.query.service&&(b.parsedUrl.query.SERVICE=b.parsedUrl.query.service,delete b.parsedUrl.query.service);
b.parsedUrl.query&&b.parsedUrl.query.request&&(b.parsedUrl.query.REQUEST=b.parsedUrl.query.request,delete b.parsedUrl.query.request);return a(b.parsedUrl.path,{query:k({SERVICE:"WMS",REQUEST:"GetCapabilities"},b.parsedUrl.query,b.customParameters),responseType:"xml"})}).then(function(a){if(!b.resourceInfo){a.data=E.parseCapabilities(a.data);var c=new d(b.parsedUrl.path);"https"!==c.scheme||c.port&&"443"!==c.port||-1!==h.request.httpsDomains.indexOf(c.host)||h.request.httpsDomains.push(c.host)}a.data&&
b.read(a.data,{origin:"service"})})};t.prototype._mixCustomParameters=function(a){if(!this.customLayerParameters&&!this.customParameters)return a;var b=k({},this.customParameters,this.customLayerParameters),c;for(c in b)a[c.toLowerCase()]=b[c];return a};g([r.property({readOnly:!0})],t.prototype,"allSublayers",void 0);g([r.property({json:{write:!0}})],t.prototype,"customParameters",void 0);g([r.property({json:{write:!0}})],t.prototype,"customLayerParameters",void 0);g([r.property({type:String,json:{write:!0}})],
t.prototype,"copyright",void 0);g([r.property()],t.prototype,"description",void 0);g([r.property({json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0);g([r.reader(["web-document","portal-item"],"fullExtent",["extent"])],t.prototype,"readFullExtentFromItemOrMap",null);g([r.writer(["web-document","portal-item"],"fullExtent")],t.prototype,"writeFullExtent",null);g([r.property()],t.prototype,"fullExtents",void 0);g([r.property({type:String,json:{write:{ignoreOrigin:!0}}})],
t.prototype,"featureInfoFormat",void 0);g([r.property({type:String,json:{write:{ignoreOrigin:!0}}})],t.prototype,"featureInfoUrl",void 0);g([r.property({type:String,json:{origins:{"web-document":{read:{source:"format"},write:{target:"format"}}}}})],t.prototype,"imageFormat",void 0);g([r.reader("imageFormat",["supportedImageFormatTypes"])],t.prototype,"readImageFormat",null);g([r.property({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],t.prototype,"imageMaxHeight",void 0);
g([r.property({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],t.prototype,"imageMaxWidth",void 0);g([r.property()],t.prototype,"imageTransparency",void 0);g([r.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0);g([r.property({type:String,json:{write:{ignoreOrigin:!0}}})],t.prototype,"mapUrl",void 0);g([r.property()],t.prototype,"operationalLayerType",void 0);g([r.property({type:u,
json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],t.prototype,"spatialReference",void 0);g([r.reader(["web-document","portal-item"],"spatialReference",["spatialReferences"])],t.prototype,"readSpatialReferenceFromItemOrDocument",null);g([r.property({type:[Number],json:{read:{source:"spatialReferences"},write:{ignoreOrigin:!0}}})],t.prototype,"spatialReferences",void 0);g([r.writer(["web-document","portal-item"],"spatialReferences")],t.prototype,"writeSpatialReferences",
null);g([r.property({type:l.ofType(C),json:{write:{overridePolicy:function(a,b,c){if(D(this.allSublayers,c))return{ignoreOrigin:!0}}}}})],t.prototype,"sublayers",void 0);g([r.reader(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],t.prototype,"readSublayersFromItemOrMap",null);g([r.reader("service","sublayers",["layers"])],t.prototype,"readSublayers",null);g([r.writer("sublayers")],t.prototype,"writeSublayers",null);g([r.property({json:{read:!1},readOnly:!0,value:"wms"})],t.prototype,
"type",void 0);g([r.property({type:String,json:{write:{ignoreOrigin:!0}}})],t.prototype,"version",void 0);return t=g([r.subclass("esri.layers.WMSLayer")],t)}(r.declared(x,v,z,y,A))})},"esri/layers/support/ExportWMSImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/accessorSupport/decorators ./wmsUtils".split(" "),function(m,f,k,e,g,d,h,
c,b){var a={visible:"visibleSublayers"},l=[102100,3857,102113,900913],n=[3395,54004];return function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a._layerHandles=new h;a.extent=null;return a}e(f,d);Object.defineProperty(f.prototype,"layer",{set:function(b){var c=this;this._get("layer")!==b&&(this._set("layer",b),this._layerHandles&&(this._layerHandles.removeAll(),this._layerHandles=null),b&&(this._layerHandles||(this._layerHandles=new h),this._layerHandles.add([b.sublayers.on("change",
function(){return c.notifyChange("visibleSublayers")}),b.on("wms-sublayer-update",function(b){return c.notifyChange(a[b.propertyName])})])))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layers",{get:function(){return this.visibleSublayers.map(function(a){return a.name}).join(",")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"visibleSublayers",{get:function(){var a=this.layer.sublayers,b=[],c=function(a){a.visible&&(a.sublayers?a.sublayers.forEach(c):b.unshift(a))};a&&a.forEach(c);return b},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"wkid",{get:function(){var a=this.extent,b=this.layer.spatialReferences,c=a.spatialReference&&a.spatialReference.wkid;b&&-1===b.indexOf(c)&&a.spatialReference.latestWkid&&(c=a.spatialReference.latestWkid);a=l.some(function(a){return a===
c});if(!b)return c;if(a){var d=[];b.forEach(function(a){-1<l.indexOf(a)&&d.push(a)});d.length||b.forEach(function(a){-1<n.indexOf(a)&&d.push(a)});c=0<d.length?d[0]:l[0]}return c},enumerable:!0,configurable:!0});f.prototype.toJSON=function(){var a=this.layer,c=this.extent,d=this.wkid;a.spatialReferences&&-1===a.spatialReferences.indexOf(d)&&c.spatialReference.latestWkid&&(d=c.spatialReference.latestWkid);c={bbox:"1.3.0"===a.version&&b.coordsReversed(d)?c.ymin+","+c.xmin+","+c.ymax+","+c.xmax:c.xmin+
","+c.ymin+","+c.xmax+","+c.ymax,format:a.imageFormat,request:"GetMap",service:"WMS",styles:"",transparent:a.imageTransparency,version:a.version};isNaN(d)||("1.3.0"===a.version?c.crs="EPSG:"+d:c.srs="EPSG:"+d);return k({},c,{layers:this.layers})};g([c.property()],f.prototype,"extent",void 0);g([c.property()],f.prototype,"layer",null);g([c.property({readOnly:!0,dependsOn:["visibleSublayers"]})],f.prototype,"layers",null);g([c.property({dependsOn:["layers","layer.imageTransparency"]})],f.prototype,
"version",null);g([c.property({readOnly:!0,dependsOn:["layer.sublayers"]})],f.prototype,"visibleSublayers",null);g([c.property()],f.prototype,"wkid",null);return f=g([c.subclass("esri.layers.support.ExportWMSImageParameters")],f)}(c.declared(d))})},"esri/layers/support/wmsUtils":function(){define("require exports ../../core/Error ../../core/urlUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(m,f,k,e,g,d){function h(a){return r.some(function(b){var c=b[1];return a>=
b[0]&&a<=c})}function c(a){var b=[];a.forEach(function(a){b.push(a);a.sublayers&&a.sublayers.length&&(b=b.concat(c(a.sublayers)),delete a.sublayers)});return b}function b(a,b){return(a=b&&b.getElementsByTagName(a))&&0<a.length?a[0]:null}function a(a,c,d){return(a=b(a,c))?a.textContent:d}function l(a,b,c){if(!a)return null;var e=parseFloat(a.getAttribute("minx")),h=parseFloat(a.getAttribute("miny")),l=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));c?(c=isNaN(h)?-Number.MAX_VALUE:
h,e=isNaN(e)?-Number.MAX_VALUE:e,h=isNaN(a)?Number.MAX_VALUE:a,l=isNaN(l)?Number.MAX_VALUE:l):(c=isNaN(e)?-Number.MAX_VALUE:e,e=isNaN(h)?-Number.MAX_VALUE:h,h=isNaN(l)?Number.MAX_VALUE:l,l=isNaN(a)?Number.MAX_VALUE:a);b=new d({wkid:b});return new g({xmin:c,ymin:e,xmax:h,ymax:l,spatialReference:b})}function n(a,c){a=b(c,a);if(a=b("DCPType",a))if(a=b("HTTP",a))if(a=b("Get",a)){var d;if(d=(a=b("OnlineResource",a))?a.getAttribute("xlink:href"):null){d.indexOf("\x26")===d.length-1&&(d=d.substring(0,d.length-
1));a=["service","request"];c=[];d=e.urlToObject(d);for(var g in d.query)d.query.hasOwnProperty(g)&&-1===a.indexOf(g.toLowerCase())&&c.push(g+"\x3d"+d.query[g]);return d.path+(c.length?"?"+c.join("\x26"):"")}}return null}function p(a,c){var d=a.getElementsByTagName("Operation");if(d&&d.length){var e=[];Array.prototype.slice.call(d).forEach(function(a){a.getAttribute("name")===c&&(a=a.getElementsByTagName("Format"),Array.prototype.slice.call(a).forEach(function(a){e.push(a.textContent)}))});return e}a=
b(c,a).getElementsByTagName("Format");return Array.prototype.slice.call(a).map(function(a){return a.textContent})}function q(c,e){if(!c)return null;var k={id:w++,fullExtents:[],parentLayerId:null,queryable:"1"===c.getAttribute("queryable"),spatialReferences:[],sublayers:null},f=b("LatLonBoundingBox",c),m=b("EX_GeographicBoundingBox",c),n=null;f&&(n=l(f,4326));m&&(n=new g(0,0,0,0,new d({wkid:4326})),n.xmin=parseFloat(a("westBoundLongitude",m,0)),n.ymin=parseFloat(a("southBoundLatitude",m,0)),n.xmax=
parseFloat(a("eastBoundLongitude",m,0)),n.ymax=parseFloat(a("northBoundLatitude",m,0)));f||m||(n=new g(-180,-90,180,90,new d({wkid:4326})));var p=-1<["1.0.0","1.1.0","1.1.1"].indexOf(e)?"SRS":"CRS";Array.prototype.slice.call(c.childNodes).forEach(function(a){if("Name"===a.nodeName)k.name=a.textContent||"";else if("Title"===a.nodeName)k.title=a.textContent||"";else if("Abstract"===a.nodeName)k.description=a.textContent||"";else if("BoundingBox"===a.nodeName){var c=a.getAttribute(p);if(c&&0===c.indexOf("EPSG:")){var d=
parseInt(c.substring(5),10);0===d||isNaN(d)||n||(n="1.3.0"===e?l(a,d,h(d)):l(a,d))}(d=c&&c.indexOf(":"))&&-1<d&&(d=parseInt(c.substring(d+1,c.length),10),0===d||isNaN(d)||(d=t[d]?t[d]:d),a="1.3.0"===e?l(a,d,h(d)):l(a,d),k.fullExtents.push(a))}else if(a.nodeName===p)a.textContent.split(" ").forEach(function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(t[a]&&(a=t[a]),-1===k.spatialReferences.indexOf(a)&&k.spatialReferences.push(a))});else if("Style"!==a.nodeName||
k.legendURL)"Layer"===a.nodeName&&(a=q(a,e))&&(a.parentLayerId=k.id,k.sublayers||(k.sublayers=[]),k.sublayers.push(a));else if(a=b("LegendURL",a))if(a=b("OnlineResource",a))k.legendURL=a.getAttribute("xlink:href")});k.extent=n&&n.toJSON();return k}Object.defineProperty(f,"__esModule",{value:!0});var r=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,
2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],t={84:4326,83:4269,27:4267},w;f.parseCapabilities=
function(d){if(d){w=-1;"string"===typeof d&&(d=(new DOMParser).parseFromString(d,"text/xml"));var e=d.documentElement;if("ServiceExceptionReport"===e.nodeName){var h=Array.prototype.slice.call(e.childNodes).map(function(a){return a.textContent}).join("\r\n");throw new k("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",h);}var l=b("Layer",e);if(l){var f="WMS_Capabilities"===e.nodeName||"WMT_MS_Capabilities"===e.nodeName?e.getAttribute("version"):
"1.3.0",m=b("Service",e);d=a("Title",m,"")||a("Name",m,"");var r=a("AccessConstraints",m,""),t=a("Abstract",m,""),u=parseInt(a("MaxWidth",m,5E3),10),m=parseInt(a("MaxHeight",m,5E3),10),D=b("Capability",e),F=p(e,"GetMap"),M=n(e,"GetMap"),N=q(l,f),I=0,G;Array.prototype.slice.call(D.childNodes).forEach(function(a){"Layer"===a.nodeName&&(0===I?G=a:(1===I&&N.name&&(N.name="",N.sublayers.push(q(G,f))),N.sublayers.push(q(a,f))),I++)});if(!N)return null;var O,J,l=N.fullExtents;(D=N.sublayers)||(D=[]);0===
D.length&&D.push(N);O=N.extent;O||(O=new g(D[0].extent),N.extent=O.toJSON(),O=N.extent);J=N.spatialReferences;if(!J.length&&0<D.length){var Q=function(a){var b=[];a.sublayers.forEach(function(a){!b.length&&a.spatialReferences.length&&(b=a.spatialReferences||Q(a))});return b};D.forEach(function(a){J.length||(J=a.spatialReferences||Q(a))})}var H=n(e,"GetFeatureInfo");H&&(e=p(e,"GetFeatureInfo"),-1<e.indexOf("text/html")?h="text/html":-1<e.indexOf("text/plain")&&(h="text/plain"));if(!h){var K=function(a){a&&
(a.queryable=!1,a.sublayers&&a.sublayers.forEach(function(a){K(a)}))};K(N)}e=c(D);return{copyright:r,description:t,extent:O,fullExtents:l,featureInfoFormat:h,featureInfoUrl:H,mapUrl:M,maxImageWidth:u,maxImageHeight:m,layers:e,spatialReferences:J,supportedImageFormatTypes:F,title:d,version:f}}}};f.coordsReversed=h;f.getPopupLayers=function(a){return a.length?a.filter(function(a){return a.popupEnabled&&a.name&&a.queryable}).map(function(a){return a.name}).join(","):""}})},"esri/layers/support/WMSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/Collection ../../core/Handles ../../core/MultiOriginJSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/Extent".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=0;return function(c){function g(a){a=c.call(this)||this;a._sublayersHandles=new h;a.fullExtents=null;a.featureInfoFormat=null;a.featureInfoUrl=null;a.legendUrl=null;a.legendEnabled=!0;a.popupEnabled=!1;a.queryable=!1;a.spatialReferences=null;return a}k(g,c);f=g;Object.defineProperty(g.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"fullExtent",{get:function(){return this._get("fullExtent")},set:function(a){this._set("fullExtent",a)},enumerable:!0,configurable:!0});g.prototype.readExtent=function(a,b,c){return(a=b.extent)?l.fromJSON(a):null};Object.defineProperty(g.prototype,"id",{get:function(){var a=this._get("id");return null==a?n++:a},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=
a})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"name",{get:function(){return this._get("name")},set:function(a){this._set("name",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"sublayers",{set:function(a){var b=this,c=this._get("sublayers");c&&(c.forEach(function(a){a.layer=null}),this._sublayersHandles.removeAll(),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=b;a.layer=b.layer}),this._sublayersHandles.add([a.on("after-add",function(a){a=
a.item;a.parent=b;a.layer=b.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]));this._set("sublayers",a)},enumerable:!0,configurable:!0});g.prototype.castSublayers=function(b){return a.default(d.ofType(f),b)};Object.defineProperty(g.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._setAndNotifyLayer("visible",
a)},enumerable:!0,configurable:!0});g.prototype.clone=function(){var a=new f;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent.clone());this.hasOwnProperty("fullExtents")&&(a.fullExtents=this.fullExtents.map(function(a){return a.clone()}));this.hasOwnProperty("featureInfoFormat")&&(a.featureInfoFormat=this.featureInfoFormat);this.hasOwnProperty("featureInfoUrl")&&(a.featureInfoUrl=this.featureInfoUrl);this.hasOwnProperty("legendUrl")&&
(a.legendUrl=this.legendUrl);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("name")&&(a.name=this.name);this.hasOwnProperty("parent")&&(a.parent=this.parent);this.hasOwnProperty("queryable")&&(a.queryable=this.queryable);this.hasOwnProperty("sublayers")&&(a.sublayers=this.sublayers&&this.sublayers.map(function(a){return a.clone()}));this.hasOwnProperty("spatialReferences")&&(a.spatialReferences=this.spatialReferences.map(function(a){return a}));
this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("title")&&(a.title=this.title);return a};g.prototype._setAndNotifyLayer=function(a,b){var c=this.layer;this._get(a)!==b&&(this._set(a,b),c&&c.emit("wms-sublayer-update",{propertyName:a,id:this.id}))};var f;e([b.property()],g.prototype,"description",null);e([b.property({value:null})],g.prototype,"fullExtent",null);e([b.reader("fullExtent",["extent"])],g.prototype,"readExtent",null);e([b.property()],g.prototype,"fullExtents",
void 0);e([b.property()],g.prototype,"featureInfoFormat",void 0);e([b.property()],g.prototype,"featureInfoUrl",void 0);e([b.property({type:String,json:{write:{ignoreOrigin:!0}}})],g.prototype,"id",null);e([b.property({type:String,json:{origins:{"web-document":{read:{source:"legendUrl"},write:{target:"legendUrl",ignoreOrigin:!0}}},read:{source:"legendURL"},write:{ignoreOrigin:!0}}})],g.prototype,"legendUrl",void 0);e([b.property({value:!0,type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"},
origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],g.prototype,"legendEnabled",void 0);e([b.property({value:null})],g.prototype,"layer",null);e([b.property({type:String,value:null,json:{read:{source:"name"},write:{ignoreOrigin:!0}}})],g.prototype,"name",null);e([b.property()],g.prototype,"parent",void 0);e([b.property({type:Boolean,json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],g.prototype,"popupEnabled",void 0);e([b.property({type:Boolean,json:{write:{ignoreOrigin:!0}}})],
g.prototype,"queryable",void 0);e([b.property()],g.prototype,"sublayers",null);e([b.cast("sublayers")],g.prototype,"castSublayers",null);e([b.property({type:[Number],json:{read:{source:"spatialReferences"}}})],g.prototype,"spatialReferences",void 0);e([b.property({type:String,value:null,json:{write:{ignoreOrigin:!0}}})],g.prototype,"title",null);e([b.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"}}})],g.prototype,"visible",null);return g=f=e([b.subclass("esri.layers.support.WMSSublayer")],
g)}(b.declared(c))})},"esri/views/SceneView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/dom dojo/when ../Camera ../geometry ../Graphic ../Viewpoint ../core/asyncUtils ../core/Error ../core/Handles ../core/has ../core/lang ../core/Logger ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/watch ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/lib/gl-matrix ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O,J,Q,H,K,R,P,L,T,S,W,Y,X,aa,U,ha,Z,ba,ka,ga,ia,na,wa,za,Aa,sa,ma,Ea,Ha,Na){var xa=u.getLogger("esri.views.SceneView");f=function(f){function u(a){a=f.call(this)||this;a._layerViewsUpdatingHandles={};a._clippingArea=null;a._internallyReady=!1;a._userClippingArea=null;a._initialDefaultSpatialReference=null;a._defaults={};a._externallySet={environment:!1};a._handles=new r;a._createGraphicsViewPromise=null;a._updateUpdatingMonitorsHandle=
null;a._mapLayersChangeHandle=null;a._updateDrawingOrderHandle=null;a._stageFrameTask=null;a.onViewExtentUpdateHandle=null;a._resolveWhenReady=[];a.resourceController=new ga(a);a.deconflictor=new H(a);a.labeler=new K.Labeler({view:a});a.renderSpatialReference=null;a.sharedSymbolResources=null;a.basemapTerrain=null;a.elevationProvider=null;a.camera=null;a.canvas=null;a.center=null;a.constraints=new G.default;a.extent=null;a.fullOpacity=1;a.graphicsView=null;a.map=null;a.screenSizePerspectiveEnabled=
!0;a.state=null;a.scale=null;a.isHeightModelInfoRequired=!0;a.alphaCompositingEnabled=!1;a.supersampleScreenhotsEnabled=!0;a.type="3d";a.ui=new Ha;a.updating=!1;a.updatingPercentage=0;a.viewpoint=null;a.zoom=null;a.highlightOptions=new U;z.when(a,"ready",a._viewReadyHandler.bind(a));a._evaluateUpdating=a._evaluateUpdating.bind(a);a.watch("map",function(a){a&&a.load&&a.load()});a.inputManager=new Q({view:a});a.stateManager=new S.ViewStateManager({view:a});return a}k(u,f);u.prototype.getDefaults=function(a){var b=
this.inherited(arguments);b.environment||a.environment||(this._defaults.environment=new O,b.environment=this._defaults.environment);return b};u.prototype.initialize=function(){var a=this;this.environmentManager=new J.default({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});z.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));this.resourceController.memoryEvents.on("updating-changed",
function(){return a._evaluateUpdating()});z.init(this.qualitySettings,"gpuMemoryLimit",function(b){a.resourceController&&(a.resourceController.maxGpuMemory=b)});z.init(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&(a.resourceController.additionalCacheMemory=b)});z.init(this.qualitySettings,"frameRate",function(a){v.setFrameRate(a)});z.init(X,"SCENEVIEW_LOCKING_LOG",function(b){a.defaultsFromMap.logDebugInformation=b})};u.prototype.destroy=function(){this.activeTool=
null;A.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._handles.removeAll();this.inputManager&&(this.inputManager.destroy(),this._set("inputManager",null))};Object.defineProperty(u.prototype,"activeTool",{set:function(a){if(a&&!this.ready)xa.error("#activeTool\x3d","cannot set active tool while view is not ready");else{var b=this._get("activeTool");a!==b&&(b&&b.deactivate(),
this._set("activeTool",a),a&&a.activate())}},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var b=this.get("map.clippingEnabled"),c=this.get("map.clippingArea");if(!b||!c)return this._clippingArea=null;if(!(c instanceof a.Extent))return xa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(D.canProject(c.spatialReference,
this.spatialReference))c=D.project(c,this.spatialReference);else return xa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&c&&this._clippingArea.equals(c)?this._clippingArea:this._clippingArea=c},set:function(a){this.ready&&"global"===this.viewingMode&&a?xa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});
Object.defineProperty(u.prototype,"dataExtent",{get:function(){var b=[],c=this.spatialReference||a.SpatialReference.WGS84,d=this.clippingArea;d&&(d=D.project(d,c));var e=function(a){a&&(a=D.project(a,c))&&(d&&(a=a.intersection(d)),a&&b.push(a))},g=this._get("basemapTerrain");g&&g.spatialReference&&e(new a.Extent({xmin:g.extent[0],ymin:g.extent[1],zmin:0,xmax:g.extent[2],ymax:g.extent[3],zmax:0,spatialReference:g.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){e(a.fullExtent)});
return 0<b.length?(g=b.reduce(function(a,b){return a.union(b)}),g.hasZ?(g.zmin=Math.min(0,g.zmin),g.zmax=Math.max(0,g.zmax)):(g.zmin=0,g.zmax=0),g):new a.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:c})},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);a?a instanceof O?this._set("environment",a):a instanceof Na?(this.environment.lighting=a.lighting,this.environment.background=
w.clone(a.background),this.environment.atmosphereEnabled=a.atmosphereEnabled,this.environment.starsEnabled=a.starsEnabled):a.declaredClass?this._set("environment",a):this._set("environment",new O(a)):this._set("environment",new O)},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"groundExtent",{get:function(){var b=this._get("basemapTerrain");if(b&&b.spatialReference){var c=b.extent;return new a.Extent({xmin:c[0],ymin:c[1],xmax:c[2],ymax:c[3],spatialReference:b.spatialReference})}return new a.Extent({spatialReference:this.spatialReference||
a.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"initialExtentRequired",{get:function(){return!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});u.prototype._mapSetter=function(a){a!==this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),
a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))};Object.defineProperty(u.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||aa.getDefaultProfile()},set:function(a){aa.isValidProfile(a)&&(aa.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"slicePlane",{set:function(a){this._stage.setRenderParams({slicePlane:a});this._set("slicePlane",
a)},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"resolution",{get:function(){return null!=this.spatialReference?E.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?B.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"viewingMode",{get:function(){var a=
this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?xa.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});u.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};
u.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};u.prototype.toMap=function(a,b,c){if(!this.ready)return xa.error("#toMap()","Scene view cannot be used before it is ready"),null;var d;"number"===typeof a?(d=a,a=b):(d=a.x,a=a.y,c=b);b=this.sceneIntersectionHelper.pickSelectorInScreen([d,this.height-a]).minResult;return this._computeMapPointFromIntersectionResult(b,c)};u.prototype.toScreen=function(a,b,c,d){if(!this.ready)return xa.error("#toScreen()",
"Scene view cannot be used before it is ready"),null;"number"===typeof a?("object"===typeof c&&(d=c),Z.vectorToVector([a,b,"number"===typeof c?c:0],this.spatialReference,ya,this.renderSpatialReference)):(Z.pointToVector(a,ya,this.renderSpatialReference),d=b);return this.engineToScreen(ya,d)};u.prototype.pixelSizeAt=function(b,c){if(!this.ready)return xa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof b){if(b=this.sceneIntersectionHelper.pickSelectorInScreen([b,
this.height-c]).minResult,!b.getIntersectionPoint(ya))return 0}else if(b instanceof a.Point)Z.pointToVector(b,ya,this.renderSpatialReference);else if(b=this.sceneIntersectionHelper.pickSelectorInScreen([b.x,this.height-b.y]).minResult,!b.getIntersectionPoint(ya))return 0;return this.state.camera.computePixelSizeAt(ya)};u.prototype.hitTest=function(b,d){if(!this.ready)return xa.error("#hitTest()","Scene view cannot be used before it is ready"),null;var e,g;"number"===typeof b?(e=b,g=d):(e=b.x,g=b.y);
var h=this.sceneIntersectionHelper.pickSelectorInScreen([e,this.height-g],null,null,!0);b=h.minResult;var l=this._computeMapPointFromIntersectionResult(b);d=null;if(b.target)switch(b.target.type){case "stage":d=this._getGraphicFromStageObject(b.target.obj,b.triangleNr);break;case "external":switch(b.intersector){case "PointRenderer":d=c(this._getGraphicFromPointRenderer(b.target));break;case "LodRenderer":d=this._getGraphicFromLodRenderer(b.target)}}return c(d).catch(function(){return null}).then(function(b){var c=
[];(b||l)&&c.push({mapPoint:l,graphic:b});b={screenPoint:new a.ScreenPoint({x:e,y:g}),results:c};X.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(b.selector=h);return b})};u.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};u.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){return b._stage.takeScreenshot(ma.toRenderSettings(a,b))})};u.prototype.destroyLayerViews=function(){for(var a in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[a].remove();
this._layerViewsUpdatingHandles={};this.stateManager.deinit();this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null};u.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||
this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};u.prototype.validate=function(){var a=Ea.check();t("safari")&&9>t("safari")&&(a=new q("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:t("safari")}));return a?(xa.warn("#validate()",a.message),x.reject(a)):x.resolve()};u.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,
g=a.isWGS84,h="local"===this.viewingMode,l=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(l){if(h&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!h&&!e&&!g)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!g)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(b)if(za.isTiledLayer(b)){if(d=
void 0,l?l=za.getTiledLayerInfo(b,a,this.viewingMode):(l=za.getTiledLayerInfo(b,a,"global"),null==l.tileInfo&&(l=za.getTiledLayerInfo(b,a,"local"))),d=null!=l.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((g||e)&&!h)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),l||this._internallyReady||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+
b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};u.prototype.whenReady=function(){var a=this;return x.create(function(b){a._internallyReady?b(a):a._resolveWhenReady.push(b)})};u.prototype.engineToScreen=function(b,c){var d=L.vec3d.create();this.state.camera.projectPoint(b,d);b=d[0];var e=this.height-d[1],d=d[2];return c?(c.x=b,c.y=e,c.z=d,c):new a.ScreenPoint({x:b,y:e,z:d})};u.prototype.flushDisplayModifications=function(){this._stage.processDirty()};
u.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})};u.prototype.getViewForGraphic=function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):this.graphicsView};u.prototype.whenViewForGraphic=function(a){var b=this;return a.layer?this.whenLayerView(a.layer):this.graphicsView||this._createGraphicsViewPromise||0<this.graphics.length?z.whenOnce(this,"graphicsView").then(function(){return b.graphicsView}):
x.reject()};u.prototype._computeMapPointFromIntersectionResult=function(a,b){if(a.getIntersectionPoint(ya)){b=this._computeMapPointFromVec3d(ya,b);var c=this._get("basemapTerrain");"TerrainRenderer"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null};u.prototype._computeMapPointFromVec3d=function(b,c){var d=this.spatialReference||a.SpatialReference.WGS84;Z.vectorToVector(b,this.renderSpatialReference,b,d)||(d=a.SpatialReference.WGS84,Z.vectorToVector(b,this.renderSpatialReference,
b,d));c?(c.x=b[0],c.y=b[1],c.z=b[2],c.spatialReference=d):c=new a.Point(b,d);return c};u.prototype._getGraphicFromStageObject=function(a,b){var c=a.getMetadata();if(null!=c&&null!=c.layerUid){if(this.graphicsView&&c.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(a.metadata.graphicUid);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){if(c&&!c.suspended){if(c.getGraphicFromStageObject)return c.getGraphicFromStageObject(a,
b);if(c.getGraphicFromGraphicUid&&null!=a.metadata.graphicUid)return c.getGraphicFromGraphicUid(a.metadata.graphicUid)}})}return null};u.prototype._getGraphicFromPointRenderer=function(a){var b=this._computeMapPointFromVec3d(a.point),b=new l(b);a=a.metadata.layerUid;null!=a&&b.set("layer",this.map.findLayerByUid(a));return b};u.prototype._getGraphicFromLodRenderer=function(a){var b=a.metadata;if(null!=b&&null!=b.layerUid){if(this.graphicsView&&b.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(b.graphicUid);
if(a=this.map.findLayerByUid(b.layerUid))return this.whenLayerView(a).then(function(a){if(a&&!a.suspended)return a.getGraphicFromGraphicUid(b.graphicUid)})}return null};u.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};u.prototype._initBasemapTerrain=function(a){var b=this;this._disposeBasemapTerrain();this._set("basemapTerrain",new wa(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new Y({view:this}));this.elevationProvider.register("ground",
this.basemapTerrain);this._handles.add([z.init(this,"map.ground.opacity",function(a){b.basemapTerrain.baseOpacity=null!=a?a:1}),z.init(this,"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a})],"basemapTerrain")};u.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,0,0,0]});this._initBasemapTerrain(a);this._set("pointsOfInterest",new na.default({view:this}));this._set("featureTiles",new R.default({renderCoordsHelper:this.renderCoordsHelper,
cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,filterExtent:null,resourceController:this.resourceController}));this._handles.add(this.featureTiles.watch("updating",function(){return b._evaluateUpdating()}));this._handles.add(z.init(X,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTilesDebugger?b.featureTilesDebugger=new P.FeatureTileTree3DDebugger(b):!a&&b.featureTilesDebugger&&
(b.featureTilesDebugger.destroy(),b.featureTilesDebugger=null)}),"feature-tiles");this._handles.add(z.init(this,["clippingArea","basemapTerrain.extent"],function(){if(b.clippingArea||b.basemapTerrain.extent)if(b.basemapTerrain.extent&&b.basemapTerrain.spatialReference){var a=C.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference);b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a}else b.featureTiles.filterExtent=b.clippingArea;else b.featureTiles.filterExtent=
null},!0),"feature-tiles");this._initStateManager()};u.prototype._initCoordinateSystem=function(){if(this.spatialReference){var a=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(a)||this._set("mapCoordsHelper",new ha.default(this.map,a));var b="global"===this.viewingMode,a=b?Z.SphericalECEFSpatialReference:a;a!==this.renderSpatialReference&&(this.renderSpatialReference=a,this._set("renderCoordsHelper",ka.createRenderCoordsHelper(b?"global":"local",a)),this.sceneIntersectionHelper&&
this.sceneIntersectionHelper.setTolerance(sa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};u.prototype._evaluateUpdating=function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});if(this._createGraphicsViewPromise||this.graphicsView&&this.graphicsView.updating||this.resourceController&&this.resourceController.updating||
this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating)c=!0;c!==this.updating&&this._set("updating",c);a=0!==b?a/b:c?100:0;this.updatingPercentage!==a&&this._set("updatingPercentage",a)};u.prototype._updateUpdatingMonitors=function(a){for(var b=0;b<a.removed.length;b++){var c=a.removed[b],d=this._layerViewsUpdatingHandles[c.uid];d&&(delete this._layerViewsUpdatingHandles[c.uid],c.destroyed||d.remove())}for(b=0;b<a.added.length;b++)c=a.added[b],c.destroyed||(d=c.watch(["updating",
"updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[c.uid]=d);this._evaluateUpdating()};u.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this._mapLayersChangeHandle=a(this._mapLayersChangeHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",
null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};u.prototype._disposeBasemapTerrain=function(){var a=this._get("basemapTerrain");a&&(this._handles.remove("basemapTerrain"),a.destroy(),this._set("basemapTerrain",null))};u.prototype._initStage=function(){var a=this,b={};b.renderContext=this.renderContext;b.deactivatedWebGLExtensions=
this.deactivatedWebGLExtensions;b.viewingMode=this.viewingMode;b.alpha=this.alphaCompositingEnabled;b.supersampleScreenshots=this.supersampleScreenhotsEnabled;this.renderCanvas&&(b.canvas=this.renderCanvas);var c=new W.SceneIntersectionHelper(this.viewingMode,{getPickableLayers:function(){var b=a._stage.getLayers(),c=[];Object.keys(b).forEach(function(a){a=b[a];a.isPickable&&c.push(a)});return c}},{camera:function(){return a.state.camera},extent:function(){return a.dataExtent},slicePlane:function(){return a.slicePlane}});
this._set("sceneIntersectionHelper",c);this._stage=new Aa(this.viewingMode,h.byId(this.surface),b,c);this._handles.add(z.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),"stage");b=function(){a._stage.setRenderParams({defaultHighlightOptions:U.toEngineOptions(a.highlightOptions)})};this._handles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],
b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(sa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=v.addFrameTask(this._stage.getFrameTask())};u.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ia.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest,
viewState:this.state})};u.prototype._createGraphicsViewIfNeeded=function(){this.graphicsView||this._createGraphicsViewPromise||0===this.graphics.length||(this._handles.remove("graphics-view"),this._createGraphicsViewPromise=p.safeCast(this._createGraphicsViewAsync()),this._createGraphicsViewPromise.isFulfilled()&&(this._createGraphicsViewPromise=null),this._evaluateUpdating())};u.prototype._createGraphicsViewAsync=function(){return d(this,void 0,void 0,function(){var a;return g(this,function(b){switch(b.label){case 0:return[4,
x.create(function(a){return m(["./3d/layers/GraphicsView3D"],a)})];case 1:return a=b.sent(),[4,z.whenTrueOnce(this.basemapTerrain,"ready")];case 2:return b.sent(),this._set("graphicsView",new a({view:this})),this._layerViewsUpdatingHandles[this.graphicsView.mockLayerId]=z.init(this.graphicsView,"updating",this._evaluateUpdating),this._createGraphicsViewPromise=null,this._evaluateUpdating(),[2]}})})};u.prototype._disposeGraphicsView=function(){this._createGraphicsViewPromise&&(this._createGraphicsViewPromise.cancel(),
this._createGraphicsViewPromise=null);this._handles.remove("graphics-view");if(this.graphicsView){var a=this.graphicsView.mockLayerId;this._layerViewsUpdatingHandles[a].remove();delete this._layerViewsUpdatingHandles[a];this.graphicsView.destroy();this._set("graphicsView",null)}};u.prototype._initState=function(){this._set("state",new T.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};u.prototype._initStateManager=function(){this.stateManager.init()};u.prototype._viewReadyHandler=
function(a,b){var c=this;b||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._handles.add(z.on(this,"graphics","change",function(){return c._createGraphicsViewIfNeeded()},function(){return c._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewPromise&&this._handles.remove("graphics-view"),this._evaluateUpdating(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),
this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this)),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),a=this._resolveWhenReady,this._resolveWhenReady=[],a.forEach(function(a){return a(c)}))};u.prototype._viewUnreadyHandler=function(a,b){b&&(this.activeTool&&(this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),
this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),this._stage=null),this._handles.remove("stage"),this._set("canvas",null))};u.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in
b&&(b.drawingOrder=a-c)})};e([y.property({value:null})],u.prototype,"activeTool",null);e([y.property({type:I,readOnly:!0,aliasOf:"state.animation"})],u.prototype,"animation",void 0);e([y.property({readOnly:!0})],u.prototype,"basemapTerrain",void 0);e([y.property({readOnly:!0})],u.prototype,"elevationProvider",void 0);e([y.property({type:b,aliasOf:"stateManager.camera"})],u.prototype,"camera",void 0);e([y.property({readOnly:!0})],u.prototype,"canvas",void 0);e([y.property({type:a.Point,aliasOf:"stateManager.center"})],
u.prototype,"center",void 0);e([y.property({type:a.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],u.prototype,"clippingArea",null);e([y.property({type:G.default})],u.prototype,"constraints",void 0);e([y.property({type:a.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],u.prototype,"dataExtent",null);e([y.property({value:null})],u.prototype,"environment",null);e([y.property()],u.prototype,"environmentManager",void 0);e([y.property({type:a.Extent,
aliasOf:"stateManager.extent"})],u.prototype,"extent",void 0);e([y.property({type:a.ScreenPoint,readOnly:!0,aliasOf:"stateManager.screenCenter"})],u.prototype,"screenCenter",void 0);e([y.property({aliasOf:"stateManager.frustum"})],u.prototype,"frustum",void 0);e([y.property({type:Number,readOnly:!0})],u.prototype,"fullOpacity",void 0);e([y.property({readOnly:!0})],u.prototype,"graphicsView",void 0);e([y.property({type:a.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],u.prototype,"groundExtent",
null);e([y.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],u.prototype,"initialExtentRequired",null);e([y.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],u.prototype,"interacting",null);e([y.property()],u.prototype,"map",void 0);e([y.property({readOnly:!0})],u.prototype,"mapCoordsHelper",void 0);e([y.property({aliasOf:"stateManager.padding"})],u.prototype,"padding",void 0);e([y.property({type:na.default,readOnly:!0})],u.prototype,"pointsOfInterest",void 0);
e([y.property({type:R.default,readOnly:!0})],u.prototype,"featureTiles",void 0);e([y.property({type:P.FeatureTileTree3DDebugger})],u.prototype,"featureTilesDebugger",void 0);e([y.property({type:Boolean})],u.prototype,"screenSizePerspectiveEnabled",void 0);e([y.property({constructOnly:!0})],u.prototype,"deactivatedWebGLExtensions",void 0);e([y.property({constructOnly:!0})],u.prototype,"renderCanvas",void 0);e([y.property({readOnly:!0})],u.prototype,"state",void 0);e([y.property({readOnly:!0})],u.prototype,
"inputManager",void 0);e([y.property({readOnly:!0})],u.prototype,"stateManager",void 0);e([y.property()],u.prototype,"qualityProfile",null);e([y.property({type:ba,get:function(){var a=this._get("qualitySettings");a||(a=new ba,aa.apply(this.qualityProfile,a));return a}})],u.prototype,"qualitySettings",void 0);e([y.property()],u.prototype,"slicePlane",null);e([y.property({dependsOn:["viewingMode"]})],u.prototype,"ready",void 0);e([y.property({readOnly:!0})],u.prototype,"renderCoordsHelper",void 0);
e([y.property({readOnly:!0})],u.prototype,"sceneIntersectionHelper",void 0);e([y.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],u.prototype,"resolution",null);e([y.property({type:Number,aliasOf:"stateManager.scale"})],u.prototype,"scale",void 0);e([y.property()],u.prototype,"heightModelInfo",null);e([y.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],u.prototype,"spatialReference",void 0);e([y.property({type:Boolean})],
u.prototype,"isHeightModelInfoRequired",void 0);e([y.property({type:Boolean,constructOnly:!0})],u.prototype,"alphaCompositingEnabled",void 0);e([y.property({type:Boolean,constructOnly:!0})],u.prototype,"supersampleScreenhotsEnabled",void 0);e([y.property()],u.prototype,"type",void 0);e([y.property({type:Ha})],u.prototype,"ui",void 0);e([y.property({type:Boolean,readOnly:!0})],u.prototype,"updating",void 0);e([y.property({type:Number,readOnly:!0})],u.prototype,"updatingPercentage",void 0);e([y.property({type:["global",
"local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],u.prototype,"viewingMode",null);e([y.property({type:n,aliasOf:"stateManager.viewpoint"})],u.prototype,"viewpoint",void 0);e([y.property({type:Number,aliasOf:"stateManager.zoom"})],u.prototype,"zoom",void 0);e([y.property({type:U})],u.prototype,"highlightOptions",void 0);return u=e([y.subclass("esri.views.SceneView")],u)}(y.declared(M,N,F));var ya=L.vec3d.create();return f})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?c.small:b<=a.medium?c.medium:b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?c.small:b<=a.medium?c.medium:b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},q={xsmall:544,small:768,medium:992,large:1200};return function(h){function f(){var a=null!==h&&h.apply(this,arguments)||this;a._breakpointsHandles=new b;a.breakpoints=q;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}
k(f,h);f.prototype.initialize=function(){this._breakpointsHandles.add([a.init(this,["breakpoints","size"],this._updateClassNames)])};f.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};f.prototype._updateClassNames=function(){if(this.container){var a=c.acquire(),b=c.acquire(),d=!1,e,g,h;for(e in p)g=this[e],h=p[e].getValue({viewSize:this.size,breakpoints:this.breakpoints}),g!==h&&(d=!0,this[e]=h,b.push(p[e].valueToClassName[g]),
a.push(p[e].valueToClassName[h]));d&&(this._applyClassNameChanges(a,b),c.release(a),c.release(b))}};f.prototype._applyClassNameChanges=function(a,b){var c=this.container;c&&(d.remove(c,b),d.add(c,a))};f.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var b in p)d.remove(a,p[b].valueToClassName[this[b]])};e([l.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var c=JSON.stringify(q,null,
2);console.warn("provided breakpoints are not valid, using defaults:"+c)}a=b?a:q;this._set("breakpoints",g({},a))}}})],f.prototype,"breakpoints",void 0);e([l.property()],f.prototype,"orientation",void 0);e([l.property()],f.prototype,"widthBreakpoint",void 0);e([l.property()],f.prototype,"heightBreakpoint",void 0);return f=e([l.subclass("esri.views.BreakpointsOwner")],f)}(l.declared(h,n))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct dojo/on ../core/Accessor ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./PopupManager ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){var w=[0,0];return function(b){function c(){var c=b.call(this)||this;c._domHandles=new a;c._freqInfo={freq:16,time:750};c._overlayRenderTaskHandle=null;c.height=0;c.popup=new t({view:c});c.position=null;c.resizing=!1;c.root=null;c.surface=null;c.suspended=!0;c.ui=null;c.userContent=null;c.width=0;c.watch("cursor",function(a){var b=c.surface;b&&b.setAttribute("data-cursor",a)});c.watch("interacting",function(a){var b=c.surface;b&&b.setAttribute("data-interacting",
a.toString())});c._focusEvent=c._focusEvent.bind(c);c._blurEvent=c._blurEvent.bind(c);return c}k(c,b);c.prototype.initialize=function(){this.watch("ui",this._handleUIChange);this._wireUI(this.ui)};c.prototype.destroy=function(){this.ui.destroy();this.popup&&!this.popup.destroyed&&this.popup.destroy();this.container=null;this._domHandles.destroy()};Object.defineProperty(c.prototype,"container",{set:function(a){var b=this,c=this._get("container");if(c!==a){this._domHandles.remove("dom-size");this._stopMeasuring();
if(c){var e=this.surface;e&&(e.removeEventListener("focus",this._focusEvent),e.removeEventListener("blur",this._blurEvent));c.classList.remove("esri-view");this.popupManager.destroy();this._set("popupManager",null);this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null);this.overlay.destroy();this._set("overlay",null);d.destroy(this.root);this._set("root",null);d.destroy(this.userContent);this._set("userContent",null)}if(a){a.classList.add("esri-view");
c=document.createElement("div");for(c.className="esri-view-user-storage";a.hasChildNodes();)c.appendChild(a.firstChild);a.appendChild(c);c=document.createElement("div");c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var h=document.createElement("div");h.className="esri-view-surface";h.setAttribute("role","application");h.tabIndex=0;h.addEventListener("focus",this._focusEvent);h.addEventListener("blur",this._blurEvent);g.setSelectable(h,!1);c.appendChild(h);this._set("surface",
h);e=new r;c.appendChild(e.surface);this._set("overlay",e);e.watch("needsRender",function(a){a&&!b._overlayRenderTaskHandle?b._overlayRenderTaskHandle=l.addFrameTask({render:function(){b.overlay.render()}}):b._overlayRenderTaskHandle&&(b._overlayRenderTaskHandle.remove(),b._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._domHandles.add(n.init(this,"size",function(a){var b=a[1];h.classList.toggle("esri-view-surface--inset-outline",a[0]>=document.body.clientWidth||b>=document.body.clientHeight)}),
"dom-size");this._set("container",a);this._startMeasuring();a=new q({enabled:!0,view:this});this._set("popupManager",a)}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"focused",{get:function(){return document.activeElement===this.surface},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){return[this.width,
this.height]},enumerable:!0,configurable:!0});c.prototype.blur=function(){this.surface&&this.surface.blur()};c.prototype.focus=function(){this.surface&&this.surface.focus()};c.prototype.pageToContainer=function(a,b,c){var d=this.position;a-=d[0];b-=d[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};c.prototype.containerToPage=function(a,b,c){var d=this.position;a+=d[0];b+=d[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};c.prototype._handleUIChange=function(a,b){b&&(this._domHandles.remove("ui"),b.destroy());a&&this._wireUI(a);
this._set("ui",a)};c.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([n.init(this,"root",function(b){a.container=b?d.create("div",null,b):null}),n.init(this,"popup",function(b,c){c&&(a.remove(c,"popup"),c!==b&&c.destroy());b&&(b.view=a.view,a.add(b,{key:"popup",position:"manual"}))})],"ui"))};c.prototype._focusEvent=function(a){this.notifyChange("focused");this.emit("focus",{native:a})};c.prototype._blurEvent=function(a){this.notifyChange("focused");
this.emit("blur",{native:a})};c.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};c.prototype._startMeasuring=function(){var a=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([h(window,"resize",function(){b.freq=16;b.time=750}),l.addFrameTask({prepare:function(b){var c=a._measure(),d=a._freqInfo;d.time+=b.deltaTime;c&&(d.freq=16,a._get("resizing")||a._set("resizing",!0));d.time<d.freq||(d.time=0,a._position()||
c?d.freq=16:d.freq=Math.min(750,2*d.freq),!c&&512<=d.freq&&a._get("resizing")&&a._set("resizing",!1))}})],"measuring");this._measure();this._position()};c.prototype._measure=function(){var a=this.container,b=a?a.clientWidth:0,c=a?a.clientHeight:0;if(0===b||0===c||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var a=this.width,d=this.height;if(b===a&&c===d)return this.suspended&&this._set("suspended",!1),!1;this._set("width",b);this._set("height",
c);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:a,oldHeight:d,width:b,height:c});return!0};c.prototype._position=function(){var a=this.container,b=this.position,c=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();w[0]=a.left+c.pageXOffset;w[1]=a.top+c.pageYOffset;return b&&w[0]===b[0]&&w[1]===b[1]?!1:(this._set("position",[w[0],w[1]]),!0)};e([p.property({value:null,cast:function(a){return g.byId(a)}})],c.prototype,"container",null);e([p.property({readOnly:!0,
dependsOn:["surface"]})],c.prototype,"focused",null);e([p.property({readOnly:!0})],c.prototype,"height",void 0);e([p.property({type:t})],c.prototype,"popup",void 0);e([p.property({type:q})],c.prototype,"popupManager",void 0);e([p.property({type:r})],c.prototype,"overlay",void 0);e([p.property({readOnly:!0})],c.prototype,"position",void 0);e([p.property({readOnly:!0})],c.prototype,"resizing",void 0);e([p.property({readOnly:!0})],c.prototype,"root",void 0);e([p.property({value:null,dependsOn:["width",
"height"],readOnly:!0})],c.prototype,"size",null);e([p.property({readOnly:!0})],c.prototype,"surface",void 0);e([p.property({readOnly:!0})],c.prototype,"suspended",void 0);e([p.property()],c.prototype,"ui",void 0);e([p.property({readOnly:!0})],c.prototype,"userContent",void 0);e([p.property({readOnly:!0})],c.prototype,"width",void 0);return c=e([p.subclass("esri.views.DOMContainer")],c)}(p.declared(c,b))})},"esri/views/PopupManager":function(){define("../core/promiseUtils dojo/on dojo/Deferred ../layers/graphics/dehydratedFeatures ../geometry/support/scaleUtils ../geometry/Extent ../tasks/support/Query ../layers/GroupLayer ../core/Accessor".split(" "),
function(m,f,k,e,g,d,h,c,b){return b.createSubclass({declaredClass:"esri.views.PopupManager",properties:{map:{dependsOn:["view.map"],readOnly:!0}},constructor:function(){this._featureLayersCache={}},destroy:function(){this._featureLayersCache={};this.view=null},_clickHandle:null,_featureLayersCache:null,enabled:!1,_enabledSetter:function(a){this._clickHandle&&(a?this._clickHandle.resume():this._clickHandle.pause());this._set("enabled",a)},_mapGetter:function(){return this.get("view.map")||null},view:null,
_viewSetter:function(a){this._clickHandle&&(this._clickHandle.remove(),this._clickHandle=null);a&&(this._clickHandle=f.pausable(a,"click",this._clickHandler.bind(this)),this.enabled||this._clickHandle.pause());this._set("view",a)},_closePopup:function(){var a=this.get("view.popup");a&&(a.clear(),a.close())},_showPopup:function(a,b,f){function l(a){return t.allLayerViews.find(function(b){return b.layer===a})}function n(a){if(null==a)return!1;var b=l(a);return null==b?!1:a.loaded&&!b.suspended&&(a.popupEnabled&&
a.popupTemplate||"graphics"===a.type||"geo-rss"===a.type||"map-notes"===a.type||"kml"===a.type||b.getPopupData)}function r(a){return(a=l(a))&&a.hasDraped}var t=this.view;a=t.popup;var w=this,u=[],x="3d"===t.type;this.map.layers.toArray().forEach(function(a){a.isInstanceOf(c)?a.layers.toArray().forEach(function(a){n(a)&&(!x||l(a)&&l(a).getPopupData||r(a))&&u.push(a)}):n(a)&&(!x||l(a)&&l(a).getPopupData||r(a))&&u.push(a)});0<t.graphics.length&&u.push(t.graphics);(f&&t.graphics.includes(f)?f.getEffectivePopupTemplate():
!f||n(f.layer))||(f=null);if(u.length||f){var v=[],z=!!f,y=w._calculateClickTolerance(u);if(b){var A=1;"2d"===t.type&&(A=t.state.resolution);var B=t.basemapTerrain;B&&B.overlayManager&&(A=B.overlayManager.overlayPixelSizeInMapUnits(b));y*=A;B&&!B.spatialReference.equals(t.spatialReference)&&(y*=g.getMetersPerUnitForSR(B.spatialReference)/g.getMetersPerUnitForSR(t.spatialReference));var B=b.clone().offset(-y,-y),y=b.clone().offset(y,y),C=new d(Math.min(B.x,y.x),Math.min(B.y,y.y),Math.max(B.x,y.x),
Math.max(B.y,y.y),t.spatialReference),B=function(a){var c;if("imagery"===a.type){c=new h;c.geometry=b;var d=l(a),g={rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0};g.layerView=d;c=a.queryVisibleRasters(c,g).then(function(a){z=z||0<a.length;return a})}else if("scene"===a.type||!w._featureLayersCache[a.id]&&"function"!==typeof a.queryFeatures){if("map-image"===a.type||"tile"===a.type||"wms"===a.type)return d=l(a),d.getPopupData(C);var g=[],k,n=!1;"esri.core.Collection\x3cesri.Graphic\x3e"===
a.declaredClass?(d=a,k=!0):"graphics"===a.type?(d=a.graphics,k=!0):(d=(d=l(a))&&d.loadedGraphics,k=!1,n=!0);d&&(g=d.filter(function(a){return a&&(!k||a.getEffectivePopupTemplate())&&a.visible&&C.intersects(a.geometry)}).toArray(),n&&(g=g.map(function(b){return e.hydrateGraphic(b,a)})));0<g.length&&(z=!0,c="scene"===a.type?w._fetchSceneAttributes(a,g):m.resolve(g))}else c=a.createQuery(),c.geometry=C,c=a.queryFeatures(c).then(function(b){b=b.features;if(f&&f.layer===a&&a.objectIdField){var c=a.objectIdField,
d=f.attributes[c];b=b.filter(function(a){return a.attributes[c]!==d})}if(!f&&"graphics3DGraphics"in l(a)){var e=[],g=l(a).graphics3DGraphics,h;for(h in g)e.push(g[h].graphic.attributes[a.objectIdField]);b=b.filter(function(b){return-1!==e.indexOf(b.attributes[a.objectIdField])})}z=z||0<b.length;return b});return c};if(x&&!f||!x)var v=u.map(B).filter(function(a){return!!a}),E=function(a){return a.reduce(function(a,b){return a.concat(b.items?E(b.items):b)},[])},v=E(v);f&&(f.layer&&"scene"===f.layer.type?
v.unshift(this._fetchSceneAttributes(f.layer,[f])):f.getEffectivePopupTemplate()&&(B=new k,v.unshift(B.resolve([f]))));v.some(function(a){return!a.isFulfilled()})||z?v.length&&a.open({promises:v,location:b}):w._closePopup()}else w._closePopup()}else w._closePopup()},_fetchSceneAttributes:function(a,b){return this.view.whenLayerView(a).then(function(c){var d=this._getOutFields(a.popupTemplate),e=b.map(function(a){return c.whenGraphicAttributes(a,d).catch(function(){return a})});return m.eachAlways(e)}.bind(this)).then(function(a){return a.map(function(a){return a.value})})},
_getOutFields:function(a){var b=["*"];if("esri.PopupTemplate"===a.declaredClass){var c=null==a.content||Array.isArray(a.content)&&a.content.every(function(a){return"attachments"===a.type||"fields"===a.type&&null==a.fieldInfos||"text"===a.type&&-1===a.text.indexOf("{")});a.fieldInfos&&!a.expressionInfos&&c&&(b=[],a.fieldInfos.forEach(function(a){var c=a.fieldName&&a.fieldName.toLowerCase();c&&"shape"!==c&&0!==c.indexOf("relationships/")&&b.push(a.fieldName)}))}return b},_calculateClickTolerance:function(a){var b=
6;a.forEach(function(a){if(a=a.renderer)"simple"===a.type?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):"unique-value"!==a.type&&"class-breaks"!==a.type||(a.uniqueValueInfos||a.classBreakInfos).forEach(function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b},_clickHandler:function(a){function b(a){return d.allLayerViews.find(function(b){return b.layer===
a})}var d=this.view,e=a.screenPoint,g=this;if(0===a.button&&d.popup&&d.ready){var h="3d"===d.type,k=d.map.allLayers.some(function(a){if(a.isInstanceOf(c))return!1;var d;null==a?d=!1:(d=b(a),d=null==d?!1:a.loaded&&!d.suspended&&(a.popupEnabled&&a.popupTemplate||"graphics"===a.type||d.getPopupData));d&&!(d=!h)&&(d=(a=b(a))&&a.hasDraped);return d?!0:!1});null!=e?this.view.hitTest(e.x,e.y).then(function(b){k||0<b.results.length?0<b.results.length?(b=b.results[0],g._showPopup(a,b.mapPoint,b.graphic)):
g._showPopup(a,a.mapPoint,null):g._closePopup()}):g._showPopup(a,a.mapPoint)}}})})},"esri/layers/GroupLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/asyncUtils ../core/loadAll ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/utils ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ../support/LayersMixin".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){return function(h){function l(a){a=
h.call(this)||this;a._visibilityHandles={};a.fullExtent=void 0;a.operationalLayerType="GroupLayer";a.spatialReference=void 0;a.type="group";a._visibilityWatcher=a._visibilityWatcher.bind(a);return a}k(l,h);l.prototype.initialize=function(){this._enforceVisibility(this.visibilityMode,this.visible);this.watch("visible",this._visibleWatcher.bind(this),!0)};l.prototype._writeLayers=function(a,b,c,d){var e=[];if(!a)return e;a.forEach(function(a){a.write&&(a=a.write(null,d))&&a.layerType&&e.push(a)});b.layers=
e};Object.defineProperty(l.prototype,"visibilityMode",{set:function(a){var b=this._get("visibilityMode")!==a;this._set("visibilityMode",a);b&&this._enforceVisibility(a,this.visible)},enumerable:!0,configurable:!0});l.prototype.load=function(){this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]}));return this.when()};l.prototype.loadAll=function(){var a=this;return g.safeCast(d.loadAll(this,function(b){b(a.layers)}))};l.prototype.layerAdded=
function(a){a.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(a):"inherited"===this.visibilityMode&&(a.visible=this.visible);this._visibilityHandles[a.uid]=a.watch("visible",this._visibilityWatcher,!0)};l.prototype.layerRemoved=function(a){var b=this._visibilityHandles[a.uid];b&&(b.remove(),delete this._visibilityHandles[a.uid]);this._enforceVisibility(this.visibilityMode,this.visible)};l.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return c.create(function(a){m(["../views/layers/GroupLayerView"],
a)});case "3d":return c.create(function(a){m(["../views/layers/GroupLayerView"],a)})}};l.prototype._turnOffOtherLayers=function(a){this.layers.forEach(function(b){b!==a&&(b.visible=!1)})};l.prototype._enforceVisibility=function(b,c){if(a.getProperties(this).initialized){var d=this.layers,e=d.find(function(a){return a.visible});switch(b){case "exclusive":d.length&&!e&&(e=d.getItemAt(0),e.visible=!0);this._turnOffOtherLayers(e);break;case "inherited":d.forEach(function(a){a.visible=c})}}};l.prototype._visibleWatcher=
function(a){"inherited"===this.visibilityMode&&this.layers.forEach(function(b){b.visible=a})};l.prototype._visibilityWatcher=function(a,b,c,d){switch(this.visibilityMode){case "exclusive":a?this._turnOffOtherLayers(d):this._isAnyLayerVisible()||(d.visible=!0);break;case "inherited":d.visible=this.visible}};l.prototype._isAnyLayerVisible=function(){return this.layers.some(function(a){return a.visible})};e([b.property()],l.prototype,"fullExtent",void 0);e([b.property({json:{read:!1,write:{ignoreOrigin:!0}}})],
l.prototype,"layers",void 0);e([b.writer("layers")],l.prototype,"_writeLayers",null);e([b.property()],l.prototype,"operationalLayerType",void 0);e([b.property({json:{write:!1}})],l.prototype,"portalItem",void 0);e([b.property()],l.prototype,"spatialReference",void 0);e([b.property({json:{read:!1},readOnly:!0,value:"group"})],l.prototype,"type",void 0);e([b.property({json:{read:!1,write:!1}})],l.prototype,"url",void 0);e([b.property({type:String,value:"independent",json:{write:!0}})],l.prototype,"visibilityMode",
null);return l=e([b.subclass("esri.layers.GroupLayer")],l)}(b.declared(l,q,h,n,p))})},"esri/core/loadAll":function(){define("require exports ./tsSupport/generatorHelper ./tsSupport/awaiterHelper ./asyncUtils ./Collection ./Loadable".split(" "),function(m,f,k,e,g,d,h){function c(b,a){return e(this,void 0,void 0,function(){var c,f,m=this;return k(this,function(l){switch(l.label){case 0:return[4,b.load()];case 1:return l.sent(),c=[],f=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];
for(b=0;b<a.length;b++){var e=a[b];e&&(Array.isArray(e)?f.apply(void 0,e):d.isCollection(e)?e.forEach(function(a){return f(a)}):e.isInstanceOf&&e.isInstanceOf(h)&&c.push(e))}},a(f),[4,g.map(c,function(a){return e(m,void 0,void 0,function(){return k(this,function(b){switch(b.label){case 0:return"loadAll"in a&&"function"===typeof a.loadAll?[4,a.loadAll()]:[3,2];case 1:return b.sent(),[3,4];case 2:return[4,a.load()];case 3:b.sent(),b.label=4;case 4:return[2]}})})})];case 2:return l.sent(),[2,b]}})})}
Object.defineProperty(f,"__esModule",{value:!0});f.loadAll=c;f.default=c})},"esri/support/LayersMixin":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/collectionUtils ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../layers/Layer".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){function n(a,b,c){for(var d,e=0,g=a.length;e<g;e++)if(d=a.getItemAt(e),d[b]===c||d&&null!=d.layers&&
(d=n(d.layers,b,c)))return d}var p=d.ofType(l),q=c.getLogger("esri.support.LayersMixin");return function(c){function d(a){var b=c.call(this,a)||this;b.layers=new p;b.layers.on("after-add",function(a){a=a.item;a.parent&&a.parent!==b&&"remove"in a.parent&&a.parent.remove(a);a.parent=b;b.layerAdded(a);"elevation"===a.type&&q.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as an operational layer and will therefore be ignored.")});b.layers.on("after-remove",function(a){a=
a.item;a.parent=null;b.layerRemoved(a)});return b}k(d,c);d.prototype.destroy=function(){this.layers.drain(this.layerRemoved,this)};Object.defineProperty(d.prototype,"layers",{set:function(a){this._set("layers",h.referenceSetter(a,this._get("layers"),p))},enumerable:!0,configurable:!0});d.prototype.findLayerById=function(a){return n(this.layers,"id",a)};d.prototype.add=function(a,c){var d=this,e=this.layers;c=e.getNextIndex(c);a instanceof l?(a.parent===this&&this.reorder(a,c),e.add(a,c)):b.isThenable(a)?
a.then(function(a){d.destroyed||d.add(a,c)}):q.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")};d.prototype.addMany=function(a,b){var c=this,d=this.layers;b=d.getNextIndex(b);a.slice().forEach(function(a){a.parent===c?c.reorder(a,b):(d.add(a,b),b+=1)})};d.prototype.findLayerByUid=function(a){return n(this.layers,"uid",a)};d.prototype.remove=function(a){return this.layers.remove(a)};d.prototype.removeMany=function(a){return this.layers.removeMany(a)};d.prototype.removeAll=
function(){return this.layers.removeAll()};d.prototype.reorder=function(a,b){return this.layers.reorder(a,b)};d.prototype.layerAdded=function(a){};d.prototype.layerRemoved=function(a){};e([a.property({type:p,cast:h.castForReferenceSetter})],d.prototype,"layers",null);return d=e([a.subclass("esri.support.LayersMixin")],d)}(a.declared(g))})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c.items=new h;c._callbacks=new Map;c._projector=b.createProjector();c._hiddenProjector=b.createProjector();return c}k(d,a);Object.defineProperty(d.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";g.setSelectable(b,!1);this._set("surface",
b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(b){b.added.map(function(b){var c=function(){return b.render()};a._callbacks.set(b,c);a._projector.append(a.surface,c)});b.removed.map(function(b){var c=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(c.domNode);a._callbacks.delete(b)})})};d.prototype.addItem=function(a){this.items.add(a)};
d.prototype.removeItem=function(a){this.items.remove(a)};d.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};d.prototype.render=function(){this._projector.renderNow()};d.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,c=this._hiddenProjector,d=null,e=function(){return d=a.render()};c.append(b,e);c.renderNow();var g={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var h=d.domNode.getBoundingClientRect();g.left=
h.left;g.top=h.top;g.right=h.right;g.bottom=h.bottom}for(c.detach(e);b.firstChild;)b.removeChild(b.firstChild);return g};d.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};e([c.property({readOnly:!0})],d.prototype,"surface",void 0);e([c.property({readOnly:!0})],d.prototype,"items",void 0);e([c.property({readOnly:!0,dependsOn:["items.length"]})],
d.prototype,"needsRender",null);return d=e([c.subclass("esri.views.overlay.ViewOverlay")],d)}(c.declared(d))})},"maquette/dist/maquette.umd":function(){(function(m,f){"object"===typeof exports&&"undefined"!==typeof module?f(exports):"function"===typeof define&&define.amd?define(["exports"],f):f(m.maquette={})})(this,function(m){var f=[],k=function(a,b){var c={};Object.keys(a).forEach(function(b){c[b]=a[b]});b&&Object.keys(b).forEach(function(a){c[a]=b[a]});return c},e=function(a,b){return a.vnodeSelector!==
b.vnodeSelector?!1:a.properties&&b.properties?a.properties.key!==b.properties.key?!1:a.properties.bind===b.properties.bind:!a.properties&&!b.properties},g=function(a){if("string"!==typeof a)throw Error("Style values must be strings");},d=function(a,b,c,d){var g=a[b];if(""!==g.vnodeSelector){var h=g.properties;if(!(h&&(void 0===h.key?h.bind:h.key)))for(h=0;h<a.length;h++)if(h!==b&&e(a[h],g))throw Error(c.vnodeSelector+" had a "+g.vnodeSelector+" child "+("added"===d?d:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.");
}},h=[],c=!1,b=function(a){(a.children||[]).forEach(b);a.properties&&a.properties.afterRemoved&&a.properties.afterRemoved.apply(a.properties.bind||a.properties,[a.domNode])},a=function(){c=!1;h.forEach(b);h.length=0},l=function(b){h.push(b);c||(c=!0,"undefined"!==typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(a,{timeout:16}):setTimeout(a,16))},n=function(a){var b=a.domNode;if(a.properties){var c=a.properties.exitAnimation;if(c){b.style.pointerEvents="none";c(b,function(){b.parentNode&&
(b.parentNode.removeChild(b),l(a))},a.properties);return}}b.parentNode&&(b.parentNode.removeChild(b),l(a))},p=function(a,b,c){if(b)for(var d=c.eventHandlerInterceptor,e=Object.keys(b),h=e.length,l=function(h){h=e[h];var l=b[h];if("className"===h)throw Error('Property "className" is not supported, use "class".');if("class"===h)w(a,l,!0);else if("classes"===h){var k=Object.keys(l),f=k.length;for(h=0;h<f;h++){var m=k[h];l[m]&&a.classList.add(m)}}else if("styles"===h)for(k=Object.keys(l),f=k.length,h=
0;h<f;h++){var m=k[h],n=l[m];n&&(g(n),c.styleApplyer(a,m,n))}else"key"!==h&&null!==l&&void 0!==l&&(k=typeof l,"function"===k?0===h.lastIndexOf("on",0)&&(d&&(l=d(h,l,a,b)),"oninput"===h&&function(){var a=l;l=function(b){a.apply(this,[b]);b.target["oninput-value"]=b.target.value}}(),a[h]=l):"http://www.w3.org/2000/svg"===c.namespace?"href"===h?a.setAttributeNS("http://www.w3.org/1999/xlink",h,l):a.setAttribute(h,l):"string"===k&&"value"!==h&&"innerHTML"!==h?a.setAttribute(h,l):a[h]=l)},k=0;k<h;k++)l(k)},
q=function(a,b,c){var d=b.children;if(d)for(var e=0;e<d.length;e++)r(d[e],a,void 0,c);b.text&&(a.textContent=b.text);p(a,b.properties,c);b.properties&&b.properties.afterCreate&&b.properties.afterCreate.apply(b.properties.bind||b.properties,[a,c,b.vnodeSelector,b.properties,b.children])},r=function(a,b,c,d){var e,g=0,h=a.vnodeSelector,l=b.ownerDocument;if(""===h)e=a.domNode=l.createTextNode(a.text),void 0!==c?b.insertBefore(e,c):b.appendChild(e);else{for(var f=0;f<=h.length;++f){var m=h.charAt(f);
if(f===h.length||"."===m||"#"===m)m=h.charAt(g-1),g=h.slice(g,f),"."===m?e.classList.add(g):"#"===m?e.id=g:("svg"===g&&(d=k(d,{namespace:"http://www.w3.org/2000/svg"})),void 0!==d.namespace?e=a.domNode=l.createElementNS(d.namespace,g):(e=a.domNode=a.domNode||l.createElement(g),"input"===g&&a.properties&&void 0!==a.properties.type&&e.setAttribute("type",a.properties.type)),void 0!==c?b.insertBefore(e,c):e.parentNode!==b&&b.appendChild(e)),g=f+1}q(e,a,d)}},t,w=function(a,b,c){b&&b.split(" ").forEach(function(b){return a.classList.toggle(b,
c)})};t=function(a,b,c){var h=a.domNode;if(a===b)return!1;var l=!1;if(""===b.vnodeSelector){if(b.text!==a.text)return a=h.ownerDocument.createTextNode(b.text),h.parentNode.replaceChild(a,h),b.domNode=a,!0;b.domNode=h}else{0===b.vnodeSelector.lastIndexOf("svg",0)&&(c=k(c,{namespace:"http://www.w3.org/2000/svg"}));a.text!==b.text&&(l=!0,void 0===b.text?h.removeChild(h.firstChild):h.textContent=b.text);b.domNode=h;var m;m=a.children;var p=b.children,q=c;if(m===p)m=!1;else{m=m||f;for(var p=p||f,v=m.length,
u=p.length,x=0,z=0,y=!1;z<u;){var C=x<v?m[x]:void 0,A=p[z];if(void 0!==C&&e(C,A))y=t(C,A,q)||y,x++;else{b:{var C=m,D=A;if(""!==D.vnodeSelector)for(var E=x+1;E<C.length;E++)if(e(C[E],D)){C=E;break b}C=-1}if(0<=C){for(;x<C;x++)n(m[x]),d(m,x,b,"removed");y=t(m[C],A,q)||y;x=C+1}else r(A,h,x<v?m[x].domNode:void 0,q),A.properties&&(C=A.properties.enterAnimation)&&C(A.domNode,A.properties),d(p,z,b,"added")}z++}if(v>x)for(;x<v;x++)n(m[x]),d(m,x,b,"removed");m=y}l=m||l;m=a.properties;p=b.properties;q=c;if(p){v=
!1;u=Object.keys(p);z=u.length;for(y=0;y<z;y++)if(C=u[y],A=p[C],x=m[C],"class"===C)x!==A&&(w(h,x,!1),w(h,A,!0));else if("classes"===C)for(var D=h.classList,E=Object.keys(A),B=E.length,C=0;C<B;C++){var W=E[C],Y=!!A[W];Y!==!!x[W]&&(v=!0,Y?D.add(W):D.remove(W))}else if("styles"===C)for(D=Object.keys(A),E=D.length,C=0;C<E;C++)B=D[C],W=A[B],W!==x[B]&&(v=!0,W?(g(W),q.styleApplyer(h,B,W)):q.styleApplyer(h,B,""));else A||"string"!==typeof x||(A=""),"value"===C?(D=h[C],D!==A&&(h["oninput-value"]?D===h["oninput-value"]:
A!==x)&&(h[C]=A,h["oninput-value"]=void 0),A!==x&&(v=!0)):A!==x&&(x=typeof A,"function"===x&&q.eventHandlerInterceptor||("http://www.w3.org/2000/svg"===q.namespace?"href"===C?h.setAttributeNS("http://www.w3.org/1999/xlink",C,A):h.setAttribute(C,A):"string"===x&&"innerHTML"!==C?"role"===C&&""===A?h.removeAttribute(C):h.setAttribute(C,A):h[C]!==A&&(h[C]=A),v=!0));m=v}else m=void 0;l=m||l;b.properties&&b.properties.afterUpdate&&b.properties.afterUpdate.apply(b.properties.bind||b.properties,[h,c,b.vnodeSelector,
b.properties,b.children])}l&&b.properties&&b.properties.updateAnimation&&b.properties.updateAnimation(h,b.properties,a.properties);return!1};var u=function(a,b){return{getLastRender:function(){return a},update:function(c){if(a.vnodeSelector!==c.vnodeSelector)throw Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");var d=a;a=c;t(d,c,b)},domNode:a.domNode}},x={namespace:void 0,performanceLogger:function(){},eventHandlerInterceptor:void 0,
styleApplyer:function(a,b,c){a.style[b]=c}},v={create:function(a,b){b=k(x,b);r(a,document.createElement("div"),void 0,b);return u(a,b)},append:function(a,b,c){c=k(x,c);r(b,a,void 0,c);return u(b,c)},insertBefore:function(a,b,c){c=k(x,c);r(b,a.parentNode,a,c);return u(b,c)},merge:function(a,b,c){c=k(x,c);b.domNode=a;q(a,b,c);return u(b,c)},replace:function(a,b,c){c=k(x,c);r(b,a.parentNode,a,c);a.parentNode.removeChild(a);return u(b,c)}},z=function(a,b,c){for(var d=0,e=b.length;d<e;d++){var g=b[d];
Array.isArray(g)?z(a,g,c):null!==g&&void 0!==g&&!1!==g&&("string"===typeof g&&(g={vnodeSelector:"",properties:void 0,children:void 0,text:g.toString(),domNode:null}),c.push(g))}},y;y=Array.prototype.find?function(a,b){return a.find(b)}:function(a,b){return a.filter(b)[0]};var A=function(a,b){var c=a;b.forEach(function(a){c=c&&c.children?y(c.children,function(b){return b.domNode===a}):void 0});return c},B=function(a,b,c){var d=function(d){c("domEvent",d);var e=b(),g;g=d.currentTarget;for(var h=e.domNode,
l=[];g!==h;)l.push(g),g=g.parentNode;g=l;g.reverse();e=A(e.getLastRender(),g);a.scheduleRender();var k;e&&(k=e.properties["on"+d.type].apply(e.properties.bind||this,arguments));c("domEventProcessed",d);return k};return function(a,b,c,e){return d}};m.dom=v;m.h=function(a,b,c){if(Array.isArray(b))c=b,b=void 0;else if(b&&("string"===typeof b||b.hasOwnProperty("vnodeSelector"))||c&&("string"===typeof c||c.hasOwnProperty("vnodeSelector")))throw Error("h called with invalid arguments");var d,e;void 0!==
c&&1===c.length&&"string"===typeof c[0]?d=c[0]:c&&(e=[],z(a,c,e),0===e.length&&(e=void 0));return{vnodeSelector:a,properties:b,children:e,text:""===d?void 0:d,domNode:null}};m.createProjector=function(a){var b,c=k(x,a),d=c.performanceLogger,e=!0,g,h=!1,l=[],f=[],m=function(a,e,g){var h;c.eventHandlerInterceptor=B(b,function(){return h},d);h=a(e,g(),c);l.push(h);f.push(g)},n=function(){g=void 0;if(e){e=!1;d("renderStart",void 0);for(var a=0;a<l.length;a++){var b=f[a]();d("rendered",void 0);l[a].update(b);
d("patched",void 0)}d("renderDone",void 0);e=!0}};return b={renderNow:n,scheduleRender:function(){g||h||(g=requestAnimationFrame(n))},stop:function(){g&&(cancelAnimationFrame(g),g=void 0);h=!0},resume:function(){h=!1;e=!0;b.scheduleRender()},append:function(a,b){m(v.append,a,b)},insertBefore:function(a,b){m(v.insertBefore,a,b)},merge:function(a,b){m(v.merge,a,b)},replace:function(a,b){m(v.replace,a,b)},detach:function(a){for(var b=0;b<f.length;b++)if(f[b]===a)return f.splice(b,1),l.splice(b,1)[0];
throw Error("renderFunction was not found");}}};m.createCache=function(){var a,b;return{invalidate:function(){a=b=void 0},result:function(c,d){if(a)for(var e=0;e<c.length;e++)a[e]!==c[e]&&(b=void 0);b||(b=d(),a=c);return b}}};m.createMapping=function(a,b,c){var d=[],e=[];return{results:e,map:function(g){for(var h=g.map(a),l=e.slice(),k=0,f=0;f<g.length;f++){var m=g[f],n=h[f];if(n===d[k])e[f]=l[k],c(m,l[k],f),k++;else{for(var p=!1,q=1;q<d.length+1;q++){var r=(k+q)%d.length;if(d[r]===n){e[f]=l[r];c(g[f],
l[r],f);k=r+1;p=!0;break}}p||(e[f]=b(m,f))}}e.length=g.length;d=h}}};Object.defineProperty(m,"__esModule",{value:!0})})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ./support/widget ./support/widgetUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){function v(a,b){return void 0===b?"esri-popup__"+a:"esri-popup__"+a+"-"+b}var z={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},y=l.getLogger("esri.widgets.Popup");return function(l){function f(a){a=l.call(this)||this;a._blurContainer=!1;a._containerNode=null;a._mainContainerNode=null;a._featureMenuNode=null;a._focusContainer=!1;a._focusDockButton=!1;a._focusFeatureMenuButton=!1;a._focusFirstFeature=!1;a._handles=new b;a._displayActionTextLimit=
2;a._pointerOffsetInPx=16;a._spinner=null;a.actions=null;a.alignment="auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.features=null;a.featureNavigationEnabled=!0;a.goToOverride=null;a.highlightEnabled=null;a.location=null;a.featureWidgets=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedFeatureWidget=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=null;a.view=null;a.viewModel=new w;
a.visible=null;return a}k(f,l);f.prototype.postInitialize=function(){var a=this;this._addSelectedFeatureIndexHandle();this.own(n.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),n.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),n.watch(this,"viewModel.screenLocation",function(b,c){!!b!==!!c&&a.reposition()}),n.watch(this,"viewModel.features",function(b){return a._createFeatureWidgets(b)}),n.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),
function(){return a.reposition()}),n.watch(this,"spinnerEnabled",function(b){return a._spinnerEnabledChange(b)}),n.watch(this,"viewModel.view.size",function(b,c){return a._updateDockEnabledForViewSize(b,c)}),n.watch(this,"viewModel.view",function(b,c){return a._viewChange(b,c)}),n.watch(this,"viewModel.view.ready",function(b,c){return a._viewReadyChange(b,c)}),n.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),n.watch(this,["featureWidgets","viewModel.selectedFeatureIndex"],
function(){return a._updateFeatureWidget()}),n.watch(this,"selectedFeatureWidget.viewModel.title",function(b){return a._setTitleFromFeatureWidget(b)}),n.watch(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return a._setContentFromFeatureWidget()}),n.on(this,"viewModel","trigger-action",function(b){return a._zoomToAction(b)}))};f.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();
this._handles=null};Object.defineProperty(f.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||z},set:function(a){var b=g({},z),c=this.get("viewModel.view.breakpoints"),d={};c&&(d.width=c.xsmall,d.height=
c.xsmall);a=g({},b,a);b=g({},b.breakpoint,d);d=a.breakpoint;!0===d?a.breakpoint=b:"object"===typeof d&&(a.breakpoint=g({},b,d));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",!!a)},enumerable:!0,configurable:!0});f.prototype.blur=function(){this.visible||y.warn("Popup cannot be blurred while visible is false");
this._blurContainer=!0;this.scheduleRender()};f.prototype.clear=function(){};f.prototype.close=function(){this.visible=!1};f.prototype.focus=function(){this.visible||y.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};f.prototype.next=function(){return null};f.prototype.open=function(a){this._handles.remove("selected-index");this.set({featureMenuOpen:a?!!a.featureMenuOpen:!1});this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};f.prototype.previous=
function(){return null};f.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};f.prototype.triggerAction=function(a){return null};f.prototype.render=function(){var b,c,d,e,g,l,k,f=this.collapsed,m=this.collapseEnabled,n=this.dockEnabled,p=this.featureMenuOpen,q=this.featureNavigationEnabled,r=this.featureWidgets,t=this.visible,w=this.viewModel,z=w.allActions,y=w.content,A=w.featureCount,B=w.pendingPromisesCount,Y=w.selectedFeatureIndex,X=w.title,
w=1<A&&q,q=1<A&&p,aa=m&&!q&&f,f=z&&z.length,U=w&&this._getPageText(A,Y),ha=this._renderContent(),Z=x.isRtl(),ba=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):ha,ka=n?h.undock:h.dock,A=this.currentAlignment,z=this.currentDockPosition,B=B?u.tsx("div",{key:v("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":h.loading,title:h.loading},u.tsx("span",{"aria-hidden":"true",
class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,ga=(b={},b["esri-icon-layer-list"]=!q,b["esri-icon-close"]=q,b);b=u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ga)});ga=(c={},c["esri-icon-right-triangle-arrow"]=Z,c["esri-popup__pagination-previous-icon--rtl"]=Z,c["esri-icon-left-triangle-arrow"]=!Z,c["esri-popup__pagination-previous-icon"]=!Z,c);c=u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ga)});
ga=u.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":h.previous,title:h.previous},c);c=(d={},d["esri-icon-left-triangle-arrow"]=Z,d["esri-popup__pagination-next-icon--rtl"]=Z,d["esri-icon-right-triangle-arrow"]=!Z,d["esri-popup__pagination-next-icon"]=!Z,d);d=u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",c)});Z=u.tsx("div",{role:"button",
tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":h.next,title:h.next},d);c=x.cssTransition("enter","esri-popup--feature-updated");d=this.id+"-feature-menu";p=u.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),
"aria-haspopup":"true","aria-controls":d,"aria-expanded":p,"aria-label":h.menu,title:h.menu},b);U=u.tsx("div",{class:"esri-popup__pagination-page-text"},U);p=w?u.tsx("div",{class:"esri-popup__navigation-buttons",enterAnimation:c},ga,U,Z,B||p):null;U=this._wouldDockTo();U=(e={},e["esri-icon-minimize"]=n,e["esri-popup__icon--dock-icon"]=!n,e["esri-icon-dock-right"]=!n&&("top-right"===U||"bottom-right"===U),e["esri-icon-dock-left"]=!n&&("top-left"===U||"bottom-left"===U),e["esri-icon-maximize"]=!n&&
"top-center"===U,e["esri-icon-dock-bottom"]=!n&&"bottom-center"===U,e);e=u.tsx("span",{"aria-hidden":"true",class:this.classes(U,"esri-popup__icon")});e=this.get("dockOptions.buttonEnabled")?u.tsx("div",{role:"button","aria-label":ka,title:ka,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},e):null;m=m&&X&&(ba||f||w);
ka=(g={},g["esri-popup__header-title--button"]=m,g);U=m?"button":"heading";B=m?aa?h.expand:h.collapse:"";g=this.id+"-popup-title";X=X?u.tsx("h2",{class:this.classes("esri-popup__header-title",ka),key:X,enterAnimation:c,id:g,role:U,"aria-label":B,title:B,bind:this,tabIndex:m?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,innerHTML:X}):null;m=u.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});m=u.tsx("div",{role:"button",tabIndex:0,bind:this,
onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":h.close,title:h.close},m);m=u.tsx("header",{class:"esri-popup__header"},X,u.tsx("div",{class:"esri-popup__header-buttons"},e,m));e=this.id+"-popup-content";y=ba&&!aa?u.tsx("article",{key:y,enterAnimation:c,id:e,class:"esri-popup__content"},ha):null;ha=!aa&&("bottom-left"===A||"bottom-center"===A||"bottom-right"===A||"top-left"===z||"top-center"===z||"top-right"===z);aa=!aa&&("top-left"===A||"top-center"===A||"top-right"===
A||"bottom-left"===z||"bottom-center"===z||"bottom-right"===z);ba=q?null:u.tsx("div",{key:v("actions"),class:"esri-popup__actions"},this._renderActions());c=u.tsx("section",{key:v("navigation"),class:"esri-popup__navigation"},p);w=w||f?u.tsx("div",{key:v("feature-buttons"),class:"esri-popup__feature-buttons"},ba,c):null;Y=this._renderFeatureMenuNode(r,Y,q,d);r=a.substitute({total:r.length},h.selectedFeatures);d=u.tsx("section",{key:v("menu"),class:"esri-popup__feature-menu"},u.tsx("h2",{class:"esri-popup__feature-menu-header"},
r),u.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},Y));r=n?null:u.tsx("div",{key:v("pointer"),class:"esri-popup__pointer",role:"presentation"},u.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}));Y=this.get("selectedFeature.layer.title");f=this.get("selectedFeature.layer.id");ba=(l={},l["esri-popup--shadow"]=n,l);l=(k={},k["esri-popup--aligned-top-center"]=
t&&"top-center"===A,k["esri-popup--aligned-bottom-center"]=t&&"bottom-center"===A,k["esri-popup--aligned-top-left"]=t&&"top-left"===A,k["esri-popup--aligned-bottom-left"]=t&&"bottom-left"===A,k["esri-popup--aligned-top-right"]=t&&"top-right"===A,k["esri-popup--aligned-bottom-right"]="bottom-right"===A,k["esri-popup--is-docked"]=t&&n,k["esri-popup--shadow"]=t&&!n,k["esri-popup--is-docked-top-left"]=t&&"top-left"===z,k["esri-popup--is-docked-top-center"]=t&&"top-center"===z,k["esri-popup--is-docked-top-right"]=
t&&"top-right"===z,k["esri-popup--is-docked-bottom-left"]=t&&"bottom-left"===z,k["esri-popup--is-docked-bottom-center"]=t&&"bottom-center"===z,k["esri-popup--is-docked-bottom-right"]=t&&"bottom-right"===z,k["esri-popup--feature-menu-open"]=t&&q,k);k=ha?d:null;n=aa?d:null;q=ha?w:null;A=aa?w:null;k=u.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",ba),tabIndex:-1,role:"dialog","aria-labelledby":X?g:"","aria-describedby":y?e:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},q,k,m,y,A,n);return u.tsx("div",{key:v("base"),class:this.classes("esri-popup",l),role:"presentation","data-layer-title":Y,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},t?[k,r]:null)};f.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};f.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};
f.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};f.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===c.ESCAPE&&(a.stopPropagation(),this.featureMenuOpen=!1)};f.prototype._handleFeatureMenuItemKeyup=function(a){var b=a.keyCode,d=this._featureMenuNode,e=this.get("features.length"),g=a.currentTarget["data-feature-index"];d&&(d=d.querySelectorAll("li"),b===c.UP_ARROW?(a.stopPropagation(),d[(g-1+e)%e].focus()):b===c.DOWN_ARROW?
(a.stopPropagation(),d[(g+1+e)%e].focus()):b===c.HOME?(a.stopPropagation(),d[0].focus()):b===c.END&&(a.stopPropagation(),d[d.length-1].focus()))};f.prototype._handleMainKeyup=function(a){var b=a.keyCode;b===c.LEFT_ARROW&&(a.stopPropagation(),this.previous());b===c.RIGHT_ARROW&&(a.stopPropagation(),this.next())};f.prototype._zoomToAction=function(a){a.action&&!a.action.disabled&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};f.prototype._spinnerEnabledChange=function(a){this._destroySpinner();
a&&(a=this.get("viewModel.view"),this._createSpinner(a))};f.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,c=b.location;b.waitingForResult?a.show({location:c}):a.hide()}};f.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};f.prototype._renderAction=function(b,c,d,e){var g=this,l,k,f=n.watch(b,"active className disabled id title image visible".split(" "),function(){return g.scheduleRender()});this._handles.add(f,e);f=this.get("selectedFeature.attributes");
"zoom-to"===b.id&&(b.title=h.zoom,b.className="esri-icon-zoom-in-magnifying-glass");e=b.title;var m=b.className,p=b.image,m=p||m?m:"esri-icon-default-action";e=e&&f?a.substitute(f,e):e;var q=m&&f?a.substitute(f,m):m,f=p&&f?a.substitute(f,p):p,p=(l={},l["esri-icon-loading-indicator"]=b.active,l["esri-rotating"]=b.active,l["esri-popup__icon"]=!!m,l["esri-popup__action-image"]=!b.active&&!!f,l);q&&(p[q]=!b.active);l=(k={},k["esri-popup__action"]="toggle"!==b.type,k["esri-popup__action-toggle"]="toggle"===
b.type,k["esri-popup__action-toggle--on"]="toggle"===b.type&&b.value,k["esri-popup__button--disabled"]=b.disabled,k);d=d<=this._displayActionTextLimit?u.tsx("span",{key:"text",class:"esri-popup__action-text"},e):null;return b.visible?u.tsx("div",{key:b,role:"button",tabIndex:0,title:e,"aria-label":e,class:this.classes("esri-popup__button",l),bind:this,"data-action-index":c,onclick:this._triggerAction,onkeydown:this._triggerAction},u.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",
p),styles:this._getIconStyles(f)}),d):null};f.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var b=this.viewModel.allActions;if(b){var c=b.length;return b.map(function(b,d){return a._renderAction(b,d,c,"actions")}).toArray()}};f.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=n.watch(this,"viewModel.selectedFeatureIndex",function(b,c){return a._selectedFeatureIndexUpdated(b,c)});this._handles.add(b,"selected-index")};f.prototype._selectedFeatureIndexUpdated=
function(a,b){var c=this.featureMenuOpen;this.featureCount&&c&&a!==b&&-1!==a&&(this.featureMenuOpen=!1)};f.prototype._updateFeatureWidget=function(){var a=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedFeatureWidget",a)};f.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};f.prototype._createFeatureWidgets=function(a){var b=this.featureWidgets.slice(0),
c=this.get("viewModel.view"),d=[];a.forEach(function(a,e){if(a){var g=null;b.some(function(c,d){c&&c.graphic===a&&(g=c,b.splice(d,1));return!!g});d[e]=g||new q({contentEnabled:!1,graphic:a,view:c})}});b.forEach(function(a){return a&&a.destroy()});this._set("featureWidgets",d)};f.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};f.prototype._isOutsideView=function(a){var b=a.popupHeight,c=a.popupWidth,d=a.screenLocation,e=a.side;a=a.view;if(isNaN(c)||
isNaN(b)||!a||!d)return!1;var g=a.padding;return"right"===e&&d.x+c/2>a.width-g.right||"left"===e&&d.x-c/2<g.left||"top"===e&&d.y-b<g.top||"bottom"===e&&d.y+b>a.height-g.bottom?!0:!1};f.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,b=this._containerNode,c=this._mainContainerNode,e=this.viewModel,g=e.screenLocation,e=e.view;if(!g||!e||!b)return"top-center";if(!this._isScreenLocationWithinView(g,e))return this._get("currentAlignment")||"top-center";var h=c?window.getComputedStyle(c,
null):null,c=h?parseInt(h.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,h=h?parseInt(h.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,l=d.getContentBox(b),b=l.w+a,l=Math.max(l.h,c,h)+a,a=this._isOutsideView({popupHeight:l,popupWidth:b,screenLocation:g,side:"right",view:e}),c=this._isOutsideView({popupHeight:l,popupWidth:b,screenLocation:g,side:"left",view:e}),h=this._isOutsideView({popupHeight:l,popupWidth:b,screenLocation:g,side:"top",view:e}),g=this._isOutsideView({popupHeight:l,
popupWidth:b,screenLocation:g,side:"bottom",view:e});return c?h?"bottom-right":"top-right":a?h?"bottom-left":"top-left":h?g?"top-center":"bottom-center":"top-center"};f.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};f.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};f.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",
this._getCurrentDockPosition())};f.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};f.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};f.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};f.prototype._renderFeatureMenuItemNode=function(a,b,c,d){var e,g=b===c;d=(e={},e["esri-popup__feature-menu-item--selected"]=
g,e);e=g?u.tsx("span",{key:v("feature-menu-selected-feature-"+c),title:h.selectedFeature,"aria-label":h.selectedFeature,class:"esri-icon-check-mark"}):null;a=u.tsx("span",{innerHTML:a.title||h.untitled});return u.tsx("li",{role:"menuitem",tabIndex:-1,key:v("feature-menu-feature-"+c),class:this.classes(d,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},u.tsx("span",{class:"esri-popup__feature-menu-title"},
a,e))};f.prototype._renderFeatureMenuNode=function(a,b,c,d){var e=this;return 1<a.length?u.tsx("ol",{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,d){return e._renderFeatureMenuItemNode(a,d,b,c)})):null};f.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),b=x.isRtl()?"top-left":"top-right";if(!a)return b;var c=
a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&c<=a.xsmall?"bottom-center":b};f.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return u.tsx("div",{key:a,innerHTML:a});if(u.isWidget(a))return u.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return u.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});if(u.isWidgetBase(a))return u.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};
f.prototype._attachToNode=function(a){a.appendChild(this)};f.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var b=this.viewModel.screenLocation,c=d.getContentBox(a);if(b=this._calculatePositionStyle(b,c))a.style.top=b.top,a.style.left=b.left,a.style.bottom=b.bottom,a.style.right=b.right}};f.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===
b||"bottom-right"===b?a+c:a};f.prototype._calculateAlignmentPosition=function(a,b,c,d){var e=this.currentAlignment,g=this._pointerOffsetInPx;d/=2;var h=c.height-b;c=c.width-a;var l=this.view.padding;if("bottom-center"===e)return{top:b+g-l.top,left:a-d-l.left};if("top-left"===e)return{bottom:h+g-l.bottom,right:c+g-l.right};if("bottom-left"===e)return{top:b+g-l.top,right:c+g-l.right};if("top-right"===e)return{bottom:h+g-l.bottom,left:a+g-l.left};if("bottom-right"===e)return{top:b+g-l.top,left:a+g-l.left};
if("top-center"===e)return{bottom:h+g-l.bottom,left:a-d-l.left}};f.prototype._calculatePositionStyle=function(a,b){var c=this.view;if(c){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&b&&(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,a.y,c,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};f.prototype._viewChange=function(a,
b){a&&b&&(this.close(),this.clear())};f.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),this._wireUpView(a)):b&&(this.close(),this.clear())};f.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};f.prototype._dockingThresholdCrossed=function(a,b,c){var d=a[0];a=a[1];var e=b[0];b=b[1];var g=c.width;c=c.height;return d<=g&&e>g||d>g&&e<=g||a<=c&&b>c||a>c&&b<=c};f.prototype._updateDockEnabledForViewSize=
function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=c.left+c.right,e=c.top+c.bottom,c=[],g=[];c[0]=a[0]-d;c[1]=a[1]-e;g[0]=b[0]-d;g[1]=b[1]-e;a=this.dockOptions;this._dockingThresholdCrossed(c,g,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};f.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};f.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=
a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};f.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};f.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};f.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};f.prototype._toggleScreenLocationEnabled=
function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};f.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return c||a};f.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};f.prototype._getPageText=function(b,
c){return a.substitute({index:c+1,total:b},h.pageText)};f.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};f.prototype._createSpinner=function(a){a&&(this._spinner=new r({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};f.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};f.prototype._close=function(){this.close();this.view&&this.view.focus()};f.prototype._toggleDockEnabled=
function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};f.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.featureMenuOpen=a};f.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);this.viewModel.triggerAction(a)};f.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||
(this.viewModel.selectedFeatureIndex=a)};f.prototype._next=function(){this.next()};f.prototype._previous=function(){this.previous()};e([p.aliasOf("viewModel.actions"),u.renderable()],f.prototype,"actions",void 0);e([p.property()],f.prototype,"alignment",void 0);e([p.aliasOf("viewModel.autoCloseEnabled")],f.prototype,"autoCloseEnabled",void 0);e([p.aliasOf("viewModel.content"),u.renderable()],f.prototype,"content",void 0);e([p.property(),u.renderable()],f.prototype,"collapsed",void 0);e([p.property(),
u.renderable()],f.prototype,"collapseEnabled",void 0);e([p.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),u.renderable()],f.prototype,"currentAlignment",null);e([p.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),u.renderable()],f.prototype,"currentDockPosition",null);e([p.property(),u.renderable()],f.prototype,"dockOptions",null);e([p.property(),u.renderable()],f.prototype,"dockEnabled",void 0);e([p.aliasOf("viewModel.featureCount"),u.renderable()],
f.prototype,"featureCount",void 0);e([p.property({dependsOn:["viewModel.visible"]}),u.renderable()],f.prototype,"featureMenuOpen",null);e([p.aliasOf("viewModel.features"),u.renderable()],f.prototype,"features",void 0);e([p.property(),u.renderable()],f.prototype,"featureNavigationEnabled",void 0);e([p.aliasOf("viewModel.goToOverride")],f.prototype,"goToOverride",void 0);e([p.aliasOf("viewModel.highlightEnabled")],f.prototype,"highlightEnabled",void 0);e([p.aliasOf("viewModel.location"),u.renderable()],
f.prototype,"location",void 0);e([p.property({readOnly:!0}),u.renderable()],f.prototype,"featureWidgets",void 0);e([p.aliasOf("viewModel.promises")],f.prototype,"promises",void 0);e([p.aliasOf("viewModel.selectedFeature"),u.renderable()],f.prototype,"selectedFeature",void 0);e([p.aliasOf("viewModel.selectedFeatureIndex"),u.renderable()],f.prototype,"selectedFeatureIndex",void 0);e([p.property({readOnly:!0}),u.renderable()],f.prototype,"selectedFeatureWidget",void 0);e([p.property()],f.prototype,"spinnerEnabled",
void 0);e([p.aliasOf("viewModel.title"),u.renderable()],f.prototype,"title",void 0);e([p.aliasOf("viewModel.updateLocationEnabled")],f.prototype,"updateLocationEnabled",void 0);e([p.aliasOf("viewModel.view")],f.prototype,"view",void 0);e([p.property({type:w}),u.renderable("viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),u.vmEvent(["triggerAction","trigger-action"])],
f.prototype,"viewModel",void 0);e([p.aliasOf("viewModel.visible"),u.renderable()],f.prototype,"visible",void 0);e([p.aliasOf("viewModel.clear")],f.prototype,"clear",null);e([p.aliasOf("viewModel.next")],f.prototype,"next",null);e([p.aliasOf("viewModel.previous")],f.prototype,"previous",null);e([p.aliasOf("viewModel.triggerAction")],f.prototype,"triggerAction",null);e([u.accessibleHandler()],f.prototype,"_toggleCollapsed",null);e([u.accessibleHandler()],f.prototype,"_close",null);e([u.accessibleHandler()],
f.prototype,"_toggleDockEnabled",null);e([u.accessibleHandler()],f.prototype,"_toggleFeatureMenu",null);e([u.accessibleHandler()],f.prototype,"_triggerAction",null);e([u.accessibleHandler()],f.prototype,"_selectFeature",null);e([u.accessibleHandler()],f.prototype,"_next",null);e([u.accessibleHandler()],f.prototype,"_previous",null);return f=e([p.subclass("esri.widgets.Popup")],f)}(p.declared(t))})},"esri/widgets/Feature":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/uriUtils ./support/widget".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){function r(a,b){return void 0===b?"esri-feature__"+a:"esri-feature__"+a+"-"+b}return function(a){function f(b){b=a.call(this)||this;b._chartMap=new Map;b._activeMediaMap=new Map;b._chartRequirePromise=null;b._refreshTimers=new Map;b._mediaInfo=new Map;b.contentEnabled=null;b.graphic=null;b.title=null;b.view=null;b.viewModel=new l;return b}k(f,a);f.prototype.postInitialize=function(){var a=this;this.own(c.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
f.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};f.prototype.render=function(){var a=q.tsx("div",{key:r("loading-container"),class:"esri-feature__loading-container"},q.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return q.tsx("div",{class:"esri-feature"},q.tsx("div",
{class:"esri-feature__size-container"},q.tsx("div",{class:"esri-feature__main-container"},a)))};f.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};f.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};f.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};f.prototype._cancelChartModules=function(){var a=this._chartRequirePromise;a&&a.cancel();this._chartRequirePromise=null};f.prototype._destroyChart=function(a){var b=this._chartMap.get(a);
b&&(b.chart.destroy(),b.tooltip.destroy());this._chartMap.delete(a)};f.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};f.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return q.tsx("div",{key:r("content-string"),innerHTML:a});if(q.isWidget(a))return q.tsx("div",{key:r("content-widget")},a.render());if(a instanceof HTMLElement)return q.tsx("div",{key:r("content-html-element"),
bind:a,afterCreate:this._attachToNode});if(q.isWidgetBase(a))return q.tsx("div",{key:r("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?q.tsx("div",{key:r("content-content-elements")},a.map(this._renderContentElement,this)):null};f.prototype._renderContentElement=function(a,b){switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,
b);default:return null}};f.prototype._renderAttachmentInfo=function(a){var b,c,d=a.attachmentInfo,e=a.supportsResizeAttachments,h=d.contentType;a=d.name;var l=d.url,k=e&&n.isSupportedImage(h),f=-1===l.indexOf("?")?"?":"\x26",h=k?""+l+f+"w\x3d48":n.getIconPath(h),k=(b={},b["esri-feature__attachment-item-mask--icon"]=!k,b);b=(c={},c["esri-feature__attachments-image--resizable"]=e,c);return q.tsx("li",{class:"esri-feature__attachments-item",key:d},q.tsx("a",{class:"esri-feature__attachments-item-link",
href:l,target:"_blank"},q.tsx("div",{class:this.classes(k,"esri-feature__attachment-item-mask")},q.tsx("img",{alt:a,class:this.classes(b,"esri-feature__attachments-image"),title:a,src:h}),q.tsx("span",{class:"esri-feature__attachments-image-overlay"},q.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),q.tsx("span",{class:"esri-feature__attachments-filename"},a||g.noTitle)))};f.prototype._renderAttachments=function(a,b){var c=this,d,e=a.displayType,
h=(b=a.attachmentInfos)&&b.length,l=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),e=(d={},d["esri-feature__attachments--list"]="preview"!==e,d["esri-feature__attachments--preview"]="preview"===e,d);return h?q.tsx("div",{key:r("attachments-element"),class:this.classes("esri-feature__attachments","esri-feature__content-element",e)},q.tsx("div",{class:"esri-feature__attachments-title"},g.attach),q.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,d){return c._renderAttachmentInfo({attachmentInfo:b,
attachmentInfoIndex:d,supportsResizeAttachments:l,contentElement:a})}))):null};f.prototype._forceLTR=function(a){return"\x26lrm;"+a};f.prototype._renderFieldInfo=function(a,b){var c,d=this.viewModel.formattedAttributes,e=d?d.content[b]||d.global:null,g=a.fieldName,d=a.label||g,e=e?null==e[g]?"":e[g]:"";a=!(!a.format||!a.format.dateFormat);e="number"!==typeof e||a?p.autoLink(e):this._forceLTR(e);a=(c={},c["esri-feature__field-data--date"]=a,c);return q.tsx("tr",{key:r("fields-element-info-row",b)},
q.tsx("th",{key:r("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:d}),q.tsx("td",{key:r("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:e}))};f.prototype._renderFields=function(a,b){var c=this;return(a=a.fieldInfos)?q.tsx("div",{key:r("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},q.tsx("table",{class:"esri-widget__table",summary:g.fieldsSummary,key:r("fields-element-table",
b)},q.tsx("tbody",{key:r("fields-element-table-body",b)},a.map(function(a){return c._renderFieldInfo(a,b)})))):null};f.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};f.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};f.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};
f.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+(d?"#":"")+d};f.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};f.prototype._setupMediaRefreshTimers=function(){var a=this;
this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})};f.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};f.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,e=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(e.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(e.sourceURL,
a)},b),this._refreshTimers.set(a,b))};f.prototype._renderMediaInfoType=function(a,b){var c=a.value,d=a.title,d=void 0===d?"":d,e=a.type,g=a.refreshInterval,h=c.sourceURL,c=c.linkURL;if("image"===e)return a=this._shouldOpenInNewTab(c)?"_blank":"_self",h=(g=g?this._mediaInfo.get(b):null)?g.sourceURL:h,b=q.tsx("img",{alt:d,key:r("media-image-"+(g?g.timestamp:0),b),src:h}),(d=c?q.tsx("a",{title:d,href:c,target:a},b):null)?d:b;if(-1!==e.indexOf("chart"))return q.tsx("div",{key:r("chart",b),bind:this,"data-media-info":a,
"data-content-element-index":b,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};f.prototype._getChartDependencies=function(a){var b=this,c=a["data-media-info"],d=a["data-content-element-index"],e=c.value,g=e.theme||"Claro",l=c.type,k=g;"string"===typeof g&&(k=g.replace(/\./g,"/"));this._cancelChartModules();this._chartRequirePromise=h.create(function(a){return m(["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip","dojox/charting/themes/"+
k],function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return a(b)})}).then(function(c){b._renderChart(a,d,l,e,c[0],c[1],c[2]);b._chartRequirePromise=null})};f.prototype._renderChart=function(a,b,c,d,e,g,h){a=new e(a,{margins:{l:4,t:4,r:4,b:4}});h&&a.setTheme(h);switch(c){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",d.chartOptions);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,
majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.chartOptions.forEach(function(a,b){a.x=b+1});a.addSeries("Series A",d.chartOptions);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",d.chartOptions);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,
majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",d.chartOptions)}c=new g(a);a.render();this._chartMap.set(b,{chart:a,tooltip:c})};f.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var c=this._renderMediaInfoType(a,b),d=a.title?q.tsx("div",{key:r("media-title",b),class:"esri-feature__media-item-title",innerHTML:a.title}):null;a=a.caption?q.tsx("div",{key:r("media-caption",b),class:"esri-feature__media-item-caption",innerHTML:a.caption}):null;return q.tsx("div",
{key:r("media-container",b),class:"esri-feature__media-item-container"},q.tsx("div",{key:r("media-item-container",b),class:"esri-feature__media-item"},c),d,a)};f.prototype._renderMediaStatsItem=function(a,b,c){c="chart"===c?this.classes("esri-feature__media-chart-icon","esri-icon-chart"):this.classes("esri-feature__media-image-icon","esri-icon-media");return q.tsx("li",{class:"esri-feature__media-image-summary"},q.tsx("span",{"aria-hidden":"true",class:c}),q.tsx("span",{class:"esri-feature__media-count",
"aria-label":a},"("+b+")"))};f.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?g.previous:g.next,d=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),e=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),h=a?this.classes("esri-feature__icon",
"esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),l=a?this._previousClick:this._nextClick;return q.tsx("div",{key:r(a?"previous":"next",b),title:c,tabIndex:0,role:"button",class:d,"data-content-element-index":b,bind:this,onkeydown:l,onclick:l},q.tsx("span",{"aria-hidden":"true",class:e}),q.tsx("span",{"aria-hidden":"true",class:h}),q.tsx("span",{class:"esri-icon-font-fallback-text"},
c))};f.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],c=a.keyCode;c===d.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(b));c===d.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(b))};f.prototype._renderMedia=function(a,b){var c;a=a.mediaInfos;var d=this._getMediaStats(a),e=d.total,h=(c={},c["esri-feature--media-pagination-visible"]=1<d.total,c);c=this._renderMediaStatsItem(g.numImages,d.images,"image");var d=this._renderMediaStatsItem(g.numCharts,
d.charts,"chart"),l=this._renderMediaPageButton("previous",b),k=this._renderMediaPageButton("next",b),f=this._activeMediaMap.get(b);isNaN(f)&&(this._activeMediaMap.set(b,0),f=0);return e?q.tsx("div",{key:r("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",h)},q.tsx("ul",{class:"esri-feature__media-summary"},c,d),q.tsx("div",{key:r("media-element-container",b),class:"esri-feature__media-container"},
l,this._renderMediaInfo(a[f],b),k)):null};f.prototype._renderText=function(a,b){return a.text?q.tsx("div",{key:r("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};f.prototype._attachToNode=function(a){a.appendChild(this)};f.prototype._getMediaStats=function(a){var b=0,c=0;a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&c++});return{total:c+b,images:b,charts:c}};f.prototype._setContentElementMedia=function(a,
b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};f.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};f.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};f.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};
e([b.aliasOf("viewModel.contentEnabled")],f.prototype,"contentEnabled",void 0);e([b.aliasOf("viewModel.graphic")],f.prototype,"graphic",void 0);e([b.aliasOf("viewModel.title")],f.prototype,"title",void 0);e([b.aliasOf("viewModel.view")],f.prototype,"view",void 0);e([b.property({type:l}),q.renderable(["viewModel.waitingForContent","viewModel.content"])],f.prototype,"viewModel",void 0);e([q.accessibleHandler()],f.prototype,"_previousClick",null);e([q.accessibleHandler()],f.prototype,"_nextClick",null);
return f=e([b.subclass("esri.widgets.Feature")],f)}(b.declared(a))})},"esri/widgets/Widget":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom ../core/Accessor ../core/Collection ../core/Evented ../core/Handles ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./support/widget maquette".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t=l.getLogger("esri.widgets.Widget"),w=0;return function(b){function h(c,
d){c=b.call(this)||this;c._attached=!1;c.destroyed=!1;c.domNode=null;c.iconClass="esri-icon-checkbox-unchecked";c.visible=!0;c._internalHandles=new a;c.render=c.render.bind(c);return c}e(h,b);h.prototype.normalizeCtorArgs=function(a,b){a=k({},a);b&&(a.container=b);return a};h.prototype.initialize=function(){var a=this;this._internalHandles.add(this._renderableProps.map(function(b){return n.init(a,b,function(a,d){var e=this;c.isCollection(d)&&this._internalHandles.remove(this.declaredClass+":"+b+"-collection-change-event-listener");
c.isCollection(a)&&(a=a.on("change",function(){return e.scheduleRender()}),this._internalHandles.add(a,this.declaredClass+":"+b+"-collection-change-event-listener"));this.scheduleRender()})}));this._delegatedEventNames.length&&this._internalHandles.add(n.init(this,"viewModel",function(){a._get("viewModel")&&a._internalHandles.remove("delegated-events");a._delegatedEventNames.map(function(b){return a.viewModel.on(b,function(c){a.emit(b,c)})})}),"delegated-events");this.postInitialize();this._internalHandles.add(n.whenOnce(this,
"container",function(b){return a._attach(b)}))};h.prototype.postInitialize=function(){};h.prototype.destroy=function(){this.destroyed||(this.viewModel&&this.viewModel.destroy(),this._detach(this.container),this._internalHandles.destroy(),this._set("destroyed",!0))};h.prototype.startup=function(){t.warn("Widget.startup() is deprecated and no longer needed")};Object.defineProperty(h.prototype,"container",{set:function(a){this._get("container")||this._set("container",a)},enumerable:!0,configurable:!0});
h.prototype.castContainer=function(a){return d.byId(a)};Object.defineProperty(h.prototype,"id",{get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+w++},set:function(a){a&&this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"label",{get:function(){return this.declaredClass.split(".").pop()},enumerable:!0,configurable:!0});h.prototype.scheduleRender=function(){this._projector.scheduleRender()};h.prototype.on=function(a,
b){var c=this.inherited(arguments);this._internalHandles.add(c);return c};h.prototype.classes=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return q.classes.apply(this,a)};h.prototype.own=function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));this._internalHandles.add(a)};h.prototype.renderNow=function(){this._projector.renderNow()};h.prototype._attach=function(a){a&&(this._projector.merge(a,this.render),this._attached=!0)};h.prototype._detach=function(a){a&&
this._attached&&(this._projector.detach(this.render),a.parentNode&&a.parentNode.removeChild(a),this._attached=!1)};g([p.shared(r.createProjector())],h.prototype,"_projector",void 0);g([p.shared([])],h.prototype,"_renderableProps",void 0);g([p.shared([])],h.prototype,"_delegatedEventNames",void 0);g([p.property({value:null})],h.prototype,"container",null);g([p.cast("container")],h.prototype,"castContainer",null);g([p.property({readOnly:!0})],h.prototype,"destroyed",void 0);g([p.property({aliasOf:"container"})],
h.prototype,"domNode",void 0);g([p.property({readOnly:!0})],h.prototype,"iconClass",void 0);g([p.property({dependsOn:["container"]})],h.prototype,"id",null);g([p.property({readOnly:!0})],h.prototype,"label",null);g([p.property()],h.prototype,"viewModel",void 0);g([p.property()],h.prototype,"visible",void 0);return h=g([p.subclass("esri.widgets.Widget")],h)}(p.declared(h,b))})},"esri/widgets/support/widget":function(){define("require exports ./decorators ./jsxFactory ./widgetUtils ./shim/SVGElement".split(" "),
function(m,f,k,e,g){function d(d){for(var c in d)f.hasOwnProperty(c)||(f[c]=d[c])}Object.defineProperty(f,"__esModule",{value:!0});d(k);d(e);d(g);f.isWidget=function(d){return d&&"function"===typeof d.render};f.isWidgetBase=function(d){return d&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup}})},"esri/widgets/support/decorators":function(){define(["require","exports","./decorators/accessibleHandler",
"./decorators/renderable","./decorators/vmEvent"],function(m,f,k,e,g){function d(d){for(var c in d)f.hasOwnProperty(c)||(f[c]=d[c])}Object.defineProperty(f,"__esModule",{value:!0});d(k);d(e);d(g)})},"esri/widgets/support/decorators/accessibleHandler":function(){define(["require","exports","dojo/keys"],function(m,f,k){function e(e){return function(d){for(var g=[],c=1;c<arguments.length;c++)g[c-1]=arguments[c];c=d.type;if(d instanceof KeyboardEvent||"keyup"===c||"keydown"===c||"keypress"===c){if(d.keyCode===
k.ENTER||d.keyCode===k.SPACE)d.preventDefault(),d.target.click()}else e.call.apply(e,[this,d].concat(g))}}Object.defineProperty(f,"__esModule",{value:!0});f.accessibleHandler=function(){return function(g,d){return{value:e(g[d])}}}})},"esri/widgets/support/decorators/renderable":function(){define(["require","exports","./propUtils"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.renderable=function(e){var g="string"===typeof e?k.splitProps(e):e;return function(d,e){d._renderableProps||
(d._renderableProps=[]);d=d._renderableProps;g?d.push.apply(d,k.normalizePropNames(g,e)):d.push(e)}}})},"esri/widgets/support/decorators/propUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.splitProps=function(k){return k.split(",").map(function(e){return e.trim()})};f.normalizePropNames=function(k,e){return k.map(function(g){g=0===g.indexOf(e)?g:e+"."+g;return g})}})},"esri/widgets/support/decorators/vmEvent":function(){define(["require",
"exports","./propUtils"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.vmEvent=function(e){return function(g){g._delegatedEventNames||(g._delegatedEventNames=[]);var d=Array.isArray(e)?e:k.splitProps(e);g._delegatedEventNames=g._delegatedEventNames.concat(d)}}})},"esri/widgets/support/jsxFactory":function(){define(["require","exports","maquette-jsx"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.tsx=k.jsx})},"maquette-jsx/dist/maquette-jsx.umd":function(){(function(m,
f){"object"===typeof exports&&"undefined"!==typeof module?f(exports):"function"===typeof define&&define.amd?define(["exports"],f):f(m.maquetteCssTransitions={})})(this,function(m){var f=function(e,g){for(var d=0,h=e.length;d<h;d++){var c=e[d];Array.isArray(c)?f(c,g):null!==c&&void 0!==c&&!1!==c&&(c.hasOwnProperty("vnodeSelector")||(c={vnodeSelector:"",properties:void 0,children:void 0,text:c.toString(),domNode:null}),g.push(c))}},k=function(e,g){for(var d=[],h=2;h<arguments.length;h++)d[h-2]=arguments[h];
if(1===d.length&&"string"===typeof d[0])return{vnodeSelector:e,properties:g||void 0,children:void 0,text:d[0],domNode:null};h=[];f(d,h);return{vnodeSelector:e,properties:g||void 0,children:h,text:void 0,domNode:null}};m.jsx=k;m.enableGlobalJsx=function(){window.jsx=k};Object.defineProperty(m,"__esModule",{value:!0})})},"esri/widgets/support/widgetUtils":function(){define("require exports ../../core/ArrayPool ../../core/has ../../core/Logger maquette-css-transitions".split(" "),function(m,f,k,e,g,
d){Object.defineProperty(f,"__esModule",{value:!0});g.getLogger("esri.widgets.support.widgetUtils");f.join=function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];return d.join(" ")};f.classes=function(d){for(var c=k.acquire(),b=0;b<arguments.length;b++){var a=arguments[b],e=typeof a;if("string"===e)c.push(a);else if(Array.isArray(a))c.push.apply(c,a);else if("object"===e)for(var g in a)a[g]&&c.push(g)}b=c.join(" ");k.release(c);return b};f.isRtl=function(){return"rtl"===document.dir};
f.storeNode=function(d){this[d.getAttribute("data-node-ref")]=d};f.cssTransition=function(e,c){return("enter"===e?d.createEnterCssTransition:d.createExitCssTransition)(c)}})},"maquette-css-transitions/dist/maquette-css-transitions.umd":function(){(function(m,f){"object"===typeof exports&&"undefined"!==typeof module?f(exports):"function"===typeof define&&define.amd?define(["exports"],f):f(m.maquetteCssTransitions={})})(this,function(m){var f,k,e=function(e){if("WebkitTransition"in e.style)f="webkitTransitionEnd",
k="webkitAnimationEnd";else if("transition"in e.style)f="transitionend",k="animationend";else throw Error("Your browser is not supported!");};m.createEnterCssTransition=function(g,d){void 0===d&&(d=g+"-active");return function(h){f||e(h);var c=!1,b=function(a){c||(c=!0,h.removeEventListener(f,b),h.removeEventListener(k,b),h.classList.remove(g),h.classList.remove(d))};h.classList.add(g);h.addEventListener(f,b);h.addEventListener(k,b);requestAnimationFrame(function(){h.classList.add(d)})}};m.createExitCssTransition=
function(g,d){void 0===d&&(d=g+"-active");return function(h,c){f||e(h);var b=!1,a=function(d){b||(b=!0,h.removeEventListener(f,a),h.removeEventListener(k,a),c())};h.classList.add(g);h.addEventListener(f,a);h.addEventListener(k,a);requestAnimationFrame(function(){h.classList.add(d)})}};Object.defineProperty(m,"__esModule",{value:!0})})},"esri/widgets/support/shim/SVGElement":function(){define(["require","exports","../../../core/has"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});
k.add("esri-svg-classlist","classList"in SVGElement.prototype);var e=function(){function e(d){this._node=d}e.prototype.add=function(d){var e=this._node;e.className.baseVal=(e.className.baseVal+" "+d).trim()};e.prototype.contains=function(d){return-1<this._node.className.baseVal.split(" ").indexOf(d)};e.prototype.remove=function(d){for(var e=this._node,c="",b=0,a=e.className.baseVal.split(" ");b<a.length;b++){var g=a[b];g!==d&&(c+=g+" ")}e.className.baseVal=c.trim()};e.prototype.toggle=function(d,
e){var c=this.contains(d),b;if(b=c?!0!==e&&"remove":!1!==e&&"add")this[b](d);return void 0!==e?e:!c};return e}();f.DOMTokenListSubset=e;k("esri-svg-classlist")||Object.defineProperty(SVGElement.prototype,"classList",{get:function(){return new e(this)}})})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper dojo/i18n!dojo/cldr/nls/number ../../Graphic ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/arcadeUtils ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v){function z(a,b){return a&&"feature"===a.type?a.getField(b):null}function y(a){return a.replace(/[\u00A0-\u99999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var A=n.getLogger("esri.widgets.FeatureViewModel"),B=/^\s*expression\//i,C=new RegExp(""+d.group,"g"),E=new b("cancelled-query","cancelled feature query"),D=c.getFormat("short-date-short-time"),F="DateFormat"+D;return function(b){function f(c){c=b.call(this)||this;c._handles=new a;
c._featurePromise=void 0;c._layerDateFields=null;c._expressionAttributes=null;c.content=null;c.contentEnabled=!0;c.formattedAttributes=null;c.title="";c.view=null;return c}k(f,b);f.prototype.destroy=function(){this._clear();this._handles.destroy();this._expressionAttributes=this._layerDateFields=this.graphic=this.view=this._handles=null};Object.defineProperty(f.prototype,"graphic",{get:function(){return this._get("graphic")||null},set:function(a){if(a){var b=u.getSourceLayer(a);this._layerDateFields=
b?this._getDateFields(b):[]}this._set("graphic",a);this._graphicChanged(a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"waitingForContent",{get:function(){return!!this._featurePromise},enumerable:!0,configurable:!0});f.prototype._clear=function(){this._cancelFeatureQuery();this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};f.prototype._graphicChanged=function(a){var b=this,c=this._handles;if(c&&(c.remove("graphic"),this._clear(),a)){c.add(q.watch(this,
"graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos contentEnabled".split(" "),function(){b._graphicChanged(b.graphic)}),"graphic");var d=!1;a=this._queryFeature().catch(function(a){a!==E&&A.error("error","error loading template",a)}).then(function(){d=!0;b._featurePromise=null;b.notifyChange("waitingForContent")});d||(this._featurePromise=
a,this.notifyChange("waitingForContent"))}};f.prototype._cancelFeatureQuery=function(){var a=this._featurePromise;a&&"function"===typeof a.cancel&&a.cancel(E);this._featurePromise=null;this.notifyChange("waitingForContent")};f.prototype._compileContent=function(a,b){var c=this;if(a&&(a.nodeName||a&&v.isWidgetBase(a)||v.isWidget(a)))return a;if("string"===typeof a)return this._compileText({type:"text",text:a}).text;if(Array.isArray(a))return a.map(function(a,d){d=(d=b&&b[d])&&d.value;var e=a.type;
if("attachments"===e)return c._compileAttachments(a,d);if("fields"===e)return c._compileFields(a);if("media"===e)return c._compileMedia(a);if("text"===e)return c._compileText(a)});a&&A.warn("invalid content type.")};f.prototype._compileFields=function(a){var b=this,c=this.graphic;a=l.clone(a);var d=(c=c.getEffectivePopupTemplate())&&c.expressionInfos,c=a.fieldInfos?void 0:c&&c.fieldInfos,c=a.fieldInfos||l.clone(c),e=[];c&&c.forEach(function(a){var c=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||
a.visible)c=b._isExpressionField(c)?b._getExpressionInfo(d,c):null,a.label=c?c.title:a.label,e.push(a)});a.fieldInfos=e;return a};f.prototype._setImageValue=function(a){var b=a.value,c=a.formattedAttributes;a=a.layer;var d=b.linkURL,e=b.sourceURL;e&&(e=this._fixTokens(e,a),b.sourceURL=this._substituteAttributes(c,e));d&&(a=this._fixTokens(d,a),b.linkURL=this._substituteAttributes(c,a))};f.prototype._compileMedia=function(a){var b=this,c=this._expressionAttributes,d=this._layerDateFields,e=this.graphic;
a=l.clone(a);var h=a.mediaInfos||[],f=g({},e.attributes,c),k=u.getSourceLayer(e),m=this.formattedAttributes.global,n={dateFormat:{properties:d,formatter:F}};a.mediaInfos=h.map(function(a){if(a=l.clone(a)){var c=a.value,d=a.type,e=a.title?b._processFieldsInLinks(a.title,f):"",g=a.caption?b._processFieldsInLinks(a.caption,f):"";a.title=e?b._substituteAttributes(m,e,n):"";a.caption=g?b._substituteAttributes(m,g,n):"";if("image"===d)return b._setImageValue({value:c,formattedAttributes:m,layer:k}),a.value.sourceURL?
a:void 0;if("pie-chart"===d||"line-chart"===d||"column-chart"===d||"bar-chart"===d)return b._setChartValue({value:c,attributes:f,formattedAttributes:m,layer:k}),a}}).filter(Boolean);return a};f.prototype._substituteAttributes=function(a,b,c){return(""+this._removeEmptyHref(l.substitute(a,b,c))).trim()};f.prototype._compileText=function(a){var b=this._expressionAttributes,c=this._layerDateFields,d=this.graphic;(a=l.clone(a))&&a.text&&(d=g({},d.attributes,b),b=this.formattedAttributes.global,c={dateFormat:{properties:c,
formatter:F}},d=this._processFieldsInLinks(a.text,d),a.text=this._substituteAttributes(b,d,c));return a};f.prototype._compileTitle=function(){var a=this._expressionAttributes,b=this._layerDateFields,c=this.graphic,d=c.getEffectivePopupTemplate(),d=d&&d.title,a=g({},c.attributes,a),b={dateFormat:{properties:b,formatter:F}},e=this.formattedAttributes.global;return"function"===typeof d?d.call(null,{graphic:c}):"string"===typeof d&&d?(c=this._processFieldsInLinks(d,a),this._substituteAttributes(e,c,b)):
""};f.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var c=b.replace(B,"").toLowerCase(),d;a.some(function(a){if(a.name.toLowerCase()===c)return d=a,!0});return d}};f.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,c,d){return(a=z(b,d))?"{"+a.name+"}":c})};f.prototype._encodeAttributes=function(a){var b=a?l.clone(a):{};Object.keys(b).forEach(function(a){var c=b[a];"string"===typeof c&&(c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),
b[a]=c)});return b};f.prototype._formatAttributesToFieldInfos=function(a,b,c){var d=this,e=l.clone(this._layerDateFields);a.forEach(function(g){var h=d._getFixedFieldName(g.fieldName,b);g.fieldName=h;c[h]=d._formatValue(c[h],{fieldInfos:a,fieldName:h,layer:b});e&&g.format&&g.format.dateFormat&&(g=e.indexOf(h),-1<g&&e.splice(g,1))})};f.prototype._getArcadeViewingMode=function(a){return a&&"local"===a.viewingMode?"localScene":"globalScene"};f.prototype._getViewInfo=function(){var a=this.view;if(a){var b=
"3d"===a.type?this._getArcadeViewingMode(a):"map";return t.getViewInfo({viewingMode:b,scale:a.scale,spatialReference:a.spatialReference})}};f.prototype._formatAttributes=function(a){var b=this,c=this._expressionAttributes,d=this.graphic,e=d.attributes,d=u.getSourceLayer(d),h=e?l.clone(e):{},f=g({},h,c);this.addRelatedFeatureAttributes(f);a&&this._formatAttributesToFieldInfos(a,d,f);if(d){var k=d.typeIdField;e&&Object.keys(e).forEach(function(a){if(!b.isRelatedField(a)){var c=e[a];null!=c&&(c=b._getDomainName(a,
c),null!=c?f[a]=c:a===k&&(c=b._getTypeName(),null!=c&&(f[a]=c)))}})}return f};f.prototype._formatValue=function(a,b){var e={dateFormat:{properties:this._layerDateFields,formatter:F}},g=b.fieldName,h=this._getFieldInfo(b.fieldInfos,g),f=l.clone(h),h=b.preventPlacesFormatting;(b=z(b.layer,g))&&"date"===b.type&&(b=f.format||{},b.dateFormat=b.dateFormat||"short-date-short-time",f.format=b);g=f&&f.format;if(null==a||!f||null==g)return a;var k=[],f=g.hasOwnProperty("places")||g.hasOwnProperty("digitSeparator");
b=g.hasOwnProperty("digitSeparator")?g.digitSeparator:!0;h=null!=g.places&&(!h||0<g.places);f&&h&&k.push("places: "+Number(g.places));h=f?h?"NumberFormat("+k.join(",")+")":"NumberFormat":g.dateFormat?"DateFormat"+(c.getFormat(g.dateFormat)||D):void 0;if(!h)return a;a=l.substitute({myKey:a},"{myKey:"+h+"}",e)||"";return f&&!b&&d.group?a.replace(C,""):a};f.prototype._getDomainName=function(a,b){var c=this.graphic,d=u.getSourceLayer(c);return d&&"feature"===d.type?(a=d.getFieldDomain(a,{feature:c}))&&
"coded-value"===a.type?a.getName(b):null:null};f.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var c=b.toLowerCase(),d=void 0;a.some(function(a){if(a.fieldName&&a.fieldName.toLowerCase()===c)return d=a,!0});return d}};f.prototype._getTypeName=function(){var a=this.graphic,b=u.getSourceLayer(a);if(b&&"feature"===b.type&&(a=b.getFeatureType(a)))return a.name};f.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};f.prototype._processFieldsInLinks=function(a,b){var c=
this.get("graphic.layer");a=this._fixTokens(a,c);var d=this._encodeAttributes(b),c=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(c,function(a,c,e){c=(""+(c||e)).trim();return l.substitute(c&&"{"===c[0]?b:d,a)}):a};f.prototype._compileAttachments=function(a,b){a=l.clone(a);if(!b)return a;a.attachmentInfos=b;return a};f.prototype._queryAttachments=function(){var a=this.graphic,b=u.getSourceLayer(a);if(!b)return p.resolve([]);if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:
b)&&"feature"===b.type){var c=b.objectIdField,d=(a=a.attributes)&&a[c],a=new w({objectIds:[d]});return b.queryAttachments(a).then(function(a){return a[d]||[]})}return p.resolve([])};f.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return p.resolve();var c={};a.forEach(function(a,d){"attachments"===a.type&&(a=b._queryAttachments())&&(c[d]=a)});return Object.keys(c).length?p.eachAlways(c):p.resolve()};f.prototype._getContent=function(){var a=this.graphic;if(!this.contentEnabled)return p.resolve();
var b=a.getEffectivePopupTemplate(),b=b&&b.content,a="function"===typeof b?b.call(null,{graphic:a}):b;return p.isThenable(a)?a:p.resolve(a)};f.prototype._queryFeature=function(){var a=this;return this._getContent().then(function(b){return a._checkForRelatedFeatures(b).then(function(){a._expressionAttributes=a._createFormattedExpressions();a._set("formattedAttributes",a._createFormattedAttributes(b));a._set("title",a._compileTitle());return a._queryContentElements(b).then(function(c){c=a._compileContent(b,
c);a._set("content",c||null);return c})})})};f.prototype._isExpressionField=function(a){return B.test(a)};f.prototype._createCompiledExpressionDictionary=function(a){var b=new Map;if(!a)return b;a.forEach(function(a){return b.set(a.name,t.createFunction(a.expression))});return b};f.prototype._getDateFields=function(a){return(a=a.fields)?a.filter(function(a){return"date"===a.type}).map(function(a){return a.name}):[]};f.prototype._createFormattedExpressions=function(){var a=this,b=this.graphic,c=b.getEffectivePopupTemplate(),
c=c&&c.expressionInfos,d=this._createCompiledExpressionDictionary(c),e={};c&&c.forEach(function(c){var g="expression/"+c.name;c=d.get(c.name);var h=a._getViewInfo();c=t.executeFunction(c,t.createExecContext(b,h));e[g]="string"===typeof c?y(c):c});return e};f.prototype._createFormattedAttributes=function(a){var b=this,c=this.graphic.getEffectivePopupTemplate(),d={global:this._formatAttributes(c&&c.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,c){"fields"===a.type&&a.fieldInfos&&(d.content[c]=
b._formatAttributes(a.fieldInfos))});return d};f.prototype._getAllFieldInfos=function(a){var b=[],c=this.graphic.getEffectivePopupTemplate();(c=c&&c.fieldInfos)&&b.push.apply(b,c);if(!a||!Array.isArray(a))return b;a.forEach(function(a){b.push.apply(b,a&&a.fieldInfos)});return b};f.prototype._checkForRelatedFeatures=function(a){var b=this.graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(b,a)};f.prototype._getChartOption=function(a){var b=a.value,c=a.attributes,e=a.formattedAttributes,
g=a.fieldName,h=a.relatedFieldName,l=a.fieldInfos;a=u.getSourceLayer(this.graphic);var f=b.normalizeField,k=b.tooltipField,f=f?this.isRelatedField(f)?c[this.getRelatedFieldInfo(f).fieldName]:c[f]:null,b=h&&void 0!==c[h]?c[h]:void 0!==c[g]?c[g]:e[g],b="string"===typeof b&&d.group?parseFloat(b.replace(C,"")):b,m=void 0===b?null:b&&f?b/f:b,b={y:m};if(this.isRelatedField(g))return e=this.getRelatedFieldInfo(g),g=(g=this.getRelatedFieldInfo(k))?g.fieldName:null,a=this._formatValue(m,{fieldInfos:l,fieldName:h,
layer:a,preventPlacesFormatting:!!f}),h=e?e.label||e.fieldName:h,b.tooltip=(g&&void 0!==c[g]?c[g]:h)+": "+a,b;c=this._getFieldInfo(l,g);h=this._getFixedFieldName(g,a);c=c?c.label||c.fieldName:g;b.tooltip=(k&&void 0!==e[k]?e[k]:c)+": "+e[h];return b};f.prototype._getFixedFieldName=function(a,b){return(b=z(b,a))?b.name:a};f.prototype._getFixedFieldNames=function(a,b){var c=this;return a&&a.map(function(a){return c._getFixedFieldName(a,b)})};f.prototype._setChartValue=function(a){var b=this,c=a.value,
d=a.attributes,e=a.formattedAttributes,g=a.layer,h=this.graphic,l=this.relatedInfoCount;a=c.fields;var f=c.normalizeField;c.fields=this._getFixedFieldNames(a,g);f&&(c.normalizeField=this._getFixedFieldName(f,g));if(a.some(function(a){return!!(null!=e[a]||b.isRelatedField(a)&&l)})){var k=(g=h.getEffectivePopupTemplate())&&g.fieldInfos;c.chartOptions=c.chartOptions||[];a.forEach(function(a){b.isRelatedField(a)?c.chartOptions=c.chartOptions.concat(b._getRelatedChartInfos({fieldInfos:k,fieldName:a,formattedAttributes:e,
value:c})):(a=b._getChartOption({value:c,attributes:d,formattedAttributes:e,fieldName:a,fieldInfos:k}),c.chartOptions.push(a))})}};f.prototype._getRelatedChartInfos=function(a){var b=this,c=a.fieldInfos,d=a.fieldName,e=a.formattedAttributes,g=a.value,h=[];a=this.getRelatedFieldInfo(d);var l=a.fieldName,f=this.getRelatedInfo(a.layerId);if(!f)return h;a=f.relatedFeatures;f=f.relation;if(!f||!a)return h;f=f.cardinality;a.forEach(function(a){var f=a.attributes;f&&Object.keys(f).forEach(function(a){a===
l&&h.push(b._getChartOption({value:g,attributes:f,formattedAttributes:e,fieldName:d,relatedFieldName:a,fieldInfos:c}))})});return"one-to-many"===f||"many-to-many"===f?h:[h[0]]};e([r.property({readOnly:!0})],f.prototype,"content",void 0);e([r.property()],f.prototype,"contentEnabled",void 0);e([r.property({readOnly:!0})],f.prototype,"formattedAttributes",void 0);e([r.property({type:h})],f.prototype,"graphic",null);e([r.property({readOnly:!0})],f.prototype,"title",void 0);e([r.property()],f.prototype,
"view",void 0);e([r.property({readOnly:!0})],f.prototype,"waitingForContent",null);return f=e([r.subclass("esri.widgets.FeatureViewModel")],f)}(r.declared(x))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.getSourceLayer=function(f){if(f)return f.get("sourceLayer")||f.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){var r=new Map,t=c.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(c){function d(a){a=c.call(this)||this;a.relatedInfoCount=null;a.relatedInfos=new Map;return a}k(d,c);d.prototype.destroy=function(){this.relatedInfos.clear()};d.prototype.addRelatedFeatureAttributes=function(a){var b=this;this.relatedInfos.forEach(function(c){return b._addRelatedFeatureAttribute(a,c)})};d.prototype.getRelatedFieldInfo=function(a){if(-1===a.indexOf("relationships/"))return null;
a=a.split("/").slice(1);return{layerId:a[0],fieldName:a[1]}};d.prototype.getRelatedInfo=function(a){return this.relatedInfos.get(a.toString())};d.prototype.isRelatedField=function(a){void 0===a&&(a="");return a?-1!==a.indexOf("relationships/"):!1};d.prototype.queryRelatedInfos=function(a,c){var d=this;this.relatedInfos.clear();var e=q.getSourceLayer(a);if(!e)return b.resolve();var g=c.filter(function(a){return a&&d.isRelatedField(a.fieldName)});if(!g||!g.length)return b.resolve();this._createRelatedInfos(c,
e);return this._queryLayerInfos(e,c).then(function(b){d._updateRelatedInfoLayerInfos(b);return d._queryRelatedFeatureMap(a).then(function(a){Object.keys(a).forEach(function(b){d._setRelatedFeatures(a[b],b.toString())});return a})})};d.prototype._addRelatedFeatureAttribute=function(a,b){var c=this;a&&b&&("one-to-one"===b.relation.cardinality&&b.relatedFeatures&&b.relatedFeatures.forEach(function(d){return c._addAttributesFromFeature(a,d,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(d){return c._addAttributesFromFeature(a,
d,b)}))};d.prototype._updateRelatedInfoLayerInfo=function(a,b){if(a=a.value)this.getRelatedInfo(b).layerInfo=a.data};d.prototype._updateRelatedInfoLayerInfos=function(a){var b=this;Object.keys(a).forEach(function(c){return b._updateRelatedInfoLayerInfo(a[c],c.toString())})};d.prototype._addAttributesFromFeature=function(a,b,c){var d=this;a&&b&&c&&Object.keys(b.attributes).forEach(function(e){var g=d._relatedFieldInfoToString({layerId:c.relation.id.toString(),fieldName:e});a[g]=b.attributes[e]})};
d.prototype._relatedFieldInfoToString=function(a){return a?"relationships/"+a.layerId+"/"+a.fieldName:""};d.prototype._createRelatedInfoForFieldInfo=function(a,b){var c=this.getRelatedFieldInfo(a.fieldName);if(c){var d=c.layerId,c=c.fieldName;d&&(b=this.getRelatedInfo(d)||this._createRelatedInfo(d,b))&&(b.relatedFields.push(c),a.statisticType&&(a=new p({statisticType:a.statisticType,onStatisticField:c,outStatisticFieldName:c}),b.outStatistics.push(a)))}};d.prototype._createRelatedInfos=function(a,
b){var c=this;a.forEach(function(a){return c._createRelatedInfoForFieldInfo(a,b)})};d.prototype._queryRelatedFeatureMap=function(a){var c=this,d={};this.relatedInfos.forEach(function(b,e){d[e]=c._queryRelatedLayerFeatures(a,b)});return b.eachAlways(d)};d.prototype._queryLayerInfos=function(a,c){var d=this,e={};this.relatedInfos.forEach(function(c,g){c=c.relation;if(!c)return g=new h("relation-required","A relation is required on a layer to retrieve related records."),t.error(g),b.reject(g);c=c.relatedTableId;
if(!c)return g=new h("A related table ID is required on a layer to retrieve related records."),t.error(g),b.reject(g);c=a.url+"/"+c;var l=r.get(c),f=l?l:d._queryLayerInfo(c);l||r.set(c,f);e[g]=f});return b.eachAlways(e)};d.prototype._queryLayerInfo=function(a){return g(a,{query:{f:"json"}})};d.prototype._queryRelatedLayerFeatures=function(a,c){var d=q.getSourceLayer(a).layerId.toString(),e=c.layerInfo,g=c.queryTask,h=c.relation;if(d=this._getDestinationRelation(e,d)){var h=h.keyField,l=d.keyField,
d="string"===this._getDestinationFieldType(e,d)?l+"\x3d'"+a.attributes[h]+"'":l+"\x3d"+a.attributes[h];a=g.execute(new n({where:d,outFields:c.relatedFields}));c=c.outStatistics&&0<c.outStatistics.length&&e.supportsStatistics?g.execute(new n({where:d,outFields:c.relatedFields,outStatistics:c.outStatistics})):null;return b.eachAlways({features:a,statsFeatures:c?c:b.resolve()})}return b.resolve()};d.prototype._setRelatedFeatures=function(a,b){if(b=this.getRelatedInfo(b)){var c=a.value;c&&(a=c.features,
c=c.statsFeatures,a=a&&a.value,b.relatedFeatures=a?a.features:[],a=c&&c.value,b.relatedStatsFeatures=a?a.features:[])}};d.prototype._getRelation=function(a,b){if("feature"!==b.type)return null;var c=null;b.relationships.some(function(b){if(b.id===parseInt(a,10))return c=b,!0});return c};d.prototype._createRelatedInfo=function(a,b){var c=this._getRelation(a,b);if(c){b=b.url+"/"+c.relatedTableId;var d=new l({url:b}),c={url:b,queryTask:d,relation:c,relatedFields:[],outStatistics:[]};this.relatedInfos.set(a,
c);return c}};d.prototype._getDestinationRelation=function(a,b){var c;a&&a.relationships&&a.relationships.some(function(a){if(""+a.relatedTableId===b)return c=a,!0});return c};d.prototype._getDestinationFieldType=function(a,b){var c=void 0;a.fields.some(function(a){if(a.name===b.keyField)return c=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?"number":"string",!0});return c};e([a.aliasOf("relatedInfos.size")],d.prototype,"relatedInfoCount",
void 0);e([a.property()],d.prototype,"relatedInfos",void 0);return d=e([a.subclass("esri.widgets.Popup.support.RelatedFeatures")],d)}(a.declared(d))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});var k=m.toUrl("../../../themes/base/images/files/");f.isSupportedImage=function(e){e=e.toLowerCase();return"image/bmp"===e||"image/emf"===e||"image/exif"===e||"image/gif"===e||"image/x-icon"===e||"image/jpeg"===
e||"image/png"===e||"image/tiff"===e||"image/x-wmf"===e};f.getIconPath=function(e){return"text/plain"===e?k+"text-32.svg":"application/pdf"===e?k+"pdf-32.svg":"text/csv"===e?k+"csv-32.svg":"application/gpx+xml"===e?k+"gpx-32.svg":"application/x-dwf"===e?k+"cad-32.svg":"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?k+"code-32.svg":"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===
e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?k+"zip-32.svg":-1!==e.indexOf("image/")?k+"image-32.svg":-1!==e.indexOf("audio/")?k+"sound-32.svg":-1!==e.indexOf("video/")?k+"video-32.svg":-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?k+"excel-32.svg":-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?
k+"word-32.svg":-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?k+"report-32.svg":k+"generic-32.svg"}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(m,f,k,e){function g(e){var c=null;d.some(function(b){b.pattern.test(e)&&(c=b);return!!c});return c}Object.defineProperty(f,"__esModule",{value:!0});var d=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:k.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,
label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,
label:k.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:k.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,
label:k.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Microsoft Power Bi"}];f.autoLink=function(d){if("string"!==typeof d||!d)return d;var c=g(d);if(!c)return d;var b=d.match(c.pattern),b=e.substitute({appName:c.appName,hierPart:b&&b[2]},c.label);return d.replace(c.pattern,"\x3ca "+(c.target?'target\x3d"'+c.target+'"':"")+'" href\x3d"$1"\x3e'+
b+"\x3c/a\x3e")}})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(m,f,k,e,g,d,h,c,b,a){return function(c){function l(a){a=c.call(this)||this;a._animationDelay=500;a._animationPromise=null;a.location=null;a.view=null;a.visible=!1;a.viewModel=new b;return a}k(l,c);
l.prototype.postInitialize=function(){var a=this;this.own([d.watch(this,"visible",function(b){return a._visibleChange(b)})])};l.prototype.destroy=function(){this._cancelAnimationPromise()};l.prototype.show=function(a){var b=this,c=a.location;a=a.promise;c&&(this.viewModel.location=c);this.visible=!0;c=function(){return b.hide()};a&&a.catch(function(){}).then(c)};l.prototype.hide=function(){this.visible=!1};l.prototype.render=function(){var b,c=this.visible,d=!!this.viewModel.screenLocation,c=(b={},
b["esri-spinner--start"]=c&&d,b["esri-spinner--finish"]=!c&&d,b);b=this._getPositionStyles();return a.tsx("div",{class:this.classes("esri-spinner",c),styles:b})};l.prototype._cancelAnimationPromise=function(){var a=this._animationPromise;a&&a.cancel();this._animationPromise=null};l.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=g.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=
!1;b._animationPromise=null}))};l.prototype._getPositionStyles=function(){var a=this.viewModel,b=a.screenLocation,a=a.view;if(!a||!b)return{};a=a.padding;return{left:b.x-a.left+"px",top:b.y-a.top+"px"}};e([h.aliasOf("viewModel.location")],l.prototype,"location",void 0);e([h.aliasOf("viewModel.view")],l.prototype,"view",void 0);e([h.property(),a.renderable()],l.prototype,"visible",void 0);e([h.property({type:b}),a.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],l.prototype,
"viewModel",void 0);return l=e([h.subclass("esri.widgets.Spinner")],l)}(h.declared(c))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c,b,a){return function(d){function g(){var a=d.call(this)||this;a._anchorHandles=
new h;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([b.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),b.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}k(g,d);g.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};g.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");
this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=c.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};g.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};g.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};g.prototype._toggleWatchingViewpoint=
function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};g.prototype._setScreenLocation=function(){var a=this.location,b=this.view,c=this.screenLocationEnabled,d=this.get("view.ready"),a=c&&a&&d?b.toScreen(a):null;this._set("screenLocation",a)};e([a.property()],g.prototype,"location",void 0);e([a.property({readOnly:!0})],g.prototype,"screenLocation",void 0);e([a.property()],g.prototype,"screenLocationEnabled",void 0);e([a.property()],g.prototype,
"view",void 0);return g=e([a.subclass("esri.widgets.support.AnchorElementViewModel")],g)}(a.declared(g,d))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/webMercatorUtils ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../views/support/layerViewUtils ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v){var z=new t({id:"zoom-to"}),y=d.ofType({key:"type",defaultKeyValue:"button",base:r,typeMap:{button:t,toggle:w}}),A=new y([z]),B=b.getLogger("esri.widgets.Popup.PopupViewModel");return function(b){function d(a){a=b.call(this)||this;a._handles=new c;a._pendingPromises=new Set;a._zoomToLocation=null;a.actions=A;a.autoCloseEnabled=!1;a.content=null;a.highlightEnabled=!0;a.title=null;a.updateLocationEnabled=!1;a.view=null;a.visible=!1;a.zoomFactor=4;return a}
k(d,b);d.prototype.initialize=function(){var a=this;this._handles.add([this.on("view-change",this._autoClose),l.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),l.watch(this,"view.animation.state",function(b){a._zoomToLocation||(z.disabled="waiting-for-target"===b)})])};d.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(d.prototype,"allActions",{get:function(){var a=
this._get("allActions")||new y;a.removeAll();var b=this.selectedFeature&&("function"===typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate()||this.selectedFeature.popupTemplate),c=b&&b.actions;(b=b&&b.overwriteActions?c:this.actions.concat(c))&&b.filter(Boolean).forEach(function(b){return a.add(b)});return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var b=this.pendingPromisesCount,c=this.selectedFeatureIndex,d=this.promiseCount&&a.length;d&&b&&-1===c?this.selectedFeatureIndex=0:d&&-1!==c||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"location",{get:function(){return this._get("location")||null},set:function(a){var b=this.get("location"),
c=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&c&&(a=q.geographicToWebMercator(a));this._set("location",a);a!==b&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&0===this.featureCount},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var b=this,c=this._get("promises");c&&c.forEach(function(a){a&&"function"===typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),a.forEach(function(a){b._pendingPromises.add(a);
a.then(function(c){b._updatePendingPromises(a);b._updateFeatures(c)},function(){return b._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"selectedFeature",{get:function(){var a=this.selectedFeatureIndex;if(-1===a)return null;a=this.features[a];if(!a)return null;this.updateLocationEnabled&&(this.location=this._getPointFromGeometry(a.geometry));return a},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var b=this.featureCount;a=isNaN(a)||-1>a||!b?-1:(a+b)%b;this._set("selectedFeatureIndex",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype.centerAtLocation=function(){var b=this.location,c=this.view;return b&&
c?this.callGoTo({target:{target:b,scale:c.scale}}):(b=new h("center-at-location:invalid-location-or-view","Cannot center at a location without a location and view.",{location:b,view:c}),B.error(b),a.reject(b))};d.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};d.prototype.open=function(a){this.set(g({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};d.prototype.triggerAction=function(a){(a=this.allActions.getItemAt(a))&&
this.emit("trigger-action",{action:a})};d.prototype.next=function(){this.selectedFeatureIndex+=1;return this};d.prototype.previous=function(){--this.selectedFeatureIndex;return this};d.prototype.zoomToLocation=function(){var b=this,c=this.location,d=this.selectedFeature,e=this.view,g=this.zoomFactor;if(!c||!e)return d=new h("zoom-to:invalid-location-or-view","Cannot zoom to location without a location and view.",{location:c,view:e}),B.error(d),a.reject(d);var g=e.scale/g,l=this.get("selectedFeature.geometry"),
e=d&&"3d"===e.type,c=(e=l||e)?d:c,f=l&&"point"===l.type,k=e&&f&&this._isScreenSize(d),d={target:c,scale:k?g:void 0};z.active=!0;z.disabled=!0;return this._zoomToLocation=d=this.callGoTo({target:d}).then(function(){k&&f&&(b.location=l);z.active=!1;z.disabled=!1;b._zoomToLocation=null}).catch(function(){z.active=!1;z.disabled=!1;b._zoomToLocation=null})};d.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};
d.prototype._setVisibleWhenContentExists=function(){var a=this,b=this._handles,c=this.promiseCount;b.remove("pendingVisible");c?(c=l.init(this,"pendingPromisesCount",function(c){a.featureCount&&(a.set("visible",!0),b.remove("pendingVisible"));c||b.remove("pendingVisible")}),b.add(c,"pendingVisible")):this.set("visible",!0)};d.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};d.prototype._isScreenSize=function(a){var b=this.view;if("3d"!==b.type||"esri.Graphic"!==a.declaredClass)return!0;
if((b=b.getViewForGraphic(a))&&b.whenGraphicBounds){var c=!1;b.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){c=!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return c}return!0};d.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type||"polyline"===a.type?a.extent.center:null:null};d.prototype._centerAtLocation=
function(){var a=this.location,b=this.updateLocationEnabled,c=this.get("view.extent");b&&c&&a&&!c.contains(a)&&this.centerAtLocation()};d.prototype._highlightFeature=function(){var a=this;this._handles.remove("highlight");var b=this.selectedFeature,c=this.highlightEnabled,d=this.view,e=this.visible;if(b&&d&&c&&e){var g=b.layer;g&&d.when(function(){d.whenLayerView(g).then(function(c){if(c&&u.hasHighlight(c)){var d=g.objectIdField,e=b.attributes;c=c.highlight(e&&e[d]||b,{});a._handles.add(c,"highlight")}})})}};
d.prototype._updateFeatures=function(a){var b=this.features;a&&a.length&&(b.length?(a=a.filter(function(a){return-1===b.indexOf(a)}),this.features=b.concat(a)):this.features=a)};e([n.property({type:y})],d.prototype,"actions",void 0);e([n.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],
d.prototype,"allActions",null);e([n.property()],d.prototype,"autoCloseEnabled",void 0);e([n.property()],d.prototype,"content",void 0);e([n.property({readOnly:!0,dependsOn:["features"]})],d.prototype,"featureCount",null);e([n.property()],d.prototype,"features",null);e([n.property()],d.prototype,"highlightEnabled",void 0);e([n.property({type:p})],d.prototype,"location",null);e([n.property({readOnly:!0,dependsOn:["promises"]})],d.prototype,"pendingPromisesCount",null);e([n.property({readOnly:!0,dependsOn:["featureCount",
"pendingPromisesCount"]})],d.prototype,"waitingForResult",null);e([n.property({readOnly:!0,dependsOn:["promises"]})],d.prototype,"promiseCount",null);e([n.property()],d.prototype,"promises",null);e([n.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],d.prototype,"selectedFeature",null);e([n.property({value:-1})],d.prototype,"selectedFeatureIndex",null);e([n.property({readOnly:!0,dependsOn:["view.ready"]})],d.prototype,"state",null);e([n.property()],
d.prototype,"title",void 0);e([n.property()],d.prototype,"updateLocationEnabled",void 0);e([n.property()],d.prototype,"view",void 0);e([n.property()],d.prototype,"visible",void 0);e([n.property()],d.prototype,"zoomFactor",void 0);e([n.property()],d.prototype,"centerAtLocation",null);e([n.property()],d.prototype,"clear",null);e([n.property()],d.prototype,"triggerAction",null);e([n.property()],d.prototype,"next",null);e([n.property()],d.prototype,"previous",null);e([n.property()],d.prototype,"zoomToLocation",
null);return d=e([n.subclass("esri.widgets.Popup.PopupViewModel")],d)}(n.declared(x,v))})},"esri/views/support/layerViewUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.hasHighlight=function(f){return f&&"function"===typeof f.highlight}})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){return function(g){function c(){var b=null!==g&&g.apply(this,arguments)||this;b.goToOverride=null;b.view=null;return b}k(c,g);c.prototype.callGoTo=function(b){var a=this.view;return this.goToOverride?this.goToOverride(a,b):a.goTo(b.target,b.options)};e([d.property()],c.prototype,"goToOverride",void 0);e([d.property()],c.prototype,"view",void 0);return c=e([d.subclass("esri.widgets.support.GoTo")],c)}(d.declared(g))})},"esri/views/View":function(){define("../Graphic ../core/Accessor ../core/Collection ../core/CollectionFlattener ../core/Evented ../core/Handles ../core/lang ../core/Logger ../core/Promise ../core/watchUtils ../core/promiseUtils ../core/scheduling ../geometry/Extent ../geometry/HeightModelInfo ../geometry/SpatialReference ./LayerViewManager ./RefreshManager ./BasemapView ./GroundView ./support/DefaultsFromMap ./input/Input ./navigation/Navigation".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y){var A=c.getLogger("esri.views.View");return f.createSubclass([b,g],{declaredClass:"esri.views.View",properties:{allLayerViews:{readOnly:!0},basemapView:{},animation:{},resizing:{},interacting:{},graphics:{type:k.ofType(m)},groundView:{},defaultsFromMap:v,heightModelInfo:{readOnly:!0,type:q,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]},initialExtent:{readOnly:!0,type:p,dependsOn:["defaultsFromMap.extent"]},initialExtentRequired:{},
layerViews:{type:k},map:{},ready:{readOnly:!0,dependsOn:"map spatialReference width height initialExtentRequired initialExtent defaultsFromMap.isSpatialReferenceDone map.loaded?".split(" ")},size:{readOnly:!0,dependsOn:["width","height"],get:function(){return[this.width,this.height]}},spatialReference:{type:r,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]},stationary:{dependsOn:["animation","interacting","resizing"]},type:{},updating:{},padding:{},
width:{},height:{},cursor:{},spatialReferenceWarningDelay:1E3,renderContext:{},input:{readOnly:!0},navigation:{readOnly:!0}},constructor:function(a){this._viewHandles=new d;this._viewHandles.add(this.watch("ready",function(a,b){this._currentSpatialReference=a?this.spatialReference:null;this.notifyChange("spatialReference");!a&&b&&this.layerViewManager.clear()}.bind(this)));this.allLayerViews=new e({root:this,rootCollectionNames:["basemapView.baseLayerViews","groundView.layerViews","layerViews","basemapView.referenceLayerViews"],
getChildrenFunction:function(a){return a.layerViews}});this.defaultsFromMap=new v({view:this});this.input=new z;this.navigation=new y},getDefaults:function(){return h.mixin(this.inherited(arguments),{layerViews:[],graphics:[],padding:{left:0,top:0,right:0,bottom:0}})},initialize:function(){var b=this.validate().then(function(){this._isValid=!0;this.notifyChange("ready");var b=function(){return a.whenOnce(this,"ready").then(function(){return l.after(0)}.bind(this)).then(function(){if(!this.ready)return b()}.bind(this))}.bind(this);
return b()}.bind(this));this.addResolvingPromise(b);this.basemapView=new u({view:this});this.groundView=new x({view:this});this.layerViewManager=new t({view:this});this.refreshManager=new w({view:this});this._resetInitialViewPropertiesFromContent();var c;a.init(this.defaultsFromMap,"isSpatialReferenceDone",function(a){var b=!!(this.map&&0<this.map.allLayers.length);a&&!this.spatialReference&&b||!c?a&&!this.spatialReference&&b&&!c&&(c=l.after(this.spatialReferenceWarningDelay),c.then(function(){A.warn("#spatialReference",
"no spatial reference could be derived from the currently added map layers")}).catch(function(){})):(c.cancel(),c=null)}.bind(this),!0)},destroy:function(){this.destroyed||(this.basemapView.destroy(),this.groundView.destroy(),this.destroyLayerViews(),this.refreshManager.destroy(),this.defaultsFromMap.destroy(),this.defaultsFromMap=null,this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this._viewHandles.destroy(),this.map=null)},destroyLayerViews:function(){this.layerViewManager.destroy()},
_viewHandles:null,_isValid:!1,_readyCycleForced:!1,_userSpatialReference:null,_currentSpatialReference:null,animation:null,basemapView:null,groundView:null,graphics:null,heightModelInfo:null,_heightModelInfoGetter:function(){return this.getDefaultHeightModelInfo()},interacting:!1,layerViews:null,map:null,_mapSetter:function(a){var b=this._get("map");a!==b&&(a&&a.load&&a.load(),this._forceReadyCycle(),this._resetInitialViewPropertiesFromContent(),this._set("map",a))},padding:null,_readyGetter:function(){return!!(this._isValid&&
!this._readyCycleForced&&this.map&&0!==this.width&&0!==this.height&&this.spatialReference&&(!this.map.load||this.map.loaded)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone&&this.isSpatialReferenceSupported(this.spatialReference))},spatialReference:null,_spatialReferenceGetter:function(){var a=this._userSpatialReference||this._currentSpatialReference||
this.getDefaultSpatialReference()||null;a&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(a=a.clone(),a.vcsWkid=this.defaultsFromMap.vcsWkid,a.latestVcsWkid=this.defaultsFromMap.latestVcsWkid);return a},_spatialReferenceSetter:function(a){this._userSpatialReference=a;this._set("spatialReference",a)},stationary:!0,_stationaryGetter:function(){return!this.animation&&!this.interacting&&!this.resizing},type:null,updating:!1,initialExtentRequired:!0,initialExtent:null,_initialExtentGetter:function(){return this.defaultsFromMap&&
this.defaultsFromMap.extent},cursor:"default",renderContext:null,input:null,navigation:null,whenLayerView:function(a){return this.layerViewManager.whenLayerView(a)},getDefaultSpatialReference:function(){return this.get("defaultsFromMap.spatialReference")},getDefaultHeightModelInfo:function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null},validate:function(){return l.resolve()},isSpatialReferenceSupported:function(){return!0},
isTileInfoRequired:function(){return!1},when:function(a,b,c){this.isResolved()&&!this.ready&&A.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.');return this.inherited(arguments)},_resetInitialViewPropertiesFromContent:function(){if(this.defaultsFromMap){var b=this.defaultsFromMap.start.bind(this.defaultsFromMap);this.defaultsFromMap.reset();this._currentSpatialReference=
null;this.notifyChange("spatialReference");this._viewHandles.remove("defaultsFromMap");this._viewHandles.add([a.watch(this,"spatialReference",b),a.watch(this,"initialExtentRequired",b),n.schedule(b)],"defaultsFromMap")}},_forceReadyCycle:function(){this.ready&&(this._readyCycleForced=!0,a.whenFalseOnce(this,"ready",function(){this._readyCycleForced=!1;this.notifyChange("ready")}.bind(this)),this.notifyChange("ready"))}})})},"esri/views/LayerViewManager":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Error ../core/Handles ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./LayerViewFactory".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){return function(g){function f(){var b=g.call(this)||this;b._promisesMap=new Map;b._layerViewsMap=new Map;b._handles=new h;b.factory=new n;b.ready=!1;b.layersToLayerViews=function(){var a=new Map;a.set("view.map.basemap.baseLayers","view.basemapView.baseLayerViews");a.set("view.map.ground.layers","view.groundView.layerViews");a.set("view.map.layers","view.layerViews");a.set("view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews");return a}();b._doWork=
b._doWork.bind(b);b.refresh=b.refresh.bind(b);b._handles.add(a.init(b,"view.ready",function(a){return b.ready=a}));b._handles.add(b.watch(["view.map.basemap","view.map.ground","view.map.layers","ready"],b.refresh),"watcher");return b}k(f,g);f.prototype.destroy=function(){this._handles&&(this.clear(),this.view=null,this.factory.destroy(),this.factory=null,this._handles.destroy(),this._map=this._layerViewsMap=this._promisesMap=this._handles=null)};f.prototype.clear=function(){this.destroyed||(this._layerViewsMap.forEach(this._disposeLayerView,
this),this._promisesMap.forEach(function(a){return a.cancel()}),this._layerViewsMap.clear(),this._promisesMap.clear(),this._refreshCollections())};f.prototype.refresh=function(){var a=this._handles;a.remove("refresh");a.add(b.schedule(this._doWork),"refresh")};f.prototype.whenLayerView=function(a){this.refresh();this._doWork();return this._promisesMap.has(a)?this._promisesMap.get(a):c.reject(new d("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:a}))};f.prototype._doWork=
function(){var a=this,b=this._handles,c=this.get("view.map");this._map!==c&&(this.clear(),this._map=c);if(b.has("refresh")){b.remove("refresh");b.remove("collection-change");this.factory.paused=!this.ready;var d=this._map&&this._map.allLayers;d&&(d.forEach(this._createLayerView,this),this._refreshCollections(),this._promisesMap.forEach(function(b,c){d.includes(c)||a._disposeLayerView(a._layerViewsMap.get(c),c)}),b.add(d.on("change",this.refresh),"collection-change"))}};f.prototype._refreshCollections=
function(){var a=this;this.layersToLayerViews.forEach(function(b,c){a._populateLayerViewsOwners(a.get(c),a.get(b),a.view)})};f.prototype._populateLayerViewsOwners=function(a,b,c){var d=this;if(a&&b){var e=0;a.forEach(function(a){var g=d._layerViewsMap.get(a);g&&(g.layer=a,g.parent=c,b.getItemAt(e)!==g&&b.splice(e,0,g),a.layers&&d._populateLayerViewsOwners(a.layers,g.layerViews,g),e+=1)});e<b.length&&b.splice(e,b.length)}else b&&b.removeAll()};f.prototype._createLayerView=function(a){var b=this,c=
this.view,e=this.factory,g=this._layerViewsMap,h=this._promisesMap;g.has(a)?a.load():h.has(a)||(e=e.create(c,a).then(function(e){if(!b._map||!b._map.allLayers.some(function(b){return a===b}))throw new d("view:no-layerview-for-layer","The layer has been removed from the map",{layer:a});g.set(a,e);b._refreshCollections();a.emit("layerview-create",{view:c,layerView:e});c.emit("layerview-create",{layer:a,layerView:e});return e.when()}),h.set(a,e),e.always(this.refresh))};f.prototype._disposeLayerView=
function(a,b){if(this._promisesMap.has(b)&&(this._promisesMap.get(b).cancel(),this._promisesMap.delete(b),a)){b=a.layer;var c=a.view;this.factory.dispose(a);a.layer=a.parent=a.view=null;this._layerViewsMap.delete(b);b.emit("layerview-destroy",{view:c,layerView:a});c.emit("layerview-destroy",{layer:b,layerView:a})}};e([l.property()],f.prototype,"ready",void 0);e([l.property()],f.prototype,"view",void 0);return f=e([l.subclass("esri.views.LayerViewManager")],f)}(l.declared(g))})},"esri/views/LayerViewFactory":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/Deferred dojo/when ../core/Accessor ../core/Collection ../core/Error ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p=a.getLogger("esri.views.LayerViewFactory");return function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b.creationRequests=new c;b.paused=!0;return b}k(h,a);h.prototype.initialize=function(){var a=this;l.whenFalse(this,"paused",function(){a.creationRequests.toArray().forEach(a._processRequest,a)},!0)};h.prototype.destroy=function(){this.creationRequests.drain(function(a){return a.deferred.cancel(void 0)})};Object.defineProperty(h.prototype,
"working",{get:function(){return 0<this.creationRequests.length},enumerable:!0,configurable:!0});h.prototype.create=function(a,c){var d=this.getLayerViewPromise(c);if(d)return d;var e=this.creationRequests,h={deferred:new g(function(){var a=new b("cancelled:layerview-create","layerview creation cancelled",{layer:c});e.remove(h);h.creationPromise&&h.creationPromise.cancel(a);return a}),view:a,layer:c,started:!1,creationPromise:null};e.push(h);this.paused||this._processRequest(h);return h.deferred.promise};
h.prototype.dispose=function(a){a.layer.destroyLayerView(a)};h.prototype.getLayerViewPromise=function(a){var b=this.creationRequests&&this.creationRequests.find(function(b){return b.layer===a});return b&&b.deferred.promise};h.prototype._processRequest=function(a){var c=this;if(!a.started){a.started=!0;var e=a.deferred,g=a.layer,h=a.view;g.load().then(function(b){if(!e.isCanceled())return a.creationPromise=b.createLayerView(h),a.creationPromise}).then(function(b){return e.isCanceled()?b:a.creationPromise=
d(b.when())}).catch(function(a){e.isCanceled()||(p.error("Failed to create view for layer '"+g.title+", id:"+g.id+"' of type '"+g.type+"'.",{error:a}),e.reject(new b("layerview:create-error","layerview creation failed",{layer:g,error:a})))}).then(function(b){c.creationRequests&&c.creationRequests.remove(a);e.isFulfilled()?b&&c.dispose(b):e.resolve(b);return b})}};e([n.property()],h.prototype,"creationRequests",void 0);e([n.property()],h.prototype,"paused",void 0);e([n.property()],h.prototype,"view",
void 0);e([n.property({dependsOn:["paused","creationRequests.length"],readOnly:!0})],h.prototype,"working",null);return h=e([n.subclass("esri.views.LayerViewFactory")],h)}(n.declared(h))})},"esri/views/RefreshManager":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Handles ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||
this;a._handles=new d;a._currentTick=0;return a}k(b,c);b.prototype.initialize=function(){var a=this;this.view.allLayerViews.on("after-changes",function(){a.notifyChange("tickInterval");a._handles.remove("layerViewsUpdating");a._handles.add(a._getLayerViewHandles(),"layerViewsUpdating")});this.watch("tickInterval",function(){return a._restartTicking()});this.watch("view.ready",function(){return a._restartTicking()});this._restartTicking()};b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),
this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)};Object.defineProperty(b.prototype,"tickInterval",{get:function(){var a=this.view.allLayerViews.filter(function(a){return!!a.refresh});return this._getCommonInterval(a)},enumerable:!0,configurable:!0});b.prototype._restartTicking=function(){var a=this;this._currentTick=0;this._intervalID&&clearInterval(this._intervalID);this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval(function(){var b=
Date.now();a._currentTick+=a.tickInterval;a.view.allLayerViews.forEach(function(c){if(c.refresh){var d=Math.round(6E4*c.refreshInterval),e=0===a._currentTick%d,g=6E3>b-c.refreshTimestamp;d&&e&&!g&&c.refresh(b)}})},this.tickInterval))};b.prototype._getLayerViewHandles=function(){var a=this,b=[];this.view.allLayerViews.forEach(function(c){if(c.refresh){var d=c.watch("refreshInterval",function(){return a.notifyChange("tickInterval")});b.push(d);c.layer&&(d=c.layer.on("refresh",function(){var a=Date.now();
6E3>a-c.refreshTimestamp||c.refresh(a)}),b.push(d))}});return b};b.prototype._getCommonInterval=function(a){var b=function(a,c){return isNaN(a)||isNaN(c)?0:0>=c?a:b(c,a%c)};return a.toArray().reduce(function(a,c){return b(Math.round(6E4*c.refreshInterval),a)},0)};e([h.property()],b.prototype,"view",void 0);e([h.property({readOnly:!0})],b.prototype,"tickInterval",null);return b=e([h.subclass("esri.views.RefreshManager")],b)}(h.declared(g))})},"esri/views/BasemapView":function(){define(["../core/Accessor",
"../core/Collection","../core/watchUtils"],function(m,f,k){return m.createSubclass({declaredClass:"esri.views.BasemapView",properties:{view:{},baseLayerViews:{type:f},referenceLayerViews:{type:f}},constructor:function(){this._loadingHdl=k.init(this,"view.map.basemap",this._loadBasemap)},getDefaults:function(){return{baseLayerViews:[],referenceLayerViews:[]}},destroy:function(){this.view=null;this._loadingHdl&&(this._loadingHdl.remove(),this._loadingHdl=null)},_suspendedGetter:function(){return this.view?
this.view.suspended:!0},_loadBasemap:function(e){e&&e.load()}})})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),function(m,f,k,e,g,d,h,c,b,a){return function(g){function l(a){a=g.call(this)||this;a.handles=new h;a.view=null;a.layerViews=new d;return a}k(l,g);l.prototype.initialize=
function(){var a=this;this.handles.add(c.when(this,"view.map.ground",function(a){return a.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return a.layerViewsAfterChangesHandler()}))};l.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(l.prototype,"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?
new a({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(a){return a.updating})},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});l.prototype.layerViewsAfterChangesHandler=function(){var a=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(b){return b.watch("updating",
function(){return a.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};l.prototype.updateUpdating=function(){this.notifyChange("updating")};e([b.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],l.prototype,"elevationSampler",null);e([b.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],l.prototype,"updating",null);e([b.property({constructOnly:!0})],l.prototype,"view",void 0);e([b.property({type:d,readOnly:!0})],l.prototype,"layerViews",void 0);
e([b.property({readOnly:!0,dependsOn:["view.suspended"]})],l.prototype,"suspended",null);return l=e([b.subclass("esri.views.GroundView")],l)}(b.declared(g))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){var q=h.getLogger("esri.views.support.GroundViewElevationSampler");return function(d){function g(a){a=d.call(this,a)||this;a.demResolution={min:-1,max:-1};a.noDataValue=p.noDataValueOpt.noDataValue;return a}k(g,d);g.prototype.initialize=function(){var a=this;this.view.basemapTerrain.on("elevation-change",function(){return a.emit("changed",{})})};Object.defineProperty(g.prototype,"extent",{get:function(){var a=this.view.basemapTerrain;return a.extent&&a.spatialReference?
b.toExtent(a.extent,a.spatialReference):null},enumerable:!0,configurable:!0});g.prototype.elevationAt=function(b){var c=b.spatialReference,d=this.spatialReference;if(!l.canProject(c,d))return q.error("Cannot sample elevation at a location with spatial reference ("+(c?c.wkid:"unknown")+") different from the view ("+d.wkid+")"),null;a.extentContainsPoint(this.extent,b)||(c=this.extent,q.warn("#elevationAt()","Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler extent ("+(c.xmin+
", "+c.ymin+", "+c.xmax+", "+c.ymax)+")"));return this.view.basemapTerrain.getElevation(b)};g.prototype.queryElevation=function(a){return n.updateGeometryElevation(a.clone(),this)};e([c.property({readOnly:!0})],g.prototype,"demResolution",void 0);e([c.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],g.prototype,"extent",null);e([c.property({readOnly:!0})],g.prototype,"noDataValue",void 0);e([c.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
g.prototype,"spatialReference",void 0);e([c.property({constructOnly:!0})],g.prototype,"view",void 0);return g=e([c.subclass("esri.views.support.GroundViewElevationSampler")],g)}(c.declared(g,d))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../geometry ../../core/Logger ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/scaleUtils ../../geometry/support/webMercatorUtils".split(" "),function(m,f,k,e,g,d,h,c){function b(b,c){var d=
a(b,c.spatialReference);if(!d)return null;switch(b.type){case "point":b.z=c.elevationAt(d)||0;break;case "polyline":p.spatialReference=d.spatialReference;for(var e=b.hasM&&!b.hasZ,g=0;g<b.paths.length;g++)for(var h=b.paths[g],l=d.paths[g],f=0;f<h.length;f++){var k=h[f],m=l[f];p.x=m[0];p.y=m[1];m=c.elevationAt(p)||0;e&&(k[3]=k[2]);k[2]=m}b.hasZ=!0;break;case "multipoint":p.spatialReference=d.spatialReference;e=b.hasM&&!b.hasZ;for(g=0;g<b.points.length;g++)h=b.points[g],l=d.points[g],p.x=l[0],p.y=l[1],
l=c.elevationAt(p)||0,e&&(h[3]=h[2]),h[2]=l;b.hasZ=!0}return b}function a(a,b){var d=a.spatialReference;return d.equals(b)?a:c.canProject(d,b)?c.project(a,b):(l.error("Cannot project geometry spatial reference (wkid:"+d.wkid+") to elevation sampler spatial reference (wkid:"+b.wkid+")"),null)}Object.defineProperty(f,"__esModule",{value:!0});var l=e.getLogger("esri.layers.support.ElevationSampler"),n=function(){function c(a,b,c){this.tile=a;this.noDataValue=c;this.extent=g.toExtent(a.tile.extent,b.spatialReference);
c=h.getMetersPerUnitForSR(b.spatialReference);a=b.lodAt(a.tile.level).resolution*c;this.demResolution={min:a,max:a}}Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});c.prototype.contains=function(b){b=a(b,this.spatialReference);return d.extentContainsPoint(this.extent,b)};c.prototype.elevationAt=function(b){var c=a(b,this.spatialReference);if(!c)return null;if(!this.contains(b)){var d=this.extent;l.warn("#elevationAt()",
"Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler extent ("+(d.xmin+", "+d.ymin+", "+d.xmax+", "+d.ymax)+")")}return this.tile.sample(c.x,c.y)};c.prototype.queryElevation=function(a){return b(a.clone(),this)};c.prototype.on=function(a,b){return q};return c}();f.TileElevationSampler=n;m=function(){function c(a,b,c){var d=this,e;"number"===typeof b?(this.noDataValue=b,e=null):(e=b,this.noDataValue=c);this.samplers=e?a.map(function(a){return new n(a,e,d.noDataValue)}):a;if(a=
this.samplers[0])for(this.extent=a.extent.clone(),a=a.demResolution,this.demResolution={min:a.min,max:a.max},a=1;a<this.samplers.length;a++)b=this.samplers[a],this.extent.union(b.extent),this.demResolution.min=Math.min(this.demResolution.min,b.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,b.demResolution.max);else this.extent=g.toExtent(g.create(),e.spatialReference),this.demResolution={min:0,max:0}}Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},
enumerable:!0,configurable:!0});c.prototype.elevationAt=function(b){var c=a(b,this.spatialReference);if(!c)return null;for(var d=0,e=this.samplers;d<e.length;d++){var g=e[d];if(g.contains(c))return g.elevationAt(c)}l.warn("#elevationAt()","Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler");return null};c.prototype.queryElevation=function(a){return b(a.clone(),this)};c.prototype.on=function(a,b){return q};return c}();f.MultiTileElevationSampler=m;f.updateGeometryElevation=
b;var p=new k.Point,q={remove:function(){}}})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});(function(e){e[e.MAP=0]="MAP";e[e.ELEVATION=1]="ELEVATION";e[e.COUNT=2]="COUNT"})(f.LayerClass||(f.LayerClass={}));(function(e){e[e.NONE=0]="NONE";e[e.SPLIT=1]="SPLIT";e[e.VSPLITMERGE=2]="VSPLITMERGE";e[e.MERGE=4]="MERGE";e[e.DECODE_ELEVATION=8]="DECODE_ELEVATION";
e[e.UPDATE_GEOMETRY=16]="UPDATE_GEOMETRY";e[e.UPDATE_TEXTURE=32]="UPDATE_TEXTURE"})(f.TileUpdateTypes||(f.TileUpdateTypes={}));f.TILE_LOADING_DEBUGLOG=!1;f.MAX_ROOT_TILES=64;f.MAX_TILE_TESSELATION=512;f.ELEVATION_NODATA_VALUE=3.40282347E38/10;f.noDataValueOpt={noDataValue:f.ELEVATION_NODATA_VALUE};f.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;f.TILEMAP_SIZE_EXP=5;f.TILEMAP_SIZE=1<<f.TILEMAP_SIZE_EXP;f.WEBMERCATOR_WORLD_EXTENT=k.create();e.WebMercatorAuxiliarySphere.getExtent(0,0,0,f.WEBMERCATOR_WORLD_EXTENT);
f.GEOGRAPHIC_WORLD_EXTENT=k.create([-180,-90,180,90]);f.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";f.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";f.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC"})},
"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/scaleUtils ../../../layers/support/TileInfo ../support/mathUtils ../support/projectionUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a){var l=a.webMercator.x2lon,n=a.webMercator.y2lat;m=function(){function a(b){var c=a._checkUnsupported(b);if(c)throw c;this.spatialReference=b.spatialReference;
this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84=this.spatialReference.isWGS84;this.origin=[b.origin.x,b.origin.y];this.pixelSize=[b.size[0],b.size[1]];this.dpi=b.dpi;var d=b.lods.reduce(function(a,b,c){b.level<a.min&&(a.min=b.level,a.minIndex=c);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),e=b.lods[d.minIndex],g=Math.pow(2,e.level),c=e.resolution*g,e=e.scale*g;this.levels=Array(d.max+1);for(d=0;d<this.levels.length;d++)this.levels[d]={resolution:c,
scale:e,tileSize:[c*b.size[0],c*b.size[1]]},c/=2,e/=2}a.prototype.clone=function(){return new a(this.toTileInfo())};a.prototype.toTileInfo=function(){return new c({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:this.pixelSize,spatialReference:this.spatialReference,lods:this.levels.map(function(a,b){return{level:b,scale:a.scale,resolution:a.resolution}})})};a.prototype.getExtent=function(a,c,e,g,h){void 0===g&&(g=d.create());var f=this.levels[a];
a=f.tileSize[0];f=f.tileSize[1];g[0]=this.origin[0]+e*a;g[2]=g[0]+a;g[3]=this.origin[1]-c*f;g[1]=g[3]-f;h&&(this._isWebMercator?(h[0]=l(g[0]),h[1]=n(g[1]),h[2]=l(g[2]),h[3]=n(g[3])):this._isWGS84&&(h[0]=b.deg2rad(g[0]),h[1]=b.deg2rad(g[1]),h[2]=b.deg2rad(g[2]),h[3]=b.deg2rad(g[3])));return g};a.prototype.getExtentGeometry=function(a,b,c,d){void 0===d&&(d=new k.Extent);this.getExtent(a,b,c,p);d.spatialReference=this.spatialReference;d.xmin=p[0];d.ymin=p[1];d.xmax=p[2];d.ymax=p[3];d.zmin=void 0;d.zmax=
void 0;return d};a.prototype.ensureMaxLod=function(a){for(;this.levels.length<=a;){var b=this.levels[this.levels.length-1],c=b.resolution/2;this.levels.push({resolution:c,scale:b.scale/2,tileSize:[c*this.pixelSize[0],c*this.pixelSize[1]]})}};a.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};a.prototype.getMaxLod=function(){return this.levels.length-1};a.prototype.scaleAtLevel=function(a){return this.levels[0].scale/Math.pow(2,a)};a.prototype.levelAtScale=function(a){var b=
this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E};a.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};a.prototype.compatibleWith=function(c){if(!(c instanceof a)){if(a._checkUnsupported(c))return!1;c=new a(c)}if(!c.spatialReference.equals(this.spatialReference)||c.pixelSize[0]!==this.pixelSize[0]||c.pixelSize[1]!==this.pixelSize[1])return!1;var d=Math.min(this.levels.length,c.levels.length)-1,e=this.levels[d].resolution,g=.5*e;if(!b.floatEqualAbsolute(c.origin[0],
this.origin[0],g)||!b.floatEqualAbsolute(c.origin[1],this.origin[1],g))return!1;g=.5*e/Math.pow(2,d)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return b.floatEqualAbsolute(e,c.levels[d].resolution,g)};a.prototype.rootTilesInExtent=function(b,c,d){var e=this.levels[0].tileSize;a.computeRowColExtent(b,e,this.origin,p);b=p[1];var g=p[3],h=p[0],l=p[2],f=l-h,k=g-b;f*k>d&&(d=Math.floor(Math.sqrt(d)),k>d&&(b=b+Math.floor(.5*k)-Math.floor(.5*d),g=b+d),f>d&&(h=h+Math.floor(.5*f)-Math.floor(.5*d),l=h+
d));d=Array((l-h)*(g-b));f=0;for(k=b;k<g;k++)for(var m=h;m<l;m++)d[f++]=[0,k,m];c&&(c[0]=this.origin[0]+h*e[0],c[1]=this.origin[1]-g*e[1],c[2]=this.origin[0]+l*e[0],c[3]=this.origin[1]-b*e[1]);return d};a.computeRowColExtent=function(a,b,c,d){var e=.001*(a[2]-a[0]+(a[3]-a[1]));d[0]=Math.floor((a[0]+e-c[0])/b[0]);d[2]=Math.ceil((a[2]-e-c[0])/b[0]);d[1]=Math.floor((c[1]-a[3]+e)/b[1]);d[3]=Math.ceil((c[1]-a[1]-e)/b[1])};a.isPowerOfTwo=function(a){a=a.lods;var c=a[0].resolution*Math.pow(2,a[0].level);
return!a.some(function(a){return!b.floatEqualRelative(a.resolution,c/Math.pow(2,a.level))})};a.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};a.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};a._checkUnsupported=function(b){return b?1>b.lods.length?new e("tilingscheme:generic","Tiling scheme must have at least one level"):a.isPowerOfTwo(b)?
null:new e("tilingscheme:power-of-two","Tiling scheme must be power of two"):new e("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};a.checkUnsupported=function(b){var c=a._checkUnsupported(b);return c?c:a.hasGapInLevels(b)?new e("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):a.tileSizeSupported(b)?null:new e("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};a.fromExtent=function(b,d){var e=
b[2]-b[0],g=b[3]-b[1],l=h.getMetersPerUnitForSR(d),f=1.2*Math.max(e,g);b=new a(new c({size:[256,256],origin:{x:b[0]-.5*(f-e),y:b[3]+.5*(f-g)},lods:[{level:0,resolution:f/256,scale:1/(256/96*.0254/(f*l))}],spatialReference:d}));b.ensureMaxLod(20);return b};a.makeWebMercatorAuxiliarySphere=function(b){void 0===b&&(b=19);var c=new a(a.WebMercatorAuxiliarySphereTileInfo);c.ensureMaxLod(b);return c};a.makeWGS84WithTileSize=function(b,d){void 0===d&&(d=16);var e=256/b;b=new a(new c({size:[b,b],origin:{x:-180,
y:90,spatialReference:g.WGS84},spatialReference:g.WGS84,lods:[{level:0,resolution:.703125*e,scale:2.95497598570834E8*e}]}));b.ensureMaxLod(d);return b};a.WebMercatorAuxiliarySphereTileInfo=new c({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:g.WebMercator},spatialReference:g.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});a.WebMercatorAuxiliarySphere=a.makeWebMercatorAuxiliarySphere(19);return a}();var p=d.create();return m})},
"esri/layers/support/TileInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),function(m,
f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t=c({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});return function(c){function h(a){a=c.call(this)||this;a.dpi=96;a.format=null;a.origin=null;a.minScale=0;a.maxScale=0;a.size=null;a.spatialReference=null;return a}e(h,c);f=h;h.create=function(a){void 0===a&&(a={size:256,spatialReference:d.SpatialReference.WebMercator});
var b=a.resolutionFactor||1,c=a.scales,e=a.size||256;a=a.spatialReference||d.SpatialReference.WebMercator;var g=p.getInfo(a),g=g?new d.Point(g.origin[0],g.origin[1],a):new d.Point(0,0,a),h=1/(39.37*n.getMetersPerUnitForSR(a)*96),l=[];if(c)for(var k=0;k<c.length;k++){var m=c[k],q=m*h;l.push({level:k,scale:m,resolution:q})}else for(m=p.isGeographic(a)?512/e*1.47748799285417E8:256/e*5.91657527591555E8,c=Math.ceil(24/b),l.push({level:0,scale:m,resolution:m*h}),k=1;k<c;k++)m/=Math.pow(2,b),q=m*h,l.push({level:k,
scale:m,resolution:q});return new f({dpi:96,lods:l,origin:g,size:e,spatialReference:a})};Object.defineProperty(h.prototype,"isWrappable",{get:function(){var a=this.spatialReference,b=this.origin;if(a&&b){var c=p.getInfo(a);return a.isWrappable&&Math.abs(c.origin[0]-b.x)<=c.dx}return!1},enumerable:!0,configurable:!0});h.prototype.readOrigin=function(a,b){return d.Point.fromJSON(k({spatialReference:b.spatialReference},a))};Object.defineProperty(h.prototype,"lods",{set:function(a){var b=this,c=0,d=0,
e=[];this._levelToLOD={};a&&(c=-Infinity,d=Infinity,a.forEach(function(a){e.push(a.scale);c=a.scale>c?a.scale:c;d=a.scale<d?a.scale:d;b._levelToLOD[a.level]=a}));this._set("scales",e);this._set("minScale",c);this._set("maxScale",d);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});h.prototype.readSize=function(a,b){return[b.cols,b.rows]};h.prototype.writeSize=function(a,b){b.cols=a[0];b.rows=a[0]};h.prototype.zoomToScale=function(a){var b=this.scales;if(0>=a)return b[0];
if(a>=b.length)return b[b.length-1];var c=Math.round(a);return b[c]+(c-a)*(b[Math.round(a-.5)]-b[c])};h.prototype.scaleToZoom=function(a){for(var b=this.scales,c=b.length-1,d=0;d<c;d++){var e=b[d],g=b[d+1];if(e<=a)break;if(g===a)return d+1;if(e>a&&g<a)return d+1-(a-g)/(e-g)}return d};h.prototype.snapScale=function(a,b){void 0===b&&(b=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=b?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};h.prototype.tileAt=function(a,b,c,d){var e=this.lodAt(a);
if(!e)return null;var g;if("number"===typeof b)g=b,b=c;else{if(p.equals(b.spatialReference,this.spatialReference))g=b.x,b=b.y;else{d=q.project(b,this.spatialReference);if(!d)return null;g=d.x;b=d.y}d=c}c=e.resolution*this.size[0];e=e.resolution*this.size[1];d||(d={id:null,level:0,row:0,col:0,extent:l.create()});d.level=a;d.row=Math.floor((this.origin.y-b)/e+.001);d.col=Math.floor((g-this.origin.x)/c+.001);this.updateTileInfo(d);return d};h.prototype.updateTileInfo=function(a){var b=this.lodAt(a.level);
if(b){var c=b.resolution*this.size[0],b=b.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=l.create());a.extent[0]=this.origin.x+a.col*c;a.extent[1]=this.origin.y-(a.row+1)*b;a.extent[2]=a.extent[0]+c;a.extent[3]=a.extent[1]+b}};h.prototype.upsampleTile=function(a){var b=this._upsampleLevels[a.level];if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+.001);a.col=Math.floor(a.col/b.factor+.001);this.updateTileInfo(a);return!0};h.prototype.getTileBounds=
function(a,b){var c=this.lodAt(b.level).resolution,d=c*this.size[0],c=c*this.size[1];a[0]=this.origin.x+b.col*d;a[1]=this.origin.y-(b.row+1)*c;a[2]=a[0]+d;a[3]=a[1]+c;return a};h.prototype.lodAt=function(a){return this._levelToLOD&&this._levelToLOD[a]||null};h.prototype.clone=function(){return f.fromJSON(this.write({}))};h.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,c=0;c<a.length;c++){var d=a[c];this._upsampleLevels[d.level]={parentLevel:b?
b.level:-1,factor:b?b.resolution/d.resolution:0};b=d}};var f;g([b.property({type:Number,json:{write:!0}})],h.prototype,"compressionQuality",void 0);g([b.property({type:Number,json:{write:!0}})],h.prototype,"dpi",void 0);g([b.property({type:String,json:{read:t.read,write:t.write}})],h.prototype,"format",void 0);g([b.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],h.prototype,"isWrappable",null);g([b.property({type:d.Point,json:{write:!0}})],h.prototype,"origin",void 0);g([b.reader("origin")],
h.prototype,"readOrigin",null);g([b.property({type:[r],value:null,json:{write:!0}})],h.prototype,"lods",null);g([b.property({readOnly:!0})],h.prototype,"minScale",void 0);g([b.property({readOnly:!0})],h.prototype,"maxScale",void 0);g([b.property({readOnly:!0})],h.prototype,"scales",void 0);g([b.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,a]:[256,256]}})],h.prototype,"size",void 0);g([b.reader("size",["rows","cols"])],h.prototype,"readSize",null);g([b.writer("size",
{cols:{type:a.Integer},rows:{type:a.Integer}})],h.prototype,"writeSize",null);g([b.property({type:d.SpatialReference,json:{write:!0}})],h.prototype,"spatialReference",void 0);return h=f=g([b.subclass("esri.layers.support.TileInfo")],h)}(b.declared(h))})},"esri/layers/support/LOD":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,a)||this;a.level=0;a.levelValue=null;a.resolution=0;a.scale=0;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var a;e([d.property({type:h.Integer,json:{write:!0}})],b.prototype,"level",void 0);e([d.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);e([d.property({type:Number,json:{write:!0}})],b.prototype,
"resolution",void 0);e([d.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=a=e([d.subclass("esri.layers.support.LOD")],b)}(d.declared(g))})},"esri/views/support/DefaultsFromMap":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/arrayUtils ../../core/Handles ../../core/Logger ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/heightModelInfoUtils ../../geometry/support/webMercatorUtils ../../portal/support/geometryServiceUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){function q(a){return a?JSON.stringify(a.toJSON()):"undefined"}function r(a){switch(a){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}return"Unknown: "+a}var t=c.getLogger("esri.views.support.DefaultsFromMap");return function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a._handles=new h;a._waitTask=null;a._isStarted=!1;a._spatialReferenceCandidates=null;a._extentCandidates=null;a.logDebugInformation=!1;a.isSpatialReferenceDone=
!1;a.isTileInfoDone=!1;a.isHeightModelInfoSearching=!1;a.spatialReference=null;a.extent=null;a.heightModelInfo=null;a.vcsWkid=null;a.latestVcsWkid=null;a.mapCollectionPaths=f.DefaultMapCollectionPaths.slice();a.tileInfo=null;return a}k(g,c);f=g;g.prototype.initialize=function(){var a=this;this.watch("mapCollectionPaths",function(){a._isStarted&&(a.reset(),a.start())})};g.prototype.destroy=function(){this._set("view",null);this._handles&&(this._handles.destroy(),this._handles=null,this._isStarted=
!1);this._cancelLoading()};g.prototype.reset=function(){this._handles.removeAll();this._isStarted=!1;this._set("isSpatialReferenceDone",!1);this._set("isTileInfoDone",!1);this._set("isHeightModelInfoSearching",!1);this._set("spatialReference",null);this._set("extent",null);this._set("heightModelInfo",null);this._set("vcsWkid",null);this._set("latestVcsWkid",null);this._set("tileInfo",null);this._extentCandidates=this._spatialReferenceCandidates=null};g.prototype.start=function(){this._handles.removeAll();
this._isStarted=!0;for(var a=this._updateLayerChange.bind(this),c=0,d=this.mapCollectionPaths;c<d.length;c++)this._handles.add(b.on(this.view,"map."+d[c],"change",a,a,a,!0))};g.prototype._ownerNameFromCollectionName=function(a){var b=a.lastIndexOf(".");return-1===b?"view":"view."+a.slice(0,b)};g.prototype._ensureLoadedOwnersFromCollectionName=function(a){a=this._ownerNameFromCollectionName(a).split(".");for(var b,c=0;c<a.length;c++){b=this.get(a.slice(0,c+1).join("."));if(!b)break;if(b.load&&!b.isFulfilled())return{owner:null,
loading:b.load()}}return{owner:b}};g.prototype._cancelLoading=function(){this._waitTask=null;this._extentProjectTask&&(this._extentProjectTask.cancel(),this._extentProjectTask=null)};g.prototype._updateWhen=function(a){var b=this,c=!0,d=!1,e=a.always(function(){c?d=!0:e===b._waitTask&&b._update()}),c=!1;d||(this._waitTask=e);return d};g.prototype._updateLayerChange=function(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1);this._update()};g.prototype._update=
function(){var a=this;this._cancelLoading();if(this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");var b=this._processMapCollections(function(b){return a._processSpatialReferenceSource(b)});this._debugLog("Search ended with status '"+r(b)+"'");if(0!==b){var c=null,b=this._spatialReferenceCandidates;!b||1>b.length?(c=this.defaultSpatialReference,this._debugLog("No spatial reference found, locking to default ("+q(c)+")")):(this.defaultSpatialReference&&
1<b.length&&-1<d.findIndex(b,function(b){return b.equals(a.defaultSpatialReference)})&&(b=[this.defaultSpatialReference]),c=b[0],this._debugLog("Locking to "+q(c)));this._set("spatialReference",c);this._set("isSpatialReferenceDone",!0);c&&(b=this.logDebugInformation,this.logDebugInformation=!1,this._processMapCollections(function(b){return a._findExtent(b,c)}),this.extent||this._projectExtentCandidate(),this.logDebugInformation=b)}}null==this.heightModelInfo&&this.view.isHeightModelInfoRequired&&
(this._debugLog("Starting search for height model info..."),b=this._processMapCollections(function(b){return a._processHeightModelInfoSource(b)},function(a){return l.mayHaveHeightModelInfo(a)}),this._debugLog("Search ended with status "+r(b)),this._set("isHeightModelInfoSearching",0===b));null==this.tileInfo&&(b=!1,this.view.isTileInfoRequired()&&(b=this._deriveTileInfo()),b||this._set("isTileInfoDone",!0))}};g.prototype._processMapCollections=function(a,b){for(var c=0,d=this.mapCollectionPaths;c<
d.length;c++){var e="map."+d[c],g=this._ensureLoadedOwnersFromCollectionName(e);this._debugLog("Processing collection "+e+"...");if(g.loading&&!this._updateWhen(g.loading))return this._debugLog("Collection "+e+" owner is loading -\x3e wait"),0;g=g.owner;if(!g||g.isRejected&&g.isRejected())this._debugLog("Collection "+e+" owner is invalid or rejected -\x3e skip");else if(g=this.view.get(e)){if(e=this._processMapCollection(g,a,b),2!==e)return e}else this._debugLog("Collection "+e+" does not exist -\x3e skip")}return 2};
g.prototype._processMapCollection=function(a,b,c){for(var d=0;d<a.length;d++){var e=a.getItemAt(d);if(null==c||c(e)){if(e.load&&!e.isFulfilled()&&!this._updateWhen(e.load()))return this._debugLog("Source "+e.id+" is loading -\x3e wait"),0;if(!e.load||e.isResolved()){if(b(e))return 1;if(e.layers&&(e=this._processMapCollection(e.layers,b),2!==e))return e}}else this._debugLog("Source "+e.id+" is skipped due to predicate")}return 2};g.prototype._processSpatialReferenceSource=function(a){var b=this._getSupportedSpatialReferences(a);
if(0===b.length)return!1;this._spatialReferenceCandidates?(b=d.intersect(b,this._spatialReferenceCandidates,function(a,b){return a.equals(b)}),0<b.length?this._spatialReferenceCandidates=b:this._debugLog("Layer "+a.id+" is ignored because its supported spatial\n          references are not compatible with the previous candidates")):this._spatialReferenceCandidates=b;return 1===this._spatialReferenceCandidates.length};g.prototype._findExtent=function(a,b){var c=a.fullExtents||(a.fullExtent?[a.fullExtent]:
[]),e=d.find(c,function(a){return a.spatialReference.equals(b)});if(e)return this._set("extent",e),!0;0<this._getSupportedSpatialReferences(a).length&&(c=c.map(function(b){return{extent:b,layer:a}}),this._extentCandidates=(this._extentCandidates||[]).concat(c));return!1};g.prototype._projectExtentCandidate=function(){var a=this;if(this._extentCandidates&&this._extentCandidates.length){var b=this.spatialReference,c=d.find(this._extentCandidates,function(a){return n.canProject(a.extent.spatialReference,
b)});c?this._set("extent",n.project(c.extent,b)):(c=this._extentCandidates[0],this._extentProjectTask=p.projectGeometry(c.extent,b,c.layer.portalItem).then(function(b){a._set("extent",b)}))}};g.prototype._getSupportedSpatialReferences=function(a){var b=this,c=a.supportedSpatialReferences||(a.spatialReference?[a.spatialReference]:[]);if(0===c.length)return this._debugLog("Layer "+a.id+" is ignored because it does not have any spatial references"),[];c=c.filter(function(c){return b.view.isSpatialReferenceSupported(c,
a,function(a){return b._debugLog(a)})});0===c.length?this._debugLog("Layer "+a.id+" has spatial references but none of them are supported (or layer doesn't require locking)"):this._debugLog("Layer "+a.id+" has spatial references. Resulting candidate set: "+c.map(q).join(", "));return c};g.prototype._processHeightModelInfoSource=function(a){var b=l.deriveHeightModelInfoFromLayer(a);return b?(this._set("heightModelInfo",b),this._set("isHeightModelInfoSearching",!1),a.spatialReference&&(this._set("vcsWkid",
a.spatialReference.vcsWkid),this._set("latestVcsWkid",a.spatialReference.latestVcsWkid)),!0):!1};g.prototype._deriveTileInfo=function(){if(!this.isSpatialReferenceDone)return!0;var a=this.get("view.map");if(!a)return!0;var b=a.basemap,c=b&&b.get("baseLayers.0"),a=a.get("layers.0"),d=!1,e=null;b&&"failed"!==b.loadStatus?b.loaded?c&&"failed"!==c.loadStatus?c.loaded?e=c.tileInfo:(this._updateWhen(c.load()),d=!0):a&&"failed"!==a.loadStatus?a.loaded?e=a.tileInfo:(this._updateWhen(a.load()),d=!0):d=!0:
(this._updateWhen(b.load()),d=!0):a&&"failed"!==a.loadStatus&&(a.loaded?e=a.tileInfo:(this._updateWhen(a.load()),d=!0));e&&!e.spatialReference.equals(this.spatialReference)&&(e=null);d||this._set("tileInfo",e);return d};g.prototype._debugLog=function(a){this.logDebugInformation&&t.info(a)};var f;g.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"];e([a.property()],g.prototype,"logDebugInformation",void 0);e([a.property({readOnly:!0})],g.prototype,"isSpatialReferenceDone",
void 0);e([a.property({readOnly:!0})],g.prototype,"isTileInfoDone",void 0);e([a.property({readOnly:!0})],g.prototype,"isHeightModelInfoSearching",void 0);e([a.property({constructOnly:!0})],g.prototype,"view",void 0);e([a.property({readOnly:!0})],g.prototype,"spatialReference",void 0);e([a.property({readOnly:!0})],g.prototype,"extent",void 0);e([a.property({readOnly:!0})],g.prototype,"heightModelInfo",void 0);e([a.property({readOnly:!0})],g.prototype,"vcsWkid",void 0);e([a.property({readOnly:!0})],
g.prototype,"latestVcsWkid",void 0);e([a.property()],g.prototype,"mapCollectionPaths",void 0);e([a.property()],g.prototype,"defaultSpatialReference",void 0);e([a.property({readOnly:!0})],g.prototype,"tileInfo",void 0);return g=f=e([a.subclass("esri.views.support.DefaultsFromMap")],g)}(a.declared(g))})},"esri/views/input/Input":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./gamepad/GamepadSettings".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.gamepad=new h;return a}k(b,c);e([d.property({readOnly:!0})],b.prototype,"gamepad",void 0);return b=e([d.subclass("esri.views.input.Input")],b)}(d.declared(g))})},"esri/views/input/gamepad/GamepadSettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Collection ../../../core/accessorSupport/decorators ./GamepadInputDevice".split(" "),
function(m,f,k,e,g,d,h,c){return function(b){function a(){var a=b.call(this)||this;a.devices=new d;a.enabledFocusMode="document";return a}k(a,b);e([h.property({type:d.ofType(c),readOnly:!0})],a.prototype,"devices",void 0);e([h.property({type:["document","view","none"]})],a.prototype,"enabledFocusMode",void 0);return a=e([h.subclass("esri.views.input.gamepad.GamepadSettings")],a)}(h.declared(g))})},"esri/views/input/gamepad/GamepadInputDevice":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){var h=/^(3dconnexion|space(mouse|navigator|pilot|explorer))/i,c={standard:.15,spacemouse:.025,unknown:0};return function(b){function a(a){var c=b.call(this)||this;c.native=null;c._detectedDeviceType="unknown";"standard"===a.mapping?c._detectedDeviceType="standard":h.test(a.id)?c._detectedDeviceType="spacemouse":c._detectedDeviceType="unknown";c.native=a;return c}k(a,b);Object.defineProperty(a.prototype,"deviceType",{get:function(){return this._detectedDeviceType},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"axisThreshold",{get:function(){return c[this.deviceType]},enumerable:!0,configurable:!0});e([d.property({nonNullable:!0,readOnly:!0})],a.prototype,"native",void 0);e([d.property({type:String,readOnly:!0})],a.prototype,"deviceType",null);e([d.property({type:Number,readOnly:!0})],a.prototype,"axisThreshold",null);return a=e([d.subclass("esri.views.input.gamepad.GamepadInputDevice")],a)}(d.declared(g))})},"esri/views/navigation/Navigation":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./gamepad/GamepadSettings".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,a)||this;a.gamepad=new h;return a}k(b,c);e([d.property({readOnly:!0})],b.prototype,"gamepad",void 0);return b=e([d.subclass("esri.views.navigation.Navigation")],b)}(d.declared(g))})},"esri/views/navigation/gamepad/GamepadSettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../input/gamepad/GamepadInputDevice".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(){var a=c.call(this)||this;a.enabled=!0;a.device=null;a.mode="pan";a.tiltDirection="forward-down";a.velocityFactor=1;return a}k(b,c);e([d.property({type:Boolean,nonNullable:!0})],b.prototype,"enabled",void 0);e([d.property({type:h})],b.prototype,"device",void 0);e([d.property({type:["pan","zoom"],nonNullable:!0})],b.prototype,"mode",void 0);e([d.property({type:["forward-down","forward-up"],nonNullable:!0})],b.prototype,"tiltDirection",void 0);
e([d.property({type:Number,nonNullable:!0})],b.prototype,"velocityFactor",void 0);return b=e([d.subclass("esri.views.navigation.gamepad.GamepadSettings")],b)}(d.declared(g))})},"esri/views/ViewAnimation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/Deferred ../core/Accessor ../core/Error ../core/Promise ../core/promiseUtils ../core/scheduling ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){m=function(c){function d(a){a=
c.call(this)||this;a.state="running";a.target=null;return a}k(d,c);d.prototype.initialize=function(){this._dfd=new g;this.addResolvingPromise(this._dfd.promise)};Object.defineProperty(d.prototype,"done",{get:function(){return"finished"===this.state||"stopped"===this.state},enumerable:!0,configurable:!0});d.prototype.stop=function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),a.schedule(this._dfd.reject.bind(this._dfd,new h("ViewAnimation stopped"))))};d.prototype.finish=
function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),a.schedule(this._dfd.resolve))};d.prototype.update=function(a,c){c||(c=b.isThenable(a)?"waiting-for-target":"running");this._set("target",a);this._set("state",c)};e([l.property({readOnly:!0,dependsOn:["state"]})],d.prototype,"done",null);e([l.property({readOnly:!0,type:String})],d.prototype,"state",void 0);e([l.property()],d.prototype,"target",void 0);return d=e([l.subclass("esri.views.ViewAnimation")],d)}(l.declared(d,
c));(m||(m={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};return m})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,
"__esModule",{value:!0});m=function(g){function l(){var d=null!==g&&g.apply(this,arguments)||this;d.tilt=new a.default;d.altitude=new h.default;d.clipDistance=new c.default;d.collision=new b.default;return d}k(l,g);e([d.property({type:a.default})],l.prototype,"tilt",void 0);e([d.property({type:h.default})],l.prototype,"altitude",void 0);e([d.property({type:c.default})],l.prototype,"clipDistance",void 0);e([d.property({type:b.default})],l.prototype,"collision",void 0);return l=e([d.subclass("esri.views.3d.constraints.Constraints")],
l)}(d.declared(g));f.Constraints=m;f.default=m})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.min=c.AltitudeDefault.min;
a.max=c.AltitudeDefault.max;return a}k(a,b);Object.defineProperty(a.prototype,"mode",{get:function(){g.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){g.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});e([h.property({type:Number})],a.prototype,"min",void 0);e([h.property({type:Number})],a.prototype,"max",void 0);return a=e([h.subclass("esri.views.3d.constraints.AltitudeConstraint")],a)}(h.declared(d));f.AltitudeConstraint=m;f.default=m})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});var a=d.getLogger("esri.views.3d.state.Constraints");m=function(c){function d(a){a=c.call(this)||this;a.collision=new n;a.distance=Infinity;a.minimumPoiDistance=4;return a}k(d,c);Object.defineProperty(d.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(b){"local"===this.mode?a.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",b)},enumerable:!0,
configurable:!0});d.prototype.clampAltitude=function(a){return this.altitude?b.clamp(a,this.altitude.min,this.altitude.max):a};d.prototype.clampTilt=function(a,c){if(!this.tilt)return c;a=this.tilt(a);return b.clamp(c,a.min,a.max)};d.prototype.clampDistance=function(a){return Math.min(a,this.distance)};d.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};d.prototype.createConstantMaxTilt=function(a){return function(b,c){void 0===
c&&(c=l);c.min=f.TiltDefault.min;c.max=a;return c}};d.prototype.createDefaultTiltLocal=function(){var a=this.collision.enabled?b.makePiecewiseLinearFunction([[4E3,f.TiltDefault.max],[1E4,b.deg2rad(88)],[6E6,b.deg2rad(88)]]):function(){return f.TiltDefault.max};return function(b,c){void 0===c&&(c=l);c.min=f.TiltDefault.min;c.max=a(b);return c}};d.prototype.createDefaultTiltGlobal=function(){var a=this.collision.enabled?b.makePiecewiseLinearFunction([[4E3,f.TiltDefault.max],[5E4,b.deg2rad(88)],[6E6,
b.deg2rad(88)],[2E7,f.TiltDefault.min]]):b.makePiecewiseLinearFunction([[3E5,f.TiltDefault.max],[3E6,b.deg2rad(88)],[6E6,b.deg2rad(88)],[2E7,f.TiltDefault.min]]);return function(b,c){void 0===c&&(c=l);c.min=f.TiltDefault.min;c.max=a(b);return c}};e([h.property()],d.prototype,"altitude",null);e([h.property({readOnly:!0})],d.prototype,"collision",void 0);e([h.property()],d.prototype,"distance",void 0);e([h.property({readOnly:!0})],d.prototype,"minimumPoiDistance",void 0);e([h.property()],d.prototype,
"tilt",void 0);e([h.property({constructOnly:!0})],d.prototype,"mode",void 0);return d=e([h.subclass("esri.views.3d.state.Constraints")],d)}(h.declared(g));f.Constraints=m;f.AltitudeDefault={min:-2E5,max:4*c.earthRadius};f.TiltDefault={min:b.deg2rad(.5),max:b.deg2rad(179.5)};var l={min:0,max:0},n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.enabled=!0;b.elevationMargin=5;return b}k(b,a);e([h.property({type:Boolean})],b.prototype,"enabled",void 0);e([h.property({type:Number})],
b.prototype,"elevationMargin",void 0);return b=e([h.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],b)}(h.declared(g));f.default=m})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(){var b=
null!==g&&g.apply(this,arguments)||this;b.mode="auto";return b}k(c,g);Object.defineProperty(c.prototype,"near",{get:function(){return this._get("near")},set:function(b){this._set("near",b);b>=this._get("far")&&(this.far=b+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});c.prototype.castNear=function(b){return Math.max(1E-8,b)};Object.defineProperty(c.prototype,"far",{get:function(){return this._get("far")},set:function(b){this._set("far",b);b<=this._get("near")&&(this.near=b-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});c.prototype.castFar=function(b){return Math.max(1E-8,b)};c.prototype.autoUpdate=function(b,a){"auto"===this.mode&&(this._get("near")!==b&&this._set("near",b),this._get("far")!==a&&this._set("far",a))};e([d.property({type:Number,value:1E-8})],c.prototype,"near",null);e([d.cast("near")],c.prototype,"castNear",null);e([d.property({type:Number,value:1E-8})],c.prototype,"far",null);e([d.cast("far")],c.prototype,"castFar",null);e([d.property({type:String})],c.prototype,
"mode",void 0);return c=e([d.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],c)}(d.declared(g));f.ClipDistanceConstraint=m;f.default=m})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(){return null!==
c&&c.apply(this,arguments)||this}k(b,c);Object.defineProperty(b.prototype,"enabled",{set:function(a){g.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",a)},enumerable:!0,configurable:!0});e([h.property({value:!0})],b.prototype,"enabled",null);return b=e([h.subclass("esri.views.3d.constraints.CollisionConstraint")],b)}(h.declared(d));f.CollisionConstraint=m;f.default=m})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});var b=c.rad2deg(h.TiltDefault.min),a=c.rad2deg(h.TiltDefault.max);m=function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a.mode="auto";return a}k(h,g);Object.defineProperty(h.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});h.prototype.castMax=function(d){return c.clamp(d,b,a)};h.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};e([d.property({type:String})],h.prototype,"mode",void 0);e([d.property({type:Number,value:a})],h.prototype,"max",null);e([d.cast("max")],h.prototype,"castMax",null);return h=e([d.subclass("esri.views.3d.constraints.TiltConstraint")],h)}(d.declared(g));f.TiltConstraint=m;f.default=m})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/lang ../../../core/accessorSupport/decorators ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a.atmosphere=new h.default;return a}k(l,b);f=l;Object.defineProperty(l.prototype,"lighting",{set:function(b){if(b)if(this.lighting)null!=b.date&&(this.lighting.date=b.date),null!=b.defaultDate&&(this.lighting.defaultDate=b.defaultDate),null!=b.displayUTCOffset&&(this.lighting.displayUTCOffset=b.displayUTCOffset),this.lighting.directShadowsEnabled=b.directShadowsEnabled,null!=b.ambientOcclusionEnabled&&
(this.lighting.ambientOcclusionEnabled=b.ambientOcclusionEnabled),null!=b.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=b.cameraTrackingEnabled);else if(b instanceof c.default)this._set("lighting",b);else if(b instanceof a){var d={directShadowsEnabled:b.directShadowsEnabled};null!=b.date&&(d.date=b.date);null!=b.displayUTCOffset&&(d.displayUTCOffset=b.displayUTCOffset);null!=b.defaultDate&&(d.defaultDate=b.defaultDate);this._set("lighting",new c.default(d))}else this._set("lighting",
new c.default(b));else this.lighting||this._set("lighting",new c.default)},enumerable:!0,configurable:!0});l.prototype.clone=function(){return new f({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:g.clone(this.background)})};var f;e([d.property({type:h.default,json:{read:!1}})],l.prototype,"atmosphere",void 0);e([d.property()],l.prototype,"lighting",null);return l=f=e([d.subclass("esri.views.3d.environment.SceneViewEnvironment")],
l)}(d.declared(b))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(){return null!==g&&g.apply(this,arguments)||this}k(c,g);Object.defineProperty(c.prototype,"quality",{set:function(b){-1!==["low","high"].indexOf(b)&&
this._set("quality",b)},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new this.constructor({quality:this.quality})};e([d.property({type:String,value:"low"})],c.prototype,"quality",null);return c=e([d.subclass("esri.views.3d.environment.SceneViewAtmosphere")],c)}(d.declared(g));f.SceneViewAtmosphere=m;f.default=m})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function h(a){a=g.call(this)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var b=(new Date).getFullYear(),b=new Date("March 15, "+b+" 12:00:00 UTC");a._set("defaultDate",b);a._set("date",b);return a}k(h,g);Object.defineProperty(h.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=
this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())),this._emitDateWillChange())},enumerable:!0,configurable:!0});h.prototype.autoUpdate=function(b,c){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=c.hours;
this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=b&&(this.positionTimezoneInfo.autoUpdated=!0,c=this.date&&this.date.getTime(),this._set("date",new Date(b.getTime())),this._emitDateWillChange());var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==e&&(a.target=this,a.timezoneOffset=e,this.emit("timezone-will-change",a));if(null!=b)return c!==b.getTime()};h.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/
60+a.seconds/3600)};h.prototype._emitDateWillChange=function(){b.target=this;c.setTime(this._get("date").getTime());b.date=c;this.emit("date-will-change",b)};e([d.property({type:Boolean})],h.prototype,"cameraTrackingEnabled",void 0);e([d.property({type:Boolean})],h.prototype,"ambientOcclusionEnabled",void 0);e([d.property({type:Date})],h.prototype,"defaultDate",null);e([d.property({type:Date})],h.prototype,"date",null);return h=e([d.subclass("esri.views.3d.environment.SceneViewLighting")],h)}(d.declared(h,
g));f.SceneViewLighting=m;var c=new Date,b={target:null,date:null},a={target:null,timezoneOffset:0};f.default=m})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){return function(g){function c(a){a=g.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}k(c,g);b=c;c.prototype.readDate=function(a,
b){return null!=b.datetime&&new Date(b.datetime)||null};c.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};c.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};c.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};c.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};c.prototype.clone=function(){return new b({date:null!=this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null})};c.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};var b;e([d.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);e([d.reader("date",["datetime"])],c.prototype,"readDate",null);e([d.writer("date")],c.prototype,"writeDate",null);e([d.property({type:Boolean,json:{write:{target:"directShadows"}}})],
c.prototype,"directShadowsEnabled",void 0);e([d.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);e([d.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);e([d.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);e([d.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=b=e([d.subclass("esri.webscene.Lighting")],c)}(d.declared(g))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=function(a,b,c){return{enabled:!c||!c.isPresentation}};return function(g){function l(a){a=g.call(this,a)||this;a.lighting=new c;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}k(l,g);f=l;l.prototype.clone=function(){return new f({lighting:c.prototype.clone.call(this.lighting),background:d.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})};l.sanitizeJSON=function(a){return{lighting:a.lighting?c.sanitizeJSON(a.lighting):
(new c).toJSON(),background:a.background,atmosphereEnabled:a.atmosphereEnabled,starsEnabled:a.starsEnabled}};var f;e([h.property({type:c,json:{write:!0}})],l.prototype,"lighting",void 0);e([h.property(b.backgroundProperty)],l.prototype,"background",void 0);e([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],l.prototype,"atmosphereEnabled",void 0);e([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],l.prototype,"starsEnabled",void 0);return l=f=e([h.subclass("esri.webscene.Environment")],
l)}(h.declared(g))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m={base:k,key:"type",typeMap:{color:e}};f.backgroundProperty={types:m,json:{read:function(e){return function(d,g,c){if(!d)return d;for(var b in e.typeMap)if(d.type===b)return g=new e.typeMap[b],g.read(d,c),g}}(m),write:{overridePolicy:function(e,d,h){return{enabled:!h||!h.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h,c){var b=h.strict()({color:"color"});return function(a){function d(b){return a.call(this)||this}k(d,a);d.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=g({},a),delete a.type);return a};d.prototype.clone=function(){};e([c.property({type:b.apiValues,readOnly:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],d.prototype,"type",void 0);return d=e([c.subclass("esri.webscene.background.Background")],d)}(c.declared(d))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=g({},c.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function c(a){a=b.call(this)||this;a.type="color";a.color=new d([0,0,0,1]);return a}k(c,b);g=c;c.prototype.clone=function(){return new g(this.cloneProperties())};c.prototype.cloneProperties=function(){return{color:this.color.clone()}};var g;e([h.enumeration.serializable()({color:"color"})],c.prototype,"type",void 0);e([h.property(a)],c.prototype,"color",void 0);return c=g=e([h.subclass("esri.webscene.background.ColorBackground")],
c)}(h.declared(b))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../lib/gl-matrix ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v){Object.defineProperty(f,"__esModule",{value:!0});var z=[.5773502691896258,-.5773502691896258,.5773502691896258];m=function(d){function h(a){a=d.call(this)||this;a.referencePointUpdateDelay=200;a.referencePointUpdateInterval=3E3;a.referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new c;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._viewConnected=!1;a._referencePosResetPreserveAbsoluteTime=
!1;a._referencePosUpdateTimer=null;a._referencePosWGS84=null;a._referencePosMapCoords=null;a._mainLight=new x.MainLight;a._ambientLight=new x.AmbientLight;a._moonLight=new x.FillLight;a._environmentRenderer=null;a._resetReferencePosition();return a}k(h,d);h.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(h.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)},
enumerable:!0,configurable:!0});h.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};h.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};h.prototype.connectView=function(b){var c=this;this._environmentRenderer=new r({view:b});this._viewHandles.add([this.view.watch("environment.lighting.date",
function(a){return c._lightingDateHandler(a)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),a.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),a.init(this.view,"environment.lighting.cameraTrackingEnabled",
this._updateCameraTracking.bind(this),!0),a.init(this,"view.state.camera",this._cameraHandler.bind(this,null),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};h.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1};h.prototype.disconnectView=function(a){this.disposeRendering();
this._viewHandles.removeAll()};h.prototype._lightingDateHandler=function(a){if(a){var b=this.view.environment.lighting;if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var c=this.view.spatialReference;if(!(c.isWGS84||c.isWebMercator||(c=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(c)))){this._requestReferencePositionUpdate(c);return}this._preupdateTracking(a);this._referencePosWGS84&&(c=w.positionToTimezone(this._referencePosWGS84,
A),b.autoUpdate(null,c),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};h.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};h.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var b=this.view.camera;if(b){var c=this.view.spatialReference;c.isWGS84||c.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}}};
h.prototype._cameraHandlerGlobal=function(a,b){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new n({spatialReference:p.WGS84}));a.spatialReference.isWebMercator?q.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,b)||this._updateLightParams(b)};h.prototype._cameraHandlerLocal=function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||
this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};h.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};h.prototype._updateLightParams=function(a){void 0===a&&(a=null);var b=this.view.environment.lighting;a=a||b.date;var b=
this.view._stage,c;this._referencePosWGS84?(c=u.computeColorAndIntensity(a,this._referencePosWGS84),u.computeDirection(a,this._referencePosWGS84,this.view.viewingMode,c.diffuse.direction)):c={diffuse:{color:[1,1,1],intensity:.55,direction:z},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};t.vec3d.scale(c.diffuse.color,c.diffuse.intensity*Math.PI,this._mainLight.intensity);t.vec3d.negate(c.diffuse.direction,this._mainLight.direction);t.vec3d.scale(c.ambient.color,c.ambient.intensity,
this._ambientLight.intensity);t.vec3d.lerp(B,C,c.globalFactor,this._moonLight.intensity);t.vec3d.scale(this._moonLight.intensity,(1-.5*c.globalFactor)*(1-.4*c.noonFactor*(1-c.globalFactor)));t.vec3d.set(c.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:c.globalFactor,groundLightingFactor:1-c.noonFactor});this._updateRenderParamsHandler()};h.prototype._autoUpdateTimezone=function(a,b){void 0===b&&(b=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;
var c=y;c.setTime((b||this.view.environment.lighting.date).getTime());a=w.positionToTimezone(a,A);var d=this.view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=a;else if(d.hours===a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1;var e=c.getUTCHours()-(a.hours-d.hours),g=c.getUTCMinutes()-(a.minutes-d.minutes),d=c.getUTCSeconds()-(a.seconds-d.seconds);c.setUTCHours(e);c.setUTCMinutes(g);c.setUTCSeconds(d);return b?!1:this.view.environment.lighting.autoUpdate(c,a)};h.prototype._updateRenderParamsHandler=
function(){var a=this.view._stage,b=!0;this._referencePosWGS84&&(b=u.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var c=this.view.environment.background,c=c instanceof v?{type:"color",color:g.toUnitRGBA(c.color)}:{type:"color",color:[0,0,0,1]};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&b,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:c})};h.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};
h.prototype._viewingModeHandler=function(){this._resetReferencePosition()};h.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};h.prototype._requestReferencePositionUpdate=function(a,c){var d=this;void 0===c&&(c=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!c,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var e=this._referencePosUpdateQuery=b.after(this.referencePointUpdateDelay).then(function(){if(d._referencePosUpdateQuery===e)return d._doReferencePositionUpdateQuery(function(){return d._referencePosUpdateQuery!==
e})}).always(function(){d._referencePosUpdateQuery===e&&(d._referencePosUpdateQuery=null,d._referencePosUpdateTimer||d._executePendingReferencePositionUpdate(),d.notifyChange("updating"))}),g=this._referencePosUpdateTimer=b.after(this.referencePointUpdateInterval).then(function(){d._referencePosUpdateTimer===g&&(d._referencePosUpdateTimer=null,d._referencePosUpdateQuery||d._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};h.prototype._doReferencePositionUpdateQuery=function(a){var b=
this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(c){if(!a()&&!isNaN(c[0])&&!isNaN(c[1])){var d=b._referencePosMapCoords.z*
b.view.mapCoordsHelper.unitInMeters;b._referencePosWGS84?(b._referencePosWGS84.x=c[0],b._referencePosWGS84.y=c[1],b._referencePosWGS84.z=d):b._referencePosWGS84=new n({x:c[0],y:c[1],z:d,spatialReference:p.WGS84});b._referencePosChanged()}})};h.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};h.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};h.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};h.prototype._cancelReferencePosUpdates=function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=null};h.FIXED_LIGHT_DIRECTION=z;e([l.property({type:Boolean,
dependsOn:["noReferencePositionQueries"],readOnly:!0})],h.prototype,"updating",null);e([l.property()],h.prototype,"noReferencePositionQueries",void 0);e([l.property({constructOnly:!0})],h.prototype,"view",void 0);e([l.property()],h.prototype,"_environmentRenderer",void 0);return h=e([l.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],h)}(l.declared(d,h));f.SceneViewEnvironmentManager=m;var y=new Date,A={hours:0,minutes:0,seconds:0},B=t.vec3d.createFrom(.22,.22,.33),C=t.vec3d.createFrom(.22,
.22,.22);f.default=m})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p){var q=[p.POSTPROCESSING_ATMOSPHERE_OPAQUE,p.POSTPROCESSING_ATMOSPHERE_TRANSPARENT];
return function(g){function f(){var a=null!==g&&g.apply(this,arguments)||this;a.needsRender=!1;a.didRender=!0;a._handles=new d;a._initContext=null;a._atmosphereReadyPromise=null;a._atmosphere=null;a._stars=null;return a}k(f,g);f.prototype.initialize=function(){this.view._stage.addRenderPlugin(q,this)};f.prototype.destroy=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&
(this.view._stage.removeRenderPlugin(this),this.view=null)};f.prototype.initializeRenderContext=function(a){this._initContext=a;this.setup(a)};f.prototype.setup=function(a){var b=this;this._handles.add(h.when(this.view,"basemapTerrain",function(){return b._updateBasemapTerrain()}));this._handles.add([h.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return b._updateAtmosphere()}),h.init(this.view,"environment.starsEnabled",function(){return b._updateStars()})])};
f.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};f.prototype.render=function(a){var b=this.view.basemapTerrain;if(!(b&&b.loaded||"global"!==this.view.viewingMode))return!1;b=!0;this._stars&&(b=this._stars.render(a)&&b);this._atmosphere&&(b=this._atmosphere.render(a)&&b);return b};f.prototype._updateStars=
function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new n(this.view),this._stars.initializeRenderContext(this._initContext),this.needsRender=!0):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this.needsRender=!0)};f.prototype._updateAtmosphere=function(){var c=this,d=this._getAtmosphereType(this._initContext);if(this.atmosphereType!==d){this.atmosphereType=d;var e=null;switch(d){case "realistic":e=a;break;case "panoramic":e=b;break;case "simple":e=
l}if(e){var g=new e(this.view);this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);g.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=g,this.needsRender=!0);this._atmosphereReadyPromise=g.when(function(){c._atmosphere!==g&&(c._atmosphere&&(c._atmosphere.destroy(),c._atmosphere=null),c._atmosphere=g);c._atmosphereReadyPromise=null;c.needsRender=!0;c._updateBasemapTerrain()})}else this._atmosphere&&(this._atmosphere.destroy(),
this._atmosphere=null),this._updateBasemapTerrain()}};f.prototype._getAtmosphereType=function(b){var c=this.view.get("environment.atmosphereEnabled"),d=this.view.get("environment.atmosphere.quality"),e=this.view.viewingMode;return c&&null!=d?"local"===e?"panoramic":"high"===d&&a.isSupported(b)?"realistic":"simple":"none"};f.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};e([c.property()],f.prototype,
"view",void 0);return f=e([c.subclass("esri.views.3d.environment.EnvironmentRenderer")],f)}(c.declared(g))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ./resources/SimpleAtmosphereTexture ../lib/gl-matrix ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){m=function(){function h(b){this.needsRender=!1;this.didRender=!0;this.slot=a.POSTPROCESSING_ATMOSPHERE_OPAQUE;this.view=b}h.prototype.destroy=function(){this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null)};h.prototype.when=function(a){return this._readyPromise.then(a)};h.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._program=q.createProgram(c,n.colorPass,{panoramic:!0});
this._vao=this._createVertexArrayObject(c);this._vaoCount=w.vertexCount(this._vao,"geometry");this._readyPromise=g.requestImage(k).then(function(c){b._texture=new r(a.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},c);b.needsRender=!0})};h.prototype.uninitializeRenderContext=function(a){this.destroy()};h.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==b.MATERIAL||null==this._texture)return!1;var c=a.rctx,d=this._program;c.bindProgram(d);c.bindTexture(this._texture);
d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);e.mat4d.toRotationMat(a.camera.viewMatrix,x);d.setUniformMatrix4fv("view",x);d.setUniform4f("color",1,1,1,1);d.setUniform3fv("lightDirection",a.lightingData.direction);c.setDepthTestEnabled(!0);c.setFaceCullingEnabled(!0);c.setDepthFunction(515);c.setBlendingEnabled(!0);c.setDepthWriteEnabled(!1);c.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao,d);c.drawArrays(4,0,this._vaoCount);c.setDepthWriteEnabled(!0);
c.setBlendingEnabled(!1);c.setDepthFunction(513);c.setFaceCullingEnabled(!1);return!0};h.prototype._createVertexArrayObject=function(a){for(var b=c.createPolySphereGeometry(1,2,!1),e=b.indices[l.VertexAttrConstants.POSITION],g=0;g<e.length;g+=3){var h=e[g];e[g]=e[g+2];e[g+2]=h}for(var b=b.vertexAttributes[l.VertexAttrConstants.POSITION].data,h=v.createBuffer(e.length),f=h.position,g=0;g<e.length;++g){var k=3*e[g];f.set(g,0,b[k]);f.set(g,1,b[k+1]);f.set(g,2,b[k+2])}return new u(a,n.colorPass.attributes,
{geometry:d.glLayout(v)},{geometry:p.createVertex(a,35044,h.buffer)})};return h}();var x=e.mat4d.create(),v=h.newLayout().vec3f("position");return m})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(m,f){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.colorPass={name:"simple-atmosphere-color",shaders:function(d){return{vertexShader:g.glslifyDefineMap({PANORAMIC:d.panoramic})+e.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:g.glslifyDefineMap({PANORAMIC:d.panoramic})+
e.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:k.Default3D};f.fadePass={name:"simple-atmosphere-fade",shaders:{vertexShader:e.resolveIncludes("environment/simpleAtmosphereFade.vert"),fragmentShader:e.resolveIncludes("environment/simpleAtmosphereFade.frag")},attributes:k.Default3D}})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ./atmosphereUtils ../lib/gl-matrix ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){m=function(){function a(a){this.needsRender=!1;this.didRender=!0;this.slot=n.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._hazeSlot=n.POSTPROCESSING_ATMOSPHERE_TRANSPARENT;this._renderData={texDepth:h.vec2d.create(),v3CameraPos:h.vec3d.create(),v3CameraUp:h.vec3d.create(),v3CameraRight:h.vec3d.create(),v3CameraDir:h.vec3d.create(),halfSizeNearPlane:h.vec2d.create(),v2CameraCenterOffset:h.vec2d.create(),v4SphereComp:h.vec4d.create(),v4AtmosParams1:h.vec4d.create(),
v4AtmosParams2:h.vec4d.create(),v4AtmosParams3:h.vec4d.create(),v3InvWavelength:x,v3InvWavelengthScaled:v,v4Radii:h.vec4d.create(),fScale:0,fScaleDepth:z,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:y,fOneOverScaleDepthBlue:B,fScaleOverScaleDepthBlue:0,g:C,g2:C*C,fMiePhaseCoefficients:E,showTest:0,nearFar:h.vec2d.create(),fCameraHeight:0,fCameraHeight2:0,fC:0,fCSur:0,fInnerFadeDistance:0,fAltitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=c.earthRadius;
this.view=a;this._updateRadius(c.earthRadius)}a.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.when=function(a){return e.resolve().then(a)};a.prototype.initializeRenderContext=function(a){var b=this;a=a.rctx;this._handles=new k;this._updateElevation({spatialReference:this.view.basemapTerrain.spatialReference,
tile:this.view.basemapTerrain.rootTiles[0],extent:this.view.basemapTerrain.rootTiles[0].extent});this._handles.add(g.on(this.view,"basemapTerrain","elevation-change",function(a){return b._updateElevation(a)},function(){return b._updateElevation()}));this._handles.add(g.on(this.view,"basemapTerrain","elevation-bounds-change",function(){return b._updateVisibleElevationBounds()},function(){return b._updateVisibleElevationBounds()}));this._hazeProgram=r.createProgram(a,p.program,{haze:!0});this._skyProgram=
r.createProgram(a,p.program);this._vao=this._createVertexArrayObject(a)};a.prototype.uninitializeRenderContext=function(a){this.destroy()};a.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this.slot||a.pass!==l.MATERIAL)return!1;this._update(a.camera);a.slot===this.slot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);this.needsRender=!1;return!0};a.prototype._renderSky=function(a){var b=a.rctx,c=this._skyProgram;b.bindProgram(c);b.setBlendFunctionSeparate(770,771,
1,771);b.setDepthFunction(515);b.setDepthTestEnabled(!0);c.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(c,a)};a.prototype._renderHaze=function(a){var b=this,c=a.rctx,d=a.offscreenRenderingHelper,e=this._hazeProgram;c.bindProgram(e);c.setBlendFunctionSeparate(1,769,0,1);d.renderDepthDetached(function(){c.setDepthTestEnabled(!1);c.bindTexture(d.depthTexture,0);e.setUniform1i("tDepth",0);b._renderCommon(e,a)})};a.prototype._renderCommon=function(a,b){var c=b.rctx;
a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",b.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);a.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);
a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);a.setUniform1f("showTest",this._renderData.showTest);a.setUniform1f("fInnerFadeDistance",this._renderData.fInnerFadeDistance);
a.setUniform1f("fAltitudeFade",this._renderData.fAltitudeFade);c.setBlendingEnabled(!0);c.setDepthWriteEnabled(!1);c.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao,a);c.drawArrays(5,0,4);c.setDepthFunction(513);c.setDepthTestEnabled(!1);c.setDepthWriteEnabled(!0);c.setBlendingEnabled(!1);c.setBlendFunctionSeparate(770,771,1,771)};a.prototype._createVertexArrayObject=function(a){var c=D.createBuffer(4);c.position.setVec(0,[-1,-1,1]);c.position.setVec(1,[1,-1,1]);c.position.setVec(2,
[-1,1,1]);c.position.setVec(3,[1,1,1]);c.uv0.setVec(0,[0,0]);c.uv0.setVec(1,[1,0]);c.uv0.setVec(2,[0,1]);c.uv0.setVec(3,[1,1]);return new w(a,p.program.attributes,{geometry:b.glLayout(D)},{geometry:q.createVertex(a,35044,c.buffer)})};a.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};a.prototype._updateElevation=function(a){a=a?a.tile:this.view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(c.earthRadius+a.elevationBounds[0]),
a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))};a.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(c.earthRadius+this.view.basemapTerrain.getElevationBounds()[0]);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};a.prototype._updateRadius=function(a){this._earthRadius=a;var b=a*a,c=a/10*10.25,e=c*c,g=1/(c-a),l=g/z,f=g/y,k=.3*(c-a)+a,m=1/(c-k),n=this._renderData;
h.vec4d.set4(g,z,l,A,n.v4AtmosParams1);h.vec4d.set4(C,y,f,B,n.v4AtmosParams2);h.vec4d.set4(C*C,E,k,m,n.v4AtmosParams3);h.vec4d.set4(a,b,c,e,n.v4Radii);n.fScale=g;n.fLowerAlphaBlendBound=k;n.fScaleOverScaleDepth=l;n.fScaleOverScaleDepthBlue=f;b=d.INNER_ATMOSPHERE_DEPTH;n.fInnerFadeDistance=2*Math.sqrt((2*a-b)*b)};a.prototype._update=function(a){a&&(h.vec3d.negate(a.viewForward,this._renderData.v3CameraDir),h.vec3d.set(a.viewUp,this._renderData.v3CameraUp),h.vec3d.set(a.viewRight,this._renderData.v3CameraRight),
this._renderData.fCameraHeight=h.vec3d.length(a.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight,this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=h.vec4d.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),h.vec3d.set(a.eye,this._renderData.v3CameraPos),
h.vec2d.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane),h.vec2d.set2((a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset),h.vec2d.set2(a.near,a.far,this._renderData.nearFar),this._renderData.fAltitudeFade=d.computeInnerAltitudeFade(this._renderData.fCameraHeight-this._earthRadius))};a.isSupported=function(a){return a.rctx.capabilities.depthTexture};return a}();
f=.02*Math.PI;var u=.004*Math.PI,x=h.vec3d.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),v=h.vec3d.create(x);h.vec3d.scale(v,f);h.vec3d.add(v,h.vec3d.createFrom(u,u,u));var z=.25,y=.05,A=1/z,B=1/y,C=-.99999,E=(1-C*C)/(2+C*C)*1.5,D=a.newLayout().vec3f("position").vec2f("uv0");return m})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.computeInnerAltitudeFade=function(f){return Math.min(1,
Math.max(0,(f-1E5)/9E5))};f.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.program={name:"realistic-atmosphere-color",shaders:function(d){return{vertexShader:g.glslifyDefineMap({HAZE:d.haze})+e.resolveIncludes("environment/realisticAtmosphere.vert"),
fragmentShader:g.glslifyDefineMap({HAZE:d.haze})+e.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:k.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/watchUtils ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../lib/gl-matrix ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){function y(a,b,c,e,g){var h=d.vec3d.length(a),l=e*Math.sqrt(h*h-e*e)/h,f=g.silCircleV1,k=g.silCircleV2;d.vec3d.scale(a,Math.sqrt(e*e-l*l)/h,g.silCircleCenter);d.vec3d.cross(a,b,f);1>d.vec3d.length2(f)&&d.vec3d.cross(a,c,f);d.vec3d.scale(f,l/d.vec3d.length(f));d.vec3d.cross(f,a,k);d.vec3d.scale(k,l/d.vec3d.length(k));return l}function A(a,b,c,e){d.vec3d.add(e.silCircleCenter,e.silCircleV2,N);d.vec3d.scale(N,D,I);d.mat4d.lookAt(b,N,c,M);r.project(N,
M,a.projectionMatrix,a.viewport);r.project(I,M,a.projectionMatrix,a.viewport);return d.vec3d.dist(N,I)/a.height}var B=-e.INNER_ATMOSPHERE_DEPTH,C=(h.earthRadius+B)/h.earthRadius,E=(h.earthRadius+0)/h.earthRadius,D=(h.earthRadius+3E5)/h.earthRadius,F=b.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);m=function(){function l(a){this.needsRender=!1;this.didRender=!0;this.slot=q.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._renderData={texV:d.vec2d.create(),silCircleCenter:d.vec3d.create(),
silCircleV1:d.vec3d.create(),silCircleV2:d.vec3d.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this.view=a}l.prototype.when=function(a){return this._readyPromise.then(a)};l.prototype.initializeRenderContext=function(a){var b=this,d=a.rctx;this._cameraChangeHandle=k.init(this.view,"state.camera",function(){return b.needsRender=!0},!0);this._program=u.createProgram(d,t.colorPass);this._fadeProgram=u.createProgram(d,t.fadePass);this._vao=this._createRibbon(d);this._vaoCount=
v.vertexCount(this._vao,"geometry");this._fadeVao=n.createQuadVAO(d);this._fadeVaoCount=v.vertexCount(this._fadeVao,"geometry");this._readyPromise=c.requestImage(g).then(function(a){b._texture=new x(d,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);b.needsRender=!0})};l.prototype.uninitializeRenderContext=function(a){this.destroy()};l.prototype.destroy=function(){this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&
(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null)};l.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==p.MATERIAL||null==this._texture)return!1;this._update(a.camera);var b=a.rctx,c=this._program;b.setDepthTestEnabled(!0);b.setDepthFunction(515);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);b.setBlendFunctionSeparate(770,
771,1,771);1>this._renderData.undergroundFadeAlpha&&(b.bindProgram(c),c.setUniformMatrix4fv("proj",a.camera.projectionMatrix),c.setUniformMatrix4fv("view",a.camera.viewMatrix),c.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),c.setUniform3fv("silCircleV1",this._renderData.silCircleV1),c.setUniform3fv("silCircleV2",this._renderData.silCircleV2),c.setUniform2fv("texV",this._renderData.texV),b.bindTexture(this._texture,0),c.setUniform1i("tex",0),c.setUniform3fv("lightDirection",a.lightingData.direction),
c.setUniform1f("altitudeFade",this._renderData.altitudeFade),c.setUniform1f("innerScale",this._renderData.innerScale),b.bindVAO(this._vao),b.drawArrays(4,0,this._vaoCount));0<this._renderData.undergroundFadeAlpha&&(b.bindProgram(this._fadeProgram),this._fadeProgram.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),this._fadeProgram.setUniform3fv("lightDirection",a.lightingData.direction),this._fadeProgram.setUniform3fv("cameraPosition",a.camera.eye),b.bindVAO(this._fadeVao),
b.drawArrays(5,0,this._fadeVaoCount));b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(513);this.needsRender=!1;return!0};l.prototype._update=function(a){var c=d.vec3d.create(),g=h.earthRadius,l=d.vec3d.length(a.eye),f=l-g;this._renderData.undergroundFadeAlpha=0>f?Math.min(-f/5E3,1):0;var k=g+B,m=g+Math.max(50,f);this._renderData.innerScale=m*m/(Math.sqrt(m*m-g*g)*Math.sqrt(m*m-k*k)+g*k)-1;this._renderData.altitudeFade=e.computeInnerAltitudeFade(f);d.vec3d.scale(a.eye,(g+50)/
l,c);y(c,a.center,a.up,g,this._renderData);c=A(a,c,a.up,this._renderData);l=F(f);k=.001953125;m=0+c*l*1;50<f&&(y(a.eye,a.center,a.up,g,this._renderData),a=A(a,a.eye,a.up,this._renderData),a=b.clamp((a-1.5)/(c-1.5),0,1),k=0+.001953125*a,m=0+1*b.lerp(1,c*l,a));d.vec2d.set2(k,m,this._renderData.texV)};l.prototype._createRibbon=function(b){var c=new Float32Array(1155),d=new Uint32Array(1920);c[0]=0;c[1]=0;c[2]=-1;for(var e=0;128>e;e++){var g=9*e+3;c[g+0]=e;c[g+1]=C;c[g+2]=-1;c[g+3]=e;c[g+4]=E;c[g+5]=
0;c[g+6]=e;c[g+7]=D;c[g+8]=1;var g=3*e+1,h=127===e?1:g+3,l=15*e;d[l+0]=g;d[l+1]=g+1;d[l+2]=h+1;d[l+3]=h+1;d[l+4]=h;d[l+5]=g;d[l+6]=g+1;d[l+7]=g+2;d[l+8]=h+2;d[l+9]=h+2;d[l+10]=h+1;d[l+11]=g+1;d[l+12]=g;d[l+13]=h;d[l+14]=0}g=G.createBuffer(d.length);h=g.position;for(e=0;e<d.length;++e)l=3*d[e],h.set(e,0,c[l]),h.set(e,1,c[l+1]),h.set(e,2,c[l+2]);return new z(b,t.colorPass.attributes,{geometry:a.glLayout(G)},{geometry:w.createVertex(b,35044,g.buffer)})};return l}();var M=d.mat4d.create(),N=d.vec3d.create(),
I=d.vec3d.create(),G=l.newLayout().vec3f("position");return m})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../lib/gl-matrix ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){var u=g.getLogger("esri.views.3d.environment.Stars");f=function(){function a(a){this.slot=n.POSTPROCESSING_ATMOSPHERE_OPAQUE;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this.needsRender=!1;this.didRender=!0;this._numStars=0;this._modelMatrix=c.mat4d.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}a.prototype.destroy=function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&
(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._program=r.createProgram(c,p.program);this._dateHandle=h.init(this.view,"environment.lighting.date",function(a){return b._update(a)});this._loadDataPromise.then(function(){b._numStars=b._starData.byteLength/b.bytesPerStar;var a=new Float32Array(b._starData,0,b._numStars*
b.numBinaryFloats),d=new Uint8Array(b._starData,b._numStars*b.numBinaryFloats*4,b._numStars*b.numBinaryUInt8);b._vao=b._createVertexArrayObject(c,a,d);b.needsRender=!0})};a.prototype.uninitializeRenderContext=function(a){this.destroy()};a.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==l.MATERIAL||null==this._starData)return!1;var b=a.rctx,c=this._program;b.bindProgram(c);c.setUniformMatrix4fv("view",a.camera.viewMatrix);c.setUniformMatrix4fv("proj",a.camera.projectionMatrix);c.setUniform4fv("viewport",
a.camera.fullViewport);c.setUniformMatrix4fv("model",this._modelMatrix);c.setUniform1f("pixelRatio",a.pixelRatio);b.setDepthTestEnabled(!0);b.setDepthFunction(515);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(770,771,1,771);b.setDepthWriteEnabled(!1);b.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao,c);b.drawArrays(0,0,this._numStars);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(513);this.needsRender=!1;return!0};a.prototype._computeDayDuration=
function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+b)/(+c-+b)};a.prototype._update=function(a){if(a){var b=a.getHours()/12,d=a.getMinutes()/60*(2/24),e=a.getSeconds()/60*(2/1440),b=(b+d+e-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;c.mat4d.set(z,d);c.mat4d.rotateZ(d,-a*Math.PI);c.mat4d.multiply(v,d,d);c.mat4d.rotateZ(d,-b*Math.PI);this.needsRender=!0}};a.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),
16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};a.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};a.prototype._createVertexArrayObject=function(a,c,d){for(var e=y.createBuffer(this._numStars),g=e.position,h=e.color,l=e.size,f=0;f<this._numStars;f++){var k=c[2*f+0],m=c[2*f+1];g.set(f,0,-Math.cos(k)*Math.sin(m));g.set(f,1,-Math.sin(k)*Math.sin(m));g.set(f,2,-Math.cos(m));
k=this._unpackUint8Attributes(d[f]);m=this._hexToRGB(x[k[1]]);h.set(f,0,255*m[0]);h.set(f,1,255*m[1]);h.set(f,2,255*m[2]);h.set(f,3,255);l.set(f,k[0])}return new w(a,p.program.attributes,{geometry:b.glLayout(y)},{geometry:q.createVertex(a,35044,e.buffer)})};a.prototype._verifyStartData=function(a){if(!a)throw new e("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new e("stars:invalid-data","Failed to create stars because star catalogue data is invalid");
};a.prototype._loadBrightStarCatalogue=function(){var a=this;return A?(this._starData=A,d.resolve()):k(m.toUrl("./resources/stars.wsv"),{responseType:"array-buffer"}).then(function(b){b=b.data;a._verifyStartData(b);A=b;a._starData=b}).catch(function(a){a&&"cancel"!==a.dojoType&&u.error("loadBrightStarCatalogue",a.message);throw a;})};return a}();var x="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),
v=c.mat3d.toMat4(c.mat3d.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),z=c.mat3d.toMat4(c.mat3d.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,0,.39778850739794974,.9174771405229186)),y=a.newLayout().vec3f("position").vec4u8("color").f32("size"),A=null;return f})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(m,f,k,e){Object.defineProperty(f,
"__esModule",{value:!0});f.program={name:"stars",shaders:{vertexShader:e.resolveIncludes("environment/stars.vert"),fragmentShader:e.resolveIncludes("environment/stars.frag")},attributes:k.Default3D}})},"esri/views/3d/support/sunUtils":function(){define(["require","exports","../lib/gl-matrix","../lib/SunCalc","./mathUtils"],function(m,f,k,e,g){function d(a,b,c,d){for(var e=[],g=0;g<c.length;g++)e[g]=(d[g]-c[g])*a/b+c[g];return e}Object.defineProperty(f,"__esModule",{value:!0});f.settings={local:{altitude:1500,
ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};f.computeColorAndIntensity=function(a,c){var h,l,m,r=c.z,t=b;k.vec3d.set3(1,1,1,t.ambient.color);t.ambient.intensity=f.settings.global.ambient;k.vec3d.set3(1,1,1,t.diffuse.color);t.diffuse.intensity=f.settings.global.diffuse;r=(Math.abs(r)-f.settings.local.altitude)/
(f.settings.global.altitude-f.settings.local.altitude);r=g.clamp(r,0,1);t.globalFactor=r;c=e.getTimes(a,c.y,c.x);if(1>r){l=a.valueOf();var w,u;c.polarException===e.POLAR_EXCEPTION.MIDNIGHT_SUN?(w=l-36E5*(a.getHours()+48)-6E4*a.getMinutes(),u=w+432E6):c.polarException===e.POLAR_EXCEPTION.POLAR_NIGHT?(w=l-2,u=l-1):(w=c.sunrise.valueOf(),u=c.sunset.valueOf());var x=u-w;m=w+x/2;var v=x/4;h=m-v;var v=m+v,z=.06*x,x=w-z/2;w+=z/2;var y=u-z/2,A=u+z/2;u=f.settings.local;var B=[.01,u.ambientAtNight],C=[.8,.8,
1],E=[.01,.01,.01],D=[u.diffuseAtTwilight,u.ambientAtTwilight],F=[1,.75,.75],M=[.8,.8,1],N=[.9*u.diffuseAtNoon,u.ambientAtNoon],I=[1,.98,.98],G=[.98,.98,1],O=[u.diffuseAtNoon,u.ambientAtNoon],J=[1,1,1],Q=[1,1,1];u=[0,0];var H=[0,0],z=[0,0];l<x||l>A?(u=B,H=E,z=C):l<w?(z=w-x,u=d(l-x,z,B,D),H=d(l-x,z,E,F),z=d(l-x,z,C,M)):l<h?(z=h-w,u=d(l-w,z,D,N),H=d(l-w,z,F,I),z=d(l-w,z,M,G)):l<m?(z=m-h,u=d(l-h,z,N,O),H=d(l-h,z,I,J),z=d(l-h,z,G,Q)):l<v?(z=v-m,u=d(l-m,z,O,N),H=d(l-m,z,J,I),z=d(l-m,z,Q,G)):l<y?(z=y-v,
u=d(l-v,z,N,D),H=d(l-v,z,I,F),z=d(l-v,z,G,M)):l<A&&(z=A-y,u=d(l-y,z,D,B),H=d(l-y,z,F,E),z=d(l-y,z,M,C));l=u[0];m=H;h=u[1];k.vec3d.lerp(z,t.ambient.color,r,t.ambient.color);t.ambient.intensity=g.lerp(h,t.ambient.intensity,r);k.vec3d.lerp(m,t.diffuse.color,r,t.diffuse.color);t.diffuse.intensity=g.lerp(l,t.diffuse.intensity,r)}r=a.valueOf();c.polarException===e.POLAR_EXCEPTION.MIDNIGHT_SUN?(a=r-36E5*(a.getHours()+48)-6E4*a.getMinutes(),c=a+432E6):c.polarException===e.POLAR_EXCEPTION.POLAR_NIGHT?(a=r-
2,c=r-1):(a=c.sunrise.valueOf(),c=c.sunset.valueOf());a=1-g.clamp(Math.abs(r-(a+(c-a)/2))/432E5,0,1);t.noonFactor=a;return t};f.computeDirection=function(a,b,d,m){m||(m=k.vec3d.create());var l=c,n=k.mat4d.identity(h);if("global"===d)e.getPosition(a,0,0,l),k.vec3d.set3(0,0,-1,m),k.mat4d.rotateX(n,-l.azimuth),k.mat4d.rotateY(n,-l.altitude);else{var p=f.settings.planarDirection;d=p.globalAngles;p=(Math.abs(b.z)-p.localAltitude)/(p.globalAltitude-p.localAltitude);p=g.clamp(p,0,1);1>p?(e.getPosition(a,
b.y,b.x,l),l.azimuth=(1-p)*l.azimuth+p*d.azimuth,l.altitude=(1-p)*l.altitude+p*d.altitude):(l.azimuth=d.azimuth,l.altitude=d.altitude);k.vec3d.set3(0,-1,0,m);k.mat4d.rotateZ(n,-l.azimuth);k.mat4d.rotateX(n,-l.altitude)}k.mat4d.multiplyVec3(n,m);return m};f.computeShadowsEnabled=function(a,b){return"global"===b?!0:Math.abs(a.z)<f.settings.planarDirection.localAltitude};var h=k.mat4d.identity(),c={azimuth:0,altitude:0},b={ambient:{color:k.vec3d.create(),intensity:0},diffuse:{color:k.vec3d.create(),
intensity:0,direction:k.vec3d.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function m(a){return new Date(864E5*(a+.5-2440588))}function f(a,b){return r(l(a)*n(x)-p(b)*l(x),n(a))}function k(a,b){return q(l(b)*n(x)+n(b)*l(x)*l(a))}function e(a,b,c){return r(l(a),n(a)*l(b)-p(c)*n(b))}function g(a,b,c){return q(l(b)*l(c)+n(b)*n(c)*n(a))}function d(a){return w*(1.9148*l(a)+.02*l(2*a)+3E-4*l(3*a))}function h(b,c){b=w*(357.5291+.98560028*b);var e=
d(b);b=b+e+102.9372*w+a;c||(c={dec:0,ra:0});c.dec=k(b,0);c.ra=f(b,0);return c}function c(a,b,c){return 2451545+a+.0053*l(b)-.0069*l(2*c)}function b(a){var b=w*(134.963+13.064993*a),c=w*(93.272+13.22935*a);a=w*(218.316+13.176396*a)+6.289*w*l(b);c=5.128*w*l(c);b=385001-20905*n(b);return{ra:f(a,c),dec:k(a,c),dist:b}}var a=Math.PI,l=Math.sin,n=Math.cos,p=Math.tan,q=Math.asin,r=Math.atan2,t=Math.acos,w=a/180,u={dec:0,ra:0},x=23.4397*w,v={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,
b,c,d){c=w*-c;b*=w;var l=a.valueOf()/864E5-.5+2440588-2451545;a=h(l,u);c=w*(280.16+360.9856235*l)-c-a.ra;d||(d={azimuth:0,altitude:0});d.azimuth=e(c,b,a.dec);d.altitude=g(c,b,a.dec);return d}},z=[[-.83,"sunrise","sunset"]];v.addTime=function(a,b,c){z.push([a,b,c])};v.getTimes=function(b,e,g){function h(b){var d=p,e=x;b=t((l(b)-l(d)*l(e))/(n(d)*n(e)));return c(9E-4+(b+f)/(2*a)+q,r,u)}var f=w*-g,p=w*e,q=Math.round(b.valueOf()/864E5-.5+2440588-2451545-9E-4-f/(2*a));b=9E-4+(0+f)/(2*a)+q;var r=w*(357.5291+
.98560028*b);e=d(r);var u=r+e+102.9372*w+a,x=k(u,0);b=c(b,r,u);e={solarNoon:m(b),nadir:m(b-.5),polarException:v.POLAR_EXCEPTION.NORMAL};var y,A,B,Q;g=0;for(y=z.length;g<y;g+=1)A=z[g],B=h(A[0]*w),Q=b-(B-b),e[A[1]]=m(Q),e[A[2]]=m(B);e.polarException=function(a){a=(l(a)-l(p)*l(x))/(n(p)*n(x));return-1>a?v.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?v.POLAR_EXCEPTION.POLAR_NIGHT:v.POLAR_EXCEPTION.NORMAL}(z[0][0]*w);return e};v.getMoonPosition=function(a,c,d){d=w*-d;c*=w;var h=a.valueOf()/864E5-.5+2440588-2451545;
a=b(h);d=w*(280.16+360.9856235*h)-d-a.ra;h=g(d,c,a.dec);h+=.017*w/p(h+10.26*w/(h+5.1*w));return{azimuth:e(d,c,a.dec),altitude:h,distance:a.dist}};v.getMoonFraction=function(a){var c=a.valueOf()/864E5-.5+2440588-2451545;a=h(c);c=b(c);a=t(l(a.dec)*l(c.dec)+n(a.dec)*n(c.dec)*n(a.ra-c.ra));a=r(149598E3*l(a),c.dist-149598E3*n(a));return(1+n(a))/2};return v})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){m=function(g){function f(){var a=null!==g&&g.apply(this,arguments)||this;a._handles=new d;return a}k(f,g);f.prototype.initialize=function(){var a=this;this.viewEvents=new y.ViewEvents(this.view);this._handles.add([h.whenNot(this.view,"ready",function(){return a._disconnect()}),h.when(this.view,"ready",function(){return a._connect()})])};f.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(f.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});f.prototype._disconnect=
function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};f.prototype._connect=function(){var c=this.view;this._source=new v.BrowserEventSource(this.view.surface,c.input);var d=new z.InputManager(this._source);this._inputManager=d;d.installHandlers("prevent-context-menu",[new A.PreventContextMenu]);this._modeDragPan=new r.PinchAndPanNavigation(c,"primary");this._modeDragRotate=new a.DragRotate(c,
"secondary","center");this._modeDragZoom=new l.DragZoom(c,"tertiary");d.installHandlers("navigation",[new t.PointerDownCancelAnimation(c),new b.DoubleClickZoom(c),new n.GamepadNavigation(c),new p.KeyPan(c,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new q.MouseWheelZoom(c),new u.SingleKeyResetTilt(c,"p"),new w.SingleKeyResetHeading(c,"n"),new a.DragRotate(c,"primary","eye",["b"]),new a.DragRotate(c,"secondary","center",["b"]),new r.PinchAndPanNavigation(c,
"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new x.TwoFingerTilt(c)]);this.viewEvents.connect(d);this._updateMode()};f.prototype._updateMode=function(){var a=this.primaryDragAction,a=B.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};e([c.property()],f.prototype,"view",void 0);e([c.property({value:"pan"})],
f.prototype,"primaryDragAction",null);e([c.property({value:"default"})],f.prototype,"mode",null);e([c.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],f.prototype,"latestPointerType",void 0);e([c.property()],f.prototype,"_inputManager",void 0);return f=e([c.subclass("esri.views.3d.input.SceneInputManager")],f)}(c.declared(g));var B=new Map;f=new Map;g=new Map;f.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});f.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});
g.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});g.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});B.set("default",f);B.set("pro",g);return m})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,
"__esModule",{value:!0});m=function(c){function b(a,b){var d=c.call(this,!0)||this;d.view=a;d.registerIncoming("double-click",b,function(a){return d.handleDoubleClick(a)});return d}k(b,c);b.prototype.handleDoubleClick=function(a){var b=a.data;if(h.eventMatchesPointerAction(b,"primary")){var c=this.view.state.isGlobal?new e.ZoomStepController(this.view,"animation"):new g.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(c);c.zoomStep(Math.log(.5)/Math.log(.6),[b.x,this.view.height-
b.y]);a.stopPropagation()}};return b}(d.InputHandler);f.DoubleClickZoom=m})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function d(b,
d){var e=a.call(this,b.state,b.sceneIntersectionHelper,"interaction"===d?null:void 0)||this;e.view=b;e.mode=d;e.zoomLocation=g.vec3d.create();e.tmpCamera=new c;e.panAxis=g.vec3d.create();e.tmpViewDir=g.vec3d.create();e.targetOnSphere=g.vec3d.create();e.tmpCenter=g.vec3d.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new c,interactionDirection:null,tiltMode:0};e.sphere={center:g.vec3d.create(),radius:0};return e}k(d,a);Object.defineProperty(d.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});d.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);d=!1;0<a&&this.intersectionHelper.pickPointInScreen(b,this.zoomLocation)&&(d=!0);this.tmpCamera.copyFrom(c.camera);d?this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:g.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};d.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:b.outExpo}};d.prototype.updateCamera=function(a,b,c,d){this.sphere.radius=g.vec3d.length(c);
g.vec3d.subtract(a.center,a.eye,this.tmpViewDir);var l=g.vec3d.length(this.tmpViewDir),f=l*b;1>=b&&4>f&&(f=4,b=f/l);1E-6>Math.abs(l-f)||(l=g.vec3d.length(a.center),this.sphere.radius!==l&&g.vec3d.scale(a.center,(this.sphere.radius+b*(l-this.sphere.radius))/l),g.vec3d.scale(this.tmpViewDir,-b),g.vec3d.add(a.center,this.tmpViewDir,a.eye),e.applyAll(this.view,a,this.constraintOptions),1E-12<g.vec3d.dist2(c,a.center)&&h.intersectSphereFromScreenPoint(this.sphere,a,d,this.targetOnSphere)&&(b=h.rotationAndAxisFromPoints(c,
this.targetOnSphere,this.panAxis),h.applyRotation(a,this.sphere.center,this.panAxis,b)),e.applySurfaceCollision(this.view,a))};return d}(d.PointToPointAnimationController);f.ZoomStepController=m})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../lib/gl-matrix ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){Object.defineProperty(f,"__esModule",{value:!0});f.applyTilt=a.apply;f.tiltError=a.error;f.applyAltitude=l.apply;f.altitudeError=l.error;f.applyDistance=n.apply;f.distanceError=n.error;f.applySurfaceCollision=p.apply;f.applyAll=function(a,b,c,g){void 0===c&&(c=r);void 0===g&&(g=b);var h=!1;g!==b&&g.copyFrom(b);g.markViewDirty();g.computeUp(a.state.mode);for(b=0;b<t;b++){for(var l=0,f=0,k=q;f<k.length;f++){var m=k[f];if(e.hasConstraintType(c.selection,m.type)){var n=
Math.abs(m.error(a,g,c));m.apply(a,g,c)&&(h=!0,l+=n)}}if(0===l)break}b=e.hasConstraintType(c.selection,8);a:switch(c.interactionType){case 4:c=1;break a;case 5:c=a.state.isGlobal?2:1;break a;default:c=0}b&&d.apply(a,g,c)&&(h=!0);h&&g.computeUp(a.state.mode);return h};f.pixelDistanceToInteractionFactor=function(a,d){a="number"===typeof a?a:c.vec2d.dist(a,d);return b.inOutCubic(Math.min(1,a/150))};var q=[{type:1,error:function(a,b,c){return h.error(a,b,c)*b.distance},apply:h.apply},{type:2,error:k.error,
apply:k.apply},{type:4,error:g.error,apply:g.apply}],r={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},t=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ./common ../../lib/gl-matrix ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(m,f,k,e,g,d){function h(a,c,e){void 0===e&&(e=k.defaultApplyOptions);var g;g=a.state.constraints.altitude;g=a.state.isGlobal&&g?2===
e.interactionType&&k.hasConstraintType(e.selection,1)?!1:!0:!1;if(!g)return 0;var l=a.state.constraints.altitude;g=b;g.min=l.min;g.max=l.max;var f=e.interactionType;if(0!==f){var l=g.min,m=g.max,n=e.interactionStartCamera;e=e.interactionFactor;var f=2===f||1===f,p=h(a,n),n=0===p?0:a.renderCoordsHelper.getAltitude(n.eye);g.min=l;g.max=m;k.adjustRangeForInteraction(p,n,f,e,.05*n,g)}a=a.renderCoordsHelper.getAltitude(c.eye);a=d.clamp(a,g.min,g.max)-a;return 1E-6>=Math.abs(a)?0:a}function c(a,b,c,d){a.renderCoordsHelper.worldUpAtPosition(b.eye,
d);e.vec3d.scale(d,c);return d}Object.defineProperty(f,"__esModule",{value:!0});f.apply=function(b,f,m,t){void 0===m&&(m=k.defaultApplyOptions);void 0===t&&(t=f);t!==f&&t.copyFrom(f);var p=h(b,f,m);if(0===p)return!1;var q=b.renderCoordsHelper,r=q.getAltitude(f.eye)+p;b=k.interactionDirectionTowardsConstraintMinimization(b,f,m.interactionDirection,c(b,f,d.sign(p),l),a);m=e.vec3d.set(f.viewForward,n);q.intersectManifold(f.eye,b,r,t.eye)||q.setAltitude(r,t.eye);g.closestPointOnRay(f.eye,m,f.center,f.center);
t.markViewDirty();return!0};f.error=h;var b={min:0,max:0},a=e.vec3d.create(),l=e.vec3d.create(),n=e.vec3d.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../lib/gl-matrix","../../support/mathUtils"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.hasConstraintType=function(e,d){return 0!==(e&d)};f.adjustRangeForInteraction=function(e,d,h,c,b,a){0!==e&&(h?(a.min=Math.min(a.min,d),a.max=Math.max(a.max,d)):null!=c?(a.min-=Math.max(0,
(d-a.min)*(1-c)),a.max+=Math.max(0,(d-a.max)*(1-c))):b&&(a.min-=Math.max(0,d-a.min-b),a.max+=Math.max(0,d-a.max-b)))};f.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};f.interactionDirectionTowardsConstraintMinimization=function(g,d,h,c,b){h||(h=d.viewForward);k.vec3d.set(h,b);k.vec3d.scale(b,e.sign(k.vec3d.dot(h,c)));return b}})},"esri/views/3d/camera/constraintUtils/distance":function(){define(["require","exports",
"./common","../../lib/gl-matrix","../../webgl-engine/lib/Util"],function(m,f,k,e,g){function d(a,b,c){void 0===c&&(c=k.defaultApplyOptions);if(!a.state.isLocal)return 0;var g=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===g)return 0;h.min=0;h.max=g;var g=h,l=c.interactionType;if(0!==l){var f=g.min,m=g.max,n=c.interactionStartCamera;c=c.interactionFactor;var l=1===l||4===l,p=d(a,n),n=0===p?0:e.vec3d.dist(n.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);
g.min=f;g.max=m;k.adjustRangeForInteraction(p,n,l,c,.05*n,g)}a=e.vec3d.dist(b.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);a=h.max-a;return-1E-6<=a?0:a}Object.defineProperty(f,"__esModule",{value:!0});f.error=d;f.apply=function(h,f,m,r){void 0===m&&(m=k.defaultApplyOptions);void 0===r&&(r=f);r!==f&&r.copyFrom(f);var n=d(h,f,m);if(0===n)return!1;var p=h.pointsOfInterest.surfaceOrigin,n=e.vec3d.dist(f.eye,h.pointsOfInterest.surfaceOrigin.renderLocation)+n,q=e.vec3d.set(f.eye,c);m=k.interactionDirectionTowardsConstraintMinimization(h,
f,m.interactionDirection,e.vec3d.direction(h.pointsOfInterest.surfaceOrigin.renderLocation,f.eye,l),a);return g.raySphere(f.eye,m,p.renderLocation,n,r.eye)?(f=e.vec3d.subtract(r.eye,q,b),e.vec3d.add(r.center,f),r.markViewDirty(),f=h.renderCoordsHelper.getAltitude(r.center),h.renderCoordsHelper.intersectManifold(r.eye,r.viewForward,f,r.center),r.markViewDirty(),!0):!1};var h={min:0,max:0},c=e.vec3d.create(),b=e.vec3d.create(),a=e.vec3d.create(),l=e.vec3d.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../intersectionUtils","../../lib/gl-matrix"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.apply=function(d,h,c,b){void 0===c&&(c=0);void 0===b&&(b=h);var a=d.state.constraints;h!==b&&b.copyFrom(h);if(!a.collision.enabled)return!1;var l=k.surfaceElevationBelowEye(d,h);h=d.renderCoordsHelper.getAltitude(h.eye);a=l+a.collision.elevationMargin;if(h>=a)return!1;l=e.vec3d.length(b.eye);e.vec3d.subtract(b.center,b.eye,g);d.renderCoordsHelper.setAltitude(a,b.eye);1===c?
e.vec3d.add(b.eye,g,b.center):2===c&&e.vec3d.scale(b.center,(l-h+a)/l);b.markViewDirty();return!0};var g=e.vec3d.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(m,f,k,e,g,d,h){function c(a,b){return a.renderCoordsHelper.fromRenderCoords(b,q,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(q)||
0:0}function b(a,b,d){if(!a.state.isGlobal)return!1;var e=c(a,b);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(b,d,a.dataExtent,e,t).far;a*=a;return g.vec3d.dist2(b,d)>a}function a(a,c,e,f){void 0===f&&(f=g.vec3d.create());var k=l[a.viewingMode];k||(k=new h(a.viewingMode),k.enableBackfacesTerrain=!a.state.isGlobal,k.enableInvisibleTerrain=!0,l[a.viewingMode]=k);var m=a.state.isGlobal;if(a.sceneIntersectionHelper.pickPointFromSegment(c,e,f,k)&&!b(a,c,f))return f;k=g.vec3d.direction(e,
c,r);if(!a.renderCoordsHelper.intersectManifold(c,k,0,f)||b(a,c,f))m?(a=f,m=g.vec3d.dot(c,c)-d.earthRadius*d.earthRadius,m=0<m?Math.sqrt(m)/3:1,g.vec3d.subtract(e,c,a),g.vec3d.scale(a,m/g.vec3d.length(a),a),g.vec3d.add(a,c)):e!==f&&g.vec3d.set(e,f);return f}Object.defineProperty(f,"__esModule",{value:!0});f.eyeWithinExtent=function(a,b,c,d){return a.renderCoordsHelper.fromRenderCoords(b.eye,n,d)&&e.containsPoint(c,n)};f.surfaceElevationBelowEye=function(a,b){return c(a,b.eye)};f.surfaceElevationBelowRenderPoint=
c;f.cameraOnContentAlongViewDirection=function(b,c,d,e){var h=b.state.camera.copy();c&&(h.eye=c);d&&(h.center=d);e&&(h.up=e);a(b,h.eye,h.center,p);d=b.state.constraints;e=d.minimumPoiDistance;g.vec3d.dist2(h.eye,p)<e&&(c=d.collision.enabled,g.vec3d.set(h.viewForward,r),g.vec3d.scale(r,e),c?g.vec3d.subtract(p,r,h.eye):g.vec3d.add(h.eye,r,p),b=b.renderCoordsHelper,e=b.getAltitude(h.eye),d=d.collision.elevationMargin,c&&e<d&&(g.vec3d.subtract(p,h.eye,r),b.setAltitude(d,h.eye),g.vec3d.add(h.eye,r,p)));
h.center=p;return h};f.contentAlongViewDirection=a;var l={},n=g.vec3d.create(),p=g.vec3d.create(),q=new k,r=g.vec3d.create(),t={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports ../../../../core/has ../../lib/gl-matrix ./Object3D ./PerformanceTimer".split(" "),function(m,f,k,e,g,d){var h=e.vec3d.create(),c=e.vec3d.create(),b=e.vec3d.create();m=function(){function d(b){this.minResult=new a;this.maxResult=new a;this._normalDir=null;this._transform=e.mat4d.create();
this._transformInverse=new l({value:this._transform},e.mat4d.inverse,e.mat4d.create);this._transformInverseTranspose=new l(this._transformInverse,e.mat4d.transpose,e.mat4d.create);this._transformTranspose=new l({value:this._transform},e.mat4d.transpose,e.mat4d.create);this._transformInverseRotation=new l({value:this._transform},e.mat4d.toInverseMat3,e.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,
numObjectsTested:0};this.viewingMode=b||"global"}d.prototype.init=function(a,c,d,g,h,l,f,k){var m=this;c&&d&&e.vec3d.subtract(d,c,b);this.minResult.init(c,d);this.maxResult.init(c,d);this._numObjectsTested=0;this.point=g;this.camera=h;this.isSelection=f;this.p0=c;this.p1=d;this.hudResults=[];null==l&&(l=1E-5);this.tolerance=l;if(a)for(c=function(a){m.intersectObject(a,k)},d=0;d<a.length;d++)if(g=a[d],h=g.getSpatialQueryAccelerator?g.getSpatialQueryAccelerator():void 0)h.forEachAlongRay(this.p0,b,
c),f&&h.forEachDegenerateObject(c);else for(h=0,g=g.getObjects();h<g.length;h++)c(g[h])};Object.defineProperty(d.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});d.prototype.getDirection=function(){this._normalDir||(this._normalDir=e.vec3d.create(),e.vec3d.normalize(b,this._normalDir));return this._normalDir};d.prototype.intersectObject=function(b,d){var g=this;this._numObjectsTested++;for(var l=b.id,f=b.getGeometryRecords(),k=b.objectTransformation,m,n=0;n<f.length;n++){var p=f[n],q=
p.geometry,r=p.materials,C=p.instanceParameters;C.hidden||(m=q.id,e.mat4d.set(k,this._transform),e.mat4d.multiply(this._transform,p.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),e.mat4d.multiplyVec3(this.transformInverse,this.p0,h),e.mat4d.multiplyVec3(this.transformInverse,this.p1,c),r[0].intersect(q,C,this._transform,this,h,c,function(c,e,h,f,k,n){0<=c&&
(null==d||d(g.p0,g.p1,c))&&(k?(k=new a,k.init(g.p0,g.p1),k.set(b,l,c,e,f,n,m,h),g.hudResults.push(k)):((null==g.minResult.priority||f>=g.minResult.priority)&&(null==g.minResult.dist||c<g.minResult.dist)&&g.minResult.set(b,l,c,e,f,null,m,h),(null==g.maxResult.priority||f>=g.maxResult.priority)&&(null==g.maxResult.dist||c>g.maxResult.dist)&&g.maxResult.set(b,l,c,e,f,null,m,h)))},p.customTransformation),this.minResult.geometryId===m&&e.mat4d.set(this._transform,this.minResult.transformation),this.maxResult.geometryId===
m&&e.mat4d.set(this._transform,this.maxResult.transformation))}};d.DEFAULT_TOLERANCE=1E-5;return d}();var a=function(){function a(a,b){this.transformation=e.mat4d.identity();this.normal=e.vec3d.create();this.init(a,b)}a.prototype.getIntersectionPoint=function(a){if(null==this.dist)return!1;e.vec3d.lerp(this.p0,this.p1,this.dist,a);return!0};a.prototype.getTransformedNormal=function(a){e.vec3d.set(this.normal,n);n[3]=0;e.mat4d.multiplyVec4(this.transformation,n);e.vec3d.set(n,a);e.vec3d.normalize(a);
return a};a.prototype.set=function(a,b,c,d,h,l,f,k){a instanceof g&&(a={type:"stage",obj:a});this.dist=c;e.vec3d.set(d,this.normal);this.target=a;this.name=b;this.priority=h;this.center=l?e.vec3d.create(l):null;this.geometryId=f;this.triangleNr=k};a.prototype.copyFrom=function(a){this.p0=a.p0;this.p1=a.p1;this.dist=a.dist;this.target=a.target;this.name=a.name;this.priority=a.priority;this.center=a.center?e.vec3d.create(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=
a.intersector;e.vec3d.set(a.normal,this.normal)};a.prototype.setIntersector=function(a){this.intersector=a};a.prototype.init=function(a,b){this.priority=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";this.p0=a;this.p1=b};return a}(),l=function(){function a(a,b,c){this.original=a;this.update=b;this.dirty=!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&
(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}(),n=e.vec4d.create();return m})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ./common ../../lib/gl-matrix ../../state/utils/navigationUtils ../../state/utils/viewUtils ../../support/earthUtils ../../support/mathUtils".split(" "),function(m,f,k,e,g,d,h,c){function b(c,d,g,h,l){void 0===g&&(g=k.defaultApplyOptions);void 0===h&&(h=d);void 0===
l&&(l=!0);d!==h&&h.copyFrom(d);x.eyeCenterDistance=0;x.requiresTwoSteps=!1;var f=a(c,d,g,void 0,x);if(0===f)return!1;e.mat4d.identity(q);e.mat4d.rotate(q,-f,d.viewRight);switch(g.tiltMode){case 1:e.mat4d.multiplyVec3(q,d.viewForward,p);e.vec3d.scale(p,x.eyeCenterDistance);e.vec3d.add(d.eye,p,h.center);break;case 0:e.vec3d.subtract(d.center,d.eye,p),e.mat4d.multiplyVec3(q,p),e.vec3d.subtract(d.center,p,h.eye)}e.mat4d.multiplyVec3(q,h.up);h.markViewDirty();return x.requiresTwoSteps&&l?b(c,h,g,h,!1):
!0}function a(b,f,m,p,q){void 0===m&&(m=k.defaultApplyOptions);void 0===p&&(p=k.defaultApplyOptions);if(!b.state.constraints.tilt)return 0;var v=b.state.constraints.tilt(f.distance,w);var x=m;if(0!==x.interactionType){var z=x.interactionStartCamera,y=x.interactionFactor,A=v.min,B=v.max,I=a(b,z,k.defaultApplyOptions,x),G=0===I?0:d.viewAngle(b.renderCoordsHelper,z.center,z.eye);v.min=A;v.max=B;2===x.interactionType?(k.hasConstraintType(x.selection,2)&&n(b,z,v),k.adjustRangeForInteraction(I,G,!0,y,t,
v)):k.adjustRangeForInteraction(I,G,!1,y,t,v)}2===p.interactionType&&k.hasConstraintType(p.selection,2)&&n(b,p.interactionStartCamera,v);if(1===m.tiltMode||1===p.tiltMode){a:{q&&(q.requiresTwoSteps=!1);switch(b.viewingMode){case "global":m=u;x=b.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;p=x+h.earthRadius;x=b.renderCoordsHelper.intersectManifold(f.eye,f.viewForward,x,r);m.eyeCenterDistance=f.distance;x?(m.eyeCenterDistance=e.vec3d.dist(f.eye,r),m.tiltAtCenter=d.viewAngle(b.renderCoordsHelper,
r,f.eye)):b.state.isLocal?m.tiltAtCenter=d.viewAngle(b.renderCoordsHelper,f.center,f.eye):(g.closestPointOnCenteredSphereSilhouette(p,f.eye,f.viewForward,r),m.eyeCenterDistance=e.vec3d.dist(f.eye,r),m.tiltAtCenter=c.acos(-e.vec3d.dot(f.viewForward,e.vec3d.normalize(r))));m.radius=p;m.eyeRadius=e.vec3d.length(f.eye);m.constraints=b.state.constraints;m.centerIsOnSurface=x;f=c.clamp(m.tiltAtCenter,v.min,v.max);if(1E-9<Math.abs(m.tiltAtCenter-f)){if(m.centerIsOnSurface){f=m.constraints;b=p=m.tiltAtCenter;
v=f.clampTilt(m.eyeCenterDistance,p);x=l(m,v);if(f.clampTilt(x,p)!==v)for(p=0;10>p&&1E-9<Math.abs(v-b);)x=(b+v)/2,z=l(m,x),z=f.clampTilt(z,x),1E-9<Math.abs(z-x)?b=x:v=x,p++;f=v;v=f;b=c.asin(m.radius/m.eyeRadius*Math.sin(m.tiltAtCenter));v=c.asin(m.radius/m.eyeRadius*Math.sin(v));b=m.eyeRadius>m.radius?b-v:v-b}else f=m.constraints.clampTilt(m.eyeCenterDistance,m.tiltAtCenter),q&&f<Math.PI/2&&(q.requiresTwoSteps=!0,f=Math.PI/2-1E-5),b=m.tiltAtCenter-Math.PI/2-(f-Math.PI/2);q&&(q.eyeCenterDistance=l(m,
f));q=b}else q=0;break a;case "local":p=d.viewAngle(b.renderCoordsHelper,f.center,f.eye);m=c.clamp(p,v.min,v.max);v=p-m;1E-9<Math.abs(v)?(q&&(p=b.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,b=b.renderCoordsHelper.getAltitude(f.eye)-p,m=Math.cos(m),q.eyeCenterDistance=1E-4<Math.abs(m)?b/m:f.distance),q=v):q=0;break a}q=void 0}return q}q=d.viewAngle(b.renderCoordsHelper,f.center,f.eye);f=c.clamp(q,v.min,v.max);q-=f;q=1E-9<Math.abs(q)?q:0;return q}function l(a,b){if(!a.centerIsOnSurface)return a.eyeCenterDistance;
b=Math.PI-c.clamp(b,0,Math.PI);var d=c.asin(a.radius/a.eyeRadius*Math.sin(b)),e=Math.sin(Math.PI-b-d)/Math.sin(b);return a.eyeRadius<a.radius&&1<e?Math.sin(Math.PI-b-(Math.PI-d))/Math.sin(b)*a.eyeRadius:e*a.eyeRadius}function n(a,b,d){if(!a.state.isLocal){var g=a.state.constraints;if(g.altitude){a=e.vec3d.length2(b.center);var l=Math.sqrt(a);b=b.distance;var f=g.altitude.min+h.earthRadius,g=g.altitude.max+h.earthRadius,f=(f*f-b*b-a)/(-2*l*b);d.min=Math.max(d.min,Math.min(Math.PI-c.acos((g*g-b*b-a)/
(-2*l*b)),d.max));d.max=Math.min(d.max,Math.PI-c.acos(f))}}}Object.defineProperty(f,"__esModule",{value:!0});f.apply=b;f.error=a;var p=e.vec3d.create(),q=e.mat4d.create(),r=e.vec3d.create(),t=c.deg2rad(5),w={min:0,max:0},u={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},x={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../lib/gl-matrix ./primitiveIntersectionUtils ../../support/earthUtils ../../support/mathUtils".split(" "),
function(m,f,k,e,g,d){function h(b,d,g,h,l){void 0===l&&(l=!1);var f=F;e.createRay(d,g,f,l);return e.intersectSphere(b,f,h)?k.vec3d.dist2(b.center,f.origin)<b.radius*b.radius&&(d=c(b,f.origin),f=-a(f.origin,h,B)-d,0<f)?(d=y,k.mat4d.identity(d),k.mat4d.rotate(d,-f,B),k.vec3d.subtract(h,b.center),k.mat4d.multiplyVec3(d,h,h),k.vec3d.add(h,b.center),!1):!0:(n(b,f,h),!1)}function c(a,b){var c=B;k.vec3d.subtract(b,a.center,c);b=Math.abs(k.vec3d.length(c)-a.radius);return Math.acos(a.radius/(b+a.radius))}
function b(a,b,c,d){var g=F;e.createRay(b,c,g,!0);return e.intersectSphere(a,g,d)}function a(a,b,c){k.vec3d.cross(a,b,c);a=k.vec3d.dot(a,b)/(k.vec3d.length(a)*k.vec3d.length(b));return-d.acos(a)}function l(a,b,c,d){var e=y;k.mat4d.identity(e);k.mat4d.rotate(e,d,c);k.vec3d.subtract(a.eye,b);k.mat4d.multiplyVec3(e,a.eye,a.eye);k.vec3d.add(a.eye,b);k.vec3d.subtract(a.center,b);k.mat4d.multiplyVec3(e,a.center,a.center);k.vec3d.add(a.center,b);k.mat4d.multiplyVec3(e,a.up,a.up);a.markViewDirty()}function n(a,
b,c){var e=B,g=C,h=z;k.vec3d.subtract(b.origin,a.center,g);k.vec3d.cross(g,b.direction,e);k.vec3d.cross(e,g,c);k.vec3d.scale(c,1/k.vec3d.length(c)*a.radius);a=-d.asin(a.radius/k.vec3d.length(b.origin));k.mat4d.identity(h);k.mat4d.rotate(h,a,e);k.mat4d.multiplyVec3(h,c)}function p(a,b,c,d){M.radius=a;k.vec3d.set3(0,0,0,M.center);k.vec3d.set(b,F.origin);k.vec3d.set(c,F.direction);return n(M,F,d)}function q(a,b){k.vec3d.set3(0,0,0,b);for(var c=0;c<a.length;c++)k.vec3d.add(b,a[c]);k.vec3d.scale(b,1/a.length)}
function r(a,b,c){return Math.sin(a/k.vec3d.length(b))*(c+g.earthRadius)}Object.defineProperty(f,"__esModule",{value:!0});f.Earth={center:k.vec3d.create(),radius:g.earthRadius};f.normalizeCoordinate=function(a,b,c){c[0]=b[0]/a.fullWidth;c[1]=b[1]/a.fullHeight;return c};f.sphereOrSilhouettePointFromScreenPoint=h;f.computeHorizonSphereCapAngle=c;f.intersectSphereFromScreenPoint=b;f.rotationAndAxisFromPoints=a;f.rotationFromPointsAroundAxis=function(a,b,c){var d=B,e=C,g=E;k.vec3d.set(a,e);k.vec3d.set(b,
g);a=k.vec3d.dot(e,c);b=k.vec3d.dot(g,c);k.vec3d.scale(c,a,d);k.vec3d.subtract(e,d);k.vec3d.normalize(e);k.vec3d.scale(c,b,d);k.vec3d.subtract(g,d);k.vec3d.normalize(g);a=k.vec3d.dot(e,g);k.vec3d.cross(c,e,d);c=k.vec3d.dot(g,d);return Math.atan2(c,a)};f.setPlane=function(a,b,c){k.vec3d.set(b,c.normal);c.d=-k.vec3d.dot(b,a)};f.setPlaneD=function(a,b){b.d=-k.vec3d.dot(b.normal,a)};f.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};f.applyRotation=
l;f.closestPointOnSphereSilhouette=n;f.closestPointOnCenteredSphereSilhouette=p;f.intersectPlaneFromScreenPoint=function(a,b,c,d){var g=F;e.createRay(b,c,g);return e.intersectPlane(a,g,d)};f.centerOnManifoldSilhouetteFallback=function(a,b,c,d,e){a.intersectManifold(b,c,d,e)||"global"!==a.type||(p(d+g.earthRadius,b,c,D),k.vec3d.add(b,k.vec3d.scale(c,k.vec3d.dist(b,D),D),e))};f.applyZoomToPoint=function(a,b,c,d){var e=A;c=1-c;k.vec3d.subtract(b,a.eye,e);var g=k.vec3d.length(e),h=g*(1-c);0<=c&&h<d&&
(h=d,c=-(h-g)/g);1E-6>Math.abs(g-h)||(k.vec3d.scale(e,c),k.vec3d.add(a.eye,e),k.vec3d.lerp(a.center,b,c))};f.applyZoomOnSphere=function(a,c,d){k.vec2d.set2(c.padding[3]+c.width/2,c.padding[2]+c.height/2,t);b(a,c,t,c.center);k.vec3d.subtract(c.center,c.eye,A);a=k.vec3d.length(A);1E-6>Math.abs(a-a*d)||(k.vec3d.scale(A,d),k.vec3d.subtract(c.center,A,c.eye),c.markViewDirty())};var t=k.vec2d.create();f.navPointToScreenPoint=function(a,b,c){k.vec2d.set2(b.x,a.fullHeight-b.y,c)};f.centroidOnSphere=function(a,
b,c){q(b,c);k.vec3d.normalize(c);k.vec3d.scale(c,a)};f.centroid=q;f.onSurfaceTiltToEyeTiltGlobal=r;f.offSurfaceTiltToEyeTiltGlobal=function(a,b,c){return r(Math.PI/2,b,c)+(a-Math.PI/2)};var w;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(w=f.PanMode||(f.PanMode={}));f.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};f.pickPointAndInitSphere=function(a,c,d,e){var g=k.vec3d.create(),l={center:k.vec3d.create(),radius:0},m=!0;a.pickPointInScreen(d,g)?l.radius=k.vec3d.length(g):
(l.radius=c.aboveGround?Math.max(k.vec3d.length(c.center),.9*f.Earth.radius):k.vec3d.length(c.eye)-c.relativeElevation,e?h(l,c,d,g):m=b(l,c,d,g));return{sphere:l,scenePickPoint:m?g:null}};f.decidePanMode=function(a,b,c){var d=k.vec3d.length(a.eye);if(Math.abs(d-f.Earth.radius)>f.VerticalPanTresholds.Elevation)return w.Horizontal;if(a.aboveGround===b.radius>d)return w.Vertical;k.vec3d.normalize(k.vec3d.subtract(a.eye,c,u));return Math.abs(.5*Math.PI-Math.acos(k.vec3d.dot(c,u)/k.vec3d.length(c)))<f.VerticalPanTresholds.Angle?
w.Vertical:w.Horizontal};var u=k.vec3d.create();f.applyPanPlanar=function(a,b,c){k.vec3d.subtract(c,b,x);k.vec3d.subtract(a.eye,x);k.vec3d.subtract(a.center,x);a.markViewDirty()};var x=k.vec3d.create();f.applyPanSpherical=function(b,c,d,e){d=a(d,e,v);l(c,b.center,v,d)};var v=k.vec3d.create(),z=k.mat4d.create(),y=k.mat4d.create(),A=k.vec3d.create(),B=k.vec3d.create(),C=k.vec3d.create(),E=k.vec3d.create(),D=k.vec3d.create(),F={origin:k.vec3d.create(),direction:k.vec3d.create()},M={center:k.vec3d.create(),
radius:0}})},"esri/views/3d/state/utils/primitiveIntersectionUtils":function(){define(["require","exports","../../lib/gl-matrix"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.createRay=function(d,g,c,b){void 0===b&&(b=!1);k.vec3d.set3(g[0],g[1],0,e);b?k.vec3d.set(d.eye,c.origin):k.vec3d.unproject(e,d.viewMatrix,d.projectionMatrix,d.fullViewport,c.origin);e[2]=1;k.vec3d.unproject(e,d.viewMatrix,d.projectionMatrix,d.fullViewport,c.direction);k.vec3d.subtract(c.direction,c.origin,
c.direction);k.vec3d.normalize(c.direction)};f.intersectSphere=function(d,e,c){var b=k.vec3d.subtract(e.origin,d.center,g),a=k.vec3d.dot(e.direction,e.direction),h=2*k.vec3d.dot(e.direction,b);d=k.vec3d.dot(b,b)-d.radius*d.radius;d=h*h-4*a*d;if(0>d)return!1;b=Math.sqrt(d);d=(-h-b)/(2*a);a=(-h+b)/(2*a);if(0>d||a<d&&0<a)d=a;return 0<d?(k.vec3d.add(e.origin,k.vec3d.scale(e.direction,d,c),c),!0):!1};f.intersectPlane=function(d,e,c){var b=k.vec3d.dot(d.normal,e.direction);if(0===b)return!1;d=-(k.vec3d.dot(d.normal,
e.origin)+d.d)/b;if(0>d)return!1;k.vec3d.add(e.origin,k.vec3d.scale(e.direction,d,c),c);return!0};var e=k.vec3d.create(),g=k.vec3d.create()})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../lib/gl-matrix","../../support/mathUtils"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.viewAngle=function(h,c,b){h.worldUpAtPosition(c,g);k.vec3d.subtract(b,c,d);h=k.vec3d.length(d);return 0===h?0:e.acos(k.vec3d.dot(d,g)/h)};var g=k.vec3d.create(),d=
k.vec3d.create()})},"esri/views/animation/easing":function(){define(["require","exports"],function(m,f){function k(d){return d}function e(d){var e=2*(d-Math.sqrt((d-1)*d)),c=e/2/d;return function(b){return b<c?d*b*b:e*b-e+1}}function g(d,e){return function(c){return c<e?e*d(c/e):1-d((1-c)/(1-e))*(1-e)}}Object.defineProperty(f,"__esModule",{value:!0});f.linear=k;f.inQuad=function(d){return d*d};f.outQuad=function(d){return 1-f.inQuad(1-d)};f.inOutQuad=function(d){return.5>d?f.inQuad(2*d)/2:(f.outQuad(2*
(d-.5))+1)/2};f.inCubic=function(d){return d*d*d};f.outCubic=function(d){return 1-f.inCubic(1-d)};f.inOutCubic=function(d){return.5>d?f.inCubic(2*d)/2:(f.outCubic(2*(d-.5))+1)/2};f.inQuart=function(d){return d*d*d*d};f.outQuart=function(d){return 1-f.inQuart(1-d)};f.inOutQuart=function(d){return.5>d?f.inQuart(2*d)/2:(f.outQuart(2*(d-.5))+1)/2};f.inQuint=function(d){return d*d*d*d*d};f.outQuint=function(d){return 1-f.inQuint(1-d)};f.inOutQuint=function(d){return.5>d?f.inQuint(2*d)/2:(f.outQuint(2*
(d-.5))+1)/2};f.inSine=function(d){return-Math.cos(d*Math.PI/2)+1};f.outSine=function(d){return 1-f.inSine(1-d)};f.inOutSine=function(d){return.5>d?f.inSine(2*d)/2:(f.outSine(2*(d-.5))+1)/2};f.inExpo=function(d){return Math.pow(2,10*(d-1))};f.outExpo=function(d){return 1-f.inExpo(1-d)};f.inOutExpo=function(d){return.5>d?f.inExpo(2*d)/2:(f.outExpo(2*(d-.5))+1)/2};f.inCirc=function(d){return-(Math.sqrt(1-d*d)-1)};f.outCirc=function(d){return 1-f.inCirc(1-d)};f.inOutCirc=function(d){return.5>d?f.inCirc(2*
d)/2:(f.outCirc(2*(d-.5))+1)/2};f.inCoastQuad=g(e(1),1);f.outCoastQuad=g(e(1),0);f.inOutCoastQuad=g(e(1),.5);f.inCoastCubic=g(e(2),1);f.outCoastCubic=g(e(2),0);f.inOutCoastCubic=g(e(2),.5);f.inCoastQuart=g(e(3),1);f.outCoastQuart=g(e(3),0);f.inOutCoastQuart=g(e(3),.5);f.inCoastQuint=g(e(4),1);f.outCoastQuint=g(e(4),0);f.inOutCoastQuint=g(e(4),.5);f.named={linear:k,"in-quad":f.inQuad,"out-quad":f.outQuad,"in-out-quad":f.inOutQuad,"in-coast-quad":f.inCoastQuad,"out-coast-quad":f.outCoastQuad,"in-out-coast-quad":f.inOutCoastQuad,
"in-cubic":f.inCubic,"out-cubic":f.outCubic,"in-out-cubic":f.inOutCubic,"in-coast-cubic":f.inCoastCubic,"out-coast-cubic":f.outCoastCubic,"in-out-coast-cubic":f.inOutCoastCubic,"in-quart":f.inQuart,"out-quart":f.outQuart,"in-out-quart":f.inOutQuart,"in-coast-quart":f.inCoastQuart,"out-coast-quart":f.outCoastQuart,"in-out-coast-quart":f.inOutCoastQuart,"in-quint":f.inQuint,"out-quint":f.outQuint,"in-out-quint":f.inOutQuint,"in-coast-quint":f.inCoastQuint,"out-coast-quint":f.outCoastQuint,"in-out-coast-quint":f.inOutCoastQuint,
"in-sine":f.inSine,"out-sine":f.outSine,"in-out-sine":f.inOutSine,"in-expo":f.inExpo,"out-expo":f.outExpo,"in-out-expo":f.inOutExpo,"in-circ":f.inCirc,"out-circ":f.outCirc,"in-out-circ":f.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../animation/pointToPoint/Animation ../../lib/gl-matrix ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,
"__esModule",{value:!0});m=function(a){function d(b,c,d){d=a.call(this,d)||this;d.viewState=b;d.intersectionHelper=c;d.hasTarget=!1;d.animation=new e.default(d.viewState.mode);return d}k(d,a);d.prototype.begin=function(a,d){this.hasTarget=!0;d=this.animationSettings(d);c.copyFrom(this.viewState.camera);this.intersectionHelper.pickPointFromSegment(c.eye,c.center,b)&&(c.center=b);this.animation.update(c,a,d);this.animation.finished&&this.finish()};d.prototype.finish=function(){this.animation.currentTime=
this.animation.time;a.prototype.finish.call(this)};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});d.prototype.stepController=function(b,c){a.prototype.stepController.call(this,b,c);this.hasTarget&&this.animation.step(b,c)};d.prototype.onControllerEnd=function(b){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,b),this.animation.currentTime=this.animation.time);
a.prototype.onControllerEnd.call(this,b)};d.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return d}(d.AnimationController);f.PointToPointAnimationController=m;var c=new h,b=g.vec3d.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Camera ../../lib/gl-matrix ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});var c=g.vec3d.create();m=function(){function b(a){this.currentTime=0;this.animation=new h.Animation(function(){return new e.default(a)});this._current=new e.default(a)}Object.defineProperty(b.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});b.prototype.update=
function(a,b,d){var e=this.animation.definition.source,h=this.animation.definition.target,l=g.vec3d.subtract(b.center,a.center,c),f=g.vec3d.length(l);1E-5<=f?(l[0]/=f,l[1]/=f,l[2]/=f):(l[0]=0,l[1]=1,l[0]=0);g.vec3d.set(l,e.lookAtDirection);g.vec3d.set(l,h.lookAtDirection);e.copyFromRenderCamera(a);h.copyFromRenderCamera(b);this._current.copyFrom(e);this.animation.update(e,h,d);this.currentTime=0;a.almostEquals(b,5E-4,!0)&&(this.currentTime=this.animation.time)};b.prototype.cameraAt=function(a,b){this.animation.cameraAt(a,
this._current);b=b||new d;this._current.copyToRenderCamera(b);return b};b.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return b}();f.Animation=m;f.default=m})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/gl-matrix","../../support/mathUtils"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});var g=e.angle,
d=e.lerp,h=e.slerp,c=k.vec3d.create(),b=k.vec3d.create(),a=k.vec3d.create(),l=k.vec3d.create(),n=k.vec3d.create(),p=k.vec3d.create(),q=k.vec3d.createFrom(0,0,1),r=k.vec3d.createFrom(0,1,0),t=k.vec3d.createFrom(1,0,0),w=k.mat3d.create();m=function(){function e(a){void 0===a&&(a="global");this.viewingMode=a;this.center=k.vec3d.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=k.vec3d.create(r)}e.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};e.prototype.zoomAtPixelsPerPan=
function(a){return this.size/2/(this._zoomToPanScale*a)};e.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};e.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var c=k.vec3d.length(this.center),d=k.vec3d.length(a.center),c=(c+d)/2;b.pan=g(this.center,a.center)*c}else b.pan=k.vec3d.dist(this.center,a.center);c=Math.abs(a.yaw-this.yaw);c>=Math.PI&&(c=2*Math.PI-c);b.rotate=Math.max(c,
Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};e.prototype.interpolate=function(a,b,c){"global"===this.viewingMode?h(a.center,b.center,c.pan,this.center):k.vec3d.lerp(a.center,b.center,c.pan,this.center);this.distance=d(a.distance,b.distance,c.zoom);this.pitch=d(a.pitch,b.pitch,c.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(a<b?1:-1)*Math.PI);this.yaw=d(a,b,c.rotate)};e.prototype.copyFrom=function(a){k.vec3d.set(a.center,this.center);this.pitch=
a.pitch;this.yaw=a.yaw;this.distance=a.distance;k.vec3d.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};e.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,w);k.vec3d.set(a.center,this.center);k.mat3d.multiplyVec3(b,k.vec3d.subtract(a.center,a.eye,l));k.mat3d.multiplyVec3(b,a.up,n);this.distance=k.vec3d.length(l);l[0]/=this.distance;l[1]/=this.distance;l[2]/=this.distance;this.pitch=this._eyeUpToPitch(l,
n);this.yaw=this._eyeUpToYaw(l,n);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};e.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};e.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,w);k.mat3d.transpose(b);this._axisAngleVec3(t,this.pitch-Math.PI/2,r,l);this._axisAngleVec3(q,this.yaw,l);this._axisAngleVec3(t,this.pitch-Math.PI/2,q,n);this._axisAngleVec3(q,this.yaw,n);k.vec3d.scale(l,
this.distance);k.mat3d.multiplyVec3(b,l);k.mat3d.multiplyVec3(b,n);a.center=this.center;a.eye=k.vec3d.subtract(this.center,l,l);a.up=n};e.prototype._axisAngleVec3=function(d,e,g,h){void 0===h&&(h=g);var l=Math.cos(e);e=Math.sin(e);k.vec3d.scale(g,l,c);k.vec3d.scale(k.vec3d.cross(d,g,b),e);k.vec3d.scale(d,(1-l)*k.vec3d.dot(d,g),a);return k.vec3d.add(k.vec3d.add(c,b,h),a,h)};e.prototype._lookAtOrientation=function(d,e){this._upAtLookAt(d,a);k.vec3d.normalize(k.vec3d.cross(this.lookAtDirection,a,c));
0===c[0]&&0===c[1]&&0===c[2]&&k.vec3d.set(t,c);k.vec3d.normalize(k.vec3d.cross(a,c,b));e||(e=k.mat3d.create());e[0]=c[0];e[1]=b[0];e[2]=a[0];e[3]=c[1];e[4]=b[1];e[5]=a[1];e[6]=c[2];e[7]=b[2];e[8]=a[2];return e};e.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?k.vec3d.set(q,b):k.vec3d.normalize(a,b)};e.prototype._eyeUpToPitch=function(a,b){return Math.PI-g(q,a)};e.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?(k.vec3d.set(c,p),0<a[2]&&k.vec3d.scale(p,-1)):k.vec3d.set(a,
p);return g(t,k.vec3d.normalize(k.vec3d.cross(p,q,b)),q)};return e}();f.default=m})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});var h={zoom:0,pan:0,rotate:0};m=function(){function c(b){this.createCamera=b;this.time=0;this.definition=new e.Definition(b);this.path=new d.Path}c.prototype.update=function(b,a,c){this.definition.update(b,
a,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};c.prototype.cameraAt=function(b,a){a=a||this.createCamera();b=Math.min(Math.max(0,b),1);b=this.settings.easing?this.normalizedEasing(this.settings.easing,b,1E3*this.time):1<=this.time?this.normalizedEasing(k.inOutCoastQuad,b):this.normalizedEasing(k.outExpo,b);b=this.path.interpolateComponentsAt(b,h);a.interpolate(this.definition.source,this.definition.target,b);return a};c.prototype.normalizedEasing=
function(b,a,c){c=b(0);var d=b(1);return(b(a)-c)/(d-c)};c.prototype._applyTimeSettings=function(b,a){var c=null!=a.speedFactor?a.speedFactor:1;null!=a.duration?b=a.duration:null!=a.speedFactor&&(b/=c);return b=Math.min(Math.max(null!=a.minDuration?a.minDuration:g.defaultSettings.minDuration/c,b),null!=a.maxDuration?a.maxDuration:g.defaultSettings.maxDuration/c)};return c}();f.Animation=m;f.default=m})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],
function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e){this.createCamera=e;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:k.defaultSettings.desiredScreenFlow};this.source=e();this.target=e()}e.prototype.clone=function(){var g=new e(this.createCamera);g.copyFrom(this);return g};e.prototype.copyFrom=function(e){this.update(e.source,e.target,e.settings)};e.prototype.update=function(e,d,h){this.source!==e&&this.source.copyFrom(e);
this.target!==d&&this.target.copyFrom(d);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=h.desiredScreenFlow?h.desiredScreenFlow:k.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};e.prototype.halfWindowPanAtZoom=function(e){e=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/e};Object.defineProperty(e.prototype,"hasZoom",{get:function(){return 1E-5<
Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return e}();f.Definition=m;f.default=m})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,
"__esModule",{value:!0});f.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(a,b){var e=c.call(this)||this;e._preallocSegments=[new d.default,new d.default,new d.default];e.update(a,b);return e}k(b,c);b.prototype.update=
function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=h.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,b.apex)}};b.prototype.segmentInterpolateComponentsAt=function(a,b,c){c=a.interpolateComponentsAt(b,c);a===this._ascensionSegment?c.zoom=e.outQuad(c.zoom):a===this._descensionSegment&&(c.zoom=e.inQuad(c.zoom));return c};b.prototype._updateWithApex=
function(a,b){var c=this._preallocSegments,d=c[0],e=c[1],c=c[2],g=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-g,null!=b.ascensionFactor?b.descensionFactor:.5);var h=1-g-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=a;d.definition.compared.pan=this.definition.compared.pan*g;d.definition.compared.rotate=this.definition.compared.rotate*g;d.update();this._ascensionSegment=d;this.segments.push(d);0<h&&(e.definition?
e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=a,e.definition.compared.targetZoom=a,e.definition.compared.pan=this.definition.compared.pan*h,e.definition.compared.rotate=this.definition.compared.rotate*h,e.update(),this.segments.push(e));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*
b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};b.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return b}(g.default);f.Path=m;f.default=m})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(){this.segments=[]}Object.defineProperty(f.prototype,
"time",{get:function(){return this.segments.reduce(function(e,g){return e+g.time},0)},enumerable:!0,configurable:!0});f.prototype.interpolateComponentsAt=function(e,g){e=Math.min(Math.max(e,0),1);e*=this.time;for(var d=0,h=0,c=this.definition,b=0;b<this.segments.length;b++){var a=this.segments[b],l=a.definition;if(e<=a.time||b===this.segments.length-1)return g=this.segmentInterpolateComponentsAt(a,e/a.time,g),g.pan=c.hasPan?(d+l.compared.pan*g.pan)/c.compared.pan:1,g.rotate=c.hasRotate?(h+l.compared.rotate*
g.rotate)/c.compared.rotate:1,e=g.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom,g.zoom=c.hasZoom?(e-d)/(h-d):1,g;e-=a.time;d+=l.compared.pan;h+=l.compared.rotate}};f.prototype.segmentInterpolateComponentsAt=function(e,g,d){return e.interpolateComponentsAt(g,d)};return f}();f.Path=m;f.default=m})},"esri/views/animation/pointToPoint/Segment":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e){e&&this.update(e)}f.prototype.update=function(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};f.prototype._updatePrecomputedVariables=function(){var e=this.definition,g=e.compared,d=g.sourceZoom,h=g.targetZoom;this._zoomSign=d>h?1:-1;this._panPixelsAtSource=g.pan*e.source.pixelsPerPanAtZoom(d);e=(e.source.pixelsPerRotateAtZoom(d)+
e.target.pixelsPerRotateAtZoom(h))/2;this._rotatePixels=g.rotate*e};f.prototype._updatePixelFlow=function(){var e=this.definition.compared.sourceZoom,g=this.definition.compared.targetZoom,d=this.definition,h=d.hasZoom,c=d.hasPan,d=d.hasRotate,b=0,a=0;h&&(c&&(b=(g/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),d&&(a=Math.log(e/g)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=
0;e=this.definition.desiredPixelFlow;h&&c&&d?(g=b+a+b*a,this._zoomPixelFlow=b*a/g*e,this._panPixelFlow=a/g*e,this._rotatePixelFlow=b/g*e):h&&c?(g=1+b,this._zoomPixelFlow=b/g*e,this._panPixelFlow=1/g*e):h&&d?(g=1+a,this._zoomPixelFlow=a/g*e,this._rotatePixelFlow=1/g*e):c&&d?(b=this._panPixelsAtSource/this._rotatePixels,g=1+b,this._panPixelFlow=b/g*e,this._rotatePixelFlow=1/g*e):c?this._panPixelFlow=e:h?this._zoomPixelFlow=e:d&&(this._rotatePixelFlow=e);this.time=d?this.rotateTime:h?this.zoomTime:c?
this.panTime:0};Object.defineProperty(f.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/
this._panPixelFlow*this._panPixelsAtSource*e+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});f.prototype._interpolateComponentsZoom=function(e){if(this.definition.hasZoom){var g=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;return(g*
Math.pow(g/d,-e)-g)/(d-g)}return e};f.prototype._interpolateComponentsPan=function(e){if(this.definition.hasPan&&this.definition.hasZoom){var g=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,g*e*this.time)-1)/(g*Math.LN2)}return e};f.prototype._interpolateComponentsRotate=function(e){return e};f.prototype.interpolateComponentsAt=function(e,g){e=Math.min(Math.max(e,0),1);var d=this._interpolateComponentsZoom(e),
h=this._interpolateComponentsPan(e);e=this._interpolateComponentsRotate(e);g?(g.zoom=d,g.pan=h,g.rotate=e):g={zoom:d,pan:h,rotate:e};return g};return f}();f.Segment=m;f.default=m})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports","./functions"],function(m,f,k){function e(e,d){var g=Math.max(e.compared.sourceZoom,e.compared.targetZoom);e=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return e<g?null!=d.maximumDistance?g+(d.maximumDistance-
g)/2:1.5*g:d.maximumDistance?Math.min(d.maximumDistance,e):e}Object.defineProperty(f,"__esModule",{value:!0});f.optimalDistance=function(g,d){var h=e(g,d),c={ascensionFactor:null!=d.ascensionFactor?d.ascensionFactor:.5,descensionFactor:null!=d.descensionFactor?d.descensionFactor:.5},b=0===c.ascensionFactor,a=0===c.descensionFactor,l=b?k.tAscensionZoomOnly:k.tAscensionZoomPan,f=b?k.dtAscensionZoomOnly:k.dtAscensionZoomPan,m=b?k.ddtAscensionZoomOnly:k.ddtAscensionZoomPan,q=a?k.tDescensionZoomOnly:k.tDescensionZoomPan,
r=a?k.dtDescensionZoomOnly:k.dtDescensionZoomPan,t=a?k.ddtDescensionZoomOnly:k.ddtDescensionZoomPan,b=function(a){return l(g,c,a)+k.tPanion(g,c,a)+q(g,c,a)},a=function(a){return f(g,c,a)+k.dtPanion(g,c,a)+r(g,c,a)},w=function(a){return m(g,c,a)+k.ddtPanion(g,c,a)+t(g,c,a)},u=b(h),x=k.tBaseLine(g),v=d.maximumIterations||20,z=null!=d.maximumDistance?d.maximumDistance:Infinity;for(d=0;d<v;d++){var y=(a(h)+1E-6)/w(h);if(isNaN(y)||h>=z&&0>y){if(!isFinite(z))return null;h=z;u=b(h);break}h-=y;if(h<g.compared.sourceZoom||
h<g.compared.targetZoom)return null;y=b(h);if(.005>=Math.abs(y-u)/u)break;u=y}return u>.7*x?null:h<g.compared.sourceZoom||h<g.compared.targetZoom?null:h}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.tAscensionZoomPan=function(f,e,g){var d=f.halfWindowPanAtZoom(g-f.compared.sourceZoom);return-f.halfWindowSize*(e.ascensionFactor*Math.LN2*f.compared.pan+d)*Math.log(f.compared.sourceZoom/
g)/(f.desiredPixelFlow*Math.LN2*d)};f.dtAscensionZoomPan=function(f,e,g){var d=1/g,h=Math.log(f.compared.sourceZoom*d),c=1/f.desiredPixelFlow,b=1/Math.LN2;g-=f.compared.sourceZoom;var a=1/g;e=(e.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(g))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*d*c*b*a*e-f.halfWindowSize*h*c*b*a+f.halfWindowSize*h*c*b*e/(g*g)};f.ddtAscensionZoomPan=function(f,e,g){var d=g-f.compared.sourceZoom,h=1/d,c=1/g,b=Math.log(f.compared.sourceZoom*c);e=(e.ascensionFactor*
Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(d))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*h*(-2*h*c*e+2*h*b+2*c-2*b*e/(d*d)-e/(g*g))/(f.desiredPixelFlow*Math.LN2)};f.tAscensionZoomOnly=function(f,e,g){return-f.halfWindowSize*Math.log(f.compared.sourceZoom/g)/(f.desiredPixelFlow*Math.LN2)};f.dtAscensionZoomOnly=function(f,e,g){return f.halfWindowSize/(g*f.desiredPixelFlow*Math.LN2)};f.ddtAscensionZoomOnly=function(f,e,g){return-f.halfWindowSize/(g*g*f.desiredPixelFlow*Math.LN2)};f.tPanion=
function(f,e,g){return-f.compared.pan*f.halfWindowSize*(e.ascensionFactor+e.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(g))};f.dtPanion=function(f,e,g){return f.compared.pan*f.halfWindowSize*(e.ascensionFactor+e.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(g*g))};f.ddtPanion=function(f,e,g){return-2*f.compared.pan*f.halfWindowSize*(e.ascensionFactor+e.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(g*g*g))};f.tDescensionZoomPan=function(f,e,g){return f.halfWindowSize*
(-f.halfWindowPanAtZoom(g)-e.descensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))*Math.log(g/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*f.halfWindowPanAtZoom(-g+f.compared.targetZoom))};f.dtDescensionZoomPan=function(f,e,g){var d=Math.log(g/f.compared.targetZoom),h=1/f.desiredPixelFlow,c=1/Math.LN2,b=-g+f.compared.targetZoom,a=1/b;e=(-f.halfWindowPanAtZoom(g)-e.descensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);
return-f.halfWindowSize*d*h*c*a+f.halfWindowSize*d*h*c*e/(b*b)+f.halfWindowSize*h*c*a*e/g};f.ddtDescensionZoomPan=function(f,e,g){var d=g-f.compared.targetZoom,h=1/d,c=1/g,b=Math.log(g/f.compared.targetZoom);e=(f.halfWindowPanAtZoom(g)+e.descensionFactor*Math.LN2*f.compared.pan-f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*h*(-2*h*c*e-2*h*b+2*c+2*b*e/(d*d)-e/(g*g))/(f.desiredPixelFlow*Math.LN2)};f.tDescensionZoomOnly=function(f,e,g){return f.halfWindowSize*
Math.log(g/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2)};f.dtDescensionZoomOnly=function(f,e,g){return f.halfWindowSize/(g*f.desiredPixelFlow*Math.LN2)};f.ddtDescensionZoomOnly=function(f,e,g){return-f.halfWindowSize/(g*g*f.desiredPixelFlow*Math.LN2)};f.tBaseLine=function(f){var e=Math.LN2*f.compared.pan,g=f.halfWindowPanAtZoom(f.compared.sourceZoom-f.compared.targetZoom),d=f.halfWindowSize*Math.log(f.compared.sourceZoom/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*g);return f.compared.sourceZoom<=
f.compared.targetZoom?d*(e-g):d*(e+g)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function h(c){void 0===c&&(c=new e);var b=d.call(this)||this;b.viewAnimation=c;return b}k(h,d);Object.defineProperty(h.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(c){this._asyncResult&&this._asyncResult.reject();this._asyncResult=c;if(this.state===g.State.Finished||this.state===g.State.Stopped)this._asyncResult=null,this.state===g.State.Finished?c.resolve():c.reject()},enumerable:!0,configurable:!0});h.prototype.onControllerStart=function(c){var b=this;d.prototype.onControllerStart.call(this,c);this.viewAnimation&&this.viewAnimation.always(function(){b.updateStateFromViewAnimation()})};
h.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==g.State.Ready&&this.state!==g.State.Running||(this.viewAnimation.state===e.State.FINISHED?this.finish():this.viewAnimation.state===e.State.STOPPED&&(this.state=g.State.Stopped))};h.prototype.onControllerEnd=function(c){this.viewAnimation&&(this.viewAnimation.done||(this.state===g.State.Finished?this.viewAnimation.finish():this.state===g.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===
g.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());d.prototype.onControllerEnd.call(this,c)};h.prototype.finish=function(){this.finishController()};return h}(g.CameraController);f.AnimationController=m})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,
"__esModule",{value:!0});var h;(function(c){c.Ready="ready";c.Rejected="rejected";c.Running="running";c.Stopped="stopped";c.Finished="finished"})(h=f.State||(f.State={}));m=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.state=h.Ready;return a}k(b,c);Object.defineProperty(b.prototype,"active",{get:function(){return this.state===h.Running},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});b.prototype.stopController=function(){return this.canStop?(this.state=h.Stopped,!0):!1};b.prototype.finishController=function(){this.state=h.Finished};b.prototype.onControllerStart=function(a){this.state=h.Running};b.prototype.onControllerEnd=function(a){};b.prototype.stepController=function(a,b){};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});
e([d.property({readOnly:!0,dependsOn:["state"]})],b.prototype,"active",null);e([d.property()],b.prototype,"state",void 0);return b=e([d.subclass()],b)}(d.declared(g));f.CameraController=m})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(m,
f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(a,c){var d=b.call(this,a.state,a.sceneIntersectionHelper,"interaction"===c?null:void 0)||this;d.view=a;d.mode=c;d.zoomLocation=g.vec3d.create();d.tmpCamera=new h;d.tmpRayDir=g.vec3d.create();d.tmpCenter=g.vec3d.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new h,interactionDirection:null,tiltMode:0};return d}k(a,b);Object.defineProperty(a.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});a.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);this.tmpCamera.copyFrom(c.camera);0<a?(this.intersectionHelper.pickPointInScreen(b,this.zoomLocation)||this.intersectionHelper.pickFreePointInScreen(b,this.zoomLocation),this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,
this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:g.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};a.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:c.outExpo}};a.prototype.updateCamera=function(a,b,
c,d){g.vec3d.subtract(c,a.eye,this.tmpRayDir);d=g.vec3d.length(this.tmpRayDir);var h=d*b;1>=b&&4>h&&(h=4,b=h/d);1E-6>Math.abs(d-h)||(g.vec3d.scale(this.tmpRayDir,b),g.vec3d.subtract(c,this.tmpRayDir,a.eye),g.vec3d.lerp(a.center,c,1-b),e.applyAll(this.view,this.tmpCamera,this.constraintOptions))};return a}(d.PointToPointAnimationController);f.ZoomStepController=m})},"esri/views/input/InputHandler":function(){define(["require","exports","../../core/Logger","./EventMatch"],function(m,f,k,e){Object.defineProperty(f,
"__esModule",{value:!0});var g=k.getLogger("esri.views.input.InputHandler");m=function(){function c(b){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._hasSideEffects=b}Object.defineProperty(c.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(var b in this._incoming)for(var a=0,c=this._incoming[b];a<c.length;a++)this._incomingEventMatches.push(c[a].match)}return this._incomingEventMatches},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(b){return b.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});c.prototype.onInstall=function(b){var a=this;this._manager?g.error("This InputHandler has already been registered with an InputManager"):(b.setEventCallback(function(b){return a._handleEvent(b)}),b.setUninstallCallback(function(){return a._onUninstall()}),this._manager=b)};c.prototype.onUninstall=function(){};c.prototype.registerIncoming=function(b,a,c){var g=this;"function"===
typeof a?(c=a,a=[]):a=a||[];b="string"===typeof b?new e.EventMatch(b,a):b;var h=function(){g._incomingEventTypes=null;g._incomingEventMatches=null};a=function(a){var b=g._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),h(),g._manager&&g._manager.updateDependencies())};c=new d(b,c,{onPause:a,onRemove:a,onResume:function(a){var b=g._incoming[a.match.eventType];b&&-1===b.indexOf(a)&&(b.push(a),h(),g._manager&&g._manager.updateDependencies())}});a=this._incoming[b.eventType];a||(a=[],this._incoming[b.eventType]=
a);a.push(c);h();this._manager&&this._manager.updateDependencies();return c};c.prototype.registerOutgoing=function(b){var a=this;if(this._outgoing[b])throw Error("There is already a callback registered for this outgoing InputEvent: "+b);var c=new h(b,{onEmit:function(b,c,d,e){a._manager.emit(b.eventType,c,d,e)},onRemove:function(b){delete a._outgoing[b.eventType];a._manager.updateDependencies()}});this._outgoing[b]=c;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();
return c};c.prototype.startCapturingPointer=function(b){this._manager.setPointerCapture(b,!0)};c.prototype.stopCapturingPointer=function(b){this._manager.setPointerCapture(b,!1)};c.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):g.error("This InputHandler is not registered with an InputManager")};c.prototype._handleEvent=function(b){var a=this._incoming[b.type];if(a)for(var c=0;c<a.length;c++){var d=a[c];if(d.match.matches(b)&&(d.callback(b),b.shouldStopPropagation()))break}};
return c}();f.InputHandler=m;var d=function(){function c(b,a,c){this.match=b;this._callback=a;this._handler=c}c.prototype.pause=function(){this._handler.onPause(this)};c.prototype.resume=function(){this._handler.onResume(this)};c.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(c.prototype,"callback",{get:function(){return this._callback},enumerable:!0,configurable:!0});return c}(),h=function(){function c(b,a){this.eventType=b;this._removed=!1;this._handler=a}c.prototype.emit=
function(b,a,c){if(!this._removed)this._handler.onEmit(this,b,a,c)};c.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return c}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e,g){void 0===g&&(g=[]);this.eventType=e;this.keyModifiers=g}f.prototype.matches=function(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;e=e.modifiers;
for(var g=0,d=this.keyModifiers;g<d.length;g++)if(!e.has(d[g]))return!1;return!0};return f}();f.EventMatch=m})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.eventMatchesPointerAction=function(f,e){switch(e){case "primary":return"touch"===f.pointerType||0===f.button;case "secondary":return"touch"!==f.pointerType&&2===f.button;case "tertiary":return"touch"!==f.pointerType&&1===f.button}};f.eventMatchesMousePointerAction=
function(f,e){if("touch"===f.pointerType)return!1;switch(e){case "primary":return 0===f.button;case "secondary":return 2===f.button;case "tertiary":return 1===f.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(b,
a,c,d){var e=g.call(this,!0)||this;e.view=b;e.pointerAction=a;e.pivotPoint=c;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}k(c,g);c.prototype.handleDrag=function(b){var a=b.data;if(!(1<a.pointers.size)&&d.eventMatchesMousePointerAction(b.data,this.pointerAction)){var c=[a.center.x,this.view.height-a.center.y];switch(a.action){case "start":this.cameraController=new e.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(c);break;case "update":this.cameraController.update(c);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return c}(g.InputHandler);f.DragRotate=m})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/gl-matrix ../Constraints ./InteractiveController ../utils/navigationUtils ../../support/mathUtils".split(" "),function(m,
f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function h(b,c,d){var e=a.call(this)||this;e.view=b;e.intersectionHelper=c;e.pivot=d;e.lastPoint=g.vec2d.create();e.tmpWorldUp=g.vec3d.create();e.tmpViewDir=g.vec3d.create();e.tmpRotCurPoint=g.vec2d.create();e.tmpTransf=g.mat4d.create();e.tmpAxis=g.vec3d.create();e.pivotPos=g.vec3d.create();e.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};
e.rotScale="center"===d?3:1.5;return e}k(h,a);h.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":g.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.pickPointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.intersectionHelper.pickFreePointFromSegment(this.beginCamera.eye,
this.beginCamera.center,this.pivotPos):g.vec3d.set(this.beginCamera.center,this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;c.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};h.prototype.update=function(a){if(this.active){var b;switch(this.pivot){case "eye":b=this.currentCamera.center;break;case "center":this.currentCamera.center=
this.pivotPos,b=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,b,this.pivotPos);e.applyAll(this.view,this.currentCamera,this.constraintOptions)}};h.prototype.end=function(){this.active&&this.finishController()};h.prototype.applyRotation=function(a,e,h,f){this.view.renderCoordsHelper.worldUpAtPosition(f,this.tmpWorldUp);c.normalizeCoordinate(a,e,this.tmpRotCurPoint);e=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var l=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;
g.vec3d.subtract(h,f,this.tmpViewDir);var k=g.vec3d.length(this.tmpViewDir),k=b.acos(g.vec3d.dot(this.tmpViewDir,this.tmpWorldUp)/k);if("eye"===this.pivot){var m=.5*Math.PI-k,n=.495*Math.PI;e=m-Math.max(-n,Math.min(n,m+-.5*e))}e=b.clamp(e+k,d.TiltDefault.min,d.TiltDefault.max)-k;g.mat4d.identity(this.tmpTransf);g.vec3d.cross(a.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(l=-l);g.mat4d.rotate(this.tmpTransf,l,this.tmpWorldUp);g.mat4d.rotate(this.tmpTransf,e,this.tmpAxis);g.mat4d.multiplyVec3(this.tmpTransf,
this.tmpViewDir);g.vec3d.add(f,this.tmpViewDir,h);g.mat4d.multiplyVec3(this.tmpTransf,a.up);g.vec2d.set(this.tmpRotCurPoint,this.lastPoint);a.markViewDirty()};return h}(h.InteractiveController);f.RotateController=m})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function e(){var c=
null!==d&&d.apply(this,arguments)||this;c.beginCamera=new g;c.currentCamera=new g;return c}k(e,d);Object.defineProperty(e.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});e.prototype.stepController=function(c,b){d.prototype.stepController.call(this,c,b);b.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(b)};e.prototype.onControllerStart=function(c){d.prototype.onControllerStart.call(this,c);this.beginCamera.copyFrom(c);this.currentCamera.copyFrom(c)};
e.prototype.onControllerEnd=function(c){c.copyViewFrom(this.currentCamera);d.prototype.onControllerEnd.call(this,c)};return e}(e.CameraController);f.InteractiveController=m})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,
"__esModule",{value:!0});m=function(c){function b(a,b,d){var e=c.call(this,!0)||this;e.view=a;e.pointerAction=b;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}k(b,c);b.prototype.handleDrag=function(a){var b=a.data;if(!(1<b.pointers.size)&&h.eventMatchesMousePointerAction(a.data,this.pointerAction)){var c=[b.center.x,this.view.height-b.center.y];switch(b.action){case "start":this.cameraController=this.view.state.isGlobal?new e.ZoomController(this.view,this.view.sceneIntersectionHelper):
new g.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController.update(c);break;case "end":this.cameraController.end(),this.cameraController=null}a.stopPropagation()}};return b}(d.InputHandler);f.DragZoom=m})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../InteractiveController ../../utils/navigationUtils".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(a,b){var d=c.call(this)||this;d.view=a;d.intersectionHelper=b;d.pickPoint=g.vec3d.create();d.tmpP0=g.vec3d.create();d.panAxis=g.vec3d.create();d.tmpRayDir=g.vec3d.create();d.targetOnSphere=g.vec3d.create();d.dragBeginPoint=g.vec2d.create();d.normalizedAnchorPoint=g.vec2d.create();d.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};d.sphere={center:g.vec3d.create(),radius:0};d.hasPickPoint=!1;return d}k(b,c);b.prototype.begin=function(a){this.active&&(g.vec2d.set(a,this.dragBeginPoint),h.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=h.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};b.prototype.update=function(a){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;g.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var b=g.vec3d.length(this.tmpRayDir);h.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var c=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),d=b*Math.pow(2,c),f=this.view.state.constraints.minimumPoiDistance;0>c&&d<f&&(d=f);1E-6>Math.abs(b-d)||(this.hasPickPoint&&d<b&&(c=1-(1-d/b)*(1-this.sphere.radius/
g.vec3d.length(this.currentCamera.center)),g.vec3d.scale(this.currentCamera.center,c)),g.vec3d.scale(this.tmpRayDir,-d/b),g.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),e.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(h.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),a=h.rotationAndAxisFromPoints(this.pickPoint,
this.targetOnSphere,this.panAxis),h.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,a)),e.applySurfaceCollision(this.view,this.currentCamera))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(d.InteractiveController);f.ZoomController=m})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../InteractiveController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(a,c){var d=b.call(this)||this;d.view=a;d.intersectionHelper=c;d.tmpP=g.vec3d.create();d.tmpN=g.vec3d.create();d.tmpP0=g.vec3d.create();d.tmpPoi=g.vec3d.create();d.tmpRayDir=g.vec3d.create();d.dragBeginPoint=g.vec2d.create();d.normalizedAnchorPoint=g.vec2d.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:g.vec3d.create(),
tiltMode:0};d.plane={normal:g.vec3d.create(),d:0};return d}k(a,b);a.prototype.begin=function(a){this.active&&(g.vec2d.set(a,this.dragBeginPoint),h.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.intersectionHelper.pickPointInScreen(a,this.tmpP)||this.intersectionHelper.pickFreePointInScreen(a,this.tmpP),g.vec3d.normalize(g.vec3d.subtract(this.beginCamera.eye,this.beginCamera.center,this.tmpN)),0>this.tmpN[1]&&g.vec3d.negate(this.tmpN),h.setPlane(this.tmpP,this.tmpN,this.plane),
this.constraintOptions.interactionStartCamera=this.beginCamera)};a.prototype.update=function(a){if(this.active){h.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||g.vec3d.set(this.currentCamera.center,this.tmpPoi);h.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var b=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);g.vec2d.set(this.tmpP0,this.normalizedAnchorPoint);g.vec3d.subtract(this.tmpPoi,this.currentCamera.eye,this.tmpRayDir);var d=g.vec3d.length(this.tmpRayDir),
f=d*(1-b);g.vec3d.set(this.tmpRayDir,this.constraintOptions.interactionDirection);g.vec3d.scale(this.constraintOptions.interactionDirection,c.sign(b)/d);var l=this.view.state.constraints.minimumPoiDistance;0<=b&&f<l&&(f=l,b=-(f-d)/d);1E-6>Math.abs(d-f)||(g.vec3d.scale(this.tmpRayDir,b),g.vec3d.add(this.currentCamera.eye,this.tmpRayDir),g.vec3d.lerp(this.currentCamera.center,this.tmpPoi,b),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):
Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),e.applyAll(this.view,this.currentCamera,this.constraintOptions))}};a.prototype.end=function(){this.active&&this.finishController()};return a}(d.InteractiveController);f.ZoomController=m})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadController ../../../input/InputHandler".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(a){var b=c.call(this,!0)||this;b.view=a;b.watchHandles=new e;b.handle=b.registerIncoming("gamepad",function(a){return b.handleEvent(a)});b.handle.pause();return b}k(b,c);b.prototype.onInstall=function(a){var b=this;c.prototype.onInstall.call(this,a);this.watchHandles.add([g.init(this.view.navigation.gamepad,"enabled",function(a){a?b.handle.resume():(b.handle.pause(),b.cameraController&&(b.cameraController.finishController(),
b.cameraController=null))}),this.view.navigation.gamepad.watch("device",function(a){b.cameraController&&a&&b.cameraController.device!==a&&(b.cameraController.finishController(),b.cameraController=null)})])};b.prototype.onUninstall=function(){this.watchHandles.removeAll();c.prototype.onUninstall.call(this)};b.prototype.handleEvent=function(a){var b=this.view.navigation.gamepad.device;if(!b||a.data.device===b)if((b=this.cameraController&&this.cameraController.active)||d.GamepadController.activatesFor(this.view,
a.data))b||(b=new d.GamepadController(this.view,a.data.device),this.view.state.switchCameraController(b)&&(this.cameraController=b)),this.cameraController&&this.cameraController.active&&this.cameraController.device===a.data.device&&this.cameraController.handleEvent(a.data)};return b}(h.InputHandler);f.GamepadNavigation=m})},"esri/views/3d/state/controllers/GamepadController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/runtimeUtils ../../camera/constraintUtils ../../lib/gl-matrix ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../../3d/support/earthUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/mathUtils ../../webgl-engine/lib/Camera ../../../navigation/gamepadUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function f(a,b){var d=c.call(this)||this;d.view=a;d.device=b;d.transformation={translation:[0,0,0],heading:0,tilt:0};d.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new r,interactionFactor:0,interactionDirection:null,tiltMode:1};return d}k(f,c);f.prototype.handleEvent=function(a){var b=t.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===
a.action||t.isZeroTransformation(b))&&this.finishController()};f.prototype.onControllerStart=function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;c.prototype.onControllerStart.call(this,a)};f.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};f.prototype.stepController=function(a,b){this.updateFilteredSurfaceElevation(a);this.currentCamera.copyViewFrom(b);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,G);this.applyPan(G.pan);this.applyRotate(G.rotate);this.applyZoom(G.zoom);this.applyAscend(G.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;g.applyAll(this.view,this.currentCamera,this.constraintOptions);c.prototype.stepController.call(this,a,b)};f.prototype.applyRotate=function(a){if(a.enabled){var b=this.currentCamera,
c=b.center,e=b.up,h=b.eye;d.vec3d.subtract(c,h);d.mat4d.multiplyVec3(a.matrix,c);d.vec3d.add(c,h);d.mat4d.multiplyVec3(a.matrix,e);b.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;g.applyAll(this.view,b,this.constraintOptions)}};f.prototype.applyPan=function(a){if(a.enabled){var b=this.currentCamera,c=b.center,e=b.up;d.mat4d.multiplyVec3(a.matrix,b.eye);d.mat4d.multiplyVec3(a.matrix,c);this.view.state.isGlobal&&d.mat4d.multiplyVec3(a.matrix,e);b.markViewDirty();
this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;g.applyAll(this.view,b,this.constraintOptions)}};f.prototype.applyZoom=function(a){if(a){var b=this.currentCamera,c=b.viewForward;d.vec3d.add(b.eye,d.vec3d.scale(c,a,D));this.currentCamera.markViewDirty();this.constraintOptions.interactionDirection=d.vec3d.negate(d.vec3d.set(c,O));this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;g.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=
null}};f.prototype.applyAscend=function(a){if(a){var b=this.currentCamera,c=b.center,b=b.eye;this.view.renderCoordsHelper.worldUpAtPosition(b,C);this.constraintOptions.interactionDirection=d.vec3d.set(C,O);if(this.view.state.isGlobal){var e=d.vec3d.length(b);a=(e+a)/e;d.vec3d.scale(b,a);d.vec3d.scale(c,a)}else a=d.vec3d.scale(C,a,F),d.vec3d.add(b,a),d.vec3d.add(c,a);this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=
8;g.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;g.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};f.prototype.calculateControlTransformation=function(a,b,c){c.zoom=0;c.ascend=0;c.pan.enabled=!1;d.mat4d.identity(c.pan.matrix);c.rotate.enabled=!1;d.mat4d.identity(c.rotate.matrix);a=this.computeVelocities(a);switch(this.view.viewingMode){case "local":this.calculateControlTransformationLocal(a,
b,c);break;case "global":this.calculateControlTransformationGlobal(a,b,c);break;default:e.neverReached(this.view.viewingMode)}};f.prototype.updateCameraCenter=function(){var a=this.currentCamera;b.centerOnManifoldSilhouetteFallback(this.view.renderCoordsHelper,a.eye,a.viewForward,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);this.currentCamera.markViewDirty()};f.prototype.calculateControlTransformationLocal=function(b,c,g){var f=c.viewRight,l=c.viewForward,
k=this.transformation,m=this.view.navigation.gamepad;d.vec3d.set3(l[0],l[1],0,B);d.vec3d.normalize(B);l=k.translation[0]*b.pan;0!==l&&(d.vec3d.scale(f,l,E),d.mat4d.translate(g.pan.matrix,E),g.pan.enabled=!0);d.vec3d.set3(0,0,0,D);switch(m.mode){case "pan":m=-k.translation[1]*b.pan;0!==m&&(d.vec3d.scale(B,m,D),d.mat4d.translate(g.pan.matrix,D),g.pan.enabled=!0);break;case "zoom":g.zoom=-k.translation[1]*b.zoom;break;default:e.neverReached(m.mode)}g.ascend=k.translation[2]*b.ascend;m=-k.heading*b.rotate;
0!==m&&(d.mat4d.rotate(g.rotate.matrix,m,this.view.renderCoordsHelper.worldUpAtPosition(c.eye,C)),g.rotate.enabled=!0);b=k.tilt*b.rotate;c=a.viewAngle(this.view.renderCoordsHelper,c.center,c.eye);if(c=q.clamp(c+b,h.TiltDefault.min,h.TiltDefault.max)-c)d.mat4d.rotate(g.rotate.matrix,c,f),g.rotate.enabled=!0};f.prototype.calculateControlTransformationGlobal=function(a,b,c){var e=b.eye,g=b.viewRight,h=this.transformation,f=this.view.navigation.gamepad;d.vec3d.cross(g,e,B);d.vec3d.normalize(B);d.vec3d.negate(B);
var l=h.translation[0]*a.pan;0!==l&&(d.mat4d.rotate(c.pan.matrix,l,B),c.pan.enabled=!0);switch(f.mode){case "pan":f=h.translation[1]*a.pan;0!==f&&(d.mat4d.rotate(c.pan.matrix,f,g),c.pan.enabled=!0);break;case "zoom":c.zoom=-h.translation[1]*a.zoom}f=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;c.ascend=h.translation[2]*a.ascend;l=-h.heading*a.rotate;0!==l&&(d.mat4d.rotate(c.rotate.matrix,l,e),c.rotate.enabled=!0);a=this.clampTiltDeltaGlobalToValidRange(h.tilt*a.rotate,
b.eye,b.viewForward,f);0!==a&&(d.mat4d.rotate(c.rotate.matrix,a,g),c.rotate.enabled=!0)};f.prototype.clampTiltDeltaGlobalToValidRange=function(c,e,g,f){var k=b.onSurfaceTiltToEyeTiltGlobal(h.TiltDefault.min,e,f),m=0,n=0;this.view.renderCoordsHelper.intersectManifold(e,g,f,F)?(g=a.viewAngle(this.view.renderCoordsHelper,F,e),m=b.onSurfaceTiltToEyeTiltGlobal(g,e,f),n=b.onSurfaceTiltToEyeTiltGlobal(h.TiltDefault.max,e,f)):(b.closestPointOnCenteredSphereSilhouette(f+l.earthRadius,e,g,F),g=q.acos(-d.vec3d.dot(g,
d.vec3d.normalize(F))),m=b.offSurfaceTiltToEyeTiltGlobal(g,e,f),n=b.offSurfaceTiltToEyeTiltGlobal(h.TiltDefault.max,e,f));return q.clamp(m+c,k,n)-m};f.prototype.pointEquivalentAboveSurface=function(a,b,c){var e=this.view.renderCoordsHelper,g=e.getAltitude(a);b+=Math.abs(g-b);d.vec3d.set(a,c);e.setAltitude(b,c);return b};f.prototype.clampedDistanceToSurface=function(a,c){var e=this.view.renderCoordsHelper,g=this.view.state.camera,h=n.headingTiltToDirectionUp(this.view,c,0,u,J).direction;b.centerOnManifoldSilhouetteFallback(e,
c,h,a,M);h=d.vec3d.dist(c,M);b.centerOnManifoldSilhouetteFallback(e,c,d.vec3d.direction(g.center,c,M),a,N);a=d.vec3d.dist(c,N);return Math.min(h,a)};f.prototype.computeHeadingRotateRadius=function(a){var c=this.view,e=c.renderCoordsHelper,g=c.state,c=g.camera,g=g.isGlobal;b.centerOnManifoldSilhouetteFallback(e,c.eye,c.viewForward,this.filteredSurfaceElevation,F);if(g)return c=d.vec3d.subtract(a,F,M),e=d.vec3d.length(c),d.vec3d.scale(c,1/e,c),a=d.vec3d.normalize(a,N),a=q.acos(d.vec3d.dot(a,c)),e*Math.sin(Math.min(x,
a));d.vec3d.set(a,M);e.setAltitude(this.filteredSurfaceElevation,M);return d.vec3d.dist(F,M)};f.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:z};f.prototype.computeVelocities=function(a){var b=this.filteredSurfaceElevation,c=b+l.earthRadius,d=this.view.state,e=d.camera,g=d.isGlobal,h=this.pointEquivalentAboveSurface(e.eye,b,I),f=this.clampedDistanceToSurface(b,I),k=e.width/2,m=v*e.width,d=v*e.width,e=f*Math.tan(.5*e.fovX)/k,n=e/c,c=e/this.computeHeadingRotateRadius(I),
g=(g?n:e)*m*a,b=h-b,b=Math.max(this.minimumAscendVelocity()*a,Math.pow(2,m*a/k)*b-b),f=Math.pow(2,m*a/k)*f-f;a*=q.clamp(c*d,y,A);return{pan:g,ascend:b,zoom:f,rotate:a}};f.activatesFor=function(a,b){a=t.extractTransformation(b,a.navigation.gamepad,w);return!("end"===b.action||t.isZeroTransformation(a))};return f}(c.InteractiveController);f.GamepadController=m;var w={translation:[0,0,0],heading:0,tilt:0},u=80,x=q.deg2rad(u),v=.75,z=5,y=q.deg2rad(30),A=q.deg2rad(80),B=d.vec3d.create(),C=d.vec3d.create(),
E=d.vec3d.create(),D=d.vec3d.create(),F=d.vec3d.create(),M=d.vec3d.create(),N=d.vec3d.create(),I=d.vec3d.create(),G={zoom:0,ascend:0,pan:{enabled:!1,matrix:d.mat4d.create()},rotate:{enabled:!1,matrix:d.mat4d.create()}},O=d.vec3d.create(),J=p.createDirectionUp()})},"esri/core/runtimeUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.neverReached=function(f){}})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/promiseUtils ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/gl-matrix ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){function v(a){return"global"===a.viewingMode?r:q}function z(a,d,g){var h=a.renderSpatialReference,f=p.vec3d.set(d.viewForward,R),f=C(a,d.eye,f,d.up,P);a=a.spatialReference||b.WGS84;u.vectorToVector(d.eye,h,H,a)||(a=b.WGS84,u.vectorToVector(d.eye,h,H,a));return g?(g.position.x=H[0],g.position.y=H[1],g.position.z=H[2],g.position.spatialReference=a,g.heading=f.heading,g.tilt=f.tilt,g.fov=w.rad2deg(d.fov),g):new e(new c(H,a),f.heading,f.tilt,w.rad2deg(d.fov))}
function y(a,b,c){var d=a.state.camera,e=d.fovX,d=d.width/2;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(w.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return d/(39.37*g.screenDPI/b)/Math.tan(e/2)}function A(a,b,c){var d=a.state.camera;b=39.37*g.screenDPI/(d.width/2/(b*Math.tan(d.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(w.deg2rad(c)));return b*=a.renderCoordsHelper.unitInMeters}function B(a,b,c,d,e,g){if(J(g)){var f=h.createResolver();N(a,d.heading,d.tilt,b,c,e,f);f.promise.then(function(b){return g.resolve(O(a,
b,d.fov))})}else return f={center:[],eye:[],up:[],tilt:0,heading:0},N(a,d.heading,d.tilt,b,c,e,f),O(a,f,d.fov,g)}function C(a,b,c,d,e){return v(a).directionToHeadingTilt(b,c,d,e)}function E(a,b,c){return a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(b,L,a.spatialReference)&&a.basemapTerrain.getElevation(L)>L.z-1}function D(a,b,c){return a.renderCoordsHelper.fromRenderCoords(b,L,a.spatialReference)?a.elevationProvider.queryElevation(L).then(function(a){return a>L.z-10}):h.resolve(!1)}function F(a,
b){var d=p.vec3d.create();if(b&&b instanceof c){if(u.pointToVector(b,d,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain)return a.elevationProvider.queryElevation(b).then(function(b){null!=b&&a.renderCoordsHelper.setAltitude(b,d);return d})}else b?p.vec3d.set(b,d):p.vec3d.set(a.state.camera.center,d);return h.resolve(d)}function M(a,b){var d=p.vec3d.create();b&&b instanceof c?(u.pointToVector(b,d,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain&&(b=a.elevationProvider.getElevation(b),
null!=b&&a.renderCoordsHelper.setAltitude(b,d))):b?p.vec3d.set(b,d):p.vec3d.set(a.state.camera.center,d);return d}function N(a,b,d,e,g,h,f){var l=e&&e instanceof c?e:null;if(J(f))F(a,e).then(function(c){I(a,b,d,l,c,g,h,f)});else return e=M(a,e),I(a,b,d,l,e,g,h,f)}function I(a,c,d,e,g,h,f,l){e||(e=u.vectorToPoint(g,a.renderSpatialReference,a.spatialReference||b.WGS84));h=Math.max(h,a.state.constraints.minimumPoiDistance);var k=G(a,c,d,g,h,f),m=v(a).eyeForCenterWithHeadingTilt,n=m(g,h,k.heading,k.tilt);
if(f===S.ADJUST&&"global"===a.viewingMode&&0<d){var p=function(){var b=h,k=h,m=a.state.constraints.tilt(k),k=v(a).eyeTiltToLookAtTilt(g,k,d),k=Math.min(k,.5*Math.PI),m=m.min*(1-W)+k*W,b=v(a).lookAtTiltToEyeTilt(g,b,m);f=1>d-b?S.LOCKED:S.ADJUST;return I(a,c,b,e,g,h,f,l)};if(E(a,n.eye,n.tilt))return p();if(J(l)){D(a,n.eye,n.tilt).then(function(a){if(a)return p();l.resolve({eye:n.eye,up:n.up,center:g,heading:n.heading,tilt:n.tilt})});return}}k={center:[],eye:[],up:[],tilt:0,heading:0};l&&!J(l)&&(k=l);
k.eye=n.eye;k.up=n.up;k.center=g;k.heading=n.heading;k.tilt=n.tilt;J(l)&&l.resolve(k);return k}function G(a,c,d,e,g,h){var f=0;if(h=h===S.ADJUST)if(f=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(g/f)/Math.LN2)h=!0;else{var l=a.renderSpatialReference,k=a.spatialReference||b.WGS84;h=u.vectorToPoint(e,l,k);l=u.vectorToPoint(a.state.camera.center,l,k);f*=Math.tan(.5*a.state.camera.fov);h=5<l.distance(h)/f}h?(c=0,h=a.state.constraints.tilt(g),h.max=Math.min(h.max,.5*Math.PI),h=h.min*
(1-W)+h.max*W,d=v(a).eyeTiltToLookAtTilt(e,g,d),f=Math.min(d,h)):f=v(a).eyeTiltToLookAtTilt(e,g,d);d=f=a.state.constraints.clampTilt(g,f);d=v(a).lookAtTiltToEyeTilt(e,g,d);return{heading:c,tilt:d}}function O(a,c,d,g){a=u.vectorToPoint(c.eye,a.renderSpatialReference,a.spatialReference||b.WGS84);return a?g?(g.position=a,g.heading=c.heading,g.tilt=c.tilt,g.fov=d,g):new e(a,c.heading,c.tilt,d):null}function J(a){return a&&a.resolve&&a.reject}Object.defineProperty(f,"__esModule",{value:!0});var Q=d.getLogger("esri.views.3d.support.cameraUtils"),
H=p.vec3d.create(),K=p.vec3d.create(),R=p.vec3d.create(),P={heading:0,tilt:0},L=new c,T=new w.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),S;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(S=f.OrientationMode||(f.OrientationMode={}));f.headingTiltToDirectionUp=function(a,b,c,d,e){return v(a).headingTiltToDirectionUp(b,c,d,e)};f.externalToInternal=function(a,b){var c=a.renderSpatialReference,d=v(a).headingTiltToDirectionUp,e=p.vec3d.create();if(!u.pointToVector(b.position,e,c))return null;
c=d(e,b.heading,b.tilt);p.vec3d.add(c.direction,e);a=n.cameraOnContentAlongViewDirection(a,e,c.direction,c.up);a.fov=w.deg2rad(b.fov);return a};f.internalToExternal=z;f.scaleToDistance=y;f.distanceToScale=A;f.fromCenterScale=function(a,b,c,d,e,g){c=y(a,c,b.latitude);return B(a,b,c,d,e,g)};f.fromCenterDistance=B;f.directionToHeadingTilt=C;f.getObserverForPointAtDistance=N;f.fromExtent=function(a,d,e,g,f,k){var m,n=0;null!=d.zmax&&null!=d.zmin&&(m=(d.zmax+d.zmin)/2,n=d.zmax-d.zmin);var p,q;if("global"===
a.viewingMode){p=b.WebMercator;q=d.spatialReference||p;var r=new c(d.xmin,d.ymin,q),w=new c(d.xmax,d.ymax,q),r=l.project(r,p),w=l.project(w,p);if(null===r||null===w){J(k)&&k.reject();return}d=new c(T.center(r.x,w.x),(w.y+r.y)/2,p);null!=m&&(d.z=m);m=t.getGreatCircleSpanAt(d,r,w);p=m.lon;q=m.lat;T.diff(r.x,w.x)>T.range/2&&(p+=t.halfEarthCircumference);p=Math.min(p,t.halfEarthCircumference);q=Math.min(q,t.halfEarthCircumference)}else r=a.spatialReference||b.WGS84,l.canProject(d,r)&&(d=l.project(d,r)),
p=d.xmax-d.xmin,q=d.ymax-d.ymin,d=new c({x:d.xmin+.5*p,y:d.ymin+.5*q,z:m,spatialReference:r});m=a.state.camera;n=Math.max(1/Math.tan(m.fovX/2)*p*.5,1/Math.tan(m.fovY/2)*q*.5,1/Math.tan(m.fov/2)*n*.5)/1;if(J(k))m=h.createResolver(),N(a,e,g,d,n,f,m),m.promise.then(function(b){return k.resolve(O(a,b,a.camera.fov))});else return m={center:[],eye:[],up:[],tilt:0,heading:0},N(a,e,g,d,n,f,m),O(a,m,a.camera.fov,k)};f.toExtent=function(a,c,d,e,g){c||(d||(d=a.state.camera),c=z(a,d,g));g=a.renderSpatialReference;
var h;if(d)g=u.vectorToPoint(d.center,g,a.spatialReference||b.WGS84),h=d.distance;else{g=a.toMap(a.screenCenter);if(!g)return null;h=t.computeCarthesianDistance(c.position,g)}d||(d=a.state.camera);c=2*h*Math.tan(d.fovX/2)*1;d=2*h*Math.tan(d.fovY/2)*1;return"global"===a.viewingMode?r.toExtent(a,g,c,d,e):q.toExtent(a,g,c,d,e)};var W=.7;f.observerToCamera=O;f.scaleToZoom=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(b);Q.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};
f.zoomToScale=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(b);Q.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};f.scaleToResolution=function(b,c){return b.spatialReference?a.getResolutionForScale(c,b.spatialReference):void 0};f.computeScale=function(a,c,d){var e=a.renderSpatialReference;c||(c=a.state.camera);var g;g=b.WGS84;c instanceof x?(u.vectorToVector(c.center,e,K,g),g=K[1],c=c.distance):(g=c.position.latitude,u.pointToVector(c.position,
H,e),u.pointToVector(d,K,e),c=p.vec3d.dist(H,K));return A(a,c,g)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../geometry/Extent ../lib/gl-matrix ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),function(m,f,k,e,g,d,h){function c(c,h,f,k){void 0===k&&(k=g.createDirectionUp());e.mat4d.identity(l);c=k.direction;var m=k.up;e.mat4d.rotateZ(l,-d.deg2rad(h));e.mat4d.rotateX(l,d.deg2rad(f));e.mat4d.multiplyVec3(l,a,c);e.vec3d.scale(c,-1);e.mat4d.multiplyVec3(l,
b,m);return k}Object.defineProperty(f,"__esModule",{value:!0});var b=e.vec3d.createFrom(0,1,0),a=e.vec3d.createFrom(0,0,1),l=e.mat4d.create(),n=e.vec3d.create(),p=e.vec3d.create();f.headingTiltToDirectionUp=c;f.directionToHeadingTilt=function(c,d,e,h){return g.directionToHeadingTilt(d,e,h,a,b)};f.eyeForCenterWithHeadingTilt=function(a,b,d,g){var h=c(a,d,g);a=e.vec3d.add(e.vec3d.scale(h.direction,-b,e.vec3d.create()),a);return{up:h.up,eye:a,heading:d,tilt:g}};f.lookAtTiltToEyeTilt=function(a,b,c){return d.rad2deg(c)};
f.eyeTiltToLookAtTilt=function(a,b,c){return d.deg2rad(c)};f.toExtent=function(a,b,c,d,e){var g=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;h.pointToVector(b,n,g);h.pointToVector(b,p,g);n[0]-=c/2;p[0]+=c/2;n[1]-=d/2;p[1]+=d/2;h.vectorToVector(n,g,n,a);h.vectorToVector(p,g,p,a);e?(e.xmin=n[0],e.ymin=n[1],e.xmax=p[0],e.ymax=p[1],e.spatialReference=a):e=new k(n[0],n[1],p[0],p[1],a);return e}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports",
"../lib/gl-matrix","./mathUtils"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});var g=k.vec3d.create(),d=k.vec3d.create();f.createDirectionUp=function(){return{direction:k.vec3d.create(),up:k.vec3d.create()}};f.directionToHeadingTilt=function(h,c,b,a,f){var l=g;k.vec3d.normalize(h,l);var m=k.vec3d.dot(l,a),q=0<m,m=Math.abs(m);.99<m&&(m=Math.abs(k.vec3d.dot(c,a)),.99>m?(k.vec3d.set(c,l),q&&k.vec3d.scale(l,-1)):l=null);c=0;l&&(k.vec3d.scale(a,k.vec3d.dot(a,l),d),k.vec3d.subtract(l,
d),c=k.vec3d.dot(l,f)/(k.vec3d.length(l)*k.vec3d.length(f)),k.vec3d.cross(l,f,d),c=(0<k.vec3d.dot(d,a)?1:-1)*e.rad2deg(e.acos(c)));h=e.rad2deg(e.acos(-k.vec3d.dot(a,h)/k.vec3d.length(h)));return b?(b.heading=c,b.tilt=h,b):{heading:c,tilt:h}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../lib/gl-matrix ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(a,c,e,g){void 0===g&&(g=h.createDirectionUp());d.vec3d.cross(a,p,w);0===d.vec3d.dot(w,w)&&d.vec3d.cross(a,q,w);d.mat4d.identity(t);d.mat4d.rotate(t,-b.deg2rad(c),a);d.mat4d.rotate(t,-b.deg2rad(e),w);c=g.up;e=g.direction;d.vec3d.cross(w,a,c);d.vec3d.normalize(c);d.mat4d.multiplyVec3(t,c);d.vec3d.normalize(a,e);d.mat4d.multiplyVec3(t,d.vec3d.negate(e));return g}function l(a){var b=a[1];a[1]=-a[2];a[2]=b}function n(b,c){c=a(c,b.heading,b.tilt);b.up=c.up;return b}
Object.defineProperty(f,"__esModule",{value:!0});var p=d.vec3d.createFrom(0,0,1),q=d.vec3d.normalize(d.vec3d.createFrom(1,1,1)),r=new b.Cyclical(-180,180),t=d.mat4d.create(),w=d.vec3d.create(),u=d.vec3d.create();f.headingTiltToDirectionUp=a;f.directionToHeadingTilt=function(a,b,c,e){var g=w;d.vec3d.normalize(a,g);d.vec3d.cross(g,p,u);0===d.vec3d.dot(u,u)&&d.vec3d.cross(g,q,u);d.vec3d.cross(u,g,u);return h.directionToHeadingTilt(b,c,e,g,u)};f.eyeForCenterWithHeadingTilt=function(a,c,e,g){var h={eye:d.vec3d.create(),
up:null,tilt:g,heading:e},f=w;f[0]=a[0];f[1]=a[2];f[2]=-a[1];e=b.deg2rad(e);var k=b.deg2rad(g);g=Math.sin(e);e=Math.cos(e);var m=Math.sin(k),p=Math.cos(k),q=d.vec3d.length(f);if(1E-8>Math.abs(k))k=c+q;else var r=q/m,t=b.asin(c/r),k=r*Math.sin(Math.PI-k-t);var r=m*c,p=p*c,t=e*r,v=k-p,u=v*v,x=c*c*m*m,m=e*e*x,x=g*g*x,y=f[1]*v,z=m*(m+u-f[1]*f[1]);if(0>z)return d.vec3d.scale(f,k/q,h.eye),h.tilt=0,h;var H=Math.sqrt(z),z=m+u,y=0<e?-H+y:H+y;if(1E-8>Math.abs(z))return 1E-8>q?(h.eye[0]=0,h.eye[1]=0,h.eye[2]=
c):d.vec3d.scale(f,k/q,h.eye),h.tilt=0,l(h.eye),n(h,a);h.eye[1]=y/z;z=h.eye[1]*h.eye[1];c=1-z;y=Math.sqrt(c);t=m*z+x-2*t*h.eye[1]*y*v+c*u;if(1E-8>Math.abs(t))return d.vec3d.scale(f,k/q,h.eye),h.tilt=0,l(h.eye),n(h,a);h.eye[0]=(c*(k*f[0]-p*f[0])-r*y*(f[0]*h.eye[1]*e+f[2]*g))/t;h.eye[2]=(c*(k*f[2]-p*f[2])-r*y*(f[2]*h.eye[1]*e-f[0]*g))/t;d.vec3d.scale(h.eye,k);l(h.eye);return n(h,a)};f.lookAtTiltToEyeTilt=function(a,c,e){a=d.vec3d.length(a);c=b.asin(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-e))/Math.sin(e)));
return b.rad2deg(e-c)};f.eyeTiltToLookAtTilt=function(a,c,e){e=b.deg2rad(e);a=d.vec3d.length(a);return b.asin(c/(a/Math.sin(e)))+e};f.toExtent=function(a,d,h,f,l){function m(a){var c=Math.PI/2;a=b.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var n;n=d.latitude;d=d.longitude;var p=c.getLonDeltaForDistance(d,n,h)/2;h=d-p;d+=p;n=b.deg2rad(n);p=c.earthRadius;n=(1+Math.sin(n))/(1-Math.sin(n));var q=(n+1)*Math.tan(f/p/2);n=1.5*Math.PI-2*Math.atan(.5*(q+Math.sqrt(4*n+q*q)));f=n+f/p;n=m(n);f=m(f);
f<n&&(p=f,f=n,n=p);n=Math.max(b.rad2deg(n),-90);f=Math.min(b.rad2deg(f),90);d=r.monotonic(h,d);180<d-h&&(p=(d-h-180)/2,h+=p,d-=p);l?(l.xmin=h,l.ymin=n,l.xmax=d,l.ymax=f,l.spatialReference=e.WGS84):l=new k(h,n,d,f,e.WGS84);a.spatialReference&&a.spatialReference.isWebMercator&&g.geographicToWebMercator(l,!1,l);return l}})},"esri/views/navigation/gamepadUtils":function(){define(["require","exports","../3d/lib/gl-matrix"],function(m,f,k){function e(e){var d=e*e;0>e&&(d*=-1);return d}Object.defineProperty(f,
"__esModule",{value:!0});f.quadraticAccentuation=e;f.resetTransformation=function(e){e.translation[0]=0;e.translation[1]=0;e.translation[2]=0;e.heading=0;e.tilt=0;return e};f.extractTransformation=function(g,d,h){var c=g.state;g=g.device;d="forward-down"===d.tiltDirection?1:-1;"standard"===g.deviceType?(h.translation[0]=e(c.axes[0]),h.translation[1]=e(c.axes[1]),h.translation[2]=e(c.buttons[7])-e(c.buttons[6]),h.heading=e(c.axes[2]),h.tilt=e(c.axes[3])):"spacemouse"===g.deviceType&&(h.translation[0]=
1.2*e(c.axes[0]),h.translation[1]=1.2*e(c.axes[1]),h.translation[2]=2*-e(c.axes[2]),h.heading=1.2*e(c.axes[5]),h.tilt=1.2*e(c.axes[3]));h.tilt*=d;k.vec3d.scale(h.translation,1);return h};f.isZeroTransformation=function(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt}})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/global/PanContinuousController",
"../../../input/InputHandler"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function g(c,b,a){var g,h=d.call(this,!0)||this;h.view=c;h.keyToDirection=(g={},g[b.left]=e.Direction.LEFT,g[b.right]=e.Direction.RIGHT,g[b.forward]=e.Direction.FORWARD,g[b.backward]=e.Direction.BACKWARD,g[b.up]=e.Direction.UP,g[b.down]=e.Direction.DOWN,g);c.state.isGlobal&&(h.registerIncoming("key-down",a,function(a){return h.handleKeyDown(a)}),h.registerIncoming("key-up",a,function(a){return h.handleKeyUp(a)}));
return h}k(g,d);g.prototype.handleKeyDown=function(c){if(!c.data.repeat){var b=this.keyToDirection[c.data.key];null!=b&&(this.cameraController&&this.cameraController.active||(this.cameraController=new e.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(c,b,!0))}};g.prototype.handleKeyUp=function(c){var b=this.keyToDirection[c.data.key];null!=b&&this.cameraController&&this.cameraController.active&&this.handleKey(c,
b,!1)};g.prototype.handleKey=function(c,b,a){a?this.cameraController.addDirection(b):this.cameraController.removeDirection(b);c.stopPropagation()};return g}(g.InputHandler);f.KeyPan=m})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,
"__esModule",{value:!0});f.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};m=function(b){function a(a){var c=b.call(this)||this;c.view=a;c.directionStatus=0;c.direction=g.vec3d.create();c.tmpAxis=g.vec3d.create();c.radiusChange=0;c.velocity=0;c.tmpP1=g.vec3d.create();c.tmpTransf=g.mat4d.create();return c}k(a,b);Object.defineProperty(a.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});a.prototype.addDirection=function(a){0===this.directionStatus&&g.vec3d.set3(0,
0,0,this.direction);this.directionStatus&a||(this.directionStatus|=a,a&(f.Direction.LEFT|f.Direction.RIGHT|f.Direction.FORWARD|f.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),g.vec3d.add(this.direction,this.tmpAxis)):(a=this.directionStatus&(f.Direction.UP|f.Direction.DOWN),this.radiusChange=a===f.Direction.UP?1:a===f.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};a.prototype.removeDirection=function(a){this.directionStatus&=~a;0===this.directionStatus&&this.active?this.finishController():
a&(f.Direction.LEFT|f.Direction.RIGHT|f.Direction.FORWARD|f.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),g.vec3d.subtract(this.direction,this.tmpAxis),.01>g.vec3d.length(this.direction)&&g.vec3d.set3(0,0,0,this.direction)):(a=this.directionStatus&(f.Direction.UP|f.Direction.DOWN),this.radiusChange=a===f.Direction.UP?1:a===f.Direction.DOWN?-1:0)};a.prototype.stepController=function(a,c){b.prototype.stepController.call(this,a,c);a*=this.velocity;var d=!1;if(0<Math.abs(this.radiusChange)){var d=
1+a*this.radiusChange,h=c.viewForward,f=g.vec3d.normalize(c.center,this.tmpP1);(-.999<g.vec3d.dot(h,f)||0>this.radiusChange)&&g.vec3d.scale(c.center,d);g.vec3d.scale(c.eye,d);this.velocity=this.computePanVelocity();d=!0}.01<g.vec3d.length2(this.direction)&&(g.mat4d.identity(this.tmpTransf),g.mat4d.rotate(this.tmpTransf,a,this.direction),g.mat4d.multiplyVec3(this.tmpTransf,c.eye),g.mat4d.multiplyVec3(this.tmpTransf,c.center),g.mat4d.multiplyVec3(this.tmpTransf,c.up),d=!0);d&&e.applyAll(this.view,c,
{selection:14,interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,interactionDirection:null,tiltMode:0})};a.prototype.computePanAxis=function(a,b){var c=this.view.state.camera;g.vec3d.subtract(c.center,c.eye,b);g.vec3d.cross(b,c.up);if(a===f.Direction.LEFT||a===f.Direction.RIGHT)g.vec3d.normalize(b),g.vec3d.cross(b,c.center);a!==f.Direction.RIGHT&&a!==f.Direction.FORWARD||g.vec3d.negate(b);g.vec3d.normalize(b)};a.prototype.computePanVelocity=function(){var a=.5*
Math.abs(g.vec3d.length(this.view.state.camera.eye)-h.earthRadius),a=c.clamp(a,1,2*h.earthRadius);return c.acos(1-a*a/(2*h.earthRadius*h.earthRadius))};return a}(d.CameraController);f.PanContinuousController=m})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,
"__esModule",{value:!0});m=function(d){function c(b,a){var c=d.call(this,!0)||this;c.view=b;c.registerIncoming("mouse-wheel",a,function(a){return c.handleMouseWheel(a)});return c}k(c,d);c.prototype.handleMouseWheel=function(b){var a=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new e.ZoomStepController(this.view,"interaction"):new g.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));
this.cameraController.zoomStep(-1/60*a.deltaY,[a.x,this.view.height-a.y]);b.stopPropagation()};return c}(d.InputHandler);f.MouseWheelZoom=m})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",
{value:!0});m=function(c){function b(a,b,d){var e=c.call(this,!0)||this;e.view=a;e.pointerAction=b;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}k(b,c);b.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||h.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;this.controller&&
this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};b.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};b.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};b.prototype.createController=function(){return this.view.state.isGlobal?new e.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new g.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return b}(d.InputHandler);f.PinchAndPanNavigation=m})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/gl-matrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function f(a,b){var c=h.call(this)||this;c.view=a;c.intersectionHelper=b;c.smoothRotation=new g.ExponentialFalloff(.05);c.rotationAxis=d.vec3d.create();c.panningPlane={normal:d.vec3d.create(),d:0};c.smoothScaling=new g.ExponentialFalloff(.05);c.zoomCenterScreen=d.vec2d.create();c.zoomMomentumEstimator=new x.ZoomMomentumEstimator;c.rotationMomentumEstimator=new u.RotationMomentumEstimator;
c.panSphericalMomentumEstimator=new w.PanSphericalMomentumEstimator;c.panPlanarMomentumEstimator=new t.PanPlanarMomentumEstimator;c.adjustedSphere={center:d.vec3d.create(),radius:0};c.tmp2d=d.vec2d.create();c.tmp3d=d.vec3d.create();c.tmpMat=d.mat4d.create();c.beginScreenPoint=d.vec2d.create();c.beginScenePoint=d.vec3d.create();c.screenPickPoint=d.vec2d.create();c.panMode=q.PanMode.Horizontal;c.tmpInteractionDirection=d.vec3d.create();c.constraintOptions={selection:15,interactionType:0,interactionFactor:0,
interactionStartCamera:new r,interactionDirection:null,tiltMode:0};return c}k(f,h);f.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();p.navPointToScreenPoint(this.currentCamera,a.center,this.screenPickPoint);d.vec2d.set(this.screenPickPoint,this.beginScreenPoint);var b=p.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=b.scenePickPoint;
this.sphere=b.sphere;d.vec3d.set(this.scenePickPoint,this.beginScenePoint);this.panMode=p.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===q.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};f.prototype.preparePlanarPanModeOverground=function(a){d.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);d.vec3d.normalize(this.panningPlane.normal);
d.vec3d.negate(this.panningPlane.normal);p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);var b=d.vec3d.create();d.vec3d.set3(this.screenPickPoint[0],this.currentCamera.fullHeight,0,b);var c=d.vec3d.create(),e=d.vec3d.length(this.beginCamera.eye);this.adjustedSphere.radius=e<this.sphere.radius?e-100:this.sphere.radius;p.sphereOrSilhouettePointFromScreenPoint(this.adjustedSphere,this.beginCamera,b,c);this.beginCamera.projectPoint(c,b);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],
.9*b[1]);this.intersectionHelper.pickPointInScreen(this.screenPickPoint,this.scenePickPoint)&&p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)};f.prototype.preparePlanarPanMode=function(a){d.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);d.vec3d.normalize(this.panningPlane.normal);d.vec3d.negate(this.panningPlane.normal);
p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);var b=p.computeHorizonSphereCapAngle(this.sphere,this.currentCamera.eye),c=this.tmp3d,b=-p.rotationAndAxisFromPoints(this.currentCamera.eye,this.scenePickPoint,c)-(this.currentCamera.aboveGround?.25:.025)*b;if(0<b){var e=d.mat4d.identity(this.tmpMat);d.mat4d.rotate(e,-b,c);d.vec3d.subtract(this.scenePickPoint,this.sphere.center);d.mat4d.multiplyVec3(e,this.scenePickPoint,this.scenePickPoint);d.vec3d.add(this.scenePickPoint,
this.sphere.center);p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)}};f.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===q.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),
this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};f.prototype.end=function(d){d.pointers.size===this.pointerCount&&this.update(d);this.finishController();if(d=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===q.PanMode.Horizontal?new n.ZoomSphericalMomentumController(this.view,d,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new l.ZoomPlanarMomentumController(this.view,d,this.beginScenePoint);if(d=this.rotationMomentumEstimator.evaluateMomentum())return new a.RotationMomentumController(this.view,
d,this.sphere.center,this.rotationAxis);if(this.panMode===q.PanMode.Horizontal){if(d=this.panSphericalMomentumEstimator.evaluateMomentum())return new b.PanSphericalMomentumController(this.view,d)}else if(d=this.panPlanarMomentumEstimator.evaluateMomentum())return new c.PanPlanarMomentumController(this.view,d);return null};f.prototype.zoomSpherical=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);p.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);p.navPointToScreenPoint(this.currentCamera,a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);e.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.panningSpherical=function(a){p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);
p.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.tmp2d,this.tmp3d);p.applyPanSpherical(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d);this.panSphericalMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(this.screenPickPoint,this.tmp2d);e.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.rotateSpherical=
function(a){d.vec3d.normalize(this.scenePickPoint,this.rotationAxis);var b=this.smoothRotation.value,c=p.normalizeRotationDelta(a.angle-b),b=b+c;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b);c=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*a.timestamp);p.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,c);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(a.radius*
b);e.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.panningPlanar=function(a){p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(p.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(this.beginScreenPoint,
this.tmp2d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),e.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};f.prototype.zoomPlanar=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);
p.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);e.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.rotatePlanar=function(a){d.vec3d.set(this.beginScenePoint,this.rotationAxis);var b=this.smoothRotation.value,c=a.angle-b,c=p.normalizeRotationDelta(c);
this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b+c);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*a.timestamp);p.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,b);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(a.radius*b);e.applyAll(this.view,this.currentCamera,this.constraintOptions)};return f}(h.InteractiveController);
f.PinchAndPanController=m})},"esri/views/3d/input/util":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e){this._gain=e}f.prototype.reset=function(e){this._value=e};Object.defineProperty(f.prototype,"gain",{set:function(e){this._gain=e},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});f.prototype.update=function(e){this._value=
void 0===this._value?e:this._gain*e+(1-this._gain)*this._value};return f}();f.ExponentialFalloff=m})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/gl-matrix","./MomentumController"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function g(c,b){c=d.call(this,c,4)||this;c.momentum=b;c.tmpPan=e.vec3d.create();return c}k(g,d);g.prototype.momentumStep=
function(c,b){c=this.momentum.value(c);e.vec3d.scale(this.momentum.direction,c,this.tmpPan);e.vec3d.subtract(b.eye,this.tmpPan);e.vec3d.subtract(b.center,this.tmpPan);b.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return g}(g.MomentumController);f.PanPlanarMomentumController=m})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(b,a){a=g.call(this)||this;a.view=b;a.beginCamera=new d;a.elapsedTimeSec=0;a.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new d,interactionDirection:null,tiltMode:0};return a}k(c,g);Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});c.prototype.onControllerStart=
function(b){this.beginCamera.copyFrom(b);this.constraintOptions.interactionStartCamera=this.beginCamera;g.prototype.onControllerStart.call(this,b)};c.prototype.stepController=function(b,a){a.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=b;this.momentumStep(this.elapsedTimeSec,a);e.applyAll(this.view,a,this.constraintOptions)};return c}(g.AnimationController);f.MomentumController=m})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define(["require","exports",
"../../../../../core/tsSupport/extendsHelper","./MomentumController","../../utils/navigationUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=[0,0,0];m=function(e){function c(b,a){b=e.call(this,b,4)||this;b.momentum=a;return b}k(c,e);c.prototype.momentumStep=function(b,a){b=this.momentum.value(b);g.applyRotation(a,d,this.momentum.axis,b)};return c}(e.MomentumController);f.PanSphericalMomentumController=m})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(b,a,c,d){b=g.call(this,b,2)||this;b.momentum=a;b.axis=e.vec3d.create();b.center=e.vec3d.create();e.vec3d.set(d,b.axis);e.vec3d.set(c,b.center);return b}k(c,g);c.prototype.momentumStep=function(b,a){b=this.momentum.value(b);d.applyRotation(a,this.center,this.axis,b)};return c}(g.MomentumController);f.RotationMomentumController=m})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(b,a,c){b=g.call(this,b,1)||this;b.momentum=a;b.zoomCenter=e.vec3d.create();e.vec3d.set(c,b.zoomCenter);b.constraintOptions.interactionDirection=e.vec3d.create();return b}k(c,g);c.prototype.momentumStep=function(b,a){e.vec3d.set(a.eye,this.constraintOptions.interactionDirection);b=this.momentum.valueDelta(0,b);d.applyZoomToPoint(a,this.zoomCenter,b,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=
e.vec3d.direction(this.constraintOptions.interactionDirection,a.eye)};return c}(g.MomentumController);f.ZoomPlanarMomentumController=m})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(a,
b,d,e,h){a=c.call(this,a,1)||this;a.momentum=b;a.screenCenter=g.vec2d.create();a.sceneCenter=g.vec3d.create();a.tmpSceneCenter=g.vec3d.create();a.tmpZoomAxis=g.vec3d.create();a.sphere={center:g.vec3d.create(),radius:0};g.vec2d.set(d,a.screenCenter);g.vec3d.set(e,a.sceneCenter);a.sphere.radius=h;return a}k(b,c);b.prototype.momentumStep=function(a,b){a=this.momentum.valueDelta(0,a);h.applyZoomOnSphere(this.sphere,b,a);this.constraintOptions.interactionType=1;e.applyAll(this.view,b,this.constraintOptions);
h.sphereOrSilhouettePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);a=h.rotationAndAxisFromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxis);h.applyRotation(b,this.sphere.center,this.tmpZoomAxis,a);this.constraintOptions.interactionType=4};return b}(d.MomentumController);f.ZoomSphericalMomentumController=m})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/gl-matrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});var h=function(c){function b(a,b,d,e,g){a=c.call(this,a,b,d)||this;a.sceneVelocity=e;a.direction=g;return a}k(b,c);b.prototype.value=function(a){return c.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,a)};return b}(d.Momentum);f.PanPlanarMomentum=h;m=function(){function c(b,a,c){void 0===b&&(b=300);void 0===a&&(a=12);void 0===c&&(c=.84);this.minimumInitialVelocity=b;this.stopVelocity=a;this.friction=c;this.time=
new g.FilteredFiniteDifference(.6);this.screen=[new g.FilteredFiniteDifference(.4),new g.FilteredFiniteDifference(.4)];this.scene=[new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6)];this.tmpDirection=e.vec3d.create()}c.prototype.add=function(b,a,c){this.time.hasLastValue&&.015>this.time.computeDelta(c)||(this.screen[0].update(b[0]),this.screen[1].update(b[1]),this.scene[0].update(a[0]),this.scene[1].update(a[1]),this.scene[2].update(a[2]),this.time.update(c))};
c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var b=this.screen[0].filteredDelta,a=this.screen[1].filteredDelta,b=Math.sqrt(b*b+a*a)/this.time.filteredDelta;return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};c.prototype.createMomentum=function(b,
a,c){e.vec3d.set3(this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta,this.tmpDirection);var d=e.vec3d.length(this.tmpDirection);0<d&&e.vec3d.scale(this.tmpDirection,1/d);return new h(b,a,c,d/this.time.filteredDelta,this.tmpDirection)};return c}();f.PanPlanarMomentumEstimator=m})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e){this.gain=
e}f.prototype.update=function(e){if(this.hasLastValue){var g=this.computeDelta(e);this.updateDelta(g)}this.lastValue=e};f.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(f.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});f.prototype.computeDelta=function(e){return e-
this.lastValue};f.prototype.updateDelta=function(e){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*e:e};return f}();f.FilteredFiniteDifference=m})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d,h){this._initialVelocity=e;this._stopVelocity=d;this._friction=h;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});e.prototype.isFinished=function(e){return e>this.duration};Object.defineProperty(e.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});e.prototype.value=function(e){return this.valueFromInitialVelocity(this._initialVelocity,e)};e.prototype.valueDelta=function(e,d){var g=this.value(e);return this.value(e+
d)-g};e.prototype.valueFromInitialVelocity=function(e,d){d=Math.min(d,this.duration);var g=1-this.friction;return e*(Math.pow(g,d)-1)/Math.log(g)};return e}();f.Momentum=m})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/gl-matrix ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){function b(b,
c,d,e,g){b=a.call(this,b,c,d)||this;b.angularVelocity=e;b.axis=g;return b}k(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity,b)};return b}(c.Momentum);f.PanSphericalMomentum=b;m=function(){function a(a,b,c){void 0===a&&(a=300);void 0===b&&(b=12);void 0===c&&(c=.84);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=c;this.tmpAxis=e.vec3d.create();this.time=new d.FilteredFiniteDifference(.3);this.screen=[new d.FilteredFiniteDifference(.4),
new d.FilteredFiniteDifference(.4)];this.angle=new h.FilteredValue(.6);this.axis=e.vec3d.create();this.lastScene=e.vec3d.create()}a.prototype.add=function(a,b,c){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;var d=g.rotationAndAxisFromPoints(this.lastScene,b,this.tmpAxis);1E-5>e.vec3d.length2(this.tmpAxis)?d=0:e.vec3d.normalize(this.tmpAxis,this.axis);this.angle.update(d);e.vec3d.set(b,this.lastScene)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(c)};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,c,d){return new b(a,c,d,this.angle.filteredValue/
this.time.filteredDelta,this.axis)};return a}();f.PanSphericalMomentumEstimator=m})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e){this.gain=e}f.prototype.update=function(e){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*e:e};f.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(f.prototype,"hasFilteredValue",{get:function(){return void 0!==
this.filteredValue},enumerable:!0,configurable:!0});return f}();f.FilteredValue=m})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(d,c,b,a){void 0===d&&(d=3);void 0===c&&(c=.01);void 0===b&&(b=.95);void 0===a&&(a=12);return e.call(this,d,c,b,a)||this}k(d,e);d.prototype.add=function(d,c){if(this.value.hasLastValue){var b=
this.value.lastValue;for(d-=b;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=b+d}e.prototype.add.call(this,d,c)};return d}(e.MomentumEstimator);f.RotationMomentumEstimator=m})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function h(c,b,a,d){void 0===c&&(c=2.5);void 0===
b&&(b=.01);void 0===a&&(a=.95);void 0===d&&(d=12);this.minimumInitialVelocity=c;this.stopVelocity=b;this.friction=a;this.maxVelocity=d;this.value=new g.FilteredFiniteDifference(.8);this.time=new g.FilteredFiniteDifference(.3)}h.prototype.add=function(c,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var a=this.value.computeDelta(c);0>this.value.filteredDelta*a&&this.value.reset()}}this.time.update(b);this.value.update(c)};h.prototype.reset=function(){this.value.reset();
this.time.reset()};h.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var c=this.value.filteredDelta/this.time.filteredDelta,c=e.clamp(c,-this.maxVelocity,this.maxVelocity);return Math.abs(c)<this.minimumInitialVelocity?null:this.createMomentum(c,this.stopVelocity,this.friction)};h.prototype.createMomentum=function(c,b,a){return new d.Momentum(c,b,a)};return h}();f.MomentumEstimator=m})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports",
"../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){function c(b,a,c){return d.call(this,b,a,c)||this}k(c,d);c.prototype.value=function(b){b=d.prototype.value.call(this,b);return Math.exp(b)};c.prototype.valueDelta=function(b,a){var c=d.prototype.value.call(this,b);b=d.prototype.value.call(this,b+a);return Math.exp(b-c)};return c}(e.Momentum);f.ZoomMomentum=d;m=function(e){function c(b,a,c,
d){void 0===b&&(b=2.5);void 0===a&&(a=.01);void 0===c&&(c=.95);void 0===d&&(d=12);return e.call(this,b,a,c,d)||this}k(c,e);c.prototype.add=function(b,a){e.prototype.add.call(this,Math.log(b),a)};c.prototype.createMomentum=function(b,a,c){return new d(b,a,c)};return c}(g.MomentumEstimator);f.ZoomMomentumEstimator=m})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/gl-matrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){Object.defineProperty(f,"__esModule",{value:!0});var t;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(t=f.PanMode||(f.PanMode={}));var w=d.vec3d.createFrom(0,0,1),u=16/180*Math.PI;m=function(h){function f(a,b){var c=h.call(this)||this;c.view=a;c.intersectionHelper=b;c.rotationValueSmooth=new g.ExponentialFalloff(.05);c.scalingValueSmooth=new g.ExponentialFalloff(.05);c.planeHorizontal={normal:d.vec3d.create(),d:0};c.planeVertical={normal:d.vec3d.create(),
d:0};c.rotationMomentumEstimator=new q.RotationMomentumEstimator;c.panMomentumEstimator=new p.PanPlanarMomentumEstimator(300,12,.9);c.zoomMomentumEstimator=new r.ZoomMomentumEstimator;c.beginCenter=d.vec3d.create();c.tmpPoints=[];c.beginCenterScreen=d.vec2d.create();c.tmpCentroid3d=d.vec3d.create();c.tmpCentroid2d=d.vec2d.create();c.tmp2d=d.vec2d.create();c.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new n,interactionDirection:null,tiltMode:0};return c}
k(f,h);f.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();l.navPointToScreenPoint(this.beginCamera,a.center,this.beginCenterScreen);this.planeHorizontal.d=0;d.vec3d.set(w,this.planeHorizontal.normal);var b=d.vec3d.create();this.intersectionHelper.pickPointInScreen(this.beginCenterScreen,b)||this.intersectionHelper.pickFreePointInScreen(this.beginCenterScreen,
b);var c=d.vec3d.create();d.vec3d.negate(this.beginCamera.viewForward,c);var e=d.vec3d.create();d.vec3d.set(w,e);var g=d.vec3d.dot(c,e);this.panMode=Math.asin(0>g?-g:g)>=u?t.Horizontal:t.Vertical;l.setPlaneD(b,this.planeHorizontal);0>d.vec3d.dot(this.planeHorizontal.normal,this.beginCamera.eye)+this.planeHorizontal.d&&(d.vec3d.negate(this.planeHorizontal.normal),this.planeHorizontal.d*=-1);this.panMode===t.Vertical?(d.vec3d.scale(e,g),d.vec3d.subtract(c,e,this.planeVertical.normal),d.vec3d.normalize(this.planeVertical.normal),
l.setPlaneD(b,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);l.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};f.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size,c=this.panMode===t.Horizontal?this.planeHorizontal:this.planeVertical,
d=this.beginCenter;if(b){var g=this.beginRadius/a.radius,h=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=h;this.scalingValueSmooth.update(g);l.applyZoomToPoint(this.currentCamera,d,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));
e.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,c,this.currentCamera,this.tmpPoints);l.centroid(this.tmpPoints,this.tmpCentroid3d);l.navPointToScreenPoint(this.currentCamera,a.center,this.tmpCentroid2d);l.applyPanPlanar(this.currentCamera,d,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=e.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);e.applyAll(this.view,this.currentCamera,this.constraintOptions);b&&(b=this.planeHorizontal.normal,c=this.rotationValueSmooth.value,g=l.normalizeRotationDelta(a.angle-c),h=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=h,this.rotationValueSmooth.update(c+g),h=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(h,.001*a.timestamp),l.applyRotation(this.currentCamera,d,b,h),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
e.pixelDistanceToInteractionFactor(Math.abs(a.radius*h)),e.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};f.prototype.end=function(d){d.pointers.size===this.pointerCount&&this.update(d);this.finishController();return(d=this.zoomMomentumEstimator.evaluateMomentum())?new a.ZoomPlanarMomentumController(this.view,d,this.beginCenter):(d=this.rotationMomentumEstimator.evaluateMomentum())?new b.RotationMomentumController(this.view,d,this.beginCenter,this.planeHorizontal.normal):
(d=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,d):null};f.prototype.computePlanePoints=function(a,b,c,e){e.length=a.size;var g=this.tmp2d,h=0;a.forEach(function(a){l.navPointToScreenPoint(c,a,g);void 0===e[h]&&(e[h]=d.vec3d.create());l.intersectPlaneFromScreenPoint(b,c,g,e[h]);h+=1});return e};return f}(h.InteractiveController);f.PinchAndPanController=m})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports",
"../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(d,c){var b=e.call(this,!0)||this;b.view=d;b.registerIncoming("pointer-down",c,function(a){return b.view.state.stopActiveCameraController()});return b}k(d,e);return d}(e.InputHandler);f.PointerDownCancelAnimation=m})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(d,c,b){b=e.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",c,b)||this;b.view=d;b.key=c;return b}k(d,e);d.prototype.activate=function(){this.view.goTo({heading:0})};return d}(e.SingleKey);f.SingleKeyResetHeading=m})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(m,
f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(d,c,b){var a=e.call(this,!0)||this;a.key=c;a.registerIncoming("key-down",b,function(b){return a._handleKeyDown(b)});return a}k(d,e);d.prototype._handleKeyDown=function(d){d.data.key===this.key&&(this.activate(),d.stopPropagation())};return d}(e.InputHandler);f.SingleKey=m})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(d,c,b){b=e.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",c,b)||this;b.view=d;b.key=c;return b}k(d,e);d.prototype.activate=function(){this.view.goTo({tilt:0})};return d}(e.SingleKey);f.SingleKeyResetTilt=m})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/RotateController","../../../input/InputHandler"],
function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function g(c,b){void 0===b&&(b=!1);var a=d.call(this,!0)||this;a.view=c;a.invert=b;a.registerIncoming("vertical-two-finger-drag",function(b){return a.handleTwoFinger(b)});return a}k(g,d);g.prototype.handleTwoFinger=function(c){var b=[0,-c.data.delta*(this.invert?-1:1)];switch(c.data.action){case "begin":this.cameraController=new e.RotateController(this.view,this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(b);break;case "update":this.cameraController.update(b);break;case "end":this.cameraController.end(),this.cameraController=null}};return g}(g.InputHandler);f.TwoFingerTilt=m})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});var h=k("trident"),c=k("edge"),b=k("chrome"),a=k("ff"),l=k("safari");m=
function(){function f(a,b){var c=this;this.input=b;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=a;e.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=a.style.touchAction;a.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new d.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return c._callback("gamepad",a)}}f.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});
this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(f.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(n[c],
this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&n[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(n[a],c);b._active[a]=c}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});f.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):("pointerup"!==a.type&&this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};
f.prototype._updateNormalizedPointerLikeEvent=function(a,b){var c=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(c.left);b.y=a.clientY-Math.round(c.top);return b};f.prototype._handleKey=function(a,b){var c=g.eventKey(b);c&&"key-up"===a&&this._keyDownState.delete(c);b={native:b,key:c,repeat:c&&this._keyDownState.has(c)};c&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};f.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,
x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});this._callback(a,b)};f.prototype._handlePointerPreventDefault=function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});b.preventDefault();this._callback(a,c)};f.prototype._handleMouseWheel=function(d,e){e.preventDefault();var g=e.deltaY;switch(e.deltaMode){case 0:if(h||c)g=g/document.documentElement.clientHeight*600;break;case 1:g*=30;break;case 2:g*=
900}h||c?g*=.7:b||l?g*=.6:a&&(g*=1.375);var f=Math.abs(g);100<f&&(g=g/f*200/(1+Math.exp(-.02*(f-100))));e=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,deltaY:g});this._callback(d,e)};f.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};f.prototype._handleDefault=function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};f.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};
return f}();f.BrowserEventSource=m;var n={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel"}})},"esri/core/libs/pep/pep":function(){define(function(){function m(b,c){c=c||Object.create(null);var d=document.createEvent("Event");
d.initEvent(b,c.bubbles||!1,c.cancelable||!1);b=2;for(var e;b<a.length;b++)e=a[b],d[e]=c[e]||l[b];d.buttons=c.buttons||0;b=0;b=c.pressure?c.pressure:d.buttons?.5:0;d.x=d.clientX;d.y=d.clientY;d.pointerId=c.pointerId||0;d.width=c.width||0;d.height=c.height||0;d.pressure=b;d.tiltX=c.tiltX||0;d.tiltY=c.tiltY||0;d.pointerType=c.pointerType||"";d.hwTimestamp=c.hwTimestamp||0;d.isPrimary=c.isPrimary||!1;return d}function f(){this.array=[];this.size=0}function k(a,b,c,d){this.addCallback=a.bind(d);this.removeCallback=
b.bind(d);this.changedCallback=c.bind(d);A&&(this.observer=new A(this.mutationWatcher.bind(this)))}function e(a){return"body /shadow-deep/ "+g(a)}function g(a){return'[touch-action\x3d"'+a+'"]'}function d(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function h(){if(D){C.forEach(function(a){String(a)===a?(E+=g(a)+d(a)+"\n",F&&(E+=e(a)+d(a)+"\n")):(E+=a.selectors.map(g)+d(a.rule)+"\n",F&&(E+=a.selectors.map(e)+d(a.rule)+"\n"))});var a=document.createElement("style");
a.textContent=E;document.head.appendChild(a)}}function c(a){if(!w.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function b(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var a="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),l=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],n=window.Map&&window.Map.prototype.forEach?Map:
f;f.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
q=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],r={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},t="undefined"!==typeof SVGElementInstance,w={pointermap:new n,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b.events;c&&(c.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=
this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,a)},contains:function(a,b){try{return a.contains(b)}catch(U){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&
this.eventMap[b])&&b(a);a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new m(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},
fireEvent:function(a,b){a=this.makeEvent(a,b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),c,d=0;d<p.length;d++)c=p[d],b[c]=a[c]||q[d],t&&("target"===c||"relatedTarget"===c)&&b[c]instanceof SVGElementInstance&&(b[c]=b[c].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in r))return b},propagate:function(a,
b,c){for(var d=a.target,e=[];!d.contains(a.relatedTarget)&&d!==document;)e.push(d),d=d.parentNode;c&&e.reverse();e.forEach(function(c){a.target=c;b.call(this,a)},this)},setCapture:function(a,b){this.captureInfo[a]&&this.releaseCapture(a);this.captureInfo[a]=b;var c=new m("gotpointercapture");c.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)},
releaseCapture:function(a){var b=this.captureInfo[a];if(b){var c=new m("lostpointercapture");c.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};w.boundHandler=w.eventHandler.bind(w);
var u={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,c){if(a){var d=a.elementFromPoint(b,c),e;for(e=this.targetingShadow(d);e;){if(a=
e.elementFromPoint(b,c))return d=this.targetingShadow(a),this.searchRoot(d,b,c)||a;e=this.olderShadow(e)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,c=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,c)||(a=document);return this.searchRoot(a,b,c)}},x=Array.prototype.forEach.call.bind(Array.prototype.forEach),v=Array.prototype.map.call.bind(Array.prototype.map),
z=Array.prototype.slice.call.bind(Array.prototype.slice),y=Array.prototype.filter.call.bind(Array.prototype.filter),A=window.MutationObserver||window.WebKitMutationObserver,B={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};k.prototype={watchSubtree:function(a){this.observer&&u.canTarget(a)&&this.observer.observe(a,B)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},
installNewSubtree:function(a){x(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(z(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},
isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=v(a,this.findElements,this);b.push(y(a,this.isElement));return b.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,
a.oldValue)}};var C=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],E="",D=window.PointerEvent||window.MSPointerEvent,F=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,M=w.pointermap,N=[1,4,2,8,16],I=!1;try{I=1===(new MouseEvent("test",{buttons:1})).buttons}catch(X){}var G={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){w.listen(a,this.events)},unregister:function(a){w.unlisten(a,
this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,e=b.length,g;d<e&&(g=b[d]);d++){var h=Math.abs(a-g.y);if(25>=Math.abs(c-g.x)&&25>=h)return!0}},prepareEvent:function(a){var b=w.cloneEvent(a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,b){var c=M.get(this.POINTER_ID);a.buttons=0!==
b.which&&c?c.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=M.get(this.POINTER_ID),c=this.prepareEvent(a);I||(c.buttons=N[c.button],b&&(c.buttons|=b.buttons),a.buttons=c.buttons);M.set(this.POINTER_ID,a);b&&0!==b.buttons?w.move(c):w.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);I||this.prepareButtonsForMove(b,a);b.button=-1;M.set(this.POINTER_ID,a);w.move(b)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=
M.get(this.POINTER_ID),c=this.prepareEvent(a);if(!I){var d=N[c.button];c.buttons=b?b.buttons&~d:0;a.buttons=c.buttons}M.set(this.POINTER_ID,a);c.buttons&=~N[c.button];0===c.buttons?w.up(c):w.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);I||this.prepareButtonsForMove(b,a);b.button=-1;M.set(this.POINTER_ID,a);w.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);I||this.prepareButtonsForMove(b,a);b.button=
-1;w.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);w.cancel(a);this.deactivateMouse()},deactivateMouse:function(){M.delete(this.POINTER_ID)}},O=w.captureInfo,J=u.findTarget.bind(u),Q=u.allShadows.bind(u),H=w.pointermap,K,R={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){K.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);c&&(a._scrollType=c,w.listen(a,this.events),
Q(a).forEach(function(a){a._scrollType=c;w.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;w.unlisten(a,this.events);Q(a).forEach(function(a){a._scrollType=void 0;w.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);b=this.touchActionToScrollType(b);d&&b?(a._scrollType=d,Q(a).forEach(function(a){a._scrollType=d},this)):b?this.elementRemoved(a):d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",
XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===H.size||1===H.size&&H.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=
!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,
c=w.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=O[d]||J(c);c.bubbles=!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(b.type);c.width=a.radiusX||a.webkitRadiusX||0;c.height=a.radiusY||a.webkitRadiusY||0;c.pressure=a.force||a.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(a);c.pointerType=this.POINTER_TYPE;c.altKey=b.altKey;c.ctrlKey=b.ctrlKey;c.metaKey=b.metaKey;c.shiftKey=b.shiftKey;var e=this;c.preventDefault=function(){e.scrolling=!1;e.firstXY=null;b.preventDefault()};
return c},processTouches:function(a,b){var c=a.changedTouches;this.currentTouchEvent=a;a=0;for(var d;a<c.length;a++)d=c[a],b.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var b;b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var c="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+c]-this.firstXY[c])}this.firstXY=null;return b}},findTouch:function(a,b){for(var c=0,d=a.length,e;c<d&&(e=a[c]);c++)if(e.identifier===
b)return!0},vacuumTouches:function(a){var b=a.touches;if(H.size>=b.length){var c=[];H.forEach(function(a,d){1===d||this.findTouch(b,d-2)||c.push(a.out)},this);c.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){H.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});w.enterOver(a);w.down(a)},touchmove:function(a){this.scrolling||
(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=H.get(a.pointerId);if(b){var c=b.out,d=b.outTarget;w.move(a);c&&d!==a.target&&(c.relatedTarget=a.target,a.relatedTarget=d,c.target=d,a.target?(w.leaveOut(c),w.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||
(w.up(a),w.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){w.cancel(a);w.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){H.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=G.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};K=new k(R.elementAdded,
R.elementRemoved,R.elementChanged,R);var P=w.pointermap,L=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,T={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){w.listen(a,this.events)},unregister:function(a){w.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;L&&(b=w.cloneEvent(a),b.pointerType=
this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){P.delete(a)},MSPointerDown:function(a){P.set(a.pointerId,a);a=this.prepareEvent(a);w.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);w.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);w.up(b);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);w.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);w.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);w.cancel(b);this.cleanup(a.pointerId)},
MSLostPointerCapture:function(a){a=w.makeEvent("lostpointercapture",a);w.dispatchEvent(a)},MSGotPointerCapture:function(a){a=w.makeEvent("gotpointercapture",a);w.dispatchEvent(a)}},S,W;window.navigator.msPointerEnabled?(S=function(a){c(a);b(this);0!==w.pointermap.get(a).buttons&&this.msSetPointerCapture(a)},W=function(a){c(a);this.msReleasePointerCapture(a)}):(S=function(a){c(a);b(this);0!==w.pointermap.get(a).buttons&&w.setCapture(a,this)},W=function(a){c(a);w.releaseCapture(a,this)});var Y=window.PointerEvent||
window.MSPointerEvent;return{dispatcher:w,Installer:k,PointerEvent:m,PointerMap:n,targetFinding:u,applyGlobal:function(){h();window.PointerEvent||(window.PointerEvent=m,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),w.registerSource("ms",T)):(w.registerSource("mouse",G),void 0!==window.ontouchstart&&w.registerSource("touch",R)),w.register(document));window.Element&&!Element.prototype.setPointerCapture&&
Object.defineProperties(Element.prototype,{setPointerCapture:{value:S},releasePointerCapture:{value:W}})},applyLocal:function(a){Y||(window.PointerEvent||(window.navigator.msPointerEnabled?w.registerSource("ms",T):(w.registerSource("mouse",G),void 0!==window.ontouchstart&&w.registerSource("touch",R)),w.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=S.bind(a),a.releasePointerCapture=W.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action",
"none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/has"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.primaryKey=k("mac")?"Meta":"Ctrl";var e={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(m=48;58>m;m++)e[m]=String.fromCharCode(m);for(m=1;25>m;m++)e[111+m]="F"+m;for(m=65;91>m;m++)e[m]=[String.fromCharCode(m+
32),String.fromCharCode(m)];var g={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};f.eventKey=function(d){if(void 0!==d.key)return g[d.key]||d.key;var h=e[d.keyCode];return Array.isArray(h)?d.shiftKey?h[1]:h[0]:h};f.isSystemModifier=function(d){switch(d){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function h(c,b){var a=this;this.element=c;this.input=b;this.handleGamepadConnectedEvent=function(b){a.handleGamepadConnected(b.gamepad)};this.handleGamepadDisconnectedEvent=function(b){b=b.gamepad;var c=a.inputDevices[b.index];c&&(a.emitGamepadEvent(b,d.extractState(c),!1),a.inputDevices[b.index]=void 0,a.latestUpdate[b.index]=void 0,a.input.gamepad.devices.remove(c))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=
[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(b){return a.handleGamepadConnected(b)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}h.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",
this.handleGamepadDisconnectedEvent))};Object.defineProperty(h.prototype,"onEvent",{set:function(c){this.callback=c},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"pollingEnabled",{set:function(c){this.supported&&(c?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});h.prototype.handleGamepadConnected=function(c){var b=new g(c);"unknown"!==b.deviceType&&(this.inputDevices[c.index]=b,this.input.gamepad.devices.add(b))};h.prototype.startPolling=function(){var c=
this;null==this.frameTask&&(this.frameTask=e.addFrameTask({update:function(){return c.readGamepadState()}}))};h.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};h.prototype.readGamepadState=function(){var c=this,b=!document.hasFocus||document.hasFocus(),a=this.element.contains(document.activeElement),e="document"===this.input.gamepad.enabledFocusMode&&!b||"view"===this.input.gamepad.enabledFocusMode&&!a;this.forEachGamepad(function(a){var b=
c.inputDevices[a.index];if(b){var g=c.latestUpdate[a.index],b=d.extractState(b),h=e||d.stateIdle(b);g&&(g.timestamp===a.timestamp||!g.active&&h||d.stateEqual(g.state,b))||c.emitGamepadEvent(a,b,!h)}})};h.prototype.forEachGamepad=function(c){for(var b=window.navigator.getGamepads(),a=0;a<b.length;a++){var d=b[a];this.validate(d)&&c(d)}};h.prototype.emitGamepadEvent=function(c,b,a){var d=this.latestUpdate[c.index];if((d=d&&d.active)||a)this.latestUpdate[c.index]={timestamp:c.timestamp,state:b,active:a},
this.callback&&this.callback({device:this.inputDevices[c.index],state:b,action:!d&&a?"start":d&&a?"update":"end"})};h.prototype.validate=function(c){if(!c||!c.connected)return!1;for(var b=0;b<c.axes.length;b++)if(isNaN(c.axes[b]))return!1;return!0};return h}();f.GamepadSource=m})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../3d/support/mathUtils"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.extractState=function(e){var g=e.native;return{buttons:g.buttons.map(function(d){return d.pressed?
d.value?d.value:1:0}),axes:g.axes.map(function(d){var g=e.axisThreshold,c=Math.abs(d);d=c<g?0:k.sign(d)*(c-g)/(1-g);return d})}};f.stateEqual=function(e,g){if(e.axes.length!==g.axes.length||e.buttons.length!==g.buttons.length)return!1;for(var d=0;d<e.axes.length;d++)if(e.axes[d]!==g.axes[d])return!1;for(d=0;d<e.buttons.length;d++)if(e.buttons[d]!==g.buttons[d])return!1;return!0};f.stateIdle=function(e){for(var g=0;g<e.axes.length;g++)if(0!==e.axes[g])return!1;for(g=0;g<e.buttons.length;g++)if(0!==
e.buttons[g])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){Object.defineProperty(f,"__esModule",{value:!0});var n=d.getLogger("esri.views.input.InputManager");m=function(d){function g(a,c){a=d.call(this)||
this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=b.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}k(g,d);g.prototype.normalizeCtorArgs=function(b,c){this._browserEvents=b;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=c;this._recognizers||(this._recognizers=a.defaults.map(function(a){return new a}));return{}};
g.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a]);this._browserEvents=null};g.prototype.installHandlers=function(a,b){var c=this;if(this._nameToGroup[a])n.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)n.error("Can't register a group of zero handlers");else{var d={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};
this._nameToGroup[a]=d;a=function(a){var b=d.handlers[a];e._handlers.push(b);b.handler.onInstall({updateDependencies:function(){c.updateDependencies()},emit:function(a,d,e,g){c._emitInputEvent(b.priorityIndex,a,d,e,g)},setPointerCapture:function(a,e){c._setPointerCapture(d,b,a,e)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=a}})};var e=this;for(b=d.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};g.prototype.uninstallHandlers=function(a){var b=
this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):n.error("There is no InputHandler group registered under the name `"+a+"`")};g.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};g.prototype.updateDependencies=function(){var a=new Set,c=new Set;this._handlersPriority=[];for(var d=this._handlers.length-
1;0<=d;d--){var e=this._handlers[d];e.priorityIndex=d;this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(d=this._handlersPriority.length-1;0<=d;d--){e=this._handlersPriority[d];e.priorityIndex=d;var g=e.handler.hasSideEffects;if(!g)for(var h=0,f=e.handler.outgoingEventTypes;h<f.length;h++)if(a.has(f[h])){g=!0;break}if(g)for(h=0,f=e.handler.incomingEventMatches;h<f.length;h++){var l=f[h];a.add(l.eventType);for(var k=0,l=l.keyModifiers;k<l.length;k++){var m=
l[k];b.isSystemModifier(m)||c.add(m)}}e.active=g}this._sourceEvents=a;this._keyModifiers=c;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};g.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};g.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);
this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,b,b.native?b.native.timestamp:void 0)};g.prototype._updateKeyModifiers=function(a,b){var c=this;if(b){var d=!1,e=function(){if(!d){var a=new Set;c._activeKeyModifiers.forEach(function(b){a.add(b)});c._activeKeyModifiers=a;d=!0}},g=function(a,b){b&&!c._activeKeyModifiers.has(a)?(e(),c._activeKeyModifiers.add(a)):!b&&c._activeKeyModifiers.has(a)&&(e(),c._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var h=b.key;this._keyModifiers.has(h)&&
g(h,"key-down"===a)}a=b.native;g("Alt",!(!a||!a.altKey));g("Ctrl",!(!a||!a.ctrlKey));g("Shift",!(!a||!a.shiftKey));g("Meta",!(!a||!a.metaKey));g("Primary",this._activeKeyModifiers.has(this.primaryKey))}};g.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new l.LatestPointerType(function(b){return a._setLatestPointerType(b)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};
g.prototype._setPointerCapture=function(a,b,c,d){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(c.pointerId)||new Set;this._pointerCaptures.set(c.pointerId,b);d?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(c,!1)))};g.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});
this.updateDependencies()};g.prototype._emitInputEventFromSource=function(a,b,c){this._emitInputEvent(0,a,b,c)};g.prototype._emitInputEvent=function(a,b,c,d,e){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:h();b=new p(b,c,d,e||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):this._doNewPropagation(a,b)};g.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],
needsHandlerGarbageCollect:!1,timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var c=[];a.addedEvents=[];for(var d=0;d<b.length;d++){var e=b[d];a.currentHandler.active&&a.currentHandler.eventCallback(e);e.shouldStopPropagation()||c.push(e)}a.events=c.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=
null};g.prototype._compareHandlerPriority=function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var c=0,d=a.handler.incomingEventMatches;c<d.length;c++)for(var e=d[c],g=function(a){if(e.eventType!==a.eventType)return"continue";var b=e.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});if(b.length===e.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:e.keyModifiers.length>a.keyModifiers.length?-1:1}},h=
0,f=b.handler.incomingEventMatches;h<f.length;h++){var l=g(f[h]);if("object"===typeof l)return l.value}return a.priorityIndex>b.priorityIndex?-1:1};g.prototype._sortHandlersPriority=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=0;e<b.length&&0<=this._compareHandlerPriority(d,b[e]);)e++;b.splice(e,0,d)}return b};e([c.property({readOnly:!0})],g.prototype,"latestPointerType",void 0);return g=e([c.subclass("esri.views.input.InputManager")],g)}(c.declared(g));f.InputManager=m;var p=function(){function a(a,
b,c,d){this.type=a;this.data=b;this.timestamp=c;this.modifiers=d;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",
{value:!0});f.defaults=[e.PointerClickHoldAndDrag,g.SingleAndDoubleClick,k.Drag,d.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(m,f,k,e,g){function d(a){var b=[];a.forEach(function(a){b.push(a.event)});return g.fitCircleLSQ(b)}function h(a){var c=d(a),e=0;a.forEach(function(a){for(var d=b(a,c),d=d-a.lastAngle;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=
a.lastAngle+d;a.lastAngle=d;e+=d-a.initialAngle});e/=a.size||1;return{angle:e,radius:c.radius,center:c.center}}function c(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});return b}function b(a,b){a=a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function e(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",
b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-cancel",b.handlePointerUpAndPointerLost.bind(b));return b}k(e,a);e.prototype.createPayload=function(a,b,d,e){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:e,pointers:c(this.activePointerMap),pointer:b,angle:d.angle,radius:d.radius,center:d.center}};
e.prototype.addPointer=function(a){var c=a.native.pointerId,e=h(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(c,a);c=b(a,d(this.activePointerMap));a.initialAngle=c;a.lastAngle=c;this.updatePointerAngles(e)};e.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};e.prototype.removePointer=function(a){var b=h(this.activePointerMap).angle;this.activePointerMap.delete(a);
this.updatePointerAngles(b)};e.prototype.updatePointerAngles=function(a){var c=h(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=b(d,c)-a;d.lastAngle=b(d,c)-a})};e.prototype.emitEvent=function(a,b,c){var d=h(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};e.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,c=a.timestamp;this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),
this.emitEvent("end",a.data,c),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};e.prototype.handlePointerDrag=function(a){var b=a.data,c=b.currentEvent,d=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),this.emitEvent("update",c,d)):(this.addPointer(c),this.emitEvent("added",c,d)):(this.updatePointer(c),this.pointerType=a.data.startEvent.pointerType,
this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",c,d))}};return e}(e.InputHandler);f.Drag=m;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(f.Button||(f.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.manhattanDistance=
function(f,e){return Math.abs(e.x-f.x)+Math.abs(e.y-f.y)};f.euclideanDistance=function(f,e){var g=e.x-f.x;f=e.y-f.y;return Math.sqrt(g*g+f*f)};f.fitCircleLSQ=function(f,e){e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:{x:0,y:0}};if(0===f.length)return e;if(1===f.length)return e.center.x=f[0].x,e.center.y=f[0].y,e;if(2===f.length){var g=f[0];f=f[1];var d=[f.x-g.x,f.y-g.y],h=d[0],d=d[1];e.radius=Math.sqrt(h*h+d*d)/2;e.center.x=(g.x+f.x)/2;e.center.y=(g.y+f.y)/2;return e}for(var c=0,b=
0,a=0;a<f.length;a++)c+=f[a].x,b+=f[a].y;for(var c=c/f.length,b=b/f.length,l=f.map(function(a){return a.x-c}),k=f.map(function(a){return a.y-b}),m=g=e=0,q=0,r=h=0,a=d=0;a<l.length;a++){var t=l[a],w=k[a],u=t*t,x=w*w;e+=u;g+=x;m+=t*w;q+=u*t;h+=x*w;r+=t*x;d+=w*u}a=e;l=m;k=g;q=.5*(q+r);h=.5*(h+d);d=a*k-m*l;r=(q*k-h*l)/d;h=(a*h-m*q)/d;return{radius:Math.sqrt(r*r+h*h+(e+g)/f.length),center:{x:r+c,y:h+b}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};m=function(d){function e(c,b,a,e){void 0===c&&(c=f.DefaultParameters.maximumClickDelay);void 0===b&&(b=f.DefaultParameters.movementUntilMouseDrag);void 0===a&&(a=f.DefaultParameters.movementUntilTouchDrag);void 0===e&&(e=f.DefaultParameters.holdDelay);var g=d.call(this,!1)||this;g.maximumClickDelay=
c;g.movementUntilMouseDrag=b;g.movementUntilTouchDrag=a;g.holdDelay=e;g._pointerState=new Map;g._pointerDrag=g.registerOutgoing("pointer-drag");g._immediateClick=g.registerOutgoing("immediate-click");g._pointerHold=g.registerOutgoing("hold");g.registerIncoming("pointer-down",g._handlePointerDown.bind(g));g.registerIncoming("pointer-up",function(a){g._handlePointerLoss(a,"pointer-up")});g.registerIncoming("pointer-capture-lost",function(a){g._handlePointerLoss(a,"pointer-capture-lost")});g.registerIncoming("pointer-cancel",
function(a){g._handlePointerLoss(a,"pointer-cancel")});g._moveHandle=g.registerIncoming("pointer-move",g._handlePointerMove.bind(g));g._moveHandle.pause();return g}k(e,d);e.prototype.onUninstall=function(){this._pointerState.forEach(function(c){0!==c.holdTimeout&&(clearTimeout(c.holdTimeout),c.holdTimeout=0)});d.prototype.onUninstall.call(this)};e.prototype._handlePointerDown=function(c){var b=this,a=c.data,d=a.native.pointerId,e=0;0===this._pointerState.size&&(e=setTimeout(function(){var a=b._pointerState.get(d);
a&&(a.isDragging||(b._pointerHold.emit(a.previousEvent,void 0,c.modifiers),a.holdEmitted=!0),a.holdTimeout=0)},this.holdDelay));e={startEvent:a,previousEvent:a,startTimestamp:c.timestamp,isDragging:!1,downButton:a.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(d,e);this.startCapturingPointer(a.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(c)};e.prototype._createPointerDragData=function(c,b,a){return{action:c,startEvent:b.startEvent,previousEvent:b.previousEvent,
currentEvent:a}};e.prototype._handlePointerMove=function(c){var b=c.data,a=this._pointerState.get(b.native.pointerId);a&&(a.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",a,b),void 0,a.modifiers):g.euclideanDistance(b,a.startEvent)>("touch"===b.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(c),a.previousEvent=b)};e.prototype.startDragging=function(c){var b=this,a=c.data,d=a.native.pointerId;this._pointerState.forEach(function(e){0!==
e.holdTimeout&&(clearTimeout(e.holdTimeout),e.holdTimeout=0);e.isDragging||(e.modifiers=c.modifiers,e.isDragging=!0,d===e.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",e,a)):b._pointerDrag.emit(b._createPointerDragData("start",e,e.previousEvent),c.timestamp))})};e.prototype._handlePointerLoss=function(c,b){var a=c.data,d=a.native.pointerId,e=this._pointerState.get(d);e&&(0!==e.holdTimeout&&clearTimeout(e.holdTimeout),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",
e,"pointer-up"===b?a:e.previousEvent),void 0,e.modifiers):"pointer-up"===b&&e.downButton===a.native.button&&c.timestamp-e.startTimestamp<=this.maximumClickDelay&&!e.holdEmitted&&this._immediateClick.emit(a),this._pointerState.delete(d),this.stopCapturingPointer(a.native),0===this._pointerState.size&&this._moveHandle.pause())};return e}(e.InputHandler);f.PointerClickHoldAndDrag=m})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};m=function(d){function e(c,b,a,e){void 0===c&&(c=f.DefaultParameters.maximumDoubleClickDelay);void 0===b&&(b=f.DefaultParameters.maximumDoubleClickDistance);void 0===a&&(a=f.DefaultParameters.maximumDoubleTouchDelay);void 0===e&&(e=f.DefaultParameters.maximumDoubleTouchDistance);
var g=d.call(this,!1)||this;g.maximumDoubleClickDelay=c;g.maximumDoubleClickDistance=b;g.maximumDoubleTouchDelay=a;g.maximumDoubleTouchDistance=e;g._pointerState=new Map;g._click=g.registerOutgoing("click");g._doubleClick=g.registerOutgoing("double-click");g.registerIncoming("immediate-click",g._handleImmediateClick.bind(g));return g}k(e,d);e.prototype.onUninstall=function(){this._pointerState.forEach(function(c){0!==c.doubleClickTimeout&&(clearTimeout(c.doubleClickTimeout),c.doubleClickTimeout=0)})};
e.prototype._pointerId=function(c){c=c.native;return"mouse"===c.pointerType?c.pointerId+":"+c.button:""+c.pointerType};e.prototype._handleImmediateClick=function(c){var b=c.data,a=this._pointerId(b),d=this._pointerState.get(a);if(d){clearTimeout(d.doubleClickTimeout);d.doubleClickTimeout=0;var e="touch"===b.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;g.manhattanDistance(d.event.data,b)>e?(this._doubleClickTimeoutExceeded(a),this._startClick(c)):(this._doubleClick.emit(b,
void 0,d.event.modifiers),this._pointerState.delete(a))}else this._startClick(c)};e.prototype._startClick=function(c){var b=this,a=this._pointerId(c.data);this._pointerState.set(a,{event:c,doubleClickTimeout:setTimeout(function(){return b._doubleClickTimeoutExceeded(a)},"touch"===c.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)})};e.prototype._doubleClickTimeoutExceeded=function(c){var b=this._pointerState.get(c);this._click.emit(b.event.data,void 0,b.event.modifiers);
b.doubleClickTimeout=0;this._pointerState.delete(c)};return e}(e.InputHandler);f.SingleAndDoubleClick=m})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function g(c,b){void 0===c&&(c=20);void 0===b&&(b=40);var a=d.call(this,!1)||this;a._threshold=c;a._maxDelta=b;a.state="ready";a.emittedArtificalEnd2=
!1;a._vertical=a.registerOutgoing("vertical-two-finger-drag");a._artificalDrag=a.registerOutgoing("drag");a.dragEventSeparator=new e.DragEventSeparator({start:function(b,c){return a.observeStart(b,c)},update:function(b,c,d){return a.observeUpdate(b,c,d)},end:function(b,c){return a.observeEnd(b,c)}});a.registerIncoming("drag",function(b){return a.dragEventSeparator.handle(b)});return a}k(g,d);Object.defineProperty(g.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});
g.prototype.observeStart=function(c,b){1===c&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),b.stopPropagation());this.state=2===c?"ready":"failed"};g.prototype.observeUpdate=function(c,b,a){"failed"!==this.state&&2===c&&("active"===
this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,a.data)?this.checkVerticalThresholdReached(b.data,a.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,
angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};g.prototype.observeEnd=function(c,b){"active"===this.state&&(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",b.stopPropagation())};g.prototype.checkMovementWithinLimits=function(c,b){var a=-Infinity,d=Infinity,e=-Infinity,g=Infinity;
b.pointers.forEach(function(b){a=Math.max(a,b.x);d=Math.min(d,b.x);e=Math.max(e,b.y);g=Math.min(g,b.y)});var h=-Infinity,f=Infinity,k=-Infinity,m=Infinity;c.pointers.forEach(function(a){h=Math.max(h,a.x);f=Math.min(f,a.x);k=Math.max(k,a.y);m=Math.min(m,a.y)});return Math.abs(c.center.x-b.center.x)<this._threshold&&Math.abs(h-f-(a-d))<=this._maxDelta&&Math.abs(k-m-(e-g))<=this._maxDelta};g.prototype.checkVerticalThresholdReached=function(c,b){var a=Math.abs(c.center.y-b.center.y);c.pointers.forEach(function(c,
d){d=b.pointers.get(d);a=Math.min(a,Math.abs(c.y-d.y))});return a>=this._threshold};return g}(g.InputHandler);f.VerticalTwoFingerDrag=m})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e){this.callbacks=e;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}f.prototype.handle=function(e){var g=e.data,d=g.pointers.size;switch(g.action){case "start":this.currentCount=
d;this.emitStart(e);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(e);break;case "update":this.emitUpdate(e);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(e);break;case "end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e};f.prototype.emitStart=function(e){this.startEvent=e;this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)};f.prototype.emitUpdate=
function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)};f.prototype.emitEnd=function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent);this.startEvent=null};return f}();f.DragEventSeparator=m})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(m,f,k,e){Object.defineProperty(f,"__esModule",
{value:!0});m=function(e){function d(d){var c=e.call(this,!0)||this;c._onChange=d;c._value="mouse";c.registerIncoming("pointer-down",function(b){c._setValue("touch"===b.data.native.pointerType?"touch":"mouse")});c._moveHandler=c.registerIncoming("pointer-move",function(b){c._setValue("touch"===b.data.native.pointerType?"touch":"mouse")});c._moveHandler.pause();return c}k(d,e);d.prototype._setValue=function(d){d!==this._value&&("touch"===d?this._moveHandler.resume():this._moveHandler.pause(),this._value=
d,this._onChange(d))};return d}(e.InputHandler);f.LatestPointerType=m})},"esri/views/input/ViewEvents":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry/ScreenPoint ../3d/support/mathUtils ./InputHandler".split(" "),function(m,f,k,e,g,d){function h(a){return!!b[a]}function c(a){for(var b=0;b<a.length;b++)if(!h(a[b]))return!1;return!0}Object.defineProperty(f,"__esModule",{value:!0});var b={click:!0,"double-click":!0,"immediate-click":!0,hold:!0,drag:!0,"key-down":!0,
"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"pointer-drag":!0,"mouse-wheel":!0,"pointer-enter":!0,"pointer-leave":!0,gamepad:!0},a;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(a||(a={}));m=function(){function a(a){this.handlers=new Map;this.counter=0;this.handlerCounts=new Map;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,c){return b.inputManager.installHandlers(c,
[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,c){return a.inputManager.uninstallHandlers(c)});this.inputManager=null};a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};a.prototype.register=function(a,b,d){var e=this,g=Array.isArray(a)?a:a.split(",");if(!c(g))return g.some(h)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;a=Array.isArray(b)?
b:[];d=Array.isArray(b)?d:b;var f=this.createUniqueGroupName();b=new l(this.view,g,a,d);this.handlers.set(f,b);for(d=0;d<g.length;d++){a=g[d];var k=this.handlerCounts.get(a)||0;this.handlerCounts.set(a,k+1)}this.inputManager&&this.inputManager.installHandlers(f,[b]);return{remove:function(){return e.removeHandler(f,g)}}};a.prototype.hasHandler=function(a){return!!this.handlerCounts.get(a)};a.prototype.removeHandler=function(a,b){if(this.handlers.has(a)){this.handlers.delete(a);for(var c=0;c<b.length;c++){var d=
b[c],e=this.handlerCounts.get(d);void 0===e?console.error("Trying to remove handler for event that has no handlers registered: ",d):1===e?this.handlerCounts.delete(d):this.handlerCounts.set(d,e-1)}}this.inputManager&&this.inputManager.uninstallHandlers(a)};a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();f.ViewEvents=m;var l=function(a){function b(b,c,d,e){var g=a.call(this,!0)||this;g.view=b;for(b=0;b<c.length;b++)switch(c[b]){case "click":g.registerIncoming("click",
d,function(a){return e(g.wrapClick(a))});break;case "double-click":g.registerIncoming("double-click",d,function(a){return e(g.wrapDoubleClick(a))});break;case "immediate-click":g.registerIncoming("immediate-click",d,function(a){return e(g.wrapImmediateClick(a))});break;case "hold":g.registerIncoming("hold",d,function(a){return e(g.wrapHold(a))});break;case "drag":g.registerIncoming("drag",d,function(a){(a=g.wrapDrag(a))&&e(a)});break;case "key-down":g.registerIncoming("key-down",d,function(a){return e(g.wrapKeyDown(a))});
break;case "key-up":g.registerIncoming("key-up",d,function(a){return e(g.wrapKeyUp(a))});break;case "pointer-down":g.registerIncoming("pointer-down",d,function(a){return e(g.wrapPointer(a,"pointer-down"))});break;case "pointer-move":g.registerIncoming("pointer-move",d,function(a){return e(g.wrapPointer(a,"pointer-move"))});break;case "pointer-up":g.registerIncoming("pointer-up",d,function(a){return e(g.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":g.registerIncoming("pointer-drag",d,function(a){return e(g.wrapPointerDrag(a))});
break;case "mouse-wheel":g.registerIncoming("mouse-wheel",d,function(a){return e(g.wrapMouseWheel(a))});break;case "pointer-enter":g.registerIncoming("pointer-enter",d,function(a){return e(g.wrapPointer(a,"pointer-enter"))});break;case "pointer-leave":g.registerIncoming("pointer-leave",d,function(a){return e(g.wrapPointer(a,"pointer-leave"))});break;case "gamepad":g.registerIncoming("gamepad",d,function(a){e(g.wrapGamepad(a))})}return g}k(b,a);b.prototype.wrapClick=function(a){var b=a.data,c=b.x,
d=b.y;return{type:"click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,screenPoint:new e(c,d),mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapDoubleClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"double-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};
b.prototype.wrapImmediateClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"immediate-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapHold=function(a){var b=a.data,c=b.x,d=b.y;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,
d),stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapDrag=function(a){var b=a.data,c=b.center,d=c.x,c=c.y,e=b.action,h=b.pointerType,f=b.button;"start"===e&&(this.latestDragStart=b);if(this.latestDragStart){var l=b.pointer.native,k=b.buttons,m=a.timestamp,n={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};"end"===e&&(this.latestDragStart=void 0);return{type:"drag",action:e,x:d,y:c,origin:n,pointerType:h,button:f,buttons:k,radius:b.radius,angle:g.rad2deg(b.angle),
native:l,timestamp:m,stopPropagation:function(){return a.stopPropagation()}}}};b.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapKeyUp=function(a){var b=a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapPointer=function(a,b){var c=a.data,d=c.native;
return{type:b,x:c.x,y:c.y,pointerId:d.pointerId,pointerType:d.pointerType,button:c.button,buttons:c.buttons,native:d,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent;return{type:"pointer-drag",x:b.x,y:b.y,pointerId:a.data.startEvent.native.pointerId,pointerType:a.data.startEvent.native.pointerType,button:a.data.startEvent.button,buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},
native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapGamepad=function(a){var b=a.data,c=b.state;return{type:"gamepad",device:b.device,timestamp:a.timestamp,action:b.action,buttons:c.buttons,axes:c.axes,stopPropagation:function(){return a.stopPropagation()}}};
return b}(d.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(){var d=e.call(this,!0)||this;d.registerIncoming("context-menu",function(c){c.data.native.preventDefault()});return d}k(d,e);return d}(e.InputHandler);f.PreventContextMenu=m;f.default=m})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/Logger ../../../../core/now ../../../../core/PooledArray ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../lib/gl-matrix ../../support/mathUtils ../../support/ResourceController ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){function w(a){return!!a&&"selection"===a.type}var u=g.getLogger("esri.views.3d.graphics.Deconflictor"),x=a.vec4d.create(),v=a.vec4d.create(),z=a.vec4d.create(),y=a.vec4d.create(),A=c.create(),B=c.create(),C=new Set,E=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.currentIndex>=this.list.length&&this.list.push(new this.creator(a));
return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,c=this.list;0<=--a;)b(c[a]);this.currentIndex=0};return a}(),D=function(){function a(){this.graphics3DGraphic=null;this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.id=0}a.release=function(a){a.graphics3DGraphic=null;a.graphicsOwner=null};a.copyMetadata=function(a,b){b.graphics3DGraphic=a.graphics3DGraphic;b.graphicsOwner=a.graphicsOwner;b.iconDeconflictionEnabled=
a.iconDeconflictionEnabled;b.labelDeconflictionEnabled=a.labelDeconflictionEnabled;return b};return a}(),F;(function(a){a[a.Idle=0]="Idle";a[a.Collect=1]="Collect";a[a.Process=2]="Process";a[a.SortIcons=3]="SortIcons";a[a.SortLabels=4]="SortLabels";a[a.Deconflict=5]="Deconflict"})(F||(F={}));m=function(){function a(a){var b=this;this.graphicsOwners=[];this.lastRunTimestamp=0;this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.syncBudget=null;this.state=F.Idle;this.collectIndex=0;this.collectGraphics=
null;this.collectGraphicsIndex=0;this.handles=new e;this.graphicInfosToProcess=new h;this.graphicInfoPool=new E(D,D.release);this.nextGraphicInfoId=0;this.visibleObjects={icons:new h,labels:new h};this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=a;this.handles.add([a.watch("state.camera",function(){b.setDirty({async:!0,forceMaxIntervalRun:!0})})]);this.frameWorker=a.resourceController.registerFrameWorker(function(a){return b.run(a)})}
a.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.graphicInfoPool.freeAll();this.graphicInfoPool=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.view=null};a.prototype.addGraphicsOwner=function(a){var b=this,c=null;a.layer&&"function"===typeof a.layer.watch&&(c=a.layer.watch("featureReduction",function(c,d){w(c)?(b._setIconVisibilityFlags(a,!1),b.setDirty()):w(d)&&(b._setIconVisibilityFlags(a,void 0),b.setDirty())}));this.graphicsOwners.push({handle:c,
owner:a});this.setDirty()};a.prototype.removeGraphicsOwner=function(a){for(var b=-1,c=0;c<this.graphicsOwners.length;c++)if(this.graphicsOwners[c].owner===a){b=c;break}0<=b&&((a=this.graphicsOwners[b].handle)&&a.remove(),this.graphicsOwners.splice(b,1),this.setDirty())};Object.defineProperty(a.prototype,"isDirty",{get:function(){return this.nextRunTimestamp!==Number.POSITIVE_INFINITY},enumerable:!0,configurable:!0});a.prototype.setDirty=function(a){var b=a?a.async:!0;a=a?a.forceMaxIntervalRun:!1;
this.state!==F.Idle&&(this.state=F.Idle);var c=d();this.nextRunTimestamp=a&&1E3<c-this.lastRunTimestamp?this.lastRunTimestamp=c:c+200;b||this.syncBudget||(this.syncBudget=new n.Budget(d),this.syncBudget.enabled=!1)};a.prototype.setClean=function(){this.graphicInfoPool.freeAll();this.graphicInfosToProcess.clear();this.nextGraphicInfoId=0;this.state=F.Idle;this.lastRunTimestamp=d();this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.syncBudget=null};a.prototype.setInitialIconVisibilityFlag=function(a,
b){a=!w(a?a.featureReduction:null);b.setVisibilityFlag(2,a)};a.prototype.doesIntersectExistingPoly=function(a){var b=a.graphics3DGraphic.graphic.uid;C.clear();for(var c=Math.floor(a.xMin/this.accBinsSizeX);c<=Math.floor(a.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=Math.floor(a.yMax/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY))for(var e=this.accBins[c][d],g=0;g<e.length;g++){var h=e.data[g];if(h.graphics3DGraphic.graphic.uid!==
b&&(this.accNumTests++,!(h.xMin>a.xMax||h.xMax<a.xMin||h.yMin>a.yMax||h.yMax<a.yMin)))return!0}return!1};a.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-1],e=0;e<this.accBinsNumY;e++)d.push(new h({initialSize:10}))}}for(c=0;c<this.accBinsNumX;c++)for(e=0;e<this.accBinsNumY;e++)this.accBins[c][e].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;
this.accNumTests=0};a.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)0>c||c>=this.accBinsNumY||this.accBins[b][c].push(a)};a.prototype.run=function(a){if(this.view.ready&&!(a.now()<this.nextRunTimestamp))switch(b.prepare(this.view),this.syncBudget&&(a=this.syncBudget),this.state){case F.Idle:this.collectIndex=
0,this.collectGraphics=null,this.visibleObjects.icons.clear(),this.visibleObjects.labels.clear(),this.graphicInfosToProcess.clear();case F.Collect:this.state=F.Collect;if(!this._collectVisibleObjects(a))break;if(0===this.graphicInfosToProcess.length){this.setClean();break}case F.Process:this.state=F.Process;if(a.done())break;for(;this.graphicInfosToProcess.length&&!a.done();)this._processVisibleObject(this.graphicInfosToProcess.pop());if(0<this.graphicInfosToProcess.length)break;case F.SortIcons:this.state=
F.SortIcons;if(a.done())break;this.visibleObjects.icons.sort(function(a,b){return a.posView-b.posView});case F.SortLabels:this.state=F.SortLabels;if(a.done())break;this.visibleObjects.labels.sort(function(a,b){return a.posView-b.posView});case F.Deconflict:this.state=F.Deconflict,a.done()||(this._deconflictVisibleObjects(this.visibleObjects.icons,!1,a),this.visibleObjects.labels.length&&this._deconflictVisibleObjects(this.visibleObjects.labels,!0,a),b.drawAccelerationStruct(this,this.visibleObjects.icons),
b.drawAccelerationStruct(this,this.visibleObjects.labels),0===this.visibleObjects.icons.length&&0===this.visibleObjects.labels.length&&this.setClean())}};a.prototype._collectVisibleObjects=function(a){for(var b=this.view.state.camera,c=b.fullWidth,b=b.fullHeight;this.collectIndex<this.graphicsOwners.length;++this.collectIndex){var d=this.graphicsOwners[this.collectIndex].owner,e=d.graphics3DGraphics;if(e){var g=d.labelsEnabled,h=w(d.layer?d.layer.featureReduction:null);if(g||h)if(this.collectGraphics||
(this.collectGraphics=d.graphics3DGraphicsKeys,this.collectGraphicsIndex=0),this.collectGraphics){if(this.collectGraphics!==d.graphics3DGraphicsKeys)return this.collectIndex=0,this.collectGraphics=null,!1;for(;this.collectGraphicsIndex<this.collectGraphics.length&&!a.done();++this.collectGraphicsIndex){var f=e[this.collectGraphics[this.collectGraphicsIndex]];if(f&&f.areVisibilityFlagsSet(void 0,2)){var l=this.graphicInfoPool.alloc();l.id=this.nextGraphicInfoId++;l.graphicsOwner=d;l.graphics3DGraphic=
f;l.iconDeconflictionEnabled=h;l.labelDeconflictionEnabled=g;this.graphicInfosToProcess.push(l)}}this.collectGraphicsIndex>=this.collectGraphics.length&&(this.collectGraphics=null)}}}if(this.collectIndex===this.graphicsOwners.length&&!this.collectGraphics){this.collectIndex=0;if(0===this.graphicInfosToProcess.length)return!0;this.initBins(c,b);return!0}this.collectGraphics&&--this.collectIndex;return!1};a.prototype._processVisibleObject=function(a){var b=this.view.state.camera;a.iconDeconflictionEnabled&&
this._collectGraphics(a,b,0);a.labelDeconflictionEnabled&&(a=a.iconDeconflictionEnabled?D.copyMetadata(a,this.graphicInfoPool.alloc()):a,a.id=this.nextGraphicInfoId++,this._collectGraphics(a,b,1))};a.prototype._collectGraphics=function(a,b,d){var e=a.graphics3DGraphic,g=a.graphicsOwner,h=1===d,f=h?this.visibleObjects.labels:this.visibleObjects.icons,k=h?e._labelGraphics:e._graphics,h=h?0:this.iconMarginFactor;if(k.length){for(var m=c.empty(A),n,w,D=0;D<k.length;D++){var C=k[D];if(C&&"object3d"===
C.type){var E=C.stageObject,F=E?E.getNumGeometryRecords():0;if(!(1>F)){var I=E.getGeometryRecord(0),G=I.materials[0];if(G instanceof r)if(1<F)u.warn("Graphic objects with more than 1 geometry record are not supported");else{F=I.geometry.data.getVertexAttr();if(!w){w=E.getCenter();I=I.origin.vec3;t.transformToWorld(w,I,x);t.transformToView(x,I,b.viewMatrix,v);G.applyVerticalOffsetTransformation(v,F[q.VertexAttrConstants.NORMAL].data,E.objectTransformation,b,M);E=F[q.VertexAttrConstants.AUXPOS1].data;
I="screen"!==G.getParams().centerOffsetUnits;t.transformToProjection(v,b.projectionMatrix,I?E:[0,0,0],z);w=t.transformToNDC(z,y);I||(w[0]+=E[0]/b.fullWidth*2,w[1]+=E[1]/b.fullHeight*2);if(-1>w[0]||-1>w[1]||-1>w[2]||1<=w[0]||1<=w[1])break;n=v[2];e.areVisibilityFlagsSet(2,void 0,d)&&(n*=.7)}C=C.getScreenSize(N);p.applyPrecomputedScaleFactorVec2(C,M.factor,C);G=c.offset(G.calculateRelativeScreenBounds(C,M.scaleAlignment,B),l.lerp(0,b.fullWidth,.5+.5*w[0]),l.lerp(0,b.fullHeight,.5+.5*w[1]));0!==h&&(C=
h*Math.min(c.width(G),c.height(G)),G[0]-=C,G[1]-=C,G[2]+=C,G[3]+=C);c.expand(m,G)}}}}null!=n&&(a.xMin=m[0],a.yMin=m[1],a.xMax=m[2],a.yMax=m[3],a.graphics3DGraphic=e,a.posView=n,a.graphicsOwner=g,f.push(a))}};a.prototype._deconflictVisibleObjects=function(a,c,d){for(var e=c?1:0;0<a.length&&!d.done();){var g=a.pop(),h=g.graphics3DGraphic,f=!(c&&!1===h.areVisibilityFlagsSet(2))&&!this.doesIntersectExistingPoly(g);f&&this.addToBins(g);h.setVisibilityFlag(2,f,e);c&&this.view.labeler.setLabelGraphicVisibility(h,
f);b.drawPoly(g,f?"green":"red")}};a.prototype._setIconVisibilityFlags=function(a,b){var c=a.graphics3DGraphics;a=a.graphics3DGraphicsKeys;if(null!=c&&null!=a)for(var d=0;d<a.length;d++)c[a[d]].setVisibilityFlag(2,b)};return a}();var M={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},N=a.vec2d.create();return m})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],
function(m,f,k,e){function g(a,d,e,g,h){var f=c.height,l=b;l.beginPath();l.lineWidth=1;l.strokeStyle=h;l.moveTo(a,f-e);l.lineTo(d,f-e);l.stroke();l.lineTo(d,f-g);l.stroke();l.lineTo(d,f-e);l.stroke();l.lineTo(a,f-e);l.stroke();l.lineTo(a,f-e);l.stroke();l.closePath()}Object.defineProperty(f,"__esModule",{value:!0});var d=!1,h=!1,c,b;f.drawAccelerationStruct=function(a,c){if(h&&b){for(var d=b,e=0,f=0;f<a.accBinsNumX;f++)for(var l=0;l<a.accBinsNumY;l++){var k=a.accBins[f][l],e=e+k.length,m=f*a.accBinsSizeX,
u=(f+1)*a.accBinsSizeX,x=l*a.accBinsSizeY,v=(l+1)*a.accBinsSizeY;d.fillText(k.length.toFixed(),m+5,x+15);g(m,u,x,v,"blue")}d.fillText("total totalShownLabels: "+e,70,40);d.fillText("total visible labels: "+c.length,70,50);d.fillText("total numTests: "+a.accNumTests,70,30)}};f.prepare=function(a){d=e.DECONFLICTOR_SHOW_OUTLINES;h=e.DECONFLICTOR_SHOW_GRID;if(d||h)null==c&&(c=document.createElement("canvas"),c.setAttribute("id","canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(c)),
c.setAttribute("width",a.width+"px"),c.setAttribute("height",a.height+"px"),c.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),b=c.getContext("2d"),b.clearRect(0,0,a.width,a.height),b.font="8px Arial"};f.drawPoly=function(a,b){d&&g(a.xMin,a.xMax,a.yMin,a.yMax,b)}})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/Handles ../../../core/now ../../../core/scheduling ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../webgl-engine/lib/Util".split(" "),
function(m,f,k,e,g,d,h,c,b){function a(){var a={},b;for(b in l.ClientType)a[l.ClientType[b]]=0;a[l.ClientType.TERRAIN]=15;a[l.ClientType.SCENE]=20;a[l.ClientType.SYMBOLOGY]=5;return new h(a)}var l=function(){function h(b,c,f){void 0===c&&(c=g);void 0===f&&(f=e);var l=this;this._view=b;this._memoryController=this._budget=null;this._streamDataLoader=a();this._frameWorkers=[];this._nextFrameWorker=0;this._idleWorkers=[];this._nextIdleWorker=0;this._idleUpdatesStartFired=!1;this._lastTargetChangeTime=
0;this._handles=new k;this._frameTask=null;this.idleTimeout=300;this.idleBudget=100;this._budget=new h.Budget(f);this._lastTargetChangeTime=f();this._memoryController=new d(this._view);this._handles.add(this._view.watch("state.camera",function(){return l.cameraChangedHandler()},!0));this._frameTask=c.addFrameTask({update:function(a){return l.frameUpdate(a)}})}h.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._handles.remove();this._streamDataLoader&&
(this._streamDataLoader.destroy(),this._streamDataLoader=null)};Object.defineProperty(h.prototype,"enableBudget",{set:function(a){this._budget.enabled=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maxGpuMemory",{set:function(a){this._memoryController.setMaxGpuMemory(a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"additionalCacheMemory",
{set:function(a){this._memoryController.setAdditionalCacheMemory(a)},enumerable:!0,configurable:!0});h.prototype.setMemoryDirty=function(){this._memoryController.setDirty()};Object.defineProperty(h.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"memoryEvents",
{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0});h.prototype.getMemCache=function(a,b){return this._memoryController.getMemCache(a,b)};h.prototype.getStreamDataSupplier=function(a,b){return new c(a,this._streamDataLoader,b)};h.prototype.registerIdleFrameWorker=function(a){var c=this;b.assert(!a.idleFrame||a.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var d={callbacks:a};this.addIdleFrameWorker(d);return{remove:function(){c.removeIdleFrameWorker(d)}}};
h.prototype.registerFrameWorker=function(a){var b=this,c={callback:a};this.addFrameWorker(c);return{remove:function(){b.removeFrameWorker(c)}}};h.prototype.addIdleFrameWorker=function(a){this._idleWorkers.push(a);this.isIdle()&&this._idleUpdatesStartFired&&a.callbacks.idleBegin&&a.callbacks.idleBegin()};h.prototype.removeIdleFrameWorker=function(a){var c=this._idleWorkers,d=c.indexOf(a);b.assert(0<=d,"worker not registered");this._idleUpdatesStartFired&&a.callbacks.idleEnd&&a.callbacks.idleEnd();
c.splice(d,1);this._nextIdleWorker>=c.length&&(this._nextIdleWorker=0)};h.prototype.addFrameWorker=function(a){this._frameWorkers.push(a)};h.prototype.removeFrameWorker=function(a){var c=this._frameWorkers;a=c.indexOf(a);b.assert(0<=a,"worker not registerted");c.splice(a,1);this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)};h.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now();this.setMemoryDirty();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this.callIdleFrameWorkersEnd())};h.prototype.frameUpdate=function(a){var b=this.isIdle()?0:5,c=a.frameDuration-a.elapsedFrameTime-b,d=this.idleBudget-a.elapsedFrameTime;this._view._stage&&!this._view._stage.getIdleSuspend()&&(d=c);c=Math.max(this.isIdle()?d:c,5);this._budget.reset(c);this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3);this._memoryController.update();for(a=0;a<this._frameWorkers.length;++a)if(c=(this._nextFrameWorker+a)%this._frameWorkers.length,this._frameWorkers[c].callback(this._budget),
this._budget.remaining()<b){this._nextFrameWorker=(c+1)%this._frameWorkers.length;break}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())};h.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout};h.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(a){a.callbacks.idleBegin&&a.callbacks.idleBegin()})};h.prototype.callIdleFrameWorkersEnd=
function(){this._idleWorkers.forEach(function(a){a.callbacks.idleEnd&&a.callbacks.idleEnd()})};h.prototype.callIdleFrameWorkers=function(){for(var a=0;a<this._idleWorkers.length;++a){var b=(this._nextIdleWorker+a)%this._idleWorkers.length;if(this._budget.done()){this._nextIdleWorker=b;break}b=this._idleWorkers[b];b.callbacks.needsUpdate&&b.callbacks.needsUpdate()&&b.callbacks.idleFrame(this._budget)}};return h}();(function(a){(function(a){a.TERRAIN="terrain";a.SCENE="scene";a.SYMBOLOGY="symbology"})(a.ClientType||
(a.ClientType={}));var b=function(){function a(a){this._nowFunc=a;this.enabled=!0;this.budget=this.begin=0}a.prototype.now=function(){return this._nowFunc()};a.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};a.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};a.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY};a.prototype.elapsed=function(){return this.now()-this.begin};
return a}();a.Budget=b})(l||(l={}));return l})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Logger ../layers/support/MemoryManagedLayerView ./Evented ./MemCache".split(" "),function(m,f,k,e,g,d){var h=k.getLogger("esri.views.3d.support.MemoryController");return function(){function c(b){this._view=b;this._minQuality=.1;this._memoryHWM=this._maxQuality=1;this._memoryLWM=.75;this._divideRate=1.3;this._throttle=5;this.events=new g.Evented;this._maxMemory=
500;this._additionalCacheMemory=100;this._quality=1;this._memoryCommitted=this._memoryUsed=this._throttled=this._stableQuality=0;this._cacheStorage=new d.Storage;this.updating=!1}c.prototype.getMemCache=function(b,a){return new d(b,this._cacheStorage,a)};c.prototype.setMaxGpuMemory=function(b){null!=b&&0<b&&(this._maxMemory=b,this.setDirty())};c.prototype.setAdditionalCacheMemory=function(b){null!=b&&0<=b&&(this._additionalCacheMemory=b,this.setDirty())};c.prototype.disableMemCache=function(){this._additionalCacheMemory=
-4096};c.prototype.getMemoryFactor=function(){return this._quality};c.prototype._updateQuality=function(b){b=Math.min(Math.max(b,this._minQuality),this._maxQuality);if(b===this._quality)return!1;this._quality=b;this.events.emit("quality-changed",this._quality);return!0};c.prototype.getUsedMemory=function(){return this._memoryUsed};c.prototype.setDirty=function(){this._stableQuality=0};c.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryCommitted)){this._throttled=Math.max(0,this._throttled-
1);var b=this._layersUpdating();if(b){if(this._quality<=this._minQuality)return;if(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)if(0<this._stableQuality)this._updateQuality(this._stableQuality);else if(0===this._throttled||1.05<this._memoryUsed)this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle}else this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,b=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&
this._quality<this._maxQuality&&this._stableQuality!==this._quality&&(this._stableQuality=this._quality,b=this._updateQuality(this._quality+.1*(this._memoryLWM-this._memoryCommitted+.1)));this.updating!==b&&(this.updating=b,this.events.emit("updating-changed",this.updating))}};c.prototype._layersUpdating=function(){var b=!1;this._view.allLayerViews.forEach(function(a){b=b||a.updating});return b};c.prototype._updateMemory=function(){var b=0,a=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&
(b+=this._view.basemapTerrain.getUsedMemory());var c=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();c&&(b+=c.getGpuMemoryUsage());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(c){e.isMemoryManagedLayerView(c)&&(b+=c.getUsedMemory(),a+=c.getUnloadedMemory())});var d=null==this._warnMemoryUsage||Math.round(10*b)!==Math.round(10*this._warnMemoryUsage),c=1048576*this._maxMemory;if(b>c&&d){this._warnMemoryUsage=b;var d=function(a){return(a/1048576).toLocaleString(void 0,
{maximumFractionDigits:1})+" MB"},g=Math.round(100*this._quality);h.warn("GPU Memory Limit exceeded! Limit: "+d(c)+" Current: "+d(b)+" Projected: "+d(b+a)+" Quality: "+g+"%")}this._memoryUsed=b/c;this._memoryCommitted=(b+a)/c;this._cacheStorage.maxSize=Math.max(0,c-b+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};return c}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,
"__esModule",{value:!0});f.isMemoryManagedLayerView=function(f){return"function"===typeof f.getUsedMemory}})},"esri/views/3d/support/MemCache":function(){define(["require","exports","../../../core/lang","../../../core/PooledArray"],function(m,f,k,e){var g=new e;m=function(){function d(d,c,b){this._namespace=d;this._storage=c;this._priority=0;this._removeFunc=!1;this._miss=this._hit=0;g.push(this);this._namespace+=":";b&&(this._storage.registerRemoveFunc(this._namespace,b),this._removeFunc=!0)}Object.defineProperty(d.prototype,
"priority",{get:function(){return this._priority},set:function(d){isNaN(d)||(this._priority=Math.max(0,d))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0});d.prototype.resetHitRate=function(){this._hit=this._miss=0};d.prototype.destroy=function(){this._storage.clear(this._namespace);
this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace);g.removeUnordered(this)};d.prototype.put=function(d,c,b){this._storage.put(this._namespace+d,c,b,this._priority)};d.prototype.pop=function(d){d=this._storage.pop(this._namespace+d);void 0===d?++this._miss:++this._hit;return d};d.prototype.clear=function(){this._storage.clear(this._namespace)};d.prototype.clearAll=function(){this._storage.clearAll()};d.prototype.getSize=function(){return this._storage.getSize()};d.prototype.getMaxSize=
function(){return this._storage.maxSize};d.prototype.getStats=function(){return this._storage.getStats()};d.prototype.resetStats=function(){this._storage.resetStats()};return d}();(function(d){var e=function(){function c(){this._db=new Map;this._miss=this._hit=this._age=this._size=0;this._maxSize=10485760;this._removeFuncs=[]}c.prototype.registerRemoveFunc=function(b,a){this._removeFuncs.push([b,a])};c.prototype.deregisterRemoveFunc=function(b){this._removeFuncs=this._removeFuncs.filter(function(a){return a[0]!==
b})};Object.defineProperty(c.prototype,"maxSize",{get:function(){return this._maxSize},set:function(b){this._maxSize=Math.max(b,0);this._size>this._maxSize&&this._removeEntries()},enumerable:!0,configurable:!0});c.prototype.put=function(b,a,c,d){if(c>this._maxSize){if(this._db.has(b)){var e=this._db.get(b);this._size-=e.size;this._db.delete(b)}this._notifyRemoved(b,a)}else!c||0>c?console.warn("Refusing to cache entry with invalid size "+c):(this._db.has(b)?(e=this._db.get(b),this._notifyRemoved(b,
e.entry),this._size+=c-e.size,e.entry=a,e.lastUsed=this._age+d,e.size=c):(this._db.set(b,{entry:a,size:c,lastUsed:this._age+d}),this._size+=c),++this._age,this._size>this._maxSize&&this._removeEntries())};c.prototype.pop=function(b){if(this._db.has(b)){var a=this._db.get(b);this._size-=a.size;this._db.delete(b);++this._hit;return a.entry}++this._miss};c.prototype.getSize=function(){return this._size};c.prototype.getStats=function(){var b=this,a={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/
1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},c={},d=this._age,e=this._age;this._db.forEach(function(a,b){d=Math.min(d,a.lastUsed);e=Math.max(e,a.lastUsed);g.forEach(function(d){d=d.namespace;if(k.startsWith(b,d))return c[d]=(c[d]||0)+a.size,!1})});a.Entries+=" / "+d+" - "+e;var h={};g.forEach(function(a){var b=a.namespace;!isNaN(a.hitRate)&&0<a.hitRate?(c[b]=c[b]||0,h[b]=Math.round(100*a.hitRate)+"%"):h[b]="0%"});var f=Object.keys(c);f.forEach(function(a){return c[a]=
c[a]/b._size*100});f.sort(function(a,b){return c[b]-c[a]});f.forEach(function(b){return a[b]=Math.round(c[b])+"% / "+h[b]});return a};c.prototype.resetStats=function(){this._hit=this._miss=0;g.forEach(function(b){return b.resetHitRate()})};c.prototype.clear=function(b){var a=this;this._db.forEach(function(c,d){k.startsWith(d,b)&&(a._size-=c.size,a._db.delete(d),a._notifyRemoved(d,c.entry))})};c.prototype.clearAll=function(){var b=this;this._db.forEach(function(a,c){b._notifyRemoved(c,a.entry)});this._size=
0;this._db.clear()};c.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)};c.prototype._notifyRemoved=function(b,a){this._removeFuncs.forEach(function(c){if(k.startsWith(b,c[0]))c[1](a)})};c.prototype._removeEntries=function(){var b=[];this._db.forEach(function(a,c){b.push([a.lastUsed,c])});b.sort(function(a,b){return a[0]-b[0]});for(var a=0;a<b.length;a++){var c=b[a][1],d=this._db.get(c);this._size-=d.size;this._db.delete(c);this._notifyRemoved(c,d.entry);if(this._size<=.9*this.maxSize)break}};
return c}();d.Storage=e})(m||(m={}));return m})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../request ../../../core/arrayUtils ../../../core/lang ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),function(m,f,k,e,g,d,h,c,b){var a;(function(a){a[a.QUEUED=1]="QUEUED";a[a.DOWNLOADING=2]="DOWNLOADING";a[a.CANCELLED=4]="CANCELLED"})(a||(a={}));return function(){function f(a){this.tasks=new Map;this.clientPromiseToTask=
new Map;this.loadQueue=new d(this.startLoading.bind(this),this.doneLoadingCallback,this,a)}f.prototype.destroy=function(){var a=this;this.tasks.forEach(function(b){for(var c=0,d=b.clientPromises;c<d.length;c++){var e=d[c];e.isRejected()||e.reject(b.url,null);a.cancelTask(e)}});this.loadQueue.clear();this.clientPromiseToTask=this.tasks=this.loadQueue=null};f.prototype.request=function(a,b,c){var d=this,e=new h.Promise(function(){d.cancel(e)});this.createOrUpdateTask(a,b,c,e);return e};f.prototype.createTask=
function(b,c,d,e,g){b={url:b,docType:c,clientType:d,key:e,result:null,status:a.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(b,g);this.tasks.set(e,b);this.loadQueue.push(b)};f.prototype.cancel=function(a){this.cancelTask(a)};f.prototype.hasPendingDownloads=function(){return 0<this.tasks.size};Object.defineProperty(f.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});f.prototype.taskKey=
function(a,b,c){return a+":"+b+":"+c};f.prototype.updateTask=function(a,b){this.clientPromiseToTask.set(b,a);a.clientPromises.push(b)};f.prototype.createOrUpdateTask=function(a,b,c,d){var e=this.taskKey(a,b,c),g=this.tasks.get(e);g?this.updateTask(g,d):this.createTask(a,b,c,e,d)};f.prototype.cancelTask=function(b){var c=this.clientPromiseToTask.get(b);c&&(e.removeUnordered(c.clientPromises,b),this.clientPromiseToTask.delete(b),0===c.clientPromises.length&&(c.status===a.DOWNLOADING&&(this.loadQueue.workerCancelled(c),
c.status=a.CANCELLED,c.downloadObj.cancel(),c.downloadObj=null),c.status=a.CANCELLED,this.tasks.delete(c.key)))};f.prototype.doneLoadingCallback=function(c,d){b.assert(c.status===a.DOWNLOADING);for(var e=c.result,h=0,f=c.clientPromises;h<f.length;h++){var l=f[h];this.clientPromiseToTask.delete(l);d?l.isRejected()||l.reject(c.url,d):(e||(e=g.clone(c.result)),l.done(c.url,e),e instanceof HTMLImageElement||(e=null))}this.tasks.delete(c.key)};f.prototype.startLoading=function(b,d){if(b.status===a.CANCELLED)return!1;
b.status=a.DOWNLOADING;var e,g;switch(b.docType){case "binary":g="array-buffer";e=0;break;case "image":g="image";break;default:g="json"}b.startTime=c.now();b.downloadObj=k(b.url,{responseType:g,timeout:e});b.downloadObj.then(function(a){b.duration=c.now()-b.startTime;b.size="binary"===b.docType?a.data.byteLength:0;b.result=a.data;d(b)},function(a){b.downloadObj.isCanceled()||d(b,a)});return!0};return f}()})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports",
"../../../core/arrayUtils","../webgl-engine/lib/Util"],function(m,f,k,e){return function(){function g(d,e,c,b){this.workerFunc=d;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=0;for(var a in b)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=b[a],this.type2id[a]=
this.robin++,this.maxTotalNumWorkers+=b[a];this.numTypes=this.tasks.length;this.robin=0;var g=this;this.taskCallback=function(a){a._cancelledInQueue||(e.apply(c,arguments),g.taskFinished(a))}}g.prototype.setWorkerQuota=function(d){e.assert(k.equals(Object.keys(this.typeWorkerAllication),Object.keys(d)));this.typeWorkerAllication=d;this.maxTotalNumWorkers=0;for(var g in d)this.typeWorkerQuota[this.type2id[g]]=d[g],this.maxTotalNumWorkers+=d[g]};g.prototype.setWorkerFunc=function(d){this.workerFunc=
d};g.prototype.push=function(d){var e=this.type2id[d.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[e]++,this.totalNumWorkers++,this.workerFunc(d,this.taskCallback)):this.tasks[e].push(d)};g.prototype._getStatsForType=function(d){d=this.type2id[d];return{quota:this.typeWorkerQuota[d],workers:this.typeNumWorkers[d],queueSize:this.tasks[d].length,requestStats:this.typeStatistics[d]}};g.prototype.removeTasks=function(d,e){for(var c=[],b=0,a=this.tasks[this.type2id[e]];b<
a.length;b++){var g=a[b];-1===d.indexOf(g)&&c.push(g)}this.tasks[this.type2id[e]]=c};g.prototype.workerCancelled=function(d){this.taskFinished(d);d._cancelledInQueue=!0};g.prototype.clear=function(){for(var d=0;d<this.tasks.length;d++)this.tasks[d]=[]};g.prototype.taskFinished=function(d){var g=this.type2id[d.clientType];this.typeNumWorkers[g]--;this.totalNumWorkers--;this.typeStatistics[g].requests++;this.typeStatistics[g].size+=d.size||0;this.typeStatistics[g].duration+=d.duration||0;this.typeStatistics[g].speed=
0<this.typeStatistics[g].duration?this.typeStatistics[g].size/this.typeStatistics[g].duration:0;e.assert(0<=this.typeNumWorkers[g]);this.next()};g.prototype.next=function(){var d=this.robin,e=!1;do this.typeNumWorkers[d]<this.typeWorkerQuota[d]&&this.processQueue(d)&&(e=!0),d=(d+1)%this.numTypes;while(!e&&d!==this.robin);if(!e){do this.processQueue(d)&&(e=!0),d=(d+1)%this.numTypes;while(!e&&d!==this.robin)}this.robin=d};g.prototype.processQueue=function(d){for(;0<this.tasks[d].length;)if(this.workerFunc(this.tasks[d].shift(),
this.taskCallback))return this.typeNumWorkers[d]++,this.totalNumWorkers++,!0;return!1};return g}()})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(m,f){return function(){function f(e,g,d){this._clientType=e;this._loader=g;this._activeRequests=null;d&&d.trackRequests&&(this._activeRequests=new Map)}f.prototype.request=function(e,g){var d=this;g=this._loader.request(e,g,this._clientType);if(this._activeRequests){this._activeRequests.set(e,g);var h=function(){d._activeRequests.delete(e)};
g.then(h,h)}return g};f.prototype.cancelRequest=function(e){this._loader.cancel(e)};f.prototype.cancelAll=function(){var e=this;this._activeRequests&&(this._activeRequests.forEach(function(g){e._loader.cancel(g)}),this._activeRequests.clear())};f.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return f}()})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper dojo/promise/all ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DWebStyleSymbol ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTexture ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y){Object.defineProperty(f,"__esModule",{value:!0});m=function(h){function f(a){a=h.call(this)||this;a.labelStageLayer=null;a.labels={};a.labelsToAdd={};a.labelsToRemove={};a.labelingContexts=[];a.idHint="__labeler";a.dirty=!1;return a}k(f,h);m=f;f.prototype.setup=function(){var a=this;this.handles||(this.handles=new c,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()})]));this.labelStageLayer||(this.labelStageLayer=
new x(this.idHint,{isPickable:!1},this.idHint+"_labels"),this.view._stage.add(u.ModelContentType.LAYER,this.labelStageLayer),this.view._stage.addToViewContent([this.labelStageLayer.id]),this.textTextureAtlas=new y(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new v(this.view._stage),this.calloutMaterialCollection=new v(this.view._stage));this.handles.add(this.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}))};
f.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.labelStageLayer&&(this.view._stage.removeFromViewContent([this.labelStageLayer.id]),this.view._stage.remove(u.ModelContentType.LAYER,this.labelStageLayer.id),this.labelStageLayer=null,this.textTextureAtlas.dispose(),this.textTextureAtlas=null,this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null,this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=
[];this.labels={};this.labelsToAdd={};this.labelsToRemove={}};f.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};f.prototype.activateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]=c;c.graphics3DGraphic.setVisibilityFlag(0,!0,1)}a.active=!0};f.prototype.deactivateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];c.graphics3DGraphic.setVisibilityFlag(0,!1,1);c.rendered&&(this.labelsToRemove[b]=a.labels[b]);
delete this.labels[b];delete this.labelsToAdd[b]}a.active=!1};f.prototype.addLabelTextureToAtlas=function(a){for(var b=0,c=0;c<a.graphics3DGraphic._labelGraphics.length;c++){var d=a.graphics3DGraphic._labelGraphics[c];if(d._labelClass){var e=a.textTextures[b];b++;e&&this.textTextureAtlas.addTextTexture(e,d.stageObject)}}a.rendered=!0};f.prototype.removeLabelTextureFromAtlas=function(a){for(var b=0;b<a.graphics3DGraphic._labelGraphics.length;b++)a.textTextures[b]&&this.textTextureAtlas.removeTextTexture(a.textTextures[b],
a.graphics3DGraphic._labelGraphics[b].stageObject);a.rendered=!1};f.prototype.needsIdleUpdate=function(){return this.isDirty};f.prototype.idleUpdate=function(a){if(this.view.ready){for(var b=!!a,c=!1,d=0,e=this.labelingContexts;d<e.length;d++){var g=e[d];if(this.isActiveLabelingContext(g)){if(!this.hasValidLabelClassContext(g)){if(this.hasInvalidLabelClassContext(g)){this.deactivateLabelingContext(g);continue}this.createLabelClassContext(g);if(this.hasPendingLabelClassContext(g)){c=!0;continue}if(!this.hasValidLabelClassContext(g))continue}for(var h in g.labelsToInitialize){if(b&&
a.done())return;var f=g.labelsToInitialize[h];!f.hasGraphics3DResources&&this.createGraphics3DResources(f)&&(this.labels[h]=f,b&&this.view.deconflictor.setDirty());f.hasGraphics3DResources&&!f.hasTextTextureResources&&f.visible&&this.createTextTextureResources(f);(f.visible&&f.hasTextTextureResources||!f.visible&&f.hasGraphics3DResources)&&delete g.labelsToInitialize[h]}}}for(h in this.labelsToRemove)this.removeLabelTextureFromAtlas(this.labelsToRemove[h]),delete this.labelsToRemove[h];for(h in this.labelsToAdd)this.addLabelTextureToAtlas(this.labelsToAdd[h]),
delete this.labelsToAdd[h];c||(this.dirty=!1)}};f.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()};f.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};f.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};f.prototype.createLabelClassContext=function(a){if(a.labelClassPromise)return a.labelClassPromise;a.labelClassPromise=a.layer.when(function(){a.scaleVisibility&&
a.scaleVisibility.updateScaleRangeActive();var b=a.graphics3DCore,c=b.layer.labelingInfo&&b.layer.labelingInfo.filter(function(a){return!!a.symbol});if(!c||0===c.length)return null;var d=Array(c.length),c=c.map(function(a,c){var e=a.symbol,g;g=b.getOrCreateGraphics3DSymbol(e);g=g instanceof r?g.graphics3DSymbol:g;var h=null;p.isCalloutSupport(e)&&e.hasVisibleCallout()&&(h=q.make(e,b.symbolCreationContext));d[c]={labelClass:a,graphics3DSymbol:g,graphics3DCalloutSymbolLayer:h,options:a.getOptions()};
return g});return g(c).then(function(){return d})}).then(function(b){b&&(a.labelClassContexts=b)}).catch(function(){a.labelClassContexts=null});return a.labelClassPromise};f.prototype.destroyLabelClassContext=function(a){a.labelClassContexts=[];a.labelClassPromise=null};f.prototype.createLabelText=function(a,b,c,d){if(!n.evaluateWhere(b.where,a.attributes))return null;b=b.getLabelExpression();return b.expression?n.buildLabelText(b.expression,a,d.fields,c):null};f.prototype.createTextSymbolGraphic=
function(a,b,c,d,e){a={text:a,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,needsOffsetAdjustment:c.needsOffsetAdjustment,centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:w.LABELS_SHOW_BORDER};m.tmpGraphicCreationContext.graphic=b;m.tmpGraphicCreationContext.renderingInfo=null;m.tmpGraphicCreationContext.layer=d;return e.createGraphics3DGraphic(m.tmpGraphicCreationContext,a,this.hudMaterialCollection,
this.textTextureAtlas)};f.prototype.createLineCalloutGraphic=function(a,b,c,d,e){m.tmpGraphicCreationContext.graphic=a;m.tmpGraphicCreationContext.renderingInfo={symbol:b,needsOffsetAdjustment:d.needsOffsetAdjustment,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};m.tmpGraphicCreationContext.layer=e;return c.createGraphics3DGraphic(m.tmpGraphicCreationContext)};
f.prototype.createGraphics3DResources=function(a){var b=a.labelingContext,c=!1,d=a.graphics3DGraphic,e=d.graphic,g=b.labelClassContexts,h=b.layer,f=this.labelsEnabled(b);if(g&&0!==g.length&&d._graphics[0]){for(var l=0;l<g.length;l++){var k=g[l],m=k.labelClass,n=this.createLabelText(e,m,k.options,h);if(n){var p=null;k.graphics3DSymbol&&k.graphics3DSymbol.symbol&&"label-3d"===k.graphics3DSymbol.symbol.type&&(p=k.graphics3DSymbol.symbol);var q=k.graphics3DSymbol.childGraphics3DSymbols[0],r=t.get({graphics3DGraphic:d,
labelSymbol:p,labelClass:k.labelClass});if(q&&r.isValid){if(c=this.createTextSymbolGraphic(n,e,r,h,q)){if(c._labelClass=m,d.addLabelGraphic(c,this.labelStageLayer,this.view._stage),b.spatialIndex&&b.spatialIndex.add(d),d.setVisibilityFlag(0,f,1),d.setVisibilityFlag(1,void 0,1),d.setVisibilityFlag(2,!1,1),c=!0,k.graphics3DCalloutSymbolLayer&&r.hasLabelVerticalOffset&&(e=this.createLineCalloutGraphic(e,p,k.graphics3DCalloutSymbolLayer,r,h)))k.calloutSymbolLayerIndex=d._labelGraphics.length,d.addLabelGraphic(e,
this.labelStageLayer,this.view._stage)}else return!1;break}}}b.scaleVisibility&&c&&b.scaleVisibility.updateGraphicLabelScaleVisibility(d);return a.hasGraphics3DResources=!0}};f.prototype.destroyGraphics3DResources=function(a){a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};f.prototype.createTextTextureResources=function(b){var c=b.labelingContext,e=b.graphics3DGraphic,g=c.labelClassContexts,c=c.layer,h=e.graphic;if(g&&0!==g.length&&e._graphics[0]){for(e=0;e<g.length;e++){var f=
g[e],l=this.createLabelText(h,f.labelClass,f.options,c)||h.symbol&&h.symbol.text;if(l&&!(1>l.length)){var f=f.graphics3DSymbol.childGraphics3DSymbols[0].symbol,k=f.material?d.toUnitRGBA(f.material.color):A,m=f.halo&&f.halo.color&&0<f.halo.size,n=m?d.toUnitRGBA(f.halo.color):A,m=m?a.pt2px(f.halo.size):0,p=a.pt2px(f.size)||12,l=new z(l,{size:p,color:k,font:{family:f.font&&f.font.family?f.font.family:"sans-serif",weight:f.font&&f.font.weight?f.font.weight:"normal",style:f.font&&f.font.style?f.font.style:
"normal"},halo:{size:m,color:n}},c.id+"_label_"+h.uid);b.textTextures.push(l)}}b.hasTextTextureResources=!0}};f.prototype.destroyTextTextureResources=function(a){a.textTextures=[];a.hasTextTextureResources=!1};f.prototype.addGraphic=function(a,b){var c={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:b,textTextures:[]};b=b.graphic.uid;a.labels[b]=c;this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.createGraphics3DResources(c)?
this.labels[b]=c:a.labelsToInitialize[b]=c;a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};f.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.labels[b];c&&(this.labels[b]&&(this.removeLabelTextureFromAtlas(c),delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]),c.hasTextTextureResources&&this.destroyTextTextureResources(c),c.hasGraphics3DResources&&this.destroyGraphics3DResources(c),delete a.labels[b],delete a.labelsToInitialize[b],
a=a.graphics3DCore.asyncUpdates,this.setDirty(a),this.view.deconflictor.setDirty({async:a}))};f.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible&&null!=a.layer.labelingInfo&&0<a.layer.labelingInfo.length};f.prototype.elevationInfoChange=function(a){for(var b=function(b){b.graphics3DSymbol.layerPropertyChanged("elevationInfo",{});if(b.graphics3DCalloutSymbolLayer){var c={},d;for(d in a.labels){var e=a.labels[d].graphics3DGraphic;c[e.graphic.uid]=e}b.graphics3DCalloutSymbolLayer.layerPropertyChanged("elevationInfo",
c,function(a){return a._labelGraphics[b.calloutSymbolLayerIndex]})}},c=0,d=a.labelClassContexts;c<d.length;c++)b(d[c])};f.prototype.visibilityInfoChange=function(a){var b=a.layer.labelsVisible;b&&!a.active&&this.activateLabelingContext(a);!b&&a.active&&this.deactivateLabelingContext(a);a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};f.prototype.resetLabels=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]&&(this.removeLabelTextureFromAtlas(c),
delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]);c.hasTextTextureResources&&this.destroyTextTextureResources(c);c.hasGraphics3DResources&&this.destroyGraphics3DResources(c);c.visible=!1;c.rendered=!1;a.labelsToInitialize[b]=c}this.destroyLabelClassContext(a);this.labelStageLayer.invalidateSpatialQueryAccelerator();a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};f.prototype.findLabelingContext=function(a){for(var b=0;b<this.labelingContexts.length;b++)if(this.labelingContexts[b].graphics3DCore===
a)return this.labelingContexts[b];return null};f.prototype.addGraphicsOwner=function(a,c,d){var e=this;if(!this.findLabelingContext(a)){var g={graphics3DCore:a,layer:a.layer,scaleVisibility:c,spatialIndex:d,active:a.layer.labelsVisible,labelClassPromise:null,labelClassContexts:[],labels:{},labelsToInitialize:{}};this.labelingContexts.push(g);this.setDirty();return{addGraphic:function(a){return e.addGraphic(g,a)},removeGraphic:function(a){return e.removeGraphic(g,a)},layerLabelsEnabled:function(){return e.labelsEnabled(g)},
labelingInfoChange:function(a){if(a){for(var c=0;c<a.length;c++){var d=g.labels[a[c]];d&&(e.removeGraphic(g,d.graphics3DGraphic),e.addGraphic(g,d.graphics3DGraphic))}return b.create(function(a){return!0})}e.visibilityInfoChange(g);e.resetLabels(g);return e.createLabelClassContext(g)},elevationInfoChange:function(){e.elevationInfoChange(g)},visibilityInfoChange:function(){e.visibilityInfoChange(g)},clear:function(){e.resetLabels(g)}}}};f.prototype.removeGraphicsOwner=function(a){if(a=this.findLabelingContext(a)){var b=
this.labelingContexts.indexOf(a);this.labelingContexts.splice(b,1);for(var c in a.labels)this.removeGraphic(a,a.labels[c].graphics3DGraphic);this.setDirty()}};f.prototype.setLabelGraphicVisibility=function(a,b){a=a.graphic.uid;var c=this.labels[a];c&&(b&&!c.rendered?(this.labelsToAdd[a]=c,c.hasTextTextureResources||(c.labelingContext.labelsToInitialize[a]=c)):!b&&c.rendered&&(this.labelsToRemove[a]=c),c.visible=b,this.setDirty(c.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(f.prototype,
"labelStageLayerId",{get:function(){return this.labelStageLayer.id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isDirty",{get:function(){return this.dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});f.prototype.setDirty=function(a){void 0===a&&(a=!0);this.dirty=!0;a||this.idleUpdate()};Object.defineProperty(f.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()})},
enumerable:!0,configurable:!0});var m;f.tmpGraphicCreationContext={graphic:null,renderingInfo:null,layer:null};e([l.property({constructOnly:!0})],f.prototype,"view",void 0);e([l.property({type:Boolean,readOnly:!0})],f.prototype,"updating",null);return f=m=e([l.subclass()],f)}(l.declared(h));f.Labeler=m;var A=[0,0,0,1]})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/Logger ../../../../core/scheduling ./Graphics3DWebStyleSymbol ../../lib/gl-matrix ../../webgl-engine/materials/HUDMaterial".split(" "),
function(m,f,k,e,g,d,h){function c(c,e){switch(e.graphics3DGraphic.graphic.geometry.type){case "polyline":case "polygon":case "extent":case "multipoint":c.anchor="center";break;case "point":var g=e.graphics3DGraphic,f=a(g.graphics3DSymbol).symbol.symbolLayers.getItemAt(0),g=g.getCenterObjectSpace();d.vec3d.set(g,c.translation);switch(f.type){case "icon":case "text":g=e.graphics3DGraphic;f=g._graphics[0].getScreenSize();g.isDraped()?c.hasLabelVerticalOffset||(c.anchor="center"):(g=void 0,void 0===
g&&(g=x),e=e.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].materials[0],e instanceof h?(e=e.getParams().anchorPos,g[0]=2*(e[0]-.5),g[1]=2*(e[1]-.5)):(g[0]=0,g[1]=0),e=g,u[0]=f[0]/2*(c.normalizedOffset[0]-e[0]),u[1]=f[1]/2*(c.normalizedOffset[1]-e[1]),c.screenOffset[0]=u[0],c.hasLabelVerticalOffset?(c.centerOffset[1]=u[1],c.centerOffsetUnits="screen"):c.screenOffset[1]=u[1]);break;case "object":b(c,e)}break;case "mesh":b(c,e)}}function b(a,b){b=b.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace();
b=[b[3]-b[0],b[4]-b[1],b[5]-b[2]];a.centerOffset[0]=1.1*Math.max(b[0],b[1])/2*a.normalizedOffset[0];var c=b[2]/2*a.normalizedOffset[1]+a.translation[2];a.translation[2]=c*(1.1-1);a.elevationOffset=c;b=d.vec3d.length(b);a.centerOffset[2]=1.1*b/2*a.normalizedOffset[2]}function a(a){return a instanceof g?a.graphics3DSymbol:a}function l(b,c){var d=c.labelSymbol;c=c.graphics3DGraphic;var e=a(c.graphics3DSymbol).symbol;if("point-3d"===e.type&&e.supportsCallout()&&e.hasVisibleVerticalOffset()&&!c.isDraped())b.verticalOffset=
n(e.verticalOffset);else if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==e.type||!e.supportsCallout()||!e.verticalOffset||c.isDraped())){a:switch(b.placement){case "above-center":c=!0;break a;default:c=!1}c?(b.verticalOffset=n(d.verticalOffset),b.anchor="bottom",b.normalizedOffset=[0,b.normalizedOffset[1],0],b.hasLabelVerticalOffset=!0):(p.error("verticalOffset","Callouts and vertical offset on labels are currently only supported with above-center label placement (not with "+b.placement+" placement)"),
b.isValid=!1)}}function n(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(f,"__esModule",{value:!0});var p=k.getLogger("esri.views.3d.layers.graphics.labelPlacement"),q=null;f.get=function(a){var b=a.labelClass.labelPlacement,d=r[b];d||(null!=b&&null==q&&(p.warn("labelPlacement","'"+b+"' is not a valid label placement"),q=e.schedule(function(){q.remove();q=null})),d=r["default"]);var b=a.graphics3DGraphic._graphics[0],g=
b.graphics3DSymbolLayer.getGraphicElevationContext(a.graphics3DGraphic.graphic),d={placement:d.placement,anchor:d.anchor,normalizedOffset:d.normalizedOffset,needsOffsetAdjustment:"draped"===b.type?void 0:g.hasOffsetAdjustment,verticalOffset:null,screenOffset:[0,0],centerOffset:[0,0,0,-1],centerOffsetUnits:"world",translation:[0,0,0],elevationOffset:0,hasLabelVerticalOffset:!1,isValid:!0};l(d,a);c(d,a);return d};var r={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},
"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},
"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},t={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],
"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};m=function(a){var b=r[a];t[a].forEach(function(a){r[a]=b})};for(var w in t)m(w);Object.freeze&&(Object.freeze(r),Object.keys(r).forEach(function(a){Object.freeze(r[a]);Object.freeze(r[a].normalizedOffset)}));var u=[0,0],x=[0,0]})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports",
"./ModelContentType"],function(m,f,k){return function(){function e(e){this.materials={};this.stage=e}e.prototype.getMaterial=function(e){return this.materials[e]};e.prototype.addMaterial=function(e,d){this.materials[e]=d;this.stage.add(k.MATERIAL,d)};e.prototype.dispose=function(){for(var e in this.materials)this.stage.remove(k.MATERIAL,this.materials[e].id);this.materials={}};return e}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/arrayUtils ../../support/mathUtils ./ModelContentType ./Texture ../../../webgl/Texture".split(" "),
function(m,f,k,e,g,d,h){var c={budget:null,repackingEnabled:!0};return function(){function b(a,b){this.dirty=!1;this.elementsToAdd={};this.elementsToRemove={};this.elementsToRender={};this.elements={};this.stageObjects={};this.id=d.idGen.gen(a);this.stage=b._stage;this.controller=b.resourceController;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");this.stage.add(g.TEXTURE,this);a=this.computeAtlasResolution(b.width,b.height);this.createAtlasRegion(a);this.update2DCanvasSize()}
b.prototype.setUnloadFunc=function(a){this.unloadFunc=a};b.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};b.prototype.deferredLoading=function(){return!1};b.prototype.getWidth=function(){return this.atlas.size.width};b.prototype.getHeight=function(){return this.atlas.size.height};b.prototype.initializeThroughRender=function(a,b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;return this.glTexture=new h(a,
b,this.canvas)};b.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.glTexture&&(this.glTexture=null,this.stage.remove(g.TEXTURE,this.id))};b.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};b.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",
this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};b.prototype.generateTextId=function(a){return JSON.stringify(a.getParams())+"_"+a.getText()};b.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};b.prototype.computeAtlasResolution=function(a,b){a=Math.max(a,b);a=e.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};b.prototype.resizeAtlas=function(a,b){b=b||a;var c=
this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,b);this.update2DCanvasSize()};b.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=0;a.cursor.y=0;a.lineHeight=0};b.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};b.prototype.getExpectedAtlasUsage=function(){var a=Object.keys(this.elementsToRemove).length,b=Object.keys(this.elementsToAdd).length,c=Object.keys(this.elements).length;
return this.getAtlasUsage()/c*(c+b-a)};b.prototype.addAtlasElement=function(a,b,c,d,e){var g=this.atlas;a.placement.offset.x=g.cursor.x;a.placement.offset.y=g.cursor.y;a.placement.size.width=b;a.placement.size.height=c;a.placement.uvMinMax=[a.placement.offset.x/g.size.width,1-(a.placement.offset.y+c)/g.size.height,(a.placement.offset.x+b)/g.size.width,1-a.placement.offset.y/g.size.height];g.cursor.x+=d;g.lineHeight=Math.max(g.lineHeight,e)};b.prototype.removeAtlasElement=function(a){if(a&&this.elements[a.textId]){var b=
a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);delete this.elements[a.textId]}};b.prototype.addStageObject=function(a,b){this.stageObjects[a]||(this.stageObjects[a]=[]);-1===this.stageObjects[a].indexOf(b)&&this.stageObjects[a].push(b)};b.prototype.removeStageObject=function(a,b){this.stageObjects[a]&&k.removeUnordered(this.stageObjects[a],b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};b.prototype.processAdditionRequest=
function(a,b){var c=this.atlas,d=a.textId,e=a.textTexture.renderedWidth,g=a.textTexture.renderedHeight,h=e+2,f=g+2+2;b=b.repackingEnabled;if(c.cursor.x+h<c.size.width&&c.cursor.y+f<c.size.height)this.addAtlasElement(a,e,g,h,f),this.elements[d]=a,this.elementsToRender[d]=a,delete this.elementsToAdd[d];else if(c.cursor.y+f+c.lineHeight<c.size.height)c.cursor.x=2,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,e,g,h,f),this.elements[d]=a,this.elementsToRender[d]=a,delete this.elementsToAdd[d];
else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);for(var l in this.elementsToRemove)0===this.stageObjects[l].length&&this.removeAtlasElement(this.elementsToRemove[l]),delete this.elementsToRemove[l];if(!b||!d&&.95<a&&4096===c.size.width)return 0;for(var k in this.elements)c=this.elements[k],c.rendered=!1,this.elementsToAdd[k]=c,delete this.elements[k];this.resetAtlasCursor();this.elementsToRender={};return 1}return 0};b.prototype.processRenderingRequest=
function(a){var b=a.textId;this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textTexture.renderText(a.placement.size.width,a.placement.size.height,this.ctx,a.placement.offset.x,a.placement.offset.y);for(var c=0,b=this.stageObjects[b];c<b.length;c++){var d=b[c];d.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);d.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.width,a.placement.size.height]);
d.geometryVertexAttrsUpdated(0)}a.rendered=!0};b.prototype.run=function(a){if(this.dirty&&this.glTexture){var b=a.budget,c;for(c in this.elementsToAdd)if(this.elements[c]&&this.elements[c].rendered){for(var d=0,e=this.stageObjects[c];d<e.length;d++){var g=e[d],h=g.geometries[0].data.vertexAttributes;h.uv0.data=new Float32Array(this.elements[c].placement.uvMinMax);h.size.data=new Float32Array([this.elements[c].placement.size.width,this.elements[c].placement.size.height]);g.geometryVertexAttrsUpdated(0)}delete this.elementsToAdd[c]}else if(1===
this.processAdditionRequest(this.elementsToAdd[c],a)){a.budget=null;a.repackingEnabled=!1;this.run(a);return}a=!1;for(c in this.elementsToRender){if(b&&!b.remaining()){a&&this.glTexture.setData(this.canvas);return}this.processRenderingRequest(this.elementsToRender[c]);delete this.elementsToRender[c];a=!0}a&&this.glTexture.setData(this.canvas);this.dirty=!1;this.frameWorker.remove();this.frameWorker=null}};b.prototype.makeRunContext=function(a){void 0===a&&(a=null);c.budget=a;c.repackingEnabled=!0;
return c};b.prototype.addTextTexture=function(a,b){var c=this.generateTextId(a);this.elementsToAdd[c]||(this.elementsToAdd[c]={textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0},uvMinMax:[]},textTexture:a,rendered:!1});this.addStageObject(c,b);delete this.elementsToRemove[c];this.setDirty()};b.prototype.removeTextTexture=function(a,b){a=this.generateTextId(a);this.elementsToRemove[a]=this.elements[a];this.removeStageObject(a,b);delete this.elementsToAdd[a]};Object.defineProperty(b.prototype,
"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});b.prototype.setDirty=function(){var a=this;this.dirty||(this.dirty=!0,this.frameWorker=this.controller.registerFrameWorker(function(b){return a.run(a.makeRunContext(b))}))};return b}()})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){Object.defineProperty(f,"__esModule",{value:!0});var t=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");m=function(c){function g(a){a=c.call(this,a)||this;a.tiles=new d;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new h;a.clients=new Set;a.geometryEnginePromise=null;a._dirty=!1;return a}k(g,c);Object.defineProperty(g.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))t.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||
!this.tilingScheme)return null;var a=n.create();r.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),a||this.setDirty())},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||null!=this.geometryEnginePromise||this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var c=this;this.throttledUpdate=b.throttle(this.setDirty,function(){return c.notifyChange("updating")},
1E3,this);var d=this.disableThrottling?function(){return c.setDirty}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return c.tileMeasurements=null},!0));this.handles.add(a.init(this,"changeId",d));this.resourceController&&(this._frameWorker=this.resourceController.registerFrameWorker(function(){return c.update()}))};g.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),this.handles=
null)};g.prototype.addClient=function(){var a=this,b=w++;this.clients.add(b);1===this.clients.size&&this.setDirty();return{remove:function(){return a.removeClient(b)}}};g.prototype.removeClient=function(a){this.clients.delete(a);this.hasClients||this.setDirty()};Object.defineProperty(g.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});g.prototype.setDirty=function(){this.suspended?this.notifyChange("updating"):(this._dirty=!0,this._frameWorker||this.update())};
g.prototype.update=function(){if(this._dirty&&!this.suspended){this._dirty=!1;if(this.tilingScheme&&this.hasClients){this.tileMeasurements||(this.tileMeasurements=new q.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:x}));var a=this.cameraOnSurface.location;this.tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this.updateTiles(this.subdivideTilesForView(this.getRootTiles()));
this.tileMeasurements.end()}else this.tiles.removeAll(),this.idToTile.clear();this.notifyChange("updating")}};g.prototype.getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new p.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};g.prototype.purgeHorizonTiles=function(a){a.sort(function(a,b){return b.measures.screen.rect[1]-a.measures.screen.rect[1]});n.empty(u);for(var b=0;b<a.length;b++)if(n.expand(u,a[b].measures.screen.rect),n.height(u)>x)return a.slice(b);
return[]};g.prototype.subdivideTilesForView=function(a){a=a.slice();for(var b=[];0<a.length;){var c=a.pop();if(!this.filterExtentRect||n.intersects(this.filterExtentRect,c.extent))this.tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),a.push.apply(a,c.getChildren())):b.push(c))}return this.purgeHorizonTiles(b)};g.prototype.updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=
b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){if(a.used)return!1;b.idToTile.delete(a.id);return!0});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};g.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};
e([l.property({constructOnly:!0})],g.prototype,"resourceController",void 0);e([l.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);e([l.property({constructOnly:!0})],g.prototype,"tilingSchemeOwner",void 0);e([l.property({constructOnly:!0})],g.prototype,"cameraOnSurface",void 0);e([l.property({constructOnly:!0})],g.prototype,"focus",void 0);e([l.property({constructOnly:!0})],g.prototype,"viewState",void 0);e([l.property()],g.prototype,"tiles",void 0);e([l.property()],g.prototype,
"tileSize",void 0);e([l.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],g.prototype,"tilingScheme",null);e([l.property()],g.prototype,"filterExtent",null);e([l.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],g.prototype,"filterExtentRect",null);e([l.property({readOnly:!0,dependsOn:["filterExtentRect"]})],g.prototype,"rootTileIds",null);e([l.property({value:!1})],g.prototype,"suspended",null);e([l.property()],g.prototype,"updating",null);e([l.property({readOnly:!0,
dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"]})],g.prototype,"changeId",null);e([l.property({constructOnly:!0})],g.prototype,"disableThrottling",void 0);return g=e([l.subclass()],g)}(l.declared(g));f.FeatureTileTree3D=m;var w=0,u=n.create(),x=10;f.default=m})},"esri/core/throttle":function(){define(["require","exports"],function(m,f){function k(e,g,d,h){var c=null,b=1E3;"number"===typeof g?(b=g,h=d):(c=g,b=d);var a=0,f,k=function(){a=
0;e.apply(h,f)};g=function(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];c&&c.apply(h,d);f=d;b?a||(a=setTimeout(k,b)):k()};g.remove=function(){a&&(clearTimeout(a),a=0)};g.forceUpdate=function(){a&&(clearTimeout(a),k())};g.hasPendingUpdates=function(){return!!a};return g}Object.defineProperty(f,"__esModule",{value:!0});f.throttle=k;f.default=k})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],
function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d,h,c){void 0===c&&(c=null);this.lij=[0,0,0];this.extent=k.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:k.create()},distance:0,shouldSplit:!1};this.used=!1;c&&this.acquire(e,d,h,c)}e.prototype.acquire=function(g,d,h,c){this.tilingScheme=c;this.id=e.id(g,d,h);this.lij[0]=g;this.lij[1]=d;this.lij[2]=h;c.getExtent(g,d,h,this.extent);this.resolution=c.resolutionAtLevel(g)};
e.prototype.release=function(){this.tilingScheme=null};e.prototype.getChildren=function(g){var d=this.lij[0]+1,h=2*this.lij[1],c=2*this.lij[2];return g?(g[0].acquire(d,h,c,this.tilingScheme),g[1].acquire(d,h+1,c,this.tilingScheme),g[2].acquire(d,h,c+1,this.tilingScheme),g[3].acquire(d,h+1,c+1,this.tilingScheme),g):[new e(d,h,c,this.tilingScheme),new e(d,h+1,c,this.tilingScheme),new e(d,h,c+1,this.tilingScheme),new e(d,h+1,c+1,this.tilingScheme)]};e.prototype.copyMeasurementsFrom=function(e){this.measures.visibility=
e.measures.visibility;this.measures.shouldSplit=e.measures.shouldSplit;this.measures.distance=e.measures.distance;k.set(e.measures.screen.rect,this.measures.screen.rect)};e.id=function(e,d,h){return e+"/"+d+"/"+h};return e}();f.FeatureTileDescriptor3D=m;f.default=m})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../lib/gl-matrix ../../support/geometryUtils".split(" "),function(m,
f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(a){this.pointOfInterestInMap=[0,0];this.screenRect=k.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new e.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}f.prototype.begin=function(a,b,c){this.camera=a;this.z=c;this.pointOfInterestInMap[0]=b.x;this.pointOfInterestInMap[1]=
b.y;k.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(a,c)};f.prototype.end=function(){this.visibility.end()};f.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};f.prototype.updateDistanceMeasure=function(a){a.measures.distance=k.distance(a.extent,this.pointOfInterestInMap)};f.prototype.updateScreenMeasure=function(a){var c=b,d=1<<c,e=a.measures.screen.rect;
k.empty(e);for(var g=0,h=a.lij[0]+c,f=a.lij[1]<<c,c=a.lij[2]<<c,l=this.tileSizeWithBias(a),l=l*l,m=!1,n=0;n<d;n++){for(var p=0;p<d&&!(m=this.computeScreenArea(a,h,f+n,c+p,e),g+=m.area,m=g>l&&k.height(e)>this.maxVerticalScreenSize);p++);if(m)break}a.measures.shouldSplit=g>l};f.prototype.tileSizeWithBias=function(b){return 1===b.measures.visibility?this.tileSize*a:this.tileSize};f.prototype.computeScreenArea=function(a,b,e,g,f){var m=l.points;this.projectToScreen(b,e,g,1===a.measures.visibility,m);
k.empty(h);for(a=0;4>a;a++)k.expandPointInPlace(h,m[a]);k.expand(f,h);k.intersection(h,this.screenRect,c);l.screenOverlap=k.area(c)/k.area(h);l.area=d.triangle.areaPoints2d(m[0],m[1],m[2])+d.triangle.areaPoints2d(m[0],m[2],m[3]);return l};f.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,n);this.toRenderCoords(n,0,3,q[0]);this.toRenderCoords(n,2,3,q[1]);this.toRenderCoords(n,2,1,q[2]);this.toRenderCoords(n,0,1,q[3]);d&&(this.projectToPlane(q,
this.camera.frustumPlanes[4]),this.projectToPlane(q,this.camera.frustumPlanes[3]),this.projectToPlane(q,this.camera.frustumPlanes[2]));for(a=0;4>a;a++)this.camera.projectPoint(q[a],e[a])};f.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)r[c]=d.plane.distance(b,a[c]);c=Math.max(r[0],r[1],r[2],r[3]);if(0<c)for(b=g.vec3d.scale(b,-c,p),c=0;4>c;c++)g.vec3d.add(a[c],b)};f.prototype.toRenderCoords=function(a,b,c,d){p[0]=a[b];p[1]=a[c];p[2]=this.z;this.renderCoordsHelper.toRenderCoords(p,this.tilingScheme.spatialReference,
d);return d};return f}();f.FeatureTileMeasurements3D=m;var h=k.create(),c=k.create(),b=2,a=5,l={points:[g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],area:0,screenOverlap:0},n=k.create(),p=g.vec3d.create(),q=[g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],r=[0,0,0,0];f.default=m})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ./FeatureTileDescriptor3D ../../lib/gl-matrix ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new d.Frustum({renderCoordsHelper:a});this.extendedFrustum=new d.Frustum({renderCoordsHelper:a});this.intersector=new h.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}e.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};e.prototype.end=function(){this.cache.clear()};e.prototype.calculate=function(b){if(this.allTilesInvisible)return 0;var c="global"===this.renderCoordsHelper.type&&b.lij[0]>=a&&b.lij[0]<l,d=this.getOrCalculateSingleTileVisibility(b,!c);return 0!==d&&c?this.calculateAggregatedChildrenVisibility(b):d};e.prototype.shortenFrustumFarPlane=function(a){for(var b=a.points,c=0,e=d.Frustum.nearFarLineIndices;c<e.length;c++){var h=e[c],
f=h[1],h=b[h[0]];g.vec3d.add(h,g.vec3d.scale(g.vec3d.subtract(b[f],h,q),p),b[f])}a.updatePoints(b)};e.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=r.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}r.release(c);this.cache.set(a.id,b);return b};e.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);
b&&this.cache.set(a.id,c);return c};e.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&a.lij[0]<n){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};e.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?
this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};e.prototype.updateExtendedFrustum=function(a,d){var e=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var h=this.renderCoordsHelper.worldUpAtPosition(a.eye,q);this.aboveGround||g.vec3d.negate(h);h=b.acos(-g.vec3d.dot(h,a.viewForward));this.allTilesInvisible=h>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=h>a.fovY/2)){a=this.extendedFrustumParameters(d);d=this.extendedFrustum.points;
for(h=0;4>h;h++){var f=a.pointIndices[h],l=d[f],k=e.getAltitude(l);if(a.needsAltitudeAdjustment(k)){this.renderCoordsHelper.worldUpAtPosition(l,q);switch(f){case 4:case 7:case 0:case 3:c.plane.projectVector(this.extendedFrustum.planes[0],q);break;case 5:case 6:case 1:case 2:c.plane.projectVector(this.extendedFrustum.planes[1],q)}g.vec3d.scale(q,a.direction);this.renderCoordsHelper.intersectManifold(l,q,a.zWithMargin,l)}}this.extendedFrustum.updatePoints(d);0>g.vec3d.dot(this.extendedFrustum.planes[4],
this.frustum.planes[4])&&(e=this.extendedFrustum.points,this.aboveGround?(a=[e[1],e[0]],e[0]=a[0],e[1]=a[1]):(a=[e[2],e[3]],e[3]=a[0],e[2]=a[1]),this.extendedFrustum.updatePoints(e))}};e.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};e.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=a-b;return{zWithMargin:c,pointIndices:d.Frustum.planePointIndices.bottom,direction:-1,
needsAltitudeAdjustment:function(a){return a>c}}};e.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:d.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return e}();f.FeatureTileVisibility3D=m;var a=2,l=6,n=12,p=.95,q=g.vec3d.create(),r=new k(Array,function(a){4!==a.length&&(a[0]=new e.FeatureTileDescriptor3D,a[1]=new e.FeatureTileDescriptor3D,a[2]=new e.FeatureTileDescriptor3D,a[3]=new e.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});f.default=m})},"esri/views/3d/state/Frustum":function(){define("require exports ../lib/gl-matrix ../support/geometryUtils ../support/intersectionUtils ../webgl-engine/lib/Util".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function h(c){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=k.vec3d.create();this.direction=k.vec3d.create();this._altitude=null;
this.renderCoordsHelper=c?c.renderCoordsHelper:null;for(c=0;6>c;c++)this.planes[c]=e.plane.create();for(c=0;8>c;c++)this.points[c]=k.vec3d.create();for(c=0;12>c;c++)this.lines[c]={origin:null,direction:k.vec3d.create(),endpoint:null}}h.prototype.update=function(c){d.matrixToFrustumPoints(c.viewMatrix,c.projectionMatrix,this.points);this.updatePoints(this.points);k.vec3d.set(c.eye,this.origin);k.vec3d.set(c.viewForward,this.direction);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);
this.updateLines()};h.prototype.updatePoints=function(c){if(c!==this.points)for(var b=0;b<this.points.length;b++)k.vec3d.set(c[b],this.points[b]);d.frustumPointsToPlanes(this.points,this.planes);this.updateLines()};Object.defineProperty(h.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0});h.prototype.intersectsSphere=function(c,b){return g.frustumSphere(this.planes,c,b)};h.prototype.intersectsRay=function(c,b,a){return g.frustumRay(this.planes,c,b,a)};h.prototype.intersectsLineSegment=
function(c,b,a){return g.frustumLineSegment(this.planes,c,b,a)};h.prototype.intersectsPoint=function(c){return g.frustumPoint(this.planes,c)};h.prototype.updateLines=function(){for(var c=0;4>c;c++){var b=c,a=c+4;this.updateLine(this.lines[c],this.points[b],this.points[a]);this.updateLine(this.lines[c+4],this.points[b],3===c?this.points[0]:this.points[b+1]);this.updateLine(this.lines[c+8],this.points[a],3===c?this.points[4]:this.points[a+1])}};h.prototype.updateLine=function(c,b,a){c.origin=b;c.endpoint=
a;k.vec3d.direction(a,b,c.direction)};h.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};h.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return h}();f.Frustum=m;f.default=m})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];m=function(){function f(a){var b=this;this.view=a;this.graphics=[];this.handles=new e;this._enabled=!0;this.symbols=l.map(function(a){return new c(new d({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([a.featureTiles.addClient(),g.on(a.featureTiles,"tiles","change",function(){return b.update()},function(){return b.update()})])}Object.defineProperty(f.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};f.prototype.update=
function(){var c=this;this.clear();if(this._enabled){var d=this.view.featureTiles,e=d.tilingScheme,g=d.tiles.toArray().sort(function(a,b){return a.loadPriority-b.loadPriority});g.forEach(function(d,f){var l=d.lij,m=l[0],n=l[1],p=l[2],q=e.getExtentGeometry(m,n,p),l=new k({geometry:q,symbol:c.symbols[m%c.symbols.length]}),r=f/(g.length-1);f=a.lerp(0,200,r);var r=a.lerp(20,6,r),t=d.loadPriority>=g.length;d=new k({geometry:q.center,symbol:new h({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new b({text:m+"/"+n+"/"+p+" ("+d.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[f,t?0:f,t?0:f]},size:r/.75})]})});c.graphics.push(l,d);c.view.graphics.addMany([l,d])})}};f.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return f}();f.FeatureTileTree3DDebugger=m;f.default=m})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../ViewAnimation ../lib/gl-matrix ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function f(a){a=g.call(this,a)||this;a.propertiesPool=new q.default({camera:r},a);a.lastSeenCameraProjectionValues=new r;a.events=new p.Evented;a.updateQueue=new x;a.processingUpdates=!1;return a}k(f,g);f.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};f.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new b.default({mode:a.viewingMode})}};Object.defineProperty(f.prototype,"animation",{get:function(){return this.cameraController instanceof a.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==t&&t.copyFrom(a);t.markViewDirty();t.computeUp(this.mode);w.camera=t;this.events.emit("before-camera-change",
w);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,t)&&(this.lastSeenCameraProjectionValues.copyFrom(t),u.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",u));a&&a.equivalent(t)||this._set("camera",this.propertiesPool.get("camera").copyFrom(t))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===l.State.Finished||c===l.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(b){a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=l.State.Rejected)},enumerable:!0,configurable:!0});f.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==l.State.Rejected};f.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};f.prototype.cameraChanged=function(){this.updateCamera(function(){})};f.prototype.updateCamera=
function(a){this.updateQueue.enqueue(a);this.processUpdateQueue()};f.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.dequeue();t.copyFrom(this._get("camera"));a(t);this.camera=t;this.processingUpdates=!1;this.processUpdateQueue()}};f.prototype.createInitialCamera=function(a){return"global"===a?new r(c.vec3d.createFrom(4*n.earthRadius,0,0),c.vec3d.createFrom(n.earthRadius,0,0),c.vec3d.createFrom(0,0,1)):
new r(c.vec3d.createFrom(0,0,100),c.vec3d.createFrom(0,0,0),c.vec3d.createFrom(0,1,0))};f.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};e([d.property({readOnly:!0,type:h,dependsOn:["cameraController"]})],
f.prototype,"animation",null);e([d.property({type:r})],f.prototype,"camera",null);e([d.property({constructOnly:!0})],f.prototype,"constraints",void 0);e([d.property({readOnly:!0})],f.prototype,"events",void 0);e([d.property({readOnly:!0,dependsOn:["isLocal"]})],f.prototype,"isGlobal",null);e([d.property({readOnly:!0,dependsOn:["mode"]})],f.prototype,"isLocal",null);e([d.property({constructOnly:!0})],f.prototype,"mode",void 0);e([d.property({constructOnly:!0})],f.prototype,"spatialReference",void 0);
e([d.property({readOnly:!0,dependsOn:["cameraController"]})],f.prototype,"interacting",null);e([d.property()],f.prototype,"cameraController",null);return f=e([d.subclass()],f)}(d.declared(g));f.ViewState=m;var t=new r,w={camera:null},u={camera:null},x=function(){function a(){this.data=[];this.length=this.ptr=0}a.prototype.enqueue=function(a){this.data.push(a);this.length++};a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=
this.data.length=0);return a};return a}();f.default=m})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../geometry/Point ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ../lib/gl-matrix ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N){Object.defineProperty(f,"__esModule",{value:!0});var I=l.getLogger("esri.views.3d.state.ViewStateManager");m=function(c){function f(b){b=c.call(this)||this;b.propertiesPool=new D.default({frustum:A.default},b);b.handles=new a;b.cameraSetByUser=!1;b.internalSetOrder=[];b.immediateGoToPromise=null;b.animatedGoToPromise=null;b.ready=!1;return b}e(f,c);Object.defineProperty(f.prototype,"camera",{get:function(){return this.ready?E.internalToExternal(this.view,
this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(E.externalToInternal(this.view,a),{applyConstraints:!1})||I.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),
{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():I.error("#center\x3d","Invalid center",a):I.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):I.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"extent",{get:function(){return this.ready?E.toExtent(this.view,null,
null,null,Q):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||I.error("#extent\x3d","Invalid extent",a):I.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):I.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;
return E.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||I.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding,b=this._get("padding");return null!==b&&b.top===a[0]&&b.right===a[1]&&b.bottom===a[2]&&b.left===
a[3]?b:{top:a[0],right:a[1],bottom:a[2],left:a[3]}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?z.vec4d.set4(a.top||0,a.right||0,a.bottom||0,a.left||0,K):z.vec4d.set4(0,0,0,0,K),this.view.state.updateCamera(function(a){a.padding=K}))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"screenCenter",{get:function(){var a=this.padding;return new w((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"viewpoint",{get:function(){return this.ready?F.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||I.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;I.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else I.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"zoom",{get:function(){return this.ready?E.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||I.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});f.prototype.initialize=
function(){var a=this;this.handles.add(this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),p.on(this.view,"state.events","before-camera-change",function(b){return a.beforeCameraChangeHandle(b.camera)}));p.once(this.view,"state.camera",function(b){return a.updateCameraAboveGround(b)});this.handles.add(this.view.on("resize",function(b){return a.handleResize(b.width,b.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(R);
a.cancelImmediateGoTo()}));this.handles.add(p.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};f.prototype.init=function(){var a=this;this.constraintsManager=new y.default({view:this.view});this.handleResize(this.view.width,this.view.height);var b=this.getInitialProperties();this.cameraSetByUser=
!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(p.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(R);a.setInitialView(a.view.groundExtent)}),R))};f.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),
this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(R),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};f.prototype.goTo=function(a,b){b=k({animate:!0},b);return b.animate?this.goToAnimated(a,b):this.goToImmediate(a,b)};f.prototype.debugSetCameraOnContent=function(){this.setStateCamera(v.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};
f.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};f.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};f.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};f.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=
[],d=0,e=O;d<e.length;d++){var g=e[d],h=g.propertyName,g=g.overrides,f=b.has(h),l=this._isOverridden(h);!f&&l&&c.push({name:h,value:this._get(h)});this._clearOverride(h);(f||l)&&g.forEach(function(a){return b.add(a)})}return c.sort(function(b,c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};f.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof d)this.setStateCamera(E.externalToInternal(this.view,a),{applyConstraints:!1});
else if(a instanceof h)if(a.targetGeometry instanceof r){var b=E.fromExtent(this.view,a.targetGeometry,0,.5,E.OrientationMode.LOCKED);this.setStateCamera(E.externalToInternal(this.view,b),{applyConstraints:!0})}else b={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,b);else b=E.fromExtent(this.view,a,0,.5,E.OrientationMode.LOCKED),this.setStateCamera(E.externalToInternal(this.view,b),{applyConstraints:!0})};f.prototype.updatePropertyBeforeReady=function(a,b){if(this.ready)return!1;
this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==G.indexOf(a)&&this._override("hasInitialView",!0));return!0};f.prototype.isCompatible=function(a){return a?a instanceof h?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof d?this.isCompatible(a.position):a.spatialReference&&u.canProject(a.spatialReference,this.view.spatialReference):!1};f.prototype.getPreservingHeadingTilt=
function(a){void 0===a&&(a=J);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};f.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=H);var d=this.getPreservingHeadingTilt();return(a=E.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,E.OrientationMode.ADJUST))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};f.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;
b.forceUpdate();return this.centerPointAtDistanceToCamera(a,b.distance)};f.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=E.fromExtent(this.view,a,b.heading,b.tilt,E.OrientationMode.ADJUST,Q);return E.externalToInternal(this.view,a)};f.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();var c=b.renderLocation;a=E.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,
a)};f.prototype.zoomToCamera=function(a){return this.scaleToCamera(E.zoomToScale(this.view,a))};f.prototype.viewpointToCamera=function(a){return(a=F.toCamera(this.view,a))?E.externalToInternal(this.view,a):null};f.prototype.setStateCamera=function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&x.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=
new C.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};f.prototype.handleResize=function(a,b){var c=this.view.canvas;!c||c.width===a&&c.height===b||(c.width=a,c.height=b);this.view.state&&(c=this.view.state.camera,c.fullWidth!==a||c.fullHeight!==b)&&(H.copyFrom(c),H.fullWidth=a,H.fullHeight=b,this.view.state.camera=H)};f.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)};f.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};
f.prototype.updateCameraAboveGround=function(a){var b=this.view.basemapTerrain,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b&&b.spatialReference?v.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};f.prototype.createGoToCamera=function(a){var c=this;return p.whenOnce(this,"ready",null,!0).then(function(){return F.create(c.view,a)}).then(function(e){var g=!!(a instanceof h&&a.camera||a instanceof d),f=e.camera;if(!c.isCompatible(f))throw e=(e=f.position)&&e.spatialReference,new b("goto:incompatible-spatialreference",
"Resulting camera has an incompatible spatial reference (camera: "+(e?e.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:f});f=E.externalToInternal(c.view,f);if(!f)throw new b("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:e,camera:f,isFullySpecified:g}})};f.prototype.cancellableGoTo=function(a){var b=this,c;return n.create(function(b,d){c={resolve:b,reject:d};a.asyncResult=c},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===c&&a.stopController()})};
f.prototype.goToImmediate=function(a,c){var d=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var e=this.createGoToCamera(a).then(function(a){d.immediateGoToPromise===e&&(d.immediateGoToPromise=null);d.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){d.immediateGoToPromise===e&&(d.immediateGoToPromise=null);a instanceof b&&a.message&&I.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=
e};f.prototype.goToAnimatedBeforeReady=function(a,c){var d=this;this.cancelAnimatedGoTo();var e=p.whenOnce(this.view,"ready").then(function(){if(e===d.animatedGoToPromise)return d.animatedGoToPromise=null,d.goToAnimated(a,c);throw new b("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=e};f.prototype.goToAnimated=function(a,c){var d=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,c);var e=this.view.state.cameraController,g;e instanceof B.PointToPointAnimationController&&
(e.updateStateFromViewAnimation(),e.active&&(g=e));null==g&&(g=new B.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));var h=g.viewAnimation;a=this.createGoToCamera(a);var f=a.then(function(a){return a.viewpoint});h.update(f);if(g!==e&&!this.view.state.switchCameraController(g))return h.stop(),I.error("#goTo()","Cannot start an animation while interacting"),n.reject(new b("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var l=h.target,
k=function(){return d.view.state.cameraController===g&&g.viewAnimation.target===l&&g.active};a.then(function(a){var b=a.viewpoint,e=a.camera;a=a.isFullySpecified;if(k()){g.viewAnimation.update(b);l=g.viewAnimation.target;var f;a?(f=new C.SurfaceCollisionCorrectionController({view:d.view,desiredCamera:e}),x.applySurfaceCollision(d.view,e,1)):x.applyAll(d.view,e);g.begin(e,d.internalAnimateOptions(c));return h.when().then(function(){var a=d.view.state.cameraController;f&&(a&&a.active?a instanceof B.PointToPointAnimationController&&
a.viewAnimation.target===l&&(d.view.state.cameraController=f):g.viewAnimation.target===l&&(d.view.state.cameraController=f))})}}).catch(function(a){a instanceof b&&a.message&&I.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(k())throw d.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(g)};f.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&
(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?N.named[a.easing]:a.easing));return b};g([q.property({type:d,dependsOn:["view.state.camera","ready"]})],f.prototype,"camera",null);g([q.property({type:t,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],f.prototype,"center",null);g([q.property({type:r,dependsOn:["view.state.camera","ready"]})],f.prototype,"extent",null);g([q.property({readOnly:!0,
dependsOn:["view.state.camera","ready"]})],f.prototype,"frustum",null);g([q.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],f.prototype,"hasInitialView",null);g([q.property({readOnly:!0,type:Boolean})],f.prototype,"ready",void 0);g([q.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],f.prototype,"scale",null);g([q.property({dependsOn:["view.state.camera","ready"]})],f.prototype,"padding",null);g([q.property({readOnly:!0,
dependsOn:["view.width","view.height","padding"]})],f.prototype,"screenCenter",null);g([q.property({constructOnly:!0})],f.prototype,"view",void 0);g([q.property({type:h,dependsOn:["camera","ready"]})],f.prototype,"viewpoint",null);g([q.property({type:Number,dependsOn:["scale"]})],f.prototype,"zoom",null);return f=g([q.subclass("esri.views.3d.state.ViewStateManager")],f)}(q.declared(c));f.ViewStateManager=m;var G="camera viewpoint extent scale center zoom".split(" "),O=[{propertyName:"camera",overrides:["viewpoint"]},
{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],J={heading:0,tilt:0},Q=new d,H=new M,K=z.vec4d.create(),R="pending-initial-view";f.default=m})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function f(a){var b=g.call(this)||this;b.handles=new d;b.nearFarHeuristic=l.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return b}k(f,g);f.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(h.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new n.default({view:this.view}))};f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};f.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};f.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};f.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};f.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};f.prototype.cameraUpdateNearFarAuto=function(b,c){this.nearFarHeuristic.compute(b.eye,
b.center,this.view.dataExtent,a.surfaceElevationBelowEye(this.view,b),b);c&&c.autoUpdate(b.near,b.far)};f.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};f.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};f.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};f.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};f.prototype.handleTiltModeChanged=function(){this.updateTilt()};f.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};f.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};f.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(p.deg2rad(a.max))};f.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};f.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(p.rad2deg(b)))}};f.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};f.prototype.reapplyConstraints=function(a){var c=this;void 0===a&&(a=15);this.view.state.updateCamera(function(d){return b.applyAll(c.view,d,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};e([c.property({constructOnly:!0})],f.prototype,"view",void 0);e([c.property({readOnly:!0})],f.prototype,"surfaceCollisionConstraint",void 0);return f=e([c.subclass("esri.views.3d.state.ConstraintsManager")],
f)}(c.declared(g));f.ConstraintsManager=m;f.default=m})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../geometry/support/scaleUtils ../lib/gl-matrix ../support/earthUtils ../support/mathUtils".split(" "),function(m,f,k,e,g,d){function h(a,b,c,d){c=l/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(f,"__esModule",{value:!0});f.createNearFarHeuristic=function(a,d,e){return"global"===a?new b:new c(d,e)};var c=function(){function b(a,
b){this.elevationProvider=a;this.unitInMeters=k.getMetersPerUnitForSR(b)}b.prototype.compute=function(b,c,f,l,k){k||(k={near:0,far:0});var m=g.earthRadius,t=b[2]*this.unitInMeters,v=t;l=t-l;var u=this.elevationProvider?this.elevationProvider.getElevationBounds():null;u&&(t=0<=l?v-this.unitInMeters*u[0]:this.unitInMeters*u[1]-v);v=Math.max(f.xmax-f.xmin,f.ymax-f.ymin,4*Math.max(f.xmax-f.xmin,f.ymax-f.ymin));e.vec3d.subtract(c,b,r);q[0]=0<r[0]?f.xmax:f.xmin;q[1]=0<r[1]?f.ymax:f.ymin;q[2]=0<r[2]?v/2:
-v/2;e.vec3d.subtract(q,b);e.vec3d.normalize(r);b=1.1*e.vec3d.dot(q,r)*this.unitInMeters;m=Math.sqrt(t*(t+2*m));f=Math.max(f.xmax-f.xmin,f.ymax-f.ymin);c=f*p*this.unitInMeters;t=d.clamp((t-c)/(f*n*this.unitInMeters-c),0,1);t=d.lerp(m,b,t*t*t);t*=Math.max(Math.log(Math.abs(l)),1);t=Math.min(t,Math.max(34064E4,v));t/=this.unitInMeters;return h(t,a,this.unitInMeters,k)};return b}(),b=function(){function a(){}a.prototype.compute=function(a,b,c,f,l){l||(l={near:0,far:0});b=g.earthRadius;a=e.vec3d.length(a)-
b;a=Math.max(Math.abs(a-f),Math.abs(a));f=Math.sqrt(a*(a+2*(b+Math.min(0,f))));a=d.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return h(1.2*f,a,1,l)};return a}(),a=2E4,l=2,n=.001,p=1E-4,q=e.vec3d.create(),r=e.vec3d.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function g(b){b=a.call(this)||this;b.handles=new d;return b}k(g,a);g.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
b.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};g.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){c.applySurfaceCollision(a.view,b,1)})};e([h.property({constructOnly:!0})],g.prototype,"view",void 0);return g=e([h.subclass("esri.views.3d.state.ElevationCollisionConstraint")],g)}(h.declared(g));f.SurfaceCollisionConstraint=m;f.default=m})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function b(a){var b=c.call(this)||this;b.handles=new e;b.view=a.view;b.desiredCamera=a.desiredCamera.copy();return b}k(b,c);Object.defineProperty(b.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});b.prototype.onControllerStart=function(a){var b=
this;c.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};b.prototype.onControllerEnd=function(a){this.handles.removeAll();c.prototype.onControllerEnd.call(this,a)};b.prototype.handleElevationChangeEvent=function(a){d.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};b.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
g.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=h.State.Stopped)})};return b}(h.CameraController);f.SurfaceCollisionCorrectionController=m})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/gl-matrix ./cameraUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){function u(a){return 360-t.cyclicalDeg.normalize(a)}function x(a){return t.cyclicalDeg.normalize(360-a)}function v(a,b){a&&(null==b?a.reject():a.resolve(b));return b}function z(a,b,c,d){if(!b)return v(d);var g=a.spatialReference||e.SpatialReference.WGS84;if(b.camera){a=b.get("camera.position.spatialReference");if(!l.canProject(a,g))return v(d);b=b.camera.clone();a.equals(g)||(b.position=l.project(b.position,g));return v(d,b)}var h=b.get("targetGeometry.spatialReference");
if(h&&!l.canProject(h,g))return v(d);g=q.internalToExternal(a,a.state.camera);h=q.OrientationMode.ADJUST;null!=b.rotation&&(g.heading=u(b.rotation),h=q.OrientationMode.LOCKED);null!=c&&(g.tilt=c);if("point"===b.targetGeometry.type){c=b.targetGeometry;var f=void 0,k=b.targetGeometry.clone(),f=null!=b.scale?q.scaleToDistance(a,b.scale,c.latitude):a.state.camera.distance;return q.fromCenterDistance(a,k,f,g,h,d)}return q.fromExtent(a,b.targetGeometry.extent,g.heading,g.tilt,h,d)}function y(a,b){var c=
b.scale;null==c&&null!=b.zoom&&(c=q.zoomToScale(a,b.zoom));return c}function A(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=u(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function B(a,b,c){var d=a.spatialReference||e.SpatialReference.WGS84;b=b||q.externalToInternal(a,c.camera);c.targetGeometry=w.vectorToPoint(b.center,a.renderSpatialReference,d);c.scale=q.computeScale(a,b);c.rotation=x(c.camera.heading);return c}
function C(a,c,d){if(c){if(!l.canProject(c.spatialReference,a.spatialReference))throw new h("viewpointutils:incompatible-spatialreference","Spatial reference ("+(c.spatialReference?c.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:c});var e=[];if(!c.hasZ&&a.basemapTerrain){var g=void 0;switch(c.type){case "point":g=c;break;case "multipoint":case "polyline":case "mesh":g=c.extent.center;break;case "extent":g=c.center;break;case "polygon":g=
c.centroid}g&&l.canProject(g,a.basemapTerrain.spatialReference)?K[2]=a.basemapTerrain.getElevation(g)||0:K[2]=0}(0,U[c.type])(c,function(a){e.push(a[0],a[1],a[2])},K);var f=e.length/3;if(0!==f&&(g=Array(e.length),w.bufferToBuffer(e,c.spatialReference,0,g,a.spatialReference,0,f)))for(c.hasZ&&(d.hasZ=!0),a=0;a<g.length;a+=3)c.hasZ?(K[0]=g[a+0],K[1]=g[a+1],K[2]=g[a+2]):(K[0]=g[a+0],K[1]=g[a+1]),b.expand(d.boundingBox,K)}}function E(a,c,d,e){return a.whenViewForGraphic(c).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(c,
{minDemResolution:d})}).then(function(a){var c=a.boundingBox;b.expand(e.boundingBox,c);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){e.screenSpaceObjects.push(a)});isFinite(c[2])&&(e.hasZ=!0)}).catch(function(){C(a,c.geometry,e)})}function D(a,b,d,h){if(Array.isArray(b)&&2===b.length){var f=b[0],l=b[1];if("number"===typeof f&&"number"===typeof l)return aa.x=f,aa.y=l,aa.z=void 0,aa.spatialReference=e.SpatialReference.WGS84,C(a,aa,h),c.resolve()}if(b&&"function"===typeof b.map)return c.eachAlways(b.map(function(b){return D(a,
b,d,h)}));if(b instanceof e.BaseGeometry)try{C(a,b,h)}catch(na){return c.reject(na)}else if(b instanceof g)return E(a,b,d,h);return c.resolve()}function F(a,b,d,e){if(b.camera)return c.resolve(M(a,d,b.camera,e));e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=d.heading?e.rotation=x(d.heading):null!=d.rotation&&(e.rotation=d.rotation);b=y(a,d);null!=b&&(e.scale=b);b=c.createResolver();z(a,e,d.tilt,b);return b.promise.then(function(a){e.camera=
a;return e})}function M(a,b,c,d){d.camera=c.clone();d.camera.fov=a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!l.canProject(c,b))return null;c.equals(b)||(d.camera.position=l.project(d.camera.position,b));return B(a,null,d)}function N(a,b,c,d,g){var h=a.renderSpatialReference;w.pointToVector(c.position,W,h);w.pointToVector(b,Y,h);g.targetGeometry=new e.Point(b);g.camera.position=new e.Point(c.position);p.vec3d.subtract(Y,W,S);q.directionToHeadingTilt(a,W,S,d.up,g.camera);
g.scale=q.distanceToScale(a,p.vec3d.dist(W,Y),g.targetGeometry.latitude);g.rotation=x(g.camera.heading);return g}function I(a,b,d,e){if(!d)return c.reject();e.targetGeometry=d.clone();var g=n.cameraOnContentAlongViewDirection(a);if(b.position)return c.resolve(N(a,e.targetGeometry,b,g,e));if(b.zoomFactor){var h=g.distance/b.zoomFactor,f=p.vec3d.scale(g.viewForward,-h,K);p.vec3d.add(g.center,f,g.eye);g.markViewDirty();e.scale=q.distanceToScale(a,h,d.latitude)}q.internalToExternal(a,g,e.camera);h=A(e.camera,
b)?q.OrientationMode.LOCKED:q.OrientationMode.ADJUST;return b.zoomFactor?c.resolve(e):(e.scale=y(a,b),null==e.scale&&(w.pointToVector(d,K,a.renderSpatialReference),r.frustumPoint(g.frustumPlanes,K)?e.scale=q.distanceToScale(a,p.vec3d.dist(g.eye,K),d.latitude):e.scale=q.computeScale(a,g)),b=c.createResolver(),q.fromCenterScale(a,e.targetGeometry,e.scale,e.camera,h,b),b.promise.then(function(a){e.camera=a;return e}))}function G(a,b,d,e){e.targetGeometry=d.clone();var g=n.cameraOnContentAlongViewDirection(a);
q.internalToExternal(a,g,e.camera);b=A(e.camera,b)?q.OrientationMode.LOCKED:q.OrientationMode.ADJUST;g=c.createResolver();q.fromExtent(a,d,e.camera.heading,e.camera.tilt,b,g);return g.promise.then(function(a){e.camera=a;return e})}function O(a,c,d,e,g){var h=0;d.hasZ?h=d.z:a.basemapTerrain&&(h=a.basemapTerrain.getElevation(d));p.vec3d.set3(d.x,d.y,h,K);w.computeLinearTransformation(a.spatialReference,K,R,a.renderSpatialReference);p.mat4d.toMat3(R,P);p.mat3d.transpose(P);b.empty(L);d=[[0,1,2],[3,1,
2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var f=0;f<d.length;f++){var l=d[f],k=e[l[2]];isFinite(k)||(k=h);p.vec3d.set3(e[l[0]],e[l[1]],k,K);w.vectorToVector(K,a.spatialReference,K,a.renderSpatialReference);b.expand(L,p.mat3d.multiplyVec3(P,K))}a=b.width(L);e=b.height(L);h=b.depth(L);d=1/Math.tan(c.fovY/2);return Math.max(.5*Math.sqrt(a*a+h*h)*Math.max(d,1/Math.tan(c.fovX/2))+.5*e,.5*e*d+.5*Math.max(a,h))/g}function J(a,b,d,e,g,h){h.targetGeometry=d.clone();var f=n.cameraOnContentAlongViewDirection(a);
d=O(a,f,d,e,g);q.internalToExternal(a,f,h.camera);b=A(h.camera,b)?q.OrientationMode.LOCKED:q.OrientationMode.ADJUST;h.scale=q.distanceToScale(a,d,h.targetGeometry.latitude);f=c.createResolver();q.fromCenterScale(a,h.targetGeometry,h.scale,h.camera,b,f);return f.promise.then(function(a){h.camera=a;return h})}function Q(a,b){if(!b||!a.spatialReference)return null;a={target:null};if("declaredClass"in b||Array.isArray(b))a.target=b;else{for(var c in b)a[c]=b[c];b.center&&!a.target&&(a.target=b.center)}return a}
function H(a){a&&(a.rotation=x(a.camera.heading));return a}Object.defineProperty(f,"__esModule",{value:!0});f.DEFAULT_FRAME_COVERAGE=.66;f.rotationToHeading=u;f.headingToRotation=x;f.toCamera=z;f.fromInternalCamera=function(a,b,c){c||(c=new d({camera:new k}));q.internalToExternal(a,b,c.camera);return B(a,b,c)};f.fromCamera=function(a,b,c){c||(c=new d);c.camera=b.clone();return B(a,null,c)};f.create=function(g,l){var m=Q(g,l);if(!m)return c.reject(new h("viewpointutils-create:no-target","Missing target for creating viewpoint"));
var r=new d({camera:new k({fov:g.camera.fov})}),t=null!=m.scale||null!=m.zoom;if(m.target instanceof d)return F(g,m.target,m,r).then(function(a){return H(a)});if(m.target instanceof k)return c.resolve(H(M(g,m,m.target,r)));if(m.target instanceof e.Extent)return l=m.target.xmin===m.target.xmax||m.target.ymin===m.target.ymax,t||l?I(g,m,m.target.center,r).then(function(a){return H(a)}):G(g,m,m.target,r).then(function(a){return H(a)});var v={boundingBox:b.empty(),hasZ:!1,screenSpaceObjects:[]};l=t?q.scaleToResolution(g,
y(g,m)):void 0;return D(g,m.target,l,v).then(function(){if(isFinite(v.boundingBox[0])){b.center(v.boundingBox,K);aa.x=K[0];aa.y=K[1];aa.z=K[2];aa.spatialReference=g.spatialReference;var c=void 0;isFinite(aa.z)&&v.hasZ?c=b.isPoint(v.boundingBox):(aa.z=void 0,c=a.isPoint(b.toRect(v.boundingBox,T)));if(t||c)return I(g,m,aa,r);var c=v.screenSpaceObjects,d=f.DEFAULT_FRAME_COVERAGE;if(c.length){for(var h=Number.NEGATIVE_INFINITY,l=0;l<c.length;l++)var k=c[l].screenSpaceBoundingRect,h=Math.max(h,Math.abs(k[0]),
Math.abs(k[1]),Math.abs(k[2]),Math.abs(k[3]));c=d-h/Math.min(g.width,g.height)*2}else c=d;return J(g,m,aa,v.boundingBox,c,r)}if(m.position)return c=n.cameraOnContentAlongViewDirection(g),p.vec3d.set(c.viewForward,S),q.directionToHeadingTilt(g,c.eye,S,c.up,X),r.camera.position=new e.Point(m.position),r.camera.heading=null!=m.heading?m.heading:X.heading,r.camera.tilt=null!=m.tilt?m.tilt:X.tilt,B(g,null,r);c=n.cameraOnContentAlongViewDirection(g);c=w.vectorToPoint(c.center,g.renderSpatialReference,aa,
g.spatialReference);return I(g,m,c,r)}).then(function(a){return H(a)})};var K=p.vec3d.create(),R=p.mat4d.create(),P=p.mat3d.create(),L=b.create(),T=a.create(),S=p.vec3d.create(),W=p.vec3d.create(),Y=p.vec3d.create(),X={heading:0,tilt:0},aa=new e.Point,U={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var g=a.rings[e],h=0;h<g.length;h++)c[0]=g[h][0],c[1]=g[h][1],d&&(c[2]=g[h][2]),b(c)},polyline:function(a,b,c){for(var d=
a.hasZ,e=0;e<a.paths.length;e++)for(var g=a.paths[e],h=0;h<g.length;h++)c[0]=g[h][0],c[1]=g[h][1],d&&(c[2]=g[h][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(p.vec3d.set3(a.xmin,a.ymin,a.zmin,c)),b(p.vec3d.set3(a.xmax,a.ymin,a.zmin,c)),b(p.vec3d.set3(a.xmin,a.ymax,a.zmin,c)),b(p.vec3d.set3(a.xmax,a.ymax,a.zmin,c)),b(p.vec3d.set3(a.xmin,a.ymin,a.zmax,c)),b(p.vec3d.set3(a.xmax,
a.ymin,a.zmax,c)),b(p.vec3d.set3(a.xmin,a.ymax,a.zmax,c)),b(p.vec3d.set3(a.xmax,a.ymax,a.zmax,c))):(b(p.vec3d.set3(a.xmin,a.ymin,c[2],c)),b(p.vec3d.set3(a.xmax,a.ymin,c[2],c)),b(p.vec3d.set3(a.xmin,a.ymax,c[2],c)),b(p.vec3d.set3(a.xmax,a.ymax,c[2],c)))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(p.vec3d.set3(a[d+0],a[d+1],a[d+2],c))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define(["require","exports","../../lib/gl-matrix",
"../../webgl-engine/lib/Selector","../../webgl-engine/lib/SelectorUtils"],function(m,f,k,e,g){function d(d,c,b,a,e){b?k.vec3d.set(c.eye,a):k.vec3d.unproject(k.vec3d.createFrom(d[0],d[1],0),c.viewMatrix,c.projectionMatrix,c.fullViewport,a);k.vec3d.unproject(k.vec3d.createFrom(d[0],d[1],1),c.viewMatrix,c.projectionMatrix,c.fullViewport,e)}Object.defineProperty(f,"__esModule",{value:!0});m=function(){function h(c,b,a){this.viewingMode=c;this.layerProvider=b;this.viewPropertyProvider=a;this.tmpR0=k.vec3d.create();
this.tmpR1=k.vec3d.create();this.tmpScreenPoint=k.vec2d.create();this.tmpScreenPointHud=k.vec2d.create();this.tmpPointHud=k.vec3d.create();this.tmpSelector=new e(this.viewingMode);this.externalIntersectionHandlers=new Set;this.intersectionTolerance=e.DEFAULT_TOLERANCE;this.validateHUDSelector=new e(this.viewingMode);this.validateHUDSelector.enableHUDSelection=!1}h.prototype.getPickRay=function(c,b,a){void 0===b&&(b=k.vec3d.create());void 0===a&&(a=k.vec3d.create());var e=this.viewPropertyProvider.camera();
d(c,e,!1,b,a)};h.prototype.pickPointInScreen=function(c,b,a){var e=this.viewPropertyProvider.camera();d(c,e,!1,this.tmpR0,this.tmpR1);return this.pickPointFromSegment(this.tmpR0,this.tmpR1,b,a)};h.prototype.pickPointFromSegment=function(c,b,a,d){d=this.computeIntersection(c,b,null,null,!1,d||this.tmpSelector);a=d?(c=d.minResult)?c.getIntersectionPoint(a):!1:!1;return a};h.prototype.pickFreePointInScreen=function(c,b){var a=this.viewPropertyProvider.camera();d(c,a,!1,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,
this.tmpR1,b)};h.prototype.pickFreePointFromSegment=function(c,b,a){k.vec3d.set(c,this.tmpR0);k.vec3d.set(b,this.tmpR1);k.vec3d.subtract(this.tmpR1,this.tmpR0);k.vec3d.normalize(this.tmpR1);var d=this.viewPropertyProvider.extent();c=Math.max(d.xmax-d.xmin,d.ymax-d.ymin,8*Math.max(d.xmax-d.xmin,d.ymax-d.ymin));var e=this.viewPropertyProvider.camera();b=Math.max(0,d.xmin-e.eye[0],e.eye[0]-d.xmax);d=Math.max(0,d.ymin-e.eye[1],e.eye[1]-d.ymax);e=c/Math.max(1,Math.pow(Math.max(0,Math.log(c/(Math.abs(e.relativeElevation)+
Number.MIN_VALUE))),2));e=Math.max(e,Math.min(Math.sqrt(b*b+d*d),c));k.vec3d.scale(this.tmpR1,e);k.vec3d.add(this.tmpR0,this.tmpR1,a)};h.prototype.pickSelectorInScreen=function(c,b,a,e){void 0===e&&(e=!1);var g=this.viewPropertyProvider.camera();d(c,g,!1,this.tmpR0,this.tmpR1);return this.computeIntersection(this.tmpR0,this.tmpR1,c,a,e,b)};h.prototype.setTolerance=function(c){void 0===c&&(c=e.DEFAULT_TOLERANCE);this.intersectionTolerance=c};h.prototype.addIntersectionHandler=function(c){this.externalIntersectionHandlers.add(c)};
h.prototype.removeIntersectionHandler=function(c){this.externalIntersectionHandlers.delete(c)};h.prototype.computeIntersection=function(c,b,a,h,f,m){var l=this,n=this.viewPropertyProvider.camera();a||(a=this.tmpScreenPoint,n.projectPoint(b,a));var p=this.layerProvider.getPickableLayers();h&&(p=p.filter(function(a){return h.has(a.id)}));var w=this.viewPropertyProvider.slicePlane(),w=w?g.sliceFilterPredicate(w):null;m=m||new e(this.viewingMode);m.init(p,c,b,a,n,this.intersectionTolerance,f,w);this.externalIntersectionHandlers.forEach(function(d){d.intersect(m,
c,b,a)});if(m.hudResults.length){var u=m.hudResults;u.sort(function(a,b){return b.dist-a.dist});var u=u[u.length-1],x=this.tmpScreenPointHud;n.projectPoint(u.center,x);x[0]=Math.round(x[0]);x[1]=Math.round(x[1]);var v=this.tmpPointHud;d(x,n,!1,c,v);var z=k.vec3d.dist(u.center,c)/k.vec3d.dist(c,v)*.99;this.validateHUDSelector.init(p,c,v,x,n,this.intersectionTolerance,f,w);this.externalIntersectionHandlers.forEach(function(a){a.intersect(l.validateHUDSelector,c,v,x)});f=this.validateHUDSelector.minResult;
(null==f.dist||z<=f.dist)&&m.minResult.copyFrom(u)}return m};return h}();f.SceneIntersectionHelper=m})},"esri/views/3d/webgl-engine/lib/SelectorUtils":function(){define(["require","exports","../../lib/gl-matrix","../../support/geometryUtils/boundedPlane"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.sliceFilterPredicate=function(d){return function(h,c,b){k.vec3d.lerp(h,c,b,g);return!e.extrusionContainsPoint(d,g)}};var g=k.vec3d.create()})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define(["require",
"exports","../../../../core/Logger","../../lib/gl-matrix","./plane"],function(m,f,k,e,g){function d(a){void 0===a&&(a=f.UP);return{origin:e.vec3d.create(a.origin),basis1:e.vec3d.create(a.basis1),basis2:e.vec3d.create(a.basis2)}}function h(a,b){void 0===b&&(b=g.create());return g.fromVectorsAndPoint(a.basis2,a.basis1,a.origin,b)}function c(a,b){e.vec3d.subtract(b,a.origin,l);b=e.vec3d.length2(a.basis1);var c=e.vec3d.length2(a.basis2),d=e.vec3d.dot(a.basis1,l);a=e.vec3d.dot(a.basis2,l);return 0>-d-
b&&0>d-b&&0>-a-c&&0>a-c}Object.defineProperty(f,"__esModule",{value:!0});var b=k.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");f.create=d;f.set=function(a,b){e.vec3d.set(b.origin,a.origin);e.vec3d.set(b.basis1,a.basis1);e.vec3d.set(b.basis2,a.basis2);return a};f.fromValues=function(a,c,g,h){void 0===h&&(h=d());e.vec3d.set(a,h.origin);e.vec3d.set(c,h.basis1);e.vec3d.set(g,h.basis2);1E-6<Math.abs(e.vec3d.dot(h.basis1,h.basis2))&&b.warn("fromValues()","Provided basis vectors are not perpendicular");
return h};f.toPlane=h;f.intersectRay=function(b,d,e,f){h(b,a);return g.intersectRay(a,d,e,f)?c(b,d):!1};f.extrusionContainsPoint=function(a,b){e.vec3d.cross(a.basis1,a.basis2,n);var d=-e.vec3d.dot(n,a.origin);return 0>e.vec3d.dot(n,b)+d&&c(a,b)};var a=g.create(),l=e.vec3d.create(),n=e.vec3d.create();f.UP={origin:e.vec3d.createFrom(0,0,0),basis1:e.vec3d.createFrom(1,0,0),basis2:e.vec3d.createFrom(0,1,0)}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){return function(d){function g(a){var b=d.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;b.elevationChange=function(a){b.emit("elevation-change",a)};return b}k(g,d);g.prototype.getElevation=function(a,b){var c=-Infinity,d=!0;"scene"===b&&(c=this._updateElevation(c,this.providers.im,a,b),isFinite(c)&&(d=!1));d&&(c=this._updateElevation(c,this.providers.ground,a,b));"scene"===b&&(c=this._updateElevation(c,this.providers.scene,a,b));return isFinite(c)?
c:null};g.prototype._updateElevation=function(a,b,c,d){for(var e=0;e<b.length;e++){var g=b[e].getElevation(c,d);null!=g&&(a=Math.max(g,a))}return a};g.prototype.queryElevation=function(b,d,e){var g=this;void 0===d&&(d=0);this._elevationService||(this._elevationService=new l.ElevationQuery(this.view.spatialReference,function(){return g.view.map&&g.view.map.ground},{maximumAutoTileRequests:4}));var h=c.createResolver();(a.isPoint(b)?this._elevationService.queryElevation(b.x,b.y,d):this._elevationService.queryElevation(b[0],
b[0],d)).then(function(a){"scene"===e&&(a=g._updateElevation(a,g.providers.scene,b,e));h.resolve(isFinite(a)?a:null)}).catch(function(){return h.resolve(g.getElevation(b))});return h.promise};g.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};g.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=
this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};e([b.property({constructOnly:!0})],g.prototype,"view",void 0);e([b.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],g.prototype,"spatialReference",void 0);return g=e([b.subclass("esri.views.3d.support.CombinedElevationProvider")],g)}(b.declared(h,n.Evented))})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.color=new g([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}k(b,c);b.toEngineOptions=function(a){return{color:new Float32Array(g.toUnitRGBA(a.color)),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};e([h.property({type:g})],b.prototype,"color",void 0);e([h.property()],b.prototype,"haloOpacity",void 0);e([h.property()],
b.prototype,"fillOpacity",void 0);return b=e([h.subclass()],b)}(h.declared(d))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function b(a,b,c){void 0===c&&(c=null);var e=this;this.spatialReference=
b;this.unitInMeters=d.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=c)||h.create(a&&a.get("portalItem")).then(function(a){e.geometryService=a}).catch(function(){})}b.prototype.toGeographic=function(a){var b=this,d=!0;if(!this.geometryService)return g.reject(new e("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));Array.isArray(a[0])&&"number"!==typeof a[0]||(a=[a],d=!1);a=a.map(function(a){return a instanceof k.Point?a:new k.Point(a,b.spatialReference)});
a=new c({geometries:a,outSR:k.SpatialReference.WGS84});return this.geometryService.project(a).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return d?a:a[0]})};b.prototype.canProject=function(){return!!this.geometryService};return b}();f.MapCoordsHelper=m;f.default=m})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){var h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.maxTotalNumberOfFeatures=5E4;b.maxTotalNumberOfVertices=5E6;return b}k(b,a);e([d.property()],b.prototype,"maxTotalNumberOfFeatures",void 0);e([d.property()],b.prototype,"maxTotalNumberOfVertices",void 0);return b=e([d.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],b)}(d.declared(g)),c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}k(c,a);c.prototype.getDefaults=
function(){return{"3dObject":new b,point:new b,integratedMesh:new b,pointCloud:new b,uncompressedTextureDownsamplingEnabled:!1}};e([d.property()],c.prototype,"3dObject",void 0);e([d.property()],c.prototype,"point",void 0);e([d.property()],c.prototype,"integratedMesh",void 0);e([d.property()],c.prototype,"pointCloud",void 0);e([d.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=e([d.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],c)}(d.declared(g)),
b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodFactor=1;return b}k(b,a);e([d.property()],b.prototype,"lodFactor",void 0);return b=e([d.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],b)}(d.declared(g)),a=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodBias=0;b.angledSplitBias=1;return b}k(b,a);e([d.property()],b.prototype,"lodBias",void 0);e([d.property()],b.prototype,"angledSplitBias",void 0);return b=e([d.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
b)}(d.declared(g));return function(b){function g(){return null!==b&&b.apply(this,arguments)||this}k(g,b);g.prototype.getDefaults=function(){return{graphics3D:new h,sceneService:new c,tiledSurface:new a,antialiasingEnabled:!0}};e([d.property()],g.prototype,"graphics3D",void 0);e([d.property()],g.prototype,"sceneService",void 0);e([d.property()],g.prototype,"tiledSurface",void 0);e([d.property()],g.prototype,"antialiasingEnabled",void 0);e([d.property()],g.prototype,"gpuMemoryLimit",void 0);e([d.property()],
g.prototype,"additionalCacheMemory",void 0);e([d.property()],g.prototype,"frameRate",void 0);return g=e([d.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],g)}(d.declared(g))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../layers/graphics/dehydratedFeatures ../lib/gl-matrix ./earthUtils ./geometryUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Util".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){Object.defineProperty(f,"__esModule",{value:!0});f.createRenderCoordsHelper=function(a,b){return"global"===a?new r(b):new t(b)};var q;(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(q=f.BasisDimension||(f.BasisDimension={}));m=function(){function a(a,b){this.spatialReference=a;this.unitInMeters=b}a.prototype.toRenderCoords=function(a,b,c){return h.isPoint(a)?n.pointToVector(a,b,this.spatialReference):n.vectorToVector(a,b,c,this.spatialReference)};a.prototype.fromRenderCoords=
function(a,b,c){return b instanceof e?n.vectorToPoint(a,this.spatialReference,b,c):b instanceof g?n.vectorToPoint(a,this.spatialReference,b):n.vectorToVector(a,this.spatialReference,b,c)};return a}();f.RenderCoordsHelper=m;var r=function(a){function d(b){b=a.call(this,b||n.SphericalECEFSpatialReference,1)||this;b.type="global";return b}k(d,a);d.prototype.getAltitude=function(a){return c.vec3d.length(a)-b.earthRadius};d.prototype.setAltitude=function(a,d){a=(a+b.earthRadius)/c.vec3d.length(d);c.vec3d.scale(d,
a)};d.prototype.setAltitudeOfTransformation=function(a,c){var d=c[12],e=c[13],g=c[14];a=(a+b.earthRadius)/Math.sqrt(d*d+e*e+g*g);c[12]=d*a;c[13]=e*a;c[14]=g*a};d.prototype.worldUpAtPosition=function(a,b){return this.worldBasisAtPosition(a,q.Z,b)};d.prototype.worldBasisAtPosition=function(a,b,d){switch(b){case q.X:return l.cartesianToSpherical(a||v,u),a=u[2],c.vec3d.set3(-Math.sin(a),Math.cos(a),0,d);case q.Y:l.cartesianToSpherical(a||v,u);b=u[1];a=u[2];var e=Math.sin(b);return c.vec3d.set3(-e*Math.cos(a),
-e*Math.sin(a),Math.cos(b),d);case q.Z:return c.vec3d.normalize(a||v,d)}};d.prototype.intersectManifold=function(a,d,e,g){void 0===g&&(g=c.vec3d.create());if(!p.raySphere(a,d,null,b.earthRadius+e,u)||0>c.vec3d.dot(c.vec3d.direction(u,a,x),d))return!1;c.vec3d.set(u,g);return!0};return d}(m),t=function(b){function e(a){a=b.call(this,a,d.getMetersPerUnitForSR(a))||this;a.type="local";a.worldX=[1,0,0];a.worldY=[0,1,0];a.worldZ=[0,0,1];return a}k(e,b);e.prototype.getAltitude=function(a,b){return b?a[b+
2]:a[2]};e.prototype.setAltitude=function(a,b){b[2]=a};e.prototype.setAltitudeOfTransformation=function(a,b){b[14]=a};e.prototype.worldUpAtPosition=function(a,b){return c.vec3d.set(this.worldZ,b)};e.prototype.worldBasisAtPosition=function(a,b,d){switch(b){case q.X:return c.vec3d.set(this.worldX,d);case q.Y:return c.vec3d.set(this.worldY,d);case q.Z:return c.vec3d.set(this.worldZ,d)}};e.prototype.intersectManifold=function(b,d,e,g){void 0===g&&(g=c.vec3d.create());a.plane.fromNormalAndOffset(this.worldZ,
-e,w);if(!a.plane.intersectRay(w,b,d,u))return!1;c.vec3d.set(u,g);return!0};return e}(m),w=a.plane.create(),u=c.vec3d.create(),x=c.vec3d.create(),v=[0,0,0]})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./ResourceController ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function b(a){this.streamDataSupplier=
this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var b=g.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(b);this.textures=new d(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=h.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=
h.getLabelSettings(a.viewingMode)}b.prototype.destroy=function(){this.streamDataSupplier=this.textures=this.streamDataSupplier=null};b.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var c="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),k.removeUnordered(b.graphicsOwners,a),b.updateScreenSizePerspectiveEnabled())}}};
b.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,b=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new e,b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",b,!0),this.viewState.events.on("camera-projection-changed",b)]),this.updateScreenSizePerspectiveSettings()):
!b&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};b.prototype.updateScreenSizePerspectiveSettings=function(){c.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;c.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(c);this.screenSizePerspectiveSettingsLabels.update(c);this.stage.setNeedsRender()};return b}();f.SharedSymbolResources=m;var c={distance:0,fovY:0};f.default=m})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/lang ../../../core/urlUtils dojo/Deferred ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),
function(m,f,k,e,g,d,h){var c=h.assert;return m(null,{constructor:function(b,a,c){this._streamDataSupplier=b;this._stage=a;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=c||{}},acquire:function(b,a,c){var d;if(d=this._textureRecords[b])return d.referenceCount++,d.texture||d.clientDfd;if(a)return c=a(b),this._stage.add(g.ModelContentType.TEXTURE,c),d={texture:c,referenceCount:1},this._textureRecords[b]=
d,c;d=new e;a=this._streamDataSupplier.request(b,"image");this._textureRecords[b]={clientDfd:d,loaderDfd:a,texture:null,size:Math.ceil(c||0),referenceCount:1};a.then(this._loadedHandler,this._errorHandler);return d.promise},release:function(b){var a=this._textureRecords[b];a?(1>a.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+b),a.referenceCount--,1>a.referenceCount&&(a.texture?(this._stage.remove(g.ModelContentType.TEXTURE,a.texture.id),a.texture=null):this._streamDataSupplier.cancelRequest(a.loaderDfd),
delete this._textureRecords[b])):console.warn("TextureCollection: texture doesn't exist: "+b)},isInUse:function(b){b=this._textureRecords[b];c(!b||0<b.referenceCount,"texture record with zero reference count");return!!b},_loadedHandler:function(b,a){var e=this._textureRecords[b];c(e&&!e.texture);if(k.isSVG(b)&&(e.size||0===a.width&&0===a.height)){b=a.width?a.height/a.width:1;var h=e.size||64;1<b?(a.width=Math.round(h/b),a.height=h):(a.width=h,a.height=Math.round(h*b))}b=f.mixin({width:a.width,height:a.height},
this._textureOptions);a=new d(a,"symbol",b);this._stage.add(g.ModelContentType.TEXTURE,a);e.texture=a;e.clientDfd.resolve(a)},_errorHandler:function(b){b=this._textureRecords[b];c(b&&!b.texture);b.clientDfd.reject()}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Selector".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){Object.defineProperty(f,"__esModule",{value:!0});var x=Array;m=function(g){function f(b){b=g.call(this,b)||this;b.handles=new d;b.surfaceAltitudeAtCenter=0;b.surfaceAltitudeAtCenterDirty=!0;b.surfaceAltitudeAtCenterWithContent=0;b.surfaceAltitudeAtCenterWithContentDirty=!0;b.propertiesPool=new a.default({pointOfView:c,renderPointOfView:x},b);b.updateSurfaceAltitudeFrequentInterval=z;b.updateSurfaceAltitudeInfrequentInterval=y;b.renderPointOfView=[0,0,
0];return b}k(f,g);f.prototype.initialize=function(){var a=this,b=this.view,c=b.state,d=b.basemapTerrain,e=b.renderCoordsHelper,b=b.map;this.surfaceSelector=new u(c.mode);this.surfaceSelector.enableBackfacesTerrain=c.isGlobal?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new u(c.mode);this.contentSelector.enableTerrain=!1;var g=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new n.default({state:c,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:g,
altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new n.default({state:c,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:g,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new n.default({state:c,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));
this._set("cameraOnSurface",new l.default({state:c,surface:d,renderCoordsHelper:e,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:b}));this._set("surfaceGeometryUpdates",new w.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new p.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:e}));this._set("surfaceOrigin",
new t.default({view:this.view}));this._set("focus",new r.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add(c.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(d.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",
function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};f.prototype.destroy=function(){q.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(f.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);
return a},enumerable:!0,configurable:!0});f.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate();this.focus.forceUpdate()};f.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||
this.centerOnSurfaceFrequent.hasPendingUpdates()||this.focus.hasPendingUpdates()};f.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.state.camera;this.view.sceneIntersectionHelper.pickPointFromSegment(a.eye,a.center,v,this.contentSelector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(v):this.surfaceAltitudeAtCenterWithContent=
this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};f.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(v)&&
(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(v));return this.surfaceAltitudeAtCenter};f.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",b.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};f.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=
this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a);this.focus.update(a)};f.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)};e([h.property({constructOnly:!0})],f.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);e([h.property({constructOnly:!0})],f.prototype,"updateSurfaceAltitudeInfrequentInterval",
void 0);e([h.property({readOnly:!0})],f.prototype,"centerOnContent",void 0);e([h.property({readOnly:!0})],f.prototype,"centerOnSurfaceFrequent",void 0);e([h.property({readOnly:!0})],f.prototype,"centerOnSurfaceInfrequent",void 0);e([h.property({readOnly:!0})],f.prototype,"cameraOnSurface",void 0);e([h.property({readOnly:!0})],f.prototype,"focus",void 0);e([h.property({readOnly:!0})],f.prototype,"surfaceOrigin",void 0);e([h.property({readOnly:!0})],f.prototype,"contentGeometryUpdates",void 0);e([h.property({readOnly:!0,
dependsOn:["renderPointOfView"]})],f.prototype,"pointOfView",null);e([h.property({readOnly:!0})],f.prototype,"renderPointOfView",void 0);e([h.property({readOnly:!0})],f.prototype,"surfaceGeometryUpdates",void 0);e([h.property({constructOnly:!0})],f.prototype,"view",void 0);return f=e([h.subclass("esri.views.3d.support.PointsOfInterest")],f)}(h.declared(g));f.PointsOfInterest=m;var v=b.vec3d.create(),z=200,y=3E3;f.default=m})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../PropertiesPool ./PointOfInterest".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){Object.defineProperty(f,"__esModule",{value:!0});var n=Array;m=function(f){function l(b){b=f.call(this,b)||this;b.propertiesPool=new a.default({location:c,renderLocation:n},b);b.estimatedSurfaceAltitude=0;b.pendingElevationQuery=null;b.renderLocation=[0,0,0];return b}k(l,f);l.prototype.initialize=function(){var a=this;this.measureSurfaceAltitudeThrottle=g.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude();var b=function(){return a.measureSurfaceAltitudeThrottle()};this.map&&this.handles.add([d.on(this.map,"ground.layers","change",b,b,b)])};l.prototype.destroy=function(){this.cancelPendingRequest()};Object.defineProperty(l.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});l.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();
this.updateCameraOnSurface()};l.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCameraOnSurface()};l.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()||!!this.pendingElevationQuery};l.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};l.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();if(this.map&&
this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,q,this.state.spatialReference);var b=this.map.ground.queryElevation(q).then(function(b){a.updateSurfaceAltitude(b.geometry.z)}).catch(function(b){b&&"cancel"===b.dojoType||a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===b&&(a.pendingElevationQuery=null)});b.isFulfilled()||(this.pendingElevationQuery=b)}else this.updateSurfaceAltitude(0)};l.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==
a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};l.prototype.updateCameraOnSurface=function(){b.vec3d.set(this.state.camera.eye,p);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,p);var a=this._get("renderLocation");a[0]===p[0]&&a[1]===p[1]&&a[2]===p[2]||this._set("renderLocation",b.vec3d.set(p,this.propertiesPool.get("renderLocation")))};l.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;e([h.property({constructOnly:!0})],l.prototype,"altitudeEstimationInterval",void 0);
e([h.property({readOnly:!0,dependsOn:["renderLocation"]})],l.prototype,"location",null);e([h.property({constructOnly:!0})],l.prototype,"map",void 0);e([h.property({readOnly:!0})],l.prototype,"renderLocation",void 0);return l=e([h.subclass("esri.views.3d.support.CameraOnSurface")],l)}(h.declared(l.PointOfInterest));f.CameraOnSurface=m;var p=b.vec3d.create(),q=new c;f.default=m})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(a){a=b.call(this)||this;a.handles=new d;return a}k(a,b);a.prototype.destroy=function(){c.default(this,"handles")};e([h.property({constructOnly:!0})],a.prototype,"renderCoordsHelper",void 0);e([h.property({constructOnly:!0})],a.prototype,"surface",void 0);e([h.property({constructOnly:!0})],a.prototype,"state",void 0);return a=e([h.subclass("esri.views.3d.support.PointOfInterest")],a)}(h.declared(g));
f.PointOfInterest=m;f.default=m})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(m,f,k){function e(e){for(var d=[],g=1;g<arguments.length;g++)d[g-1]=arguments[g];if(e instanceof k&&e.destroyed)try{throw Error("instance is already destroyed");}catch(a){console.warn(a.stack)}else for(g=0;g<d.length;g++){var c=d[g];if(!(c in e))throw Error("Property '"+c+"' does not exist and cannot be disposed");var b=e[c];b&&("function"===
typeof b.destroy?b.destroy():"function"===typeof b.dispose?b.dispose():"function"===typeof b.remove&&b.remove());e instanceof k&&c in e.__accessor__.metadatas?e._set(c,null):e[c]=null}}Object.defineProperty(f,"__esModule",{value:!0});f.disposeMembers=e;f.default=e})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){Object.defineProperty(f,"__esModule",{value:!0});var q=Array;m=function(f){function m(a){a=f.call(this,a)||this;a.propertiesPool=new n.default({location:h,renderLocation:q},a);a.latestSurfaceAltitude=0;a.currentSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}k(m,f);p=m;m.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=g.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude()};Object.defineProperty(m.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});m.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};m.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};m.prototype.hasPendingUpdates=
function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};Object.defineProperty(m.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});m.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};m.prototype.updateCenterOnSurface=function(){var a=r,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),d=this.currentSurfaceAltitude!==
this.latestSurfaceAltitude;!b&&d&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);d=t;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,d)&&(c.vec3d.set(d,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=c.vec3d.dist(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,c.vec3d.add(c.vec3d.scale(b.viewForward,this._get("distance"),a),b.eye));b=this._get("renderLocation");
b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",c.vec3d.set(a,this.propertiesPool.get("renderLocation")))};m.prototype.calculateSurfaceIntersection=function(b,d){var e=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(e.eye,e.viewForward,b,d))return!1;if(this.state.isGlobal){b=a.earthRadius+b;var g=c.vec3d.length2(e.eye),h=g<b*b,f=c.vec3d.dist(e.eye,d);h&&f>a.earthRadius/4&&c.vec3d.add(c.vec3d.scale(e.viewForward,b-Math.sqrt(g),d),e.eye)}else if(e=this.surface.ready&&
this.surface.extent)d[0]=l.clamp(d[0],e[0],e[2]),d[1]=l.clamp(d[1],e[1],e[3]);return!0};m.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,d){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,d)){var e=this.state.camera.eye;a=c.vec3d.dist(e,a);d=c.vec3d.dist(e,d);if(b.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(d-a)/a>p.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};var p;
m.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;e([d.property({constructOnly:!0})],m.prototype,"altitudeEstimationInterval",void 0);e([d.property({readOnly:!0})],m.prototype,"distance",void 0);e([d.property({constructOnly:!0})],m.prototype,"estimateSurfaceAltitudeAtCenter",void 0);e([d.property({readOnly:!0,dependsOn:["renderLocation"]})],m.prototype,"location",null);e([d.property({readOnly:!0})],m.prototype,"renderLocation",void 0);return m=p=e([d.subclass("esri.views.3d.support.CenterOnSurface")],m)}(d.declared(p.PointOfInterest));
f.CenterOnSurface=m;var r=c.vec3d.create(),t=c.vec3d.create();f.default=m})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Handles","../Evented"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function d(d){this.handles=new k;this.events=new e.Evented;this.contentLayerViews=d.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),
removed:[],moved:[],target:this.contentLayerViews})}d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.layerViewsChanged=function(d){var c=this;d.added.forEach(function(b){"esri.views.3d.layers.SceneLayerView3D"===b.declaredClass&&c.handles.add(b.on("visible-geometry-changed",c.contentChanged.bind(c)),b.uid)});d.removed.forEach(function(b){return c.handles.remove(b.uid)})};d.prototype.contentChanged=function(){this.events.emit("request-update",g)};
return d}();f.ContentGeometryUpdates=m;var g={};f.default=m})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});var l=Array;m=function(a){function f(c){c=
a.call(this,c)||this;c.propertiesPool=new b.default({locationOnSurface:d,renderLocationOnSurface:l},c);c.centerOnSurface=null;return c}k(f,a);Object.defineProperty(f.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,
b=this.renderCoordsHelper,d=this.calculateScreenHorizontalEdgeOnSurface(r);h.vec3d.subtract(a,this.state.camera.eye,n);h.vec3d.normalize(n);b.worldUpAtPosition(a,p);var e=Math.abs(Math.acos(h.vec3d.dot(p,n))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),e=1-c.clamp(e/(.5*Math.PI),0,1);h.vec3d.lerp(a,d,e*e*e,b);return b},enumerable:!0,configurable:!0});f.prototype.update=function(a){};f.prototype.forceUpdate=function(){};f.prototype.hasPendingUpdates=function(){return this.centerOnSurface.hasPendingUpdates()};
f.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var b=this.state.camera,c=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),d=this.renderCoordsHelper.getAltitude(b.eye)>=c?b.padding[2]:b.fullHeight-b.padding[0];b.unprojectPoint([b.padding[3]+b.width/2,d,.5],q);d=h.vec3d.normalize(h.vec3d.subtract(q,b.eye,q));this.renderCoordsHelper.intersectManifold(b.eye,d,c,a)||(h.vec3d.set(b.eye,a),this.renderCoordsHelper.setAltitude(c,a));return a};e([g.property({constructOnly:!0})],
f.prototype,"centerOnSurface",void 0);e([g.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],f.prototype,"locationOnSurface",null);e([g.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],f.prototype,"renderLocationOnSurface",null);return f=e([g.subclass("esri.views.3d.support.CenterOnSurface")],f)}(g.declared(a.PointOfInterest));f.Focus=m;var n=h.vec3d.create(),p=h.vec3d.create(),q=h.vec3d.create(),r=h.vec3d.create();f.default=m})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function f(a){a=g.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new d;return a}k(f,g);Object.defineProperty(f.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference",
"surfaceView.extent"],function(){return a._update()}),h.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};f.prototype.destroy=function(){this._handles.destroy()};f.prototype._update=function(){var c=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var d=a.center(this.surfaceView.extent),d=new b({x:d[0],y:d[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(d,{noDataValue:0}).then(function(a){c._updatePromise=null;c._set("location",a.geometry)}).catch(function(a){"cancel"===a||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",d)}else this._set("location",null)};e([c.property({constructOnly:!0})],f.prototype,"view",void 0);e([c.property({readOnly:!0,aliasOf:"view.map.ground"})],
f.prototype,"surface",void 0);e([c.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],f.prototype,"surfaceView",void 0);e([c.property({readOnly:!0})],f.prototype,"location",void 0);e([c.property({readOnly:!0,dependsOn:["location"]})],f.prototype,"renderLocation",null);return f=e([c.subclass("esri.views.3d.terrain.StableSurfaceCenter")],f)}(c.declared(g));f.StableSurfaceCenter=m;f.default=m})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../geometry/support/aaBoundingRect ../../lib/gl-matrix ../debugFlags ../Evented".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function d(a){var b=this;this.handles=new k;this.tileGeometryUpdateExtent=g.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new c.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return b.tileGeometryChangeHandler(a)}))}
d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",b),this.hasPendingTileGeometryChanges=!1)};d.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};d.prototype.tileGeometryChangeHandler=function(a){var b=this;this.tileGeometryUpdateSpatialReference=
a.spatialReference;g.expand(this.tileGeometryUpdateExtent,a.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(e.schedule(function(){return b.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};d.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(h.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",b));g.empty(this.tileGeometryUpdateExtent)};d.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};d.prototype.centerIntersectsExtent=function(b,c){var d=this.state.camera.eye,e=n,h=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(d,a,c);this.renderCoordsHelper.fromRenderCoords(h.renderLocation,
l,c);a[0]<l[0]?(e[0]=a[0],e[2]=l[0]):(e[0]=l[0],e[2]=a[0]);a[1]<l[1]?(e[1]=a[1],e[3]=l[1]):(e[1]=l[1],e[3]=a[1]);return g.intersects(e,b)};return d}();f.SurfaceGeometryUpdates=m;var b={},a=d.vec3d.create(),l=d.vec3d.create(),n=g.empty();f.default=m})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ../support/Evented ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O,J,Q){function H(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function K(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function R(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var g in e.layerInfo)for(var h in e.layerInfo[g]){var f=e.layerInfo[g][h].upsampleFromTile;if(f&&f.tile===b)return!0}c=c||R(e,b)}}return c}var P=M.weakAssert,L=a.getLogger("esri.views.3d.terrain.TerrainSurface");
m=function(a){function d(c,d){c=a.call(this)||this;c.defaultTileBackground=D.DEFAULT_TILE_BACKGROUND;c.hideSkirtsDistanceFromExtentMargin=T;c.hideSkirtsMinimumCameraTilt=S;c.hideSkirtsMaximumCameraTilt=W;c._clippingExtent=null;c._dataExtent=null;c._elevationBounds=[0,0];c._rootExtent=r.create();c._iteratorPool=new l(O.IteratorPreorder);c._postorderIterator=new O.IteratorPostorder;c.visible=!1;c.suspended=!1;c._pendingUpdates=!1;c._lvPendingUpdates=!1;c._updateNextFrame=0;c._vectorTileLayerRequests=
0;c._memoryUsed=0;c._overlayOpacity=1;c._eyePosRenderSR=t.vec3d.create();c._eyePosSurfaceSR=t.vec3d.create();c._splitLimits=[0,0,0,0,0,0];c._frustumPlanes=Array(6);c._viewProjectionMatrix=t.mat4d.identity();c.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};c._layerViews=[[],[]];c._layerIndexByLayerViewId=[{},{}];c._basemapLayerViewHandles={};c._handles=new b;
c._lowPrioUpdates=new n;c._topLevelTilemapOnlyTiles=Array(D.TILEMAP_SIZE_EXP+1);c.loaded=!1;c.maxTextureScale=1.2;c.rootTiles=null;c.backgroundImage=D.DEFAULT_TILE_BACKGROUND;c.backgroundColor=null;for(d=0;d<c._topLevelTilemapOnlyTiles.length;d++)c._topLevelTilemapOnlyTiles[d]=new I([d-D.TILEMAP_SIZE_EXP,0,0]);for(d=0;6>d;d++)c._frustumPlanes[d]=t.vec4d.create();return c}k(d,a);d.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};d.prototype.initialize=
function(){var a=this;this.tilePool="planar"===this.manifold?A.Pool:B.Pool;this._renderer=new F(this.manifold,null);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.install(this._view._stage);p.init(this,"_background",function(){a._renderer.updateTileBackground(a._background)});this._handles.add(this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}));this._set("overlayManager",new y({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",
this._handleHasHighlights.bind(this)),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new C.SurfaceExtentHelperGlobal(b):new C.SurfaceExtentHelperLocal(b);this._handles.add(p.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new c({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,
getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new E({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=
this._view.resourceController.getStreamDataSupplier(z.ClientType.TERRAIN);this._handles.add(this._view.resourceController.registerFrameWorker(function(b){return a._frame(b)}));this._handles.add(this._view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a._needsIdleUpdate()},idleFrame:function(){return a._idleUpdate()}}));this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryEvents.on("quality-changed",function(){return a._viewChangeUpdate()});
this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});
this._updateClippingExtent();this.notifyChange("extent")};d.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=
this._stage=this._view=this._renderer=null};Object.defineProperty(d.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"baseOpacity",
{set:function(a){this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",
a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});d.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};d.prototype.isVisible=function(){return this.visible&&this.ready};d.prototype.isSeeThrough=function(){return!this._renderer.isOpaque()};d.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};
d.prototype.intersect=function(a,b,c){this._renderer.intersect(a,b,c,null)};d.prototype.getElevation=function(a){if(!this.ready)return null;var b=this.rootTiles;if(0===b[0].layerInfo[D.LayerClass.ELEVATION].length)return null;var c=X;if(Array.isArray(a))c=a;else if("point"===a.type&&!x.pointToVector(a,c,this.tilingScheme.spatialReference))return L.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var d=0;d<b.length;d++)if(a=b[d],G.isPosWithinTile(a,
c)){for(;a&&!a.renderData;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];if(b=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null)return N.elevationSampler(c[0],c[1],b);break}return null};d.prototype.getElevationBounds=function(){return this._elevationBounds};d.prototype.getScale=function(a){if(this.tilingScheme){if(!x.pointToVector(a,X,this.spatialReference))return L.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],G.isPosWithinTile(a,X)){for(;a.children[0];)b=0,X[0]>a.children[0].extent[2]&&(b+=1),X[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};d.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};
d.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};d.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!r.equals(a,this._dataExtent);b&&(this._dataExtent?r.set(this._dataExtent,a):this._dataExtent=r.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(P(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),
this._renderer.setTileSize(a.pixelSize[0]),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};d.prototype._acquireTile=function(a,b,c,d){var e=this.tilePool.acquire();U[0]=a;U[1]=b;U[2]=c;e.init(U,d,this,this.tilingScheme);return e};d.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};d.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,
c=this.tilingScheme;if(b&&c){var d=aa,e=c.rootTilesInExtent(b,d,Infinity);if(this.rootTiles){if(e.length>D.MAX_ROOT_TILES){L.warn(D.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),g=h.difference(b,e,H);if(0<g.removed.length||0<g.added.length){var f=this.rootTiles.filter(function(b){return-1<h.findIndex(g.removed,H.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});g.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);f.push(b);
a._loadTile(b)});this._set("rootTiles",f);this._renderer.setRootTiles(this.rootTiles)}}else e.length>D.MAX_ROOT_TILES&&(L.warn(D.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),e=c.rootTilesInExtent(b,d,D.MAX_ROOT_TILES)),this._set("rootTiles",e.map(function(b){b=a._acquireTile(0,b[1],b[2],null);a._loadTile(b);return b})),this._renderer.setRootTiles(this.rootTiles);h.equals(d,this._rootExtent)||(this._rootExtent=r.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();
this.overlayManager.setOverlayDirty();this.notifyChange("ready")}};d.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateSkirts(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]),this._updateTiles())};d.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.pendingUpdates&D.TileUpdateTypes.UPDATE_GEOMETRY&&(this._updateTileGeometry(a),a.pendingUpdates&=~D.TileUpdateTypes.UPDATE_GEOMETRY)};
d.prototype._updateTiles=function(a){void 0===a&&(a=this.rootTiles);if(a){var b=this._iteratorPool.acquire();b.reset(a);var c=this._splitLimits,d=this._frustumPlanes,e;G.hasVisibleSiblings(a)?(a=this._elevationBounds[0],e=this._elevationBounds[1]):(a=Infinity,e=-Infinity);for(;!b.done;){var g=b.next();this._updateClippingStatus(g);if(g.updateVisibility(d)){g.updateScreenDepth(this._viewProjectionMatrix);g.renderData&&(a=Math.min(g.elevationBounds[0],a),e=Math.max(g.elevationBounds[1],e));var h=g.shouldSplit(c,
this._eyePosRenderSR);if(h===D.TileUpdateTypes.SPLIT){g.pendingUpdates&=~D.TileUpdateTypes.MERGE;g.renderData&&(g.pendingUpdates|=D.TileUpdateTypes.SPLIT,b.skipSubtree());this._pendingUpdates=this._pendingUpdates||0!==g.pendingUpdates;continue}g.pendingUpdates&=~D.TileUpdateTypes.SPLIT;h===D.TileUpdateTypes.VSPLITMERGE&&g.updateAgents(D.LayerClass.ELEVATION)}b.skipSubtree();if(!g.renderData){g.pendingUpdates|=D.TileUpdateTypes.MERGE;g.pendingUpdates&=~D.TileUpdateTypes.SPLIT;h=this._iteratorPool.acquire();
for(h.resetOne(g);!h.done;){var f=h.next();this._updateClippingStatus(f);f.updateVisibility(d);f.visible&&f.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(h)}this._pendingUpdates=this._pendingUpdates||0!==g.pendingUpdates}this._iteratorPool.release(b);isFinite(a)&&isFinite(e)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==e)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=e,this.emit("elevation-bounds-change",null))}};d.prototype._updateViewDependentParameters=
function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias());this._splitLimits[0]=b;this._splitLimits[1]=d[0]/a.width*this.maxTextureScale*e;this._splitLimits[2]=c;this._splitLimits[3]=d[1]/a.height*this.maxTextureScale*e;this._splitLimits[4]=this.tilingScheme.getMaxLod();this._splitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._frustumPlanes);t.mat4d.multiply(a.projectionMatrix,
a.viewMatrix,this._viewProjectionMatrix);t.vec3d.set(a.eye,this._eyePosRenderSR);x.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};d.prototype._updateSkirts=function(){M.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};d.prototype._setLayerViewsUpdating=function(){for(var a=0;a<D.LayerClass.COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c].updatingChanged(this._pendingUpdates)};d.prototype._frameTraversal=
function(a){if(this.suspended||!this._pendingUpdates)return!1;this._lowPrioUpdates.clear();this._pendingUpdates=!1;var b=this._renderer.resourceCounter,c=b.numTileTexturesComposited,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=!1,g=0;!(d.done||a.done()&&e)&&b.numTileTexturesComposited-c<Y;){var h=d.next(),g=g+h.memoryUsed;h.pendingUpdates&D.TileUpdateTypes.MERGE?(this._mergeTile(h),h.pendingUpdates&=~D.TileUpdateTypes.MERGE,e=!0,d.skipSubtree()):h.pendingUpdates&D.TileUpdateTypes.SPLIT?
(this._splitTile(h),h.pendingUpdates&=~D.TileUpdateTypes.SPLIT,e=!0,d.skipSubtree()):0<h.pendingUpdates&&this._lowPrioUpdates.push(h);this._pendingUpdates=this._pendingUpdates||0!==h.pendingUpdates}d.done?this._memoryUsed=g:this._pendingUpdates=!0;this._iteratorPool.release(d);return e};d.prototype._updateTileGeometry=function(a){this._renderer.updateTileGeometry(a);this._elevationUpdate(a)};d.prototype._elevationUpdate=function(a){ha.spatialReference=this.spatialReference;ha.tile=a;ha.extent=a.extent;
this.emit("elevation-change",ha);r.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};d.prototype._frame=function(a){if(this.rootTiles){for(var b=this._frameTraversal(a);(!a.done()||!b)&&0<this._lowPrioUpdates.length;){var c=this._lowPrioUpdates.pop();c.pendingUpdates&D.TileUpdateTypes.DECODE_ELEVATION?(this._decodeElevation(c,a)&&(c.pendingUpdates&=~D.TileUpdateTypes.DECODE_ELEVATION),b=!0):c.pendingUpdates&D.TileUpdateTypes.UPDATE_GEOMETRY?(this._updateTileGeometry(c),c.pendingUpdates&=
~D.TileUpdateTypes.UPDATE_GEOMETRY,b=!0):c.pendingUpdates&D.TileUpdateTypes.UPDATE_TEXTURE&&(this._renderer.updateTileTexture(c),c.pendingUpdates&=~D.TileUpdateTypes.UPDATE_TEXTURE,b=!0);this._pendingUpdates=this._pendingUpdates||0!==c.pendingUpdates}if(0<this._lowPrioUpdates.length||this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),
this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0);b&&(this._memoryUsed=0)}};d.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};d.prototype._idleUpdate=function(){this.overlayManager.updateOverlays();this._updateOverlayOpacity(this._eyePosSurfaceSR[2])};d.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=r.create(),b=null;x.extentToBoundingRect(this._view.clippingArea,a,
this.spatialReference)&&(b=a);if(h.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this._updateTileOverlayParams();this.overlayManager.setOverlayDirty();return!0};d.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};d.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias+2*this._view.resourceController.memoryFactor-2)};d.prototype._getLodBiasCorrectedScale=
function(a){var b=this.tilingScheme.levels;a=u.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};d.prototype._cancelTilemapRequests=function(a){for(var b=0;b<D.LayerClass.COUNT;b++){var c=a.layerInfo[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.tilemapRequest&&(e.tilemapRequest.cancel(),e.tilemapRequest=null)}}};d.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._set("rootTiles",null),this.notifyChange("ready"));
for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};d.prototype._purgeChildTiles=function(a){var b=this._postorderIterator;for(b.reset([a]);!b.done;){for(var c=b.next(),d=0;4>d;d++)c.children[d]=null;c!==a&&this._purgeTile(c)}};d.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};d.prototype._splitTile=function(a){var b=a.lij[0]+1,c=2*
a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(b,c,d,a);a.children[1]=this._createTile(b,c,d+1,a);a.children[2]=this._createTile(b,c+1,d,a);a.children[3]=this._createTile(b,c+1,d+1,a);a.unload(this._renderer);Z.spatialReference=this.spatialReference;Z.extent=a.extent;Z.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",Z)};d.prototype._createTile=function(a,b,c,d){P(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._frustumPlanes);
a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._splitLimits,this._eyePosRenderSR)===D.TileUpdateTypes.SPLIT&&(a.pendingUpdates|=D.TileUpdateTypes.SPLIT,this._pendingUpdates=!0));this._loadTile(a);return a};d.prototype._mergeTile=function(a){P(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);Z.spatialReference=this.spatialReference;Z.extent=a.extent;Z.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",Z)};d.prototype._loadTile=
function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};d.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};d.prototype._decodeElevation=function(a,b){var c=a.layerInfo[D.LayerClass.ELEVATION];if(!c)return!0;for(var d=0;d<c.length;d++){var e=c[d];e.pendingUpdates&=~D.TileUpdateTypes.DECODE_ELEVATION;if(e.rawData){var g=a.decodeElevationData(e.rawData);
e.rawData=null;if(g){e.data=g;var e=[a],h=a.lij[0],f=this._iteratorPool.acquire();for(f.reset(e);!f.done;){var l=f.next();l.findElevationBoundsForLayer(d,h);l.computeElevationBounds()}this._iteratorPool.release(f);a.dataArrived(d,D.LayerClass.ELEVATION,g);this._updateTiles(e)}if(b.done())break}}return d===c.length};d.prototype._handleLayerViewChanges=function(a){var b=this,c=!1;a.added.forEach(function(a){var d=a.layer;M.isTiledLayerView(a)?(b._registerTiledLayer(a),d.loaded&&(c=!0)):a.supportsDraping&&
b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){M.isTiledLayerView(a)?(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(M.isTiledLayerView).length)&&this._updateTiledLayers()};d.prototype._registerTiledLayer=function(a){var b=this,c=[];c.push(a.watch("suspended",function(){b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));
a.on("data-changed",function(){var c=M.isElevationLayerView(a)?D.LayerClass.ELEVATION:D.LayerClass.MAP,d=b._layerIndexByLayerViewId[c][a.uid];null!=d&&b._invalidateLayerData(d,c)});this._basemapLayerViewHandles[a.uid]=c};d.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();delete this._basemapLayerViewHandles[a]}};d.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,
c=[[],[]],d=null,e=r.empty();b.forEach(function(b){var g=b.layer;if(g&&!b.suspended&&M.isTiledLayerView(b)){var h=b.fullExtent;h?a.tilingScheme.compatibleWith(b.tileInfo)?(r.expand(e,h),M.isElevationLayerView(b)?c[D.LayerClass.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===d||b.maxDataLevel>d)&&(d=b.maxDataLevel),c[D.LayerClass.MAP].push(b))):L.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn"):L.warn("Terrain: Map or elevation layer does not have fullExtent: "+
g.id)}},this);for(var b=function(a){var b=g._layerViews[a],d=c[a];d.reverse();var e=d.length,h=b.length!==e,f=Array(e),l=Array(b.length);g._layerIndexByLayerViewId[a]={};for(var k=0;k<e;k++){g._layerIndexByLayerViewId[a][d[k].uid]=k;var m=b.indexOf(d[k]);f[k]=m;k!==m&&(h=!0);-1<m&&(l[m]=k)}if(h){g._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(l,f,a)});b=g._postorderIterator;for(b.reset(g.rootTiles);!b.done;)b.next().modifyLayers(l,f,a);g._layerViews[a]=d;for(b.reset(g.rootTiles);!b.done;)d=
b.next(),d.restartAgents(a),a===D.LayerClass.ELEVATION&&d.computeElevationBounds();g._updateTiles()}},g=this,h=0;h<D.LayerClass.COUNT;h++)b(h);this.tilingScheme.levels.length-1<d&&(this.tilingScheme.ensureMaxLod(d),this._viewChangeUpdate())}};d.prototype._hasFixedExtent=function(){return!!this._clippingExtent};d.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};d.prototype.numLayers=function(a){return this._layerViews[a].length};d.prototype._updateTileTextures=function(a){void 0===
a&&(a=!1);var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().updateTexture(a);this._iteratorPool.release(b)};d.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c)};d.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};d.prototype.requestTileData=function(a,b,c){var d=
this;this.tilemapStats.tilesRequested++;var e=this.layerViewByIndex(b,c),g=e.layer;if(g.tilemapCache&&!M.isVectorTileLayerView(e)){var h=this.getTilemapTile(a),f=h.layerInfo[c][b];if(f.tilemap){if(!h.hasDataAvailable(a,b,c))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),b=new v.Promise,b.reject(),b}else{f.tilemapRequest||(f.tilemapRequest=this.requestTilemap(h,b,c,e,g));var l,k=new v.Promise(function(){l&&l.cancel()});f.tilemapRequest.always(function(){f.tilemapRequest=
null;if(!k.isCancelled()){var b=d._layerIndexByLayerViewId[c][e.uid];null!=b&&(h.hasDataAvailable(a,b,c)?(l=d._requestTileData(a,b,c,e),l.then(function(){return k.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),k.reject()))}});return k}}return this._requestTileData(a,b,c,e)};d.prototype._requestTileData=function(a,b,c,d){this.tilemapStats.tileRequestsSent++;return c===D.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,d):this._requestMapTileData(a,
b,c,d)};d.prototype._requestElevationTileData=function(a,b,c,d){var e=this;if(M.isElevationLayerView(d)){var g=function(b){var g=e._layerIndexByLayerViewId[c][d.uid];null!=g?(g=a.layerInfo[c][g],g.rawData=b,a.pendingUpdates|=D.TileUpdateTypes.DECODE_ELEVATION,g.pendingUpdates|=D.TileUpdateTypes.DECODE_ELEVATION,e._pendingUpdates=!0):L.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString())};b=function(b){K(b)||(e.tilemapStats.tileRequestErrors++,e._dispatchDataEvent(a,"dataMissing",
c,d,b))};var h=d.layer;if(M.useFetchTileForLayer(h))return h=h.fetchTile(a.lij[0],a.lij[1],a.lij[2],D.ELEVATION_NODATA_VALUE),h.then(function(a){return g(a)},b),h;h=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);h=this._streamDataSupplier.request(h,"binary");h.then(function(a,b){b.url=a;g(b)},b);return h}P(!1,"_requestElevationTileData can only be called for elevation layer views")};d.prototype._requestMapTileData=function(a,b,c,d){var e=this,g=function(b){e._dispatchDataEvent(a,"dataArrived",c,d,b)};b=
function(b){K(b)||(e._dispatchDataEvent(a,"dataMissing",c,d,b),e.tilemapStats.tileRequestErrors++)};if(M.isVectorTileLayerView(d)){var h=d.tileHandler,f=d.schemaHelper.getLevelRowColumn(a.lij);++this._vectorTileLayerRequests;h=h.getVectorTile(f[0],f[1],f[2],0);h.then(g).catch(b).then(function(){return--e._vectorTileLayerRequests});return h}if(M.useFetchTileForLayer(d.layer)&&M.isTileLayerView(d))return h=d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),h.then(g).catch(b),h;h=d.getTileUrl(a.lij[0],a.lij[1],
a.lij[2]);null!=d.refreshInterval&&d.refreshTimestamp&&(h+=(-1<h.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp);h=this._streamDataSupplier.request(h,"image");h.then(function(a,b){return g(b)},b);return h};d.prototype.requestTilemap=function(a,b,c,d,e){var g=this,h=a.lij[0]+D.TILEMAP_SIZE_EXP,f=a.lij[1]<<D.TILEMAP_SIZE_EXP,l=a.lij[2]<<D.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return e.tilemapCache.fetchTilemap(h,f,l,{timeout:6E3}).then(function(e){g.tilemapStats.tilemapRequestsPending--;
b=g._layerIndexByLayerViewId[c][d.uid];null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(a){g.tilemapStats.tilemapRequestsPending--;g.tilemapStats.tilemapRequestErrors++})};d.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>D.TILEMAP_SIZE_EXP?G.getTileNLevelsUp(a,D.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};d.prototype._dispatchDataEvent=function(a,b,c,d,e){d=this._layerIndexByLayerViewId[c][d.uid];if(null!=d)a[b](d,c,e);else L.warn("TerrainSurface: received data from unknown layer")};
d.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};d.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._overlayOpacity){var b=this._iteratorPool.acquire();
for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._overlayOpacity=a;this._renderer.setNeedsRender()}};d.prototype.getStats=function(){var a=0,b=0,c=0,d=[],e=this._iteratorPool.acquire();for(e.reset(this.rootTiles);!e.done;){var g=e.next();a++;g.renderData&&(b++,g.visible&&(c++,g=g.lij[0],d[g]=null!=d[g]?d[g]+1:1))}this._iteratorPool.release(e);return{numNodes:a,numLeaves:b,numVisible:c,numVisiblePerLevel:d}};d.prototype.getUsedMemory=
function(){if(!this.tilingScheme)return 0;if(0<this._memoryUsed)return this._memoryUsed;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();this._memoryUsed+=b.memoryUsed}this._iteratorPool.release(a);return this._memoryUsed};d.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,b=0,c=0,d=0,e=0,g=0,h=this._iteratorPool.acquire();h.reset(this.rootTiles);for(var f=this.tilingScheme.pixelSize,f=f[0]*f[1]*4;!h.done;){for(var l=h.next(),k=R(l),
m=0,n=l.layerInfo[D.LayerClass.MAP];m<n.length;m++){var p=n[m],p=p.data,q=0,r=0;p instanceof Q?q+=1.3*p.descriptor.width*p.descriptor.height*4:p instanceof HTMLImageElement?r+=f:p instanceof J&&(g+=p.getGpuMemoryUsage(),c+=p.getCpuMemoryUsage());l.renderData||k?(a+=r,d+=q):(b+=r,e+=q)}k=0;for(m=l.layerInfo[D.LayerClass.ELEVATION];k<m.length;k++)p=m[k],p=p.data,a+=p?f:0;l.renderData&&(p=l.renderData.texture,d+=p&&p.descriptor?1.3*p.descriptor.width*p.descriptor.height*4:0,l=l.renderData.estimateGeometryMemoryUsage(),
g+=l,c+=l)}this._iteratorPool.release(h);return{cpuVisibleImageData:a,cpuInvisibleImageData:b,cpuGeometryData:c,gpuVisibleImageData:d,gpuInvisibleImageData:e,gpuGeometryData:g}};d.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};d.prototype.getTile=
function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),null;var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),e=Math.floor(b[2]/c),g;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(g=a,!0):!1});if(g){for(c=1<<b[0]-1;g.lij[0]<b[0];){var h=b[1]&c?2:0;0<(b[2]&c)&&h++;if(!g.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+G.tile2str(g)),null;g=g.children[h];
c>>=1}P(g.lij[0]===b[0]&&g.lij[1]===b[1]&&g.lij[2]===b[2],"not the right tile?");return g}return null};d.prototype.setBorders=function(a){this._renderer.drawBorders=a};d.prototype.setDisableRendering=function(a){this._renderer.disableRendering=a};e([q.property({value:!1})],d.prototype,"cullBackFaces",null);e([q.property({readOnly:!0})],d.prototype,"extent",null);e([q.property({readOnly:!0})],d.prototype,"loaded",void 0);e([q.property({value:1})],d.prototype,"baseOpacity",null);e([q.property({readOnly:!0})],
d.prototype,"overlayManager",void 0);e([q.property({readOnly:!0})],d.prototype,"manifold",void 0);e([q.property()],d.prototype,"maxTextureScale",void 0);e([q.property({readOnly:!0})],d.prototype,"ready",null);e([q.property({value:1})],d.prototype,"renderOrder",null);e([q.property({readOnly:!0})],d.prototype,"rootTiles",void 0);e([q.property({value:!0})],d.prototype,"skirtScale",null);e([q.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],d.prototype,"spatialReference",void 0);e([q.property({})],
d.prototype,"backgroundImage",void 0);e([q.property({type:g})],d.prototype,"backgroundColor",void 0);e([q.property({dependsOn:["backgroundColor","backgroundImage"]})],d.prototype,"_background",null);e([q.property({readOnly:!0})],d.prototype,"tilingScheme",void 0);e([q.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],d.prototype,"tilingSchemeLocked",void 0);e([q.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],d.prototype,"tilingSchemeDone",void 0);e([q.property({readOnly:!0})],
d.prototype,"tilingSchemeLogic",void 0);e([q.property({value:!0})],d.prototype,"velvetOverground",null);e([q.property({value:!1})],d.prototype,"wireframe",null);return d=e([q.subclass("esri.views.3d.terrain.TerrainSurface")],d)}(q.declared(d,w.Evented));var T=1.2,S=80/180*Math.PI,W=110/180*Math.PI,Y=12,X=t.vec4d.create(),aa=r.create(),U=[0,0,0],ha={spatialReference:null,tile:null,extent:null},Z={spatialReference:null,extent:null,scale:0};return m})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../lib/gl-matrix ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../webgl-engine/lib/Selector".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){var y=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],A=b.getLogger("esri.views.3d.OverlayManager"),B,C=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new c;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}k(h,
b);Object.defineProperty(h.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedTextureRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setOverlayDirty()};this._renderer.forceUpdate=function(b){return a.updateOverlays(b)};this.groundSelector=
new z(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayDirty()}))};h.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);
this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};h.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};h.prototype.hasOverlays=function(){return!!this._overlays};h.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new x.Cyclical(-2.0037508342788905E7,
2.0037508342788905E7):new x.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};h.prototype.registerLayerView=function(a){var b=this,c=a.layer.uid;if(this._connectedLayers[c])A.warn("[OverlayManager#registerLayerView]: Layer "+c+" is already connected");else{var d=g(a,"draped-data-change",function(){return b.setOverlayDirty()});this._connectedLayers[c]={eventHandles:[d],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(c,
d){a.setDrapingExtent(d,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin)});this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)}};h.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];if(c.layerView===a){if(c.eventHandles)for(var d=0;d<c.eventHandles.length;d++)c.eventHandles[d].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a.overlayUpdating=!1)}}};h.prototype.setOverlayDirty=function(){this._dirty||
(this._setOverlayUpdating(!0),this._dirty=!0)};h.prototype._setLayerViewOverlayUpdating=function(a,b){if(!b||!a.suspended&&a.hasDraped)a.overlayUpdating=b};h.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[b].layerView,a);if(b=this.view.graphicsView)b.overlayUpdating=a};h.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=Math.max(a.fullWidth,a.fullHeight);b=x.nextHighestPowerOfTwo(b+
256);b=Math.min(b,2048);this._computeOverlayExtents(a,b,I);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,I.inner,b);this._updateOverlay(this._overlays.outer,1,I.outer,b);this.opacity=1;this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}};h.prototype._updateOverlay=function(a,b,c,d){var e;a:{e=a.extent;for(var g=t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:C.EXTENTS_DIFFER_THRESHOLD*Math.max(c[2]-c[0],c[3]-
c[1],e[2]-e[0],e[3]-e[1]),h=0;4>h;h++)if(Math.abs(e[h]-c[h])>g){e=!0;break a}e=!1}if(e||d!==a.resolution){n.set(a.extent,c);a.resolution=d;a.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:n.center(a.extent,q.vec3d.create())};for(var f in this._connectedLayers)e=this._connectedLayers[f].layerView,e.setDrapingExtent&&e.setDrapingExtent(b,c,this._overlaySR,d,a.renderLocalOrigin)}};h.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};h.prototype.updateOpacity=function(a){var b=
1;if(this._overlays){var c=this._scale;3.5*a<c&&(b=Math.sqrt(x.clamp((a-c/10)/(c/3.5-c/10),0,1)))}return b};h.prototype.setOverlayParamsOfTile=function(a,b,c){var d=this._overlays.inner,e=this._overlays.outer;a=n.intersection(a.extent,a.parentSurface.extent,G);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):
(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};h.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),g=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>g&&
(e=g-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null};h.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};h.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(b=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);return b?
(b.extent[2]-b.extent[0])/b.resolution:0};h.prototype._createEmptyOverlay=function(a){var b=this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createHighlightRenderTarget("overlayHighlight"+a);return{extent:n.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:{id:"O",vec3:[0,0,0]}}};h.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};h.prototype._disposeOverlays=
function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};h.prototype._intersectGroundFromView=function(a,b,c,d){var e=q.vec3d.createFrom(b*a.fullWidth,c*a.fullHeight,1);q.vec3d.unproject(e,a.viewMatrix,
a.projectionMatrix,a.fullViewport,e);b=q.vec3d.createFrom(b*a.fullWidth,c*a.fullHeight,0);q.vec3d.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b);this.groundSelector.init([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,b,e);return this.groundSelector.minResult.getIntersectionPoint(d)};h.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=q.vec3d.create(a.eye);q.vec3d.normalize(d);q.vec3d.negate(d);b=
q.vec3d.length(b);b=Math.asin(b/q.vec3d.length(a.eye));var e=Math.acos(q.vec3d.dot(a.viewForward,d)),d=x.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=x.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=q.mat4d.multiplyVec4(a.projectionMatrix,q.vec4d.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],d=x.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};h.prototype._computeOverlayExtents=function(a,
b,c){var e=this.terrainSurface.extent,g=q.vec3d.create(),h=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(a,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,g)||q.vec3d.set(h,g);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var f=q.vec3d.dist(a.eye,g),h=r.viewAngle(this.view.renderCoordsHelper,h,a.eye),h=Math.PI/2-Math.abs(h-Math.PI/2);if(w.OVERLAY_SHOW_CENTER){var k=new p({color:[255,0,0],outline:{color:[255,
255,255],width:2}}),m=new l;v.vectorToPoint(g,this._renderSR,m,this._overlaySR);k=new d({geometry:m,symbol:k});void 0!==B&&this.view.graphics.remove(B);this.view.graphics.add(k);B=k}this._overlaySREqualsRenderSR||v.vectorToVector(g,this._renderSR,g,this._overlaySR);b=.5*b*a.perPixelRatio*f*2;m=!1;f=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(b/=Math.cos(v.webMercator.y2lat(g[1])),f=this.terrainSurface.extent[3],f*=.999):(m=!0,b/=u.metersPerDegree,f=90),b>=f&&(b=f,g[1]=0,this._overlaySR.isWebMercator&&
(g[0]=0)));k=1;m&&(k=1/Math.max(.2,Math.cos(Math.abs(x.deg2rad(g[1])))),180<b*k&&(k=180/b));var t=b*k,m=c.inner;m[0]=g[0]-t;m[1]=g[1]-b;m[2]=g[0]+t;m[3]=g[1]+b;this._isSpherical&&this._shiftExtentToFitBounds(m,Infinity,f);c=c.outer;n.set(c,m);6*t>e[2]-e[0]?n.set(c,e):h<=.25*Math.PI?(c[0]-=t,c[1]-=b,c[2]+=t,c[3]+=b):(v.vectorToVector(a.eye,this._renderSR,N,this._overlaySR),q.vec2d.subtract(g,N,M),a=-Math.atan2(M[1],M[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),q.vec4d.scale(y[Math.floor(a/(.25*Math.PI))],
2*b,M),M[0]*=k,M[2]*=k,q.vec4d.add(c,M,c));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],-f),c[3]=Math.min(c[3],f));!this._isSpherical&&e&&(a=n.intersection(m,e,G),e=n.intersection(c,e,O),n.contains(a,e)&&(c[2]=c[0],c[3]=c[1]))};h.prototype._drawOverlays=function(){var a=this._overlays.inner.extent[2]-this._overlays.inner.extent[0];this._drawOverlay(this._overlays.inner,0,a);this._drawOverlay(this._overlays.outer,1,a)};h.prototype._drawOverlay=
function(a,b,c){var d=this._renderer,e=a.extent,g=a.resolution,h=this._longitudeCyclical?e[2]>this._longitudeCyclical.max:!1,f=this._longitudeCyclical?e[0]<this._longitudeCyclical.min:!1;if(h||f){E.views=F;var f=void 0,f=h?this._longitudeCyclical.max-e[0]:this._longitudeCyclical.min-e[0],f=Math.round(f/(e[2]-e[0])*g),l=E.views[0];q.vec4d.set4(0,0,f,g,l.viewport);q.vec4d.set4(e[0],e[1],this._longitudeCyclical.max,e[3],l.extent);h||(l.extent[0]+=this._longitudeCyclical.range);l=E.views[1];q.vec4d.set4(f,
0,g-f,g,l.viewport);q.vec4d.set4(this._longitudeCyclical.min,e[1],e[2],e[3],l.extent);h&&(l.extent[2]-=this._longitudeCyclical.range)}else E.views=D,n.set(E.views[0].extent,e),q.vec4d.set4(0,0,g,g,E.views[0].viewport);E.width=g;E.height=g;E.pixelRatio=c/(e[2]-e[0]);E.index=b;a.valid=d.draw(a.renderTargetId,E);a.highlightValid=d.drawHighlights(a.highlightRenderTargetId,E)};h.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||
this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):n.intersects(a,b)};h.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:n.contains(b,a)};h.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];
var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};h.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);n.offset(a,d,e)};h.EXTENTS_DIFFER_THRESHOLD=1E-5;e([a.property()],h.prototype,"view",void 0);e([a.property()],h.prototype,"terrainSurface",void 0);e([a.property({type:Boolean})],h.prototype,"hasHighlights",null);return h=e([a.subclass("esri.views.3d.terrain.OverlayManager")],h)}(a.declared(h)),E={width:0,height:0,
pixelRatio:0,views:null,index:0},D=[{viewport:n.create(),extent:n.create()}],F=[D[0],{viewport:n.create(),extent:n.create()}],M=q.vec4d.create(),N=q.vec3d.create(),I={inner:n.create(),outer:n.create()},G=n.create(),O=n.create();return C})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/gl-matrix ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(m,f,k,e,g,d,h,c){m=function(a){function g(c,
d,e,h){var f=a.call(this,g.NumSubdivisionsAtLevel)||this;f.tileUp=b;void 0!==c&&f.init(c,d,e,h);return f}k(g,a);g.prototype.init=function(b,c,e,g){a.prototype.init.call(this,b,c,e,g);this.edgeLen=this.extent[2]-this.extent[0];this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=0;this.centerAtSeaLevel[0]=d.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=d.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=
function(){a.prototype.updateRadiusAndCenter.call(this);var b=(this.extent[2]-this.extent[0])*Math.SQRT1_2,c=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(b*b+c*c)};g.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;for(var b=this.extent[0],c=this.extent[1],d=this.elevationBounds[0],e=this.extent[2],g=this.extent[3],h=this.elevationBounds[1],f=0;6>f;++f){var l=a[f];if(0<l[0]*(0<l[0]?b:e)+l[1]*(0<l[1]?c:g)+l[2]*(0<l[2]?d:h)+l[3])return!1}return!0};
g.prototype.createGeometry=function(a,b,d){a.needsUpdate=!1;c.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,d,a.clippingArea,this.renderData);this.updateMemoryUsed()};g.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];g.Pool=new e(g);return g}(h);var b=g.vec3d.createFrom(0,0,1);return m})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ../support/mathUtils ../support/buffer/typedArrayUtil ./ElevationData ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){function u(c){c instanceof b?b.Pool.release(c):c instanceof a&&a.Pool.release(c)}var x=n.weakAssert,v=g.vec3d.create(),z=g.vec4d.create(),y=g.vec4d.create(),A=g.vec3d.create(),B=p.AGENT_DONE;return function(){function f(a){this.lij=[0,0,0];this.extent=e.create();this.elevationBounds=g.vec2d.create();this.children=[null,null,null,null];this.layerInfo=Array(l.LayerClass.COUNT);this.extentWGS84Rad=e.create();this.centerAtSeaLevel=g.vec3d.create();this.center=
g.vec3d.create();this.tileUp=A;this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._memoryUsed=this.radius=this.edgeLen2=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0;this.numSubdivisionsAtLevel=a}Object.defineProperty(f.prototype,"memoryUsed",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});f.prototype.init=function(a,b,c,d){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];d.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);
this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen2=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b.elevationBounds?g.vec2d.set(b.elevationBounds,this.elevationBounds):g.vec2d.set2(0,0,this.elevationBounds);this.pendingUpdates=0;this.renderData=null;this.screenDepth=0;this.visible=!1;this.parent=b;this.parentSurface=c;for(a=0;4>a;a++)this.children[a]=null;for(a=0;a<l.LayerClass.COUNT;a++)if(c){b=c.numLayers(a);var e=void 0;this.layerInfo[a]?(e=this.layerInfo[a],
e.length=b):(e=Array(b),this.layerInfo[a]=e);for(var h=0;h<b;h++)e[h]=q.makeEmptyLayerInfo(a,e[h]),a===l.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(h,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(d.pixelSize[0],l.MAX_TILE_TESSELATION)};f.prototype.dispose=function(){for(var a=0;a<l.LayerClass.COUNT;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this.updateMemoryUsed()};f.prototype.updateMemoryUsed=function(){for(var a=this.parentSurface.tilingScheme.pixelSize,
a=a[0]*a[1]*4,b=this._memoryUsed=0,c=this.layerInfo[l.LayerClass.MAP];b<c.length;b++){var d=c[b],d=d.data;d instanceof w?this._memoryUsed+=1.3*d.descriptor.width*d.descriptor.height*4:d instanceof HTMLImageElement?this._memoryUsed+=a:d instanceof t&&(this._memoryUsed+=d.getGpuMemoryUsage()+d.getCpuMemoryUsage())}b=0;for(c=this.layerInfo[l.LayerClass.ELEVATION];b<c.length;b++)d=c[b],this._memoryUsed+=d.data?a:0;this.renderData&&(this._memoryUsed+=this.renderData.estimateGeometryMemoryUsage(),a=this.renderData.texture?
this.renderData.texture.descriptor:null)&&(this._memoryUsed+=1.3*a.width*a.height*4)};f.prototype.updateScreenDepth=function(a){g.vec3d.set(this.center,y);y[3]=1;g.mat4d.multiplyVec4(a,y,y);this.screenDepth=y[2]/y[3]};f.prototype.shouldSplit=function(a,b){var c=this.lij[0];g.vec3d.subtract(this.center,b,v);var e=g.vec3d.length2(v),h=a[4];if(e<this.edgeLen2&&c<h)return l.TileUpdateTypes.SPLIT;var f=a[1],e=2*Math.sqrt(e),k=this.edgeLen/(a[0]*e);return k<f?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],
l.TileUpdateTypes.VSPLITMERGE):l.TileUpdateTypes.NONE:c>=h?(a=c+Math.ceil(-d.log2(f/k)),a!==this.vlevel?(this.vlevel=a,l.TileUpdateTypes.VSPLITMERGE):l.TileUpdateTypes.NONE):6<c&&(g.vec3d.scale(this.tileUp,g.vec3d.dot(this.tileUp,v),z),g.vec3d.subtract(z,v),c=g.vec3d.length2(z),c>this.radius*this.radius&&(g.vec3d.scale(z,this.radius/Math.sqrt(c)),g.vec3d.add(z,this.center),g.vec3d.subtract(b,z,z),b=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(g.vec3d.dot(z,this.tileUp))+.5*
b+this.curvatureHeight)/g.vec3d.length(z))*(this.edgeLen/(a[2]*e))<.1/a[5]*a[3]))?l.TileUpdateTypes.NONE:l.TileUpdateTypes.SPLIT};f.prototype.decodeElevationData=function(a){var b;if(h.isArrayBuffer(a))try{b=c.createFromLERC(this.lij,this.extent,a,l.noDataValueOpt)}catch(F){console.warn("Error decoding raw data: %s",F.message)}else b=c.createFromFetchTileResult(this.lij,this.extent,a);return b};f.prototype.getWGS84Extent=function(){var a=this.extentWGS84Rad;return e.fromValues(d.rad2deg(a[0]),d.rad2deg(a[1]),
d.rad2deg(a[2]),d.rad2deg(a[3]))};f.prototype.load=function(a){for(var b=0;b<l.LayerClass.COUNT;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};f.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<l.LayerClass.COUNT;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==B&&(d.loadingAgent.dispose(),u(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.pendingUpdates&=~l.TileUpdateTypes.UPDATE_GEOMETRY;
this.pendingUpdates&=~l.TileUpdateTypes.UPDATE_TEXTURE};f.prototype.updateClippingStatus=function(a){if(k.equals(a,this.clippingArea))return!1;var b=this.intersectsClippingArea,c=this.isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;a=c&&this.isWithinClippingArea;b=!c&&!b&&!this.isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||
a||b||this.updateGeometry();return!0};f.prototype.updateVisibility=function(a){a=this.isVisible(a)&&this.intersectsClippingArea;if(a!==this.visible){this.visible=a;for(var b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==B&&d.loadingAgent.setSuspension(!a)}}return a};f.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};f.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};f.prototype.hasDataAvailable=function(a,
b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};f.prototype.requestLayerData=function(a,b,c){l.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);
if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&l.TileUpdateTypes.DECODE_ELEVATION||d.requestPromise)return!0;var e=this.parentSurface.requestTileData(this,a,b);if(!e||e.isFulfilled())return!1;a=function(){d.requestPromise===e&&(d.requestPromise=null)};d.requestPromise=e;e.then(a,a);return!0};f.prototype.descendants=
function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a};f.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};f.prototype.findByLij=function(a){if(this.hasLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};f.prototype.unrequestLayerData=function(a,b,c){l.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",
this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=null!=k.removeUnordered(e,c);x(c,"agent has not requested this piece of map data");1>e.length&&(e=d.requestPromise,c=!1,b===l.LayerClass.MAP&&(c=this.parentSurface.layerViewByIndex(a,l.LayerClass.MAP),c=n.isVectorTileLayerView(c)),c||x(e||d.rawData,"no pending operations on layerInfo that agents were waiting for"),e&&!e.isFulfilled()&&(e.cancel(),d.requestPromise=null),l.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",
this.lij.toString(),b,a),this.updateMemoryUsed())};f.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this.updateMemoryUsed()};f.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);
a.waitingAgents.length=0;this.updateMemoryUsed()};f.prototype.updateTexture=function(a){void 0===a&&(a=!1);this.renderData&&(a?this.parentSurface.renderer.updateTileTexture(this):(this.pendingUpdates|=l.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface.setPendingUpdates()))};f.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};f.prototype.computeElevationBounds=function(){g.vec2d.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);
for(var a=this.layerInfo[l.LayerClass.ELEVATION],b=!1,c=0;c<a.length;c++){var d=a[c];d.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],d.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],d.elevationBounds[1]),b=!0)}b||g.vec2d.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};f.prototype.updateRadiusAndCenter=function(){g.vec3d.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),z);g.vec3d.add(this.centerAtSeaLevel,
z,this.center)};f.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[l.LayerClass.ELEVATION][a];if(!c.elevationBounds||c.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,l.LayerClass.ELEVATION),r.fallsWithinLayer(this,b.layer,!1)){b=!1;if(c.data){var d=c.data;g.vec2d.set(d.bounds,z);z[2]=this.lij[0];b=!0}else{for(var e=this.parent,h=0,f=null,d=c.data;e&&(!d||h<l.ELEVATION_DESIRED_RESOLUTION_LEVEL);){h=this.vlevel-e.lij[0];f=d||f;d=e.layerInfo[l.LayerClass.ELEVATION][a].data;
if(!d&&f&&h>=l.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;e=e.parent}if(d=d||f)d.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],z),Infinity!==z[0]&&(z[2]=d.level,b=!0)}b&&(c.elevationBounds?g.vec3d.set(z,c.elevationBounds):c.elevationBounds=[z[0],z[1],z[2]])}};f.prototype.updateGeometry=function(){this.pendingUpdates|=l.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()};f.prototype.modifyLayers=function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var g=d[e];g.loadingAgent&&
g.loadingAgent!==B&&(g.loadingAgent.dispose(),u(g.loadingAgent),g.loadingAgent=null);g.waitingAgents.length=0}if(c===l.LayerClass.MAP)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;g=Array(a);for(e=0;e<a;e++){var h=b[e];g[e]=-1<h?d[h]:q.makeEmptyLayerInfo(c)}this.layerInfo[c]=g;this.updateMemoryUsed()};f.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===l.LayerClass.ELEVATION){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=
l.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()}else this.updateTexture(!0)};f.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===B&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};f.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==B&&a.loadingAgent.dispose();a.loadingAgent=null};f.prototype.agentDone=function(a,b){var c=this.layerInfo[b],
d=c[a];d.loadingAgent=B;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};f.prototype._createOrUpdateAgents=function(c,d){for(var e=d===l.LayerClass.ELEVATION?!1:!this.visible,g=this.layerInfo[d];c<g.length;++c){var h=g[c],f=!1,k=this.parentSurface.layerViewByIndex(c,d);if(h.loadingAgent)h.loadingAgent!==B&&(f=h.loadingAgent.update());else if(r.fallsWithinLayer(this,k.layer,!1)){var m;m=d===l.LayerClass.ELEVATION?b.Pool.acquire():a.Pool.acquire();(f=m.init(this,c,d,e))?
h.loadingAgent=m:(m.dispose(),u(m),h.loadingAgent=B)}if(f&&k.isOpaque)break}};f.prototype.geometryState=function(a){var b,c=this._getElevationInfo(a?a.samplerData:null),e=this.lij[0];c.samplerData?(b=this.vlevel-e,b=Math.max(e-c.maxTileLevel,l.ELEVATION_DESIRED_RESOLUTION_LEVEL-b),e=this._maxTesselation,b=d.clamp((e>>b)+1,2,e+1)):b=8>e?this.numSubdivisionsAtLevel[e]+1:2;e=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)e=null;a?(a.needsUpdate=!1,a.numVertsPerRow!==b&&
(a.numVertsPerRow=b,a.needsUpdate=!0),c.changed&&(a.samplerData=c.samplerData,a.needsUpdate=!0),k.equals(a.clippingArea,e)||(a.clippingArea=e,a.needsUpdate=!0)):a={numVertsPerRow:b,samplerData:c.samplerData,needsUpdate:!0,clippingArea:e};return a};f.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[l.LayerClass.ELEVATION],c=b.length,d=Array(c),e=0,g=0,h=!1,f=0;f<c;f++){var k=b[f];if(k.upsampleFromTile){var k=k.upsampleFromTile.tile,m=k.layerInfo[l.LayerClass.ELEVATION][f].data;a&&a[e]===
m.samplerData||(h=!0);d[e++]=m.samplerData;g=Math.max(g,k.lij[0])}else k.data&&(m=this.parentSurface.layerViewByIndex(f,l.LayerClass.ELEVATION),r.fallsWithinLayer(this,m.layer,!1)&&(m=k.data,a&&a[e]===m.samplerData||(h=!0),d[e++]=m.samplerData,g=this.lij[0]))}a&&a.length!==e&&(h=!0);0<e?d.length=e:d=null;return{changed:h,samplerData:d,maxTileLevel:g}};f.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};f.prototype.intersectsExtent=function(a){var b=
this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return f}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","../support/mathUtils","./TerrainConst"],function(m,f,k,e,g){return function(){function d(d,c,b,a){this.samplerData=null;this.level=d;this.i=c;this.j=b;this.extent=a}d.prototype.computeMinMaxValue=function(d,c,b,a){var h=Infinity,f=-Infinity;d-=this.level;var k=Math.pow(2,d);if(Math.floor(c/
k)===this.i&&Math.floor(b/k)===this.j&&0<d){var m=this.samplerData.width,r=this.samplerData.pixelData,t=.5*g.ELEVATION_NODATA_VALUE;d=(m-1)/k;b=(b-this.j*k)*d;c=(c-this.i*k)*d;if(1>d){var k=Math.floor(b),w=Math.floor(c),u=k+w*m,x=r[u],v=r[u+1],z=r[u+m],u=r[u+m+1];if(x+v+z+u<t)return h=e.bilerp(x,v,z,u,b-k,c-w),f=e.bilerp(x,v,z,u,b-k+d,c-w),m=e.bilerp(x,v,z,u,b-k,c-w+d),d=e.bilerp(x,v,z,u,b-k+d,c-w+d),a[0]=Math.min(h,f,m,d),a[1]=Math.max(h,f,m,d),a;b=k;c=w;d=1}else b=Math.floor(b),c=Math.floor(c),
d=Math.ceil(d);for(k=b;k<=b+d;k++)for(w=c;w<=c+d;w++)u=k+w*m,x=r[u],x<t?(h=Math.min(h,x),f=Math.max(f,x)):(h=0<h?0:h,f=0>f?0:f)}a[0]=h;a[1]=f;return a};d.createFromLERC=function(e,c,b,a){b=k.decode(b,a);e=new d(e[0],e[1],e[2],c);e.samplerData={pixelData:b.pixelData,width:b.width,height:b.height,minValue:b.minValue,maxValue:b.maxValue,noDataValue:b.noDataValue,safeWidth:.99999999*(b.width-1),dx:(b.width-1)/(e.extent[2]-e.extent[0]),dy:(b.width-1)/(e.extent[3]-e.extent[1]),x0:e.extent[0],y1:e.extent[3]};
e.bounds=[e.samplerData.minValue,-3E38<e.samplerData.maxValue?e.samplerData.maxValue:0];return e};d.createFromFetchTileResult=function(e,c,b){e=new d(e[0],e[1],e[2],c);c=b.values;for(var a=b.noDataValue,g=Infinity,h=-Infinity,f=!0,k=0;k<c.length;k++){var m=c[k];m!==a&&(g=m<g?m:g,h=m>h?m:h,f=!1)}f&&(h=g=0);e.samplerData={pixelData:b.values,width:b.width,height:b.height,minValue:g,maxValue:h,noDataValue:a,safeWidth:.99999999*(b.width-1),dx:(b.width-1)/(e.extent[2]-e.extent[0]),dy:(b.width-1)/(e.extent[3]-
e.extent[1]),x0:e.extent[0],y1:e.extent[3]};e.bounds=[g,h];return e};return d}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent ./UpsampleInfo".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}k(b,c);b.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),
this.updateGeometry());this._dataRequested=null;this._requestNext()};b.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=g.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};b.prototype._findAncestorWithData=function(){for(var a=this.layerClass,b=this.layerIdx,c=this.tile,d=c.vlevel,e;c&&!(c.layerInfo[a][b].data&&(e=c,d-c.lij[0]>=g.ELEVATION_DESIRED_RESOLUTION_LEVEL));)c=c.parent;return e?(a=h.Pool.acquire(),a.init(e,0,0,1),a):null};b.prototype._desiredMinLevelDelta=
function(){return g.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};b.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=h.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};b.Pool=new e(b);return b}(d)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","./tileUtils","./UpsampleInfo"],function(m,f,k,e){function g(d,c,b,a,f,k,m){if(!d.parent||6<m)return null;a*=.5;f*=.5;k*=.5;d.lij[2]&
1&&(f+=.5);0===(d.lij[1]&1)&&(k+=.5);return d.parent.hasLayerData(c,b)?(c=e.Pool.acquire(),c.init(d.parent,f,k,a),c):g(d.parent,c,b,a,f,k,m+1)}var d=Error("Abstract method called on TileAgent");return function(){function h(){}h.prototype.init=function(c,b,a,d){this.tile=c;this.layerIdx=b;this.layerClass=a;this.suspended=d;this._tileLayerInfo=c.getLayerInfo(b,a);this._dataRequested=null;(c=this._findAncestorWithData())?(this._setUpsamplingTile(c.tile),e.Pool.release(c)):this._unsetUpsamplingTile();
return this._requestNext(!0)};h.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};h.prototype.setSuspension=function(c){c!==this.suspended&&((this.suspended=c)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};h.prototype.update=function(){var c=this._findAncestorWithData(),
b=this._tileLayerInfo.upsampleFromTile;c&&(b&&c.tile!==b.tile&&this._setUpsamplingTile(c.tile),e.Pool.release(c));return this._requestNext()};h.prototype.dataArrived=function(c){throw d;};h.prototype.dataMissing=function(c){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};h.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};h.prototype._requestNext=function(c){void 0===c&&(c=!1);if(this.suspended)return!0;var b=this._findNextDownload();
if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):c||this._agentDone();return!!this._dataRequested};h.prototype._findNextDownload=function(){for(var c=this.layerIdx,b=this.layerClass,a=this.tile.parentSurface.layerViewByIndex(c,b),d=a.minDataLevel,e=a.maxDataLevel,g=this._desiredMinLevelDelta(),f=h.START_LOADING_LEVEL_DELTA+
g,m=this._scaleRangeEnabled,t,w=this.tile,u=0,x=w.lij[0],v=this._tileLayerInfo.upsampleFromTile,v=v?v.tile.lij[0]:-1,z=this.tile.parentSurface,y=z.tilemapStats,A=z.getTilemapTile(w),B=!1;w&&(!m||k.fallsWithinLayer(w,a.layer,!1))&&w.lij[0]>=d;){var C=w.layerInfo[b][c];if(C.data&&u>=g){w.lij[0]>v&&this._setUpsamplingTile(w);C.dataInvalidated&&(t=w);break}if(A&&!A.hasDataAvailable(w,c,b))B=!0;else if(w.lij[0]<=e&&!C.data&&!C.dataMissing&&(t=w,u>=f))break;(w=w.parent)&&A&&(A=A.parent||z.getTilemapTile(w));
u++}t&&x-t.lij[0]<g&&this._tileLayerInfo.upsampleFromTile&&(t=null);!t&&B&&y.tilesNotPresent++;return t};h.prototype._findAncestorWithData=function(){return g(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};h.prototype._desiredMinLevelDelta=function(){throw d;};h.prototype._setUpsamplingTile=function(c){throw d;};h.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&e.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};h.START_LOADING_LEVEL_DELTA=
4;h.AGENT_DONE=new h;return h}()})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ../lib/gl-matrix ./UpsampleInfo ../webgl-engine/materials/internal/MaterialUtil".split(" "),function(m,f,k,e,g,d){function h(a){return a[0]+"/"+a[1]+"/"+a[2]}function c(a,b){b(a);for(var d=0;4>d;d++){var e=a.children[d];e&&c(e,b)}}function b(a,c){for(var d=0;4>d;d++){var e=a.children[d];e&&b(e,c)}c(a)}Object.defineProperty(f,"__esModule",{value:!0});m=function(){function a(){this.q=
new k;this._last=null;this.done=!0}a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null;this.done=!1};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null;this.done=0===this.q.length};a.prototype.skipSubtree=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=function(){if(this.done)return null;if(this._last){var a=this._last.children;if(a[0])for(var b=3;0<=b;b--){var c=a[b];c&&this.q.push(c)}}this._last=this.q.pop();
0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();f.IteratorPreorder=m;m=function(){function a(a){void 0===a&&(a=100);this.q=new k({initialSize:a});this.done=!0}a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a)for(var b=this.q.data[a],c=0;4>c;c++){var d=b.children[c];d&&this.q.push(d)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();f.IteratorPostorder=
m;f.lij2str=h;f.tile2str=function(a){return h(a.lij)};f.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)c(a[d],b);else c(a,b)};f.traverseTilesPostorder=function(a,c){if(Array.isArray(a))for(var d=0;d<a.length;d++)b(a[d],c);else b(a,c)};f.fallsWithinLayer=function(a,b,c){if(!b)return!1;var d=b.fullExtent,e=a.extent;if(c){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;
return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};f.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};f.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};f.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,e=0;a.lij[1]>>c&1&&(e+=2);d&1&&(e+=1);return b.children[e]};f.computeUpsampleInfoForAncestor=function(a,b){for(var c=1,d=0,e=0;a!==b;)if(c*=.5,d*=.5,e*=.5,a.lij[2]&1&&(d+=.5),
0===(a.lij[1]&1)&&(e+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");a=g.Pool.acquire();a.init(b,d,e,c);return a};f.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;if(d)for(var e=0;4>e;e++){var g=d.children[e];if(g&&g!==c&&g.visible)return!0}}return!1};var a=Math.pow(2,-52),l=e.vec3d.create(),n=e.vec3d.create();f.intersectSkirts=function(b,c,g,h,f,k,m,v,z){var p=k.data,q=k.offsetIdx;k=k.strideIdx;var r=b[0],t=b[1];b=b[2];var u=c[0]-
r,w=c[1]-t;for(c=c[2]-b;g<h;g++){var x=m?m[g]:g,M=q+k*f[3*x],N=q+k*f[3*x+1],I=q+k*f[3*x+2],G=p[M],O=p[M+1],J=p[M+2];2<=p[M+3]&&(e.vec3d.set3(G,O,J,l),v(l),G+=l[0],O+=l[1],J+=l[2]);var Q=p[N],M=p[N+1],H=p[N+2];2<=p[N+3]&&(e.vec3d.set3(Q,M,H,l),v(l),Q+=l[0],M+=l[1],H+=l[2]);var N=p[I],K=p[I+1],R=p[I+2];2<=p[I+3]&&(e.vec3d.set3(N,K,R,l),v(l),N+=l[0],K+=l[1],R+=l[2]);var I=Q-G,M=M-O,H=H-J,N=N-G,K=K-O,R=R-J,P=w*R-K*c,L=c*N-R*u,T=u*K-N*w,Q=I*P+M*L+H*T,G=r-G,S=t-O,W=b-J,J=S*H-M*W,O=W*I-H*G,Y=G*M-I*S;if(Q>
a){G=G*P+S*L+W*T;if(0>G||G>Q)continue;P=u*J+w*O+c*Y;if(0>P||G+P>Q)continue}else if(Q<-a){G=G*P+S*L+W*T;if(0<G||G<Q)continue;P=u*J+w*O+c*Y;if(0<P||G+P<Q)continue}else continue;J=(N*J+K*O+R*Y)/Q;0<=J&&(I=d.computeNormal(I,M,H,N,K,R,n),z(J,I,x))}}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/ObjectPool","../lib/gl-matrix"],function(m,f,k,e){return function(){function g(d,g,c,b){this.scale=0;this.tile=null;this.offset=e.vec2d.create();void 0!==d&&this.init(d,
g,c,b)}g.prototype.init=function(d,e,c,b){this.tile=d;this.offset[0]=e;this.offset[1]=c;this.scale=b};g.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};g.Pool=new k(g);return g}()})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgent ./tileUtils".split(" "),function(m,f,k,e,g,d){return function(g){function c(){var b=g.call(this)||this;b._scaleRangeEnabled=!0;return b}
k(c,g);c.prototype.dataArrived=function(b){b===this.tile?(this._unsetUpsamplingTile(),this.tile.updateTexture()):this._setUpsamplingTile(b);this._dataRequested=null;b!==this.tile&&this._requestNext()};c.prototype._desiredMinLevelDelta=function(){return 0};c.prototype._setUpsamplingTile=function(b){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===b||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=d.computeUpsampleInfoForAncestor(this.tile,b),this.tile.updateTexture())};
c.Pool=new e(c);return c}(g)})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),function(m,f,k,e,g,d,h,c){function b(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function a(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function l(a){return a&&
"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function n(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function p(){t={};for(var a in d)d[a].baseMapLayers.forEach(function(a){t[a.url]=19});t["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=20}function q(a,b,c,d){return r["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(f,"__esModule",{value:!0});var r={planar:h,spherical:c};
f.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};f.autoUpdateSkirtsVisibility=function(a,b,c){var d=r[a.manifold],e,g=d.isInsideExtent(a,b);g?e=a.getElevation(b):(e=a.getElevationBounds(),e=.5*(e[0]+e[1]));e=b[2]-e;c=.9*Math.abs(e)<c?0:0>e?-1:1;g||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};f.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===
a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};f.isVectorTileLayer=function(a){return a&&a.isInstanceOf(g)};f.isTileLayerView=b;f.isVectorTileLayerView=a;f.isWMTSLayerView=l;f.isElevationLayerView=n;f.isTiledLayerView=function(c){return c&&(b(c)||n(c)||a(c)||l(c))};f.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===e.prototype.fetchTile||a.fetchTile===k.prototype.fetchTile)};var t=
null;f.getKnownTiledServiceLevelCap=function(a){t||p();a=a&&a.replace(/https?:/,"");return a in t?t[a]:Infinity};f.prepareKnownTiledServiceLevelCaps=p;f.checkIfTileInfoSupportedForView=q;f.getTiledLayerInfo=function(a,b,c){var d,e;if("wmts"===a.type){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)d=g.tileInfo,e=g.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==q(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d="vector-tile"===a.type?
a.compatibleTileInfo256:a.tileInfo,e=a.fullExtent;return d&&e&&null==q(d,e,b,c)?{tileInfo:d,fullExtent:e}:{tileInfo:null,fullExtent:null}}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/io-query dojo/_base/kernel ../request ../core/Error ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/rasterFormats/LercCodec".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){return function(f){function q(a){a=f.call(this)||this;a.copyright=null;a.heightModelInfo=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.type="elevation";a.url=null;return a}e(q,f);q.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};Object.defineProperty(q.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&h.deprecated(this.declaredClass+".minScale support has been removed.",
"","4.5")},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&h.deprecated(this.declaredClass+".maxScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});q.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var c=0;c<a.typeKeywords.length;c++)if("elevation 3d layer"===a.typeKeywords[c].toLowerCase())return!0;
throw new b("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}}).always(function(){return a._fetchImageService()}));return this.when()};q.prototype.fetchTile=function(a,b,d,e){var g=this;void 0===e&&(e=0);return this.load().then(function(){return g._fetchTileAvailability(a,b,d)}).then(function(){return c(g.getTileUrl(a,b,d),{responseType:"array-buffer"})}).then(function(a){a=u.decode(a.data,
{noDataValue:e,returnFileInfo:!0});return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue}})};q.prototype.getTileUrl=function(a,b,c){var e=d.objectToQuery(k({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+b+"/"+c+(e?"?"+e:"")};q.prototype.queryElevation=function(b,c){var d=this;return a.create(function(a){return m(["./support/ElevationQuery"],a)}).then(function(a){return(new a.ElevationQuery).query(d,
b,c)})};q.prototype.createElevationSampler=function(b,c){var d=this;return a.create(function(a){return m(["./support/ElevationQuery"],a)}).then(function(a){return(new a.ElevationQuery).createSampler(d,b,c)})};q.prototype.importLayerViewModule=function(c){switch(c.type){case "2d":return a.reject(new b("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"));case "3d":return a.create(function(a){return m(["../views/3d/layers/ElevationLayerView3D"],a)})}};q.prototype._fetchTileAvailability=
function(b,c,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(b,c,d):a.resolve("unknown")};q.prototype._fetchImageService=function(){var b=this;return a.resolve().then(function(){if(b.resourceInfo)return b.resourceInfo;var a={query:k({f:"json"},b.parsedUrl.query),responseType:"json"};return c(b.parsedUrl.path,a)}).then(function(a){a.ssl&&(b.url=b.url.replace(/^http:/i,"https:"));b.read(a.data,{origin:"service",url:b.parsedUrl})})};g([n.property({json:{read:{source:"copyrightText"}}})],
q.prototype,"copyright",void 0);g([n.property({readOnly:!0,type:p})],q.prototype,"heightModelInfo",void 0);g([n.property({json:{read:!1,write:!1}})],q.prototype,"minScale",null);g([n.property({json:{read:!1,write:!1}})],q.prototype,"maxScale",null);g([n.property({json:{read:!1,write:!1}})],q.prototype,"opacity",void 0);g([n.property()],q.prototype,"operationalLayerType",void 0);g([n.property()],q.prototype,"resourceInfo",void 0);g([n.property({json:{read:!1},value:"elevation",readOnly:!0})],q.prototype,
"type",void 0);g([n.property({json:{origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writer:l.writeOperationalLayerUrl}}}}})],q.prototype,"url",void 0);return q=g([n.subclass("esri.layers.ElevationLayer")],q)}(n.declared(q,r,t,w))})},"esri/layers/mixins/ArcGISCachedService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/accessorSupport/decorators ./ArcGISService ../support/TileInfo ../support/TilemapCache".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;a.copyright=null;a.minScale=0;a.maxScale=0;a.spatialReference=null;a.tileInfo=null;a.tilemapCache=null;return a}e(f,c);Object.defineProperty(f.prototype,"supportsBlankTile",{get:function(){return 10.2<=this.version},enumerable:!0,configurable:!0});f.prototype.readTileInfo=function(a,c){var d=c.minScale?Math.round(1E4*c.minScale)/1E4:Infinity,e=c.maxScale?Math.round(1E4*c.maxScale)/1E4:-Infinity;
return a?(a.lods=a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=d&&a>=e}),b.fromJSON(a)):null};f.prototype.readTilemapCache=function(b,c){return c.capabilities&&-1<c.capabilities.indexOf("Tilemap")?new a({layer:this}):null};g([h.property({json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0);g([h.property({json:{origins:{service:{read:!1}}}})],f.prototype,"minScale",void 0);g([h.property({json:{origins:{service:{read:!1}}}})],f.prototype,"maxScale",void 0);g([h.property({type:d.SpatialReference})],
f.prototype,"spatialReference",void 0);g([h.property({readOnly:!0,dependsOn:["version"]})],f.prototype,"supportsBlankTile",null);g([h.property({type:b})],f.prototype,"tileInfo",void 0);g([h.reader("service","tileInfo",["tileInfo","minScale","maxScale"])],f.prototype,"readTileInfo",null);g([h.property()],f.prototype,"tilemapCache",void 0);g([h.reader("service","tilemapCache",["capabilities"])],f.prototype,"readTilemapCache",null);g([h.property()],f.prototype,"version",void 0);return f=g([h.subclass("esri.layers.mixins.ArcGISCachedService")],
f)}(h.declared(c))})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/io-query ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUMap ../../core/PooledArray ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w){var u=
l.getLogger("esri.layers.support.TilemapCache");return function(c){function f(b){b=c.call(this)||this;b._handles=new a;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=h;return b}e(f,c);l=f;f.prototype.initialize=function(){var a=this;this._tilemapCache=new n(this.cacheByteSize,{sizeOfFunction:function(a){return a.byteSize}});this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),r.init(this,
"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},!0)]);this._initializeTilemapDefinition()};f.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};f.prototype.castLevels=function(a){return 2>=a?(u.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(f.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});f.prototype.getTilemap=function(a,b,c){return this._tilemapFromCache(a,
b,c,this._tmpTilemapDefinition)};f.prototype.fetchTilemap=function(a,c,d,e){var g=this;if(!this._availableLevels[a])return q.reject(new b("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var h=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,c,d,h))return q.resolve(a);var f=w.tilemapDefinitionId(h),k=this._pendingTilemapRequests[f];k||(k=w.Tilemap.fromDefinition(h,e).then(function(a){g._tilemapCache.set(f,a);delete g._pendingTilemapRequests[f];return a}).catch(function(a){delete g._pendingTilemapRequests[f];
return q.reject(a)}),this._pendingTilemapRequests[f]=k);return q.create(function(a,b){k.then(a,b)})};f.prototype.getAvailability=function(a,b,c){return this._availableLevels[a]?(a=this.getTilemap(a,b,c))?a.getAvailability(b,c):"unknown":"unavailable"};f.prototype.getAvailabilityUpsample=function(a,b,c,d){d.level=a;d.row=b;d.col=c;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(b=this.getAvailability(d.level,d.row,d.col),"unavailable"===b){if(!a.upsampleTile(d))return"unavailable"}else return b};
f.prototype.fetchAvailability=function(a,c,d,e){return this._availableLevels[a]?this.fetchTilemap(a,c,d,e).always(function(e){return e instanceof w.Tilemap?(e=e.getAvailability(c,d),"unavailable"===e?q.reject(new b("tile-map:tile-unavailable","Tile is not available",{level:a,row:c,col:d})):e):e&&"cancel"===e.dojoType?q.reject(e):"unknown"}):q.reject(new b("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"))};f.prototype.fetchAvailabilityUpsample=function(a,b,c,d,e){var g=
this;d.level=a;d.row=b;d.col=c;var h=this.layer.tileInfo;h.updateTileInfo(d);var f=this.fetchAvailability(a,b,c,e).catch(function(a){return a&&"cancel"===a.dojoType?q.reject(a):h.upsampleTile(d)?g.fetchAvailabilityUpsample(d.level,d.row,d.col,d):q.reject(a)}),k={id:d.id,level:a,row:b,col:c};a=function(a){var b=m.fetchAvailability(k.level,k.row,k.col,e);l._prefetches.push(b);f.always(function(){return b.cancel()});b.always(function(){return l._prefetches.removeUnordered(b)})};var m=this;for(b=0;l._prefetches.length<
l._maxPrefetch&&h.upsampleTile(k);++b)a(b);return f};f.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,b=a.query;b&&b.token||!this.layer.token||(b=k({},b,{token:this.layer.token}));this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:a.path,query:b?d.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};f.prototype._tilemapFromCache=
function(a,b,c,d){a=this._getTilemapDefinition(a,b,c,d);a=w.tilemapDefinitionId(a);return this._tilemapCache.get(a)};f.prototype._getTilemapDefinition=function(a,b,c,d){d.level=a;d.row=b-b%this.size;d.col=c-c%this.size;return d};f.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};var l;f._maxPrefetch=4;f._prefetches=new p({initialSize:l._maxPrefetch});g([t.property({constructOnly:!0,type:Number})],
f.prototype,"levels",void 0);g([t.cast("levels")],f.prototype,"castLevels",null);g([t.property({readOnly:!0,dependsOn:["levels"],type:Number})],f.prototype,"size",null);g([t.property({constructOnly:!0,type:Number})],f.prototype,"cacheByteSize",void 0);g([t.property({constructOnly:!0})],f.prototype,"layer",void 0);g([t.property({constructOnly:!0})],f.prototype,"request",void 0);return f=l=g([t.subclass("esri.layers.support.TilemapCache")],f)}(t.declared(c))})},"esri/core/LRUMap":function(){define(["require",
"exports"],function(m,f){return function(){function f(e,g){void 0===e&&(e=0);this.sizeOfFunction=function(){return 1};this._sizeOf=0;this._cache=new Map;this._queue=[];if(0>=e)throw Error("LRU cache size must be bigger than zero!");this._maxSize=e;g&&(g.disposeFunction&&(this.disposeFunction=g.disposeFunction),g.sizeOfFunction&&(this.sizeOfFunction=g.sizeOfFunction))}Object.defineProperty(f.prototype,"length",{get:function(){return this._cache.size},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"size",{get:function(){return this._sizeOf},enumerable:!0,configurable:!0});f.prototype.clear=function(){var e=this;this._queue.length=0;this.disposeFunction&&this._cache.forEach(function(g,d){e.disposeFunction(d,g)});this._cache.clear();this._sizeOf=0};f.prototype.delete=function(e){var g=this._cache.get(e);return this._cache.delete(e)?(this._sizeOf-=this.sizeOfFunction(g),this._queue.splice(this._queue.indexOf(e),1),this.disposeFunction&&this.disposeFunction(e,g),!0):!1};f.prototype.forEach=function(e,
g){this._cache.forEach(e,g)};f.prototype.get=function(e){var g=this._cache.get(e);if(void 0!==g)return this._queue.splice(this._queue.indexOf(e),1),this._queue.unshift(e),g};f.prototype.has=function(e){return this._cache.has(e)};f.prototype.set=function(e,g){var d=this.get(e);void 0!==d?this._sizeOf-=this.sizeOfFunction(d):this._queue.unshift(e);this._sizeOf+=this.sizeOfFunction(g);this._cache.set(e,g);this._collect();return this};f.prototype._collect=function(){for(;this._queue.length&&this._sizeOf>
this._maxSize;){var e=this._queue.pop(),g=this._cache.get(e);this._cache.delete(e)&&(this._sizeOf-=this.sizeOfFunction(g),this.disposeFunction&&this.disposeFunction(e,g))}};return f}()})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/Error ../../core/lang ../../core/promiseUtils".split(" "),function(m,f,k,e,g,d,h){function c(b){var a;"vector-tile"===b.service.type?a=b.service.url+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+
"/"+b.width+"/"+b.height:(a=b.service.tileServers,a=(a&&a.length?a[b.row%a.length]:b.service.url)+"/tilemap/"+b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height);(b=b.service.query)&&(a=a+"?"+b);return a}Object.defineProperty(f,"__esModule",{value:!0});m=function(){function b(){this.location={left:0,top:0,width:0,height:0};this.byteSize=40}b.prototype.getAvailability=function(a,b){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";a=(a-this.location.top)*this.location.width+
(b-this.location.left);b=a>>3;var c=this._tileAvailabilityBitSet;return 0>b||b>c.length?"unknown":c[b]&1<<a%8?"available":"unavailable"};b.prototype._updateFromData=function(a){for(var b=!0,c=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,g=0;g<a.length;g++){var h=g%8;a[g]?(c=!1,d[e]|=1<<h):b=!1;7===h&&++e}this._isAllUnvailable=c;this._isAllAvailable=b;this._isAllAvailable||this._isAllUnvailable||(this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};b.fromDefinition=
function(a,d){var f=a.service.request||e,l=a.row,m=a.col,r=a.width,t=a.height,w={query:{f:"json"}};d=d?k({},w,d):w;return f(c(a),d).then(function(a){return a.data}).catch(function(a){if(a&&a.details&&422===a.details.httpStatus){a=[];for(var b=0,c=r*t;b<c;b++)a[b]=0;return{location:{top:l,left:m,width:r,height:t},valid:!0,data:a}}return h.reject(a)}).then(function(a){if(a.location&&(a.location.top!==l||a.location.left!==m||a.location.width!==r||a.location.height!==t))throw new g("tilemap:location-mismatch",
"Tilemap response for different location than requested",{response:a,definition:{top:l,left:m,width:r,height:t}});return b.fromJSON(a)})};b.fromJSON=function(a){b.validateJSON(a);var c=new b;c.location=Object.freeze(d.clone(a.location));c._updateFromData(a.data);return Object.freeze(c)};b.validateJSON=function(a){if(!a||!a.location)throw new g("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new g("tilemap:invalid","Tilemap response was marked as invalid");
if(!a.data)throw new g("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new g("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new g("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");};return b}();f.Tilemap=m;f.tilemapDefinitionId=function(b){return b.level+"/"+b.row+"/"+b.col+"/"+b.width+"/"+b.height};f.tilemapDefinitionUrl=c;f.default=m})},"esri/layers/TileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/io-query ../geometry ../request ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayers ./support/arcgisLayerUrl".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){var y="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");return function(f){function n(a,b){a=f.call(this)||this;
a.spatialReference=null;a.sublayers=null;a.type="tile";a.url=null;return a}e(n,f);n.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};n.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service","Map Service"]}).always(function(){return a._fetchService()}));return this.when()};Object.defineProperty(n.prototype,"attributionDataUrl",{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},
enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"operationalLayerType",{get:function(){if(this.capabilities)return this.capabilities.operations.supportsExportMap?"ArcGISTiledMapServiceLayer":"ArcGISTiledImageServiceLayer";var a=this.url||this.portalItem&&this.portalItem.url;return a&&/\/ImageServer(\/|\/?$)/i.test(a)?"ArcGISTiledImageServiceLayer":"ArcGISTiledMapServiceLayer"},enumerable:!0,configurable:!0});n.prototype.readSpatialReference=function(a,b){return(a=a||b.tileInfo&&
b.tileInfo.spatialReference)&&h.SpatialReference.fromJSON(a)};Object.defineProperty(n.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!0,configurable:!0});n.prototype.castTileServers=function(b){return Array.isArray(b)?b.map(function(b){return a.urlToObject(b).path}):null};n.prototype.fetchTile=function(a,b,d,e){a=this.getTileUrl(a,b,d);b={responseType:"image"};e&&e.timestamp&&(b.query={_ts:e.timestamp});return c(a,b).then(function(a){return a.data})};
n.prototype.getTileUrl=function(a,b,c){var e=d.objectToQuery(k({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,token:this.token?encodeURIComponent(this.token):null})),g=this.tileServers;return(g&&g.length?g[b%g.length]:this.parsedUrl.path)+"/tile/"+a+"/"+b+"/"+c+(e?"?"+e:"")};n.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return b.create(function(a){return m(["../views/2d/layers/TileLayerView2D"],a)});case "3d":return b.create(function(a){return m(["../views/3d/layers/TileLayerView3D"],
a)})}};n.prototype._fetchService=function(){var a=this;return b.create(function(b,d){a.resourceInfo?b({data:a.resourceInfo}):c(a.parsedUrl.path,{query:k({f:"json"},a.parsedUrl.query),responseType:"json"}).then(b,d)}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(b.data,{origin:"service",url:a.parsedUrl});if(10.1===a.version&&!z.isHostedAgolService(a.url))return v.fetchServerVersion(a.url).then(function(b){a.read({currentVersion:b})}).catch(function(){})})};n.prototype._getMapName=
function(a){return(a=a.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&a[2]};n.prototype._getDefaultAttribution=function(b){if(b){var c;b=b.toLowerCase();for(var d=0,e=y.length;d<e;d++)if(c=y[d],-1<c.toLowerCase().indexOf(b))return a.makeAbsolute("//static.arcgis.com/attribution/"+c)}};n.prototype._getDefaultTileServers=function(a){var b=-1!==a.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),c=-1!==a.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);
return b||c?[a,a.replace(b?/server\.arcgisonline/i:/services\.arcgisonline/i,b?"services.arcgisonline":"server.arcgisonline")]:[]};g([l.property({readOnly:!0,dependsOn:["parsedUrl"]})],n.prototype,"attributionDataUrl",null);g([l.property({readOnly:!0})],n.prototype,"operationalLayerType",null);g([l.property()],n.prototype,"popupTemplates",void 0);g([l.property({type:h.SpatialReference})],n.prototype,"spatialReference",void 0);g([l.reader("spatialReference",["spatialReference","tileInfo"])],n.prototype,
"readSpatialReference",null);g([l.property()],n.prototype,"resourceInfo",void 0);g([l.property({readOnly:!0})],n.prototype,"sublayers",void 0);g([l.property({dependsOn:["parsedUrl"],readOnly:!0})],n.prototype,"tileServers",null);g([l.cast("tileServers")],n.prototype,"castTileServers",null);g([l.property({readOnly:!0,json:{read:!1}})],n.prototype,"type",void 0);g([l.property({json:{origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writer:a.writeOperationalLayerUrl}}}}})],n.prototype,"url",
void 0);return n=g([l.subclass("esri.layers.TileLayer")],n)}(l.declared(n,x.default,q,p,u,r,t,w))})},"esri/layers/support/arcgisLayers":function(){define("require exports ../../core/tsSupport/assignHelper dojo/when ../../request ../../core/Error ../../core/promiseUtils ./arcgisLayerUrl ./arcgisLayerUrl ./lazyLayerLoader".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a,b){return a.sublayerIds.map(function(c){return new a.Constructor(k({},b,{layerId:c,sublayerTitleMode:"service-name"}))})}function n(c){var g=
b.parse(c);if(!g)return h.reject(new d("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:c}));var f=g.serverType,k=g.sublayer,l={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(f){case "MapServer":f=null!=k?"FeatureLayer":q(c).then(function(a){return a?"TileLayer":"MapImageLayer"});break;case "ImageServer":f=t(c).then(function(a){var b=a.tileInfo&&a.tileInfo.format;return a.tileInfo?b&&"LERC"===b.toUpperCase()&&a.cacheType&&
"elevation"===a.cacheType.toLowerCase()?"ElevationLayer":"TileLayer":"ImageryLayer"});break;case "SceneServer":f=t(g.url.path).then(function(a){var b={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer"};return a&&Array.isArray(a.layers)&&0<a.layers.length&&(a=a.layers[0].layerType,null!=b[a])?b[a]:"SceneLayer"});break;default:f=l[f]}var m={FeatureLayer:!0,SceneLayer:!0},n={parsedUrl:g,Constructor:null,sublayerIds:null},r;return e(f).then(function(a){r=
a;if(m[a]&&null==k)return p(c).then(function(a){1!==a.length&&(n.sublayerIds=a)})}).then(function(){return(0,a.layerLookupMap[r])()}).then(function(a){n.Constructor=a;return n})}function p(a){return t(a).then(function(a){return a&&Array.isArray(a.layers)?a.layers.map(function(a){return a.id}).reverse():[]})}function q(a){return t(a).then(function(a){return a.tileInfo})}function r(a,b){a=a.Constructor.prototype.declaredClass;return"esri.layers.FeatureLayer"===a||"esri.layers.StreamLayer"===a?k({outFields:["*"]},
b):b}function t(a){return g(a,{responseType:"json",query:{f:"json"}}).then(function(a){return a.data})}Object.defineProperty(f,"__esModule",{value:!0});f.fromUrl=function(a){return n(a.url).then(function(b){var c=r(b,k({},a.properties,{url:a.url}));return b.sublayerIds?h.create(function(a){return m(["../GroupLayer"],a)}).then(function(a){var d=new a({title:b.parsedUrl.title});l(b,c).forEach(function(a){return d.add(a)});return h.resolve(d)}):h.resolve(new b.Constructor(c))})};f.fetchServerVersion=
function(a){if(!c.test(a))return h.reject();a=a.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return g(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data&&a.data.currentVersion?a.data.currentVersion:h.reject()})}})},"esri/layers/support/lazyLayerLoader":function(){define(["require","exports","../../core/promiseUtils"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.layerLookupMap={CSVLayer:function(){return k.create(function(e){return m(["../CSVLayer"],e)})},ElevationLayer:function(){return k.create(function(e){return m(["../ElevationLayer"],
e)})},FeatureLayer:function(){return k.create(function(e){return m(["../FeatureLayer"],e)})},GroupLayer:function(){return k.create(function(e){return m(["../GroupLayer"],e)})},GeoRSSLayer:function(){return k.create(function(e){return m(["../GeoRSSLayer"],e)})},ImageryLayer:function(){return k.create(function(e){return m(["../ImageryLayer"],e)})},KMLLayer:function(){return k.create(function(e){return m(["../KMLLayer"],e)})},MapImageLayer:function(){return k.create(function(e){return m(["../MapImageLayer"],
e)})},MapNotesLayer:function(){return k.create(function(e){return m(["../MapNotesLayer"],e)})},OpenStreetMapLayer:function(){return k.create(function(e){return m(["../OpenStreetMapLayer"],e)})},PointCloudLayer:function(){return k.create(function(e){return m(["../PointCloudLayer"],e)})},SceneLayer:function(){return k.create(function(e){return m(["../SceneLayer"],e)})},IntegratedMeshLayer:function(){return k.create(function(e){return m(["../IntegratedMeshLayer"],e)})},StreamLayer:function(){return k.create(function(e){return m(["../StreamLayer"],
e)})},TileLayer:function(){return k.create(function(e){return m(["../TileLayer"],e)})},UnknownLayer:function(){return k.create(function(e){return m(["../UnknownLayer"],e)})},UnsupportedLayer:function(){return k.create(function(e){return m(["../UnsupportedLayer"],e)})},VectorTileLayer:function(){return k.create(function(e){return m(["../VectorTileLayer"],e)})},WebTileLayer:function(){return k.create(function(e){return m(["../WebTileLayer"],e)})},WMSLayer:function(){return k.create(function(e){return m(["../WMSLayer"],
e)})},WMTSLayer:function(){return k.create(function(e){return m(["../WMTSLayer"],e)})},BingMapsLayer:function(){return k.create(function(e){return m(["../BingMapsLayer"],e)})}}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){return function(c){function f(a,b){a=c.call(this)||this;a.capabilities=null;a.currentStyleInfo=null;a.fullExtent=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.tilemapCache=null;a.type="vector-tile";a.url=null;return a}e(f,c);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};f.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Vector Tile Service"],
supportsData:!1}).then(function(){if(a.portalItem&&a.portalItem.id){var b=a.portalItem.itemUrl+"/resources/styles/root.json";return d(b,{query:{f:"json"}}).then(function(c){c.data&&a.read({url:b},A.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(b);return this.when()};Object.defineProperty(f.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&l.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):
null},enumerable:!0,configurable:!0});f.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});a=!!b.exportTilesAllowed;c=-1!==c.indexOf("tilemap");return{operations:{supportsExportTiles:a,supportsTileMap:c},exportTiles:a?{maxExportTilesCount:+b.maxExportTilesCount}:null}};Object.defineProperty(f.prototype,"parsedUrl",{get:function(){return this.serviceUrl?a.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});f.prototype.writeStyleUrl=
function(a,b){a&&l.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};f.prototype.readTileIndexType=function(a,b){return b.type};f.prototype.readTileIndexUrl=function(a,b){return l.join(this.serviceUrl,b.tileMap)};f.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new z({layer:this}):null};f.prototype.readTileServers=function(a,b){a=b.tiles;var c=this.serviceUrl||this.styleUrl&&l.removeFile(this.styleUrl);c&&a.forEach(function(a,b,d){l.isAbsolute(a)?
d[b]=a:d[b]=l.join(c,a)});return a};f.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};f.prototype.readCompatibleTileInfo256=function(a,b){return v.fromJSON(B.create256x256CompatibleTileInfo(b.tileInfo))};f.prototype.readCompatibleTileInfo512=function(a,b){return v.fromJSON(B.create512x512CompatibleTileInfo(b.tileInfo))};f.prototype.loadStyle=function(a){a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;
var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};f.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};f.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new h("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+
this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};f.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return b.create(function(a){return m(["../views/2d/layers/VectorTileLayerView2D"],a)});case "3d":return b.create(function(a){return m(["../views/3d/layers/VectorTileLayerView3D"],a)})}};f.prototype._getSourceAndStyle=function(a){var c=this;return a?y.loadMetadata(a).then(function(b){c._set("currentStyleInfo",{serviceUrl:b.serviceUrl,
styleUrl:b.styleUrl,spriteUrl:b.spriteUrl,glyphsUrl:b.glyphsUrl,style:b.style,layerDefinition:b.layerDefinition});"string"===typeof a?(c.url=a,c.style=null):(c.url=null,c.style=a);c._set("styleRepository",new C(b.style,b));c.read(b.layerDefinition,{origin:"service"})}):b.reject(Error("invalid style!"))};f.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return l.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};g([n.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],f.prototype,"attributionDataUrl",null);g([n.property({readOnly:!0})],f.prototype,
"capabilities",void 0);g([n.reader("capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount"])],f.prototype,"readCapabilities",null);g([n.property({readOnly:!0})],f.prototype,"currentStyleInfo",void 0);g([n.property({type:p,readOnly:!0})],f.prototype,"fullExtent",void 0);g([n.property()],f.prototype,"style",void 0);g([n.property({readOnly:!0,dependsOn:["serviceUrl"]})],f.prototype,"parsedUrl",null);g([n.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],f.prototype,"serviceUrl",
null);g([n.property({type:q,dependsOn:["tileInfo"],readOnly:!0})],f.prototype,"spatialReference",null);g([n.property({readOnly:!0})],f.prototype,"styleRepository",void 0);g([n.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],f.prototype,"styleUrl",null);g([n.writer(["portal-item","web-document"],"styleUrl")],f.prototype,"writeStyleUrl",null);g([n.property({readOnly:!0})],f.prototype,
"tileIndexType",void 0);g([n.reader("tileIndexType",["tileIndexType","type"])],f.prototype,"readTileIndexType",null);g([n.property({readOnly:!0})],f.prototype,"tileIndexUrl",void 0);g([n.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],f.prototype,"readTileIndexUrl",null);g([n.property({readOnly:!0,type:v})],f.prototype,"tileInfo",void 0);g([n.property({readOnly:!0,type:z})],f.prototype,"tilemapCache",void 0);g([n.reader("tilemapCache",["capabilities"])],f.prototype,"readTilemapCache",null);g([n.property({readOnly:!0})],
f.prototype,"tileServers",void 0);g([n.reader("tileServers",["tiles"])],f.prototype,"readTileServers",null);g([n.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],f.prototype,"type",void 0);g([n.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],f.prototype,"url",void 0);g([n.property({readOnly:!0})],f.prototype,"version",void 0);g([n.reader("version",["version","currentVersion"])],f.prototype,"readVersion",null);
g([n.property({readOnly:!0})],f.prototype,"compatibleTileInfo256",void 0);g([n.reader("compatibleTileInfo256",["tileInfo"])],f.prototype,"readCompatibleTileInfo256",null);g([n.property({readOnly:!0})],f.prototype,"compatibleTileInfo512",void 0);g([n.reader("compatibleTileInfo512",["tileInfo"])],f.prototype,"readCompatibleTileInfo512",null);return f=g([n.subclass("esri.layers.VectorTileLayer")],f)}(n.declared(r,w,u,x,c,t))})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),
function(m,f,k,e,g,d,h){function c(a){a&&(a=h.getOrigin(a),l&&-1===l.indexOf(a)&&l.push(a))}function b(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)h.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=h.isAbsolute(a[c])?a[c]:h.join(b,a[c]);return b}function a(e,f,k){var l,m,n;"string"===typeof f?(f=h.normalize(f),c(f),l=h.urlToObject(f),l=g(l.path,{query:{f:"json"},responseType:"json"}),n=m=f):(l=d.resolve({data:f}),m=f.jsonUrl||
null,n=k);return l.then(function(g){var f=g.data;g.ssl&&(m&&(m=m.replace(/^http:/i,"https:")),n&&(n=n.replace(/^http:/i,"https:")));if(f.sources){e.styleUrl=m||null;g=n?h.removeFile(n):h.appBaseUrl;e.styleBase=g;e.style=f;e.styleUrl&&c(e.styleUrl);if(e.source)f=d.resolve();else{b:if(f=f.sources,f.esri)f=f.esri;else{for(var k=0,l=Object.keys(f);k<l.length;k++){var p=l[k];if("vector"===f[p].type){f=f[p];break b}}f=null}f=f.url?a(e,b(g,f.url)):a(e,f,g)}return f}if(f.sources)return d.reject("You must specify the URL or the JSON for a service or for a style.");
e.sourceUrl=m||null;g=n?h.removeTrailingSlash(n)+"/":h.appBaseUrl;e.sourceBase=g;e.source=f;if(f.hasOwnProperty("tileInfo"))k=f;else{for(var k={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},p=(k.xmax-k.xmin)/512,l=[],q=f.hasOwnProperty("minzoom")?parseFloat(f.minzoom):0,r=f.hasOwnProperty("maxzoom")?parseFloat(f.maxzoom):16;q<r;q++){var t=p/Math.pow(2,q);l.push({level:q,scale:Math.floor(3779.527559055118*t),
resolution:t})}p=0;for(r=f.tiles;p<r.length;p++)c(b(g,r[p]));k={capabilities:"TilesOnly",initialExtent:k,fullExtent:k,minScale:l[0].scale,maxScale:l[l.length-1].scale,tiles:f.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:l,spatialReference:{wkid:102100}}}}e.validatedSource=k;e.sourceUrl&&c(e.sourceUrl);f=e.style?d.resolve():null==f.defaultStyles?d.reject():"string"===typeof f.defaultStyles?a(e,b(g,f.defaultStyles,"root.json")):a(e,f.defaultStyles,
b(g,"root.json"));return f})}Object.defineProperty(f,"__esModule",{value:!0});var l=e.defaults&&e.defaults.io.corsEnabledServers;f.loadMetadata=function(d){var e={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null},g="string"===typeof d?[d,null]:[null,d.jsonUrl],f=g[0],g=g[1],k=f?h.urlToObject(f):null;return a(e,d,g).then(function(){var a={layerDefinition:e.validatedSource,url:f,parsedUrl:k,serviceUrl:e.sourceUrl,style:e.style,styleUrl:e.styleUrl,
spriteUrl:e.style.sprite&&b(e.styleBase,e.style.sprite),glyphsUrl:e.style.glyphs&&b(e.styleBase,e.style.glyphs)};c(a.spriteUrl);c(a.glyphsUrl);return a})}})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.createForItem=function(g){return{origin:"portal-item",url:k.urlToObject(g.itemUrl),portal:g.portal||e.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require",
"exports"],function(m,f){return function(){function f(e,g){this.lockedSchemaPixelSize=e;this.isWGS84=g}f.prototype.getLevelRowColumn=function(e){return this.isWGS84?[e[0],e[1]>>1,e[2]>>1]:256===this.lockedSchemaPixelSize&&0<e[0]?[e[0]-1,e[1]>>1,e[2]>>1]:e};f.prototype.adjustLevel=function(e){return this.isWGS84?e:256===this.lockedSchemaPixelSize?0<e?e-1:0:e};f.prototype.getShift=function(e,g){var d=0,h=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)e[2]%2&&(d=2*g),e[1]%2&&(h=2*g);return[d,h]};
f.prototype.getScale=function(e){if(this.isWGS84){if(512===this.lockedSchemaPixelSize)return 2}else if(256===this.lockedSchemaPixelSize&&0===e)return.5;return 1};f.create256x256CompatibleTileInfo=function(e){if(!e)return null;if(256===e.rows&&256===e.cols)return e;for(var g=4326===e.spatialReference.wkid,d=[],h=e.lods.length,c=0;c<h;c++){var b=e.lods[c];d.push({level:b.level,scale:b.scale,resolution:g?b.resolution:2*b.resolution})}return{rows:256,cols:256,dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,
origin:e.origin,spatialReference:e.spatialReference,lods:d}};f.create512x512CompatibleTileInfo=function(e){if(!e||256===e.rows||256===e.cols)return null;for(var g=[],d=e.lods.length,h=0;h<d;h++){var c=e.lods[h];g.push({level:c.level,scale:c.scale,resolution:.5*c.resolution})}return{rows:512,cols:512,dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:g}};return f}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require",
"exports","../../../core/has","./StyleLayer"],function(m,f,k,e){return function(){function g(d,e){this.styleJSON=d;this.version=parseFloat(d.version);this.sprite=e?e.spriteUrl:d.sprite;this.glyphs=e?e.glyphsUrl:d.glyphs;this.layers=(d.layers||[]).map(g._create);this._identifyRefLayers()}g.prototype._identifyRefLayers=function(){for(var d=[],e=[],c=0,b=0,a=this.layers;b<a.length;b++){var g=a[b];if(1===g.type){var f=g,k=g.sourceLayer,k=k+("|"+JSON.stringify(g.minzoom)),k=k+("|"+JSON.stringify(g.maxzoom)),
k=k+("|"+JSON.stringify(g.filter));if(f.hasDataDrivenFill||f.hasDataDrivenOutline)k+="|"+JSON.stringify(c);d.push({key:k,layer:g})}2===g.type&&(f=g,k=g.sourceLayer,k+="|"+JSON.stringify(g.minzoom),k+="|"+JSON.stringify(g.maxzoom),k+="|"+JSON.stringify(g.filter),k+="|"+JSON.stringify(g.layout&&g.layout["line-cap"]),k+="|"+JSON.stringify(g.layout&&g.layout["line-join"]),f.hasDataDrivenLine&&(k+="|"+JSON.stringify(c)),e.push({key:k,layer:g}));++c}this._assignRefLayers(d);this._assignRefLayers(e)};g.prototype._assignRefLayers=
function(d){d.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var e,c,b=d.length,a=0;a<b;a++){var g=d[a];if(g.key===e)g.layer.refLayerId=c;else if(e=g.key,c=g.layer.id,1===g.layer.type&&!g.layer.getPaintProperty("fill-outline-color"))for(var f=a+1;f<b;f++){var k=d[f];if(k.key===e){if(k.layer.getPaintProperty("fill-outline-color")){d[a]=k;d[f]=g;c=k.layer.id;break}}else break}}};g._create=function(d,g,c){g=1-1/(c.length+1)*(1+g);switch(d.type){case "background":return new e.BackgroundStyleLayer(0,
d,g);case "fill":return new e.FillStyleLayer(1,d,g);case "line":return new e.LineStyleLayer(2,d,g);case "symbol":return new e.SymbolStyleLayer(3,d,g);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new e.CircleStyleLayer(4,d,g)}throw Error("Unknown vector tile layer");};return g}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function c(b,a,c){this.type=b;this.id=a.id;this.source=a.source;this.sourceLayer=a["source-layer"];this.minzoom=a.minzoom;this.maxzoom=a.maxzoom;this.filter=a.filter;this.layout=a.layout;this.paint=a.paint;this.z=c;switch(b){case 0:this._layoutDefinition=d.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=d.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=d.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=d.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=d.StyleDefinition.lineLayoutDefinition;this._paintDefinition=d.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=d.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=d.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=d.StyleDefinition.circleLayoutDefinition,this._paintDefinition=d.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}c.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=g.createFilter(this.filter)};c.prototype.getLayoutProperty=function(b){var a=this._layoutProperties;if(a)return a[b]};c.prototype.getPaintProperty=function(b){var a=this._paintProperties;if(a)return a[b]};c.prototype.getLayoutValue=function(b,a,c){var d,e=this._layoutProperties;e&&(e=e[b])&&(d=e.getValue(a,c));b=this._layoutDefinition[b];
void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};c.prototype.getPaintValue=function(b,a,c){var d,e=this._paintProperties;e&&(e=e[b])&&(d=e.getValue(a,c));b=this._paintDefinition[b];void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};c.prototype._parseLayout=function(b){var a={},c;for(c in b){var d=this._layoutDefinition[c];d&&(a[c]=new h(c,d,b[c]))}return a};c.prototype._parsePaint=function(b){var a={},c;for(c in b){var d=this._paintDefinition[c];
d&&(a[c]=new h(c,d,b[c]))}return a};return c}();f.StyleLayer=m;e=function(c){function b(a,b,d){return c.call(this,a,b,d)||this}k(b,c);return b}(m);f.BackgroundStyleLayer=e;e=function(c){function b(a,b,d){a=c.call(this,a,b,d)||this;b=a.getPaintProperty("fill-color");a.hasDataDrivenColor=b?b.isDataDriven:!1;b=a.getPaintProperty("fill-opacity");a.hasDataDrivenOpacity=b?b.isDataDriven:!1;a.hasDataDrivenFill=a.hasDataDrivenColor||a.hasDataDrivenOpacity;b=a.getPaintProperty("fill-outline-color");a.outlineUsesFillColor=
!b;a.hasDataDrivenOutlineColor=b?b.isDataDriven:!1;a.hasDataDrivenOutline=(b?a.hasDataDrivenOutlineColor:a.hasDataDrivenColor)||a.hasDataDrivenOpacity;return a}k(b,c);return b}(m);f.FillStyleLayer=e;e=function(c){function b(a,b,d){a=c.call(this,a,b,d)||this;b=a.getPaintProperty("line-color");a.hasDataDrivenColor=b?b.isDataDriven:!1;b=a.getPaintProperty("line-opacity");a.hasDataDrivenOpacity=b?b.isDataDriven:!1;b=a.getPaintProperty("line-width");a.hasDataDrivenWidth=b?b.isDataDriven:!1;a.hasDataDrivenLine=
a.hasDataDrivenColor||a.hasDataDrivenOpacity||a.hasDataDrivenWidth;return a}k(b,c);return b}(m);f.LineStyleLayer=e;e=function(c){function b(a,b,d){a=c.call(this,a,b,d)||this;b=a.getPaintProperty("icon-color");a.hasDataDrivenIconColor=b?b.isDataDriven:!1;b=a.getPaintProperty("icon-opacity");a.hasDataDrivenIconOpacity=b?b.isDataDriven:!1;b=a.getLayoutProperty("icon-size");a.hasDataDrivenIconSize=b?b.isDataDriven:!1;a.hasDataDrivenIcon=a.hasDataDrivenIconColor||a.hasDataDrivenIconOpacity||a.hasDataDrivenIconSize;
b=a.getPaintProperty("text-color");a.hasDataDrivenTextColor=b?b.isDataDriven:!1;b=a.getPaintProperty("text-opacity");a.hasDataDrivenTextOpacity=b?b.isDataDriven:!1;b=a.getLayoutProperty("text-size");a.hasDataDrivenTextSize=b?b.isDataDriven:!1;a.hasDataDrivenText=a.hasDataDrivenTextColor||a.hasDataDrivenTextOpacity||a.hasDataDrivenTextSize;return a}k(b,c);return b}(m);f.SymbolStyleLayer=e;m=function(c){function b(a,b,d){a=c.call(this,a,b,d)||this;b=a.getPaintProperty("circle-radius");a.hasDataDrivenRadius=
b?b.isDataDriven:!1;b=a.getPaintProperty("circle-color");a.hasDataDrivenColor=b?b.isDataDriven:!1;b=a.getPaintProperty("circle-opacity");a.hasDataDrivenOpacity=b?b.isDataDriven:!1;b=a.getPaintProperty("circle-stroke-width");a.hasDataDrivenStrokeWidth=b?b.isDataDriven:!1;b=a.getPaintProperty("circle-stroke-color");a.hasDataDrivenStrokeColor=b?b.isDataDriven:!1;b=a.getPaintProperty("circle-stroke-opacity");a.hasDataDrivenStrokeOpacity=b?b.isDataDriven:!1;b=a.getPaintProperty("circle-blur");a.hasDataDrivenBlur=
b?b.isDataDriven:!1;return a}k(b,c);return b}(m);f.CircleStyleLayer=m;m=function(){return function(c,b,a){this.cap=c.getLayoutValue("line-cap",b,a);this.join=c.getLayoutValue("line-join",b,a);this.miterLimit=c.getLayoutValue("line-miter-limit",b,a);this.roundLimit=c.getLayoutValue("line-round-limit",b,a)}}();f.LineLayout=m;m=function(){return function(c,b,a,d){this.allowOverlap=c.getLayoutValue("icon-allow-overlap",b,d);this.ignorePlacement=c.getLayoutValue("icon-ignore-placement",b,d);this.optional=
c.getLayoutValue("icon-optional",b,d);this.rotationAlignment=c.getLayoutValue("icon-rotation-alignment",b,d);this.size=c.getLayoutValue("icon-size",b,d);this.rotate=c.getLayoutValue("icon-rotate",b,d);this.padding=c.getLayoutValue("icon-padding",b,d);this.keepUpright=c.getLayoutValue("icon-keep-upright",b,d);this.offset=c.getLayoutValue("icon-offset",b,d);2===this.rotationAlignment&&(this.rotationAlignment=a?0:1)}}();f.IconLayout=m;m=function(){return function(c,b,a,d){this.allowOverlap=c.getLayoutValue("text-allow-overlap",
b,d);this.ignorePlacement=c.getLayoutValue("text-ignore-placement",b,d);this.optional=c.getLayoutValue("text-optional",b,d);this.rotationAlignment=c.getLayoutValue("text-rotation-alignment",b,d);this.fontArray=c.getLayoutValue("text-font",b,d);this.maxWidth=c.getLayoutValue("text-max-width",b,d);this.lineHeight=c.getLayoutValue("text-line-height",b,d);this.letterSpacing=c.getLayoutValue("text-letter-spacing",b,d);this.justify=c.getLayoutValue("text-justify",b,d);this.anchor=c.getLayoutValue("text-anchor",
b,d);this.maxAngle=c.getLayoutValue("text-max-angle",b,d);this.size=c.getLayoutValue("text-size",b,d);this.rotate=c.getLayoutValue("text-rotate",b,d);this.padding=c.getLayoutValue("text-padding",b,d);this.keepUpright=c.getLayoutValue("text-keep-upright",b,d);this.transform=c.getLayoutValue("text-transform",b,d);this.offset=c.getLayoutValue("text-offset",b,d);2===this.rotationAlignment&&(this.rotationAlignment=a?0:1)}}();f.TextLayout=m})},"esri/views/vectorTiles/style/Filter":function(){define(["require",
"exports"],function(m,f){return function(){function f(e,g,d){this._op=e;"$type"===g?(this._val=d instanceof Array?d.map(function(d){return f._types.indexOf(d)}):f._types.indexOf(d),this._op+=11):(this._key=g,this._val=d)}f.prototype.filter=function(e){switch(this._op){case 0:return this._val;case 1:return e.values[this._key]===this._val;case 2:return e.values[this._key]!==this._val;case 3:return e.values[this._key]<this._val;case 4:return e.values[this._key]>this._val;case 5:return e.values[this._key]<=
this._val;case 6:return e.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(e.values[this._key]);case 8:return-1===this._val.indexOf(e.values[this._key]);case 9:for(var g=0,d=this._val;g<d.length;g++){var h=d[g];if(h.filter(e))return!0}return!1;case 10:g=0;for(d=this._val;g<d.length;g++)if(h=d[g],!h.filter(e))return!1;return!0;case 11:g=0;for(d=this._val;g<d.length;g++)if(h=d[g],h.filter(e))return!1;return!0;case 12:return e.type===this._val;case 13:return e.type!==this._val;case 14:return e.type<
this._val;case 15:return e.type>this._val;case 16:return e.type>=this._val;case 17:return e.type<=this._val;case 18:return-1!==this._val.indexOf(e.type);case 19:return-1===this._val.indexOf(e.type)}};f.createFilter=function(e){if(!e)return new f(0,void 0,!0);var g=e[0];if(1>=e.length)return new f(0,void 0,"any"!==g);switch(g){case "\x3d\x3d":return new f(1,e[1],e[2]);case "!\x3d":return new f(2,e[1],e[2]);case "\x3e":return new f(4,e[1],e[2]);case "\x3c":return new f(3,e[1],e[2]);case "\x3e\x3d":return new f(6,
e[1],e[2]);case "\x3c\x3d":return new f(5,e[1],e[2]);case "in":return new f(7,e[1],e.slice(2));case "!in":return new f(8,e[1],e.slice(2));case "any":return new f(9,void 0,e.slice(1).map(f.createFilter.bind(this)));case "all":return new f(10,void 0,e.slice(1).map(f.createFilter.bind(this)));case "none":return new f(11,void 0,e.slice(1).map(f.createFilter.bind(this)));default:throw Error("invalid operator: "+g);}};f._types=["Unknown","Point","LineString","Polygon"];return f}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(){}f.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel",
"round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};f.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",
default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},
"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},
"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};f.circleLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};f.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",
value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};f.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",
minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};f.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",
value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map",
"viewport"],default:"map"}};f.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};f.circlePaintDefinition=
{"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",
minimum:0,maximum:1,default:1}};return f}();f.StyleDefinition=m})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(m,f,k,e){return function(){function g(d,e,c){this.isDataDriven=!1;switch(e.type){case "number":d=!0;break;case "color":d=!0;c=g._parseColor(c);break;case "array":d="number"===e.value;break;default:d=!1}null==c&&(c=e.default);d&&"interval"===c.type&&(d=!1);var b=c&&c.stops&&0<c.stops.length;if(b)for(var a=
0,h=c.stops;a<h.length;a++){var f=h[a];f[1]=this._validate(f[1],e)}if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,e)),b)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,e);break;case "categorical":this.getValue=this._buildCategorical(c,e);break;default:this.getValue=d?this._buildInterpolate(c,e):this._buildInterval(c,e)}else this.getValue=this._buildIdentity(c,e);else b?this.getValue=d?this._buildZoomInterpolate(c):this._buildZoomInterval(c):
(c=this._validate(c,e),this.getValue=this._buildSimple(c))}g.prototype._validate=function(d,e){if("number"===e.type){if(d<e.minimum)return e.minimum;if(d>e.maximum)return e.maximum}return d};g.prototype._buildSimple=function(d){return function(){return d}};g.prototype._buildIdentity=function(d,e){var c=this;return function(b,a){var h;a&&(h=a.values[d.property],"color"===e.type&&(h=g._parseColor(h)));void 0===h&&(h=d.default);return void 0!==h?c._validate(h,e):e.default}};g.prototype._buildCategorical=
function(d,e){var c=this;return function(b,a){var g;a&&(g=a.values[d.property]);g=c._categorical(g,d.stops);return void 0!==g?g:void 0!==d.default?d.default:e.default}};g.prototype._buildInterval=function(d,e){var c=this;return function(b,a){var g;a&&(g=a.values[d.property]);return"number"===typeof g?c._interval(g,d.stops):void 0!==d.default?d.default:e.default}};g.prototype._buildInterpolate=function(d,e){var c=this;return function(b,a){var g;a&&(g=a.values[d.property]);return"number"===typeof g?
c._interpolate(g,d.stops,d.base||1):void 0!==d.default?d.default:e.default}};g.prototype._buildZoomInterpolate=function(d){var e=this;return function(c){return e._interpolate(c,d.stops,d.base||1)}};g.prototype._buildZoomInterval=function(d){var e=this;return function(c){return e._interval(c,d.stops)}};g.prototype._categorical=function(d,e){for(var c=e.length,b=0;b<c;b++)if(e[b][0]===d)return e[b][1]};g.prototype._interval=function(d,e){for(var c=e.length,b=0,a=0;a<c;a++)if(e[a][0]<=d)b=a;else break;
return e[b][1]};g.prototype._interpolate=function(d,g,c){for(var b,a,h=g.length,f=0;f<h;f++){var k=g[f];if(k[0]<=d)b=k;else{a=k;break}}if(b&&a){f=a[0]-b[0];d-=b[0];c=1===c?d/f:(Math.pow(c,d)-1)/(Math.pow(c,f)-1);if(Array.isArray(b[1])){b=b[1];a=a[1];d=[];for(f=0;f<b.length;f++)d.push(e.interpolate(b[f],a[f],c));return d}return e.interpolate(b[1],a[1],c)}if(b)return b[1];if(a)return a[1]};g._isEmpty=function(d){for(var e in d)if(d.hasOwnProperty(e))return!1;return!0};g._parseColor=function(d){if(Array.isArray(d))return d;
if("string"===typeof d){if(d=new k(d),!this._isEmpty(d))return k.toUnitRGBA(d)}else return d&&d.default&&(d.default=g._parseColor(d.default)),d&&d.stops&&(d.stops=d.stops.map(function(d){return[d[0],g._parseColor(d[1])]})),d};return g}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(m,f){function k(e,d){e%=d;return 0<=e?e:e+d}Object.defineProperty(f,"__esModule",{value:!0});f.C_INFINITY=Number.POSITIVE_INFINITY;f.C_PI=Math.PI;f.C_2PI=2*f.C_PI;f.C_PI_BY_2=
f.C_PI/2;f.C_RAD_TO_256=128/f.C_PI;f.C_256_TO_RAD=f.C_PI/128;f.C_DEG_TO_256=256/360;f.C_DEG_TO_RAD=f.C_PI/180;f.C_SQRT2=1.414213562;f.C_SQRT2_INV=1/f.C_SQRT2;var e=1/Math.LN2;f.positiveMod=k;f.radToByte=function(e){return k(e*f.C_RAD_TO_256,256)};f.degToByte=function(e){return k(e*f.C_DEG_TO_256,256)};f.log2=function(g){return Math.log(g)*e};f.sqr=function(e){return e*e};f.clamp=function(e,d,h){return Math.min(Math.max(e,d),h)};f.interpolate=function(e,d,h){return e*(1-h)+d*h};f.between=function(e,
d,h){return e>=d&&e<=h||e>=h&&e<=d}})},"esri/support/basemapDefinitions":function(){define(["require","exports","dojo/i18n!../nls/basemaps"],function(m,f,k){return{streets:{id:"streets",title:k.streets,thumbnailUrl:m.toUrl("../images/basemap/streets.jpg"),baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",
title:k.satellite,thumbnailUrl:m.toUrl("../images/basemap/satellite.jpg"),baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",title:k.hybrid,thumbnailUrl:m.toUrl("../images/basemap/hybrid.jpg"),baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",title:k.terrain,thumbnailUrl:m.toUrl("../images/basemap/terrain.jpg"),baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",title:k.topo,thumbnailUrl:m.toUrl("../images/basemap/topo.jpg"),baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",title:k.gray,thumbnailUrl:m.toUrl("../images/basemap/gray.jpg"),baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",
layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",title:k["dark-gray"],thumbnailUrl:m.toUrl("../images/basemap/dark-gray.jpg"),baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",
url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",title:k.oceans,thumbnailUrl:m.toUrl("../images/basemap/oceans.jpg"),baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",
showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",title:k["national-geographic"],thumbnailUrl:m.toUrl("../images/basemap/national-geographic.jpg"),baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",
title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",title:k.osm,thumbnailUrl:m.toUrl("../images/basemap/osm.jpg"),baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",title:k["dark-gray"],thumbnailUrl:m.toUrl("../images/basemap/dark-gray.jpg"),baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/c11ce4f7801740b2905eb03ddc963ac8/resources/styles/root.json",
layerType:"VectorTileLayer",title:"World Dark Gray",visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",title:k.gray,thumbnailUrl:m.toUrl("../images/basemap/gray.jpg"),baseMapLayers:[{id:"gray-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/8a2cba3b0ebf4140b7c0dc5ee149549a/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Light Gray",visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",title:k.streets,thumbnailUrl:m.toUrl("../images/basemap/streets.jpg"),
baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",title:k.topo,thumbnailUrl:m.toUrl("../images/basemap/topo.jpg"),baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",
title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",title:k["streets-night-vector"],thumbnailUrl:m.toUrl("../images/basemap/streets-night.jpg"),baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",
layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",title:k["streets-relief-vector"],thumbnailUrl:m.toUrl("../images/basemap/streets-relief.jpg"),baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",
styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",showLegend:!1,visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",title:k["streets-navigation-vector"],thumbnailUrl:m.toUrl("../images/basemap/streets-navigation.jpg"),baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",
layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]}}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ./TerrainConst ./TilingScheme".split(" "),function(m,f,k,e,g,d,h){function c(c,d,e,h){g.vec3d.set(e,b);b[h]=d[h];h=g.vec3d.subtract(b,d);var f=g.vec3d.subtract(c,d,a),f=g.vec3d.dot(f,h),k=g.vec3d.dot(h,h);d=0>=f?d:k<=f?e:g.vec3d.add(d,g.vec3d.scale(h,f/
k),b);c=g.vec3d.subtract(c,d,b);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}Object.defineProperty(f,"__esModule",{value:!0});var b=g.vec3d.create(),a=g.vec3d.create(),l=g.vec3d.create(),n=g.vec3d.create();f.isInsideExtent=function(a,b,c){void 0===c&&(c=0);a=a.extent;return 0===c?e.containsPoint(a,b):e.containsPointWithMargin(a,b,c*Math.min(a[2]-a[0],a[3]-a[1]))};f.tiltOnEdge=c;f.tiltToExtentEdge=function(a,b){var d=a.getElevationBounds();a=a.extent;d=.5*(d[0]+d[1]);l[0]=a[0];l[1]=
a[1];l[2]=d;n[0]=a[2];n[1]=a[3];n[2]=d;a=d=Infinity;b[0]<l[0]?d=c(b,l,n,0):b[0]>n[0]&&(d=c(b,n,l,0));b[1]<l[1]?a=c(b,l,n,1):b[1]>n[1]&&(a=c(b,n,l,1));return Math.min(d,a)};f.checkIfTileInfoSupportedForViewSR=function(a,b,c){if(a.spatialReference.isGeographic)return new k("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var g=h.checkUnsupported(a);if(g)return g;var f=a.lods,g=f[0].resolution*Math.pow(2,f[0].level),l=[g*a.size[0],g*a.size[1]],
m=[a.origin.x,a.origin.y];b=e.fromExtent(b);var n=e.create();h.computeRowColExtent(b,l,m,n);l=(n[2]-n[0])*(n[3]-n[1]);l>d.MAX_ROOT_TILES?(f=f[0].scale*Math.pow(2,f[0].level),g=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*f/g,b=Math.floor(Math.log(g)/Math.log(10)),g=Math.ceil(g/Math.pow(10,b))*Math.pow(10,b),g=new k("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+g.toLocaleString()+
".",{level0Scale:f,suggestedLevel0Scale:g,requiredNumRootTiles:l,allowedNumRootTiles:d.MAX_ROOT_TILES})):g=null;return g?g:c&&!a.spatialReference.equals(c)?new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error","./TilingScheme"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.isInsideExtent=function(e,
d,h){void 0===h&&(h=0);return!0};f.tiltToExtentEdge=function(e,d){return 0};f.checkIfTileInfoSupportedForViewSR=function(g,d,h){d=g.lods.length-1;if(g.spatialReference.isWebMercator){if(!e.makeWebMercatorAuxiliarySphere(d).compatibleWith(g))return new k("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(g.spatialReference.isWGS84){if(!e.makeWGS84WithTileSize(g.size[1],d).compatibleWith(g))return new k("tilingscheme:incompatible-global-wgs84",
"The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new k("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(h&&!g.spatialReference.equals(h))return new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TerrainConst ./TileAgent ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(m,f,k,e,g,d,h){return function(){function c(b){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(b)}c.prototype.init=function(b){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=
0;b===k.LayerClass.ELEVATION&&(this.elevationBounds=null)};c.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&(g.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};c.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==e.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&
(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(g.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=0;this.disposeData()};c.prototype.disposeData=function(){var b=this.data;(b instanceof h||b instanceof d)&&b.dispose();this.data=null};c.makeEmptyLayerInfo=function(b,a){return a?(a.init(b),a):new c(b)};return c}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec2 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/enums ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(c){function f(){for(var a,e=[],h=0;h<arguments.length;h++)e[h]=arguments[h];h=c.call(this)||this;h._renderBuckets=[];h._vectorTileData=
null;h._symbolUpdateData=null;h.status=b.TileStatus.INITIALIZED;h.coords=[0,0];h.bounds=[0,0,0,0];h.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};h.stencilData={mask:0,reference:0};h.status=b.TileStatus.INITIALIZED;h.tileTransform.transform=g.create();h.tileTransform.displayCoord=d.create();0<e.length&&(a=h.acquire).call.apply(a,[h].concat(e));return h}k(f,c);f.prototype.reset=function(){a.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;
this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=b.TileStatus.INITIALIZED};f.prototype.acquire=function(a,b,c,d,e){this.key=a;this.refKey=b;b=c.lodAt(a.level);b=
null!==b?b.resolution:0;var g=c.size[0]*b,f=c.origin,k=a.col*g,l=a.row*g,m=c.spatialReference,n=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=h.getInfo(m),n=m.valid[1]-m.valid[0]);k=f.x+k+a.world*n;f=f.y-l;this.coords[0]=k;this.coords[1]=f;this.bounds[0]=k;this.bounds[1]=f;this.bounds[2]=k+g;this.bounds[3]=f-g;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=e;this.styleLayers=d;this.id=a.id};f.prototype.setData=function(a,c){this._vectorTileData=a;this.client=
c;a&&a.bufferDataInfo||(this.status=b.TileStatus.NO_DATA)};f.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};f.prototype.dispose=function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
c=0;c<a.length;++c){var d=a[c];this[d]&&(this[d].dispose(),this[d]=null)}this._renderBuckets.length=0;this.status=b.TileStatus.INITIALIZED};f.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};f.prototype.getGpuMemoryUsage=function(){var a=this,b=p.reduce(function(b,c){return a[c]?
b+a[c].size:b},0);this.texture&&(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};f.prototype.attach=function(a){if(this.status!==b.TileStatus.INITIALIZED)return!0;this._createRenderBuckets();this._createBufferObjects(a);this._vectorTileData=null;this.status=b.TileStatus.READY;return!0};f.prototype._createRenderBuckets=function(){if(0===this._renderBuckets.length)for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,c=0;c<b;){var d=a[c];switch(a[c+1]){case 0:var e=
new l.BackgroundRenderBucket;e.layerID=d;this._renderBuckets.push(e);c+=2;break;case 1:e=new l.FillRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];e.outlineElementStart=a[c+4];e.outlineElementCount=a[c+5];this._renderBuckets.push(e);c+=6;break;case 2:e=new l.LineRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];this._renderBuckets.push(e);c+=4;break;case 3:e=new l.SymbolRenderBucket;e.layerID=d;e.isSDF=0!==a[c+2];var g=c+3,d=
a[g];g++;if(0<d)for(var h=void 0,f=void 0,k=void 0,m=0;m<d;m++)h=a[g],f=a[g+1],k=a[g+2],e.markerPerPageElementsMap.set(h,[f,k]),g+=3;var n=a[g];g++;if(0<n)for(k=f=h=void 0,m=0;m<n;m++)h=a[g],f=a[g+1],k=a[g+2],e.glyphPerPageElementsMap.set(h,[f,k]),g+=3;this._renderBuckets.push(e);c+=5+3*d+3*n;break;case 4:e=new l.CircleRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];this._renderBuckets.push(e);c+=4;break;default:console.error("Bad bucket type!"),c+=2}}};f._createBufferToObject=
function(){var a=[];a[1]={create:n.createVertex,var:"fillVertexBuffer"};a[2]={create:n.createVertex,var:"fillDDVertexBuffer"};a[3]={create:n.createIndex,var:"fillIndexBuffer"};a[4]={create:n.createVertex,var:"outlineVertexBuffer"};a[5]={create:n.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:n.createIndex,var:"outlineIndexBuffer"};a[7]={create:n.createVertex,var:"lineVertexBuffer"};a[9]={create:n.createIndex,var:"lineIndexBuffer"};a[10]={create:n.createVertex,var:"iconVertexBuffer"};a[11]=
{create:n.createVertex,var:"iconDDVertexBuffer"};a[12]={create:n.createIndex,var:"iconIndexBuffer"};a[13]={create:n.createVertex,var:"textVertexBuffer"};a[14]={create:n.createVertex,var:"textDDVertexBuffer"};a[15]={create:n.createIndex,var:"textIndexBuffer"};a[16]={create:n.createVertex,var:"circleVertexBuffer"};a[17]={create:n.createIndex,var:"circleIndexBuffer"};return a};f.prototype._createBufferObjects=function(a){a=a.context;for(var b=new Uint32Array(this._vectorTileData.bufferDataInfo),c=b.length,
d=0,e=0;e<c;e+=2,d++){var g=b[e];if(!(0>=b[e+1]||0===this._vectorTileData.bufferData[d].byteLength)){var h=f.bufferToObject[g];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[d]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+g)}}};f.prototype.detach=function(a){this.client&&this.status!==b.TileStatus.INVALID&&this.status!==b.TileStatus.INITIALIZED&&this.client.invoke("destructTileData",this.id);this.dispose();c.prototype.detach.call(this,
a)};f.prototype.doRender=function(a){if(this.visible&&this.status===b.TileStatus.READY){var c=a.context,d=a.renderer;if(c&&d){var e=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);c.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var g=this.styleLayers,h=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==h){var f=this._renderBuckets.length;if(0===e)for(var k=f-1;0<=k;k--){var l=this._renderBuckets[k];1!==l.type&&0!==l.type||!l.hasData()||d.renderBucket(c,l,a.displayLevel,
a.requiredLevel,e,this,g.layers[l.layerID],h)}else for(k=0;k<f;k++)l=this._renderBuckets[k],l.hasData()&&d.renderBucket(c,l,a.displayLevel,a.requiredLevel,e,this,g.layers[l.layerID],h)}}}};f.prototype._updateSymbolData=function(a){if(!this._symbolUpdateData.bucketDataInfo)return!0;var c=new Uint32Array(this._symbolUpdateData.bucketDataInfo),d=c.length;if(0===d)return this._symbolUpdateData=null,!0;if(this.status!==b.TileStatus.READY)return this.requestRender(),!1;a=a.context;for(var e=new Uint32Array(this._symbolUpdateData.bufferDataInfo),
g=e.length,h=0,f=0;f<g;f+=2,h++)switch(e[f]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);
this.iconIndexBuffer=n.createIndex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=n.createVertex(a,35044,this._symbolUpdateData.bufferData[h]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),
this.textIndexBuffer=null),this.textIndexBuffer=n.createIndex(a,35044,this._symbolUpdateData.bufferData[h])}a=this._renderBuckets.length;for(e=0;e<a;e++)this._renderBuckets[e]instanceof l.SymbolRenderBucket&&(g=this._renderBuckets[e],g.markerPerPageElementsMap.clear(),g.glyphPerPageElementsMap.clear());for(a=0;a<d;){g=c[a];h=-1;f=this._renderBuckets.length;for(e=0;e<f;e++)if(this._renderBuckets[e].layerID===g){h=e;break}e=this._renderBuckets[h];e||(e=new l.SymbolRenderBucket,e.layerID=g,e.isSDF=0!==
c[a+2],this._renderBuckets.push(e));var k=a+3,g=c[k];k++;if(0<g)for(var m=f=h=void 0,p=0;p<g;p++)h=c[k],f=c[k+1],m=c[k+2],e.markerPerPageElementsMap.set(h,[f,m]),k+=3;var q=c[k];k++;if(0<q)for(m=f=h=void 0,p=0;p<q;p++)h=c[k],f=c[k+1],m=c[k+2],e.glyphPerPageElementsMap.set(h,[f,m]),k+=3;a+=5+3*g+3*q}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);
this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this._symbolUpdateData=null;return!0};f.pool=new e(f);f.bufferToObject=f._createBufferToObject();return f}(c)})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(m){var f={scalar:{},SIMD:{},create:function(){var f=new m.ARRAY_TYPE(16);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=
1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},clone:function(f){var e=new m.ARRAY_TYPE(16);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];e[4]=f[4];e[5]=f[5];e[6]=f[6];e[7]=f[7];e[8]=f[8];e[9]=f[9];e[10]=f[10];e[11]=f[11];e[12]=f[12];e[13]=f[13];e[14]=f[14];e[15]=f[15];return e},copy:function(f,e){f[0]=e[0];f[1]=e[1];f[2]=e[2];f[3]=e[3];f[4]=e[4];f[5]=e[5];f[6]=e[6];f[7]=e[7];f[8]=e[8];f[9]=e[9];f[10]=e[10];f[11]=e[11];f[12]=e[12];f[13]=e[13];f[14]=e[14];f[15]=e[15];
return f},fromValues:function(f,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){var k=new m.ARRAY_TYPE(16);k[0]=f;k[1]=e;k[2]=g;k[3]=d;k[4]=h;k[5]=c;k[6]=b;k[7]=a;k[8]=l;k[9]=n;k[10]=p;k[11]=q;k[12]=r;k[13]=t;k[14]=w;k[15]=u;return k},set:function(f,e,g,d,h,c,b,a,l,m,p,q,r,t,w,u,x){f[0]=e;f[1]=g;f[2]=d;f[3]=h;f[4]=c;f[5]=b;f[6]=a;f[7]=l;f[8]=m;f[9]=p;f[10]=q;f[11]=r;f[12]=t;f[13]=w;f[14]=u;f[15]=x;return f},identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;
f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f}};f.scalar.transpose=function(f,e){if(f===e){var g=e[1],d=e[2],h=e[3],c=e[6],b=e[7],a=e[11];f[1]=e[4];f[2]=e[8];f[3]=e[12];f[4]=g;f[6]=e[9];f[7]=e[13];f[8]=d;f[9]=c;f[11]=e[14];f[12]=h;f[13]=b;f[14]=a}else f[0]=e[0],f[1]=e[4],f[2]=e[8],f[3]=e[12],f[4]=e[1],f[5]=e[5],f[6]=e[9],f[7]=e[13],f[8]=e[2],f[9]=e[6],f[10]=e[10],f[11]=e[14],f[12]=e[3],f[13]=e[7],f[14]=e[11],f[15]=e[15];return f};f.SIMD.transpose=function(f,e){var g,d,h,c,b,a;g=SIMD.Float32x4.load(e,0);
d=SIMD.Float32x4.load(e,4);h=SIMD.Float32x4.load(e,8);e=SIMD.Float32x4.load(e,12);c=SIMD.Float32x4.shuffle(g,d,0,1,4,5);b=SIMD.Float32x4.shuffle(h,e,0,1,4,5);a=SIMD.Float32x4.shuffle(c,b,0,2,4,6);c=SIMD.Float32x4.shuffle(c,b,1,3,5,7);SIMD.Float32x4.store(f,0,a);SIMD.Float32x4.store(f,4,c);c=SIMD.Float32x4.shuffle(g,d,2,3,6,7);b=SIMD.Float32x4.shuffle(h,e,2,3,6,7);g=SIMD.Float32x4.shuffle(c,b,0,2,4,6);d=SIMD.Float32x4.shuffle(c,b,1,3,5,7);SIMD.Float32x4.store(f,8,g);SIMD.Float32x4.store(f,12,d);return f};
f.transpose=m.USE_SIMD?f.SIMD.transpose:f.scalar.transpose;f.scalar.invert=function(f,e){var g=e[0],d=e[1],h=e[2],c=e[3],b=e[4],a=e[5],k=e[6],m=e[7],p=e[8],q=e[9],r=e[10],t=e[11],w=e[12],u=e[13],x=e[14];e=e[15];var v=g*a-d*b,z=g*k-h*b,y=g*m-c*b,A=d*k-h*a,B=d*m-c*a,C=h*m-c*k,E=p*u-q*w,D=p*x-r*w,F=p*e-t*w,M=q*x-r*u,N=q*e-t*u,I=r*e-t*x,G=v*I-z*N+y*M+A*F-B*D+C*E;if(!G)return null;G=1/G;f[0]=(a*I-k*N+m*M)*G;f[1]=(h*N-d*I-c*M)*G;f[2]=(u*C-x*B+e*A)*G;f[3]=(r*B-q*C-t*A)*G;f[4]=(k*F-b*I-m*D)*G;f[5]=(g*I-h*
F+c*D)*G;f[6]=(x*y-w*C-e*z)*G;f[7]=(p*C-r*y+t*z)*G;f[8]=(b*N-a*F+m*E)*G;f[9]=(d*F-g*N-c*E)*G;f[10]=(w*B-u*y+e*v)*G;f[11]=(q*y-p*B-t*v)*G;f[12]=(a*D-b*M-k*E)*G;f[13]=(g*M-d*D+h*E)*G;f[14]=(u*z-w*A-x*v)*G;f[15]=(p*A-q*z+r*v)*G;return f};f.SIMD.invert=function(f,e){var g,d,h,c,b,a,k,m;b=SIMD.Float32x4.load(e,0);a=SIMD.Float32x4.load(e,4);k=SIMD.Float32x4.load(e,8);m=SIMD.Float32x4.load(e,12);e=SIMD.Float32x4.shuffle(b,a,0,1,4,5);d=SIMD.Float32x4.shuffle(k,m,0,1,4,5);g=SIMD.Float32x4.shuffle(e,d,0,2,
4,6);d=SIMD.Float32x4.shuffle(d,e,1,3,5,7);e=SIMD.Float32x4.shuffle(b,a,2,3,6,7);c=SIMD.Float32x4.shuffle(k,m,2,3,6,7);h=SIMD.Float32x4.shuffle(e,c,0,2,4,6);c=SIMD.Float32x4.shuffle(c,e,1,3,5,7);e=SIMD.Float32x4.mul(h,c);e=SIMD.Float32x4.swizzle(e,1,0,3,2);b=SIMD.Float32x4.mul(d,e);a=SIMD.Float32x4.mul(g,e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);b=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,e),b);a=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);e=SIMD.Float32x4.mul(d,h);
e=SIMD.Float32x4.swizzle(e,1,0,3,2);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,e),b);m=SIMD.Float32x4.mul(g,e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);b=SIMD.Float32x4.sub(b,SIMD.Float32x4.mul(c,e));m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);e=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,3,0,1),c);e=SIMD.Float32x4.swizzle(e,1,0,3,2);h=SIMD.Float32x4.swizzle(h,2,3,0,1);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,e),b);k=SIMD.Float32x4.mul(g,e);e=SIMD.Float32x4.swizzle(e,
2,3,0,1);b=SIMD.Float32x4.sub(b,SIMD.Float32x4.mul(h,e));k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,e),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);e=SIMD.Float32x4.mul(g,d);e=SIMD.Float32x4.swizzle(e,1,0,3,2);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,e),k);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,e),m);e=SIMD.Float32x4.swizzle(e,2,3,0,1);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,e),k);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(h,e));e=SIMD.Float32x4.mul(g,c);e=SIMD.Float32x4.swizzle(e,1,0,3,2);a=SIMD.Float32x4.sub(a,
SIMD.Float32x4.mul(h,e));k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,e),k);e=SIMD.Float32x4.swizzle(e,2,3,0,1);a=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,e),a);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(d,e));e=SIMD.Float32x4.mul(g,h);e=SIMD.Float32x4.swizzle(e,1,0,3,2);a=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,e),a);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(d,e));e=SIMD.Float32x4.swizzle(e,2,3,0,1);a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(c,e));m=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,e),m);g=SIMD.Float32x4.mul(g,
b);g=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(g,2,3,0,1),g);g=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(g,1,0,3,2),g);e=SIMD.Float32x4.reciprocalApproximation(g);g=SIMD.Float32x4.sub(SIMD.Float32x4.add(e,e),SIMD.Float32x4.mul(g,SIMD.Float32x4.mul(e,e)));g=SIMD.Float32x4.swizzle(g,0,0,0,0);if(!g)return null;SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(g,b));SIMD.Float32x4.store(f,4,SIMD.Float32x4.mul(g,a));SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(g,k));SIMD.Float32x4.store(f,12,SIMD.Float32x4.mul(g,
m));return f};f.invert=m.USE_SIMD?f.SIMD.invert:f.scalar.invert;f.scalar.adjoint=function(f,e){var g=e[0],d=e[1],h=e[2],c=e[3],b=e[4],a=e[5],k=e[6],m=e[7],p=e[8],q=e[9],r=e[10],t=e[11],w=e[12],u=e[13],x=e[14];e=e[15];f[0]=a*(r*e-t*x)-q*(k*e-m*x)+u*(k*t-m*r);f[1]=-(d*(r*e-t*x)-q*(h*e-c*x)+u*(h*t-c*r));f[2]=d*(k*e-m*x)-a*(h*e-c*x)+u*(h*m-c*k);f[3]=-(d*(k*t-m*r)-a*(h*t-c*r)+q*(h*m-c*k));f[4]=-(b*(r*e-t*x)-p*(k*e-m*x)+w*(k*t-m*r));f[5]=g*(r*e-t*x)-p*(h*e-c*x)+w*(h*t-c*r);f[6]=-(g*(k*e-m*x)-b*(h*e-c*x)+
w*(h*m-c*k));f[7]=g*(k*t-m*r)-b*(h*t-c*r)+p*(h*m-c*k);f[8]=b*(q*e-t*u)-p*(a*e-m*u)+w*(a*t-m*q);f[9]=-(g*(q*e-t*u)-p*(d*e-c*u)+w*(d*t-c*q));f[10]=g*(a*e-m*u)-b*(d*e-c*u)+w*(d*m-c*a);f[11]=-(g*(a*t-m*q)-b*(d*t-c*q)+p*(d*m-c*a));f[12]=-(b*(q*x-r*u)-p*(a*x-k*u)+w*(a*r-k*q));f[13]=g*(q*x-r*u)-p*(d*x-h*u)+w*(d*r-h*q);f[14]=-(g*(a*x-k*u)-b*(d*x-h*u)+w*(d*k-h*a));f[15]=g*(a*r-k*q)-b*(d*r-h*q)+p*(d*k-h*a);return f};f.SIMD.adjoint=function(f,e){var g,d,h,c,b,a,k,m;g=SIMD.Float32x4.load(e,0);d=SIMD.Float32x4.load(e,
4);h=SIMD.Float32x4.load(e,8);c=SIMD.Float32x4.load(e,12);a=SIMD.Float32x4.shuffle(g,d,0,1,4,5);b=SIMD.Float32x4.shuffle(h,c,0,1,4,5);e=SIMD.Float32x4.shuffle(a,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,a,1,3,5,7);a=SIMD.Float32x4.shuffle(g,d,2,3,6,7);d=SIMD.Float32x4.shuffle(h,c,2,3,6,7);g=SIMD.Float32x4.shuffle(a,d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,a,1,3,5,7);a=SIMD.Float32x4.mul(g,d);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.mul(b,a);c=SIMD.Float32x4.mul(e,a);a=SIMD.Float32x4.swizzle(a,
2,3,0,1);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),h);c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,a),c);c=SIMD.Float32x4.swizzle(c,2,3,0,1);a=SIMD.Float32x4.mul(b,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,a),h);m=SIMD.Float32x4.mul(e,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(d,a));m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,a),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),d);
a=SIMD.Float32x4.swizzle(a,1,0,3,2);g=SIMD.Float32x4.swizzle(g,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),h);k=SIMD.Float32x4.mul(e,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(g,a));k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,a),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);a=SIMD.Float32x4.mul(e,b);a=SIMD.Float32x4.swizzle(a,1,0,3,2);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,a),k);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,a),m);a=SIMD.Float32x4.swizzle(a,2,
3,0,1);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),k);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(g,a));a=SIMD.Float32x4.mul(e,d);a=SIMD.Float32x4.swizzle(a,1,0,3,2);c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(g,a));k=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),k);a=SIMD.Float32x4.swizzle(a,2,3,0,1);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),c);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.mul(e,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,a),c);
m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.swizzle(a,2,3,0,1);c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(d,a));m=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),m);SIMD.Float32x4.store(f,0,h);SIMD.Float32x4.store(f,4,c);SIMD.Float32x4.store(f,8,k);SIMD.Float32x4.store(f,12,m);return f};f.adjoint=m.USE_SIMD?f.SIMD.adjoint:f.scalar.adjoint;f.determinant=function(f){var e=f[0],g=f[1],d=f[2],h=f[3],c=f[4],b=f[5],a=f[6],k=f[7],m=f[8],p=f[9],q=f[10],r=f[11],t=f[12],w=f[13],u=f[14];f=f[15];
return(e*b-g*c)*(q*f-r*u)-(e*a-d*c)*(p*f-r*w)+(e*k-h*c)*(p*u-q*w)+(g*a-d*b)*(m*f-r*t)-(g*k-h*b)*(m*u-q*t)+(d*k-h*a)*(m*w-p*t)};f.SIMD.multiply=function(f,e,g){var d=SIMD.Float32x4.load(e,0),h=SIMD.Float32x4.load(e,4),c=SIMD.Float32x4.load(e,8);e=SIMD.Float32x4.load(e,12);var b=SIMD.Float32x4.load(g,0),b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,
2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),e))));SIMD.Float32x4.store(f,0,b);b=SIMD.Float32x4.load(g,4);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),e))));SIMD.Float32x4.store(f,4,b);b=SIMD.Float32x4.load(g,8);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,
0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,3,3,3,3),e))));SIMD.Float32x4.store(f,8,b);g=SIMD.Float32x4.load(g,12);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),
c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),e))));SIMD.Float32x4.store(f,12,d);return f};f.scalar.multiply=function(f,e,g){var d=e[0],h=e[1],c=e[2],b=e[3],a=e[4],k=e[5],m=e[6],p=e[7],q=e[8],r=e[9],t=e[10],w=e[11],u=e[12],x=e[13],v=e[14];e=e[15];var z=g[0],y=g[1],A=g[2],B=g[3];f[0]=z*d+y*a+A*q+B*u;f[1]=z*h+y*k+A*r+B*x;f[2]=z*c+y*m+A*t+B*v;f[3]=z*b+y*p+A*w+B*e;z=g[4];y=g[5];A=g[6];B=g[7];f[4]=z*d+y*a+A*q+B*u;f[5]=z*h+y*k+A*r+B*x;f[6]=z*c+y*m+A*t+B*v;f[7]=z*b+y*p+A*w+B*e;z=g[8];y=g[9];A=
g[10];B=g[11];f[8]=z*d+y*a+A*q+B*u;f[9]=z*h+y*k+A*r+B*x;f[10]=z*c+y*m+A*t+B*v;f[11]=z*b+y*p+A*w+B*e;z=g[12];y=g[13];A=g[14];B=g[15];f[12]=z*d+y*a+A*q+B*u;f[13]=z*h+y*k+A*r+B*x;f[14]=z*c+y*m+A*t+B*v;f[15]=z*b+y*p+A*w+B*e;return f};f.multiply=m.USE_SIMD?f.SIMD.multiply:f.scalar.multiply;f.mul=f.multiply;f.scalar.translate=function(f,e,g){var d=g[0],h=g[1];g=g[2];var c,b,a,k,m,p,q,r,t,w,u,x;e===f?(f[12]=e[0]*d+e[4]*h+e[8]*g+e[12],f[13]=e[1]*d+e[5]*h+e[9]*g+e[13],f[14]=e[2]*d+e[6]*h+e[10]*g+e[14],f[15]=
e[3]*d+e[7]*h+e[11]*g+e[15]):(c=e[0],b=e[1],a=e[2],k=e[3],m=e[4],p=e[5],q=e[6],r=e[7],t=e[8],w=e[9],u=e[10],x=e[11],f[0]=c,f[1]=b,f[2]=a,f[3]=k,f[4]=m,f[5]=p,f[6]=q,f[7]=r,f[8]=t,f[9]=w,f[10]=u,f[11]=x,f[12]=c*d+m*h+t*g+e[12],f[13]=b*d+p*h+w*g+e[13],f[14]=a*d+q*h+u*g+e[14],f[15]=k*d+r*h+x*g+e[15]);return f};f.SIMD.translate=function(f,e,g){var d=SIMD.Float32x4.load(e,0),h=SIMD.Float32x4.load(e,4),c=SIMD.Float32x4.load(e,8),b=SIMD.Float32x4.load(e,12);g=SIMD.Float32x4(g[0],g[1],g[2],0);e!==f&&(f[0]=
e[0],f[1]=e[1],f[2]=e[2],f[3]=e[3],f[4]=e[4],f[5]=e[5],f[6]=e[6],f[7]=e[7],f[8]=e[8],f[9]=e[9],f[10]=e[10],f[11]=e[11]);d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,0,0,0,0));h=SIMD.Float32x4.mul(h,SIMD.Float32x4.swizzle(g,1,1,1,1));c=SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(g,2,2,2,2));e=SIMD.Float32x4.add(d,SIMD.Float32x4.add(h,SIMD.Float32x4.add(c,b)));SIMD.Float32x4.store(f,12,e);return f};f.translate=m.USE_SIMD?f.SIMD.translate:f.scalar.translate;f.scalar.scale=function(f,e,g){var d=g[0],
h=g[1];g=g[2];f[0]=e[0]*d;f[1]=e[1]*d;f[2]=e[2]*d;f[3]=e[3]*d;f[4]=e[4]*h;f[5]=e[5]*h;f[6]=e[6]*h;f[7]=e[7]*h;f[8]=e[8]*g;f[9]=e[9]*g;f[10]=e[10]*g;f[11]=e[11]*g;f[12]=e[12];f[13]=e[13];f[14]=e[14];f[15]=e[15];return f};f.SIMD.scale=function(f,e,g){var d;g=SIMD.Float32x4(g[0],g[1],g[2],0);d=SIMD.Float32x4.load(e,0);SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,0,0,0,0)));d=SIMD.Float32x4.load(e,4);SIMD.Float32x4.store(f,4,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,1,1,
1,1)));d=SIMD.Float32x4.load(e,8);SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(g,2,2,2,2)));f[12]=e[12];f[13]=e[13];f[14]=e[14];f[15]=e[15];return f};f.scale=m.USE_SIMD?f.SIMD.scale:f.scalar.scale;f.rotate=function(f,e,g,d){var h=d[0],c=d[1];d=d[2];var b=Math.sqrt(h*h+c*c+d*d),a,k,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M;if(Math.abs(b)<m.EPSILON)return null;b=1/b;h*=b;c*=b;d*=b;a=Math.sin(g);k=Math.cos(g);n=1-k;g=e[0];b=e[1];p=e[2];q=e[3];r=e[4];t=e[5];w=e[6];u=e[7];x=e[8];v=e[9];
z=e[10];y=e[11];A=h*h*n+k;B=c*h*n+d*a;C=d*h*n-c*a;E=h*c*n-d*a;D=c*c*n+k;F=d*c*n+h*a;M=h*d*n+c*a;h=c*d*n-h*a;c=d*d*n+k;f[0]=g*A+r*B+x*C;f[1]=b*A+t*B+v*C;f[2]=p*A+w*B+z*C;f[3]=q*A+u*B+y*C;f[4]=g*E+r*D+x*F;f[5]=b*E+t*D+v*F;f[6]=p*E+w*D+z*F;f[7]=q*E+u*D+y*F;f[8]=g*M+r*h+x*c;f[9]=b*M+t*h+v*c;f[10]=p*M+w*h+z*c;f[11]=q*M+u*h+y*c;e!==f&&(f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);return f};f.scalar.rotateX=function(f,e,g){var d=Math.sin(g);g=Math.cos(g);var h=e[4],c=e[5],b=e[6],a=e[7],k=e[8],m=e[9],
p=e[10],q=e[11];e!==f&&(f[0]=e[0],f[1]=e[1],f[2]=e[2],f[3]=e[3],f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);f[4]=h*g+k*d;f[5]=c*g+m*d;f[6]=b*g+p*d;f[7]=a*g+q*d;f[8]=k*g-h*d;f[9]=m*g-c*d;f[10]=p*g-b*d;f[11]=q*g-a*d;return f};f.SIMD.rotateX=function(f,e,g){var d=SIMD.Float32x4.splat(Math.sin(g));g=SIMD.Float32x4.splat(Math.cos(g));e!==f&&(f[0]=e[0],f[1]=e[1],f[2]=e[2],f[3]=e[3],f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);var h=SIMD.Float32x4.load(e,4);e=SIMD.Float32x4.load(e,8);SIMD.Float32x4.store(f,
4,SIMD.Float32x4.add(SIMD.Float32x4.mul(h,g),SIMD.Float32x4.mul(e,d)));SIMD.Float32x4.store(f,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,g),SIMD.Float32x4.mul(h,d)));return f};f.rotateX=m.USE_SIMD?f.SIMD.rotateX:f.scalar.rotateX;f.scalar.rotateY=function(f,e,g){var d=Math.sin(g);g=Math.cos(g);var h=e[0],c=e[1],b=e[2],a=e[3],k=e[8],m=e[9],p=e[10],q=e[11];e!==f&&(f[4]=e[4],f[5]=e[5],f[6]=e[6],f[7]=e[7],f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);f[0]=h*g-k*d;f[1]=c*g-m*d;f[2]=b*g-p*d;f[3]=a*g-q*
d;f[8]=h*d+k*g;f[9]=c*d+m*g;f[10]=b*d+p*g;f[11]=a*d+q*g;return f};f.SIMD.rotateY=function(f,e,g){var d=SIMD.Float32x4.splat(Math.sin(g));g=SIMD.Float32x4.splat(Math.cos(g));e!==f&&(f[4]=e[4],f[5]=e[5],f[6]=e[6],f[7]=e[7],f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);var h=SIMD.Float32x4.load(e,0);e=SIMD.Float32x4.load(e,8);SIMD.Float32x4.store(f,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,g),SIMD.Float32x4.mul(e,d)));SIMD.Float32x4.store(f,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(h,d),SIMD.Float32x4.mul(e,
g)));return f};f.rotateY=m.USE_SIMD?f.SIMD.rotateY:f.scalar.rotateY;f.scalar.rotateZ=function(f,e,g){var d=Math.sin(g);g=Math.cos(g);var h=e[0],c=e[1],b=e[2],a=e[3],k=e[4],m=e[5],p=e[6],q=e[7];e!==f&&(f[8]=e[8],f[9]=e[9],f[10]=e[10],f[11]=e[11],f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);f[0]=h*g+k*d;f[1]=c*g+m*d;f[2]=b*g+p*d;f[3]=a*g+q*d;f[4]=k*g-h*d;f[5]=m*g-c*d;f[6]=p*g-b*d;f[7]=q*g-a*d;return f};f.SIMD.rotateZ=function(f,e,g){var d=SIMD.Float32x4.splat(Math.sin(g));g=SIMD.Float32x4.splat(Math.cos(g));
e!==f&&(f[8]=e[8],f[9]=e[9],f[10]=e[10],f[11]=e[11],f[12]=e[12],f[13]=e[13],f[14]=e[14],f[15]=e[15]);var h=SIMD.Float32x4.load(e,0);e=SIMD.Float32x4.load(e,4);SIMD.Float32x4.store(f,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(h,g),SIMD.Float32x4.mul(e,d)));SIMD.Float32x4.store(f,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,g),SIMD.Float32x4.mul(h,d)));return f};f.rotateZ=m.USE_SIMD?f.SIMD.rotateZ:f.scalar.rotateZ;f.fromTranslation=function(f,e){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=
0;f[9]=0;f[10]=1;f[11]=0;f[12]=e[0];f[13]=e[1];f[14]=e[2];f[15]=1;return f};f.fromScaling=function(f,e){f[0]=e[0];f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=e[1];f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=e[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};f.fromRotation=function(f,e,g){var d=g[0],h=g[1];g=g[2];var c=Math.sqrt(d*d+h*h+g*g),b;if(Math.abs(c)<m.EPSILON)return null;c=1/c;d*=c;h*=c;g*=c;c=Math.sin(e);e=Math.cos(e);b=1-e;f[0]=d*d*b+e;f[1]=h*d*b+g*c;f[2]=g*d*b-h*c;f[3]=0;f[4]=d*h*b-g*c;f[5]=h*h*b+e;f[6]=
g*h*b+d*c;f[7]=0;f[8]=d*g*b+h*c;f[9]=h*g*b-d*c;f[10]=g*g*b+e;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};f.fromXRotation=function(f,e){var g=Math.sin(e);e=Math.cos(e);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=e;f[6]=g;f[7]=0;f[8]=0;f[9]=-g;f[10]=e;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};f.fromYRotation=function(f,e){var g=Math.sin(e);e=Math.cos(e);f[0]=e;f[1]=0;f[2]=-g;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=g;f[9]=0;f[10]=e;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};f.fromZRotation=
function(f,e){var g=Math.sin(e);e=Math.cos(e);f[0]=e;f[1]=g;f[2]=0;f[3]=0;f[4]=-g;f[5]=e;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};f.fromRotationTranslation=function(f,e,g){var d=e[0],h=e[1],c=e[2],b=e[3],a=d+d,l=h+h,k=c+c;e=d*a;var m=d*l,d=d*k,q=h*l,h=h*k,c=c*k,a=b*a,l=b*l,b=b*k;f[0]=1-(q+c);f[1]=m+b;f[2]=d-l;f[3]=0;f[4]=m-b;f[5]=1-(e+c);f[6]=h+a;f[7]=0;f[8]=d+l;f[9]=h-a;f[10]=1-(e+q);f[11]=0;f[12]=g[0];f[13]=g[1];f[14]=g[2];f[15]=1;return f};f.getTranslation=
function(f,e){f[0]=e[12];f[1]=e[13];f[2]=e[14];return f};f.getRotation=function(f,e){var g=e[0]+e[5]+e[10],d=0;0<g?(d=2*Math.sqrt(g+1),f[3]=.25*d,f[0]=(e[6]-e[9])/d,f[1]=(e[8]-e[2])/d,f[2]=(e[1]-e[4])/d):e[0]>e[5]&e[0]>e[10]?(d=2*Math.sqrt(1+e[0]-e[5]-e[10]),f[3]=(e[6]-e[9])/d,f[0]=.25*d,f[1]=(e[1]+e[4])/d,f[2]=(e[8]+e[2])/d):e[5]>e[10]?(d=2*Math.sqrt(1+e[5]-e[0]-e[10]),f[3]=(e[8]-e[2])/d,f[0]=(e[1]+e[4])/d,f[1]=.25*d,f[2]=(e[6]+e[9])/d):(d=2*Math.sqrt(1+e[10]-e[0]-e[5]),f[3]=(e[1]-e[4])/d,f[0]=(e[8]+
e[2])/d,f[1]=(e[6]+e[9])/d,f[2]=.25*d);return f};f.fromRotationTranslationScale=function(f,e,g,d){var h=e[0],c=e[1],b=e[2],a=e[3],l=h+h,k=c+c,m=b+b;e=h*l;var q=h*k,h=h*m,r=c*k,c=c*m,b=b*m,l=a*l,k=a*k,a=a*m,m=d[0],t=d[1];d=d[2];f[0]=(1-(r+b))*m;f[1]=(q+a)*m;f[2]=(h-k)*m;f[3]=0;f[4]=(q-a)*t;f[5]=(1-(e+b))*t;f[6]=(c+l)*t;f[7]=0;f[8]=(h+k)*d;f[9]=(c-l)*d;f[10]=(1-(e+r))*d;f[11]=0;f[12]=g[0];f[13]=g[1];f[14]=g[2];f[15]=1;return f};f.fromRotationTranslationScaleOrigin=function(f,e,g,d,h){var c=e[0],b=e[1],
a=e[2],l=e[3],k=c+c,m=b+b,q=a+a;e=c*k;var r=c*m,c=c*q,t=b*m,b=b*q,a=a*q,k=l*k,m=l*m,l=l*q,q=d[0],w=d[1];d=d[2];var u=h[0],x=h[1];h=h[2];f[0]=(1-(t+a))*q;f[1]=(r+l)*q;f[2]=(c-m)*q;f[3]=0;f[4]=(r-l)*w;f[5]=(1-(e+a))*w;f[6]=(b+k)*w;f[7]=0;f[8]=(c+m)*d;f[9]=(b-k)*d;f[10]=(1-(e+t))*d;f[11]=0;f[12]=g[0]+u-(f[0]*u+f[4]*x+f[8]*h);f[13]=g[1]+x-(f[1]*u+f[5]*x+f[9]*h);f[14]=g[2]+h-(f[2]*u+f[6]*x+f[10]*h);f[15]=1;return f};f.fromQuat=function(f,e){var g=e[0],d=e[1],h=e[2];e=e[3];var c=g+g,b=d+d,a=h+h,g=g*c,l=
d*c,d=d*b,k=h*c,m=h*b,h=h*a,c=e*c,b=e*b;e*=a;f[0]=1-d-h;f[1]=l+e;f[2]=k-b;f[3]=0;f[4]=l-e;f[5]=1-g-h;f[6]=m+c;f[7]=0;f[8]=k+b;f[9]=m-c;f[10]=1-g-d;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};f.frustum=function(f,e,g,d,h,c,b){var a=1/(g-e),l=1/(h-d),k=1/(c-b);f[0]=2*c*a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*c*l;f[6]=0;f[7]=0;f[8]=(g+e)*a;f[9]=(h+d)*l;f[10]=(b+c)*k;f[11]=-1;f[12]=0;f[13]=0;f[14]=b*c*2*k;f[15]=0;return f};f.perspective=function(f,e,g,d,h){e=1/Math.tan(e/2);var c=1/(d-h);f[0]=e/g;
f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=e;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(h+d)*c;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*h*d*c;f[15]=0;return f};f.perspectiveFromFieldOfView=function(f,e,g,d){var h=Math.tan(e.upDegrees*Math.PI/180),c=Math.tan(e.downDegrees*Math.PI/180),b=Math.tan(e.leftDegrees*Math.PI/180);e=Math.tan(e.rightDegrees*Math.PI/180);var a=2/(b+e),l=2/(h+c);f[0]=a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=l;f[6]=0;f[7]=0;f[8]=-((b-e)*a*.5);f[9]=(h-c)*l*.5;f[10]=d/(g-d);f[11]=-1;f[12]=0;f[13]=0;f[14]=d*g/(g-
d);f[15]=0;return f};f.ortho=function(f,e,g,d,h,c,b){var a=1/(e-g),l=1/(d-h),k=1/(c-b);f[0]=-2*a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*l;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*k;f[11]=0;f[12]=(e+g)*a;f[13]=(h+d)*l;f[14]=(b+c)*k;f[15]=1;return f};f.lookAt=function(k,e,g,d){var h,c,b,a,l,n,p,q,r=e[0],t=e[1];e=e[2];b=d[0];a=d[1];c=d[2];p=g[0];d=g[1];h=g[2];if(Math.abs(r-p)<m.EPSILON&&Math.abs(t-d)<m.EPSILON&&Math.abs(e-h)<m.EPSILON)return f.identity(k);g=r-p;d=t-d;p=e-h;q=1/Math.sqrt(g*g+d*d+p*p);g*=q;d*=
q;p*=q;h=a*p-c*d;c=c*g-b*p;b=b*d-a*g;(q=Math.sqrt(h*h+c*c+b*b))?(q=1/q,h*=q,c*=q,b*=q):b=c=h=0;a=d*b-p*c;l=p*h-g*b;n=g*c-d*h;(q=Math.sqrt(a*a+l*l+n*n))?(q=1/q,a*=q,l*=q,n*=q):n=l=a=0;k[0]=h;k[1]=a;k[2]=g;k[3]=0;k[4]=c;k[5]=l;k[6]=d;k[7]=0;k[8]=b;k[9]=n;k[10]=p;k[11]=0;k[12]=-(h*r+c*t+b*e);k[13]=-(a*r+l*t+n*e);k[14]=-(g*r+d*t+p*e);k[15]=1;return k};f.str=function(f){return"mat4("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+", "+f[9]+", "+f[10]+", "+f[11]+", "+
f[12]+", "+f[13]+", "+f[14]+", "+f[15]+")"};f.frob=function(f){return Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)+Math.pow(f[2],2)+Math.pow(f[3],2)+Math.pow(f[4],2)+Math.pow(f[5],2)+Math.pow(f[6],2)+Math.pow(f[7],2)+Math.pow(f[8],2)+Math.pow(f[9],2)+Math.pow(f[10],2)+Math.pow(f[11],2)+Math.pow(f[12],2)+Math.pow(f[13],2)+Math.pow(f[14],2)+Math.pow(f[15],2))};f.add=function(f,e,g){f[0]=e[0]+g[0];f[1]=e[1]+g[1];f[2]=e[2]+g[2];f[3]=e[3]+g[3];f[4]=e[4]+g[4];f[5]=e[5]+g[5];f[6]=e[6]+g[6];f[7]=e[7]+g[7];
f[8]=e[8]+g[8];f[9]=e[9]+g[9];f[10]=e[10]+g[10];f[11]=e[11]+g[11];f[12]=e[12]+g[12];f[13]=e[13]+g[13];f[14]=e[14]+g[14];f[15]=e[15]+g[15];return f};f.subtract=function(f,e,g){f[0]=e[0]-g[0];f[1]=e[1]-g[1];f[2]=e[2]-g[2];f[3]=e[3]-g[3];f[4]=e[4]-g[4];f[5]=e[5]-g[5];f[6]=e[6]-g[6];f[7]=e[7]-g[7];f[8]=e[8]-g[8];f[9]=e[9]-g[9];f[10]=e[10]-g[10];f[11]=e[11]-g[11];f[12]=e[12]-g[12];f[13]=e[13]-g[13];f[14]=e[14]-g[14];f[15]=e[15]-g[15];return f};f.sub=f.subtract;f.multiplyScalar=function(f,e,g){f[0]=e[0]*
g;f[1]=e[1]*g;f[2]=e[2]*g;f[3]=e[3]*g;f[4]=e[4]*g;f[5]=e[5]*g;f[6]=e[6]*g;f[7]=e[7]*g;f[8]=e[8]*g;f[9]=e[9]*g;f[10]=e[10]*g;f[11]=e[11]*g;f[12]=e[12]*g;f[13]=e[13]*g;f[14]=e[14]*g;f[15]=e[15]*g;return f};f.multiplyScalarAndAdd=function(f,e,g,d){f[0]=e[0]+g[0]*d;f[1]=e[1]+g[1]*d;f[2]=e[2]+g[2]*d;f[3]=e[3]+g[3]*d;f[4]=e[4]+g[4]*d;f[5]=e[5]+g[5]*d;f[6]=e[6]+g[6]*d;f[7]=e[7]+g[7]*d;f[8]=e[8]+g[8]*d;f[9]=e[9]+g[9]*d;f[10]=e[10]+g[10]*d;f[11]=e[11]+g[11]*d;f[12]=e[12]+g[12]*d;f[13]=e[13]+g[13]*d;f[14]=
e[14]+g[14]*d;f[15]=e[15]+g[15]*d;return f};f.exactEquals=function(f,e){return f[0]===e[0]&&f[1]===e[1]&&f[2]===e[2]&&f[3]===e[3]&&f[4]===e[4]&&f[5]===e[5]&&f[6]===e[6]&&f[7]===e[7]&&f[8]===e[8]&&f[9]===e[9]&&f[10]===e[10]&&f[11]===e[11]&&f[12]===e[12]&&f[13]===e[13]&&f[14]===e[14]&&f[15]===e[15]};f.equals=function(f,e){var g=f[0],d=f[1],h=f[2],c=f[3],b=f[4],a=f[5],l=f[6],k=f[7],p=f[8],q=f[9],r=f[10],t=f[11],w=f[12],u=f[13],x=f[14];f=f[15];var v=e[0],z=e[1],y=e[2],A=e[3],B=e[4],C=e[5],E=e[6],D=e[7],
F=e[8],M=e[9],N=e[10],I=e[11],G=e[12],O=e[13],J=e[14];e=e[15];return Math.abs(g-v)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(v))&&Math.abs(d-z)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(h-y)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-A)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(b-B)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(a-C)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(l-E)<=m.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&
Math.abs(k-D)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(D))&&Math.abs(p-F)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-M)<=m.EPSILON*Math.max(1,Math.abs(q),Math.abs(M))&&Math.abs(r-N)<=m.EPSILON*Math.max(1,Math.abs(r),Math.abs(N))&&Math.abs(t-I)<=m.EPSILON*Math.max(1,Math.abs(t),Math.abs(I))&&Math.abs(w-G)<=m.EPSILON*Math.max(1,Math.abs(w),Math.abs(G))&&Math.abs(u-O)<=m.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(x-J)<=m.EPSILON*Math.max(1,Math.abs(x),Math.abs(J))&&Math.abs(f-
e)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(e))};return f})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var m={EPSILON:1E-6};m.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;m.RANDOM=Math.random;m.ENABLE_SIMD=!1;m.SIMD_AVAILABLE=m.ARRAY_TYPE===Float32Array&&"SIMD"in this;m.USE_SIMD=m.ENABLE_SIMD&&m.SIMD_AVAILABLE;m.setMatrixArrayType=function(f){m.ARRAY_TYPE=f};var f=Math.PI/180;m.toRadian=function(k){return k*f};m.equals=function(f,e){return Math.abs(f-e)<=
m.EPSILON*Math.max(1,Math.abs(f),Math.abs(e))};return m})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(m){var f={create:function(){var f=new m.ARRAY_TYPE(2);f[0]=0;f[1]=0;return f},clone:function(f){var e=new m.ARRAY_TYPE(2);e[0]=f[0];e[1]=f[1];return e},fromValues:function(f,e){var g=new m.ARRAY_TYPE(2);g[0]=f;g[1]=e;return g},copy:function(f,e){f[0]=e[0];f[1]=e[1];return f},set:function(f,e,g){f[0]=e;f[1]=g;return f},add:function(f,e,g){f[0]=e[0]+g[0];f[1]=e[1]+g[1];
return f},subtract:function(f,e,g){f[0]=e[0]-g[0];f[1]=e[1]-g[1];return f}};f.sub=f.subtract;f.multiply=function(f,e,g){f[0]=e[0]*g[0];f[1]=e[1]*g[1];return f};f.mul=f.multiply;f.divide=function(f,e,g){f[0]=e[0]/g[0];f[1]=e[1]/g[1];return f};f.div=f.divide;f.ceil=function(f,e){f[0]=Math.ceil(e[0]);f[1]=Math.ceil(e[1]);return f};f.floor=function(f,e){f[0]=Math.floor(e[0]);f[1]=Math.floor(e[1]);return f};f.min=function(f,e,g){f[0]=Math.min(e[0],g[0]);f[1]=Math.min(e[1],g[1]);return f};f.max=function(f,
e,g){f[0]=Math.max(e[0],g[0]);f[1]=Math.max(e[1],g[1]);return f};f.round=function(f,e){f[0]=Math.round(e[0]);f[1]=Math.round(e[1]);return f};f.scale=function(f,e,g){f[0]=e[0]*g;f[1]=e[1]*g;return f};f.scaleAndAdd=function(f,e,g,d){f[0]=e[0]+g[0]*d;f[1]=e[1]+g[1]*d;return f};f.distance=function(f,e){var g=e[0]-f[0];f=e[1]-f[1];return Math.sqrt(g*g+f*f)};f.dist=f.distance;f.squaredDistance=function(f,e){var g=e[0]-f[0];f=e[1]-f[1];return g*g+f*f};f.sqrDist=f.squaredDistance;f.length=function(f){var e=
f[0];f=f[1];return Math.sqrt(e*e+f*f)};f.len=f.length;f.squaredLength=function(f){var e=f[0];f=f[1];return e*e+f*f};f.sqrLen=f.squaredLength;f.negate=function(f,e){f[0]=-e[0];f[1]=-e[1];return f};f.inverse=function(f,e){f[0]=1/e[0];f[1]=1/e[1];return f};f.normalize=function(f,e){var g=e[0],d=e[1],g=g*g+d*d;0<g&&(g=1/Math.sqrt(g),f[0]=e[0]*g,f[1]=e[1]*g);return f};f.dot=function(f,e){return f[0]*e[0]+f[1]*e[1]};f.cross=function(f,e,g){e=e[0]*g[1]-e[1]*g[0];f[0]=f[1]=0;f[2]=e;return f};f.lerp=function(f,
e,g,d){var h=e[0];e=e[1];f[0]=h+d*(g[0]-h);f[1]=e+d*(g[1]-e);return f};f.random=function(f,e){e=e||1;var g=2*m.RANDOM()*Math.PI;f[0]=Math.cos(g)*e;f[1]=Math.sin(g)*e;return f};f.transformMat2=function(f,e,g){var d=e[0];e=e[1];f[0]=g[0]*d+g[2]*e;f[1]=g[1]*d+g[3]*e;return f};f.transformMat2d=function(f,e,g){var d=e[0];e=e[1];f[0]=g[0]*d+g[2]*e+g[4];f[1]=g[1]*d+g[3]*e+g[5];return f};f.transformMat3=function(f,e,g){var d=e[0];e=e[1];f[0]=g[0]*d+g[3]*e+g[6];f[1]=g[1]*d+g[4]*e+g[7];return f};f.transformMat4=
function(f,e,g){var d=e[0];e=e[1];f[0]=g[0]*d+g[4]*e+g[12];f[1]=g[1]*d+g[5]*e+g[13];return f};f.forEach=function(){var k=f.create();return function(e,g,d,f,c,b){g||(g=2);d||(d=0);for(f=f?Math.min(f*g+d,e.length):e.length;d<f;d+=g)k[0]=e[d],k[1]=e[d+1],c(k,k,b),e[d]=k[0],e[d+1]=k[1];return e}}();f.str=function(f){return"vec2("+f[0]+", "+f[1]+")"};f.exactEquals=function(f,e){return f[0]===e[0]&&f[1]===e[1]};f.equals=function(f,e){var g=f[0];f=f[1];var d=e[0];e=e[1];return Math.abs(g-d)<=m.EPSILON*Math.max(1,
Math.abs(g),Math.abs(d))&&Math.abs(f-e)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(e))};return f})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(m,f,k,e){return function(e){function d(){var d=null!==e&&e.apply(this,arguments)||this;d._renderRequestedCalled=!1;d._attached=!1;d._opacity=1;d.renderRequested=!1;d._visible=!0;return d}k(d,e);Object.defineProperty(d.prototype,"attached",{get:function(){return this._attached},
set:function(d){this._attached!==d&&((this._attached=d)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"opacity",{get:function(){return this._opacity},set:function(d){this._opacity!==d&&(this._opacity=d,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{get:function(){return this._visible},set:function(d){this._visible!==d&&
(this._visible=d,this.requestRender())},enumerable:!0,configurable:!0});d.prototype.attach=function(d){return!0};d.prototype.detach=function(d){};d.prototype.processRender=function(d){this._renderRequestedCalled=!1;this.doRender(d);this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};d.prototype.requestRender=function(){var d=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);
d!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};d.prototype.dispose=function(){};return d}(e.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function d(){}d.prototype.on=function(d,c){return e.after(this,"on"+d,c,!0)};d.prototype.once=function(d,c){return g.once(this,d,c)};d.prototype.emit=
function(d){g.emit(this,d,this)};d.prototype.hasEventListener=function(d){d="on"+d;return!(!this[d]||!this[d].after)};return d}();f.Evented=m;f.EventedMixin=function(d){return function(d){function c(){return null!==d&&d.apply(this,arguments)||this}k(c,d);c.prototype.on=function(b,a){return e.after(this,"on"+b,a,!0)};c.prototype.once=function(b,a){return g.once(this,b,a)};c.prototype.emit=function(b,a){g.emit(this,b,a)};c.prototype.hasEventListener=function(b){b="on"+b;return!(!this[b]||!this[b].after)};
return c}(d)}})},"esri/views/2d/tiling/enums":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=f.TileStatus||(f.TileStatus={});m[m.INITIALIZED=0]="INITIALIZED";m[m.NO_DATA=1]="NO_DATA";m[m.READY=2]="READY";m[m.MODIFIED=3]="MODIFIED";m[m.INVALID=4]="INVALID"})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(m,f,k){return function(){function e(e,d,f,c){this.set(e,d,f,c)}e.from=function(g,
d,f,c){return e.pool.acquire(g,d,f,c)};e.getId=function(e,d,f,c){return"object"===typeof e?e.level+"/"+e.row+"/"+e.col+"/"+e.world:e+"/"+d+"/"+f+"/"+c};Object.defineProperty(e.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});e.prototype.equals=function(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world};e.prototype.release=
function(){this.world=this.col=this.row=this.level=0};e.prototype.set=function(e,d,f,c){null==e?this.world=this.col=this.row=this.level=0:"object"===typeof e?(this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0):"string"===typeof e?(e=e.split("/"),d=e[1],f=e[2],c=e[3],this.level=parseFloat(e[0]),this.row=parseFloat(d),this.col=parseFloat(f),this.world=parseFloat(c)):(this.level=+e,this.row=+d,this.col=+f,this.world=+c||0);return this};e.prototype.toString=function(){return this.level+
"/"+this.row+"/"+this.col+"/"+this.world};e.prototype.getChildKeys=function(){var g=this.level+1,d=this.row<<1,f=this.col<<1,c=this.world;return[e.pool.acquire(g,d,f,c),e.pool.acquire(g,d,f+1,c),e.pool.acquire(g,d+1,f,c),e.pool.acquire(g,d+1,f+1,c)]};e.prototype._compare=function(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0};e.sort=function(g){return g.map(function(d){return e.from(d)}).sort(function(d,e){return d._compare(e)}).map(function(d){return d.id})};e.pool=
new k(e,!0,null,25,50);return e}()})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(){return function(e){this.type=e}}();f.RenderBucket=m;e=function(e){function d(){var d=e.call(this,2)||this;d.triangleElementStart=0;d.triangleElementCount=0;return d}k(d,e);d.prototype.hasData=function(){return 0<this.triangleElementCount};
return d}(m);f.LineRenderBucket=e;e=function(e){function d(){var d=e.call(this,1)||this;d.triangleElementStart=0;d.triangleElementCount=0;d.outlineElementStart=0;d.outlineElementCount=0;return d}k(d,e);d.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return d}(m);f.FillRenderBucket=e;e=function(e){function d(){var d=e.call(this,3)||this;d.markerPerPageElementsMap=new Map;d.glyphPerPageElementsMap=new Map;d.isSDF=!1;return d}k(d,e);d.prototype.hasData=
function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return d}(m);f.SymbolRenderBucket=e;e=function(e){function d(){var d=e.call(this,4)||this;d.triangleElementStart=0;d.triangleElementCount=0;return d}k(d,e);d.prototype.hasData=function(){return 0<this.triangleElementCount};return d}(m);f.CircleRenderBucket=e;m=function(e){function d(){return e.call(this,0)||this}k(d,e);d.prototype.hasData=function(){return!0};return d}(m);f.BackgroundRenderBucket=m})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(m,f,k,e,g,d,h,c){function b(a,b,d){for(var e=0;e<d.length;e++){var g=d[e];if(g){var f=g.safeWidth,l=g.width,k=g.pixelData,m=h.clamp(g.dy*(g.y1-b),0,f),g=h.clamp(g.dx*(a-g.x0),0,f),f=Math.floor(m),n=Math.floor(g),p=f*l+n,q=p+l,r=k[p],l=k[q],p=k[p+1],k=k[q+1];if(r+l+p+k<.5*c.ELEVATION_NODATA_VALUE)return m-=f,g-=n,a=r+(p-r)*g,a+(l+(k-l)*g-a)*m}}return null}function a(a,b,c,d){var e=0<(c&2),g=b+(d?1024:0)+(e?2048:0),f=r[g];if(!f){var f=b-1,h=b-1,l=b*b,k=2*f+2*h,m=f*h*6,n=6*k,q=6*(2*f+h-1);d&&
(m*=2,n*=2,q*=2);for(var k=65536<l+k?new Uint32Array(m+n):new Uint16Array(m+n),t=0,v=0,u=m,w,x,z,y,A=0,T=0;T<=h;T++){e&&(A=0===T?q:T===h?-q:0);for(var u=u+A,S=0;S<=f;S++)z=p(S,T,f,h),-1<z&&(y=0===T&&S!==f?1:S===f&&T!==h?f+1:T===h&&0!==S?-1:0===S&&0!==T?-(f+1):0,0!==y&&(w=t,x=l+z,z=l+(0===S&&1===T?0:z+1),y=t+y,d?(k[u+0]=w,k[u+1]=x,k[u+2]=x,k[u+3]=z,k[u+4]=z,k[u+5]=w,k[u+6]=z,k[u+7]=y,k[u+8]=y,k[u+9]=w,k[u+10]=w,k[u+11]=z,u+=12):(k[u+0]=w,k[u+1]=x,k[u+2]=z,k[u+3]=z,k[u+4]=y,k[u+5]=w,u+=6))),++t,S<f&&
T<h&&(w=T*(f+1)+S,x=w+1,z=x+(f+1),y=z-1,d?(k[v+0]=w,k[v+1]=x,k[v+2]=x,k[v+3]=z,k[v+4]=z,k[v+5]=w,k[v+6]=z,k[v+7]=y,k[v+8]=y,k[v+9]=w,k[v+10]=w,k[v+11]=z,v+=12):(k[v+0]=w,k[v+1]=x,k[v+2]=z,k[v+3]=z,k[v+4]=y,k[v+5]=w,v+=6));u-=A}f={values:k,numSurfaceIndices:m,numSkirtIndices:n};r[g]=f}a.indices=f.values;a.numSurfaceIndices=f.numSurfaceIndices;a.numSkirtIndices=f.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function l(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);
b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function n(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function p(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(f,"__esModule",{value:!0});var q=new g.ArrayPool(Float32Array);f.releaseGeometry=function(a){q.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};f.elevationSampler=b;f.createSphericalGlobeTile=function(c,g,f,m,r,C,E,D,F){var v=f[0],z=f[1],y=f[2];f=f[3];
var A=.1*d.earthRadius*(f-z),B=c-1,J=c-1,Q=c*c,H=q.get(5*(Q+(2*B+2*J))),K=F.geometryInfo.boundingBox;k.empty(K);var R=g[2]-g[0],P=g[3]-g[1],L=y-v,y=C[0],T=C[1];C=C[2];for(var S=0;S<=B;S++){var W=S/B,Y=v+W*L;t[S]=Math.sin(Y);w[S]=Math.cos(Y);u[S]=W;x[S]=g[0]+W*R}v=m&&!!(E&1);R=m&&!!(E&2);for(Y=L=0;Y<=J;Y++){var X=Y/J,S=h.lerp(z,f,X),aa=Math.cos(S),U=Math.sin(S),ha=void 0;m?(ha=d.earthRadius/2*Math.log((1+U)/(1-U)),X=(ha-g[1])/P):ha=180*S/Math.PI;for(S=0;S<=B;S++){var W=u[S],Z=t[S],ba=w[S],ka=d.earthRadius;
r&&(ka+=b(x[S],ha,r)||0);ba=ba*aa*ka-y;Z=Z*aa*ka-T;ka=U*ka-C;l(ba,Z,ka,K);var ga=5*L;H[ga+0]=ba;H[ga+1]=Z;H[ga+2]=ka;H[ga+3]=W;H[ga+4]=X;ga=p(S,Y,B,J);if(-1<ga){var ga=5*(Q+ga),ia=v&&0===Y?-1:R&&Y===J?1:0,ba=0===ia?ba:-y,Z=0===ia?Z:-T,ka=0===ia?ka:d.earthRadius*ia-C;H[ga+0]=ba;H[ga+1]=Z;H[ga+2]=ka;H[ga+3]=0===ia?n(W,X):W;H[ga+4]=0===ia?A:X;0!==ia&&l(ba,Z,ka,K)}++L}}F.geometryInfo.numVertsPerRow=c;F.geometryInfo.vertexAttributes=H;F.geometryInfo.skirtLength=A;e.vec4d.set4(0,0,1,1,F.geometryInfo.uvOffsetAndScale);
a(F.geometryInfo,c,m?E:0,D)};f.createPlanarGlobeTile=function(c,d,g,f,h,m,r){var t=d[0],v=d[1],u=d[2]-t,w=d[3]-v,x=m?Math.max(0,(m[0]-d[0])/u):0,z=m?Math.max(0,(m[1]-d[1])/w):0,y=m?Math.min(1,(m[2]-d[0])/u):1;d=m?Math.min(1,(m[3]-d[1])/w):1;var A=y>x?1/(y-x):1,B=d>z?1/(d-z):1,C=-x*A,E=-z*B,R=.1*u,P=c-1,L=c-1,T=c*c,S=q.get(5*(T+(2*P+2*L))),W=r.geometryInfo.boundingBox;k.empty(W);for(var Y=0,X=0;X<=L;X++){var aa=X/L,U=E+aa*B,aa=v+aa*w;m&&(aa<m[1]?(aa=m[1],U=0):aa>m[3]&&(aa=m[3],U=1));for(var ha=0;ha<=
P;ha++){var Z=ha/P,ba=C+Z*A,Z=t+Z*u;m&&(Z<m[0]?(Z=m[0],ba=0):Z>m[2]&&(Z=m[2],ba=1));var ka=g?b(Z,aa,g)||0:0,Z=Z-f[0],ga=aa-f[1],ka=ka-f[2];l(Z,ga,ka,W);S[5*Y]=Z;S[5*Y+1]=ga;S[5*Y+2]=ka;S[5*Y+3]=ba;S[5*Y+4]=U;var ia=p(ha,X,P,P);-1<ia&&(ia=5*(T+ia),S[ia]=Z,S[ia+1]=ga,S[ia+2]=ka,S[ia+3]=n(ba,U),S[ia+4]=R);++Y}}r.geometryInfo.numVertsPerRow=c;r.geometryInfo.vertexAttributes=S;r.geometryInfo.skirtLength=R;e.vec4d.set4(x,z,y-x,d-z,r.geometryInfo.uvOffsetAndScale);a(r.geometryInfo,c,0,h)};var r=[],t=Array(c.MAX_TILE_TESSELATION+
1),w=Array(c.MAX_TILE_TESSELATION+1),u=Array(c.MAX_TILE_TESSELATION+1),x=Array(c.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function f(e,g){void 0===g&&(g=50);this.arrayConstructor=e;this.maxPoolSizePerCount=g;this.pool={}}f.prototype.get=function(e){var g=this.pool[e];g||(g={ptr:0,data:Array(this.maxPoolSizePerCount)},this.pool[e]=g);0<g.ptr?(e=g.data[--g.ptr],g.data[g.ptr]=
null):e=new this.arrayConstructor(e);return e};f.prototype.put=function(e){var g=this.pool[e.length];g.ptr<g.data.length&&(g.data[g.ptr++]=e)};return f}();f.ArrayPool=m})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/gl-matrix ../support/earthUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(m,f,k,e,g,d,h,c,b){function a(a,b,c,e){c=d.earthRadius+c;var g=Math.cos(a);e[0]=Math.cos(b)*
g*c;e[1]=Math.sin(b)*g*c;e[2]=Math.sin(a)*c}return function(c){function f(a,b,d,e){var h=c.call(this,f.NumSubdivisionsAtLevel)||this;h.obb=[];h.isWebMercator=!1;h.tileUp=g.vec3d.create();h.obb=Array(8);for(var l=0;8>l;l++)h.obb[l]=g.vec3d.create();void 0!==a&&h.init(a,b,d,e);return h}k(f,c);f.prototype.init=function(b,e,f,l){c.prototype.init.call(this,b,e,f,l);this.isWebMercator=l.spatialReference.isWebMercator;e=this.extentWGS84Rad[0];f=this.extentWGS84Rad[1];l=this.extentWGS84Rad[2];var k=this.extentWGS84Rad[3];
b=b[0];var m=h.lerp(f,k,.5),n=h.lerp(e,l,.5);this.edgeLen=(l-e)*Math.cos(0===b?0:Math.min(Math.abs(f),Math.abs(k)))*d.earthRadius;this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=d.earthRadius-Math.sqrt(d.earthRadius*d.earthRadius-this.edgeLen2/4);a(m,n,0,this.centerAtSeaLevel);g.vec3d.set(this.centerAtSeaLevel,this.tileUp);g.vec3d.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};f.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])g.vec3d.set3(0,0,0,this.center),
this.radius=d.earthRadius+this.elevationBounds[1];else{c.prototype.updateRadiusAndCenter.call(this);var a=Math.max(g.vec3d.dist2(this.center,this.obb[0]),g.vec3d.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};f.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){for(var b=this.obb,c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!(0>a[c][0]*b[d][0]+a[c][1]*b[d][1]+a[c][2]*b[d][2]+a[c][3]);d++);if(8===d)return!1}return!0}b=this.radius;c=this.center;return a[0][0]*
c[0]+a[0][1]*c[1]+a[0][2]*c[2]+a[0][3]>b||a[1][0]*c[0]+a[1][1]*c[1]+a[1][2]*c[2]+a[1][3]>b||a[2][0]*c[0]+a[2][1]*c[1]+a[2][2]*c[2]+a[2][3]>b||a[3][0]*c[0]+a[3][1]*c[1]+a[3][2]*c[2]+a[3][3]>b||a[4][0]*c[0]+a[4][1]*c[1]+a[4][2]*c[2]+a[4][3]>b||a[5][0]*c[0]+a[5][1]*c[1]+a[5][2]*c[2]+a[5][3]>b?!1:!0};f.prototype.computeElevationBounds=function(){c.prototype.computeElevationBounds.call(this);this._updateOBB()};f.prototype.createGeometry=function(a,c,d){var e=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=
!1;b.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this.isWebMercator,a.samplerData,c,e,d,this.renderData);this.updateMemoryUsed()};f.prototype._updateOBB=function(){for(var b=this.extentWGS84Rad,c=this.obb,e=0;2>e;e++){var f=this.elevationBounds[e],h=4*e;a(b[1],b[0],f,c[h++]);a(b[3],b[0],f,c[h++]);a(b[3],b[2],f,c[h++]);a(b[1],b[2],f,c[h++])}this.isWebMercator&&(b=this._isPole(this.lij[1],this.lij[0]),2===b?(g.vec3d.set3(0,0,d.earthRadius,c[1]),g.vec3d.set3(0,0,d.earthRadius,
c[2]),g.vec3d.set3(0,0,d.earthRadius,c[5]),g.vec3d.set3(0,0,d.earthRadius,c[6])):1===b&&(g.vec3d.set3(0,0,-d.earthRadius,c[0]),g.vec3d.set3(0,0,-d.earthRadius,c[3]),g.vec3d.set3(0,0,-d.earthRadius,c[4]),g.vec3d.set3(0,0,-d.earthRadius,c[7])))};f.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};f.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];f.Pool=new e(f);return f}(c)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){function n(a,c){a&&!a.spatialReference.equals(c)&&(a=b.canProject(a.spatialReference,c)?b.project(a,c):null);return a}Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function b(b){b=a.call(this,b)||this;b._changeListeners=new d;return b}k(b,a);b.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};b.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(b.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});b.prototype._computeStencilEnabledExtents=function(a,b){var d=[],e=0;for(a=a.items;e<a.length;e++){var g=a[e].layer;"IntegratedMeshLayer"===g.operationalLayerType&&null!=b&&(g=n(g.fullExtent,b),null!=g&&d.push(c.fromExtent(g)))}return d};
e([h.property({readOnly:!0})],b.prototype,"layerViewsExtent",null);e([h.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],b.prototype,"tiledLayersExtent",null);e([h.property({readOnly:!0,dependsOn:["spatialReference"]})],b.prototype,"stencilEnabledExtents",null);e([h.property()],b.prototype,"spatialReference",null);e([h.property()],b.prototype,"tilingScheme",null);e([h.property()],b.prototype,"defaultTiledLayersExtent",void 0);e([h.property({constructOnly:!0})],b.prototype,"layers",
void 0);e([h.property({constructOnly:!0})],b.prototype,"layerViews",void 0);return b=e([h.subclass()],b)}(h.declared(g));g=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}k(c,b);c.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};c.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};c.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?a.WEBMERCATOR_WORLD_EXTENT:a.GEOGRAPHIC_WORLD_EXTENT};e([h.property({dependsOn:["spatialReference"]})],
c.prototype,"layerViewsExtent",void 0);return c=e([h.subclass()],c)}(h.declared(m));f.SurfaceExtentHelperGlobal=g;m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);b.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};b.prototype._computeLayerViewsExtent=function(){var a=c.empty(),b=this.spatialReference;
this.layerViews.forEach(function(d){d.isResolved()&&(d=d.fullExtentInLocalViewSpatialReference||d.layer.fullExtent,(d=n(d,b))&&c.expand(a,d))});var d=c.allFinite(a)?a:null,e=this._get("layerViewsExtent");return c.equals(d,e)?e:d};b.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,d=c.empty();this.layers.forEach(function(e){if(e.loaded&&l.isTiledLayer(e)){var g=l.getTiledLayerInfo(e,b,"local");e=g.tileInfo;g=g.fullExtent;e&&a.compatibleWith(e)&&
g&&g.spatialReference.equals(b)&&c.expand(d,g)}});this.defaultTiledLayersExtent&&c.expand(d,this.defaultTiledLayersExtent);var e=c.allFinite(d)?d:null,g=this._get("tiledLayersExtent");return c.equals(e,g)?g:e};return b=e([h.subclass()],b)}(h.declared(m));f.SurfaceExtentHelperLocal=m})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function g(b){b=a.call(this,b)||this;b._changeHandles=new d;return b}k(g,a);g.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};g.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};g.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var d=this.layers.find(function(b){return c.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!c.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(d)if(d.isResolved()){var e=c.getTiledLayerInfo(d,this.viewSpatialReference,this.manifold).tileInfo,e=new b(e),d=c.getKnownTiledServiceLevelCap(d.url);Infinity>d&&e.capMaxLod(d);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(e)}else this._updateWhen(d);else this._set("tilingSchemeDone",!0)}};g.prototype._updateWhen=function(a){var b=this,c=a.when().always(function(){c===b._waitTask&&b._update()});this._waitTask=c};g.prototype._lockTilingScheme=function(a){var c=this;if("spherical"===this.manifold){var d=a.levels.length-1;a=a.spatialReference.isWebMercator?b.makeWebMercatorAuxiliarySphere(d):b.makeWGS84WithTileSize(a.pixelSize[0],d)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return c._updateTiledLayerExtent()}))};g.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};g.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?b.WebMercatorAuxiliarySphere:b.makeWGS84WithTileSize(256),this.extent=
this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=b.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};e([h.property()],g.prototype,"tilingScheme",void 0);e([h.property()],g.prototype,"extent",void 0);e([h.property({value:!1})],g.prototype,"tilingSchemeLocked",void 0);e([h.property({readOnly:!0,value:!1})],g.prototype,"tilingSchemeDone",void 0);e([h.property({constructOnly:!0})],g.prototype,"viewSpatialReference",void 0);e([h.property({constructOnly:!0})],
g.prototype,"layers",void 0);e([h.property({constructOnly:!0})],g.prototype,"extentHelper",void 0);e([h.property({constructOnly:!0})],g.prototype,"manifold",void 0);return g=e([h.subclass()],g)}(h.declared(g))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../Color ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/BufferObject ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M){function N(a){return function(b,c){b=b.screenDepth;c=c.screenDepth;return b<c?-a:b>c?a:0}}function I(a){var b=N(a);return function(c,d){return 0===c.tiles.length?-a:0===d.tiles.length?a:b(c.tiles.data[0],d.tiles.data[0])}}var G=B.assert,O=b.mat4d.identity(),J=z.OPAQUE_TERRAIN,Q=z.TRANSPARENT_TERRAIN,H=b.vec3d.create(),K=b.vec2d.create(),R=c.create(),P=b.vec4d.create(),L=b.vec4d.create(),T=b.vec4d.create(),S=function(){return function(){this.extent=
b.vec4d.create();this.maxLevel=this.minLevel=0;this.callback=null}}();m=function(){function f(a,b){this.initialized=!1;this.rctx=null;this.renderDataPool=new g(q.TileRenderData);this.perOriginTileData=new d({initialSize:10,allocator:function(){return{root:null,origin:null,tiles:new d({initialSize:300})}}});this.perOriginTileDataDirty=!0;this.tileIterator=new t.IteratorPreorder;this.highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=C.copyParameters(W);this._opaque=
!0;this._skirtScale=1;this._cullBackFaces=this._disableRendering=this._drawBorders=!1;this._renderOrder=1;this._velvetOverground=!0;this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new l;this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=
!0;this.needsHighlight=this.didRender=!1;this.visibleScaleRangeQueries=new d({initialSize:10});this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new d({initialSize:30});this.visibleScaleRangeQueryPool=new g(S,!1);this.manifold=a;this.tileSize=b||256}f.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null)};f.prototype.install=function(a){a.addRenderPlugin([J,Q],this);this.drapedRenderer=a.getDrapedTextureRenderer()};
f.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(f.prototype,"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"opaque",{set:function(a){this._opaque=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"drawBorders",{set:function(a){this._drawBorders!==a&&(this._drawBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderOrder",{set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==
a&&(this._velvetOverground=a,this._updatePrograms())},enumerable:!0,configurable:!0});f.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};f.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};f.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};f.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};f.prototype.loadTile=
function(a){G(null===a.renderData);a.renderData=this.renderDataPool.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a);a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===this.wireframe.mode);a.renderData.localOrigin=b;this._updateTileGeometryBuffers(a);this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};f.prototype.queryVisibleLevelRange=function(a,c,d,e){var g=this.visibleScaleRangeQueryPool.acquire();b.vec4d.set(a,g.extent);g.minLevel=c?c:-Number.MAX_VALUE;
g.maxLevel=null!=d?d:Number.MAX_VALUE;g.callback=e;this.visibleScaleRangeQueryQueue.push(g);this.setNeedsRender()};f.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};f.prototype.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);for(var b=a.renderData.geometryState,c=a.layerInfo[n.LayerClass.ELEVATION],d=0;d<c.length;d++)c[d].pendingUpdates&=~n.TileUpdateTypes.UPDATE_GEOMETRY;return b.needsUpdate?(a.renderData.vao&&
this._releaseTileGeometry(a),a.createGeometry(b,a.renderData.localOrigin,"debug"===this.wireframe.mode),this._updateTileGeometryBuffers(a),!0):!1};f.prototype.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();this.renderDataPool.release(a.renderData);a.renderData=null;a.updateMemoryUsed()};f.prototype.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===this.manifold)return H;
for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};f.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};f.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};f.prototype.getWireframeEnabled=function(){return"shader"===this.wireframe.mode};f.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&
(this.debugScreenSizePerspective=a,this._updatePrograms())};f.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&t.traverseTilesPreorder(this.rootTiles,function(a){a.renderData&&(a.renderData.vao&&b._releaseTileGeometry(a),a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,
e),b._updateTileGeometryBuffers(a))})}for(var g in a)c.hasOwnProperty(g)&&(c[g]=a[g]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};f.prototype.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};f.prototype.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};f.prototype.isOpaque=
function(){var a=this.wireframe,a="shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity);return this._opaque&&!a};f.prototype.updateTileBackground=function(b){this.backgroundPromise&&this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof b?a.requestImage(b).catch(function(){return null}):null!=b?h.resolve(e.toUnitRGBA(b)):h.resolve(null);this._renderTileBackground()};f.prototype.initializeRenderContext=function(a){var b=this,c=this.rctx=a.rctx;a=this.programRep=a.programRep;var d=
function(a){h.when(a).then(function(){b.initialized=!0;b.setNeedsRender()}).catch(d)};d(this._renderTileBackground());this.programs={color:null,normal:null,depth:null,depthShadowMap:null,highlight:null};this._updatePrograms();this.tileRenderer=new r(c,this.tileSize,a,this.resourceCounter,this.setNeedsRender.bind(this));this._renderTileBackground();this.emptyTex=x.createEmptyTexture(c)};f.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);
this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};f.prototype.render=function(a){var b=a.rctx,c=b.gl;if(!this.initialized||this._disableRendering||!this.visible||!this.rootTiles||!this.tileBackgroundInitialized)return!1;var d=this.isOpaque()?J:Q;if(a.slot!==d)return!1;A.trace("# BEGIN RENDER TERRAIN");d=a.pass;b.setFaceCullingEnabled(this._cullBackFaces);var e=1===a.lightingData.helper.globalFactor;d===v.MATERIAL?this._renderMaterialPass(a,this._updatePerOriginTileData()):d===
v.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&e?this._renderDepthPass(a,this.programs.depthShadowMap,this._updatePerOriginTileData()):d===v.MATERIAL_DEPTH?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):d===v.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):d===v.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clear(c.DEPTH_BUFFER_BIT));this._cullBackFaces&&b.setFaceCullingEnabled(!1);A.trace("# END RENDER TERRAIN");
return!0};f.prototype.intersect=function(a,d,e,g){if(this.rootTiles&&(!a.isSelection||this.isOpaque())&&a.enableTerrain){var f=X,h=aa;b.vec3d.subtract(e,d,f);b.vec3d.set3(1/f[0],1/f[1],1/f[2],h);var l=a.minResult,k=a.maxResult,m=this.clippingExtent,n=this.tileIterator;n.reset(this.rootTiles);g=function(){var g=n.next();if(null===g.renderData)return"continue";if(a.enableInvisibleTerrain){if(!g.visible&&m&&!g.intersectsExtent(m))return"continue"}else if(!g.visible)return"continue";var q=g.renderData.geometryInfo,
r=g.renderData.localOrigin,v=U;b.vec3d.subtract(d,r,v);var u=-p._skirtScale*q.skirtLength;if(0!==u){var w=g.tileUp;c.offset(q.boundingBox,u*w[0],u*w[1],u*w[2],R);c.expandWithBuffer(R,q.boundingBox,0,2)}if(!C.intersectAabbInvDir(0!==u?R:q.boundingBox,v,h,a.tolerance))return"continue";var w=function(c,d,e){if(0<=c&&(a.enableBackfacesTerrain||0>b.vec3d.dot(d,f))){e=void 0;if(void 0===l.dist||c<l.dist)e=t.tile2str(g),l.set(void 0,e,c,d,void 0),l.setIntersector("TerrainRenderer");if(void 0===k.dist||c>
k.dist)e=t.tile2str(g),k.set(void 0,e,c,d,void 0),k.setIntersector("TerrainRenderer")}},x=ha;b.vec3d.subtract(e,r,x);var r=q.indices,z={data:q.vertexAttributes,size:3,offsetIdx:0,strideIdx:5},q=q.numWithoutSkirtIndices/3;C.intersectTriangles(v,x,0,q,r,z,null,w);0!==u&&t.intersectSkirts(v,x,q,r.length/3,r,z,null,"spherical"===p.manifold?function(a){return b.vec3d.scale(a,u/b.vec3d.length(a))}:function(a){return b.vec3d.set3(0,0,u,a)},w)};for(var p=this;!n.done;)g()}};f.prototype._renderTileBackground=
function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=!0,a.tileRenderer.setBackground(b),a.rootTiles&&t.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b)}))})};f.prototype._updatePrograms=function(){var a="spherical"===this.manifold,b=a?"global":"local",c="shader"===this.wireframe.mode,d=this.programRep;this.programs.color=d.getProgram(E.colorPass,{viewingMode:b,
mode:c||this._drawBorders?"wireframe":"normal",spherical:a,overlay:this._hasOverlays,atmosphere:a&&this._velvetOverground,wireframeTexture:c,tileBorders:this._drawBorders,receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective});this.programs.normal=d.getProgram(E.normalPass,{viewingMode:b,spherical:a,alphaZero:!0});this.programs.depth=d.getProgram(E.depthPass,{viewingMode:b,spherical:a,shadowMap:!1});this.programs.depthShadowMap=d.getProgram(E.depthPass,{viewingMode:b,
spherical:a,shadowMap:!0});this.programs.highlight=d.getProgram(E.highlightPass,{viewingMode:b,spherical:a});this.setNeedsRender()};f.prototype._renderMaterialPass=function(a,c){var d=this,e=a.shadowMap&&a.shadowMap.enabled,g=a.rctx;this.receiveShadows!==e&&(this.receiveShadows=e,this._updatePrograms());e=!this.drapedRenderer.isEmpty();e!==this._hasOverlays&&(this._hasOverlays=e,this._updatePrograms());e=a.camera;g.setDepthTestEnabled(!0);var f=this.wireframe,h=this.programs.color;g.bindProgram(h);
if("shader"===f.mode||this._drawBorders)h.setUniform1f("wireframe.width",this.wireframe.width),h.setUniform1f("wireframe.falloff",Math.min(f.width,f.falloff)),h.setUniform1f("wireframe.wireOpacity",f.wireOpacity),h.setUniform1f("wireframe.surfaceOpacity",f.surfaceOpacity),h.setUniform4fv("wireframe.color",f.color);a.shadowMap&&a.shadowMap.bind(h);a.ssaoHelper&&a.ssaoHelper.setUniforms(h);h.setUniform1i("tex",0);h.setUniform1i("overlay0Tex",1);h.setUniform1i("overlay1Tex",2);h.setUniformMatrix4fv("viewNormal",
e.viewInverseTransposeMatrix);h.setUniformMatrix4fv("proj",e.projectionMatrix);a.lightingData.helper.setUniforms(h,!0);g=e.viewMatrix;b.vec3d.set3(g[12],g[13],g[14],Y);b.vec3d.normalize(Y);h.setUniform3fv("viewDirection",Y);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.isOpaque()?this._renderTiles(a,h,c):a.offscreenRenderingHelper.renderToTargets(function(){return d._renderTiles(a,h,c)},a.offscreenRenderingHelper.tmpColor,
a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};f.prototype._renderDepthPass=function(a,b,c){var d=a.rctx,e=a.camera;d.bindProgram(b);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!0);b.setUniformMatrix4fv("model",O);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);K[0]=e.near;K[1]=e.far;b.setUniform2fv("nearFar",K);this._renderTilesAuxiliary(a,b,c,!1)};f.prototype._renderNormalPass=
function(a,b){var c=a.rctx,d=a.camera,e=this.programs.normal;c.bindProgram(e);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);e.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);this._renderTilesAuxiliary(a,e,b,!1)};f.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);var e=a.offscreenRenderingHelper;c.bindTexture(e.depthTexture,3);d.setUniform1i("depthTex",3);d.setUniform4f("highlightViewportPixelSz",
0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};f.prototype._updatePerOriginTileData=function(){var a=this.perOriginTileData;if(!this.perOriginTileDataDirty)return a;this.highestVisibleLODTile=null;this._renderCollectOrigins();if(0!==this._renderOrder){for(var b=N(this._renderOrder),c=0;c<a.length;c++)this._sortFrontToBack(a.data[c].tiles,b);b=I(this._renderOrder);this._sortFrontToBack(a,b)}this.perOriginTileDataDirty=!1;return a};f.prototype._renderCollectOrigins=function(){var a=
this.perOriginTileData,b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],g=a.pushNew();g.root=e;g.origin=c?H:e.centerAtSeaLevel;g.tiles.clear();this._renderCollectOriginsForRoot(g)}return!0};f.prototype._renderCollectOriginsForRoot=function(a){var b=this.tileIterator,c=this.perOriginTileData;for(b.resetOne(a.root);!b.done;){var d=b.next(),e=d.renderData;if(e&&!d.visible)this.numTilesCulled++,b.skipSubtree();else{var g=c.back();if(7===d.lij[0]){if(g===
a||0!==g.tiles.length)g=c.pushNew(),g.tiles.clear();g.root=d;g.origin=d.centerAtSeaLevel}if(e){10<=d.lij[0]?c.back().tiles.push(d):a.tiles.push(d);if(!this.highestVisibleLODTile||d.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=d;b.skipSubtree()}}}};f.prototype._sortFrontToBack=function(a,b){a.sort(b)};f.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;
a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};f.prototype._updateStencilReadStateForTile=function(a,b){if(a.stencilRenderingHelper&&a.stencilRenderingHelper.enabled){for(var c=this.stencilEnabledLayerExtents,d=!1,e=0;e<c.length;e++)if(b.intersectsExtent(c[e])){d=!0;break}d?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};
f.prototype._renderTilesAuxiliary=function(a,b,c,d){var e=a.rctx,g=e.gl,f=a.camera,h=f.viewMatrix;b.setUniformMatrix4fv("proj",f.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",2));for(f=0;f<c.length;f++){var l=c.data[f];b.setUniform3fv("origin",l.origin);C.bindView(l.origin,h,b);for(var k=0;k<l.tiles.length;k++){var m=l.tiles.data[k],n=m.renderData;d&&(this._bindOverlayTextures(b,n.overlays,!0),b.setUniform1f("overlayOpacity",
n.overlayOpacity));this._updateStencilReadStateForTile(a,m);e.bindVAO(n.vao);F.assertCompatibleVertexAttributeLocations(n.vao,b);e.drawElements(g.TRIANGLES,0!==this._skirtScale?n.vao.indexBuffer.size:n.geometryInfo.numWithoutSkirtIndices,n.vao.indexBuffer.indexType,0)}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};f.prototype._renderTiles=function(a,c,d){var e=a.rctx,g=e.gl,f=a.camera,h=f.viewMatrix;if(this.debugScreenSizePerspective&&this.pointsOfInterest){var l=
y.getSettings("spherical"===this.manifold?"global":"local");l.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});C.bindScreenSizePerspective(l,a,c,"screenSizePerspective")}c.setUniform1f("skirtScale",this._skirtScale);for(f=0;f<d.length;f++)if(l=d.data[f],c.setUniform3fv("origin",l.origin),C.bindView(l.origin,h,c),a.shadowMap&&a.shadowMap.bindView(c,l.origin),this.numOriginsRendered++,l=l.tiles,0!==l.length){var k="debug"===this.wireframe.mode?g.LINES:g.TRIANGLES,
m=this.highestVisibleLODTile,n=void 0,p=void 0;m?(n=m.vlevel,p=this.tileSize/this.wireframe.resolution):(n=16,p=this.tileSize/64);for(m=0;m<l.length;m++){var q=l.data[m],r=q.renderData;this._updateStencilReadStateForTile(a,q);A.trace("# RENDER TILE "+t.tile2str(q)+", screenDepth:"+q.screenDepth);var v=r.geometryInfo.uvOffsetAndScale,u=r.texOffsetAndScale;b.vec4d.set4(v[0]*u[2]+u[0],v[1]*u[3]+u[1],v[2]*u[2],v[3]*u[3],T);c.setUniform4fv("texOffsetAndScale",T);e.bindTexture(r.textureReference||r.texture,
0);c.setUniform1f("opacity",r.opacity);this._bindOverlayTextures(c,r.overlays,!1);c.setUniform1f("overlayOpacity",r.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&c.setUniform1f("wireframe.subdivision",p*(1<<n-q.vlevel));v=0!==this._skirtScale?r.vao.indexBuffer.size:r.geometryInfo.numWithoutSkirtIndices;e.bindVAO(r.vao);F.assertCompatibleVertexAttributeLocations(r.vao,c);e.drawElements(k,v,r.vao.indexBuffer.indexType,0);q.renderOrder=this.numTilesRendered;this.numTilesRendered++;
this.numTrianglesRendered+=v/3;this._scaleQueriesForTile(q)}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};f.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,g=b[d],f=c?g.highlightRenderTargetId:g.renderTargetId;f?(f=this.drapedRenderer.getRenderTargetTexture(f),P[e]=g.texOffset[0],P[e+1]=g.texOffset[1],L[e]=g.texScale[0],L[e+1]=g.texScale[1],this.rctx.bindTexture(f,1+d)):(P[e]=0,P[e+1]=0,L[e]=0,L[e+1]=0,this.rctx.bindTexture(this.emptyTex,
1+d))}a.setUniform4fv("overlayTexOffset",P);a.setUniform4fv("overlayTexScale",L)};f.prototype._updateTileGeometryBuffers=function(a){var b=this.rctx,c=b.gl;a=a.renderData;var d=a.geometryInfo.indices;a.vao=new M(b,w.Default3D,{geometry:u.Pos3Tex},{geometry:D.createVertex(b,c.STATIC_DRAW,a.geometryInfo.vertexAttributes)},D.createIndex(b,c.STATIC_DRAW,d));this.setNeedsRender()};f.prototype._releaseTileGeometry=function(a){a=a.renderData;a.vao.dispose(!0);a.vao=null;p.releaseGeometry(a.geometryInfo);
this.setNeedsRender()};f.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};f.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};
return f}();var W={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},Y=b.vec3d.create(),X=b.vec3d.create(),aa=b.vec3d.create(),U=b.vec3d.create(),ha=b.vec3d.create();return m})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(m,f){return function(){function f(){this._numTileTexturesComposited=0}Object.defineProperty(f.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},
enumerable:!0,configurable:!0});f.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};f.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return f}()})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../../../geometry/support/aaBoundingBox","../lib/gl-matrix"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function g(){this.overlayTexOffset=e.vec2d.create();
this.texOffsetAndScale=e.vec4d.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:k.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:e.vec4d.create()};this.init()}g.prototype.init=function(){var d=this.geometryInfo;d.indices=null;d.vertexAttributes=null;k.empty(d.boundingBox);d.numSurfaceIndices=0;d.numSkirtIndices=0;d.numWithoutSkirtIndices=0;d.numVertsPerRow=0;this.textureReference=this.texture=this.vao=
this.geometryState=null;e.vec4d.set4(0,0,1,1,this.texOffsetAndScale);this.opacity=1;if(this.overlays)for(var d=0,g=this.overlays;d<g.length;d++){var c=g[d];c.renderTargetId=null;c.highlightRenderTargetId=null;e.vec2d.set2(1,1,c.texScale);e.vec2d.set2(0,0,c.texOffset)}else for(this.overlays=[null,null],d=0;2>d;d++)this.overlays[d]={renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};g.prototype.updateGeometryState=function(d){return this.geometryState=
d.geometryState(this.geometryState)};g.prototype.estimateGeometryMemoryUsage=function(){var d=this.geometryInfo;return d.indices.byteLength+d.vertexAttributes.byteLength};return g}();f.TileRenderData=m})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/gl-matrix ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){function t(a){return a instanceof HTMLImageElement||a instanceof HTMLCanvasElement}var w=Array(20),u=[0,0];return function(){function f(a,b,e,f,k){this._blackTex=this._backgroundTex=null;this.tileSize=256;this._context=a;this.tileSize=b;this._resourceCounter=f;this._setNeedsRender=k;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));b=new Float32Array(20);b[0]=-1;b[1]=-1;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=
-1;b[7]=0;b[8]=1;b[9]=0;b[10]=-1;b[11]=1;b[12]=0;b[13]=0;b[14]=1;b[15]=1;b[16]=1;b[17]=0;b[18]=1;b[19]=1;this._vaoQuad=new r(a,g.Default3D,{geometry:d.Pos3Tex},{geometry:l.createVertex(a,35044,b)});this._blendLayersProgram=e.getProgram(c.blendLayers);this._blackTex=h.createColorTexture(this._context,[0,0,0,1])}f.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vtFBO&&(this._vtFBO.dispose(),this._vtFBO=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);
this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};f.prototype.updateTileTexture=function(a){for(var b=e.LayerClass.MAP,c=a.layerInfo[b],d=0;d<c.length;d++)c[d].pendingUpdates&=~e.TileUpdateTypes.UPDATE_TEXTURE;if(a.renderData){for(var d=a.renderData,g=a.parentSurface,f=g.baseOpacity,
h=0,l=!1,m=c.length-1,n=c.length,q=0;q<c.length;q++){var r=c[q],v=g.layerViewByIndex(q,b),u=v.fullOpacity;w[q]=u;this._isBaseLayer(v.layer)&&n>=c.length&&(n=q);if(r.data||r.upsampleFromTile)if(h++,v.isOpaque&&1===u){l=!0;m=q;break}}0===h&&this._backgroundTex?(d.opacity=f,d.textureReference=this._backgroundTex,k.vec4d.set4(0,0,1,1,d.texOffsetAndScale)):1===h&&l?(r=c[m],g=c=void 0,r.data?(c=r,k.vec4d.set4(0,0,1,1,d.texOffsetAndScale)):(g=r.upsampleFromTile,c=g.tile.layerInfo[b][m],k.vec4d.set4(g.offset[0],
g.offset[1],g.scale,g.scale,d.texOffsetAndScale)),d.opacity=f,c&&(t(c.data)&&(c.data=this._buildTexture(c.data),g?g.tile.updateMemoryUsed():a.updateMemoryUsed()),c.data instanceof p&&(d.textureReference=c.data))):(d.opacity=this._composeMapLayers(a,c,m,n,l,w),d.textureReference=null,k.vec4d.set4(0,0,1,1,d.texOffsetAndScale));this._setNeedsRender()}};f.prototype.setBackground=function(a){t(a)?this._backgroundTex=this._buildTexture(a):this._backgroundTex=h.createColorTexture(this._context,a||[0,0,0,
0])};f.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if(a)try{d=new p(c,b,a)}catch(B){d=h.createEmptyTexture(c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else b.width=b.height=this.tileSize,d=new p(c,b);c.bindTexture(d);d.generateMipmap();return d};f.prototype._bindFBO=function(a,b,c,d){a&&a.width===
b&&a.height===c||(a&&a.dispose(),a=n.create(this._context,{colorTarget:0,depthStencilTarget:d?1:0,width:b,height:c}));this._context.bindFramebuffer(a);return a};f.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,g=this._blendLayersProgram,f=this._vaoQuad;e.bindProgram(g);e.bindVAO(f);q.assertCompatibleVertexAttributeLocations(f,g);e.bindTexture(a,0);g.setUniform1i("tex",0);g.setUniform1f("scale",b);g.setUniform2f("offset",c[0],c[1]);g.setUniform1f("opacity",d);e.drawArrays(5,
0,q.vertexCount(f,"geometry"))};f.prototype._composeMapLayers=function(c,d,g,f,h,l){c.renderData.texture||(c.renderData.texture=this._buildTexture(),c.updateMemoryUsed());var k=e.LayerClass.MAP,m=c.renderData.texture,n=this._context;this._fbo=this._bindFBO(this._fbo,m.descriptor.width,m.descriptor.height,!1);var q=n.gl;n.setViewport(0,0,this.tileSize,this.tileSize);n.setClearColor(0,0,0,0);n.setClearDepth(1);n.clear(q.COLOR_BUFFER_BIT);n.setDepthTestEnabled(!1);n.setBlendFunction(1,771);n.setBlendEquation(32774);
n.setBlendingEnabled(!0);!h&&this._backgroundTex&&this._drawRasterData(this._backgroundTex,1,u);h=c.parentSurface.baseOpacity;for(var r=!1;0<=g;g--){var v=d[g],w=v,x=c.lij,z=u,y=1;!v.data&&v.upsampleFromTile&&(y=v.upsampleFromTile,x=y.tile.lij,w=y.tile.layerInfo[k][g],z=[y.offset[0],y.offset[1]],y=y.scale);if(w){g<f&&1>h&&!r&&(n.setBlendFunction(0,770),this._drawRasterData(this._blackTex,1,u,h),n.setBlendFunction(1,771),r=!0);if(w.data instanceof a){var A=c.parentSurface.layerViewByIndex(g,k);this._vtFBO=
this._bindFBO(this._vtFBO,this.tileSize,this.tileSize,!0);n.setClearColor(1,1,1,0);n.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);b(this._context,x,w.data,A.renderer,A.schemaHelper,m.descriptor.width,m.descriptor.height);w.data.dispose();w.data=this._buildTexture();n.bindTexture(w.data);q.copyTexImage2D(n.gl.TEXTURE_2D,0,w.data.descriptor.pixelFormat,0,0,this.tileSize,this.tileSize,0);w.data.generateMipmap();n.bindFramebuffer(this._fbo);w===v?c.updateMemoryUsed():v.upsampleFromTile.tile.updateMemoryUsed()}else t(w.data)&&
(w.data=this._buildTexture(w.data),w===v?c.updateMemoryUsed():v.upsampleFromTile.tile.updateMemoryUsed());w.data instanceof p&&this._drawRasterData(w.data,y,z,l[g])}}n.bindTexture(m);q.copyTexImage2D(n.gl.TEXTURE_2D,0,m.descriptor.pixelFormat,0,0,m.descriptor.width,m.descriptor.height,0);m.generateMipmap();n.bindFramebuffer(null);n.setBlendFunctionSeparate(770,771,1,771);n.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited();return r?1:h};f.prototype._isBaseLayer=function(a){return a.parent&&
"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};return f}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","../../core/has","../../core/libs/gl-matrix/mat4"],function(m,f,k,e){var g={extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(d){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},
worldScreenWidth:1,viewpoint:{},toMap:function(d,e,c){return null},toScreen:function(d,e,c){return null},clone:function(){return null},copy:function(d){return this},toJSON:function(){return null}};return function(d,f,c,b,a,l,m){if(l!==m)throw Error("It is expected that tiles are square!");var h=a.adjustLevel(f[0]),h={context:d,drawPhase:0,state:g,stationary:!0,pixelRatio:1,displayLevel:h,requiredLevel:h,drawphase:0,renderer:b,layerOpacity:1,painter:null};b.initializeProgramCache(d);var n=a.getScale(f[0]);
a=a.getShift(f,n);var r=a[1];c.tileTransform.displayCoord[0]=-1-a[0];c.tileTransform.displayCoord[1]=1+r;a=c.tileTransform.transform;e.identity(a);n=.25*n/l;a[0]=n;a[5]=-n;d.setBlendFunctionSeparate(1,771,1,771);h.state.size=[l,m];h.state.width=l;h.state.height=m;b.setStateParams(h.state,h.pixelRatio,f[0]);c.attach(h);d.setFaceCullingEnabled(!1);d.setDepthFunction(515);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!0);d.setDepthWriteEnabled(!0);c.processRender(h);d.setDepthWriteEnabled(!1);d.setBlendingEnabled(!0);
h.drawphase=1;c.processRender(h);h.drawphase=2;c.processRender(h);k("esri-vector-tiles-debug")&&b.renderTileInfo(d,c);d.setDepthWriteEnabled(!0);d.setDepthTestEnabled(!1);d.setFaceCullingEnabled(!0)}})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){return g.glslifyDefineMap({SPHERICAL:d.spherical,
OVERLAY:d.overlay,ATMOSPHERE:d.atmosphere,WIREFRAME_TEXTURE:d.wireframeTexture,TILE_BORDERS:d.tileBorders,RECEIVE_SHADOWS:d.receiveShadows,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,ALPHA_ZERO:d.alphaZero,BIAS_SHADOWMAP:d.shadowMap})};f.colorPass={name:"terrain-color",shaders:function(g){return{vertexShader:d(g)+e.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:d(g)+e.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:k.Default3D};f.normalPass={name:"terrain-normal",
shaders:function(g){return{vertexShader:d(g)+e.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:d(g)+e.resolveIncludes("terrainRenderer/normalPass.frag")}},attributes:k.Default3D};f.depthPass={name:"terrain-depth",shaders:function(g){return{vertexShader:d(g)+e.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:d(g)+e.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"terrain-highlight",shaders:function(g){return{vertexShader:d(g)+
e.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:d(g)+e.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(m,f,k,e){return function(){function g(d){this.parent=null;this.lij=d;this.layerInfo=Array(k.LayerClass.COUNT)}g.prototype.hasDataAvailable=function(d,e,c){return(e=this.layerInfo[c][e].tilemap)?"unavailable"!==e.getAvailability(d.lij[1],
d.lij[2]):!0};g.prototype.modifyLayers=function(d,g,c){d=this.layerInfo[c];for(var b=g.length,a=Array(b),f=0;f<b;f++){var h=g[f];a[f]=-1<h?d[h]:e.makeEmptyLayerInfo(c)}this.layerInfo[c]=a};return g}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/has"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});f.check=function(){return e("esri-webgl")?e("esri-webgl-major-performance-caveat")?new k("webgl:major-performance-caveat-detected",
"Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):e("esri-webgl-high-precision-fragment")?e("esri-webgl-vertex-shader-samplers")?e("esri-webgl-element-index-uint")?e("esri-webgl-standard-derivatives")?e("esri-webgl-instanced-arrays")?null:new k("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new k("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):
new k("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new k("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new k("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new k("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(m,f,k,e,g,d){return function(d){function c(b){b=d.call(this)||this;b.components=["attribution","zoom","navigation-toggle","compass"];return b}k(c,d);e([g.property()],c.prototype,"components",void 0);return c=e([g.subclass("esri.views.ui.3d.DefaultUI3D")],c)}(g.declared(d))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-geometry ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){return function(b){function f(a){a=b.call(this)||this;a._defaultPositionLookup=null;a.components=[];return a}k(f,b);f.prototype.initialize=function(){this._handles.add([d.init(this,"components",this._componentsWatcher.bind(this)),d.init(this,"view",this._updateViewAwareWidgets.bind(this))])};f.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=g.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right",
"navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":"top-right"}}return this._defaultPositionLookup[a]};f.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};f.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};f.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};
f.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};f.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._findComponentPosition(a))})};f.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new c({id:a,node:b})};f.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===
a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};f.prototype._createAttribution=function(){return new a({view:this.view})};f.prototype._createCompass=function(){return new l({view:this.view})};f.prototype._createNavigationToggle=function(){return new n({view:this.view})};f.prototype._createZoom=function(){return new p({view:this.view})};e([h.property()],f.prototype,"components",void 0);return f=e([h.subclass("esri.views.ui.DefaultUI")],
f)}(h.declared(b))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.widget=null;return a}k(a,b);a.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(a.prototype,
"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&d.add(a,"esri-component"),b&&d.remove(b,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});a.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),g.byId(a);a&&
"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};e([c.property()],a.prototype,"id",null);e([c.property()],a.prototype,"node",null);e([c.cast("node")],a.prototype,"castNode",null);e([c.property({readOnly:!0})],a.prototype,"widget",void 0);return a=e([c.subclass("esri.views.ui.Component")],a)}(c.declared(h))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){function r(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(q)||!("component"in a||"index"in a||"position"in a)?null:a}var t={left:0,top:0,bottom:0,right:0},w={bottom:30,top:15,right:15,left:15};return function(a){function b(){var b=a.call(this)||this;b._cornerNameToContainerLookup={};b._positionNameToContainerLookup={};b._components=[];b._handles=new l;b._componentToKey=new Map;b.view=null;b._initContainers();return b}e(b,a);b.prototype.initialize=
function(){this._handles.add([n.init(this,"view.padding, container",this._applyViewPadding.bind(this)),n.init(this,"padding",this._applyUIPadding.bind(this))])};b.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(b.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(d.add(a,"esri-ui"),this._attachContainers(a)),
b&&(d.remove(b,"esri-ui"),c.set(b,{top:"",bottom:"",left:"",right:""}),h.empty(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},
enumerable:!0,configurable:!0});b.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:k({},w,a)};Object.defineProperty(b.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});b.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var g=r(a);g&&(d=g.index,b=g.position,a=g.component,
e=g.key);b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(q)||(a=new q({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};b.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};b.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!d.contains(a,"esri-ui-corner")}).map(function(a){return b.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};b.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=r(a)||r(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};b.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(q)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};b.prototype._getViewPadding=function(){return this.get("view.padding")||
t};b.prototype._attachContainers=function(a){h.place(this._manualContainer,a);h.place(this._innerContainer,a)};b.prototype._initContainers=function(){var a=h.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=h.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=h.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=h.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),e=h.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),g=h.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":e,"bottom-right":g};this._positionNameToContainerLookup=k({manual:b},this._cornerNameToContainerLookup)};b.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};b.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];
var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};b.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup&&a.widget.startup();h.place(a.node,b,c)};b.prototype._applyViewPadding=
function(){var a=this.container;a&&c.set(a,this._toPxPosition(this._getViewPadding()))};b.prototype._applyUIPadding=function(){this._innerContainer&&c.set(this._innerContainer,this._toPxPosition(this.padding))};b.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};b.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};b.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=
d===a)&&(b=d);return c});return b};b.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};b.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};g([p.property()],b.prototype,"container",null);g([p.property({dependsOn:["view.height"]})],b.prototype,"height",null);g([p.property({value:w})],b.prototype,"padding",null);g([p.cast("padding")],b.prototype,"castPadding",
null);g([p.property()],b.prototype,"view",void 0);g([p.property({dependsOn:["view.width"]})],b.prototype,"width",null);return b=g([p.subclass("esri.views.ui.UI")],b)}(p.declared(b,a))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(m,f,
k,e,g,d,h,c,b,a){return function(c){function f(a){a=c.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=g.widgetLabel;a.view=null;a.viewModel=new b;return a}k(f,c);f.prototype.postInitialize=function(){var a=this;this.own(d.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(f.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});f.prototype.render=function(){var b,c=(b={},b["esri-attribution--open"]=this._isOpen,b);return a.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",c),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),a.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",a.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:this.classes("esri-attribution__link",
"esri-widget__anchor")},"Esri")))};f.prototype._renderSourcesNode=function(){var b,c=this._isOpen,d=this._isInteractive(),e=d?0:-1,g=this.attributionText,f=d?"button":void 0,c=(b={},b["esri-attribution__sources--open"]=c,b["esri-interactive"]=d,b);return a.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",c),innerHTML:g,role:f,tabIndex:e})};f.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};f.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};f.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};f.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
e([h.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),a.renderable()],f.prototype,"attributionText",null);e([h.property()],f.prototype,"iconClass",void 0);e([h.property(),a.renderable()],f.prototype,"itemDelimiter",void 0);e([h.property()],f.prototype,"label",void 0);e([h.aliasOf("viewModel.view")],f.prototype,"view",void 0);e([h.property({type:b}),a.renderable(["state","view.size"])],f.prototype,"viewModel",void 0);e([a.accessibleHandler()],f.prototype,"_toggleState",
null);return f=e([h.subclass("esri.widgets.Attribution")],f)}(h.declared(c))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n){return function(d){function f(a){a=
d.call(this,a)||this;a._handles=new c;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new h;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}k(f,d);f.prototype.initialize=function(){this._handles.add(b.init(this,"view",this._viewWatcher))};f.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,
configurable:!0});f.prototype._viewWatcher=function(a){var c=this,d=this._handles;d&&d.remove();a&&(d.add([a.allLayerViews.on("change",function(a){c._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){d.remove(a.uid)}),c._updateAttributionItems())}),b.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};f.prototype._addLayerViews=function(a){var c=this;a.forEach(function(a){c._handles.has(a.uid)||c._handles.add(b.init(a,"suspended",c._updateAttributionItems),
a.uid)})};f.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(!d.hasAttributionData){if(c=d.get("copyright")){var e=a._findItem(b,{layer:d,text:c});e||b.push({text:c,layer:d})}}else if(d&&d.tileInfo){var g=a._attributionDataByLayerId;if(g[d.uid]){if(c=a._getDynamicAttribution(g[d.uid],a.view,d))(e=a._findItem(b,{layer:d,text:c}))||b.push({text:c,layer:d})}else{var f=a._pendingAttributionItemsByLayerId;a._inProgress(f[d.uid])||
(f[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete f[d.uid];g[d.uid]=b;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};f.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};f.prototype._inProgress=function(a){return a&&!a.isFulfilled()};f.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&
a.get("layer.attributionVisible")})};f.prototype._findItem=function(a,b){var c=b.layer,d=b.text,e;a.some(function(a){var b=a.layer===c&&a.text===d;b&&(e=a);return b});return e};f.prototype._isBingLayer=function(a){return"bing-maps"===a.type};f.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var h=0;h<f.length;h++)for(var l=f[h],k=l.bbox,m=l.zoomMin-(b&&l.zoomMin?1:0),p=l.zoomMax-(b&&
l.zoomMax?1:0),l={extent:n.geographicToWebMercator({xmin:k[1],ymin:k[0],xmax:k[3],ymax:k[2],spatialReference:g.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=l.score?l.score:100,id:d};m<=p;m++)c[m]=c[m]||[],c[m].push(l)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};f.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=n.project(d.center.clone().normalize(),
b.spatialReference),g={};return a.filter(function(a){var b=!g[a.id]&&e&&l.extentContainsPoint(a.extent,e);b&&(g[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};e([a.property({readOnly:!0,type:h})],f.prototype,"items",void 0);e([a.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"state",null);e([a.property()],f.prototype,"view",void 0);return f=e([a.subclass("esri.widgets.Attribution.AttributionViewModel")],
f)}(a.declared(d))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),function(m,f,k,e,g,d,h,c,b){return function(a){function f(b){b=a.call(this)||this;b.goToOverride=null;b.iconClass="esri-icon-locate-circled";b.label=g.widgetLabel;b.view=null;b.viewModel=new c;return b}k(f,a);f.prototype.reset=
function(){};f.prototype.render=function(){var a,c,d=this.viewModel,e=d.orientation,d=d.state,f="disabled"===d,h="compass"===("rotation"===d?"rotation":"compass"),d=f?-1:0,f=(a={},a["esri-disabled"]=f,a["esri-interactive"]=!f,a);a=(c={},c["esri-icon-compass"]=h,c["esri-icon-dial"]=!h,c);return b.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",f),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:d,"aria-label":g.reset,title:g.reset},b.tsx("span",
{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(e)}),b.tsx("span",{class:"esri-icon-font-fallback-text"},g.reset))};f.prototype._reset=function(){this.viewModel.reset()};f.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};e([d.aliasOf("viewModel.goToOverride")],f.prototype,"goToOverride",void 0);e([d.property()],f.prototype,"iconClass",void 0);e([d.property()],f.prototype,"label",void 0);e([d.aliasOf("viewModel.view")],
f.prototype,"view",void 0);e([d.property({type:c}),b.renderable(["viewModel.orientation","viewModel.state"])],f.prototype,"viewModel",void 0);e([d.aliasOf("viewModel.reset")],f.prototype,"reset",null);e([b.accessibleHandler()],f.prototype,"_reset",null);return f=e([d.subclass("esri.widgets.Compass")],f)}(d.declared(h))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function b(b){b=a.call(this,b)||this;b._handles=new d;b.orientation={x:0,y:0,z:0};b.view=null;b._updateForCamera=b._updateForCamera.bind(b);b._updateForRotation=b._updateForRotation.bind(b);b._updateRotationWatcher=b._updateRotationWatcher.bind(b);return b}k(b,a);b.prototype.initialize=function(){this._handles.add(h.init(this,"view",this._updateRotationWatcher))};b.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(b.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});b.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};b.prototype._updateForRotation=function(a){void 0!==
a&&null!==a&&(this.orientation={z:a})};b.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};b.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(h.init(this,"view.rotation",this._updateForRotation)):this._handles.add(h.init(this,"view.camera",this._updateForCamera)))};e([c.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],b.prototype,"canShowNorth",null);
e([c.property()],b.prototype,"orientation",void 0);e([c.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],b.prototype,"state",null);e([c.property()],b.prototype,"view",void 0);e([c.property()],b.prototype,"reset",null);return b=e([c.subclass("esri.widgets.CompassViewModel")],b)}(c.declared(g,b))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function f(b){b=a.call(this)||this;b.iconClass="esri-icon-pan2";b.label=g.widgetLabel;b.view=null;b.viewModel=new c;return b}k(f,a);Object.defineProperty(f.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});f.prototype.toggle=function(){};f.prototype.render=function(){var a,c,d,e="disabled"===this.get("viewModel.state"),f="pan"===this.get("viewModel.navigationMode"),h=(a={},a["esri-disabled"]=
e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(c={},c["esri-navigation-toggle__button--active"]=f,c);c=(d={},d["esri-navigation-toggle__button--active"]=!f,d);d=e?-1:0;return b.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",h),onclick:this._toggle,onkeydown:this._toggle,tabIndex:d,"aria-label":g.toggle,title:g.toggle},b.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},b.tsx("span",{class:"esri-icon-pan"})),b.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",c)},b.tsx("span",{class:"esri-icon-rotate"})))};f.prototype._toggle=function(){this.toggle()};e([d.property()],f.prototype,"iconClass",void 0);e([d.property()],f.prototype,"label",void 0);e([d.property({value:"vertical"}),b.renderable()],f.prototype,"layout",null);e([d.aliasOf("viewModel.view"),b.renderable()],f.prototype,"view",void 0);
e([d.property({type:c}),b.renderable(["viewModel.state","viewModel.navigationMode"])],f.prototype,"viewModel",void 0);e([d.aliasOf("viewModel.toggle")],f.prototype,"toggle",null);e([b.accessibleHandler()],f.prototype,"_toggle",null);return f=e([d.subclass("esri.widgets.NavigationToggle")],f)}(d.declared(h))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this,a)||this;a._handles=new d;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}k(a,b);a.prototype.initialize=function(){this._handles.add(h.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};a.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(a.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});a.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};a.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};e([c.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);e([c.property()],a.prototype,"navigationMode",void 0);e([c.property()],a.prototype,"view",void 0);
e([c.property()],a.prototype,"toggle",null);return a=e([c.subclass("esri.widgets.NavigationToggleViewModel")],a)}(c.declared(g))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(m,f,k,e,g,d,h,c,b,a){return function(f){function h(a){a=f.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";
a.label=g.widgetLabel;a.view=null;a.viewModel=new b;return a}k(h,f);h.prototype.postInitialize=function(){this._zoomInButton=new c({action:this.zoomIn,iconClass:"esri-icon-plus",title:g.zoomIn});this._zoomOutButton=new c({action:this.zoomOut,iconClass:"esri-icon-minus",title:g.zoomOut})};Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});h.prototype.render=function(){var b,c=this.viewModel,d=(b={},b["esri-zoom--horizontal"]=
"horizontal"===this.layout,b);this._zoomInButton.enabled="ready"===c.state&&c.canZoomIn;this._zoomOutButton.enabled="ready"===c.state&&c.canZoomOut;return a.tsx("div",{class:this.classes("esri-zoom esri-widget",d)},this._zoomInButton.render(),this._zoomOutButton.render())};h.prototype.zoomIn=function(){};h.prototype.zoomOut=function(){};e([d.property()],h.prototype,"iconClass",void 0);e([d.property()],h.prototype,"label",void 0);e([d.property({value:"vertical"}),a.renderable()],h.prototype,"layout",
null);e([d.aliasOf("viewModel.view"),a.renderable()],h.prototype,"view",void 0);e([d.property({type:b}),a.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],h.prototype,"viewModel",void 0);e([d.aliasOf("viewModel.zoomIn")],h.prototype,"zoomIn",null);e([d.aliasOf("viewModel.zoomOut")],h.prototype,"zoomOut",null);return h=e([d.subclass("esri.widgets.Zoom")],h)}(d.declared(h))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}k(b,c);b.prototype.render=function(){var a,b,c=this.enabled?0:-1,d=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return h.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",d),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:c,
title:this.title},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),h.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};b.prototype._triggerAction=function(){this.action.call(this)};e([g.property()],b.prototype,"action",void 0);e([g.property(),h.renderable()],b.prototype,"enabled",void 0);e([g.property({readOnly:!1}),h.renderable()],b.prototype,"iconClass",void 0);e([g.property(),h.renderable()],b.prototype,"title",void 0);e([h.accessibleHandler()],
b.prototype,"_triggerAction",null);return b=e([g.subclass("esri.widgets.IconButton")],b)}(g.declared(d))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}k(a,b);a.prototype.destroy=function(){this.view=null};Object.defineProperty(a.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new h({view:a}):"3d"===a.type&&(this._zoomConditions=new c):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});a.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};a.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};a.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};e([d.property()],a.prototype,"_zoomConditions",void 0);e([d.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],a.prototype,"canZoomIn",void 0);e([d.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],a.prototype,"canZoomOut",
void 0);e([d.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);e([d.property()],a.prototype,"view",null);e([d.property()],a.prototype,"zoomIn",null);e([d.property()],a.prototype,"zoomOut",null);return a=e([d.subclass("esri.widgets.Zoom.ZoomViewModel")],a)}(d.declared(g))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){return function(g){function c(){return null!==g&&g.apply(this,arguments)||this}k(c,g);Object.defineProperty(c.prototype,"canZoomIn",{get:function(){var b=this.get("view.animation.target.scale")||this.get("view.scale"),a=this.get("view.constraints.effectiveMaxScale");return 0===a||b>a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canZoomOut",{get:function(){var b=this.get("view.animation.target.scale")||this.get("view.scale"),a=this.get("view.constraints.effectiveMinScale");
return 0===a||b<a},enumerable:!0,configurable:!0});e([d.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],c.prototype,"canZoomIn",null);e([d.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],c.prototype,"canZoomOut",null);e([d.property()],c.prototype,"view",void 0);return c=e([d.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)}(d.declared(g))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){return function(g){function c(){var b=null!==g&&g.apply(this,arguments)||this;b.canZoomIn=!0;b.canZoomOut=!0;return b}k(c,g);e([d.property({readOnly:!0})],c.prototype,"canZoomIn",void 0);e([d.property({readOnly:!0})],c.prototype,"canZoomOut",void 0);return c=e([d.subclass("esri.widgets.Zoom.ZoomConditions3D")],c)}(d.declared(g))})},"webSceneViewer/Scene":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/Basemap esri/WebScene esri/request esri/core/Collection esri/core/promiseUtils esri/core/Error esri/core/Handles esri/core/CollectionFlattener esri/geometry/Extent esri/geometry/SpatialReference esri/geometry/support/webMercatorUtils esri/layers/Layer esri/layers/SceneLayer esri/layers/FeatureLayer esri/portal/PortalItem dojo/i18n!webSceneViewer/nls/viewer ./support/layerUtils ./support/errorUtils ./support/popupUtils ./support/persistedSettingsUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){return function(f){function m(a){var c=f.call(this,a)||this;c.prioritySpatialReferenceLayers=new b;c.hasUnsavedChanges=!1;c.allOperationalLikeLayers=new p({root:c,rootCollectionNames:["ground.layers","layers"],getChildrenFunction:function(a){return a.layers}});c.initialLayerState={visibility:{},basemap:null};c.saveInitialLayerState=!1;c.layerHandles=new n;null==c.customGroundLayers&&(c.customGroundLayers=new Set);c.when(function(){c.allLayers.forEach(function(a){a.isInstanceOf(x)&&
(a.outFields=["*"])});c.copyInitialLayerState()});return c}k(m,f);E=m;Object.defineProperty(m.prototype,"ground",{set:function(a){var b=this;this._groundBeforeAddHandle&&(this._groundBeforeAddHandle.remove(),this._groundBeforeAddHandle=null);null==this.customGroundLayers&&(this.customGroundLayers=new Set);if(a){if(a.loaded){var c=this.ground;c&&c.loaded&&a.layers.length===c.layers.length&&a.layers.every(function(a){return-1!==c.layers.indexOf(a)})||console.error("Setting loaded ground should not change ground layers to preserve the default ground layer contract")}else this.customGroundLayers.clear(),
a.layers.forEach(function(a){return b.defaultGroundLayerAdded(a)});this._groundBeforeAddHandle=a.layers.on("before-add",function(c){c=c.item;a.loaded?b.customGroundLayerAdded(c):b.defaultGroundLayerAdded(c)})}else this.customGroundLayers.clear();this._set("ground",a)},enumerable:!0,configurable:!0});m.prototype.initialize=function(){var a=this;this.allLayers.on("change",function(){return a.layersChanged()});this.layersChanged()};m.prototype.destroy=function(){this.layerHandles.removeAll();this.allOperationalLikeLayers.destroy()};
Object.defineProperty(m.prototype,"appVersion",{set:function(a){this.authoringApp=a?a.appName:"";this.authoringAppVersion=a?a.versionString:"";this._set("appVersion",a)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"isLocked",{get:function(){return this.isLockedIgnoringLayers()},enumerable:!0,configurable:!0});m.prototype.isLockedIgnoringLayers=function(a){var b=this,c=y.explodeGroupLayers(this.layers);return null!=this.initialViewProperties.spatialReference||0<this.presentation.slides.length||
c.some(function(b){return!y.isInternalLayer(b)&&!(a&&-1!==a.indexOf(b))})||this.ground.layers.some(function(c){return b.isCustomGroundLayer(c)&&!(a&&-1!==a.indexOf(c))})};m.prototype.isDefaultGroundLayer=function(a){return!this.isCustomGroundLayer(a)};m.prototype.isCustomGroundLayer=function(a){return this.customGroundLayers.has(a.uid)};m.prototype.cloneEmpty=function(){return new E({appVersion:this.appVersion,portalItem:this.portalItem,basemap:null,thumbnailUrl:this.portalItem&&this.thumbnailUrl===
this.portalItem.thumbnailUrl?null:this.thumbnailUrl})};m.prototype.importFromScene=function(a){var b=this,c=a.ground.layers.filter(function(b){return a.isCustomGroundLayer(b)}),d=c.concat(y.explodeGroupLayers(a.layers,!0)),e=E.ensureUniqueItemIds(d,this.allLayers,/(.*-layer)(\d+)$/),g=this.ground.layers.filter(function(a){return b.isDefaultGroundLayer(a)});a.ground.layers.forEach(function(a){e[a.id]=g.length?g.getItemAt(0).id:null});E.ensureUniqueItemIds(a.presentation.slides,this.presentation.slides,
/(slide_)(\d+)$/);a.presentation.slides.forEach(function(a){a.visibleLayers.forEach(function(a){a.id in e&&(a.id=e[a.id])});a.visibleLayers=a.visibleLayers.filter(function(a){return!!a.id})});this.layers.addMany(a.layers);this.ground.layers.addMany(c);this.presentation.slides.addMany(a.presentation.slides);a.allOperationalLikeLayers.forEach(function(a){b.initialLayerState.visibility[a.id]=a.visible});return{layers:d,slides:a.presentation.slides}};m.prototype.verifyWriteLayer=function(a){return this.inherited(arguments)&&
!y.isInternalLayer(a)};m.createDefault=function(b){return(b.portal?b.portal.load():a.resolve(b.portal)).then(function(){var c=E.defaultSceneProperties(b);c.portalItem.title=b.title||z.defaultWebSceneName;c.basemap=E.createDefaultBasemap(b.portal);c.ground=y.createDefaultGround(b.portal);c.initialViewProperties=E.createDefaultViewProperties(b);c=new E(c);return a.resolve({scene:c,isDefault:!0,layers:[]})})};m.createFromPortal=function(b){if(!b.portal)return a.reject(new l("wsv-scene:load-requires-portal",
"Loading a scene by item requires a portal"));var c=E.defaultSceneProperties(b);c.portalItem.id=b.id;var d=new E(c);return d.load().then(function(){b.portal.user?C.setRecentScene(b.portal.user.username,d.portalItem):C.setRecentScene(void 0,d.portalItem);return{scene:d,isDefault:!1,warningsToConsole:!0}})};m.createFromUrl=function(a){return c(a.url).then(function(b){b=E.fromJSON(b.data);var c=E.defaultSceneProperties(a);c.portalItem.title=a.title||z.defaultWebSceneName;b.set(c);return b.load()}).then(function(a){return{scene:a,
isDefault:!1,warningsToConsole:!0}})};m.createWithLayersFromPortal=function(b){var c=b.portal,d=b.layerIds.map(function(b){return c?w.fromPortalItem({portalItem:new v({id:b,portal:c})}):a.reject(new l("wsv-scene:layer-load-requires-portal","Loading layers by item requires a portal"))});return a.eachAlways(d).then(function(a){a=a.filter(function(a,c){if(a.error&&b.onError)b.onError(new l("wsv-scene:load-invalid-layer-item","Invalid layer item: ${id}, ${error}",{id:b.layerIds[c],error:a.error}));return!!a.value}).map(function(a){return a.value});
return E.createWithLayers({layers:a,appVersion:b.appVersion,onError:b.onError,portal:b.portal})})};m.createWithLayerFromUrl=function(a){return w.fromArcGISServerUrl({url:a.url}).catch(function(b){a.onError&&a.onError(new l("wsv-scene:load-invalid-layer-url","Invalid layer url: ${url}, ${error}",{url:a.url,error:b}))}).then(function(b){return E.createWithLayers({layers:b?[b]:[],appVersion:a.appVersion,onError:a.onError,portal:a.portal})})};m.createFromAppState=function(a){var b=a.urlParameters,c=a.portal,
d=a.appVersion,e=function(b){a.errors.error(A.layerAddError(b.details&&b.details.layer||null,b))};b.webscene?(b=b.webscene,c=/https?:/.test(b)?E.createFromUrl({url:b,appVersion:d,onError:e,portal:c}):E.createFromPortal({id:b,appVersion:d,onError:e,portal:c})):c=b.url?E.createWithLayerFromUrl({url:b.url,appVersion:d,onError:e,portal:c}):b.layers&&b.layers.length?E.createWithLayersFromPortal({layerIds:b.layers,appVersion:d,onError:e,portal:c}):E.createDefault({appVersion:d,onError:e,portal:c,viewingMode:b.viewingmode});
return c};m.prototype.updateThumbnailFrom=function(a,b){var c=this;return this.createThumbnailFrom(a).then(function(a){c.thumbnailUrl=a;b&&(c.hasUnsavedChanges=!0)})};m.prototype.createThumbnailFrom=function(a){return a.when(function(){return a.takeScreenshot({format:"jpg",width:600,height:400})}).then(function(a){return a.dataUrl})};m.fromJSON=function(a){return h.fromJSON.call(E,a)};m.prototype.read=function(a,b){var c=this;this.inherited(arguments);this.correctOldSeeThrough(this,a);a.presentation&&
a.presentation.slides&&a.presentation.slides.forEach(function(a){var b=c.presentation.slides.find(function(b){return b.id===a.id});b&&c.correctOldSeeThrough(b,a)});return this};m.prototype.defaultGroundLayerAdded=function(a){this.customGroundLayers.delete(a.uid);a.__accessor__.store.set("listMode","hide",0)};m.prototype.customGroundLayerAdded=function(a){this.customGroundLayers.add(a.uid)};m.prototype.layersChanged=function(){this.updateDynamicPopups();this.notifyChange("isLocked")};m.prototype.updateDynamicPopups=
function(){var a=this;this.layerHandles.remove("popupEnabledWatches");this.allLayers.forEach(function(b){a.canSupportPopups(b)&&(a.layerHandles.add(b.watch(["popupEnabled","loaded","popupTemplate"],function(){return a.updateDynamicPopup(b)}),"popupEnabledWatches"),a.updateDynamicPopup(b))})};m.prototype.canSupportPopups=function(a){return"popupTemplate"in a&&"popupEnabled"in a?!0:!1};m.prototype.doesSupportPopups=function(a){return this.canSupportPopups(a)?a.isInstanceOf(u)?!(!a.associatedLayer&&
!a.attributeStorageInfo):!0:!1};m.prototype.updateDynamicPopup=function(a){a.loaded&&a.originOf&&(!a.popupTemplate||"user"===a.originOf("popupTemplate"))&&this.doesSupportPopups(a)&&(a.popupEnabled&&!a.popupTemplate?a.popupTemplate=B.createDefaultPopupTemplate(a):a.popupEnabled||(a.popupTemplate=null))};m.prototype.copyInitialLayerState=function(){var a=this;this.initialLayerState.visibility={};this.allOperationalLikeLayers.forEach(function(b){a.initialLayerState.visibility[b.id]=b.visible});this.initialLayerState.basemap=
this.basemap?this.basemap.clone():null};m.prototype.updateLayerJSONVisibility=function(a){a.visibility=!!this.initialLayerState.visibility[a.id];a.layers&&a.layers.forEach(this.updateLayerJSONVisibility.bind(this))};m.createWithLayers=function(a){var b={scene:null,isDefault:!0,layers:[]};return this.createDefault(a).then(function(c){b.scene=c.scene;c=y.validateLayers(a.layers,{context:"operational"});a.onError&&c.errors.forEach(function(b){b.details.layer.load().always(function(){return a.onError(b)})});
b.scene.prioritySpatialReferenceLayers.addMany(c.layers);y.add(b.scene,c.layers);b.layers=c.layers;return b})};m.createDefaultBasemap=function(a){return a?a.useVectorBasemaps?a.defaultVectorBasemap?a.defaultVectorBasemap.clone():null:a.defaultBasemap?a.defaultBasemap.clone():null:d.fromId("topo")};m.prototype.resetDefaultGround=function(a){a=y.createDefaultGround(a);y.cloneGroundProperties(a,this.ground);this.ground=a};m.createDefaultViewProperties=function(a){var b={},c=a.portal;if(a=a.viewingMode)b.viewingMode=
a;if(!c||!c.defaultExtent)return b;var c=c.defaultExtent.clone(),d=c.spatialReference;(d.isWebMercator||d.isWGS84)&&"local"!==a&&(a=t.project(c.center,r.WebMercator),c=new q({xmin:-43E5,xmax:43E5,ymin:-43E5,ymax:43E5,spatialReference:r.WebMercator}),c.centerAt(a));b.viewpoint={targetGeometry:c};return b};m.defaultSceneProperties=function(a){return{portalItem:new v({portal:a.portal}),appVersion:a.appVersion}};m.ensureUniqueItemIds=function(a,b,c){var d={},e=[];a.forEach(function(a){var g=a.id;if(b.find(function(a){return a.id===
g})||-1!==e.indexOf(g)){var f=void 0,h=void 0;(h=g.match(c))?(f=h[1],h=parseInt(h[2],10)):(f=g+"-",h=0);for(var l=f+h.toString();b.find(function(a){return a.id===l})||-1!==e.indexOf(l);)h++,l=f+h.toString();a.id=l;e.push(l);d[g]=l}else d[g]=g});return d};m.prototype.write=function(a,b){var c=this.inherited(arguments);this.saveInitialLayerState||this.restoreOriginalInitialState(c,b);return c};m.prototype.restoreOriginalInitialState=function(a,b){var c=this;a&&a.operationalLayers&&a.operationalLayers.forEach(function(a){return c.updateLayerJSONVisibility(a)});
a.ground&&a.ground.layers&&a.ground.layers.forEach(function(a){return c.updateLayerJSONVisibility(a)});var d=a.baseMap&&a.baseMap.elevationLayers;this.initialLayerState.basemap?(a.baseMap=this.initialLayerState.basemap.write({},b),d&&(a.baseMap.elevationLayers=d)):d?a.baseMap={elevationLayers:d}:delete a.baseMap};m.prototype.correctOldSeeThrough=function(a,b){this.sourceVersion&&1===this.sourceVersion.major&&11>this.sourceVersion.minor&&(b=b.baseMap&&null!=b.baseMap.transparency&&0!==b.baseMap.transparency,
a.ground||(a.ground={}),a.ground.opacity=b?E.SEETHROUGH_OPACITY:1)};var E;m.SEETHROUGH_OPACITY=.6;e([g.property()],m.prototype,"ground",null);e([g.property({type:b})],m.prototype,"prioritySpatialReferenceLayers",void 0);e([g.property()],m.prototype,"appVersion",null);e([g.property({json:{read:!1}})],m.prototype,"authoringApp",void 0);e([g.property({json:{read:!1}})],m.prototype,"authoringAppVersion",void 0);e([g.property()],m.prototype,"hasUnsavedChanges",void 0);e([g.property({readOnly:!0})],m.prototype,
"allOperationalLikeLayers",void 0);e([g.property({readOnly:!0,dependsOn:["portalItem.id","presentation.slides.length"]})],m.prototype,"isLocked",null);e([g.property()],m.prototype,"initialLayerState",void 0);e([g.property()],m.prototype,"saveInitialLayerState",void 0);return m=E=e([g.subclass("webSceneViewer.Scene")],m)}(g.declared(h))})},"esri/Basemap":function(){define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/asyncUtils ./core/Collection ./core/collectionUtils ./core/Evented ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./layers/Layer ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){var y=0,A=h.ofType(u),B=q.getLogger("esri.Basemap");return function(a){function b(b){var c=a.call(this)||this;c.id=null;c.portalItem=null;c.thumbnailUrl=null;c.title="Basemap";c.id=Date.now().toString(16)+"-basemap-"+y++;c.baseLayers=new A;c.referenceLayers=new A;var d=function(a){a.parent&&a.parent!==c&&"remove"in a.parent&&a.parent.remove(a);a.parent=c;"elevation"===a.type&&B.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as a basemap layer and will therefore be ignored.")};
c.baseLayers.on("after-add",function(a){return d(a.item)});c.referenceLayers.on("after-add",function(a){return d(a.item)});c.baseLayers.on("after-remove",function(a){a.item.parent=null});c.referenceLayers.on("after-remove",function(a){a.item.parent=null});return c}e(b,a);f=b;b.prototype.initialize=function(){var a=this;this.when().catch(function(b){B.error("#load()","Failed to load basemap (title: '"+a.title+"', id: '"+a.id+"')",b)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};
b.prototype.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a=k({},a),delete a.resourceInfo);return a};Object.defineProperty(b.prototype,"baseLayers",{set:function(a){this._set("baseLayers",c.referenceSetter(a,this._get("baseLayers"),A))},enumerable:!0,configurable:!0});b.prototype.writeBaseLayers=function(a,b,c,d){var e=[];a&&(d=k({},d,{layerContainerType:"basemap"}),this.baseLayers.forEach(function(a){if(a.write){var b={};a.write(b,d)&&e.push(b)}}),
this.referenceLayers.forEach(function(a){if(a.write){var b={isReference:!0};a.write(b,d)&&e.push(b)}}));b[c]=e};Object.defineProperty(b.prototype,"referenceLayers",{set:function(a){this._set("referenceLayers",c.referenceSetter(a,this._get("referenceLayers"),A))},enumerable:!0,configurable:!0});b.prototype.writeTitle=function(a,b){b.title=a||"Basemap"};b.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this.when()};b.prototype.loadAll=function(){var a=this;return d.safeCast(p.loadAll(this,
function(b){b(a.baseLayers,a.referenceLayers)}))};b.prototype.clone=function(){var a={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};this.loaded&&(a.loadStatus="loaded");return(new f({resourceInfo:this.resourceInfo})).set(a)};b.prototype.read=function(a,b){this.resourceInfo||this._set("resourceInfo",{data:a,context:b});return this.inherited(arguments)};b.prototype.write=function(a,b){a=a||{};b&&b.origin||(b=k({origin:"web-map"},
b));this.inherited(arguments,[a,b]);!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(a.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(function(a){a=l.clone(a);a.url&&t.isProtocolRelative(a.url)&&(a.url="https:"+a.url);a.templateUrl&&t.isProtocolRelative(a.templateUrl)&&(a.templateUrl="https:"+a.templateUrl);return a}));return a};b.prototype._loadFromSource=function(){var a=this.resourceInfo,b=this.portalItem;return a?this._loadLayersFromJSON(a.data,a.context?a.context.url:
null):b?this._loadFromItem(b):r.resolve(null)};b.prototype._loadLayersFromJSON=function(a,b){var c=this,d=this.resourceInfo&&this.resourceInfo.context,e=this.portalItem&&this.portalItem.portal||d&&d.portal||null,g=d&&"web-scene"===d.origin?"web-scene":"web-map";return r.create(function(a){return m(["./portal/support/layersCreator"],a)}).then(function(d){var f=[];if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){var h={context:{origin:g,url:b,portal:e,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},
l=d.populateOperationalLayers(c.baseLayers,a.baseMapLayers.filter(function(a){return!a.isReference}),h);f.push.apply(f,l);d=d.populateOperationalLayers(c.referenceLayers,a.baseMapLayers.filter(function(a){return a.isReference}),h);f.push.apply(f,d)}return r.eachAlways(f)}).then(function(){})};b.prototype._loadFromItem=function(a){var b=this;return a.load().then(function(a){return a.fetchData()}).then(function(c){var d=t.urlToObject(a.itemUrl);b._set("resourceInfo",{data:c.baseMap,context:{origin:"web-map",
portal:a.portal||x.getDefault(),url:d}});b.read(b.resourceInfo.data,b.resourceInfo.context);b.read({title:a.title,thumbnailUrl:a.thumbnailUrl},{origin:"portal-item",portal:a.portal||x.getDefault(),url:d});return b._loadLayersFromJSON(b.resourceInfo.data,d)})};b.fromId=function(a){return(a=z[a])?f.fromJSON(a):null};var f;g([w.property({type:A,json:{write:{ignoreOrigin:!0,target:"baseMapLayers"}}}),w.cast(c.castForReferenceSetter)],b.prototype,"baseLayers",null);g([w.writer("baseLayers")],b.prototype,
"writeBaseLayers",null);g([w.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],b.prototype,"id",void 0);g([w.property({type:v})],b.prototype,"portalItem",void 0);g([w.property({type:A}),w.cast(c.castForReferenceSetter)],b.prototype,"referenceLayers",null);g([w.property({readOnly:!0})],b.prototype,"resourceInfo",void 0);g([w.property()],b.prototype,"thumbnailUrl",void 0);g([w.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],b.prototype,"title",void 0);g([w.writer("title")],
b.prototype,"writeTitle",null);return b=f=g([w.subclass("esri.Basemap")],b)}(w.declared(a,b,n))})},"esri/WebScene":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O,J,Q,H,K,R,P){var L=z.getLogger("esri.WebScene"),T=new P.default(1,12),S={width:600,height:400};return function(a){function f(b){b=a.call(this)||this;b._handles=new r;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.presentation=null;b.initialViewProperties=null;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=
null;b._isAuthoringAppSetByUser=!1;b._isAuthoringAppVersionSetByUser=!1;return b}k(f,a);f.prototype.initialize=function(){var a=this;this.when().catch(function(a){L.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(U){this.addResolvingPromise(y.reject(U));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};f.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};f.prototype.getDefaults=function(a){return d({},this.inherited(arguments),{presentation:{},initialViewProperties:{}})};f.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};f.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};f.prototype.writeClippingEnabled=function(a,
b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};f.prototype.writeLayers=function(a,b,c,e){var g=this,f=d({},e,{layerContainerType:"operational-layers"});a=a.filter(function(a){return g.verifyWriteLayer(a,f)}).map(function(a){return a.write(null,f)}).filter(function(a){return!!a});b[c]=a.toArray()};f.prototype.verifyWriteLayer=function(a,b){return a.write?!0:(b&&b.messages&&b.messages.push(new q("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+
"' cannot be persisted in web scenes",{layer:a})),!1)};f.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new P.default(parseInt(a[0],10),parseInt(b,10))};f.prototype.writeSourceVersion=function(a,b,c){b[c]=T.major+"."+T.minor};Object.defineProperty(f.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});f.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(f.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});f.prototype.writeAuthoringAppVersion=
function(a,c){c.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:b.version};f.prototype.writeGround=function(a,b,c,d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};f.prototype.readInitialViewProperties=function(a,b){a={};b.initialState&&b.initialState.environment&&(a.environment=H.fromJSON(b.initialState.environment));b.spatialReference&&(a.spatialReference=M.fromJSON(b.spatialReference));a.viewingMode=b.viewingMode||"global";b.initialState&&b.initialState.viewpoint&&(a.viewpoint=
l.fromJSON(b.initialState.viewpoint));return new K(a)};f.prototype.writeInitialViewProperties=function(a,b,c,d){a&&(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):M.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};f.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());
return this.when()};f.prototype.loadAll=function(){var a=this;return n.safeCast(v.default(this,function(b){var c=a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))}))};f.prototype.read=function(a,b){var c=this;b=d({},b,{origin:"web-scene"});var e=this._isAuthoringAppVersionSetByUser,g=this._isAuthoringAppSetByUser,f=arguments;E.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b);g||(this._isAuthoringAppSetByUser=!1);e||(this._isAuthoringAppVersionSetByUser=
!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var e=a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),h=this.presentation.slides,l=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},k=e.filter(function(a){return!h.some(function(b){return l(b,a.id)})});h.forEach(function(a){a.visibleLayers.addMany(k)})}return this};f.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;
!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=u.clone(b))};f.prototype.write=function(a,b){if("loaded"!==this.loadStatus){var c=new q("webscene:not-loaded","Web scene must be loaded before it can be serialized");L.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=d({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);
return c};f.prototype.save=function(a){return c(this,void 0,void 0,function(){var b,c,d;return h(this,function(e){switch(e.label){case 0:if(this.portalItem)return[3,2];L.error("save(): requires the .portalItem property to be set");return[4,y.reject(new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:e.sent(),e.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,y.reject(new q("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];
case 3:e.sent(),e.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return e.sent(),[4,this._loadObjectsWithLayers()];case 6:return e.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&A.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||G.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return e.sent(),this._updateTypeKeywords(this.portalItem),
[4,this.portalItem.update({data:d})];case 8:return e.sent(),C.updateOrigins(c),b?[4,b]:[3,10];case 9:e.sent(),e.label=10;case 10:return[4,this._saveThumbnail()];case 11:return e.sent(),[2,this.portalItem]}})})};f.prototype.saveAs=function(a,b){return c(this,void 0,void 0,function(){var c,d,e,g,f;return h(this,function(h){switch(h.label){case 0:if(a)return[3,2];L.error("saveAs(portalItem): requires a portal item parameter");return[4,y.reject(new q("webscene:portal-item-required","saveAs requires a portal item to save to"))];
case 1:h.sent(),h.label=2;case 2:return a.type&&"Web Scene"!==a.type||a.id?[4,y.reject(new q("webscene:portal-item-already-exists","WebScene can only saveAs to a new and empty portal item"))]:[3,4];case 3:h.sent(),h.label=4;case 4:return c=a.portal||G.getDefault(),[4,this.load()];case 5:return h.sent(),[4,this._loadObjectsWithLayers()];case 6:return h.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:c,writtenProperties:[],blockedRelativeUrls:[]}),e=this.write(null,
d),[4,this._verifySaveAs(e,d,b)];case 7:return h.sent(),[4,c._signIn()];case 8:return h.sent(),g=this.thumbnailUrl,f=!this._isOverridden("thumbnailUrl"),a.type="Web Scene",a.portal=c,this._updateTypeKeywords(a),[4,c.user.addItem({item:a,folder:b&&b.folder,data:e})];case 9:return h.sent(),this.portalItem=a,w.prototype.read.call(this,{version:e.version,authoringApp:e.authoringApp,authoringAppVersion:e.authoringAppVersion},{name:"web-scene",url:a.itemUrl&&A.urlToObject(a.itemUrl)}),C.updateOrigins(d),
g&&(this.thumbnailUrl=f?A.addQueryParameter(g,"w","8192"):g),[4,this._saveThumbnail()];case 10:return h.sent(),[2,a]}})})};f.prototype._saveThumbnail=function(){return c(this,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};f.prototype._verifySave=function(a,b,c,d){void 0===d&&
(d=!1);var e=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new q(a.name,a.message,a.details)});b.blockedRelativeUrls&&(e=e.concat(b.blockedRelativeUrls.map(function(a){return new q("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||
(e=e.filter(function(a){return"web-document-write:property-required"!==a.name}));var g=c&&c.strictSchemaValidationEnabled;return(g?y.create(function(a){return m(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");L.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new q("webscene:schema-validation",a)})}).then(function(a){return g&&0<a.length?(a=J.createSchemaValidationError(a.concat(e)),y.reject(a)):e}):
y.resolve(e)).then(function(a){if(0<a.length)return y.reject(new q("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};f.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?y.reject(J.createCopyError()):this._verifySave(a,b,c,!0)};f.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,
b,a)};f.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};f.prototype.updateFrom=function(a,b){void 0===b&&(b={});return c(this,void 0,void 0,function(){var c,d;return h(this,function(e){switch(e.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:e.sent();if(d=this._updateFromPromise===c)this._updateFromPromise=
null;return[2]}})})};f.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return c(this,void 0,void 0,function(){return h(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=H.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),
this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=
3;case 3:return[2]}})})};f.prototype._updateFromThumbnail=function(a,b){void 0===b&&(b=S);return c(this,void 0,void 0,function(){var c,d,e,g;return h(this,function(f){switch(f.label){case 0:return c=b.width,d=b.height,e=c/d,1.5>e?d=c/1.5:1.5<e&&(c=1.5*d),c>a.width&&(d*=a.width/c,c=a.width),d>a.height&&(c*=a.height/d,d=a.height),[4,a.takeScreenshot({format:"jpg",width:Math.round(c),height:Math.round(d)})];case 1:return g=f.sent(),this.thumbnailUrl=g.dataUrl,[2]}})})};f.prototype._loadFromSource=function(){return this.resourceInfo?
this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};f.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a,b&&b.url&&b.url.path);this.read(a,b);return this._loadFromJSON(a,b)};f.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);
var g=[],f=function(a){a.layers&&(a.layers=a.layers.filter(f));return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||g.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(f):[],operationalElevationLayers:g,basemapElevationLayers:c}};f.prototype._loadFromJSON=function(a,b){var c=this,e=new p;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return y.create(function(a){return m(["./portal/support/layersCreator"],
a)})}).then(function(g){var f=c._extractOperationalLayers(a),h=f.operationalLayers,l=f.operationalElevationLayers,f=f.basemapElevationLayers,k=[],m={context:d({},b,{layerContainerType:"operational-layers"})};c.portalItem&&(m.context.portal=c.portalItem.portal||G.getDefault());if(0<f.length){var n=d({},m,{context:d({},m.context,{layerContainerType:"ground"})});n.defaultLayerType="ArcGISTiledElevationServiceLayer";k.push.apply(k,g.populateOperationalLayers(c.ground.layers,f,n))}0<l.length&&(n=d({},
m,{context:d({},m.context,{layerContainerType:"ground"})}),n.defaultLayerType="ArcGISTiledElevationServiceLayer",k.push.apply(k,g.populateOperationalLayers(e,l,n)));h&&0<h.length&&k.push.apply(k,g.populateOperationalLayers(c.layers,h,m));return y.eachAlways(k).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(e)})};f.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());
this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())});return y.eachAlways(a).then(function(){})};f.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new q("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=
c;return b._readAndLoadFromJSON(c,{origin:"web-scene",url:A.urlToObject(a.itemUrl),portal:a.portal||G.getDefault()})})};f.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!b.isWGS84&&!b.isWebMercator)return y.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator or WGS84 GCS are supported",{spatialReference:b,viewingMode:a.viewingMode}));
c=function(a){return!a||a.isWGS84||a.isWebMercator}}else{if(b.isGeographic)return y.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},e=d(a.viewpoint);
return e&&!c(e)?y.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),y.reject(new q("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):y.resolve()};f.prototype._validateHeightModelInfo=function(){var a=N.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?y.reject(a):y.resolve()};f.prototype._validateJSON=function(a,b){void 0===b&&(b=null);a=this._sanitizeJSON(a,b);b=P.default.parse(a.version,"webscene");T.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=M.WebMercator.toJSON());return a};
f.prototype._sanitizeJSON=function(a,b){void 0===b&&(b=null);return{version:a.version||"",baseMap:a.baseMap,ground:a.ground,operationalLayers:a.operationalLayers,authoringApp:a.authoringApp||"",authoringAppVersion:a.authoringAppVersion||"",viewingMode:a.viewingMode||"global",presentation:a.presentation&&R.sanitizeJSON(a.presentation)||{},initialState:a.initialState,spatialReference:a.spatialReference||M.WebMercator.toJSON(),heightModelInfo:a.heightModelInfo||null,clippingArea:a.clippingArea,applicationProperties:a.applicationProperties}};
f.prototype._updateTypeKeywords=function(a){"local"===this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(f.prototype,
"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||M.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?A.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});f.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});
return a};f.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};f.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};f.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,
c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};f.fromJSON=function(a){if(!a)throw new q("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};f.VERSION=T;e([B.property({type:Q,json:{write:!0}})],f.prototype,
"applicationProperties",void 0);e([B.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],f.prototype,"basemap",void 0);e([B.property({type:D,json:{read:{source:"clippingArea.geometry",reader:I.fromJSON},write:{target:"clippingArea.geometry"}}})],f.prototype,"clippingArea",void 0);e([B.writer("clippingArea")],f.prototype,"writeClippingArea",null);e([B.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],f.prototype,"clippingEnabled",void 0);e([B.reader("clippingEnabled",
["clippingArea"])],f.prototype,"readClippingEnabled",null);e([B.writer("clippingEnabled")],f.prototype,"writeClippingEnabled",null);e([B.property({type:F,json:{write:!0}})],f.prototype,"heightModelInfo",void 0);e([B.property({json:{write:{target:"operationalLayers"}}})],f.prototype,"layers",void 0);e([B.writer("layers")],f.prototype,"writeLayers",null);e([B.property({readOnly:!0,type:P.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],f.prototype,"sourceVersion",void 0);
e([B.reader("sourceVersion",["version"])],f.prototype,"readSourceVersion",null);e([B.writer("sourceVersion")],f.prototype,"writeSourceVersion",null);e([B.property({dependsOn:["portalItem.thumbnailUrl"]})],f.prototype,"thumbnailUrl",null);e([B.property({type:String,json:{write:{allowNull:!0}}})],f.prototype,"authoringApp",null);e([B.writer("authoringApp")],f.prototype,"writeAuthoringApp",null);e([B.property({type:String,json:{write:{allowNull:!0}}})],f.prototype,"authoringAppVersion",null);e([B.writer("authoringAppVersion")],
f.prototype,"writeAuthoringAppVersion",null);e([B.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],f.prototype,"ground",void 0);e([B.writer("ground")],f.prototype,"writeGround",null);e([B.property({type:R,json:{write:function(a,b,c,e){a.slides&&0<a.slides.length&&(c=d({},e,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],f.prototype,"presentation",void 0);e([B.property({type:K})],f.prototype,"initialViewProperties",void 0);e([B.reader("initialViewProperties",["initialState.environment",
"spatialReference","viewingMode","initialState.viewpoint"])],f.prototype,"readInitialViewProperties",null);e([B.writer("initialViewProperties",{"initialState.environment":{type:H},spatialReference:{type:M},viewingMode:{type:String},"initialState.viewpoint":{type:l}})],f.prototype,"writeInitialViewProperties",null);e([B.property({type:O})],f.prototype,"portalItem",void 0);e([B.property()],f.prototype,"resourceInfo",void 0);e([g(0,B.cast(O))],f.prototype,"saveAs",null);e([B.property()],f.prototype,
"_sceneSpatialReference",null);e([B.property()],f.prototype,"_verifyItemRelativeRootPath",null);return f=e([B.subclass("esri.WebScene")],f)}(B.declared(a,x,w))})},"esri/Map":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./Basemap ./Ground ./core/Accessor ./core/CollectionFlattener ./core/Evented ./core/Logger ./core/accessorSupport/decorators ./support/basemapUtils ./support/groundUtils ./support/LayersMixin".split(" "),function(m,f,k,e,g,
d,h,c,b,a,l,n,p,q){var r=a.getLogger("esri.Map");return function(a){function b(b){b=a.call(this)||this;b.basemap=null;b.ground=new d;b._basemapCache=n.createCache();return b}k(b,a);Object.defineProperty(b.prototype,"allLayers",{get:function(){return new c({root:this,rootCollectionNames:["basemap.baseLayers","ground.layers","layers","basemap.referenceLayers"],getChildrenFunction:function(a){return a.layers}})},enumerable:!0,configurable:!0});b.prototype.castBasemap=function(a){return n.ensureType(a,
this._basemapCache)};b.prototype.castGround=function(a){a=p.ensureType(a);return a?a:(r.error("Map.ground may not be set to null or undefined"),this._get("ground"))};e([l.property({readOnly:!0})],b.prototype,"allLayers",null);e([l.property({type:g})],b.prototype,"basemap",void 0);e([l.cast("basemap")],b.prototype,"castBasemap",null);e([l.property({type:d})],b.prototype,"ground",void 0);e([l.cast("ground")],b.prototype,"castGround",null);return b=e([l.subclass("esri.Map")],b)}(l.declared(h,b,q))})},
"esri/Ground":function(){define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./Color ./core/asyncUtils ./core/Collection ./core/collectionUtils ./core/Error ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators ./ground/navigationConstraints ./layers/Layer ./layers/support/types ./webdoc/support/opacityUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,
n,p,q,r,t,w,u,x,v,z){var y=c.ofType(x),A=r.getLogger("esri.Ground");return function(c){function f(a){var b=c.call(this)||this;b.opacity=1;b.surfaceColor=null;b.navigationConstraint=null;b.layers=new y;b.layers.on("after-add",function(a){a=a.item;a.parent&&a.parent!==b&&"remove"in a.parent&&a.parent.remove(a);a.parent=b;v.isOfType(a,["elevation","base-elevation"])||A.error("Layer '"+a.title+", id:"+a.id+"' of type '"+a.type+"' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.")});
b.layers.on("after-remove",function(a){a.item.parent=null});return b}e(f,c);l=f;f.prototype.initialize=function(){this.when().catch(function(a){A.error("#load()","Failed to load ground",a)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};f.prototype.normalizeCtorArgs=function(a){a&&"resourceInfo"in a&&(this._set("resourceInfo",a.resourceInfo),a=k({},a),delete a.resourceInfo);return a};Object.defineProperty(f.prototype,"layers",{set:function(a){this._set("layers",b.referenceSetter(a,
this._get("layers"),y))},enumerable:!0,configurable:!0});f.prototype.writeLayers=function(b,c,d,e){var g=[];b&&(e=k({},e,{layerContainerType:"ground"}),b.forEach(function(b){if(b.write){var c={};b.write(c,e)&&g.push(c)}else e&&e.messages&&e.messages.push(new a("layer:unsupported","Layers ("+b.title+", "+b.id+") of type '"+b.declaredClass+"' cannot be persisted in the ground",{layer:b}))}));c.layers=g};f.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this.when()};
f.prototype.loadAll=function(){var a=this;return h.safeCast(q.loadAll(this,function(b){b(a.layers)}))};f.prototype.queryElevation=function(a,b){var c=this;return t.create(function(a){return m(["./layers/support/ElevationQuery"],a)}).then(function(d){d=new d.ElevationQuery;var e=c.layers.filter(function(a){return"elevation"===a.type}).toArray();return d.queryAll(e,a,b)})};f.prototype.createElevationSampler=function(a,b){var c=this;return t.create(function(a){return m(["./layers/support/ElevationQuery"],
a)}).then(function(d){d=new d.ElevationQuery;var e=c.layers.filter(function(a){return"elevation"===a.type}).toArray();return d.createSamplerAll(e,a,b)})};f.prototype.clone=function(){var a={opacity:this.opacity,surfaceColor:n.clone(this.surfaceColor),navigationConstraint:n.clone(this.navigationConstraint),layers:this.layers.slice()};this.loaded&&(a.loadStatus="loaded");return(new l({resourceInfo:this.resourceInfo})).set(a)};f.prototype.read=function(a,b){this.resourceInfo||this._set("resourceInfo",
{data:a,context:b});return this.inherited(arguments)};f.prototype._loadFromSource=function(){var a=this.resourceInfo;return a?this._loadLayersFromJSON(a.data,a.context):t.resolve(null)};f.prototype._loadLayersFromJSON=function(a,b){var c=this,d=b&&b.origin||"web-scene",e=b&&b.portal||null,g=b&&b.url||null;return t.create(function(a){return m(["./portal/support/layersCreator"],a)}).then(function(b){var f=[];a.layers&&Array.isArray(a.layers)&&f.push.apply(f,b.populateOperationalLayers(c.layers,a.layers,
{context:{origin:d,url:g,portal:e,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));return t.eachAlways(f)}).then(function(){})};var l;g([w.property({type:y,json:{read:!1}}),w.cast(b.castForReferenceSetter)],f.prototype,"layers",null);g([w.writer("layers")],f.prototype,"writeLayers",null);g([w.property({readOnly:!0})],f.prototype,"resourceInfo",void 0);g([w.property({type:Number,json:{read:{reader:z.transparencyToOpacity,source:"transparency"},write:{writer:function(a,
b){b.transparency=z.opacityToTransparency(a)},target:"transparency"}}})],f.prototype,"opacity",void 0);g([w.property({type:d,json:{write:function(a,b){b.surfaceColor=a.toJSON().slice(0,3)}}})],f.prototype,"surfaceColor",void 0);g([w.property({types:u.navigationConstraintTypes,json:{read:u.readNavigationConstraint,write:!0}})],f.prototype,"navigationConstraint",void 0);return f=l=g([w.subclass("esri.Ground")],f)}(w.declared(l,p))})},"esri/ground/navigationConstraints":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/Warning ../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);e([h.property()],b.prototype,"type",void 0);return b=e([h.subclass("esri.ground.NavigationConstraint")],b)}(h.declared(g));f.NavigationConstraint=m;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="none";return b}k(b,a);c=b;b.prototype.clone=function(){return new c};var c;e([h.property({type:["none"],readOnly:!0,json:{read:!1,
write:!0}})],b.prototype,"type",void 0);return b=c=e([h.subclass("esri.ground.NoneNavigationConstraint")],b)}(h.declared(m));f.NoneNavigationConstraint=g;var c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="stay-above";return b}k(b,a);c=b;b.prototype.clone=function(){return new c};var c;e([h.property({type:["stay-above"],readOnly:!0,json:{read:!1,write:function(a,b){b.type="stayAbove"}}})],b.prototype,"type",void 0);return b=c=e([h.subclass("esri.ground.StayAboveNavigationConstraint")],
b)}(h.declared(m));f.StayAboveNavigationConstraint=c;f.readNavigationConstraint=function(a,c,e){if(c=a&&b[a.type])return c=new c,c.read(a,e),c;e&&e.messages&&a&&e.messages.push(new d("navigationconstraint:unsupported","Navigation constraint of type '"+(a.type||"unknown")+"' is not supported",{definition:a,context:e}))};var b={none:g,stayAbove:c};f.navigationConstraintTypes={key:"type",base:m,typeMap:{none:g,"stay-above":c}}})},"esri/support/basemapUtils":function(){define("require exports ../Basemap ../core/Collection ../core/Logger ../core/urlUtils ../core/accessorSupport/ensureType ./basemapDefinitions".split(" "),
function(m,f,k,e,g,d,h,c){function b(a,b){var d;if("string"===typeof a){if(!(a in c))return b=Object.keys(c).map(function(a){return'"'+a+'"'}).join(", "),v.warn("Unable to find basemap definition for: "+a+". Try one of these: "+b),null;b&&(d=b[a]);d||(d=k.fromId(a),b&&(b[a]=d))}else d=h.default(k,a);return d}function a(a,b){return a.map(function(a){return b.find(function(b){return u(p(a),p(b))})||a})}function l(a){return a?!a.loaded&&a.resourceInfo?q(a.resourceInfo.data):{baseLayers:n(a.baseLayers),
referenceLayers:n(a.referenceLayers)}:null}function n(a){return(e.isCollection(a)?a.toArray():a).map(p)}function p(a){return{type:a.type,url:x(a.urlTemplate||a.url||a.styleUrl),minScale:null!=a.minScale?a.minScale:0,maxScale:null!=a.maxScale?a.maxScale:0,opacity:null!=a.opacity?a.opacity:1,visible:null!=a.visible?!!a.visible:!0}}function q(a){return a?{baseLayers:r(a.baseMapLayers.filter(function(a){return!a.isReference})),referenceLayers:r(a.baseMapLayers.filter(function(a){return a.isReference}))}:
null}function r(a){return a.map(function(a){var b;switch(a.layerType){case "VectorTileLayer":b="vector-tile";break;case "ArcGISTiledMapServiceLayer":b="tile";break;default:b="unknown"}return{type:b,url:x(a.templateUrl||a.urlTemplate||a.styleUrl||a.url),minScale:null!=a.minScale?a.minScale:0,maxScale:null!=a.maxScale?a.maxScale:0,opacity:null!=a.opacity?a.opacity:1,visible:null!=a.visibility?!!a.visibility:!0}})}function t(a,b,c){return null!=a!==(null!=b)?"not-equal":a?w(a.baseLayers,b.baseLayers)?
w(a.referenceLayers,b.referenceLayers)?"equal":c.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function w(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!u(a[c],b[c]))return!1;return!0}function u(a,b){return a.type===b.type&&a.url===b.url&&a.minScale===b.minScale&&a.maxScale===b.maxScale&&a.visible===b.visible&&a.opacity===b.opacity}function x(a){return a?d.normalize(a).replace(/^\s*https?:/i,"").toLowerCase():""}Object.defineProperty(f,"__esModule",{value:!0});
var v=g.getLogger("esri.support.basemapUtils");f.createCache=function(){return{}};f.ensureType=b;f.clonePreservingTiledLayers=function(c,d){void 0===d&&(d=null);c=b(c);if(!c)return null;var e=new k({id:c.id,title:c.title,baseLayers:c.baseLayers.slice(),referenceLayers:c.referenceLayers.slice()});d&&(e.baseLayers=a(e.baseLayers,d.baseLayers),e.referenceLayers=a(e.referenceLayers,d.referenceLayers));e.load();e.portalItem=c.portalItem;return e};f.getWellKnownBasemapId=function(a){var b=null;a=l(a);for(var d in c){var e=
q(c[d]),e=t(a,e,{mustMatchReferences:!1});if("equal"===e){b=d;break}else"base-layers-equal"===e&&(b=d)}return b};f.contentEquals=function(a,b){if(a===b)return!0;a=l(a);b=l(b);return"equal"===t(a,b,{mustMatchReferences:!0})}})},"esri/support/groundUtils":function(){define("require exports ../Ground ../core/Logger ../core/accessorSupport/ensureType ../layers/ElevationLayer".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});var h=e.getLogger("esri.support.groundUtils");
f.groundElevationLayers={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer"}};f.ensureType=function(c){var b;"string"===typeof c?c in f.groundElevationLayers?(c=f.groundElevationLayers[c],c=new d({id:c.id,url:c.url}),b=new k({layers:[c]})):h.warn("Unable to find ground definition for: "+
c+'. Try "world-elevation"'):b=g.default(k,c);return b}})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.updateOrigins=function(e){e&&e.writtenProperties&&e.writtenProperties.forEach(function(e){var d=e.target;e.newOrigin&&e.oldOrigin!==e.newOrigin&&d.isInstanceOf(k)&&d.updateOrigin(e.propName,e.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require",
"exports","../core/Error"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.createCopyError=function(){return new k("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};f.isCopyError=function(e){return e&&"webscene:failed-to-copy-embedded-resources"===e.name};f.createSchemaValidationError=function(e){return new k("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",
{errors:e})};f.isSchemaValidationError=function(e){return e&&"webscene:schema-validation"===e.name}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./applicationProperties/Viewing".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,a)||this;a.viewing=null;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({viewing:this.viewing?
this.viewing.clone():null})};var a;e([d.property({type:h,json:{write:!0}})],b.prototype,"viewing",void 0);return b=a=e([d.subclass("esri.webscene.ApplicationProperties")],b)}(d.declared(g))})},"esri/webscene/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./Search".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,
a)||this;a.search=null;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({search:this.search?this.search.clone():null})};var a;e([d.property({type:h,json:{write:!0}})],b.prototype,"search",void 0);return b=a=e([d.subclass("esri.webscene.applicationProperties.Viewing")],b)}(d.declared(g))})},"esri/webscene/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(m,f,k,e,g,d,h,c){var b=g.ofType(c);return function(a){function c(c){c=a.call(this,c)||this;c.enabled=!1;c.hintText=null;c.layers=new b;return c}k(c,a);d=c;c.prototype.clone=function(){return new d({enabled:this.enabled,hintText:this.hintText,layers:this.layers?this.layers.clone():null})};var d;e([h.property({type:Boolean,json:{write:!0}})],c.prototype,"enabled",void 0);e([h.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);e([h.property({type:b,json:{write:{enabled:!0,
isRequired:!0}}})],c.prototype,"layers",void 0);return c=d=e([h.subclass("esri.webscene.applicationProperties.Search")],c)}(h.declared(d))})},"esri/webscene/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this,
a)||this;a.field=null;a.id=null;a.subLayer=null;return a}k(a,b);g=a;a.prototype.clone=function(){return new g({field:this.field?this.field.clone():null,id:this.id,subLayer:this.subLayer})};var g;e([d.property({type:c,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"field",void 0);e([d.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"id",void 0);e([d.property({type:h.Integer,json:{write:!0}})],a.prototype,"subLayer",void 0);return a=g=e([d.subclass("esri.webscene.applicationProperties.SearchLayer")],
a)}(d.declared(g))})},"esri/webscene/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}k(b,c);a=b;b.prototype.clone=function(){return new a({exactMatch:this.exactMatch,
type:this.type,name:this.name})};var a;e([d.property({type:Boolean,json:{write:!0}})],b.prototype,"exactMatch",void 0);e([d.property({type:String,json:{write:!0}})],b.prototype,"name",void 0);e([d.property({type:String,json:{read:h.kebabDict.read,write:h.kebabDict.write}})],b.prototype,"type",void 0);return b=a=e([d.subclass("esri.webscene.applicationProperties.SearchLayerField")],b)}(d.declared(g))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),
function(m,f,k,e,g,d,h,c,b){return function(a){function d(c){c=a.call(this,c)||this;c.environment=new b;c.spatialReference=null;c.viewpoint=null;return c}k(d,a);f=d;Object.defineProperty(d.prototype,"viewingMode",{set:function(a){this._set("viewingMode",a)},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new f({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():
null})};var f;e([h.property({type:b,json:{write:{isRequired:!0}}})],d.prototype,"environment",void 0);e([h.property({type:c})],d.prototype,"spatialReference",void 0);e([h.property({type:["local","global"]})],d.prototype,"viewingMode",null);e([h.property({type:g,json:{write:{isRequired:!0}}})],d.prototype,"viewpoint",void 0);return d=f=e([h.subclass("esri.webscene.InitialViewProperties")],d)}(h.declared(d))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=g.ofType(b);return function(g){function f(b){b=g.call(this,b)||this;b.slides=new a;return b}k(f,g);Object.defineProperty(f.prototype,"slides",{set:function(b){this._set("slides",d.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});f.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f.sanitizeJSON=function(a){return{slides:void 0!==a.slides&&Array.isArray(a.slides)?a.slides.filter(function(a){return a&&!!a.viewpoint}).map(function(a){return b.sanitizeJSON(a)}):
[]}};e([c.property({type:a,json:{write:!0}}),c.cast(d.castForReferenceSetter)],f.prototype,"slides",null);return f=e([c.subclass("esri.webscene.Presentation")],f)}(c.declared(h))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../Basemap ../Viewpoint ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/lang ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../support/basemapUtils ../views/3d/lib/gl-matrix ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/Title".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B){var C=0,E=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.id="";return b}e(b,a);c=b;b.prototype.clone=function(){return new c({id:this.id})};var c;g([r.property({type:String,json:{write:!0}})],b.prototype,"id",void 0);return b=c=g([r.subclass()],b)}(r.declared(l)),D=b.ofType(E),F=p.getLogger("esri.webscene.Slide");return function(f){function l(a){a=f.call(this,a)||this;a._currentAnimation=null;a.id=Date.now().toString(16)+
"-slide-"+C++;a.title=new B.default;a.description=new y.default;a.thumbnail=new x.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new v;a.visibleLayers=new D;return a}e(l,f);l.prototype.castTitle=function(a){return"string"===typeof a?new B.default({text:a}):t.ensureType(B.default,a)};l.prototype.castDescription=function(a){return"string"===typeof a?new y.default({text:a}):t.ensureType(y.default,a)};l.prototype.castThumbnail=function(a){return"string"===typeof a?new x.default({url:a}):
t.ensureType(x.default,a)};l.prototype.castBasemap=function(a){return w.ensureType(a)};Object.defineProperty(l.prototype,"visibleLayers",{set:function(b){this._set("visibleLayers",a.referenceSetter(b,this._get("visibleLayers"),D))},enumerable:!0,configurable:!0});l.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a.id)return{id:a.id};F.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):a};l.prototype.clone=
function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};l.prototype._updateVisibleLayersFrom=function(a){var b=this,c=[];return q.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){a.visible&&
c.push(new E({id:a.layer.id}))})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(c)})};l.prototype.updateFrom=function(a,b){var c=this;b=k({screenshot:k({format:"jpeg",quality:80,width:120,height:75},b&&b.screenshot)},b);return a.when(function(){c.viewpoint=a.viewpoint.clone();c.environment.lighting=z.prototype.clone.apply(a.environment.lighting);c.basemap=a.map.basemap&&a.map.basemap.clone()||null;c.ground=a.map.ground?A.default.fromGround(a.map.ground):null;return c._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){c.thumbnail=
new x.default({url:a.dataUrl});return c})};l.prototype.applyTo=function(a,b){var c=this,e=k({animate:!0},b);return this._applyBasemap(a).then(function(){return d([c._applyViewpoint(a,e),c._applyLayerVisibility(a,e),c._applyGround(a)])}).then(function(){return c})};l.prototype._applyBasemap=function(a){var b=this;return this.basemap?this.basemap.load().always(function(){a.map.basemap=w.clonePreservingTiledLayers(b.basemap,a.map.basemap)}):q.resolve()};l.prototype._applyGround=function(a){this.ground&&
(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground));return q.resolve()};l.prototype._allLayers=function(a){var c=new b;this._collectLayers(a,c);this._collectLayers(a.ground,c);return c};l.prototype._collectLayers=function(a,b){var c=this;a.layers.forEach(function(a){b.add(a);a.layers&&c._collectLayers(a,b)})};l.prototype._applyLayerVisibility=function(a,b){var c=this;if(this.visibleLayers){var d=this._allLayers(a.map);if(b.applyToLayerViews)return q.eachAlways(d.map(function(b){return a.whenLayerView(b).then(function(a){a.visible=
c.visibleLayers.some(function(b){return b.id===a.layer.id})})}).toArray());d.forEach(function(a){return a.visible=c.visibleLayers.some(function(b){return b.id===a.id})});return q.resolve()}};l.prototype._applyViewpoint=function(a,b){if(this.viewpoint){this.viewpoint.camera.fov=a.camera.fov;if(b.animate){if(this.get("environment.lighting.date"))return this._animateToLighting(a,b);a.environment.lighting=this.environment.lighting.clone();return a.goTo(this.viewpoint,b)}a.viewpoint=this.viewpoint;a.environment.lighting=
this.environment.lighting.clone()}return q.resolve()};l.prototype._animateToLighting=function(a,b){var c=this,d;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));this._currentAnimation&&(this._currentAnimation.cancel(),this._currentAnimation=null);a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);
var e=a.goTo(this.viewpoint,b);this._currentAnimation=e;this._currentAnimation.always(function(){d&&d.remove();c._currentAnimation===e&&(a.environment.lighting.cameraTrackingEnabled=!0)});this._currentAnimation.then(function(){a.environment.lighting=c.environment.lighting.clone()});return this._currentAnimation};l.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};l.prototype._setTime=function(a,b,c){a.setTime(b);a.setUTCHours(c/
3600);a.setUTCMinutes(c%3600/60);a.setUTCSeconds(c%3600%60);return a};l.prototype._animateLightingWithCamera=function(a){var b=this,c=this._getTime(new Date(a.environment.lighting.date.toString())),d=c[0],e=c[1],c=this._getTime(this.environment.lighting.date),g=c[0],f=c[1],h=a.renderCoordsHelper,l=[0,0,0];h.toRenderCoords(a.camera.position,l);var k=[0,0,0];h.toRenderCoords(this.viewpoint.camera.position,k);var m=[0,0,0],n=new Date;return a.watch("camera",function(c){h.toRenderCoords(c.position,m);
c=u.vec3d.dist2(l,m);var p=u.vec3d.dist2(k,m),q=0;0!==c+p&&(q=c/(c+p));a.environment.lighting.date=b._setTime(n,d+(g-d)*q,e+(f-e)*q)})};l.createFrom=function(a,b){return(new this).updateFrom(a,b)};l.sanitizeJSON=function(a){var b;b=void 0!==a.visibleLayers&&Array.isArray(a.visibleLayers)?n.clone(a.visibleLayers):[];b={id:a.id||"",title:a.title||{text:""},thumbnail:a.thumbnail||{url:""},viewpoint:a.viewpoint,baseMap:a.baseMap,visibleLayers:b};void 0!==a.description&&(b.description=a.description);void 0!==
a.environment&&(b.environment=v.sanitizeJSON(a.environment));void 0!==a.ground&&(b.ground=A.default.sanitizeJSON(a.ground));return b};g([r.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"id",void 0);g([r.property({type:B.default,json:{write:{isRequired:!0}}})],l.prototype,"title",void 0);g([r.cast("title")],l.prototype,"castTitle",null);g([r.property({type:y.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],l.prototype,"description",void 0);g([r.cast("description")],
l.prototype,"castDescription",null);g([r.property({type:x.default,json:{write:{isRequired:!0}}})],l.prototype,"thumbnail",void 0);g([r.cast("thumbnail")],l.prototype,"castThumbnail",null);g([r.property({type:c,json:{write:{isRequired:!0}}})],l.prototype,"viewpoint",void 0);g([r.property({type:h,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],l.prototype,"basemap",void 0);g([r.cast("basemap")],l.prototype,"castBasemap",null);g([r.property({type:A.default,json:{write:!0}})],l.prototype,"ground",
void 0);g([r.property({type:D,json:{write:{isRequired:!0}}})],l.prototype,"visibleLayers",null);g([r.cast("visibleLayers")],l.prototype,"castVisibleLayers",null);g([r.property({type:v,json:{write:!0}})],l.prototype,"environment",void 0);return l=g([r.subclass("esri.webscene.Slide")],l)}(r.declared(l))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(){var a=null!==g&&g.apply(this,arguments)||this;a.url="";return a}k(c,g);b=c;c.prototype.clone=function(){return new b({url:this.url})};var b;e([d.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"url",void 0);return c=b=e([d.subclass("esri.webdoc.support.Thumbnail")],c)}(d.declared(g));f.default=m})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(){var a=null!==g&&g.apply(this,arguments)||this;a.text="";return a}k(c,g);b=c;c.prototype.clone=function(){return new b({text:this.text})};var b;e([d.property({type:String,json:{write:!0}})],c.prototype,"text",void 0);return c=b=e([d.subclass("esri.webscene.support.Description")],c)}(d.declared(g));f.default=m})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../webdoc/support/opacityUtils".split(" "),
function(m,f,k,e,g,d,h,c){Object.defineProperty(f,"__esModule",{value:!0});m=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.opacity=null;return a}k(a,b);d=a;a.prototype.clone=function(){return new d({opacity:this.opacity})};a.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new g;a.opacity=this.opacity;return a};a.fromGround=function(a){return new d({opacity:a.opacity})};a.sanitizeJSON=function(a){return{transparency:a.transparency}};
var d;e([h.property({type:Number,json:{read:{reader:c.transparencyToOpacity,source:"transparency"},write:{writer:function(a,b){b.transparency=c.opacityToTransparency(a)},target:"transparency"}}})],a.prototype,"opacity",void 0);return a=d=e([h.subclass("esri.webscene.support.SlideGround")],a)}(h.declared(d));f.default=m})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(g){function c(){var a=null!==g&&g.apply(this,arguments)||this;a.text="";return a}k(c,g);b=c;c.prototype.clone=function(){return new b({text:this.text})};var b;e([d.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"text",void 0);return c=b=e([d.subclass("esri.webscene.support.Title")],c)}(d.declared(g));f.default=m})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper",
"../core/Version"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});m=function(e){function d(d,c){return e.call(this,d,c,"webscene")||this}k(d,e);Object.defineProperty(d.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return d}(e.Version);f.Version=m;f.default=m})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D,F,M,N,I,G,O){function J(a,b,c){a&&((a=M.read(a,b,c)||void 0)||H.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var Q=["3DObject","Point"],H=a.getLogger("esri.layers.SceneLayer"),K={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
R={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(a){function f(b,c){b=a.call(this)||this;b.featureReduction=null;b.rangeInfos=null;b.operationalLayerType="ArcGISSceneServiceLayer";b.type="scene";b.fields=[];b.definitionExpression=null;b.labelsVisible=!0;b.labelingInfo=null;b.legendEnabled=!0;b.cachedDrawingInfo={color:!1};b.popupEnabled=!0;b.popupTemplate=null;b.objectIdField=null;b.objectIdFilter=null;b._fieldUsageInfo={};b.screenSizePerspectiveEnabled=
!0;return b}e(f,a);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};f.prototype.getField=function(a){return B.getField(a,this.fields)};Object.defineProperty(f.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"geometryType",{get:function(){return R[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"renderer",{set:function(a){B.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});f.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};f.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};f.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&K[a])return K[a];H.error("Unknown or missing profile",
{profile:a,layer:this});return"mesh-pyramids"};f.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame};f.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return d([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._validateElevationInfo()}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return N.loadStyleRenderer(a,
{origin:"service"})}).then(function(){return B.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(b);return this.when()};f.prototype.createLayerView=function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?l.create(function(a){return m(["../views/3d/layers/SceneLayerView3D"],a)}):l.create(function(a){return m(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};f.prototype.createQuery=function(){var a=new O;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};f.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};f.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};f.prototype.queryFeatures=function(a){var b=this;
return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,d=a.features;c<d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};f.prototype.queryFeaturesJSON=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeaturesJSON(a||b.createQuery())})};f.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||
b.createQuery())})};f.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(H.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};f.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var c=this.associatedLayer;return null!=c?l.resolve(c):l.reject(new b("scenelayer:query-not-available",
"SceneLayer queries are not available without associated feature layer"))};f.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};f.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return l.reject(new b("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var d=0,e=this.statisticsInfo;d<e.length;d++){var g=e[d];if(g.name===a)return a=n.join(this.parsedUrl.path,
g.href),c(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};f.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};f.prototype._validateLayer=function(a){if(a.layerType&&-1===Q.indexOf(a.layerType))throw new b("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new b("layer:service-version-not-supported","Service version is not supported.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new b("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var c=this.spatialReference,d=!1,e=!1;if(null==a)e=d=!0;else switch(c=c&&c.isGeographic,a){case "east-north-up":case "earth-centered":d=!0;e=c;break;case "vertex-reference-frame":d=!0;e=!c;break;default:d=!1}if(!d)throw new b("scenelayer:unsupported-normal-reference-frame",
"Normal reference frame is invalid.");if(!e)throw new b("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};f.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));
b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};f.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=r.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&
(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};f.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})};f.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?l.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):
this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?H.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):H.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};f.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",
direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new F({id:a.id,portal:a.portal})):l.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};f.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return l.resolve(new t({url:b,portalItem:a}))})};f.prototype._fetchCompanionFeatureLayerFromUrl=
function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return l.resolve(new t({url:a}))})};f.prototype._findMatchingCompanionSublayerUrl=function(a){var b=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!b)return l.reject();null==a&&(a=b[1]+"/FeatureServer");var e=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var g=b[1]+"/SceneServer",f=parseInt(b[2],10),b=c(g,a).catch(function(a){return{layers:null}});a=
c(e,a);return d([a,b]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===f)return e+"/"+b[c].id}else if(f<b.length)return e+"/"+b[f].id;throw Error("could not find matching associated sublayer");})};f.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=q.nameToId(this.originOf(a));a=q.nameToId(this.associatedLayer.originOf(a));
return null!=a&&a<=q.OriginId.SERVICE?null==b||b<q.OriginId.SERVICE:null!=a&&a<=q.OriginId.PORTAL_ITEM?null==b||b<q.OriginId.PORTAL_ITEM:!1};f.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&H.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&H.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};
g([p.shared("esri.layers.SceneLayer")],f.prototype,"declaredClass",void 0);g([p.property({types:{key:"type",base:z.default,typeMap:{selection:y.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],f.prototype,"featureReduction",void 0);g([p.property({type:[D.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],f.prototype,"rangeInfos",
void 0);g([p.property()],f.prototype,"associatedLayer",void 0);g([p.property()],f.prototype,"operationalLayerType",void 0);g([p.property({json:{read:!1},readOnly:!0})],f.prototype,"type",void 0);g([p.property({type:[A]})],f.prototype,"fields",void 0);g([p.property({readOnly:!0})],f.prototype,"attributeStorageInfo",void 0);g([p.property({readOnly:!0})],f.prototype,"statisticsInfo",void 0);g([p.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression"}}})],f.prototype,"definitionExpression",void 0);g([p.property({value:null,type:G,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],f.prototype,"elevationInfo",null);g([p.property({type:String,dependsOn:["profile"]})],f.prototype,"geometryType",null);g([p.property(x.labelsVisible)],f.prototype,"labelsVisible",void 0);g([p.property({type:[C],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",
reader:E.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:E.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],f.prototype,"labelingInfo",void 0);g([p.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],f.prototype,"legendEnabled",void 0);g([p.property({types:I.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:J}}},
read:{source:"layerDefinition.drawingInfo.renderer",reader:J},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],f.prototype,"renderer",null);g([p.property({json:{read:!1}})],f.prototype,"cachedDrawingInfo",void 0);g([p.reader("service","cachedDrawingInfo")],f.prototype,"readCachedDrawingInfo",null);g([p.property(x.popupEnabled)],f.prototype,"popupEnabled",void 0);g([p.property({type:h,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],f.prototype,"popupTemplate",void 0);
g([p.property({type:String,json:{read:!1}})],f.prototype,"objectIdField",void 0);g([p.reader("service","objectIdField",["objectIdField","fields"])],f.prototype,"readObjectIdField",null);g([p.property()],f.prototype,"objectIdFilter",void 0);g([p.property({type:String,json:{read:!1}})],f.prototype,"profile",void 0);g([p.reader("service","profile",["store.profile"])],f.prototype,"readProfile",null);g([p.property({readOnly:!0,type:String,json:{read:!1}})],f.prototype,"normalReferenceFrame",void 0);g([p.reader("service",
"normalReferenceFrame",["store.normalReferenceFrame"])],f.prototype,"readNormalReferenceFrame",null);g([p.property(v.screenSizePerspectiveEnabled)],f.prototype,"screenSizePerspectiveEnabled",void 0);return f=g([p.subclass()],f)}(p.declared(w,u))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x){var v=h.getLogger("esri.layers.mixins.SceneService");return function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}k(f,c);f.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
f.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return q.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new q(a):null};f.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new n({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};f.prototype.readVersion=function(a,
b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};f.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};f.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return x.titleFromUrlAndName(this.url,b.name);b=b.name||x.parse(this.url).title;
"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return x.cleanTitle(b)};f.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(f.prototype,"url",{set:function(a){a=x.sanitizeUrlWithLayerId(this,a,v);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});f.prototype.writeUrl=function(a,b){x.writeUrlWithLayerId(this,a,"layers",b)};Object.defineProperty(f.prototype,"parsedUrl",{get:function(){var b=this._get("url");
if(!b)return null;b=a.urlToObject(b);null!=this.layerId&&x.match.test(b.path)&&(b.path=b.path+"/layers/"+this.layerId);return b},enumerable:!0,configurable:!0});f.prototype.readRootNode=function(a,b){return b.store.rootNode};f.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};f.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&
4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};f.prototype._fetchRootNode=function(){if(!this.rootNode)return b.resolve();var c=a.join(this.parsedUrl.path,this.rootNode);return g(c,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(a){throw new d("sceneservice:root-node-missing","Root node missing.",{error:a,url:c});})};f.prototype._fetchService=function(){var a=this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?
this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):b.resolve()).then(function(){return a._fetchServiceLayer()})};f.prototype._fetchFirstLayerId=function(){return g(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};f.prototype._fetchServiceLayer=function(){var a=this;return g(this.parsedUrl.path,{query:{f:"json"},responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,
"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};f.prototype._validateLayer=function(a){};e([l.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],f.prototype,"properties",void 0);e([l.property({type:q})],f.prototype,"spatialReference",void 0);e([l.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readSpatialReference",null);e([l.property({type:n})],f.prototype,"fullExtent",void 0);e([l.reader("fullExtent",
["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readFullExtent",null);e([l.property({readOnly:!0,type:p})],f.prototype,"heightModelInfo",void 0);e([l.property({readOnly:!0})],f.prototype,"version",void 0);e([l.reader("version",["store.version"])],f.prototype,"readVersion",null);e([l.property({type:String,json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0);e([l.property({type:String})],f.prototype,"sublayerTitleMode",void 0);e([l.property({type:String})],
f.prototype,"title",void 0);e([l.reader("portal-item","title")],f.prototype,"readTitlePortalItem",null);e([l.reader("service","title",["name"])],f.prototype,"readTitleService",null);e([l.property({type:Number})],f.prototype,"layerId",void 0);e([l.reader("service","layerId",["id"])],f.prototype,"readLayerId",null);e([l.property()],f.prototype,"url",null);e([l.writer("url")],f.prototype,"writeUrl",null);e([l.property({dependsOn:["layerId"]})],f.prototype,"parsedUrl",null);e([l.property()],f.prototype,
"store",void 0);e([l.property({type:String})],f.prototype,"rootNode",void 0);e([l.reader("rootNode",["store.rootNode"])],f.prototype,"readRootNode",null);return f=e([l.subclass("esri.layers.mixins.SceneService")],f)}(l.declared(r,t,c,w,u))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,
"__esModule",{value:!0});m=function(g){function c(){var b=null!==g&&g.apply(this,arguments)||this;b.name=null;b.field=null;b.currentRangeExtent=null;b.fullRangeExtent=null;b.type="rangeInfo";return b}k(c,g);e([d.property({type:String,json:{read:!0,write:!0}})],c.prototype,"name",void 0);e([d.property({type:String,json:{read:!0,write:!0}})],c.prototype,"field",void 0);e([d.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"currentRangeExtent",void 0);e([d.property({type:[Number],json:{read:!0,
write:!0}})],c.prototype,"fullRangeExtent",void 0);e([d.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);return c=e([d.subclass("esri.layers.support.RangeInfo")],c)}(d.declared(g));f.RangeInfo=m;f.default=m})},"webSceneViewer/support/layerUtils":function(){define("require exports dojo/_base/lang esri/Ground esri/core/Collection esri/core/Error esri/core/promiseUtils esri/core/watchUtils esri/core/lang esri/support/groundUtils esri/renderers/support/rendererConversion esri/support/basemapUtils esri/geometry/support/webMercatorUtils esri/layers/ElevationLayer esri/layers/FeatureLayer esri/layers/GroupLayer esri/layers/ImageryLayer esri/layers/WMSLayer esri/layers/WMTSLayer esri/layers/UnknownLayer esri/layers/TileLayer esri/layers/SceneLayer esri/renderers/HeatmapRenderer ./spatialReferenceUtils ./errorUtils ../editor/support/dropBasemapUtils ./goToAnimationConfig".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C,E,D){function F(a,b){b=Y(b);var c=[];M(b);for(var d=function(b){b.isInstanceOf(q)?c.push(a.ground.load().then(function(){return a.ground.layers.add(b)})):a.layers.add(b)},e=0;e<b.length;e++)d(b[e]);return h.eachAlways(c).then(function(){})}function M(a){a.forEach(function(a){a.isInstanceOf(t)?a.when(function(){M(a.layers.toArray())}):a.isInstanceOf(r)&&(a.returnZ=!0,a.outFields=["*"],a.set("mode",r.MODE_SNAPSHOT))})}function N(a,b){return(a=
I(a,b))?(a.remove(b),!0):!1}function I(a,b){if(!a)return null;if(a.isInstanceOf(g)){if(-1!==a.indexOf(b))return a;for(var c=0;c<a.length;c++){var d=a.getItemAt(c);if(d.isInstanceOf(t)&&(d=I(d.layers,b)))return d}return null}return I(a.layers,b)||I(a.basemap?a.basemap.baseLayers:null,b)||I(a.basemap?a.basemap.referenceLayers:null,b)||I(a.ground.layers,b)||null}function G(a,b,c,d){return h.eachAlways(b.map(function(a){return a.isInstanceOf(t)?a.load():h.resolve()}).toArray()).then(function(){var e=
L(b,!0);return h.eachAlways(e.map(function(b){return a.whenLayerView(b).then(function(){return null}).catch(function(e){if("cancelled:layerview-create"===e.name)return null;(b.isInstanceOf(v)||c)&&N(a.map,b);e={layer:b,error:e};return d?d(e):e})}))}).then(function(a){return a.filter(function(a){return!!a.value}).map(function(a){return a.value})})}function O(a,b){var c=[],e;e=a.loadWarnings&&0<a.loadWarnings.length?a.loadWarnings.filter(function(a){return"renderer:unsupported"===a.name}):[];"getAtOrigin"in
a&&["web-scene","portal-item","service"].forEach(function(b){var c=a.getAtOrigin("renderer",b);(c=l.validateTo3D(c))&&"renderer-conversion-3d:unsupported-symbols"===c.name&&(c.details.context={origin:b},e.push(c))});var g=a.renderer;g&&g instanceof A&&e.push(new d("renderer:unsupported","Renderers of type 'heatmap' are not supported",{definition:g,context:{layer:a,origin:"originOf"in a?a.originOf("renderer"):null}}));c=c.concat(ba(e,a));a.loadWarnings&&(g=a.loadWarnings.filter(function(a){return"renderer:unsupported"!==
a.name}),c=c.concat(ka(g,a)));b&&b(c);return c}function J(a,b,c,e){return a.view.whenLayerView(c).catch(function(g){var f=P(g);if(b.isRejected()||!f)return h.reject(g);f=Z(c);if(!B.isSpatialReferenceSupported(a.view.viewingMode,f))return h.reject(new d("websceneviewer:cannot-drop-basemap","",{error:g}));f=L(a.addLayerState.layersBeingAdded,!0);f=!a.view.map.isLockedIgnoringLayers(f);a.addLayerState.layersBeingAdded.remove(b);return f?e().catch(function(){return h.reject(g)}).then(function(){var d=
[b].concat(a.addLayerState.layersBeingAdded.toArray());return E.dropBasemap(a,d,c)}).then(function(){return a.view.whenLayerView(c)}):h.reject(new d("websceneviewer:cannot-drop-basemap","",{error:g}))})}function Q(a,b){var c=ga(a),d=ga(b);if(c||d)return c&&d;c=a.portalItem;d=b.portalItem;return n.contentEquals(a,b)&&(!c||null===c.id||!d||null===d.id||c.id===d.id)}function H(a,b){var c=a.view;return G(a.view,b.baseLayers.concat(b.referenceLayers),!1).then(function(e){if(c.get("map.basemap")===b&&e.length)throw e=
new d("wsv-setbasemapinteractive:basemap-failure","Failed to set basemap",{errors:e.map(function(a){return new d("wsv-setbasemapinteractive:basemap-layer-failure","Basemap layer failed to load",a)})}),a.errors.error(C.basemapError(e,"error",a.view)),e;})}function K(a,b,c,e){var g,f,l=e&&e.goToTask||a.runningTasks.goToInitial.replace(),m=function(){if(!l.isRunning())throw new d("wsv-gotoinitial:cancelled","Cancelled");};try{m()}catch(Ga){return h.reject(Ga)}return b.when(function(){return h.eachAlways(L(c).map(function(a){return a.when()}))}).then(function(a){m();
g=a.filter(function(a){return!!aa(a.value)}).map(function(a){return a.value});a=g.map(function(a){return aa(a)});return B.projectGeometries(a,b.spatialReference)}).then(function(a){m();f=a;return h.eachAlways(g.map(function(a){return b.whenLayerView(a)}))}).then(function(a){m();var c=f.filter(function(c,d){return c&&a[d].value&&T(g[d],b.map)}),c=U(c);if(!c)throw new d("wsv-gotoinitial:nothing-to-frame","None of the layers can be framed");if(!(e&&e.forceFrame||ha(b.extent,c,wa)))throw new d("wsv-gotoinitial:extent-already-visible",
"The extent is already visible in the view");return b.goTo(k.mixin({target:c},e&&e.target),k.mixin({maxDuration:D.goToSpeed.goToAddedLayer},e&&e.options))})}function R(a,b){var c=[],e=[],g=function(a){e.push(new d("wsv-validatelayers:unsupported-"+b.context+"-layer-type","Unsupported "+b.context+" layer type ${operationalLayerType}",{operationalLayerType:a.operationalLayerType||"unknown",layer:a}))};Y(a).forEach(function(a){var d=a.operationalLayerType;if("operational"===b.context)switch(d){case "ArcGISFeatureLayer":!a.portalItem&&
!a.url||a.portalItem&&"Feature Service"!==a.portalItem.type?g(a):c.push(a);break;case "ArcGISImageServiceLayer":case "ArcGISMapServiceLayer":case "ArcGISSceneServiceLayer":case "IntegratedMeshLayer":case "PointCloudLayer":case "ArcGISTiledElevationServiceLayer":case "ArcGISTiledImageServiceLayer":case "ArcGISTiledMapServiceLayer":case "GroupLayer":case "CSVLayer":case "VectorTileLayer":case "WebTiledLayer":case "WMS":c.push(a);break;default:g(a)}else if("basemap"===b.context)switch(d){case "ArcGISTiledImageServiceLayer":case "ArcGISTiledMapServiceLayer":case "OpenStreetMap":case "VectorTileLayer":case "WebTiledLayer":c.push(a);
break;default:g(a)}else if("ground"===b.context)switch(d){case "ArcGISTiledElevationServiceLayer":c.push(a);break;default:g(a)}});return{layers:c,errors:e}}function P(a){var b=C.isEsriError(a,"layerview:create-error","layerview:tiling-scheme-incompatible");a=C.isEsriError(a,"layerview:create-error","layerview:spatial-reference-incompatible");return b||a}function L(a,b){void 0===b&&(b=!1);var c=[];Y(a).forEach(function(a){a instanceof t?(b&&c.push(a),a.layers.forEach(function(a){return c.push(a)})):
c.push(a)});return c}function T(a,b){return!!b.findLayerById(a.id)||b.ground&&!!b.ground.layers.find(function(b){return b.id===a.id})}function S(a,b,c){void 0===c&&(c=!1);b=b.filter(function(b){return T(b,a.view.map)&&!!a.extraLayerData[b.uid].extent}).map(function(b){return a.extraLayerData[b.uid].extent});c=c?{animate:!1}:{maxDuration:D.goToSpeed.goToButtonLayer};return a.view.goTo({target:U(b)},c)}function W(a){var b=a.view.map.allLayers.toArray(),b=b.filter(function(b){return b.fullExtent&&!a.ensureExtraLayerData(b).extent}),
c=b.map(function(a){return a.fullExtent});return B.projectGeometries(c,a.view.spatialReference).then(function(c){return c.forEach(function(c,d){a.extraLayerData[b[d].uid].extent=c})})}function Y(a){return a instanceof g?a.toArray():Array.isArray(a)?a:[a]}function X(a,b){return a.allLayerViews.some(function(a){return a.layer===b})}function aa(a){if(a){var b=a.portalItem;return b&&b.extent?b.extent:a.fullExtent}}function U(a){if(0!==a.length)return a.slice(1).reduce(function(a,b){return b?a.union(b):
a},a[0].clone())}function ha(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=0);if(!b)return!1;var e=a.clone().intersection(b),e=e?e.width*e.height:0;return c&&e/(a.width*a.height)<c||d&&e/(b.width*b.height)<d}function Z(a){return a.isInstanceOf(x)&&a.activeLayer&&a.activeLayer.tileMatrixSet?a.activeLayer.tileMatrixSet.tileInfo.spatialReference:a.spatialReference}function ba(a,b){if(0===a.length)return[];var c=["defaults","service","portal-item","web-scene"];a.sort(function(a,b){a=c.indexOf(a.details.context.origin);
b=c.indexOf(b.details.context.origin);return a<b?1:a>b?-1:0});var d=a[0].details.context.origin;if(b.originOf){var e=b.originOf("renderer"),g=[];c.indexOf(e)<=c.indexOf(d)&&g.push({layer:b,error:a[0]});return g}return a.map(function(a){return{layer:b,error:a}})}function ka(a,b){return a.map(function(a){return{layer:b,error:a}})}function ga(a){var b=function(a){return!a||0===a.length};return!a||b(a.baseLayers)&&b(a.referenceLayers)}function ia(b){return b?(b=b.get("helperServices.defaultElevationLayers"))&&
0<b.length?e.fromJSON({layers:b.slice()}):new e:a.ensureType("world-elevation")}function na(a,c){null!=c&&(a.opacity=c.opacity,a.surfaceColor=b.clone(c.surfaceColor),a.navigationConstraint=b.clone(c.navigationConstraint))}Object.defineProperty(f,"__esModule",{value:!0});f.add=F;f.addInteractive=function(a,b,c,e){return b.load().then(function(){var c=R(b,{context:"operational"});if(c.errors.length)throw c.errors[0];a.addLayerState.layersBeingAdded.add(b);return F(a.view.map,b)}).then(function(){var g=
L(b);return h.eachAlways(g.map(function(d){return a.view.whenLayerView(d).always(function(){return a.addLayerState.mutex.doExclusive(function(){return J(a,b,d,c)})})})).then(function(c){a.addLayerState.layersBeingAdded.remove(b);var g=c.map(function(a){return a.error}).filter(function(a){return null!=a});if(c.length===g.length)return a.view.map.remove(b),b instanceof q&&a.view.map.ground.layers.remove(b),1===g.length?h.reject(g[0]):h.reject(new d("wsv-layer-utils:group-layer-failed","All sublayers of the group layer failed to load",
{errors:g}));var f=[];if(b instanceof t){var l=b.layers;l.removeMany(l.filter(function(a,b){return null!=c[b].error}));l.forEach(function(a){f=f.concat(O(a))})}else f=O(b);e&&!1===e.goToLayer||(l={},e&&e.goToTask&&(l.goToTask=e.goToTask),K(a,a.view,b,l).catch(function(){}));return{errors:g,warnings:f}})})};f.resetInteractiveDefaultGround=function(a){var b=a.view.map;b.resetDefaultGround(a.portal);return b.ground.load().always(function(){return G(a.view,b.ground.layers,!0)}).then(function(c){if(c.length){var e=
new d("wsv-resetineractivedefaultground:ground-failure","Ground failed to load",{errors:c.map(function(a){return new d("wsv-resetineractivedefaultground:ground-layer-failure","Ground failed to load",a)})});a.errors.error(C.groundError(e,"error",a.view))}if(0===b.ground.layers.length)return h.reject(c)})};f.removeLayer=N;f.collectErrors=G;f.collectWarnings=function(a,b,c){return h.eachAlways(b.map(function(a){return a.isInstanceOf(t)?a.load():h.resolve()}).toArray()).then(function(){var d=L(b,!0);
return h.eachAlways(d.map(function(b){return a.whenLayerView(b).then(function(){return O(b,c)})}))}).then(function(a){a=a.filter(function(a){return!!a.value}).map(function(a){return a.value});return[].concat.apply([],a)})};f.collectWarningsForLoadedLayer=O;f.goToInteractive=function(a,b,c){void 0===c&&(c=!1);var e=b instanceof t?b.layers.toArray():[b],e=e.filter(function(a){return null!=a.fullExtent});if(0===e.length)return h.reject(new d("websceneviewer:no-layer-with-extent","None of the layers have a fullExtent"));
e=e.filter(function(b){return X(a.view,b)});return 0===e.length?h.reject(new d("websceneviewer:no-layer-with-layer-view","None of the layers are being displayed")):e.some(function(b){return!a.ensureExtraLayerData(b).extent})?W(a).then(function(){return S(a,e,c)}):S(a,e,c)};f.basemapEquals=Q;f.setBasemapInteractive=function(a,b){var e=a.view,g=e.get("map.basemap");if(Q(b,g))return h.reject(new d("wsv-setbasemapinteractive:basemap-already-set","Basemap already set on the map"));var f=n.clonePreservingTiledLayers(b,
g);e.map.basemap=f;var l=f.baseLayers.getItemAt(0);if(!l)return h.resolve();var k=!1,m=null,q;return l.load().then(function(){q=b.portalItem&&b.portalItem.extent||l.fullExtent;return e.whenLayerView(l)}).catch(function(b){if(e.get("map.basemap")===f&&P(b)&&!e.map.isLocked){b=e.map.cloneEmpty();b.basemap=f;b.ground=ia(a.portal);na(b.ground,e.map.ground);b.initialViewProperties.viewingMode=e.viewingMode;if(p.canProject(l.spatialReference,e.spatialReference)){var d=e.map.initialViewProperties.viewpoint;
m=d&&d.clone();b.initialViewProperties.viewpoint=e.viewpoint.clone()}b.hasUnsavedChanges=e.map.hasUnsavedChanges;e.map=b;q&&e.adjustMonthForLightingAtLatitude(q.center);k=!0;return c.whenOnce(e,"ready")}}).then(function(){if(q&&p.canProject(q.spatialReference,e.spatialReference)){var a=p.project(q,e.spatialReference);if(ha(e.extent,a,za))return e.goTo({target:q,heading:0,tilt:0},{animate:!1}).always(function(){return m=e.viewpoint.clone()})}}).then(function(){m&&(e.map.initialViewProperties.viewpoint=
m);var b=[];k&&b.push(G(e,e.map.ground.layers,!0).then(function(){}));var c=H(a,f);b.push(c);return h.eachAlways(b).then(function(){if(c.isRejected())return e.map.basemap=k?null:g,c})})};f.goToInitial=K;f.validateLayers=R;f.isInternalLayer=function(a){return 0===a.id.indexOf("__internal__:")};f.internalLayerId=function(a){return"__internal__:"+a};f.explodeGroupLayers=L;f.isLayerInMap=T;f.supportsLegend=function(a){return!(a instanceof z&&a.capabilities&&a.capabilities&&!a.capabilities.supportsExportMap)&&
"esri.layers.IntegratedMeshLayer"!==a.declaredClass};f.supportsLabeling=function(a){return a.isInstanceOf(r)||a.isInstanceOf(y)&&"mesh"!==a.geometryType?!0:!1};f.supportsPopups=function(a){return a.isInstanceOf(r)||a.isInstanceOf(w)||a.isInstanceOf(u)||a.isInstanceOf(y)&&(!!a.associatedLayer||!!a.attributeStorageInfo)};var wa=.2,za=.05;f.isNoBasemap=ga;f.createDefaultGround=ia;f.cloneGroundProperties=na})},"esri/layers/WMTSLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Collection ../core/Error ../core/Handles ../core/lang ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ./Layer ./WebTileLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/WMTSSublayer ./support/wmtsUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){function y(a,b){return a.map(function(a){var c=new v;c.read(a,b);return c})}var A={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};return function(f){function q(a,c){var d=f.call(this)||this;d._sublayersHandles=new b;d.copyright=null;d.customParameters=null;d.customLayerParameters=
null;d.fullExtent=null;d.operationalLayerType="WebTiledLayer";d.resourceInfo=null;d.serviceMode="RESTful";d.sublayers=null;d.type="wmts";d.version="1.0.0";d.watch("activeLayer",function(a,b){b&&(b.layer=null);a&&(a.layer=d)},!0);d.watch("sublayers",function(a,c){c&&(c.forEach(function(a){a.layer=null}),d._sublayersHandles.removeAll(),d._sublayersHandles=null);a&&(a.forEach(function(a){a.layer=d}),d._sublayersHandles||(d._sublayersHandles=new b),d._sublayersHandles.add([a.on("after-add",function(a){a.item.layer=
d}),a.on("after-remove",function(a){a.item.layer=null})]))},!0);return d}e(q,f);q.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};q.prototype.load=function(){var a=this;if("KVP"!==this.serviceMode&&"RESTful"!==this.serviceMode)console.error("WMTS mode could only be 'KVP' or 'RESTful'");else return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){return a._fetchService()}).catch(function(){return l.reject(new c("wmtslayer:unsupported-service-data",
"Invalid response from the WMTS service."))})),this.when()};Object.defineProperty(q.prototype,"activeLayer",{get:function(){return this._get("activeLayer")},set:function(a){this._set("activeLayer",a)},enumerable:!0,configurable:!0});q.prototype.readActiveLayerFromService=function(a,b,c){var d=this,e;this.activeLayer?b.layers.some(function(a){return a.id===d.activeLayer.id?(e=a,!0):!1}):(this.activeLayer=new v,e=b.layers[0]);this.activeLayer.read(e,c);return this.activeLayer};q.prototype.readActiveLayerFromItemOrWebDoc=
function(a,b,c){return new v({id:b.wmtsInfo.layerIdentifier,tileMatrixSetId:b.wmtsInfo.tileMatrixSet})};q.prototype.writeActiveLayer=function(a,b){a=this.activeLayer;b.templateUrl=this.getUrlTemplate(a.id,a.tileMatrixSetId,a.imageFormat,a.styleId);b.wmtsInfo=k({},b.wmtsInfo,{layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId})};Object.defineProperty(q.prototype,"fullExtents",{get:function(){var a=[];this.activeLayer.tileMatrixSets.forEach(function(b){b.fullExtent&&a.push(b.fullExtent)});return a},
enumerable:!0,configurable:!0});q.prototype.readServiceMode=function(a,b,c){return-1<b.templateUrl.indexOf("?")?"KVP":"RESTful"};q.prototype.readSublayersFromService=function(a,b,c){return y(b.layers,c)};Object.defineProperty(q.prototype,"supportedSpatialReferences",{get:function(){return this.activeLayer.tileMatrixSets.map(function(a){return a.tileInfo.spatialReference}).toArray()},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"title",{get:function(){return"Layer"===this._get("title")?
this.activeLayer&&this.activeLayer.title:this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"url",{get:function(){return this._get("url")},set:function(a){a&&"/"===a.substr(-1)?this._set("url",a.slice(0,-1)):this._set("url",a)},enumerable:!0,configurable:!0});q.prototype.createWebTileLayer=function(a){var b=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId),
c=this._getTileMatrixSetById(a.tileMatrixSetId).tileInfo,d=a.fullExtent;a={layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId,url:this.url};this.customLayerParameters&&(a.customLayerParameters=this.customLayerParameters);this.customParameters&&(a.customParameters=this.customParameters);return new r({fullExtent:d,urlTemplate:b,tileInfo:c,wmtsInfo:a})};q.prototype.fetchTile=function(a,b,c){a=this.getTileUrl(a,b,c);return d(a,{responseType:"image"}).then(function(a){return a.data})};q.prototype.findSublayerById=
function(a){return this.sublayers.find(function(b){return b.id===a})};q.prototype.getTileUrl=function(a,b,c){a=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId).tileInfo.lods[a];a=a.levelValue?a.levelValue:String(a.level);var d=this.resourceInfo?"":z.getTileUrlFromResourceUrls(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.styleId,a,b,c);d||(d=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId).replace(/\{level\}/gi,
a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c));return d=this._appendCustomLayerParameters(d)};q.prototype.getUrlTemplate=function(a,b,c,d){var e="";if(!this.resourceInfo&&(e=z.getTileUrlTemplateFromResourceUrls(a,b,c,d)))return e;"KVP"===this.serviceMode?e=this.url+"?SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+a+"\x26STYLE\x3d"+d+"\x26FORMAT\x3d"+c+"\x26TILEMATRIXSET\x3d"+b+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":"RESTful"===this.serviceMode&&
(e="",A[c.toLowerCase()]&&(e=A[c.toLowerCase()]),e=this.url+a+"/"+d+"/"+b+"/{level}/{row}/{col}"+e);return e};q.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return l.create(function(a){return m(["../views/2d/layers/WMTSLayerView2D"],a)});case "3d":return l.create(function(a){return m(["../views/3d/layers/WMTSLayerView3D"],a)})}};q.prototype._fetchService=function(){var a=this;return l.resolve().then(function(){if(a.resourceInfo)return"KVP"===a.resourceInfo.serviceMode&&(a.url+=
-1<a.url.indexOf("?")?"":"?"),{ssl:!1,data:a.resourceInfo};var b=a._getCapabilitiesUrl(a.serviceMode);return d(b,{responseType:"text"}).catch(function(c){b=a._getCapabilitiesUrl("KVP"===a.serviceMode?"RESTful":"KVP");return d(b,{responseType:"text"})})}).then(function(b){b.data=a.resourceInfo?z.parseResourceInfo(b.data):z.parseCapabilities(b.data,{serviceMode:a.serviceMode,url:a.url});b.data&&a.read(b.data,{origin:"service"})})};q.prototype._getTileMatrixSetById=function(a){return this.findSublayerById(this.activeLayer.id).tileMatrixSets.find(function(b){return b.id===
a})};q.prototype._appendCustomParameters=function(a){if(this.customParameters)for(var b in this.customParameters)a+=(-1===a.indexOf("?")?"?":"\x26")+b+"\x3d"+encodeURIComponent(this.customParameters[b]);return a};q.prototype._appendCustomLayerParameters=function(b){if(this.customLayerParameters||this.customParameters){var c=k({},a.clone(this.customParameters||{}),this.customLayerParameters),d;for(d in c)b+=(-1===b.indexOf("?")?"?":"\x26")+d+"\x3d"+encodeURIComponent(c[d])}return b};q.prototype._getCapabilitiesUrl=
function(a){var b;this.url=this.url.split("?")[0];"KVP"===a?b=this.url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===a&&(b=this.url+"/"+this.version+"/WMTSCapabilities.xml");return b=this._appendCustomParameters(b)};g([n.property({type:v,dependsOn:["sublayers"],json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],q.prototype,"activeLayer",null);g([n.reader("service","activeLayer",["layers"])],q.prototype,"readActiveLayerFromService",null);g([n.reader(["web-document",
"portal-item"],"activeLayer",["wmtsInfo"])],q.prototype,"readActiveLayerFromItemOrWebDoc",null);g([n.writer(["web-document","portal-item"],"activeLayer")],q.prototype,"writeActiveLayer",null);g([n.property()],q.prototype,"copyright",void 0);g([n.property({json:{origins:{"web-document":{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}},"portal-item":{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}}}}})],q.prototype,"customParameters",
void 0);g([n.property({json:{origins:{"web-document":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},"portal-item":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],q.prototype,"customLayerParameters",void 0);g([n.property({type:p,json:{write:{ignoreOrigin:!0},origins:{"web-document":{read:{source:"fullExtent"}},"portal-item":{read:{source:"fullExtent"}}}}})],q.prototype,"fullExtent",void 0);g([n.property({readOnly:!0,
dependsOn:["activeLayer"]})],q.prototype,"fullExtents",null);g([n.property()],q.prototype,"operationalLayerType",void 0);g([n.property()],q.prototype,"resourceInfo",void 0);g([n.property()],q.prototype,"serviceMode",void 0);g([n.reader(["portal-item","web-document"],"serviceMode",["templateUrl"])],q.prototype,"readServiceMode",null);g([n.property({type:h.ofType(v)})],q.prototype,"sublayers",void 0);g([n.reader("service","sublayers",["layers"])],q.prototype,"readSublayersFromService",null);g([n.property({readOnly:!0,
dependsOn:["activeLayer"]})],q.prototype,"supportedSpatialReferences",null);g([n.property({dependsOn:["activeLayer"],json:{read:{source:"title"}}})],q.prototype,"title",null);g([n.property({json:{read:!1},readOnly:!0,value:"wmts"})],q.prototype,"type",void 0);g([n.property({json:{origins:{service:{read:{source:"tileUrl"}},"web-document":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},"portal-item":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],q.prototype,"url",null);
g([n.property()],q.prototype,"version",void 0);return q=g([n.subclass("esri.layers.WMTSLayer")],q)}(n.declared(q,t,w,u,x))})},"esri/layers/WebTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/string dojo/_base/url ../geometry ../request ../core/Error ../core/lang ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/commonProperties ./support/LOD ./support/TileInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A){return function(f){function k(a,b){a=f.call(this)||this;a.copyright="";a.fullExtent=new c.Extent(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,c.SpatialReference.WebMercator);a.legendEnabled=!0;a.operationalLayerType="WebTiledLayer";a.popupEnabled=!0;a.spatialReference=c.SpatialReference.WebMercator;a.subDomains=null;a.tileInfo=new A({size:256,dpi:96,format:"PNG8",compressionQuality:0,origin:new c.Point({x:-2.0037508342787E7,
y:2.0037508342787E7,spatialReference:c.SpatialReference.WebMercator}),spatialReference:c.SpatialReference.WebMercator,lods:[new y({level:0,scale:5.91657527591555E8,resolution:156543.033928}),new y({level:1,scale:2.95828763795777E8,resolution:78271.5169639999}),new y({level:2,scale:1.47914381897889E8,resolution:39135.7584820001}),new y({level:3,scale:7.3957190948944E7,resolution:19567.8792409999}),new y({level:4,scale:3.6978595474472E7,resolution:9783.93962049996}),new y({level:5,scale:1.8489297737236E7,
resolution:4891.96981024998}),new y({level:6,scale:9244648.868618,resolution:2445.98490512499}),new y({level:7,scale:4622324.434309,resolution:1222.99245256249}),new y({level:8,scale:2311162.217155,resolution:611.49622628138}),new y({level:9,scale:1155581.108577,resolution:305.748113140558}),new y({level:10,scale:577790.554289,resolution:152.874056570411}),new y({level:11,scale:288895.277144,resolution:76.4370282850732}),new y({level:12,scale:144447.638572,resolution:38.2185141425366}),new y({level:13,
scale:72223.819286,resolution:19.1092570712683}),new y({level:14,scale:36111.909643,resolution:9.55462853563415}),new y({level:15,scale:18055.954822,resolution:4.77731426794937}),new y({level:16,scale:9027.977411,resolution:2.38865713397468}),new y({level:17,scale:4513.988705,resolution:1.19432856685505}),new y({level:18,scale:2256.994353,resolution:.597164283559817}),new y({level:19,scale:1128.497176,resolution:.298582141647617})]});a.type="web-tile";a.urlTemplate=null;return a}e(k,f);k.prototype.normalizeCtorArgs=
function(a,b){return"string"===typeof a?l.mixin({urlTemplate:a},b||{}):a};k.prototype.load=function(){var b=this,c=this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){if(!b.urlTemplate)throw new a("layer:load","WebTileLayer (title: '"+b.title+"', id: '"+b.id+"') is missing the required 'urlTemplate' property value");});this.addResolvingPromise(c);return this.when()};Object.defineProperty(k.prototype,"levelValues",{get:function(){var a=[];if(!this.tileInfo)return null;for(var b=0,c=this.tileInfo.lods;b<
c.length;b++){var d=c[b];a[d.level]=d.levelValue||d.level}return a},enumerable:!0,configurable:!0});k.prototype.readSpatialReference=function(a,b){return a||b.fullExtent&&b.fullExtent.spatialReference&&c.SpatialReference.fromJSON(b.fullExtent.spatialReference)};Object.defineProperty(k.prototype,"tileServers",{get:function(){if(!this.urlTemplate)return null;var a=[],b=this.subDomains,c=new h(this.urlTemplate),d=c.scheme?c.scheme+"://":"//",e=d+c.authority+"/";if(-1===c.authority.indexOf("{subDomain}"))a.push(e);
else if(b&&0<b.length&&1<c.authority.split(".").length)for(e=0;e<b.length;e++)a.push(d+c.authority.replace(/\{subDomain\}/gi,b[e])+"/");return a.map(function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a})},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"urlPath",{get:function(){if(!this.urlTemplate)return null;var a=this.urlTemplate,b=new h(a);return a.substring(((b.scheme?b.scheme+"://":"//")+b.authority+"/").length)},enumerable:!0,configurable:!0});k.prototype.readUrlTemplate=
function(a,b){return a||b.templateUrl};k.prototype.writeUrlTemplate=function(a,b,c){a&&q.isProtocolRelative(a)&&(a="https:"+a);b.templateUrl=a?q.normalize(a):a};k.prototype.fetchTile=function(a,c,d,e){a=this.getTileUrl(a,c,d);c={responseType:"image"};e&&e.timestamp&&(c.query={_ts:e.timestamp});return b(a,c).then(function(a){return a.data})};k.prototype.getTileUrl=function(a,b,c){a=this.levelValues[a];var e=this.tileServers[b%this.tileServers.length]+d.substitute(this.urlPath,{level:a,col:c,row:b});
return e=e.replace(/\{level\}/gi,""+a).replace(/\{row\}/gi,""+b).replace(/\{col\}/gi,""+c)};k.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return p.create(function(a){return m(["../views/2d/layers/TileLayerView2D"],a)});case "3d":return p.create(function(a){return m(["../views/3d/layers/TileLayerView3D"],a)})}};g([r.property({type:String,value:"",json:{write:!0}})],k.prototype,"copyright",void 0);g([r.property({type:c.Extent,json:{write:!0}})],k.prototype,"fullExtent",void 0);
g([r.property({json:{read:{source:"showLegend"},write:{target:"showLegend"}}})],k.prototype,"legendEnabled",void 0);g([r.property({dependsOn:["tileInfo"]})],k.prototype,"levelValues",null);g([r.property(z.popupEnabled)],k.prototype,"popupEnabled",void 0);g([r.property({type:c.SpatialReference})],k.prototype,"spatialReference",void 0);g([r.reader("spatialReference",["spatialReference","fullExtent.spatialReference"])],k.prototype,"readSpatialReference",null);g([r.property({type:[String],json:{write:!0}})],
k.prototype,"subDomains",void 0);g([r.property({type:A,json:{write:!0}})],k.prototype,"tileInfo",void 0);g([r.property({readOnly:!0,dependsOn:["urlTemplate","subDomains"]})],k.prototype,"tileServers",null);g([r.property({json:{read:!1}})],k.prototype,"type",void 0);g([r.property({dependsOn:["urlTemplate"]})],k.prototype,"urlPath",null);g([r.property({type:String,json:{origins:{"portal-item":{read:{source:"url"}}}}})],k.prototype,"urlTemplate",void 0);g([r.reader("urlTemplate",["urlTemplate","templateUrl"])],
k.prototype,"readUrlTemplate",null);g([r.writer("urlTemplate",{templateUrl:{type:String}})],k.prototype,"writeUrlTemplate",null);g([r.property({json:{write:!1}})],k.prototype,"url",void 0);g([r.property({json:{write:!0}})],k.prototype,"wmtsInfo",void 0);return k=g([r.subclass("esri.layers.WebTileLayer")],k)}(r.declared(t,w,n,v,u,x))})},"esri/layers/support/WMTSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ./TileMatrixSet ./WMTSStyle".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return function(g){function f(a){a=g.call(this)||this;a.fullExtent=null;a.imageFormats=null;a.id=null;a.layer=null;a.styles=null;a.tileMatrixSetId=null;a.tileMatrixSets=null;return a}k(f,g);h=f;Object.defineProperty(f.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});f.prototype.readFullExtent=function(a,c,d){return(a=c.fullExtent)?b.fromJSON(a):null};Object.defineProperty(f.prototype,
"imageFormat",{get:function(){var a=this._get("imageFormat");a||(a=this.imageFormats&&this.imageFormats.length?this.imageFormats[0]:"");return a},set:function(a){if(-1<a.indexOf("image/")||-1===this.imageFormats.indexOf(a))if(-1===a.indexOf("image/")&&(a="image/"+a),this.imageFormats&&-1===this.imageFormats.indexOf(a)){console.error("The layer doesn't support the format of "+a);return}this._set("imageFormat",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"styleId",{get:function(){var a=
this._get("styleId");a||(a=this.styles&&this.styles.length?this.styles.getItemAt(0).id:"");return a},set:function(a){this._set("styleId",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"tileMatrixSet",{get:function(){var a=this;return this.tileMatrixSets.find(function(b){return b.id===a.tileMatrixSetId})},enumerable:!0,configurable:!0});
f.prototype.clone=function(){var a=new h;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("imageFormats")&&(a.imageFormats=this.imageFormats&&this.imageFormats.slice());this.hasOwnProperty("imageFormat")&&(a.imageFormat=this.imageFormat);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("styleId")&&(a.styleId=
this.styleId);this.hasOwnProperty("styles")&&(a.styles=this.styles&&this.styles.clone());this.hasOwnProperty("tileMatrixSetId")&&(a.tileMatrixSetId=this.tileMatrixSetId);this.hasOwnProperty("tileMatrixSets")&&(a.tileMatrixSets=this.tileMatrixSets.clone());this.hasOwnProperty("title")&&(a.title=this.title);return a};var h;e([c.property()],f.prototype,"description",null);e([c.property()],f.prototype,"fullExtent",void 0);e([c.reader("fullExtent",["fullExtent"])],f.prototype,"readFullExtent",null);e([c.property({dependsOn:["imageFormats"]})],
f.prototype,"imageFormat",null);e([c.property({json:{read:{source:"formats"}}})],f.prototype,"imageFormats",void 0);e([c.property()],f.prototype,"id",void 0);e([c.property()],f.prototype,"layer",void 0);e([c.property()],f.prototype,"styleId",null);e([c.property({type:d.ofType(l),json:{read:{source:"styles"}}})],f.prototype,"styles",void 0);e([c.property({value:null,json:{write:{ignoreOrigin:!0}}})],f.prototype,"title",null);e([c.property()],f.prototype,"tileMatrixSetId",void 0);e([c.property({readOnly:!0,
dependsOn:["tileMatrixSetId"]})],f.prototype,"tileMatrixSet",null);e([c.property({type:d.ofType(a),json:{read:{source:"tileMatrixSets"}}})],f.prototype,"tileMatrixSets",void 0);return f=h=e([c.subclass("esri.layers.support.WMTSSublayer")],f)}(c.declared(h))})},"esri/layers/support/TileMatrixSet":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.fullExtent=null;a.id=null;a.tileInfo=null;return a}k(b,c);a=b;b.prototype.clone=function(){var b=new a;this.hasOwnProperty("fullExtent")&&(b.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(b.id=this.id);this.hasOwnProperty("tileInfo")&&(b.tileInfo=this.tileInfo&&this.tileInfo.clone());return b};var a;e([h.property({json:{read:{source:"fullExtent"}}})],b.prototype,"fullExtent",void 0);e([h.property({json:{read:{source:"id"}}})],
b.prototype,"id",void 0);e([h.property({json:{read:{source:"tileInfo"}}})],b.prototype,"tileInfo",void 0);return b=a=e([h.subclass("esri.layer.support.TileMatrixSet")],b)}(h.declared(d))})},"esri/layers/support/WMTSStyle":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||
this;a.id=null;a.title=null;a.description=null;a.legendUrl=null;return a}k(b,c);a=b;b.prototype.clone=function(){var b=new a;this.hasOwnProperty("description")&&(b.description=this.description);this.hasOwnProperty("id")&&(b.id=this.id);this.hasOwnProperty("isDefault")&&(b.isDefault=this.isDefault);this.hasOwnProperty("keywords")&&(b.keywords=this.keywords&&this.keywords.slice());this.hasOwnProperty("legendUrl")&&(b.legendUrl=this.legendUrl);this.hasOwnProperty("title")&&(b.title=this.title);return b};
var a;e([h.property({json:{read:{source:"id"}}})],b.prototype,"id",void 0);e([h.property({json:{read:{source:"title"}}})],b.prototype,"title",void 0);e([h.property({json:{read:{source:"abstract"}}})],b.prototype,"description",void 0);e([h.property({json:{read:{source:"legendUrl"}}})],b.prototype,"legendUrl",void 0);e([h.property({json:{read:{source:"isDefault"}}})],b.prototype,"isDefault",void 0);e([h.property({json:{read:{source:"keywords"}}})],b.prototype,"keywords",void 0);return b=a=e([h.subclass("esri.layer.support.WMTSStyle")],
b)}(h.declared(d))})},"esri/layers/support/wmtsUtils":function(){define("require exports ../../core/Error ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/WKIDUnitConversion ./TileInfo".split(" "),function(m,f,k,e,g,d,h,c){function b(a,b){return(a=b.getElementsByTagName(a))&&0<a.length?a[0]:null}function a(a,b){return Array.prototype.slice.call(b.getElementsByTagName(a)).map(function(a){return a.textContent})}function l(a,c){a.split("\x3e").forEach(function(a){c=
b(a,c)});return c&&c.textContent}function n(a,c,d,e){var g;Array.prototype.slice.call(e.childNodes).some(function(e){if(-1<e.nodeName.indexOf(a)){var f=b(c,e),f=f&&f.textContent;return f===d||d.split(":")&&d.split(":")[1]===f?(g=e,!0):!1}});return g}function p(b){var c=[],d=A[b],e=Array.prototype.slice.call(d.getElementsByTagName("ResourceURL")),d=d.getElementsByTagName("Dimension"),g,f,h,k;d.length&&(g=l("Identifier",d[0]),f=a("Default",d[0])||a("Value",d[0]));1<d.length&&(h=l("Identifier",d[1]),
k=a("Default",d[1])||a("Value",d[1]));y[b]={dimensions:f,dimensions2:k};e.forEach(function(a){var b=a.getAttribute("template");if(g&&f.length)if(-1<b.indexOf("{"+g+"}"))b=b.replace("{"+g+"}","{dimensionValue}");else{var d=b.toLowerCase().indexOf("{"+g.toLowerCase()+"}");-1<d&&(b=b.substring(0,d)+"{dimensionValue}"+b.substring(d+g.length+2))}h&&k.length&&(-1<b.indexOf("{"+h+"}")?b=b.replace("{"+h+"}","{dimensionValue2}"):(d=b.toLowerCase().indexOf("{"+h.toLowerCase()+"}"),-1<d&&(b=b.substring(0,d)+
"{dimensionValue2}"+b.substring(d+h.length+2))));c.push({template:b,format:a.getAttribute("fomrat"),resourceType:a.getAttribute("resourceType")})});return c}function q(c,d){return Array.prototype.slice.call(c.getElementsByTagName("Style")).map(function(c){var e=b("LegendURL",c),g=b("Keywords",c),g=g&&a("Keyword",g),e=e&&e.getAttribute("xlink:href");d&&(e=e&&e.replace(/^http:/i,"https:"));return{abstract:l("Abstract",c),id:l("Identifier",c),isDefault:"true"===c.getAttribute("isDefault"),keywords:g,
legendUrl:e,title:l("Title",c)}})}function r(b,c){return a("TileMatrixSet",b).map(function(a){return t(a,b,c)})}function t(d,e,g){e=n("TileMatrixSetLink","TileMatrixSet",d,e);e=a("TileMatrix",e);var f=n("TileMatrixSet","Identifier",d,g);g=w(f);var h=g.spatialReference,k=h.wkid,m=b("TileMatrix",f),m=[parseInt(l("TileWidth",m),10),parseInt(l("TileHeight",m),10)],p=[];e.length?e.forEach(function(a,b){a=n("TileMatrix","Identifier",a,f);p.push(x(a,k,b,d))}):Array.prototype.slice.call(f.getElementsByTagName("TileMatrix")).forEach(function(a,
b){p.push(x(a,k,b,d))});e=u(f,g,m,p[0]);return{id:d,fullExtent:e,tileInfo:new c({dpi:96,spatialReference:h,size:m,origin:g,lods:p})}}function w(a){var c=l("SupportedCRS",a);c&&(c=c.toLowerCase());var e=parseInt(c.split(":").pop(),10);if(900913===e||3857===e)e=102100;var f=!1;if(-1<c.indexOf("crs84")||-1<c.indexOf("crs:84"))e=4326,f=!0;else if(-1<c.indexOf("crs83")||-1<c.indexOf("crs:83"))e=4269,f=!0;else if(-1<c.indexOf("crs27")||-1<c.indexOf("crs:27"))e=4267,f=!0;var h=new d({wkid:e});a=b("TileMatrix",
a);var k=l("TopLeftCorner",a).split(" ");a=k[0].split("E").map(function(a){return Number(a)});var k=k[1].split("E").map(function(a){return Number(a)}),m=a[0],n=k[0],p;1<a.length&&(m=a[0]*Math.pow(10,a[1]));1<k.length&&(n=k[0]*Math.pow(10,k[1]));var q=f&&4326===e&&90===m&&-180===n;z.some(function(a,b){var d=Number(c.split(":").pop());if(d>=a[0]&&d<=a[1]||4326===e&&(!f||q))return p=new g(n,m,h),!0;b===z.length-1&&(p=new g(m,n,h));return!1});return p}function u(a,c,d,g){var f=b("BoundingBox",a),h,k;
f&&(h=l("LowerCorner",f).split(" "),k=l("UpperCorner",f).split(" "));h&&1<h.length&&k&&1<k.length?(a=parseFloat(h[0]),d=parseFloat(h[1]),h=parseFloat(k[0]),k=parseFloat(k[1])):(a=b("TileMatrix",a),h=parseFloat(l("MatrixWidth",a)),f=parseFloat(l("MatrixHeight",a)),a=c.x,k=c.y,h=a+h*d[0]*g.resolution,d=k-f*d[1]*g.resolution);return new e(a,d,h,k,c.spatialReference)}function x(a,b,c,d){var e=l("Identifier",a);a=l("ScaleDenominator",a).split("E").map(function(a){return Number(a)});a=1<a.length?a[0]*Math.pow(10,
a[1]):a[0];b=v(b,a,d);return{level:c,levelValue:e,scale:1.058267716535433*a,resolution:b}}function v(a,b,c){a=h.hasOwnProperty(String(a))?h.values[h[a]]:"default028mm"===c?6370997*Math.PI/180:6378137*Math.PI/180;return 7*b/25E3/a}Object.defineProperty(f,"__esModule",{value:!0});var z=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],
[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],
[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],
[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],y=new Map,A=new Map;f.parseCapabilities=function(c,d){c=c.replace(/ows:/gi,"");c=(new DOMParser).parseFromString(c,"text/xml").documentElement;var e=b("Contents",c);if(!e)throw new k("wmtslayer:wmts-capabilities-xml-is-not-valid");
var g=b("OperationsMetadata",c),g=(g=(g=g&&g.querySelector("[name\x3d'GetTile']"))&&g.getElementsByTagName("Get"))&&Array.prototype.slice.call(g),f=d.url&&-1<d.url.indexOf("https"),h=d.serviceMode,m,p,t;g&&g.length&&g.some(function(a){var c=b("Constraint",a);if(!c||n("AllowedValues","Value",h,c))return p=a.attributes[0].nodeValue,!0;if(!c||n("AllowedValues","Value","RESTful",c)||n("AllowedValues","Value","REST",c))t=a.attributes[0].nodeValue;else if(!c||n("AllowedValues","Value","KVP",c))m=a.attributes[0].nodeValue;
return!1});p||(t?(p=t,h="RESTful"):m?(p=m,h="KVP"):p=b("ServiceMetadataURL",c).getAttribute("xlink:href"));d=p.indexOf("1.0.0/");-1===d&&"RESTful"===h?p+="/":-1<d&&(p=p.substring(0,d));"KVP"===h&&(p+=-1<d?"":"?");f&&(p=p.replace(/^http:/i,"https:"));d=l("ServiceIdentification\x3eAccessConstraints",c);c=Array.prototype.slice.call(e.getElementsByTagName("Layer")).map(function(c){var d=l("Identifier",c);A[d]=c;var g=l("Abstract",c),h=a("Format",c),k,m=b("WGS84BoundingBox",c);k=m?l("LowerCorner",m).split(" "):
["-180","-90"];m=m?l("UpperCorner",m).split(" "):["180","90"];k={xmin:parseFloat(k[0]),ymin:parseFloat(k[1]),xmax:parseFloat(m[0]),ymax:parseFloat(m[1]),spatialReference:{wkid:4326}};var m=q(c,f),n=l("Title",c);c=r(c,e);return{id:d,fullExtent:k,description:g,formats:h,styles:m,title:n,tileMatrixSets:c}});return{copyright:d,layers:c,tileUrl:p,serviceMode:h}};f.parseResourceInfo=function(a){a.layers.forEach(function(a){a.tileMatrixSets.forEach(function(a){var b=a.tileInfo;96!==b.dpi&&(b.lods.forEach(function(c){c.scale=
96*c.scale/b.dpi;c.resolution=v(b.spatialReference.wkid,90.71428571428571*c.scale/96,a.id)}),b.dpi=96)})});return a};f.getTileUrlFromResourceUrls=function(a,b,c,d,e,g){var f=p(a),h=y[a].dimensions&&y[a].dimensions[0];a=y[a].dimensions2&&y[a].dimensions2[0];var l="";f&&0<f.length&&(l=f[e%f.length].template.replace(/\{Style\}/gi,c).replace(/\{TileMatrixSet\}/gi,b).replace(/\{TileMatrix\}/gi,d).replace(/\{TileRow\}/gi,e).replace(/\{TileCol\}/gi,g).replace(/\{dimensionValue\}/gi,h).replace(/\{dimensionValue2\}/gi,
a));return l};f.getTileUrlTemplateFromResourceUrls=function(a,b,c,d){c=p(a);var e="";if(c&&0<c.length){var g=y[a].dimensions&&y[a].dimensions[0];a=y[a].dimensions2&&y[a].dimensions2[0];e=c[0].template;e.indexOf(".xxx")===e.length-4&&(e=e.slice(0,e.length-4));e=e.replace(/\{Style\}/gi,d);e=e.replace(/\{TileMatrixSet\}/gi,b);e=e.replace(/\{TileMatrix\}/gi,"{level}");e=e.replace(/\{TileRow\}/gi,"{row}");e=e.replace(/\{TileCol\}/gi,"{col}");e=e.replace(/\{dimensionValue\}/gi,g);e=e.replace(/\{dimensionValue2\}/gi,
a)}return e}})},"esri/layers/UnknownLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/scheduling ../core/accessorSupport/decorators ./Layer ./mixins/PortalLayer".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){return function(a){function d(b){b=a.call(this)||this;b.resourceInfo=null;b.type="unknown";return b}k(d,a);d.prototype.initialize=function(){var a=this;this.addResolvingPromise(h.create(function(b,
d){c.schedule(function(){var b=a.resourceInfo&&(a.resourceInfo.layerType||a.resourceInfo.type),c="Unknown layer type";b&&(c+=" "+b);d(new g("layer:unknown-layer-type",c,{layerType:b}))})}))};d.prototype.read=function(a,b){this.inherited(arguments,[{resourceInfo:a},b]);return this};d.prototype.write=function(a,b){return null};e([b.shared("esri.layers.UnknownLayer")],d.prototype,"declaredClass",void 0);e([b.property({readOnly:!0})],d.prototype,"resourceInfo",void 0);e([b.property({json:{read:!1},readOnly:!0,
value:"unknown"})],d.prototype,"type",void 0);return d=e([b.subclass()],d)}(b.declared(a,d,l))})},"webSceneViewer/support/spatialReferenceUtils":function(){define("require exports esri/config esri/core/promiseUtils esri/geometry/SpatialReference esri/geometry/Point esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters".split(" "),function(m,f,k,e,g,d,h,c,b){function a(){f.geometryService||(f.geometryService=new c({url:k.geometryServiceUrl,requestOptions:{authMode:"no-prompt"}}));
return f.geometryService}Object.defineProperty(f,"__esModule",{value:!0});f.isSpatialReferenceSupported=function(a,b){if(null==b)return!1;if("global"===a)return b.isWebMercator||b.isWGS84;if("local"===a)return!b.isGeographic};f.geometryService=null;f.geometryServiceInstance=a;f.projectGeometries=function(c,d){var g={},f=Array(c.length);c.forEach(function(a,b){if(a.spatialReference.equals(d))f[b]=a;else if(h.canProject(a,d))f[b]=h.project(a,d);else{var c;c=a.spatialReference;c=a.type+"/"+(c.wkid?c.wkid.toString():
c.wkt);var e=g[c];e||(e={geometries:[],indices:[]},g[c]=e);e.geometries.push(a);e.indices.push(b)}});c=[];var l=a(),k;for(k in g){var m=g[k],n=new b;n.geometries=m.geometries;n.outSpatialReference=d;m=function(a){return function(b){b.forEach(function(b,c){"extent"===b.type&&isNaN(b.xmin)||"point"===b.type&&isNaN(b.x)?f[a[c]]=null:f[a[c]]=b})}}(m.indices);c.push(l.project(n).then(m))}return e.eachAlways(c).then(function(){return f})};f.testGeometryService=function(c){void 0===c&&(c=new d(0,0));var e=
a(),f=new b;f.outSpatialReference=g.WGS84;f.geometries=[c];return e.project(f)}})},"webSceneViewer/support/errorUtils":function(){define("require exports esri/WebScene esri/core/Error esri/layers/TileLayer esri/layers/DynamicLayer esri/layers/FeatureLayer esri/layers/ElevationLayer esri/layers/SceneLayer esri/layers/IntegratedMeshLayer esri/layers/PointCloudLayer esri/layers/GroupLayer esri/layers/VectorTileLayer esri/layers/ImageryLayer esri/layers/WMSLayer esri/layers/WMTSLayer ./ErrorMessage dojo/string dojo/i18n!webSceneViewer/nls/viewer dojo/i18n!webSceneViewer/editor/nls/editor dojox/html/entities".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z){function y(a,b){for(var c in b);return u.substitute(a,b)}function A(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return a&&a instanceof e?b.length?a.name!==b[0]?!1:1<b.length?A.apply(void 0,[a.details&&a.details.error].concat(b.slice(1))):!0:!0:!1}function B(a){switch(a){case 401:case 403:return L.http.statusUnauthorized;case 404:case void 0:return L.http.statusNotFound;case 503:return L.http.statusTemporarilyUnavailable;default:return null}}
function C(a){return a.name&&0===a.name.indexOf("request:")}function E(a){var b=D(a,M),c=D(a,F);return new w.default(b,N(a.error),"error",a.error,c)}function D(a,b){var c=a.action+"Title";return(b=(a=a.scene)&&b(a))?y(L.webscene["namedCannotBe"+c],{sceneName:b}):L.webscene["cannotBe"+c]}function F(a){var b;b=a.portalItem?a.portalItem.portal.getItemLink(a.portalItem):void 0;return(a=M(a))?(a=z.encode(a),b?'\x3ca href\x3d"'+z.encode(b)+'" target\x3d"_blank"\x3e'+a+"\x3c/a\x3e":"\x3ci\x3e"+a+"\x3c/i\x3e"):
null}function M(a){return a.portalItem?a.portalItem.title:null}function N(a){if(C(a)){var b=B(a.details.httpStatus)||a.details.httpStatus;return y(L.webscene.loadFailResourceUnavailable,{statusMessage:b})}switch(a.name){case "webscene:load-portal-item":b=P(a.details.error,["identity-manager:not-authorized"]);if(C(b))if(b.details.messageCode)switch(b.details.httpStatus){case 400:case void 0:return L.webscene.loadFailItemNotFound;case 403:return L.webscene.loadFailItemInaccessible}else switch(b.details.httpStatus){case 401:case 403:return L.webscene.loadFailItemInaccessible;
case 404:case void 0:return L.webscene.loadFailItemNotFound}return y(L.webscene.loadFailItemGeneric,{itemError:R(b)});case "webscene:invalid-version":return(b=a.details.version)?y(L.webscene.loadFailInvalidVersion,{version:a.details.version}):L.webscene.loadFailMissingVersion;case "webscene:empty-resource":return L.webscene.loadFailEmptyResource;case "webscene:unsupported-version":return b=a.details.version,a=k.VERSION,b.major<a.major?y(L.webscene.loadFailUnsupportedVersionTooOld,{version:b.major+
"."+b.minor,requiredMajorVersion:a.major}):y(L.webscene.loadFailUnsupportedVersionTooNew,{version:b.major+"."+b.minor,latestVersion:a.major+"."+a.minor});case "webscene:invalid-portal-item":return y(L.webscene.loadFailItemInvalidType,{type:a.details.type});case "webscene:unsupported-spatial-reference":return"global"===a.details.viewingMode?y(L.webscene.validateInvalidSceneSpatialReferenceGlobal,{sceneSpatialReference:a.details.spatialReference.wkid}):y(L.webscene.validateInvalidSceneSpatialReferenceLocal,
{sceneSpatialReference:a.details.spatialReference.wkid});case "webscene:incompatible-camera-spatial-reference":return"global"===a.details.viewingMode?y(L.webscene.validateInvalidCameraSpatialReferenceGlobal,{cameraSpatialReference:a.details.cameraSpatialReference.wkid}):y(L.webscene.validateInvalidCameraSpatialReferenceLocal,{cameraSpatialReference:a.details.cameraSpatialReference.wkid,sceneSpatialReference:a.details.sceneSpatialReference.wkid});case "webscene:incompatible-slide-spatial-reference":return"global"===
a.details.viewingMode?y(L.webscene.validateInvalidSlideSpatialReferenceGlobal,{slideSpatialReference:a.details.slideSpatialReference.wkid}):y(L.webscene.validateInvalidSlideSpatialReferenceLocal,{slideSpatialReference:a.details.slideSpatialReference.wkid,sceneSpatialReference:a.details.sceneSpatialReference.wkid});case "webscene:unsupported-height-model-info":return L.webscene.validateInvalidHeightModelInfo;case "webscene:incompatible-height-unit":return y(L.webscene.validateInvalidHeightUnit,{verticalUnit:a.details.verticalUnit,
horizontalUnit:a.details.horizontalUnit});case "wsv:initialize-timeout":return L.webscene.loadFailTimeout;default:return R(a)}}function I(a){var b=O(a),c=Q(a),d;d="ABORTED"===a.error.message?"warning":"error";var e=G(a,J);return new w.default(b,c,d,a.error,e)}function G(a,b){var c=a.action+"Title",d;d=a.layer;if(a.isSubLayerError){var e;b:{for(e=a.error;e&&e.details;){if(e.details.layer){e=e.details.layer;break b}e=e.details.error}e=null}d={layer:d,subLayer:e}}else d=d&&d.parent&&d.parent.isInstanceOf(n)?
{layer:d.parent,subLayer:d}:void 0;return d?(a=d.layer,d=(d=d.subLayer)&&b(d),b=a&&b(a),d?b?y(L.layer["subLayerNamedCannotBe"+c],{subLayerName:d,parentLayerName:b}):y(L.layer["namedCannotBe"+c],{layerName:d}):b?y(L.layer["subLayerCannotBe"+c],{parentLayerName:b}):L.layer["cannotBe"+c]):(b=(a=a.layer)&&b(a))?y(L.layer["namedCannotBe"+c],{layerName:b}):L.layer["cannotBe"+c]}function O(a){return G(a,function(a){return a.title})}function J(a){var b;b=a.portalItem?a.portalItem.portal.getItemLink(a.portalItem):
a.url?a.url:a.resourceInfo&&"string"===typeof a.resourceInfo.url?a.resourceInfo.url:void 0;a=a.title?a.title:a.resourceInfo&&"string"===typeof a.resourceInfo.title?a.resourceInfo.title:null;return a?(a=z.encode(a),b?'\x3ca href\x3d"'+z.encode(b)+'" target\x3d"_blank"\x3e'+a+"\x3c/a\x3e":"\x3ci\x3e"+a+"\x3c/i\x3e"):null}function Q(a){var b=a.error;A(b,"wsv-layer-utils:group-layer-failed")&&(b=b.details.errors[0]);b=P(b,["websceneviewer:cannot-drop-basemap","layerview:create-error","wsv-scene:load-invalid-layer-item",
"wsv-scene:load-invalid-layer-url"]);if("ABORTED"===b.message)return L.signInCancelled;if(C(b)){a=b.details.httpStatus;if(b.details.messageCode){switch(a){case 403:return L.layer.itemInaccessible;case 400:case void 0:return L.layer.itemNotFound}return y(L.layer.itemGeneric,{itemError:R(b)})}switch(a){case 401:case 403:return L.layer.serviceInaccessible;case 404:case void 0:return L.layer.serviceNotFound}return(a=B(a))?y(L.layer.serviceGeneric,{serviceError:a}):L.layer.serviceNotFound}var c;switch(b.name){case "layerview:spatial-reference-incompatible":return c=
A(b,"layerview:spatial-reference-incompatible","tilingscheme:global-unsupported-spatial-reference")?y(L.layer.mustBeInGlobalSR,{layerType:a.layerType}):"basemap-warning"===a.contextType?y(L.layer.mustMatchLayerSR,{layerType:a.layerType,wkid:a.sceneWKID}):y(L.layer.mustMatchSR,{layerType:a.layerType,wkid:a.sceneWKID}),b=(b=(b=b.details&&b.details.layer||a.layer)&&b.spatialReference)?!(b.isWebMercator||b.isGeographic):!1,"layer-add"!==a.contextType&&"layer-load"!==a.contextType||!b?c:c+" "+L.layer.createNewLocalScene;
case "layerview:tiling-scheme-unsupported":case "layerview:tiling-scheme-incompatible":case "layerview:no-applicable-tiling-scheme":return H(b,a.layerType);case "layerview:local-gcs-not-supported":return y(L.layer.localGCSNotSupported,{layerType:a.layerType});case "layerview:service-version-too-old":return y(L.layer.serviceMinVersion,{layerType:a.layerType,minVersion:b.details.minVersion,serverVersion:b.details.detectedVersion||""});case "layerview:unsupported-height-model-info":return a=y(L.layer.unsupportedHeightModelInfo,
{layerType:a.layerType}),(b=b.details.error)&&"layerview:unmatched-height-unit"===b.name&&(a+=" "+y(L.layer.mustMatchHeightUnitHorizontal,{horizontalUnit:b.details.horizontalUnit})),a;case "layerview:incompatible-height-model-info":a=y(L.layer.incompatibleHeightModelInfo,{layerType:a.layerType});b=b.details.error;switch(b&&b.name){case "layerview:incompatible-height-unit":a+=" "+y(L.layer.mustMatchHeightUnit,{layerUnit:b.details.layerUnit,sceneUnit:b.details.sceneUnit});break;case "layerview:incompatible-height-model":a+=
" "+y(L.layer.mustMatchHeightModel,{layerHeightModel:b.details.layerHeightModel,sceneHeightModel:b.details.sceneHeightModel});break;case "layerview:incompatible-vertical-datum":a+=" "+y(L.layer.mustMatchDatum,{layerDatum:b.details.layerDatum,sceneDatum:b.details.sceneDatum})}return a;case "tiledlayerview3d:service-missing-cors-patch":return y(L.layer.tiledMapMinVersionPatch,{patchName:"ArcGIS 10.2.2 for Server Patch - View Map and Image Services in the ArcGIS Online Scene Viewer"});case "featurelayerview3d:maximum-feature-count-exceeded":return c=
L.layer.featureServiceNotSupportedMaxFeatures+" "+b.details.numberOfFeatures+"/"+b.details.maximumFeatureCount+".",(b=b.details&&b.details.layer||a.layer)&&"point"===b.geometryType&&(c+=" "+L.layer.publishSceneLayer+"."),c;case "featurelayerview3d:create-controller":if((b=b.details&&b.details.error)&&"graphicscontroller:query-capability-required"===b.name)return L.layer.mapImageSublayerQueryUnsupported;case "layer:unsupported-layer-type":return L.layer.typeNotSupported;case "layer:unknown-layer-type":return L.layer.typeNotSupported+
" "+L.layer.removedFromScene;case "arcgis-layers:url-mismatch":return L.layer.serviceNotArcGIS;case "sceneservice:root-node-missing":return L.layer.sceneServiceRootNodeMissing;case "scenelayer:layer-type-not-supported":return L.layer.typeNotSupported;case "layer:service-version-not-supported":return y(L.layer.versionNotSupported,{layerType:K(a.layer),serviceVersion:b.details.serviceVersion,supportedVersions:b.details.supportedVersions});case "layer:service-version-too-new":return y(L.layer.versionTooNew,
{layerType:K(a.layer),serviceVersion:b.details.serviceVersion,supportedVersions:b.details.supportedVersions});case "feature-layer:source-type-not-supported":if("Table"===b.details.sourceType)return L.layer.featureServiceNotSupportedTable;case "wmtslayer:unsupported-service-data":return L.layer.serviceNotFound;case "featurelayerview3d:unsupported-geometry-type":if("multipatch"===b.details.geometryType)return L.layer.featureServiceNotSupportedMultipatch;if("multipoint"===b.details.geometryType)return L.layer.featureServiceNotSupportedMultipoint;
case "wsv-validatelayers:unsupported-operational-layer-type":case "wsv-validatelayers:unsupported-ground-layer-type":switch(b.details.operationalLayerType){case "ArcGISImageServiceLayer":return L.layer.typeNotSupported+" "+L.imageServicesCached;case "ArcGISTiledImageServiceLayer":return L.layer.typeNotSupported+" "+L.elevationImageServicesCached;default:return a.layer&&a.layer.portalItem?L.layerItemTypeNotSupported+" "+K(a.layer):L.layer.typeNotSupported+" ("+K(a.layer)+")"}case "portal:unsupported-item-type-as-group":return L.layerItemTypeNotSupported+
" "+K(a.layer);case "wsv:layer-symbology":if(a.layer.renderer){if("service"===a.layer.originOf("renderer"))return L.layer.displaysWithServiceSymbology;if("portal-item"===a.layer.originOf("renderer"))return L.layer.displaysWithItemSymbology}else return L.layer.symbologyNotSupported;case "symbol:unsupported":return y(L.layer.unsupportedSymbolType,{symbolType:b.details.definition.type||"unknown"});case "renderer:unsupported":return b=y(L.layer.unsupportedRenderer,{rendererType:b.details.definition.type||
"unknown"}),"service"===a.layer.originOf("renderer")?b+=". "+L.layer.displaysWithServiceSymbology:"portal-item"===a.layer.originOf("renderer")&&(b+=". "+L.layer.displaysWithItemSymbology),b;case "renderer-conversion-3d:unsupported-symbols":return L.layer.symbologyNotSupported}return R(b)}function H(a,b){if("layerview:tiling-scheme-incompatible"===a.name)return y(L.layer.incompatibleTilingScheme,{layerType:b});if("layerview:tiling-scheme-unsupported"===a.name)switch(a=a.details.error,a.name){case "tilingscheme:incompatible-global-web-mercator":return y(L.layer.mustMatchTilingSchemeWebMercator,
{layerType:b})+" "+L.layer.createNewLocalScene;case "tilingscheme:incompatible-global-wgs84":return y(L.layer.mustMatchTilingSchemeWGS84,{layerType:b});case "tilingscheme:power-of-two":return y(L.layer.unsupportedTilingSchemePowerOfTwo,{layerType:b});case "tilingscheme:tile-size":return y(L.layer.unsupportedTilingSchemeTileSize,{layerType:b});case "tilingscheme:gaps":return y(L.layer.unsupportedTilingSchemeGaps,{layerType:b});case "tilingscheme:too-many-root-tiles":return y(L.layer.tooManyRootTiles,
{layerType:b,minScale:a.details.suggestedLevel0Scale});default:return y(L.layer.unsupportedTilingSchemeGeneric,{layerType:b})}else{if("layerview:no-applicable-tiling-scheme"===a.name)return y(L.layer.noApplicableTilingScheme,{layerType:b});R(a)}}function K(e){if(!e)return L.layer.layer;if(e.portalItem&&e.portalItem.displayName)switch(e.portalItem.type){case "Feature Collection":return e.portalItem.displayName+" (collection)";case "Stream Service":return e.portalItem.displayName+" (stream service)";
default:return e.portalItem.displayName}return e instanceof g||e instanceof p?"Tile Layer":e instanceof d?"Map Image Layer":e instanceof h?"Feature Layer":e instanceof c?"Elevation Layer":e instanceof b||e instanceof a||e instanceof l?"Scene Layer":e instanceof q?"Imagery Layer":e instanceof r?"WMS Layer":e instanceof t?"WMTS Layer":L.layer.layer}function R(a){for(;a.details&&a.details.error;)a=a.details.error;return a.message?a.message:Array.isArray(a.details)&&0!==a.details.length?a.details.toString():
a.toString()}function P(a,b){for(;a.name&&a.details&&a.details.error&&!(0>b.indexOf(a.name));)a=a.details.error;return a}Object.defineProperty(f,"__esModule",{value:!0});var L=x.messages;f.emit=function(a,b){b&&a.errors.error(b)};f.layerAddError=function(a,b,c,d){void 0===c&&(c=null);void 0===d&&(d=!1);return I({layer:a,error:b,isSubLayerError:d,sceneWKID:c&&c.spatialReference&&c.spatialReference.wkid,viewingMode:c&&c.viewingMode,layerType:K(a),action:"Added",contextType:"layer-add"})};f.layerLoadError=
function(a,b,c,d){void 0===c&&(c=null);void 0===d&&(d=!1);return I({layer:a,error:b,isSubLayerError:d,sceneWKID:c&&c.spatialReference&&c.spatialReference.wkid,viewingMode:c&&c.viewingMode,layerType:K(a),action:"Loaded",contextType:"layer-load"})};f.layerWarning=function(a,b,c){void 0===c&&(c=!1);a=I({layer:a,error:b,isSubLayerError:c,layerType:K(a),action:"DisplayedAsExpected"});a.type="warning";return a};f.layerDisplaySymbologyWarning=function(a){a=I({layer:a,error:new e("wsv:layer-symbology","Layer symbology failed"),
layerType:K(a),action:"DisplayedAsExpected"});a.type="warning";return a};f.sceneImportError=function(a,b,c){void 0===c&&(c=null);return E({scene:a,error:b,sceneWKID:a&&a.initialViewProperties&&a.initialViewProperties.spatialReference&&a.initialViewProperties.spatialReference.wkid,viewingMode:c&&c.viewingMode,action:"Added"})};f.sceneCreateError=function(a){return new w.default(x.dialogs.webscene,N(a),"error",a)};f.basemapError=function(a,b,c){void 0===c&&(c=null);var d;switch(a.name){case "wsv-view:basemap-failure":case "wsv-setbasemapinteractive:basemap-failure":d=
a.details.errors[0];c=Q({layer:d.details.layer,error:d.details.error,isSubLayerError:!1,sceneWKID:c&&c.spatialReference&&c.spatialReference.wkid,viewingMode:c&&c.viewingMode,layerType:L.basemap.layerType,contextType:"error"===b?"basemap-error":"basemap-warning",action:"Loaded"});break;default:c=R(a)}switch(a.name){case "wsv-view:basemap-failure":d="warning"===b?L.BasemapDropWarningTitle:L.basemap.cannotBeLoadedTitle;break;case "wsv-setbasemapinteractive:basemap-failure":d=L.basemap.cannotBeSetTitle;
break;default:d=L.basemap.cannotBeLoadedTitle}return new w.default(d,c,b,a)};f.groundError=function(a,b,c){void 0===c&&(c=null);var d;switch(a.name){case "wsv-view:ground-failure":case "wsv-resetineractivedefaultground:ground-failure":d=a.details.errors[0];c=Q({layer:d.details.layer,error:d.details.error,isSubLayerError:!1,sceneWKID:c&&c.spatialReference&&c.spatialReference.wkid,viewingMode:c&&c.viewingMode,layerType:L.ground.layerType,contextType:"ground",action:"Loaded"});break;default:c=R(a)}switch(a.name){case "wsv-view:ground-failure":d=
L.ground.cannotBeLoadedTitle;break;case "wsv-resetineractivedefaultground:ground-failure":d=L.ground.cannotBeResetTitle;break;default:d=L.ground.cannotBeLoadedTitle}return new w.default(d,c,b,a)};f.groundResetError=function(a,b,c){void 0===c&&(c=null);switch(a.name){case "wsv-view:ground-failure":var d=a.details.errors[0];c=Q({layer:d.details.layer,error:d.details.error,isSubLayerError:!1,sceneWKID:c&&c.spatialReference&&c.spatialReference.wkid,viewingMode:c&&c.viewingMode,layerType:L.ground.layerType,
contextType:"ground",action:"Loaded"});return new w.default(L.ground.cannotBeResetTitle,c,b,a);default:return new w.default(L.ground.cannotBeResetTitle,R(a),b,a)}};f.isEsriError=A;f.isRequestError=C;f.sceneError=E;f.layerErrorMessage=Q;f.webSceneSaveError=function(a){return new w.default(v.dialogs.webSceneSaveFailed,R(a),"error",a)}})},"esri/layers/IntegratedMeshLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ../symbols/support/ElevationInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return function(a){function b(b,c){b=a.call(this)||this;b.geometryType="mesh";b.operationalLayerType="IntegratedMeshLayer";b.type="integrated-mesh";b.profile="mesh-pyramids";b.elevationInfo=null;return b}e(b,a);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};b.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return a._verifyRootNodeAndUpdateExtent()});
this.addResolvingPromise(b);return this.when()};b.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return h.reject(new d("integrated-mesh-layer:view-not-supported","IntegratedMeshLayer is only supported in 3D"));case "3d":return h.create(function(a){return m(["../views/3d/layers/SceneLayerView3D"],a)})}};b.prototype._validateLayer=function(a){if(a.layerType&&"IntegratedMesh"!==a.layerType)throw new d("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",
{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new d("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new d("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});};g([c.shared("esri.layers.IntegratedMeshLayer")],b.prototype,"declaredClass",void 0);g([c.property({type:String,
readOnly:!0})],b.prototype,"geometryType",void 0);g([c.property()],b.prototype,"operationalLayerType",void 0);g([c.property({json:{read:!1},readOnly:!0})],b.prototype,"type",void 0);g([c.property({type:l,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],b.prototype,"elevationInfo",void 0);return b=g([c.subclass()],b)}(c.declared(b,a))})},"esri/layers/PointCloudLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/lang ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ./pointCloudFilters/jsonUtils ./pointCloudFilters/typeUtils ./support/Field ../renderers/support/pointCloud/jsonUtils ../renderers/support/pointCloud/typeUtils ../symbols/support/ElevationInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v){function z(a,b,c){a&&((a=u.read(a,b,c)||void 0)||y.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var y=b.getLogger("esri.layers.PointCloudLayer");return function(b){function f(a,c){a=b.call(this)||this;a.operationalLayerType="PointCloudLayer";a.opacity=1;a.fields=null;a.legendEnabled=!0;a.renderer=null;a.type="point-cloud";return a}e(f,b);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?
k({url:a},b):a};f.prototype.readServiceFields=function(a,b,d){return Array.isArray(a)?a.map(function(a){var b=new w;"FieldTypeInteger"===a.type&&(a=c.clone(a),a.type="esriFieldTypeInteger");b.read(a,d);return b}):Array.isArray(b.attributeStorageInfo)?b.attributeStorageInfo.map(function(a){return new w({name:a.name,type:"ELEVATION"===a.name?"double":"integer"})}):null};Object.defineProperty(f.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this._validateElevationInfo()},enumerable:!0,
configurable:!0});f.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()});this.addResolvingPromise(b);return this.when()};f.prototype.importLayerViewModule=function(b){switch(b.type){case "2d":return a.reject(new h("point-cloud-layer:view-not-supported","PointCloudLayer is only supported in 3D"));case "3d":return a.create(function(a){return m(["../views/3d/layers/PointCloudLayerView3D"],a)})}};f.prototype._validateLayer=
function(a){if(a.layerType&&"PointCloud"!==a.layerType)throw new h("pointcloudlayer:layer-type-not-supported","PointCloudLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new h("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x-2.x"});if(2<this.version.major)throw new h("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x-2.x"});};f.prototype.hasCachedStatistics=function(a){return null!=this.attributeStorageInfo&&this.attributeStorageInfo.some(function(b){return b.name===a})};f.prototype.queryCachedStatistics=function(b){if(!this.hasCachedStatistics(b))return a.reject(new h("pointcloudlayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var c=0,e=this.attributeStorageInfo;c<e.length;c++){var g=e[c];if(g.name===b)return b=l.join(this.parsedUrl.path,"./statistics/"+
g.key),d(b,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};f.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("absolute-height"!==a.mode&&y.warn(".elevationInfo\x3d","Point cloud layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&y.warn(".elevationInfo\x3d","Point cloud layers do not support featureExpressionInfo"))};g([n.property({readOnly:!0})],f.prototype,"operationalLayerType",
void 0);g([n.property({readOnly:!0,json:{write:!1,read:!1}})],f.prototype,"opacity",void 0);g([n.property({types:[t.types],json:{origins:{service:{read:{source:"filters",reader:r.read}}},read:{source:"layerDefinition.filters",reader:r.read},write:{target:"layerDefinition.filters",writer:r.write}}})],f.prototype,"filters",void 0);g([n.property({type:[w]})],f.prototype,"fields",void 0);g([n.reader("service","fields",["fields","attributeStorageInfo"])],f.prototype,"readServiceFields",null);g([n.property({readOnly:!0})],
f.prototype,"attributeStorageInfo",void 0);g([n.property({value:null,type:v,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],f.prototype,"elevationInfo",null);g([n.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],f.prototype,"legendEnabled",void 0);g([n.property({types:x.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",
reader:z}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:z},write:{target:"layerDefinition.drawingInfo.renderer"}}})],f.prototype,"renderer",void 0);g([n.property({json:{read:!1},readOnly:!0})],f.prototype,"type",void 0);return f=g([n.subclass("esri.layers.PointCloudLayer")],f)}(n.declared(p,q))})},"esri/layers/pointCloudFilters/jsonUtils":function(){define("require exports ../../core/object ../../core/Warning ./PointCloudBitfieldFilter ./PointCloudReturnFilter ./PointCloudValueFilter".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});var c={pointCloudValueFilter:h,pointCloudBitfieldFilter:g,pointCloudReturnFilter:d};f.read=function(b,a,d){if(b&&Array.isArray(b))return b.map(function(a){var b=a?c[a.type]||null:null;if(b)return b=new b,b.read(a,d),b;d&&d.messages&&a&&d.messages.push(new e("point-cloud-filter:unsupported","Point cloud filters of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:d}))})};f.write=function(b,a,c,d){b=b.map(function(a){return a.write({},
d)});k.setDeepValue(c,b,a)};f.fromJSON=function(b){var a=b?c[b.type]||null:null;return a?a.fromJSON(b):null}})},"esri/layers/pointCloudFilters/PointCloudBitfieldFilter":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/lang ../../core/accessorSupport/decorators ./PointCloudFilter".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.requiredClearBits=null;a.requiredSetBits=null;a.type="bitfield";
return a}k(b,c);a=b;b.prototype.clone=function(){return new a({field:this.field,requiredClearBits:g.clone(this.requiredClearBits),requiredSetBits:g.clone(this.requiredSetBits)})};var a;e([d.property({type:[Number],json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!0,isRequired:!this.requiredSetBits}}}}})],b.prototype,"requiredClearBits",void 0);e([d.property({type:[Number],json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!0,isRequired:!this.requiredClearBits}}}}})],
b.prototype,"requiredSetBits",void 0);e([d.property()],b.prototype,"type",void 0);return b=a=e([d.subclass("esri.layers.pointCloudFilters.PointCloudBitfieldFilter")],b)}(d.declared(h))})},"esri/layers/pointCloudFilters/PointCloudFilter":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d,h){var c=d.strict()({pointCloudValueFilter:"value",
pointCloudBitfieldFilter:"bitfield",pointCloudReturnFilter:"return"});return function(b){function a(a){return b.call(this)||this}k(a,b);a.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};e([h.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"field",void 0);e([h.property({readOnly:!0,type:c.apiValues,nonNullable:!0,json:{read:!1,write:c.write}})],a.prototype,"type",void 0);return a=e([h.subclass("esri.layers.pointCloudFilters.PointCloudFilter")],
a)}(h.declared(g))})},"esri/layers/pointCloudFilters/PointCloudReturnFilter":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/lang ../../core/accessorSupport/decorators ./PointCloudFilter".split(" "),function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.includedReturns=[];a.type="return";return a}k(b,c);a=b;b.prototype.clone=function(){return new a({field:this.field,includedReturns:g.clone(this.includedReturns)})};
var a;e([d.property({type:[String],json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"includedReturns",void 0);e([d.property()],b.prototype,"type",void 0);return b=a=e([d.subclass("esri.layers.pointCloudFilters.PointCloudReturnFilter")],b)}(d.declared(h))})},"esri/layers/pointCloudFilters/PointCloudValueFilter":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/lang ../../core/accessorSupport/decorators ./PointCloudFilter".split(" "),
function(m,f,k,e,g,d,h){return function(c){function b(a){a=c.call(this)||this;a.mode="exclude";a.type="value";a.values=[];return a}k(b,c);a=b;b.prototype.clone=function(){return new a({field:this.field,mode:this.mode,values:g.clone(this.values)})};var a;e([d.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"mode",void 0);e([d.property()],b.prototype,"type",void 0);e([d.property({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"values",void 0);return b=
a=e([d.subclass("esri.layers.pointCloudFilters.PointCloudValueFilter")],b)}(d.declared(h))})},"esri/layers/pointCloudFilters/typeUtils":function(){define("require exports ./PointCloudBitfieldFilter ./PointCloudFilter ./PointCloudReturnFilter ./PointCloudValueFilter".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});f.types={key:"type",base:e,typeMap:{value:d,bitfield:k,return:g}}})},"esri/renderers/support/pointCloud/jsonUtils":function(){define("require exports ../../../core/Warning ../../PointCloudClassBreaksRenderer ../../PointCloudRGBRenderer ../../PointCloudStretchRenderer ../../PointCloudUniqueValueRenderer".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});var c={pointCloudClassBreaksRenderer:e,pointCloudRGBRenderer:g,pointCloudStretchRenderer:d,pointCloudUniqueValueRenderer:h};f.read=function(b,a,d){if(a=b?c[b.type]||null:null)return a=new a,a.read(b,d),a;d&&d.messages&&b&&d.messages.push(new k("renderer:unsupported","Renderers of type '"+(b.type||"unknown")+"' are not supported",{definition:b,context:d}));return null};f.fromJSON=function(b){var a=b?c[b.type]||null:null;return a?
a.fromJSON(b):null}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),function(m,f,k,e,g,d,h,c,b,a){return function(f){function l(a){a=f.call(this)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=
null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}e(l,f);m=l;l.prototype.clone=function(){return new m(k({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:d.clone(this.colorClassBreakInfos),legendOptions:d.clone(this.legendOptions)}))};var m;g([h.enumeration.serializable()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],l.prototype,"type",void 0);g([h.property({json:{write:!0},type:String})],l.prototype,"field",
void 0);g([h.property({type:b.default,json:{write:!0}})],l.prototype,"legendOptions",void 0);g([h.property({type:c.fieldTransformTypeKebabDict.apiValues,json:{type:c.fieldTransformTypeKebabDict.jsonValues,read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write}})],l.prototype,"fieldTransformType",void 0);g([h.property({type:[a.default],json:{write:!0}})],l.prototype,"colorClassBreakInfos",void 0);return l=m=g([h.subclass("esri.renderers.PointCloudClassBreaksRenderer")],l)}(h.declared(c))})},
"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){var n=d.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",
pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});m=function(d){function g(a){a=d.call(this)||this;a.type=void 0;a.pointSizeAlgorithm=null;a.colorModulation=null;a.pointsPerInch=10;return a}k(g,d);g.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};g.prototype.cloneProperties=function(){return{pointSizeAlgorithm:h.clone(this.pointSizeAlgorithm),colorModulation:h.clone(this.colorModulation),
pointsPerInch:h.clone(this.pointsPerInch)}};e([c.property({type:n.apiValues,readOnly:!0,nonNullable:!0,json:{type:n.jsonValues,read:!1,write:n.write}})],g.prototype,"type",void 0);e([c.property({types:l.pointSizeAlgorithmTypes,json:{read:a.read,write:!0}})],g.prototype,"pointSizeAlgorithm",void 0);e([c.property({type:b.default,json:{write:!0}})],g.prototype,"colorModulation",void 0);e([c.property({json:{write:!0},nonNullable:!0,type:Number})],g.prototype,"pointsPerInch",void 0);return g=e([c.subclass("esri.renderers.PointCloudRenderer")],
g)}(c.declared(g));(m||(m={})).fieldTransformTypeKebabDict=d({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return m})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",
{value:!0});m=function(g){function c(){var a=null!==g&&g.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}k(c,g);b=c;c.prototype.clone=function(){return new b({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var b;e([d.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);e([d.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"minValue",void 0);e([d.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",
void 0);return c=b=e([d.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)}(d.declared(g));f.ColorModulation=m;f.default=m})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});var d={pointCloudFixedSizeAlgorithm:e.default,pointCloudSplatAlgorithm:g.default};f.read=function(e,c,b){if(c=
e?d[e.type]||null:null)return c=new c,c.read(e,b),c;b&&b.messages&&e&&b.messages.push(new k("pointsizealgorithm:unsupported","Point size algorithms of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:b}));return null};f.fromJSON=function(e){var c=e?d[e.type]||null:null;return c?c.fromJSON(e):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.type="fixed-size";a.size=0;a.useRealWorldSymbolSizes=null;return a}k(c,d);b=c;c.prototype.clone=function(){return new b({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var b;e([g.enumeration.serializable()({pointCloudFixedSizeAlgorithm:"fixed-size"})],c.prototype,"type",void 0);e([g.property({type:Number,nonNullable:!0,json:{write:!0}})],
c.prototype,"size",void 0);e([g.property({type:Boolean,json:{write:!0}})],c.prototype,"useRealWorldSymbolSizes",void 0);return c=b=e([g.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],c)}(g.declared(d.default));f.PointSizeFixedSizeAlgorithm=m;f.default=m})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/kebabDictionary ../../../core/accessorSupport/decorators".split(" "),
function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});f.typeKebabDictionary=d({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});m=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}k(b,c);e([h.property({type:f.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:f.typeKebabDictionary.jsonValues,read:!1,write:f.typeKebabDictionary.write}})],b.prototype,"type",void 0);return b=e([h.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
b)}(h.declared(g));f.PointSizeAlgorithm=m;f.default=m})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});m=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.type="splat";a.scaleFactor=1;return a}k(c,d);
b=c;c.prototype.clone=function(){return new b({scaleFactor:this.scaleFactor})};var b;e([g.enumeration.serializable()({pointCloudSplatAlgorithm:"splat"})],c.prototype,"type",void 0);e([g.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],c.prototype,"scaleFactor",void 0);return c=b=e([g.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],c)}(g.declared(d.default));f.PointSizeSplatAlgorithm=m;f.default=m})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require",
"exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(m,f,k,e,g){Object.defineProperty(f,"__esModule",{value:!0});f.pointSizeAlgorithmTypes={key:"type",base:k.default,typeMap:{"fixed-size":e.default,splat:g.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.minValue=0;b.maxValue=0;b.color=null;return b}k(d,a);f=d;d.prototype.clone=function(){return new f({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:h.clone(this.color)})};var f;e([c.property({type:String,json:{write:!0}})],d.prototype,"description",void 0);e([c.property({type:String,
json:{write:!0}})],d.prototype,"label",void 0);e([c.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],d.prototype,"minValue",void 0);e([c.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],d.prototype,"maxValue",void 0);e([c.property({type:g,json:{type:[b.Integer],write:!0}})],d.prototype,"color",void 0);return d=f=e([c.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],d)}(c.declared(d));f.ColorClassBreakInfo=
m;f.default=m})},"esri/renderers/PointCloudRGBRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(a){a=b.call(this)||this;a.type="point-cloud-rgb";a.field=null;return a}e(a,b);c=a;a.prototype.clone=function(){return new c(k({},this.cloneProperties(),{field:d.clone(this.field)}))};
var c;g([h.enumeration.serializable()({pointCloudRGBRenderer:"point-cloud-rgb"})],a.prototype,"type",void 0);g([h.property({json:{write:{target:{field:{type:String},fieldTransformType:{type:String}},enabled:!0}},type:String})],a.prototype,"field",void 0);return a=c=g([h.subclass("esri.renderers.PointCloudRGBRenderer")],a)}(h.declared(c))})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(f){function l(a){a=f.call(this)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.stops=null;return a}e(l,f);m=l;l.prototype.clone=function(){return new m(k({},this.cloneProperties(),{field:d.clone(this.field),fieldTransformType:d.clone(this.fieldTransformType),stops:d.clone(this.stops),legendOptions:d.clone(this.legendOptions)}))};var m;g([h.enumeration.serializable()({pointCloudStretchRenderer:"point-cloud-stretch"})],
l.prototype,"type",void 0);g([h.property({json:{write:!0},type:String})],l.prototype,"field",void 0);g([h.property({type:b.default,json:{write:!0}})],l.prototype,"legendOptions",void 0);g([h.property({type:c.fieldTransformTypeKebabDict.apiValues,json:{type:c.fieldTransformTypeKebabDict.jsonValues,read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write}})],l.prototype,"fieldTransformType",void 0);g([h.property({type:[a.default],json:{write:!0}})],l.prototype,"stops",void 0);
return l=m=g([h.subclass("esri.renderers.PointCloudStretchRenderer")],l)}(h.declared(c))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function d(){var b=
null!==a&&a.apply(this,arguments)||this;b.label=null;b.value=0;b.color=null;return b}k(d,a);f=d;d.prototype.clone=function(){return new f({label:this.label,value:this.value,color:h.clone(this.color)})};var f;e([c.property({type:String,json:{write:!0}})],d.prototype,"label",void 0);e([c.property({type:Number,nonNullable:!0,json:{write:!0}})],d.prototype,"value",void 0);e([c.property({type:g,json:{type:[b.Integer],write:!0}})],d.prototype,"color",void 0);return d=f=e([c.subclass("esri.renderers.support.pointCloud.StopInfo")],
d)}(c.declared(d));f.StopInfo=m;f.default=m})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),function(m,f,k,e,g,d,h,c,b,a){return function(f){function l(a){a=f.call(this)||this;a.type="point-cloud-unique-value";a.field=
null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}e(l,f);m=l;l.prototype.clone=function(){return new m(k({},this.cloneProperties(),{field:d.clone(this.field),fieldTransformType:d.clone(this.fieldTransformType),colorUniqueValueInfos:d.clone(this.colorUniqueValueInfos),legendOptions:d.clone(this.legendOptions)}))};var m;g([h.enumeration.serializable()({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],l.prototype,"type",void 0);g([h.property({json:{write:!0},
type:String})],l.prototype,"field",void 0);g([h.property({type:c.fieldTransformTypeKebabDict.apiValues,json:{type:c.fieldTransformTypeKebabDict.jsonValues,read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write}})],l.prototype,"fieldTransformType",void 0);g([h.property({type:[a.default],json:{write:!0}})],l.prototype,"colorUniqueValueInfos",void 0);g([h.property({type:b.default,json:{write:!0}})],l.prototype,"legendOptions",void 0);return l=m=g([h.subclass("esri.renderers.PointCloudUniqueValueRenderer")],
l)}(h.declared(c))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(m,f,k,e,g,d,h,c,b){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;
b.description=null;b.label=null;b.values=null;b.color=null;return b}k(d,a);f=d;d.prototype.clone=function(){return new f({description:this.description,label:this.label,values:h.clone(this.values),color:h.clone(this.color)})};var f;e([c.property({type:String,json:{write:!0}})],d.prototype,"description",void 0);e([c.property({type:String,json:{write:!0}})],d.prototype,"label",void 0);e([c.property({type:[String],json:{write:!0}})],d.prototype,"values",void 0);e([c.property({type:g,json:{type:[b.Integer],
write:!0}})],d.prototype,"color",void 0);return d=f=e([c.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],d)}(c.declared(d));f.ColorUniqueValueInfo=m;f.default=m})},"esri/renderers/support/pointCloud/typeUtils":function(){define("require exports ../../PointCloudClassBreaksRenderer ../../PointCloudRenderer ../../PointCloudRGBRenderer ../../PointCloudStretchRenderer ../../PointCloudUniqueValueRenderer".split(" "),function(m,f,k,e,g,d,h){Object.defineProperty(f,"__esModule",{value:!0});
f.types={key:"type",base:e,typeMap:{"point-cloud-class-breaks":k,"point-cloud-rgb":g,"point-cloud-stretch":d,"point-cloud-unique-value":h}}})},"webSceneViewer/support/ErrorMessage":function(){define(["require","exports","dojox/html/entities"],function(m,f,k){Object.defineProperty(f,"__esModule",{value:!0});m=function(){function e(e,d,f,c,b,a){void 0===c&&(c=null);void 0===b&&(b=null);void 0===a&&(a=null);this.title=e;this.message=d;this.type=f;this.details=c;this.titleHtml=b||k.encode(e);this.messageHtml=
a||k.encode(d)}e.prototype.toString=function(){return"["+this.type+"]: "+this.title+" ("+this.message+")"};return e}();f.default=m})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(m){var f=m.getObject("dojox.html.entities",!0),k=function(e,d){var g,c;if(d._encCache&&d._encCache.regexp&&d._encCache.mapper&&d.length==d._encCache.length)g=d._encCache.mapper,c=d._encCache.regexp;else{g={};c=["["];var b;for(b=0;b<d.length;b++)g[d[b][0]]="\x26"+d[b][1]+";",c.push(d[b][0]);c.push("]");
c=new RegExp(c.join(""),"g");d._encCache={mapper:g,regexp:c,length:d.length}}return e=e.replace(c,function(a){return g[a]})},e=function(e,d){var g,c;if(d._decCache&&d._decCache.regexp&&d._decCache.mapper&&d.length==d._decCache.length)g=d._decCache.mapper,c=d._decCache.regexp;else{g={};c=["("];var b;for(b=0;b<d.length;b++){var a="\x26"+d[b][1]+";";b&&c.push("|");g[a]=d[b][0];c.push(a)}c.push(")");c=new RegExp(c.join(""),"g");d._decCache={mapper:g,regexp:c,length:d.length}}return e=e.replace(c,function(a){return g[a]})};
f.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];f.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6",
"para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0",
"ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea",
"ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],
["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8",
"theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],
["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a",
"radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],
["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],
["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];f.encode=function(e,d){e&&(d?e=k(e,d):(e=k(e,f.html),e=k(e,f.latin)));return e};f.decode=function(g,d){g&&(d?g=e(g,d):(g=e(g,f.html),g=e(g,f.latin)));return g};return f})},"webSceneViewer/editor/support/dropBasemapUtils":function(){define("require exports dojo/Deferred dojo/i18n!webSceneViewer/nls/viewer esri/Ground esri/core/Collection esri/core/watchUtils esri/layers/GroupLayer ../../support/layerUtils ../../widgets/Dialog/ConfirmDialog".split(" "),
function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});f.dropBasemap=function(a,e,f){var l=a.view;a=l.map.cloneEmpty();b.add(a,e);a.prioritySpatialReferenceLayers=new d([f]);a.initialViewProperties.viewingMode=l.viewingMode;a.ground=new g;b.cloneGroundProperties(a.ground,l.map.ground);l.map=a;e=e[0];e.isInstanceOf(c)&&(e=e.layers.getItemAt(0));var k={},m={animate:!1};if(e=e&&e.fullExtent)l.adjustMonthForLightingAtLatitude(e.center),k.target=e;"local"===l.viewingMode&&(k.tilt=
50);return h.whenTrueOnce(l,"ready").then(function(){l.goTo(k,m)})};f.showDropBasemapDialog=function(){function b(a){g.forEach(function(a){return a.remove()});a?c.resolve():c.reject()}var c=new k,d=new a({title:e.messages.basemapDropTitle,message:e.messages.basemapDrop,confirm:e.messages.basemapDropConfirm}),g=[d.on("confirm",b.bind(null,!0)),d.on("cancel",b.bind(null,!1))];d.show();return c.promise}})},"webSceneViewer/widgets/Dialog/ConfirmDialog":function(){define("esri/core/declare ./ClosableDialog dijit/_WidgetsInTemplateMixin dojo/text!./templates/ConfirmDialog.html dojo/i18n!../../editor/nls/editor dijit/form/Form dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/Button dijit/form/CheckBox dijit/form/Textarea".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return m([f,k],{templateString:e,message:"",confirm:"",cancel:"",title:"",constructor:function(a,b){this.draggable=!1;this.autoCenter=!0},postCreate:function(){this.buttonConfirm.set("label",""!==this.confirm?this.confirm:g.confirmDialog.confirm);this.buttonCancel.set("label",""!==this.cancel?this.cancel:g.confirmDialog.cancelButton);this.Message.innerHTML=""!==this.message?this.message:"";this.titleNode.innerHTML=""!==this.title?this.title:"";var a=this.Message;this.watch("message",
function(b,c,d){a.innerHTML=d});this.inherited(arguments)},_confirmButtonClickHandler:function(){this.emit("confirm",{})},onCancel:function(){this.inherited(arguments);this.emit("cancel",{})},show:function(){this.inherited(arguments);this.on("background-clicked",function(){this.onCancel()}.bind(this))}})})},"webSceneViewer/widgets/Dialog/ClosableDialog":function(){define("esri/core/declare dojo/on dojo/query dojo/dom-class dijit/Dialog dijit/DialogUnderlay".split(" "),function(m,f,k,e,g,d){return m([g],
{autoCenter:!1,appState:null,_resizeAndPositionHandler:null,constructor:function(d){this.on("hide",function(){this._smoothBlendInOut(!1)}.bind(this));this.autoCenter=d.autoCenter},postCreate:function(){this.inherited(arguments);this.autoCenter&&(this._resizeAndPositionHandler=this._resizeAndPosition.bind(this),window.addEventListener("resize",this._resizeAndPositionHandler),this.appState&&this.own(this.appState.watch("device.orientation",this._resizeAndPositionHandler)))},_resizeAndPosition:function(){this.open&&
setTimeout(function(){d._singleton.layout();this._position()}.bind(this),100)},destroy:function(){this._resizeAndPositionHandler&&window.removeEventListener("resize",this._resizeAndPositionHandler);this.inherited(arguments)},show:function(){this.inherited(arguments);this._smoothBlendInOut(!0);this.own(f(k(".dijitDialogUnderlayWrapper"),"click",function(){this.emit("background-clicked");this.hide()}.bind(this)))},_smoothBlendInOut:function(d){var c=k(".dijitDialogUnderlay");0<c.length&&e.toggle(c[0],
"on",d)}})})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(m,f,k,e,g){return k("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var d=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);g.parse(d,{noStart:!this._earlyTemplatedStartup,
template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(e.hitch(this,function(d){this._startupWidgets=d;for(var c=0;c<d.length;c++)this._processTemplateNode(d[c],function(b,a){return b[a]},function(b,a,c){return a in b?b.connect(b,a,c):b.on(a,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(d,e,c){return e(d,"dojoType")||e(d,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){m.forEach(this._startupWidgets,function(d){d&&!d._started&&d.startup&&d.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),
function(m,f,k,e,g,d,h,c,b){e("dijit-legacy-requires")&&d(0,function(){m(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[h,c],{templateString:b,baseClass:"dijitCheckBox",_setValueAttr:function(a,b){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,b)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},
_fillContent:function(){},_onFocus:function(){this.id&&g("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&g("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(m,f,k,e){return m("dijit.form.ToggleButton",[k,e],{baseClass:"dijitToggleButton",setChecked:function(e){f.deprecated("setChecked("+
e+") is deprecated. Use set('checked',"+e+") instead.","","2.0");this.set("checked",e)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(m,f){return m("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(f){var e=this.checked;this._set("checked",!e);var g=this.inherited(arguments);this.set("checked",g?this.checked:e);return g},_setCheckedAttr:function(k,e){this._set("checked",k);var g=this.focusNode||this.domNode;
this._created&&f.get(g,"checked")!=!!k&&f.set(g,"checked",!!k);g.setAttribute(this._aria_attr,String(k));this._handleOnChange(k,e)},postCreate:function(){this.inherited(arguments);var f=this.focusNode||this.domNode;this.checked&&f.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare",
"dojo/dom-attr"],function(m,f){return m("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(k){this._set("readOnly",k);f.set(this.focusNode,"readOnly",k)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(k){k=this._getSubmitValue(k);this._set("value",k);f.set(this.focusNode,"value",k)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));
f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/Textarea":function(){define(["dojo/_base/declare","dojo/dom-style","./_ExpandingTextAreaMixin","./SimpleTextarea"],function(m,f,k,e){return m("dijit.form.Textarea",[e,k],{baseClass:"dijitTextBox dijitTextArea dijitExpandingTextArea",cols:"",buildRendering:function(){this.inherited(arguments);f.set(this.textbox,{overflowY:"hidden",
overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"})}})})},"dijit/form/_ExpandingTextAreaMixin":function(){define("dojo/_base/declare dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/_base/window ../Viewport".split(" "),function(m,f,k,e,g,d,h){k.add("textarea-needs-help-shrinking",function(){var c=d.body(),b=f.create("textarea",{rows:"5",cols:"20",value:" ",style:{zoom:1,fontSize:"12px",height:"96px",overflow:"hidden",visibility:"hidden",
position:"absolute",border:"5px solid white",margin:"0",padding:"0",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"}},c,"last"),a=b.scrollHeight>=b.clientHeight;c.removeChild(b);return a});return m("dijit.form._ExpandingTextAreaMixin",null,{_setValueAttr:function(){this.inherited(arguments);this.resize()},postCreate:function(){this.inherited(arguments);var c=this.textbox;c.style.overflowY="hidden";this.own(g(c,"focus, resize",e.hitch(this,"_resizeLater")))},
startup:function(){this.inherited(arguments);this.own(h.on("resize",e.hitch(this,"_resizeLater")));this._resizeLater()},_onInput:function(c){this.inherited(arguments);this.resize()},_estimateHeight:function(){var c=this.textbox;c.rows=(c.value.match(/\n/g)||[]).length+1},_resizeLater:function(){this.defer("resize")},resize:function(){function c(){var a=!1;""===b.value&&(b.value=" ",a=!0);var c=b.scrollHeight;a&&(b.value="");return c}var b=this.textbox;"hidden"==b.style.overflowY&&(b.scrollTop=0);
if(!this.busyResizing){this.busyResizing=!0;if(c()||b.offsetHeight){var a=c()+Math.max(b.offsetHeight-b.clientHeight,0),d=a+"px";d!=b.style.height&&(b.style.height=d,b.rows=1);if(k("textarea-needs-help-shrinking")){var e=c(),g=b.style.minHeight,f=4,h=b.scrollTop;b.style.minHeight=d;for(b.style.height="auto";0<a;){b.style.minHeight=Math.max(a-f,4)+"px";d=c();e-=d;a-=e;if(e<f)break;e=d;f<<=1}b.style.height=a+"px";b.style.minHeight=g;b.scrollTop=h}b.style.overflowY=c()>b.clientHeight?"auto":"hidden";
"hidden"==b.style.overflowY&&(b.scrollTop=0)}else this._estimateHeight();this.busyResizing=!1}}})})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(m,f,k,e){return m("dijit.form.SimpleTextarea",e,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&
this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);k("ie")&&this.cols&&f.add(this.textbox,"dijitTextAreaCols")},filter:function(e){e&&(e=e.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(e){if(this.maxLength){var d=parseInt(this.maxLength),g=this.textbox.value.replace(/\r/g,""),d=g.length-d;if(0<d){var c=this.textbox;if(c.selectionStart){var b=c.selectionStart,a=0;k("opera")&&(a=(this.textbox.value.substring(0,
b).match(/\r/g)||[]).length);this.textbox.value=g.substring(0,b-d-a)+g.substring(b-a);c.setSelectionRange(b-d,b-d)}else this.ownerDocument.selection&&(c.focus(),g=this.ownerDocument.selection.createRange(),g.moveStart("character",-d),g.text="",g.select())}}this.inherited(arguments)}})})},"webSceneViewer/support/goToAnimationConfig":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.goToSpeed={goToButtonLayer:1500,goToAddedLayer:1500,goToInitialView:1500,
goToClippingArea:500}})},"webSceneViewer/support/popupUtils":function(){define(["require","exports","esri/PopupTemplate","dojo/i18n!webSceneViewer/nls/viewer"],function(m,f,k,e){function g(d,e,c){for(var b=0;b<c.length;b++)for(var a=0;a<d.length;a++){var g=c[b];if(g===d[a].alias||g===d[a].name)return e+": {"+d[a].name+"}";var f=g.toUpperCase();if(f===d[a].alias||f===d[a].name)return e+": {"+d[a].name+"}";g=g.charAt(0).toUpperCase()+g.slice(1);if(g===d[a].alias||g===d[a].name)return e+": {"+d[a].name+
"}"}return e}Object.defineProperty(f,"__esModule",{value:!0});f.createDefaultPopupTemplate=function(d){var f=d.fields||[],f=f.filter(function(a){return-1==="oid;geometry;blob;raster;guid;global - id;xml".split(";").indexOf(a.type)}),c=!1;75<f.length&&(c=!0,f.splice(75));d=g(f,d.title,["name"]);var b=[{type:"fields"},{type:"attachments"}],f=f.map(function(a){var b={fieldName:a.name,label:a.alias,visible:!0};switch(a.type){case "small-integer":case "integer":case "single":b.format={digitSeparator:!0,
places:0};break;case "double":b.format={digitSeparator:!0,places:2};break;case "date":b.format={dateFormat:"long-month-day-year"}}return b});c&&(b=b.concat([{type:"text",text:"\x3csmall\x3e"+e.messages.layer.tooManyFieldsForPopup+"\x3c/small\x3e"}]));return new k({title:d,content:b,fieldInfos:f})}})},"webSceneViewer/support/persistedSettingsUtils":function(){define(["require","exports","dojo/cookie","dojo/io-query","esri/core/arrayUtils"],function(m,f,k,e,g){function d(a,b,c){void 0===b&&(b=f.defaultStorage);
void 0===c&&(c="esriWebSceneViewer");return b.get(c+"_"+a)}function h(a,b,d,e){void 0===d&&(d=f.defaultStorage);void 0===e&&(e="esriWebSceneViewer");b?d.set(e+"_"+a,b):c(a,d)}function c(a,b,c){void 0===b&&(b=f.defaultStorage);void 0===c&&(c="esriWebSceneViewer");b.remove(c+"_"+a)}function b(b,c,d){void 0===c&&(c=[]);void 0===d&&(d=7);var e=a(b.thumbnailUrl),f={id:b.id,title:b.title,owner:b.owner,thumbnail:e};b=g.findIndex(c,function(a){return a.id===f.id});-1!==b&&c.splice(b,1);c=c.slice(0,d-1);c.unshift(f);
return c}function a(a){var b=null!=a?a.indexOf("?"):-1;if(-1===b)return a;var c=e.queryToObject(a.substring(b+1));delete c.token;return a.substring(0,b)+"?"+e.objectToQuery(c)}Object.defineProperty(f,"__esModule",{value:!0});f.persistedMobileWarning="experimentalMobileWarningViewed";f.cookieStorage={get:function(a){return k(a)},set:function(a,b){k(a,b,{expires:1})},remove:function(a){k(a,null,{expires:-1})}};f.localStorage={get:function(a){return window.localStorage.getItem(a)},set:function(a,b){window.localStorage.setItem(a,
b)},remove:function(a){window.localStorage.removeItem(a)}};var l;try{l="localStorage"in window&&null!==window.localStorage}catch(n){l=!1}f.defaultStorage=l?f.localStorage:f.cookieStorage;f.get=d;f.set=h;f.remove=c;f.setRecentScene=function(a,c,e,g){void 0===e&&(e=7);void 0===g&&(g=f.defaultStorage);var l=!a,k=l?d("__anonymous__",g,"esriAnonymousScenes"):d(a),k=k?JSON.parse(k):{recentScenes:[]};k.recentScenes=b(c,k.recentScenes,e);l?h("__anonymous__",JSON.stringify(k),g,"esriAnonymousScenes"):h(a,
JSON.stringify(k))};f.getRecentScenes=function(b,c){void 0===c&&(c=f.defaultStorage);try{var e=b?d(b):d("__anonymous__",c,"esriAnonymousScenes");return(e?JSON.parse(e).recentScenes:[]).filter(function(a){return a.id}).map(function(b){b.thumbnail=b.thumbnail?a(b.thumbnail):"";return b})}catch(r){return[]}}})},"webSceneViewer/PortalExtended":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/core/urlUtils dojo/_base/url esri/portal/Portal esri/identity/IdentityManager esri/identity/OAuthInfo ./support/geowConfig dojo/cookie dojo/io-query dojo/_base/kernel esri/layers/support/arcgisLayerUrl".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r){var t=function(c){function f(a){a=c.call(this,a)||this;a._baseUrl=l.available?l.baseUrl:"../";a.isMobilePhone=!1;return a}k(f,c);f.prototype.initialize=function(){var c=new a({appId:this.getClientId(),popup:!this.isMobilePhone,popupCallbackUrl:"viewer_oauth-callback.html",popupWindowFeatures:"height\x3d480,width\x3d800,resizable,scrollbars"+this._calculatePopupCenter(),locale:q.locale,minTimeUntilExpiration:525949,forceLogin:!0});c.portalUrl=this.url;b.registerOAuthInfos([c]);
this._updateUseSignInPage(!0)};f.prototype._calculatePopupCenter=function(){return",top\x3d"+((window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-240+(void 0!==window.screenTop?window.screenTop:screen?screen.top:0))+", left\x3d"+((window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-400+(void 0!==window.screenLeft?window.screenLeft:screen?screen.left:
0))};f.prototype.isOrg=function(){return this.isPortal?!0:!!this.urlKey};f.prototype.getSceneViewerUrl=function(a){void 0===a&&(a=!1);return a?document.location.protocol+"//"+this.portalHostname+"/home/webscene/viewer.html":this.getUrl()+"/webscene/viewer.html"};f.prototype.getBaseUrl=function(){return this.url};f.prototype.getUrl=function(){var a=this.url.replace(/\/$/,"");return a.match(/\/home$/)?a:a+"/home"};f.prototype.getProfileLink=function(){return this.getUrl()+"/user.html"};f.prototype.getHomeLink=
function(){return this.isPortal||this.isSignedIn()?this.getUrl()+"/index.html":this.getUrl()+"/../features/"};f.prototype.showArcGISTitle=function(){return!(this.isPortal||this.isOrg())};f.prototype.getItemLink=function(a){return this.getUrl()+"/item.html?id\x3d"+a.id};f.prototype.getFeaturesLink=function(){return this.getUrl().replace("/home","/features")+"/features.html"};f.prototype.getPlansLink=function(){return this.getUrl().replace("/home","/features")+"/plans/pricing.html"};f.prototype.getGalleryLink=
function(){return this.getUrl()+"/gallery.html"};f.prototype.getScenesGalleryLink=function(){return this.getUrl()+"/gallery.html#f\x3dscenes"};f.prototype.getGroupsLink=function(){return this.getUrl()+"/groups.html"};f.prototype.getMyContentLink=function(){return this.getUrl()+"/content.html"};f.prototype.getMyOrgLink=function(){return this.getUrl()+"/organization.html"};f.prototype.getMapLink=function(){return this.getUrl()+"/webmap/viewer.html"};f.prototype.getHelpLink=function(){if(this.isPortal){var a=
new h(this.getUrl()),b=(this.allSSL&&"http"===a.scheme?"https":a.scheme)+"://"+a.host;a.port&&(b+=":"+a.port);return b+=this.helpBase}return this.helpBase};f.prototype.getloggedInAdminHelpLink=function(){return this.isPortal?this.helpBase.replace("/website/","/admin/"):this.getUrl()+"/support.html"};f.prototype.getTrialLink=function(){return this.getUrl().replace("/home","/features")+"/free-trial.html"};f.prototype.getClientId=function(){return"arcgisonline"};f.prototype.getManageAccountsUrl=function(){return this.getUrl()+
"/pages/Account/manage_accounts.html"};f.prototype.getSwitchAccountsLink=function(){return this.getManageAccountsUrl()+"#client_id\x3d"+this.getClientId()};f.prototype.userHasSharingPrivileges=function(){var a=this.user;if(!this.isOrg()||!a)return!0;if(a&&a.privileges)for(var b=0;b<a.privileges.length;b++)if("portal:user:shareToPublic"===a.privileges[b]||"portal:user:shareToOrg"===a.privileges[b]||"portal:user:shareToGroup"===a.privileges[b])return!0;return!1};f.prototype.userCanShareWithPublic=function(){var a=
this.user;if(!this.isOrg()||!a)return!0;if(this.canSharePublic&&a&&a.privileges)for(var b=0;b<a.privileges.length;b++)if("portal:user:shareToPublic"===a.privileges[b])return!0;return!1};f.prototype.canShareViaSocialMedia=function(){var a=!this.portalProperties||!1!==this.portalProperties.showSocialMediaLinks;return!(l.available&&!1===l.showSocialMediaLinks||!a)};f.prototype.userHasEditingPrivileges=function(a){var b=this.user;if(!this.isOrg())return!0;if(b&&b.privileges)for(var c=0;c<b.privileges.length;c++)if("portal:user:createItem"===
b.privileges[c])return!0;return a?a.portalItem?this._canEditScene(a.portalItem.itemControl):!1:!1};f.prototype.userCanUpdateHostedService=function(a){if(this.user){var b=a.portalItem;if(!b)return!1;var c=b.typeKeywords;if(!r.isHostedAgolService(a.url)&&c&&-1===c.indexOf("providerSDS")||c&&-1===c.indexOf("Hosted Service"))return!1;a=this.user;return"update"===b.itemControl||"admin"===b.itemControl||a&&("org_admin"===a.role||"account_admin"===a.role)||a&&a.username===b.owner?!0:!1}};f.prototype._canEditScene=
function(a){return"update"===a||"admin"===a};f.prototype.isSignedIn=function(){return!!this.user};f.prototype.signIn=function(a,c){var d=this;void 0===a&&(a=!1);void 0===c&&(c=!1);this._updateUseSignInPage(a);b.oAuthInfos[0].popupWindowFeatures="height\x3d480,width\x3d800,resizable,scrollbars"+this._calculatePopupCenter();return b.getCredential(this.restUrl,{oAuthPopupConfirmation:!1}).then(function(a){return d._signIn()}).then(function(){d.createSecondEsriAuthCookie(d.credential);if(c){var a=window.location.href,
b=window.location.hostname,e=(d.urlKey&&d.customBaseUrl?d.urlKey+"."+d.customBaseUrl:null)||d.portalHostname.split("/")[0],a=a.replace(b,e);d._redirectToCustomURL(a,d.credential.expires)}}).catch(function(a){console.debug(a)})};f.prototype._redirectToCustomURL=function(a,b){a=this.allSSL?a.replace("http:","https:"):a;if(l&&l.available&&!l.isDebug){var c=null;!this.isPortal&&l.bridgeUrl&&(c=l.bridgeUrl.replace("http:","https:")+"?url\x3d"+encodeURIComponent(a),c=b?c+"\x26exp\x3d"+Math.ceil(((new Date(b)).valueOf()-
(new Date).valueOf())/1E3):c);window.location.href=c||a}};f.prototype._updateUseSignInPage=function(a){b.useSignInPage=a&&this.isMobilePhone&&b.oAuthInfos&&0<b.oAuthInfos.length?!1:a};f.prototype.signOut=function(){var a;if(this.isPortal){a=n("esri_auth");var b={};try{b=JSON.parse(a)}catch(y){}a={client_id:this.getClientId(),redirect_uri:this.getHomeLink(),token:b.token};n("esri_auth",null,{expires:-1,path:"/",domain:document.domain});a=d.toHTTPS(l.restBaseUrl)+"/oauth2/signout?"+p.objectToQuery(a)}else a=
this.getManageAccountsUrl()+"#client_id\x3d"+this.getClientId()+"\x26signout\x3dtrue";document.location.href=a};f.prototype.createSecondEsriAuthCookie=function(a){var b=a.expires;a={allSSL:this.allSSL,culture:a.culture||this.user.culture||this.culture,email:a.userId,expires:b,portalApp:!0,region:a.region||this.user.region,token:a.token};this.user.orgId&&this.user.role&&(a.accountId=this.user.orgId,a.role=this.user.role.replace("org_","account_"));b={domain:document.domain,path:"/",expires:null!=b?
(new Date(b)).toUTCString():null};!l.isDebug&&this&&!this.isPortal&&this.urlKey?(a.urlKey=this&&this.urlKey,a.customBaseUrl=this&&this.urlKey&&this.customBaseUrl||this.portalHostname||window.location.hostname):l.isDebug||!this||this.isPortal||(a.customBaseUrl=this&&this.portalHostname||window.location.hostname);n("esri_auth",JSON.stringify(a),b)};f.prototype.normalizeSSL=function(a){return this._normalizeSSL(a)};f.prototype.getTags=function(){return this._requestToTypedArray(this.user.url+"/tags")};
f.prototype.getStaticImage=function(a){var b=d.makeAbsolute(this.staticImagesUrl||"//static.arcgis.com/images",this.restUrl);return d.normalize(d.makeAbsolute(a,b))};f.prototype._deleteCookieDebugOnly=function(){b.destroyCredentials();if(n.isSupported()){n("esri_auth",null,{expires:-1,path:"/",domain:document.domain});for(var a=document.domain.split(".");2<a.length;)a.shift(),n("esri_auth",null,{expires:-1,path:"/",domain:a.join(".")})}};e([g.property()],f.prototype,"isMobilePhone",void 0);return f=
e([g.subclass()],f)}(g.declared(c)),w;c.getDefault=function(){w||(w=new t);return w};return t})},"webSceneViewer/support/portalUtils":function(){define("require exports dojo/request dojo/_base/kernel esri/core/promiseUtils ./geowConfig".split(" "),function(m,f,k,e,g,d){Object.defineProperty(f,"__esModule",{value:!0});f.defaultHelpUrl="http://doc.arcgis.com/en/arcgis-online/reference/scene-viewer-requirements.htm";f.getPortalUrls=function(h){if(d.available){var c=d.restBaseUrl;"/"!==c[c.length-1]&&
(c+="/");return k(c+"portals/self",{handleAs:"json",query:{f:"json",culture:e.locale}}).then(function(b){if(b.helpBase)return{helpUrl:b.helpBase+b.helpMap.m[h]||f.defaultHelpUrl,returnUrl:d.baseUrl||f.defaultHelpUrl};throw"none";})}return g.reject()}})},"dojo/request":function(){define(["./request/default!"],function(m){return m})},"dojo/request/default":function(){define(["exports","require","../has"],function(m,f,k){var e=k("config-requestProvider"),g;if(k("host-browser")||k("host-webworker"))g=
"./xhr";e||(e=g);m.getPlatformDefaultId=function(){return g};m.load=function(d,h,c,b){f(["platform"==d?g:e],function(a){c(a)})}})},"webSceneViewer/support/hostnameCheck":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});var k=[/^devext.arcgis.com$/,/^qaext.arcgis.com$/,/^jsapps.esri.com$/,/^[\w-]*\.mapsdevext.arcgis.com$/];f.isDevEnvironment=function(e){return k.some(function(g){return null!=e.match(g)})};f.isTelemetryDevEnvironment=function(e){return[/^zrh-.+?\.esri\.com$/].concat(k).some(function(g){return null!=
e.match(g)})}})},"webSceneViewer/support/Telemetry":function(){define("require exports esri/core/tsSupport/extendsHelper telemetry/telemetry.dojo ./geowConfig ./hostnameCheck".split(" "),function(m,f,k,e,g,d){return function(e){function c(b){var a=this,d=(a=b.portal)&&a.name?a.name:"ArcGIS Online",f=(!g.available||g.usageTrackingEnabled)&&(!a||a.eueiEnabled&&!a.isPortal&&a.isSignedIn()),h=c.getTelemetryID(),a=e.call(this,{disabled:!f,portal:a,debug:!g.available||g.isDebug,amazon:{userPoolID:h.poolId,
app:{name:d+" Scene Viewer",id:h.appId,version:b.appVersion.versionString}}})||this;a.appState=b;return a}k(c,e);c.getTelemetryID=function(){return!g.available||g.isDebug||d.isTelemetryDevEnvironment(window.location.hostname)?{poolId:"us-east-1:7345bcf2-bffa-4849-a379-a83178f63eef",appId:"81cecbde48724e4eb3d66cf915966509"}:{poolId:"us-east-1:8c41b2dc-7563-403d-ba64-673b103debce",appId:"4aea4eea384e4be88fe9d9d93f81a1a9"}};return c}(e)})},"telemetry/telemetry.dojo":function(){define(function(){function m(a,
b){var c=new XMLHttpRequest;c.addEventListener("load",function(){b(c.responseText)});c.open(a.method,a.url);Object.keys(a.headers).forEach(function(b){c.setRequestHeader(b,a.headers[b])});c.send(a.body)}function f(a,b){var c=v.get("TELEMETRY_COGNITO_CREDENTIALS");if(c&&Date.now()/1E3<c.Expiration)return b(c);k(a,function(a){v.set("TELEMETRY_COGNITO_CREDENTIALS",a);b(a)})}function k(a,b){var c=B({},C);c.headers["X-Amz-Target"]="AWSCognitoIdentityService.GetId";c.body=JSON.stringify({IdentityPoolId:a});
m(c,function(a){e(JSON.parse(a),b)})}function e(a,b){var c=B({},C);c.headers["X-Amz-Target"]="AWSCognitoIdentityService.GetCredentialsForIdentity";c.body=JSON.stringify({IdentityId:a.IdentityId});m(c,function(a){a=JSON.parse(a);b(a.Credentials)})}function g(){var a=void 0,b=v.get("TELEMETRY_SESSION");if(!b||Date.now()>b.expiration)a=!0,b={id:Math.floor(17592186044416*(1+Math.random())).toString(16),startTimestamp:(new Date).toISOString()};b.expiration=Date.now()+18E5;v.set("TELEMETRY_SESSION",b);
a&&(b.new=!0);a=b;b=v.get("TELEMETRY_CLIENT_ID");b||(b=d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d(),v.set("TELEMETRY_CLIENT_ID",b));return{session:a,id:b}}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function h(c,d){var e={host:d.uri.host,"content-type":c.config.defaultContentType,accept:c.config.defaultAcceptType,"x-amz-date":b(d.signDate)};d.request.method=d.request.method.toUpperCase();d.request.body?d.payload=d.request.body:d.request.data&&c.payloadSerializer?
d.payload=c.payloadSerializer(d.request.data):delete e["content-type"];d.request.headers=a(e,Object.keys(d.request.headers||{}).reduce(function(a,b){a[b.toLowerCase()]=d.request.headers[b];return a},{}));d.sortedHeaderKeys=Object.keys(d.request.headers).sort();d.request.headers["content-type"]&&(d.request.headers["content-type"]=d.request.headers["content-type"].split(";")[0]);"object"===z(d.request.params)&&a(d.uri.queryParams,d.request.params)}function c(a,b){b.signedHeaders=b.sortedHeaderKeys.map(function(a){return a.toLowerCase()}).join(";");
b.canonicalRequest=String(b.request.method).toUpperCase()+"\n"+encodeURI(b.uri.path)+"\n"+Object.keys(b.uri.queryParams).sort().map(function(a){return encodeURIComponent(a)+"\x3d"+encodeURIComponent(b.uri.queryParams[a])}).join("\x26")+"\n"+b.sortedHeaderKeys.map(function(a){return a.toLocaleLowerCase()+":"+b.request.headers[a]}).join("\n")+"\n\n"+b.signedHeaders+"\n"+a.hasher.hash(b.payload?b.payload:"")}function b(a,b){a=a.toISOString().replace(/[:\-]|\.\d{3}/g,"").substr(0,17);return b?a.substr(0,
8):a}function a(b){[].slice.call(arguments,1).forEach(function(c){c&&"object"===("undefined"===typeof c?"undefined":z(c))&&Object.keys(c).forEach(function(d){var e=c[d];"undefined"!==typeof e&&(null!==e&&"object"===("undefined"===typeof e?"undefined":z(e))?(b[d]=Array.isArray(e)?[]:{},a(b[d],e)):b[d]=e)})});return b}function l(a,b){if("undefined"===typeof a||!a)throw Error(b);}function n(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=g().session;return{eventType:"pageView",timestamp:(new Date).toISOString(),
session:{id:c.id,startTimestamp:c.startTimestamp},attributes:{referrer:document.referrer,hostname:window.location.hostname,path:a||window.location.pathname,pageUrl:a||window.location.pathname,pageName:document.title,previousPageUrl:b.pageUrl,previousPageName:b.pageName},metrics:{}}}function p(a){var b=B({},a);delete b.workflow;M.forEach(function(a){return delete b[a]});Object.keys(b).forEach(function(a){b[a]="json"===a?b[a]?JSON.stringify(b[a]):"null":void 0!==b[a]?b[a].toString():"null"});return b}
function q(a){var b={};M.forEach(function(c){a[c]&&(b[c]=a[c])});return b}function r(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=arguments[1];return(new F({region:"us-east-1",service:"mobileanalytics",accessKeyId:a.AccessKeyId,secretAccessKey:a.SecretKey,sessionToken:a.SessionToken})).sign(b)}function t(a,b,c){var d=g();a=Array.isArray(a)?a:[a];var e=w(a);f(b,function(a){try{e.headers=r(a,e),e.headers["x-amz-Client-Context"]=JSON.stringify({client:{client_id:d.id,app_title:c.name,
app_version_name:c.version||"unknown"},services:{mobile_analytics:{app_id:c.id}}})}catch(L){console.error(L);return}m(e,function(a){a&&console.error(JSON.parse(a))})})}function w(a){return{url:1<arguments.length&&void 0!==arguments[1]?arguments[1]:"https://mobileanalytics.us-east-1.amazonaws.com/2014-06-05/events",method:"POST",body:JSON.stringify({events:a})}}function u(a){window.ga?window.ga(function(){a(window.ga.getAll())}):console.log(Error("Google Analytics trackers not available"))}function x(a){var b=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},d={hitType:"event",eventCategory:a.category||"none",eventAction:a.action,eventLabel:a.label};Object.keys(b).forEach(function(c){d["dimension"+b[c]]=a[c]});Object.keys(c).forEach(function(b){d["metric"+c[b]]=a[b]});return d}var v={storage:{},memory:!0,get:function(a){var b=void 0;try{b=window.localStorage&&window.localStorage.getItem(a)||this.storage[a]}catch(H){b=this.storage[a]}if(b)try{return JSON.parse(b)}catch(H){}},
set:function(a,b){b=JSON.stringify(b);try{window.localStorage.setItem(a,b)}catch(H){this.memory||(console.error("setting local storage failed, falling back to in-memory storage"),this.memory=!0),this.storage[a]=b}}},z="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},y=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
},A=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),B=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},C={method:"POST",url:"https://cognito-identity.us-east-1.amazonaws.com/",headers:{"Content-type":"application/x-amz-json-1.1"}},
E=function(a,b){var c={},d=c.lib={},e=function(){},g=d.Base={extend:function(a){e.prototype=this;var b=new e;a&&b.mixIn(a);b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)});b.init.prototype=b;b.$super=this;return b},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
f=d.WordArray=g.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||l).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);this.sigBytes+=a;return this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-
c%4*8;b.length=a.ceil(c/4)},clone:function(){var a=g.clone.call(this);a.words=this.words.slice(0);return a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),h=c.enc={},l=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16));c.push((e&15).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<
24-d%8*4;return new f.init(c,b/2)}},k=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(a.charCodeAt(d)&255)<<24-d%4*8;return new f.init(c,b)}},m=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(ha){throw Error("Malformed UTF-8 data");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},
n=d.BufferedBlockAlgorithm=g.extend({reset:function(){this._data=new f.init;this._nDataBytes=0},_append:function(a){"string"===typeof a&&(a=m.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=e/(4*g),h=b?a.ceil(h):a.max((h|0)-this._minBufferSize,0);b=h*g;e=a.min(4*b,e);if(b){for(var l=0;l<b;l+=g)this._doProcessBlock(d,l);l=d.splice(0,b);c.sigBytes-=e}return new f.init(l,e)},clone:function(){var a=g.clone.call(this);
a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=n.extend({cfg:g.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){n.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return(new a.init(c)).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return(new p.HMAC.init(a,
c)).finalize(b)}}});var p=c.algo={};return c}(Math);(function(a){for(var b=E.lib,c=b.WordArray,d=b.Hasher,b=E.algo,e=[],g=[],f=function(a){return 4294967296*(a-(a|0))|0},h=2,l=0;64>l;){var k;a:{k=h;for(var m=a.sqrt(k),n=2;n<=m;n++)if(!(k%n)){k=!1;break a}k=!0}k&&(8>l&&(e[l]=f(a.pow(h,.5))),g[l]=f(a.pow(h,1/3)),l++);h++}var p=[],b=b.SHA256=d.extend({_doReset:function(){this._hash=new c.init(e.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],l=c[4],k=c[5],
m=c[6],n=c[7],q=0;64>q;q++){if(16>q)p[q]=a[b+q]|0;else{var r=p[q-15],t=p[q-2];p[q]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+p[q-7]+((t<<15|t>>>17)^(t<<13|t>>>19)^t>>>10)+p[q-16]}r=n+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&k^~l&m)+g[q]+p[q];t=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f);n=m;m=k;k=l;l=h+r|0;h=f;f=e;e=d;d=r+t|0}c[0]=c[0]+d|0;c[1]=c[1]+e|0;c[2]=c[2]+f|0;c[3]=c[3]+h|0;c[4]=c[4]+l|0;c[5]=c[5]+k|0;c[6]=c[6]+m|0;c[7]=c[7]+n|0},_doFinalize:function(){var b=this._data,c=
b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;c[(e+64>>>9<<4)+14]=a.floor(d/4294967296);c[(e+64>>>9<<4)+15]=d;b.sigBytes=4*c.length;this._process();return this._hash},clone:function(){var a=d.clone.call(this);a._hash=this._hash.clone();return a}});E.SHA256=d._createHelper(b);E.HmacSHA256=d._createHmacHelper(b)})(Math);(function(){var a=E.enc.Utf8;E.algo.HMAC=E.lib.Base.extend({init:function(b,c){b=this._hasher=new b.init;"string"===typeof c&&(c=a.parse(c));var d=b.blockSize,e=
4*d;c.sigBytes>e&&(c=b.finalize(c));c.clamp();b=this._oKey=c.clone();c=this._iKey=c.clone();for(var g=b.words,f=c.words,h=0;h<d;h++)g[h]^=1549556828,f[h]^=909522486;b.sigBytes=c.sigBytes=e;this.reset()},reset:function(){var a=this._hasher;a.reset();a.update(this._iKey)},update:function(a){this._hasher.update(a);return this},finalize:function(a){var b=this._hasher;a=b.finalize(a);b.reset();return b.finalize(this._oKey.clone().concat(a))}})})();var D={region:"eu-west-1",service:"execute-api",defaultContentType:"application/json",
defaultAcceptType:"application/json",payloadSerializerFactory:function(){return function(a){return JSON.stringify(a)}},uriParserFactory:function(){function a(a){return/^\??(.*)$/.exec(a)[1].split("\x26").reduce(function(a,b){(b=/^(.+)=(.*)$/.exec(b))&&(a[b[1]]=b[2]);return a},{})}var b=document?document.createElement("a"):{};return function(c){b.href=c;return{protocol:b.protocol,host:b.host.replace(/^(.*):((80)|(443))$/,"$1"),path:("/"!==b.pathname.charAt(0)?"/":"")+b.pathname,queryParams:a(b.search)}}},
hasherFactory:function(){return{hash:function(b,c){c=a({hexOutput:!0,textInput:!0},c);b=E.SHA256(b);return c.hexOutput?b.toString(E.enc.Hex):b},hmac:function(b,c,d){d=a({hexOutput:!0,textInput:!0},d);b=E.HmacSHA256(c,b,{asBytes:!0});return d.hexOutput?b.toString(E.enc.Hex):b}}}},F=function(){function d(b){y(this,d);this.config=a({},D,b);this.payloadSerializer=this.config.payloadSerializer||this.config.payloadSerializerFactory();this.uriParser=this.config.uriParserFactory();this.hasher=this.config.hasherFactory();
l(this.config.accessKeyId,"AwsSigner requires AWS AccessKeyID");l(this.config.secretAccessKey,"AwsSigner requires AWS SecretAccessKey")}A(d,[{key:"sign",value:function(d,e){d={request:a({},d),signDate:e||new Date,uri:this.uriParser(d.url)};h(this,d);c(this,d);d.credentialScope=[b(d.signDate,!0),this.config.region,this.config.service,"aws4_request"].join("/");d.stringToSign="AWS4-HMAC-SHA256\n"+b(d.signDate)+"\n"+d.credentialScope+"\n"+this.hasher.hash(d.canonicalRequest);e=this.hasher.hmac;var g=
e(e(e(e("AWS4"+this.config.secretAccessKey,b(d.signDate,!0),{hexOutput:!1}),this.config.region,{hexOutput:!1,textInput:!1}),this.config.service,{hexOutput:!1,textInput:!1}),"aws4_request",{hexOutput:!1,textInput:!1});d.signature=e(g,d.stringToSign,{textInput:!1});d.authorization="AWS4-HMAC-SHA256 Credential\x3d"+this.config.accessKeyId+"/"+d.credentialScope+", SignedHeaders\x3d"+d.signedHeaders+", Signature\x3d"+d.signature;return{Accept:d.request.headers.accept,Authorization:d.authorization,"Content-Type":d.request.headers["content-type"],
"x-amz-date":d.request.headers["x-amz-date"],"x-amz-security-token":this.config.sessionToken||void 0}}}]);return d}(),M=["size","duration","position","number","count"],N=function(){function a(b){y(this,a);this.name="amazon";B(this,b);g().session.new&&!b.test&&this.logEvent({eventType:"_session.start"})}A(a,[{key:"logPageView",value:function(a){a=n(a,this.previousPage);t(a,this.userPoolID,this.app);this.previousPage=a.attributes}},{key:"logEvent",value:function(a){var b=g().session;a={eventType:a.eventType||
"other",timestamp:(new Date).toISOString(),session:{id:b.id,startTimestamp:b.startTimestamp},attributes:B({referrer:document.referrer,hostname:window.location.hostname,path:window.location.pathname},p(a)),metrics:q(a)};t(a,this.userPoolID,this.app)}}]);return a}(),I=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};y(this,a);this.name="google";B(this,b)}A(a,[{key:"logPageView",value:function(a){u(function(b){b.forEach(function(b){b.send("pageview",a||window.location.pathname)})})}},
{key:"logEvent",value:function(a){var b=x(a,this.dimensions,this.metrics);u(function(a){a.forEach(function(a){a.send(b)})})}}]);return a}(),G=function(a){if(a)return E.SHA256(a).toString(E.enc.Hex)},O="esri.com esriuk.com esri.de esri.ca esrifrance.fr esri.nl esri-portugal.pt esribulgaria.com esri.fi esri.kr esrimalaysia.com.my esri.es esriaustralia.com.au esri-southafrica.com esri.cl esrichina.com.cn esri.co esriturkey.com.tr geodata.no esriitalia.it esri.pl".split(" ");return function(){function a(b){y(this,
a);try{this.trackers=[],this.workflows={},this.test=b.test,this.debug=b.debug,this.disabled=b.disabled,b.portal&&!b.portal.eueiEnabled&&(console.log("Telemetry Disabled"),this.disabled=!0),b.portal&&b.portal.user?this.setUser(b.portal.user,(b.portal.subscriptionInfo||{}).type):b.user&&this.setUser(b.user),this.disabled||this._initTrackers(b)}catch(H){console.error("Telemetry Disabled"),console.error(H),this.disabled=!0}}A(a,[{key:"_initTrackers",value:function(a){if(a.amazon){var b=new N(a.amazon);
this.trackers.push(b)}a.google&&(a=new I(a.google),this.trackers.push(a));this.trackers.length||console.error(Error("No trackers configured"))}},{key:"setUser",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Public";this.user=a="string"===typeof a?{username:a}:a;this.user.accountType=b;var c=void 0;if(a.email&&a.email.split)var d=a.email.split("@")[1],c=0<O.filter(function(a){return d===a}).length;if(c||-1<
["In House","Demo and Marketing"].indexOf(b))this.user.internalUser=!0}},{key:"logPageView",value:function(a){var b=this.preProcess(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});if(this.debug)console.log("Tracking page view",JSON.stringify(b));else if(this.test&&!this.disabled)return b;if(!this.trackers.length||this.disabled)return this.disabled||console.error(Error("Page view was not logged because no trackers are configured.")),!1;this.trackers.forEach(function(c){try{c.logPageView(a,
b)}catch(R){console.error(c.name+" tracker failed to log page view.",R)}});return!0}},{key:"logEvent",value:function(){var a=this.preProcess(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{});if(this.debug)console.log("Tracking event",JSON.stringify(a));else if(this.test)return a;if(!this.trackers.length||this.disabled)return this.disabled||console.error(Error("Event was not logged because no trackers are configured.")),!1;this.trackers.forEach(function(b){try{b.logEvent(a)}catch(K){console.error(b.name+
" tracker failed to log event",K)}});return!0}},{key:"logError",value:function(){var a=B({eventType:"error"},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{});this.logEvent(a)}},{key:"startWorkflow",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c={name:a,start:Date.now(),steps:[]};this.workflows[a]=c;b=B({name:a,step:"start"},b);this._logWorkflow(b);return c}},{key:"stepWorkflow",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:
{},c=B({name:a,step:b,details:"string"===typeof options?c:c.details},c);this._logWorkflow(c)}},{key:"endWorkflow",value:function(a){var b=B({name:a,step:"finish"},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});this._logWorkflow(b);delete this.workflows[a]}},{key:"cancelWorkflow",value:function(a){var b=B({name:a,step:"cancel"},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});this._logWorkflow(b);delete this.workflows[a]}},{key:"_logWorkflow",value:function(){var a=0<arguments.length&&
void 0!==arguments[0]?arguments[0]:{},a=this.preProcess(a),b=this.workflows[a.name];b||(b=this.startWorkflow(a.name));b.steps.push(a.step);b.duration=(Date.now()-b.start)/1E3;a=B(a,{eventType:"workflow",category:a.name,action:a.step,label:a.details,duration:b.duration});this.logEvent(a)}},{key:"preProcess",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b={};this.user&&(b={user:G(this.user.username),orgId:G(this.user.orgId),lastLogin:this.user.lastLogin,userSince:this.user.created,
internalUser:this.user.internalUser||!1,accountType:this.user.accountType});return B({},a,b)}}]);return a}()})},"webSceneViewer/support/uiUtils":function(){define("require exports dojo/on dojo/_base/window dojo/dom-class dojo/query dojo/has dijit/registry".split(" "),function(m,f,k,e,g,d,h,c){function b(){var a=e.doc;return a.fullscreenElement||a.msFullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement}Object.defineProperty(f,"__esModule",{value:!0});f.fadeIn=function(a){g.replace(a,
"navFadeIn","navFadeOut")};f.fadeOut=function(a){g.replace(a,"navFadeOut","navFadeIn")};f.toggleFullScreen=function(a){b()?(a=e.doc,a.msExitFullscreen?a.msExitFullscreen():a.exitFullscreen?a.exitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitExitFullscreen&&a.webkitExitFullscreen()):a.msRequestFullscreen?a.msRequestFullscreen():a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};
f.isFullScreenEnabled=(e.doc.fullscreenEnabled||e.doc.msFullscreenEnabled||e.doc.mozFullScreenEnabled||e.doc.webkitFullscreenEnabled)&&!h("fullScreenDisabled");f.onFullscreenChange=function(a){for(var b=0,c=["fullscreenChange","MSFullscreenChange","webkitfullscreenchange","mozfullscreenchange"];b<c.length;b++){var d=c[b];if("on"+d.toLowerCase()in e.doc)return k(e.doc,d,a)}};f.fullscreenElement=b;f.disableToggle=function(a,b,e){e&&(d("input, button, textarea, select",e).attr("disabled",a),d("[widgetId]",
e).map(c.byNode).forEach(function(b){b.attr?b.attr("disabled",a):b.domNode&&b.domNode.attr&&b.domNode.attr("disabled",a)}),g.toggle(e,"disable",a));b&&(b.attr?(b.attr("disabled",a),g.toggle(b.domNode,"disable",a)):b.disabled=a)};f.isOnElement=function(a,b,c){a=a.getBoundingClientRect();return b>=a.left&&b<=a.right&&c>=a.top&&c<=a.bottom}})},"webSceneViewer/support/AutoHideUI":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators dojo/_base/window ./uiUtils esri/core/Accessor esri/core/Collection esri/core/scheduling".split(" "),
function(m,f,k,e,g,d,h,c,b,a){Object.defineProperty(f,"__esModule",{value:!0});m=function(c){function f(a){a=c.call(this)||this;a.pointerLocation={clientX:0,clientY:0};a.pointerIsInsideContainer=!1;a.controlsAreShown=!0;a.evaluateElementVisibilityTimeout=new l(a.evaluateElementVisibility,a);a.autoHideTimeout=new l(a.hide,a);a.elements=new b;a.latestPointerType="mouse";a.enabled=!0;return a}k(f,c);f.prototype.initialize=function(){var a=this;this.elements.on("change",function(b){return a.onElementsChanged(b.added,
b.removed)});this.installEventListeners();this.enabled&&this.autoHideTimeout.restart(n)};Object.defineProperty(f.prototype,"autoHideDelay",{get:function(){return"touch"===this.latestPointerType?r:this.pointerIsInsideContainer?q:p},enumerable:!0,configurable:!0});f.prototype.cancelTimeouts=function(){this.autoHideTimeout.cancel();this.evaluateElementVisibilityTimeout.cancel()};f.prototype.evaluateElementVisibility=function(){var a=this.pointerLocation,b=a.clientX,c=a.clientY,a=h.isOnElement(this.container,
b,c),d=this.elements.some(function(a){return h.isOnElement(a,b,c)});((this.pointerIsInsideContainer=a)||d)&&this.show();d||(this.evaluateElementVisibilityTimeout.cancel(),this.autoHideTimeout.restart(this.autoHideDelay))};f.prototype.mouseHandler=function(a){this.enabled&&(this.latestPointerType="mouse",this.pointerLocation.clientX=a.clientX,this.pointerLocation.clientY=a.clientY,this.pointerIsInsideContainer&&this.controlsAreShown?this.evaluateElementVisibilityTimeout.start(t):this.evaluateElementVisibility())};
f.prototype.touchHandler=function(a){this.enabled&&"mouse"!==a.type&&(this.latestPointerType="touch",this.controlsAreShown||this.show(),this.autoHideTimeout.restart(this.autoHideDelay))};f.prototype.installEventListeners=function(){var a=this;["mousedown","mouseup","mousemove","mouseout"].forEach(function(b){return d.doc.addEventListener(b,function(b){return a.mouseHandler(b)})});this.container.addEventListener("wheel",function(b){return a.mouseHandler(b)});["pointerdown","pointerup","pointermove",
"touchstart","touchend"].forEach(function(b){return a.container.addEventListener(b,function(b){return a.touchHandler(b)})})};f.prototype.onElementsChanged=function(a,b){this.enabled&&(b.forEach(h.fadeIn),a.forEach(this.controlsAreShown?h.fadeIn:h.fadeOut))};f.prototype.hide=function(){this.enabled&&(this.cancelTimeouts(),this.controlsAreShown&&(this.controlsAreShown=!1,this.elements.forEach(h.fadeOut)))};f.prototype.show=function(){var b=this;this.enabled&&(this.cancelTimeouts(),this.controlsAreShown||
(this.controlsAreShown=!0,a.schedule(function(){b.controlsAreShown&&b.elements.forEach(h.fadeIn)})))};e([g.property({constructOnly:!0})],f.prototype,"appState",void 0);e([g.property({constructOnly:!0})],f.prototype,"container",void 0);e([g.property({constructOnly:!0,type:b})],f.prototype,"elements",void 0);e([g.property()],f.prototype,"enabled",void 0);return f=e([g.subclass("webSceneViewer.support.AutoHideUI")],f)}(g.declared(c));f.AutoHideUI=m;var l=function(){function a(a,b){void 0===b&&(b=null);
this.handler=a;this.id=0;b&&(this.handler=this.handler.bind(b))}a.prototype.start=function(a){this.id||(this.id=setTimeout(this.handler,a))};a.prototype.restart=function(a){this.cancel();this.start(a)};a.prototype.cancel=function(){0!==this.id&&(clearTimeout(this.id),this.id=0)};return a}(),n=1E4,p=100,q=2E3,r=6E3,t=500;f.default=m})},"webSceneViewer/widgets/Crosshair/Crosshair":function(){define("esri/core/declare esri/core/domUtils esri/core/Handles esri/views/3d/state/controllers/global/ZoomController esri/views/3d/state/controllers/local/ZoomController dojo/dom-construct dojo/dom-style".split(" "),
function(m,f,k,e,g,d,h){return m(null,{constructor:function(c){this.node=d.create("div",{className:"crosshair",id:"navCrosshair"},c.container);f.hide(this.node);this.dim=[h.get(this.node,"width"),h.get(this.node,"height")];this.handles=new k;this.handles.add(c.watch("state.cameraController",this.showHideCrossHair.bind(this,c)))},showHideCrossHair:function(c,b){b instanceof g.ZoomController||b instanceof e.ZoomController?(b=b.dragBeginPoint,this.show([b[0],c.height-b[1]])):this.hide()},destroy:function(){this.handles.remove()},
show:function(c){h.set(this.node,"left",c[0]-this.dim[0]/2+"px");h.set(this.node,"top",c[1]-this.dim[1]/2+"px");f.show(this.node)},hide:function(){f.hide(this.node)}})})},"webSceneViewer/widgets/Dialog/Dialog":function(){define("esri/core/declare dojo/_base/lang dojo/dom-construct dijit/_WidgetBase ./ClosableDialog dijit/form/Button dojo/i18n".split(" "),function(m,f,k,e,g,d,h){function c(a){var b;a&&a.length&&(a=a[0]);a&&a&&a.message&&1<a.message.length?(b=a.message,a=b.search("resource: http://"),
0<a?(b=b.substring(0,a+8),a=b.substring(a+8)):a=""):(b="Details:",a=JSON.stringify(a));return{content:b,details:a}}var b=m([g],{postMixInProperties:function(){var a=h.getLocalization("dijit","common");f.mixin(this,a)}});return m([e],{name:"Dialog",baseClass:"Dialog",title:void 0,content:void 0,details:void 0,execute:function(){},result:void 0,_dialog:void 0,autoCenter:!1,draggable:!0,constructor:function(a){this.autoCenter=a.autoCenter;this.draggable=a.draggable},destroy:function(){},postMixInProperties:function(){"undefined"!==
typeof this.content&&"string"!==typeof this.content&&f.mixin(this,c(this.content))},postCreate:function(){function a(){var a=k.create("div",{innerHTML:c.content||""});k.create("div",{class:"details",innerHTML:c.details||""},a);var b=k.create("div",{class:"ButtonContainer"},a),b=k.create("div",{},b);new d({label:"OK",class:"DialogOKButton",onClick:f.hitch(c,function(){c.execute(c.result);c.emit("close");c._dialog.destroy()})},b);return a}var c=this;this.watch("details",function(){c._dialog.set("content",
a())});this.watch("content",function(){c._dialog.set("content",a())});this._dialog=new b({title:this.title,content:a(),class:"WebSceneViewerDialog",autoCenter:this.autoCenter,draggable:this.draggable});this._dialog.show();this._dialog.on("hide",function(){c.emit("close")});this.startup()}})})},"webSceneViewer/widgets/FPSView/FPSView":function(){define(["esri/core/declare","esri/core/scheduling","dojo/dom-construct","dojo/on"],function(m,f,k,e){return m(null,{constructor:function(g){var d=k.create("div",
{id:"fpsView",className:"fpsView",act:"false"},g.container);this._domNode=d;var h=0,c=0,b=f.addFrameTask({update:function(a){var b=(a.time-c)/1E3;.5<=b?(d.textContent=(h/b).toFixed(1),c=a.time,h=1):++h}});b.pause();e(d,"click",function(){var a="false"===d.getAttribute("act")?!0:!1;d.setAttribute("act",a);a?(c=h=0,b.resume(),d.innerHTML="\x26#8734;"):(b.pause(),d.innerHTML="")}.bind(this))}})})},"webSceneViewer/widgets/Header/Header":function(){define("esri/request esri/core/declare esri/core/requireUtils esri/identity/IdentityManager dojo/io-query dijit/_WidgetBase dijit/_TemplatedMixin ../Tooltip/Tooltip dojo/text!./templates/Header.html ./Role ../../support/geowConfig ../../support/persistedSettingsUtils dojo/dom dojo/dom-class dojo/dom-attr dojo/dom-style dojo/dom-construct dojo/_base/event dojo/on dojo/query dojo/_base/window webSceneViewer/support/urlUtils ./RecentSceneLink dojo/i18n!../nls/widgets dojo/i18n!webSceneViewer/editor/nls/editor".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u,x,v,z,y,A,B,C){function E(a){var b=q.contains(a,"is-active");v(".dropdown").removeClass("is-active");N&&N.remove();b||(q.add(a,"is-active"),N=x(document.body,"click",D.bind(null,a)))}function D(a,b){var c=v(".dropdown-menu",a)[0];p.isDescendant(b.target||b.srcElement,c)||(q.remove(a,"is-active"),N.remove())}function F(a){var b=a=a&&a.fullName||"";-1<a.indexOf("_")?b=a.split("_")[0]:-1<a.indexOf(",")?b=a.split(",").slice(1).join(" "):-1<a.indexOf(" ")&&
(b=a.split(" ")[0]);return b.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")}function M(a){if(a)return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#039;").replace(/\//g,"\x26#x2F;")}var N;return f([d,h],{_i18n:B,name:"Header",templateString:b,appState:null,sceneIconTooltip:null,_loggedInChanged:function(a){this.appState.portal&&this._setupHeaderLinks()},_updateHeaderState:function(){this.appState.portal?
(this.baseUrl=l.available?l.baseUrl:"../",this._updateSignedInStatus(),this.own(this.appState.portal.watch("loaded",function(a){a?this._loggedInChanged(!0):this._loggedInChanged(!1)}.bind(this))),this._showPortalUI(),this._setupHeaderLinkUrls()):(q.add("header_map_try","hide"),this._hidePortalUI())},_updateSceneTitle:function(){var a=this.appState.view.map,b=a&&a.portalItem?a.portalItem.title:"",a=a&&a.presentation&&a.presentation.slides&&0<a.presentation.slides.length;null==b&&(b="");r.set("webmap-title-text",
"textContent",b);r.set("webmap-title-text","title",b);q.toggle("webmap-title","sceneHasSlides",a);this.appState.portal?this.appState.portal.isPortal?z.doc.title=this.appState.portal.name+" - "+b:this.appState.portal.isOrg()?z.doc.title=b:z.doc.title="ArcGIS - "+b:z.doc.title=b},_updateSceneType:function(){"global"===this.appState.view.viewingMode?r.set("sceneType","class",""):r.set("sceneType","class","local");this._updateSceneIconTooltip()},_updateSceneIconTooltip:function(){this.sceneIconTooltip||
(this.sceneIconTooltip=new c({connectId:"sceneType",label:"",position:["after"],showDelay:0,hideDelay:0,appState:this.appState}));var a="";this.appState.view.spatialReference&&this.appState.view.spatialReference.wkid&&(a=" ("+B.header.spatialRef+" "+this.appState.view.spatialReference.wkid+")");this.sceneIconTooltip.label="global"===this.appState.view.viewingMode?B.header.globalScene+a:B.header.localScene+a},_updateSceneLink:function(){var a=this.appState.view.map,b=a&&a.portalItem&&a.portalItem.id||
void 0;void 0===b||-1!==b.indexOf(".json")?r.set("webmap-title-text","class","disableLink"):(q.remove("webmap-title-text","disableLink"),a=a.portalItem.portal.getItemLink(a.portalItem),r.set("webmap-title-text","href",a),r.set("webmap-title-text","href",a))},constructor:function(a,b){this.own(a.appState.watch("portal",function(){this._updateHeaderState()}.bind(this)));this.own(a.appState.watch(["portal.user","initialDialogsOpened"],function(){this._updateSignedInStatus()}.bind(this)));this.own(a.appState.watch("view.map.portalItem.title",
function(){this._updateSceneTitle()}.bind(this)));this.own(a.appState.watch("view.viewingMode",function(){this._updateSceneType()}.bind(this)));this.own(a.appState.watch(["view.map","view.map.portalItem.id","view.map.portalItem.loaded"],function(){this._updateSceneLink()}.bind(this)));this.own(a.appState.watch("view.spatialReference",function(){this._updateSceneIconTooltip()}.bind(this)))},destroy:function(){this.inherited(arguments);w.empty(p.byId("webscene-header"))},hideElements:["header_map_home",
"sceneType","header_map_newMap","header_map_signin"],minimize:function(){q.add("webmap-header","small");"min"===this.appState.urlParameters.ui&&q.add("header-full-viewer","show");q.add(p.byId("shadowContainer"),"hide")},maximize:function(){for(var a=0;a<this.hideElements.length;a++)q.remove(this.hideElements[a],"hide");q.remove("webmap-header","small");q.remove(p.byId("shadowContainer"),"hide")},postCreate:function(){this._hidePortalUI();v(".homeHome",this.domNode)[0].innerHTML=B.header.home_link;
v(".homeFeatures",this.domNode)[0].innerHTML=B.header.overview;v(".homePlans",this.domNode)[0].innerHTML=B.header.pricing;v(".homeGallery",this.domNode)[0].innerHTML=B.header.gallery;v(".homeGroups",this.domNode)[0].innerHTML=B.header.groups;v(".homeMyContent",this.domNode)[0].innerHTML=B.header.myContent;v(".homeMyOrg",this.domNode)[0].innerHTML=B.header.myAccount;v(".homeHelp",this.domNode)[0].innerHTML=B.header.support;v(".homeMap",this.domNode)[0].innerHTML=B.header.map;r.set("newMapLabel","innerHTML",
B.header.newScene);r.set("global-scene-link","innerHTML",'\x3cdiv id\x3d"globe-img"\x3e\x3c/div\x3e'+B.header.newGlobal);r.set("local-scene-link","innerHTML",'\x3cdiv id\x3d"local-img"\x3e\x3c/div\x3e'+B.header.newLocal);r.set("modifyMapLabel","innerHTML",B.header.modifyMap);r.set("login-link","innerHTML",B.header.signIn);r.set("logged-in-signOut","innerHTML",B.header.signOut);r.set("logged-in-help","innerHTML",B.header.help);r.set("logged-in-adminhelp","innerHTML",B.header.adminGuide);r.set("esri-community-link",
"innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+B.header.esriCommunity);r.set("my-esri-link","innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+B.header.myEsri+"\x26nbsp;\x26nbsp;");r.set("esri-training-link","innerHTML",'\x3cspan class\x3d"icon-ui-link-external dropdown-link-external-icon"\x3e\x3c/span\x3e'+B.header.training+"\x26nbsp;\x26nbsp;");r.set("trial-download-link","innerHTML",B.header.trialDownloads+
"\x26nbsp;\x26nbsp;");r.set("logged-in-switchAccounts","innerHTML",B.header.switchAccounts);x(this.homeTitle,"click",function(a){u.stop(a);E(this.navDropdown)}.bind(this));x(this.userProfile,"click",function(a){u.stop(a);E(this.userDropdown)}.bind(this));x(this.newScene,"click",function(a){u.stop(a);E(this.newSceneDropdown)}.bind(this));this.FullScreenLink.innerHTML=B.header.fullScreen;this.FullScreenLink.href=this._getFullViewerURL(window.location.search);this._updateHeaderState();this._updateSignedInStatus();
this.appState.view&&(this._updateSceneTitle(),this._updateSceneType(),this._updateSceneLink());("min"===this.appState.urlParameters.ui||this.appState.device.isPhoneSize)&&this.minimize();this.appState.device.isPhoneSize&&"min"!==this.appState.urlParameters.ui&&this.createMobileMenu();var a=this._getRecentScenes();if(0<a.length){q.remove("recentScene-title","hide");for(var b=function(a,b){m(a,{responseType:"image"}).then(function(a){b.thumbnail=a.data.src},function(){b.destroy()})},c=a.length-1;0<=
c;c--){var d=new A({index:c,title:a[c].title,url:this._getItemURL(a[c].id),thumbnail:this.appState.portal.getStaticImage("desktopapp.png"),container:w.place("\x3ca\x3e\x3c/a\x3e","recentScene-title","after")});b(a[c].thumbnail,d)}}q.remove(p.byId("shadowContainer"),"hide")},createMobileMenu:function(){k.when(require,["webSceneViewer/widgets/mobile/Menu/Menu"]).then(function(a){a=a[0];var b=w.create("div",{className:"webscene-mobile-menu"},this.domNode.parentNode.parentNode),c=new a({appState:this.appState},
b);if(a=p.byId("header_map_home"))a.onclick=function(){c.toggle(!0)}}.bind(this))},_getFullViewerURL:function(a){a=g.queryToObject(a.replace(/^\?/,""));delete a.ui;var b=window.location.origin+window.location.pathname;Object.keys(a).length&&(b+="?"+decodeURIComponent(g.objectToQuery(a)));return b},_getItemURL:function(a){var b=y.emptySceneUrl();return b=0<=b.indexOf("?")?b+("\x26webscene\x3d"+a):b+("?webscene\x3d"+a)},_showPortalUI:function(){t.set("header_map_home","display","")},_hidePortalUI:function(){this.appState.device.isPhoneSize||
t.set("header_map_home","display","none")},_setupHeaderLinks:function(){var b=this.appState.portal.isPortal,c=this.appState.portal.user,d=this.appState.portal.isSignedIn()&&c,g=this.appState.portal.isOrg(),c=d&&c;!b&&this.appState.portal.user&&this.appState.portal.user.role&&(this.appState.portal.userRole=new a({id:this.appState.portal.user.roleId?this.appState.portal.user.roleId:this.appState.portal.user.role,role:this.appState.portal.user.role}),this.appState.portal.user.privileges&&this.appState.portal.userRole.setPrivileges(this.appState.portal.user.privileges));
if(d){e&&e.serverInfos&&0<e.serverInfos.length&&e.serverInfos[0].webTierAuth&&v("#logged-in-signOut").addClass("hide");r.set("username","textContent",F(c));r.set("username","title",M(c.fullName));r.set("logged-in-myProfile","innerHTML",B.header.myProfile+"\x3cbr/\x3e"+M(c.username));r.set("logged-in-myProfile","title",M(c.fullName));var f;f=null!==c.thumbnail&&null!==c.thumbnailUrl?c.thumbnailUrl:"../js/arcgisonline/css/images/no-user-thumb.jpg";r.set("dropdown-image","src",f);r.set("profileImgSmall",
"src",f)}q.toggle("header_map_signin","buttonStyle",this.appState.initialDialogsOpened&&!d);q.toggle("header_map_try","hide",!this.appState.initialDialogsOpened||!this.appState.portal||this.appState.portal.isOrg()||d);q.toggle("homeTitle","site_logo top-nav-title",this.appState.portal.showArcGISTitle());q.toggle("homeTitle","top-nav-link",!this.appState.portal.showArcGISTitle());r.set("homeTitle","innerHTML",this.appState.portal.showArcGISTitle()?"Arc\x3cspan\x3eGIS\x3c/span\x3e":B.header.simpleHome);
d?v(".homeHome",this.domNode).removeClass("hide"):v(".homeHome",this.domNode).addClass("hide");b||g?v(".homeFeatures",this.domNode).addClass("hide"):v(".homeFeatures",this.domNode).removeClass("hide");g?v(".homeGallery",this.domNode).removeClass("hide"):v(".homeGallery",this.domNode).addClass("hide");b||g?v(".homePlans",this.domNode).addClass("hide"):v(".homePlans",this.domNode).removeClass("hide");d?v(".homeHelp",this.domNode).addClass("hide"):v(".homeHelp",this.domNode).removeClass("hide");d?v(".homeMyContent",
this.domNode).removeClass("hide"):v(".homeMyContent",this.domNode).addClass("hide");d?v(".homeGroups",this.domNode).removeClass("hide"):v(".homeGroups",this.domNode).addClass("hide");d&&(g||b)?l.available&&l.restrictOrganizationPageToAdmin&&c.role&&"account_admin"!==c.role?v(".homeMyOrg",this.domNode).addClass("hide"):v(".homeMyOrg",this.domNode).removeClass("hide"):v(".homeMyOrg",this.domNode).addClass("hide");d?v("#header_map_newMap").removeClass("hide"):v("#header_map_newMap").addClass("hide");
d?q.add("logged-out-navigation","hide"):q.remove("logged-out-navigation","hide");d?q.remove("logged-in-navigation","hide"):q.add("logged-in-navigation","hide");b&&d&&"org_admin"===c.role?q.remove("logged-in-adminhelp","hide"):q.add("logged-in-adminhelp","hide");!b&&d&&("both"===c.userType&&(q.remove("esri-community-link","hide"),q.remove("my-esri-link","hide"),q.remove("esri-training-link","hide")),this.appState.portal.subscriptionInfo&&"Trial"===this.appState.portal.subscriptionInfo.type&&q.remove("trial-download-link",
"hide"));q.toggle("logged-in-switchAccounts","hide",b||!d);"min"===this.appState.urlParameters.ui&&this.minimize();this._setupHeaderLinkUrls()},_setupHeaderLinkUrls:function(){v(".homeHome",this.domNode)[0].href=this.appState.portal.getHomeLink();v(".homeFeatures",this.domNode)[0].href=this.appState.portal.getFeaturesLink();v(".homePlans",this.domNode)[0].href=this.appState.portal.getPlansLink();v(".homeGallery",this.domNode)[0].href=this.appState.portal.getGalleryLink();v(".homeMap",this.domNode)[0].href=
this.appState.portal.getMapLink();v(".homeGroups",this.domNode)[0].href=this.appState.portal.getGroupsLink();v(".homeMyContent",this.domNode)[0].href=this.appState.portal.getMyContentLink();v(".homeMyOrg",this.domNode)[0].href=this.appState.portal.getMyOrgLink();v(".homeHelp",this.domNode)[0].href=this.appState.portal.getHelpLink();v(".loggedInHelp",this.domNode)[0].href=this.appState.portal.getHelpLink();v("#logged-in-switchAccounts",this.domNode)[0].href=this.appState.portal.getSwitchAccountsLink();
v("#profileLink",this.domNode)[0].href=this.appState.portal.getProfileLink();v("#webmap-try-arcgis",this.domNode)[0].href=this.appState.portal.getTrialLink()},_disableEvent:function(a){a.preventDefault();return!1},_signInLinkClickHandler:function(a){a.preventDefault();this.appState.portal.signIn(!1,!0)},_signOutLinkClickHandler:function(a){if(this.appState.view.map.hasUnsavedChanges)if(confirm(C.messages.pendingChangesConfirm))this.appState.view.map.hasUnsavedChanges=!1;else return;a.preventDefault();
this.appState.portal.signOut()},_communityLinkClickHandler:function(a){a.preventDefault();window.open(l.available&&l.esriCommunityLink,"_blank")},_myEsriLinkClickHandler:function(a){a.preventDefault();window.open(l.available&&l.myEsriLink,"_blank")},_switchAccountsClickHandler:function(a){a.preventDefault();a=this.appState.portal.getSwitchAccountsLink();window.open(a,"_blank")},_trainingLinkClickHandler:function(a){a.preventDefault();a=this.appState.portal.userRole;var b;a?a.isAdmin()||a.isBasedOnAdmin()?
b="//www.esri.com/training/main/arcgis-online-training/administrators":a.isPublisher()||a.isBasedOnPublisher()?b="//www.esri.com/training/main/arcgis-online-training/publishers":a.isUser()||a.isBasedOnUser()?b="//www.esri.com/training/main/arcgis-online-training/users":a.isCustom()&&(b="//www.esri.com/training/main/arcgis-online-training"):b="//www.esri.com/training/main/arcgis-online-training";window.open(b,"_blank")},_trialLinkClickHandler:function(a){a.preventDefault();a=this.appState.portal.user&&
this.appState.portal.user.culture||this.appState.portal&&this.appState.portal.culture||window.dojoConfig&&window.dojoConfig.locale||"en";var b=a.split("-")[0].toLowerCase();"pt"==b?b="pt-br"==a.toLowerCase()?"pt-BR":"pt-PT":"zh"==b&&(b="zh-CN");window.open("https://learn.arcgis.com/"+b+"/trial","_blank")},_loggedInAdminHelpLinkClickHandler:function(a){a.preventDefault();a=this.appState.portal.getloggedInAdminHelpLink();window.open(a,"_blank")},_modifyMapClickHandler:function(a){a.preventDefault();
t.set("header_map_modifyMap","display","none");this.emit("modify-scene",{})},_newSceneClickHandler:function(a){a.preventDefault();a=g.queryToObject(window.location.search.replace(/^\?/,""));delete a.webscene;delete a.url;delete a.layers;a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+decodeURIComponent(g.objectToQuery(a));window.location=a},_newGlobalSceneClickHandler:function(a){a.preventDefault();a=g.queryToObject(window.location.search.replace(/^\?/,""));delete a.webscene;
delete a.url;delete a.layers;delete a.viewingmode;delete a.viewpoint;a=decodeURIComponent(g.objectToQuery(a));window.location.href=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+a+(""===a?"":"\x26")+"viewingmode\x3dglobal"},_newLocalSceneClickHandler:function(a){a.preventDefault();a=g.queryToObject(window.location.search.replace(/^\?/,""));delete a.webscene;delete a.url;delete a.layers;delete a.viewingmode;delete a.viewpoint;a=decodeURIComponent(g.objectToQuery(a));
window.location.href=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+a+(""===a?"":"\x26")+"viewingmode\x3dlocal"},_updateSignedInStatus:function(){null!=this.appState.portal&&this.appState.portal.isSignedIn()?this._loggedInChanged(!0):this._loggedInChanged(!1)},_getRecentScenes:function(){if(!this.appState.portal||!this.appState.portal.isSignedIn())return[];var a=this.appState.view.map,b=a&&a.portalItem&&a.portalItem.id;return n.getRecentScenes(this.appState.portal.user.username).filter(function(a){return a.id!==
b}.bind(this)).slice(0,3)}})})},"webSceneViewer/widgets/Header/Role":function(){define(["require","esri/core/declare","dojo/_base/lang","dojo/_base/array","dojo/json"],function(m,f,k,e,g){return f(null,{declaredClass:"arcgisonline.sharing.dijit.Role",basePath:m.toUrl("arcgisonline/sharing/dijit"),id:null,baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(d){d=d||{};this.id=d.id;this.baseRole=d.role;this.name=d.name;this.description=d.description},_initPrivilegesObject:function(){this.privilegeObj=
{portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},
features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},_readPrivileges:function(d){null!=d&&Array.isArray(d)&&e.forEach(d,k.hitch(this,function(d){this._readPrivilege(d)}))},_readPrivilege:function(d){this._applyEffectToAction(!0,d)},_applyEffectToAction:function(d,e){switch(e){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=
d;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=d;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=d;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=d;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=d;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=d;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=
d;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=d;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=d;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=d;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=d;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=d;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=
d;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=d;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=d;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=d;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=d;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=d;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=
d;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=d;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=d;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=d;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=d;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=d;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=
d;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=d;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=d;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=d;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=d;break;case "features:user:edit":this.privilegeObj.features.user.edit=d;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=d;break;
case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=d;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=d;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=d;break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=d;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=d;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=
d;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=d;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=d;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=d;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=d;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=d}},_applyToAll:function(d){this.privilegeObj.portal.admin.inviteUsers=d;this.privilegeObj.portal.admin.disableUsers=
d;this.privilegeObj.portal.admin.viewUsers=d;this.privilegeObj.portal.admin.updateUsers=d;this.privilegeObj.portal.admin.deleteUsers=d;this.privilegeObj.portal.admin.changeUserRoles=d;this.privilegeObj.portal.admin.viewGroups=d;this.privilegeObj.portal.admin.updateGroups=d;this.privilegeObj.portal.admin.deleteGroups=d;this.privilegeObj.portal.admin.reassignGroups=d;this.privilegeObj.portal.admin.assignToGroups=d;this.privilegeObj.portal.admin.manageEnterpriseGroups=d;this.privilegeObj.portal.admin.viewItems=
d;this.privilegeObj.portal.admin.updateItems=d;this.privilegeObj.portal.admin.deleteItems=d;this.privilegeObj.portal.admin.reassignItems=d;this.privilegeObj.portal.admin.manageLicenses=d;this.privilegeObj.portal.publisher.publishFeatures=d;this.privilegeObj.portal.publisher.publishTiles=d;this.privilegeObj.portal.publisher.publishScenes=d;this.privilegeObj.portal.user.createGroup=d;this.privilegeObj.portal.user.joinGroup=d;this.privilegeObj.portal.user.joinNonOrgGroup=d;this.privilegeObj.portal.user.createItem=
d;this.privilegeObj.portal.user.shareToGroup=d;this.privilegeObj.portal.user.shareToOrg=d;this.privilegeObj.portal.user.shareToPublic=d;this.privilegeObj.portal.user.shareGroupToOrg=d;this.privilegeObj.portal.user.shareGroupToPublic=d;this.privilegeObj.features.user.edit=d;this.privilegeObj.opendata.user.openDataAdmin=d;this.privilegeObj.opendata.user.designateGroup=d;this.privilegeObj.premium.user.geocode=d;this.privilegeObj.premium.user.networkanalysis=d;this.privilegeObj.premium.user.spatialanalysis=
d;this.privilegeObj.premium.user.geoenrichment=d;this.privilegeObj.premium.user.demographics=d;this.privilegeObj.premium.user.elevation=d;this.privilegeObj.marketplace.admin.purchase=d;this.privilegeObj.marketplace.admin.manage=d;this.privilegeObj.marketplace.admin.startTrial=d},_buildPrivilegesArray:function(){var d=[];!0===this.privilegeObj.portal.admin.inviteUsers&&d.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&d.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&
d.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&d.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&d.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&d.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&d.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&d.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&
d.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&d.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&d.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&d.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&d.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&d.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&
d.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&d.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&d.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&d.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&d.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&d.push("portal:publisher:publishScenes");
!0===this.privilegeObj.portal.user.createGroup&&d.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&d.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&d.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&d.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&d.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&d.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&
d.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&d.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&d.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&d.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&d.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&d.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&
d.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&d.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&d.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&d.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&d.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&d.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&
d.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&d.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&d.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&d.push("marketplace:admin:startTrial");return d},isUser:function(){return"org_user"===this.id||"account_user"===this.id},isPublisher:function(){return"org_publisher"===this.id||"account_publisher"===this.id},isAdmin:function(){return"org_admin"===
this.id||"account_admin"===this.id},isBasedOnUser:function(){return this.isUser()||"org_user"===this.baseRole||"account_user"===this.baseRole},isBasedOnPublisher:function(){return this.isPublisher()||"org_publisher"===this.baseRole||"account_publisher"===this.baseRole},isBasedOnAdmin:function(){return this.isAdmin()||"org_admin"===this.baseRole||"account_admin"===this.baseRole},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&null!=this.id&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(d){this.privileges=d;this._initPrivilegesObject();null!=d&&this._readPrivileges(d)},stringify:function(){return g.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return g.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return g.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return g.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"webSceneViewer/widgets/Header/RecentSceneLink":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/widgets/BrowseItems/plugins/PluginConfigurableApps esri/core/accessorSupport/decorators esri/widgets/support/widget esri/widgets/Widget".split(" "),function(m,f,k,e,g,d,h,c){return function(b){function a(){return null!==b&&b.apply(this,
arguments)||this}k(a,b);a.prototype.render=function(){return h.tsx("a",{bind:this,id:"recentScene-"+this.index+"-link",class:"recentScene dropdown-link",href:this.url},h.tsx("table",{cellpadding:"0",cellspacing:"0",style:"width:270px;"},h.tsx("tbody",null,h.tsx("tr",null,h.tsx("td",{class:"recentScene-thumbnail",valign:"top"},h.tsx("img",{src:this.thumbnail})),h.tsx("td",{class:"title",valign:"top"},h.tsx("span",{title:this.title},this.title))))))};e([d.property(),h.renderable()],a.prototype,"url",
void 0);e([d.property(),h.renderable()],a.prototype,"thumbnail",void 0);e([d.property(),h.renderable()],a.prototype,"title",void 0);e([d.property(),h.renderable()],a.prototype,"index",void 0);return a=e([d.subclass("webSceneViewer.widgets.Header.RecentSceneLink")],a)}(d.declared(c))})},"esri/widgets/BrowseItems/plugins/PluginConfigurableApps":function(){define("dojo/_base/declare dojo/_base/kernel dojo/Deferred ../../../core/lang ../_AppTemplateFiltersMixin ../../../portal/PortalQueryParams dojo/i18n!../nls/BrowseItems".split(" "),
function(m,f,k,e,g,d,h){var c=m(null,{declaredClass:"esri.widgets.BrowseItems.plugins.PluginConfigurableApps",_css:{base:"esri-browseitems",button:"esri-button",close:"esri-button esri-close"},infoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv class\x3d"thumbnail"\x3e\x3cimg src\x3d"${item:_formatInfoPanelImage}"\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d"quiet-scroll"\x3e${item.snippet}\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e\x3cbutton class\x3d"${_css.button}" title\x3d"${i18n.items.createApp}"id\x3d"create-app"\x3e${i18n.items.createApp}\x3c/button\x3e\x3cbutton class\x3d"${_css.button}" title\x3d"${i18n.preview}" id\x3d"preview-app"\x3e${i18n.preview}\x3c/button\x3e\x3cbutton class\x3d"${_css.button}" title\x3d"${i18n.download}" id\x3d"download-app"\x3e${i18n.download}\x3c/button\x3e\x3cbutton class\x3d"${_css.close}" id\x3d"close-panel"\x3e${i18n.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
customGroupInfoPanelTemplate:'\x3cdiv\x3e\x3cdiv class\x3d"template-info-showing"\x3e\x3cdiv class\x3d"thumbnail"\x3e\x3cimg src\x3d"${item:_formatInfoPanelImage}"\x3e\x3c/div\x3e\x3ch4\x3e${item.title}\x3c/h4\x3e\x3cdiv class\x3d"template-info"\x3e\x3cp class\x3d"quiet-scroll"\x3e${item.snippet}\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-actions"\x3e\x3cbutton class\x3d"btn blue btn-main" id\x3d"create-app"\x3e${i18n.items.createApp}\x3c/button\x3e\x3cbutton class\x3d"btn btn-secondary btn-wide" id\x3d"preview-app"\x3e${i18n.preview}\x3c/button\x3e\x3cbutton class\x3d"btn btn-cancel" id\x3d"close-panel"\x3e${i18n.close}\x3c/button\x3e\x3c/div\x3e\x3cdiv\x3e',
filters:e.mixin({},g.rootNodes.app),filterStrings:h.appTemplateFilters,rowsPerPage:9,extraClasses:[],_portal:null,_user:null,_groups:[],filterType:"all",constructor:function(b){e.mixin(this,b)},fetchData:function(){var b=[];this._portal=this.parent.get("portal");this._user=this._portal.user;this.parent.types=['type:"Web Mapping Application"'];this.helpLinkUrl||(this.helpLinkUrl=this._portal?this._portal.helpBase+this._portal.helpMap.m["120001055"]:"");return this._fetchGroups().then(function(a){a=
a||[];a.forEach(function(a){a&&a.id&&b.push('group:"'+a.id+'"')});return this._fetchGroupItems(b)}.bind(this))},_fetchGroups:function(){var b;return(b=this._portal.templatesGroupQuery||null)&&b.split("id:")[1]?this._fetchOrgConfigurableApps():this._fetchEsriConfigurableApps()},_fetchGroup:function(b,a){var c=new k;this._groups[b]?c.resolve([this._groups[b]]):this._portal.queryGroups(a,!0).then(function(a){a=a.total&&a.results&&a.results[0]||{};this._groups[b]=a;c.resolve([a])}.bind(this));return c},
_fetchGroupItems:function(b){b={groups:b,persistentTypekeywords:['-typekeywords:"Web AppBuilder"','-typekeywords:"WAB3D"'],types:['type:"Web Mapping Application"']};"2d"===this.filterType?(b.persistentTypekeywords.push('-typekeywords:"3Dscene"'),delete this.filters.present,delete this.filters["3dscene"]):"3d"===this.filterType&&(b.persistentTypekeywords.push('typekeywords:"3Dscene"'),this.filters=null);return this.parent._fetchItems(b)},_fetchEsriConfigurableApps:function(){var b=this._user&&this._user.culture||
this._portal&&this._portal.culture||f.locale||"en",a=new d({query:'title:"Web Application Templates" AND owner:"esri_'+b.split("-")[0].toLowerCase()+'"'});return this._fetchGroup("esriGallery_"+b,a).then(function(a){return a||[]})},_fetchOrgConfigurableApps:function(){var b=new d({query:this._portal.templatesGroupQuery||null});this.filters=null;this.rowsPerPage=8;this.extraClasses=["wide"];this.infoPanelTemplate=this.customGroupInfoPanelTemplate;return this._fetchGroup("customGallery",b).then(function(a){var b=
[];a&&a.length&&0<a.length&&(this.parent.sortDescending=a[0].sortOrder&&"desc"===a[0].sortOrder,this.parent.sortAttribute=a[0].sortField||"asc",b.push(a[0]));return b}.bind(this))}});e.mixin(c,{add:function(b,a){b.plugin||(a=e.mixin(a,{parent:b,filterType:b.filterType}),b.plugin=new c(a))},remove:function(b){b.plugIn&&(b.plugin.destroy(),delete b.plugIn)}});return c})},"esri/widgets/BrowseItems/_AppTemplateFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{app:{all:{},
narrate:{typekeywords:["story"]},collect:{typekeywords:["collect"]},compare:{typekeywords:["compare"]},"3dscene":{typekeywords:["3Dscene"]},analyze:{typekeywords:["summarize"]},present:{typekeywords:["gallery"]},social:{typekeywords:["social"]},local:{typekeywords:["local"]},route:{typekeywords:["route"]},showcase:{typekeywords:["showcase"]}}}}})},"webSceneViewer/widgets/MapControls/MapControls":function(){define("esri/core/declare dojo/dom-construct dojo/dom-class esri/core/watchUtils esri/widgets/Zoom esri/widgets/Home esri/widgets/NavigationToggle dojo/Evented dojo/i18n!../nls/widgets".split(" "),
function(m,f,k,e,g,d,h,c,b){return m(c,{appState:null,constructor:function(a){this.appState=a;var c=a.view,m=f.create("div",{className:"mapControlsContainer"},c.container);this._domNode=m;var p=f.create("div",{},m);this.homeWidget=new d({container:p,viewModel:{view:c},goToOverride:this._createHomeGoToOverride()});this.homeWidget.domNode.title=b.mapControls.home;this.appState.device.isPhoneSize&&e.init(c.map,"presentation.slides",function(a){k.toggle(this.homeWidget.domNode,"hide",a&&0<a.length)}.bind(this));
this.homeWidget.on("go",function(a){this.appState.telemetry.logEvent({category:"client_behaviour",label:"home_button",action:"click"})}.bind(this));this.homeWidget.renderNow();0<this.homeWidget.domNode.children.length&&(this.homeWidget.domNode.children[0].title=b.mapControls.home);(a=a.urlParameters.getViewpointObject())?this.homeWidget.viewpoint=a.clone():c.get("map.initialViewProperties.viewpoint")&&this._updateViewpoint();e.watch(c,"map.initialViewProperties.viewpoint",this._updateViewpoint.bind(this));
if(!this.appState.device.isPhoneSize&&(a=f.create("div",{},m),new g({container:a,viewModel:{view:c}}),!this.appState.device.isMobile)){var q=f.create("div",{},m);new h({container:q,viewModel:{view:c}});e.init(c,"inputManager.latestPointerType",function(a){k.toggle(q,"touch-disabled","touch"===a)})}},addStyleClass:function(a){k.add(this._domNode,a)},removeStyleClass:function(a){k.remove(this._domNode,a)},_updateViewpoint:function(){var a=this.appState.view.get("map.initialViewProperties.viewpoint");
a&&(this.homeWidget.viewpoint=a)},_createHomeGoToOverride:function(){var a=Date.now();return function(b,c){var d=Date.now(),e=300>=d-a;a=d;e&&(c.options||(c.options={}),c.options.animate=!1);return b.goTo(c.target,c.options)}}})})},"esri/widgets/Home":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!../nls/common dojo/i18n!./Home/nls/Home ../core/accessorSupport/decorators ./Widget ./Home/HomeViewModel ./support/widget".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(c){function f(a){a=c.call(this)||this;a.goToOverride=null;a.iconClass="esri-icon-home";a.label=d.widgetLabel;a.view=null;a.viewModel=new b;a.viewpoint=null;return a}k(f,c);f.prototype.cancelGo=function(){return null};f.prototype.go=function(){return null};f.prototype.render=function(){var b,c,e=this.get("viewModel.state"),f=(b={},b["esri-disabled"]="disabled"===e,b);b=(c={},c["esri-icon-loading-indicator"]="going-home"===e,c["esri-rotating"]="going-home"===
e,c);c="going-home"===e?g.cancel:d.title;return a.tsx("div",{bind:this,class:this.classes("esri-home esri-widget--button esri-widget",f),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":c,title:c},a.tsx("span",{"aria-hidden":"true",class:this.classes("esri-icon esri-icon-home",b)}),a.tsx("span",{class:"esri-icon-font-fallback-text"},d.button))};f.prototype._go=function(){var a=this.viewModel;"going-home"===a.state?a.cancelGo():a.go()};e([h.aliasOf("viewModel.goToOverride")],
f.prototype,"goToOverride",void 0);e([h.property()],f.prototype,"iconClass",void 0);e([h.property()],f.prototype,"label",void 0);e([h.aliasOf("viewModel.view"),a.renderable()],f.prototype,"view",void 0);e([h.property({type:b}),a.renderable("viewModel.state"),a.vmEvent("go")],f.prototype,"viewModel",void 0);e([h.aliasOf("viewModel.viewpoint")],f.prototype,"viewpoint",void 0);e([h.aliasOf("viewModel.cancelGo")],f.prototype,"cancelGo",null);e([h.aliasOf("viewModel.go")],f.prototype,"go",null);e([a.accessibleHandler()],
f.prototype,"_go",null);return f=e([h.subclass("esri.widgets.Home")],f)}(h.declared(c))})},"esri/widgets/Home/HomeViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Viewpoint ../../core/Accessor ../../core/Error ../../core/Evented ../../core/promiseUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){return function(c){function d(a){a=c.call(this,a)||this;a._initialViewpoint=
null;a._goingHome=null;a.go=a.go.bind(a);return a}k(d,c);d.prototype.destroy=function(){this._cancelGo();this.view=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?this._goingHome?"going-home":"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{set:function(a){var b=this;this._initialViewpoint=null;a&&a.when(function(){b._initialViewpoint=a.viewpoint.clone();b.notifyChange("viewpoint")});this._set("view",a)},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"viewpoint",{get:function(){return this._get("viewpoint")||this._initialViewpoint},set:function(a){this._set("viewpoint",a)},enumerable:!0,configurable:!0});d.prototype.go=function(){var a=this;if(!this.get("view.ready"))return b.reject(new h("home:disabled-state","Cannot go when disabled."));this._cancelGo();this.notifyChange("state");this.emit("go");var c=!1,d=this.callGoTo({target:this.viewpoint}).catch(function(){}).then(function(){a.notifyChange("state");
a._goingHome=null;c=!0});c||(this._goingHome=d,this.notifyChange("state"));return d};d.prototype.cancelGo=function(){this._cancelGo()};d.prototype._cancelGo=function(){var a=this._goingHome;a&&a.cancel();this._goingHome=null};e([a.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);e([a.property()],d.prototype,"view",null);e([a.property({type:g})],d.prototype,"viewpoint",null);e([a.property()],d.prototype,"go",null);e([a.property()],d.prototype,"cancelGo",null);return d=e([a.subclass("esri.widgets.Home.HomeViewModel")],
d)}(a.declared(d,c,l))})},"webSceneViewer/widgets/MessageListWidget/MessageListWidget":function(){define("esri/core/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/MessageListWidget.html ./MessageWidget dojo/Evented".split(" "),function(m,f,k,e,g,d){return new (m([f,k,d],{declaredClass:"MessageListWidget",templateString:e,MessageTypes:{INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error"},direction:"b2t",messages:[],constructor:function(d){},postCreate:function(){},
show:function(d){"string"===typeof d&&(d={message:d});d.removeAllFunc=this.removeAll.bind(this);var c=new g(d);"t2b"===this.direction?c.placeAt(this.MessageListContentNode,0):c.placeAt(this.MessageListContentNode);this.own(c.on("remove",function(){this.messages=this.messages.filter(function(b){return b!=c})}.bind(this)));this.messages.push(c)},removeAll:function(){this.messages.forEach(function(d){d.remove()})}}))})},"webSceneViewer/widgets/MessageListWidget/MessageWidget":function(){define("esri/core/declare esri/core/has dijit/_WidgetBase dijit/_TemplatedMixin dojo/dom-class dojo/on dojo/dom-attr dojo/_base/fx dojo/text!./templates/MessageWidget.html dojo/Evented dojo/i18n!../nls/widgets".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return m([k,e,a],{declaredClass:"MessageWidget",MessageTypes:{INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error"},templateString:b,message:void 0,details:void 0,type:void 0,timeout:void 0,collapsed:!1,removeAllFunc:void 0,constructor:function(a){},_onRemove:function(a){(a.metaKey||a.ctrlKey)&&this.removeAllFunc?this.removeAllFunc():this.remove()},_onRemoveAll:function(a){this.removeAllFunc&&this.removeAllFunc()},remove:function(){this.emit("remove",this);
clearTimeout(this.timer);var a=c.fadeOut({node:this.domNode,duration:500}).play();d.once(a,"End",function(a,b){this.destroy()}.bind(this))},postCreate:function(){if(void 0===this.type||this.type!==this.MessageTypes.INFO&&this.type!==this.MessageTypes.SUCCESS&&this.type!==this.MessageTypes.WARNING&&this.type!==this.MessageTypes.ERROR)this.type=this.MessageTypes.INFO;void 0===this.collapsed&&(this.collapsed=!1);void 0===this.timeout&&(this.timeout=this.type===this.MessageTypes.ERROR?0:1E4);g.add(this.domNode,
this.type);this.MessageShortDesc.innerHTML=this.message;this.MessageShortDesc.title=this.MessageShortDesc.textContent;this.details&&""!==this.details?this.MessageDetails.innerHTML=this.details:(g.add(this.ExpandIcon,"hide"),g.add(this.MessageDetails,"hide"));this.collapsed&&g.add(this.domNode,"collapsed");g.add(this.MessageTypeIcon,this.type+"Icon");0<this.timeout&&(this.timer=setTimeout(function(){this.remove()}.bind(this),this.timeout));c.fadeIn({node:this.domNode,duration:500}).play();var a=l.messageWidget.close,
a=f("mac")?a+(" "+l.messageWidget.closeShortcutMac):a+(" "+l.messageWidget.closeShortcut);h.set(this.closeIcon,"title",a)},_expand:function(a){if(""!==this.details&&(a=a.target?a.target:a.srcElement,-1===a.className.indexOf("closeIcon")))if(-1===a.className.indexOf("MessageWidget")&&(a=a.parentNode),-1!==a.className.indexOf("expand"))g.remove(a,"expand");else{var b=a.parentNode;if(3<b.childNodes.length)for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];d===a?g.add(d,"expand"):g.remove(d,
"expand")}}}})})},"webSceneViewer/widgets/WelcomeWidget/WelcomeWidget":function(){define("esri/request esri/core/declare esri/core/watchUtils esri/core/Handles dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/DialogUnderlay dojo/dom-construct dojo/dom-class dojo/on dojo/io-query ./WelcomeWidgetViewModel ../Dialog/ClosableDialog dojo/text!./templates/WelcomeWidget.html dojo/i18n!../nls/widgets".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){return f([g,q,d,h],{templateString:r,
_i18n:t,viewModel:null,galleryContainer:null,appState:null,constructor:function(a,b){this.viewModel=new p(a);this._handles=new e;this.draggable=!1;this.autoCenter=!0},resize:function(){},hide:function(){this.appState.initialDialogsOpened=!1;this.inherited(arguments);this.destroy()},show:function(){this.inherited(arguments);this.appState.initialDialogsOpened=!0;a.add(c._singleton.domNode,"welcomeWidgetUnderlay")},postCreate:function(){this.inherited(arguments);this.startup();this._initializeWatchers()},
getScenes:function(){return k.whenOnce(this.viewModel,"appState.portal").then(function(){return this.viewModel.getScenes(this.viewModel.numberOfScenes).then(function(a){this.viewModel.scenes=a;this._initializeSceneList();return a}.bind(this))}.bind(this))},_initializeSceneList:function(){b.empty(this.welcomeWidgetContainer);this._handles.remove();7>=this.viewModel.scenes.length&&this._initializeScene(null,this.welcomeWidgetContainer);this.viewModel.scenes.forEach(function(a){this._initializeScene(a,
this.welcomeWidgetContainer)}.bind(this))},_initializeScene:function(c,d){if(c){d=b.create("div",{className:"scene"},d);var e=b.create("div",{className:"sceneThumbnail thumbOther"},d);null!==c.thumbnail&&m(c.thumbnail,{responseType:"image"}).then(function(b){a.remove(e,"thumbOther");e.style.backgroundImage="url("+b.data.src+")"});b.create("div",{innerHTML:c.title,className:"sceneTitle",title:c.title},d);b.place('\x3cdiv class\x3d"icon-helper" title\x3d"'+t.welcomeWidget[c.iconType]+'"\x3e\x3cdiv class\x3d"iconType '+
c.iconType+'"/\x3e\x3c/div\x3e',d);this._handles.add(l(d,"click",this._existingSceneClicked.bind(this,c)))}else d=b.create("div",{className:"scene newScene"},d),c=b.create("div",{className:"newSceneContainer"},d),b.create("div",{className:this.viewModel.canCreateNewScene?"newSceneIcon":"earthIcon"},c),b.create("div",{innerHTML:this.viewModel.canCreateNewScene?t.welcomeWidget.newScene:t.welcomeWidget.explore,className:"sceneTitle"},c),this._handles.add(l(d,"click",function(){this.appState.initialDialogsOpened=
!1;this.viewModel.canCreateNewScene?this.emit("open-editor"):this.emit("open-search-tool");this.hide()}.bind(this)))},_crossClicked:function(){this.appState.initialDialogsOpened=!1;this.emit("open-search-tool");this.hide()},_existingSceneClicked:function(a,b){b.preventDefault();b=n.queryToObject(window.location.search.replace(/^\?/,""));delete b.webscene;delete b.url;delete b.layers;delete b.viewingmode;delete b.viewpoint;var c=window.location.protocol+"//"+window.location.host+window.location.pathname;
Object.keys(b).length&&(c+="?"+decodeURIComponent(n.objectToQuery(b)));c+=(Object.keys(b).length?"\x26":"?")+"webscene\x3d"+a.id;window.location.href=c},_initializeWatchers:function(){this.own(k.init(this.viewModel,"appState",function(){this.appState.portal.isOrg()?this.galleryLink.href=this.appState.portal?this.appState.portal.getScenesGalleryLink():"":a.add(this.galleryLink,"hide");this.appState.portal&&this.appState.portal.helpBase?this.helpLink.href=this.appState.portal.helpBase+this.appState.portal.helpMap.m["120001090"]:
a.add(this.helpLink,"hide")}.bind(this)));this.own(this.on("background-clicked",function(){this.appState.initialDialogsOpened=!1;this.emit("open-search-tool")}.bind(this)))}})})},"webSceneViewer/widgets/WelcomeWidget/WelcomeWidgetViewModel":function(){define("require exports esri/core/tsSupport/declareExtendsHelper esri/core/tsSupport/decorateHelper esri/core/accessorSupport/decorators esri/core/Accessor esri/core/promiseUtils ../../support/persistedSettingsUtils ../../support/queryUtils esri/portal/PortalQueryParams".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a.scenes=[];return a}k(f,d);Object.defineProperty(f.prototype,"isSignedIn",{get:function(){return!!this.appState.portal&&!!this.appState.portal.user},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"numberOfScenes",{get:function(){return this.isSignedIn?7:8},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"canCreateNewScene",{get:function(){return this.isSignedIn&&
this.appState.portal.userHasEditingPrivileges()},enumerable:!0,configurable:!0});f.prototype.getScenes=function(a){var b=this;void 0===a&&(a=7);var c=this._getRecentScenes(a);c.forEach(function(a){return a.iconType="recent"});var d=[];return c.length!==a&&this.appState.portal?this._getMostViewedScenes(a-c.length).then(function(e){d=e;if(0<e.length){var g=e[0];e[0].iconType="frequent";b._addScene(c,g,a)}return c}).then(function(){return b._getFeaturedScenes(a-c.length+5)}).then(function(e){e.forEach(function(d){d.iconType=
"featured";c=b._addScene(c,d,a)});for(d.shift();c.length<a&&0<d.length;)e=d.shift(),e.iconType="frequent",b._addScene(c,e,a);return c}):h.resolve(c)};f.prototype._addScene=function(a,b,c){b&&!a.some(function(a){return a.id===b.id})&&a.length<c&&a.push(b);return a};f.prototype._getRecentScenes=function(a){void 0===a&&(a=7);return a?c.getRecentScenes(this.isSignedIn?this.appState.portal.user.username:void 0):[]};f.prototype._getMostViewedScenes=function(b){void 0===b&&(b=1);return this.appState.portal.queryItems(new a({query:'type:"Web Scene" AND tags:"scenes"',
sortField:"numViews",sortOrder:"desc",num:b,disableExtraQuery:!0})).then(function(a){return a.results.map(function(a){return{id:a.id,title:a.title,owner:a.owner,thumbnail:a.thumbnailUrl}})})};f.prototype._getFeaturedScenes=function(a){void 0===a&&(a=3);return a?b.queryFeaturedWebscenes(this.appState.portal,null,a).then(function(a){return a.results.map(function(a){return{id:a.id,title:a.title,owner:a.owner,thumbnail:a.thumbnailUrl}})}):h.resolve([])};e([g.property()],f.prototype,"appState",void 0);
e([g.property()],f.prototype,"scenes",void 0);e([g.property({readOnly:!0,dependsOn:["appState.portal","appState.portal.user"]})],f.prototype,"isSignedIn",null);return f=e([g.subclass("esri.widgets.WelcomeWidget")],f)}(g.declared(d))})},"webSceneViewer/support/queryUtils":function(){define(["require","exports","esri/portal/PortalQueryParams","esri/core/promiseUtils"],function(m,f,k,e){function g(d){var g=d.livingAtlasGroupQuery;return g?d.queryGroups(new k({query:g,disableExtraQuery:!0})).then(function(c){if(0<
c.results.length)return c.results[0].id}):e.resolve(null)}Object.defineProperty(f,"__esModule",{value:!0});f.queryFeaturedWebscenes=function(d,f,c){void 0===c&&(c=null);return g(d).then(function(b){return b?'(group:"'+b+'" AND tags:"scenes" AND -tags:"mature support" AND type:"Web Scene")':null}).then(function(b){return b?(b=f&&""!==f?b+" AND "+f:b,b={query:b,sortField:"modified",sortOrder:"desc",disableExtraQuery:!0},c&&(b.num=c),d.queryItems(new k(b))):e.resolve({results:[]})})}})},"webSceneViewer/widgets/SlideDeck/SlideDeck":function(){define("esri/core/declare esri/core/watchUtils esri/core/Handles dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/dom dojo/query dojo/has dojo/dom-style dojo/_base/window dojo/_base/fx ../ScrollBar/ScrollBar ../../support/uiUtils dijit/Tooltip".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){return m(null,{name:"SlideDeck",baseClass:"SlideDeck",appState:null,watchHandlers:null,currentSlidePlay:null,currentSlideIndexPlay:null,playing:!1,slideTitleTimeoutId:null,constructor:function(a,b){this.watchHandlers=new k;this.appState=a.appState;this.cls=a.class;this.container=this.mainContainerNode=b;g.add(b,"slideDeck");this.slideNodes=[];f.when(a.appState.view,"map",function(){this._initialize()}.bind(this))},_initialize:function(){this.watchHandlers.removeAll();
this.webScene=this.appState.view.map;var a=this._slidesChanged.bind(this),a=f.on(this.appState.view,"map.presentation.slides","change",a,a);this.watchHandlers.add(a,"map");"SlideDeck"===this.baseClass&&((new MutationObserver(this._slideContainerAttributeChanged.bind(this))).observe(this.container,{attributes:!0,childList:!1,characterData:!1,attributeFilter:["class"],attributeOldValue:!0}),l.set(this.container,"opacity","0"),setTimeout(this._fadeSlidesIn.bind(this,!0),3E3));r.isFullScreenEnabled||
g.add(this.container,"NoFullScreenElement")},_slidesChanged:function(a){a&&"esri.core.Collection\x3cwebSceneViewer.webscene.Slide\x3e"===a.declaredClass||l.set(this.container,"opacity","");this._update();this.watchHandlers.remove("slides");this.watchHandlers.add(this.webScene.presentation.slides.map(function(a){return a.watch(["title","thumbnail.url"],this._update.bind(this))},this),"slides")},_updatePlayButton:function(a){this.playButton=d.create("div",{"class":"playButton"},a);this.playIcon=d.create("button",
{"class":"playIcon"},this.playButton);this.watchHandlers.add(h(this.playButton,"click",function(){this.playing?this._stopPlay():this._startPlay()}.bind(this)));this.watchHandlers.add(this.appState.view.watch("interacting",function(){this._stopPlay()}.bind(this)));this.watchHandlers.add(h(document.body,"click",function(a){this.playing&&(c.isDescendant(a.target?a.target:a.srcElement,this.playButton)||this._stopPlay())}.bind(this)))},_startPlay:function(){if(null==this.currentSlideIndexPlay||this.currentSlideIndexPlay>=
this.webScene.presentation.slides.length)this.currentSlideIndexPlay=0;this.currentSlideIndexPlay<this.webScene.presentation.slides.length&&(this.playing=!0,g.add(this.playButton,"playing"),this._play())},_stopPlay:function(){this.playing=!1;this.appState.view.animation&&this.appState.view.animation.stop();g.remove(this.playButton,"playing")},_play:function(){if(this.playing){if(this.currentSlideIndexPlay>=this.webScene.presentation.slides.length||null==this.currentSlideIndexPlay)this.currentSlideIndexPlay=
0;this.currentSlidePlay=this.webScene.presentation.slides.getItemAt(this.currentSlideIndexPlay);this.currentSlidePlay.applyTo(this.appState.view).then(function(){this._highlightBookmark(this.mainContainerNode.id+"slideButton"+this.currentSlidePlay.id);setTimeout(function(){this.currentSlideIndexPlay++;this._play()}.bind(this),2E3)}.bind(this))}else this._stopPlay()},_update:function(){function c(a,c,d){k=null;this.appState.device.isMobile&&(m=!0,t.show(a.title.text,c,["landscape"===this.appState.device.orientation?
"before":"above"]),b(".dijitTooltip").addClass("mobileTooltipVisible"))}this.slideNodes=[];null!=this.outerContainer&&(d.destroy(this.outerContainer),this.innerContainer=this.outerContainer=null);if(this.appState.view.map){var f=this.webScene.presentation.slides.length;if(0===f)g.remove(n.body(),"esriHasSlides");else{g.add(n.body(),"esriHasSlides");this.outerContainer=d.create("div",{"class":"Slidebar"});a("enable-feature:slide-play")&&(g.add(this.outerContainer,"usePlayButton"),this._updatePlayButton(this.outerContainer));
var l=d.create("div",{"class":"marginContainer"});this.innerContainer=d.create("ul",{"class":"slideDeckInner"});this.innerContainer.style.touchAction=this.appState.device.isMobile?"auto":"none";d.place(this.outerContainer,this.mainContainerNode,"first");d.place(l,this.outerContainer,"first");d.place(this.innerContainer,l,"first");this.titleContainer=b(".slideTitle")[0];this.titleContainer||(this.titleContainer=d.create("div",{class:"slideTitle"}),d.place(this.titleContainer,this.mainContainerNode.parentNode,
"first"));this.cls&&g.add(this.innerContainer,this.cls);for(var k=null,m=!1,l=0;l<f;l++){var p=this.webScene.presentation.slides.getItemAt(l),r=d.create("li",{"class":"slide",nr:l,bmid:p.id},this.innerContainer);this.slideNodes.push(r);r=d.create("div",{"class":"slideButton",id:this.mainContainerNode.id+"slideButton"+p.id},r);d.create("div",{"class":"slideOverlay"},r);d.create("p",{"class":"smallTitle",innerHTML:p.title.text,title:p.title.text},r);d.create("div",{"class":"homeIcon"},r);d.create("img",
{src:p.thumbnail.url},r);this.watchHandlers.add(h(r,"dblclick",e.partial(function(a,b,c){this._transitionToSlide(a,b,!0)}.bind(this),p,l)));this.watchHandlers.add(h(r,"click",e.partial(function(a,b,c){m?m=!1:this.horizontalScrollbar&&this.horizontalScrollbar.preventElementClicks||this._transitionToSlide(a,b,!1)}.bind(this),p,l)));this.watchHandlers.add(h(r,"touchstart",e.partial(function(a,b,d,e){null!==k&&clearTimeout(k);k=setTimeout(c.bind(this,a,d,e),1E3)}.bind(this),p,l,r)));this.watchHandlers.add(h(r,
"touchend, touchcancel, touchmove",e.partial(function(a,c){null!==k&&(clearTimeout(k),k=null);this.appState.device.isMobile&&(t.hide(a),b(".dijitTooltip").removeClass("mobileTooltipVisible"))}.bind(this),r)))}"SlideDeck"===this.name&&(this.horizontalScrollbar=new q({scrollTarget:this.innerContainer,appState:this.appState,view:this.appState.view}),this.horizontalScrollbar.startup(),this.horizontalScrollbar.placeAt(this.outerContainer),this.horizontalScrollbar.updateWidth(),this.appState.device.isMobile||
this.horizontalScrollbar.enableCustomScrollTargetDrag())}}},_transitionToSlide:function(a,b,c){a.applyTo(this.appState.view,c?{animate:!1}:void 0);this.appState.view.state.cameraController&&this.appState.view.state.cameraController.animation?this._scheduleSlideTitle(this.titleContainer,a,this.appState.view.state.cameraController.animation.time,!1):this._scheduleSlideTitle(this.titleContainer,a,0,this.currentSlideIndexPlay===b);this.currentSlideIndexPlay=b;this._highlightBookmark(this.mainContainerNode.id+
"slideButton"+a.id);this._transitionToSlideTimeout&&(clearTimeout(this._transitionToSlideTimeout),this._transitionToSlideTimeout=null)},_scheduleSlideTitle:function(a,b,c,d){this.slideTitleTimeoutId&&(clearTimeout(this.slideTitleTimeoutId),this.slideTitleTimeoutId=null);d?g.add(a,"showSlide"):g.remove(a,"showSlide");g.remove(a,"hideSlide");a.innerHTML=b.title.text;this.slideTitleTimeoutId=setTimeout(function(){g.add(a,"showSlide");this.slideTitleTimeoutId=setTimeout(function(){this.slideTitleTimeoutId=
null;g.remove(a,"showSlide");g.add(a,"hideSlide")}.bind(this),3E3)}.bind(this),Math.max(1E3*c-1E3,0))},_clearHighlight:function(){b(".slideButton.highlight").forEach(function(a,b,c){a.className="slideButton"})},_highlightBookmark:function(a){this._clearHighlight();(a=c.byId(a))&&g.add(a,"highlight")},_slideContainerAttributeChanged:function(){g.contains(this.container,"navFadeIn")&&this._fadeSlidesIn(!1)},_fadeSlidesIn:function(a){this.outerContainer&&(a?(g.add(this.outerContainer,"noBorderAnimation"),
g.replace(this.outerContainer,this._getAnimationClassName(),"noBorderAnimation"),p.fadeIn({node:this.container,duration:50}).play()):g.remove(this.outerContainer,"noBorderAnimation"))},_getAnimationClassName:function(){return 9>this.slideNodes.length?"borderAnimationS":16>this.slideNodes.length?"borderAnimationM":"borderAnimationL"}})})},"webSceneViewer/widgets/ScrollBar/ScrollBar":function(){define("esri/core/declare esri/core/libs/pep/pep dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/ScrollBar.html dojo/_base/lang esri/core/domUtils dojo/on dojo/has dojo/dom-class".split(" "),
function(m,f,k,e,g,d,h,c,b,a){var l=window.dojo,n=[],p=function(a,b,d){n.push(c(a,d,function(a){a.preventDefault();a.stopPropagation();var c=document.createEvent("MouseEvent");c.initMouseEvent(d,a.bubbles,a.cancelable,window,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);a.wheelDelta&&(c.wheelDelta=a.wheelDelta);b.dispatchEvent(c)}))};return m([k,e],{templateString:g,scrollTarget:void 0,view:void 0,_onHandles:void 0,appState:null,
constructor:function(a,b){this._onHandles=[];this.appState=a.appState},destroy:function(){this._onHandles.forEach(function(a){a.remove()});n.forEach(function(a){a.remove()});this._viewPortResize&&this._viewPortResize.remove();this.disableScrollTargetDrag()},postCreate:function(){this.PAGE_Y=(this.vertical=!1,"pageX");this.DIMENSION=this.vertical?"height":"width";this.OFFSET_DIMENSION=this.vertical?"offsetHeight":"offsetWidth";this.TOP=this.vertical?"top":"left";a.contains(l.doc.body.parentNode,"esriRtl")&&
(this.TOP=this.vertical?"top":"right");this.wheelDir=this.vertical?-1:1;this.min=this.mousePosRelativeToHandle=this.state=this.relativeSliderPosition=0;this.max=1;this.originMousePos=this.easing=0;this.isDragging=this.preventElementClicks=!1;this._updatePosition(this.relativeSliderPosition,!0);this._viewPortResize=this.view.on("resize",d.hitch(this,function(){this._updatePosition(this.relativeSliderPosition,!0);this.updateWidth()}));this.appState.device.isMobile||this._setupEventHandlers()},_startScrollTargetDragging:function(a){null==
this.capturedId&&(this.capturedId=a.pointerId,null!=a.target.setPointerCapture?a.target.setPointerCapture(this.capturedId):this.scrollTarget.setPointerCapture(this.capturedId),this.scrollTarget.addEventListener("pointermove",this.scrollListeners.move,!0),this.scrollTarget.addEventListener("pointerup",this.scrollListeners.stop,!0),this.scrollTarget.addEventListener("pointercancel",this.scrollListeners.stop,!0),this.scrollTarget.addEventListener("lostpointercapture",this.scrollListeners.stop,!0),this.originMousePos=
a.clientX,this.startMouseCoords={x:0,y:0},this.startMouseCoords.x=a.clientX,this.startMouseCoords.y=a.clientY,this.preventElementClicks=this.isDragging=!1)},_clickHandler:function(a){this.preventElementClicks=this.isDragging=!1;this.scrollTarget._hasScrollBarClickListener=void 0;this.scrollTarget.removeEventListener("click",this.scrollListeners.click,!0)},_scrollTargetDragging:function(b){if(b.pointerId==this.capturedId){var c="mouse"===b.pointerType?3:15,d="mouse"===b.pointerType?3:15;!this.isDragging&&
Math.abs(b.clientX-this.startMouseCoords.x)<c&&Math.abs(b.clientY-this.startMouseCoords.y)<d||(this.isDragging||(this.preventElementClicks=this.isDragging=!0,this.scrollTarget._hasScrollBarClickListener||(this.scrollTarget._hasScrollBarClickListener=!0,this.scrollTarget.addEventListener("click",this.scrollListeners.click,!0)),this.scrollTarget.style.pointerEvents="none"),c=b.clientX,d=this.originMousePos-c,a.contains(l.doc.body.parentNode,"esriRtl")&&(d=-d),this.originMousePos=c,this._updatePosition(this._calcRelativePosition(this._calcPosition(this.relativeSliderPosition)+
d)),b.preventDefault())}},_stopScrollTargetDragging:function(a){a.pointerId==this.capturedId&&(null!=a.target.releasePointerCapture?a.target.releasePointerCapture(this.capturedId):this.scrollTarget.releasePointerCapture(this.capturedId),this.capturedId=null,this.scrollTarget.removeEventListener("pointermove",this.scrollListeners.move,!0),this.scrollTarget.removeEventListener("pointerup",this.scrollListeners.stop,!0),this.scrollTarget.removeEventListener("pointercancel",this.scrollListeners.stop,!0),
this.scrollTarget.removeEventListener("lostpointercapture",this.scrollListeners.stop,!0),this.scrollTarget._hasScrollBarClickListener&&(this.scrollTarget._hasScrollBarClickListener=void 0,this.scrollTarget.removeEventListener("click",this.scrollListeners.click,!0)),this.isDragging&&(this.isDragging=!1,this.scrollTarget.style.pointerEvents="",a.preventDefault()))},_setupEventHandlers:function(){var e=c(this.scrollBarSpace,"click",d.hitch(this,function(a){a.preventDefault();this.updateWidth();this._updatePosition((a[this.PAGE_Y]-
this.scrollBarContainer.getBoundingClientRect()[this.TOP])/this._getDimension());a.stopPropagation()}));this._onHandles.push(e);e=c(this.scrollTarget,void 0===b("mozilla")?"mousewheel":"DOMMouseScroll",d.hitch(this,function(a){a.preventDefault();a.stopPropagation();a=void 0===b("mozilla")?a.wheelDelta:-60*a.detail;this._updatePosition((this._getAbsoluteDimension()-a/(12*this.wheelDir))/this._getTrackDimension())}));this._onHandles.push(e);e=c(this.scrollBarHandleHitArea,"mousedown",d.hitch(this,function(b){b.preventDefault();
b.stopPropagation();1==b.which&&(this.state=1,a.contains(l.doc.body.parentNode,"esriRtl")?this.mousePosRelativeToHandle=Math.min(this.scrollBarHandleHitArea[this.OFFSET_DIMENSION],Math.max(0,-b[this.PAGE_Y]+this.scrollBarHandleHitArea.getClientRects()[0][this.TOP])):this.mousePosRelativeToHandle=Math.min(this.scrollBarHandleHitArea[this.OFFSET_DIMENSION],Math.max(0,b[this.PAGE_Y]-this.scrollBarHandleHitArea.getClientRects()[0][this.TOP])))}));this._onHandles.push(e);e=c(document,"mousemove",d.hitch(this,
function(b){1==this.state&&(b.preventDefault(),a.contains(l.doc.body.parentNode,"esriRtl")?this._updatePosition((this.scrollBarContainer.getBoundingClientRect()[this.TOP]-b[this.PAGE_Y]-this.mousePosRelativeToHandle)/this._getTrackDimension()):this._updatePosition((b[this.PAGE_Y]-this.scrollBarContainer.getBoundingClientRect()[this.TOP]-this.mousePosRelativeToHandle)/this._getTrackDimension()))}));this._onHandles.push(e);e=c(document,"mouseup",d.hitch(this,function(a){1==this.state&&(a.preventDefault(),
this.state=0)}));this._onHandles.push(e);p(this.scrollBarContainer,this.scrollTarget,void 0===b("mozilla")?"mousewheel":"DOMMouseScroll")},_calcRelativePosition:function(a){return a/(this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth)},_calcPosition:function(a){return a*(this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth)},_getDimension:function(){return this.scrollBarContainer[this.OFFSET_DIMENSION]},_getTrackDimension:function(){return this.scrollBarHandleContainer[this.OFFSET_DIMENSION]},
_getAbsoluteDimension:function(){return Math.round(this._getTrackDimension()*this.relativeSliderPosition)},_updatePosition:function(a,b,c){this.relativeSliderPosition=Math.min(Math.max(a,.001),.999);this.scrollBarHandleHitArea.style[this.TOP]=this._getAbsoluteDimension()-this.scrollBarHandleHitArea[this.OFFSET_DIMENSION]/2+"px";b||this._scrollTo(this.relativeSliderPosition)},_scrollTo:function(c){var d=this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth;c=Math.ceil(c*d);c=c<=d?c:d;c=0<c?c:
0;if(a.contains(l.doc.body.parentNode,"esriRtl"))if(b("mozilla"))c=-c;else if(b("chrome")||b("safari"))c=d-c;this.scrollTarget.scrollLeft=c},setRange:function(a,b){this.min=a;this.max=b},get:function(){return this.relativeSliderPosition},set:function(a,b){0===this.state&&this.updatePos(a,b)},setInRange:function(a){this.set((a-this.min)/(this.max-this.min))},enableCustomScrollTargetDrag:function(){this.scrollListeners={start:this._startScrollTargetDragging.bind(this),stop:this._stopScrollTargetDragging.bind(this),
move:this._scrollTargetDragging.bind(this),click:this._clickHandler.bind(this)};this.scrollTarget&&(f.applyLocal(this.scrollTarget),this.scrollTarget.addEventListener("pointerdown",this.scrollListeners.start,!0))},disableScrollTargetDrag:function(){this.scrollTarget&&this.scrollListeners&&this.scrollTarget.removeEventListener("pointerdown",this.scrollListeners.start,!0)},resize:function(){this.scrollBarHandleContainer.style[this.DIMENSION]=this._getDimension()+"px";this.scrollBarSpace.style[this.DIMENSION]=
this._getDimension()+"px";this.scrollBarHandleHitArea.getClientRects()[0]&&(this.scrollBarHandleContainer.style[this.DIMENSION]=this._getDimension()-this.scrollBarHandleHitArea.getClientRects()[0][this.DIMENSION]+"px");this._updatePosition(this.relativeSliderPosition)},updateWidth:function(){this.scrollBarHandleHitArea.style.width=Math.max(Math.min(this.scrollTarget.offsetWidth-(this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth),.5*this.scrollTarget.offsetWidth),.2*this.scrollTarget.offsetWidth)+
"px";16>this.scrollTarget.scrollWidth-this.scrollTarget.offsetWidth?h.hide(this.scrollBarHandleHitArea):h.show(this.scrollBarHandleHitArea);this.resize()}})})},"webSceneViewer/devtools/flyby":function(){define(["require","exports","./keycombo","esri/core/scheduling"],function(m,f,k,e){Object.defineProperty(f,"__esModule",{value:!0});var g,d=.1;k.add("iddqd",function(){g&&(g.remove(),g=null);var f=window.view,c=f.center.clone(),b=f.scale,a=e.addFrameTask({update:function(a){var e=f.camera;f.goTo({target:c,
scale:b,heading:e.heading+360*d*a.deltaTime/1E3,tilt:e.tilt},{animate:!1})}}),l=function(a){var b=a.key;b||27!==a.keyCode?!b&&a.charCode&&(b=String.fromCharCode(a.charCode)):b="Escape";switch(b){case "Escape":g&&(g.remove(),g=null);break;case "+":d+=.1*(1-d);break;case "-":d-=.1*(d-0)}};window.addEventListener("keydown",l);g={remove:function(){g=null;a.remove();window.removeEventListener("keydown",l)}}})})},"webSceneViewer/devtools/keycombo":function(){define(["require","exports"],function(m,f){function k(){var b=
d[c];b&&(b.forEach(function(a){return a(c)}),c="")}function e(){if(!h){var b=0,a=function(){b&&clearTimeout(b);b=setTimeout(function(){b=0;c=""},1E3)},d=function(b){if(!b.target||"INPUT"!==b.target.tagName)if(a(),b=b.key||b.charCode&&String.fromCharCode(b.charCode))c+=b.toLowerCase(),k()};window.addEventListener("keypress",d);h={remove:function(){h&&(window.removeEventListener("keypress",d),h=null)}}}}function g(b,a,c){c=a.indexOf(c);-1!==c&&(a.splice(c,1),0===a.length&&(delete d[b],!Object.keys(d).length&&
h&&h.remove()))}Object.defineProperty(f,"__esModule",{value:!0});var d={},h,c="";f.add=function(b,a){b=b.toLowerCase();var c=d[b];c||(c=[],d[b]=c);c.push(a);e();return{remove:g.bind(this,b,c,a)}}})},"esri/portal/support/layersCreator":function(){define("require exports ../../core/has ../../core/promiseUtils ../../layers/Layer ../../layers/support/lazyLayerLoader ../PortalItem ./mapNotesUtils ./portalLayers ../../renderers/support/styleUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(b,c,
d){var g,f={};c.itemId&&(f.portalItem={id:c.itemId,portal:d.context.portal});g=new b(f);g.read(c,d.context);return a.loadStyleRenderer(g,d.context).then(function(){return e.resolve(g)})}function n(a,b){return p(a,b).then(function(c){return l(c,a,b)})}function p(a,e){var g=e.context,f=q(g),l=a.layerType||a.type;!l&&e&&e.defaultLayerType&&(l=e.defaultLayerType);e=(e=f[l])?d.layerLookupMap[e]:d.layerLookupMap.UnknownLayer;if("Feature Collection"===a.type){if(a.itemId)return(new h({id:a.itemId,portal:g&&
g.portal})).load().then(b.selectLayerClassPath).then(function(a){return d.layerLookupMap[a.className||"UnknownLayer"]}).then(function(a){return a()})}else"ArcGISFeatureLayer"===l&&c.isMapNotesLayer(a)&&(e=d.layerLookupMap.MapNotesLayer);a.wmtsInfo&&(e=d.layerLookupMap.WMTSLayer);return e()}function q(a){switch(a.origin){case "web-scene":switch(a.layerContainerType){case "basemap":a=x;break;case "ground":a=u;break;default:a=w}break;default:switch(a.layerContainerType){case "basemap":a=z;break;default:a=
v}}return a}function r(a,b,c){return b&&b.filter?c.then(function(a){var c=b.filter(a);return void 0===c?e.resolve(a):c instanceof g?e.resolve(c):c}):c}function t(a,b,c){if(!b)return[];for(var d=[],g=[],f=0;f<b.length;f++){var h=b[f],l=n(h,c);d.push(l);g.push(null);if("GroupLayer"===h.layerType&&h.layers&&Array.isArray(h.layers)&&0<h.layers.length){h=h.layers.map(function(a){return n(a,c)});d.push.apply(d,h);for(var k=0;k<h.length;k++)g.push(l)}}var m={};return d.map(function(b,d){var f=function(a,
b){m[b.id]=d;var c=a.findIndex(function(a){if(!a.id)return!1;a=m[a.id];return void 0===a?!1:d<a});0>c&&(c=void 0);a.add(b,c)};return r(a,c,b).then(function(b){if(null===g[d])f(a,b);else return g[d].then(function(a){f(a.layers,b);return e.resolve(b)});return e.resolve(b)})})}Object.defineProperty(f,"__esModule",{value:!0});var w={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",
IntegratedMeshLayer:"IntegratedMeshLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},u={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer"},x={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",
WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},v={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",VectorTileLayer:"VectorTileLayer",
WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",GeoRSS:"GeoRSSLayer",KML:"KMLLayer",WMS:"WMSLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",DefaultTileLayer:"TileLayer"},z={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",
BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};f.createLayer=n;f.processLayer=r;f.populateLayers=t;f.populateOperationalLayers=function(a,b,c){return t(a,b,c)}})},"esri/portal/support/mapNotesUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.isMapNotesLayer=function(f){var e=["TITLE","DESCRIPTION","IMAGE_URL","IMAGE_LINK_URL"];if((f=f.layers||f.featureCollection&&
f.featureCollection.layers)&&Array.isArray(f))return f=f[0],f.layerDefinition.fields&&f.layerDefinition.fields.forEach(function(g){g=e.indexOf(g.name);-1<g&&e.splice(g,1)}),e.length?!1:!0}})},"esri/portal/support/portalLayers":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/Collection ../../core/Error ../../core/promiseUtils ../../layers/support/lazyLayerLoader ../PortalItem ./mapNotesUtils".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a){switch(a.type){case "Map Service":return p(a);
case "Feature Service":return q(a);case "Feature Collection":return t(a);case "Scene Service":return r(a);case "Image Service":return w(a);case "Stream Service":return{className:"StreamLayer"};case "Vector Tile Service":return{className:"VectorTileLayer"};case "KML":return{className:"KMLLayer"};case "WMTS":return{className:"WMTSLayer"};case "WMS":return{className:"WMSLayer"};default:return h.reject(new d("portal:unknown-item-type","Unknown item type '${type}'",{type:a.type}))}}function n(a){return(0,c.layerLookupMap[a.className])().then(function(b){return{constructor:b,
properties:a.properties}})}function p(a){return u(a).then(function(a){return a?{className:"TileLayer"}:{className:"MapImageLayer"}})}function q(a){return x(a).then(function(a){if("object"===typeof a){var b={outFields:["*"]};null!=a.id&&(b.layerId=a.id);return{className:"FeatureLayer",properties:b}}return{className:"GroupLayer"}})}function r(a){return x(a).then(function(b){if("object"===typeof b){var c={},d=void 0;null!=b.id?(c.layerId=b.id,d=a.url+"/layers/"+b.id):d=a.url;if(Array.isArray(a.typeKeywords)&&
0<a.typeKeywords.length){b={IntegratedMesh:"IntegratedMeshLayer","3DObject":"SceneLayer",Point:"SceneLayer",PointCloud:"PointCloudLayer"};for(var e=0,g=Object.keys(b);e<g.length;e++){var f=g[e];if(-1!==a.typeKeywords.indexOf(f))return{className:b[f]}}}return v(d).then(function(a){var b="SceneLayer";null!=a&&"IntegratedMesh"===a.layerType?b="IntegratedMeshLayer":null!=a&&"PointCloud"===a.layerType&&(b="PointCloudLayer");return{className:b,properties:c}})}return{className:"GroupLayer"}})}function t(b){return b.load().then(function(){return b.fetchData()}).then(function(b){if(b&&
Array.isArray(b.layers)){if(a.isMapNotesLayer(b))return{className:"MapNotesLayer"};if(1===b.layers.length)return{className:"FeatureLayer"}}return{className:"GroupLayer"}})}function w(a){return u(a).then(function(b){var c=new g(a.typeKeywords);return b?c.find(function(a){return"elevation 3d layer"===a.toLowerCase()})?{className:"ElevationLayer"}:{className:"TileLayer"}:{className:"ImageryLayer"}})}function u(a){return v(a.url).then(function(a){return a.tileInfo})}function x(a){return!a.url||a.url.match(/\/\d+$/)?
h.resolve({}):a.load().then(function(){return a.fetchData()}).then(function(b){return b&&Array.isArray(b.layers)?1===b.layers.length?{id:b.layers[0].id}:!1:v(a.url).then(function(a){return a&&Array.isArray(a.layers)?1===a.layers.length?{id:a.layers[0].id}:!1:{}})})}function v(a){return e(a,{responseType:"json",query:{f:"json"}}).then(function(a){return a.data})}Object.defineProperty(f,"__esModule",{value:!0});f.fromItem=function(a){!a.portalItem||a.portalItem instanceof b||a.portalItem.constructor&&
a.portalItem.constructor._meta||(a=k({},a,{portalItem:new b(a.portalItem)}));return a.portalItem.load().then(l).then(n).then(function(b){var c=k({portalItem:a.portalItem},b.properties);b=b.constructor;"esri.layers.FeatureLayer"===b.declaredClass&&(c.outFields=["*"]);return h.resolve(new b(c))})};f.selectLayerClassPath=l})},"esri/portal/support/layersLoader":function(){define("require exports ../../request ../../core/Error ../../core/promiseUtils ../../layers/GroupLayer ../../layers/support/lazyLayerLoader ../Portal ./jsonContext ../../renderers/support/styleUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a){function l(c){var e=c.instance,g=e.portalItem,f=g.url,h=g.title,l=b.createForItem(g);if(e.isInstanceOf(d))return e.read({title:h},l),n(e,c);f&&e.read({url:f},l);return r(c).then(function(b){b&&e.read(b,l);e.read({title:h},l);return a.loadStyleRenderer(e,l)})}function n(a,b){var c;c=a.portalItem.type;switch(c){case "Feature Service":c=h.layerLookupMap.FeatureLayer;break;case "Stream Service":c=h.layerLookupMap.StreamLayer;break;case "Scene Service":c=h.layerLookupMap.SceneLayer;
break;case "Feature Collection":c=h.layerLookupMap.FeatureLayer;break;default:throw new e("portal:unsupported-item-type-as-group","The item type '"+c+"' is not supported as a 'GroupLayer'");}var d;return c().then(function(a){d=a;return r(b)}).then(function(c){return c&&Array.isArray(c.layers)?q(a,d,c,b):p(a,d,b)})}function p(a,b,c){return a.portalItem.url?k(a.portalItem.url,{responseType:"json",query:{f:"json"}}).then(function(d){if((d=d.data)&&Array.isArray(d.layers))return d=d.layers.map(function(a){return{id:a.id,
name:a.name}}),q(a,b,{layers:d},c)}):g.resolve()}function q(a,b,d,e){var g=d.showLegend;d=d.layers.slice();d.reverse();d.forEach(function(d){var e=new b({portalItem:a.portalItem,layerId:d.id,sublayerTitleMode:"service-name"});if("Feature Collection"===a.portalItem.type){var f={origin:"portal-item",portal:a.portalItem.portal||c.getDefault()};e.read(d,f);null!=g&&e.read({showLegend:g},f)}a.add(e)})}function r(a){if(!1===a.supportsData)return g.resolve();var b=a.instance;return b.portalItem.fetchData().catch(function(){return null}).then(function(a){var c,
d;d="stream"===b.type?!1:"layerId"in b;if(d){d=!0;if(a&&Array.isArray(a.layers)){null==b.layerId&&(b.layerId=a.layers[0].id);for(var e=0;e<a.layers.length;e++)if(a.layers[e].id===b.layerId){c=a.layers[e];break}c&&(1===a.layers.length&&(d=!1),null!=a.showLegend&&(c.showLegend=a.showLegend))}d&&"service-name"!==b.sublayerTitleMode&&(b.sublayerTitleMode="item-title-and-service-name");return c}return a})}Object.defineProperty(f,"__esModule",{value:!0});f.load=function(a){var b=a.instance.portalItem;return b&&
b.id?b.load().then(function(){var b=a.instance.portalItem;if(-1===a.supportedTypes.indexOf(b.type))throw new e("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:b.type,expectedType:a.supportedTypes.join(", ")});}).then(function(){return l(a)}):g.resolve()}})},"esri/views/3d/layers/TileLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils ../terrain/terrainUtils ../../layers/RefreshableLayerView".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){return function(c){function f(){return null!==c&&c.apply(this,arguments)||this}k(f,c);Object.defineProperty(f.prototype,"imageFormatIsOpaque",{get:function(){return"jpg"===this.get("layer.tileInfo.format")},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var c=this,e=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);e?this.addResolvingPromise(g.reject(e)):(e=d.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){b.throwIfError(c._getTileInfoCompatibilityError(c.tileInfo,
c.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(e));"version"in this.layer&&this.addResolvingPromise(b.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel();this.maxDataLevel=Math.min(this.maxDataLevel,a.getKnownTiledServiceLevelCap(this.layer.url))};f.prototype.getPopupData=function(a){var b=this.layer;if("tile"!==b.type)return[];var c=this.view.scale;return b.allSublayers.toArray().filter(function(a){var b=0===a.minScale||c<=a.minScale,d=0===a.maxScale||
c>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&b&&d}).map(function(b){var c=b.createQuery();c.geometry=a;c.outFields=b.popupTemplate.requiredFields;return b.queryFeatures(c).then(function(a){return a.features})})};f.prototype.doRefresh=function(){this.suspended||this.emit("data-changed")};e([h.property({readOnly:!0,dependsOn:["layer.tileInfo.format"]})],f.prototype,"imageFormatIsOpaque",null);e([h.property({aliasOf:"layer.fullExtent"})],f.prototype,"fullExtent",void 0);e([h.property()],
f.prototype,"layer",void 0);e([h.property({aliasOf:"layer.tileInfo"})],f.prototype,"tileInfo",void 0);return f=e([h.subclass("esri.views.3d.layers.TileLayerView3D")],f)}(h.declared(c,l))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/accessorSupport/decorators ./LayerView3D ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(m,
f,k,e,g,d,h,c,b){return function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.minDataLevel=0;b.maxDataLevel=Infinity;b._isUpdating=!1;return b}k(f,a);Object.defineProperty(f.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});f.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,
c)};f.prototype.updatingChanged=function(a){this._isUpdating=a;this.notifyChange("updating")};f.prototype.isUpdating=function(){return this._isUpdating};f.prototype._getTileInfoSupportError=function(a,c){if(a=b.checkIfTileInfoSupportedForView(a,c,this.view.spatialReference,this.view.basemapTerrain.manifold)){c={layer:this.layer,error:a};var d=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":d=new g("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",
c);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":d=new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",c);break;default:d=new g("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",c)}return d}return null};f.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new g("layerview:tiling-scheme-incompatible",
"The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};f.prototype._updateMinMaxDataLevel=function(){var a,b=Infinity,c=0;this.tileInfo.lods.forEach(function(a){b=Math.min(a.level,b);c=Math.max(a.level,c)});a=[b,c];this.minDataLevel=a[0];this.maxDataLevel=a[1]};e([d.property({readOnly:!0})],f.prototype,"imageFormatIsOpaque",null);e([d.property(c.updatingPercentage)],f.prototype,"updatingPercentage",void 0);e([d.property(c.updatingPercentageValue)],f.prototype,"updatingPercentageValue",
void 0);e([d.property()],f.prototype,"fullExtent",void 0);e([d.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],f.prototype,"isOpaque",null);e([d.property()],f.prototype,"layer",void 0);e([d.property()],f.prototype,"minDataLevel",void 0);e([d.property()],f.prototype,"maxDataLevel",void 0);e([d.property()],f.prototype,"tileInfo",void 0);return f=e([d.subclass("esri.views.3d.layers.TiledLayerView3D")],f)}(d.declared(h))})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require",
"exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.updatingPercentageValue={value:100,readOnly:!0};f.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(m,
f,k,e,g,d){function h(c){var b=null,a=c.search(/\/rest\/services\//i);0<a&&(b=c.substring(0,a+6));return b}Object.defineProperty(f,"__esModule",{value:!0});f.checkArcGISServiceVersionCompatibility=function(c){if(!d.isHostedAgolService(c.url)){if(10.22>c.version)return c=new e("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+c.version,{minVersion:10.22,detectedVersion:c.version}),g.reject(c);if(10.22!==c.version||d.isHostedSecuredProxyService(c.url,
c.get("portalItem.id")))return g.resolve();c=h(c.url);var b=new e("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");return k(c+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw b;}).catch(function(){throw b;})}};f.throwIfError=function(c){if(c)throw c;}})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),
function(m,f,k,e,g,d,h,c,b,a){return function(b){function f(){return null!==b&&b.apply(this,arguments)||this}k(f,b);f.prototype.initialize=function(){var b=this,c=this.get("view.map.ground.layers"),e=this.get("view.map.allLayers"),e=e&&e.includes(this.layer),c=c&&c.includes(this.layer);e&&!c&&(c=new g("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(d.reject(c)));(c=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?
this.addResolvingPromise(d.reject(c)):(c=h.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){a.throwIfError(b._getTileInfoCompatibilityError(b.tileInfo,b.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(c));this.addResolvingPromise(a.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()};e([c.property({aliasOf:"layer.fullExtent"})],f.prototype,"fullExtent",void 0);e([c.property()],f.prototype,"layer",void 0);e([c.property({aliasOf:"layer.tileInfo"})],
f.prototype,"tileInfo",void 0);return f=e([c.subclass("esri.views.3d.layers.ElevationLayerView3D")],f)}(c.declared(b))})},"esri/layers/graphics/sources/FeatureLayerSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper dojo/io-query ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Loadable ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/operations/queryAttachments".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q){Object.defineProperty(f,"__esModule",{value:!0});m=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}k(c,a);c.prototype.load=function(){this.addResolvingPromise(this._fetchService());return this.when()};Object.defineProperty(c.prototype,"queryTask",{get:function(){var a=this.layer,b=a.parsedUrl,c=a.gdbVersion;return new p({url:null!=a.dynamicDataSource?b.path+"?"+d.objectToQuery(b.query):b.path,gdbVersion:c})},enumerable:!0,configurable:!0});
c.prototype.addAttachment=function(a,b){var c=this;return this.load().then(function(){var d=a.attributes[c.layer.objectIdField];return h(c.layer.parsedUrl.path+"/"+d+"/addAttachment",{body:b,query:g({f:"json"},c.layer.parsedUrl.query,{token:c.layer.token}),responseType:"json"}).then(function(a){return c._createFeatureEditResult(a.data.addAttachmentResult)}).catch(function(a){return l.reject(c._createAttachmentErrorResult(d,a))})})};c.prototype.updateAttachment=function(a,b,c){var d=this;return this.load().then(function(){var e=
a.attributes[d.layer.objectIdField];return h(d.layer.parsedUrl.path+"/"+e+"/updateAttachment",{body:c,query:g({f:"json"},d.layer.parsedUrl.query,{attachmentId:b,token:d.layer.token}),responseType:"json"}).then(function(a){return d._createFeatureEditResult(a.data.updateAttachmentResult)}).catch(function(a){return l.reject(d._createAttachmentErrorResult(e,a))})})};c.prototype.applyEdits=function(a){var b=this;return this.load().then(function(){var c=a.addFeatures.map(b._serializeFeature,b),d=a.updateFeatures.map(b._serializeFeature,
b),e=b._getFeatureIds(a.deleteFeatures),c={f:"json",adds:c.length?JSON.stringify(c):null,updates:d.length?JSON.stringify(d):null,deletes:e.length?e.join(","):null};return h(b.layer.parsedUrl.path+"/applyEdits",{query:c,method:"post",responseType:"json"})}).then(function(a){return b._createEditsResult(a)})};c.prototype.deleteAttachments=function(a,b){var c=this;return this.load().then(function(){var d=a.attributes[c.layer.objectIdField];return h(c.layer.parsedUrl.path+"/"+d+"/deleteAttachments",{query:g({f:"json"},
c.layer.parsedUrl.query,{token:c.layer.token,attachmentIds:b.join(",")}),method:"post",responseType:"json"}).then(function(a){return a.data.deleteAttachmentResults.map(c._createFeatureEditResult)}).catch(function(a){return l.reject(c._createAttachmentErrorResult(d,a))})})};c.prototype.queryAttachments=function(a){var b=this,c=this.layer,d=c.token,e=c.parsedUrl,f=e.path;return this.load().then(function(){var c={query:g({},e.query,{f:"json",token:d}),responseType:"json"};if(!b.layer.get("capabilities.query.supportsAttachments")){for(var k=
a.objectIds,m=[],n=0;n<k.length;n++)m.push(h(f+"/"+k[n]+"/attachments",c));return l.all(m).then(function(a){return k.map(function(b,c){return{parentObjectId:b,attachmentInfos:a[c].data.attachmentInfos}})}).then(function(a){return q.processAttachmentQueryResult(a,f,d)})}return b.queryTask.executeAttachmentQuery(a,c)})};c.prototype.queryFeatures=function(a,b){var c=this;return this.load().then(function(){return c.queryTask.execute(a,b)})};c.prototype.queryFeaturesJSON=function(a,b){var c=this;return this.load().then(function(){return c.queryTask.executeJSON(a,
b)})};c.prototype.queryObjectIds=function(a,b){var c=this;return this.load().then(function(){return c.queryTask.executeForIds(a,b)})};c.prototype.queryFeatureCount=function(a,b){var c=this;return this.load().then(function(){return c.queryTask.executeForCount(a,b)})};c.prototype.queryExtent=function(a,b){var c=this;return this.load().then(function(){return c.queryTask.executeForExtent(a,b)})};c.prototype.queryRelatedFeatures=function(a){var b=this;return this.load().then(function(){return b.queryTask.executeRelationshipQuery(a)})};
c.prototype._fetchService=function(){var a=this;return h(this.layer.parsedUrl.path,{query:g({f:"json"},this.layer.parsedUrl.query),responseType:"json"}).then(function(b){a.layerDefinition=b.data})};c.prototype._serializeFeature=function(a){var b=a.geometry;a=a.attributes;return{geometry:b&&b.toJSON(),attributes:a}};c.prototype._getFeatureIds=function(a){var b=a[0];return b?"objectId"in b?this._getIdsFromFeatureIdentifier(a):this._getIdsFromFeatures(a):[]};c.prototype._getIdsFromFeatures=function(a){var b=
this.layer.objectIdField;return a.map(function(a){return a.attributes&&a.attributes[b]})};c.prototype._getIdsFromFeatureIdentifier=function(a){return a.map(function(a){return a.objectId})};c.prototype._createEditsResult=function(a){a=a.data;return{addFeatureResults:a.addResults?a.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:a.updateResults?a.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:a.deleteResults?a.deleteResults.map(this._createFeatureEditResult,
this):[]}};c.prototype._createFeatureEditResult=function(a){var c=!0===a.success?null:a.error||{code:void 0,description:void 0};return{objectId:a.objectId,globalId:a.globalId,error:c?new b("feature-layer-source:edit-failure",c.description,{code:c.code}):null}};c.prototype._createAttachmentErrorResult=function(a,c){return{objectId:a,globalId:null,error:new b("feature-layer-source:attachment-failure",c.details.messages&&c.details.messages[0]||c.message,{code:c.details.httpStatus||c.details.messageCode})}};
e([n.property({constructOnly:!0})],c.prototype,"layer",void 0);e([n.property({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource"]})],c.prototype,"queryTask",null);return c=e([n.subclass("esri.layers.graphics.sources.FeatureLayerSource")],c)}(n.declared(c,a));f.default=m})},"esri/layers/graphics/controllers/SnapshotController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/Error ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/support/scaleUtils ../../support/GraphicsManager ../../../views/3d/layers/graphics/Graphics3DVerticalScale".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t){var w=a.getLogger("esri.layers.graphics.controllers.SnapshotController");return function(a){function c(c){c=a.call(this)||this;c.type="snapshot";c._gManager=null;c._verticalScale=null;c._handles=new b;c._source=null;c._started=!1;c._pendingQueries=new Map;c.extent=null;c.hasAllFeatures=!1;c.hasFeatures=!1;c.layer=null;c.layerView=null;c.maxPageSize=null;c.defaultReturnZ=void 0;c.defaultReturnM=void 0;c.pageSize=null;c.paginationEnabled=!1;return c}k(c,a);
c.prototype.initialize=function(){var a=this,b=this.layer.when(function(){return a._verifyCapabilities()}).then(function(){return a._init()});this.addResolvingPromise(b)};c.prototype.destroy=function(){this.cancelQuery();this._gManager&&(this._gManager.destroy(),this._gManager=null);this._handles.destroy();this._pendingQueries=this._handles=null};Object.defineProperty(c.prototype,"updating",{get:function(){return!!(this._pendingQueries&&0<this._pendingQueries.size)},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"graphics",{set:function(a){var b=this._get("graphics");b!==a&&(this._handles.remove("graphics"),a&&(this._collectionChanged({added:a.toArray(),removed:b&&b.toArray()}),this._handles.add(a.on("change",this._collectionChanged.bind(this)),"graphics")),this._set("graphics",a))},enumerable:!0,configurable:!0});c.prototype.cancelQuery=function(){var a=this;this._pendingQueries&&(this._pendingQueries.forEach(function(b,c){b.isFulfilled()||b.cancel(Error(a._cancelErrorMsg))}),
this._pendingQueries.clear(),this.notifyChange("updating"))};c.prototype.refresh=function(){this.isResolved()&&this._started&&this._queryFeatures()};c.prototype.startup=function(){this._started||(this._started=!0,this._resolutionParams=this._getResolutionParams(),this._queryFeatures())};c.prototype.update=function(){this.startup()};c.prototype._init=function(){var a=this.layer;this.paginationEnabled=!!a.get("capabilities.query.supportsPagination");this._source=a.source;var b=a.maxRecordCount||4E3;
this.pageSize=null==this.maxPageSize?b:Math.min(b,this.maxPageSize);this._gManager=new r({graphics:this.graphics,objectIdField:a.objectIdField});this._verticalScale=new t({sourceSpatialReference:a.spatialReference,destSpatialReference:this.layerView.view.spatialReference});this._setupStateWatchers()};c.prototype._getResolutionParams=function(){var a=this.layer,b=a.get("capabilities.query.supportsQuantization"),c;if("polyline"===a.geometryType||"polygon"===a.geometryType){var d=q.getMetersPerUnit(this.layerView.view.spatialReference);
null!=d&&(c=this._featureResolution.scale,d=this._featureResolution.value/d,c=a.maxScale?a.maxScale:a.minScale?Math.min(c,a.minScale):Math.min(c,q.getScale(this.layerView.view,a.fullExtent)),c*=d/this._featureResolution.scale)}return c?{maxAllowableOffset:b?null:c,quantizationParameters:b?{mode:"view",originPosition:"upperLeft",tolerance:c,extent:a.fullExtent}:null}:null};c.prototype._setupStateWatchers=function(){var a=this;this._handles.add([this.watch("extent",this.refresh.bind(this)),this.layer.watch("outFields",
function(b,c){b&&c?-1===c.indexOf("*")&&(b.sort(),c.sort(),JSON.stringify(b)!==JSON.stringify(c)&&a.refresh()):a.refresh()}),this.layer.watch("definitionExpression, historicMoment",this.refresh.bind(this)),this.layer.on("edits",this._editsHandler.bind(this))])};c.prototype._createQueryParams=function(){var a=this.layer,b=this.layerView,c=a.createQuery();c.outSpatialReference=b.view.spatialReference;c.geometry=this.extent;(a=a.capabilities&&a.capabilities.data)&&a.supportsZ&&null==c.returnZ&&null!=
this.defaultReturnZ&&(c.returnZ=this.defaultReturnZ);a&&a.supportsM&&null==c.returnM&&null!=this.defaultReturnM&&(c.returnM=this.defaultReturnM);c.set(this._resolutionParams);this.paginationEnabled&&(c.start=0,c.num=this.pageSize);return c};c.prototype._queryFeatures=function(){this.cancelQuery();this.hasAllFeatures=this.hasFeatures=!1;this._gManager.beginPagedUpdate();this.emit("query-start");this._executeQuery(this._createQueryParams())};c.prototype._executeQuery=function(a){var b=this,c=this._source.queryFeatures(a),
d=this._gManager.createIntentToAdd();this._querySetup(d,c);c.then(this._processFeatureSet.bind(this,a,d)).catch(function(a){return b._queryError(d,a)}).always(function(){return b._queryTeardown(d)})};c.prototype._processFeatureSet=function(a,b,c){var d=c.exceededTransferLimit,e=c.features,g=this._maxFeatures[this.layer.geometryType]||0,f=e?e.length:0,h=this._gManager.numGraphics+f,l=h>=g;l&&(w.warn('Feature limit exceeded on layer "',this.layer.title,'". Not all features are shown.'),(g=h-g)&&e.splice(f-
g,g));a=d&&this.paginationEnabled&&!l?this._queryNextPage(a):!1;this._verticalScale.adjust(e);e&&this._gManager.addPage(e,b);this.hasFeatures=!0;a||(this._gManager.endPagedUpdate(),this.hasAllFeatures=!d,this.emit("query-end",{success:!0}));return c};c.prototype._queryNextPage=function(a){a.start+=this.pageSize;this._executeQuery(a);return!0};c.prototype._queryError=function(a,b){b&&"cancel"===b.dojoType&&!this.hasFeatures?this._gManager.revertPagedUpdate():this._gManager.endPagedUpdate();this.emit("query-end",
{success:!1});if(b&&"cancel"===b.dojoType)return n.reject(b);a=new h("snapshotcontroller:tile-request-failed","Failed to query for features",{error:b});w.error(a);return n.reject(a)};c.prototype._querySetup=function(a,b){this._pendingQueries.set(a,b);this.notifyChange("updating")};c.prototype._queryTeardown=function(a){this._gManager.removeIntent(a);this._pendingQueries.delete(a);this.notifyChange("updating")};c.prototype._processRefetch=function(a,b){(b=b.features)&&this._gManager.add(b,a)};c.prototype._refetchError=
function(a,b){};c.prototype._verifyCapabilities=function(){if(!this.layer.get("capabilities.operations.supportsQuery"))throw new h("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:this.layer});};c.prototype._collectionChanged=function(a){var b=a.added;if(b)for(var c=0;c<b.length;c++)b[c].layer=this.layer,b[c].sourceLayer=this.layer;if(b=a.removed)for(c=0;c<b.length;c++)b[c].layer=null,b[c].sourceLayer=null};c.prototype._editsHandler=
function(a){var b=function(a){return a.objectId},c=a.deletedFeatures.map(b);this._gManager.delete(c);a=a.addedFeatures.concat(a.updatedFeatures).map(b);a.length&&(b=this._createQueryParams(),b.objectIds=a,b=this._source.queryFeatures(b),a=this._gManager.createIntentToAdd(a),this._querySetup(a,b),b.then(this._processRefetch.bind(this,a)).catch(this._refetchError.bind(this,a)).always(this._queryTeardown.bind(this,a)))};e([p.shared("SnapshotController: query cancelled")],c.prototype,"_cancelErrorMsg",
void 0);e([p.property({readOnly:!0})],c.prototype,"type",void 0);e([p.shared({value:.25,scale:945})],c.prototype,"_featureResolution",void 0);e([p.shared({point:16E3,multipoint:8E3,polyline:4E3,polygon:4E3,multipatch:4E3})],c.prototype,"_maxFeatures",void 0);e([p.property()],c.prototype,"_pendingQueries",void 0);e([p.property({dependsOn:["_pendingQueries"]})],c.prototype,"updating",null);e([p.property()],c.prototype,"graphics",null);e([p.property()],c.prototype,"extent",void 0);e([p.property()],c.prototype,
"hasAllFeatures",void 0);e([p.property()],c.prototype,"hasFeatures",void 0);e([p.property()],c.prototype,"layer",void 0);e([p.property()],c.prototype,"layerView",void 0);e([p.property()],c.prototype,"maxPageSize",void 0);e([p.property()],c.prototype,"defaultReturnZ",void 0);e([p.property()],c.prototype,"defaultReturnM",void 0);e([p.property()],c.prototype,"pageSize",void 0);e([p.property()],c.prototype,"paginationEnabled",void 0);return c=e([p.subclass("esri.layers.graphics.controllers.SnapshotController")],
c)}(p.declared(d,l,c))})},"esri/layers/support/GraphicsManager":function(){define(["../../core/Accessor"],function(m){var f=0;return m.createSubclass({constructor:function(){this._deletedGraphicsIndex=new Set;this._intentsIndex=new Map},destroy:function(){this.removeAll();this._intentsIndex=this._deletedGraphicsIndex=null},properties:{graphics:null,indexById:{value:null,dependsOn:["graphics","objectIdField"],get:function(){return this._createIndexById(this.graphics&&this.graphics.toArray(),this.objectIdField)}},
numGraphics:{value:0,dependsOn:["indexById"],get:function(){return this.indexById?this.indexById.size:0}},objectIdField:null,updating:{value:!1,dependsOn:["_intentsIndex"],get:function(){return!!(this._intentsIndex&&0<this._intentsIndex.size)}},_intentsIndex:{value:null}},_oldIndex:null,_deletedGraphicsIndex:null,beginPagedUpdate:function(){this._oldIndex=this.indexById;this.indexById=null;this.notifyChange("numGraphics")},addPage:function(f,e){this.add(f,e)},revertPagedUpdate:function(){var f=this._removeLeftOnly(this.indexById,
this._oldIndex);this.indexById=this._oldIndex;this._oldIndex=null;this.graphics.removeMany(f);this.notifyChange("numGraphics")},endPagedUpdate:function(){var f=this._removeLeftOnly(this._oldIndex,this.indexById);this._oldIndex=null;this.graphics.removeMany(f);this.notifyChange("numGraphics")},findGraphic:function(f){return(f=this.indexById&&this.indexById.get(f))&&f.graphic},removeAll:function(){this.indexById=this._oldIndex=null;this.graphics.removeAll();this.notifyChange("numGraphics")},add:function(f,
e){if(f&&f.length){for(var g=this.objectIdField,d=this.indexById=this.indexById||new Map,h=this._oldIndex,c=this._createIndexById(f,g),c=this._extractObjectIds(c),d=this._extractObjectIds(d),h=this._extractObjectIds(h),d=d.concat(h),b=[],a=d.length,h=0;h<a;h++){var l=d[h];-1<c.indexOf(l)&&b.push(l)}b.length&&this._remove(b,!1);e=this.findIntent(e);c=new Map;d=f.length;for(h=0;h<d;h++)(b=f[h])&&b.attributes&&c.set(b.attributes[g],e);f.length&&this._add(f,c)}},remove:function(f){this._remove(f,!1)},
delete:function(f){this._remove(f,!0)},isDeleted:function(f){return this._deletedGraphicsIndex.has(f)},createIntentToAdd:function(k){k&&this._intentsIndex.forEach(function(e,d){k.forEach(function(d){e.ignoredIds.add(d)})},this);var e=f++;this._intentsIndex.set(e,{ignoredIds:new Set});this.notifyChange("updating");return e},findIntent:function(f){return this._intentsIndex.get(f)},removeIntent:function(f){this._intentsIndex.delete(f);this.notifyChange("updating")},update:function(f,e){if(f&&f.length){var g=
this.objectIdField,d=this.indexById=this.indexById||new Map,h=this._oldIndex;f=this._createIndexById(f,g);for(var g=this._extractObjectIds(f),c=this._extractObjectIds(d),b=this._extractObjectIds(h),c=c.concat(b),b=[],a=c.length,l=0;l<a;l++){var k=c[l];if(-1===g.indexOf(k))b.push(k);else{var m=d.get(k)||h.get(k),m=m&&m.graphic&&m.graphic._ts,q=f.get(k);(q&&q.graphic&&q.graphic._ts)>m&&b.push(k)}}d=[];h=g.length;for(l=0;l<h;l++)k=g[l],(-1===c.indexOf(k)||-1<b.indexOf(k))&&d.push(k);b.length&&this._remove(b,
!1);d.length&&this._add(this._extractGraphics(d,f),e)}},_createIndexById:function(f,e){var g;if(f&&f.length&&e){var d,h,c;g=new Map;for(d=0;h=f[d];d++)c=h.attributes&&h.attributes[e],null!=c&&g.set(c,{graphic:h,refCount:1})}return g},_add:function(f,e){var g=this.objectIdField;f.forEach(function(d){var f=e.get(d.attributes&&d.attributes[g]);this._addToIndex(d,this.indexById,f)},this);this.graphics.addMany(f);this.notifyChange("numGraphics")},_addToIndex:function(f,e,g){var d=f.attributes&&f.attributes[this.objectIdField];
e&&null!=d&&(e.has(d)?g&&g.ignoredIds.has(d)||(g=e.get(d),e.set(d,{graphic:f,refCount:g.refCount+1})):this.isDeleted(d)||e.set(d,{graphic:f,refCount:1}))},_remove:function(f,e){f=f||[];f="object"===typeof f[0]?f.map(function(d){return d.attributes&&d.attributes[this.objectIdField]}.bind(this)):f;var g=this._extractGraphics(f,this._oldIndex),d=this._extractGraphics(f,this.indexById);f.forEach(function(d){e&&this._deletedGraphicsIndex.add(d);this._removeFromIndex(d,this._oldIndex,e);this._removeFromIndex(d,
this.indexById,e)}.bind(this));this.graphics.removeMany(g.concat(d));this.notifyChange("numGraphics")},_removeFromIndex:function(f,e,g){if(e&&e.has(f))if(g)e.delete(f);else{g=e.get(f);var d=g.refCount-1;0===d?e.delete(f):g.refCount=d}},_removeLeftOnly:function(f,e){var g=[];f&&f.forEach(function(d,h){var c=d.graphic;!c||e&&e.has(h)||(--d.refCount,0===d.refCount&&f.delete(h),g.push(c))});return g},_extractGraphics:function(f,e){return f&&e?f.map(function(g){return(g=e.get(g))&&g.graphic}):[]},_extractObjectIds:function(f){var e=
[];f&&f.forEach(function(g,d){e.push(d)});return e}})})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require","exports","../../../../geometry/support/scaleUtils"],function(m,f,k){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference;this.destSpatialReference=e.destSpatialReference}e.prototype.adjust=function(e){var d=this._getVerticalUnitScale();1!==d&&this._scaleVerticalUnits(e,d)};e.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&
!this.sourceSpatialReference.equals(this.destSpatialReference)){var e=k.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),d=k.getMetersPerVerticalUnitForSR(this.destSpatialReference);return e/d}return 1};e.prototype._vertexListsScaleZ=function(e,d){for(var g=0;g<e.length;++g)for(var c=e[g],b=0;b<c.length;++b)c[b][2]*=d};e.prototype._scaleVerticalUnits=function(e,d){for(var g=0;g<e.length;++g){var c=e[g].geometry;c&&c.hasZ&&(this._geometryIsPoint(c)?null!==c.z&&(c.z*=d):this._geometryIsPolyline(c)?
this._vertexListsScaleZ(c.paths,d):this._geometryIsPolygon(c)&&this._vertexListsScaleZ(c.rings,d))}};e.prototype._geometryIsPoint=function(e){return"point"===e.type};e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type};e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type};return e}()})},"esri/views/layers/GroupLayerView":function(){define(["../../core/Collection","../../core/collectionUtils","../../core/Handles","../../core/lang","./LayerView"],function(m,f,k,e,g){var d=
m.ofType(g);return g.createSubclass({declaredClass:"esri.views.layers.GroupLayerView",constructor:function(){},getDefaults:function(){return e.mixin(this.inherited(arguments),{layerViews:[]})},initialize:function(){this._watchHandles=new k;this._watchHandles.add(this.layerViews.on("change",this._layerViewsChangeHandler.bind(this)));this._watchHandles.add(this.layerViews.on("after-changes",this._layerViewsAfterChangesHandler.bind(this)));this._watchHandles.add(this.layer.watch("visibilityMode",this._visibilityModeHandler.bind(this),
!0));this._watchHandles.add(this.watch("visible",this._visibleHandler.bind(this),!0));this._layerViewsChangeHandler({added:this.layerViews.toArray(),removed:[],changed:[]});this._layerViewsAfterChangesHandler()},destroy:function(){this._watchHandles&&(this._watchHandles.destroy(),this._watchHandles=null)},properties:{layerViews:{type:d,cast:f.castForReferenceSetter,set:function(e){this._set("layerViews",f.referenceSetter(e,this._get("layerViews"),d))}}},isUpdating:function(){return this.layerViews.some(function(d){return d.updating})},
_hasLayerViewVisibleOverrides:function(){return this.layerViews.some(function(d){return d._isOverridden("visible")})},_findLayerViewForLayer:function(d){return d&&this.layerViews.find(function(c){return c.layer===d})},_firstVisibleOnLayerOrder:function(){var d=this.layer.layers.find(function(c){return(c=this._findLayerViewForLayer(c))&&c.visible}.bind(this));return d&&this._findLayerViewForLayer(d)},_enforceExclusiveVisibility:function(d){this._hasLayerViewVisibleOverrides()&&(d||(d=this._firstVisibleOnLayerOrder(),
!d&&0<this.layerViews.length&&(d=this._findLayerViewForLayer(this.layer.layers.getItemAt(0)))),this.layerViews.forEach(function(c){c.visible=c===d}))},_layerViewsChangeHandler:function(d){this._watchHandles.remove("visible");this._watchHandles.add(this.layerViews.map(function(b){return b.watch("visible",this._layerViewVisibleHandler.bind(this),!0)}.bind(this)).toArray(),"visible");d=d.added[d.added.length-1];var c=null;d&&d.visible&&(c=d);this._enforceVisibility(c)},_layerViewsAfterChangesHandler:function(){this._watchHandles.remove("updating");
this._watchHandles.add(this.layerViews.map(function(d){return d.watch("updating",this._updateUpdating.bind(this),!0)}.bind(this)).toArray(),"updating");this._updateUpdating()},_enforceVisibility:function(d){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case "inherited":var c=this.visible;this.layerViews.forEach(function(b){b.visible=c});break;case "exclusive":this._enforceExclusiveVisibility(d)}},_visibilityModeHandler:function(d){this._enforceVisibility()},_layerViewVisibleHandler:function(d,
c,b,a){if(this._hasLayerViewVisibleOverrides())switch(this.layer.visibilityMode){case "inherited":d!==this.visible&&(a.visible=this.visible);break;case "exclusive":this._enforceExclusiveVisibility(d&&a)}},_visibleHandler:function(){this._hasLayerViewVisibleOverrides()&&"inherited"===this.layer.visibilityMode&&this._enforceVisibility()},_updateUpdating:function(){this.notifyChange("updating")}})})},"dojox/charting/action2d/Tooltip":function(){define("dijit/Tooltip dojo/_base/lang dojo/_base/declare dojo/_base/window dojo/_base/connect dojo/dom-style ./PlotAction dojox/gfx/matrix dojo/has dojo/has!dojo-bidi?../bidi/action2d/Tooltip dojox/lang/functional dojox/lang/functional/scan dojox/lang/functional/fold".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=function(a,b){var c=a.run&&a.run.data&&a.run.data[a.index];return c&&"number"!=typeof c&&(c.tooltip||c.text)?c.tooltip||c.text:b.tooltipFunc?b.tooltipFunc(a):a.y},p=Math.PI/4,q=Math.PI/2;d=k(b("dojo-bidi")?"dojox.charting.action2d.NonBidiTooltip":"dojox.charting.action2d.Tooltip",h,{defaultParams:{text:n,mouseOver:!0,defaultPosition:["after-centered","before-centered"]},optionalParams:{},constructor:function(a,b,c){this.text=c&&c.text?c.text:n;this.mouseOver=
c&&void 0!=c.mouseOver?c.mouseOver:!0;this.defaultPosition=c&&void 0!=c.defaultPosition?c.defaultPosition:["after-centered","before-centered"];this.connect()},process:function(a){if("onplotreset"===a.type||"onmouseout"===a.type)m.hide(this.aroundRect),this.aroundRect=null,"onplotreset"===a.type&&delete this.angles;else if(!(!a.shape||this.mouseOver&&"onmouseover"!==a.type||!this.mouseOver&&"onclick"!==a.type)){var d={type:"rect"},h=this.defaultPosition;switch(a.element){case "marker":d.x=a.cx;d.y=
a.cy;d.w=d.h=1;break;case "circle":d.x=a.cx-a.cr;d.y=a.cy-a.cr;d.w=d.h=2*a.cr;break;case "spider_circle":d.x=a.cx;d.y=a.cy;d.w=d.h=1;break;case "spider_plot":return;case "column":h=["above-centered","below-centered"];case "bar":d=f.clone(a.shape.getShape());d.w=d.width;d.h=d.height;break;case "candlestick":d.x=a.x;d.y=a.y;d.w=a.width;d.h=a.height;break;default:if(!this.angles){var k="number"==typeof a.run.data[0]?l.map(a.run.data,"x ? Math.max(x, 0) : 0"):l.map(a.run.data,"x ? Math.max(x.y, 0) : 0");
this.angles=l.map(l.scanl(k,"+",0),"* 2 * Math.PI / this",l.foldl(k,"+",0))}var k=c._degToRad(a.plot.opt.startAngle),n=(this.angles[a.index]+this.angles[a.index+1])/2+k;d.x=a.cx+a.cr*Math.cos(n);d.y=a.cy+a.cr*Math.sin(n);d.w=d.h=1;k&&(0>n||n>2*Math.PI)&&(n=Math.abs(2*Math.PI-Math.abs(n)));n<p||(n<q+p?h=["below-centered","above-centered"]:n<Math.PI+p?h=["before-centered","after-centered"]:n<2*Math.PI-p&&(h=["above-centered","below-centered"]))}b("dojo-bidi")&&this._recheckPosition(a,d,h);k=this.chart.getCoords();
d.x+=k.x;d.y+=k.y;d.x=Math.round(d.x);d.y=Math.round(d.y);d.w=Math.ceil(d.w);d.h=Math.ceil(d.h);this.aroundRect=d;(a=this.text(a,this.plot))&&m.show(this._format(a),this.aroundRect,h);this.mouseOver||(this._handle=g.connect(e.doc,"onclick",this,"onClick"))}},onClick:function(){this.process({type:"onmouseout"})},_recheckPosition:function(a,b,c){},_format:function(a){return a}});return b("dojo-bidi")?k("dojox.charting.action2d.Tooltip",[d,a]):d})},"dojox/charting/action2d/PlotAction":function(){define(["dojo/_base/connect",
"dojo/_base/declare","./Base","dojo/fx/easing","dojox/lang/functional"],function(m,f,k,e,g){var d=e.backOut;return f("dojox.charting.action2d.PlotAction",k,{overOutEvents:{onmouseover:1,onmouseout:1},constructor:function(e,c,b){this.anim={};b||(b={});this.duration=b.duration?b.duration:400;this.easing=b.easing?b.easing:d},connect:function(){this.handle=this.chart.connectToPlot(this.plot.name,this,"process")},disconnect:function(){this.handle&&(m.disconnect(this.handle),this.handle=null)},reset:function(){},
destroy:function(){this.inherited(arguments);g.forIn(this.anim,function(d){g.forIn(d,function(c){c.action.stop(!0)})});this.anim={}}})})},"dojox/charting/action2d/Base":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Evented"],function(m,f,k){return f("dojox.charting.action2d.Base",k,{constructor:function(e,g){this.chart=e;this.plot=g?m.isString(g)?this.chart.getPlot(g):g:this.chart.getPlot("default")},connect:function(){},disconnect:function(){},destroy:function(){this.disconnect()}})})},
"dojo/fx/easing":function(){define(["../_base/lang"],function(m){var f={linear:function(f){return f},quadIn:function(f){return Math.pow(f,2)},quadOut:function(f){return f*(f-2)*-1},quadInOut:function(f){f*=2;return 1>f?Math.pow(f,2)/2:-1*(--f*(f-2)-1)/2},cubicIn:function(f){return Math.pow(f,3)},cubicOut:function(f){return Math.pow(f-1,3)+1},cubicInOut:function(f){f*=2;return 1>f?Math.pow(f,3)/2:(Math.pow(f-2,3)+2)/2},quartIn:function(f){return Math.pow(f,4)},quartOut:function(f){return-1*(Math.pow(f-
1,4)-1)},quartInOut:function(f){f*=2;return 1>f?Math.pow(f,4)/2:-.5*(Math.pow(f-2,4)-2)},quintIn:function(f){return Math.pow(f,5)},quintOut:function(f){return Math.pow(f-1,5)+1},quintInOut:function(f){f*=2;return 1>f?Math.pow(f,5)/2:(Math.pow(f-2,5)+2)/2},sineIn:function(f){return-1*Math.cos(Math.PI/2*f)+1},sineOut:function(f){return Math.sin(Math.PI/2*f)},sineInOut:function(f){return-1*(Math.cos(Math.PI*f)-1)/2},expoIn:function(f){return 0==f?0:Math.pow(2,10*(f-1))},expoOut:function(f){return 1==
f?1:-1*Math.pow(2,-10*f)+1},expoInOut:function(f){if(0==f)return 0;if(1==f)return 1;f*=2;if(1>f)return Math.pow(2,10*(f-1))/2;--f;return(-1*Math.pow(2,-10*f)+2)/2},circIn:function(f){return-1*(Math.sqrt(1-Math.pow(f,2))-1)},circOut:function(f){return Math.sqrt(1-Math.pow(f-1,2))},circInOut:function(f){f*=2;return 1>f?-.5*(Math.sqrt(1-Math.pow(f,2))-1):.5*(Math.sqrt(1-Math.pow(f-2,2))+1)},backIn:function(f){return Math.pow(f,2)*(2.70158*f-1.70158)},backOut:function(f){--f;return Math.pow(f,2)*(2.70158*
f+1.70158)+1},backInOut:function(f){f*=2;if(1>f)return Math.pow(f,2)*(3.5949095*f-2.5949095)/2;f-=2;return(Math.pow(f,2)*(3.5949095*f+2.5949095)+2)/2},elasticIn:function(f){if(0==f||1==f)return f;--f;return-1*Math.pow(2,10*f)*Math.sin(2*(f-.075)*Math.PI/.3)},elasticOut:function(f){return 0==f||1==f?f:Math.pow(2,-10*f)*Math.sin(2*(f-.075)*Math.PI/.3)+1},elasticInOut:function(f){if(0==f)return 0;f*=2;if(2==f)return 1;var e=.3*1.5,g=e/4;if(1>f)return--f,-.5*Math.pow(2,10*f)*Math.sin(2*(f-g)*Math.PI/
e);--f;return.5*Math.pow(2,-10*f)*Math.sin(2*(f-g)*Math.PI/e)+1},bounceIn:function(k){return 1-f.bounceOut(1-k)},bounceOut:function(f){return f<1/2.75?7.5625*Math.pow(f,2):f<2/2.75?7.5625*Math.pow(f-1.5/2.75,2)+.75:f<2.5/2.75?7.5625*Math.pow(f-2.25/2.75,2)+.9375:7.5625*Math.pow(f-2.625/2.75,2)+.984375},bounceInOut:function(k){return.5>k?f.bounceIn(2*k)/2:f.bounceOut(2*k-1)/2+.5}};m.setObject("dojo.fx.easing",f);return f})},"dojox/lang/functional":function(){define(["./functional/lambda","./functional/array",
"./functional/object"],function(m){return m})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],function(m,f,k){var e=f.getObject("lang.functional",!0,m),g={},d=1<"ab".split(/a*/).length?String.prototype.split:function(b){var a=this.split.call(this,b);(b=b.exec(this))&&0==b.index&&a.unshift("");return a},h=function(b){var a=[],c=d.call(b,/\s*->\s*/m);if(1<c.length)for(;c.length;)b=c.pop(),a=c.pop().split(/\s*,\s*|\s+/m),c.length&&c.push("(function("+
a.join(", ")+"){ return ("+b+"); })");else if(b.match(/\b_\b/))a=["_"];else{var c=b.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m),e=b.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);if(c||e)c&&(a.push("$1"),b="$1"+b),e&&(a.push("$2"),b+="$2");else{var c=b.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,
"").match(/([a-z_$][a-z_$\d]*)/gi)||[],f={};k.forEach(c,function(b){f.hasOwnProperty(b)||(a.push(b),f[b]=1)})}}return{args:a,body:b}},c=function(b){return b.length?function(){var a=b.length-1,c=e.lambda(b[a]).apply(this,arguments);for(--a;0<=a;--a)c=e.lambda(b[a]).call(this,c);return c}:function(a){return a}};f.mixin(e,{rawLambda:function(b){return h(b)},buildLambda:function(b){b=h(b);return"function("+b.args.join(",")+"){return ("+b.body+");}"},lambda:function(b){if("function"==typeof b)return b;
if(b instanceof Array)return c(b);if(g.hasOwnProperty(b))return g[b];var a=h(b);return g[b]=new Function(a.args,"return ("+a.body+");")},clearLambdaCache:function(){g={}}});return e})},"dojox/main":function(){define(["dojo/_base/kernel"],function(m){return m.dojox})},"dojox/lang/functional/array":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","./lambda"],function(m,f,k,e){var g={};f.mixin(e,{filter:function(d,h,c){"string"==typeof d&&(d=d.split(""));c=c||m.global;h=e.lambda(h);
var b=[],a,l,k;if(f.isArray(d))for(l=0,k=d.length;l<k;++l)a=d[l],h.call(c,a,l,d)&&b.push(a);else if("function"==typeof d.hasNext&&"function"==typeof d.next)for(l=0;d.hasNext();)a=d.next(),h.call(c,a,l++,d)&&b.push(a);else for(l in d)l in g||(a=d[l],h.call(c,a,l,d)&&b.push(a));return b},forEach:function(d,h,c){"string"==typeof d&&(d=d.split(""));c=c||m.global;h=e.lambda(h);var b,a;if(f.isArray(d))for(b=0,a=d.length;b<a;h.call(c,d[b],b,d),++b);else if("function"==typeof d.hasNext&&"function"==typeof d.next)for(b=
0;d.hasNext();h.call(c,d.next(),b++,d));else for(b in d)b in g||h.call(c,d[b],b,d);return c},map:function(d,h,c){"string"==typeof d&&(d=d.split(""));c=c||m.global;h=e.lambda(h);var b,a,l;if(f.isArray(d))for(b=Array(a=d.length),l=0;l<a;b[l]=h.call(c,d[l],l,d),++l);else if("function"==typeof d.hasNext&&"function"==typeof d.next)for(b=[],l=0;d.hasNext();b.push(h.call(c,d.next(),l++,d)));else for(l in b=[],d)l in g||b.push(h.call(c,d[l],l,d));return b},every:function(d,h,c){"string"==typeof d&&(d=d.split(""));
c=c||m.global;h=e.lambda(h);var b,a;if(f.isArray(d))for(b=0,a=d.length;b<a;++b){if(!h.call(c,d[b],b,d))return!1}else if("function"==typeof d.hasNext&&"function"==typeof d.next)for(b=0;d.hasNext();){if(!h.call(c,d.next(),b++,d))return!1}else for(b in d)if(!(b in g||h.call(c,d[b],b,d)))return!1;return!0},some:function(d,h,c){"string"==typeof d&&(d=d.split(""));c=c||m.global;h=e.lambda(h);var b,a;if(f.isArray(d))for(b=0,a=d.length;b<a;++b){if(h.call(c,d[b],b,d))return!0}else if("function"==typeof d.hasNext&&
"function"==typeof d.next)for(b=0;d.hasNext();){if(h.call(c,d.next(),b++,d))return!0}else for(b in d)if(!(b in g)&&h.call(c,d[b],b,d))return!0;return!1}});return e})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(m,f,k){var e={};f.mixin(k,{keys:function(f){var d=[],g;for(g in f)g in e||d.push(g);return d},values:function(f){var d=[],g;for(g in f)g in e||d.push(f[g]);return d},filterIn:function(f,d,h){h=h||m.global;d=k.lambda(d);var c=
{},b,a;for(a in f)a in e||(b=f[a],d.call(h,b,a,f)&&(c[a]=b));return c},forIn:function(f,d,h){h=h||m.global;d=k.lambda(d);for(var c in f)c in e||d.call(h,f[c],c,f);return h},mapIn:function(f,d,h){h=h||m.global;d=k.lambda(d);var c={},b;for(b in f)b in e||(c[b]=d.call(h,f[b],b,f));return c}});return k})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(m,f){var k=m.matrix={},e={};k._degToRad=function(f){return e[f]||(e[f]=Math.PI*f/180)};k._radToDeg=function(e){return e/Math.PI*
180};k.Matrix2D=function(e){if(e)if("number"==typeof e)this.xx=this.yy=e;else if(e instanceof Array){if(0<e.length){for(var d=k.normalize(e[0]),g=1;g<e.length;++g){var c=d,b=k.normalize(e[g]),d=new k.Matrix2D;d.xx=c.xx*b.xx+c.xy*b.yx;d.xy=c.xx*b.xy+c.xy*b.yy;d.yx=c.yx*b.xx+c.yy*b.yx;d.yy=c.yx*b.xy+c.yy*b.yy;d.dx=c.xx*b.dx+c.xy*b.dy+c.dx;d.dy=c.yx*b.dx+c.yy*b.dy+c.dy}f.mixin(this,d)}}else f.mixin(this,e)};f.extend(k.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});f.mixin(k,{identity:new k.Matrix2D,flipX:new k.Matrix2D({xx:-1}),
flipY:new k.Matrix2D({yy:-1}),flipXY:new k.Matrix2D({xx:-1,yy:-1}),translate:function(e,d){return 1<arguments.length?new k.Matrix2D({dx:e,dy:d}):new k.Matrix2D({dx:e.x,dy:e.y})},scale:function(e,d){return 1<arguments.length?new k.Matrix2D({xx:e,yy:d}):"number"==typeof e?new k.Matrix2D({xx:e,yy:e}):new k.Matrix2D({xx:e.x,yy:e.y})},rotate:function(e){var d=Math.cos(e);e=Math.sin(e);return new k.Matrix2D({xx:d,xy:-e,yx:e,yy:d})},rotateg:function(e){return k.rotate(k._degToRad(e))},skewX:function(e){return new k.Matrix2D({xy:Math.tan(e)})},
skewXg:function(e){return k.skewX(k._degToRad(e))},skewY:function(e){return new k.Matrix2D({yx:Math.tan(e)})},skewYg:function(e){return k.skewY(k._degToRad(e))},reflect:function(e,d){1==arguments.length&&(d=e.y,e=e.x);var f=e*e,c=d*d,b=f+c,a=2*e*d/b;return new k.Matrix2D({xx:2*f/b-1,xy:a,yx:a,yy:2*c/b-1})},project:function(e,d){1==arguments.length&&(d=e.y,e=e.x);var f=e*e,c=d*d,b=f+c,a=e*d/b;return new k.Matrix2D({xx:f/b,xy:a,yx:a,yy:c/b})},normalize:function(e){return e instanceof k.Matrix2D?e:new k.Matrix2D(e)},
isIdentity:function(e){return 1==e.xx&&0==e.xy&&0==e.yx&&1==e.yy&&0==e.dx&&0==e.dy},clone:function(e){var d=new k.Matrix2D,f;for(f in e)"number"==typeof e[f]&&"number"==typeof d[f]&&d[f]!=e[f]&&(d[f]=e[f]);return d},invert:function(e){e=k.normalize(e);var d=e.xx*e.yy-e.xy*e.yx;return e=new k.Matrix2D({xx:e.yy/d,xy:-e.xy/d,yx:-e.yx/d,yy:e.xx/d,dx:(e.xy*e.dy-e.yy*e.dx)/d,dy:(e.yx*e.dx-e.xx*e.dy)/d})},_multiplyPoint:function(e,d,f){return{x:e.xx*d+e.xy*f+e.dx,y:e.yx*d+e.yy*f+e.dy}},multiplyPoint:function(e,
d,f){e=k.normalize(e);return"number"==typeof d&&"number"==typeof f?k._multiplyPoint(e,d,f):k._multiplyPoint(e,d.x,d.y)},multiplyRectangle:function(e,d){var f=k.normalize(e);d=d||{x:0,y:0,width:0,height:0};if(k.isIdentity(f))return{x:d.x,y:d.y,width:d.width,height:d.height};e=k.multiplyPoint(f,d.x,d.y);var c=k.multiplyPoint(f,d.x,d.y+d.height),b=k.multiplyPoint(f,d.x+d.width,d.y);d=k.multiplyPoint(f,d.x+d.width,d.y+d.height);var f=Math.min(e.x,c.x,b.x,d.x),a=Math.min(e.y,c.y,b.y,d.y);return{x:f,y:a,
width:Math.max(e.x,c.x,b.x,d.x)-f,height:Math.max(e.y,c.y,b.y,d.y)-a}},multiply:function(e){for(var d=k.normalize(e),f=1;f<arguments.length;++f){var c=d,b=k.normalize(arguments[f]),d=new k.Matrix2D;d.xx=c.xx*b.xx+c.xy*b.yx;d.xy=c.xx*b.xy+c.xy*b.yy;d.yx=c.yx*b.xx+c.yy*b.yx;d.yy=c.yx*b.xy+c.yy*b.yy;d.dx=c.xx*b.dx+c.xy*b.dy+c.dx;d.dy=c.yx*b.dx+c.yy*b.dy+c.dy}return d},_sandwich:function(e,d,f){return k.multiply(k.translate(d,f),e,k.translate(-d,-f))},scaleAt:function(e,d,f,c){switch(arguments.length){case 4:return k._sandwich(k.scale(e,
d),f,c);case 3:return"number"==typeof f?k._sandwich(k.scale(e),d,f):k._sandwich(k.scale(e,d),f.x,f.y)}return k._sandwich(k.scale(e),d.x,d.y)},rotateAt:function(e,d,f){return 2<arguments.length?k._sandwich(k.rotate(e),d,f):k._sandwich(k.rotate(e),d.x,d.y)},rotategAt:function(e,d,f){return 2<arguments.length?k._sandwich(k.rotateg(e),d,f):k._sandwich(k.rotateg(e),d.x,d.y)},skewXAt:function(e,d,f){return 2<arguments.length?k._sandwich(k.skewX(e),d,f):k._sandwich(k.skewX(e),d.x,d.y)},skewXgAt:function(e,
d,f){return 2<arguments.length?k._sandwich(k.skewXg(e),d,f):k._sandwich(k.skewXg(e),d.x,d.y)},skewYAt:function(e,d,f){return 2<arguments.length?k._sandwich(k.skewY(e),d,f):k._sandwich(k.skewY(e),d.x,d.y)},skewYgAt:function(e,d,f){return 2<arguments.length?k._sandwich(k.skewYg(e),d,f):k._sandwich(k.skewYg(e),d.x,d.y)}});m.Matrix2D=k.Matrix2D;return k})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),
function(m,f,k,e,g,d,h,c,b){var a=f.getObject("dojox.gfx",!0),l=a._base={};a._hasClass=function(a,b){return(a=a.getAttribute("className"))&&0<=(" "+a+" ").indexOf(" "+b+" ")};a._addClass=function(a,b){var c=a.getAttribute("className")||"";(!c||0>(" "+c+" ").indexOf(" "+b+" "))&&a.setAttribute("className",c+(c?" ":"")+b)};a._removeClass=function(a,b){var c=a.getAttribute("className");c&&a.setAttribute("className",c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),"$1$2"))};l._getFontMeasurements=function(){var a=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},b,d;e("ie")&&(d=g.doc.documentElement.style.fontSize||"",d||(g.doc.documentElement.style.fontSize="100%"));var f=c.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},g.body());for(b in a)f.style.fontSize=b,a[b]=16*Math.round(12*f.offsetHeight/16)/12/1E3;
e("ie")&&(g.doc.documentElement.style.fontSize=d);g.body().removeChild(f);return a};var n=null;l._getCachedFontMeasurements=function(a){if(a||!n)n=l._getFontMeasurements();return n};var p=null,q={};l._getTextBox=function(a,d,e){var f,h,l=arguments.length,k;p||(p=c.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},g.body()));f=p;f.className="";h=f.style;h.borderWidth="0";h.margin="0";h.padding="0";h.outline="0";if(1<l&&d)for(k in d)k in q||(h[k]=d[k]);2<l&&e&&(f.className=
e);f.innerHTML=a;f.getBoundingClientRect?(h=f.getBoundingClientRect(),h={l:h.left,t:h.top,w:h.width||h.right-h.left,h:h.height||h.bottom-h.top}):h=b.getMarginBox(f);f.innerHTML="";return h};l._computeTextLocation=function(a,b,c,d){var e={};switch(a.align){case "end":e.x=a.x-b;break;case "middle":e.x=a.x-b/2;break;default:e.x=a.x}e.y=a.y-c*(d?.75:1);return e};l._computeTextBoundingBox=function(b){if(!a._base._isRendered(b))return{x:0,y:0,width:0,height:0};var c;c=b.getShape();var d=b.getFont()||a.defaultFont;
b=b.getTextWidth();d=a.normalizedLength(d.size);c=l._computeTextLocation(c,b,d,!0);return{x:c.x,y:c.y,width:b,height:d}};l._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==a};var r=0;l._getUniqueId=function(){var a;do a=m._scopeName+"xUnique"+ ++r;while(h.byId(a));return a};var t=e("pointer-events")?"touchAction":null;l._fixMsTouchAction=t?function(a){a.rawNode.style[t]="none"}:function(){};f.mixin(a,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",
points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",
color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var b={};return function(c){var d=
b[c];if(d)return new d;d=b[c]=new Function;d.prototype=a["default"+c];return new d}}(),normalizeColor:function(a){return a instanceof k?a:new k(a)},normalizeParameters:function(a,b){var c;if(b){var d={};for(c in a)c in b&&!(c in d)&&(a[c]=b[c])}return a},makeParameters:function(a,b){var c=null;if(!b)return f.delegate(a);var d={};for(c in a)c in d||(d[c]=f.clone(c in b?b[c]:a[c]));return d},formatNumber:function(a,b){var c=a.toString();if(0<=c.indexOf("e"))c=a.toFixed(4);else{var d=c.indexOf(".");
0<=d&&5<c.length-d&&(c=a.toFixed(4))}return 0>a?c:b?" "+c:c},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family},splitFontString:function(b){var c=a.getDefault("Font");b=b.split(/\s+/);if(!(5>b.length)){c.style=b[0];c.variant=b[1];c.weight=b[2];var d=b[3].indexOf("/");c.size=0>d?b[3]:b[3].substring(0,d);var e=4;0>d&&("/"==b[4]?e=6:"/"==b[4].charAt(0)&&(e=5));e<b.length&&(c.family=b.slice(e).join(" "))}return c},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return a._base._getCachedFontMeasurements()["12pt"]/
12},pt2px:function(b){return b*a.px_in_pt()},px2pt:function(b){return b/a.px_in_pt()},normalizedLength:function(b){if(0===b.length)return 0;if(2<b.length){var c=a.px_in_pt(),d=parseFloat(b);switch(b.slice(-2)){case "px":return d;case "pt":return d*c;case "in":return 72*d*c;case "pc":return 12*d*c;case "mm":return d*a.mm_in_pt*c;case "cm":return d*a.cm_in_pt*c}}return parseFloat(b)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,
equalSources:function(a,b){return a&&b&&a===b},switchTo:function(b){var c="string"==typeof b?a[b]:b;c&&(d.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath EsriPath Surface createSurface fixTarget".split(" "),function(b){a[b]=c[b]}),"string"==typeof b?a.renderer=b:d.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(b){return a.renderer=a[b]&&a[b].Surface===a.Surface?b:null}))}});return a})},"dojox/lang/functional/scan":function(){define(["dojo/_base/kernel",
"dojo/_base/lang","./lambda"],function(m,f,k){var e={};f.mixin(k,{scanl:function(g,d,h,c){"string"==typeof g&&(g=g.split(""));c=c||m.global;d=k.lambda(d);var b,a,l;if(f.isArray(g))for(b=Array((a=g.length)+1),b[0]=h,l=0;l<a;h=d.call(c,h,g[l],l,g),b[++l]=h);else if("function"==typeof g.hasNext&&"function"==typeof g.next)for(b=[h],l=0;g.hasNext();b.push(h=d.call(c,h,g.next(),l++,g)));else for(l in b=[h],g)l in e||b.push(h=d.call(c,h,g[l],l,g));return b},scanl1:function(g,d,h){"string"==typeof g&&(g=
g.split(""));h=h||m.global;d=k.lambda(d);var c,b,a;b=!0;if(f.isArray(g)){c=Array(b=g.length);c[0]=a=g[0];for(var l=1;l<b;c[l]=a=d.call(h,a,g[l],l,g),++l);}else if("function"==typeof g.hasNext&&"function"==typeof g.next){if(g.hasNext())for(c=[a=g.next()],l=1;g.hasNext();c.push(a=d.call(h,a,g.next(),l++,g)));}else for(l in g)l in e||(b?(c=[a=g[l]],b=!1):c.push(a=d.call(h,a,g[l],l,g)));return c},scanr:function(e,d,f,c){"string"==typeof e&&(e=e.split(""));c=c||m.global;d=k.lambda(d);var b=e.length,a=
Array(b+1),g=b;for(a[b]=f;0<g;--g,f=d.call(c,f,e[g],g,e),a[g]=f);return a},scanr1:function(e,d,f){"string"==typeof e&&(e=e.split(""));f=f||m.global;d=k.lambda(d);var c=e.length,b=Array(c),a=e[c-1],c=c-1;for(b[c]=a;0<c;--c,a=d.call(f,a,e[c],c,e),b[c]=a);return b}})})},"dojox/lang/functional/fold":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","./lambda"],function(m,f,k,e){var g={};m.mixin(e,{foldl:function(d,f,c,b){"string"==typeof d&&(d=d.split(""));b=b||k.global;f=e.lambda(f);
var a,h;if(m.isArray(d))for(a=0,h=d.length;a<h;c=f.call(b,c,d[a],a,d),++a);else if("function"==typeof d.hasNext&&"function"==typeof d.next)for(a=0;d.hasNext();c=f.call(b,c,d.next(),a++,d));else for(a in d)a in g||(c=f.call(b,c,d[a],a,d));return c},foldl1:function(d,f,c){"string"==typeof d&&(d=d.split(""));c=c||k.global;f=e.lambda(f);var b,a,h;if(m.isArray(d))for(b=d[0],a=1,h=d.length;a<h;b=f.call(c,b,d[a],a,d),++a);else if("function"==typeof d.hasNext&&"function"==typeof d.next){if(d.hasNext())for(b=
d.next(),a=1;d.hasNext();b=f.call(c,b,d.next(),a++,d));}else for(a in h=!0,d)a in g||(h?(b=d[a],h=!1):b=f.call(c,b,d[a],a,d));return b},foldr:function(d,f,c,b){"string"==typeof d&&(d=d.split(""));b=b||k.global;f=e.lambda(f);for(var a=d.length;0<a;--a,c=f.call(b,c,d[a],a,d));return c},foldr1:function(d,f,c){"string"==typeof d&&(d=d.split(""));c=c||k.global;f=e.lambda(f);for(var b=d.length,a=d[b-1],b=b-1;0<b;--b,a=f.call(c,a,d[b],b,d));return a},reduce:function(d,f,c){return 3>arguments.length?e.foldl1(d,
f):e.foldl(d,f,c)},reduceRight:function(d,f,c){return 3>arguments.length?e.foldr1(d,f):e.foldr(d,f,c)},unfold:function(d,f,c,b,a){a=a||k.global;f=e.lambda(f);c=e.lambda(c);d=e.lambda(d);for(var g=[];!d.call(a,b);g.push(f.call(a,b)),b=c.call(a,b));return g}})})},"dojox/charting/Chart2D":function(){define("dojo/_base/kernel dojo/_base/lang .. ./Chart ./axis2d/Default ./axis2d/Invisible ./plot2d/Default ./plot2d/Lines ./plot2d/Areas ./plot2d/Markers ./plot2d/MarkersOnly ./plot2d/Scatter ./plot2d/Stacked ./plot2d/StackedLines ./plot2d/StackedAreas ./plot2d/Columns ./plot2d/StackedColumns ./plot2d/ClusteredColumns ./plot2d/Bars ./plot2d/StackedBars ./plot2d/ClusteredBars ./plot2d/Grid ./plot2d/Pie ./plot2d/Bubble ./plot2d/Candlesticks ./plot2d/OHLC ./plot2d/Spider".split(" "),
function(m,f,k,e){m.deprecated("dojox.charting.Chart2D","Use dojox.charting.Chart instead and require all other components explicitly","2.0");return f.setObject("dojox.charting.Chart2D",e)})},"dojox/charting/Chart":function(){define("../main dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/dom-style dojo/dom dojo/dom-geometry dojo/dom-construct dojo/_base/Color dojo/sniff ./Element ./SimpleTheme ./Series ./axis2d/common dojox/gfx/shape dojox/gfx dojo/has!dojo-bidi?./bidi/Chart dojox/lang/functional dojox/lang/functional/fold dojox/lang/functional/reversed".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){function x(a,b){a&&b&&(a.min=Math.min(a.min,b.min),a.max=Math.max(a.max,b.max));return a||b}function v(a,b){var c={},d={};k.forEach(a,function(a){var b=c[a.name]=a.getSeriesStats();a.hAxis&&(d[a.hAxis]=x(d[a.hAxis],{min:b.hmin,max:b.hmax}));a.vAxis&&(d[a.vAxis]=x(d[a.vAxis],{min:b.vmin,max:b.vmax}))});k.forEach(a,function(a){var e=c[a.name];if(a.hAxis){var f=d[a.hAxis];e.hmin=f.min;e.hmax=f.max}a.vAxis&&(f=d[a.vAxis],e.vmin=f.min,e.vmax=f.max);a.initializeScalers(b,
e)})}var z=f.getObject("charting",!0,m),y=u.lambda("item.clear()"),A=u.lambda("item.purgeGroup()"),B=u.lambda("item.destroy()"),C=u.lambda("item.dirty \x3d false"),E=u.lambda("item.dirty \x3d true"),D=u.lambda("item.name"),F={l:10,t:10,r:10,b:10};m=e(a("dojo-bidi")?"dojox.charting.NonBidiChart":"dojox.charting.Chart",null,{constructor:function(a,b){b||(b={});this.margins=b.margins||F;this._customMargins=!!b.margins;this.stroke=b.stroke;this.fill=b.fill;this.delayInMs=b.delayInMs||200;this.title=b.title;
this.titleGap=b.titleGap;this.titlePos=b.titlePos;this.titleFont=b.titleFont;this.titleFontColor=b.titleFontColor;this.titleAlign=b.titleAlign;this.chartTitle=null;this.htmlLabels=!0;"htmlLabels"in b&&(this.htmlLabels=b.htmlLabels);this.theme=null;this.axes={};this.stack=[];this.plots={};this.series=[];this.runs={};this.dirty=!0;this.node=d.byId(a);a=h.getMarginBox(a);this.surface=t.createSurface(this.node,a.w||400,a.h||300);-1==this.surface.declaredClass.indexOf("vml")&&(this._nativeClip=!0)},destroy:function(){k.forEach(this.series,
B);k.forEach(this.stack,B);u.forIn(this.axes,B);this.surface.destroy();this.chartTitle&&this.chartTitle.tagName&&c.destroy(this.chartTitle)},getCoords:function(){var a=this.node,b=g.getComputedStyle(a),b=h.getMarginBox(a,b),a=h.position(a,!0);b.x=a.x;b.y=a.y;return b},setTheme:function(a){this.theme=a.clone();this._customMargins||(this.margins=this.theme.chart.margins||F);this.dirty=!0;return this},addAxis:function(a,b){var c=b&&b.type||"Default";if("string"==typeof c){if(!z.axis2d||!z.axis2d[c])throw Error("Can't find axis: "+
c+" - Check require() dependencies.");b=new z.axis2d[c](this,b)}else b=new c(this,b);b.name=a;b.dirty=!0;a in this.axes&&this.axes[a].destroy();this.axes[a]=b;this.dirty=!0;return this},getAxis:function(a){return this.axes[a]},removeAxis:function(a){a in this.axes&&(this.axes[a].destroy(),delete this.axes[a],this.dirty=!0);return this},addPlot:function(a,b){var c=b&&b.type||"Default";if("string"==typeof c){if(!z.plot2d||!z.plot2d[c])throw Error("Can't find plot: "+c+" - didn't you forget to dojo.require() it?");
b=new z.plot2d[c](this,b)}else b=new c(this,b);b.name=a;b.dirty=!0;a in this.plots?(this.stack[this.plots[a]].destroy(),this.stack[this.plots[a]]=b):(this.plots[a]=this.stack.length,this.stack.push(b));this.dirty=!0;return this},getPlot:function(a){return this.stack[this.plots[a]]},removePlot:function(a){if(a in this.plots){var b=this.plots[a];delete this.plots[a];this.stack[b].destroy();this.stack.splice(b,1);u.forIn(this.plots,function(a,c,d){a>b&&(d[c]=a-1)});var c=k.filter(this.series,function(b){return b.plot!=
a});c.length<this.series.length&&(k.forEach(this.series,function(b){b.plot==a&&b.destroy()}),this.runs={},k.forEach(c,function(a,b){this.runs[a.plot]=b},this),this.series=c);this.dirty=!0}return this},getPlotOrder:function(){return u.map(this.stack,D)},setPlotOrder:function(a){var b={},c=u.filter(a,function(a){if(!(a in this.plots)||a in b)return!1;b[a]=1;return!0},this);c.length<this.stack.length&&u.forEach(this.stack,function(a){a=a.name;a in b||c.push(a)});a=u.map(c,function(a){return this.stack[this.plots[a]]},
this);u.forEach(a,function(a,b){this.plots[a.name]=b},this);this.stack=a;this.dirty=!0;return this},movePlotToFront:function(a){if(a in this.plots){var b=this.plots[a];if(b){var c=this.getPlotOrder();c.splice(b,1);c.unshift(a);return this.setPlotOrder(c)}}return this},movePlotToBack:function(a){if(a in this.plots){var b=this.plots[a];if(b<this.stack.length-1){var c=this.getPlotOrder();c.splice(b,1);c.push(a);return this.setPlotOrder(c)}}return this},addSeries:function(a,b,c){b=new p(this,b,c);b.name=
a;a in this.runs?(this.series[this.runs[a]].destroy(),this.series[this.runs[a]]=b):(this.runs[a]=this.series.length,this.series.push(b));this.dirty=!0;!("ymin"in b)&&"min"in b&&(b.ymin=b.min);!("ymax"in b)&&"max"in b&&(b.ymax=b.max);return this},getSeries:function(a){return this.series[this.runs[a]]},removeSeries:function(a){if(a in this.runs){var b=this.runs[a];delete this.runs[a];this.series[b].destroy();this.series.splice(b,1);u.forIn(this.runs,function(a,c,d){a>b&&(d[c]=a-1)});this.dirty=!0}return this},
updateSeries:function(a,b,c){a in this.runs&&(a=this.series[this.runs[a]],a.update(b),c?this.dirty=!0:(this._invalidateDependentPlots(a.plot,!1),this._invalidateDependentPlots(a.plot,!0)));return this},getSeriesOrder:function(a){return u.map(u.filter(this.series,function(b){return b.plot==a}),D)},setSeriesOrder:function(a){var b,c={},d=u.filter(a,function(a){if(!(a in this.runs)||a in c)return!1;var d=this.series[this.runs[a]];if(b){if(d.plot!=b)return!1}else b=d.plot;c[a]=1;return!0},this);u.forEach(this.series,
function(a){var e=a.name;e in c||a.plot!=b||d.push(e)});this.series=u.map(d,function(a){return this.series[this.runs[a]]},this).concat(u.filter(this.series,function(a){return a.plot!=b}));u.forEach(this.series,function(a,b){this.runs[a.name]=b},this);this.dirty=!0;return this},moveSeriesToFront:function(a){if(a in this.runs){var b=this.runs[a],c=this.getSeriesOrder(this.series[b].plot);if(a!=c[0])return c.splice(b,1),c.unshift(a),this.setSeriesOrder(c)}return this},moveSeriesToBack:function(a){if(a in
this.runs){var b=this.runs[a],c=this.getSeriesOrder(this.series[b].plot);if(a!=c[c.length-1])return c.splice(b,1),c.push(a),this.setSeriesOrder(c)}return this},resize:function(a,b){switch(arguments.length){case 1:h.setMarginBox(this.node,a);break;case 2:h.setMarginBox(this.node,{w:a,h:b})}var c=h.getMarginBox(this.node),d=this.surface.getDimensions();return d.width!=c.w||d.height!=c.h?(this.surface.setDimensions(c.w,c.h),this.dirty=!0,this.render()):this},getGeometry:function(){var a={};u.forIn(this.axes,
function(b){b.initialized()&&(a[b.name]={name:b.name,vertical:b.vertical,scaler:b.scaler,ticks:b.ticks})});return a},setAxisWindow:function(a,b,c,d){var e=this.axes[a];e&&(e.setWindow(b,c),k.forEach(this.stack,function(b){if(b.hAxis==a||b.vAxis==a)b.zoom=d}));return this},setWindow:function(a,b,c,d,e){"plotArea"in this||this.calculateGeometry();u.forIn(this.axes,function(e){var f,g;f=e.getScaler().bounds;g=f.span/(f.upper-f.lower);e.vertical?(f=b,g=d/g/f):(f=a,g=c/g/f);e.setWindow(f,g)});k.forEach(this.stack,
function(a){a.zoom=e});return this},zoomIn:function(a,b,c){var d=this.axes[a];if(d){var d=d.getScaler().bounds,e=Math.min(b[0],b[1]),f=Math.max(b[0],b[1]),e=b[0]<d.lower?d.lower:e,f=b[1]>d.upper?d.upper:f;this.setAxisWindow(a,(d.upper-d.lower)/(f-e),e-d.lower);c?this.delayedRender():this.render()}},calculateGeometry:function(){if(this.dirty)return this.fullGeometry();var a=k.filter(this.stack,function(a){return a.dirty||a.hAxis&&this.axes[a.hAxis].dirty||a.vAxis&&this.axes[a.vAxis].dirty},this);v(a,
this.plotArea);return this},fullGeometry:function(){this._makeDirty();k.forEach(this.stack,y);this.theme||this.setTheme(new n);k.forEach(this.series,function(a){if(!(a.plot in this.plots)){if(!z.plot2d||!z.plot2d.Default)throw Error("Can't find plot: Default - didn't you forget to dojo.require() it?");var b=new z.plot2d.Default(this,{});b.name=a.plot;this.plots[a.plot]=this.stack.length;this.stack.push(b)}this.stack[this.plots[a.plot]].addSeries(a)},this);k.forEach(this.stack,function(a){a.assignAxes&&
a.assignAxes(this.axes)},this);var b=this.dim=this.surface.getDimensions();b.width=t.normalizedLength(b.width);b.height=t.normalizedLength(b.height);u.forIn(this.axes,y);v(this.stack,b);var c=this.offsets={l:0,r:0,t:0,b:0},d=this;u.forIn(this.axes,function(b){a("dojo-bidi")&&d._resetLeftBottom(b);u.forIn(b.getOffsets(),function(a,b){c[b]=Math.max(a,c[b])})});if(this.title){this.titleGap=0==this.titleGap?0:this.titleGap||this.theme.chart.titleGap||20;this.titlePos=this.titlePos||this.theme.chart.titlePos||
"top";this.titleFont=this.titleFont||this.theme.chart.titleFont;this.titleFontColor=this.titleFontColor||this.theme.chart.titleFontColor||"black";this.titleAlign=this.titleAlign||this.theme&&this.theme.chart&&this.theme.chart.titleAlign||"middle";var e=t.normalizedLength(t.splitFontString(this.titleFont).size);c["top"==this.titlePos?"t":"b"]+=e+this.titleGap}u.forIn(this.margins,function(a,b){c[b]+=a});this.plotArea={width:b.width-c.l-c.r,height:b.height-c.t-c.b};u.forIn(this.axes,y);v(this.stack,
this.plotArea);return this},render:function(){this._delayedRenderHandle&&(clearTimeout(this._delayedRenderHandle),this._delayedRenderHandle=null);this.theme&&this.theme.clear();if(this.dirty)return this.fullRender();this.calculateGeometry();u.forEachRev(this.stack,function(a){a.render(this.dim,this.offsets)},this);u.forIn(this.axes,function(a){a.render(this.dim,this.offsets)},this);this._makeClean();return this},fullRender:function(){this.fullGeometry();var a=this.offsets,b=this.dim,d=Math.max(0,
b.width-a.l-a.r),e=Math.max(0,b.height-a.t-a.b);k.forEach(this.series,A);u.forIn(this.axes,A);k.forEach(this.stack,A);var f=this.surface.children;if(r.dispose)for(var g=0;g<f.length;++g)r.dispose(f[g]);this.chartTitle&&this.chartTitle.tagName&&c.destroy(this.chartTitle);this.surface.clear();this.chartTitle=null;this._renderChartBackground(b,a);this._renderPlotBackground(b,a,d,e);u.foldr(this.stack,function(c,d){return d.render(b,a),0},0);this._nativeClip||this._renderChartBackground(b,a);this.title&&
this._renderTitle(b,a);u.forIn(this.axes,function(c){c.render(b,a)});this._makeClean();return this},_renderTitle:function(b,c){var d="canvas"==t.renderer&&this.htmlLabels||!a("ie")&&!a("opera")&&this.htmlLabels?"html":"gfx",e=t.normalizedLength(t.splitFontString(this.titleFont).size),f=t._base._getTextBox(this.title,{font:this.titleFont}),g=this.titleAlign,h=a("dojo-bidi")&&this.isRightToLeft(),l=b.width/2;"edge"===g?(g="left",l=h?b.width-(c.r+f.w):c.l):"middle"!=g&&(h&&(g="left"===g?"right":"left"),
"left"===g?l=this.margins.l:"right"===g&&(g="left",l=b.width-(this.margins.l+f.w)));this.chartTitle=q.createText[d](this,this.surface,l,"top"==this.titlePos?e+this.margins.t:b.height-this.margins.b,g,this.title,this.titleFont,this.titleFontColor)},_renderChartBackground:function(a,c){var d=this.theme,e,f=void 0!==this.fill?this.fill:d.chart&&d.chart.fill,d=void 0!==this.stroke?this.stroke:d.chart&&d.chart.stroke;if("inherit"==f)for(e=this.node,f=new b(g.get(e,"backgroundColor"));0==f.a&&e!=document.documentElement;)f=
new b(g.get(e,"backgroundColor")),e=e.parentNode;f&&(this._nativeClip?(f=l.prototype._shapeFill(l.prototype._plotFill(f,a),{x:0,y:0,width:a.width+1,height:a.height+1}),this.surface.createRect({width:a.width+1,height:a.height+1}).setFill(f)):(f=l.prototype._plotFill(f,a,c),c.l&&(e={x:0,y:0,width:c.l,height:a.height+1},this.surface.createRect(e).setFill(l.prototype._shapeFill(f,e))),c.r&&(e={x:a.width-c.r,y:0,width:c.r+1,height:a.height+2},this.surface.createRect(e).setFill(l.prototype._shapeFill(f,
e))),c.t&&(e={x:0,y:0,width:a.width+1,height:c.t},this.surface.createRect(e).setFill(l.prototype._shapeFill(f,e))),c.b&&(e={x:0,y:a.height-c.b,width:a.width+1,height:c.b+2},this.surface.createRect(e).setFill(l.prototype._shapeFill(f,e)))));d&&this.surface.createRect({width:a.width-1,height:a.height-1}).setStroke(d)},_renderPlotBackground:function(a,b,c,d){var e=this.theme,f=e.plotarea&&e.plotarea.fill,e=e.plotarea&&e.plotarea.stroke,g={x:b.l-1,y:b.t-1,width:c+2,height:d+2};f&&(f=l.prototype._shapeFill(l.prototype._plotFill(f,
a,b),g),this.surface.createRect(g).setFill(f));e&&this.surface.createRect({x:b.l,y:b.t,width:c+1,height:d+1}).setStroke(e)},delayedRender:function(){this._delayedRenderHandle||(this._delayedRenderHandle=setTimeout(f.hitch(this,function(){this.render()}),this.delayInMs));return this},connectToPlot:function(a,b,c){return a in this.plots?this.stack[this.plots[a]].connect(b,c):null},fireEvent:function(a,b,c){if(a in this.runs){var d=this.series[this.runs[a]].plot;d in this.plots&&(d=this.stack[this.plots[d]])&&
d.fireEvent(a,b,c)}return this},_makeClean:function(){k.forEach(this.axes,C);k.forEach(this.stack,C);k.forEach(this.series,C);this.dirty=!1},_makeDirty:function(){k.forEach(this.axes,E);k.forEach(this.stack,E);k.forEach(this.series,E);this.dirty=!0},_invalidateDependentPlots:function(a,b){if(a in this.plots){var c=this.stack[this.plots[a]],d=b?"vAxis":"hAxis";c[d]?(a=this.axes[c[d]])&&a.dependOnData()&&(a.dirty=!0,k.forEach(this.stack,function(a){a[d]&&a[d]==c[d]&&(a.dirty=!0)})):c.dirty=!0}},setDir:function(a){return this},
_resetLeftBottom:function(a){},formatTruncatedLabel:function(a,b,c){}});return a("dojo-bidi")?e("dojox.charting.Chart",[m,w]):m})},"dojox/charting/Element":function(){define(["dojo/_base/array","dojo/dom-construct","dojo/_base/declare","dojox/gfx","dojox/gfx/shape"],function(m,f,k,e,g){return k("dojox.charting.Element",null,{chart:null,group:null,htmlElements:null,dirty:!0,renderingOptions:null,constructor:function(d,e){this.chart=d;this.group=null;this.htmlElements=[];this.dirty=!0;this.trailingSymbol=
"...";this._events=[];e&&e.renderingOptions&&(this.renderingOptions=e.renderingOptions)},purgeGroup:function(){this.destroyHtmlElements();if(this.group){this.getGroup().removeShape();var d=this.getGroup().children;if(g.dispose)for(var e=0;e<d.length;++e)g.dispose(d[e],!0);this.getGroup().rawNode&&f.empty(this.getGroup().rawNode);this.getGroup().clear();g.dispose&&g.dispose(this.getGroup(),!0);this.getGroup()!=this.group&&(this.group.rawNode&&f.empty(this.group.rawNode),this.group.clear(),g.dispose&&
g.dispose(this.group,!0));this.group=null}this.dirty=!0;this._events.length&&(m.forEach(this._events,function(c){c.shape.disconnect(c.handle)}),this._events=[]);return this},cleanGroup:function(d){this.destroyHtmlElements();d||(d=this.chart.surface);if(this.group){var e;d=this.getGroup().children;if(g.dispose)for(var c=0;c<d.length;++c)g.dispose(d[c],!0);this.getGroup().rawNode&&(e=this.getGroup().bgNode,f.empty(this.getGroup().rawNode));this.getGroup().clear();e&&this.getGroup().rawNode.appendChild(e)}else if(this.group=
d.createGroup(),this.renderingOptions&&this.group.rawNode&&"http://www.w3.org/2000/svg"==this.group.rawNode.namespaceURI)for(c in this.renderingOptions)this.group.rawNode.setAttribute(c,this.renderingOptions[c]);this.dirty=!0;return this},getGroup:function(){return this.group},destroyHtmlElements:function(){this.htmlElements.length&&(m.forEach(this.htmlElements,f.destroy),this.htmlElements=[])},destroy:function(){this.purgeGroup()},overrideShape:function(d,e){},getTextWidth:function(d,f){return e._base._getTextBox(d,
{font:f}).w||0},getTextWithLimitLength:function(d,e,c,b){if(!d||0>=d.length)return{text:"",truncated:b||!1};if(!c||0>=c)return{text:d,truncated:b||!1};var a=d.substring(0,1)+this.trailingSymbol,f=this.getTextWidth(a,e);if(c<=f)return{text:a,truncated:!0};if(this.getTextWidth(d,e)<=c)return{text:d,truncated:b||!1};b=0;for(a=d.length;b<a;){if(2>=a-b){for(;this.getTextWidth(d.substring(0,b)+this.trailingSymbol,e)>c;)--b;return{text:d.substring(0,b)+this.trailingSymbol,truncated:!0}}f=b+Math.round(.618*
(a-b));this.getTextWidth(d.substring(0,f),e)<c?b=f:a=f}},getTextWithLimitCharCount:function(d,e,c,b){return!d||0>=d.length?{text:"",truncated:b||!1}:!c||0>=c||d.length<=c?{text:d,truncated:b||!1}:{text:d.substring(0,c)+this.trailingSymbol,truncated:!0}},_plotFill:function(d,f,c){if(!d||!d.type||!d.space)return d;var b=d.space,a;switch(d.type){case "linear":if("plot"===b||"shapeX"===b||"shapeY"===b){d=e.makeParameters(e.defaultLinearGradient,d);d.space=b;if("plot"===b||"shapeX"===b)a=f.height-c.t-
c.b,d.y1=c.t+a*d.y1/100,d.y2=c.t+a*d.y2/100;if("plot"===b||"shapeY"===b)a=f.width-c.l-c.r,d.x1=c.l+a*d.x1/100,d.x2=c.l+a*d.x2/100}break;case "radial":"plot"===b&&(d=e.makeParameters(e.defaultRadialGradient,d),d.space=b,b=f.width-c.l-c.r,f=f.height-c.t-c.b,d.cx=c.l+b*d.cx/100,d.cy=c.t+f*d.cy/100,d.r=d.r*Math.sqrt(b*b+f*f)/200);break;case "pattern":if("plot"===b||"shapeX"===b||"shapeY"===b){d=e.makeParameters(e.defaultPattern,d);d.space=b;if("plot"===b||"shapeX"===b)a=f.height-c.t-c.b,d.y=c.t+a*d.y/
100,d.height=a*d.height/100;if("plot"===b||"shapeY"===b)a=f.width-c.l-c.r,d.x=c.l+a*d.x/100,d.width=a*d.width/100}}return d},_shapeFill:function(d,f){if(!d||!d.space)return d;var c=d.space,b;switch(d.type){case "linear":if("shape"===c||"shapeX"===c||"shapeY"===c){d=e.makeParameters(e.defaultLinearGradient,d);d.space=c;if("shape"===c||"shapeX"===c)b=f.width,d.x1=f.x+b*d.x1/100,d.x2=f.x+b*d.x2/100;if("shape"===c||"shapeY"===c)b=f.height,d.y1=f.y+b*d.y1/100,d.y2=f.y+b*d.y2/100}break;case "radial":"shape"===
c&&(d=e.makeParameters(e.defaultRadialGradient,d),d.space=c,d.cx=f.x+f.width/2,d.cy=f.y+f.height/2,d.r=d.r*f.width/200);break;case "pattern":if("shape"===c||"shapeX"===c||"shapeY"===c){d=e.makeParameters(e.defaultPattern,d);d.space=c;if("shape"===c||"shapeX"===c)b=f.width,d.x=f.x+b*d.x/100,d.width=b*d.width/100;if("shape"===c||"shapeY"===c)b=f.height,d.y=f.y+b*d.y/100,d.height=b*d.height/100}}return d},_pseudoRadialFill:function(d,f,c,b,a){if(!d||"radial"!==d.type||"shape"!==d.space)return d;var g=
d.space;d=e.makeParameters(e.defaultRadialGradient,d);d.space=g;if(4>arguments.length)return d.cx=f.x,d.cy=f.y,d.r=d.r*c/100,d;g=5>arguments.length?b:(a+b)/2;return{type:"linear",x1:f.x,y1:f.y,x2:f.x+d.r*c*Math.cos(g)/100,y2:f.y+d.r*c*Math.sin(g)/100,colors:d.colors}}})})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(m,f,k){f.switchTo(k);return f})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window",
"dojo/_base/config"],function(m,f,k,e,g){var d=null;k.add("vml",function(d,c,b){b.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';d="adj"in b.firstChild;b.innerHTML="";return d});return{load:function(h,c,b){function a(){c(["dojox/gfx/"+l],function(a){m.renderer=l;d=a;b(a)})}if(d&&"force"!=h)b(d);else{var l=g.forceGfxRenderer;h=!l&&(f.isString(g.gfxRenderer)?g.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var n,p;!l&&h.length;)switch(h.shift()){case "svg":"SVGAngle"in e.global&&(l="svg");break;
case "vml":k("vml")&&(l="vml");break;case "silverlight":try{k("ie")?(n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported("1.0"))&&(p=!0):navigator.plugins["Silverlight Plug-In"]&&(p=!0)}catch(q){p=!1}finally{n=null}p&&(l="silverlight");break;case "canvas":e.global.CanvasRenderingContext2D&&(l="canvas")}"canvas"===l&&!1!==g.canvasEvents&&(l="canvasWithEvents");g.isDebug&&console.log("gfx renderer \x3d "+l);"svg"==l&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(a):a()}}}})},
"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(m,f,k,e,g,d,h,c,b,a){function l(a,b){for(var c=a.length-1;b<c;)a[b]=a[++b];a.length=c}var n=m.shape={};n.Shape=k("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(g("gfxRegistry")){var a=
n.register(this);this.getUID=function(){return a}}},destroy:function(){g("gfxRegistry")&&n.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var b=
this.getBoundingBox();if(!b)return null;var c=this._getRealMatrix();return[a.multiplyPoint(c,b.x,b.y),a.multiplyPoint(c,b.x+b.width,b.y),a.multiplyPoint(c,b.x+b.width,b.y+b.height),a.multiplyPoint(c,b.x,b.y+b.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=m.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var b=null;if("object"==
typeof a&&"type"in a)switch(a.type){case "linear":b=m.makeParameters(m.defaultLinearGradient,a);break;case "radial":b=m.makeParameters(m.defaultRadialGradient,a);break;case "pattern":b=m.makeParameters(m.defaultPattern,a)}else b=m.normalizeColor(a);this.fillStyle=b;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||f.isArray(a)||a instanceof b)a={color:a};a=this.strokeStyle=m.makeParameters(m.defaultStroke,a);a.color=m.normalizeColor(a.color);return this},
setTransform:function(b){this.matrix=a.clone(b?a.normalize(b):a.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?
this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&this.parent.remove(this,a);return this},_setParent:function(a,b){this.parent=a;return this._updateParentMatrix(b)},_updateParentMatrix:function(b){this.parentMatrix=b?a.clone(b):null;return this._applyTransform()},_getRealMatrix:function(){for(var b=this.matrix,c=this.parent;c;)c.matrix&&(b=a.multiply(c.matrix,b)),c=c.parent;return b}});n._eventsProcessing=
{on:function(a,b){return d(this.getEventSource(),a,n.fixCallback(this,m.fixTarget,b))},connect:function(a,b,c){"on"==a.substring(0,2)&&(a=a.substring(2));return this.on(a,c?f.hitch(b,c):b)},disconnect:function(a){return a.remove()}};n.fixCallback=function(a,b,c,d){d||(d=c,c=null);if(f.isString(d)){c=c||e.global;if(!c[d])throw['dojox.gfx.shape.fixCallback: scope["',d,'"] is null (scope\x3d"',c,'")'].join("");return function(e){return b(e,a)?c[d].apply(c,arguments||[]):void 0}}return c?function(e){return b(e,
a)?d.apply(c,arguments||[]):void 0}:function(e){return b(e,a)?d.apply(c,arguments):void 0}};f.extend(n.Shape,n._eventsProcessing);n.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var b=a.getParent();b&&b.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,b){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){b||(a.parent=null,a.parentMatrix=
null);l(this.children,c);break}return this},clear:function(a){for(var b,c=0;c<this.children.length;++c)b=this.children[c],b.parent=null,b.parentMatrix=null,a&&b.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var b=null;h.forEach(this.children,function(c){var d=c.getBoundingBox();d&&((c=c.getTransform())&&(d=a.multiplyRectangle(c,d)),b?(b.x=Math.min(b.x,d.x),b.y=Math.min(b.y,d.y),b.endX=Math.max(b.endX,d.x+d.width),b.endY=Math.max(b.endY,d.y+d.height)):b={x:d.x,
y:d.y,endX:d.x+d.width,endY:d.y+d.height})});b&&(b.width=b.endX-b.x,b.height=b.endY-b.y);return b}return null},_moveChildToFront:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){l(this.children,b);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){l(this.children,b);this.children.unshift(a);break}return this}};n.Surface=k("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=
null;this._nodes=[];this._events=[]},destroy:function(){h.forEach(this._nodes,c.destroy);this._nodes=[];h.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;if(g("ie"))for(;this._parent.lastChild;)c.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(a,b){var c=f.hitch(a,b);if(this.isLoaded)c(this);
else d.once(this,"load",function(a){c(a)})}});f.extend(n.Surface,n._eventsProcessing);n.Rect=k("dojox.gfx.shape.Rect",n.Shape,{constructor:function(a){this.shape=m.getDefault("Rect");this.rawNode=a},getBoundingBox:function(){return this.shape}});n.Ellipse=k("dojox.gfx.shape.Ellipse",n.Shape,{constructor:function(a){this.shape=m.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});
n.Circle=k("dojox.gfx.shape.Circle",n.Shape,{constructor:function(a){this.shape=m.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});n.Line=k("dojox.gfx.shape.Line",n.Shape,{constructor:function(a){this.shape=m.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-
a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});n.Polyline=k("dojox.gfx.shape.Polyline",n.Shape,{constructor:function(a){this.shape=m.getDefault("Polyline");this.rawNode=a},setShape:function(a,b){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,b=a&&a.length;if(b&&"number"==typeof a[0]){for(var c=[],d=0;d<b;d+=
2)c.push({x:a[d],y:a[d+1]});this.shape.points=c}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,b=a.length,c=a[0],d=c.x,e=c.y,f=c.x,g=c.y,h=1;h<b;++h)c=a[h],d>c.x&&(d=c.x),f<c.x&&(f=c.x),e>c.y&&(e=c.y),g<c.y&&(g=c.y);this.bbox={x:d,y:e,width:f-d,height:g-e}}return this.bbox}});n.Image=k("dojox.gfx.shape.Image",n.Shape,{constructor:function(a){this.shape=m.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},
setFill:function(){return this}});n.Text=k(n.Shape,{constructor:function(a){this.fontStyle=null;this.shape=m.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},setFont:function(a){this.fontStyle="string"==typeof a?m.splitFontString(a):m.makeParameters(m.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=m._base._computeTextBoundingBox(this));return a}});n.Creator={createShape:function(a){switch(a.type){case m.defaultPath.type:return this.createPath(a);
case m.defaultRect.type:return this.createRect(a);case m.defaultCircle.type:return this.createCircle(a);case m.defaultEllipse.type:return this.createEllipse(a);case m.defaultLine.type:return this.createLine(a);case m.defaultPolyline.type:return this.createPolyline(a);case m.defaultImage.type:return this.createImage(a);case m.defaultText.type:return this.createText(a);case m.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(m.Group)},createRect:function(a){return this.createObject(m.Rect,
a)},createEllipse:function(a){return this.createObject(m.Ellipse,a)},createCircle:function(a){return this.createObject(m.Circle,a)},createLine:function(a){return this.createObject(m.Line,a)},createPolyline:function(a){return this.createObject(m.Polyline,a)},createImage:function(a){return this.createObject(m.Image,a)},createText:function(a){return this.createObject(m.Text,a)},createPath:function(a){return this.createObject(m.Path,a)},createTextPath:function(a){return this.createObject(m.TextPath,{}).setText(a)},
createObject:function(a,b){return null}};return n})},"dojox/charting/SimpleTheme":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/Color dojox/lang/utils dojox/gfx/gradutils".split(" "),function(m,f,k,e,g,d){var h=k("dojox.charting.SimpleTheme",null,{shapeSpaces:{shape:1,shapeX:1,shapeY:1},constructor:function(c){c=c||{};var b=h.defaultTheme;f.forEach("chart plotarea axis grid series marker indicator".split(" "),function(a){this[a]=m.delegate(b[a],c[a])},this);c.seriesThemes&&
c.seriesThemes.length?(this.colors=null,this.seriesThemes=c.seriesThemes.slice(0)):(this.seriesThemes=null,this.colors=(c.colors||h.defaultColors).slice(0));this.markerThemes=null;c.markerThemes&&c.markerThemes.length&&(this.markerThemes=c.markerThemes.slice(0));this.markers=c.markers?m.clone(c.markers):m.delegate(h.defaultMarkers);this.noGradConv=c.noGradConv;this.noRadialConv=c.noRadialConv;c.reverseFills&&this.reverseFills();this._current=0;this._buildMarkerArray()},clone:function(){var c=new this.constructor({chart:this.chart,
plotarea:this.plotarea,axis:this.axis,grid:this.grid,series:this.series,marker:this.marker,colors:this.colors,markers:this.markers,indicator:this.indicator,seriesThemes:this.seriesThemes,markerThemes:this.markerThemes,noGradConv:this.noGradConv,noRadialConv:this.noRadialConv,pieInnerRadius:this.pieInnerRadius});f.forEach("clone clear next skip addMixin post getTick".split(" "),function(b){this.hasOwnProperty(b)&&(c[b]=this[b])},this);return c},clear:function(){this._current=0},next:function(c,b,a){var d=
g.merge,f;if(this.colors){f=m.delegate(this.series);var d=m.delegate(this.marker),h=new e(this.colors[this._current%this.colors.length]),k;f.stroke&&f.stroke.color?(f.stroke=m.delegate(f.stroke),k=new e(f.stroke.color),f.stroke.color=new e(h),f.stroke.color.a=k.a):f.stroke={color:h};d.stroke&&d.stroke.color?(d.stroke=m.delegate(d.stroke),k=new e(d.stroke.color),d.stroke.color=new e(h),d.stroke.color.a=k.a):d.stroke={color:h};!f.fill||f.fill.type?f.fill=h:(k=new e(f.fill),f.fill=new e(h),f.fill.a=
k.a);!d.fill||d.fill.type?d.fill=h:(k=new e(d.fill),d.fill=new e(h),d.fill.a=k.a)}else f=this.seriesThemes?d(this.series,this.seriesThemes[this._current%this.seriesThemes.length]):this.series,d=this.markerThemes?d(this.marker,this.markerThemes[this._current%this.markerThemes.length]):f;f={series:f,marker:d,symbol:d&&d.symbol||this._markers[this._current%this._markers.length]};++this._current;b&&(f=this.addMixin(f,c,b));a&&(f=this.post(f,c));return f},skip:function(){++this._current},addMixin:function(c,
b,a,d){if(m.isArray(a))f.forEach(a,function(a){c=this.addMixin(c,b,a)},this);else{var e={};"color"in a&&("line"==b||"area"==b?(m.setObject("series.stroke.color",a.color,e),m.setObject("marker.stroke.color",a.color,e)):m.setObject("series.fill",a.color,e));f.forEach("stroke outline shadow fill filter font fontColor labelWiring".split(" "),function(b){var c="marker"+b.charAt(0).toUpperCase()+b.substr(1),d=c in a;b in a&&(m.setObject("series."+b,a[b],e),d||m.setObject("marker."+b,a[b],e));d&&m.setObject("marker."+
b,a[c],e)});"marker"in a&&(e.symbol=a.marker,e.symbol=a.marker);c=g.merge(c,e)}d&&(c=this.post(c,b));return c},post:function(c,b){var a=c.series.fill,d;return!this.noGradConv&&this.shapeSpaces[a.space]&&"linear"==a.type&&("bar"==b?d={x1:a.y1,y1:a.x1,x2:a.y2,y2:a.x2}:this.noRadialConv||"shape"!=a.space||"slice"!=b&&"circle"!=b||(d={type:"radial",cx:0,cy:0,r:100}),d)?g.merge(c,{series:{fill:d}}):c},getTick:function(c,b){var a=this.axis.tick;c+="Tick";var d=g.merge;a?this.axis[c]&&(a=d(a,this.axis[c])):
a=this.axis[c];b&&(a?b[c]&&(a=d(a,b[c])):a=b[c]);return a},inspectObjects:function(c){f.forEach("chart plotarea axis grid series marker indicator".split(" "),function(b){c(this[b])},this);this.seriesThemes&&f.forEach(this.seriesThemes,c);this.markerThemes&&f.forEach(this.markerThemes,c)},reverseFills:function(){this.inspectObjects(function(c){c&&c.fill&&(c.fill=d.reverse(c.fill))})},addMarker:function(c,b){this.markers[c]=b;this._buildMarkerArray()},setMarkers:function(c){this.markers=c;this._buildMarkerArray()},
_buildMarkerArray:function(){this._markers=[];for(var c in this.markers)this._markers.push(this.markers[c])}});m.mixin(h,{defaultMarkers:{CIRCLE:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",SQUARE:"m-3,-3 l0,6 6,0 0,-6 z",DIAMOND:"m0,-3 l3,3 -3,3 -3,-3 z",CROSS:"m0,-3 l0,6 m-3,-3 l6,0",X:"m-3,-3 l6,6 m0,-6 l-6,6",TRIANGLE:"m-3,3 l3,-6 3,6 z",TRIANGLE_INVERTED:"m-3,-3 l3,6 3,-6 z"},defaultColors:["#54544c","#858e94","#6e767a","#948585","#474747"],defaultTheme:{chart:{stroke:null,fill:"white",pageStyle:null,
titleGap:20,titlePos:"top",titleFont:"normal normal bold 14pt Tahoma",titleFontColor:"#333",titleAlign:"middle"},plotarea:{stroke:null,fill:"white"},axis:{stroke:{color:"#333",width:1},tick:{color:"#666",position:"center",font:"normal normal normal 7pt Tahoma",fontColor:"#333",labelGap:4},majorTick:{width:1,length:6},minorTick:{width:.8,length:3},microTick:{width:.5,length:1},title:{gap:15,font:"normal normal normal 11pt Tahoma",fontColor:"#333",orientation:"axis"}},series:{stroke:{width:1.5,color:"#333"},
outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",font:"normal normal normal 8pt Tahoma",fontColor:"#000",labelWiring:{width:1,color:"#ccc"}},marker:{stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",font:"normal normal normal 8pt Tahoma",fontColor:"#000"},indicator:{lineStroke:{width:1.5,color:"#333"},lineOutline:{width:.1,color:"#ccc"},lineShadow:null,lineFill:null,stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",
radius:3,font:"normal normal normal 10pt Tahoma",fontColor:"#000",markerFill:"#ccc",markerSymbol:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",markerStroke:{width:1.5,color:"#333"},markerOutline:{width:.1,color:"#ccc"},markerShadow:null}}});return h})},"dojox/lang/utils":function(){define(["..","dojo/_base/lang"],function(m,f){var k=f.getObject("lang.utils",!0,m),e={},g=Object.prototype.toString,d=function(d){if(d)switch(g.call(d)){case "[object Array]":return d.slice(0);case "[object Object]":return f.delegate(d)}return d};
f.mixin(k,{coerceType:function(d,c){switch(typeof d){case "number":return Number(eval("("+c+")"));case "string":return String(c);case "boolean":return!!eval("("+c+")")}return eval("("+c+")")},updateWithObject:function(f,c,b){if(!c)return f;for(var a in f)if(a in c&&!(a in e)){var g=f[a];g&&"object"==typeof g?k.updateWithObject(g,c[a],b):f[a]=b?k.coerceType(g,c[a]):d(c[a])}return f},updateWithPattern:function(f,c,b,a){if(!c||!b)return f;for(var g in b)g in c&&!(g in e)&&(f[g]=a?k.coerceType(b[g],c[g]):
d(c[g]));return f},merge:function(d,c){if(c){var b=g.call(d),a=g.call(c),e,h;switch(a){case "[object Array]":if(a==b){b=Array(Math.max(d.length,c.length));e=0;for(a=b.length;e<a;++e)b[e]=k.merge(d[e],c[e]);return b}return c.slice(0);case "[object Object]":if(a==b&&d){b=f.delegate(d);for(e in c)e in d?(a=d[e],h=c[e],h!==a&&(b[e]=k.merge(a,h))):b[e]=f.clone(c[e]);return b}return f.clone(c)}}return c}});return k})},"dojox/gfx/gradutils":function(){define(["./_base","dojo/_base/lang","./matrix","dojo/_base/Color"],
function(m,f,k,e){function g(d,f){if(0>=d)return f[0].color;var c=f.length;if(1<=d)return f[c-1].color;for(var b=0;b<c;++b){var a=f[b];if(a.offset>=d)return b?(f=f[b-1],e.blendColors(new e(f.color),new e(a.color),(d-f.offset)/(a.offset-f.offset))):a.color}return f[c-1].color}m=m.gradutils={};m.getColor=function(d,f){var c;if(d){switch(d.type){case "linear":c=k.rotate(-Math.atan2(d.y2-d.y1,d.x2-d.x1));var b=k.project(d.x2-d.x1,d.y2-d.y1);f=k.multiplyPoint(b,f);var a=k.multiplyPoint(b,d.x1,d.y1),b=
k.multiplyPoint(b,d.x2,d.y2),b=k.multiplyPoint(c,b.x-a.x,b.y-a.y).x;c=k.multiplyPoint(c,f.x-a.x,f.y-a.y).x/b;break;case "radial":c=f.x-d.cx,f=f.y-d.cy,c=Math.sqrt(c*c+f*f)/d.r}return g(c,d.colors)}return new e(d||[0,0,0,0])};m.reverse=function(d){if(d)switch(d.type){case "linear":case "radial":if(d=f.delegate(d),d.colors){for(var e=d.colors,c=e.length,b=0,a,g=d.colors=Array(e.length);b<c;++b)a=e[b],g[b]={offset:1-a.offset,color:a.color};g.sort(function(a,b){return a.offset-b.offset})}}return d};return m})},
"dojox/charting/Series":function(){define(["dojo/_base/lang","dojo/_base/declare","./Element"],function(m,f,k){return f("dojox.charting.Series",k,{constructor:function(e,f,d){m.mixin(this,d);"string"!=typeof this.plot&&(this.plot="default");this.update(f)},clear:function(){this.dyn={}},update:function(e){m.isArray(e)?this.data=e:(this.source=e,this.data=this.source.data,this.source.setSeriesObject&&this.source.setSeriesObject(this));this.dirty=!0;this.clear()}})})},"dojox/charting/axis2d/common":function(){define(["dojo/_base/lang",
"dojo/_base/window","dojo/dom-geometry","dojox/gfx","dojo/has"],function(m,f,k,e,g){var d=m.getObject("dojox.charting.axis2d.common",!0),h=function(c){c.marginLeft="0px";c.marginTop="0px";c.marginRight="0px";c.marginBottom="0px";c.paddingLeft="0px";c.paddingTop="0px";c.paddingRight="0px";c.paddingBottom="0px";c.borderLeftWidth="0px";c.borderTopWidth="0px";c.borderRightWidth="0px";c.borderBottomWidth="0px"};return m.mixin(d,{createText:{gfx:function(c,b,a,d,e,f,g,h){return b.createText({x:a,y:d,text:f,
align:e}).setFont(g).setFill(h)},html:function(c,b,a,d,m,p,q,r,t){b=f.doc.createElement("div");var l=b.style,n;c.getTextDir&&(b.dir=c.getTextDir(p));h(l);l.font=q;b.innerHTML=String(p).replace(/\s/g,"\x26nbsp;");l.color=r;l.position="absolute";l.left="-10000px";f.body().appendChild(b);var x=e.normalizedLength(e.splitFontString(q).size);t||(b.getBoundingClientRect?(n=b.getBoundingClientRect(),n=n.width||n.right-n.left):n=k.getMarginBox(b).w);"rtl"==b.dir&&(a+=t?t:n);f.body().removeChild(b);l.position=
"relative";if(t)switch(l.width=t+"px",m){case "middle":l.textAlign="center";l.left=a-t/2+"px";break;case "end":l.textAlign="right";l.left=a-t+"px";break;default:l.left=a+"px",l.textAlign="left"}else switch(m){case "middle":l.left=Math.floor(a-n/2)+"px";break;case "end":l.left=Math.floor(a-n)+"px";break;default:l.left=Math.floor(a)+"px"}l.top=Math.floor(d-x)+"px";l.whiteSpace="nowrap";t=f.doc.createElement("div");l=t.style;h(l);l.width="0px";l.height="0px";t.appendChild(b);c.node.insertBefore(t,c.node.firstChild);
g("dojo-bidi")&&c.htmlElementsRegistry.push([t,a,d,m,p,q,r]);return t}}})})},"dojox/lang/functional/reversed":function(){define(["dojo/_base/lang","dojo/_base/kernel","./lambda"],function(m,f,k){m.mixin(k,{filterRev:function(e,g,d){"string"==typeof e&&(e=e.split(""));d=d||f.global;g=k.lambda(g);for(var h=[],c,b=e.length-1;0<=b;--b)c=e[b],g.call(d,c,b,e)&&h.push(c);return h},forEachRev:function(e,g,d){"string"==typeof e&&(e=e.split(""));d=d||f.global;g=k.lambda(g);for(var h=e.length-1;0<=h;g.call(d,
e[h],h,e),--h);},mapRev:function(e,g,d){"string"==typeof e&&(e=e.split(""));d=d||f.global;g=k.lambda(g);for(var h=e.length,c=Array(h),h=h-1,b=0;0<=h;c[b++]=g.call(d,e[h],h,e),--h);return c},everyRev:function(e,g,d){"string"==typeof e&&(e=e.split(""));d=d||f.global;g=k.lambda(g);for(var h=e.length-1;0<=h;--h)if(!g.call(d,e[h],h,e))return!1;return!0},someRev:function(e,g,d){"string"==typeof e&&(e=e.split(""));d=d||f.global;g=k.lambda(g);for(var h=e.length-1;0<=h;--h)if(g.call(d,e[h],h,e))return!0;return!1}});
return k})},"dojox/charting/axis2d/Default":function(){define("dojo/_base/lang dojo/_base/array dojo/sniff dojo/_base/declare dojo/_base/connect dojo/dom-geometry ./Invisible ../scaler/linear ./common dojox/gfx dojox/lang/utils dojox/lang/functional dojo/has!dojo-bidi?../bidi/axis2d/Default".split(" "),function(m,f,k,e,g,d,h,c,b,a,l,n,p){h=e(k("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",h,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,
leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1,position:"leftOrBottom"},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},
constructor:function(a,b){this.opt=m.clone(this.defaultParams);l.updateWithObject(this.opt,b);l.updateWithPattern(this.opt,b,this.optionalParams);this.opt.enableCache&&(this._textFreePool=[],this._lineFreePool=[],this._textUsePool=[],this._lineUsePool=[]);this._invalidMaxLabelSize=!0;b&&"position"in b||(this.opt.position=this.opt.leftBottom?"leftOrBottom":"rightOrTop");this.renderingOptions={"shape-rendering":"crispEdges"}},setWindow:function(a,b){a!=this.scale&&(this._invalidMaxLabelSize=!0);return this.inherited(arguments)},
_groupLabelWidth:function(b,c,d){if(!b.length)return 0;50<b.length&&(b.length=50);m.isObject(b[0])&&(b=n.map(b,function(a){return a.text}));d&&(b=n.map(b,function(a){return 0==m.trim(a).length?"":a.substring(0,d)+this.trailingSymbol},this));b=b.join("\x3cbr\x3e");return a._base._getTextBox(b,{font:c}).w||0},_getMaxLabelSize:function(a,b,d,e,g,h){if(null==this._maxLabelSize&&6==arguments.length){var l=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var k=m.clone(l);delete k.to;delete k.from;
var n=c.buildScaler(a,b,d,k,l.to-l.from);n.minMinorStep=0;this._majorStart=n.major.start;l=c.buildTicks(n,l);if(h&&l){var p=n=0,q=function(a){a.label&&this.push(a.label)},r=[];this.opt.majorLabels&&(f.forEach(l.major,q,r),n=this._groupLabelWidth(r,g,k.maxLabelCharCount),k.maxLabelSize&&(n=Math.min(k.maxLabelSize,n)));r=[];this.opt.dropLabels&&this.opt.minorLabels&&(f.forEach(l.minor,q,r),p=this._groupLabelWidth(r,g,k.maxLabelCharCount),k.maxLabelSize&&(p=Math.min(k.maxLabelSize,p)));this._maxLabelSize=
{majLabelW:n,minLabelW:p,majLabelH:h,minLabelH:h}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(b,d,e){this.inherited(arguments);this.scaler.minMinorStep=this._prevMinMinorStep;if((this._invalidMaxLabelSize||e!=this._oldSpan)&&Infinity!=b&&-Infinity!=d){this._invalidMaxLabelSize=!1;this.opt.labelSizeChange&&(this._maxLabelSize=null);this._oldSpan=e;var f=this.opt,g=this.chart.theme.axis,h=f.rotation%360,l=this.chart.theme.axis.tick.labelGap,k=f.font||g.majorTick&&g.majorTick.font||
g.tick&&g.tick.font,g=k?a.normalizedLength(a.splitFontString(k).size):0,k=this._getMaxLabelSize(b,d,e,h,k,g);"number"!=typeof l&&(l=4);if(k&&f.dropLabels){var f=Math.abs(Math.cos(h*Math.PI/180)),m=Math.abs(Math.sin(h*Math.PI/180));0>h&&(h+=360);switch(h){case 0:case 180:this.vertical?h=g:(h=k.majLabelW,g=k.minLabelW);break;case 90:case 270:this.vertical?(h=k.majLabelW,g=k.minLabelW):h=g;break;default:h=this.vertical?Math.min(k.majLabelW,g/f):Math.min(k.majLabelW,g/m),g=Math.min(Math.sqrt(k.minLabelW*
k.minLabelW+g*g),this.vertical?g*f+k.minLabelW*m:k.minLabelW*f+g*m)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(h,g)+l;this._skipInterval=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale?0:Math.floor((h+l)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}this.ticks=c.buildTicks(this.scaler,this.opt);return this},getOffsets:function(){var b={l:0,r:0,t:0,b:0};if(!this.scaler)return b;var c=this.opt,d=this.chart.theme.axis,e=this.chart.theme.axis.tick.labelGap,
f=c.titleFont||d.title&&d.title.font,d=0==c.titleGap?0:c.titleGap||d.title&&d.title.gap,g=this.chart.theme.getTick("major",c),h=this.chart.theme.getTick("minor",c),f=f?a.normalizedLength(a.splitFontString(f).size):0,l=c.rotation%360,k=c.position,m="rightOrTop"!==k,n=Math.abs(Math.cos(l*Math.PI/180)),p=Math.abs(Math.sin(l*Math.PI/180));this.trailingSymbol=void 0===c.trailingSymbol||null===c.trailingSymbol?this.trailingSymbol:c.trailingSymbol;"number"!=typeof e&&(e=4);0>l&&(l+=360);var E=this._getMaxLabelSize();
if(E){var D=Math.ceil(Math.max(E.majLabelW,E.minLabelW))+1,F=Math.ceil(Math.max(E.majLabelH,E.minLabelH))+1;if(this.vertical)switch(E=m?"l":"r",l){case 0:case 180:b[E]="center"===k?0:D;b.t=b.b=F/2;break;case 90:case 270:b[E]=F;b.t=b.b=D/2;break;default:45>=l||180<l&&225>=l?(b[E]=F*p/2+D*n,b[m?"t":"b"]=F*n/2+D*p,b[m?"b":"t"]=F*n/2):315<l||180>l&&135<l?(b[E]=F*p/2+D*n,b[m?"b":"t"]=F*n/2+D*p,b[m?"t":"b"]=F*n/2):90>l||180<l&&270>l?(b[E]=F*p+D*n,b[m?"t":"b"]=F*n+D*p):(b[E]=F*p+D*n,b[m?"b":"t"]=F*n+D*p)}else switch(E=
m?"b":"t",l){case 0:case 180:b[E]="center"===k?0:F;b.l=b.r=D/2;break;case 90:case 270:b[E]=D;b.l=b.r=F/2;break;default:45<=l&&90>=l||225<=l&&270>=l?(b[E]=F*n/2+D*p,b[m?"r":"l"]=F*p/2+D*n,b[m?"l":"r"]=F*p/2):90<=l&&135>=l||270<=l&&315>=l?(b[E]=F*n/2+D*p,b[m?"l":"r"]=F*p/2+D*n,b[m?"r":"l"]=F*p/2):45>l||180<l&&225>l?(b[E]=F*n+D*p,b[m?"r":"l"]=F*p+D*n):(b[E]=F*n+D*p,b[m?"l":"r"]=F*p+D*n)}b[E]="center"===k?0:b[E]+(e+Math.max(0<g.length?g.length:0,0<h.length?h.length:0)+(c.title?f+d:0))}return b},cleanGroup:function(a){this.opt.enableCache&&
this.group&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._textFreePool=this._textFreePool.concat(this._textUsePool),this._textUsePool=[]);this.inherited(arguments)},createText:function(a,c,d,e,f,g,h,l,k){if(!this.opt.enableCache||"html"==a)return b.createText[a](this.chart,c,d,e,f,g,h,l,k);0<this._textFreePool.length?(a=this._textFreePool.pop(),a.setShape({x:d,y:e,text:g,align:f}),c.add(a)):a=b.createText[a](this.chart,c,d,e,f,g,h,l);this._textUsePool.push(a);
return a},createLine:function(a,b){var c;this.opt.enableCache&&0<this._lineFreePool.length?(c=this._lineFreePool.pop(),c.setShape(b),a.add(c)):c=a.createLine(b);this.opt.enableCache&&this._lineUsePool.push(c);return c},render:function(d,e){var g,h,l,m,n,p,q,r,B,C,E,D,F,M,N=this._isRtl();if(!this.dirty||!this.scaler)return this;var I=this.opt;B=this.chart.theme.axis;var G=I.position,O="rightOrTop"!==G,J=I.rotation%360,Q=0,H,K,Q=this.chart.theme.axis.tick.labelGap,R=I.font||B.majorTick&&B.majorTick.font||
B.tick&&B.tick.font,P=I.titleFont||B.title&&B.title.font,L=I.fontColor||B.majorTick&&B.majorTick.fontColor||B.tick&&B.tick.fontColor||"black",T=I.titleFontColor||B.title&&B.title.fontColor||"black";n=0==I.titleGap?0:I.titleGap||B.title&&B.title.gap||15;var S=I.titleOrientation||B.title&&B.title.orientation||"axis",W=this.chart.theme.getTick("major",I),Y=this.chart.theme.getTick("minor",I),X=this.chart.theme.getTick("micro",I),aa="stroke"in I?I.stroke:B.stroke,U=R?a.normalizedLength(a.splitFontString(R).size):
0;p=Math.abs(Math.cos(J*Math.PI/180));H=Math.abs(Math.sin(J*Math.PI/180));var ha=P?a.normalizedLength(a.splitFontString(P).size):0;"number"!=typeof Q&&(Q=4);0>J&&(J+=360);var Z=this._getMaxLabelSize(),Z=Z&&Z.majLabelW;if(this.vertical){F=d.height-e.b;M=void 0;E=e.t;D=void 0;B=(d.height-e.b+e.t)/2;C=void 0;H=U*H+(Z||0)*p+Q+Math.max(0<W.length?W.length:0,0<Y.length?Y.length:0)+ha+n;q=0;r=-1;h=g=0;n=1;p=0;l=Q;m=0;switch(J){case 0:K="end";h=.4*U;break;case 90:K="middle";g=-U;break;case 180:K="start";
h=.4*-U;break;case 270:K="middle";break;default:45>J?(K="end",h=.4*U):90>J?(K="end",h=.4*U):135>J?K="start":225>J?(K="start",h=.4*-U):270>J?(K="start",g=O?0:.4*U):315>J?(K="end",g=O?0:.4*U):(K="end",h=.4*U)}if(O)M=D="center"===G?d.width/2:e.l,Q=S&&"away"==S?90:270,C=e.l-H+(270==Q?ha:0),n=-1,l=-l;else switch(M=D=d.width-e.r,Q=S&&"axis"==S?90:270,C=d.width-e.r+H-(270==Q?0:ha),K){case "start":K="end";break;case "end":K="start";break;case "middle":g+=U}}else{M=e.l;F=void 0;D=d.width-e.r;E=void 0;C=(d.width-
e.r+e.l)/2;B=void 0;H=U*p+(Z||0)*H+Q+Math.max(0<W.length?W.length:0,0<Y.length?Y.length:0)+ha+n;q=N?-1:1;n=h=g=r=0;p=1;l=0;m=Q;switch(J){case 0:K="middle";h=U;break;case 90:K="start";g=.4*-U;break;case 180:K="middle";break;case 270:K="end";g=.4*U;break;default:45>J?(K="start",h=O?U:0):135>J?(K="start",g=.4*-U):180>J?(K="start",h=O?0:-U):225>J?(K="end",h=O?0:-U):315>J?(K="end",h=O?.4*U:0):(K="end",h=O?U:0)}if(O)F=E="center"===G?d.height/2:d.height-e.b,Q=S&&"axis"==S?180:0,B=d.height-e.b+H-(Q?ha:0);
else switch(F=E=e.t,Q=S&&"away"==S?180:0,B=e.t-H+(Q?0:ha),p=-1,m=-m,K){case "start":K="end";break;case "end":K="start";break;case "middle":h-=U}}this.cleanGroup();var ba=this.group;d=this.scaler;e=this.ticks;var ka=c.getTransformerFromModel(this.scaler),ga=I.title&&Q||J||!this.opt.htmlLabels||k("ie")||k("opera")?"gfx":"html",ia=n*W.length,na=p*W.length,wa=this._skipInterval;ba.createLine({x1:M,y1:F,x2:D,y2:E}).setStroke(aa);I.title&&(P=b.createText[ga](this.chart,ba,C,B,"middle",I.title,P,T),"html"==
ga?this.htmlElements.push(P):P.setTransform(a.matrix.rotategAt(Q,C,B)));if(null==e)return this.dirty=!1,this;var za=0<e.major.length?(e.major[0].value-this._majorStart)/d.major.tick:0,Aa=this.opt.majorLabels;f.forEach(e.major,function(b,c){var d=ka(b.value),e=(N?D:M)+q*d,d=F+r*d;c+=za;this.createLine(ba,{x1:e,y1:d,x2:e+ia,y2:d+na}).setStroke(W);if(b.label&&(!wa||0==(c-(1+wa))%(1+wa))){var f=I.maxLabelCharCount?this.getTextWithLimitCharCount(b.label,R,I.maxLabelCharCount):{text:b.label,truncated:!1},
f=I.maxLabelSize?this.getTextWithLimitLength(f.text,R,I.maxLabelSize,f.truncated):f;c=this.createText(ga,ba,e+(0<W.length?ia:0)+l+(J?0:g),d+(0<W.length?na:0)+m+(J?0:h),K,f.text,R,L);f.truncated&&this.chart.formatTruncatedLabel(c,b.label,ga);f.truncated&&this.labelTooltip(c,this.chart,b.label,f.text,R,ga);"html"==ga?this.htmlElements.push(c):J&&c.setTransform([{dx:g,dy:h},a.matrix.rotategAt(J,e+(0<W.length?ia:0)+l,d+(0<W.length?na:0)+m)])}},this);ia=n*Y.length;na=p*Y.length;Aa=this.opt.minorLabels&&
d.minMinorStep<=d.minor.tick*d.bounds.scale;f.forEach(e.minor,function(b){var c=ka(b.value),d=(N?D:M)+q*c,e=F+r*c;this.createLine(ba,{x1:d,y1:e,x2:d+ia,y2:e+na}).setStroke(Y);if(Aa&&b.label){var f=I.maxLabelCharCount?this.getTextWithLimitCharCount(b.label,R,I.maxLabelCharCount):{text:b.label,truncated:!1},f=I.maxLabelSize?this.getTextWithLimitLength(f.text,R,I.maxLabelSize,f.truncated):f,c=this.createText(ga,ba,d+(0<Y.length?ia:0)+l+(J?0:g),e+(0<Y.length?na:0)+m+(J?0:h),K,f.text,R,L);f.truncated&&
this.chart.formatTruncatedLabel(c,b.label,ga);f.truncated&&this.labelTooltip(c,this.chart,b.label,f.text,R,ga);"html"==ga?this.htmlElements.push(c):J&&c.setTransform([{dx:g,dy:h},a.matrix.rotategAt(J,d+(0<Y.length?ia:0)+l,e+(0<Y.length?na:0)+m)])}},this);ia=n*X.length;na=p*X.length;f.forEach(e.micro,function(a){var b=ka(a.value);a=M+q*b;b=F+r*b;this.createLine(ba,{x1:a,y1:b,x2:a+ia,y2:b+na}).setStroke(X)},this);this.dirty=!1;return this},labelTooltip:function(b,c,e,f,h,l){var k=["dijit/Tooltip"],
n={type:"rect"},p=["above","below"];f=a._base._getTextBox(f,{font:h}).w||0;h=h?a.normalizedLength(a.splitFontString(h).size):0;"html"==l?(m.mixin(n,d.position(b.firstChild,!0)),n.width=Math.ceil(f),n.height=Math.ceil(h),this._events.push({shape:dojo,handle:g.connect(b.firstChild,"onmouseover",this,function(a){require(k,function(a){a.show(e,n,p)})})}),this._events.push({shape:dojo,handle:g.connect(b.firstChild,"onmouseout",this,function(a){require(k,function(a){a.hide(n)})})})):(l=b.getShape(),c=c.getCoords(),
n=m.mixin(n,{x:l.x-f/2,y:l.y}),n.x+=c.x,n.y+=c.y,n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=Math.ceil(f),n.height=Math.ceil(h),this._events.push({shape:b,handle:b.connect("onmouseenter",this,function(a){require(k,function(a){a.show(e,n,p)})})}),this._events.push({shape:b,handle:b.connect("onmouseleave",this,function(a){require(k,function(a){a.hide(n)})})}))},_isRtl:function(){return!1}});return k("dojo-bidi")?e("dojox.charting.axis2d.Default",[h,p]):h})},"dojox/charting/axis2d/Invisible":function(){define(["dojo/_base/lang",
"dojo/_base/declare","./Base","../scaler/linear","dojox/lang/utils"],function(m,f,k,e,g){return f("dojox.charting.axis2d.Invisible",k,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1},constructor:function(d,e){this.opt=m.clone(this.defaultParams);g.updateWithObject(this.opt,e);g.updateWithPattern(this.opt,e,this.optionalParams)},dependOnData:function(){return!("min"in
this.opt)||!("max"in this.opt)},clear:function(){delete this.scaler;delete this.ticks;this.dirty=!0;return this},initialized:function(){return"scaler"in this&&!(this.dirty&&this.dependOnData())},setWindow:function(d,e){this.scale=d;this.offset=e;return this.clear()},getWindowScale:function(){return"scale"in this?this.scale:1},getWindowOffset:function(){return"offset"in this?this.offset:0},calculate:function(d,f,c,b){if(this.initialized())return this;var a=this.opt;this.labels=a.labels;this.scaler=
(b||e).buildScaler(d,f,c,a);var g=this.scaler.bounds;"scale"in this&&(a.from=g.lower+this.offset,a.to=(g.upper-g.lower)/this.scale+a.from,!isFinite(a.from)||isNaN(a.from)||!isFinite(a.to)||isNaN(a.to)||a.to-a.from>=g.upper-g.lower?(delete a.from,delete a.to,delete this.scale,delete this.offset):(a.from<g.lower?(a.to+=g.lower-a.from,a.from=g.lower):a.to>g.upper&&(a.from+=g.upper-a.to,a.to=g.upper),this.offset=a.from-g.lower),this.scaler=(b||e).buildScaler(d,f,c,a),g=this.scaler.bounds,1==this.scale&&
0==this.offset&&(delete this.scale,delete this.offset));return this},getScaler:function(){return this.scaler},getTicks:function(){return this.ticks}})})},"dojox/charting/axis2d/Base":function(){define(["dojo/_base/declare","../Element"],function(m,f){return m("dojox.charting.axis2d.Base",f,{constructor:function(f,e){this.vertical=e&&e.vertical;this.opt={};this.opt.min=e&&e.min;this.opt.max=e&&e.max},clear:function(){return this},initialized:function(){return!1},calculate:function(f,e,g){return this},
getScaler:function(){return null},getTicks:function(){return null},getOffsets:function(){return{l:0,r:0,t:0,b:0}},render:function(f,e){this.dirty=!1;return this},isNullValue:function(f){return!1},naturalBaseline:0})})},"dojox/charting/scaler/linear":function(){define(["dojo/_base/lang","./common"],function(m,f){function k(d,c){d=d.toLowerCase();for(var b=c.length-1;0<=b;--b)if(d===c[b])return!0;return!1}var e=m.getObject("dojox.charting.scaler.linear",!0),g=f.getNumericLabel,d=function(d,c,b,a,f,
g,p){b=m.delegate(b);a||("major"==b.fixUpper&&(b.fixUpper="minor"),"major"==b.fixLower&&(b.fixLower="minor"));f||("minor"==b.fixUpper&&(b.fixUpper="micro"),"minor"==b.fixLower&&(b.fixLower="micro"));g||("micro"==b.fixUpper&&(b.fixUpper="none"),"micro"==b.fixLower&&(b.fixLower="none"));var h=k(b.fixLower,["major"])?Math.floor(b.min/a)*a:k(b.fixLower,["minor"])?Math.floor(b.min/f)*f:k(b.fixLower,["micro"])?Math.floor(b.min/g)*g:b.min,l=k(b.fixUpper,["major"])?Math.ceil(b.max/a)*a:k(b.fixUpper,["minor"])?
Math.ceil(b.max/f)*f:k(b.fixUpper,["micro"])?Math.ceil(b.max/g)*g:b.max;b.useMin&&(d=h);b.useMax&&(c=l);var n=!a||b.useMin&&k(b.fixLower,["major"])?d:Math.ceil(d/a)*a,w=!f||b.useMin&&k(b.fixLower,["major","minor"])?d:Math.ceil(d/f)*f,u=!g||b.useMin&&k(b.fixLower,["major","minor","micro"])?d:Math.ceil(d/g)*g,x=a?(b.useMax&&k(b.fixUpper,["major"])?Math.round((c-n)/a):Math.floor((c-n)/a))+1:0,v=f?(b.useMax&&k(b.fixUpper,["major","minor"])?Math.round((c-w)/f):Math.floor((c-w)/f))+1:0;b=g?(b.useMax&&k(b.fixUpper,
["major","minor","micro"])?Math.round((c-u)/g):Math.floor((c-u)/g))+1:0;var z=f?Math.round(a/f):0,y=g?Math.round(f/g):0,A=a?Math.floor(Math.log(a)/Math.LN10):0,B=f?Math.floor(Math.log(f)/Math.LN10):0,C=p/(c-d);isFinite(C)||(C=1);return{bounds:{lower:h,upper:l,from:d,to:c,scale:C,span:p},major:{tick:a,start:n,count:x,prec:A},minor:{tick:f,start:w,count:v,prec:B},micro:{tick:g,start:u,count:b,prec:0},minorPerMajor:z,microPerMinor:y,scaler:e}};return m.mixin(e,{buildScaler:function(e,c,b,a,f,g){var h=
{fixUpper:"none",fixLower:"none",natural:!1};a&&("fixUpper"in a&&(h.fixUpper=String(a.fixUpper)),"fixLower"in a&&(h.fixLower=String(a.fixLower)),"natural"in a&&(h.natural=!!a.natural));g=!g||3>g?3:g;"min"in a&&(e=a.min);"max"in a&&(c=a.max);a.includeZero&&(0<e&&(e=0),0>c&&(c=0));h.min=e;h.useMin=!0;h.max=c;h.useMax=!0;"from"in a&&(e=a.from,h.useMin=!1);"to"in a&&(c=a.to,h.useMax=!1);if(c<=e)return d(e,c,h,0,0,0,b);f||(f=c-e);f=Math.floor(Math.log(f)/Math.LN10);f=a&&"majorTickStep"in a?a.majorTickStep:
Math.pow(10,f);var l=0,k=0,m;if(a&&"minorTickStep"in a)l=a.minorTickStep;else{do{l=f/10;if(!h.natural||.9<l)if(m=d(e,c,h,f,l,0,b),m.bounds.scale*m.minor.tick>g)break;l=f/5;if(!h.natural||.9<l)if(m=d(e,c,h,f,l,0,b),m.bounds.scale*m.minor.tick>g)break;l=f/2;if(!h.natural||.9<l)if(m=d(e,c,h,f,l,0,b),m.bounds.scale*m.minor.tick>g)break;return d(e,c,h,f,0,0,b)}while(0)}if(a&&"microTickStep"in a)k=a.microTickStep,m=d(e,c,h,f,l,k,b);else{do{k=l/10;if(!h.natural||.9<k)if(m=d(e,c,h,f,l,k,b),3<m.bounds.scale*
m.micro.tick)break;k=l/5;if(!h.natural||.9<k)if(m=d(e,c,h,f,l,k,b),3<m.bounds.scale*m.micro.tick)break;k=l/2;if(!h.natural||.9<k)if(m=d(e,c,h,f,l,k,b),3<m.bounds.scale*m.micro.tick)break;k=0}while(0)}return k?m:d(e,c,h,f,l,0,b)},buildTicks:function(d,c){var b,a,e,f=d.major.start,h=d.minor.start,k=d.micro.start;if(c.microTicks&&d.micro.tick)b=d.micro.tick,a=k;else if(c.minorTicks&&d.minor.tick)b=d.minor.tick,a=h;else if(d.major.tick)b=d.major.tick,a=f;else return null;var m=1/d.bounds.scale;if(d.bounds.to<=
d.bounds.from||isNaN(m)||!isFinite(m)||0>=b||isNaN(b)||!isFinite(b))return null;for(var t=[],w=[],u=[];a<=d.bounds.to+m;)Math.abs(f-a)<b/2?(e={value:f},c.majorLabels&&(e.label=g(f,d.major.prec,c)),t.push(e),f+=d.major.tick,h+=d.minor.tick):Math.abs(h-a)<b/2?(c.minorTicks&&(e={value:h},c.minorLabels&&d.minMinorStep<=d.minor.tick*d.bounds.scale&&(e.label=g(h,d.minor.prec,c)),w.push(e)),h+=d.minor.tick):c.microTicks&&u.push({value:k}),k+=d.micro.tick,a+=b;return{major:t,minor:w,micro:u}},getTransformerFromModel:function(d){var c=
d.bounds.from,b=d.bounds.scale;return function(a){return(a-c)*b}},getTransformerFromPlot:function(d){var c=d.bounds.from,b=d.bounds.scale;return function(a){return a/b+c}}})})},"dojox/charting/scaler/common":function(){define(["dojo/_base/lang"],function(m){var f=function(e,d){return Math.abs(e-d)<=1E-6*(Math.abs(e)+Math.abs(d))},k=m.getObject("dojox.charting.scaler.common",!0),e={};return m.mixin(k,{doIfLoaded:function(f,d,h){if(void 0===e[f])try{e[f]=require(f)}catch(c){e[f]=null}return e[f]?d(e[f]):
h()},getNumericLabel:function(e,d,h){var c="";k.doIfLoaded("dojo/number",function(a){c=(h.fixed?a.format(e,{places:0>d?-d:0}):a.format(e))||""},function(){c=h.fixed?e.toFixed(0>d?-d:0):e.toString()});if(h.labelFunc){var b=h.labelFunc(c,e,d);if(b)return b}if(h.labels){for(var b=h.labels,a=0,g=b.length;a<g;){var m=Math.floor((a+g)/2);b[m].value<e?a=m+1:g=m}if(a<b.length&&f(b[a].value,e))return b[a].text;--a;if(0<=a&&a<b.length&&f(b[a].value,e))return b[a].text;a+=2;if(a<b.length&&f(b[a].value,e))return b[a].text}return c}})})},
"dojox/charting/plot2d/Default":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){var n=b.lambda("item.purgeGroup()");return f("dojox.charting.plot2d.Default",[g,d],{defaultParams:{lines:!0,areas:!1,markers:!1,tension:"",animate:!1,enableCache:!1,interpolate:!1},optionalParams:{stroke:{},outline:{},shadow:{},
fill:{},filter:{},styleFunc:null,font:"",fontColor:"",marker:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:"",zeroLine:0},constructor:function(b,c){this.opt=m.clone(m.mixin(this.opt,this.defaultParams));a.updateWithObject(this.opt,c);a.updateWithPattern(this.opt,c,this.optionalParams);this.animate=this.opt.animate},createPath:function(a,b,c){var d;this.opt.enableCache&&0<a._pathFreePool.length?(d=a._pathFreePool.pop(),d.setShape(c),b.add(d)):d=b.createPath(c);
this.opt.enableCache&&a._pathUsePool.push(d);return d},buildSegments:function(a,b){a=this.series[a];for(var c=b?Math.min(a.data.length,Math.ceil(this._hScaler.bounds.to)):a.data.length,d=null,e=[],f=b?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0;f<c;f++)if(!this.isNullValue(a.data[f]))d||(d=[],e.push({index:f,rseg:d})),d.push(b&&a.data[f].hasOwnProperty("y")?a.data[f].y:a.data[f]);else if(!this.opt.interpolate||b)d=null;return e},render:function(a,b){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,
b);this.resetEvents();this.dirty=this.isDirty();var d;this.dirty&&(k.forEach(this.series,n),this._eventSeries={},this.cleanGroup(),this.getGroup().setTransform(null),d=this.getGroup(),c.forEachRev(this.series,function(a){a.cleanGroup(d)}));for(var f=this.chart.theme,g,p,q=this.events(),v=0;v<this.series.length;v++){var z=this.series[v];if(this.dirty||z.dirty)if(z.cleanGroup(),this.opt.enableCache&&(z._pathFreePool=(z._pathFreePool?z._pathFreePool:[]).concat(z._pathUsePool?z._pathUsePool:[]),z._pathUsePool=
[]),z.data.length){var y=f.next(this.opt.areas?"area":"line",[this.opt,z],!0),A,B=this._hScaler.scaler.getTransformerFromModel(this._hScaler),C=this._vScaler.scaler.getTransformerFromModel(this._vScaler),E=this._eventSeries[z.name]=Array(z.data.length);d=z.group;if(z.hidden){this.opt.lines&&(z.dyn.stroke=y.series.stroke);if(z.markers||void 0===z.markers&&this.opt.markers)z.dyn.markerFill=y.marker.fill,z.dyn.markerStroke=y.marker.stroke,z.dyn.marker=y.symbol;this.opt.areas&&(z.dyn.fill=y.series.fill)}else{for(var D=
k.some(z.data,function(a){return"number"==typeof a||a&&!a.hasOwnProperty("x")}),F=this.buildSegments(v,D),M=0;M<F.length;M++){var N=F[M];A=D?k.map(N.rseg,function(c,d){return{x:B(d+N.index+1)+b.l,y:a.height-b.b-C(c),data:c}},this):k.map(N.rseg,function(c){return{x:B(c.x)+b.l,y:a.height-b.b-C(c.y),data:c}},this);if(D&&this.opt.interpolate)for(;M<F.length;)M++,(N=F[M])&&(A=A.concat(k.map(N.rseg,function(c,d){return{x:B(d+N.index+1)+b.l,y:a.height-b.b-C(c),data:c}},this)));var I=this.opt.tension?h.curve(A,
this.opt.tension):"";if(this.opt.areas&&1<A.length){var G=this._plotFill(y.series.fill,a,b),O=m.clone(A),J=a.height-b.b;isNaN(this.opt.zeroLine)||(J=Math.max(b.t,Math.min(a.height-b.b-C(this.opt.zeroLine),J)));this.opt.tension?z.dyn.fill=d.createPath(I+" "+("L"+O[O.length-1].x+","+J+" L"+O[0].x+","+J+" L"+O[0].x+","+O[0].y)).setFill(G).getFill():(O.push({x:A[A.length-1].x,y:J}),O.push({x:A[0].x,y:J}),O.push(A[0]),z.dyn.fill=d.createPolyline(O).setFill(G).getFill())}if(this.opt.lines||this.opt.markers)g=
y.series.stroke,y.series.outline&&(p=z.dyn.outline=h.makeStroke(y.series.outline),p.width=2*p.width+(g&&g.width||0));this.opt.markers&&(z.dyn.marker=y.symbol);var Q=null,H=null,K=null;if(g&&y.series.shadow&&1<A.length){var R=y.series.shadow,G=k.map(A,function(a){return{x:a.x+R.dx,y:a.y+R.dy}});this.opt.lines&&(z.dyn.shadow=this.opt.tension?d.createPath(h.curve(G,this.opt.tension)).setStroke(R).getStroke():d.createPolyline(G).setStroke(R).getStroke());this.opt.markers&&y.marker.shadow&&(R=y.marker.shadow,
K=k.map(G,function(a){return this.createPath(z,d,"M"+a.x+" "+a.y+" "+y.symbol).setStroke(R).setFill(R.color)},this))}if(this.opt.lines&&1<A.length){var P;p&&(z.dyn.outline=this.opt.tension?d.createPath(I).setStroke(p).getStroke():d.createPolyline(A).setStroke(p).getStroke());z.dyn.stroke=this.opt.tension?(P=d.createPath(I)).setStroke(g).getStroke():(P=d.createPolyline(A)).setStroke(g).getStroke();P.setFilter&&y.series.filter&&P.setFilter(y.series.filter)}I=null;if(this.opt.markers){var L=y,Q=Array(A.length),
H=Array(A.length);p=null;L.marker.outline&&(p=h.makeStroke(L.marker.outline),p.width=2*p.width+(L.marker.stroke?L.marker.stroke.width:0));k.forEach(A,function(a,b){if(this.opt.styleFunc||"number"!=typeof a.data){var c="number"!=typeof a.data?[a.data]:[];this.opt.styleFunc&&c.push(this.opt.styleFunc(a.data));L=f.addMixin(y,"marker",c,!0)}else L=f.post(y,"marker");a="M"+a.x+" "+a.y+" "+L.symbol;p&&(H[b]=this.createPath(z,d,a).setStroke(p));Q[b]=this.createPath(z,d,a).setStroke(L.marker.stroke).setFill(L.marker.fill)},
this);z.dyn.markerFill=L.marker.fill;z.dyn.markerStroke=L.marker.stroke;!I&&this.opt.labels&&(I=Q[0].getBoundingBox());q?k.forEach(Q,function(a,b){a={element:"marker",index:b+N.index,run:z,shape:a,outline:H[b]||null,shadow:K&&K[b]||null,cx:A[b].x,cy:A[b].y};D?(a.x=b+N.index+1,a.y=z.data[b+N.index]):(a.x=N.rseg[b].x,a.y=z.data[b+N.index].y);this._connectEvents(a);E[b+N.index]=a},this):delete this._eventSeries[z.name]}if(this.opt.labels){var T=I?I.width:2,S=I?I.height:2;k.forEach(A,function(a,b){if(this.opt.styleFunc||
"number"!=typeof a.data){var c="number"!=typeof a.data?[a.data]:[];this.opt.styleFunc&&c.push(this.opt.styleFunc(a.data));L=f.addMixin(y,"marker",c,!0)}else L=f.post(y,"marker");this.createLabel(d,N.rseg[b],{x:a.x-T/2,y:a.y-S/2,width:T,height:S},L)},this)}}z.dirty=!1}}else z.dirty=!1,f.skip();else f.skip(),this._reconnectEvents(z.name)}e("dojo-bidi")&&this._checkOrientation(this.group,a,b);this.animate&&(g=this.getGroup(),l.animateTransform(m.delegate({shape:g,duration:1200,transform:[{name:"translate",
start:[0,a.height-b.b],end:[0,0]},{name:"scale",start:[1,0],end:[1,1]},{name:"original"}]},this.animate)).play());this.dirty=!1;return this}})})},"dojox/charting/plot2d/CartesianBase":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/has ./Base ../scaler/primitive dojox/gfx dojox/gfx/fx dojox/lang/utils".split(" "),function(m,f,k,e,g,d,h,c,b){var a=function(){return!1};return f("dojox.charting.plot2d.CartesianBase",g,{baseParams:{hAxis:"x",vAxis:"y",labels:!1,labelOffset:10,
fixed:!0,precision:1,labelStyle:"inside",htmlLabels:!0,omitLabels:!0,labelFunc:null},constructor:function(a,c){this.axes=["hAxis","vAxis"];this.zoom=null;this.zoomQueue=[];this.lastWindow={vscale:1,hscale:1,xoffset:0,yoffset:0};this.hAxis=c&&c.hAxis||"x";this.vAxis=c&&c.vAxis||"y";this.series=[];this.opt=m.clone(this.baseParams);b.updateWithObject(this.opt,c)},clear:function(){this.inherited(arguments);this._vAxis=this._hAxis=null;return this},cleanGroup:function(a,b){this.inherited(arguments);if(!b&&
this.chart._nativeClip){var c=this.chart.offsets,d=this.chart.dim;this.group.setClip({x:c.l,y:c.t,width:Math.max(0,d.width-c.l-c.r),height:Math.max(0,d.height-c.t-c.b)});this._clippedGroup||(this._clippedGroup=this.group.createGroup())}},purgeGroup:function(){this.inherited(arguments);this._clippedGroup=null},getGroup:function(){return this._clippedGroup||this.group},setAxis:function(a){a&&(this[a.vertical?"_vAxis":"_hAxis"]=a);return this},toPage:function(a){var b=this._hAxis,c=this._vAxis,d=b.getScaler(),
e=c.getScaler(),f=d.scaler.getTransformerFromModel(d),g=e.scaler.getTransformerFromModel(e),h=this.chart.getCoords(),l=this.chart.offsets,k=this.chart.dim,d=function(a){var d={};d.x=f(a[b.name])+h.x+l.l;d.y=h.y+k.height-l.b-g(a[c.name]);return d};return a?d(a):d},toData:function(a){var b=this._hAxis,c=this._vAxis,d=b.getScaler(),e=c.getScaler(),f=d.scaler.getTransformerFromPlot(d),g=e.scaler.getTransformerFromPlot(e),h=this.chart.getCoords(),l=this.chart.offsets,k=this.chart.dim,d=function(a){var d=
{};d[b.name]=f(a.x-h.x-l.l);d[c.name]=g(h.y+k.height-a.y-l.b);return d};return a?d(a):d},isDirty:function(){return this.dirty||this._hAxis&&this._hAxis.dirty||this._vAxis&&this._vAxis.dirty},createLabel:function(a,b,c,d){if(this.opt.labels){var e,f=this.opt.labelFunc?this.opt.labelFunc.apply(this,[b,this.opt.fixed,this.opt.precision]):this._getLabel(isNaN(b.y)?b:b.y);if("inside"==this.opt.labelStyle){var g=h._base._getTextBox(f,{font:d.series.font});b=c.x+c.width/2;e=c.y+c.height/2+g.h/4;if(g.w>c.width||
g.h>c.height)return}else b=c.x+c.width/2,e=c.y-this.opt.labelOffset;this.renderLabel(a,b,e,f,d,"inside"==this.opt.labelStyle)}},performZoom:function(a,b){var d=this._vAxis.scale||1,e=this._hAxis.scale||1;a=a.height-b.b;var f=this._hScaler.bounds,f=(f.from-f.lower)*f.scale,g=this._vScaler.bounds,g=(g.from-g.lower)*g.scale,h=d/this.lastWindow.vscale,l=e/this.lastWindow.hscale,n=(this.lastWindow.xoffset-f)/(1==this.lastWindow.hscale?e:this.lastWindow.hscale),v=(g-this.lastWindow.yoffset)/(1==this.lastWindow.vscale?
d:this.lastWindow.vscale),z=this.getGroup();b=c.animateTransform(m.delegate({shape:z,duration:1200,transform:[{name:"translate",start:[0,0],end:[b.l*(1-l),a*(1-h)]},{name:"scale",start:[1,1],end:[l,h]},{name:"original"},{name:"translate",start:[0,0],end:[n,v]}]},this.zoom));m.mixin(this.lastWindow,{vscale:d,hscale:e,xoffset:f,yoffset:g});this.zoomQueue.push(b);k.connect(b,"onEnd",this,function(){this.zoom=null;this.zoomQueue.shift();0<this.zoomQueue.length&&this.zoomQueue[0].play()});1==this.zoomQueue.length&&
this.zoomQueue[0].play();return this},initializeScalers:function(a,b){this._hAxis?(this._hAxis.initialized()||this._hAxis.calculate(b.hmin,b.hmax,a.width),this._hScaler=this._hAxis.getScaler()):this._hScaler=d.buildScaler(b.hmin,b.hmax,a.width);this._vAxis?(this._vAxis.initialized()||this._vAxis.calculate(b.vmin,b.vmax,a.height),this._vScaler=this._vAxis.getScaler()):this._vScaler=d.buildScaler(b.vmin,b.vmax,a.height);return this},isNullValue:function(b){if(null===b||"undefined"==typeof b)return!0;
var c=this._hAxis?this._hAxis.isNullValue:a,d=this._vAxis?this._vAxis.isNullValue:a;return"number"==typeof b?c(1)||d(b):c(isNaN(b.x)?1:b.x)||null===b.y||d(b.y)}})})},"dojox/charting/plot2d/Base":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojox/gfx ../Element ./common ../axis2d/common dojo/has".split(" "),function(m,f,k,e,g,d,h,c){m=m("dojox.charting.plot2d.Base",g,{constructor:function(b,a){a&&a.tooltipFunc&&(this.tooltipFunc=a.tooltipFunc)},clear:function(){this.series=
[];this.dirty=!0;return this},setAxis:function(b){return this},assignAxes:function(b){f.forEach(this.axes,function(a){this[a]&&this.setAxis(b[this[a]])},this)},addSeries:function(b){this.series.push(b);return this},getSeriesStats:function(){return d.collectSimpleStats(this.series,k.hitch(this,"isNullValue"))},calculateAxes:function(b){this.initializeScalers(b,this.getSeriesStats());return this},initializeScalers:function(){return this},isDataDirty:function(){return f.some(this.series,function(b){return b.dirty})},
render:function(b,a){return this},renderLabel:function(b,a,c,d,f,g,k){b=h.createText[this.opt.htmlLabels&&"vml"!=e.renderer?"html":"gfx"](this.chart,b,a,c,k?k:"middle",d,f.series.font,f.series.fontColor);g&&(this.opt.htmlLabels&&"vml"!=e.renderer?b.style.pointerEvents="none":b.rawNode&&(b.rawNode.style.pointerEvents="none"));this.opt.htmlLabels&&"vml"!=e.renderer&&this.htmlElements.push(b);return b},getRequiredColors:function(){return this.series.length},_getLabel:function(b){return d.getLabel(b,
this.opt.fixed,this.opt.precision)}});c("dojo-bidi")&&m.extend({_checkOrientation:function(b,a,c){this.chart.applyMirroring(this.group,a,c)}});return m})},"dojox/charting/plot2d/common":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Color dojox/gfx dojox/lang/functional ../scaler/common".split(" "),function(m,f,k,e,g,d){var h=m.getObject("dojox.charting.plot2d.common",!0);return m.mixin(h,{doIfLoaded:d.doIfLoaded,makeStroke:function(c){if(!c)return c;if("string"==typeof c||c instanceof
k)c={color:c};return e.makeParameters(e.defaultStroke,c)},augmentColor:function(c,b){c=new k(c);b=new k(b);b.a=c.a;return b},augmentStroke:function(c,b){if(c=h.makeStroke(c))c.color=h.augmentColor(c.color,b);return c},augmentFill:function(c,b){new k(b);return"string"==typeof c||c instanceof k?h.augmentColor(c,b):c},defaultStats:{vmin:Number.POSITIVE_INFINITY,vmax:Number.NEGATIVE_INFINITY,hmin:Number.POSITIVE_INFINITY,hmax:Number.NEGATIVE_INFINITY},collectSimpleStats:function(c,b){for(var a=m.delegate(h.defaultStats),
d=0;d<c.length;++d)for(var e=c[d],g=0;g<e.data.length;g++)if(!b(e.data[g])){if("number"==typeof e.data[g]){var g=a.vmin,k=a.vmax;f.forEach(e.data,function(c,d){b(c)||(d+=1,isNaN(c)&&(c=0),a.hmin=Math.min(a.hmin,d),a.hmax=Math.max(a.hmax,d),a.vmin=Math.min(a.vmin,c),a.vmax=Math.max(a.vmax,c))})}else{var r=a.hmin,t=a.hmax,g=a.vmin,k=a.vmax;"xmin"in e&&"xmax"in e&&"ymin"in e&&"ymax"in e||f.forEach(e.data,function(c,d){b(c)||(d="x"in c?c.x:d+1,c=c.y,isNaN(d)&&(d=0),isNaN(c)&&(c=0),a.hmin=Math.min(a.hmin,
d),a.hmax=Math.max(a.hmax,d),a.vmin=Math.min(a.vmin,c),a.vmax=Math.max(a.vmax,c))});"xmin"in e&&(a.hmin=Math.min(r,e.xmin));"xmax"in e&&(a.hmax=Math.max(t,e.xmax))}"ymin"in e&&(a.vmin=Math.min(g,e.ymin));"ymax"in e&&(a.vmax=Math.max(k,e.ymax));break}return a},calculateBarSize:function(c,b,a){a||(a=1);var d=(c-2*b.gap)/a;"minBarSize"in b&&(d=Math.max(d,b.minBarSize));"maxBarSize"in b&&(d=Math.min(d,b.maxBarSize));d=Math.max(d,1);return{size:d,gap:(c-d*a)/2}},collectStackedStats:function(c){var b=m.clone(h.defaultStats);
if(c.length){b.hmin=Math.min(b.hmin,1);b.hmax=g.foldl(c,"seed, run -\x3e Math.max(seed, run.data.length)",b.hmax);for(var a=0;a<b.hmax;++a){var d=c[0].data[a],d=d&&("number"==typeof d?d:d.y);isNaN(d)&&(d=0);b.vmin=Math.min(b.vmin,d);for(var e=1;e<c.length;++e){var f=c[e].data[a],f=f&&("number"==typeof f?f:f.y);isNaN(f)&&(f=0);d+=f}b.vmax=Math.max(b.vmax,d)}}return b},curve:function(c,b){var a=c.slice(0);"x"==b&&(a[a.length]=a[0]);return f.map(a,function(c,d){if(0==d)return"M"+c.x+","+c.y;if(!isNaN(b)){var e=
c.x-a[d-1].x;return"C"+(c.x-e/b*(b-1))+","+a[d-1].y+" "+(c.x-e/b)+","+c.y+" "+c.x+","+c.y}if("X"==b||"x"==b||"S"==b){var f;c=a[d-1];var e=a[d],g,h,l;g=1/6;1==d?(f="x"==b?a[a.length-2]:c,g=1/3):f=a[d-2];d==a.length-1?(d="x"==b?a[1]:e,g=1/3):d=a[d+1];var k=Math.sqrt((e.x-c.x)*(e.x-c.x)+(e.y-c.y)*(e.y-c.y));h=Math.sqrt((e.x-f.x)*(e.x-f.x)+(e.y-f.y)*(e.y-f.y));l=Math.sqrt((d.x-c.x)*(d.x-c.x)+(d.y-c.y)*(d.y-c.y));var m=h*g,n=l*g;m>k/2&&n>k/2?(m=k/2,n=k/2):m>k/2?(m=k/2,n=k/2*l/h):n>k/2&&(n=k/2,m=k/2*h/
l);"S"==b&&(f==c&&(m=0),e==d&&(n=0));g=c.x+m*(e.x-f.x)/h;f=c.y+m*(e.y-f.y)/h;h=e.x-n*(d.x-c.x)/l;l=e.y-n*(d.y-c.y)/l}return"C"+(g+","+f+" "+h+","+l+" "+e.x+","+e.y)}).join(" ")},getLabel:function(c,b,a){return d.doIfLoaded("dojo/number",function(d){return(b?d.format(c,{places:a}):d.format(c))||""},function(){return b?c.toFixed(a):c.toString()})}})})},"dojox/charting/scaler/primitive":function(){define(["dojo/_base/lang"],function(m){var f=m.getObject("dojox.charting.scaler.primitive",!0);return m.mixin(f,
{buildScaler:function(k,e,g,d){k==e&&(k-=.5,e+=.5);return{bounds:{lower:k,upper:e,from:k,to:e,scale:g/(e-k),span:g},scaler:f}},buildTicks:function(f,e){return{major:[],minor:[],micro:[]}},getTransformerFromModel:function(f){var e=f.bounds.from,g=f.bounds.scale;return function(d){return(d-e)*g}},getTransformerFromPlot:function(f){var e=f.bounds.from,g=f.bounds.scale;return function(d){return d/g+e}}})})},"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),
function(m,f,k,e,g,d,h,c){function b(a,b){this.start=a;this.end=b}function a(a,b,c){this.start=a;this.end=b;this.units=c}function l(a,b){this.start=a;this.end=b;this.temp=new e}function n(a){this.values=a;this.length=a.length}function p(a,b){this.values=a;this.def=b?b:{}}function q(a,b){this.stack=a;this.original=b}function r(a,b,c,d){if(a.values)return new n(a.values);var e,g;g=a.start?f.normalizeColor(a.start):e=b?c?b[c]:b:d;a.end?a=f.normalizeColor(a.end):(e||(e=b?c?b[c]:b:d),a=e);return new l(g,
a)}var t=f.fx={};b.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};a.prototype.getValue=function(a){return(this.end-this.start)*a+this.start+this.units};l.prototype.getValue=function(a){return e.blendColors(this.start,this.end,a,this.temp)};n.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*this.length),this.length-1)]};p.prototype.getValue=function(a){var b=m.clone(this.def),c;for(c in this.values)b[c]=this.values[c].getValue(a);return b};q.prototype.getValue=
function(a){var b=[];g.forEach(this.stack,function(c){if(c instanceof k.Matrix2D)b.push(c);else if("original"==c.name&&this.original)b.push(this.original);else if("matrix"==c.name){if(c.start instanceof k.Matrix2D&&c.end instanceof k.Matrix2D){var d=new k.Matrix2D,e;for(e in c.start)d[e]=(c.end[e]-c.start[e])*a+c.start[e];b.push(d)}}else c.name in k&&(d=k[c.name],"function"!=typeof d?b.push(d):(e=g.map(c.start,function(b,d){return(c.end[d]-b)*a+b}),d=d.apply(k,e),d instanceof k.Matrix2D&&b.push(d)))},
this);return b};var w=new e(0,0,0,0);t.animateStroke=function(a){a.easing||(a.easing=d._defaultEasing);var c=new d.Animation(a),e=a.shape,f;h.connect(c,"beforeBegin",c,function(){f=e.getStroke();var c=a.color,d={},g;c&&(d.color=r(c,f,"color",w));(c=a.style)&&c.values&&(d.style=new n(c.values));if(c=a.width){var h=c,l=f;h.values?g=new n(h.values):(c=h.start?h.start:g=l?l.width:1,h.end?g=h.end:"number"!=typeof g&&(g=l?l.width:1),g=new b(c,g));d.width=g}(c=a.cap)&&c.values&&(d.cap=new n(c.values));if(c=
a.join)c.values?d.join=new n(c.values):(g=c.start?c.start:f&&f.join||0,c=c.end?c.end:f&&f.join||0,"number"==typeof g&&"number"==typeof c&&(d.join=new b(g,c)));this.curve=new p(d,f)});h.connect(c,"onAnimate",e,"setStroke");return c};t.animateFill=function(a){a.easing||(a.easing=d._defaultEasing);var b=new d.Animation(a),c=a.shape,e;h.connect(b,"beforeBegin",b,function(){e=c.getFill();var b=a.color;b&&(this.curve=r(b,e,"",w))});h.connect(b,"onAnimate",c,"setFill");return b};t.animateFont=function(b){b.easing||
(b.easing=d._defaultEasing);var c=new d.Animation(b),e=b.shape,f;h.connect(c,"beforeBegin",c,function(){f=e.getFont();var c=b.style,d={},g,h;c&&c.values&&(d.style=new n(c.values));(c=b.variant)&&c.values&&(d.variant=new n(c.values));(c=b.weight)&&c.values&&(d.weight=new n(c.values));(c=b.family)&&c.values&&(d.family=new n(c.values));(c=b.size)&&c.units&&(g=parseFloat(c.start?c.start:e.font&&e.font.size||"0"),h=parseFloat(c.end?c.end:e.font&&e.font.size||"0"),d.size=new a(g,h,c.units));this.curve=
new p(d,f)});h.connect(c,"onAnimate",e,"setFont");return c};t.animateTransform=function(a){a.easing||(a.easing=d._defaultEasing);var b=new d.Animation(a),e=a.shape,l;h.connect(b,"beforeBegin",b,function(){l=e.getTransform();this.curve=new q(a.transform,l)});h.connect(b,"onAnimate",e,"setTransform");if("svg"===f.renderer&&(9<=c("ie")||c("ff")))var k=[h.connect(b,"onBegin",b,function(){for(var a=e.getParent();a&&a.getParent;)a=a.getParent();a&&(e.__svgContainer=a.rawNode.parentNode,e.__svgRoot=a.rawNode,
e.__svgRoot&&e.__svgRoot.getAttribute&&(e.__svgWidth=parseInt(e.__svgRoot.getAttribute("width"),10),isNaN(e.__svgWidth)&&delete e.__svgWidth))}),h.connect(b,"onAnimate",b,function(){try{if(e.__svgContainer){var a=e.__svgContainer.style.visibility;e.__svgContainer.style.visibility="visible";e.__svgContainer.style.visibility=a;var b=e.__svgWidth;if(!isNaN(b))try{e.__svgRoot.setAttribute("width",b-5E-6),e.__svgRoot.setAttribute("width",b)}catch(C){}}}catch(C){}}),h.connect(b,"onEnd",b,function(){g.forEach(k,
h.disconnect);if(e.__svgContainer){var a=e.__svgContainer;if(null==a.getAttribute("__gotVis")){a.setAttribute("__gotVis",!0);var b=e.__svgContainer.style.visibility,c=e.__svgRoot,d=e.__svgWidth;a.style.visibility="visible";setTimeout(function(){try{a.style.visibility=b;a.removeAttribute("__gotVis");a=null;try{isNaN(d)||(c.setAttribute("width",d-5E-6),c.setAttribute("width",d))}catch(D){}}catch(D){}},100)}}delete e.__svgContainer;delete e.__svgRoot;delete e.__svgWidth})];return b};return t})},"dojox/charting/plot2d/_PlotEvents":function(){define(["dojo/_base/lang",
"dojo/_base/array","dojo/_base/declare","dojo/_base/connect"],function(m,f,k,e){return k("dojox.charting.plot2d._PlotEvents",null,{constructor:function(){this._shapeEvents=[];this._eventSeries={}},destroy:function(){this.resetEvents();this.inherited(arguments)},plotEvent:function(e){},raiseEvent:function(e){this.plotEvent(e);var d=m.delegate(e);d.originalEvent=e.type;d.originalPlot=e.plot;d.type="onindirect";f.forEach(this.chart.stack,function(e){e!==this&&e.plotEvent&&(d.plot=e,e.plotEvent(d))},
this)},connect:function(f,d){this.dirty=!0;return e.connect(this,"plotEvent",f,d)},events:function(){return!!this.plotEvent.after},resetEvents:function(){this._shapeEvents.length&&(f.forEach(this._shapeEvents,function(e){e.shape.disconnect(e.handle)}),this._shapeEvents=[]);this.raiseEvent({type:"onplotreset",plot:this})},_connectSingleEvent:function(e,d){this._shapeEvents.push({shape:e.eventMask,handle:e.eventMask.connect(d,this,function(f){e.type=d;e.event=f;this.raiseEvent(e);e.event=null})})},
_connectEvents:function(e){e&&(e.chart=this.chart,e.plot=this,e.hAxis=this.hAxis||null,e.vAxis=this.vAxis||null,e.eventMask=e.eventMask||e.shape,this._connectSingleEvent(e,"onmouseover"),this._connectSingleEvent(e,"onmouseout"),this._connectSingleEvent(e,"onclick"))},_reconnectEvents:function(e){(e=this._eventSeries[e])&&f.forEach(e,this._connectEvents,this)},fireEvent:function(e,d,f,c){(e=this._eventSeries[e])&&e.length&&f<e.length&&(f=e[f],f.type=d,f.event=c||null,this.raiseEvent(f),f.event=null)}})})},
"dojox/charting/plot2d/Lines":function(){define(["dojo/_base/declare","./Default"],function(m,f){return m("dojox.charting.plot2d.Lines",f,{constructor:function(){this.opt.lines=!0}})})},"dojox/charting/plot2d/Areas":function(){define(["dojo/_base/declare","./Default"],function(m,f){return m("dojox.charting.plot2d.Areas",f,{constructor:function(){this.opt.lines=!0;this.opt.areas=!0}})})},"dojox/charting/plot2d/Markers":function(){define(["dojo/_base/declare","./Default"],function(m,f){return m("dojox.charting.plot2d.Markers",
f,{constructor:function(){this.opt.markers=!0}})})},"dojox/charting/plot2d/MarkersOnly":function(){define(["dojo/_base/declare","./Default"],function(m,f){return m("dojox.charting.plot2d.MarkersOnly",f,{constructor:function(){this.opt.lines=!1;this.opt.markers=!0}})})},"dojox/charting/plot2d/Scatter":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx dojox/gfx/gradutils".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n){var p=b.lambda("item.purgeGroup()");return k("dojox.charting.plot2d.Scatter",[g,d],{defaultParams:{shadows:null,animate:null},optionalParams:{markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:"",styleFunc:null},constructor:function(b,c){this.opt=m.clone(m.mixin(this.opt,this.defaultParams));a.updateWithObject(this.opt,c);a.updateWithPattern(this.opt,c,this.optionalParams);this.animate=this.opt.animate},render:function(a,
b){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,b);this.resetEvents();this.dirty=this.isDirty();var d;this.dirty&&(f.forEach(this.series,p),this._eventSeries={},this.cleanGroup(),d=this.getGroup(),c.forEachRev(this.series,function(a){a.cleanGroup(d)}));for(var g=this.chart.theme,l=this.events(),k=0;k<this.series.length;k++){var m=this.series[k];if(this.dirty||m.dirty)if(m.cleanGroup(),m.data.length){var q=g.next("marker",[this.opt,m]),r,A=this._hScaler.scaler.getTransformerFromModel(this._hScaler),
B=this._vScaler.scaler.getTransformerFromModel(this._vScaler);if(m.hidden)m.dyn.marker=q.symbol,m.dyn.markerFill=q.marker.fill,m.dyn.markerStroke=q.marker.stroke;else{d=m.group;r="number"==typeof m.data[0]?f.map(m.data,function(c,d){return{x:A(d+1)+b.l,y:a.height-b.b-B(c)}},this):f.map(m.data,function(c,d){return{x:A(c.x)+b.l,y:a.height-b.b-B(c.y)}},this);var C=Array(r.length),E=Array(r.length),D=Array(r.length);f.forEach(r,function(c,e){var f=m.data[e],l;this.opt.styleFunc||"number"!=typeof f?(l=
"number"!=typeof f?[f]:[],this.opt.styleFunc&&l.push(this.opt.styleFunc(f)),l=g.addMixin(q,"marker",l,!0)):l=g.post(q,"marker");var k="M"+c.x+" "+c.y+" "+l.symbol;l.marker.shadow&&(C[e]=d.createPath("M"+(c.x+l.marker.shadow.dx)+" "+(c.y+l.marker.shadow.dy)+" "+l.symbol).setStroke(l.marker.shadow).setFill(l.marker.shadow.color),this.animate&&this._animateScatter(C[e],a.height-b.b));if(l.marker.outline){var p=h.makeStroke(l.marker.outline);p.width=2*p.width+(l.marker.stroke&&l.marker.stroke.width||
0);D[e]=d.createPath(k).setStroke(p);this.animate&&this._animateScatter(D[e],a.height-b.b)}var p=h.makeStroke(l.marker.stroke),r=this._plotFill(l.marker.fill,a,b);!r||"linear"!==r.type&&"radial"!=r.type?E[e]=d.createPath(k).setStroke(p).setFill(r):(c=n.getColor(r,{x:c.x,y:c.y}),p&&(p.color=c),E[e]=d.createPath(k).setStroke(p).setFill(c));this.opt.labels&&(c=E[e].getBoundingBox(),this.createLabel(d,f,c,l));this.animate&&this._animateScatter(E[e],a.height-b.b)},this);E.length&&(m.dyn.marker=q.symbol,
m.dyn.markerStroke=E[E.length-1].getStroke(),m.dyn.markerFill=E[E.length-1].getFill());if(l){var F=Array(E.length);f.forEach(E,function(a,b){a={element:"marker",index:b,run:m,shape:a,outline:D&&D[b]||null,shadow:C&&C[b]||null,cx:r[b].x,cy:r[b].y};"number"==typeof m.data[0]?(a.x=b+1,a.y=m.data[b]):(a.x=m.data[b].x,a.y=m.data[b].y);this._connectEvents(a);F[b]=a},this);this._eventSeries[m.name]=F}else delete this._eventSeries[m.name];m.dirty=!1}}else m.dirty=!1,g.skip();else g.skip(),this._reconnectEvents(m.name)}this.dirty=
!1;e("dojo-bidi")&&this._checkOrientation(this.group,a,b);return this},_animateScatter:function(a,b){l.animateTransform(m.delegate({shape:a,duration:1200,transform:[{name:"translate",start:[0,b],end:[0,0]},{name:"scale",start:[0,0],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Stacked":function(){define(["dojo/_base/declare","dojo/_base/lang","./Default","./commonStacked"],function(m,f,k,e){return m("dojox.charting.plot2d.Stacked",k,{getSeriesStats:function(){return e.collectStats(this.series,
f.hitch(this,"isNullValue"))},buildSegments:function(g,d){for(var h=this.series[g],c=d?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,b=d?Math.min(h.data.length-1,Math.ceil(this._hScaler.bounds.to)):h.data.length-1,a=null,l=[],k=f.hitch(this,"isNullValue");c<=b;c++){var m=d?e.getIndexValue(this.series,g,c,k):e.getValue(this.series,g,h.data[c]?h.data[c].x:null,k);if(!k(m[0])&&(d||null!=m[0].y))a||(a=[],l.push({index:c,rseg:a})),a.push(m[0]);else if(!this.opt.interpolate||d)a=null}return l}})})},
"dojox/charting/plot2d/commonStacked":function(){define(["dojo/_base/lang","dojox/lang/functional","./common"],function(m,f,k){var e=m.getObject("dojox.charting.plot2d.commonStacked",!0);return m.mixin(e,{collectStats:function(f,d){for(var g=m.delegate(k.defaultStats),c=0;c<f.length;++c)for(var b=f[c],a=0;a<b.data.length;a++){var l,n;null!==b.data[a]&&("number"!=typeof b.data[a]&&b.data[a].hasOwnProperty("x")?(l=b.data[a].x,null!==l&&(n=e.getValue(f,c,l,d)[0],n=null!=n&&n.y?n.y:null)):(n=e.getIndexValue(f,
c,a,d)[0],l=a+1),g.hmin=Math.min(g.hmin,l),g.hmax=Math.max(g.hmax,l),g.vmin=Math.min(g.vmin,n),g.vmax=Math.max(g.vmax,n))}return g},rearrangeValues:function(e,d,h){var c=f.filter(e,"x"),b=c.length;if(!b)return e;for(var a={},g=0;g<b;++g){for(var k=c[g],m=k.min,q=k.max;m<q;++m)k[m]=(k[m]||0)+(a[m]||0);a=k}for(g=0;g<b;++g)for(k=c[g],m=k.min,q=k.max;m<q;++m)k[m]=this.isNullValue(k[m])?0:d(k[m])-h;if(this.opt.minWidth){d=this.opt.minWidth;for(g=b-1;g;--g)for(k=c[g],a=c[g-1],m=k.min,q=k.max;m<q;++m)k[m]-=
a[m];a=k.max;for(m=k.min;m<a;++m){for(g=h=k=0;g<b;++g)q=c[g][m],0<q&&(k+=q,++h);if(k<=h*d)for(g=0;g<b;++g)q=c[g][m],0<q&&(c[g][m]=d);else{for(g=h=0;g<b;++g)k=c[g],q=k[m],0<q&&(q<d?(h+=d-q,k[m]=d):0<h&&(q=k[m]-d,q>=h?(k[m]-=h,h=0):0<q&&(k[m]=d,h-=q)));if(0<h)for(g=b-1;0<=g;--g)if(k=c[g],q=k[m],0<q)if(q=k[m]-d,q>=h){k[m]-=h;break}else 0<q&&(k[m]=d,h-=q)}}for(g=1;g<b;++g)for(k=c[g],a=c[g-1],m=k.min,q=k.max;m<q;++m)k[m]+=a[m]}return e},getIndexValue:function(e,d,f,c){var b=0,a,g,h;for(g=0;g<=d;++g)e[g].hidden||
(h=b,a=e[g].data[f],c(a)||(isNaN(a)&&(a=a.y||0),b+=a));return[b,h]},getValue:function(e,d,f,c){var b=null,a,g,h,k;for(a=0;a<=d;++a)if(!e[a].hidden)for(g=0;g<e[a].data.length;g++)if(k=b,h=e[a].data[g],!c(h))if(h.x==f){b||(b={x:f});null!=h.y&&(null==b.y&&(b.y=0),b.y+=h.y);break}else if(h.x>f)break;return[b,k]}})})},"dojox/charting/plot2d/StackedLines":function(){define(["dojo/_base/declare","./Stacked"],function(m,f){return m("dojox.charting.plot2d.StackedLines",f,{constructor:function(){this.opt.lines=
!0}})})},"dojox/charting/plot2d/StackedAreas":function(){define(["dojo/_base/declare","./Stacked"],function(m,f){return m("dojox.charting.plot2d.StackedAreas",f,{constructor:function(){this.opt.lines=!0;this.opt.areas=!0}})})},"dojox/charting/plot2d/Columns":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx".split(" "),function(m,f,k,e,g,d,h,c,b,a,
l){var n=b.lambda("item.purgeGroup()"),p=function(){return!1};return k("dojox.charting.plot2d.Columns",[g,d],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(b,c){this.opt=m.clone(m.mixin(this.opt,this.defaultParams));a.updateWithObject(this.opt,c);a.updateWithPattern(this.opt,c,this.optionalParams);this.animate=this.opt.animate;this.renderingOptions=
{"shape-rendering":"crispEdges"}},getSeriesStats:function(){var a=h.collectSimpleStats(this.series,m.hitch(this,"isNullValue"));a.hmin-=.5;a.hmax+=.5;return a},createRect:function(a,b,c){var d;this.opt.enableCache&&0<a._rectFreePool.length?(d=a._rectFreePool.pop(),d.setShape(c),b.add(d)):d=b.createRect(c);this.opt.enableCache&&a._rectUsePool.push(d);return d},render:function(a,b){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,b);this.resetEvents();this.dirty=this.isDirty();var d;this.dirty&&
(f.forEach(this.series,n),this._eventSeries={},this.cleanGroup(),d=this.getGroup(),c.forEachRev(this.series,function(a){a.cleanGroup(d)}));var g=this.chart.theme,h=this._hScaler.scaler.getTransformerFromModel(this._hScaler),l=this._vScaler.scaler.getTransformerFromModel(this._vScaler),k=Math.max(this._vScaler.bounds.lower,this._vAxis?this._vAxis.naturalBaseline:0),p=l(k),q=this.events(),r=this.getBarProperties(),B=this.series.length;f.forEach(this.series,function(a){a.hidden&&B--});for(var C=this.extractValues(this._hScaler),
C=this.rearrangeValues(C,l,p),E=0;E<this.series.length;E++){var D=this.series[E];if(this.dirty||D.dirty){D.cleanGroup();this.opt.enableCache&&(D._rectFreePool=(D._rectFreePool?D._rectFreePool:[]).concat(D._rectUsePool?D._rectUsePool:[]),D._rectUsePool=[]);var F=g.next("column",[this.opt,D]),M=Array(D.data.length);if(D.hidden)D.dyn.fill=F.series.fill;else{B--;d=D.group;for(var N=f.some(D.data,function(a){return"number"==typeof a||a&&!a.hasOwnProperty("x")}),I=N?Math.min(D.data.length,Math.ceil(this._hScaler.bounds.to)):
D.data.length,G=N?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0;G<I;++G){var O=D.data[G];if(!this.isNullValue(O)){var J=this.getValue(O,G,E,N);l(J.y);var Q=C[E][G],H,K;this.opt.styleFunc||"number"!=typeof O?(H="number"!=typeof O?[O]:[],this.opt.styleFunc&&H.push(this.opt.styleFunc(O)),H=g.addMixin(F,"column",H,!0)):H=g.post(F,"column");if(1<=r.width){var R={x:b.l+h(J.x+.5)+r.gap+r.thickness*B,y:a.height-b.b-p-Math.max(Q,0),width:r.width,height:Math.abs(Q)};H.series.shadow&&(K=m.clone(R),K.x+=
H.series.shadow.dx,K.y+=H.series.shadow.dy,K=this.createRect(D,d,K).setFill(H.series.shadow.color).setStroke(H.series.shadow),this.animate&&this._animateColumn(K,a.height-b.b+p,Q));var P=this._plotFill(H.series.fill,a,b),P=this._shapeFill(P,R),P=this.createRect(D,d,R).setFill(P).setStroke(H.series.stroke);this.overrideShape(P,{index:G,value:J});P.setFilter&&H.series.filter&&P.setFilter(H.series.filter);D.dyn.fill=P.getFill();D.dyn.stroke=P.getStroke();if(q){var L={element:"column",index:G,run:D,shape:P,
shadow:K,cx:J.x+.5,cy:J.y,x:N?G:D.data[G].x,y:N?D.data[G]:D.data[G].y};this._connectEvents(L);M[G]=L}!isNaN(J.py)&&J.py>k&&(R.height=Q-l(J.py));this.createLabel(d,O,R,H);this.animate&&this._animateColumn(P,a.height-b.b-p,Q)}}}this._eventSeries[D.name]=M;D.dirty=!1}}else g.skip(),this._reconnectEvents(D.name)}this.dirty=!1;e("dojo-bidi")&&this._checkOrientation(this.group,a,b);return this},getValue:function(a,b,c,d){d?(c="number"==typeof a?a:a.y,a=b):(c=a.y,a=a.x-1);return{x:a,y:c}},extractValues:function(a){for(var b=
[],c=this.series.length-1;0<=c;--c){var d=this.series[c];if(this.dirty||d.dirty){var e=f.some(d.data,function(a){return"number"==typeof a||a&&!a.hasOwnProperty("x")}),g=e?Math.max(0,Math.floor(a.bounds.from-1)):0,e=e?Math.min(d.data.length,Math.ceil(a.bounds.to)):d.data.length,h=b[c]=[];h.min=g;for(h.max=e;g<e;++g){var l=d.data[g];h[g]=this.isNullValue(l)?0:"number"==typeof l?l:l.y}}}return b},rearrangeValues:function(a,b,c){for(var d=0,e=a.length;d<e;++d){var f=a[d];if(f)for(var g=f.min,h=f.max;g<
h;++g){var l=f[g];f[g]=this.isNullValue(l)?0:b(l)-c}}return a},isNullValue:function(a){if(null===a||"undefined"==typeof a)return!0;var b=this._hAxis?this._hAxis.isNullValue:p,c=this._vAxis?this._vAxis.isNullValue:p;return"number"==typeof a?c(.5)||b(a):c(isNaN(a.x)?.5:a.x+.5)||null===a.y||b(a.y)},getBarProperties:function(){var a=h.calculateBarSize(this._hScaler.bounds.scale,this.opt);return{gap:a.gap,width:a.size,thickness:0}},_animateColumn:function(a,b,c){0===c&&(c=1);l.animateTransform(m.delegate({shape:a,
duration:1200,transform:[{name:"translate",start:[0,b-b/c],end:[0,0]},{name:"scale",start:[1,1/c],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/StackedColumns":function(){define(["dojo/_base/declare","dojo/_base/lang","./Columns","./commonStacked"],function(m,f,k,e){return m("dojox.charting.plot2d.StackedColumns",k,{getSeriesStats:function(){var g=e.collectStats(this.series,f.hitch(this,"isNullValue"));g.hmin-=.5;g.hmax+=.5;return g},rearrangeValues:function(f,
d,h){return e.rearrangeValues.call(this,f,d,h)}})})},"dojox/charting/plot2d/ClusteredColumns":function(){define(["dojo/_base/declare","dojo/_base/array","./Columns","./common"],function(m,f,k,e){return m("dojox.charting.plot2d.ClusteredColumns",k,{getBarProperties:function(){var g=this.series.length;f.forEach(this.series,function(d){d.hidden&&g--});var d=e.calculateBarSize(this._hScaler.bounds.scale,this.opt,g);return{gap:d.gap,width:d.size,thickness:d.size,clusterSize:g}}})})},"dojox/charting/plot2d/Bars":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/has ./CartesianBase ./_PlotEvents ./common dojox/gfx/fx dojox/lang/utils dojox/lang/functional dojox/lang/functional/reversed".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=l.lambda("item.purgeGroup()"),p=function(){return!1};return k("dojox.charting.plot2d.Bars",[g,d],{defaultParams:{gap:0,animate:null,enableCache:!1},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:""},constructor:function(a,c){this.opt=m.clone(m.mixin(this.opt,this.defaultParams));b.updateWithObject(this.opt,c);b.updateWithPattern(this.opt,c,this.optionalParams);this.animate=this.opt.animate;
this.renderingOptions={"shape-rendering":"crispEdges"}},getSeriesStats:function(){var a=h.collectSimpleStats(this.series,m.hitch(this,"isNullValue")),b;a.hmin-=.5;a.hmax+=.5;b=a.hmin;a.hmin=a.vmin;a.vmin=b;b=a.hmax;a.hmax=a.vmax;a.vmax=b;return a},createRect:function(a,b,c){var d;this.opt.enableCache&&0<a._rectFreePool.length?(d=a._rectFreePool.pop(),d.setShape(c),b.add(d)):d=b.createRect(c);this.opt.enableCache&&a._rectUsePool.push(d);return d},createLabel:function(a,b,c,d){this.opt.labels&&"outside"==
this.opt.labelStyle?this.renderLabel(a,c.x+c.width+this.opt.labelOffset,c.y+c.height/2,this._getLabel(isNaN(b.y)?b:b.y),d,"start"):this.inherited(arguments)},render:function(b,c){if(this.zoom&&!this.isDataDirty())return this.performZoom(b,c);this.dirty=this.isDirty();this.resetEvents();var d;this.dirty&&(f.forEach(this.series,n),this._eventSeries={},this.cleanGroup(),d=this.getGroup(),a.forEachRev(this.series,function(a){a.cleanGroup(d)}));var g=this.chart.theme,h=this._hScaler.scaler.getTransformerFromModel(this._hScaler),
l=this._vScaler.scaler.getTransformerFromModel(this._vScaler),k=Math.max(this._hScaler.bounds.lower,this._hAxis?this._hAxis.naturalBaseline:0),p=h(k),q=this.events(),r=this.getBarProperties(),B=this.series.length;f.forEach(this.series,function(a){a.hidden&&B--});for(var C=B,E=this.extractValues(this._vScaler),E=this.rearrangeValues(E,h,p),D=0;D<this.series.length;D++){var F=this.series[D];if(this.dirty||F.dirty){F.cleanGroup();this.opt.enableCache&&(F._rectFreePool=(F._rectFreePool?F._rectFreePool:
[]).concat(F._rectUsePool?F._rectUsePool:[]),F._rectUsePool=[]);var M=g.next("bar",[this.opt,F]);if(F.hidden)F.dyn.fill=M.series.fill,F.dyn.stroke=M.series.stroke;else{C--;var N=Array(F.data.length);d=F.group;for(var I=f.some(F.data,function(a){return"number"==typeof a||a&&!a.hasOwnProperty("x")}),G=I?Math.min(F.data.length,Math.ceil(this._vScaler.bounds.to)):F.data.length,O=I?Math.max(0,Math.floor(this._vScaler.bounds.from-1)):0;O<G;++O){var J=F.data[O];if(!this.isNullValue(J)){var Q=this.getValue(J,
O,D,I),H=E[D][O],K,R;this.opt.styleFunc||"number"!=typeof J?(K="number"!=typeof J?[J]:[],this.opt.styleFunc&&K.push(this.opt.styleFunc(J)),K=g.addMixin(M,"bar",K,!0)):K=g.post(M,"bar");if(H&&1<=r.height){var P={x:c.l+p+Math.min(H,0),y:b.height-c.b-l(Q.x+1.5)+r.gap+r.thickness*(B-C-1),width:Math.abs(H),height:r.height};K.series.shadow&&(R=m.clone(P),R.x+=K.series.shadow.dx,R.y+=K.series.shadow.dy,R=this.createRect(F,d,R).setFill(K.series.shadow.color).setStroke(K.series.shadow),this.animate&&this._animateBar(R,
c.l+p,-H));var L=this._plotFill(K.series.fill,b,c),L=this._shapeFill(L,P),L=this.createRect(F,d,P).setFill(L).setStroke(K.series.stroke);L.setFilter&&K.series.filter&&L.setFilter(K.series.filter);F.dyn.fill=L.getFill();F.dyn.stroke=L.getStroke();if(q){var T={element:"bar",index:O,run:F,shape:L,shadow:R,cx:Q.y,cy:Q.x+1.5,x:I?O:F.data[O].x,y:I?F.data[O]:F.data[O].y};this._connectEvents(T);N[O]=T}!isNaN(Q.py)&&Q.py>k&&(P.x+=h(Q.py),P.width-=h(Q.py));this.createLabel(d,J,P,K);this.animate&&this._animateBar(L,
c.l+p,-Math.abs(H))}}}this._eventSeries[F.name]=N;F.dirty=!1}}else g.skip(),this._reconnectEvents(F.name)}this.dirty=!1;e("dojo-bidi")&&this._checkOrientation(this.group,b,c);return this},getValue:function(a,b,c,d){d?(c="number"==typeof a?a:a.y,a=b):(c=a.y,a=a.x-1);return{y:c,x:a}},extractValues:function(a){for(var b=[],c=this.series.length-1;0<=c;--c){var d=this.series[c];if(this.dirty||d.dirty){var e=f.some(d.data,function(a){return"number"==typeof a||a&&!a.hasOwnProperty("x")}),g=e?Math.max(0,
Math.floor(a.bounds.from-1)):0,e=e?Math.min(d.data.length,Math.ceil(a.bounds.to)):d.data.length,h=b[c]=[];h.min=g;for(h.max=e;g<e;++g){var l=d.data[g];h[g]=this.isNullValue(l)?0:"number"==typeof l?l:l.y}}}return b},rearrangeValues:function(a,b,c){for(var d=0,e=a.length;d<e;++d){var f=a[d];if(f)for(var g=f.min,h=f.max;g<h;++g){var l=f[g];f[g]=this.isNullValue(l)?0:b(l)-c}}return a},isNullValue:function(a){if(null===a||"undefined"==typeof a)return!0;var b=this._hAxis?this._hAxis.isNullValue:p,c=this._vAxis?
this._vAxis.isNullValue:p;return"number"==typeof a?c(.5)||b(a):c(isNaN(a.x)?.5:a.x+.5)||null===a.y||b(a.y)},getBarProperties:function(){var a=h.calculateBarSize(this._vScaler.bounds.scale,this.opt);return{gap:a.gap,height:a.size,thickness:0}},_animateBar:function(a,b,d){0==d&&(d=1);c.animateTransform(m.delegate({shape:a,duration:1200,transform:[{name:"translate",start:[b-b/d,0],end:[0,0]},{name:"scale",start:[1/d,1],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/StackedBars":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./Bars","./commonStacked"],function(m,f,k,e){return m("dojox.charting.plot2d.StackedBars",k,{getSeriesStats:function(){var g=e.collectStats(this.series,f.hitch(this,"isNullValue")),d;g.hmin-=.5;g.hmax+=.5;d=g.hmin;g.hmin=g.vmin;g.vmin=d;d=g.hmax;g.hmax=g.vmax;g.vmax=d;return g},rearrangeValues:function(f,d,h){return e.rearrangeValues.call(this,f,d,h)}})})},"dojox/charting/plot2d/ClusteredBars":function(){define(["dojo/_base/declare","dojo/_base/array","./Bars","./common"],function(m,
f,k,e){return m("dojox.charting.plot2d.ClusteredBars",k,{getBarProperties:function(){var g=this.series.length;f.forEach(this.series,function(d){d.hidden&&g--});var d=e.calculateBarSize(this._vScaler.bounds.scale,this.opt,g);return{gap:d.gap,height:d.size,thickness:d.size}}})})},"dojox/charting/plot2d/Grid":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/sniff ./CartesianBase ./common dojox/lang/utils dojox/gfx/fx".split(" "),function(m,f,k,e,g,d,h,c){var b=function(a,b){return a.value-
b.value};return f("dojox.charting.plot2d.Grid",g,{defaultParams:{hMajorLines:!0,hMinorLines:!1,vMajorLines:!0,vMinorLines:!1,hStripes:!1,vStripes:!1,animate:null,enableCache:!1,renderOnAxis:!0},optionalParams:{majorHLine:{},minorHLine:{},majorVLine:{},minorVLine:{},hFill:{},vFill:{},hAlternateFill:{},vAlternateFill:{}},constructor:function(a,b){this.opt=m.clone(this.defaultParams);h.updateWithObject(this.opt,b);h.updateWithPattern(this.opt,b,this.optionalParams);this.animate=this.opt.animate;this.opt.enableCache&&
(this._lineFreePool=[],this._lineUsePool=[],this._rectFreePool=[],this._rectUsePool=[])},addSeries:function(a){return this},getSeriesStats:function(){return m.delegate(d.defaultStats)},cleanGroup:function(){this.inherited(arguments);this.opt.enableCache&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._rectFreePool=this._rectFreePool.concat(this._rectUsePool),this._rectUsePool=[])},createLine:function(a,b){var c;this.opt.enableCache&&0<this._lineFreePool.length?
(c=this._lineFreePool.pop(),c.setShape(b),a.add(c)):c=a.createLine(b);this.opt.enableCache&&this._lineUsePool.push(c);return c},createRect:function(a,b){var c;this.opt.enableCache&&0<this._rectFreePool.length?(c=this._rectFreePool.pop(),c.setShape(b),a.add(c)):c=a.createRect(b);this.opt.enableCache&&this._rectUsePool.push(c);return c},render:function(a,b){if(this.zoom)return this.performZoom(a,b);this.dirty=this.isDirty();if(!this.dirty)return this;this.cleanGroup();var c=this.getGroup(),d=this.chart.theme,
f;(e("ios")&&6>e("ios")||e("safari")&&!e("ios"))&&c.createRect({x:b.l,y:b.t,width:Math.max(0,a.width-b.l-b.r),height:Math.max(0,a.height-b.t-b.b)});if(this._vAxis){f=this._vAxis.getTicks();var g=this._vAxis.getScaler();if(null!=f&&null!=g){var h=g.scaler.getTransformerFromModel(g);this.opt.hStripes&&this._renderHRect(f,d.grid,a,b,g,h);this.opt.hMinorLines&&(c=this.opt.minorHLine||d.grid&&d.grid.minorLine||d.axis.minorTick,this._renderHLines(f.minor,c,a,b,g,h));this.opt.hMajorLines&&(c=this.opt.majorHLine||
d.grid&&d.grid.majorLine||d.axis.majorTick,this._renderHLines(f.major,c,a,b,g,h))}}this._hAxis&&(f=this._hAxis.getTicks(),g=this._hAxis.getScaler(),null!=f&&null!=g&&(h=g.scaler.getTransformerFromModel(g),this.opt.vStripes&&this._renderVRect(f,d.grid,a,b,g,h),f&&this.opt.vMinorLines&&(c=this.opt.minorVLine||d.grid&&d.grid.minorLine||d.axis.minorTick,this._renderVLines(f.minor,c,a,b,g,h)),f&&this.opt.vMajorLines&&(c=this.opt.majorVLine||d.grid&&d.grid.majorLine||d.axis.majorTick,this._renderVLines(f.major,
c,a,b,g,h))));this.dirty=!1;return this},_renderHLines:function(a,b,c,d,e,f){var g=this.getGroup();k.forEach(a,function(a){if(this.opt.renderOnAxis||a.value!=(this._vAxis.opt.leftBottom?e.bounds.from:e.bounds.to))a=c.height-d.b-f(a.value),a=this.createLine(g,{x1:d.l,y1:a,x2:c.width-d.r,y2:a}).setStroke(b),this.animate&&this._animateGrid(a,"h",d.l,d.r+d.l-c.width)},this)},_renderVLines:function(a,b,c,d,e,f){var g=this.getGroup();k.forEach(a,function(a){if(this.opt.renderOnAxis||a.value!=(this._hAxis.opt.leftBottom?
e.bounds.from:e.bounds.to))a=d.l+f(a.value),a=this.createLine(g,{x1:a,y1:d.t,x2:a,y2:c.height-d.b}).setStroke(b),this.animate&&this._animateGrid(a,"v",c.height-d.b,c.height-d.b-d.t)},this)},_renderHRect:function(a,c,d,e,f,g){var h,k,l;a=a.major.concat(a.minor);a.sort(b);a[0].value>f.bounds.from&&a.splice(0,0,{value:f.bounds.from});a[a.length-1].value<f.bounds.to&&a.push({value:f.bounds.to});f=this.getGroup();for(var m=0;m<a.length-1;m++)if(h=a[m],k=d.height-e.b-g(h.value),l=d.height-e.b-g(a[m+1].value),
h=0==m%2?this.opt.hAlternateFill||c&&c.alternateFill:this.opt.hFill||c&&c.fill)h=this.createRect(f,{x:e.l,y:k,width:d.width-e.r,height:k-l}).setFill(h),this.animate&&this._animateGrid(h,"h",e.l,e.r+e.l-d.width)},_renderVRect:function(a,c,d,e,f,g){var h,k,l;a=a.major.concat(a.minor);a.sort(b);a[0].value>f.bounds.from&&a.splice(0,0,{value:f.bounds.from});a[a.length-1].value<f.bounds.to&&a.push({value:f.bounds.to});f=this.getGroup();for(var m=0;m<a.length-1;m++)if(h=a[m],k=e.l+g(h.value),l=e.l+g(a[m+
1].value),h=0==m%2?this.opt.vAlternateFill||c&&c.alternateFill:this.opt.vFill||c&&c.fill)h=this.createRect(f,{x:k,y:e.t,width:l-k,height:d.width-e.r}).setFill(h),this.animate&&this._animateGrid(h,"v",d.height-e.b,d.height-e.b-e.t)},_animateGrid:function(a,b,d,e){c.animateTransform(m.delegate({shape:a,duration:1200,transform:[{name:"translate",start:"h"==b?[d,0]:[0,d],end:[0,0]},{name:"scale",start:"h"==b?[1/e,1]:[1,1/e],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Pie":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/dom-geometry dojo/_base/Color ./Base ./_PlotEvents ./common dojox/gfx dojox/gfx/matrix dojox/lang/functional dojox/lang/utils dojo/has".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p){return k("dojox.charting.plot2d.Pie",[d,h],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0,innerRadius:0,minWidth:0,zeroDataMessage:""},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(a,b){this.opt=m.clone(this.defaultParams);n.updateWithObject(this.opt,
b);n.updateWithPattern(this.opt,b,this.optionalParams);this.axes=[];this.run=null;this.dyn=[];this.runFilter=[];b&&b.hasOwnProperty("innerRadius")&&(this._plotSetInnerRadius=!0)},clear:function(){this.inherited(arguments);this.dyn=[];this.run=null;return this},setAxis:function(a){return this},addSeries:function(a){this.run=a;return this},getSeriesStats:function(){return m.delegate(c.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(c,d){if(!this.dirty)return this;
this.resetEvents();this.dirty=!1;this._eventSeries={};this.cleanGroup();var h=this.group,k=this.chart.theme;!this._plotSetInnerRadius&&k&&k.pieInnerRadius&&(this.opt.innerRadius=k.pieInnerRadius);var n=(c.width-d.l-d.r)/2,q=(c.height-d.t-d.b)/2,r=Math.min(n,q),z="font"in this.opt?this.opt.font:k.axis.tick.titleFont||"",y=z?b.normalizedLength(b.splitFontString(z).size):0,A=this.opt.hasOwnProperty("fontColor")?this.opt.fontColor:k.axis.tick.fontColor,B=a._degToRad(this.opt.startAngle),C=B,E,D,F,M,N=
this.run.data,I=this.events(),G=m.hitch(this,function(){var a=k.clone(),b=l.map(N,function(b){var c=[this.opt,this.run];null!==b&&"number"!=typeof b&&c.push(b);this.opt.styleFunc&&c.push(this.opt.styleFunc(b));return a.next("slice",c,!0)},this);"radius"in this.opt&&(r=this.opt.radius<r?this.opt.radius:r);var e={cx:d.l+n,cy:d.t+q,r:r},m=new g(A);this.opt.innerRadius&&(m.a=.1);var p=this._createRing(h,e).setStroke(m);this.opt.innerRadius&&p.setFill(m);this.opt.zeroDataMessage&&this.renderLabel(h,e.cx,
e.cy+y/3,this.opt.zeroDataMessage,{series:{font:z,fontColor:A}},null,"middle");this.dyn=[];f.forEach(N,function(a,e){this.dyn.push({fill:this._plotFill(b[e].series.fill,c,d),stroke:b[e].series.stroke})},this)});if(!this.run&&!this.run.data.ength)return G(),this;if("number"==typeof N[0]){E=l.map(N,"x ? Math.max(x, 0) : 0");if(l.every(E,"\x3c\x3d 0"))return G(),this;D=l.map(E,"/this",l.foldl(E,"+",0));this.opt.labels&&(F=f.map(D,function(a){return 0<a?this._getLabel(100*a)+"%":""},this))}else{E=l.map(N,
"x ? Math.max(x.y, 0) : 0");if(!E.length||l.every(E,"\x3c\x3d 0"))return G(),this;D=l.map(E,"/this",l.foldl(E,"+",0));this.opt.labels&&(F=f.map(D,function(a,b){if(0>a)return"";b=N[b];return b.hasOwnProperty("text")?b.text:this._getLabel(100*a)+"%"},this))}var O=l.map(N,function(a){var b=[this.opt,this.run];null!==a&&"number"!=typeof a&&b.push(a);this.opt.styleFunc&&b.push(this.opt.styleFunc(a));return k.next("slice",b,!0)},this);this.opt.labels&&(E=l.foldl1(l.map(F,function(a,c){return b._base._getTextBox(a,
{font:O[c].series.font}).w},this),"Math.max(a, b)")/2,0>this.opt.labelOffset&&(r=Math.min(n-2*E,q-y)+this.opt.labelOffset));this.opt.hasOwnProperty("radius")&&(r=this.opt.radius<.9*r?this.opt.radius:.9*r);!this.opt.radius&&this.opt.labels&&"columns"==this.opt.labelStyle?(r/=2,n>q&&n>2*r&&(r*=n/(2*r)),r>=.8*q&&(r=.8*q)):r>=.9*q&&(r=.9*q);M=r-this.opt.labelOffset;var J={cx:d.l+n,cy:d.t+q,r:r};this.dyn=[];var Q=Array(D.length),H=[],K=C,R=this.opt.minWidth;f.forEach(D,function(a,b){if(0===a)H[b]={step:0,
end:K,start:K,weak:!1};else{a=K+2*a*Math.PI;b===D.length-1&&(a=B+2*Math.PI);var c=a-K;H[b]={step:c,start:K,end:a,weak:c*r<R};K=a}});if(0<R){E=0;var P=R/r,G=0,L;for(L=H.length-1;0<=L;L--)H[L].weak&&(++E,G+=H[L].step,H[L].step=P);P*=E;if(P>Math.PI){P=Math.PI/E;for(L=0;L<H.length;++L)H[L].weak&&(H[L].step=P);P=Math.PI}if(0<E)for(P=1-(P-G)/2/Math.PI,L=0;L<H.length;++L)H[L].weak||(H[L].step*=P);for(L=0;L<H.length;++L)H[L].start=L?H[L].end:K,H[L].end=H[L].start+H[L].step;for(L=H.length-1;0<=L;--L)if(0!==
H[L].step){H[L].end=K+2*Math.PI;break}}var K=C,T,S;f.some(D,function(f,g){var k,l=N[g],n=O[g];if(1<=f){S=this._plotFill(n.series.fill,c,d);S=this._shapeFill(S,{x:J.cx-J.r,y:J.cy-J.r,width:2*J.r,height:2*J.r});S=this._pseudoRadialFill(S,{x:J.cx,y:J.cy},J.r);k=this._createRing(h,J).setFill(S).setStroke(n.series.stroke);this.dyn.push({fill:S,stroke:n.series.stroke});I&&(T={element:"slice",index:g,run:this.run,shape:k,x:g,y:"number"==typeof l?l:l.y,cx:J.cx,cy:J.cy,cr:r},this._connectEvents(T),Q[g]=T);
for(g+=1;g<D.length;g++)n=O[g],this.dyn.push({fill:n.series.fill,stroke:n.series.stroke});return!0}if(0===H[g].step)return this.dyn.push({fill:n.series.fill,stroke:n.series.stroke}),!1;f=H[g].step;k=J.cx+r*Math.cos(K);var p=J.cy+r*Math.sin(K),q=J.cx+r*Math.cos(K+f),t=J.cy+r*Math.sin(K+f),u=a._degToRad(this.opt.fanSize);if(n.series.fill&&"radial"===n.series.fill.type&&"fan"===this.opt.radGrad&&f>u){var v=h.createGroup(),u=Math.ceil(f/u),w=f/u;S=this._shapeFill(n.series.fill,{x:J.cx-J.r,y:J.cy-J.r,
width:2*J.r,height:2*J.r});var x,y,z,A,B,C;for(x=0;x<u;++x)y=K+(x-.2)*w,z=K+(x+1+.2)*w,A=0==x?k:J.cx+r*Math.cos(y),B=0==x?p:J.cy+r*Math.sin(y),C=x==u-1?q:J.cx+r*Math.cos(z),z=x==u-1?t:J.cy+r*Math.sin(z),this._createSlice(v,J,r,A,B,C,z,y,w).setFill(this._pseudoRadialFill(S,{x:J.cx,y:J.cy},r,K+(x+.5)*w,K+(x+.5)*w));u=n.series.stroke;this._createSlice(v,J,r,k,p,q,t,K,f).setStroke(u);k=v}else{u=n.series.stroke;k=this._createSlice(h,J,r,k,p,q,t,K,f).setStroke(u);if((S=n.series.fill)&&"radial"===S.type)S=
this._shapeFill(S,{x:J.cx-J.r,y:J.cy-J.r,width:2*J.r,height:2*J.r}),"linear"===this.opt.radGrad&&(S=this._pseudoRadialFill(S,{x:J.cx,y:J.cy},r,K,K+f));else if(S&&"linear"===S.type){p=m.clone(k.getBoundingBox());if("svg"===b.renderer){q={w:0,h:0};try{q=e.position(k.rawNode)}catch(Ja){}q.h>p.height&&(p.height=q.h);q.w>p.width&&(p.width=q.w)}S=this._plotFill(S,c,d);S=this._shapeFill(S,p)}k.setFill(S)}this.dyn.push({fill:S,stroke:n.series.stroke});I&&(T={element:"slice",index:g,run:this.run,shape:k,x:g,
y:"number"==typeof l?l:l.y,cx:J.cx,cy:J.cy,cr:r},this._connectEvents(T),Q[g]=T);K+=f;return!1},this);if(this.opt.labels){var W=p("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)K=C=B,f.some(D,function(a,b){if(0>=a&&!this.opt.minWidth)return!1;var d=O[b];if(1<=a)return this.renderLabel(h,J.cx,J.cy+y/2,F[b],d,0<this.opt.labelOffset),!0;a=C+2*a*Math.PI;b+1==D.length&&(a=B+2*Math.PI);if(this.opt.omitLabels&&.001>a-C)return!1;var e=K+H[b].step/2,f=J.cx+M*Math.cos(e);this.renderLabel(h,
W?c.width-f:f,J.cy+M*Math.sin(e)+y/2,F[b],d,0<this.opt.labelOffset);K+=H[b].step;C=a;return!1},this);else if("columns"==this.opt.labelStyle){var Y=this.opt.omitLabels,K=C=B,X=[],aa=0;for(E=D.length-1;0<=E;--E)D[E]&&++aa;f.forEach(D,function(a,b){a=C+2*a*Math.PI;b+1==D.length&&(a=B+2*Math.PI);if(0!==this.minWidth||.001<=a-C){var c=K+H[b].step/2;1!==aa||this.opt.minWidth||(c=(C+a)/2);X.push({angle:c,left:0>Math.cos(c),theme:O[b],index:b,omit:Y?.001>a-C:!1})}C=a;K+=H[b].step},this);var U=b._base._getTextBox("a",
{font:z,whiteSpace:"nowrap"}).h;this._getProperLabelRadius(X,U,1.1*J.r);var ha=J.cx-2*J.r,Z=J.cx+2*J.r;f.forEach(X,function(a){if(!a.omit){var c=O[a.index],d=0;c&&c.axis&&c.axis.tick&&c.axis.tick.labelGap&&(d=c.axis.tick.labelGap);var f=b._base._getTextBox(F[a.index],{font:c.series.font,whiteSpace:"nowrap",paddingLeft:d+"px"}).w,g=J.cx+a.labelR*Math.cos(a.angle),k=J.cy+a.labelR*Math.sin(a.angle),l=a.left?ha+f:Z-f,d=a.left?ha:l+d,n=J.r,n=h.createPath().moveTo(J.cx+n*Math.cos(a.angle),J.cy+n*Math.sin(a.angle));
Math.abs(a.labelR*Math.cos(a.angle))<2*J.r-f&&n.lineTo(g,k);n.lineTo(l,k).setStroke(a.theme.series.labelWiring);n.moveToBack();g=this.renderLabel(h,d,U/3+k||0,F[a.index],c,!1,"left");I&&!this.opt.htmlLabels&&(c=b._base._getTextBox(F[a.index],{font:a.theme.series.font}).w||0,f=b.normalizedLength(b.splitFontString(a.theme.series.font).size),T={element:"labels",index:a.index,run:this.run,shape:g,x:d,y:k,label:F[a.index]},d=g.getShape(),k=e.position(this.chart.node,!0),d=m.mixin({type:"rect"},{x:d.x,
y:d.y-2*f}),d.x+=k.x,d.y+=k.y,d.x=Math.round(d.x),d.y=Math.round(d.y),d.width=Math.ceil(c),d.height=Math.ceil(f),T.aroundRect=d,this._connectEvents(T),Q[D.length+a.index]=T)}},this)}}var ba=0;this._eventSeries[this.run.name]=l.map(N,function(a){return 0>=a?null:Q[ba++]});p("dojo-bidi")&&this._checkOrientation(this.group,c,d);return this},_getProperLabelRadius:function(a,b,c){if(1==a.length)a[0].labelR=c;else{var d={},e={},f=2,g=2,h,k;for(h=0;h<a.length;++h)k=Math.abs(Math.sin(a[h].angle)),a[h].left?
f>k&&(f=k,d=a[h]):g>k&&(g=k,e=a[h]);d.labelR=e.labelR=c;this._caculateLabelR(d,a,b);this._caculateLabelR(e,a,b)}},_caculateLabelR:function(a,b,c){var d,e,f=b.length,g=a.labelR,h=b[a.index].left?-c:c;e=0;c=a.index;for(d=(c+1)%f;e<f&&b[c].left===b[d].left;++e)g=(Math.sin(b[c].angle)*g+h)/Math.sin(b[d].angle),g=Math.max(a.labelR,g),b[d].labelR=g,c=(c+1)%f,d=(d+1)%f;e>=f&&(b[0].labelR=a.labelR);e=0;c=a.index;for(d=(c||f)-1;e<f&&b[c].left===b[d].left;++e)g=(Math.sin(b[c].angle)*g-h)/Math.sin(b[d].angle),
g=Math.max(a.labelR,g),b[d].labelR=g,c=(c||f)-1,d=(d||f)-1},_createRing:function(a,b){var c=this.opt.innerRadius;0<c?c=c/100*b.r:0>c&&(c=-c);return c?a.createPath({}).setAbsoluteMode(!0).moveTo(b.cx,b.cy-b.r).arcTo(b.r,b.r,0,!1,!0,b.cx+b.r,b.cy).arcTo(b.r,b.r,0,!0,!0,b.cx,b.cy-b.r).closePath().moveTo(b.cx,b.cy-c).arcTo(c,c,0,!1,!0,b.cx+c,b.cy).arcTo(c,c,0,!0,!0,b.cx,b.cy-c).closePath():a.createCircle(b)},_createSlice:function(a,b,c,d,e,f,g,h,k){var l=this.opt.innerRadius;0<l?l=l/100*b.r:0>l&&(l=-l);
if(l){var m=b.cx+l*Math.cos(h),n=b.cy+l*Math.sin(h),p=b.cx+l*Math.cos(h+k);b=b.cy+l*Math.sin(h+k);return a.createPath({}).setAbsoluteMode(!0).moveTo(m,n).lineTo(d,e).arcTo(c,c,0,k>Math.PI,!0,f,g).lineTo(p,b).arcTo(l,l,0,k>Math.PI,!1,m,n).closePath()}return a.createPath({}).setAbsoluteMode(!0).moveTo(b.cx,b.cy).lineTo(d,e).arcTo(c,c,0,k>Math.PI,!0,f,g).lineTo(b.cx,b.cy).closePath()}})})},"dojox/charting/plot2d/Bubble":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=b.lambda("item.purgeGroup()");return f("dojox.charting.plot2d.Bubble",[g,d],{defaultParams:{animate:null},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelFunc:null},constructor:function(b,c){this.opt=m.clone(m.mixin(this.opt,this.defaultParams));a.updateWithObject(this.opt,c);a.updateWithPattern(this.opt,c,this.optionalParams);this.opt.labelFunc||(this.opt.labelFunc=function(a,b,c){return this._getLabel(a.size,
b,c)});this.animate=this.opt.animate},render:function(a,b){var d;if(this.zoom&&!this.isDataDirty())return this.performZoom(a,b);this.resetEvents();if(this.dirty=this.isDirty())k.forEach(this.series,n),this._eventSeries={},this.cleanGroup(),d=this.getGroup(),c.forEachRev(this.series,function(a){a.cleanGroup(d)});for(var f=this.chart.theme,g=this._hScaler.scaler.getTransformerFromModel(this._hScaler),l=this._vScaler.scaler.getTransformerFromModel(this._vScaler),m=this.events(),p=0;p<this.series.length;p++){var q=
this.series[p];if(this.dirty||q.dirty)if(q.cleanGroup(),q.data.length)if("number"==typeof q.data[0])console.warn("dojox.charting.plot2d.Bubble: the data in the following series cannot be rendered as a bubble chart; ",q);else{var y=f.next("circle",[this.opt,q]),A=k.map(q.data,function(c){return c?{x:g(c.x)+b.l,y:a.height-b.b-l(c.y),radius:c.size/2*this._vScaler.bounds.scale}:null},this);if(q.hidden)q.dyn.fill=y.series.fill,q.dyn.stroke=y.series.stroke;else{d=q.group;var B=null,C=null,E=null,D=this.opt.styleFunc,
F=function(a){return D?f.addMixin(y,"circle",[a,D(a)],!0):f.addMixin(y,"circle",a,!0)};y.series.shadow&&(E=k.map(A,function(c,e){return this.isNullValue(c)?null:(e=F(q.data[e]).series.shadow,e=d.createCircle({cx:c.x+e.dx,cy:c.y+e.dy,r:c.radius}).setStroke(e).setFill(e.color),this.animate&&this._animateBubble(e,a.height-b.b,c.radius),e)},this),E.length&&(q.dyn.shadow=E[E.length-1].getStroke()));y.series.outline&&(C=k.map(A,function(c,e){return this.isNullValue(c)?null:(e=F(q.data[e]),e=h.makeStroke(e.series.outline),
e.width=2*e.width+(y.series.stroke&&y.series.stroke.width||0),e=d.createCircle({cx:c.x,cy:c.y,r:c.radius}).setStroke(e),this.animate&&this._animateBubble(e,a.height-b.b,c.radius),e)},this),C.length&&(q.dyn.outline=C[C.length-1].getStroke()));B=k.map(A,function(c,e){if(!this.isNullValue(c)){var f=F(q.data[e]),g={x:c.x-c.radius,y:c.y-c.radius,width:2*c.radius,height:2*c.radius},h=this._plotFill(f.series.fill,a,b),h=this._shapeFill(h,g),h=d.createCircle({cx:c.x,cy:c.y,r:c.radius}).setFill(h).setStroke(f.series.stroke);
h.setFilter&&f.series.filter&&h.setFilter(f.series.filter);this.animate&&this._animateBubble(h,a.height-b.b,c.radius);this.createLabel(d,q.data[e],g,f);return h}return null},this);B.length&&(q.dyn.fill=B[B.length-1].getFill(),q.dyn.stroke=B[B.length-1].getStroke());if(m){var M=Array(B.length);k.forEach(B,function(a,b){null!==a&&(a={element:"circle",index:b,run:q,shape:a,outline:C&&C[b]||null,shadow:E&&E[b]||null,x:q.data[b].x,y:q.data[b].y,r:q.data[b].size/2,cx:A[b].x,cy:A[b].y,cr:A[b].radius},this._connectEvents(a),
M[b]=a)},this);this._eventSeries[q.name]=M}else delete this._eventSeries[q.name];q.dirty=!1}}else q.dirty=!1,f.skip();else f.skip(),this._reconnectEvents(q.name)}this.dirty=!1;e("dojo-bidi")&&this._checkOrientation(this.group,a,b);return this},_animateBubble:function(a,b,c){l.animateTransform(m.delegate({shape:a,duration:1200,transform:[{name:"translate",start:[0,b],end:[0,0]},{name:"scale",start:[0,1/c],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Candlesticks":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=b.lambda("item.purgeGroup()");return f("dojox.charting.plot2d.Candlesticks",[g,d],{defaultParams:{gap:2,animate:null},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:""},constructor:function(b,c){this.opt=m.clone(this.defaultParams);a.updateWithObject(this.opt,c);a.updateWithPattern(this.opt,c,this.optionalParams);this.animate=this.opt.animate},collectStats:function(a){for(var b=m.delegate(h.defaultStats),c=0;c<
a.length;c++){var d=a[c];if(d.data.length){var e=b.vmin,f=b.vmax;"ymin"in d&&"ymax"in d||k.forEach(d.data,function(a,c){this.isNullValue(a)||(c=a.x||c+1,b.hmin=Math.min(b.hmin,c),b.hmax=Math.max(b.hmax,c),b.vmin=Math.min(b.vmin,a.open,a.close,a.high,a.low),b.vmax=Math.max(b.vmax,a.open,a.close,a.high,a.low))},this);"ymin"in d&&(b.vmin=Math.min(e,d.ymin));"ymax"in d&&(b.vmax=Math.max(f,d.ymax))}}return b},getSeriesStats:function(){var a=this.collectStats(this.series);a.hmin-=.5;a.hmax+=.5;return a},
render:function(a,b){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,b);this.resetEvents();this.dirty=this.isDirty();var d;this.dirty&&(k.forEach(this.series,n),this._eventSeries={},this.cleanGroup(),d=this.getGroup(),c.forEachRev(this.series,function(a){a.cleanGroup(d)}));var f=this.chart.theme,g,l,m=this._hScaler.scaler.getTransformerFromModel(this._hScaler),p=this._vScaler.scaler.getTransformerFromModel(this._vScaler),q=this.events();g=h.calculateBarSize(this._hScaler.bounds.scale,
this.opt);l=g.gap;g=g.size;for(var y=this.series.length-1;0<=y;--y){var A=this.series[y];if(this.dirty||A.dirty){A.cleanGroup();var B=f.next("candlestick",[this.opt,A]),C=Array(A.data.length);if(A.hidden)A.dyn.fill=B.series.fill,A.dyn.stroke=B.series.stroke;else{d=A.group;for(var E=0;E<A.data.length;++E){var D=A.data[E];if(!this.isNullValue(D)){var F=f.addMixin(B,"candlestick",D,!0),M=m(D.x||E+.5)+b.l+l,N=a.height-b.b,I=p(D.open),G=p(D.close),O=p(D.high),J=p(D.low);if("mid"in D)var Q=p(D.mid);if(J>
O)var H=O,O=J,J=H;if(1<=g){var H=I>G,K={x1:g/2,x2:g/2,y1:N-O,y2:N-J},R={x:0,y:N-Math.max(I,G),width:g,height:Math.max(H?I-G:G-I,1)},P=d.createGroup();P.setTransform({dx:M,dy:0});var L=P.createGroup();L.createLine(K).setStroke(F.series.stroke);L.createRect(R).setStroke(F.series.stroke).setFill(H?F.series.fill:"white");"mid"in D&&L.createLine({x1:F.series.stroke?F.series.stroke.width||1:1,x2:g-(F.series.stroke?F.series.stroke.width||1:1),y1:N-Q,y2:N-Q}).setStroke(H?"white":F.series.stroke);A.dyn.fill=
F.series.fill;A.dyn.stroke=F.series.stroke;q&&(D={element:"candlestick",index:E,run:A,shape:L,x:M,y:N-Math.max(I,G),cx:g/2,cy:N-Math.max(I,G)+Math.max(H?I-G:G-I,1)/2,width:g,height:Math.max(H?I-G:G-I,1),data:D},this._connectEvents(D),C[E]=D)}this.animate&&this._animateCandlesticks(P,N-J,O-J)}}this._eventSeries[A.name]=C;A.dirty=!1}}else f.skip(),this._reconnectEvents(A.name)}this.dirty=!1;e("dojo-bidi")&&this._checkOrientation(this.group,a,b);return this},tooltipFunc:function(a){return'\x3ctable cellpadding\x3d"1" cellspacing\x3d"0" border\x3d"0" style\x3d"font-size:0.9em;"\x3e\x3ctr\x3e\x3ctd\x3eOpen:\x3c/td\x3e\x3ctd align\x3d"right"\x3e\x3cstrong\x3e'+
a.data.open+'\x3c/strong\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3eHigh:\x3c/td\x3e\x3ctd align\x3d"right"\x3e\x3cstrong\x3e'+a.data.high+'\x3c/strong\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3eLow:\x3c/td\x3e\x3ctd align\x3d"right"\x3e\x3cstrong\x3e'+a.data.low+'\x3c/strong\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3eClose:\x3c/td\x3e\x3ctd align\x3d"right"\x3e\x3cstrong\x3e'+a.data.close+"\x3c/strong\x3e\x3c/td\x3e\x3c/tr\x3e"+(void 0!==a.data.mid?'\x3ctr\x3e\x3ctd\x3eMid:\x3c/td\x3e\x3ctd align\x3d"right"\x3e\x3cstrong\x3e'+
a.data.mid+"\x3c/strong\x3e\x3c/td\x3e\x3c/tr\x3e":"")+"\x3c/table\x3e"},_animateCandlesticks:function(a,b,c){l.animateTransform(m.delegate({shape:a,duration:1200,transform:[{name:"translate",start:[0,b-b/c],end:[0,0]},{name:"scale",start:[1,1/c],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/OHLC":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l){var n=b.lambda("item.purgeGroup()");return k("dojox.charting.plot2d.OHLC",[g,d],{defaultParams:{gap:2,animate:null},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:""},constructor:function(b,c){this.opt=m.clone(this.defaultParams);a.updateWithObject(this.opt,c);a.updateWithPattern(this.opt,c,this.optionalParams);this.animate=this.opt.animate},collectStats:function(a){for(var b=m.delegate(h.defaultStats),c=0;c<a.length;c++){var d=
a[c];if(d.data.length){var e=b.vmin,g=b.vmax;"ymin"in d&&"ymax"in d||f.forEach(d.data,function(a,c){this.isNullValue(a)||(c=a.x||c+1,b.hmin=Math.min(b.hmin,c),b.hmax=Math.max(b.hmax,c),b.vmin=Math.min(b.vmin,a.open,a.close,a.high,a.low),b.vmax=Math.max(b.vmax,a.open,a.close,a.high,a.low))},this);"ymin"in d&&(b.vmin=Math.min(e,d.ymin));"ymax"in d&&(b.vmax=Math.max(g,d.ymax))}}return b},getSeriesStats:function(){var a=this.collectStats(this.series);a.hmin-=.5;a.hmax+=.5;return a},render:function(a,
b){if(this.zoom&&!this.isDataDirty())return this.performZoom(a,b);this.resetEvents();if(this.dirty=this.isDirty()){f.forEach(this.series,n);this._eventSeries={};this.cleanGroup();var d=this.getGroup();c.forEachRev(this.series,function(a){a.cleanGroup(d)})}var g=this.chart.theme,k,l,m=this._hScaler.scaler.getTransformerFromModel(this._hScaler),p=this._vScaler.scaler.getTransformerFromModel(this._vScaler),q=this.events();k=h.calculateBarSize(this._hScaler.bounds.scale,this.opt);l=k.gap;k=k.size;for(var y=
0;y<this.series.length;y++){var A=this.series[y];if(this.dirty||A.dirty){A.cleanGroup();for(var B=g.next("candlestick",[this.opt,A]),d=A.group,C=Array(A.data.length),E=0;E<A.data.length;++E){var D=A.data[E];if(!this.isNullValue(D)){var F=g.addMixin(B,"candlestick",D,!0),M=m(D.x||E+.5)+b.l+l,N=a.height-b.b,I=p(D.open),G=p(D.close),O=p(D.high),J=p(D.low);if(J>O)var Q=O,O=J,J=Q;if(1<=k){var Q={x1:k/2,x2:k/2,y1:N-O,y2:N-J},H={x1:0,x2:k/2+(F.series.stroke?F.series.stroke.width||1:1)/2,y1:N-I,y2:N-I},K=
{x1:k/2-(F.series.stroke?F.series.stroke.width||1:1)/2,x2:k,y1:N-G,y2:N-G},R=d.createGroup();R.setTransform({dx:M,dy:0});var P=R.createGroup();P.createLine(Q).setStroke(F.series.stroke);P.createLine(H).setStroke(F.series.stroke);P.createLine(K).setStroke(F.series.stroke);A.dyn.stroke=F.series.stroke;q&&(D={element:"candlestick",index:E,run:A,shape:P,x:M,y:N-Math.max(I,G),cx:k/2,cy:N-Math.max(I,G)+Math.max(I>G?I-G:G-I,1)/2,width:k,height:Math.max(I>G?I-G:G-I,1),data:D},this._connectEvents(D),C[E]=
D)}this.animate&&this._animateOHLC(R,N-J,O-J)}}this._eventSeries[A.name]=C;A.dirty=!1}else g.skip(),this._reconnectEvents(A.name)}this.dirty=!1;e("dojo-bidi")&&this._checkOrientation(this.group,a,b);return this},_animateOHLC:function(a,b,c){l.animateTransform(m.delegate({shape:a,duration:1200,transform:[{name:"translate",start:[0,b-b/c],end:[0,0]},{name:"scale",start:[1,1/c],end:[1,1]},{name:"original"}]},this.animate)).play()}})})},"dojox/charting/plot2d/Spider":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/dom-geometry dojo/_base/fx dojo/fx dojo/sniff ./Base ./_PlotEvents ./common ../axis2d/common dojox/gfx dojox/gfx/matrix dojox/gfx/fx dojox/lang/functional dojox/lang/utils dojo/fx/easing".split(" "),
function(m,f,k,e,g,d,h,c,b,a,l,n,p,q,r,t,w,u){return f("dojox.charting.plot2d.Spider",[b,a],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:.2,spiderOrigin:.16,markerSize:3,spiderType:"polygon",animationType:u.backOut,animate:null,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",
fontColor:""},constructor:function(a,b){this.opt=m.clone(this.defaultParams);w.updateWithObject(this.opt,b);w.updateWithPattern(this.opt,b,this.optionalParams);this.dyn=[];this.datas={};this.labelKey=[];this.oldSeriePoints={};this.animate=null===this.opt.animate?{}:this.opt.animate;this.animations={}},clear:function(){this.inherited(arguments);this.dyn=[];this.axes=[];this.datas={};this.labelKey=[];this.oldSeriePoints={};this.animations={};return this},setAxis:function(a){a&&(void 0!=a.opt.min&&(this.datas[a.name].min=
a.opt.min),void 0!=a.opt.max&&(this.datas[a.name].max=a.opt.max));return this},addSeries:function(a){this.series.push(a);for(var b in a.data){var c=a.data[b],d=this.datas[b];d?(d.vlist.push(c),d.min=Math.min(d.min,c),d.max=Math.max(d.max,c)):(d="__"+b,this.axes.push(d),this[d]=b,this.datas[b]={min:c,max:c,vlist:[c]})}if(0>=this.labelKey.length)for(b in a.data)this.labelKey.push(b);return this},getSeriesStats:function(){return l.collectSimpleStats(this.series,function(a){return null===a})},render:function(a,
b){if(!this.dirty)return this;this.dirty=!1;this.cleanGroup();var c=this.group,d=this.chart.theme;this.resetEvents();if(!this.series||!this.series.length)return this;var f=this.opt,h=d.axis,k=(a.width-b.l-b.r)/2,l=(a.height-b.t-b.b)/2,m=Math.min(k,l),r=f.font||h.majorTick&&h.majorTick.font||h.tick&&h.tick.font||"normal normal normal 7pt Tahoma",u=f.axisFont||h.tick&&h.tick.titleFont||"normal normal normal 11pt Tahoma",v=f.axisTickFontColor||h.majorTick&&h.majorTick.fontColor||h.tick&&h.tick.fontColor||
"silver",w=f.axisFontColor||h.tick&&h.tick.titleFontColor||"black",x=f.axisColor||h.tick&&h.tick.axisColor||"silver",O=f.spiderColor||h.tick&&h.tick.spiderColor||"silver",J=f.axisWidth||h.stroke&&h.stroke.width||2,Q=f.spiderWidth||h.stroke&&h.stroke.width||2,h=f.seriesWidth||h.stroke&&h.stroke.width||2,H=p.normalizedLength(p.splitFontString(u).size),K=q._degToRad(f.startAngle),R,P,L,T,S,W,Y=f.spiderOrigin,X=3<=f.divisions?f.divisions:3,aa=f.markerSize,U=f.spiderType,ha=f.animationType,Z=-10>f.labelOffset?
f.labelOffset:-10,ba;f.labels&&(m=e.map(this.series,function(a){return a.name},this),m=t.foldl1(t.map(m,function(a){return p._base._getTextBox(a,{font:d.series.font}).w},this),"Math.max(a, b)")/2,m=Math.min(k-2*m,l-H)+Z,R=m-Z);"radius"in f&&(m=f.radius,R=m-Z);m/=1.2;b={cx:b.l+k,cy:b.t+l,r:m};for(k=0;k<this.series.length;k++)if(ba=this.series[k],this.dirty||ba.dirty){if(ba.cleanGroup(),H=ba.data,null!==H&&(l=this._getObjectLength(H),!P||0>=P.length))if(P=[],L=[],W=[],this._buildPoints(P,l,b,m,K,!0,
a),this._buildPoints(L,l,b,m*Y,K,!0,a),this._buildPoints(W,l,b,R,K,!1,a),2<X)for(T=[],S=[],H=0;H<X-2;H++)T[H]=[],this._buildPoints(T[H],l,b,m*(Y+(1-Y)*(H+1)/(X-1)),K,!0,a),S[H]=m*(Y+(1-Y)*(H+1)/(X-1))}else d.skip();l=c.createGroup();x={color:x,width:J};k={color:O,width:Q};for(H=P.length-1;0<=H;--H)O=P[H],Q={x:O.x+.2*(O.x-b.cx),y:O.y+.2*(O.y-b.cy)},O={x:O.x+.2*(O.x-b.cx)/2,y:O.y+.2*(O.y-b.cy)/2},l.createLine({x1:b.cx,y1:b.cy,x2:Q.x,y2:Q.y}).setStroke(x),this._drawArrow(l,Q,O,x);l=c.createGroup();for(H=
W.length-1;0<=H;--H)O=W[H],Q=p._base._getTextBox(this.labelKey[H],{font:u}).w||0,x=this.opt.htmlLabels&&"vml"!=p.renderer?"html":"gfx",O=n.createText[x](this.chart,l,g.isBodyLtr()||"html"!=x?O.x:O.x+Q-a.width,O.y,"middle",this.labelKey[H],u,w),this.opt.htmlLabels&&this.htmlElements.push(O);u=c.createGroup();if("polygon"==U){if(u.createPolyline(P).setStroke(k),u.createPolyline(L).setStroke(k),0<T.length)for(H=T.length-1;0<=H;--H)u.createPolyline(T[H]).setStroke(k)}else if(u.createCircle({cx:b.cx,cy:b.cy,
r:m}).setStroke(k),u.createCircle({cx:b.cx,cy:b.cy,r:m*Y}).setStroke(k),0<S.length)for(H=S.length-1;0<=H;--H)u.createCircle({cx:b.cx,cy:b.cy,r:S[H]}).setStroke(k);l=this._getObjectLength(this.datas);w=c.createGroup();T=0;for(var ka in this.datas){S=this.datas[ka];P=S.min;S=S.max;S-=P;u=K+2*Math.PI*T/l;for(k=0;k<X;k++)W=P+S*k/(X-1),O=this._getCoordinate(b,m*(Y+(1-Y)*k/(X-1)),u,a),W=this._getLabel(W),Q=p._base._getTextBox(W,{font:r}).w||0,x=this.opt.htmlLabels&&"vml"!=p.renderer?"html":"gfx",this.opt.htmlLabels&&
this.htmlElements.push(n.createText[x](this.chart,w,g.isBodyLtr()||"html"!=x?O.x:O.x+Q-a.width,O.y,"start",W,r,v));T++}this.chart.seriesShapes={};for(k=this.series.length-1;0<=k;k--)if(ba=this.series[k],H=ba.data,null!==H){var r=d.next("spider",[f,ba]),ga=p.normalizeColor(r.series.fill),r={color:r.series.fill,width:h};ga.a=f.seriesFillAlpha;ba.dyn={fill:ga,stroke:r};if(!ba.hidden){var ia=[],na=[];T=0;for(ka in H)S=this.datas[ka],P=S.min,S=S.max,S-=P,v=H[ka],u=K+2*Math.PI*T/l,O=this._getCoordinate(b,
m*(Y+(1-Y)*(v-P)/S),u,a),ia.push(O),na.push({sname:ba.name,key:ka,data:v}),T++;ia[ia.length]=ia[0];na[na.length]=na[0];var v=this._getBoundary(ia),wa=ba.group,r=this._createSeriesEntry(wa,this.oldSeriePoints[ba.name]||L,ia,ga,r,m,Y,aa,ha);this.chart.seriesShapes[ba.name]=r;this.oldSeriePoints[ba.name]=ia;this._connectEvents({element:"spider_poly",index:k,id:"spider_poly_"+ba.name,run:ba,plot:this,shape:r.poly,parent:wa,brect:v,cx:b.cx,cy:b.cy,cr:m,f:ga,s:c});this._connectEvents({element:"spider_plot",
index:k,id:"spider_plot_"+ba.name,run:ba,plot:this,shape:ba.group});e.forEach(r.circles,function(a,b){this._connectEvents({element:"spider_circle",index:b,id:"spider_circle_"+ba.name+b,run:ba,plot:this,shape:a,parent:wa,tdata:na[b],cx:ia[b].x,cy:ia[b].y,f:ga,s:c})},this)}}return this},_createSeriesEntry:function(a,b,c,f,g,l,n,p,q){l=this.animate?b:c;var r=a.createPolyline(l).setFill(f).setStroke(g),t=[];for(n=0;n<l.length;n++){var u=l[n],u=a.createCircle({cx:u.x,cy:u.y,r:p}).setFill(f).setStroke(g);
t.push(u)}this.animate&&(f=e.map(c,function(a,c){a=new d.Animation(m.delegate({duration:1E3,easing:q,curve:[b[c].y,a.y]},this.animate));var e=t[c];k.connect(a,"onAnimate",function(a){var b=r.getShape();b.points[c].y=a;r.setShape(b);b=e.getShape();b.cy=a;e.setShape(b)});return a},this),c=e.map(c,function(a,c){a=new d.Animation(m.delegate({duration:1E3,easing:q,curve:[b[c].x,a.x]},this.animate));var e=t[c];k.connect(a,"onAnimate",function(a){var b=r.getShape();b.points[c].x=a;r.setShape(b);b=e.getShape();
b.cx=a;e.setShape(b)});return a},this),h.combine(f.concat(c)).play());return{group:a,poly:r,circles:t}},plotEvent:function(a){"spider_plot"==a.element&&("onmouseover"!=a.type||c("ie")||a.shape.moveToFront())},tooltipFunc:function(a){return"spider_circle"==a.element?a.tdata.sname+"\x3cbr/\x3e"+a.tdata.key+"\x3cbr/\x3e"+a.tdata.data:null},_getBoundary:function(a){for(var b=a[0].x,c=a[0].x,d=a[0].y,e=a[0].y,f=0;f<a.length;f++)var g=a[f],b=Math.max(g.x,b),d=Math.max(g.y,d),c=Math.min(g.x,c),e=Math.min(g.y,
e);return{x:c,y:e,width:b-c,height:d-e}},_drawArrow:function(a,b,c,d){var e=Math.sqrt(Math.pow(c.x-b.x,2)+Math.pow(c.y-b.y,2)),f=(c.y-b.y)/e,g=(c.x-b.x)/e;a.createPolyline([b,{x:c.x+e/3*-f,y:c.y+e/3*g},{x:c.x+e/3*f,y:c.y+e/3*-g}]).setFill(d.color).setStroke(d)},_buildPoints:function(a,b,c,d,e,f,g){for(var h=0;h<b;h++)a.push(this._getCoordinate(c,d,e+2*Math.PI*h/b,g));f&&a.push(this._getCoordinate(c,d,e+2*Math.PI,g))},_getCoordinate:function(a,b,d,e){var f=a.cx+b*Math.cos(d);c("dojo-bidi")&&this.chart.isRightToLeft()&&
e&&(f=e.width-f);return{x:f,y:a.cy+b*Math.sin(d)}},_getObjectLength:function(a){var b=0;if(m.isObject(a))for(var c in a)b++;return b},_getLabel:function(a){return l.getLabel(a,this.opt.fixed,this.opt.precision)}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),function(m,f,k,e,g,d,h,c,b,a,l){k.isAsync||a(0,function(){l(["./fx/Toggler"])});k=k.fx={};a={_fire:function(a,b){this[a]&&
this[a].apply(this,b||[]);return this}};var n=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;e.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};n.prototype=new f;m.extend(n,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=
null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=g.after(this._current,"onAnimate",m.hitch(this,"_onAnimate"),!0),this._onEndCtx=g.after(this._current,"onEnd",m.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==this._current.status())return this;var c=g.after(this._current,"beforeBegin",m.hitch(this,function(){this._fire("beforeBegin")}),
!0),d=g.after(this._current,"onBegin",m.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),e=g.after(this._current,"onPlay",m.hitch(this,function(a){this._fire("onPlay",arguments);c.remove();d.remove();e.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=g.after(this._current,"onAnimate",m.hitch(this,"_onAnimate"),!0);this._onEndCtx&&this._onEndCtx.remove();this._onEndCtx=g.after(this._current,"onEnd",m.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,
arguments);return this},pause:function(){if(this._current){var a=g.after(this._current,"onPause",m.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(a,b){this.pause();var c=this.duration*a;this._current=null;e.some(this._animations,function(a,b){if(c<=a.duration)return this._current=a,this._index=b,!0;c-=a.duration;return!1},this);this._current&&this._current.gotoPercent(c/this._current.duration);b&&this.play();return this},
stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=g.after(this._current,"onStop",m.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});
m.extend(n,a);k.chain=function(a){return new n(m.isArray(a)?a:Array.prototype.slice.call(a,0))};var p=function(a){this._animations=a||[];this._connects=[];this.duration=this._finished=0;e.forEach(a,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(g.after(a,"onEnd",m.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=new d.Animation({curve:[0,1],duration:this.duration});var b=this;e.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),
function(a){b._connects.push(g.after(b._pseudoAnimation,a,function(){b._fire(a,arguments)},!0))})};m.extend(p,{_doAction:function(a,b){e.forEach(this._animations,function(c){c[a].apply(c,b)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(a,b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",
arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var c=this.duration*a;e.forEach(this._animations,function(a){a.gotoPercent(a.duration<c?1:c/a.duration,b)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop();e.forEach(this._connects,function(a){a.remove()})}});m.extend(p,a);k.combine=function(a){return new p(m.isArray(a)?
a:Array.prototype.slice.call(a,0))};k.wipeIn=function(a){var b=a.node=h.byId(a.node),e=b.style,f;a=d.animateProperty(m.mixin({properties:{height:{start:function(){f=e.overflow;e.overflow="hidden";if("hidden"==e.visibility||"none"==e.display)return e.height="1px",e.display="",e.visibility="",1;var a=c.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},a));var k=function(){e.height="auto";e.overflow=f};g.after(a,"onStop",k,!0);g.after(a,"onEnd",k,!0);return a};k.wipeOut=
function(a){var b=(a.node=h.byId(a.node)).style,c;a=d.animateProperty(m.mixin({properties:{height:{end:1}}},a));g.after(a,"beforeBegin",function(){c=b.overflow;b.overflow="hidden";b.display=""},!0);var e=function(){b.overflow=c;b.height="auto";b.display="none"};g.after(a,"onStop",e,!0);g.after(a,"onEnd",e,!0);return a};k.slideTo=function(a){var e=null,f=null,k=function(a){return function(){var d=c.getComputedStyle(a),g=d.position;e="absolute"==g?a.offsetTop:parseInt(d.top)||0;f="absolute"==g?a.offsetLeft:
parseInt(d.left)||0;"absolute"!=g&&"relative"!=g&&(d=b.position(a,!0),e=d.y,f=d.x,a.style.position="absolute",a.style.top=e+"px",a.style.left=f+"px")}}(a.node=h.byId(a.node));k();a=d.animateProperty(m.mixin({properties:{top:a.top||0,left:a.left||0}},a));g.after(a,"beforeBegin",k,!0);return a};return k})},"dojox/charting/themes/PlotKit/base":function(){define(["dojo/_base/lang","dojo/_base/Color","../../Theme","../common"],function(m,f,k,e){m=m.getObject("PlotKit",!0,e);m.base=new k({chart:{stroke:null,
fill:"yellow"},plotarea:{stroke:null,fill:"yellow"},axis:{stroke:{color:"#fff",width:1},line:{color:"#fff",width:.5},majorTick:{color:"#fff",width:.5,length:6},minorTick:{color:"#fff",width:.5,length:3},tick:{font:"normal normal normal 7pt Helvetica,Arial,sans-serif",fontColor:"#999"}},series:{stroke:{width:2.5,color:"#fff"},fill:"#666",font:"normal normal normal 7.5pt Helvetica,Arial,sans-serif",fontColor:"#666"},marker:{stroke:{width:2},fill:"#333",font:"normal normal normal 7pt Helvetica,Arial,sans-serif",
fontColor:"#666"},colors:["red","green","blue"]});m.base.next=function(e,d,h){var c=k.prototype.next.apply(this,arguments);"line"==e?(c.marker.outline={width:2,color:"#fff"},c.series.stroke.width=3.5,c.marker.stroke.width=2):"candlestick"==e?c.series.stroke.width=1:c.series.stroke.color&&c.series.stroke.color.toString()==(new f(this.colors[(this._current-1)%this.colors.length])).toString()&&(c.series.stroke.color="#fff");return c};return m})},"dojox/charting/Theme":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/Color ./SimpleTheme dojox/color/_base dojox/color/Palette dojox/gfx/gradutils".split(" "),
function(m,f,k,e,g,d){var h=f("dojox.charting.Theme",e,{});m.mixin(h,{defineColors:function(c){c=c||{};var b,a=[],e=c.num||5;if(c.colors){b=c.colors.length;for(var f=0;f<e;f++)a.push(c.colors[f%b]);return a}return c.hue?d.generate(g.fromHsv(c.hue,c.saturation||100,((c.high||90)+(c.low||30))/2),"monochromatic").colors:c.generator?g.Palette.generate(c.base,c.generator).colors:a},generateGradient:function(c,b,a){c=m.delegate(c);c.colors=[{offset:0,color:b},{offset:1,color:a}];return c},generateHslColor:function(c,
b){c=new k(c);var a=c.toHsl();b=g.fromHsl(a.h,a.s,b);b.a=c.a;return b},generateHslGradient:function(c,b,a,d){c=new k(c);var e=c.toHsl();a=g.fromHsl(e.h,e.s,a);d=g.fromHsl(e.h,e.s,d);a.a=d.a=c.a;return h.generateGradient(b,a,d)}});h.defaultMarkers=e.defaultMarkers;h.defaultColors=e.defaultColors;h.defaultTheme=e.defaultTheme;return h})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(m,f,k,e){m=f.getObject("color",!0,m);m.Color=k;m.blend=
k.blendColors;m.fromRgb=k.fromRgb;m.fromHex=k.fromHex;m.fromArray=k.fromArray;m.fromString=k.fromString;m.greyscale=e.makeGrey;f.mixin(m,{fromCmy:function(e,d,h){f.isArray(e)?(d=e[1],h=e[2],e=e[0]):f.isObject(e)&&(d=e.m,h=e.y,e=e.c);return new k({r:Math.round(255*(1-e/100)),g:Math.round(255*(1-d/100)),b:Math.round(255*(1-h/100))})},fromCmyk:function(e,d,h,c){f.isArray(e)?(d=e[1],h=e[2],c=e[3],e=e[0]):f.isObject(e)&&(d=e.m,h=e.y,c=e.b,e=e.c);c/=100;return new k({r:Math.round(255*(1-Math.min(1,e/100*
(1-c)+c))),g:Math.round(255*(1-Math.min(1,d/100*(1-c)+c))),b:Math.round(255*(1-Math.min(1,h/100*(1-c)+c)))})},fromHsl:function(e,d,h){f.isArray(e)?(d=e[1],h=e[2],e=e[0]):f.isObject(e)&&(d=e.s,h=e.l,e=e.h);d/=100;for(h/=100;0>e;)e+=360;for(;360<=e;)e-=360;var c,b;120>e?(c=(120-e)/60,b=e/60,e=0):240>e?(c=0,b=(240-e)/60,e=(e-120)/60):(c=(e-240)/60,b=0,e=(360-e)/60);c=2*d*Math.min(c,1)+(1-d);b=2*d*Math.min(b,1)+(1-d);e=2*d*Math.min(e,1)+(1-d);.5>h?(c*=h,b*=h,e*=h):(c=(1-h)*c+2*h-1,b=(1-h)*b+2*h-1,e=(1-
h)*e+2*h-1);return new k({r:Math.round(255*c),g:Math.round(255*b),b:Math.round(255*e)})}});m.fromHsv=function(e,d,h){f.isArray(e)?(d=e[1],h=e[2],e=e[0]):f.isObject(e)&&(d=e.s,h=e.v,e=e.h);360==e&&(e=0);d/=100;h/=100;var c,b,a;if(0==d)b=a=c=h;else{var g=e/60;e=Math.floor(g);var m=g-e,g=h*(1-d),p=h*(1-d*m);d=h*(1-d*(1-m));switch(e){case 0:c=h;b=d;a=g;break;case 1:c=p;b=h;a=g;break;case 2:c=g;b=h;a=d;break;case 3:c=g;b=p;a=h;break;case 4:c=d;b=g;a=h;break;case 5:c=h,b=g,a=p}}return new k({r:Math.round(255*
c),g:Math.round(255*b),b:Math.round(255*a)})};f.extend(k,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var e,d=this.r/255,f=this.g/255,c=this.b/255;e=Math.min(1-d,1-f,1-c);return{c:Math.round((1-d-e)/(1-e)*100),m:Math.round((1-f-e)/(1-e)*100),y:Math.round((1-c-e)/(1-e)*100),b:Math.round(100*e)}},toHsl:function(){var e=this.r/255,d=this.g/255,f=this.b/255,c=Math.min(e,f,d),b=Math.max(e,d,f),a=b-c,k=0,
m=0,c=(c+b)/2;0<c&&1>c&&(m=a/(.5>c?2*c:2-2*c));0<a&&(b==e&&b!=d&&(k+=(d-f)/a),b==d&&b!=f&&(k+=2+(f-e)/a),b==f&&b!=e&&(k+=4+(e-d)/a),k*=60);return{h:k,s:Math.round(100*m),l:Math.round(100*c)}},toHsv:function(){var e=this.r/255,d=this.g/255,f=this.b/255,c=Math.max(e,d,f),b=c-Math.min(e,f,d),a=null,k=0==c?0:b/c;0==k?a=0:(a=e==c?60*(d-f)/b:d==c?120+60*(f-e)/b:240+60*(e-d)/b,0>a&&(a+=360));return{h:a,s:Math.round(100*k),v:Math.round(100*c)}}});return m})},"dojox/color/Palette":function(){define(["dojo/_base/lang",
"dojo/_base/array","./_base"],function(m,f,k){function e(b,a,c){var d=new k.Palette;d.colors=[];f.forEach(b.colors,function(b){d.colors.push(new k.Color({r:Math.min(255,Math.max(0,"dr"==a?b.r+c:b.r)),g:Math.min(255,Math.max(0,"dg"==a?b.g+c:b.g)),b:Math.min(255,Math.max(0,"db"==a?b.b+c:b.b)),a:Math.min(1,Math.max(0,"da"==a?b.a+c:b.a))}))});return d}function g(b,a,c){var d=new k.Palette;d.colors=[];f.forEach(b.colors,function(b){b=b.toCmy();d.colors.push(k.fromCmy(Math.min(100,Math.max(0,"dc"==a?b.c+
c:b.c)),Math.min(100,Math.max(0,"dm"==a?b.m+c:b.m)),Math.min(100,Math.max(0,"dy"==a?b.y+c:b.y))))});return d}function d(b,a,c){var d=new k.Palette;d.colors=[];f.forEach(b.colors,function(b){b=b.toCmyk();d.colors.push(k.fromCmyk(Math.min(100,Math.max(0,"dc"==a?b.c+c:b.c)),Math.min(100,Math.max(0,"dm"==a?b.m+c:b.m)),Math.min(100,Math.max(0,"dy"==a?b.y+c:b.y)),Math.min(100,Math.max(0,"dk"==a?b.b+c:b.b))))});return d}function h(b,a,c){var d=new k.Palette;d.colors=[];f.forEach(b.colors,function(b){b=b.toHsl();
d.colors.push(k.fromHsl(("dh"==a?b.h+c:b.h)%360,Math.min(100,Math.max(0,"ds"==a?b.s+c:b.s)),Math.min(100,Math.max(0,"dl"==a?b.l+c:b.l))))});return d}function c(b,a,c){var d=new k.Palette;d.colors=[];f.forEach(b.colors,function(b){b=b.toHsv();d.colors.push(k.fromHsv(("dh"==a?b.h+c:b.h)%360,Math.min(100,Math.max(0,"ds"==a?b.s+c:b.s)),Math.min(100,Math.max(0,"dv"==a?b.v+c:b.v))))});return d}k.Palette=function(b){this.colors=[];b instanceof k.Palette?this.colors=b.colors.slice(0):b instanceof k.Color?
this.colors=[null,null,b,null,null]:m.isArray(b)?this.colors=f.map(b.slice(0),function(a){return m.isString(a)?new k.Color(a):a}):m.isString(b)&&(this.colors=[null,null,new k.Color(b),null,null])};m.extend(k.Palette,{transform:function(b){var a=e;if(b.use){var f=b.use.toLowerCase();0==f.indexOf("hs")?a="l"==f.charAt(2)?h:c:0==f.indexOf("cmy")&&(a="k"==f.charAt(3)?d:g)}else if("dc"in b||"dm"in b||"dy"in b)a="dk"in b?d:g;else if("dh"in b||"ds"in b)a="dv"in b?c:h;var f=this,k;for(k in b)"use"!=k&&(f=
a(f,k,b[k]));return f},clone:function(){return new k.Palette(this)}});m.mixin(k.Palette,{generators:{analogous:function(b){var a=b.high||60,c=b.low||18;b=(m.isString(b.base)?new k.Color(b.base):b.base).toHsv();var d=Math.max(10,95>=b.s?b.s+5:100-(b.s-95)),e=92<=b.v?b.v-9:Math.max(b.v+9,20),g=90>=b.v?Math.max(b.v+5,20):95+Math.ceil((b.v-90)/2),h=[d,1<b.s?b.s-1:21-b.s,b.s,d,d],t=[e,g,b.v,e,g];return new k.Palette(f.map([(b.h+c+360)%360,(b.h+Math.round(c/2)+360)%360,b.h,(b.h-Math.round(a/2)+360)%360,
(b.h-a+360)%360],function(a,b){return k.fromHsv(a,h[b],t[b])}))},monochromatic:function(b){b=m.isString(b.base)?new k.Color(b.base):b.base;var a=b.toHsv(),c=9<a.s-30?a.s-30:a.s+30,d=a.s,e=20<a.v-20?a.v-20:a.v+60,f=20<a.v-50?a.v-50:a.v+30;return new k.Palette([k.fromHsv(a.h,c,100-.8*(100-a.v)),k.fromHsv(a.h,d,f),b,k.fromHsv(a.h,c,f),k.fromHsv(a.h,d,e)])},triadic:function(b){b=m.isString(b.base)?new k.Color(b.base):b.base;var a=b.toHsv(),c=(a.h-157+360)%360,d=90<a.s?a.s-10:a.s+10,e=95<a.s?a.s-5:a.s+
5,f=20<a.v-20?a.v-20:a.v+20,g=20<a.v-30?a.v-30:a.v+30,h=70<a.v-30?a.v-30:a.v+30;return new k.Palette([k.fromHsv((a.h+57+360)%360,20<a.s?a.s-10:a.s+10,a.v),k.fromHsv(a.h,d,g),b,k.fromHsv(c,d,f),k.fromHsv(c,e,h)])},complementary:function(b){b=m.isString(b.base)?new k.Color(b.base):b.base;var a=b.toHsv(),c=360>2*a.h+137?2*a.h+137:Math.floor(a.h/2)-137,d=100-.9*(100-a.s),e=Math.min(100,a.s+20),f=20<a.v?a.v-30:a.v+30;return new k.Palette([k.fromHsv(a.h,Math.max(a.s-10,0),Math.min(100,a.v+30)),k.fromHsv(a.h,
d,f),b,k.fromHsv(c,e,f),k.fromHsv(c,a.s,a.v)])},splitComplementary:function(b){var a=m.isString(b.base)?new k.Color(b.base):b.base,c=b.da||30;b=a.toHsv();var d=360>2*b.h+137?2*b.h+137:Math.floor(b.h/2)-137,e=(d-c+360)%360,c=(d+c)%360,d=100-.9*(100-b.s),f=Math.min(100,b.s+20),g=20<b.v?b.v-30:b.v+30;return new k.Palette([k.fromHsv(e,Math.max(b.s-10,0),Math.min(100,b.v+30)),k.fromHsv(e,d,g),a,k.fromHsv(c,f,g),k.fromHsv(c,b.s,b.v)])},compound:function(b){b=m.isString(b.base)?new k.Color(b.base):b.base;
var a=b.toHsv(),c=360>2*a.h+18?2*a.h+18:Math.floor(a.h/2)-18,d=360>2*a.h+120?2*a.h+120:Math.floor(a.h/2)-120,e=360>2*a.h+99?2*a.h+99:Math.floor(a.h/2)-99,f=80<a.s-10?a.s-10:a.s+10,g=10<a.s-25?a.s-25:a.s+25,h=80<a.v-20?a.v-20:a.v+20,w=Math.max(a.v,20);return new k.Palette([k.fromHsv(c,10<a.s-40?a.s-40:a.s+40,10<a.v-40?a.v-40:a.v+40),k.fromHsv(c,f,h),b,k.fromHsv(d,g,w),k.fromHsv(e,f,h)])},shades:function(b){b=m.isString(b.base)?new k.Color(b.base):b.base;var a=b.toHsv(),c=100==a.s&&0==a.v?0:a.s,d=20<=
a.v-25?a.v-25:a.v+55,e=20<=a.v-75?a.v-75:a.v+5,f=Math.max(a.v-10,20);return new k.Palette([new k.fromHsv(a.h,c,20<a.v-50?a.v-50:a.v+30),new k.fromHsv(a.h,c,d),b,new k.fromHsv(a.h,c,e),new k.fromHsv(a.h,c,f)])}},generate:function(b,a){if(m.isFunction(a))return a({base:b});if(k.Palette.generators[a])return k.Palette.generators[a]({base:b});throw Error("dojox.color.Palette.generate: the specified generator ('"+a+"') does not exist.");}});return k.Palette})},"dojox/charting/themes/common":function(){define(["dojo/_base/lang"],
function(m){return m.getObject("dojox.charting.themes",!0)})},"dojox/charting/themes/Claro":function(){define(["../Theme","dojox/gfx/gradutils","./common"],function(m,f,k){var e=m.generateGradient,g={type:"linear",space:"shape",x1:0,y1:0,x2:0,y2:100};k.Claro=new m({chart:{fill:{type:"linear",x1:0,x2:0,y1:0,y2:100,colors:[{offset:0,color:"#dbdbdb"},{offset:1,color:"#efefef"}]},stroke:{color:"#b5bcc7"}},plotarea:{fill:{type:"linear",x1:0,x2:0,y1:0,y2:100,colors:[{offset:0,color:"#dbdbdb"},{offset:1,
color:"#efefef"}]}},axis:{stroke:{color:"#888c76",width:1},tick:{color:"#888c76",position:"center",font:"normal normal normal 7pt Verdana, Arial, sans-serif",fontColor:"#888c76"}},series:{stroke:{width:2.5,color:"#fff"},outline:null,font:"normal normal normal 7pt Verdana, Arial, sans-serif",fontColor:"#131313"},marker:{stroke:{width:1.25,color:"#131313"},outline:{width:1.25,color:"#131313"},font:"normal normal normal 8pt Verdana, Arial, sans-serif",fontColor:"#131313"},seriesThemes:[{fill:e(g,"#2a6ead",
"#3a99f2")},{fill:e(g,"#613e04","#996106")},{fill:e(g,"#0e3961","#155896")},{fill:e(g,"#55aafa","#3f7fba")},{fill:e(g,"#ad7b2a","#db9b35")}],markerThemes:[{fill:"#2a6ead",stroke:{color:"#fff"}},{fill:"#613e04",stroke:{color:"#fff"}},{fill:"#0e3961",stroke:{color:"#fff"}},{fill:"#55aafa",stroke:{color:"#fff"}},{fill:"#ad7b2a",stroke:{color:"#fff"}}]});k.Claro.next=function(d,e,c){var b="line"==d,a;if(b||"area"==d){a=this.seriesThemes[this._current%this.seriesThemes.length];var f=this.markerThemes[this._current%
this.markerThemes.length];a.fill.space="plot";b&&(a.stroke={width:4,color:a.fill.colors[0].color});f.outline={width:1.25,color:f.fill};b=m.prototype.next.apply(this,arguments);delete a.outline;delete a.stroke;a.fill.space="shape";return b}return"candlestick"==d?(a=this.seriesThemes[this._current%this.seriesThemes.length],a.fill.space="plot",a.stroke={width:1,color:a.fill.colors[0].color},b=m.prototype.next.apply(this,arguments)):m.prototype.next.apply(this,arguments)};k.Claro.post=function(d,e){d=
m.prototype.post.apply(this,arguments);"slice"!=e&&"circle"!=e||!d.series.fill||"radial"!=d.series.fill.type||(d.series.fill=f.reverse(d.series.fill));return d};return k.Claro})},"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/Dialog.html":'\x3cdiv class\x3d"dijitDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title"\r\n\t\t\t\trole\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"-1"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\x3c/div\x3e\r\n\t${!actionBarTemplate}\r\n\x3c/div\x3e\r\n\r\n',
"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:webSceneViewer/widgets/Dialog/templates/ConfirmDialog.html":'\x3cdiv class\x3d"dijitDialog confirmDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title" role\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"0"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n    \x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\r\n    \x3cdiv class\x3d"dijitDialogPaneContentArea"\x3e\r\n      \x3cdiv class\x3d"confirmDialogContentNode"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"Message"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"dijitDialogPaneActionBar"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-event\x3d"click: _confirmButtonClickHandler" data-dojo-attach-point\x3d"buttonConfirm"\x3e\x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"button" data-dojo-attach-event\x3d"click: onCancel" title\x3d"${buttonCancel}" data-dojo-attach-point\x3d"buttonCancel"\x3e\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:webSceneViewer/widgets/Header/templates/Header.html":'\x3cdiv id\x3d"webmap-header" class\x3d"top-nav clearfix" \x3e\r\n  \x3cdiv id\x3d"header_map_home" class\x3d"esriFloatLeading gutter-right-1"\x3e\r\n    \x3cdiv id\x3d"home-navigation" class\x3d"dropdown" data-dojo-attach-point\x3d"navDropdown"\x3e\r\n      \x3ca id\x3d"homeTitle" class\x3d"top-nav-link dropdown-btn js-dropdown-toggle" data-dojo-attach-point\x3d"homeTitle"\x3e\x3c/a\x3e\r\n      \x3cdiv class\x3d"dropdown-menu"\x3e\r\n        \x3ca class\x3d"dropdown-link homeHome" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeFeatures" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homePlans hide" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeGallery" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeMap" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeGroups hide" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeMyContent hide" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeMyOrg hide" href\x3d""\x3e\x3c/a\x3e\r\n        \x3ca class\x3d"dropdown-link homeHelp" target\x3d"_blank" href\x3d""\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3ch1 id\x3d"webmap-title" class\x3d"avenir-light font-size-1 esriFloatLeading leader-1"\x3e\r\n    \x3ca id\x3d"webmap-title-text" target\x3d"_blank" class\x3d"text-ellipsis"\x3e\x3c/a\x3e\x3cdiv id\x3d"sceneType" class\x3d"sceneType hide"\x3e\x3c/div\x3e\r\n  \x3c/h1\x3e\r\n\r\n  \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n\r\n    \x3cdiv id\x3d"header_map_newMap" class\x3d"esriFloatLeading gutter-right-1"\x3e\r\n      \x3cdiv id\x3d"new-scene-navigation" class\x3d"dropdown esriFloatTrailing" data-dojo-attach-point\x3d"newSceneDropdown"\x3e\r\n        \x3ca id\x3d"webmap-newMap" class\x3d"dropdown-btn top-nav-link" data-dojo-attach-point\x3d"newScene"\x3e\r\n          \x3cspan id\x3d"newMapLabel"\x3e\x3c/span\x3e\r\n        \x3c/a\x3e\r\n        \x3cdiv class\x3d"dropdown-menu dropdown-right"\x3e\r\n          \x3ca class\x3d"dropdown-link" id\x3d"global-scene-link" data-dojo-attach-event\x3d"click:_newGlobalSceneClickHandler" \x3eNew Global Scene!!!\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link" id\x3d"local-scene-link" data-dojo-attach-event\x3d"click:_newLocalSceneClickHandler" \x3eNew Local Scene!!!\x3c/a\x3e\r\n          \x3cspan id\x3d"recentScene-title" class\x3d"dropdown-link dropdown-title hide" style\x3d"cursor: default;"\x3e${_i18n.header.recentScenes}\x3c/span\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"header_map_modifyMap" class\x3d"esriFloatLeading esriTrailingMargin1" style\x3d"display:none;"\x3e\r\n      \x3ca id\x3d"webmap-modifyMap" class\x3d"top-nav-link" \x3e\r\n        \x3cspan id\x3d"modifyMapLabel"\x3e\x3c/span\x3e\r\n      \x3c/a\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"header_map_presentation" class\x3d"esriFloatLeading esriTrailingMargin1" style\x3d"display:none;"\x3e\r\n      \x3ca id\x3d"webmap-presentation" class\x3d"top-nav-link" \x3e\r\n        \x3cspan id\x3d"presentationLabel"\x3e\x3c/span\x3e\r\n      \x3c/a\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv id\x3d"header_map_signin" class\x3d"status esriFloatTrailing"\x3e\r\n\r\n       \x3c!-- Log in --\x3e\r\n      \x3cdiv id\x3d"logged-out-navigation" class\x3d"hide esriFloatTrailing esriAlignTrailing"\x3e\r\n        \x3ca id\x3d"login-link" class\x3d"top-nav-link icon-ui-user link-gray" data-dojo-attach-event\x3d"click:_signInLinkClickHandler"\x3e\x3c/a\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3c!-- User Menu --\x3e\r\n      \x3cdiv id\x3d"logged-in-navigation" class\x3d"dropdown hide esriFloatTrailing" data-dojo-attach-point\x3d"userDropdown"\x3e\r\n        \x3ca class\x3d"top-nav-link dropdown-btn top-nav-username text-ellipsis" data-dojo-attach-point\x3d"userProfile"\x3e\r\n          \x3cimg id\x3d"profileImgSmall" width\x3d"16" height\x3d"16" alt\x3d""\x3e\r\n          \x3cspan id\x3d"username"\x3e\x3c/span\x3e\r\n        \x3c/a\x3e\r\n        \x3cdiv class\x3d"dropdown-menu dropdown-right"\x3e\r\n          \x3ca id\x3d"profileLink" class\x3d"dropdown-link" href\x3d"#"\x3e\r\n            \x3cimg id\x3d"dropdown-image" width\x3d"32" height\x3d"32" class\x3d"gutter-right-half gutter-left-0 left"\x3e\r\n            \x3cdiv id\x3d"logged-in-myProfile" class\x3d"text-ellipsis dropdown-username"\x3e\x3c/div\x3e\r\n          \x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link dropdown-link-external hide" id\x3d"esri-community-link"  data-dojo-attach-event\x3d"click:_communityLinkClickHandler, contextmenu:_disableEvent"\x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link dropdown-link-external hide" id\x3d"my-esri-link" data-dojo-attach-event\x3d"click:_myEsriLinkClickHandler, contextmenu:_disableEvent" \x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link dropdown-link-external hide" id\x3d"esri-training-link" data-dojo-attach-event\x3d"click:_trainingLinkClickHandler, contextmenu:_disableEvent" \x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link" target\x3d"_blank" id\x3d"logged-in-switchAccounts" data-dojo-attach-event\x3d"click:_switchAccountsClickHandler, contextmenu:_disableEvent" \x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link hide" id\x3d"trial-download-link" data-dojo-attach-event\x3d"click:_trialLinkClickHandler, contextmenu:_disableEvent" \x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link loggedInHelp" id\x3d"logged-in-help" target\x3d"_blank"\x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link hide" id\x3d"logged-in-adminhelp" data-dojo-attach-event\x3d"click:_loggedInAdminHelpLinkClickHandler, contextmenu:_disableEvent" class\x3d"loggedInAdminHelp" \x3e\x3c/a\x3e\r\n          \x3ca class\x3d"dropdown-link" id\x3d"logged-in-signOut" data-dojo-attach-event\x3d"click:_signOutLinkClickHandler, contextmenu:_disableEvent" \x3e\x3c/a\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"header_map_try" class\x3d"status esriFloatTrailing"\x3e\x3ca id\x3d"webmap-try-arcgis" target\x3d"_blank"\x3e${_i18n.header.tryArcGIS}\x3c/a\x3e\x3c/div\x3e\r\n    \x3ca id\x3d"header-full-viewer" class\x3d"fullScreen" href\x3d"" target\x3d"_blank" data-dojo-attach-point\x3d"FullScreenLink"\x3e\x3c/a\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
"url:webSceneViewer/widgets/MessageListWidget/templates/MessageListWidget.html":'\x3cdiv class\x3d"MessageList" data-dojo-attach-point\x3d"MessageList"\x3e\r\n    \x3cdiv class\x3d"MessageListContent" data-dojo-attach-point\x3d"MessageListContentNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',"url:webSceneViewer/widgets/MessageListWidget/templates/MessageWidget.html":'\x3cdiv class\x3d"MessageWidget"  data-dojo-attach-event\x3d"click:_expand"\x3e\r\n    \x3cdiv class\x3d"" data-dojo-attach-point\x3d"MessageTypeIcon"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"MessageShortDesc" class \x3d "MessageTitle"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"MessageDetails" class \x3d "MessageContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"closeIcon" data-dojo-attach-point\x3d"closeIcon" data-dojo-attach-event\x3d"click:_onRemove, dblclick:_onRemoveAll"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"ExpandIcon" class\x3d"arrowIcon"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:webSceneViewer/widgets/WelcomeWidget/templates/WelcomeWidget.html":'\x3cdiv class\x3d"welcomeWidgetContainer" role\x3d"dialog" \x3e\r\n  \x3cdiv class\x3d"backgroundImageContainer"\x3e\r\n    \x3cdiv class\x3d"dijitDialogTitleBar"\x3e\r\n      \x3cdiv class\x3d"dijitDialogTitle"  data-dojo-attach-point\x3d"titleBar"\x3e\r\n        \x3cdiv class\x3d"titleIcon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"title"\x3eScene Viewer\x3c/div\x3e\r\n        \x3cdiv class\x3d"closeButtonContainer"\x3e\r\n          \x3cdiv class\x3d"closeIcon" data-dojo-attach-point\x3d"closeButtonNode" data-dojo-attach-event\x3d"onClick:_crossClicked" title\x3d"${_i18n.symbolStyler.discard}"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv class\x3d"gallery" data-dojo-attach-point\x3d"welcomeWidgetContainer"\x3e\x3cdiv class\x3d"loading"\x3e\x3c/div\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"galleryLinkContainer"\x3e\r\n      \x3ca data-dojo-attach-point\x3d"galleryLink" target\x3d"_blank"\x3e${_i18n.welcomeWidget.gallery}\x3c/a\x3e\r\n      \x3ca data-dojo-attach-point\x3d"helpLink" target\x3d"_blank"\x3e${_i18n.welcomeWidget.help}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:webSceneViewer/widgets/ScrollBar/templates/ScrollBar.html":'\x3cdiv data-dojo-attach-point\x3d"scrollBarContainer" class\x3d"scrollBarContainer"\x3e\r\n    \x3cdiv class\x3d"scrollBarSpace" data-dojo-attach-point\x3d"scrollBarSpace" \x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"scrollBarHandleContainer" class\x3d"scrollBarHandleContainer"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"scrollBarHandleHitArea" class\x3d"scrollBarHandleHitArea" \x3e\r\n            \x3cdiv class\x3d"scrollBarHandle" \x3e\r\n                \x3cdiv style\x3d"display: none;" class\x3d"handleT"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"*now":function(m){m(['dojo/i18n!*preload*dojo/nls/dojo*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});require.boot&&require.apply(null,require.boot);
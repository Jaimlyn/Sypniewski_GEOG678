// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(z,p,q){function v(a,n,q){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,q+t.identifierOffset,t.identifierLength)),version:n.getUint16(q+t.versionOffset,!0),checksum:n.getUint32(q+t.checksumOffset,!0)}}function w(a,n,q){var d=[];n=u(a,n,d);for(var b=[],r=0;r<d.length;r++){b.length=0;n=u(a,n,b);for(var c=0;c<b.length;c++)q.push(b[c]+d[r])}return n}function u(a,
n,p){var d=new DataView(a,n),b=d.getUint8(0),r=b&31,c=!!(b&32),l=(b&192)>>6,b=0;if(0===l)b=d.getUint32(1,!0),n+=5;else if(1===l)b=d.getUint16(1,!0),n+=3;else if(2===l)b=d.getUint8(1),n+=2;else throw new q("lepcc-decode-error","Bad count type");if(c)throw new q("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,n,Math.ceil(b*r/8));for(var l=c=d=0,h=-1>>>32-r,m=0;m<b;m++){for(;c<r;)d|=a[l]<<c,c+=8,l+=1;p[m]=d&h;d>>>=r;c-=r;32<c+r&&(d|=a[l-1]>>8-c)}return n+l}Object.defineProperty(p,"__esModule",
{value:!0});var t={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};p.decodeXYZ=function(a){var n,p,d,b,r,c,l,h,m,f,B,x,g=new DataView(a,0),k=0;b=v(a,g,k);d=b.identifier;b=b.version;k+=t.byteCount;if("LEPCC     "!==d)throw new q("lepcc-decode-error","Bad identifier");if(1<b)throw new q("lepcc-decode-error","Unknown version");var e=k;n=g.getUint32(e+0,!0);p=g.getUint32(e+4,!0);d=g.getFloat64(e+8,!0);b=g.getFloat64(e+16,!0);r=g.getFloat64(e+24,!0);c=g.getFloat64(e+
32,!0);l=g.getFloat64(e+40,!0);h=g.getFloat64(e+48,!0);m=g.getFloat64(e+56,!0);f=g.getFloat64(e+64,!0);B=g.getFloat64(e+72,!0);x=g.getUint32(e+80,!0);g.getUint32(e+84,!0);k+=88;if(p*Math.pow(2,32)+n!==a.byteLength)throw new q("lepcc-decode-error","Bad size");g=new Float64Array(3*x);n=[];p=[];x=[];e=[];k=w(a,k,n);k=w(a,k,p);k=w(a,k,x);k=w(a,k,e);if(k!==a.byteLength)throw new q("lepcc-decode-error","Bad length");for(var y=k=a=0;y<n.length;y++)for(var k=k+n[y],C=0,u=0;u<p[y];u++){var C=C+x[a],z=e[a];
g[3*a]=Math.min(c,d+2*m*C);g[3*a+1]=Math.min(l,b+2*f*k);g[3*a+2]=Math.min(h,r+2*B*z);a++}return{errorX:m,errorY:f,errorZ:B,result:g}};p.decodeRGB=function(a){var n,p,d,b,r,c,l=new DataView(a,0),h=0;b=v(a,l,h);d=b.identifier;b=b.version;h+=t.byteCount;if("ClusterRGB"!==d)throw new q("lepcc-decode-error","Bad identifier");if(1<b)throw new q("lepcc-decode-error","Unknown version");c=h;n=l.getUint32(c+0,!0);p=l.getUint32(c+4,!0);d=l.getUint32(c+8,!0);b=l.getUint16(c+12,!0);r=l.getUint8(c+14);c=l.getUint8(c+
15);h+=16;if(p*Math.pow(2,32)+n!==a.byteLength)throw new q("lepcc-decode-error","Bad size");if(2!==r&&1!==r||0!==c){if(0===r&&0===c){if(3*d+h!==a.byteLength||0!==b)throw new q("lepcc-decode-error","Bad count");return(new Uint8Array(a,h)).slice()}if(2>=r&&1===c){if(h+3!==a.byteLength||1!==b)throw new q("lepcc-decode-error","Bad count");b=l.getUint8(h);n=l.getUint8(h+1);l=l.getUint8(h+2);h=new Uint8Array(3*d);for(a=0;a<d;a++)h[3*a]=b,h[3*a+1]=n,h[3*a+2]=l;return h}throw new q("lepcc-decode-error","Bad method "+
r+","+c);}if(3*b+d+h!==a.byteLength||256<b)throw new q("lepcc-decode-error","Bad count");l=new Uint8Array(a,h,3*b);b=new Uint8Array(a,h+3*b,d);h=new Uint8Array(3*d);for(a=0;a<d;a++)n=b[a],h[3*a]=l[3*n],h[3*a+1]=l[3*n+1],h[3*a+2]=l[3*n+2];return h};p.decodeIntensity=function(a){var n,p,d,b,r,c=new DataView(a,0),l=0;b=v(a,c,l);d=b.identifier;b=b.version;l+=t.byteCount;if("Intensity "!==d)throw new q("lepcc-decode-error","Bad identifier");if(1<b)throw new q("lepcc-decode-error","Unknown version");var h=
l;n=c.getUint32(h+0,!0);p=c.getUint32(h+4,!0);d=c.getUint32(h+8,!0);b=c.getUint16(h+12,!0);r=c.getUint8(h+14);c.getUint8(h+15);l+=16;if(p*Math.pow(2,32)+n!==a.byteLength)throw new q("lepcc-decode-error","Bad size");c=new Uint16Array(d);if(8===r){if(d+l!==a.byteLength)throw new q("lepcc-decode-error","Bad size");r=new Uint8Array(a,l,d)}else if(16===r){if(2*d+l!==a.byteLength)throw new q("lepcc-decode-error","Bad size");r=new Uint16Array(a,l,d)}else if(r=[],u(a,l,r)!==a.byteLength)throw new q("lepcc-decode-error",
"Bad size");for(a=0;a<d;a++)c[a]=r[a]*b;return c}})}}});
define("require exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),function(z,p,q,v,w,u){function t(m,f,a){for(var b="",g=0;g<a;){var k=m[f+g];if(128>k)b+=String.fromCharCode(k),g++;else if(192<=k&&224>k){if(g+1>=a)throw new q("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var e=m[f+g+1],k=(k&31)<<6|e&63,b=b+String.fromCharCode(k),g=g+2}else if(224<=k&&240>k){if(g+2>=a)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");
var e=m[f+g+1],l=m[f+g+2],k=(k&15)<<12|(e&63)<<6|l&63,b=b+String.fromCharCode(k),g=g+3}else if(240<=k&&248>k){if(g+3>=a)throw new q("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");e=m[f+g+1];l=m[f+g+2];k=(k&7)<<18|(e&63)<<12|(l&63)<<6|m[f+g+3]&63;b=65536<=k?b+String.fromCharCode((k-65536>>10)+55296,(k&1023)+56320):b+String.fromCharCode(k);g+=4}else throw new q("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return b}function a(m,f){for(var a=
{byteOffset:0,byteCount:0,fields:Object.create(null)},b=0,g=0;g<f.length;g++){var k=f[g],e=k.valueType||k.type;a.fields[k.property]=(0,p.valueType2ArrayBufferReader[e])(m,b);b+=p.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}a.byteCount=b;return a}function n(a,f,b){var m=[],g,k=0,e;for(e=0;e<a;e+=1){g=f[e];if(0<g){if(m.push(t(b,k,g-1)),0!==b[k+g-1])throw new q("string-array-error","Invalid string array: missing null termination.");}else m.push(null);k+=g}return m}function A(a,f){return new p.valueType2TypedArrayClassMap[f.valueType](a,
f.byteOffset,f.count*f.valuesPerElement)}function d(a,f){return new Uint8Array(a,f.byteOffset,f.byteCount)}function b(m,f,b){m=null!=f.header?a(m,f.header):{byteOffset:0,byteCount:0,fields:{count:b}};b={header:m,byteOffset:m.byteCount,byteCount:0,entries:Object.create(null)};for(var d=m.byteCount,g=0;g<f.ordering.length;g++){var k=f.ordering[g],e=v.clone(f[k]);e.count=m.fields.count;if("String"===e.valueType){if(e.byteOffset=d,e.byteCount=m.fields[k+"ByteCount"],"UTF-8"!==e.encoding)throw new q("unsupported-encoding",
"Unsupported String encoding.",{encoding:e.encoding});}else if(c(e.valueType)){var h=l(e.valueType),d=d+(0!==d%h?h-d%h:0);e.byteOffset=d;e.byteCount=h*e.valuesPerElement*e.count}else throw new q("unsupported-value-type","Unsupported binary valueType",{valueType:e.valueType});d+=e.byteCount;b.entries[k]=e}b.byteCount=d-b.byteOffset;return b}function r(a,f,b){f!==a&&h.error("Invalid "+b+" buffer size\n expected: "+a+", actual: "+f+")");if(f<a)throw new q("buffer-too-small","Binary buffer is too small",
{expectedSize:a,actualSize:f});}function c(a){return p.valueType2TypedArrayClassMap.hasOwnProperty(a)}function l(a){return c(a)&&p.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(p,"__esModule",{value:!0});var h=w.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");p.readHeader=a;p.readStringArray=n;p.createTypedView=A;p.createRawView=d;p.createAttributeDataIndex=b;p.createGeometryDataIndex=function(b,f,d){var m=a(b,f&&f.header),g=m.byteCount,k={header:m,byteOffset:m.byteCount,
byteCount:0,vertexAttributes:v.clone(f.vertexAttributes)},e=k.vertexAttributes;d||null==e.region||delete e.region;var m=m.fields,h=null!=m.vertexCount?m.vertexCount:m.count;for(d=0;d<f.ordering.length;d++){var c=f.ordering[d];null!=e[c]&&(e[c].byteOffset=g,e[c].count=h,g+=l(e[c].valueType)*e[c].valuesPerElement*h)}e=m.faceCount;if(f.faces&&e)for(k.faces=v.clone(f.faces),h=k.faces,d=0;d<f.ordering.length;d++)c=f.ordering[d],null!=h[c]&&(h[c].byteOffset=g,h[c].count=e,g+=l(h[c].valueType)*h[c].valuesPerElement*
e);m=m.featureCount;if(f.featureAttributes&&f.featureAttributeOrder&&m)for(k.featureAttributes=v.clone(f.featureAttributes),e=k.featureAttributes,d=0;d<f.featureAttributeOrder.length;d++)h=f.featureAttributeOrder[d],e[h].byteOffset=g,e[h].count=m,c=l(e[h].valueType),"UInt64"===e[h].valueType&&(c=8),g+=c*e[h].valuesPerElement*m;r(g,b.byteLength,"geometry");k.byteCount=g-k.byteOffset;return k};p.readBinaryAttribute=function(a,f,c){if("lepcc-rgb"===a.encoding)return u.decodeRGB(f);if("lepcc-intensity"===
a.encoding)return u.decodeIntensity(f);if(null!=a.encoding&&""!==a.encoding)throw new q("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(h.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(h.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");c=b(f,a,c);r(c.byteOffset+c.byteCount,
f.byteLength,"attribute");if(a=c.entries.attributeValues||c.entries.objectIds){if("String"===a.valueType){c=c.entries.attributeByteCounts;var m=A(f,c);f=d(f,a);return n(c.count,m,f)}return A(f,a)}throw new q("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};p.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};p.valueType2ArrayBufferReader={Float32:function(a,
b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};p.isValueType=c;p.getBytesPerValue=
l});
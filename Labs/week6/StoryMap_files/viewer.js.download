//>>built
require({cache:{"esri/kernel":function(){define(["dojo/_base/kernel","dojo/_base/config","dojo/has"],function(c,b,a){c=function(){return this}();var n=c.location,u=n.pathname;a=n.protocol;n={version:"3.26",_appBaseUrl:a+"//"+n.host+u.substring(0,u.lastIndexOf(u.split("/")[u.split("/").length-1]))};b.noGlobals||(c.esri=n);(n.dijit=n.dijit||{})._arcgisUrl=("http:"===a||"https:"===a?a:"http:")+"//www.arcgis.com/sharing/rest";return n})},"esri/config":function(){define(["dojo/_base/config","dojo/topic",
"dojo/has","./kernel"],function(c,b,a,n){a=function(){return this}();var u={defaults:{screenDPI:96,geometryService:null,kmlService:null,map:{width:400,height:400,layerNamePrefix:"layer",graphicsLayerNamePrefix:"graphicsLayer",slider:{left:"30px",top:"30px",width:null,height:"200px"},sliderLabel:{tick:5,labels:null,style:"width:2em; font-family:Verdana; font-size:75%;"},sliderChangeImmediate:!0,zoomSymbol:{color:[0,0,0,64],outline:{color:[255,0,0,255],width:1.25,style:"esriSLSSolid"},style:"esriSFSSolid"},
zoomDuration:500,zoomRate:25,zoomAnimationThrottled:!1,panDuration:350,panRate:25,logoLink:"http://www.esri.com"},autoSpatialIndexing:a.Worker&&!1,io:{errorHandler:function(a,c){b.publish("esri.Error",[a])},proxyUrl:null,alwaysUseProxy:!1,useCors:"with-credentials",corsEnabledServers:[/^https?:\/\/.+\.arcgis\.com(\/|$)/i,"server.arcgisonline.com","services.arcgisonline.com","www.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","tiles.arcgis.com","tiles1.arcgis.com","tiles2.arcgis.com",
"tiles3.arcgis.com","tiles4.arcgis.com","basemaps.arcgis.com","basemapsbeta.arcgis.com","elevation3d.arcgis.com","services.arcgis.com","services1.arcgis.com","services2.arcgis.com","services3.arcgis.com","services4.arcgis.com","services5.arcgis.com","services6.arcgis.com","services7.arcgis.com","services8.arcgis.com","services9.arcgis.com","cdn.arcgis.com","cdn-a.arcgis.com","cdn-b.arcgis.com","static.arcgis.com","utility.arcgis.com","utility.arcgisonline.com","geocode.arcgis.com","geoenrich.arcgis.com",
"qaext.arcgis.com","staticqa.arcgis.com","tilesqa.arcgis.com","servicesqa.arcgis.com","servicesqa1.arcgis.com","servicesqa2.arcgis.com","servicesqa3.arcgis.com","geocodeqa.arcgis.com","geoenrichqa.arcgis.com","dev.arcgis.com","devext.arcgis.com","localvtiles.arcgis.com","staticdev.arcgis.com","tilesdevext.arcgis.com","elevation3ddev.arcgis.com","servicesdev.arcgis.com","servicesdev1.arcgis.com","servicesdev2.arcgis.com","servicesdev3.arcgis.com","geocodedev.arcgis.com","geoenrichdev.arcgis.com","basemapsdev.arcgis.com",
"basemapsbetadev.arcgis.com"],corsDetection:a.cordova?!1:!0,corsDetectionTimeout:15,corsStatus:{},webTierAuthServers:[],proxyRules:[],postLength:2E3,timeout:6E4,useWorkers:"on-request",maxRequestWorkers:5,httpsDomains:"arcgis.com arcgisonline.com esrikr.com premiumservices.blackbridge.com esripremium.accuweather.com gbm.digitalglobe.com firstlook.digitalglobe.com msi.digitalglobe.com".split(" ")},workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}}}};n.config=u;c.noGlobals||(a.esriConfig=u);
return u})},"esri/sniff":function(){define(["dojo/_base/sniff","dojo/global","./kernel"],function(c,b,a){var n=c("ff"),u=c("ie"),v=void 0===u&&7<=c("trident"),h=c("edge"),f=c("webkit"),l=c("opera"),t=c("chrome"),p=c("safari"),w=navigator.userAgent,x;(x=w.match(/(iPhone|iPad|CPU)\s+OS\s+(\d+\_\d+)/i))&&c.add("esri-iphone",parseFloat(x[2].replace("_",".")));(x=w.match(/Android\s+(\d+(\.\d+)*)/i))&&c.add("esri-android",parseFloat(x[1]));(x=w.match(/Fennec\/(\d+\.\d+)/i))&&c.add("esri-fennec",parseFloat(x[1]));
0<=w.indexOf("BlackBerry")&&0<=w.indexOf("WebKit")&&c.add("esri-blackberry",1);c.add("esri-touch",c("esri-iphone")||c("esri-android")||c("esri-blackberry")||6<=c("esri-fennec")||(n||f)&&(document.createTouch||"ontouchstart"in b)?!0:!1);(x=w.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i))&&c.add("esri-mobile",!!x);c.add("esri-pointer",navigator.pointerEnabled||navigator.msPointerEnabled||!(!h||!b.PointerEvent));a._getDOMAccessor=function(e){var a="";n?a="Moz":f?a="Webkit":
u?a="ms":l&&(a="O");return a+e.charAt(0).toUpperCase()+e.substr(1)};c.add("esri-phonegap",!!b.cordova);c.add("esri-cors",c("esri-phonegap")||b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest);c.add("esri-file-upload",b.FormData&&b.FileList?!0:!1);c.add("esri-script-sandbox",function(){return"MessageChannel"in b&&"HTMLIFrameElement"in b&&"sandbox"in HTMLIFrameElement.prototype});c.add("esri-secure-context",function(){if("isSecureContext"in b)return b.isSecureContext;if(b.location&&b.location.origin)return 0===
b.location.origin.indexOf("https:")});c.add("esri-wasm","WebAssembly"in b);c.add("esri-workers",b.Worker?!0:!1);c.add("esri-featurelayer-webgl",!1);if(w=c("esri-featurelayer-webgl")){var e=c("esri-mobile");x=e?1:2;e=e?1:3;"object"===typeof w?(w.maxDrillLevel=null==w.maxDrillLevel?x:w.maxDrillLevel,w.maxRecordCountFactor=null==w.maxRecordCountFactor?e:w.maxRecordCountFactor,w.enablePBFQuery=null==w.enablePBFQuery?!0:w.enablePBFQuery):c.add("esri-featurelayer-webgl",{maxDrillLevel:x,maxRecordCountFactor:e,
enablePBFQuery:!0},null,!0)}c.add("esri-featurelayer-webgl-labeling",!1);c.add("esri-pbf",!u||10<=u);c.add("esri-featurelayer-pbf",!0);c.add("esri-transforms",v||h||9<=u||3.5<=n||4<=t||3.1<=p||10.5<=l||3.2<=c("esri-iphone")||2.1<=c("esri-android"));c.add("esri-transitions",v||h||10<=u||4<=n||4<=t||3.1<=p||10.5<=l||3.2<=c("esri-iphone")||2.1<=c("esri-android"));c.add("esri-transforms3d",v||h||10<=n||12<=t||4<=p||3.2<=c("esri-iphone")||3<=c("esri-android"));c.add("esri-url-encodes-apostrophe",function(){if(!b.document)return!1;
var e=b.document.createElement("a");e.href="?'";return-1<e.href.indexOf("?%27")});3>c("esri-android")&&(c.add("esri-transforms",!1,!1,!0),c.add("esri-transitions",!1,!1,!0),c.add("esri-transforms3d",!1,!1,!0));c.add("esri-will-change",c("esri-transforms")&&(52<=t||11.1<=p));a._css=function(e){var a=c("esri-transforms3d");void 0!==e&&null!==e?a=e:a&&(t||p&&!c("esri-iphone"))&&(a=!1);var d=a?"translate3d(":"translate(",b=a?t?",-1px)":",0px)":")",k=a?"scale3d(":"scale(",m=a?",1)":")",x=a?"rotate3d(0,0,1,":
"rotate(",h=a?"matrix3d(":"matrix(",v=a?",0,0,":",",z=a?",0,0,0,0,1,0,":",",J=a?",0,1)":")";return{names:{transition:f&&"-webkit-transition"||n&&"MozTransition"||l&&"OTransition"||u&&"msTransition"||"transition",transform:f&&"-webkit-transform"||n&&"MozTransform"||l&&"OTransform"||u&&"msTransform"||"transform",transformName:f&&"-webkit-transform"||n&&"-moz-transform"||l&&"-o-transform"||u&&"-ms-transform"||"transform",origin:f&&"-webkit-transform-origin"||n&&"MozTransformOrigin"||l&&"OTransformOrigin"||
u&&"msTransformOrigin"||"transformOrigin",endEvent:f&&"webkitTransitionEnd"||n&&"transitionend"||l&&"oTransitionEnd"||u&&"MSTransitionEnd"||"transitionend"},translate:function(e,a){return d+e+"px,"+a+"px"+b},scale:function(d){return k+d+","+d+m},rotate:function(d){return x+d+"deg)"},matrix:function(d){return h+d.xx+","+d.xy+v+d.yx+","+d.yy+z+d.dx.toFixed(10)+(n&&59>=n?"px,":",")+d.dy.toFixed(10)+(n&&59>=n?"px":"")+J},getScaleFromMatrix:function(d){if(!d)return 1;d=d.toLowerCase();var e=-1<d.indexOf("matrix3d")?
"matrix3d(":"matrix(";return Number(d.substring(e.length,d.indexOf(",")))}}};a.isiPhone=c("esri-iphone");a.isAndroid=c("esri-android");a.isFennec=c("esri-fennec");a.isBlackBerry=c("esri-blackberry");a.isTouchEnabled=c("esri-touch");a.isPointerEnabled=c("esri-pointer");a._hasCors=c("esri-cors");a._hasFileUpload=c("esri-file-upload");a._hasTransforms=c("esri-transforms");a._hasTransitions=c("esri-transitions");a._has3DTransforms=c("esri-transforms3d");return c})},"esri/lang":function(){define("dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/_base/lang dojo/date dojo/has dojo/number dojo/date/locale ./kernel".split(" "),
function(c,b,a,n,u,v,h,f,l){function t(d,e,b){return[n.isString(d)?d.split(""):d,e||a.global,n.isString(b)?new Function("item","index","array",b):b]}function p(d){return void 0!==d&&null!==d}function w(d){return p(d)?d:""}function x(d,e,a){var g=a.match(/([^\(]+)(\([^\)]+\))?/i),k=n.trim(g[1]);a=e[d];var g=b.fromJson((g[2]?n.trim(g[2]):"()").replace(/^\(/,"({").replace(/\)$/,"})")),y=g.utcOffset;if(-1===c.indexOf(m,k))k=n.getObject(k),n.isFunction(k)&&(a=k(a,d,e,g));else if("number"===typeof a||"string"===
typeof a&&a&&!isNaN(Number(a)))switch(a=Number(a),k){case "NumberFormat":return h.format(a,g);case "DateString":d=new Date(a);if(g.local||g.systemLocale)return g.systemLocale?d.toLocaleDateString()+(g.hideTime?"":" "+d.toLocaleTimeString()):d.toDateString()+(g.hideTime?"":" "+d.toTimeString());d=d.toUTCString();g.hideTime&&(d=d.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,""));return d;case "DateFormat":return d=new Date(a),p(y)&&(d=u.add(d,"minute",d.getTimezoneOffset()-y)),f.format(d,g)}return w(a)}
function e(d,a){var b;if(a)for(b in d)d.hasOwnProperty(b)&&(void 0===d[b]?delete d[b]:d[b]instanceof Object&&e(d[b],!0));else for(b in d)d.hasOwnProperty(b)&&void 0===d[b]&&delete d[b];return d}var m=["NumberFormat","DateString","DateFormat"],g=/<\/?[^>]+>/g;v={valueOf:function(d,e){for(var a in d)if(d[a]==e)return a;return null},stripTags:function(d){if(d){var e=typeof d;if("string"===e)d=d.replace(g,"");else if("object"===e)for(var a in d)(e=d[a])&&"string"===typeof e&&(e=e.replace(g,"")),d[a]=
e}return d},substitute:function(d,e,a){var b,g,k;p(a)&&(n.isObject(a)?(b=a.first,g=a.dateFormat,k=a.numberFormat):b=a);if(e&&"${*}"!==e)return n.replace(e,n.hitch({obj:d},function(d,e){d=e.split(":");return 1<d.length?(e=d[0],d.shift(),x(e,this.obj,d.join(":"))):g&&-1!==c.indexOf(g.properties||"",e)?x(e,this.obj,g.formatter||"DateString"):k&&-1!==c.indexOf(k.properties||"",e)?x(e,this.obj,k.formatter||"NumberFormat"):w(this.obj[e])}),/\$\{([^\}]+)\}/g);e=[];for(var y in d)if(a=d[y],g&&-1!==c.indexOf(g.properties||
"",y)?a=x(y,d,g.formatter||"DateString"):k&&-1!==c.indexOf(k.properties||"",y)&&(a=x(y,d,k.formatter||"NumberFormat")),e.push(y+" \x3d "+w(a)+"\x3cbr/\x3e"),b)break;return e.join("")},filter:function(d,e,a){e=t(d,a,e);a={};var b;d=e[0];for(b in d)e[2].call(e[b],d[b],b,d)&&(a[b]=d[b]);return a},startsWith:function(d,e,a){a=a||0;return d.indexOf(e,a)===a},endsWith:function(d,e,a){if("number"!==typeof a||!isFinite(a)||Math.floor(a)!==a||a>d.length)a=d.length;a-=e.length;d=d.indexOf(e,a);return-1!==d&&
d===a},isDefined:p,fixJson:e,isObject:function(d){return d&&"object"===typeof d},isString:function(d){return"string"===typeof d},mixin:function(d,e){for(var a in e)e.hasOwnProperty(a)&&(d[a]=e[a]);return d},clone2DArray:function(d){if(d=d?d.slice(0):null){var e,a=d.length;for(e=0;e<a;e++)d[e]=d[e]?d[e].slice(0):null}return d},clone3DArray:function(d){if(d=d?d.slice(0):null){var e,a=d.length;for(e=0;e<a;e++){d[e]=d[e]?d[e].slice(0):null;var b=d[e];if(b){var g,m=b.length;for(g=0;g<m;g++)b[g]=b[g]?b[g].slice(0):
null}}}return d}};n.mixin(l,v);l._isDefined=p;l._getParts=t;l._sanitize=e;return v})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(c,b){var a=c.matrix={},n={};a._degToRad=function(a){return n[a]||(n[a]=Math.PI*a/180)};a._radToDeg=function(a){return a/Math.PI*180};a.Matrix2D=function(c){if(c)if("number"==typeof c)this.xx=this.yy=c;else if(c instanceof Array){if(0<c.length){for(var v=a.normalize(c[0]),h=1;h<c.length;++h){var f=v,l=a.normalize(c[h]),v=new a.Matrix2D;v.xx=
f.xx*l.xx+f.xy*l.yx;v.xy=f.xx*l.xy+f.xy*l.yy;v.yx=f.yx*l.xx+f.yy*l.yx;v.yy=f.yx*l.xy+f.yy*l.yy;v.dx=f.xx*l.dx+f.xy*l.dy+f.dx;v.dy=f.yx*l.dx+f.yy*l.dy+f.dy}b.mixin(this,v)}}else b.mixin(this,c)};b.extend(a.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});b.mixin(a,{identity:new a.Matrix2D,flipX:new a.Matrix2D({xx:-1}),flipY:new a.Matrix2D({yy:-1}),flipXY:new a.Matrix2D({xx:-1,yy:-1}),translate:function(b,c){return 1<arguments.length?new a.Matrix2D({dx:b,dy:c}):new a.Matrix2D({dx:b.x,dy:b.y})},scale:function(b,
c){return 1<arguments.length?new a.Matrix2D({xx:b,yy:c}):"number"==typeof b?new a.Matrix2D({xx:b,yy:b}):new a.Matrix2D({xx:b.x,yy:b.y})},rotate:function(b){var c=Math.cos(b);b=Math.sin(b);return new a.Matrix2D({xx:c,xy:-b,yx:b,yy:c})},rotateg:function(b){return a.rotate(a._degToRad(b))},skewX:function(b){return new a.Matrix2D({xy:Math.tan(b)})},skewXg:function(b){return a.skewX(a._degToRad(b))},skewY:function(b){return new a.Matrix2D({yx:Math.tan(b)})},skewYg:function(b){return a.skewY(a._degToRad(b))},
reflect:function(b,c){1==arguments.length&&(c=b.y,b=b.x);var h=b*b,f=c*c,l=h+f,t=2*b*c/l;return new a.Matrix2D({xx:2*h/l-1,xy:t,yx:t,yy:2*f/l-1})},project:function(b,c){1==arguments.length&&(c=b.y,b=b.x);var h=b*b,f=c*c,l=h+f,t=b*c/l;return new a.Matrix2D({xx:h/l,xy:t,yx:t,yy:f/l})},normalize:function(b){return b instanceof a.Matrix2D?b:new a.Matrix2D(b)},isIdentity:function(a){return 1==a.xx&&0==a.xy&&0==a.yx&&1==a.yy&&0==a.dx&&0==a.dy},clone:function(b){var c=new a.Matrix2D,h;for(h in b)"number"==
typeof b[h]&&"number"==typeof c[h]&&c[h]!=b[h]&&(c[h]=b[h]);return c},invert:function(b){b=a.normalize(b);var c=b.xx*b.yy-b.xy*b.yx;return b=new a.Matrix2D({xx:b.yy/c,xy:-b.xy/c,yx:-b.yx/c,yy:b.xx/c,dx:(b.xy*b.dy-b.yy*b.dx)/c,dy:(b.yx*b.dx-b.xx*b.dy)/c})},_multiplyPoint:function(a,b,c){return{x:a.xx*b+a.xy*c+a.dx,y:a.yx*b+a.yy*c+a.dy}},multiplyPoint:function(b,c,h){b=a.normalize(b);return"number"==typeof c&&"number"==typeof h?a._multiplyPoint(b,c,h):a._multiplyPoint(b,c.x,c.y)},multiplyRectangle:function(b,
c){var h=a.normalize(b);c=c||{x:0,y:0,width:0,height:0};if(a.isIdentity(h))return{x:c.x,y:c.y,width:c.width,height:c.height};b=a.multiplyPoint(h,c.x,c.y);var f=a.multiplyPoint(h,c.x,c.y+c.height),l=a.multiplyPoint(h,c.x+c.width,c.y);c=a.multiplyPoint(h,c.x+c.width,c.y+c.height);var h=Math.min(b.x,f.x,l.x,c.x),t=Math.min(b.y,f.y,l.y,c.y);return{x:h,y:t,width:Math.max(b.x,f.x,l.x,c.x)-h,height:Math.max(b.y,f.y,l.y,c.y)-t}},multiply:function(b){for(var c=a.normalize(b),h=1;h<arguments.length;++h){var f=
c,l=a.normalize(arguments[h]),c=new a.Matrix2D;c.xx=f.xx*l.xx+f.xy*l.yx;c.xy=f.xx*l.xy+f.xy*l.yy;c.yx=f.yx*l.xx+f.yy*l.yx;c.yy=f.yx*l.xy+f.yy*l.yy;c.dx=f.xx*l.dx+f.xy*l.dy+f.dx;c.dy=f.yx*l.dx+f.yy*l.dy+f.dy}return c},_sandwich:function(b,c,h){return a.multiply(a.translate(c,h),b,a.translate(-c,-h))},scaleAt:function(b,c,h,f){switch(arguments.length){case 4:return a._sandwich(a.scale(b,c),h,f);case 3:return"number"==typeof h?a._sandwich(a.scale(b),c,h):a._sandwich(a.scale(b,c),h.x,h.y)}return a._sandwich(a.scale(b),
c.x,c.y)},rotateAt:function(b,c,h){return 2<arguments.length?a._sandwich(a.rotate(b),c,h):a._sandwich(a.rotate(b),c.x,c.y)},rotategAt:function(b,c,h){return 2<arguments.length?a._sandwich(a.rotateg(b),c,h):a._sandwich(a.rotateg(b),c.x,c.y)},skewXAt:function(b,c,h){return 2<arguments.length?a._sandwich(a.skewX(b),c,h):a._sandwich(a.skewX(b),c.x,c.y)},skewXgAt:function(b,c,h){return 2<arguments.length?a._sandwich(a.skewXg(b),c,h):a._sandwich(a.skewXg(b),c.x,c.y)},skewYAt:function(b,c,h){return 2<arguments.length?
a._sandwich(a.skewY(b),c,h):a._sandwich(a.skewY(b),c.x,c.y)},skewYgAt:function(b,c,h){return 2<arguments.length?a._sandwich(a.skewYg(b),c,h):a._sandwich(a.skewYg(b),c.x,c.y)}});c.Matrix2D=a.Matrix2D;return a})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),function(c,b,a,n,u,v,h,f,l){var t=b.getObject("dojox.gfx",!0),p=t._base={};t._hasClass=function(d,
a){return(d=d.getAttribute("className"))&&0<=(" "+d+" ").indexOf(" "+a+" ")};t._addClass=function(d,a){var e=d.getAttribute("className")||"";(!e||0>(" "+e+" ").indexOf(" "+a+" "))&&d.setAttribute("className",e+(e?" ":"")+a)};t._removeClass=function(d,a){var e=d.getAttribute("className");e&&d.setAttribute("className",e.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)"),"$1$2"))};p._getFontMeasurements=function(){var d={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,
"x-large":0,"xx-large":0},a,e;n("ie")&&(e=u.doc.documentElement.style.fontSize||"",e||(u.doc.documentElement.style.fontSize="100%"));var b=f.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},u.body());for(a in d)b.style.fontSize=a,d[a]=16*Math.round(12*b.offsetHeight/16)/12/1E3;n("ie")&&(u.doc.documentElement.style.fontSize=e);u.body().removeChild(b);return d};var w=null;
p._getCachedFontMeasurements=function(d){if(d||!w)w=p._getFontMeasurements();return w};var x=null,e={};p._getTextBox=function(d,a,b){var g,k,m=arguments.length,y;x||(x=f.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},u.body()));g=x;g.className="";k=g.style;k.borderWidth="0";k.margin="0";k.padding="0";k.outline="0";if(1<m&&a)for(y in a)y in e||(k[y]=a[y]);2<m&&b&&(g.className=b);g.innerHTML=d;g.getBoundingClientRect?(k=g.getBoundingClientRect(),k={l:k.left,t:k.top,
w:k.width||k.right-k.left,h:k.height||k.bottom-k.top}):k=l.getMarginBox(g);g.innerHTML="";return k};p._computeTextLocation=function(d,a,e,b){var g={};switch(d.align){case "end":g.x=d.x-a;break;case "middle":g.x=d.x-a/2;break;default:g.x=d.x}g.y=d.y-e*(b?.75:1);return g};p._computeTextBoundingBox=function(d){if(!t._base._isRendered(d))return{x:0,y:0,width:0,height:0};var a;a=d.getShape();var e=d.getFont()||t.defaultFont;d=d.getTextWidth();e=t.normalizedLength(e.size);a=p._computeTextLocation(a,d,e,
!0);return{x:a.x,y:a.y,width:d,height:e}};p._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==a};var m=0;p._getUniqueId=function(){var a;do a=c._scopeName+"xUnique"+ ++m;while(h.byId(a));return a};var g=n("pointer-events")?"touchAction":n("MSPointer")?"msTouchAction":null;p._fixMsTouchAction=g?function(a){a.rawNode.style[g]="none"}:function(){};b.mixin(t,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,
height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},
defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var a={};return function(e){var d=a[e];if(d)return new d;d=a[e]=new Function;d.prototype=
t["default"+e];return new d}}(),normalizeColor:function(e){return e instanceof a?e:new a(e)},normalizeParameters:function(a,e){var d;if(e){var b={};for(d in a)d in e&&!(d in b)&&(a[d]=e[d])}return a},makeParameters:function(a,e){var d=null;if(!e)return b.delegate(a);var g={};for(d in a)d in g||(g[d]=b.clone(d in e?e[d]:a[d]));return g},formatNumber:function(a,e){var d=a.toString();if(0<=d.indexOf("e"))d=a.toFixed(4);else{var b=d.indexOf(".");0<=b&&5<d.length-b&&(d=a.toFixed(4))}return 0>a?d:e?" "+
d:d},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family},splitFontString:function(a){var e=t.getDefault("Font");a=a.split(/\s+/);if(!(5>a.length)){e.style=a[0];e.variant=a[1];e.weight=a[2];var b=a[3].indexOf("/");e.size=0>b?a[3]:a[3].substring(0,b);var d=4;0>b&&("/"==a[4]?d=6:"/"==a[4].charAt(0)&&(d=5));d<a.length&&(e.family=a.slice(d).join(" "))}return e},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return t._base._getCachedFontMeasurements()["12pt"]/
12},pt2px:function(a){return a*t.px_in_pt()},px2pt:function(a){return a/t.px_in_pt()},normalizedLength:function(a){if(0===a.length)return 0;if(2<a.length){var e=t.px_in_pt(),b=parseFloat(a);switch(a.slice(-2)){case "px":return b;case "pt":return b*e;case "in":return 72*b*e;case "pc":return 12*b*e;case "mm":return b*t.mm_in_pt*e;case "cm":return b*t.cm_in_pt*e}}return parseFloat(a)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,
equalSources:function(a,e){return a&&e&&a===e},switchTo:function(a){var e="string"==typeof a?t[a]:a;e&&(v.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath EsriPath Surface createSurface fixTarget".split(" "),function(a){t[a]=e[a]}),"string"==typeof a?t.renderer=a:v.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(a){return t.renderer=t[a]&&t[a].Surface===t.Surface?a:null}))}});return t})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base",
"./gfx/renderer!"],function(c,b,a){b.switchTo(a);return b})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(c,b,a,n,u){var v=null;a.add("vml",function(a,b,c){c.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';a="adj"in c.firstChild;c.innerHTML="";return a});return{load:function(h,f,l){function t(){f(["dojox/gfx/"+p],function(a){c.renderer=p;v=a;l(a)})}if(v&&"force"!=h)l(v);else{var p=u.forceGfxRenderer;h=!p&&(b.isString(u.gfxRenderer)?
u.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var w,x;!p&&h.length;)switch(h.shift()){case "svg":"SVGAngle"in n.global&&(p="svg");break;case "vml":a("vml")&&(p="vml");break;case "silverlight":try{a("ie")?(w=new ActiveXObject("AgControl.AgControl"),w.IsVersionSupported("1.0"))&&(x=!0):navigator.plugins["Silverlight Plug-In"]&&(x=!0)}catch(e){x=!1}finally{w=null}x&&(p="silverlight");break;case "canvas":n.global.CanvasRenderingContext2D&&(p="canvas")}"canvas"===p&&!1!==u.canvasEvents&&(p=
"canvasWithEvents");"svg"==p&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(t):t()}}}})},"dojox/gfx/svg":function(){define("dojo/_base/lang dojo/_base/sniff dojo/_base/window dojo/dom dojo/_base/declare dojo/_base/array dojo/dom-geometry dojo/dom-attr dojo/_base/Color ./_base ./shape ./path".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w){function x(e,b){return a.doc.createElementNS?a.doc.createElementNS(e,b):a.doc.createElement(b)}function e(a,e,b,d){return a.setAttributeNS?a.setAttributeNS(e,
b,d):a.setAttribute(b,d)}function m(e){return g.useSvgWeb?a.doc.createTextNode(e,!0):a.doc.createTextNode(e)}var g=t.svg={};g.useSvgWeb="undefined"!=typeof window.svgweb;var d=navigator.userAgent,y=b("ios"),k=b("android"),G=b("chrome")||k&&4<=k?"auto":"optimizeLegibility";g.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"};g.getRef=function(a){return a&&"none"!=a?a.match(/^url\(#.+\)$/)?n.byId(a.slice(5,-1)):a.match(/^#dojoUnique\d+$/)?n.byId(a.slice(1)):null:null};g.dasharray=
{solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var E=0;g.Shape=u("dojox.gfx.svg.Shape",p.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var a=this.rawNode.getAttribute("fill");(a=g.getRef(a))&&a.parentNode.removeChild(a)}this.clip&&(a=this.rawNode.getAttribute("clip-path"))&&(a=n.byId(a.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);
p.Shape.prototype.destroy.apply(this,arguments)},setFill:function(a){if(!a)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var e,b=function(a){this.setAttribute(a,e[a].toFixed(8))};if("object"==typeof a&&"type"in a){switch(a.type){case "linear":e=t.makeParameters(t.defaultLinearGradient,a);a=this._setFillObject(e,"linearGradient");v.forEach(["x1","y1","x2","y2"],b,a);break;case "radial":e=t.makeParameters(t.defaultRadialGradient,
a);a=this._setFillObject(e,"radialGradient");v.forEach(["cx","cy","r"],b,a);break;case "pattern":e=t.makeParameters(t.defaultPattern,a),a=this._setFillObject(e,"pattern"),v.forEach(["x","y","width","height"],b,a)}this.fillStyle=e;return this}this.fillStyle=e=t.normalizeColor(a);this.rawNode.setAttribute("fill",e.toCss());this.rawNode.setAttribute("fill-opacity",e.a);this.rawNode.setAttribute("fill-rule","evenodd");return this},setStroke:function(a){var e=this.rawNode;if(!a)return this.strokeStyle=
null,e.setAttribute("stroke","none"),e.setAttribute("stroke-opacity",0),this;if("string"==typeof a||c.isArray(a)||a instanceof l)a={color:a};a=this.strokeStyle=t.makeParameters(t.defaultStroke,a);a.color=t.normalizeColor(a.color);if(a){var b=0>a.width?0:a.width;e.setAttribute("stroke",a.color.toCss());e.setAttribute("stroke-opacity",a.color.a);e.setAttribute("stroke-width",b);e.setAttribute("stroke-linecap",a.cap);"number"==typeof a.join?(e.setAttribute("stroke-linejoin","miter"),e.setAttribute("stroke-miterlimit",
a.join)):e.setAttribute("stroke-linejoin",a.join);var d=a.style.toLowerCase();d in g.dasharray&&(d=g.dasharray[d]);if(d instanceof Array){var d=c._toArray(d),k;for(k=0;k<d.length;++k)d[k]*=b;if("butt"!=a.cap){for(k=0;k<d.length;k+=2)d[k]-=b,1>d[k]&&(d[k]=1);for(k=1;k<d.length;k+=2)d[k]+=b}d=d.join(",")}e.setAttribute("stroke-dasharray",d);e.setAttribute("dojoGfxStrokeStyle",a.style)}return this},_getParentSurface:function(){for(var a=this.parent;a&&!(a instanceof t.Surface);a=a.parent);return a},
_setFillObject:function(a,b){var d=g.xmlns.svg;this.fillStyle=a;var k=this._getParentSurface().defNode,m=this.rawNode.getAttribute("fill");if(m=g.getRef(m))if(m.tagName.toLowerCase()!=b.toLowerCase()){var y=m.id;m.parentNode.removeChild(m);m=x(d,b);m.setAttribute("id",y);k.appendChild(m)}else for(;m.childNodes.length;)m.removeChild(m.lastChild);else m=x(d,b),m.setAttribute("id",t._base._getUniqueId()),k.appendChild(m);if("pattern"==b)m.setAttribute("patternUnits","userSpaceOnUse"),d=x(d,"image"),
d.setAttribute("x",0),d.setAttribute("y",0),d.setAttribute("width",(0>a.width?0:a.width).toFixed(8)),d.setAttribute("height",(0>a.height?0:a.height).toFixed(8)),e(d,g.xmlns.xlink,"xlink:href",a.src),m.appendChild(d);else for(m.setAttribute("gradientUnits","userSpaceOnUse"),b=0;b<a.colors.length;++b){var k=a.colors[b],y=x(d,"stop"),c=k.color=t.normalizeColor(k.color);y.setAttribute("offset",k.offset.toFixed(8));y.setAttribute("stop-color",c.toCss());y.setAttribute("stop-opacity",c.a);m.appendChild(y)}this.rawNode.setAttribute("fill",
"url(#"+m.getAttribute("id")+")");this.rawNode.removeAttribute("fill-opacity");this.rawNode.setAttribute("fill-rule","evenodd");return m},_applyTransform:function(){if(this.matrix){var a=this.matrix;this.rawNode.setAttribute("transform","matrix("+a.xx.toFixed(8)+","+a.yx.toFixed(8)+","+a.xy.toFixed(8)+","+a.yy.toFixed(8)+","+a.dx.toFixed(8)+","+a.dy.toFixed(8)+")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(a){a=this.rawNode=a;"image"!=this.shape.type&&a.setAttribute("fill",
"none");a.setAttribute("fill-opacity",0);a.setAttribute("stroke","none");a.setAttribute("stroke-opacity",0);a.setAttribute("stroke-width",1);a.setAttribute("stroke-linecap","butt");a.setAttribute("stroke-linejoin","miter");a.setAttribute("stroke-miterlimit",4);a.__gfxObject__=this},setShape:function(a){this.shape=t.makeParameters(this.shape,a);for(var e in this.shape)if("type"!=e){a=this.shape[e];if("width"===e||"height"===e)a=0>a?0:a;this.rawNode.setAttribute(e,a)}this.bbox=null;return this},_moveToFront:function(){this.rawNode.parentNode.appendChild(this.rawNode);
return this},_moveToBack:function(){this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild);return this},setClip:function(a){this.inherited(arguments);var e=a?"width"in a?"rect":"cx"in a?"ellipse":"points"in a?"polyline":"d"in a?"path":null:null;if(a&&!e)return this;"polyline"===e&&(a=c.clone(a),a.points=a.points.join(","));var b,d=f.get(this.rawNode,"clip-path");d&&(b=n.byId(d.match(/gfx_clip[\d]+/)[0]))&&b.removeChild(b.childNodes[0]);a?(b?(e=x(g.xmlns.svg,e),b.appendChild(e)):
(d="gfx_clip"+ ++E,this.rawNode.setAttribute("clip-path","url(#"+d+")"),b=x(g.xmlns.svg,"clipPath"),e=x(g.xmlns.svg,e),b.appendChild(e),this.rawNode.parentNode.insertBefore(b,this.rawNode),f.set(b,"id",d)),f.set(e,a)):(this.rawNode.removeAttribute("clip-path"),b&&b.parentNode.removeChild(b));return this},_removeClipNode:function(){var a,e=f.get(this.rawNode,"clip-path");e&&(a=n.byId(e.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);return a}});g.Group=u("dojox.gfx.svg.Group",g.Shape,{constructor:function(){p.Container._init.call(this)},
setRawNode:function(a){this.rawNode=a;this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0);g.Shape.prototype.destroy.apply(this,arguments)}});g.Group.nodeType="g";g.Rect=u("dojox.gfx.svg.Rect",[g.Shape,p.Rect],{setShape:function(a){this.shape=t.makeParameters(this.shape,a);this.bbox=null;for(var e in this.shape)if("type"!=e&&"r"!=e){a=this.shape[e];if("width"===e||"height"===e)a=0>a?0:a;this.rawNode.setAttribute(e,a)}null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),
this.rawNode.setAttribute("rx",this.shape.r));return this}});g.Rect.nodeType="rect";g.Ellipse=u("dojox.gfx.svg.Ellipse",[g.Shape,p.Ellipse],{});g.Ellipse.nodeType="ellipse";g.Circle=u("dojox.gfx.svg.Circle",[g.Shape,p.Circle],{});g.Circle.nodeType="circle";g.Line=u("dojox.gfx.svg.Line",[g.Shape,p.Line],{});g.Line.nodeType="line";g.Polyline=u("dojox.gfx.svg.Polyline",[g.Shape,p.Polyline],{setShape:function(a,e){a&&a instanceof Array?(this.shape=t.makeParameters(this.shape,{points:a}),e&&this.shape.points.length&&
this.shape.points.push(this.shape.points[0])):this.shape=t.makeParameters(this.shape,a);this.bbox=null;this._normalizePoints();a=[];e=this.shape.points;for(var b=0;b<e.length;++b)a.push(e[b].x.toFixed(8),e[b].y.toFixed(8));this.rawNode.setAttribute("points",a.join(" "));return this}});g.Polyline.nodeType="polyline";g.Image=u("dojox.gfx.svg.Image",[g.Shape,p.Image],{setShape:function(a){this.shape=t.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;for(var b in this.shape)if("type"!=b&&"src"!=
b){var d=this.shape[b];if("width"===b||"height"===b)d=0>d?0:d;a.setAttribute(b,d)}a.setAttribute("preserveAspectRatio","none");e(a,g.xmlns.xlink,"xlink:href",this.shape.src);a.__gfxObject__=this;return this}});g.Image.nodeType="image";g.Text=u("dojox.gfx.svg.Text",[g.Shape,p.Text],{setShape:function(a){this.shape=t.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;var e=this.shape;a.setAttribute("x",e.x);a.setAttribute("y",e.y);a.setAttribute("text-anchor",e.align);a.setAttribute("text-decoration",
e.decoration);a.setAttribute("rotate",e.rotated?90:0);a.setAttribute("kerning",e.kerning?"auto":0);a.setAttribute("text-rendering",G);a.firstChild?a.firstChild.nodeValue=e.text:a.appendChild(m(e.text));return this},getTextWidth:function(){var a=this.rawNode,e=a.parentNode,a=a.cloneNode(!0);a.style.visibility="hidden";var b=0,d=a.firstChild.nodeValue;e.appendChild(a);if(""!=d)for(;!b;)b=a.getBBox?parseInt(a.getBBox().width):68;e.removeChild(a);return b},getBoundingBox:function(){var a=null;if(this.getShape().text)try{a=
this.rawNode.getBBox()}catch(J){a={x:0,y:0,width:0,height:0}}return a}});g.Text.nodeType="text";g.Path=u("dojox.gfx.svg.Path",[g.Shape,w.Path],{_updateWithSegment:function(a){this.inherited(arguments);"string"==typeof this.shape.path&&this.rawNode.setAttribute("d",this.shape.path)},setShape:function(a){this.inherited(arguments);this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d");return this}});g.Path.nodeType="path";g.TextPath=u("dojox.gfx.svg.TextPath",
[g.Shape,w.TextPath],{_updateWithSegment:function(a){this.inherited(arguments);this._setTextPath()},setShape:function(a){this.inherited(arguments);this._setTextPath();return this},_setTextPath:function(){if("string"==typeof this.shape.path){var a=this.rawNode;if(!a.firstChild){var b=x(g.xmlns.svg,"textPath"),d=m("");b.appendChild(d);a.appendChild(b)}b=(b=a.firstChild.getAttributeNS(g.xmlns.xlink,"href"))&&g.getRef(b);if(!b&&(d=this._getParentSurface())){var d=d.defNode,b=x(g.xmlns.svg,"path"),k=t._base._getUniqueId();
b.setAttribute("id",k);d.appendChild(b);e(a.firstChild,g.xmlns.xlink,"xlink:href","#"+k)}b&&b.setAttribute("d",this.shape.path)}},_setText:function(){var a=this.rawNode;if(!a.firstChild){var e=x(g.xmlns.svg,"textPath"),b=m("");e.appendChild(b);a.appendChild(e)}a=a.firstChild;e=this.text;a.setAttribute("alignment-baseline","middle");switch(e.align){case "middle":a.setAttribute("text-anchor","middle");a.setAttribute("startOffset","50%");break;case "end":a.setAttribute("text-anchor","end");a.setAttribute("startOffset",
"100%");break;default:a.setAttribute("text-anchor","start"),a.setAttribute("startOffset","0%")}a.setAttribute("baseline-shift","0.5ex");a.setAttribute("text-decoration",e.decoration);a.setAttribute("rotate",e.rotated?90:0);a.setAttribute("kerning",e.kerning?"auto":0);a.firstChild.data=e.text}});g.TextPath.nodeType="text";var C=534<function(){var a=/WebKit\/(\d*)/.exec(d);return a?a[1]:0}();g.Surface=u("dojox.gfx.svg.Surface",p.Surface,{constructor:function(){p.Container._init.call(this)},destroy:function(){p.Container.clear.call(this,
!0);this.defNode=null;this.inherited(arguments)},setDimensions:function(a,e){if(!this.rawNode)return this;a=0>a?0:a;e=0>e?0:e;this.rawNode.setAttribute("width",a);this.rawNode.setAttribute("height",e);C&&(this.rawNode.style.width=a,this.rawNode.style.height=e);return this},getDimensions:function(){return this.rawNode?{width:t.normalizedLength(this.rawNode.getAttribute("width")),height:t.normalizedLength(this.rawNode.getAttribute("height"))}:null}});g.createSurface=function(a,e,b){var d=new g.Surface;
d.rawNode=x(g.xmlns.svg,"svg");d.rawNode.setAttribute("overflow","hidden");e&&d.rawNode.setAttribute("width",0>e?0:e);b&&d.rawNode.setAttribute("height",0>b?0:b);e=x(g.xmlns.svg,"defs");d.rawNode.appendChild(e);d.defNode=e;d._parent=n.byId(a);d._parent.appendChild(d.rawNode);t._base._fixMsTouchAction(d);return d};b={_setFont:function(){var a=this.fontStyle;this.rawNode.setAttribute("font-style",a.style);this.rawNode.setAttribute("font-variant",a.variant);this.rawNode.setAttribute("font-weight",a.weight);
this.rawNode.setAttribute("font-size",a.size);this.rawNode.setAttribute("font-family",a.family)}};var D=p.Container;u=g.Container={openBatch:function(){if(!this._batch){var e;e=g.useSvgWeb?a.doc.createDocumentFragment(!0):a.doc.createDocumentFragment();this.fragment=e}++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment);return this},add:function(a){this!=a.getParent()&&
(this.fragment?this.fragment.appendChild(a.rawNode):this.rawNode.appendChild(a.rawNode),D.add.apply(this,arguments),a.setClip(a.clip));return this},remove:function(a,e){this==a.getParent()&&(this.rawNode==a.rawNode.parentNode&&this.rawNode.removeChild(a.rawNode),this.fragment&&this.fragment==a.rawNode.parentNode&&this.fragment.removeChild(a.rawNode),a._removeClipNode(),D.remove.apply(this,arguments));return this},clear:function(){for(var a=this.rawNode;a.lastChild;)a.removeChild(a.lastChild);var e=
this.defNode;if(e){for(;e.lastChild;)e.removeChild(e.lastChild);a.appendChild(e)}return D.clear.apply(this,arguments)},getBoundingBox:D.getBoundingBox,_moveChildToFront:D._moveChildToFront,_moveChildToBack:D._moveChildToBack};w=g.Creator={createObject:function(a,e){if(!this.rawNode)return null;var b=new a;a=x(g.xmlns.svg,a.nodeType);b.setRawNode(a);b.setShape(e);this.add(b);return b}};c.extend(g.Text,b);c.extend(g.TextPath,b);c.extend(g.Group,u);c.extend(g.Group,p.Creator);c.extend(g.Group,w);c.extend(g.Surface,
u);c.extend(g.Surface,p.Creator);c.extend(g.Surface,w);g.fixTarget=function(a,e){a.gfxTarget||(a.gfxTarget=y&&a.target.wholeText?a.target.parentElement.__gfxObject__:a.target.__gfxObject__);return!0};g.useSvgWeb&&(g.createSurface=function(a,e,b){var d=new g.Surface;e=0>e?0:e;b=0>b?0:b;if(!e||!b){var k=h.position(a);e=e||k.w;b=b||k.h}a=n.byId(a);var k=a.id?a.id+"_svgweb":t._base._getUniqueId(),m=x(g.xmlns.svg,"svg");m.id=k;m.setAttribute("width",e);m.setAttribute("height",b);svgweb.appendChild(m,a);
m.addEventListener("SVGLoad",function(){d.rawNode=this;d.isLoaded=!0;var a=x(g.xmlns.svg,"defs");d.rawNode.appendChild(a);d.defNode=a;if(d.onLoad)d.onLoad(d)},!1);d.isLoaded=!1;return d},g.Surface.extend({destroy:function(){var a=this.rawNode;svgweb.removeChild(a,a.parentNode)}}),b={connect:function(a,e,b){"on"===a.substring(0,2)&&(a=a.substring(2));b=2==arguments.length?e:c.hitch(e,b);this.getEventSource().addEventListener(a,b,!1);return[this,a,b]},disconnect:function(a){this.getEventSource().removeEventListener(a[1],
a[2],!1);delete a[0]}},c.extend(g.Shape,b),c.extend(g.Surface,b));return g})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(c,b,a,n,u,v,h,f,l,t){function p(a,e){for(var b=a.length-1;e<b;)a[e]=a[++e];a.length=b}var w=c.shape={};w.Shape=a("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=
this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(u("gfxRegistry")){var a=w.register(this);this.getUID=function(){return a}}},destroy:function(){u("gfxRegistry")&&w.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},
getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var e=this._getRealMatrix();return[t.multiplyPoint(e,a.x,a.y),t.multiplyPoint(e,a.x+a.width,a.y),t.multiplyPoint(e,a.x+a.width,a.y+a.height),t.multiplyPoint(e,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=c.makeParameters(this.shape,a);this.bbox=null;
return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var e=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":e=c.makeParameters(c.defaultLinearGradient,a);break;case "radial":e=c.makeParameters(c.defaultRadialGradient,a);break;case "pattern":e=c.makeParameters(c.defaultPattern,a)}else e=c.normalizeColor(a);this.fillStyle=e;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||b.isArray(a)||a instanceof l)a={color:a};a=
this.strokeStyle=c.makeParameters(c.defaultStroke,a);a.color=c.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=t.clone(a?t.normalize(a):t.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},
applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&this.parent.remove(this,a);return this},_setParent:function(a,e){this.parent=a;return this._updateParentMatrix(e)},_updateParentMatrix:function(a){this.parentMatrix=a?t.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=
this.matrix,e=this.parent;e;)e.matrix&&(a=t.multiply(e.matrix,a)),e=e.parent;return a}});w._eventsProcessing={on:function(a,e){return v(this.getEventSource(),a,w.fixCallback(this,c.fixTarget,e))},connect:function(a,e,m){"on"==a.substring(0,2)&&(a=a.substring(2));return this.on(a,m?b.hitch(e,m):e)},disconnect:function(a){return a.remove()}};w.fixCallback=function(a,e,m,g){g||(g=m,m=null);if(b.isString(g)){m=m||n.global;if(!m[g])throw['dojox.gfx.shape.fixCallback: scope["',g,'"] is null (scope\x3d"',
m,'")'].join("");return function(b){return e(b,a)?m[g].apply(m,arguments||[]):void 0}}return m?function(b){return e(b,a)?g.apply(m,arguments||[]):void 0}:function(b){return e(b,a)?g.apply(m,arguments):void 0}};b.extend(w.Shape,w._eventsProcessing);w.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var e=a.getParent();e&&e.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},
remove:function(a,e){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){e||(a.parent=null,a.parentMatrix=null);p(this.children,b);break}return this},clear:function(a){for(var e,b=0;b<this.children.length;++b)e=this.children[b],e.parent=null,e.parentMatrix=null,a&&e.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var a=null;h.forEach(this.children,function(e){var b=e.getBoundingBox();b&&((e=e.getTransform())&&(b=t.multiplyRectangle(e,b)),a?(a.x=Math.min(a.x,
b.x),a.y=Math.min(a.y,b.y),a.endX=Math.max(a.endX,b.x+b.width),a.endY=Math.max(a.endY,b.y+b.height)):a={x:b.x,y:b.y,endX:b.x+b.width,endY:b.y+b.height})});a&&(a.width=a.endX-a.x,a.height=a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var e=0;e<this.children.length;++e)if(this.children[e]==a){p(this.children,e);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var e=0;e<this.children.length;++e)if(this.children[e]==a){p(this.children,e);this.children.unshift(a);
break}return this}};w.Surface=a("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){h.forEach(this._nodes,f.destroy);this._nodes=[];h.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;if(u("ie"))for(;this._parent.lastChild;)f.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},
isLoaded:!0,onLoad:function(a){},whenLoaded:function(a,e){var m=b.hitch(a,e);if(this.isLoaded)m(this);else v.once(this,"load",function(a){m(a)})}});b.extend(w.Surface,w._eventsProcessing);w.Rect=a("dojox.gfx.shape.Rect",w.Shape,{constructor:function(a){this.shape=c.getDefault("Rect");this.rawNode=a},getBoundingBox:function(){return this.shape}});w.Ellipse=a("dojox.gfx.shape.Ellipse",w.Shape,{constructor:function(a){this.shape=c.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=
this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});w.Circle=a("dojox.gfx.shape.Circle",w.Shape,{constructor:function(a){this.shape=c.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});w.Line=a("dojox.gfx.shape.Line",w.Shape,{constructor:function(a){this.shape=c.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=
this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});w.Polyline=a("dojox.gfx.shape.Polyline",w.Shape,{constructor:function(a){this.shape=c.getDefault("Polyline");this.rawNode=a},setShape:function(a,e){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),e&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=
this.shape.points,e=a&&a.length;if(e&&"number"==typeof a[0]){for(var b=[],g=0;g<e;g+=2)b.push({x:a[g],y:a[g+1]});this.shape.points=b}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,e=a.length,b=a[0],g=b.x,d=b.y,y=b.x,k=b.y,c=1;c<e;++c)b=a[c],g>b.x&&(g=b.x),y<b.x&&(y=b.x),d>b.y&&(d=b.y),k<b.y&&(k=b.y);this.bbox={x:g,y:d,width:y-g,height:k-d}}return this.bbox}});w.Image=a("dojox.gfx.shape.Image",w.Shape,{constructor:function(a){this.shape=c.getDefault("Image");
this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});w.Text=a(w.Shape,{constructor:function(a){this.fontStyle=null;this.shape=c.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},setFont:function(a){this.fontStyle="string"==typeof a?c.splitFontString(a):c.makeParameters(c.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=c._base._computeTextBoundingBox(this));
return a}});w.Creator={createShape:function(a){switch(a.type){case c.defaultPath.type:return this.createPath(a);case c.defaultRect.type:return this.createRect(a);case c.defaultCircle.type:return this.createCircle(a);case c.defaultEllipse.type:return this.createEllipse(a);case c.defaultLine.type:return this.createLine(a);case c.defaultPolyline.type:return this.createPolyline(a);case c.defaultImage.type:return this.createImage(a);case c.defaultText.type:return this.createText(a);case c.defaultTextPath.type:return this.createTextPath(a)}return null},
createGroup:function(){return this.createObject(c.Group)},createRect:function(a){return this.createObject(c.Rect,a)},createEllipse:function(a){return this.createObject(c.Ellipse,a)},createCircle:function(a){return this.createObject(c.Circle,a)},createLine:function(a){return this.createObject(c.Line,a)},createPolyline:function(a){return this.createObject(c.Polyline,a)},createImage:function(a){return this.createObject(c.Image,a)},createText:function(a){return this.createObject(c.Text,a)},createPath:function(a){return this.createObject(c.Path,
a)},createTextPath:function(a){return this.createObject(c.TextPath,{}).setText(a)},createObject:function(a,e){return null}};return w})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(c,b,a,n,u){u=a("dojox.gfx.path.Path",u.Shape,{constructor:function(a){this.shape=b.clone(c.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=a;this.segmented=!1},setAbsoluteMode:function(a){this._confirmSegmented();
this.absolute="string"==typeof a?"absolute"==a:a;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var a=this.bbox,b=this._getRealMatrix();this.bbox=null;for(var c=0,l=this.segments.length;c<l;++c)this._updateWithSegment(this.segments[c],
b);b=this.bbox;this.bbox=a;return this.tbbox=b?[{x:b.l,y:b.t},{x:b.r,y:b.t},{x:b.r,y:b.b},{x:b.l,y:b.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(a,b,c){c&&(b=n.multiplyPoint(c,a,b),a=b.x,b=b.y);this.bbox&&"l"in this.bbox?(this.bbox.l>a&&(this.bbox.l=a),this.bbox.r<a&&(this.bbox.r=a),this.bbox.t>b&&(this.bbox.t=b),this.bbox.b<b&&(this.bbox.b=b)):
this.bbox={l:a,b:b,r:a,t:b}},_updateWithSegment:function(a,b){var f=a.args,l=f.length,t;switch(a.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(t=0;t<l;t+=2)this._updateBBox(f[t],f[t+1],b);this.last.x=f[l-2];this.last.y=f[l-1];this.absolute=!0;break;case "H":for(t=0;t<l;++t)this._updateBBox(f[t],this.last.y,b);this.last.x=f[l-1];this.absolute=!0;break;case "V":for(t=0;t<l;++t)this._updateBBox(this.last.x,f[t],b);this.last.y=f[l-1];this.absolute=!0;break;case "m":t=0;"x"in this.last||
(this._updateBBox(this.last.x=f[0],this.last.y=f[1],b),t=2);for(;t<l;t+=2)this._updateBBox(this.last.x+=f[t],this.last.y+=f[t+1],b);this.absolute=!1;break;case "l":case "t":for(t=0;t<l;t+=2)this._updateBBox(this.last.x+=f[t],this.last.y+=f[t+1],b);this.absolute=!1;break;case "h":for(t=0;t<l;++t)this._updateBBox(this.last.x+=f[t],this.last.y,b);this.absolute=!1;break;case "v":for(t=0;t<l;++t)this._updateBBox(this.last.x,this.last.y+=f[t],b);this.absolute=!1;break;case "c":for(t=0;t<l;t+=6)this._updateBBox(this.last.x+
f[t],this.last.y+f[t+1],b),this._updateBBox(this.last.x+f[t+2],this.last.y+f[t+3],b),this._updateBBox(this.last.x+=f[t+4],this.last.y+=f[t+5],b);this.absolute=!1;break;case "s":case "q":for(t=0;t<l;t+=4)this._updateBBox(this.last.x+f[t],this.last.y+f[t+1],b),this._updateBBox(this.last.x+=f[t+2],this.last.y+=f[t+3],b);this.absolute=!1;break;case "A":for(t=0;t<l;t+=7)this._updateBBox(f[t+5],f[t+6],b);this.last.x=f[l-2];this.last.y=f[l-1];this.absolute=!0;break;case "a":for(t=0;t<l;t+=7)this._updateBBox(this.last.x+=
f[t+5],this.last.y+=f[t+6],b);this.absolute=!1}a=[a.action];for(t=0;t<l;++t)a.push(c.formatNumber(f[t],!0));if("string"==typeof this.shape.path)this.shape.path+=a.join("");else for(t=0,l=a.length;t<l;++t)this.shape.path.push(a[t])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(a,b){this.tbbox=null;var c=this._validSegments[a.toLowerCase()];"number"==typeof c&&(c?b.length>=c&&(a={action:a,args:b.slice(0,b.length-b.length%c)},this.segments.push(a),this._updateWithSegment(a)):
(a={action:a,args:[]},this.segments.push(a),this._updateWithSegment(a)))},_collectArgs:function(a,b){for(var c=0;c<b.length;++c){var l=b[c];"boolean"==typeof l?a.push(l?1:0):"number"==typeof l?a.push(l):l instanceof Array?this._collectArgs(a,l):"x"in l&&"y"in l&&a.push(l.x,l.y)}},moveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"M":"m",a);return this},lineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);
this._pushSegment(this.absolute?"L":"l",a);return this},hLineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"H":"h",a);return this},vLineTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"V":"v",a);return this},curveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"C":"c",a);return this},smoothCurveTo:function(){this._confirmSegmented();
var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"S":"s",a);return this},qCurveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"Q":"q",a);return this},qSmoothCurveTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"T":"t",a);return this},arcTo:function(){this._confirmSegmented();var a=[];this._collectArgs(a,arguments);this._pushSegment(this.absolute?"A":
"a",a);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var a=this.shape.path;this.shape.path=[];this._setPath(a);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(a){a=b.isArray(a)?a:a.match(c.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(a){for(var h="",f=[],l=a.length,t=0;t<l;++t){var p=a[t],w=parseFloat(p);isNaN(w)?(h&&this._pushSegment(h,
f),f=[],h=p):f.push(w)}this._pushSegment(h,f)}},setShape:function(a){this.inherited(arguments,["string"==typeof a?{path:a}:a]);this.segmented=!1;this.segments=[];c.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});a=a("dojox.gfx.path.TextPath",u,{constructor:function(a){"text"in this||(this.text=b.clone(c.defaultTextPath));"fontStyle"in this||(this.fontStyle=b.clone(c.defaultFont))},getText:function(){return this.text},setText:function(a){this.text=c.makeParameters(this.text,
"string"==typeof a?{text:a}:a);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(a){this.fontStyle="string"==typeof a?c.splitFontString(a):c.makeParameters(c.defaultFont,a);this._setFont();return this}});return c.path={Path:u,TextPath:a}})},"dojox/gfx/filters":function(){define(["dojo/_base/lang","dojo/_base/array"],function(c,b){var a={},n={x:"0%",y:"0%",width:"100%",height:"100%"},u={};a.createFilter=function(a,b){a=c.mixin({},n,a);a.primitives||(a.primitives=
[]);b&&Array.prototype.push.apply(a.primitives,b);return a};var v=function(a,b,e){b instanceof Array&&(e=b,b=null);b=c.mixin({},b);b.children=e;b.tag=a;return b};b.forEach("feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feFlood feGaussianBlur feImage feMorphology feOffset feSpecularLighting feTile feTurbulence feDistantLight fePointLight feSpotLight feMergeNode feFuncA feFuncR feFuncG feFuncB".split(" "),function(b){a[b]=function(a,e){return v(b,
a,e)}});a.feMerge=function(b,c){if("string"===typeof b){for(var e=[],m=0;m<arguments.length;++m)e.push(a.feMergeNode({"in":arguments[m]}));return v("feMerge",{},e)}return v("feMerge",b,c)};var h=a.createFilter;u.convolutions=[h({_gfxName:"boxBlur3"},[a.feConvolveMatrix({"in":"SourceGraphic",order:3,divisor:9,kernelMatrix:"1,1,1,1,1,1,1,1,1"})]),h({_gfxName:"boxBlur5"},[a.feConvolveMatrix({"in":"SourceGraphic",order:5,divisor:25,kernelMatrix:"1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1"})]),
h({_gfxName:"verticalEdges",filterUnits:"objectBoundingBox"},[a.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:1,kernelMatrix:"-1 0 1 -1 0 1 -1 0 1"}),a.feComponentTransfer({"in":"kernel"},[a.feFuncA({type:"table",tableValues:"1,1"})])]),h({_gfxName:"horizontalEdges",filterUnits:"objectBoundingBox"},[a.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:1,kernelMatrix:"1 1 1 0 0 0 -1 -1 -1"}),a.feComponentTransfer({"in":"kernel"},[a.feFuncA({type:"table",
tableValues:"1,1"})])]),h({_gfxName:"allEdges3",filterUnits:"objectBoundingBox"},[a.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:1,kernelMatrix:"-1 -1 -1 -1 8 -1 -1 -1 -1"}),a.feComponentTransfer({"in":"kernel"},[a.feFuncA({type:"table",tableValues:"1,1"})])]),h({_gfxName:"edgeEnhance",filterUnits:"objectBoundingBox"},[a.feConvolveMatrix({"in":"SourceGraphic",result:"kernel",order:3,divisor:-1,kernelMatrix:"0 1 0 1 -5 1 0 1 0"}),a.feComponentTransfer({"in":"kernel"},[a.feFuncA({type:"table",
tableValues:"1,1"})])])];b.forEach(u.convolutions,function(a){c.mixin(a,n)});u.shadows=[h({_gfxName:"fastSmallDropShadow"},[a.feColorMatrix({"in":"SourceAlpha",type:"matrix",result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0.7,0"}),a.feOffset({dx:3,dy:3,result:"offsetBlur"}),a.feMerge("offsetBlur","SourceGraphic")]),h({_gfxName:"fastDropShadow"},[a.feColorMatrix({"in":"SourceAlpha",type:"matrix",result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0.7,0"}),
a.feOffset({dx:5,dy:5,result:"offsetBlur"}),a.feMerge("offsetBlur","SourceGraphic")]),h({_gfxName:"fastDropShadowLight"},[a.feColorMatrix({"in":"SourceAlpha",type:"matrix",result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0.4,0"}),a.feOffset({dx:5,dy:5,result:"offsetBlur"}),a.feMerge("offsetBlur","SourceGraphic")]),h({_gfxName:"dropShadow"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:4}),a.feOffset({dx:5,dy:5,result:"offsetBlur"}),a.feMerge("offsetBlur",
"SourceGraphic")]),h({_gfxName:"dropShadowLight"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:4,result:"blur"}),a.feComponentTransfer({"in":"blur",result:"lessblur"},[a.feFuncA({type:"linear",slope:.5})]),a.feOffset({"in":"lessblur",dx:5,dy:5,result:"offsetBlur"}),a.feMerge("offsetBlur","SourceGraphic")]),h({_gfxName:"smallDropShadow"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:3}),a.feOffset({dx:2,dy:2,result:"offsetBlur"}),a.feMerge("offsetBlur","SourceGraphic")]),h({_gfxName:"smallDropShadowLight"},
[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:3,result:"blur"}),a.feComponentTransfer({"in":"blur",result:"lessblur"},[a.feFuncA({type:"linear",slope:.5})]),a.feOffset({"in":"lessblur",dx:2,dy:2,result:"offsetBlur"}),a.feMerge("offsetBlur","SourceGraphic")])];var f={x:"-10%",y:"-10%",width:"125%",height:"125%"};b.forEach(u.shadows,function(a){c.mixin(a,f)});u.blurs=[h({_gfxName:"blur1",x:"-5%",y:"-5%",width:"110%",height:"110%"},[a.feGaussianBlur({"in":"SourceGraphic",stdDeviation:1})]),h({_gfxName:"blur2",
x:"-15%",y:"-15%",width:"130%",height:"130%"},[a.feGaussianBlur({"in":"SourceGraphic",stdDeviation:2})]),h({_gfxName:"blur4",x:"-15%",y:"-15%",width:"130%",height:"130%"},[a.feGaussianBlur({"in":"SourceGraphic",stdDeviation:4})]),h({_gfxName:"blur8",x:"-20%",y:"-20%",width:"140%",height:"140%"},[a.feGaussianBlur({"in":"SourceGraphic",stdDeviation:8})]),h({_gfxName:"glow",x:"-10%",y:"-10%",width:"120%",height:"120%"},[a.feGaussianBlur({"in":"SourceGraphic",stdDeviation:2}),a.feComponentTransfer([a.feFuncA({type:"linear",
slope:10})])])];u.colors=[h({_gfxName:"negate"},[a.feComponentTransfer([a.feFuncR({type:"table",tableValues:"1,0"}),a.feFuncG({type:"table",tableValues:"1,0"}),a.feFuncB({type:"table",tableValues:"1,0"})])]),h({_gfxName:"sepia"},[a.feColorMatrix({result:"grey",values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,1,0"}),a.feComponentTransfer({"in":"grey"},[a.feFuncR({type:"linear",slope:.5,intercept:.5}),a.feFuncB({type:"table",tableValues:"0,0"})])]),h({_gfxName:"grayscale"},
[a.feColorMatrix({values:"0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,1,0"})]),h({_gfxName:"showRed"},[a.feComponentTransfer([a.feFuncG({type:"table",tableValues:"0,0"}),a.feFuncB({type:"table",tableValues:"0,0"})])]),h({_gfxName:"showGreen"},[a.feComponentTransfer([a.feFuncR({type:"table",tableValues:"0,0"}),a.feFuncB({type:"table",tableValues:"0,0"})])]),h({_gfxName:"showBlue"},[a.feComponentTransfer([a.feFuncR({type:"table",tableValues:"0,0"}),a.feFuncG({type:"table",
tableValues:"0,0"})])]),h({_gfxName:"hueRotate60"},[a.feColorMatrix({type:"hueRotate",values:60})]),h({_gfxName:"hueRotate120"},[a.feColorMatrix({type:"hueRotate",values:120})]),h({_gfxName:"hueRotate180"},[a.feColorMatrix({type:"hueRotate",values:180})]),h({_gfxName:"hueRotate270"},[a.feColorMatrix({type:"hueRotate",values:270})])];b.forEach(u.colors,function(a){c.mixin(a,n)});u.miscs=[h({_gfxName:"thinEmbossDropShadow",x:"-5%",y:"-5%",width:"120%",height:"120%"},[a.feGaussianBlur({"in":"SourceAlpha",
stdDeviation:1,result:"blur"}),a.feOffset({"in":"blur",dx:6,dy:6,result:"offsetBlur"}),a.feSpecularLighting({"in":"blur",surfaceScale:8,specularConstant:1,specularExponent:12,result:"specOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",result:"litPaint",k1:0,k2:1,k3:1,k4:0}),a.feMerge("offsetBlur","litPaint")]),h({_gfxName:"embossDropShadow",
x:"-5%",y:"-5%",width:"120%",height:"120%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"4",result:"blur"}),a.feOffset({"in":"blur",dx:4,dy:4,result:"offsetBlur"}),a.feSpecularLighting({"in":"blur",surfaceScale:5,specularConstant:.75,specularExponent:20,"lighting-color":"#bbbbbb",result:"specOut"},[a.fePointLight({x:-5E3,y:-1E4,z:2E4})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,
k2:1,k3:1,k4:0,result:"litPaint"}),a.feMerge("offsetBlur","litPaint")]),h({_gfxName:"largeEmbossDropShadow",x:"-20%",y:"-20%",width:"140%",height:"140%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:5,result:"blur"}),a.feOffset({"in":"blur",dx:6,dy:6,result:"offsetBlur"}),a.feSpecularLighting({"in":"blur",surfaceScale:8,specularConstant:1,specularExponent:12,result:"spec"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"spec",in2:"SourceGraphic",operator:"in",result:"specOut"}),
a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",result:"litPaint",k1:0,k2:1,k3:1,k4:0}),a.feMerge("offsetBlur","litPaint")]),h({_gfxName:"thinEmbossDropShadowLight",x:"-5%",y:"-5%",width:"120%",height:"120%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:1,result:"blur"}),a.feComponentTransfer({"in":"blur",result:"lessblur"},[a.feFuncA({type:"linear",slope:"0.5"})]),a.feOffset({"in":"lessblur",dx:"6",dy:"6",result:"offsetBlur"}),a.feSpecularLighting({"in":"lessblur",surfaceScale:8,
specularConstant:1,specularExponent:"12",result:"specOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",result:"litPaint",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0}),a.feMerge("offsetBlur","litPaint")]),h({_gfxName:"embossDropShadowLight",x:"-5%",y:"-5%",width:"120%",height:"120%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"3",result:"blur"}),a.feComponentTransfer({"in":"blur",
result:"lessblur"},[a.feFuncA({type:"linear",slope:"0.5"})]),a.feOffset({"in":"lessblur",dx:"6",dy:"6",result:"offsetBlur"}),a.feSpecularLighting({"in":"lessblur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",result:"litPaint",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"}),a.feMerge("offsetBlur",
"litPaint")]),h({_gfxName:"largeEmbossDropShadowLight",x:"-20%",y:"-20%",width:"140%",height:"140%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"5",result:"blur"}),a.feComponentTransfer({"in":"blur",result:"lessblur"},[a.feFuncA({type:"linear",slope:"0.5"})]),a.feOffset({"in":"lessblur",dx:"6",dy:"6",result:"offsetBlur"}),a.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"spec"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"spec",
in2:"SourceGraphic",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0",result:"litPaint"}),a.feMerge("offsetBlur","litPaint")]),h({_gfxName:"fuzzy",x:"-10%",y:"-10%",width:"120%",height:"120%"},[a.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"turb2"}),a.feDisplacementMap({"in":"SourceGraphic",in2:"turb2",result:"turb2",scale:"20",xChannelSelector:"R",yChannelSelector:"G"})]),h({_gfxName:"veryFuzzy",
x:"-20%",y:"-20%",width:"140%",height:"140%"},[a.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"turb2"}),a.feDisplacementMap({"in":"SourceGraphic",in2:"turb2",result:"turb2",scale:"35",xChannelSelector:"R",yChannelSelector:"G"})]),h({_gfxName:"melting",x:"-10%",y:"-10%",width:"120%",height:"120%"},[a.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"2",result:"turb"}),a.feDisplacementMap({result:"bended","in":"SourceGraphic",in2:"turb",scale:"25",xChannelSelector:"R",
yChannelSelector:"G"}),a.feGaussianBlur({"in":"bended",stdDeviation:"1",result:"bb"}),a.feComponentTransfer({"in":"bb",result:"BendedSource"},[a.feFuncA({type:"linear",slope:10,intercept:"-1"})]),a.feComponentTransfer({"in":"BendedSource",result:"BendedAlpha"},[a.feFuncR({type:"linear",slope:"0",intercept:"0"}),a.feFuncG({type:"linear",slope:"0",intercept:"0"}),a.feFuncB({type:"linear",slope:"0",intercept:"0"}),a.feFuncA({type:"linear",slope:"1",intercept:"0"})]),a.feGaussianBlur({"in":"BendedAlpha",
stdDeviation:"1",result:"blur"}),a.feSpecularLighting({"in":"blur","lighting-color":"rgb(80%, 80%, 80%)",surfaceScale:"5",specularConstant:"1",specularExponent:"10",result:"specularOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"20000"})]),a.feComposite({"in":"specularOut",in2:"BendedAlpha",operator:"in",result:"specularOut"}),a.feComposite({"in":"BendedSource",in2:"specularOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0",result:"litPaint"})]),h({_gfxName:"impressionist",x:"0%",y:"0%",width:"100%",
height:"100%"},[a.feMorphology({"in":"SourceGraphic",operator:"dilate",radius:"2"})]),h({_gfxName:"holes",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feTurbulence({type:"fractalNoise",baseFrequency:"0.1",numOctaves:"1",result:"texture"}),a.feComponentTransfer({"in":"texture",result:"holes"},[a.feFuncA({type:"discrete",tableValues:"0,1"})]),a.feComposite({"in":"SourceGraphic",in2:"holes",operator:"out"})]),h({_gfxName:"holesComplement",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feTurbulence({type:"fractalNoise",
baseFrequency:"0.1",numOctaves:"1",result:"texture"}),a.feComponentTransfer({"in":"texture",result:"holes"},[a.feFuncA({type:"discrete",tableValues:"1,0"})]),a.feComposite({"in":"SourceGraphic",in2:"holes",operator:"out"})])];u.reliefs=[h({_gfxName:"bumpIn",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feColorMatrix({"in":"SourceGraphic",type:"luminanceToAlpha",result:"lumalpha"}),a.feComponentTransfer({"in":"lumalpha",result:"invertedalpha"},[a.feFuncA({type:"table",tableValues:"1,0"})]),a.feDiffuseLighting({"in":"invertedalpha",
"lighting-color":"rgb(60%, 60%, 60%)",result:"diffuse",surfaceScale:"5"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),a.feSpecularLighting({"in":"invertedalpha",result:"specular",surfaceScale:"5",specularExponent:"6"},[a.feDistantLight({azimuth:"135",elevation:"30"})]),a.feComposite({"in":"diffuse",in2:"specular",operator:"arithmetic",k2:"1.0",k3:"1.0"})]),h({_gfxName:"bumpOut",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feColorMatrix({"in":"SourceGraphic",type:"luminanceToAlpha",result:"lumalpha"}),
a.feDiffuseLighting({"in":"lumalpha","lighting-color":"rgb(60%, 60%, 60%)",result:"diffuse",surfaceScale:"5"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),a.feSpecularLighting({"in":"lumalpha",result:"specular",surfaceScale:"5",specularExponent:"6"},[a.feDistantLight({azimuth:"135",elevation:"30"})]),a.feComposite({"in":"diffuse",in2:"specular",operator:"arithmetic",k2:"1.0",k3:"1.0"})]),h({_gfxName:"thinEmboss",x:"-5%",y:"-5%",width:"110%",height:"110%"},[a.feGaussianBlur({"in":"SourceAlpha",
stdDeviation:"1",result:"blur"}),a.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]),h({_gfxName:"emboss",x:"-5%",y:"-5%",width:"110%",height:"110%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"3",
result:"blur"}),a.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})]),h({_gfxName:"largeEmboss",x:"-5%",y:"-5%",width:"110%",height:"110%"},[a.feGaussianBlur({"in":"SourceAlpha",stdDeviation:"5",result:"blur"}),
a.feSpecularLighting({"in":"blur",surfaceScale:"8",specularConstant:"1",specularExponent:"12",result:"specOut"},[a.fePointLight({x:"-5000",y:"-10000",z:"12000"})]),a.feComposite({"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"}),a.feComposite({"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:"0",k2:"1",k3:"1",k4:"0"})])];u.textures=[h({_gfxName:"paper",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feTurbulence({type:"turbulence",baseFrequency:"0.01",numOctaves:"5",result:"texture"}),
a.feDiffuseLighting({"in":"texture",result:"diffuse",surfaceScale:"-10"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),a.feComposite({"in":"diffuse",in2:"SourceGraphic",operator:"arithmetic",k1:"1",k2:"0",k3:"0",k4:"0"})]),h({_gfxName:"swirl",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feTurbulence({type:"turbulence",baseFrequency:"0.05",numOctaves:"1",result:"texture"}),a.feDiffuseLighting({"in":"texture",result:"diffuse",surfaceScale:"-10"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),
a.feComposite({"in":"diffuse",in2:"SourceGraphic",operator:"arithmetic",k1:"1",k2:"0",k3:"0",k4:"0"})]),h({_gfxName:"swirl2",x:"0%",y:"0%",width:"100%",height:"100%"},[a.feTurbulence({type:"turbulence",baseFrequency:"0.15",numOctaves:"1",result:"texture"}),a.feDiffuseLighting({"in":"texture",result:"diffuse",surfaceScale:"-10"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),a.feComposite({"in":"diffuse",in2:"SourceGraphic",operator:"arithmetic",k1:"1",k2:"0",k3:"0",k4:"0"})]),h({_gfxName:"gold",
x:"-5%",y:"-5%",width:"115%",height:"110%"},[a.feTurbulence({baseFrequency:"0.2",numOctaves:"1",type:"turbulence",result:"turb"}),a.feComposite({"in":"SourceGraphic",in2:"turb",operator:"arithmetic",k2:"0.6",k3:"0.4",result:"turb"}),a.feComposite({"in":"turb",in2:"SourceGraphic",operator:"in",result:"bump"}),a.feDiffuseLighting({"in":"turb",surfaceScale:"6.0","lighting-color":"rgb(60%, 50%, 0%)",diffuseConstant:"1.0",result:"diffuse"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),a.feSpecularLighting({"in":"bump",
surfaceScale:"6.0",specularConstant:"1.0",specularExponent:"10.0",result:"specularOut"},[a.feDistantLight({azimuth:"135",elevation:"60"})]),a.feComposite({"in":"specularOut",in2:"SourceGraphic",operator:"in",result:"specularOut"}),a.feComposite({"in":"bump",in2:"diffuse",operator:"arithmetic",k1:"0.7",k2:"0.3",result:"litPaint"}),a.feComposite({"in":"litPaint",in2:"specularOut",operator:"arithmetic",k2:"1.0",k3:"0.7",result:"litPaint"})])];for(var l in u)if(u.hasOwnProperty(l)){a[l]={};for(var t=
u[l],p=0;p<t.length;++p)(function(){var b=t[p];a[l][b._gfxName]=function(a){return c.delegate(b,a)}})()}return a})},"dojox/gfx/svgext":function(){define(["dojo/dom","dojo/_base/array","dojo/_base/window","./_base","./svg"],function(c,b,a,n,u){function v(a,c){var f=c.ownerDocument.createElementNS(u.xmlns.svg,a.tag);c.appendChild(f);for(var l in a)l in h||f.setAttribute(l,a[l]);a.children&&b.forEach(a.children,function(a){v(a,f)});return f}a=n.svgext={};var h={primitives:null,tag:null,children:null};
u.Shape.extend({addRenderingOption:function(a,b){this.rawNode.setAttribute(a,b);return this},setFilter:function(a){if(!a)return this.rawNode.removeAttribute("filter"),this.filter=null,this;this.filter=a;a.id=a.id||n._base._getUniqueId();var f=c.byId(a.id);if(!f){f=this.rawNode.ownerDocument.createElementNS(u.xmlns.svg,"filter");f.setAttribute("filterUnits","userSpaceOnUse");for(var t in a)t in h||f.setAttribute(t,a[t]);b.forEach(a.primitives,function(a){v(a,f)});(t=this._getParentSurface())&&t.defNode.appendChild(f)}this.rawNode.setAttribute("filter",
"url(#"+a.id+")");return this},getFilter:function(){return this.filter}});return a})},"dojox/gfx/_gfxBidiSupport":function(){define("./_base dojo/_base/lang dojo/_base/sniff dojo/dom dojo/_base/html dojo/_base/array ./utils ./shape ./path dojox/string/BidiEngine".split(" "),function(c,b,a,n,u,v,h,f,l,t){function p(a,b){var e=w(b);e&&c.utils.forEach(a,function(a){if(a instanceof c.Surface||a instanceof c.Group)a.textDir=e;a instanceof c.Text&&a.setShape({textDir:e});a instanceof c.TextPath&&a.setText({textDir:e})},
a);return a}function w(a){var b=["ltr","rtl","auto"];return a&&(a=a.toLowerCase(),0>v.indexOf(b,a))?null:a}b.getObject("dojox.gfx._gfxBidiSupport",!0);switch(c.renderer){case "vml":c.isVml=!0;break;case "svg":c.isSvg=!0;c.svg.useSvgWeb&&(c.isSvgWeb=!0);break;case "silverlight":c.isSilverlight=!0;break;case "canvas":case "canvasWithEvents":c.isCanvas=!0}var x=new t;b.extend(c.shape.Surface,{textDir:"",setTextDir:function(a){p(this,a)},getTextDir:function(){return this.textDir}});b.extend(c.Group,{textDir:"",
setTextDir:function(a){p(this,a)},getTextDir:function(){return this.textDir}});b.extend(c.Text,{textDir:"",formatText:function(b,m){if(m&&b&&1<b.length){var e="ltr";if("auto"==m){if(c.isVml)return b;m=x.checkContextual(b)}if(c.isVml)return e=x.checkContextual(b),m!=e?"rtl"==m?x.hasBidiChar(b)?"\u200f\u200f"+b:x.bidiTransform(b,"IRNNN","ILNNN"):"\u200e"+b:b;if(c.isSvgWeb)return"rtl"==m?x.bidiTransform(b,"IRNNN","ILNNN"):b;if(c.isSilverlight)return"rtl"==m?x.bidiTransform(b,"IRNNN","VLYNN"):x.bidiTransform(b,
"ILNNN","VLYNN");if(c.isCanvas)return"rtl"==m?"\u202b"+b+"\u202c":"\u202a"+b+"\u202c";if(c.isSvg)return 4>a("ff")?"rtl"==m?x.bidiTransform(b,"IRYNN","VLNNN"):x.bidiTransform(b,"ILYNN","VLNNN"):"\u200e"+("rtl"==m?"\u202b":"\u202a")+b+"\u202c"}return b},bidiPreprocess:function(a){return a}});b.extend(c.TextPath,{textDir:"",formatText:function(b,m){if(m&&b&&1<b.length){var e="ltr";if("auto"==m){if(c.isVml)return b;m=x.checkContextual(b)}if(c.isVml)return e=x.checkContextual(b),m!=e?"rtl"==m?x.hasBidiChar(b)?
"\u200f\u200f"+b:x.bidiTransform(b,"IRNNN","ILNNN"):"\u200e"+b:b;if(c.isSvgWeb)return"rtl"==m?x.bidiTransform(b,"IRNNN","ILNNN"):b;c.isSvg&&(b=a("opera")||4<=a("ff")?"\u200e"+("rtl"==m?"\u202b":"\u202a")+b+"\u202c":"rtl"==m?x.bidiTransform(b,"IRYNN","VLNNN"):x.bidiTransform(b,"ILYNN","VLNNN"))}return b},bidiPreprocess:function(a){a&&"string"==typeof a&&(this.origText=a,a=this.formatText(a,this.textDir));return a}});h=function(a,b,g,d){var e=a.prototype[b];a.prototype[b]=function(){var a;g&&(a=g.apply(this,
arguments));a=e.call(this,a);d&&(a=d.call(this,a,arguments));return a}};f=function(a){a&&(a.textDir&&(a.textDir=w(a.textDir)),a.text&&a.text instanceof Array&&(a.text=a.text.join(",")));!a||void 0==a.text&&!a.textDir||this.textDir==a.textDir&&a.text==this.origText||(this.origText=void 0!=a.text?a.text:this.origText,a.textDir&&(this.textDir=a.textDir),a.text=this.formatText(this.origText,this.textDir));return this.bidiPreprocess(a)};h(c.Text,"setShape",f,null);h(c.TextPath,"setText",f,null);f=function(a){(a=
b.clone(a))&&this.origText&&(a.text=this.origText);return a};h(c.Text,"getShape",null,f);h(c.TextPath,"getText",null,f);f=function(a,b){var e;b&&b[0]&&(e=w(b[0]));a.setTextDir(e?e:this.textDir);return a};h(c.Surface,"createGroup",null,f);h(c.Group,"createGroup",null,f);f=function(a){if(a){var b=a.textDir?w(a.textDir):this.textDir;b&&(a.textDir=b)}return a};h(c.Surface,"createText",f,null);h(c.Surface,"createTextPath",f,null);h(c.Group,"createText",f,null);h(c.Group,"createTextPath",f,null);c.createSurface=
function(a,b,g,d){b=c[c.renderer].createSurface(a,b,g);d=w(d);if(c.isSvgWeb)return b.textDir=d?d:u.style(n.byId(a),"direction"),b;if(c.isVml||c.isSvg||c.isCanvas)b.textDir=d?d:u.style(b.rawNode,"direction");c.isSilverlight&&(b.textDir=d?d:u.style(b._nodes[1],"direction"));return b};return c})},"dojox/gfx/utils":function(){define("dojo/_base/kernel dojo/_base/lang ./_base dojo/_base/html dojo/_base/array dojo/_base/window dojo/_base/json dojo/_base/Deferred dojo/_base/sniff require dojo/_base/config".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p){var w=a.utils={};b.mixin(w,{forEach:function(b,e,m){m=m||c.global;e.call(m,b);(b instanceof a.Surface||b instanceof a.Group)&&u.forEach(b.children,function(a){w.forEach(a,e,m)})},serialize:function(b){var e={},m;if((m=b instanceof a.Surface)||b instanceof a.Group){if(e.children=u.map(b.children,w.serialize),m)return e.children}else e.shape=b.getShape();b.getTransform&&(m=b.getTransform())&&(e.transform=m);b.getStroke&&(m=b.getStroke())&&(e.stroke=m);b.getFill&&(m=b.getFill())&&
(e.fill=m);b.getFont&&(m=b.getFont())&&(e.font=m);return e},toJson:function(a,b){return h.toJson(w.serialize(a),b)},deserialize:function(a,e){if(e instanceof Array)return u.map(e,b.hitch(null,w.deserialize,a));a="shape"in e?a.createShape(e.shape):a.createGroup();"transform"in e&&a.setTransform(e.transform);"stroke"in e&&a.setStroke(e.stroke);"fill"in e&&a.setFill(e.fill);"font"in e&&a.setFont(e.font);"children"in e&&u.forEach(e.children,b.hitch(null,w.deserialize,a));return a},fromJson:function(a,
b){return w.deserialize(a,h.fromJson(b))},toSvg:function(b){var e=new f;if("svg"===a.renderer)try{var m=w._cleanSvg(w._innerXML(b.rawNode));e.callback(m)}catch(d){e.errback(d)}else{w._initSvgSerializerDeferred||w._initSvgSerializer();var g=w.toJson(b),m=function(){try{var a=b.getDimensions(),m=a.width,k=a.height,c=w._gfxSvgProxy.document.createElement("div");w._gfxSvgProxy.document.body.appendChild(c);v.withDoc(w._gfxSvgProxy.document,function(){n.style(c,"width",m);n.style(c,"height",k)},this);w._gfxSvgProxy[dojox._scopeName].gfx.createSurface(c,
m,k).whenLoaded(null,function(a){try{w._gfxSvgProxy[dojox._scopeName].gfx.utils.fromJson(a,g);var b=w._cleanSvg(c.innerHTML);a.clear();a.destroy();w._gfxSvgProxy.document.body.removeChild(c);e.callback(b)}catch(D){e.errback(D)}})}catch(E){e.errback(E)}};0<w._initSvgSerializerDeferred.fired?m():w._initSvgSerializerDeferred.addCallback(m)}return e},_gfxSvgProxy:null,_initSvgSerializerDeferred:null,_svgSerializerInitialized:function(){w._initSvgSerializerDeferred.callback(!0)},_initSvgSerializer:function(){if(!w._initSvgSerializerDeferred){w._initSvgSerializerDeferred=
new f;var a=v.doc.createElement("iframe");n.style(a,{display:"none",position:"absolute",width:"1em",height:"1em",top:"-10000px"});var b;l("ie")?a.onreadystatechange=function(){"complete"==a.contentWindow.document.readyState&&(a.onreadystatechange=function(){},b=setInterval(function(){a.contentWindow[c.scopeMap.dojo[1]._scopeName]&&a.contentWindow[c.scopeMap.dojox[1]._scopeName].gfx&&a.contentWindow[c.scopeMap.dojox[1]._scopeName].gfx.utils&&(clearInterval(b),a.contentWindow.parent[c.scopeMap.dojox[1]._scopeName].gfx.utils._gfxSvgProxy=
a.contentWindow,a.contentWindow.parent[c.scopeMap.dojox[1]._scopeName].gfx.utils._svgSerializerInitialized())},50))}:a.onload=function(){a.onload=function(){};b=setInterval(function(){a.contentWindow[c.scopeMap.dojo[1]._scopeName]&&a.contentWindow[c.scopeMap.dojox[1]._scopeName].gfx&&a.contentWindow[c.scopeMap.dojox[1]._scopeName].gfx.utils&&(clearInterval(b),a.contentWindow.parent[c.scopeMap.dojox[1]._scopeName].gfx.utils._gfxSvgProxy=a.contentWindow,a.contentWindow.parent[c.scopeMap.dojox[1]._scopeName].gfx.utils._svgSerializerInitialized())},
50)};var m=p.dojoxGfxSvgProxyFrameUrl||t.toUrl("dojox/gfx/resources/gfxSvgProxyFrame.html");a.setAttribute("src",m.toString());v.body().appendChild(a)}},_innerXML:function(a){return a.innerXML?a.innerXML:a.xml?a.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(a):null},_cleanSvg:function(a){a&&(-1==a.indexOf('xmlns\x3d"http://www.w3.org/2000/svg"')&&(a=a.substring(4,a.length),a='\x3csvg xmlns\x3d"http://www.w3.org/2000/svg"'+a),-1==a.indexOf('xmlns:xlink\x3d"http://www.w3.org/1999/xlink"')&&
(a=a.substring(4,a.length),a='\x3csvg xmlns:xlink\x3d"http://www.w3.org/1999/xlink"'+a),-1===a.indexOf("xlink:href")&&(a=a.replace(/href\s*=/g,"xlink:href\x3d")),a=a.replace(/<img\b([^>]*)>/gi,"\x3cimage $1 /\x3e"),a=a.replace(/\bdojoGfx\w*\s*=\s*(['"])\w*\1/g,""),a=a.replace(/\b__gfxObject__\s*=\s*(['"])\w*\1/g,""),a=a.replace(/[=]([^"']+?)(\s|>)/g,'\x3d"$1"$2'),a=a.replace(/\bstroke-opacity\w*\s*=\s*(['"])undefined\1/g,""));return a}});return w})},"dojox/string/BidiEngine":function(){define(["dojo/_base/lang",
"dojo/_base/declare","dojo/Stateful"],function(c,b,a){function n(a,b,e,d,g){var k=a;void 0===b&&(b=g.defInFormat);void 0===e&&(e=g.defOutFormat);void 0===d&&(d=g.defSwap);if(b!==e){var m,c=b.substring(0,1);m=b.substring(1,4);var y=e.substring(0,1),P=e.substring(1,4);"C"===m.charAt(0)&&(m=u(k),m="ltr"===m||"rtl"===m?m.toUpperCase():"L"===b.charAt(2)?"LTR":"RTL",b=c+m);"C"===P.charAt(0)&&(m=u(k),"rtl"===m?P="RTL":"ltr"===m?(k=k.split(""),k.reverse(),m=u(k.join("")),P=m.toUpperCase()):P="L"===e.charAt(2)?
"LTR":"RTL",e=y+P)}if(b===e)return a;y=b.substring(0,1);k=b.substring(1,4);c=e.substring(0,1);P=e.substring(1,4);g.inFormat=b;g.outFormat=e;g.swap=d;if("L"===y&&"VLTR"===e){if("LTR"===k)return g.dir=z,v(a,g);if("RTL"===k)return g.dir=J,v(a,g)}if("V"===y&&"V"===c)return g.dir="RTL"===k?J:z,f(a,g);if("L"===y&&"VRTL"===e)return g.dir="LTR"===k?z:J,a=v(a,g),f(a);if("VLTR"===b&&"LLTR"===e)return g.dir=z,v(a,g);if("V"===y&&"L"===c&&k!==P)return a=f(a),"RTL"===k?n(a,"LLTR","VLTR",d,g):n(a,"LRTL","VRTL",
d,g);if("VRTL"===b&&"LRTL"===e)return n(a,"LRTL","VRTL",d,g);if("L"===y&&"L"===c)return b=g.swap,g.swap=b.substr(0,1)+"N","RTL"===k?(g.dir=J,a=v(a,g),g.swap="N"+b.substr(1,2),g.dir=z,a=v(a,g)):(g.dir=z,a=v(a,g),g.swap="N"+b.substr(1,2),a=n(a,"VLTR","LRTL",g.swap,g)),a}function u(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}function v(a,b){a=a.split("");var e=[];h(a,e,b);if(0!==b.hiLevel&&b.swap.substr(0,1)!==b.swap.substr(1,
2))for(var d=0;d<a.length;d++)if(1===e[d]){var g=d,k;b:{k=a[d];for(var m=void 0,c=0,y=B.length-1;c<=y;)if(m=Math.floor((c+y)/2),k<B[m][0])y=m-1;else if(k>B[m][0])c=m+1;else{k=B[m][1];break b}}a[g]=k}p(2,a,e,b);p(1,a,e,b);G=e;return a.join("")}function h(a,b,e){var d=a.length,g=e.dir?aa:va,k=null,m=null,c=null,k=0,m=m=null,y=-1,f=m=null,l=[],G=[];e.hiLevel=e.dir;e.lastArabic=!1;e.hasUbatAl=!1;e.hasUbatB=!1;e.hasUbatS=!1;for(m=0;m<d;m++){var f=m,c=a[m].charCodeAt(0),t=ka[c>>8];l[f]=t<Y?t:pa[t-Y][c&
255]}for(f=0;f<d;f++){G[f]=m=w(a,l,G,f,e);k=g[k][m];m=k&240;k&=15;b[f]=c=g[k][C];if(0<m){if(16===m)for(m=y;m<f;m++)b[m]=1;y=-1}if(m=g[k][D])-1===y&&(y=f);else if(-1<y){for(m=y;m<f;m++)b[m]=c;y=-1}l[f]===na&&(b[f]=0);e.hiLevel|=c}if(e.hasUbatS)for(a=0;a<d;a++)if(l[a]===wa)for(b[a]=e.dir,g=a-1;0<=g;g--)if(l[g]===ha)b[g]=e.dir;else break}function f(a,b){a=a.split("");if(b){var e=[];h(a,e,b);G=e}a.reverse();y.reverse();return a.join("")}function l(a){for(var b=0;b<X.length;b++)if(a>=X[b]&&a<=oa[b])return!0;
return!1}function t(a,b,d,g){for(;b*d<g&&e(a[b]);)b+=d;return b*d<g&&l(a[b])?!0:!1}function p(a,b,e,d){if(!(d.hiLevel<a))if(1!==a||d.dir!==J||d.hasUbatB){d=b.length;for(var g=0,k,m,c;g<d;){if(e[g]>=a){for(k=g+1;k<d&&e[k]>=a;)k++;for(m=k-1;g<m;g++,m--)c=b[g],b[g]=b[m],b[m]=c,c=y[g],y[g]=y[m],y[m]=c;g=k}g++}}else b.reverse(),y.reverse()}function w(a,b,e,d,g){return{UBAT_L:function(){g.lastArabic=!1;return ca},UBAT_R:function(){g.lastArabic=!1;return la},UBAT_ON:function(){return Z},UBAT_AN:function(){return ia},
UBAT_EN:function(){return g.lastArabic?ia:ea},UBAT_AL:function(){g.lastArabic=!0;g.hasUbatAl=!0;return la},UBAT_WS:function(){return Z},UBAT_CS:function(){var a,k;if(1>d||d+1>=b.length||(a=e[d-1])!==ea&&a!==ia||(k=b[d+1])!==ea&&k!==ia)return Z;g.lastArabic&&(k=ia);return k===a?k:Z},UBAT_ES:function(){return(0<d?e[d-1]:na)===ea&&d+1<b.length&&b[d+1]===ea?ea:Z},UBAT_ET:function(){if(0<d&&e[d-1]===ea)return ea;if(g.lastArabic)return Z;for(var a=d+1,k=b.length;a<k&&b[a]===ja;)a++;return a<k&&b[a]===ea?
ea:Z},UBAT_NSM:function(){if("VLTR"===g.inFormat){for(var k=b.length,m=d+1;m<k&&b[m]===qa;)m++;if(m<k&&(k=a[d],m=b[m],(1425<=k&&2303>=k||64286===k)&&(m===la||m===ta)))return la}return 1>d||b[d-1]===na?Z:e[d-1]},UBAT_B:function(){g.lastArabic=!0;g.hasUbatB=!0;return g.dir},UBAT_S:function(){g.hasUbatS=!0;return Z},UBAT_LRE:function(){g.lastArabic=!1;return Z},UBAT_RLE:function(){g.lastArabic=!1;return Z},UBAT_LRO:function(){g.lastArabic=!1;return Z},UBAT_RLO:function(){g.lastArabic=!1;return Z},UBAT_PDF:function(){g.lastArabic=
!1;return Z},UBAT_BN:function(){return Z}}[da[b[d]]]()}function x(a,b){for(var e=0;e<Q.length;e++)if(a===Q[e])return b[e];return a}function e(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function m(a){if("L"===a)return"LTR";if("R"===a)return"RTL";if("C"===a)return"CLR";if("D"===a)return"CRL"}function g(a,b){for(var e=0;e<M.length;e++)if(a===M[e])return b[e];return a}function d(a,b,e,d){for(var g=0;g<a.length;g++)if(a[g]>b||!e&&a[g]===b)a[g]+=d}c.getObject("string",!0,dojox);c=b("dojox.string.BidiEngine",
a,{inputFormat:"ILYNN",outputFormat:"VLNNN",sourceToTarget:[],targetToSource:[],levels:[],bidiTransform:function(a,b,c){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var P=this.sourceToTarget,f=this.targetToSource,B=a.length;y=[];G=[];for(var z=0;z<B;z++)P[z]=z,f[z]=z,y[z]=z;if(!this.checkParameters(b,c))return a;b=this.inputFormat;c=this.outputFormat;var P=a,P=E,z=m(b.charAt(1)),f=m(c.charAt(1)),h="I"===b.charAt(0)?"L":b.charAt(0),B="I"===c.charAt(0)?"L":c.charAt(0),z=h+z,f=B+f,B=
b.charAt(2)+c.charAt(2);P.defInFormat=z;P.defOutFormat=f;P.defSwap=B;a=n(a,z,f,B,P);P=!1;if("R"===c.charAt(1))P=!0;else if("C"===c.charAt(1)||"D"===c.charAt(1))P=this.checkContextual(a);f=this.sourceToTarget=y;B=Array(f.length);for(z=0;z<f.length;z++)B[f[z]]=z;k=this.targetToSource=B;if(b.charAt(3)===c.charAt(3))P=a;else if("S"===c.charAt(3))if(b=P,c=!0,0===a.length)P=void 0;else{void 0===b&&(b=!0);void 0===c&&(c=!0);a=String(a);a=a.split("");var p=0,f=1,P=a.length;b||(p=a.length-1,f=-1,P=1);for(var B=
P,z=c,C=0,P=[],h=0;p*f<B;p+=f)if(l(a[p])||e(a[p])){var D;if(D="\u0644"===a[p])b:{for(var w=a,J=p+f,q=f,r=B;J*q<r&&e(w[J]);)J+=q;D=" ";if(J*q<r)for(D=w[J],w=0;w<M.length;w++)if(M[w]===D){D=!0;break b}D=!1}if(D){a[p]=0===C?g(a[p+f],U):g(a[p+f],N);p+=f;C=a;D=p;w=f;for(J=B;D*w<J&&e(C[D]);)D+=w;D*w<J&&(C[D]=" ");z&&(P[h]=p,h++);C=0}else{D=a[p];if(1===C){w=p;if(t(a,p+f,f,B))b:for(J=a[p],q=0;q<Q.length;q++){if(J===Q[q]){J=I[q];break b}}else J=x(a[p],K);a[w]=J}else!0===t(a,p+f,f,B)?a[p]=x(a[p],H):a[p]=x(a[p],
O);e(D)||(C=1);b:{for(w=0;w<L.length;w++)if(L[w]===D){D=!0;break b}D=!1}!0===D&&(C=0)}}else C=0;f="";for(B=0;B<a.length;B++){if(z=c){b:{for(z=0;z<P.length;z++)if(P[z]===B)break b;z=-1}z=-1<z}z?(d(k,B,!b,-1),y.splice(B,1)):f+=a[B]}P=f}else if(b=a,c=P,a=!0,0===b.length)P=void 0;else for(void 0===a&&(a=!0),void 0===c&&(c=!0),b=String(b),P="",f=[],f=b.split(""),B=0;B<b.length;B++)z=!1,"\ufe70"<=f[B]&&"\ufeff">f[B]?(h=b.charCodeAt(B),"\ufef5"<=f[B]&&"\ufefc">=f[B]?(c?(0<B&&a&&" "===f[B-1]?P=P.substring(0,
P.length-1)+"\u0644":(P+="\u0644",z=!0),P+=M[(h-65269)/2]):(P+=M[(h-65269)/2],P+="\u0644",B+1<b.length&&a&&" "===f[B+1]?B++:z=!0),z&&(d(k,B,!0,1),y.splice(B,0,y[B]))):P+=fa[h-65136]):P+=f[B];this.sourceToTarget=y;this.targetToSource=k;this.levels=G;return P},_inputFormatSetter:function(a){if(!F.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a},_outputFormatSetter:function(a){if(!F.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.outputFormat=a},checkParameters:function(a,b){a?this.set("inputFormat",a):a=this.inputFormat;b?this.set("outputFormat",b):b=this.outputFormat;return a===b?!1:!0},checkContextual:function(a){a=u(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(ra){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a},hasBidiChar:function(a){return T.test(a)}});var y=[],k=[],G=[],E={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,
hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1},C=5,D=6,z=0,J=1,F=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,T=/[\u0591-\u06ff\ufb1d-\ufefc]/,B=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],
["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],M=["\u0622","\u0623","\u0625","\u0627"],U=["\ufef5","\ufef7","\ufef9","\ufefb"],N=["\ufef6","\ufef8","\ufefa","\ufefc"],Q="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split(""),
O="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split(""),K="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split(""),
I="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split(""),H="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split(""),
L="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split(""),fa="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split(""),
X=["\u0621","\u0641"],oa=["\u063a","\u064a"],va=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],aa=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ca=0,la=1,ea=2,ia=3,Z=4,na=5,wa=6,ta=7,ha=8,ja=11,qa=12,da="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" "),Y=100;b=ca;a=la;var R=ea,V=ia,q=Z,ba=na,ga=wa,r=ta,W=ha,
S=ja,A=qa,ka=[Y+0,b,b,b,b,Y+1,Y+2,Y+3,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,Y+4,q,q,q,b,q,b,q,b,q,q,q,b,b,q,q,b,b,b,b,b,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,b,b,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,b,b,q,q,b,b,q,q,b,b,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,b,b,b,Y+5,r,r,Y+6,Y+7],pa=[[18,18,18,18,18,18,18,18,18,ga,ba,ga,W,ba,18,18,18,18,18,18,18,18,18,18,18,18,18,18,ba,ba,ba,ga,W,q,q,S,S,S,q,q,q,q,q,10,9,10,9,9,R,R,R,R,R,R,R,R,R,R,9,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,q,18,18,18,18,18,18,ba,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,q,S,S,S,S,q,q,q,q,b,q,q,18,q,q,S,S,R,R,q,b,q,q,q,R,b,q,q,q,q,q,b,b,
b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,b,b,b,b,b,b,b,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,b,q,q,q,q,q,q,q,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,
A,A,a,A,a,A,A,a,A,A,a,A,q,q,q,q,q,q,q,q,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,q,q,q,q,q,a,a,a,a,a,q,q,q,q,q,q,q,q,q,q,q],[V,V,V,V,q,q,q,q,r,S,S,r,9,r,q,q,A,A,A,A,A,A,A,A,A,A,A,r,q,q,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,V,V,V,V,V,V,V,V,V,V,S,V,V,r,r,r,A,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,
r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,A,A,A,A,A,A,A,V,q,A,A,A,A,A,A,r,r,A,A,q,A,A,A,A,r,r,R,R,R,R,R,R,R,R,R,R,r,r,r,r,r,r],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,q,r,r,A,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,q,q,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,A,A,A,A,A,A,A,A,A,A,
A,r,q,q,q,q,q,q,q,q,q,q,q,q,q,q,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,A,A,A,A,A,A,A,A,A,a,a,q,q,q,q,a,q,q,q,q,q],[W,W,W,W,W,W,W,W,W,W,W,18,18,18,b,a,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,W,ba,13,14,15,16,17,9,S,S,S,S,S,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,9,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,W,18,18,18,18,18,q,q,q,q,q,18,18,18,18,18,18,R,b,q,q,R,R,R,R,R,R,10,10,q,q,q,b,R,R,R,R,R,R,R,R,R,R,10,10,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,q,
q,q,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q],[b,b,b,b,b,b,b,q,q,q,q,q,q,q,q,q,q,q,q,b,b,b,b,b,q,q,q,q,q,a,A,a,a,a,a,a,a,a,a,a,a,10,a,a,a,a,a,a,a,a,a,a,a,a,a,q,a,a,a,a,a,q,a,q,a,a,q,a,a,q,a,a,a,a,a,a,a,a,a,a,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,
r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r],[A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,A,A,A,A,A,A,A,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,9,q,9,q,q,9,q,q,q,q,q,q,q,q,q,S,q,q,10,10,q,q,q,q,q,S,S,q,q,q,q,q,r,r,r,r,r,q,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,
r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,q,q,18],[q,q,q,S,S,S,q,q,q,q,q,10,9,10,9,9,R,R,R,R,R,R,R,R,R,R,9,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,q,q,q,q,q,q,q,q,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,
b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,q,q,q,b,b,b,b,b,b,q,q,b,b,b,b,b,b,q,q,b,b,b,b,b,b,q,q,b,b,b,q,q,q,S,S,q,q,q,S,S,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q]];return c})},"esri/Evented":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/Evented dojo/has ./kernel".split(" "),function(c,b,a,n,u,v){c=c([n],{declaredClass:"esri.Evented",registerConnectEvents:function(){var a=this.constructor,c=this.constructor._meta.parents,
l=[{}],t={},p,w,x=function(a,m){b.isArray(a)||(a=[a]);for(var e=0;e<a.length;e++){var d=a[e];d._meta&&d._meta.parents&&x(d._meta.parents,m);d.prototype._eventMap&&m.push(b.mixin({},d.prototype._eventMap))}return m};if(!a._onMap){x(c,l);l.push(this._eventMap);c=b.mixin.apply(this,l);for(p in this)/^on\w/.test(p)&&b.isFunction(this[p])&&(l=this._hyphenLower(p).toLowerCase(),c[l]||(t[l]={method:p}));for(w in c)p=this._onCamelCase(w),t[w]={method:p,argKeys:c[w]};a._onMap=t;return a._onMap}},on:function(c,
f){if(-1<c.indexOf(",")){for(var l=c.split(/\s*,\s*/),t=l.length,h=[];t--;)h.push(this.on(l[t],f));h.remove=function(){for(var a=0;a<h.length;a++)h[a].remove()};return h}var l=this.constructor._onMap||this.registerConnectEvents(),t="string"==typeof c&&c.toLowerCase(),w=this._onCamelCase(t),x=l&&l[t];return(w=x&&x.method||this[w]&&b.isFunction(this[w])&&w)?x&&b.isArray(x.argKeys)?(l=this._onArr2Obj(f,l[t].argKeys),a.after(this,w,l,!0)):a.after(this,w,function(a){a=a||{};a.target||(a.target=this);f.call(this,
a)},!0):this.inherited(arguments)},emit:function(a,c){var f,t,h,w,x=a.toLowerCase();w=this._onCamelCase(a);var e=this.constructor._onMap||this.registerConnectEvents();w=(h=e&&e[x]&&e[x].method||b.isFunction(this[w])&&w)&&this[h];h&&e&&e[x]&&this._onObj2Arr(function(){t=Array.prototype.slice.call(arguments)},e[x].argKeys)(c);c=c||{};c.target||(c.target=this);w&&(f=t&&t.length?t:[c],f=w.apply(this,f));this.inherited(arguments,[a,c]);return f},_onObj2Arr:function(a,b){if(b){var c=this;return function(f){var l,
t=[],h=b.length;for(l=0;l<h;l++)t[l]=f[b[l]];a.apply(c,t)}}return a},_onArr2Obj:function(a,b){if(b){var c=this;return function(){var f,l={},h=arguments.length;for(f=0;f<h;f++)l[b[f]]=arguments[f];l.target||(l.target=c);a.call(c,l)}}return a},_hyphenLower:function(a){return a.replace(/^on/,"").replace(/[A-Z](?=[a-z])/g,function(a,b){return(b?"-":"")+a.toLowerCase()})},_onCamelCase:function(a){return"on"+a.substr(0,1).toUpperCase()+a.substr(1).replace(/\-([a-z])/g,function(a,b){return b.toUpperCase()})}});
return v.Evented=c})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),function(c,b,a,n,u,v,h,f,l,t,p){a.isAsync||t(0,function(){p(["./fx/Toggler"])});a=a.fx={};t={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var w=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;n.forEach(this._animations,function(a){a&&
("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};w.prototype=new b;c.extend(w,{_onAnimate:function(){this._fire("onAnimate",arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=u.after(this._current,"onAnimate",c.hitch(this,"_onAnimate"),!0),this._onEndCtx=
u.after(this._current,"onEnd",c.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==this._current.status())return this;var e=u.after(this._current,"beforeBegin",c.hitch(this,function(){this._fire("beforeBegin")}),!0),d=u.after(this._current,"onBegin",c.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),m=u.after(this._current,"onPlay",c.hitch(this,function(a){this._fire("onPlay",arguments);
e.remove();d.remove();m.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=u.after(this._current,"onAnimate",c.hitch(this,"_onAnimate"),!0);this._onEndCtx&&this._onEndCtx.remove();this._onEndCtx=u.after(this._current,"onEnd",c.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=u.after(this._current,"onPause",c.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},
gotoPercent:function(a,b){this.pause();var e=this.duration*a;this._current=null;n.some(this._animations,function(a,b){if(e<=a.duration)return this._current=a,this._index=b,!0;e-=a.duration;return!1},this);this._current&&this._current.gotoPercent(e/this._current.duration);b&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=u.after(this._current,
"onStop",c.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});c.extend(w,t);a.chain=function(a){return new w(c.isArray(a)?a:Array.prototype.slice.call(a,0))};var x=function(a){this._animations=a||[];this._connects=[];this.duration=this._finished=0;n.forEach(a,
function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(u.after(a,"onEnd",c.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=new v.Animation({curve:[0,1],duration:this.duration});var b=this;n.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){b._connects.push(u.after(b._pseudoAnimation,a,function(){b._fire(a,arguments)},!0))})};c.extend(x,{_doAction:function(a,b){n.forEach(this._animations,function(e){e[a].apply(e,
b)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var e=this._pseudoAnimation;e[a].apply(e,b)},play:function(a,b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var e=this.duration*a;n.forEach(this._animations,function(a){a.gotoPercent(a.duration<e?1:e/a.duration,b)});
this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},destroy:function(){this.stop();n.forEach(this._connects,function(a){a.remove()})}});c.extend(x,t);a.combine=function(a){return new x(c.isArray(a)?a:Array.prototype.slice.call(a,0))};a.wipeIn=function(a){var b=a.node=h.byId(a.node),e=b.style,d;a=v.animateProperty(c.mixin({properties:{height:{start:function(){d=
e.overflow;e.overflow="hidden";if("hidden"==e.visibility||"none"==e.display)return e.height="1px",e.display="",e.visibility="",1;var a=f.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},a));var y=function(){e.height="auto";e.overflow=d};u.after(a,"onStop",y,!0);u.after(a,"onEnd",y,!0);return a};a.wipeOut=function(a){var b=(a.node=h.byId(a.node)).style,e;a=v.animateProperty(c.mixin({properties:{height:{end:1}}},a));u.after(a,"beforeBegin",function(){e=b.overflow;b.overflow=
"hidden";b.display=""},!0);var d=function(){b.overflow=e;b.height="auto";b.display="none"};u.after(a,"onStop",d,!0);u.after(a,"onEnd",d,!0);return a};a.slideTo=function(a){var b=null,e=null,d=function(a){return function(){var d=f.getComputedStyle(a),g=d.position;b="absolute"==g?a.offsetTop:parseInt(d.top)||0;e="absolute"==g?a.offsetLeft:parseInt(d.left)||0;"absolute"!=g&&"relative"!=g&&(d=l.position(a,!0),b=d.y,e=d.x,a.style.position="absolute",a.style.top=b+"px",a.style.left=e+"px")}}(a.node=h.byId(a.node));
d();a=v.animateProperty(c.mixin({properties:{top:a.top||0,left:a.left||0}},a));u.after(a,"beforeBegin",d,!0);return a};return a})},"esri/deferredUtils":function(){define(["dojo/_base/lang","dojo/has","./kernel"],function(c,b,a){b={_dfdCanceller:function(a){a.canceled=!0;var b=a._pendingDfd,c;a.isFulfilled()||!b||b.isFulfilled()||(b.cancel(),c=b.results&&b.results[1]);a._pendingDfd=null;return c},_fixDfd:function(a){var b=a.then;a.then=function(a,c,f){if(a){var l=a;a=function(a){return a&&a._argsArray?
l.apply(null,a):l(a)}}return b.call(this,a,c,f)};return a},_resDfd:function(a,b,c){var h=b.length;1===h?c?a.errback(b[0]):a.callback(b[0]):1<h?(b._argsArray=!0,a.callback(b)):a.callback()}};c.mixin(a,b);return b})},"esri/tileUtils":function(){define(["dojo/_base/array","dojo/has","./kernel","./geometry/Point","./geometry/Extent"],function(c,b,a,n,u){b={_addFrameInfo:function(a,b){var f,l,t=2*b.origin[1],h=b.origin[0],w=a.origin.x,x=a.width,e;c.forEach(a.lods,function(a){f=Math.round(t/a.resolution);
l=Math.ceil(f/x);e=Math.floor((h-w)/(x*a.resolution));a._frameInfo||(a._frameInfo=[l,e,e+l-1,f])})},getContainingTileCoords:function(a,b,c){var f=a.origin;c=c.resolution;return{row:Math.floor((f.y-b.y)/(a.height*c)),col:Math.floor((b.x-f.x)/(a.width*c))}},getCandidateTileInfo:function(a,b,c){var f;f=a.width;for(var t=a.height,h=c.xmax-c.xmin,w=c.ymax-c.ymin,x=a.__tileInfo===b,e=x?a.getMinZoom():-1,x=x?a.getMaxZoom():-1,m=-1,g=b.lods,d=Math.abs,y,k,G,x=-1<x?x:g.length-1,e=-1<e?e:0;e<=x;e++)if(k=g[e])if(G=
h>w?d(w-t*k.resolution):d(h-f*k.resolution),0>m||G<=m)y=k,m=G;else break;f=y;y=f.resolution;t=(c.xmin+c.xmax)/2;h=(c.ymin+c.ymax)/2;w=a.width/2*y;y*=a.height/2;t=new u(t-w,h-y,t+w,h+y,c.spatialReference);c=new n(t.xmin,t.ymax,c.spatialReference);x=f.resolution;w=b.width;h=b.height;b=b.origin;a=a.__visibleDelta;y=Math.floor;g=w*x;d=h*x;x=y((b.y-c.y)/d);m=y((c.x-b.x)/g);e=b.y-x*d;b=y(Math.abs((c.x-(b.x+m*g))*w/g))+a.x;a=y(Math.abs((c.y-e)*h/d))+a.y;return{tile:{point:c,coords:{row:x,col:m},offsets:{x:b,
y:a}},lod:f,extent:t}},getTileExtent:function(a,b,c,l){var f=a.origin;b=a.lods[b].resolution;var h=a.width,w=a.height;return new u(l*b*h+f.x,f.y-(c+1)*b*w,(l+1)*b*h+f.x,f.y-c*b*w,a.spatialReference)}};return a.TileUtils=b})},"esri/geometry/Point":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ../srUtils".split(" "),function(c,b,a,n,u,v,h,f){function l(a,b){89.99999<b?b=89.99999:-89.99999>b&&(b=-89.99999);b*=.017453292519943;return[111319.49079327169*
a,3189068.5*Math.log((1+Math.sin(b))/(1-Math.sin(b)))]}function t(a,b,g){a=a/6378137*57.29577951308232;return g?[a,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*b/6378137)))]:[a-360*Math.floor((a+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*b/6378137)))]}function p(){}function w(){}function x(a){var b=a._json;a._unquantizeFn?(b=a._unquantizeFn({x:b.x,y:b.y}),a._xVal=b.x,a._yVal=b.y,a._unquantizeFn=null):(a._xVal=b.x,a._yVal=b.y);a._json=null}a={type:"point",
x:0,y:0};c=c(h,{declaredClass:"esri.geometry.Point",type:"point",x:0,y:0,constructor:function(a,c,g){b.isArray(a)?(this.x=a[0],this.y=a[1],this.spatialReference=c):u.isObject(a)?(u.mixin(this,a),null!=this.latitude&&(this.y=this.latitude),null!=this.longitude&&(this.x=this.longitude),this.spatialReference&&(this.spatialReference=f.createSpatialReference(this.spatialReference))):(this.x=a,this.y=c,this.spatialReference=g);this.verifySR()},offset:function(a,b){return new this.constructor(this.x+a,this.y+
b,this.spatialReference)},setX:function(a){this.x=a;this.clearCache();return this},setY:function(a){this.y=a;this.clearCache();return this},setLongitude:function(a){var b=this.spatialReference;b&&(b._isWebMercator()?this.setX(l(a,this.y)[0]):4326===b.wkid&&this.setX(a));return this},setLatitude:function(a){var b=this.spatialReference;b&&(b._isWebMercator()?this.setY(l(this.x,a)[1]):4326===b.wkid&&this.setY(a));return this},getLongitude:function(){var a=this.spatialReference,b;a&&(a._isWebMercator()?
b=t(this.x,this.y)[0]:4326===a.wkid&&(b=this.x));return b},getLatitude:function(){var a=this.spatialReference,b;a&&(a._isWebMercator()?b=t(this.x,this.y)[1]:4326===a.wkid&&(b=this.y));return b},update:function(a,b){this.x=a;this.y=b;this.clearCache();return this},normalize:function(){var a=this.x,b=this.spatialReference;if(b){var g=b._getInfo();g&&(a=this._normalizeX(a,g))}return new this.constructor(a,this.y,b)},_normalizeX:function(a,b){var e=b.valid[0],d=b.valid[1];b=2*d;a>d?(e=Math.ceil(Math.abs(a-
d)/b),a-=e*b):a<e&&(e=Math.ceil(Math.abs(a-e)/b),a+=e*b);return a},toJson:function(){var a={x:this.x,y:this.y},b=this.spatialReference;b&&(a.spatialReference=b.toJson());return a}});p.prototype=c.prototype;w.prototype=new p;Object.defineProperty(w.prototype,"x",{get:function(){this._json&&x(this);return this._xVal},set:function(a){this._xVal=a}});Object.defineProperty(w.prototype,"y",{get:function(){this._json&&x(this);return this._yVal},set:function(a){this._yVal=a}});w.prototype.setupLazyUnquantization=
function(a,b){this._unquantizeFn=a;this._json=b};c.simpleConstructor=p;c.accessorConstructor=w;c.lngLatToXY=l;c.xyToLngLat=t;c.defaultProps=a;c.metersPerDegree=6378137*Math.PI/180;b.setObject("geometry.Point",c,n);n.geometry.defaultPoint=a;return c})},"esri/SpatialReference":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/has","./kernel","./lang"],function(c,b,a,n,u){function v(){}a=[-2.0037508342788905E7,2.0037508342788905E7];var h=[-2.0037508342787E7,2.0037508342787E7];c=c(null,
{declaredClass:"esri.SpatialReference",constructor:function(a){a&&(u.isObject(a)?u.mixin(this,a):u.isString(a)?this.wkt=a:this.wkid=a)},wkid:null,wkt:null,_info:{102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',
valid:a,origin:h,dx:1E-5},102100:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:a,origin:h,
dx:1E-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:a,origin:h,dx:1E-5},3857:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',
valid:a,origin:h,dx:1E-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",${Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],UNIT["Degrees",111319.491]]',
valid:[-180,180],origin:[-180,180],dx:1E-5}},_isWebMercator:function(){return-1!==b.indexOf([102113,102100,3857,3785],this.wkid)},_isWrappable:function(){return-1!==b.indexOf([102113,102100,3857,3785,4326],this.wkid)},_getInfo:function(){return this.wkid?this._info[this.wkid]:null},_canProject:function(a){var b=!1;a&&(b=this.isWebMercator()&&4326===a.wkid||a.isWebMercator()&&4326===this.wkid);return b},isWebMercator:function(){return this._isWebMercator()},equals:function(a){var b=!1;a&&(this===a&&
(b=!0),this.wkid||a.wkid?b=this.wkid===a.wkid||this.isWebMercator()&&a.isWebMercator()||this.wkid===a.latestWkid||a.wkid===this.latestWkid:this.wkt&&a.wkt&&(b=this.wkt.toUpperCase()===a.wkt.toUpperCase()));return b},toJson:function(){var a=null;null!=this.wkid?a={wkid:this.wkid}:null!=this.wkt&&(a={wkt:this.wkt});a&&null!=this.latestWkid&&(a.latestWkid=this.latestWkid);return a}});v.prototype=c.prototype;c.simpleConstructor=v;return n.SpatialReference=c})},"esri/geometry/Geometry":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../SpatialReference"],function(c,b,a,n,u){c=c(null,{declaredClass:"esri.geometry.Geometry",spatialReference:null,type:null,cache:void 0,setSpatialReference:function(a){this.spatialReference=a;return this},verifySR:function(){this.spatialReference||this.setSpatialReference(new u(4326))},getExtent:function(){return null},clearCache:function(){this.cache=void 0},getCacheValue:function(a){return this.cache&&this.cache[a]},setCacheValue:function(a,b){this.cache||
(this.cache={});this.cache[a]=b}});b.setObject("geometry.Geometry",c,n);return c})},"esri/srUtils":function(){define(["./SpatialReference","./ImageSpatialReference","./kernel","./sniff","dojo/_base/lang"],function(c,b,a,n,u){function v(a){var b=!1;a&&(a.ics||a.icsid)&&(b=!0);return b}n={isICS:v,createSpatialReference:function(a){var f=null;a&&(f=v(a)?new b(a):new c(a));return f}};u.mixin(a,n);return n})},"esri/ImageSpatialReference":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./lang ./SpatialReference".split(" "),
function(c,b,a,n,u,v){c=c(v,{declaredClass:"esri.ImageSpatialReference",constructor:function(a){a&&b.isObject(a)&&b.mixin(this,a)},icsid:null,icsns:null,ics:null,_isWebMercator:function(){return!1},_isWrappable:function(){return!1},equals:function(a){var b=!1;if(a)if(this.icsid&&a.icsid){if(b=this.icsid===a.icsid,this.icsns||a.icsns)b=b&&this.icsns===a.icsns}else this.ics&&a.ics&&(b=this.ics===a.ics);return b},toJson:function(a){var b=null,c=u.isDefined;a=c(a)?a:!0;c(this.icsid)?(b={icsid:this.icsid},
c(this.icsns)&&(b.icsns=this.icsns)):c(this.ics)&&(b={ics:this.ics});c(this.url)&&c(b)&&a&&(b.url=this.url);return b}});return n.ImageSpatialReference=c})},"esri/geometry/Extent":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./webMercatorUtils ./mathUtils ../srUtils".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w){function x(){}n={type:"extent",xmin:0,ymin:0,xmax:0,ymax:0};var e=c(f,{declaredClass:"esri.geometry.Extent",
type:"extent",xmin:0,ymin:0,xmax:0,ymax:0,constructor:function(a,b,d,e,k){v.isObject(a)?(v.mixin(this,a),this.spatialReference&&(this.spatialReference=w.createSpatialReference(this.spatialReference))):this.update(a,b,d,e,k);this.verifySR()},getWidth:function(){return Math.abs(this.xmax-this.xmin)},getHeight:function(){return Math.abs(this.ymax-this.ymin)},getCenter:function(){return new l((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2,this.spatialReference)},centerAt:function(a){var b=this.getCenter(),
d=a.x-b.x;a=a.y-b.y;return new e(this.xmin+d,this.ymin+a,this.xmax+d,this.ymax+a,this.spatialReference)},update:function(a,b,d,e,k){this.xmin=a;this.ymin=b;this.xmax=d;this.ymax=e;this.spatialReference=k;this.clearCache();return this},offset:function(a,b){return new e(this.xmin+a,this.ymin+b,this.xmax+a,this.ymax+b,this.spatialReference)},expand:function(a){var b=(1-a)/2;a=this.getWidth()*b;b*=this.getHeight();return new e(this.xmin+a,this.ymin+b,this.xmax-a,this.ymax-b,this.spatialReference)},intersects:function(a){if(!a)return!1;
var b=a.type,d=this.spatialReference,e=a.spatialReference;d&&e&&!d.equals(e)&&d._canProject(e)&&(a=d.isWebMercator()?t.geographicToWebMercator(a):t.webMercatorToGeographic(a,!0));switch(b){case "point":return this.contains(a);case "multipoint":return this._intersectsMultipoint(a);case "extent":return this._intersectsExtent(a);case "polygon":return this._intersectsPolygon(a);case "polyline":return this._intersectsPolyline(a)}},normalize:function(){var b=this._normalize(!1,!0);a.isArray(b)||(b=[b]);
return b},shiftCentralMeridian:function(){return this._normalize(!0)},bisect:function(){var a=this.spatialReference,b=a&&a._getInfo(),d=[],c=0;if(b&&this._isOutOfBounds(b)){var k=this,c=k.xmin,f=k.ymin,l=k.ymax,t=b.valid[0],p=b.valid[1];k.getWidth()>2*p&&(k=k.getCenter(),k=new e(k.x-p,f,k.x+p,l,new h(a.toJson())));var c=k.xmin-c,z=this._normalizeX(k.xmin,b),b=this._normalizeX(k.xmax,b);z.frameId===b.frameId?d.push(new e(z.x,f,b.x,l,new h(a.toJson()))):d.push(new e(z.x,f,p,l,new h(a.toJson())),new e(t,
f,b.x,l,new h(a.toJson())))}else d.push(this.getExtent());return{extents:d,marginLeft:c}},_intersectsMultipoint:function(a){var b=a.points.length,d;for(d=0;d<b;d++)if(this.contains(a.getPoint(d)))return!0;return!1},_intersectsExtent:function(a){var b,d,c,k,m=!1;this.xmin<=a.xmin?(b=a.xmin,this.xmax<b?m=!0:c=Math.min(this.xmax,a.xmax)-b):(b=this.xmin,a.xmax<b?m=!0:c=Math.min(this.xmax,a.xmax)-b);this.ymin<=a.ymin?(d=a.ymin,this.ymax<d?m=!0:k=Math.min(this.ymax,a.ymax)-d):(d=this.ymin,a.ymax<d?m=!0:
k=Math.min(this.ymax,a.ymax)-d);return m?null:new e(b,d,b+c,d+k,this.spatialReference)},_intersectsPolygon:function(a){var b=[this.xmin,this.ymax],d=[this.xmax,this.ymax],e=[this.xmin,this.ymin],c=[this.xmax,this.ymin],m=[b,d,e,c],b=[[e,b],[b,d],[d,c],[c,e]],e=a.rings,c=e.length,f,t=new l(0,0,this.spatialReference);f=m.length;for(d=0;d<f;d++)if(t.update(m[d][0],m[d][1]),a.contains(t))return!0;t.setSpatialReference(a.spatialReference);for(var p,z,d=0;d<c;d++)if(m=e[d],f=m.length){p=m[0];t.update(p[0],
p[1]);if(this.contains(t))return!0;for(a=1;a<f;a++){z=m[a];t.update(z[0],z[1]);if(this.contains(t)||this._intersectsLine([p,z],b))return!0;p=z}}return!1},_intersectsPolyline:function(a){var b=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],d,e=a.paths,c=e.length,m,f,t,p,z=new l(0,0,a.spatialReference);for(a=0;a<c;a++)if(m=e[a],f=m.length){t=m[0];z.update(t[0],t[1]);
if(this.contains(z))return!0;for(d=1;d<f;d++){p=m[d];z.update(p[0],p[1]);if(this.contains(z)||this._intersectsLine([t,p],b))return!0;t=p}}return!1},_intersectsLine:function(a,b){var d=p._getLineIntersection2,e,g=b.length;for(e=0;e<g;e++)if(d(a,b[e]))return!0;return!1},contains:function(a){if(!a)return!1;var b=a.type;if("point"===b){var d=this.spatialReference,e=a.spatialReference,b=a.x;a=a.y;d&&e&&!d.equals(e)&&d._canProject(e)&&(a=d.isWebMercator()?l.lngLatToXY(b,a):l.xyToLngLat(b,a,!0),b=a[0],a=
a[1]);return b>=this.xmin&&b<=this.xmax&&a>=this.ymin&&a<=this.ymax}return"extent"===b?this._containsExtent(a):!1},_containsExtent:function(a){var b=a.xmin,d=a.ymin,e=a.xmax,c=a.ymax,m=a.spatialReference;a=new l(b,d,m);b=new l(b,c,m);c=new l(e,c,m);d=new l(e,d,m);return this.contains(a)&&this.contains(b)&&this.contains(c)&&this.contains(d)?!0:!1},union:function(a){return new e(Math.min(this.xmin,a.xmin),Math.min(this.ymin,a.ymin),Math.max(this.xmax,a.xmax),Math.max(this.ymax,a.ymax),this.spatialReference)},
getExtent:function(){var a=this.spatialReference;return new e(this.xmin,this.ymin,this.xmax,this.ymax,a&&new h(a.toJson()))},_shiftCM:function(a){var b=this.getCacheValue("_shifted");if(!b){var b=new e(this.toJson()),d=b.spatialReference;if(a=a||d._getInfo()){var c=this._getCM(a);if(c){var k=d._isWebMercator()?t.webMercatorToGeographic(c):c;b.xmin-=c.x;b.xmax-=c.x;d._isWebMercator()||(k.x=this._normalizeX(k.x,a).x);b.setSpatialReference(new h(v.substitute({Central_Meridian:k.x},4326===d.wkid?a.altTemplate:
a.wkTemplate)))}}this.setCacheValue("_shifted",b)}return b},_getCM:function(a){var b;this._isOutOfBounds(a)&&(b=this.getCenter());return b},_isOutOfBounds:function(a){var b=a.valid[0];a=a.valid[1];var d=this.xmin,e=this.xmax;return!(d>=b&&d<=a&&e>=b&&e<=a)},_normalize:function(a,c,d){var g=new e(this.toJson()),k=g.spatialReference;if(k&&(d=d||k._getInfo())){var m=b.map(this._getParts(d),function(a){return a.extent});return 2<m.length?a?this._shiftCM(d):g.update(d.valid[0],g.ymin,d.valid[1],g.ymax,
k):2===m.length?a?this._shiftCM(d):c?m:{rings:b.map(m,function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]}),spatialReference:k}:m[0]||g}return g},_getParts:function(a){var b=this.getCacheValue("_parts");if(!b){var b=[],d=this.xmin,c=this.xmax,k=this.ymin,m=this.ymax,f=this.spatialReference,l=this.getWidth(),t=d,z=c,p=0,h=0,x,B;a=a||f._getInfo();x=a.valid[0];B=a.valid[1];h=this._normalizeX(d,a);d=h.x;p=h.frameId;h=this._normalizeX(c,a);c=h.x;h=h.frameId;
a=d===c&&0<l;if(l>2*B){l=new e(t<z?d:c,k,B,m,f);d=new e(x,k,t<z?c:d,m,f);B=new e(0,k,B,m,f);k=new e(x,k,0,m,f);f=[];x=[];l.contains(B)&&f.push(p);l.contains(k)&&x.push(p);d.contains(B)&&f.push(h);d.contains(k)&&x.push(h);for(m=p+1;m<h;m++)f.push(m),x.push(m);b.push({extent:l,frameIds:[p]},{extent:d,frameIds:[h]},{extent:B,frameIds:f},{extent:k,frameIds:x})}else d>c||a?b.push({extent:new e(d,k,B,m,f),frameIds:[p]},{extent:new e(x,k,c,m,f),frameIds:[h]}):b.push({extent:new e(d,k,c,m,f),frameIds:[p]});
this.setCacheValue("_parts",b)}return b},_normalizeX:function(a,b){var d=0,e=b.valid[0],c=b.valid[1];b=2*c;a>c?(d=Math.ceil(Math.abs(a-c)/b),a-=d*b):a<e&&(d=Math.ceil(Math.abs(a-e)/b),a+=d*b,d=-d);return{x:a,frameId:d}},toJson:function(){var a={xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax},b=this.spatialReference;b&&(a.spatialReference=b.toJson());return a}});x.prototype=e.prototype;e.simpleConstructor=x;e.defaultProps=n;a.setObject("geometry.Extent",e,u);u.geometry.defaultExtent=n;
return e})},"esri/geometry/webMercatorUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/has ../kernel ../SpatialReference ./Point".split(" "),function(c,b,a,n,u,v){function h(a,b,f,h){if("point"===a.type){var l=b(a.x,a.y,h);return new a.constructor(l[0],l[1],new u(f))}if("extent"===a.type){var l=b(a.xmin,a.ymin,h),e=b(a.xmax,a.ymax,h);return new a.constructor(l[0],l[1],e[0],e[1],new u(f))}if("polyline"===a.type||"polygon"===a.type){var l="polyline"===a.type,m=[],g;c.forEach(l?a.paths:
a.rings,function(a){m.push(g=[]);c.forEach(a,function(a){g.push(b(a[0],a[1],h))})});return l?new a.constructor({paths:m,spatialReference:new u(f)}):new a.constructor({rings:m,spatialReference:new u(f)})}if("multipoint"===a.type){var d=[];c.forEach(a.points,function(a){d.push(b(a[0],a[1],h))});return new a.constructor({points:d,spatialReference:new u(f)})}}function f(a,b){a=a&&(null!=a.wkid?a:a.spatialReference);b=b&&(null!=b.wkid?b:b.spatialReference);return a&&b?b.equals(a)?!0:b._canProject(a):!1}
a={canProject:f,project:function(a,b){var c=a&&a.spatialReference;b=b&&(null!=b.wkid?b:b.spatialReference);c&&b?c.equals(b)?a=new a.constructor(a.toJson()):f(c,b)?b.isWebMercator()?a=h(a,v.lngLatToXY,{wkid:102100}):4326===b.wkid&&(a=h(a,v.xyToLngLat,{wkid:4326})):a=null:a=null;return a},lngLatToXY:v.lngLatToXY,xyToLngLat:v.xyToLngLat,metersPerDegree:v.metersPerDegree,geographicToWebMercator:function(a){return h(a,v.lngLatToXY,{wkid:102100})},webMercatorToGeographic:function(a,b){return h(a,v.xyToLngLat,
{wkid:4326},b)}};b.mixin(b.getObject("geometry",!0,n),a);return a})},"esri/geometry/mathUtils":function(){define(["dojo/_base/lang","dojo/has","../kernel","./Point"],function(c,b,a,n){function u(a,b,c){return a instanceof n?new n(a.x+c*(b.x-a.x),a.y+c*(b.y-a.y)):[a[0]+c*(b[0]-a[0]),a[1]+c*(b[1]-a[1])]}function v(a,b){return 1E-8>Math.abs(a-b)}function h(a,b,c,p){var f,l=v(a[0],b[0])?1E10:(a[1]-b[1])/(a[0]-b[0]),e=v(c[0],p[0])?1E10:(c[1]-p[1])/(c[0]-p[0]),m=a[1]-l*a[0],g=c[1]-e*c[0];if(v(l,e)){if(v(m,
g)){if(v(a[0],b[0]))if(Math.min(a[1],b[1])<Math.max(c[1],p[1])||Math.max(a[1],b[1])>Math.min(c[1],p[1]))a=(a[1]+b[1]+c[1]+p[1]-Math.min(a[1],b[1],c[1],p[1])-Math.max(a[1],b[1],c[1],p[1]))/2,f=(a-m)/l;else return null;else if(Math.min(a[0],b[0])<Math.max(c[0],p[0])||Math.max(a[0],b[0])>Math.min(c[0],p[0]))f=(a[0]+b[0]+c[0]+p[0]-Math.min(a[0],b[0],c[0],p[0])-Math.max(a[0],b[0],c[0],p[0]))/2,a=l*f+m;else return null;return[f,a]}return null}v(l,1E10)?(f=a[0],a=e*f+g):v(e,1E10)?(f=c[0],a=l*f+m):(f=-(m-
g)/(l-e),a=a[1]===b[1]?a[1]:c[1]===p[1]?c[1]:l*f+m);return[f,a]}b={getLength:function(a,b){var c=b.x-a.x;a=b.y-a.y;return Math.sqrt(c*c+a*a)},_getLength:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},getPointOnLine:u,getMidpoint:function(a,b){return u(a,b,.5)},_equals:v,_getLineIntersection:h,getLineIntersection:function(a,b,c,p,w){(a=h([a.x,a.y],[b.x,b.y],[c.x,c.y],[p.x,p.y]))&&(a=new n(a[0],a[1],w));return a},_getLineIntersection2:function(a,b){var c=a[0],f=a[1],l=b[0],h=b[1];
b=c[0];c=c[1];a=f[0];var f=f[1],e=l[0],m=l[1],l=h[0]-e,e=b-e,g=a-b,h=h[1]-m,m=c-m,d=f-c,y=h*g-l*d;if(0===y)return!1;l=(l*m-h*e)/y;e=(g*m-d*e)/y;return 0<=l&&1>=l&&0<=e&&1>=e?[b+l*(a-b),c+l*(f-c)]:!1},_pointLineDistance:function(a,b){var c=b[0],f=b[1];b=c[0];var l=c[1],c=a[0];a=a[1];var h=f[0]-b,e=f[1]-l,m=c-b,g=a-l,f=Math.sqrt,d=Math.pow,y=f(d(h,2)+d(e,2)),m=(m*h+g*e)/(y*y),l=l+m*e;return f(d(c-(b+m*h),2)+d(a-l,2))}};c.mixin(c.getObject("geometry",!0,a),b);return b})},"esri/urlUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/url dojo/global dojo/io-query ./kernel ./lang ./config ./sniff dojo/i18n!./nls/jsapi".split(" "),
function(c,b,a,n,u,v,h,f,l,t){var p={},w=f.defaults.io,x=/^[a-z][a-z0-9\+\-\.]*:/i,e=/^\s*http:/i,m=/^\s*https:/i,g=/:\d+$/,d=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i;p.isHTTP=function(a){var b=n.location.protocol;return null==a?"http:"===b||"https:"===b:a?"https:"===b:"http:"===b};p.getProtocolForWebResource=function(a){return p.isHTTP()?n.location.protocol:a?"https:":"http:"};p.urlToObject=function(b){var d={},e=new a(b),c=b.indexOf("?");null===e.query?d={path:b,query:null}:(d.path=b.substring(0,
c),d.query=u.queryToObject(e.query));e.fragment&&(d.hash=e.fragment,null===e.query&&(d.path=d.path.substring(0,d.path.length-(e.fragment.length+1))));return d};p.getProxyUrl=function(a,b){var d=c.isString(a)?0===c.trim(a).toLowerCase().indexOf("https:"):a,e=w.proxyUrl,g,k=t.io.proxyNotSet;c.isString(a)&&(a=p.getProxyRule(a))&&(e=a.proxyUrl);if(!e)throw Error(k);d&&!1!==b&&0!==n.location.href.toLowerCase().indexOf("https:")&&(b=e,0!==b.toLowerCase().indexOf("http")&&(b=p.getAbsoluteUrl(b)),b=b.replace(/^http:/i,
"https:"),p.canUseXhr(b)&&(e=b,g=1));e=p.urlToObject(e);e._xo=g;return e};p.addProxy=function(a){var b=p.getProxyRule(a),d;b?d=p.urlToObject(b.proxyUrl):w.alwaysUseProxy&&(d=p.getProxyUrl());d&&(b=p.urlToObject(a),a=d.path+"?"+b.path,(d=u.objectToQuery(c.mixin(d.query||{},b.query)))&&(a+="?"+d));return a};p.addProxyRule=function(a){var b=a.urlPrefix=p.urlToObject(a.urlPrefix).path.replace(/([^\/])$/,"$1/").replace(/^https?:\/\//ig,"").toLowerCase(),d=w.proxyRules,e,c=d.length,g,y=c;for(e=0;e<c;e++)if(g=
d[e].urlPrefix,0===b.indexOf(g)){if(b.length===g)return-1;y=e;break}else 0===g.indexOf(b)&&(y=e+1);d.splice(y,0,a);return y};p.getProxyRule=function(a){var b=w.proxyRules,d=b.length,e=p.urlToObject(a).path.replace(/([^\/])$/,"$1/").replace(/^https?:\/\//ig,"").toLowerCase(),c;for(a=0;a<d;a++)if(0===e.indexOf(b[a].urlPrefix)){c=b[a];break}return c};p.hasSameOrigin=function(b,d,e){b=b.toLowerCase();d=d.toLowerCase();var g=n.location.href.toLowerCase();b=0===b.indexOf("http")?new a(b):g=new a(g);d=0===
d.indexOf("http")?new a(d):c.isString(g)?new a(g):g;return(e||b.scheme===d.scheme)&&b.host===d.host&&b.port===d.port};p.canUseXhr=function(a,d){var e=l("esri-phonegap")?!0:!1,c=p.hasSameOrigin,g=w.corsEnabledServers,k,y=-1;!e&&l("esri-cors")&&g&&g.length&&(e=b.some(g,function(b,d){b=!b||"object"!==typeof b||b instanceof RegExp?b:b.host;if(b instanceof RegExp){if(b.test(a))return y=d,!0}else if(b&&(k=0!==b.trim().toLowerCase().indexOf("http"),c(a,k?"http://"+b:b)||k&&c(a,"https://"+b)))return y=d,
!0;return!1}));return d?y:e};p.getAbsoluteUrl=function(a){var b=p.getProtocolForWebResource();return c.isString(a)&&!x.test(a)?0===a.indexOf("//")?b+a:0===a.indexOf("/")?b+"//"+n.location.host+a:v._appBaseUrl+a:a};p.fixUrl=function(a){a=c.trim(a);a=p.getAbsoluteUrl(a);a=p.normalizeSlashes(a);a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");a=p.downgradeToHTTP(a);return a=p.upgradeToHTTPS(a)};p.normalize=function(a){return p.fixUrl(a)};p.normalizeSlashes=function(a){if(/^https?:\/\//i.test(a)){var b,
d,e=a.indexOf("?");-1<e?(b=a.slice(0,e),d=a.slice(e+1)):b=a;a=b.replace(/\/{2,}/g,"/");a=a.replace("/","//");d&&(a+="?"+d)}return a};p.downgradeToHTTP=function(a){return p.isHTTP(!1)&&m.test(a)&&p.hasSameOrigin(n.location.href,a,!0)&&!p.canUseXhr(a)?a.replace(m,"http:"):a};p.upgradeToHTTPS=function(a){var b=w.httpsDomains,m=p.isHTTP(!1),f=p.isHTTP(!0);if(!e.test(a))return a;a=c.trim(a);var y=a.indexOf("/",7),y=-1===y?a:a.slice(0,y),y=y.toLowerCase().slice(7);if(g.test(y))if(h.endsWith(y,":80"))y=
y.slice(0,-3),a=a.replace(":80","");else return a;if(m&&y===n.location.host&&(!d.test(a)||!p.canUseXhr(a)))return a;m=!1;if(f&&y===n.location.host)m=!0;else if(b)for(var l=0;l<b.length;l++){var z=b[l];if(y===z||h.endsWith(y,"."+z)){m=!0;break}}m||!f||w.alwaysUseProxy||p.getProxyRule(a)||(m=!0);m&&(a=a.replace(e,"https:"));return a};c.mixin(v,p);v._getProxyUrl=p.getProxyUrl;v._getProxiedUrl=p.addProxy;v._hasSameOrigin=p.hasSameOrigin;v._canDoXOXHR=p.canUseXhr;v._getAbsoluteUrl=p.getAbsoluteUrl;v.fixUrl=
p.fixUrl;return p})},"esri/geometry/Multipoint":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./Extent ../srUtils".split(" "),function(c,b,a,n,u,v,h,f,l,t){function p(){}function w(){}a={type:"multipoint",points:null};c=c(h,{declaredClass:"esri.geometry.Multipoint",type:"multipoint",points:null,constructor:function(a){this.points=[];a&&(a.points?u.mixin(this,a):this.spatialReference=a,this.spatialReference&&(this.spatialReference=
t.createSpatialReference(this.spatialReference)));this.verifySR()},addPoint:function(a){this.clearCache();b.isArray(a)?this.points.push(a):this.points.push([a.x,a.y]);return this},removePoint:function(a){if(this._validateInputs(a))return this.clearCache(),new f(this.points.splice(a,1)[0],this.spatialReference)},getExtent:function(){var a=this.getCacheValue("_extent");if(a)return new l(a);var a=this.points,b=a.length;if(b){var c=a[0],g,d,f=g=c[0],k=d=c[1],h=Math.min,p=Math.max,t=this.spatialReference,
D,z;for(z=0;z<b;z++)c=a[z],D=c[0],c=c[1],f=h(f,D),k=h(k,c),g=p(g,D),d=p(d,c);a={xmin:f,ymin:k,xmax:g,ymax:d,spatialReference:t?t.toJson():null};this.setCacheValue("_extent",a);return new l(a)}},_validateInputs:function(a){return null===a||0>a||a>=this.points.length?!1:!0},getPoint:function(a){if(this._validateInputs(a))return a=this.points[a],new f(a[0],a[1],this.spatialReference)},setPoint:function(a,b){if(this._validateInputs(a))return this.clearCache(),this.points[a]=[b.x,b.y],this},toJson:function(){var a=
{points:u.clone2DArray(this.points)},b=this.spatialReference;b&&(a.spatialReference=b.toJson());return a}});p.prototype=c.prototype;w.prototype=new p;Object.defineProperty(w.prototype,"points",{get:function(){this._unquantizeFn&&(this._pointsVal=this._unquantizeFn({points:u.clone2DArray(this._pointsVal)}).points,this._unquantizeFn=null);return this._pointsVal},set:function(a){this._pointsVal=a}});w.prototype.setupLazyUnquantization=function(a,b){this._unquantizeFn=a;this._pointsVal=b.points};c.simpleConstructor=
p;c.accessorConstructor=w;c.defaultProps=a;b.setObject("geometry.Multipoint",c,n);n.geometry.defaultMultipoint=a;return c})},"esri/geometry/Polygon":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./Extent ./mathUtils ../srUtils".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w){function x(){}function e(){}n={type:"polygon",rings:null};var m=c(f,{declaredClass:"esri.geometry.Polygon",type:"polygon",rings:null,constructor:function(b){this.rings=
[];this._ring=0;b&&(a.isArray(b)?this.rings=a.isArray(b[0][0])?b:[b]:b.rings?v.mixin(this,b):this.spatialReference=b,this.spatialReference&&(this.spatialReference=w.createSpatialReference(this.spatialReference)));this.verifySR()},addRing:function(e){this.clearCache();this._ring=this.rings.length;this.rings[this._ring]=[];a.isArray(e[0])?b.forEach(e,this._addPointArr,this):b.forEach(e,this._addPoint,this);return this},_addPointArr:function(a){this.rings[this._ring].push(a)},_addPoint:function(a){this.rings[this._ring].push([a.x,
a.y])},_insertPoints:function(a,d){this.clearCache();this._ring=d;this.rings[this._ring]||(this.rings[this._ring]=[]);b.forEach(a,this._addPoint,this)},_validateInputs:function(a,b){return null!==a&&void 0!==a&&(0>a||a>=this.rings.length)||null!==b&&void 0!==a&&(0>b||b>=this.rings[a].length)?!1:!0},getPoint:function(a,b){if(this._validateInputs(a,b))return new l(this.rings[a][b],this.spatialReference)},setPoint:function(a,b,e){if(this._validateInputs(a,b))return this.clearCache(),this.rings[a][b]=
[e.x,e.y],this},insertPoint:function(a,b,e){if(this._validateInputs(a)&&null!=b&&0<=b&&b<=this.rings[a].length)return this.clearCache(),this.rings[a].splice(b,0,[e.x,e.y]),this},removeRing:function(a){if(this._validateInputs(a,null)){this.clearCache();a=this.rings.splice(a,1)[0];var b,e=a.length,c=this.spatialReference;for(b=0;b<e;b++)a[b]=new l(a[b],c);return a}},removePoint:function(a,b){if(this._validateInputs(a,b))return this.clearCache(),new l(this.rings[a].splice(b,1)[0],this.spatialReference)},
getExtent:function(){var a;a=this.getCacheValue("_extent");var b=this.getCacheValue("_partwise");if(a)return a=new t(a),a._partwise=b,a;a=this.rings;var e=a.length;if(e&&a[0].length){var c,m,f,l,h,z,p,x,n=l=a[0][0][0],B=h=a[0][0][1],M=Math.min,w=Math.max,u=this.spatialReference,b=[],v,O,K,I;for(z=0;z<e;z++){c=a[z];v=O=c[0]&&c[0][0];K=I=c[0]&&c[0][1];x=c.length;for(p=0;p<x;p++)m=c[p],f=m[0],m=m[1],n=M(n,f),B=M(B,m),l=w(l,f),h=w(h,m),v=M(v,f),K=M(K,m),O=w(O,f),I=w(I,m);b.push(new t({xmin:v,ymin:K,xmax:O,
ymax:I,spatialReference:u?u.toJson():null}))}a={xmin:n,ymin:B,xmax:l,ymax:h,spatialReference:u?u.toJson():null};b=1<b.length?b:null;this.setCacheValue("_extent",a);this.setCacheValue("_partwise",b);a=new t(a);a._partwise=b;return a}},contains:function(a){var b=this.rings,e,c=!1,g,m,f,h,z,p,t=b.length;e=this.spatialReference;g=a.spatialReference;var x=a.x;a=a.y;e&&g&&!e.equals(g)&&e._canProject(g)&&(a=e.isWebMercator()?l.lngLatToXY(x,a):l.xyToLngLat(x,a,!0),x=a[0],a=a[1]);for(p=0;p<t;p++)for(e=b[p],
f=e.length,z=h=0;z<f;z++)h++,h===f&&(h=0),g=e[z],m=e[h],(g[1]<a&&m[1]>=a||m[1]<a&&g[1]>=a)&&g[0]+(a-g[1])/(m[1]-g[1])*(m[0]-g[0])<x&&(c=!c);return c},getCentroid:function(){var a=this.getCacheValue("_centroid");if(void 0!==a)return a;var a=this.rings,e,c,k,m,f=[],h,p,z=Infinity,t=-Infinity,x=Infinity,n=-Infinity;b.forEach(a,function(a){e=c=k=0;b.forEach(a,function(b,d){d<a.length-1&&(h=a[d+1],p=b[0]*h[1]-h[0]*b[1],e+=(b[0]+h[0])*p,c+=(b[1]+h[1])*p,k+=p,b[0]<z&&(z=b[0]),b[0]>t&&(t=b[0]),b[1]<x&&(x=
b[1]),b[1]>n&&(n=b[1]))});0<k&&(k*=-1);k&&f.push([e,c,k/2])});f.sort(function(a,b){return a[2]-b[2]});e=c=void 0;f[0]&&(m=6*f[0][2],e=f[0][0]/m,c=f[0][1]/m,e<z||e>t||c<x||c>n)&&(e=c=void 0);if(void 0===e||void 0===c)if(a=a[0]&&a[0].length?this._getLineCentroid(a[0]):null)e=a.x,c=a.y;a=isNaN(e)||isNaN(c)?null:new l(e,c,this.spatialReference);this.setCacheValue("_centroid",a);return a},_getLineCentroid:function(a){var b,e=0,c=0,g=0,m,f,l={x:0,y:0},z={x:0,y:0},h,t=a.length,x;for(h=0;h<t-1;h++)m=a[h],
f=a[h+1],m&&f&&(l.x=m[0],l.y=m[1],z.x=f[0],z.y=f[1],b=p.getLength(l,z),0<b&&(e+=b,m=p.getMidpoint(m,f),c+=b*m[0],g+=b*m[1]));0<e?x={x:c/e,y:g/e}:a[0]&&(x={x:a[0][0],y:a[0][1]});return x},isClockwise:function(b){var e=0,c,g=b.length,m=a.isArray(b[0])?function(a,b){return a[0]*b[1]-b[0]*a[1]}:function(a,b){return a.x*b.y-b.x*a.y};for(c=0;c<g;c++)e+=m(b[c],b[(c+1)%g]);return 0>=e/2},isSelfIntersecting:function(a){a=a||this;var b,e,c,g,m,f,h,z=a.rings.length,l;for(c=0;c<z;c++){for(b=0;b<a.rings[c].length-
1;b++)for(m=[[a.rings[c][b][0],a.rings[c][b][1]],[a.rings[c][b+1][0],a.rings[c][b+1][1]]],e=c+1;e<z;e++)for(g=0;g<a.rings[e].length-1;g++)if(f=[[a.rings[e][g][0],a.rings[e][g][1]],[a.rings[e][g+1][0],a.rings[e][g+1][1]]],(h=p._getLineIntersection2(m,f))&&!(h[0]===m[0][0]&&h[1]===m[0][1]||h[0]===f[0][0]&&h[1]===f[0][1]||h[0]===m[1][0]&&h[1]===m[1][1]||h[0]===f[1][0]&&h[1]===f[1][1]))return!0;g=a.rings[c].length;if(!(4>=g))for(b=0;b<g-3;b++)for(l=g-1,0===b&&(l=g-2),m=[[a.rings[c][b][0],a.rings[c][b][1]],
[a.rings[c][b+1][0],a.rings[c][b+1][1]]],e=b+2;e<l;e++)if(f=[[a.rings[c][e][0],a.rings[c][e][1]],[a.rings[c][e+1][0],a.rings[c][e+1][1]]],(h=p._getLineIntersection2(m,f))&&!(h[0]===m[0][0]&&h[1]===m[0][1]||h[0]===f[0][0]&&h[1]===f[0][1]||h[0]===m[1][0]&&h[1]===m[1][1]||h[0]===f[1][0]&&h[1]===f[1][1]))return!0}return!1},toJson:function(){var a={rings:v.clone3DArray(this.rings)},b=this.spatialReference;b&&(a.spatialReference=b.toJson());return a}});x.prototype=m.prototype;e.prototype=new x;Object.defineProperty(e.prototype,
"rings",{get:function(){this._unquantizeFn&&(this._ringsVal=this._unquantizeFn({rings:v.clone3DArray(this._ringsVal)}).rings,this._unquantizeFn=null);return this._ringsVal},set:function(a){this._ringsVal=a}});e.prototype.setupLazyUnquantization=function(a,b){this._unquantizeFn=a;this._ringsVal=b.rings};m.simpleConstructor=x;m.accessorConstructor=e;m.defaultProps=n;m.createEllipse=function(a){var b=a.center.x,e=a.center.y,c=a.longAxis,g=a.shortAxis,f=a.numberOfPoints,h=a.map,l,z,p;a=[];var t=2*Math.PI/
f;for(z=0;z<f;z++)l=Math.cos(z*t),p=Math.sin(z*t),l=h.toMap({x:c*l+b,y:g*p+e}),a.push(l);a.push(a[0]);b=new m(h.spatialReference);b.addRing(a);return b};m.createCircle=function(a){return m.createEllipse({center:a.center,longAxis:a.r,shortAxis:a.r,numberOfPoints:a.numberOfPoints,map:a.map})};m.fromExtent=function(a){var e=a.normalize();a=a.spatialReference;return new m({rings:b.map(e,function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]}),spatialReference:a?
a.toJson():null})};a.setObject("geometry.Polygon",m,u);u.geometry.defaultPolygon=n;u.geometry.createEllipse=m.createEllipse;u.geometry.createCircle=m.createCircle;u.geometry.isClockwise=m.prototype.isClockwise;u.geometry.polygonSelfIntersecting=m.prototype.isSelfIntersecting;return m})},"esri/geometry/Polyline":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./Extent ../srUtils".split(" "),function(c,b,a,n,u,
v,h,f,l,t,p){function w(){}function x(){}n={type:"polyline",paths:null};c=c(f,{declaredClass:"esri.geometry.Polyline",type:"polyline",paths:null,constructor:function(b){this.paths=[];this._path=0;b&&(a.isArray(b)?this.paths=a.isArray(b[0][0])?b:[b]:b.paths?v.mixin(this,b):this.spatialReference=b,this.spatialReference&&(this.spatialReference=p.createSpatialReference(this.spatialReference)));this.verifySR()},addPath:function(e){this.clearCache();this._path=this.paths.length;this.paths[this._path]=[];
a.isArray(e[0])?b.forEach(e,this._addPointArr,this):b.forEach(e,this._addPoint,this);return this},_addPointArr:function(a){this.paths[this._path].push(a)},_addPoint:function(a){this.paths[this._path].push([a.x,a.y])},_insertPoints:function(a,c){this.clearCache();this._path=c;this.paths[this._path]||(this.paths[this._path]=[]);b.forEach(a,this._addPoint,this)},_validateInputs:function(a,b){return null!==a&&void 0!==a&&(0>a||a>=this.paths.length)||null!==b&&void 0!==a&&(0>b||b>=this.paths[a].length)?
!1:!0},getPoint:function(a,b){if(this._validateInputs(a,b))return new l(this.paths[a][b],this.spatialReference)},setPoint:function(a,b,c){if(this._validateInputs(a,b))return this.clearCache(),this.paths[a][b]=[c.x,c.y],this},insertPoint:function(a,b,c){if(this._validateInputs(a)&&null!=b&&0<=b&&b<=this.paths[a].length)return this.clearCache(),this.paths[a].splice(b,0,[c.x,c.y]),this},removePath:function(a){if(this._validateInputs(a,null)){this.clearCache();a=this.paths.splice(a,1)[0];var b,e=a.length,
d=this.spatialReference;for(b=0;b<e;b++)a[b]=new l(a[b],d);return a}},removePoint:function(a,b){if(this._validateInputs(a,b))return this.clearCache(),new l(this.paths[a].splice(b,1)[0],this.spatialReference)},getExtent:function(){var a;a=this.getCacheValue("_extent");var b=this.getCacheValue("_partwise");if(a)return a=new t(a),a._partwise=b,a;a=this.paths;var c=a.length;if(c&&a[0].length){var d,f,k,h,l,p,x,z,n=h=a[0][0][0],w=l=a[0][0][1],u=Math.min,B=Math.max,M=this.spatialReference,b=[],v,N,Q,O;
for(p=0;p<c;p++){d=a[p];v=N=d[0]&&d[0][0];Q=O=d[0]&&d[0][1];z=d.length;for(x=0;x<z;x++)f=d[x],k=f[0],f=f[1],n=u(n,k),w=u(w,f),h=B(h,k),l=B(l,f),v=u(v,k),Q=u(Q,f),N=B(N,k),O=B(O,f);b.push(new t({xmin:v,ymin:Q,xmax:N,ymax:O,spatialReference:M?M.toJson():null}))}a={xmin:n,ymin:w,xmax:h,ymax:l,spatialReference:M?M.toJson():null};b=1<b.length?b:null;this.setCacheValue("_extent",a);this.setCacheValue("_partwise",b);a=new t(a);a._partwise=b;return a}},toJson:function(){var a={paths:v.clone3DArray(this.paths)},
b=this.spatialReference;b&&(a.spatialReference=b.toJson());return a}});w.prototype=c.prototype;x.prototype=new w;Object.defineProperty(x.prototype,"paths",{get:function(){this._unquantizeFn&&(this._pathsVal=this._unquantizeFn({paths:v.clone3DArray(this._pathsVal)}).paths,this._unquantizeFn=null);return this._pathsVal},set:function(a){this._pathsVal=a}});x.prototype.setupLazyUnquantization=function(a,b){this._unquantizeFn=a;this._pathsVal=b.paths};c.simpleConstructor=w;c.accessorConstructor=x;c.defaultProps=
n;a.setObject("geometry.Polyline",c,u);u.geometry.defaultPolyline=n;return c})},"esri/request":function(){define("require dojo/_base/array dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/_base/url dojo/_base/xhr ./core/request/script dojo/request/iframe dojo/dom-construct dojo/io-query ./kernel ./config ./sniff ./lang ./urlUtils ./deferredUtils".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d){function y(a){a=new v(a);return(a.host+(a.port?":"+a.port:"")).toLowerCase()}function k(a){return this._xhr?
this._xhr.getResponseHeader(a):null}function G(a,b){var e=p.objectToQuery(a.content);e&&(a.url+=(-1===a.url.indexOf("?")?"?":"\x26")+e);if(2E3<a.url.length){if("data:"!==a.url.toLowerCase().slice(0,5))return a=new n,a.reject(u.mixin(Error(),{message:"When using responseType 'image', URL length cannot exceed 2000 characters."})),a;if(3E6<a.url.length)return a=new n,a.reject(u.mixin(Error(),{message:"When using responseType 'image', data URL length cannot exceed 3000000 characters."})),a}var d=new Image;
b.allowImageDataAccess&&(d.crossOrigin=a.withCredentials?"use-credentials":"anonymous");var c=!1,k=new n(function(a){c=!0;d.onload=d.onerror=d.onabort=null;d.src=""});b=function(a){d.onload=d.onerror=d.onabort=null;c||k.reject(Error("Unable to load the resource"))};d.onload=function(){d.onload=d.onerror=d.onabort=null;c||k.resolve(this)};d.onerror=b;d.onabort=b;d.alt="";d.src=a.url;return k}function E(d,c,k,z){var y=!1,x=!1,D,H;m.isDefined(c)&&(u.isObject(c)?(y=!!c.useProxy,x=!!c.usePost,D=c.crossOrigin):
y=!!c);d=u.mixin({},d);d._ssl&&(d.url=d.url.replace(/^http:/i,"https:"));10>e("ie")&&!Q.test(d.url)&&(d.url=encodeURI(d.url));var C=d.content,E=d.url,J=k&&d.form,I=M;D=m.isDefined(D)?D:I.useCors;d.load=function(b){var e;b&&(b.error?(e=u.mixin(Error(),b.error),e.log=!!a.isDebug):"error"===b.status&&(e=u.mixin(Error(),b),e.log=!!a.isDebug),e&&(d.failOk=!e.log,m.isDefined(e.httpCode)||(e.httpCode=e.code)));return e||b};d.error=function(b,e){e&&e.xhr&&e.xhr.abort();b instanceof Error||(b=u.mixin(Error(),
b));b.log=!!a.isDebug;d.failOk=!b.log;I.errorHandler(b,e);return b};d._token&&(d.content=d.content||{},d.content.token=d._token);var L=0,v;C&&E&&(v=p.objectToQuery(C),L=v.length+E.length+1,e("esri-url-encodes-apostrophe")&&(L=v.replace(/'/g,"%27").length+E.length+1));d.timeout=m.isDefined(d.timeout)?d.timeout:I.timeout;d.handleAs=d.handleAs||"json";try{var F,O,T=D&&g.canUseXhr(d.url)&&!/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i.test(d.url),U=g.hasSameOrigin(d.url,window.location.href)||T,K=x||
k||L>I.postLength?!0:!1,qa=U||-1===d.handleAs.indexOf("json")||!d.callbackParamName||k?!1:!0,da=g.getProxyRule(d.url)||I.alwaysUseProxy||y||!("image"===d.handleAs&&!c.allowImageDataAccess||qa&&!K||U)?!0:!1;k&&!e("esri-file-upload")&&!da&&T&&(da=!0);if(da)if(F=g.getProxyUrl(E,D),O=F.path,F._xo&&(T=!0),!K&&O.length+1+L>I.postLength&&(K=!0),d.url=O+"?"+E,K)d.content=u.mixin(F.query||{},C);else{var Y=p.objectToQuery(u.mixin(F.query||{},C));Y&&(d.url+="?"+Y);d.content=null}if(!qa||K||da){var R=d.headers;
!T||R&&R.hasOwnProperty("X-Requested-With")||(R=d.headers=R||{},R["X-Requested-With"]=null);if(k){var V=d.callbackParamName||"callback.html",q=d.callbackElementName||"textarea",ba,ga,r,W,S=J.elements?J.elements.length:0,A;if(C=d.content)for(ba in C.token&&-1<E.toLowerCase().indexOf("/sharing/servers/")&&(E+=(-1===E.indexOf("?")?"?":"\x26")+"token\x3d"+C.token,d.url=da?O+"?"+E:E,delete C.token),C)if(r=C[ba],m.isDefined(r)){ga=null;for(W=0;W<S;W++)if(A=J.elements[W],A.name===ba){ga=A;break}ga?ga.value=
r:z?J.append(ba,r):J.appendChild(t.create("input",{type:"hidden",name:ba,value:r}))}if(e("esri-file-upload")){b.forEach(J.elements,function(a){a.name===V&&J.removeChild(a)});var ka=z?J:new FormData(J);if(11<=e("safari")&&"entries"in ka&&"delete"in ka){z=[];for(var pa=ka.entries(),sa=pa.next();!sa.done;){var ra=sa.value;ra[1]instanceof File&&""===ra[1].name&&z.push(ra[0]);sa=pa.next()}z.forEach(function(a){ka.delete(a)})}d.contentType=!1;d.postData=ka;delete d.form}else{J.enctype="multipart/form-data";
9>e("ie")&&(J.encoding="multipart/form-data");J.method="post";b.some(J.elements,function(a){return a.name===V})||J.appendChild(t.create("input",{type:"hidden",name:V,value:q}));if(-1!==E.toLowerCase().indexOf("addattachment")||-1!==E.toLowerCase().indexOf("updateattachment"))E+=(-1===E.indexOf("?")?"?":"\x26")+V+"\x3d"+q,d.url=da?O+"?"+E:E;delete d.content}}if(T&&!d.hasOwnProperty("withCredentials")&&"with-credentials"===M.useCors){var E=da?O:E,ma=g.canUseXhr(E,!0),P=-1<ma?M.corsEnabledServers[ma]:
null;if(P&&P.hasOwnProperty("withCredentials"))P.withCredentials&&(d.withCredentials=!0);else if(w.id){var xa=w.id.findServerInfo(E);xa&&xa.webTierAuth&&(d.withCredentials=!0)}}d=B?B(d):d;if("image"===d.handleAs)return G(d,c);if(K){if(k&&!e("esri-file-upload")){H=new n(function(){za.cancel()});var za=l.post(d.url,d).then(function(a){H.resolve(a)}).otherwise(function(a){H.reject(a)});H.addCallback(function(a){return d.load(a)});H.addErrback(function(a){return d.error(a)});return H}!da&&e("safari")&&
(d.url+=(-1===d.url.indexOf("?")?"?":"\x26")+"_ts\x3d"+(new Date).getTime()+N++);return h.post(d)}return h.get(d)}d=B?B(d):d;d.jsonp=d.callbackParamName;d.query=d.content;H=new n(function(){ya.cancel()});var ya=f.get(d.url,d).then(function(a){H.resolve(a)}).otherwise(function(a){H.reject(a)});H.addCallback(function(a){return d.load(a)});H.addErrback(function(a){return d.error(a)});return H}catch(ua){return H=new n,H.errback(d.error(ua)),H}}function C(b){var d=M.corsStatus,e=g.canUseXhr(b,!0);-1<e&&
M.corsEnabledServers.splice(e,1);var c=new n;c.reject({log:!!a.isDebug});d[y(b)]=c.promise;return e}function D(a){var b=M.corsStatus;try{var c=y(a);if(M.corsDetection&&M.useCors&&e("esri-cors")&&a&&-1!==a.toLowerCase().indexOf("/rest/services")&&!g.hasSameOrigin(a,window.location.href)&&!g.canUseXhr(a)){if(b[c]&&!b[c].isCanceled())return b[c];var k=new n(d._dfdCanceller);b[c]=k.promise;var f=h.get({url:a.substring(0,a.toLowerCase().indexOf("/rest/")+6)+"info",content:{f:"json"},failOk:!0,handleAs:"json",
headers:{"X-Requested-With":null},timeout:1E3*M.corsDetectionTimeout});k._pendingDfd=f;f.then(function(b){b?(g.canUseXhr(a)||M.corsEnabledServers.push(c),k.resolve()):k.reject()},function(a){k.reject(a)});return k.promise}}catch(X){}return O}function z(a){B=a}function J(d,f,B,z){function l(d){d._pendingDfd=E(B,z,I,H);if(!d._pendingDfd){d.ioArgs=d._pendingDfd&&d._pendingDfd.ioArgs;var e=Error("Deferred object is missing");e.log=!!a.isDebug;d.errback(e);d._pendingDfd=null;return d}d._pendingDfd.addCallback(function(b){if(!b)return b;
var e=d._pendingDfd&&d._pendingDfd.ioArgs&&d._pendingDfd.ioArgs.xhr;if(!e)return b;if(e=e.getResponseHeader("Content-Type"))if(e=e.toLowerCase(),-1===e.indexOf("text/plain")&&-1===e.indexOf("application/json"))return b;if(b instanceof ArrayBuffer&&750>=b.byteLength)e=new Blob([b]);else if(b instanceof Blob&&750>=b.size)e=b;else return b;var c=new n,k=new FileReader;k.readAsText(e);k.onloadend=function(){var d;if(!k.error)try{var e=JSON.parse(k.result);e.error&&(d=e.error)}catch(V){}d?(d=u.mixin(Error(),
d),d.log=!!a.isDebug,null==d.httpCode&&(d.httpCode=d.code),c.reject(d)):c.resolve(b)};return c.promise}).addCallback(function(a){d.ioArgs=d._pendingDfd&&d._pendingDfd.ioArgs;z.returnFullResponse&&(a={data:a,_xhr:d.ioArgs&&d.ioArgs.xhr,getHeader:k});d.callback(a);d._pendingDfd=null}).addErrback(function(a){var e,c,k;a&&(e=a.code,c=a.subcode,k=(k=a.messageCode)&&k.toUpperCase());if(a&&403==e&&(4==c||a.message&&-1<a.message.toLowerCase().indexOf("ssl")&&-1===a.message.toLowerCase().indexOf("permission"))){if(!B._ssl){B._ssl=
B._sslFromServer=!0;J(d,!0,B,z);return}}else if(a&&415==a.status){if(C(B.url),!B._err415){B._err415=1;J(d,!0,B,z);return}}else if(w.id&&-1!==b.indexOf(w.id._errorCodes,e)&&!w.id._isPublic(B.url)&&!t&&(403!=e||-1===b.indexOf(U,k)&&(!m.isDefined(c)||2==c&&B._token))){d._pendingDfd=w.id.getCredential(B.url,{token:B._token,error:a});d._pendingDfd.addCallback(function(a){B._token=a.token;B._credential=a;B._ssl=B._sslFromServer||a.ssl;J(d,!0,B,z)}).addErrback(function(a){d.errback(a);d._pendingDfd=null});
return}d.ioArgs=d._pendingDfd&&d._pendingDfd.ioArgs;d.isFulfilled()||d.errback(a);d._pendingDfd=null})}var p=B.form,t=z.disableIdentityLookup,x=z._preLookup,G=!1;if(e("esri-workers")&&!1!==M.useWorkers)if(!0===z.useWorkers||!0===M.useWorkers)G=!0;else if(z.workerOptions){var D=z.workerOptions;if(D.callback||D.worker&&D.worker.worker instanceof Worker)G=!0}var H=p&&e("esri-file-upload")&&p instanceof FormData,I=p&&(p.elements?b.some(p.elements,function(a){return"file"===a.type}):H),v=-1!==B.url.toLowerCase().indexOf("token\x3d")||
B.content&&B.content.token||I&&b.some(p.elements,function(a){return"token"===a.name})?1:0;if(!f){d.addCallback(function(a){if((/\/sharing\/rest\/accounts\/self/i.test(B.url)||/\/sharing\/rest\/portals\/self/i.test(B.url))&&!v&&!B._token&&a.user&&a.user.username){M.webTierAuthServers.push(y(B.url));a=M.corsEnabledServers;var b=g.canUseXhr(B.url,!0),d={host:y(B.url),withCredentials:!0};if(-1===b)a.push(d);else{var e=a[b];e instanceof RegExp?(d.host=e,a.splice(b,1,d)):"object"===typeof e?e.withCredentials=
!0:a.splice(b,1,d)}}if(a=B._credential)if(b=(b=w.id.findServerInfo(a.server))&&b.owningSystemUrl)b=b.replace(/\/?$/,"/sharing"),(a=w.id.findCredential(b,a.userId))&&-1===w.id._getIdenticalSvcIdx(b,a)&&a.resources.splice(0,0,b)});d.addBoth(function(a){delete B._credential;!a||e("ie")&&a.nodeType||(a._ssl=B._ssl)});var L=B.load,F=B.error;L&&d.addCallback(function(a){var b=d._pendingDfd,b=b&&b.ioArgs;return L.call(b&&b.args,a,b)});F&&d.addErrback(function(a){var b=d._pendingDfd,b=b&&b.ioArgs;return F.call(b&&
b.args,a,b)})}!w.id||v||B._token||w.id._isPublic(B.url)||t&&!x||!(f=w.id.findCredential(B.url))||(B._token=f.token,B._ssl=f.ssl);G?z.workerOptions&&z.workerOptions.worker?(T||(T=h),h=z.workerOptions.worker,l(d)):c(["./workers/RequestClient"],function(a){T||(T=h);if(z.workerOptions){var b=z.workerOptions;h=a.getClient(b.callback,b.cbFunction)}else h=a.getClient();l(d)}):(T&&(h=T,T=null),l(d));return d}function F(a,b){a.url=g.fixUrl(a.url);b=b||{};var e=new n(d._dfdCanceller),c=D(a.url);e._pendingDfd=
c;c.always(function(d){d&&"cancel"===d.dojoType?e.reject(d):J(e,!1,a,b)});return e}var T=null,B,M=x.defaults.io,U=["COM_0056","COM_0057"],N=0,Q=/%[0-9A-F]{2}/i,O=function(){var a=new n;a.resolve();return a.promise}();F._makeRequest=E;F._processRequest=J;F._disableCors=C;F._detectCors=D;F.setRequestPreCallback=z;w.request=F;w._makeRequest=E;w._processRequest=J;w._disableCors=C;w._detectCors=D;w.setRequestPreCallback=z;return F})},"esri/core/request/script":function(){define("require exports dojo/Deferred dojo/request/script dojo/text!./iframe.html ../sniff".split(" "),
function(c,b,a,n,u,v){function h(){var a=document.createElement("iframe");a.name="esri_core_jsonp_iframe";a.style.display="none";a.setAttribute("sandbox","allow-scripts");if(!v("ff")&&"srcdoc"in a){var b=c.toUrl("dojo/dojo.js"),e=u.replace("../../../dojo/dojo.js",b),b=b.slice(0,-7),e=e.replace("../../../dojo/",b);a.srcdoc=e}else e=c.toUrl("./iframe.html"),"http:"===window.location.protocol&&0===e.indexOf("https:")&&(e=e.replace("https:","http:")),a.src=e;document.body.appendChild(a);return a}function f(){var a=
new MessageChannel;a.port1.addEventListener("message",l);a.port1.start();return a}function l(a){var b=a.data;if("ready"===b){for(var b=0,d=m;b<d.length;b++)a=d[b],p(a,x);m=null}else if(a=g[b.id])delete g[b.id],b.isError?a.dfd.reject(Error(b.message)):a.dfd.resolve(b.response)}function t(a,b){a.addEventListener("load",function(){a.contentWindow.postMessage("init","*",[b.port2])})}function p(a,b){g[a.message.id]=a;b.port1.postMessage(a.message)}Object.defineProperty(b,"__esModule",{value:!0});var w,
x,e=0,m=[],g={};b.get=function(b,c){if(!v("esri-script-sandbox"))return n.get(b,c);var d=null;c&&(d={jsonp:c.jsonp,preventCache:c.preventCache,query:c.query,timeout:c.timeout});c=new a(function(){if(m){var a=m.indexOf(l);-1<a&&m.splice(a,1)}else l.message.id in g&&delete g[l.message.id]});var l={dfd:c,message:{id:"id"+(++e+Math.random()),url:b,options:d}};w||(w=h(),x=f(),t(w,x));m?m.push(l):p(l,x);return c.promise}})},"dojo/request/script":function(){define("module ./watch ./util ../_base/kernel ../_base/array ../_base/lang ../on ../dom ../dom-construct ../has ../_base/window".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p){function w(a,b){a.canDelete&&d._remove(a.id,b.options.frameDoc,!0)}function x(a){D&&D.length&&(u.forEach(D,function(a){d._remove(a.id,a.frameDoc);a.frameDoc=null}),D=[]);return a.options.jsonp?!a.data:!0}function e(a){return!!this.scriptLoaded}function m(a){return(a=a.options.checkString)&&eval("typeof("+a+') !\x3d\x3d "undefined"')}function g(a,b){if(this.canDelete){var d=this.response.options;D.push({id:this.id,frameDoc:d.ioArgs?d.ioArgs.frameDoc:d.frameDoc});d.ioArgs&&
(d.ioArgs.frameDoc=null);d.frameDoc=null}b?this.reject(b):this.resolve(a)}function d(c,f,l){var z=a.parseArgs(c,a.deepCopy({},f));c=z.url;f=z.options;var B=a.deferred(z,w,x,f.jsonp?null:f.checkString?m:e,g);v.mixin(B,{id:y+k++,canDelete:!1});f.jsonp&&((new RegExp("[?\x26]"+f.jsonp+"\x3d")).test(c)||(c+=(~c.indexOf("?")?"\x26":"?")+f.jsonp+"\x3d"+(f.frameDoc?"parent.":"")+y+"_callbacks."+B.id),B.canDelete=!0,C[B.id]=function(a){z.data=a;B.handleResponse(z)});a.notify&&a.notify.emit("send",z,B.promise.cancel);
if(!f.canAttach||f.canAttach(B)){var p=d._attach(B.id,c,f.frameDoc,function(a){if(!(a instanceof Error)){var b=Error("Error loading "+(a.target?a.target.src:"script"));b.source=a;a=b}B.reject(a);d._remove(B.id,f.frameDoc,!0)});if(!f.jsonp&&!f.checkString)var t=h(p,G,function(a){if("load"===a.type||E.test(p.readyState))t.remove(),B.scriptLoaded=a})}b(B);return l?B:B.promise}t.add("script-readystatechange",function(a,b){return"undefined"!==typeof b.createElement("script").onreadystatechange&&("undefined"===
typeof a.opera||"[object Opera]"!==a.opera.toString())});var y=c.id.replace(/[\/\.\-]/g,"_"),k=0,G=t("script-readystatechange")?"readystatechange":"load",E=/complete|loaded/,C=n.global[y+"_callbacks"]={},D=[];d.get=d;d._attach=function(a,b,d,e){d=d||p.doc;var c=d.createElement("script");if(e)h.once(c,"error",e);c.type="text/javascript";try{c.src=b}catch(M){e&&e(c)}c.id=a;c.async=!0;c.charset="utf-8";return d.getElementsByTagName("head")[0].appendChild(c)};d._remove=function(a,b,d){l.destroy(f.byId(a,
b));C[a]&&(d?C[a]=function(){delete C[a]}:delete C[a])};d._callbacksProperty=y+"_callbacks";return d})},"esri/core/sniff":function(){define(["../sniff"],function(c){return c})},"dojo/request/iframe":function(){define("module require ./watch ./util ./handlers ../_base/lang ../io-query ../query ../has ../dom ../dom-construct ../_base/window ../NodeList-dom ../NodeList-manipulate".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w){function x(a){return!this.isFulfilled()}function e(a){return!!this._finished}
function m(a,b){if(!b)try{var e=a.options,c=d.doc(d._frame),k=e.handleAs;if("html"!==k){if("xml"===k)if("html"===c.documentElement.tagName.toLowerCase()){f("a",c.documentElement).orphan();var g=c.documentElement.innerText||c.documentElement.textContent,g=g.replace(/>\s+</g,"\x3e\x3c");a.text=v.trim(g)}else a.data=c;else a.text=c.getElementsByTagName("textarea")[0].value;u(a)}else a.data=c}catch(T){b=T}b?this.reject(b):this._finished?this.resolve(a):this.reject(Error("Invalid dojo/request/iframe request state"))}
function g(a){this._callNext()}function d(b,c,f){var h=n.parseArgs(b,n.deepCreate(G,c),!0);b=h.url;c=h.options;if("GET"!==c.method&&"POST"!==c.method)throw Error(c.method+" not supported by dojo/request/iframe");d._frame||(d._frame=d.create(d._iframeName,k+"();"));b=n.deferred(h,null,x,e,m,g);b._callNext=function(){this._calledNext||(this._calledNext=!0,d._currentDfd=null,d._fireNextRequest())};b._legacy=f;d._dfdQueue.push(b);d._fireNextRequest();a(b);return f?b:b.promise}var y=c.id.replace(/[\/\.\-]/g,
"_"),k=y+"_onload";w.global[k]||(w.global[k]=function(){var a=d._currentDfd;if(a){var b=t.byId(a.response.options.form)||a._tmpForm;if(b){for(var e=a._contentToClean,c=0;c<e.length;c++)for(var k=e[c],g=0;g<b.childNodes.length;g++){var f=b.childNodes[g];if(f.name===k){p.destroy(f);break}}a._originalAction&&b.setAttribute("action",a._originalAction);a._originalMethod&&(b.setAttribute("method",a._originalMethod),b.method=a._originalMethod);a._originalTarget&&(b.setAttribute("target",a._originalTarget),
b.target=a._originalTarget)}a._tmpForm&&(p.destroy(a._tmpForm),delete a._tmpForm);a._finished=!0}else d._fireNextRequest()});var G={method:"POST"};d.create=function(a,d,e){if(w.global[a])return w.global[a];if(w.global.frames[a])return w.global.frames[a];e||(l("config-useXDomain")&&l("config-dojoBlankHtmlUrl"),e=l("config-dojoBlankHtmlUrl")||b.toUrl("dojo/resources/blank.html"));d=p.place('\x3ciframe id\x3d"'+a+'" name\x3d"'+a+'" src\x3d"'+e+'" onload\x3d"'+d+'" style\x3d"position: absolute; left: 1px; top: 1px; height: 1px; width: 1px; visibility: hidden"\x3e',
w.body());return w.global[a]=d};d.doc=function(a){if(a.contentDocument)return a.contentDocument;var b=a.name;if(b){var d=w.doc.getElementsByTagName("iframe");if(a.document&&d[b].contentWindow&&d[b].contentWindow.document)return d[b].contentWindow.document;if(w.doc.frames[b]&&w.doc.frames[b].document)return w.doc.frames[b].document}return null};d.setSrc=function(a,b,d){a=w.global.frames[a.name];a.contentWindow&&(a=a.contentWindow);try{d?a.location.replace(b):a.location=b}catch(z){}};d._iframeName=
y+"_IoIframe";d._notifyStart=function(){};d._dfdQueue=[];d._currentDfd=null;d._fireNextRequest=function(){var a;try{if(!d._currentDfd&&d._dfdQueue.length){do a=d._currentDfd=d._dfdQueue.shift();while(a&&(a.canceled||a.isCanceled&&a.isCanceled())&&d._dfdQueue.length);if(!a||a.canceled||a.isCanceled&&a.isCanceled())d._currentDfd=null;else{var b=a.response,e=b.options,c=a._contentToClean=[],k=t.byId(e.form),g=n.notify,m=e.data||null,B;a._legacy||"POST"!==e.method||k?"GET"===e.method&&k&&-1<b.url.indexOf("?")&&
(B=b.url.slice(b.url.indexOf("?")+1),m=v.mixin(h.queryToObject(B),m)):k=a._tmpForm=p.create("form",{name:y+"_form",style:{position:"absolute",top:"-1000px",left:"-1000px"}},w.body());if(k){if(!a._legacy){var l=k;do l=l.parentNode;while(l&&l!==w.doc.documentElement);l||(k.style.position="absolute",k.style.left="-1000px",k.style.top="-1000px",w.body().appendChild(k));k.name||(k.name=y+"_form")}if(m){var l=function(a,b){p.create("input",{type:"hidden",name:a,value:b},k);c.push(a)},x;for(x in m){var G=
m[x];if(v.isArray(G)&&1<G.length)for(B=0;B<G.length;B++)l(x,G[B]);else{var u=f("input[name\x3d'"+x+"']",k);-1==u.indexOf()?l(x,G):u.val(G)}}}var O=k.getAttributeNode("action"),K=k.getAttributeNode("method"),I=k.getAttributeNode("target");b.url&&(a._originalAction=O?O.value:null,O?O.value=b.url:k.setAttribute("action",b.url));a._legacy?K&&K.value||(K?K.value=e.method:k.setAttribute("method",e.method)):(a._originalMethod=K?K.value:null,K?K.value=e.method:k.setAttribute("method",e.method));a._originalTarget=
I?I.value:null;I?I.value=d._iframeName:k.setAttribute("target",d._iframeName);k.target=d._iframeName;g&&g.emit("send",b,a.promise.cancel);d._notifyStart(b);k.submit()}else e="",b.options.data&&(e=b.options.data,"string"!==typeof e&&(e=h.objectToQuery(e))),l=b.url+(-1<b.url.indexOf("?")?"\x26":"?")+e,g&&g.emit("send",b,a.promise.cancel),d._notifyStart(b),d.setSrc(d._frame,l,!0)}}}catch(H){a.reject(H)}};n.addCommonMethods(d,["GET","POST"]);return d})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),
function(c,b,a,n,u){function v(a){for(;a.childNodes[0]&&1==a.childNodes[0].nodeType;)a=a.childNodes[0];return a}function h(a,b){"string"==typeof a?(a=n.toDom(a,b&&b.ownerDocument),11==a.nodeType&&(a=a.childNodes[0])):1==a.nodeType&&a.parentNode&&(a=a.cloneNode(!1));return a}var f=c.NodeList;b.extend(f,{_placeMultiple:function(a,b){a="string"==typeof a||a.nodeType?c(a):a;for(var f=[],h=0;h<a.length;h++)for(var l=a[h],e=this.length,m=e-1,g;g=this[m];m--)0<h&&(g=this._cloneNode(g),f.unshift(g)),m==e-
1?n.place(g,l,b):l.parentNode.insertBefore(g,l),l=g;f.length&&(f.unshift(0),f.unshift(this.length-1),Array.prototype.splice.apply(this,f));return this},innerHTML:function(a){return arguments.length?this.addContent(a,"only"):this[0].innerHTML},text:function(a){if(arguments.length){for(var b=0,c;c=this[b];b++)1==c.nodeType&&u.set(c,"textContent",a);return this}for(var f="",b=0;c=this[b];b++)f+=u.get(c,"textContent");return f},val:function(c){if(arguments.length){for(var f=b.isArray(c),h=0,l;l=this[h];h++){var x=
l.nodeName.toUpperCase(),e=l.type,m=f?c[h]:c;if("SELECT"==x)for(x=l.options,e=0;e<x.length;e++){var g=x[e];g.selected=l.multiple?-1!=a.indexOf(c,g.value):g.value==m}else"checkbox"==e||"radio"==e?l.checked=l.value==m:l.value=m}return this}if((l=this[0])&&1==l.nodeType){c=l.value||"";if("SELECT"==l.nodeName.toUpperCase()&&l.multiple){c=[];x=l.options;for(e=0;e<x.length;e++)g=x[e],g.selected&&c.push(g.value);c.length||(c=null)}return c}},append:function(a){return this.addContent(a,"last")},appendTo:function(a){return this._placeMultiple(a,
"last")},prepend:function(a){return this.addContent(a,"first")},prependTo:function(a){return this._placeMultiple(a,"first")},after:function(a){return this.addContent(a,"after")},insertAfter:function(a){return this._placeMultiple(a,"after")},before:function(a){return this.addContent(a,"before")},insertBefore:function(a){return this._placeMultiple(a,"before")},remove:f.prototype.orphan,wrap:function(a){if(this[0]){a=h(a,this[0]);for(var b=0,c;c=this[b];b++){var f=this._cloneNode(a);c.parentNode&&c.parentNode.replaceChild(f,
c);v(f).appendChild(c)}}return this},wrapAll:function(a){if(this[0]){a=h(a,this[0]);this[0].parentNode.replaceChild(a,this[0]);a=v(a);for(var b=0,c;c=this[b];b++)a.appendChild(c)}return this},wrapInner:function(a){if(this[0]){a=h(a,this[0]);for(var c=0;c<this.length;c++){var f=this._cloneNode(a);this._wrap(b._toArray(this[c].childNodes),null,this._NodeListCtor).wrapAll(f)}}return this},replaceWith:function(a){a=this._normalize(a,this[0]);for(var b=0,c;c=this[b];b++)this._place(a,c,"before",0<b),c.parentNode.removeChild(c);
return this},replaceAll:function(a){a=c(a);for(var b=this._normalize(this,this[0]),f=0,h;h=a[f];f++)this._place(b,h,"before",0<f),h.parentNode.removeChild(h);return this},clone:function(){for(var a=[],b=0;b<this.length;b++)a.push(this._cloneNode(this[b]));return this._wrap(a,this,this._NodeListCtor)}});f.prototype.html||(f.prototype.html=f.prototype.innerHTML);return f})},"esri/domUtils":function(){define(["./kernel","dojo/_base/connect","dojo/_base/lang","dojo/dom-style","dojo/has"],function(c,b,
a,n,u){var v={show:function(a){if(a=v.getNode(a))a.style.display="block"},getNode:function(a){return a&&a.domNode||a},hide:function(a){if(a=v.getNode(a))a.style.display="none"},toggle:function(a){if(a=v.getNode(a))a.style.display="none"===a.style.display?"block":"none"},documentBox:8>=u("ie")?{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}:{w:window.innerWidth,h:window.innerHeight},setScrollable:function(a){if(a=this.getNode(a)){var c=0,h=0,t=0,p=0,w=0,x=0;return[b.connect(a,
"ontouchstart",function(b){c=b.touches[0].screenX;h=b.touches[0].screenY;t=a.scrollWidth;p=a.scrollHeight;w=a.clientWidth;x=a.clientHeight}),b.connect(a,"ontouchmove",function(b){b.preventDefault();var e=a.firstChild;e instanceof Text&&(e=a.childNodes[1]);var g=e._currentX||0,d=e._currentY||0,g=g+(b.touches[0].screenX-c);0<g?g=0:0>g&&Math.abs(g)+w>t&&(g=-1*(t-w));e._currentX=g;d+=b.touches[0].screenY-h;0<d?d=0:0>d&&Math.abs(d)+x>p&&(d=-1*(p-x));e._currentY=d;n.set(e,{"-webkit-transition-property":"-webkit-transform",
"-webkit-transform":"translate("+g+"px, "+d+"px)"});c=b.touches[0].screenX;h=b.touches[0].screenY})]}}};a.mixin(c,v);return v})},"esri/geometry/normalizeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/has ../kernel ../config ../deferredUtils ./Extent ./Polyline ./Polygon ./webMercatorUtils ./jsonUtils".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w){function x(a,b){return Math.ceil((a-b)/(2*b))}function e(a,b){var d=a.paths||a.rings,e,c,k=d.length,g;for(e=0;e<k;e++)for(g=
d[e].length,c=0;c<g;c++){var f=a.getPoint(e,c);a.setPoint(e,c,f.offset(b,0))}return a}function m(a,b){if(!(a instanceof l||a instanceof t))throw Error("_straightLineDensify: the input geometry is neither polyline nor polygon");var d=a instanceof l,e=[],k;c.forEach(d?a.paths:a.rings,function(a){e.push(k=[]);k.push([a[0][0],a[0][1]]);var d,c,g,f,m,B,h,z,y,l,p,t;for(m=0;m<a.length-1;m++){d=a[m][0];c=a[m][1];g=a[m+1][0];f=a[m+1][1];h=Math.sqrt((g-d)*(g-d)+(f-c)*(f-c));z=(f-c)/h;y=(g-d)/h;l=h/b;if(1<l){for(B=
1;B<=l-1;B++)t=B*b,p=y*t+d,t=z*t+c,k.push([p,t]);B=(h+Math.floor(l-1)*b)/2;p=y*B+d;t=z*B+c;k.push([p,t])}k.push([g,f])}});return d?new l({paths:e,spatialReference:a.spatialReference}):new t({rings:e,spatialReference:a.spatialReference})}function g(a,b,d){b&&(a=m(a,1E6),a=p.webMercatorToGeographic(a,!0));d&&(a=e(a,d));return a}function d(a,b,d){var e=a.x||a[0],c;e>b?(c=x(e,b),a.x?a=a.offset(-2*c*b,0):a[0]=e+-2*c*b):e<d&&(c=x(e,d),a.x?a=a.offset(-2*c*d,0):a[0]=e+-2*c*d);return a}function y(a,b){var d=
-1;c.forEach(b.cutIndexes,function(e,k){var g=b.geometries[k];c.forEach(g.rings||g.paths,function(a,b){c.some(a,function(d){if(!(180>d[0])){d=0;var e,c=a.length,k;for(e=0;e<c;e++)k=a[e][0],d=k>d?k:d;d=Number(d.toFixed(9));d=-360*x(d,180);c=a.length;for(e=0;e<c;e++)k=g.getPoint(b,e),g.setPoint(b,e,k.offset(d,0))}return!0})});e===d?g.rings?c.forEach(g.rings,function(b){a[e]=a[e].addRing(b)}):c.forEach(g.paths,function(b){a[e]=a[e].addPath(b)}):(d=e,a[e]=g)});return a}function k(b,k,f,m){var B=new a;
B.addCallbacks(f,m);k=k||v.defaults.geometryService;var h=[],z=[],G,n,D,C,u,H,E,J,F=0;c.forEach(b,function(a){if(a)if(G||(G=a.spatialReference,n=G._getInfo(),C=(D=G._isWebMercator())?2.0037508342788905E7:180,u=D?-2.0037508342788905E7:-180,H=D?102100:4326,E=new l({paths:[[[C,u],[C,C]]],spatialReference:{wkid:H}}),J=new l({paths:[[[u,u],[u,C]]],spatialReference:{wkid:H}})),n){var b=w.fromJson(a.toJson()),k=a.getExtent();"point"===a.type?h.push(d(b,C,u)):"multipoint"===a.type?(b.points=c.map(b.points,
function(a){return d(a,C,u)}),h.push(b)):"extent"===a.type?(b=k._normalize(null,null,n),h.push(b.rings?new t(b):b)):k?(a=2*x(k.xmin,u)*C,b=0===a?b:e(b,a),k=k.offset(a,0),k.intersects(E)&&k.xmax!==C?(F=k.xmax>F?k.xmax:F,b=g(b,D),z.push(b),h.push("cut")):k.intersects(J)&&k.xmin!==u?(F=2*k.xmax*C>F?2*k.xmax*C:F,b=g(b,D,360),z.push(b),h.push("cut")):h.push(b)):h.push(b)}else h.push(a);else h.push(a)});f=new l;m=x(F,C);for(var oa=-90,T=m;0<m;){var aa=-180+360*m;f.addPath([[aa,oa],[aa,-1*oa]]);oa*=-1;m--}0<
z.length&&0<T?k?k.cut(z,f,function(a){z=y(z,a);var d=[];c.forEach(h,function(a,e){"cut"===a&&(a=z.shift(),b[e].rings&&1<b[e].rings.length&&a.rings.length>=b[e].rings.length?(h[e]="simplify",d.push(a)):h[e]=!0===D?p.geographicToWebMercator(a):a)});0<d.length?k.simplify(d,function(a){c.forEach(h,function(b,d){"simplify"===b&&(h[d]=!0===D?p.geographicToWebMercator(a.shift()):a.shift())});B.callback(h)},function(a){B.errback(a)}):B.callback(h)},function(a){B.errback(a)}):B.errback(Error("esri.geometry.normalizeCentralMeridian: 'geometryService' argument is missing.")):
(c.forEach(h,function(a,b){"cut"===a&&(a=z.shift(),h[b]=!0===D?p.geographicToWebMercator(a):a)}),B.callback(h));return B}function G(a,d,e,k){var g=!1,f;b.isObject(a)&&a&&(b.isArray(a)?a.length&&((f=a[0]&&a[0].declaredClass)&&-1!==f.indexOf("Graphic")?(a=c.map(a,function(a){return a.geometry}),g=a.length?!0:!1):f&&-1!==f.indexOf("esri.geometry.")&&(g=!0)):(f=a.declaredClass)&&-1!==f.indexOf("FeatureSet")?(a=c.map(a.features||[],function(a){return a.geometry}),g=a.length?!0:!1):f&&-1!==f.indexOf("esri.geometry.")&&
(g=!0));g&&d.push({index:e,property:k,value:a})}function E(a,d){var e=[];c.forEach(d,function(d){var k=d.i,g=a[k];d=d.p;var f;if(b.isObject(g)&&g)if(d)if("*"===d[0])for(f in g)g.hasOwnProperty(f)&&G(g[f],e,k,f);else c.forEach(d,function(a){G(b.getObject(a,!1,g),e,k,a)});else G(g,e,k)});return e}function C(a,d){var e=0,k={};c.forEach(d,function(d){var c=d.index,g=d.property,f=d.value,m=f.length||1,h=a.slice(e,e+m);b.isArray(f)||(h=h[0]);e+=m;delete d.value;g?(k[c]=k[c]||{},k[c][g]=h):k[c]=h});return k}
function D(a){for(var b=[],d=0,e=0,c=Math.min,k=Math.max,g=0;g<a.length;g++){for(var f=a[g],m=null,h=0;h<f.length;h++)m=f[h],b.push(m),0===h?e=d=m[0]:(d=c(d,m[0]),e=k(e,m[0]));m&&b.push([(d+e)/2,0])}return b}n={normalizeCentralMeridian:k,_foldCutResults:y,_prepareGeometryForCut:g,_offsetMagnitude:x,_pointNormalization:d,_updatePolyGeometry:e,_straightLineDensify:m,_createWrappers:function(d){var e=b.isObject(d)?d.prototype:b.getObject(d+".prototype");c.forEach(e.__msigns,function(b){var d=e[b.n];
e[b.n]=function(){var e=this,g=[],f,m=new a(h._dfdCanceller);b.f&&h._fixDfd(m);for(f=0;f<b.c;f++)g[f]=arguments[f];var y={dfd:m};g.push(y);var l,p=[],z;e.normalization&&!e._isTable&&(l=E(g,b.a),c.forEach(l,function(a){p=p.concat(a.value)}),p.length&&(z=k(p)));z?(m._pendingDfd=z,z.addCallbacks(function(a){m.canceled||(y.assembly=C(a,l),m._pendingDfd=d.apply(e,g))},function(a){var d=e.declaredClass;d&&-1!==d.indexOf("FeatureLayer")?e._resolve([a],null,g[b.e],m,!0):e._errorHandler(a,g[b.e],m)})):m._pendingDfd=
d.apply(e,g);return m}})},_disassemble:E,_addToBucket:G,_reassemble:C,getDenormalizedExtent:function(a){if(!a)return null;var b=a.getExtent();if(!b)return null;var d=a.spatialReference&&a.spatialReference._getInfo();if(!d)return b;var e=d.valid[0],d=d.valid[1],c=2*d,k=b.getWidth(),g=b.xmax,m=b.xmin;if("extent"===a.type||0===k||k<=d||k>c||g<e||m>d)return b;var h;switch(a.type){case "polygon":if(1<a.rings.length)h=D(a.rings);else return b;break;case "polyline":if(1<a.paths.length)h=D(a.paths);else return b;
break;case "multipoint":h=a.points}a=Math.min;for(var e=Math.max,c=new f(b.toJson()),y=0;y<h.length;y++){var l=h[y][0];0>l?(l+=d,m=e(l,m)):(l-=d,g=a(l,g))}c.xmin=g;c.xmax=m;return c.getWidth()<k?(c.xmin-=d,c.xmax-=d,c):b}};b.mixin(b.getObject("geometry",!0,u),n);return n})},"esri/geometry/jsonUtils":function(){define("dojo/_base/lang dojo/has ../kernel ../lang ./Point ./Polyline ./Polygon ./Multipoint ./Extent".split(" "),function(c,b,a,n,u,v,h,f,l){function t(a,b,c){var d=a.rings||a.paths,e,k,g,
f,m,h,l,p;e=0;for(k=d.length;e<k;e++)for(m=d[e],g=0,f=m.length;g<f;g++)h=m[g],0<g?(l+=h[0],p+=h[1]):(l=h[0],p=h[1]),h[0]=b(l),h[1]=c(p);return a}var p={esriGeometryPoint:function(a,b,c){a.x=b(a.x);a.y=c(a.y);return a},esriGeometryPolyline:t,esriGeometryPolygon:t,esriGeometryEnvelope:function(a,b,c){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax);return a},esriGeometryMultipoint:function(a,b,c){var d=a.points,e,k,g,f,m;e=0;for(k=d.length;e<k;e++)g=d[e],0<e?(f+=g[0],m+=g[1]):(f=
g[0],m=g[1]),g[0]=b(f),g[1]=c(m);return a}},w={esriGeometryPoint:function(a,b,c){a.x=b(a.x);a.y=c(a.y);return a}},x={createInstance:function(a,b){a=new a;b&&n.mixin(a,b);return a},fromJson:function(a){if(void 0!==a.x&&void 0!==a.y)return new u(a);if(void 0!==a.paths)return new v(a);if(void 0!==a.rings)return new h(a);if(void 0!==a.points)return new f(a);if(void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax)return new l(a)},getJsonType:function(a){return a instanceof u?"esriGeometryPoint":
a instanceof v?"esriGeometryPolyline":a instanceof h?"esriGeometryPolygon":a instanceof l?"esriGeometryEnvelope":a instanceof f?"esriGeometryMultipoint":null},getGeometryType:function(a){return"esriGeometryPoint"===a?u:"esriGeometryPolyline"===a?v:"esriGeometryPolygon"===a?h:"esriGeometryEnvelope"===a?l:"esriGeometryMultipoint"===a?f:null},supportsLazyUnquantization:function(a){return"esriGeometryPoint"===a||"esriGeometryPolyline"===a||"esriGeometryPolygon"===a||"esriGeometryMultipoint"===a},unquantizeFunction:function(a,
b){if(a&&b){var e=b.translate[0],d=b.translate[1],c=b.scale[0],k=b.scale[1],f=function(a){return a*c+e},m=function(a){return d-a*k},h=p[a];return function(a){return a?h(a,f,m):null}}},unquantize:function(a,b,c){if(b=x.unquantizeFunction(b,c)){var d=a.length;for(c=0;c<d;c++)b(a[c].geometry)}},quantizeFunction:function(a,b){if(a&&"esriGeometryPoint"===a&&b){var e=b.translate[0],d=b.translate[1],c=b.scale[0],k=b.scale[1],f=function(a){return Math.round((a-e)/c)},m=function(a){return Math.round((d-a)/
k)},h=w[a];return function(a){return a?h(a,f,m):null}}},quantize:function(a,b,c){if(b=x.quantizeFunction(b,c)){var d=a.length;for(c=0;c<d;c++)b(a[c].geometry)}}};c.mixin(c.getObject("geometry",!0,a),x);return x})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(c,b,a){c.DeferredList=function(c,u,v,h,f){var l=[];b.call(this);var t=this;0!==c.length||u||this.resolve([0,[]]);var p=0;a.forEach(c,function(a,b){function e(a,e){l[b]=[a,e];p++;p===c.length&&
t.resolve(l)}a.then(function(a){u?t.resolve([b,a]):e(!0,a)},function(a){v?t.reject(a):e(!1,a);if(h)return null;throw a;})})};c.DeferredList.prototype=new b;c.DeferredList.prototype.gatherResults=function(b){b=new c.DeferredList(b,!1,!0,!1);b.addCallback(function(b){var c=[];a.forEach(b,function(a){c.push(a[1])});return c});return b};return c.DeferredList})},"esri/graphicsUtils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","./kernel","./geometry/Extent"],function(c,b,a,n,u){a=
{graphicsExtent:function(a){if(!a||!a.length)return null;var b=a[0].geometry,c=b.getExtent(),l,t,p=a.length;null===c&&(c=new u(b.x,b.y,b.x,b.y,b.spatialReference));for(t=1;t<p;t++)l=(b=a[t].geometry).getExtent(),null===l&&(l=new u(b.x,b.y,b.x,b.y,b.spatialReference)),c=c.union(l);return 0>c.getWidth()&&0>c.getHeight()?null:c},getGeometries:function(a){return b.map(a,function(a){return a.geometry})},_encodeGraphics:function(a,c){var f=[],h,t,p;b.forEach(a,function(a,b){h=a.toJson();t={};h.geometry&&
(p=c&&c[b],t.geometry=p&&p.toJson()||h.geometry);h.attributes&&(t.attributes=h.attributes);f[b]=t});return f}};c.mixin(n,a);return a})},"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(c,b,a,n){var u=c.some;return function(c){var h,f;b.isArray(c)?f=c:c&&"object"===typeof c&&(h=c);var l,t=[];if(h){f=[];for(var p in h)Object.hasOwnProperty.call(h,p)&&(t.push(p),f.push(h[p]));l={}}else f&&(l=[]);if(!f||!f.length)return(new a).resolve(l);var w=new a;
w.promise.always(function(){l=t=null});var x=f.length;u(f,function(a,b){h||t.push(b);n(a,function(a){w.isFulfilled()||(l[t[b]]=a,0===--x&&w.resolve(l))},w.reject);return w.isFulfilled()});return w.promise}})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(c,b,a,n,u,v,h){v.extend(c,{waiRole:"",waiState:""});return u("dijit._Templated",[b,a],{constructor:function(){h.deprecated(this.declaredClass+
": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(a,b){var c=this.inherited(arguments),f=b(a,"waiRole");f&&a.setAttribute("role",f);(f=b(a,"waiState"))&&n.forEach(f.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),a.setAttribute("aria-"+b[0],b[1]))});return c}})})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],
function(c,b,a,n,u){return a("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var a=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);u.parse(a,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(n.hitch(this,
function(a){this._startupWidgets=a;for(var b=0;b<a.length;b++)this._processTemplateNode(a[b],function(a,b){return a[b]},function(a,b,c){return b in a?a.connect(a,b,c):a.on(b,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(a,b,c){return b(a,"dojoType")||b(a,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){c.forEach(this._startupWidgets,function(a){a&&!a._started&&a.startup&&a.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(c,
b,a,n,u,v,h,f,l,t,p,w,x,e,m,g){function d(a){return eval("("+a+")")}function y(a){var b=a._nameCaseMap,d=a.prototype;if(!b||b._extendCnt<G){var b=a._nameCaseMap={},e;for(e in d)"_"!==e.charAt(0)&&(b[e.toLowerCase()]=e);b._extendCnt=G}return b}function k(b,d){d||(d=c);var e=d._dojoParserCtorMap||(d._dojoParserCtorMap={}),k=b.join();if(!e[k]){for(var g=[],f=0,m=b.length;f<m;f++){var h=b[f];g[g.length]=e[h]=e[h]||a.getObject(h)||~h.indexOf("/")&&d(h)}b=g.shift();e[k]=g.length?b.createSubclass?b.createSubclass(g):
b.extend.apply(b,g):b}return e[k]}new Date("X");var G=0;l.after(a,"extend",function(){G++},!0);var E={_clearCache:function(){G++;_ctorMap={}},_functionFromScript:function(a,b){var d="",e="",c=a.getAttribute(b+"args")||a.getAttribute("args");b=a.getAttribute("with");c=(c||"").split(/\s*,\s*/);b&&b.length&&n.forEach(b.split(/\s*,\s*/),function(a){d+="with("+a+"){";e+="}"});return new Function(c,d+a.innerHTML+e)},instantiate:function(a,d,e){d=d||{};e=e||{};var c=(e.scope||b._scopeName)+"Type",k="data-"+
(e.scope||b._scopeName)+"-",g=k+"type",f=k+"mixins",m=[];n.forEach(a,function(a){var b=c in d?d[c]:a.getAttribute(g)||a.getAttribute(c);if(b){var e=a.getAttribute(f),b=e?[b].concat(e.split(/\s*,\s*/)):[b];m.push({node:a,types:b})}});return this._instantiate(m,d,e)},_instantiate:function(a,b,d,e){function c(a){b._started||d.noStart||n.forEach(a,function(a){"function"!==typeof a.startup||a._started||a.startup()});return a}a=n.map(a,function(a){var e=a.ctor||k(a.types,d.contextRequire);if(!e)throw Error("Unable to resolve constructor for: '"+
a.types.join()+"'");return this.construct(e,a.node,b,d,a.scripts,a.inherited)},this);return e?t(a).then(c):c(a)},construct:function(c,k,g,h,t,G){function B(b){H&&a.setObject(H,b);for(C=0;C<F.length;C++)l[F[C].advice||"after"](b,F[C].method,a.hitch(b,F[C].func),!0);for(C=0;C<T.length;C++)T[C].call(b);for(C=0;C<aa.length;C++)b.watch(aa[C].prop,aa[C].func);for(C=0;C<ca.length;C++)m(b,ca[C].event,ca[C].func);return b}var z=c&&c.prototype;h=h||{};var w={};h.defaults&&a.mixin(w,h.defaults);G&&a.mixin(w,
G);var u;x("dom-attributes-explicit")?u=k.attributes:x("dom-attributes-specified-flag")?u=n.filter(k.attributes,function(a){return a.specified}):(G=(/^input$|^img$/i.test(k.nodeName)?k:k.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),u=n.map(G.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==k.nodeName&&"value"==a||"enctype"==b?k.getAttribute(b):k.getAttributeNode(b).value}}));var D=h.scope||b._scopeName;
G="data-"+D+"-";var E={};"dojo"!==D&&(E[G+"props"]="data-dojo-props",E[G+"type"]="data-dojo-type",E[G+"mixins"]="data-dojo-mixins",E[D+"type"]="dojotype",E[G+"id"]="data-dojo-id");for(var C=0,I,D=[],H,L;I=u[C++];){var v=I.name,J=v.toLowerCase();I=I.value;switch(E[J]||J){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":L=I;break;case "data-dojo-id":case "jsid":H=I;break;case "data-dojo-attach-point":case "dojoattachpoint":w.dojoAttachPoint=I;break;case "data-dojo-attach-event":case "dojoattachevent":w.dojoAttachEvent=
I;break;case "class":w["class"]=k.className;break;case "style":w.style=k.style&&k.style.cssText;break;default:if(v in z||(v=y(c)[J]||v),v in z)switch(typeof z[v]){case "string":w[v]=I;break;case "number":w[v]=I.length?Number(I):NaN;break;case "boolean":w[v]="false"!=I.toLowerCase();break;case "function":""===I||-1!=I.search(/[^\w\.]+/i)?w[v]=new Function(I):w[v]=a.getObject(I,!1)||new Function(I);D.push(v);break;default:J=z[v],w[v]=J&&"length"in J?I?I.split(/\s*,\s*/):[]:J instanceof Date?""==I?new Date(""):
"now"==I?new Date:p.fromISOString(I):J instanceof f?b.baseUrl+I:d(I)}else w[v]=I}}for(u=0;u<D.length;u++)E=D[u].toLowerCase(),k.removeAttribute(E),k[E]=null;if(L)try{L=d.call(h.propsThis,"{"+L+"}"),a.mixin(w,L)}catch(la){throw Error(la.toString()+" in data-dojo-props\x3d'"+L+"'");}a.mixin(w,g);t||(t=c&&(c._noScript||z._noScript)?[]:e("\x3e script[type^\x3d'dojo/']",k));var F=[],T=[],aa=[],ca=[];if(t)for(C=0;C<t.length;C++)E=t[C],k.removeChild(E),g=E.getAttribute(G+"event")||E.getAttribute("event"),
h=E.getAttribute(G+"prop"),L=E.getAttribute(G+"method"),D=E.getAttribute(G+"advice"),u=E.getAttribute("type"),E=this._functionFromScript(E,G),g?"dojo/connect"==u?F.push({method:g,func:E}):"dojo/on"==u?ca.push({event:g,func:E}):w[g]=E:"dojo/aspect"==u?F.push({method:L,advice:D,func:E}):"dojo/watch"==u?aa.push({prop:h,func:E}):T.push(E);c=(t=c.markupFactory||z.markupFactory)?t(w,k,c):new c(w,k);return c.then?c.then(B):B(c)},scan:function(a,d){function e(a){if(!a.inherited){a.inherited={};var b=a.node,
d=e(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(p)||d.textDir},c;for(c in b)b[c]&&(a.inherited[c]=b[c])}return a.inherited}var g=[],f=[],m={},h=(d.scope||b._scopeName)+"Type",l="data-"+(d.scope||b._scopeName)+"-",y=l+"type",p=l+"textdir",l=l+"mixins",t=a.firstChild,G=d.inherited;if(!G){var x=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&x(a.parentNode,b)},G={dir:x(a,"dir"),lang:x(a,"lang"),textDir:x(a,p)},u;for(u in G)G[u]||
delete G[u]}u={inherited:G};for(var H,E;;)if(t)if(1!=t.nodeType)t=t.nextSibling;else if(H&&"script"==t.nodeName.toLowerCase())(G=t.getAttribute("type"))&&/^dojo\/\w/i.test(G)&&H.push(t),t=t.nextSibling;else if(E)t=t.nextSibling;else if(G=t.getAttribute(y)||t.getAttribute(h),a=t.firstChild,G||a&&(3!=a.nodeType||a.nextSibling)){E=null;if(G){var C=t.getAttribute(l);H=C?[G].concat(C.split(/\s*,\s*/)):[G];try{E=k(H,d.contextRequire)}catch(oa){}E||n.forEach(H,function(a){~a.indexOf("/")&&!m[a]&&(m[a]=!0,
f[f.length]=a)});C=E&&!E.prototype._noScript?[]:null;u={types:H,ctor:E,parent:u,node:t,scripts:C};u.inherited=e(u);g.push(u)}else u={node:t,scripts:H,parent:u};H=C;E=t.stopParser||E&&E.prototype.stopParser&&!d.template;t=a}else t=t.nextSibling;else{if(!u||!u.node)break;t=u.node.nextSibling;E=!1;u=u.parent;H=u.scripts}var D=new w;f.length?(d.contextRequire||c)(f,function(){D.resolve(n.filter(g,function(a){if(!a.ctor)try{a.ctor=k(a.types,d.contextRequire)}catch(ca){}for(var b=a.parent;b&&!b.types;)b=
b.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!d.template);a.instantiate=!b||b.instantiate&&b.instantiateChildren;return a.instantiate}))}):D.resolve(g);return D.promise},_require:function(b,e){b=d("{"+b.innerHTML+"}");var k=[],g=[],f=new w;e=e&&e.contextRequire||c;for(var m in b)k.push(m),g.push(b[m]);e(g,function(){for(var b=0;b<k.length;b++)a.setObject(k[b],arguments[b]);f.resolve(arguments)});return f.promise},_scanAmd:function(a,b){var d=new w,c=d.promise;d.resolve(!0);
var k=this;e("script[type\x3d'dojo/require']",a).forEach(function(a){c=c.then(function(){return k._require(a,b)});a.parentNode.removeChild(a)});return c},parse:function(b,d){!b||"string"==typeof b||"nodeType"in b||(d=b,b=d.rootNode);var e=b?v.byId(b):h.body();d=d||{};var c=d.template?{template:!0}:{},k=[],g=this;b=this._scanAmd(e,d).then(function(){return g.scan(e,d)}).then(function(a){return g._instantiate(a,c,d,!0)}).then(function(a){return k=k.concat(a)}).otherwise(function(a){throw a;});a.mixin(k,
b);return k}};b.parser=E;u.parseOnLoad&&g(100,E,"parse");return E})},"esri/layerUtils":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/has","./kernel"],function(c,b,a,n,u){n={_serializeLayerDefinitions:function(c,h){var f=[],l=/[:;]/;if(c&&(b.forEach(c,function(a,b){a&&(f.push([b,a]),!h&&l.test(a)&&(h=!0))}),0<f.length)){var t;h?(t={},b.forEach(f,function(a){t[a[0]]=a[1]}),t=a.toJson(t)):(t=[],b.forEach(f,function(a){t.push(a[0]+":"+a[1])}),t=t.join(";"));return t}return null},
_serializeTimeOptions:function(c,h){if(c){var f=[];b.forEach(c,function(c,t){c&&(c=c.toJson(),h&&-1!==b.indexOf(h,t)&&(c.useTime=!1),f.push('"'+t+'":'+a.toJson(c)))});if(f.length)return"{"+f.join(",")+"}"}},_getVisibleLayers:function(a,c){var f=[],h,t;if(!a)return f;if(c)for(f=c.concat(),t=0;t<a.length;t++)c=a[t],h=b.indexOf(a,c.id),c.subLayerIds&&-1<h&&(f.splice(h,1),f=f.concat(c.subLayerIds));else f=this._getDefaultVisibleLayers(a);return f},_getDefaultVisibleLayers:function(a){var c=[],f;if(!a)return c;
for(f=0;f<a.length;f++)0<=a[f].parentLayerId&&-1===b.indexOf(c,a[f].parentLayerId)&&b.some(a,function(b){return b.id===a[f].parentLayerId})||a[f].defaultVisibility&&c.push(a[f].id);return c},_getLayersForScale:function(a,c){var f=[];if(0<a&&c){var h;for(h=0;h<c.length;h++)if(!(0<=c[h].parentLayerId&&-1===b.indexOf(f,c[h].parentLayerId)&&b.some(c,function(a){return a.id===c[h].parentLayerId}))&&0<=c[h].id){var t=!0,p=c[h].maxScale,n=c[h].minScale;if(0<p||0<n)0<p&&0<n?t=p<=a&&a<=n:0<p?t=p<=a:0<n&&(t=
a<=n);t&&f.push(c[h].id)}}return f}};c.mixin(u,n);return n})},"esri/dijit/Attribution":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y){c=c(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",
listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(a,d){try{b.mixin(this,a);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];this._layerHandles={};var c=this.domNode=f.byId(d),e=this.map,k="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";c&&(l.set(c,"innerHTML",k),this.listNode=u.query(".esriAttributionList",c)[0],this.itemNodes={});this._eventConnections=
[n.connect(e,"onLayerAdd",this,this._onLayerAdd),n.connect(e,"onLayerRemove",this,this._onLayerRemove),n.connect(e,"onLayerSuspend",this,this._onLayerSuspend),n.connect(e,"onLayerResume",this,this._onLayerResume),n.connect(e,"onResize",this,this._adjustFocus),n.connect(e,"onExtentChange",this,this._onExtentChange)];if(e.loaded){var g=e.layerIds.concat(e.graphicsLayerIds),m,h,y=g.length;for(h=0;h<y;h++)m=e.getLayer(g[h]),m.loaded&&this._onLayerAdd(m)}}catch(B){}},startup:function(){},destroy:function(){a.forEach(this._eventConnections,
n.disconnect);t.destroy(this.listNode);var b=this._layerHandles,d;for(d in b)b[d]&&b[d].remove();this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=this._layerHandles=null},_onLayerAdd:function(a){try{var d=this._attributions,e=a.id;if(!m.isDefined(d[e])&&a.showAttribution){if(a.hasAttributionData){var c=a.getAttributionData();this._pendingDfds[e]=1;d[e]=c;c.addBoth(b.partial(this._onAttributionLoad,
this,a))}else d[e]=a.copyright||a.copyrightText||"",d[e]?(a.suspended||this._activeLayers.push(e),this._createNode(e)):this._onLayerRemove(a);-1<a.declaredClass.toLowerCase().indexOf("vetiledlayer")&&(this._layerHandles[e]=a.on("map-style-change",b.hitch(this,function(){this._onLayerRemove(a);this._onLayerAdd(a)})))}}catch(D){}},_onAttributionLoad:function(a,b,d){var e=a._attributions,c=a._pendingDfds,k=b.id;if(c&&c[k]){delete c[k];if(!d||d instanceof Error)d="";e[k]=d?a._createIndexByLevel(d,-1!==
b.declaredClass.toLowerCase().indexOf("vetiledlayer")):b.copyright||b.copyrightText||"";e[k]?(b.suspended||a._activeLayers.push(k),a._createNode(k)):a._onLayerRemove(b)}},_onLayerRemove:function(b){try{var d=b.id,e=this.itemNodes,c,k=-1;this._onLayerSuspend(b);this._layerHandles[d]&&this._layerHandles[d].remove();delete this._attributions[d];delete this._pendingDfds[d];delete this._layerHandles[d];c=this._getGroupIndex(d);-1!==c&&(k=a.indexOf(this._sharedLayers[c],d),-1!==k&&(this._sharedLayers[c].splice(k,
1),1>=this._sharedLayers[c].length&&this._sharedLayers.splice(c,1)));e[d]&&-1===k&&t.destroy(e[d]);delete e[d];this._updateLastItem()}catch(z){}},_onLayerSuspend:function(b){try{var d=b.id;if(this._attributions[d]){var e=a.indexOf(this._activeLayers,d),c=this.itemNodes[d];-1!==e&&this._activeLayers.splice(e,1);c&&this._toggleItem(c,!1,this._getGroupIndex(d))}}catch(D){}},_adjustFocus:function(){var a=this.domNode.scrollWidth>this.domNode.clientWidth,b=w.contains(this.domNode,"esriAttributionOpen");
l.set(this.domNode,"tabIndex",a||b?"0":"")},_onLayerResume:function(d){try{var e=d.id,c=this._attributions[e],k=this.itemNodes[e];if(c&&(-1===a.indexOf(this._activeLayers,e)&&this._activeLayers.push(e),k)){var g=b.isString(c)?c:this._getContributorsList(c,this.map.extent,this.map.getLevel());b.isString(c)||l.set(k,"innerHTML",g?g+this._getDelimiter():"");g&&this._toggleItem(k,!0,this._getGroupIndex(e))}}catch(z){}},_onExtentChange:function(a,d,e,c){try{var k=this._activeLayers,g=this._attributions,
f=this.itemNodes,m,h,B,y,t=k.length||0;for(y=0;y<t;y++)if(h=k[y],B=g[h],(m=f[h])&&!b.isString(B)){var p=this._getContributorsList(B,a,c?c.level:-1);l.set(m,"innerHTML",p?p+this._getDelimiter():"");this._toggleItem(m,!!p,-1)}}catch(Q){}this._adjustCursorStyle()},_createNode:function(a){if(this.domNode){var d=this._checkShareInfo(a),e=d&&d.sharedWith,e=e&&this.itemNodes[e],c=this.map,k=this._attributions[a],k=b.isString(k)?k:this._getContributorsList(k,c.extent,c.getLevel()),c=!!k&&!c.getLayer(a).suspended;
e?(this.itemNodes[a]=e,this._toggleItem(e,c,d.index)):(a=this.itemNodes[a]=t.create("span",{"class":this.itemClass,innerHTML:k?k+this._getDelimiter():"",style:{display:c?"inline":"none"}},this.listNode),c&&this._setLastItem(a));this._adjustCursorStyle()}},_checkShareInfo:function(d){var e=this._attributions,c,k,g=-1,f=e[d],m;if(f&&b.isString(f)){for(k in e)if(c=e[k],k!==d&&c&&b.isString(c)&&c.length===f.length&&c.toLowerCase()===f.toLowerCase()){m=k;break}e=this._sharedLayers;c=e.length;if(m){for(k=
0;k<c;k++)if(f=e[k],-1!==a.indexOf(f,m)){g=k;f.push(d);break}-1===g&&(g=e.push([m,d])-1)}}return-1<g?{index:g,sharedWith:m}:null},_getGroupIndex:function(b){var d=this._sharedLayers,e,c=d.length,k=-1;for(e=0;e<c;e++)if(-1!==a.indexOf(d[e],b)){k=e;break}return k},_getDelimiter:function(){var a=this.itemDelimiter;return a?"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+a+"\x3c/span\x3e":""},_toggleItem:function(b,d,e){if(-1<e&&!d){e=this._sharedLayers[e];var c,k=e.length,g=this._activeLayers;for(c=
0;c<k;c++)if(-1!==a.indexOf(g,e[c]))return}p.set(b,"display",d?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var a=this.listNode.childNodes,b;b=a.length;var d;if(b)for(--b;0<=b;b--)if(d=a[b],"none"!==p.get(d,"display")){this._setLastItem(d);break}this._adjustCursorStyle()},_setLastItem:function(a){var b=this.itemClass,d=this.lastItemClass;this._lastItem&&w.replace(this._lastItem,b,d);a&&(w.replace(a,d,b),this._lastItem=a)},_createIndexByLevel:function(a,b){a=a.contributors;var e,
c,k,f,h=a?a.length:0,t,p,B=new g(4326),l={},x;for(f=0;f<h;f++)for(e=a[f],p=(c=e.coverageAreas)?c.length:0,t=0;t<p;t++)for(k=c[t],x=k.bbox,x={extent:d.geographicToWebMercator(new y(x[1],x[0],x[3],x[2],B)),attribution:e.attribution||"",zoomMin:k.zoomMin-(b&&k.zoomMin?1:0),zoomMax:k.zoomMax-(b&&k.zoomMax?1:0),score:m.isDefined(k.score)?k.score:100,objectId:f},k=x.zoomMin;k<=x.zoomMax;k++)l[k]=l[k]||[],l[k].push(x);return l},_getContributorsList:function(a,b,d){var e="";if(b&&m.isDefined(d)&&-1<d){a=
a[d];d=b.getCenter().normalize();for(var c=a?a.length:0,k=[],g={},e=0;e<c;e++)b=a[e],!g[b.objectId]&&b.extent.contains(d)&&(g[b.objectId]=1,k.push(b));k.sort(function(a,b){return b.score-a.score||a.objectId-b.objectId});c=k.length;for(e=0;e<c;e++)k[e]=k[e].attribution;e=k.join(", ")}return e},_adjustCursorStyle:function(){var a=x.position(this.listNode.parentNode,!0).h;w.contains(this.listNode.parentNode,"esriAttributionOpen")?(w.remove(this.listNode.parentNode,"esriAttributionOpen"),a>x.position(this.listNode.parentNode,
!0).h?(p.set(this.listNode.parentNode,"cursor","pointer"),w.add(this.listNode.parentNode,"esriAttributionOpen")):p.set(this.listNode.parentNode,"cursor","default")):(w.add(this.listNode.parentNode,"esriAttributionOpen"),a<x.position(this.listNode.parentNode,!0).h?p.set(this.listNode.parentNode,"cursor","pointer"):p.set(this.listNode.parentNode,"cursor","default"),w.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}});b.setObject("dijit.Attribution",c,e);return c})},"esri/IdentityManager":function(){define(["./IdentityManagerDialog",
"./kernel","./OAuthSignInHandler","dojo/_base/declare"],function(c,b,a,n){c=new c;b.id=n.safeMixin(c,a);return b.id})},"esri/IdentityManagerDialog":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/has dojo/dom-attr dojo/keys dijit/registry dijit/Dialog ./kernel ./lang ./domUtils ./Credential ./IdentityManagerBase dojo/i18n!./nls/jsapi dojo/query dijit/form/Button dijit/form/Form dijit/form/ValidationTextBox".split(" "),function(c,b,
a,n,u,v,h,f,l,t,p,w,x,e,m,g){b=b([m],{declaredClass:"esri.IdentityManager",_eventMap:{"dialog-cancel":["info"]},constructor:function(a){u.mixin(this,a);this.registerConnectEvents()},_dialogContent:"\x3cdiv data-dojo-type\x3d'dijit.form.Form' data-dojo-props\x3d'\"class\":\"esriIdForm\"'\x3e\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${info}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3ctable style\x3d'width: 100%;'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblUser}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"text\", \"class\":\"esriIdUser\", required:true, trim:true, style:\"width: 100%;\", autocapitalize:\"none\", autocorrect:\"off\", spellcheck:false' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblPwd}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"password\", \"class\":\"esriIdPwd\", required:true, style:\"width: 100%;\"' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e",
onDialogCreate:function(){},onDialogCancel:function(){},signIn:function(b,e,c){this._nls||(this._nls=g.identity);this._loginDialog||(this._loginDialog=this.dialog=this._createLoginDialog(),this.onDialogCreate());var d=this._loginDialog,k=c&&c.error,f=c&&c.token,m=new n(function(){d.onCancel()});if(d.open)return b=Error("BUSY"),b.code="IdentityManager.1",b.log=!!a.isDebug,m.errback(b),m;x.hide(d.errMsg_);k&&403==k.code&&f&&(h.set(d.errMsg_,"innerHTML",this._nls.forbidden),x.show(d.errMsg_));d.dfd_=
m;d.serverInfo_=e;d.resUrl_=b;d.admin_=c&&c.isAdmin;h.set(d.resLink_,{title:b,innerHTML:"("+(this.getResourceName(b)||this._nls.lblItem)+")"});h.set(d.serverLink_,{title:e.server,innerHTML:(-1!==e.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":e.server)+" "});d.txtPwd_.set("value","");d.show();return m},_createLoginDialog:function(){var b=this._nls,g=w.substitute(b,this._dialogContent),g=w.substitute({resource:"\x3cspan class\x3d'resLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e",
server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},g),k=new t({title:b.title,content:g,"class":"esriSignInDialog",style:"width: 18em;",esriIdMgr_:this,keypressed_:function(a){a.charOrCode===f.ENTER&&this.execute_()},execute_:function(){var a=this.txtUser_.get("value"),d=this.txtPwd_.get("value"),c=this.dfd_,k=this;if(this.form_.validate()&&a&&d){this.btnSubmit_.set("label",b.lblSigning);var g=p.id.findCredential(k.resUrl_,a),f=function(d){k.btnSubmit_.set("label",
b.lblOk);k.btnSubmit_.set("disabled",!1);x.hide(k.errMsg_);k.hide();t._DialogLevelManager.hide(k);var f=k.serverInfo_;k.dfd_=k.serverInfo_=k.generateDfd_=k.resUrl_=null;var m,h,y=g,p;d&&(m=d.token,h=w.isDefined(d.expires)?Number(d.expires):null,p=!!d.ssl,y?(y.userId=a,y.token=m,y.expires=h,y.validity=d.validity,y.ssl=p,y.creationTime=(new Date).getTime()):y=new e({userId:a,server:f.server,token:m,expires:h,ssl:p,isAdmin:k.admin_,validity:d.validity}));c.callback(y)};g&&!g._enqueued?f():(k.btnSubmit_.set("disabled",
!0),k.generateDfd_=p.id.generateToken(this.serverInfo_,{username:a,password:d},{isAdmin:this.admin_}).addCallback(f).addErrback(function(a){k.btnSubmit_.set("disabled",!1);k.generateDfd_=null;k.btnSubmit_.set("label",b.lblOk);h.set(k.errMsg_,"innerHTML",a&&a.code?b.invalidUser:b.noAuthService);x.show(k.errMsg_)}))}},cancel_:function(){k.generateDfd_&&k.generateDfd_.cancel();var b=k.dfd_,d=k.resUrl_,e=k.serverInfo_;k.btnSubmit_.set("disabled",!1);k.dfd_=k.serverInfo_=k.generateDfd_=k.resUrl_=null;
x.hide(k.errMsg_);t._DialogLevelManager.hide(k);k.esriIdMgr_.onDialogCancel({resourceUrl:d,serverInfo:e});d=Error("ABORTED");d.code="IdentityManager.2";d.log=!!a.isDebug;b.errback(d)}}),g=k.domNode;k.form_=l.byNode(c.query(".esriIdForm",g)[0]);k.txtUser_=l.byNode(c.query(".esriIdUser",g)[0]);k.txtPwd_=l.byNode(c.query(".esriIdPwd",g)[0]);k.btnSubmit_=l.byNode(c.query(".esriIdSubmit",g)[0]);k.btnCancel_=l.byNode(c.query(".esriIdCancel",g)[0]);k.resLink_=c.query(".resLink",g)[0];k.serverLink_=c.query(".serverLink",
g)[0];k.errMsg_=c.query(".esriErrorMsg",g)[0];k.connect(k.txtUser_,"onKeyPress",k.keypressed_);k.connect(k.txtPwd_,"onKeyPress",k.keypressed_);k.connect(k.btnSubmit_,"onClick",k.execute_);k.connect(k.btnCancel_,"onClick",k.onCancel);k.connect(k,"onCancel",k.cancel_);return k}});return p.IdentityManagerDialog=p.IdentityManager=b})},"dijit/Dialog":function(){define("require dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/ready dojo/sniff dojo/touch dojo/window dojo/dnd/Moveable dojo/dnd/TimedMoveable ./focus ./_base/manager ./_Widget ./_TemplatedMixin ./_CssStateMixin ./form/_FormMixin ./_DialogMixin ./DialogUnderlay ./layout/ContentPane ./layout/utils dojo/text!./templates/Dialog.html ./a11yclick dojo/i18n!./nls/common".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F,T,B,M,U,N){function Q(){}var O=new u;O.resolve(!0);C=n("dijit._DialogBase"+(g("dojo-bidi")?"_NoBidi":""),[z,F,T,J],{templateString:N,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:{node:"titleNode",type:"innerHTML"},open:!1,duration:C.defaultDuration,refocus:!0,autofocus:!0,_firstFocusItem:null,_lastFocusItem:null,draggable:!0,_setDraggableAttr:function(a){this._set("draggable",a)},maxRatio:.9,
closable:!0,_setClosableAttr:function(a){this.closeButtonNode.style.display=a?"":"none";this._set("closable",a)},postMixInProperties:function(){var a=p.getLocalization("dijit","common");x.mixin(this,a);this.inherited(arguments)},postCreate:function(){l.set(this.domNode,{display:"none",position:"absolute"});this.ownerDocumentBody.appendChild(this.domNode);this.inherited(arguments);a.after(this,"onExecute",x.hitch(this,"hide"),!0);a.after(this,"onCancel",x.hitch(this,"hide"),!0);e(this.closeButtonNode,
d.press,function(a){a.stopPropagation()});this._modalconnects=[]},onLoad:function(){this.resize();this._position();this.autofocus&&I.isTop(this)&&(this._getFocusItems(),E.focus(this._firstFocusItem));this.inherited(arguments)},focus:function(){this._getFocusItems();E.focus(this._firstFocusItem)},_endDrag:function(){var a=f.position(this.domNode),b=y.getBox(this.ownerDocument);a.y=Math.min(Math.max(a.y,0),b.h-a.h);a.x=Math.min(Math.max(a.x,0),b.w-a.w);this._relativePosition=a;this._position()},_setup:function(){var d=
this.domNode;this.titleBar&&this.draggable?(this._moveable=new (6==g("ie")?G:k)(d,{handle:this.titleBar}),a.after(this._moveable,"onMoveStop",x.hitch(this,"_endDrag"),!0)):h.add(d,"dijitDialogFixed");this.underlayAttrs={dialogId:this.id,"class":b.map(this["class"].split(/\s/),function(a){return a+"_underlay"}).join(" "),_onKeyDown:x.hitch(this,"_onKey"),ownerDocument:this.ownerDocument}},_size:function(){this.resize()},_position:function(){if(!h.contains(this.ownerDocumentBody,"dojoMove")){var a=
this.domNode,b=y.getBox(this.ownerDocument),d=this._relativePosition,e=f.position(a);l.set(a,{left:Math.floor(b.l+(d?Math.min(d.x,b.w-e.w):(b.w-e.w)/2))+"px",top:Math.floor(b.t+(d?Math.min(d.y,b.h-e.h):(b.h-e.h)/2))+"px"})}},_onKey:function(a){if(a.keyCode==w.TAB){this._getFocusItems();var b=a.target;this._firstFocusItem==this._lastFocusItem?(a.stopPropagation(),a.preventDefault()):b==this._firstFocusItem&&a.shiftKey?(E.focus(this._lastFocusItem),a.stopPropagation(),a.preventDefault()):b!=this._lastFocusItem||
a.shiftKey||(E.focus(this._firstFocusItem),a.stopPropagation(),a.preventDefault())}else this.closable&&a.keyCode==w.ESCAPE&&(this.onCancel(),a.stopPropagation(),a.preventDefault())},show:function(){if(this.open)return O.promise;this._started||this.startup();this._alreadyInitialized||(this._setup(),this._alreadyInitialized=!0);this._fadeOutDeferred&&(this._fadeOutDeferred.cancel(),I.hide(this));var a=y.get(this.ownerDocument);this._modalconnects.push(e(a,"scroll",x.hitch(this,"resize",null)));this._modalconnects.push(e(this.domNode,
"keydown",x.hitch(this,"_onKey")));l.set(this.domNode,{opacity:0,display:""});this._set("open",!0);this._onShow();this.resize();this._position();var b;this._fadeInDeferred=new u(x.hitch(this,function(){b.stop();delete this._fadeInDeferred}));this._fadeInDeferred.then(void 0,Q);a=this._fadeInDeferred.promise;b=t.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:x.hitch(this,function(){I.show(this,this.underlayAttrs)}),onEnd:x.hitch(this,function(){this.autofocus&&I.isTop(this)&&(this._getFocusItems(),
E.focus(this._firstFocusItem));this._fadeInDeferred.resolve(!0);delete this._fadeInDeferred})}).play();return a},hide:function(){if(!this._alreadyInitialized||!this.open)return O.promise;this._fadeInDeferred&&this._fadeInDeferred.cancel();var a;this._fadeOutDeferred=new u(x.hitch(this,function(){a.stop();delete this._fadeOutDeferred}));this._fadeOutDeferred.then(void 0,Q);this._fadeOutDeferred.then(x.hitch(this,"onHide"));var b=this._fadeOutDeferred.promise;a=t.fadeOut({node:this.domNode,duration:this.duration,
onEnd:x.hitch(this,function(){this.domNode.style.display="none";I.hide(this);this._fadeOutDeferred.resolve(!0);delete this._fadeOutDeferred})}).play();this._scrollConnected&&(this._scrollConnected=!1);for(var d;d=this._modalconnects.pop();)d.remove();this._relativePosition&&delete this._relativePosition;this._set("open",!1);return b},resize:function(a){if("none"!=this.domNode.style.display){this._checkIfSingleChild();if(!a){this._shrunk&&(this._singleChild&&"undefined"!=typeof this._singleChildOriginalStyle&&
(this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle,delete this._singleChildOriginalStyle),b.forEach([this.domNode,this.containerNode,this.titleBar,this.actionBarNode],function(a){a&&l.set(a,{position:"static",width:"auto",height:"auto"})}),this.domNode.style.position="absolute");var d=y.getBox(this.ownerDocument);d.w*=this.maxRatio;d.h*=this.maxRatio;var e=f.position(this.domNode);e.w>=d.w||e.h>=d.h?(a={w:Math.min(e.w,d.w),h:Math.min(e.h,d.h)},this._shrunk=!0):this._shrunk=!1}if(a){f.setMarginBox(this.domNode,
a);d=[];this.titleBar&&d.push({domNode:this.titleBar,region:"top"});this.actionBarNode&&d.push({domNode:this.actionBarNode,region:"bottom"});e={domNode:this.containerNode,region:"center"};d.push(e);var c=U.marginBox2contentBox(this.domNode,a);U.layoutChildren(this.domNode,c,d);this._singleChild?(d=U.marginBox2contentBox(this.containerNode,e),this._singleChild.resize({w:d.w,h:d.h})):(this.containerNode.style.overflow="auto",this._layoutChildren())}else this._layoutChildren();g("touch")||a||this._position()}},
_layoutChildren:function(){b.forEach(this.getChildren(),function(a){a.resize&&a.resize()})},destroy:function(){this._fadeInDeferred&&this._fadeInDeferred.cancel();this._fadeOutDeferred&&this._fadeOutDeferred.cancel();this._moveable&&this._moveable.destroy();for(var a;a=this._modalconnects.pop();)a.remove();I.hide(this);this.inherited(arguments)}});g("dojo-bidi")&&(C=n("dijit._DialogBase",C,{_setTitleAttr:function(a){this._set("title",a);this.titleNode.innerHTML=a;this.applyTextDir(this.titleNode)},
_setTextDirAttr:function(a){this._created&&this.textDir!=a&&(this._set("textDir",a),this.set("title",this.title))}}));var K=n("dijit.Dialog",[M,C],{});K._DialogBase=C;var I=K._DialogLevelManager={_beginZIndex:950,show:function(a,b){H[H.length-1].focus=E.curNode;var d=H[H.length-1].dialog?H[H.length-1].zIndex+2:K._DialogLevelManager._beginZIndex;l.set(a.domNode,"zIndex",d);B.show(b,d-1);H.push({dialog:a,underlayAttrs:b,zIndex:d})},hide:function(a){if(H[H.length-1].dialog==a){H.pop();var d=H[H.length-
1];1==H.length?B.hide():B.show(d.underlayAttrs,d.zIndex-1);if(a.refocus&&(a=d.focus,!d.dialog||a&&v.isDescendant(a,d.dialog.domNode)||(d.dialog._getFocusItems(),a=d.dialog._firstFocusItem),a))try{a.focus()}catch(X){}}else d=b.indexOf(b.map(H,function(a){return a.dialog}),a),-1!=d&&H.splice(d,1)},isTop:function(a){return H[H.length-1].dialog==a}},H=K._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];E.watch("curNode",function(a,b,d){a=H[H.length-1].dialog;if(d&&a&&!a._fadeOutDeferred&&d.ownerDocument==
a.ownerDocument){do if(d==a.domNode||h.contains(d,"dijitPopup"))return;while(d=d.parentNode);a.focus()}});g("dijit-legacy-requires")&&m(0,function(){c(["dijit/TooltipDialog"])});return K})},"dojo/dnd/TimedMoveable":function(){define(["../_base/declare","./Moveable"],function(c,b){var a=b.prototype.onMove;return c("dojo.dnd.TimedMoveable",b,{timeout:40,constructor:function(a,b){b||(b={});b.timeout&&"number"==typeof b.timeout&&0<=b.timeout&&(this.timeout=b.timeout)},onMoveStop:function(c){c._timer&&
(clearTimeout(c._timer),a.call(this,c,c._leftTop));b.prototype.onMoveStop.apply(this,arguments)},onMove:function(b,c){b._leftTop=c;if(!b._timer){var n=this;b._timer=setTimeout(function(){b._timer=null;a.call(n,b,b._leftTop)},this.timeout)}}})})},"dijit/form/_FormMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/on dojo/window".split(" "),function(c,b,a,n,u,v){return b("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(a){var b=
[];c.forEach(a||this.getChildren(),function(a){"value"in a?b.push(a):b=b.concat(this._getDescendantFormWidgets(a.getChildren()))},this);return b},reset:function(){c.forEach(this._getDescendantFormWidgets(),function(a){a.reset&&a.reset()})},validate:function(){var a=!1;return c.every(c.map(this._getDescendantFormWidgets(),function(b){b._hasBeenBlurred=!0;var c=b.disabled||!b.validate||b.validate();c||a||(v.scrollIntoView(b.containerNode||b.domNode),b.focus(),a=!0);return c}),function(a){return a})},
setValues:function(b){a.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",b)},_setValueAttr:function(a){var b={};c.forEach(this._getDescendantFormWidgets(),function(a){a.name&&(b[a.name]||(b[a.name]=[])).push(a)});for(var h in b)if(b.hasOwnProperty(h)){var t=b[h],p=n.getObject(h,!1,a);void 0!==p&&(p=[].concat(p),"boolean"==typeof t[0].checked?c.forEach(t,function(a){a.set("value",-1!=c.indexOf(p,a._get("value")))}):t[0].multiple?
t[0].set("value",p):c.forEach(t,function(a,b){a.set("value",p[b])}))}},getValues:function(){a.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var a={};c.forEach(this._getDescendantFormWidgets(),function(b){var c=b.name;if(c&&!b.disabled){var f=b.get("value");"boolean"==typeof b.checked?/Radio/.test(b.declaredClass)?!1!==f?n.setObject(c,f,a):(f=n.getObject(c,!1,a),void 0===f&&n.setObject(c,null,a)):
(b=n.getObject(c,!1,a),b||(b=[],n.setObject(c,b,a)),!1!==f&&b.push(f)):(b=n.getObject(c,!1,a),"undefined"!=typeof b?n.isArray(b)?b.push(f):n.setObject(c,[b,f],a):n.setObject(c,f,a))}});return a},isValid:function(){return""==this.state},onValidStateChange:function(){},_getState:function(){var a=c.map(this._descendants,function(a){return a.get("state")||""});return 0<=c.indexOf(a,"Error")?"Error":0<=c.indexOf(a,"Incomplete")?"Incomplete":""},disconnectChildren:function(){},connectChildren:function(a){this._descendants=
this._getDescendantFormWidgets();c.forEach(this._descendants,function(a){a._started||a.startup()});a||this._onChildChange()},_onChildChange:function(a){a&&"state"!=a&&"disabled"!=a||this._set("state",this._getState());a&&"value"!=a&&"disabled"!=a&&"checked"!=a||(this._onChangeDelayTimer&&this._onChangeDelayTimer.remove(),this._onChangeDelayTimer=this.defer(function(){delete this._onChangeDelayTimer;this._set("value",this.get("value"))},10))},startup:function(){this.inherited(arguments);this._descendants=
this._getDescendantFormWidgets();this.value=this.get("value");this.state=this._getState();var a=this;this.own(u(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(b){b.target!=a.domNode&&a._onChildChange(b.type.replace("attrmodified-",""))}));this.watch("state",function(a,b,c){this.onValidStateChange(""==c)})},destroy:function(){this.inherited(arguments)}})})},"dijit/_DialogMixin":function(){define(["dojo/_base/declare","./a11y"],function(c,
b){return c("dijit._DialogMixin",null,{actionBarTemplate:"",execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var a=b._getTabNavigable(this.domNode);this._firstFocusItem=a.lowest||a.first||this.closeButtonNode||this.domNode;this._lastFocusItem=a.last||a.highest||this._firstFocusItem}})})},"dijit/DialogUnderlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/dom-attr dojo/dom-style dojo/on dojo/window ./_Widget ./_TemplatedMixin ./BackgroundIframe ./Viewport ./main".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w){var x=c("dijit.DialogUnderlay",[f,l],{templateString:"\x3cdiv class\x3d'dijitDialogUnderlayWrapper'\x3e\x3cdiv class\x3d'dijitDialogUnderlay' tabIndex\x3d'-1' data-dojo-attach-point\x3d'node'\x3e\x3c/div\x3e\x3c/div\x3e",dialogId:"","class":"",_modalConnects:[],_setDialogIdAttr:function(a){n.set(this.node,"id",a+"_underlay");this._set("dialogId",a)},_setClassAttr:function(a){this.node.className="dijitDialogUnderlay "+a;this._set("class",a)},postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);
this.own(v(this.domNode,"keydown",b.hitch(this,"_onKeyDown")));this.inherited(arguments)},layout:function(){var a=this.node.style,b=this.domNode.style;b.display="none";var c=h.getBox(this.ownerDocument);b.top=c.t+"px";b.left=c.l+"px";a.width=c.w+"px";a.height=c.h+"px";b.display="block"},show:function(){this.domNode.style.display="block";this.open=!0;this.layout();this.bgIframe=new t(this.domNode);var a=h.get(this.ownerDocument);this._modalConnects=[p.on("resize",b.hitch(this,"layout")),v(a,"scroll",
b.hitch(this,"layout"))]},hide:function(){this.bgIframe.destroy();delete this.bgIframe;for(this.domNode.style.display="none";this._modalConnects.length;)this._modalConnects.pop().remove();this.open=!1},destroy:function(){for(;this._modalConnects.length;)this._modalConnects.pop().remove();this.inherited(arguments)},_onKeyDown:function(){}});x.show=function(a,b){var c=x._singleton;!c||c._destroyed?c=w._underlay=x._singleton=new x(a):a&&c.set(a);u.set(c.domNode,"zIndex",b);c.open||c.show()};x.hide=function(){var a=
x._singleton;a&&!a._destroyed&&a.hide()};return x})},"dijit/layout/ContentPane":function(){define("dojo/_base/kernel dojo/_base/lang ../_Widget ../_Container ./_ContentPaneResizeMixin dojo/string dojo/html dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-construct dojo/_base/xhr dojo/i18n dojo/when dojo/i18n!../nls/loading".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g){return l("dijit.layout.ContentPane",[a,n,u],{href:"",content:"",extractContent:!1,parseOnLoad:!0,
parserScope:c._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"\x3cspan class\x3d'dijitContentPaneLoading'\x3e\x3cspan class\x3d'dijitInline dijitIconLoading'\x3e\x3c/span\x3e${loadingState}\x3c/span\x3e",errorMessage:"\x3cspan class\x3d'dijitContentPaneError'\x3e\x3cspan class\x3d'dijitInline dijitIconError'\x3e\x3c/span\x3e${errorState}\x3c/span\x3e",isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(a,
b,c){var d=new c(a,b);return!d.href&&d._contentSetter&&d._contentSetter.parseDeferred&&!d._contentSetter.parseDeferred.isFulfilled()?d._contentSetter.parseDeferred.then(function(){return d}):d},create:function(a,c){if(!(a&&a.template||!c||"href"in a||"content"in a)){c=p.byId(c);for(var d=c.ownerDocument.createDocumentFragment();c.firstChild;)d.appendChild(c.firstChild);a=b.delegate(a,{content:d})}this.inherited(arguments,[a,c])},postMixInProperties:function(){this.inherited(arguments);var a=m.getLocalization("dijit",
"loading",this.lang);this.loadingMessage=v.substitute(this.loadingMessage,a);this.errorMessage=v.substitute(this.errorMessage,a)},buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments);this._contentSetter&&f.forEach(this._contentSetter.parseResults,function(a){a._started||a._destroyed||!b.isFunction(a.startup)||(a.startup(),a._started=!0)},this)},_startChildren:function(){f.forEach(this.getChildren(),
function(a){a._started||a._destroyed||!b.isFunction(a.startup)||(a.startup(),a._started=!0)});this._contentSetter&&f.forEach(this._contentSetter.parseResults,function(a){a._started||a._destroyed||!b.isFunction(a.startup)||(a.startup(),a._started=!0)},this)},setHref:function(a){c.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0");return this.set("href",a)},_setHrefAttr:function(a){this.cancel();this.onLoadDeferred=new t(b.hitch(this,"cancel"));this.onLoadDeferred.then(b.hitch(this,
"onLoad"));this._set("href",a);this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0;return this.onLoadDeferred},setContent:function(a){c.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",a)},_setContentAttr:function(a){this._set("href","");this.cancel();this.onLoadDeferred=new t(b.hitch(this,"cancel"));this._created&&this.onLoadDeferred.then(b.hitch(this,"onLoad"));this._setContent(a||"");this._isDownloaded=
!1;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},destroy:function(){this.cancel();this.inherited(arguments)},destroyRecursive:function(a){this._beingDestroyed||this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},
refresh:function(){this.cancel();this.onLoadDeferred=new t(b.hitch(this,"cancel"));this.onLoadDeferred.then(b.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var a=this,c={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};b.isObject(this.ioArgs)&&b.mixin(c,this.ioArgs);var k=this._xhrDfd=(this.ioMethod||e.get)(c),g;k.then(function(b){g=b;try{return a._isDownloaded=!0,a._setContent(b,!1)}catch(C){a._onError("Content",
C)}},function(b){k.canceled||a._onError("Download",b);delete a._xhrDfd;return b}).then(function(){a.onDownloadEnd();delete a._xhrDfd;return g});delete this._hrefChanged},_onLoadHandler:function(a){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(a)}catch(y){}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(d){}},destroyDescendants:function(a){this.isLoaded&&this._onUnloadHandler();var b=this._contentSetter;f.forEach(this.getChildren(),function(b){b.destroyRecursive?
b.destroyRecursive(a):b.destroy&&b.destroy(a);b._destroyed=!0});b&&(f.forEach(b.parseResults,function(b){b._destroyed||(b.destroyRecursive?b.destroyRecursive(a):b.destroy&&b.destroy(a),b._destroyed=!0)}),delete b.parseResults);a||x.empty(this.containerNode);delete this._singleChild},_setContent:function(a,c){a=this.preprocessContent(a);this.destroyDescendants();var d=this._contentSetter;d&&d instanceof h._ContentSetter||(d=this._contentSetter=new h._ContentSetter({node:this.containerNode,_onError:b.hitch(this,
this._onError),onContentError:b.hitch(this,function(a){a=this.onContentError(a);try{this.containerNode.innerHTML=a}catch(D){}})}));var e=b.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!a.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{}),e=d.set(b.isObject(a)&&a.domNode?a.domNode:a,e),f=this;return g(e&&e.then?e:d.parseDeferred,function(){delete f._contentSetterParams;
c||(f._started&&(f._startChildren(),f._scheduleLayout()),f._onLoadHandler(a))})},preprocessContent:function(a){return a},_onError:function(a,b,c){this.onLoadDeferred.reject(b);a=this["on"+a+"Error"].call(this,b);c||a&&this._setContent(a,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})})},"dijit/layout/_ContentPaneResizeMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/query ../registry ../Viewport ./utils".split(" "),
function(c,b,a,n,u,v,h,f,l,t){return b("dijit.layout._ContentPaneResizeMixin",null,{doLayout:!0,isLayoutContainer:!0,startup:function(){if(!this._started){var a=this.getParent();this._childOfLayoutWidget=a&&a.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._isShown()&&this._onShow();this._childOfLayoutWidget||this.own(l.on("resize",v.hitch(this,"resize")))}},_checkIfSingleChild:function(){if(this.doLayout){var b=[],c=!1;h("\x3e *",this.containerNode).some(function(a){var e=
f.byNode(a);e&&e.resize?b.push(e):!/script|link|style/i.test(a.nodeName)&&a.offsetHeight&&(c=!0)});this._singleChild=1!=b.length||c?null:b[0];a.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)}},resize:function(a,b){this._resizeCalled=!0;this._scheduleLayout(a,b)},_scheduleLayout:function(a,b){this._isShown()?this._layout(a,b):(this._needLayout=!0,this._changeSize=a,this._resultSize=b)},_layout:function(a,b){delete this._needLayout;this._wasShown||!1===this.open||this._onShow();
a&&n.setMarginBox(this.domNode,a);var c=this.containerNode;c===this.domNode?(b=b||{},v.mixin(b,a||{}),"h"in b&&"w"in b||(b=v.mixin(n.getMarginBox(c),b)),this._contentBox=t.marginBox2contentBox(c,b)):this._contentBox=n.getContentBox(c);this._layoutChildren()},_layoutChildren:function(){this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var a=this._contentBox||n.getContentBox(this.containerNode);this._singleChild.resize({w:a.w,h:a.h})}else for(var a=this.getChildren(),b,c=0;b=
a[c++];)b.resize&&b.resize()},_isShown:function(){if(this._childOfLayoutWidget)return this._resizeCalled&&"open"in this?this.open:this._resizeCalled;if("open"in this)return this.open;var b=this.domNode,c=this.domNode.parentNode;return"none"!=b.style.display&&"hidden"!=b.style.visibility&&!a.contains(b,"dijitHidden")&&c&&c.style&&"none"!=c.style.display},_onShow:function(){this._wasShown=!0;this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments)}})})},"dijit/layout/utils":function(){define(["dojo/_base/array",
"dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang"],function(c,b,a,n,u){function v(a){return a.substring(0,1).toUpperCase()+a.substring(1)}function h(b,c){var f=b.resize?b.resize(c):a.setMarginBox(b.domNode,c);f?u.mixin(b,f):(u.mixin(b,a.getMarginBox(b.domNode)),u.mixin(b,c))}var f={marginBox2contentBox:function(b,c){var f=n.getComputedStyle(b),h=a.getMarginExtents(b,f),t=a.getPadBorderExtents(b,f);return{l:n.toPixelValue(b,f.paddingLeft),t:n.toPixelValue(b,f.paddingTop),w:c.w-
(h.w+t.w),h:c.h-(h.h+t.h)}},layoutChildren:function(a,f,p,n,x){f=u.mixin({},f);b.add(a,"dijitLayoutContainer");p=c.filter(p,function(a){return"center"!=a.region&&"client"!=a.layoutAlign}).concat(c.filter(p,function(a){return"center"==a.region||"client"==a.layoutAlign}));c.forEach(p,function(a){var c=a.domNode,e=a.region||a.layoutAlign;if(!e)throw Error("No region setting for "+a.id);var d=c.style;d.left=f.l+"px";d.top=f.t+"px";d.position="absolute";b.add(c,"dijitAlign"+v(e));c={};n&&n==a.id&&(c["top"==
a.region||"bottom"==a.region?"h":"w"]=x);"leading"==e&&(e=a.isLeftToRight()?"left":"right");"trailing"==e&&(e=a.isLeftToRight()?"right":"left");"top"==e||"bottom"==e?(c.w=f.w,h(a,c),f.h-=a.h,"top"==e?f.t+=a.h:d.top=f.t+f.h+"px"):"left"==e||"right"==e?(c.h=f.h,h(a,c),f.w-=a.w,"left"==e?f.l+=a.w:d.left=f.l+f.w+"px"):"client"!=e&&"center"!=e||h(a,f)})}};u.setObject("dijit.layout.utils",f);return f})},"dojo/html":function(){define("./_base/kernel ./_base/lang ./_base/array ./_base/declare ./dom ./dom-construct ./parser".split(" "),
function(c,b,a,n,u,v,h){var f=0,l={_secureForInnerHtml:function(a){return a.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"")},_emptyNode:v.empty,_setNodeContent:function(a,c){v.empty(a);if(c)if("number"==typeof c&&(c=c.toString()),"string"==typeof c&&(c=v.toDom(c,a.ownerDocument)),!c.nodeType&&b.isArrayLike(c))for(var f=c.length,h=0;h<c.length;h=f==c.length?h+1:0)v.place(c[h],a,"last");else v.place(c,a,"last");return a},_ContentSetter:n("dojo.html._ContentSetter",null,{node:"",
content:"",id:"",cleanContent:!1,extractContent:!1,parseContent:!1,parserScope:c._scopeName,startup:!0,constructor:function(a,c){b.mixin(this,a||{});c=this.node=u.byId(this.node||c);this.id||(this.id=["Setter",c?c.id||c.tagName:"",f++].join("_"))},set:function(a,b){void 0!==a&&(this.content=a);"number"==typeof a&&(a=a.toString());b&&this._mixin(b);this.onBegin();this.setContent();return(a=this.onEnd())&&a.then?a:this.node},setContent:function(){var a=this.node;if(!a)throw Error(this.declaredClass+
": setContent given no node");try{a=l._setNodeContent(a,this.content)}catch(w){var b=this.onContentError(w);try{a.innerHTML=b}catch(x){}}this.node=a},empty:function(){this.parseDeferred&&(this.parseDeferred.isResolved()||this.parseDeferred.cancel(),delete this.parseDeferred);this.parseResults&&this.parseResults.length&&(a.forEach(this.parseResults,function(a){a.destroy&&a.destroy()}),delete this.parseResults);v.empty(this.node)},onBegin:function(){var a=this.content;if(b.isString(a)&&(this.cleanContent&&
(a=l._secureForInnerHtml(a)),this.extractContent)){var c=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);c&&(a=c[1])}this.empty();this.content=a;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.parseDeferred;delete this.node;delete this.content},onContentError:function(a){return"Error occurred setting content: "+a},onExecError:function(a){return"Error occurred executing scripts: "+a},_mixin:function(a){var b=
{},c;for(c in a)c in b||(this[c]=a[c])},_parse:function(){var b=this.node;try{var c={};a.forEach(["dir","lang","textDir"],function(a){this[a]&&(c[a]=this[a])},this);var f=this;this.parseDeferred=h.parse({rootNode:b,noStart:!this.startup,inherited:c,scope:this.parserScope}).then(function(a){return f.parseResults=a},function(a){f._onError("Content",a,"Error parsing in _ContentSetter#"+f.id)})}catch(x){this._onError("Content",x,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(a,b,c){a=
this["on"+a+"Error"].call(this,b);c||a&&l._setNodeContent(this.node,a,!0)}}),set:function(a,c,f){void 0==c&&(c="");"number"==typeof c&&(c=c.toString());return f?(new l._ContentSetter(b.mixin(f,{content:c,node:a}))).set():l._setNodeContent(a,c,!0)}};b.setObject("dojo.html",l);return l})},"esri/Credential":function(){define(["dojo/_base/declare","dojo/has","./kernel","./IdentityManagerBase"],function(c,b,a,n){c=c(n.Credential,{});return a.Credential=c})},"esri/IdentityManagerBase":function(){define("dojo/_base/declare dojo/_base/config dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/sniff dojo/cookie dojo/io-query dojo/on dojo/regexp ./kernel ./config ./lang ./ServerInfo ./urlUtils ./deferredUtils ./request ./Evented ./OAuthCredential ./arcgis/OAuthInfo".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C){var D={},z=function(a){var b=(new h(a.owningSystemUrl)).host;a=(new h(a.server)).host;var c=/.+\.arcgis\.com$/i;return c.test(b)&&c.test(a)},J=function(a,b){return!!(z(a)&&b&&n.some(b,function(b){return b.test(a.server)}))},F,T=c(G,{declaredClass:"esri.IdentityManagerBase",constructor:function(){this._portalConfig=a.getObject("esriGeowConfig");this.serverInfos=[];this.oAuthInfos=[];this.credentials=[];this._soReqs=[];this._xoReqs=[];this._portals=
[];this._getOAuthHash();p(window,"pageshow",a.hitch(this,this._pageShowHandler))},defaultOAuthInfo:null,defaultTokenValidity:60,tokenValidity:null,signInPage:null,useSignInPage:!0,normalizeWebTierAuth:!1,_busy:null,_rejectOnPersistedPageShow:!1,_oAuthHash:null,_gwTokenUrl:"/sharing/generateToken",_agsRest:"/rest/services",_agsPortal:/\/sharing(\/|$)/i,_agsAdmin:/https?:\/\/[^\/]+\/[^\/]+\/admin\/?(\/.*)?$/i,_adminSvcs:/\/admin\/services(\/|$)/i,_agolSuffix:".arcgis.com",_gwDomains:[{regex:/https?:\/\/www\.arcgis\.com/i,
tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/dev\.arcgis\.com/i,tokenServiceUrl:"https://dev.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*dev[^.]*\.arcgis\.com/i,tokenServiceUrl:"https://devext.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*qa[^.]*\.arcgis\.com/i,tokenServiceUrl:"https://qaext.arcgis.com/sharing/generateToken"},{regex:/https?:\/\/.*.arcgis\.com/i,tokenServiceUrl:"https://www.arcgis.com/sharing/generateToken"}],_legacyFed:[],
_regexSDirUrl:/http.+\/rest\/services\/?/ig,_regexServerType:/(\/(MapServer|GeocodeServer|GPServer|GeometryServer|ImageServer|NAServer|FeatureServer|GeoDataServer|GlobeServer|MobileServer|GeoenrichmentServer|VectorTileServer)).*/ig,_gwUser:/http.+\/users\/([^\/]+)\/?.*/i,_gwItem:/http.+\/items\/([^\/]+)\/?.*/i,_gwGroup:/http.+\/groups\/([^\/]+)\/?.*/i,_errorCodes:[499,498,403,401],_rePortalTokenSvc:/\/sharing(\/rest)?\/generatetoken/i,_publicUrls:[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,
/\/rest\/info/i],_createDefaultOAuthInfo:!0,_hasTestedIfAppIsOnPortal:!1,registerServers:function(a){var b=this.serverInfos;b?(a=n.filter(a,function(a){return!this.findServerInfo(a.server)},this),this.serverInfos=b.concat(a)):this.serverInfos=a;n.forEach(a,function(a){a.owningSystemUrl&&this._portals.push(a.owningSystemUrl);if(a.hasPortal){this._portals.push(a.server);var b=e.defaults.io.corsEnabledServers,c=this._getOrigin(a.tokenServiceUrl);d.canUseXhr(a.server)||b.push(a.server.replace(/^https?:\/\//i,
""));d.canUseXhr(c)||b.push(c.replace(/^https?:\/\//i,""))}},this)},registerOAuthInfos:function(a){var b=this.oAuthInfos;b?(a=n.filter(a,function(a){return!this.findOAuthInfo(a.portalUrl)},this),this.oAuthInfos=b.concat(a)):this.oAuthInfos=a},registerToken:function(b){var c=this._sanitizeUrl(b.server),d=this.findServerInfo(c),e=!0,k;d||(d=new g,d.server=this._getServerInstanceRoot(c),d.tokenServiceUrl=this._getTokenSvcUrl(c),d.hasPortal=!0,this.registerServers([d]));(k=this.findCredential(c,b.userId))?
(a.mixin(k,b),e=!1):(k=new F({userId:b.userId,server:d.server,token:b.token,expires:b.expires,ssl:b.ssl,scope:this._isServerRsrc(c)?"server":"portal"}),k.resources=[c],this.credentials.push(k));k.onTokenChange(!1);e||k.refreshServerTokens()},toJson:function(){return m.fixJson({serverInfos:n.map(this.serverInfos,function(a){return a.toJson()}),oAuthInfos:n.map(this.oAuthInfos,function(a){return a.toJson()}),credentials:n.map(this.credentials,function(a){return a.toJson()})})},initialize:function(b){if(b){a.isString(b)&&
(b=v.fromJson(b));var c=b.serverInfos,d=b.oAuthInfos;b=b.credentials;if(c){var e=[];n.forEach(c,function(a){a.server&&a.tokenServiceUrl&&e.push(a.declaredClass?a:new g(a))});e.length&&this.registerServers(e)}if(d){var k=[];n.forEach(d,function(a){a.appId&&k.push(a.declaredClass?a:new C(a))});k.length&&this.registerOAuthInfos(k)}b&&n.forEach(b,function(a){a.userId&&a.server&&a.token&&a.expires&&a.expires>(new Date).getTime()&&(a=a.declaredClass?a:new F(a),a.onTokenChange(),this.credentials.push(a))},
this)}},findServerInfo:function(a){var b;a=this._sanitizeUrl(a);n.some(this.serverInfos,function(c){this._hasSameServerInstance(c.server,a)&&(b=c);return!!b},this);return b},findOAuthInfo:function(a){var b;a=this._sanitizeUrl(a);n.some(this.oAuthInfos,function(c){this._hasSameServerInstance(c.portalUrl,a)&&(b=c);return!!b},this);return b},findCredential:function(a,b){var c,d;a=this._sanitizeUrl(a);d=this._isServerRsrc(a)?"server":"portal";b?n.some(this.credentials,function(e){this._hasSameServerInstance(e.server,
a)&&b===e.userId&&e.scope===d&&(c=e);return!!c},this):n.some(this.credentials,function(b){this._hasSameServerInstance(b.server,a)&&-1!==this._getIdenticalSvcIdx(a,b)&&b.scope===d&&(c=b);return!!c},this);return c},getCredential:function(c,d){var e,k,f=!0;m.isDefined(d)&&(a.isObject(d)?(e=!!d.token,k=d.error,f=!1!==d.prompt):e=d);c=this._sanitizeUrl(c);var h=new u(y._dfdCanceller),B=this._isAdminResource(c),p=e&&this._doPortalSignIn(c)?this._getEsriAuthCookie():null;if((e=e?this.findCredential(c):null)&&
k&&498===k.code)e.destroy(),p&&p.token===d.token&&l("esri_auth",null,{expires:-1,path:"/",domain:document.domain});else if(p||e)return c=Error("You are currently signed in as: '"+(p&&p.email||e&&e.userId)+"'. You do not have access to this resource: "+c),c.code="IdentityManagerBase.1",c.httpCode=k&&k.httpCode,c.messageCode=k?k.messageCode:null,c.subcode=k?k.subcode:null,c.details=k?k.details:null,c.log=!!b.isDebug,h.errback(c),h;if(k=this._findCredential(c,d))return h.callback(k),h;k=this.findServerInfo(c);
if(k)!k.hasServer&&this._isServerRsrc(c)&&(k._restInfoDfd=this._getTokenSvcUrl(c,!0),k.hasServer=!0);else{p=this._getTokenSvcUrl(c);if(!p)return c=Error("Unknown resource - could not find token service endpoint."),c.code="IdentityManagerBase.2",c.log=!!b.isDebug,h.errback(c),h;k=new g;k.server=this._getServerInstanceRoot(c);a.isString(p)?(k.tokenServiceUrl=p,k.hasPortal=!0):(k._restInfoDfd=p,k.hasServer=!0);this.registerServers([k])}f&&k.hasPortal&&void 0===k._selfReq&&!this._findOAuthInfo(c)&&(k._selfReq=
{owningTenant:d&&d.owningTenant,selfDfd:this._getPortalSelf(k.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),c)});return this._enqueue(c,k,d,h,B)},getResourceName:function(a){return this._isRESTService(a)?a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(a)&&a.replace(this._gwUser,"$1")||this._gwItem.test(a)&&a.replace(this._gwItem,"$1")||this._gwGroup.test(a)&&a.replace(this._gwGroup,"$1")||""},generateToken:function(c,e,g){var f,
m,y,l,p,B,t=this._rePortalTokenSvc.test(c.tokenServiceUrl),n=new h(window.location.href.toLowerCase()),z=this._getEsriAuthCookie(),u,G=!e;l=c.shortLivedTokenValidity;var w;e&&(w=x.id.tokenValidity||l||x.id.defaultTokenValidity,w>l&&(w=l));g&&(f=g.isAdmin,m=g.serverUrl,y=g.token,B=g.ssl,c.customParameters=g.customParameters);f?l=c.adminTokenServiceUrl:(l=c.tokenServiceUrl,p=new h(l.toLowerCase()),z&&(u=(u=z.auth_tier)&&u.toLowerCase()),("web"===u||c.webTierAuth)&&g&&g.serverUrl&&!B&&"http"===n.scheme&&
(d.hasSameOrigin(n.uri,l,!0)||"https"===p.scheme&&n.host===p.host&&"7080"===n.port&&"7443"===p.port)&&(l=l.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),G&&t&&(l=l.replace(/\/rest/i,"")));f=a.mixin({url:l,content:a.mixin({request:"getToken",username:e&&e.username,password:e&&e.password,serverUrl:m,token:y,expiration:w,referer:f||t?window.location.host:null,client:f?"referer":null,f:"json"},c.customParameters),handleAs:"json",callbackParamName:G?"callback":void 0},g&&g.ioArgs);g={usePost:!G,
disableIdentityLookup:!0,useProxy:this._useProxy(c,g)};t||(f.withCredentials=!1);t=k(f,g);t.addCallback(function(a){if(!a||!a.token)return a=Error("Unable to generate token"),a.code="IdentityManagerBase.3",a.log=!!b.isDebug,a;var d=c.server;D[d]||(D[d]={});e&&(D[d][e.username]=e.password);a.validity=w;return a});t.addErrback(function(a){});return t},isBusy:function(){return!!this._busy},checkSignInStatus:function(a){var c=new u;this.getCredential(a,{prompt:!1}).then(function(a){return a.token?k({url:a.server+
("portal"===a.scope?"/sharing/rest":"/rest/services"),content:{f:"json",token:a.token},callbackParamName:"callback"},{disableIdentityLookup:!0}).then(function(){return a}).otherwise(function(c){if(498===c.code)throw a.destroy(),c=Error("User is not signed in."),c.code="IdentityManagerBase.6",c.log=!!b.isDebug,c;return a}):a}).then(function(a){c.resolve(a)}).otherwise(function(a){c.reject(a)});return c},setRedirectionHandler:function(a){this._redirectFunc=a},setProtocolErrorHandler:function(a){this._protocolFunc=
a},signIn:function(){},oAuthSignIn:function(){},onCredentialCreate:function(){},onCredentialsDestroy:function(){},destroyCredentials:function(){if(this.credentials){var a=this.credentials.slice();n.forEach(a,function(a){a.destroy()})}this.onCredentialsDestroy()},_getOAuthHash:function(){var a=window.location.hash;if(a){"#"===a.charAt(0)&&(a=a.substring(1));var a=t.queryToObject(a),b=!1;a.access_token&&a.expires_in&&a.state&&a.hasOwnProperty("username")?(a.state=v.fromJson(a.state),this._oAuthHash=
a,b=!0):a.error&&a.error_description&&"access_denied"===a.error&&(b=!0);b&&(!f("ie")||8<f("ie"))&&(window.location.hash="")}},_pageShowHandler:function(a){a.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow&&(a=Error("ABORTED"),a.code="IdentityManager.2",a.log=!!b.isDebug,this._errbackFunc(a))},_findCredential:function(a,b){var c=-1,d,e,k,g=b&&b.token;b=b&&b.resource;var f=this._isServerRsrc(a)?"server":"portal",m=n.filter(this.credentials,function(b){return this._hasSameServerInstance(b.server,
a)&&b.scope===f},this);a=b||a;if(m.length)if(1===m.length)if(b=m[0],e=(d=(k=this.findServerInfo(b.server))&&k.owningSystemUrl)&&this.findCredential(d,b.userId),c=this._getIdenticalSvcIdx(a,b),g)-1!==c&&(b.resources.splice(c,1),this._removeResource(a,e));else return-1===c&&b.resources.push(a),this._addResource(a,e),b;else{var h,y;n.some(m,function(b){y=this._getIdenticalSvcIdx(a,b);return-1!==y?(h=b,e=(d=(k=this.findServerInfo(h.server))&&k.owningSystemUrl)&&this.findCredential(d,h.userId),c=y,!0):
!1},this);if(g)h&&(h.resources.splice(c,1),this._removeResource(a,e));else if(h)return this._addResource(a,e),h}},_findOAuthInfo:function(a){var b=this.findOAuthInfo(a);b||n.some(this.oAuthInfos,function(c){this._isIdProvider(c.portalUrl,a)&&(b=c);return!!b},this);return b},_addResource:function(a,b){b&&-1===this._getIdenticalSvcIdx(a,b)&&b.resources.push(a)},_removeResource:function(a,b){var c=-1;b&&(c=this._getIdenticalSvcIdx(a,b),-1<c&&b.resources.splice(c,1))},_useProxy:function(a,b){return b&&
b.isAdmin&&!d.hasSameOrigin(a.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(a.tokenServiceUrl)&&10.1==a.currentVersion&&!d.hasSameOrigin(a.tokenServiceUrl,window.location.href)},_getOrigin:function(a){a=new h(a);return a.scheme+"://"+a.host+(m.isDefined(a.port)?":"+a.port:"")},_getServerInstanceRoot:function(a){var b=a.toLowerCase(),c=b.indexOf(this._agsRest);-1===c&&this._isAdminResource(a)&&(c=b.indexOf("/admin"));-1===c&&(c=b.indexOf("/sharing"));-1===c&&"/"===b.substr(-1)&&
(c=b.length-1);return-1<c?a.substring(0,c):a},_hasSameServerInstance:function(a,b){"/"===a.substr(-1)&&(a=a.slice(0,-1));a=a.toLowerCase();b=this._getServerInstanceRoot(b).toLowerCase();a=this._normalizeAGOLorgDomain(a);b=this._normalizeAGOLorgDomain(b);a=a.substr(a.indexOf(":"));b=b.substr(b.indexOf(":"));return a===b},_normalizeAGOLorgDomain:function(a){var b=/^https?:\/\/.+\.maps\.arcgis\.com/i,c=/^https?:\/\/.+\.mapsdevext\.arcgis\.com/i,d=/^https?:\/\/.+\.mapsqa\.arcgis\.com/i;b.test(a)?a=a.replace(b,
"https://www.arcgis.com"):c.test(a)?a=a.replace(c,"https://devext.arcgis.com"):d.test(a)&&(a=a.replace(d,"https://qaext.arcgis.com"));return a},_sanitizeUrl:function(a){var b=(e.defaults.io.proxyUrl||"").toLowerCase(),c=b?a.toLowerCase().indexOf(b+"?"):-1;-1!==c&&(a=a.substring(c+b.length+1));a=d.normalize(a);return d.urlToObject(a).path},_isRESTService:function(a){return-1<a.indexOf(this._agsRest)},_isAdminResource:function(a){return this._agsAdmin.test(a)||this._adminSvcs.test(a)},_isServerRsrc:function(a){return this._isRESTService(a)||
this._isAdminResource(a)},_isIdenticalService:function(a,b){var c;this._isRESTService(a)&&this._isRESTService(b)?(a=this._getSuffix(a).toLowerCase(),b=this._getSuffix(b).toLowerCase(),c=a===b,c||(c=/(.*)\/(MapServer|FeatureServer).*/ig,c=a.replace(c,"$1")===b.replace(c,"$1"))):this._isAdminResource(a)&&this._isAdminResource(b)?c=!0:this._isServerRsrc(a)||this._isServerRsrc(b)||!this._isPortalDomain(a)||(c=!0);return c},_isPortalDomain:function(b){b=b.toLowerCase();var c=(new h(b)).authority,d=this._portalConfig,
e=-1!==c.indexOf(this._agolSuffix);!e&&d&&(e=this._hasSameServerInstance(this._getServerInstanceRoot(d.restBaseUrl),b));e||(!this._arcgisUrl&&(d=a.getObject("esri.arcgis.utils.arcgisUrl"))&&(this._arcgisUrl=(new h(d)).authority),this._arcgisUrl&&(e=this._arcgisUrl.toLowerCase()===c));e||(e=n.some(this._portals,function(a){return this._hasSameServerInstance(a,b)},this));return e=e||this._agsPortal.test(b)},_isIdProvider:function(a,b){var c=-1,d=-1;n.forEach(this._gwDomains,function(e,k){-1===c&&e.regex.test(a)&&
(c=k);-1===d&&e.regex.test(b)&&(d=k)});var e=!1;if(-1<c&&-1<d)if(0===c||4===c){if(0===d||4===d)e=!0}else if(1===c){if(1===d||2===d)e=!0}else 2===c?2===d&&(e=!0):3===c&&3===d&&(e=!0);if(!e){var k=this.findServerInfo(b),g=k&&k.owningSystemUrl;g&&z(k)&&this._isPortalDomain(g)&&this._isIdProvider(a,g)&&(e=!0)}return e},_isPublic:function(a){a=this._sanitizeUrl(a);return n.some(this._publicUrls,function(b){return b.test(a)})},_getIdenticalSvcIdx:function(a,b){var c=-1;n.some(b.resources,function(b,d){return this._isIdenticalService(a,
b)?(c=d,!0):!1},this);return c},_getSuffix:function(a){return a.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")},_getTokenSvcUrl:function(a){var b,c;if((b=this._isRESTService(a))||this._isAdminResource(a))return c=a.toLowerCase().indexOf(b?this._agsRest:"/admin/"),b=a.substring(0,c)+"/admin/generateToken",a=a.substring(0,c)+"/rest/info",c=k({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c.adminUrl_=b,c;if(this._isPortalDomain(a)){var d="";n.some(this._gwDomains,
function(b){b.regex.test(a)&&(d=b.tokenServiceUrl);return!!d});d||n.some(this._portals,function(b){this._hasSameServerInstance(b,a)&&(d=b+this._gwTokenUrl);return!!d},this);d||(c=a.toLowerCase().indexOf("/sharing"),-1!==c&&(d=a.substring(0,c)+this._gwTokenUrl));d||(d=this._getOrigin(a)+this._gwTokenUrl);d&&(b=(new h(a)).port,/^http:\/\//i.test(a)&&"7080"===b&&(d=d.replace(/:7080/i,":7443")),d=d.replace(/http:/i,"https:"));return d}if(-1!==a.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"},
_getPortalSelf:function(a,b){"https:"===window.location.protocol?a=a.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(b)&&(a=a.replace(/^https:/i,"http:").replace(/:7443/i,":7080"));return k({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"},{crossOrigin:!1,disableIdentityLookup:!0})},_hasPortalSession:function(){return!!this._getEsriAuthCookie()},_getEsriAuthCookie:function(){var a=null;if(l.isSupported()){var b=this._getAllCookies("esri_auth"),c;for(c=0;c<
b.length;c++){var d=v.fromJson(b[c]);if(d.portalApp){a=d;break}}}a&&(b=null,a.expires&&("number"===typeof a.expires?b=a.expires:"string"===typeof a.expires&&(b=Date.parse(a.expires)),isNaN(b)&&(b=null),a.expires=b),b&&b<(new Date).getTime()&&(a=null));return a},_getAllCookies:function(a){var b=[],c=document.cookie.match(new RegExp("(?:^|; )"+w.escapeString(a)+"\x3d([^;]*)","g"));if(c)for(a=0;a<c.length;a++){var d=c[a],e=d.indexOf("\x3d");-1<e&&(d=d.substring(e+1),b.push(decodeURIComponent(d)))}return b},
_doPortalSignIn:function(a){if(l.isSupported()){var b=this._getEsriAuthCookie(),c=this._portalConfig,e=window.location.href,k=this.findServerInfo(a);if(this.useSignInPage&&(c||this._isPortalDomain(e)||b)&&(k?k.hasPortal||k.owningSystemUrl&&this._isPortalDomain(k.owningSystemUrl):this._isPortalDomain(a))&&(this._isIdProvider(e,a)||c&&(this._hasSameServerInstance(this._getServerInstanceRoot(c.restBaseUrl),a)||this._isIdProvider(c.restBaseUrl,a))||d.hasSameOrigin(e,a,!0)))return!0}return!1},_checkProtocol:function(c,
k,g,f){var m=!0;f=f?k.adminTokenServiceUrl:k.tokenServiceUrl;0!==a.trim(f).toLowerCase().indexOf("https:")||0===window.location.href.toLowerCase().indexOf("https:")||e.defaults.io.useCors&&(d.canUseXhr(f)||d.canUseXhr(d.getProxyUrl(!0).path))||(m=this._protocolFunc?!!this._protocolFunc({resourceUrl:c,serverInfo:k}):!1,m||(c=Error("Aborted the Sign-In process to avoid sending password over insecure connection."),c.code="IdentityManagerBase.4",c.log=!!b.isDebug,g(c)));return m},_enqueue:function(a,
b,c,d,e,k){d||(d=new u(y._dfdCanceller));d.resUrl_=a;d.sinfo_=b;d.options_=c;d.admin_=e;d.refresh_=k;this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(a),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(d)):this._xoReqs.push(d):this._doSignIn(d);return d},_doSignIn:function(c){this._busy=c;this._rejectOnPersistedPageShow=!1;var d=this,e=function(a){var b=c.options_&&c.options_.resource,e=c.resUrl_,k=c.refresh_,g=!1;
-1===n.indexOf(d.credentials,a)&&(k&&-1!==n.indexOf(d.credentials,k)?(k.userId=a.userId,k.token=a.token,k.expires=a.expires,k.validity=a.validity,k.ssl=a.ssl,k.creationTime=a.creationTime,g=!0,a=k):d.credentials.push(a));a.resources||(a.resources=[]);a.resources.push(b||e);a.scope=d._isServerRsrc(e)?"server":"portal";a.onTokenChange();var b=d._soReqs,f={};d._soReqs=[];n.forEach(b,function(b){if(!this._isIdenticalService(e,b.resUrl_)){var c=this._getSuffix(b.resUrl_);f[c]||(f[c]=!0,a.resources.push(b.resUrl_))}},
d);c.callback(a);n.forEach(b,function(b){this._hasSameServerInstance(this._getServerInstanceRoot(e),b.resUrl_)?b.callback(a):this._soReqs.push(b)},d);d._busy=c.resUrl_=c.sinfo_=c.refresh_=null;if(!g)d.onCredentialCreate({credential:a});d._soReqs.length?d._doSignIn(d._soReqs.shift()):d._xoReqs.length&&d._doSignIn(d._xoReqs.shift())},k=function(a){c.errback(a);d._busy=c.resUrl_=c.sinfo_=c.refresh_=null;d._soReqs.length?d._doSignIn(d._soReqs.shift()):d._xoReqs.length&&d._doSignIn(d._xoReqs.shift())},
g=function(a,g,f,h){var y=c.sinfo_,l=!c.options_||!1!==c.options_.prompt,p=y.hasPortal&&d._findOAuthInfo(c.resUrl_);d._doPortalSignIn(c.resUrl_)?(a=d._getEsriAuthCookie(),p=d._portalConfig,a?e(new F({userId:a.email,server:y.server,token:a.token,expires:a.expires})):l?(l="",a=window.location.href,l=d.signInPage?d.signInPage:p?p.baseUrl+p.signin:d._isIdProvider(a,c.resUrl_)?d._getOrigin(a)+"/home/signin.html":y.tokenServiceUrl.replace(d._rePortalTokenSvc,"")+"/home/signin.html",l=l.replace(/http:/i,
"https:"),p&&!1===p.useSSL&&(l=l.replace(/https:/i,"http:")),0===a.toLowerCase().replace("https","http").indexOf(l.toLowerCase().replace("https","http"))?(y=Error("Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: "+c.resUrl_),y.code="IdentityManagerBase.5",y.log=!!b.isDebug,k(y)):(d._rejectOnPersistedPageShow=!0,d._redirectFunc?d._redirectFunc({signInPage:l,returnUrlParamName:"returnUrl",returnUrl:a,resourceUrl:c.resUrl_,serverInfo:y}):window.location=
l+"?returnUrl\x3d"+window.escape(a))):(y=Error("User is not signed in."),y.code="IdentityManagerBase.6",y.log=!!b.isDebug,k(y))):a?e(new F({userId:a,server:y.server,token:f,expires:m.isDefined(h)?Number(h):null,ssl:!!g})):p?(a=p._oAuthCred,a||(g=new E(p,window.localStorage),f=new E(p,window.sessionStorage),g.isValid()&&f.isValid()?g.expires>f.expires?(a=g,f.destroy()):(a=f,g.destroy()):a=g.isValid()?g:f,p._oAuthCred=a),a.isValid()?e(new F({userId:a.userId,server:y.server,token:a.token,expires:a.expires,
ssl:a.ssl,_oAuthCred:a})):d._oAuthHash&&d._oAuthHash.state.portalUrl===p.portalUrl?(l=d._oAuthHash,y=new F({userId:l.username,server:y.server,token:l.access_token,expires:(new Date).getTime()+1E3*Number(l.expires_in),ssl:"true"===l.ssl,oAuthState:l.state,_oAuthCred:a}),a.storage=l.persist?window.localStorage:window.sessionStorage,a.token=y.token,a.expires=y.expires,a.userId=y.userId,a.ssl=y.ssl,a.save(),d._oAuthHash=null,e(y)):l?c._pendingDfd=d.oAuthSignIn(c.resUrl_,y,p,c.options_).addCallbacks(e,
k):(y=Error("User is not signed in."),y.code="IdentityManagerBase.6",y.log=!!b.isDebug,k(y))):l?d._checkProtocol(c.resUrl_,y,k,c.admin_)&&(l=c.options_,c.admin_&&(l=l||{},l.isAdmin=!0),c._pendingDfd=d.signIn(c.resUrl_,y,l).addCallbacks(e,k)):(y=Error("User is not signed in."),y.code="IdentityManagerBase.6",y.log=!!b.isDebug,k(y))},f=function(){var a=c.sinfo_,b=a.owningSystemUrl,g=c.options_,f,h,y,l;g&&(f=g.token,h=g.error,y=g.prompt);(l=d._findCredential(b,{token:f,resource:c.resUrl_}))||n.some(d.credentials,
function(a){this._isIdProvider(b,a.server)&&(l=a);return!!l},d);l?(g=d.findCredential(c.resUrl_,l.userId))?e(g):J(a,d._legacyFed)?(g=l.toJson(),g.server=a.server,g.resources=null,e(new F(g))):(c._pendingDfd=d.generateToken(d.findServerInfo(l.server),null,{serverUrl:c.resUrl_,token:l.token,ssl:l.ssl})).addCallbacks(function(b){e(new F({userId:l.userId,server:a.server,token:b.token,expires:m.isDefined(b.expires)?Number(b.expires):null,ssl:!!b.ssl,isAdmin:c.admin_,validity:b.validity}))},k):(d._busy=
null,f&&(c.options_.token=null),(c._pendingDfd=d.getCredential(b.replace(/\/?$/,"/sharing"),{resource:c.resUrl_,owningTenant:a.owningTenant,token:f,error:h,prompt:y})).addCallbacks(function(a){d._enqueue(c.resUrl_,c.sinfo_,c.options_,c,c.admin_)},function(a){k(a)}))};this._errbackFunc=k;var h=c.sinfo_.owningSystemUrl,y=this._isServerRsrc(c.resUrl_),l=c.sinfo_._restInfoDfd;l?l.addCallbacks(function(b){var e=c.sinfo_;e.adminTokenServiceUrl=e._restInfoDfd.adminUrl_;e._restInfoDfd=null;e.tokenServiceUrl=
a.getObject("authInfo.tokenServicesUrl",!1,b)||a.getObject("authInfo.tokenServiceUrl",!1,b)||a.getObject("tokenServiceUrl",!1,b);e.shortLivedTokenValidity=a.getObject("authInfo.shortLivedTokenValidity",!1,b);e.currentVersion=b.currentVersion;e.owningTenant=b.owningTenant;(b=e.owningSystemUrl=b.owningSystemUrl)&&d._portals.push(b);y&&b?f():g()},function(){c.sinfo_._restInfoDfd=null;var a=Error("Unknown resource - could not find token service endpoint.");a.code="IdentityManagerBase.2";a.log=!!b.isDebug;
k(a)}):y&&h?f():c.sinfo_._selfReq?c.sinfo_._selfReq.selfDfd.then(function(a){var b={},e,k,g,f;a&&(e=a.user&&a.user.username,b.username=e,b.allSSL=a.allSSL,k=a.supportsOAuth,g=a.currentVersion,"multitenant"===a.portalMode&&(f=a.customBaseUrl));c.sinfo_.webTierAuth=!!e;return e&&d.normalizeWebTierAuth?d.generateToken(c.sinfo_,null,{ssl:b.allSSL}).addBoth(function(a){b.portalToken=a&&a.token;b.tokenExpiration=a&&a.expires;return b}):!e&&k&&4.4<=parseFloat(g)&&!d._doPortalSignIn(c.resUrl_)?d._generateOAuthInfo({portalUrl:c.sinfo_.server,
customBaseUrl:f,owningTenant:c.sinfo_._selfReq.owningTenant}).always(function(){return b}):b}).always(function(a){c.sinfo_._selfReq=null;a?g(a.username,a.allSSL,a.portalToken,a.tokenExpiration):g()}):g()},_generateOAuthInfo:function(a){var b=this,c,e=a.portalUrl,g=a.customBaseUrl,f=a.owningTenant;if(a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal){c=window.location.href;var m=c.indexOf("?");-1<m&&(c=c.slice(0,m));m=c.search(/\/(apps|home)\//);c=-1<m?c.slice(0,
m):null}a&&c?(this._hasTestedIfAppIsOnPortal=!0,a=k({url:c+"/sharing/rest",content:{f:"json"},handleAs:"json"}).then(function(){b.defaultOAuthInfo=new C({appId:"arcgisonline",popup:!0,popupCallbackUrl:c+"/home/oauth-callback.html"})})):(a=new u,a.resolve(),a=a.promise);return a.then(function(){if(b.defaultOAuthInfo)return e=e.replace(/^http:/i,"https:"),k({url:e+"/sharing/rest/oauth2/validateRedirectUri",content:{accountId:f,client_id:b.defaultOAuthInfo.appId,redirect_uri:d.getAbsoluteUrl(b.defaultOAuthInfo.popupCallbackUrl),
f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){if(a.valid){var c=b.defaultOAuthInfo.clone();c.portalUrl=a.urlKey&&g?"https://"+a.urlKey+"."+g:e;b.oAuthInfos.push(c)}})})}});F=c(G,{declaredClass:"esri.Credential",tokenRefreshBuffer:2,constructor:function(b){a.mixin(this,b);this.resources=this.resources||[];m.isDefined(this.creationTime)||(this.creationTime=(new Date).getTime())},_oAuthCred:null,refreshToken:function(){var a=this,b=this.resources&&this.resources[0],c=x.id.findServerInfo(this.server),
d=c&&c.owningSystemUrl,e=!!d&&"server"===this.scope,k=e&&J(c,x.id._legacyFed),g=e&&x.id.findServerInfo(d),f,h=(f=c.webTierAuth)&&x.id.normalizeWebTierAuth,y=D[this.server],y=y&&y[this.userId],l={username:this.userId,password:y},p;if(!f||h)if(e&&!g&&n.some(x.id.serverInfos,function(a){x.id._isIdProvider(d,a.server)&&(g=a);return!!g}),f=g&&x.id.findCredential(g.server,this.userId),!e||f)if(k)f.refreshToken();else{if(e)p={serverUrl:b,token:f&&f.token,ssl:f&&f.ssl};else if(h)l=null,p={ssl:this.ssl};else if(y)this.isAdmin&&
(p={isAdmin:!0});else{var t;b&&(b=x.id._sanitizeUrl(b),this._enqueued=1,t=x.id._enqueue(b,c,null,null,this.isAdmin,this),t.addCallback(function(){a._enqueued=0;a.refreshServerTokens()}).addErrback(function(){a._enqueued=0}));return t}return x.id.generateToken(e?g:c,e?null:l,p).addCallback(function(b){a.token=b.token;a.expires=m.isDefined(b.expires)?Number(b.expires):null;a.creationTime=(new Date).getTime();a.validity=b.validity;a.onTokenChange();a.refreshServerTokens()}).addErrback(function(){})}},
refreshServerTokens:function(){"portal"===this.scope&&n.forEach(x.id.credentials,function(a){var b=x.id.findServerInfo(a.server),c=b&&b.owningSystemUrl;a!==this&&a.userId===this.userId&&c&&"server"===a.scope&&(x.id._hasSameServerInstance(this.server,c)||x.id._isIdProvider(c,this.server))&&(J(b,x.id._legacyFed)?(a.token=this.token,a.expires=this.expires,a.creationTime=this.creationTime,a.validity=this.validity,a.onTokenChange()):a.refreshToken())},this)},onTokenChange:function(a){clearTimeout(this._refreshTimer);
var b=this.server&&x.id.findServerInfo(this.server),c=(b=b&&b.owningSystemUrl)&&x.id.findServerInfo(b);!1!==a&&(!b||"portal"===this.scope||c&&c.webTierAuth&&!x.id.normalizeWebTierAuth)&&(m.isDefined(this.expires)||m.isDefined(this.validity))&&this._startRefreshTimer()},onDestroy:function(){},destroy:function(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null;this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);var a=n.indexOf(x.id.credentials,
this);-1<a&&x.id.credentials.splice(a,1);this.onTokenChange();this.onDestroy()},toJson:function(){return this._toJson()},_toJson:function(){var a=m.fixJson({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),b=this.resources;b&&0<b.length&&(a.resources=b.slice());return a},_startRefreshTimer:function(){clearTimeout(this._refreshTimer);var b=6E4*this.tokenRefreshBuffer,
c=(this.validity?this.creationTime+6E4*this.validity:this.expires)-(new Date).getTime();0>c&&(c=0);this._refreshTimer=setTimeout(a.hitch(this,this.refreshToken),c>b?c-b:c)}});T.Credential=F;return x.IdentityManagerBase=T})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(c,b){c.cookie=function(a,c,u){var n=document.cookie,h;if(1==arguments.length)h=(h=n.match(new RegExp("(?:^|; )"+b.escapeString(a)+"\x3d([^;]*)")))?decodeURIComponent(h[1]):void 0;else{u=u||{};n=u.expires;if("number"==
typeof n){var f=new Date;f.setTime(f.getTime()+864E5*n);n=u.expires=f}n&&n.toUTCString&&(u.expires=n.toUTCString());c=encodeURIComponent(c);var n=a+"\x3d"+c,l;for(l in u)n+="; "+l,f=u[l],!0!==f&&(n+="\x3d"+f);document.cookie=n}return h};c.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};
return c.cookie})},"esri/ServerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./kernel","./lang"],function(c,b,a,n,u){c=c(null,{declaredClass:"esri.ServerInfo",constructor:function(a){b.mixin(this,a)},toJson:function(){return u.fixJson({server:this.server,tokenServiceUrl:this.tokenServiceUrl,adminTokenServiceUrl:this.adminTokenServiceUrl,shortLivedTokenValidity:this.shortLivedTokenValidity,owningSystemUrl:this.owningSystemUrl,owningTenant:this.owningTenant,currentVersion:this.currentVersion,
hasPortal:this.hasPortal,hasServer:this.hasServer,webTierAuth:this.webTierAuth})}});return n.ServerInfo=c})},"esri/OAuthCredential":function(){define(["./kernel","dojo/_base/declare","dojo/has","dojo/json"],function(c,b,a,n){b=b(null,{declaredClass:"esri.OAuthCredential",oAuthInfo:null,storage:null,expires:null,ssl:null,token:null,userId:null,constructor:function(a,b){this.oAuthInfo=a;this.storage=b;this._init()},isValid:function(){var a=!1;if(this.oAuthInfo&&this.token&&this.userId){var b=(new Date).getTime();
this.expires>b&&(this.expires-b)/1E3>60*this.oAuthInfo.minTimeUntilExpiration&&(a=!0)}return a},save:function(){if(this.storage){var a=this._load(),b=this.oAuthInfo;if(b&&b.authNamespace&&b.portalUrl){var c=a[b.authNamespace];c||(c=a[b.authNamespace]={});c[b.portalUrl]={expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem("esriJSAPIOAuth",n.stringify(a))}catch(f){}}}},destroy:function(){var a=this._load(),b=this.oAuthInfo;if(b&&b.authNamespace&&b.portalUrl&&
this.storage){var c=a[b.authNamespace];if(c){delete c[b.portalUrl];try{this.storage.setItem("esriJSAPIOAuth",n.stringify(a))}catch(f){}}}b&&(this.oAuthInfo=b._oAuthCred=null)},_init:function(){var a=this._load(),b=this.oAuthInfo;b&&b.authNamespace&&b.portalUrl&&(a=a[b.authNamespace])&&(a=a[b.portalUrl])&&(this.expires=a.expires,this.ssl=a.ssl,this.token=a.token,this.userId=a.userId)},_load:function(){var a={};if(this.storage){var b=this.storage.getItem("esriJSAPIOAuth");if(b)try{a=n.parse(b)}catch(h){}}return a}});
return c.OAuthCredential=b})},"esri/arcgis/OAuthInfo":function(){define(["../kernel","../lang","dojo/_base/declare","dojo/_base/lang","dojo/has"],function(c,b,a,n,u){var v=a(null,{declaredClass:"esri.arcgis.OAuthInfo",constructor:function(a){n.mixin(this,{expiration:20160,minTimeUntilExpiration:30,portalUrl:"https://www.arcgis.com",authNamespace:"/",forceLogin:!1,popup:!1,popupCallbackUrl:"oauth-callback.html",popupWindowFeatures:"height\x3d490,width\x3d800,resizable,scrollbars,status"},a)},_oAuthCred:null,
toJson:function(){return b.fixJson({appId:this.appId,expiration:this.expiration,locale:this.locale,minTimeUntilExpiration:this.minTimeUntilExpiration,portalUrl:this.portalUrl,authNamespace:this.authNamespace,forceLogin:this.forceLogin,popup:this.popup,popupCallbackUrl:this.popupCallbackUrl,popupWindowFeatures:this.popupWindowFeatures})},clone:function(){return new v(this.toJson())}});n.setObject("arcgis.OAuthInfo",v,c);return v})},"dijit/form/Form":function(){define("dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/sniff ../_Widget ../_TemplatedMixin ./_FormMixin ../layout/_ContentPaneResizeMixin".split(" "),
function(c,b,a,n,u,v,h,f){return c("dijit.form.Form",[u,v,h,f],{name:"",action:"",method:"",encType:"","accept-charset":"",accept:"",target:"",templateString:"\x3cform data-dojo-attach-point\x3d'containerNode' data-dojo-attach-event\x3d'onreset:_onReset,onsubmit:_onSubmit' ${!nameAttrSetting}\x3e\x3c/form\x3e",postMixInProperties:function(){this.nameAttrSetting=this.name?"name\x3d'"+this.name+"'":"";this.inherited(arguments)},execute:function(){},onExecute:function(){},_setEncTypeAttr:function(a){b.set(this.domNode,
"encType",a);n("ie")&&(this.domNode.encoding=a);this._set("encType",a)},reset:function(a){var b={returnValue:!0,preventDefault:function(){this.returnValue=!1},stopPropagation:function(){},currentTarget:a?a.target:this.domNode,target:a?a.target:this.domNode};!1!==this.onReset(b)&&b.returnValue&&this.inherited(arguments,[])},onReset:function(){return!0},_onReset:function(a){this.reset(a);a.stopPropagation();a.preventDefault();return!1},_onSubmit:function(b){var c=this.constructor.prototype;if(this.execute!=
c.execute||this.onExecute!=c.onExecute)a.deprecated("dijit.form.Form:execute()/onExecute() are deprecated. Use onSubmit() instead.","","2.0"),this.onExecute(),this.execute(this.getValues());!1===this.onSubmit(b)&&(b.stopPropagation(),b.preventDefault())},onSubmit:function(){return this.isValid()},submit:function(){!1!==this.onSubmit()&&this.containerNode.submit()}})})},"esri/OAuthSignInHandler":function(){define("./Credential ./domUtils ./lang ./urlUtils dijit/Dialog dijit/registry dojo/_base/config dojo/_base/Deferred dojo/_base/kernel dojo/dom-attr dojo/i18n!./nls/jsapi dojo/io-query dojo/sniff dojo/json dijit/form/Button dojo/query".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e){return{_oAuthDfd:null,_oAuthIntervalId:0,_oAuthDialogContent:"\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${oAuthInfo}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e",
setOAuthRedirectionHandler:function(a){this._oAuthRedirectFunc=a},oAuthSignIn:function(a,c,d,e){var k=this._oAuthDfd=new f;k.resUrl_=a;k.sinfo_=c;k.oinfo_=d;var g=!e||!1!==e.oAuthPopupConfirmation;if(!d.popup||!g)return this._doOAuthSignIn(a,c,d),k;this._nls||(this._nls=p.identity);this.oAuthDialog||(this.oAuthDialog=this._createOAuthDialog());a=this.oAuthDialog;c=e&&e.error;e=e&&e.token;b.hide(a.errMsg_);c&&403==c.code&&e&&(t.set(a.errMsg_,"innerHTML",this._nls.forbidden),b.show(a.errMsg_));a.show();
return k},setOAuthResponseHash:function(a){var b=this._oAuthDfd;this._oAuthDfd=null;if(b&&a)if(clearInterval(this._oAuthIntervalId),"#"===a.charAt(0)&&(a=a.substring(1)),a=w.queryToObject(a),a.error)a=Error("access_denied"===a.error?"ABORTED":"OAuth: "+a.error+" - "+a.error_description),a.code="IdentityManagerBase.2",a.log=!!h.isDebug,b.errback(a);else{var d=b.oinfo_._oAuthCred,e=new c({userId:a.username,server:b.sinfo_.server,token:a.access_token,expires:(new Date).getTime()+1E3*Number(a.expires_in),
ssl:"true"===a.ssl,_oAuthCred:d});d.storage=a.persist?window.localStorage:window.sessionStorage;d.token=e.token;d.expires=e.expires;d.userId=e.userId;d.ssl=e.ssl;d.save();b.callback(e)}},_createOAuthDialog:function(){var c=this._nls,e=a.substitute(c,this._oAuthDialogContent),d=new u({title:c.title,content:e,"class":"esriOAuthSignInDialog",style:"min-width: 18em;",esriIdMgr_:this,execute_:function(){var a=d.esriIdMgr_._oAuthDfd;d.hide_();d.esriIdMgr_._doOAuthSignIn(a.resUrl_,a.sinfo_,a.oinfo_)},cancel_:function(){var a=
d.esriIdMgr_._oAuthDfd;d.esriIdMgr_._oAuthDfd=null;d.hide_();var b=Error("ABORTED");b.code="IdentityManager.2";b.log=!!h.isDebug;a.errback(b)},hide_:function(){b.hide(d.errMsg_);d.hide();u._DialogLevelManager.hide(d)}}),c=d.domNode;d.btnSubmit_=v.byNode(l.query(".esriIdSubmit",c)[0]);d.btnCancel_=v.byNode(l.query(".esriIdCancel",c)[0]);d.errMsg_=l.query(".esriErrorMsg",c)[0];d.connect(d.btnSubmit_,"onClick",d.execute_);d.connect(d.btnCancel_,"onClick",d.onCancel);d.connect(d,"onCancel",d.cancel_);
return d},_doOAuthSignIn:function(a,b,c){var d=this,k={client_id:c.appId,response_type:"token",state:e.stringify({portalUrl:c.portalUrl}),expiration:c.expiration,locale:c.locale,redirect_uri:c.popup?n.getAbsoluteUrl(c.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};c.forceLogin&&(k.force_login=!0);var g=c.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",f=g+"?"+w.objectToQuery(k);if(c.popup){var m;7===x("ie")?(m=window.open(c.popupCallbackUrl,"esriJSAPIOAuth",c.popupWindowFeatures),
m.location=f):m=window.open(f,"esriJSAPIOAuth",c.popupWindowFeatures);m?(m.focus(),this._oAuthDfd.oAuthWin_=m,this._oAuthIntervalId=setInterval(function(){if(m.closed){clearInterval(d._oAuthIntervalId);var a=d._oAuthDfd;if(a){var b=Error("ABORTED");b.code="IdentityManager.2";b.log=!!h.isDebug;a.errback(b)}}},500)):(a=Error("ABORTED"),a.code="IdentityManager.2",a.log=!!h.isDebug,this._oAuthDfd.errback(a))}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:k,
authorizeUrl:g,resourceUrl:a,serverInfo:b,oAuthInfo:c}):window.location=f}}})},"esri/SnappingManager":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has dojo/keys ./kernel ./graphic ./geometry/ScreenPoint ./geometry/Extent ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./tasks/query".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m){c=c(null,{declaredClass:"esri.SnappingManager",constructor:function(c){c=
c||{};this.map=c.map;this.tolerance=c.tolerance||15;this.layerInfos=[];if(c.layerInfos)this.layerInfos=c.layerInfos;else{var d;for(d=0;d<this.map.graphicsLayerIds.length;d++){var g=this.map.getLayer(this.map.graphicsLayerIds[d]);this.layerInfos.push({layer:g})}if(this.map.loaded)this.layerInfos.push({layer:this.map.graphics});else var k=b.connect(this.map,"onLoad",this,function(a){b.disconnect(k);k=null;this.layerInfos.push({layer:this.map.graphics});this.setLayerInfos(this.layerInfos)})}this.snapPointSymbol=
c.snapPointSymbol?c.snapPointSymbol:new x(x.STYLE_CROSS,15,new e(e.STYLE_SOLID,new u([0,255,255]),1),new u([0,255,0,0]));this.alwaysSnap=c.alwaysSnap?c.alwaysSnap:!1;this.snapKey=c.snapKey?c.snapKey:h("mac")?f.META:f.CTRL;this._SelectionLyrQuery=new m;this._SelectionLyrQuery.spatialRelationship=m.SPATIAL_REL_INTERSECTS;this._snappingGraphic=new t;this.setLayerInfos(this.layerInfos);this._currentGraphicOption={snapToPoint:!0,snapToVertex:!0,snapToEdge:!0};this._snappingCallback=a.hitch(this,this._snappingCallback)},
getSnappingPoint:function(b){var c=this.layers,e=this.tolerance,k=this.map,g=this.layerOptions,f=k.toMap(b.offset(-e,e)),e=k.toMap(b.offset(e,-e)),f=new w(f.x,f.y,e.x,e.y,k.spatialReference),h=new m;h.geometry=f;h.spatialRelationship=m.SPATIAL_REL_INTERSECTS;var l=[],p=[],t,x=this._extractPointsAndLines,u=new v,B=0,M,e=f.xmin,U=f.xmax;n.forEach(c,function(a,b){a.visible&&a.loaded&&"esri.layers.FeatureLayer"===a.declaredClass&&a.mode!==a.constructor.MODE_SELECTION&&B++});k.spatialReference._isWrappable()&&
(e=w.prototype._normalizeX(f.xmin,k.spatialReference._getInfo()).x,U=w.prototype._normalizeX(f.xmax,k.spatialReference._getInfo()).x);var N=new w(e,f.ymin,U,f.ymax,k.spatialReference);n.forEach(c,function(a,b){if("esri.layers.GraphicsLayer"===a.declaredClass&&a.visible){var c=[];n.forEach(a.graphics,function(a){a&&a.visible&&N.intersects(a.geometry)&&c.push(a)});a=x(c,g[b]);l=l.concat(a[0]);p=p.concat(a[1])}});var Q=a.hitch(this,function(a){B--;a instanceof Error||(a=x(a.features,g[M]),l=l.concat(a[0]),
p=p.concat(a[1]));B||(t=this._getSnappingPoint(l,p,b),u.callback(t))}),O=!1;n.forEach(c,function(a,b){a.visible&&a.loaded&&(M=b,"esri.layers.FeatureLayer"===a.declaredClass&&a.mode!==a.constructor.MODE_SELECTION&&(O=!0,a.queryFeatures(h,Q,Q)))});O||(t=this._getSnappingPoint(l,p,b),u.callback(t));return u},setLayerInfos:function(a){this.layers=[];this.layerOptions=[];var b;for(b=0;b<a.length;b++)this.layers.push(a[b].layer),this.layerOptions.push({snapToPoint:!0,snapToVertex:!0,snapToEdge:!0}),!1===
a[b].snapToPoint&&(this.layerOptions[b].snapToPoint=a[b].snapToPoint),!1===a[b].snapToVertex&&(this.layerOptions[b].snapToVertex=a[b].snapToVertex),!1===a[b].snapToEdge&&(this.layerOptions[b].snapToEdge=a[b].snapToEdge);this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];this._selectionLayers=[];this._selectionLayerOptions=[];n.forEach(this.layers,function(a,b){"esri.layers.FeatureLayer"===a.declaredClass&&a.mode===a.constructor.MODE_SELECTION&&(this._selectionLayers.push(a),
this._selectionLayerOptions.push(this.layerOptions[b]))},this);this.layerInfos=a},destroy:function(){b.disconnect(this._onExtentChangeConnect);this._killOffSnapping();this._featurePtsFromSelectionLayer=this._featureLinesFromSelectionLayer=this._currentFeaturePts=this._currentFeatureLines=this.layers=this.map=null},_startSelectionLayerQuery:function(){b.disconnect(this._onExtentChangeConnect);this._mapExtentChangeHandler(this._selectionLayers,this._selectionLayerOptions,this.map.extent);this._onExtentChangeConnect=
b.connect(this.map,"onExtentChange",a.hitch(this,"_mapExtentChangeHandler",this._selectionLayers,this._selectionLayerOptions))},_stopSelectionLayerQuery:function(){b.disconnect(this._onExtentChangeConnect)},_mapExtentChangeHandler:function(b,c,e){this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];var d;this._SelectionLyrQuery.geometry=e;var g=a.hitch(this,function(a){a instanceof Error||(a=this._extractPointsAndLines(a.features,c[d]),this._featurePtsFromSelectionLayer=this._featurePtsFromSelectionLayer.concat(a[0]),
this._featureLinesFromSelectionLayer=this._featureLinesFromSelectionLayer.concat(a[1]))});n.forEach(b,function(a,b){a.visible&&a.loaded&&(d=b,a.queryFeatures(this._SelectionLyrQuery,g,g))},this)},_extractPointsAndLines:function(a,b){var c=[],d=[],e,g;n.forEach(a,function(a,k){if((!a._graphicsLayer||a.visible)&&a.geometry)if("point"===a.geometry.type&&b.snapToPoint)c.push(a.geometry);else if("polyline"===a.geometry.type)for(e=0;e<a.geometry.paths.length;e++){d.push("lineStart");for(g=0;g<a.geometry.paths[e].length;g++)k=
a.geometry.getPoint(e,g),b.snapToVertex&&c.push(k),b.snapToEdge&&d.push(k);d.push("lineEnd")}else if("polygon"===a.geometry.type)for(e=0;e<a.geometry.rings.length;e++){d.push("lineStart");for(g=0;g<a.geometry.rings[e].length;g++)k=a.geometry.getPoint(e,g),b.snapToVertex&&c.push(k),b.snapToEdge&&d.push(k);d.push("lineEnd")}});return[c,d]},_getSnappingPoint:function(a,b,c){var d,e,g=this.tolerance,f=this.map,m=this.map._getFrameWidth();a=a.concat(this._featurePtsFromSelectionLayer);b=b.concat(this._featureLinesFromSelectionLayer);
if(this._currentGraphic){var h=this._extractPointsAndLines([this._currentGraphic],this._currentGraphicOption);a=a.concat(h[0]);b=b.concat(h[1])}var l,y;n.forEach(a,function(a,b){a=f.toScreen(a,!0);if(-1!==m&&(a.x%=m,0>a.x&&(a.x+=m),f.width>m))for(b=(f.width-m)/2;a.x<b;)a.x+=m;d=Math.sqrt((a.x-c.x)*(a.x-c.x)+(a.y-c.y)*(a.y-c.y));d<=g&&(g=d,l=a.x,y=a.y)});if(l)b=new p(l,y),e=b=f.toMap(b);else{var t,x,g=this.tolerance;for(a=0;a<b.length;a++)if("lineStart"===b[a])for(h=a+1;h<b.length;h++){if("lineEnd"!==
b[h+1]&&"lineStart"!==b[h+1]&&"lineEnd"!==b[h]&&"lineStart"!==b[h]){var u=f.toScreen(b[h],!0),w=f.toScreen(b[h+1],!0),v=u.x>=w.x?u:w,Q=u.x>=w.x?w:u;-1!==m&&(v.x%=m,0>v.x&&(v.x+=m),Q.x%=m,0>Q.x&&(Q.x+=m),Q.x>v.x&&(Q.x-=m));var u=v.x,v=v.y,w=Q.x,Q=Q.y,O,K,I,H,L,fa;u===w?(O=u,K=c.y,I=H=u,L=v<=Q?v:Q,fa=v<=Q?Q:v):v===Q?(O=c.x,K=v,I=u<=w?u:w,H=u<=w?w:u,L=fa=v):(K=(Q-v)/(w-u),I=(v*w-u*Q)/(w-u),O=(I-(c.y*Q-c.y*v-c.x*u+c.x*w)/(Q-v))/((u-w)/(Q-v)-K),K=K*O+I,I=u<=w?u:w,H=u<=w?w:u,L=v<=Q?v:Q,fa=v<=Q?Q:v);O>=
I&&O<=H&&K>=L&&K<=fa?(u=Math.sqrt((c.x-O)*(c.x-O)+(c.y-K)*(c.y-K)),u<=g&&(g=u,t=O,x=K)):(O=Math.sqrt((u-c.x)*(u-c.x)+(v-c.y)*(v-c.y)),K=Math.sqrt((w-c.x)*(w-c.x)+(Q-c.y)*(Q-c.y)),O<=K?(I=O,O=u,K=v):(I=K,O=w,K=Q),I<=g&&(g=I,t=O,x=K))}if("lineEnd"===b[h]){a=h;break}}t&&(b=new p(t,x),e=b=f.toMap(b))}return e},_setGraphic:function(a){this._currentGraphic=a},_addSnappingPointGraphic:function(){var a=this.map;this._snappingGraphic.setSymbol(this.snapPointSymbol);a.graphics.add(this._snappingGraphic)},_setUpSnapping:function(){var a=
this.map;this._onSnapKeyDown_connect=b.connect(a,"onKeyDown",this,"_onSnapKeyDownHandler");this._onSnapKeyUp_connect=b.connect(a,"onKeyUp",this,"_onSnapKeyUpHandler");this._onSnappingMouseMove_connect=b.connect(a,"onMouseMove",this,"_onSnappingMouseMoveHandler");this._onSnappingMouseDrag_connect=b.connect(a,"onMouseDrag",this,"_onSnappingMouseMoveHandler");this.alwaysSnap&&this._activateSnapping()},_killOffSnapping:function(){b.disconnect(this._onSnapKeyDown_connect);b.disconnect(this._onSnapKeyUp_connect);
b.disconnect(this._onSnappingMouseMove_connect);b.disconnect(this._onSnappingMouseDrag_connect);this._deactivateSnapping()},_onSnapKeyDownHandler:function(a){a.keyCode===this.snapKey&&(b.disconnect(this._onSnapKeyDown_connect),this.alwaysSnap?this._deactivateSnapping():this._activateSnapping())},_activateSnapping:function(){this._snappingActive=!0;this._addSnappingPointGraphic();this._currentLocation&&this._onSnappingMouseMoveHandler(this._currentLocation)},_onSnapKeyUpHandler:function(a){a.keyCode===
this.snapKey&&(this._onSnapKeyDown_connect=b.connect(this.map,"onKeyDown",this,"_onSnapKeyDownHandler"),this.alwaysSnap?this._activateSnapping():this._deactivateSnapping())},_deactivateSnapping:function(){this._snappingActive=!1;this._snappingPoint=null;this.map.graphics.remove(this._snappingGraphic);this._snappingGraphic.setGeometry(null)},_onSnappingMouseMoveHandler:function(a){this._currentLocation=a;this._snappingPoint=null;this._snappingActive&&(this._snappingGraphic.hide(),this.getSnappingPoint(a.screenPoint).addCallback(this._snappingCallback))},
_snappingCallback:function(a){if(this._snappingPoint=a)this._snappingGraphic.show(),this._snappingGraphic.setGeometry(a)}});return l.SnappingManager=c})},"esri/tasks/identify":function(){define(["./IdentifyTask","./IdentifyParameters","./IdentifyResult"],function(){return{}})},"esri/tasks/IdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),function(c,b,a,n,u,v,h,f,l){c=c(f,
{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(a,c){this._url.path+="/identify";this._handler=b.hitch(this,this._handler);this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,c,f,h,e){try{var m=[];a.forEach(b.results,function(a,b){m[b]=new l(a)});this._successHandler([m],"onComplete",f,e)}catch(g){this._errorHandler(g,h,e)}},execute:function(a,c,f,h){var e=h.assembly;
a=this._encode(b.mixin({},this._url.query,{f:"json"},a.toJson(e&&e[0])));var m=this._handler,g=this._errorHandler;this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return v({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,b){m(a,b,c,f,h.dfd)},error:function(a){g(a,f,h.dfd)}})},onComplete:function(){}});h._createWrappers(c);b.setObject("tasks.IdentifyTask",c,u);return c})},"esri/tasks/IdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),
function(c,b,a,n,u,v){c=c(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(a){b.mixin(this,a);this.feature=new u(a.geometry?v.fromJson(a.geometry):null,null,a.attributes);delete this.geometry;delete this.attributes}});b.setObject("tasks.IdentifyResult",c,n);return c})},"esri/tasks/IdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),function(c,
b,a,n,u,v,h,f,l){var t=c(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=t.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,returnFieldName:!1,returnUnformattedValues:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(b){var c=b&&b.geometry||this.geometry,p=this.mapExtent,e=this.spatialReference,m=this.layerIds;
b={tolerance:this.tolerance,returnGeometry:this.returnGeometry,returnFieldName:this.returnFieldName,returnUnformattedValues:this.returnUnformattedValues,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};if(c){var g=c.toJson();delete g.spatialReference;b.geometry=n.toJson(g);b.geometryType=f.getJsonType(c)}e?b.sr=e.wkid||n.toJson(e.toJson()):c&&c.spatialReference?b.sr=c.spatialReference.wkid||n.toJson(c.spatialReference.toJson()):
p&&p.spatialReference&&(b.sr=p.spatialReference.wkid||n.toJson(p.spatialReference.toJson()));p&&(b.mapExtent=p.xmin+","+p.ymin+","+p.xmax+","+p.ymax);b.layers=this.layerOption;m&&(b.layers+=":"+m.join(","));b.layerDefs=h._serializeLayerDefinitions(this.layerDefinitions,!0);c=this.timeExtent;b.time=c?c.toJson().join(","):null;b.layerTimeOptions=h._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){var p=l.getScale({extent:p,width:this.width,spatialReference:p.spatialReference}),
d=h._getLayersForScale(p,this.dynamicLayerInfos),y=[];a.forEach(this.dynamicLayerInfos,function(b){if(!b.subLayerIds){var c=b.id;if((!this.layerIds||this.layerIds&&-1!==a.indexOf(this.layerIds,c))&&-1!==a.indexOf(d,c)){var e={id:c};e.source=b.source&&b.source.toJson();var k;this.layerDefinitions&&this.layerDefinitions[c]&&(k=this.layerDefinitions[c]);k&&(e.definitionExpression=k);var g;this.layerTimeOptions&&this.layerTimeOptions[c]&&(g=this.layerTimeOptions[c]);g&&(e.layerTimeOptions=g.toJson());
y.push(e)}}},this);p=n.toJson(y);"[]"===p&&(p="[{}]");b.dynamicLayers=p}return b}});b.mixin(t,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"});b.setObject("tasks.IdentifyParameters",t,v);return t})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),
function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(c,b,a,n,u,v){c=c(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var b=a.map(this.polylines,function(a){return a.toJson()}),c={};c.polylines=n.toJson(b);c.trimExtendTo=n.toJson(this.trimExtendTo.toJson());c.sr=n.toJson(this.polylines[0].spatialReference.toJson());
c.extendHow=this.extendHow||0;return c}});b.mixin(c,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,NO_EXTEND_AT_TO:16});b.setObject("tasks.TrimExtendParameters",c,v);return c})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(c,b,a,n,u,v,h,f){c=c(null,{declaredClass:"esri.tasks.BufferParameters",
geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var b={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},c=this.distances,p=this.outSpatialReference,u=this.bufferSpatialReference,x=a.map(this.geometries,function(a){a="extent"===a.type?h.fromExtent(a):a;return a.toJson()},this),e=this.geometries;if(e&&0<e.length){var m="extent"===e[0].type?"esriGeometryPolygon":f.getJsonType(e[0]);b.geometries=
n.toJson({geometryType:m,geometries:x});b.inSR=e[0].spatialReference.wkid?e[0].spatialReference.wkid:n.toJson(e[0].spatialReference.toJson())}c&&(b.distances=c.join(","));p&&(b.outSR=p.wkid?p.wkid:n.toJson(p.toJson()));u&&(b.bufferSR=u.wkid?u.wkid:n.toJson(u.toJson()));return b}});b.setObject("tasks.BufferParameters",c,v);return c})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var b=a.map(this.geometries1,function(a){return a.toJson()}),c=a.map(this.geometries2,function(a){return a.toJson()}),t={},p=this.geometries1;p&&0<p.length&&(t.geometries1=n.toJson({geometryType:h.getJsonType(p[0]),geometries:b}),b=this.geometries1[0].spatialReference,t.sr=b.wkid?b.wkid:n.toJson(b.toJson()));(b=this.geometries2)&&0<b.length&&
(t.geometries2=n.toJson({geometryType:h.getJsonType(b[0]),geometries:c}));this.relation&&(t.relation=this.relation);this.relationParam&&(t.relationParam=this.relationParam);return t}});b.mixin(c,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});b.setObject("tasks.RelationParameters",c,v);return c})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,toJson:function(){var b=a.map(this.geometries,function(a){return a.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=n.toJson({geometryType:h.getJsonType(this.geometries[0]),geometries:b}),c.sr=n.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(c.geodesic=this.geodesic);this.lengthUnit&&(c.lengthUnit=this.lengthUnit);
this.maxSegmentLength&&(c.maxSegmentLength=this.maxSegmentLength);return c}});b.setObject("tasks.DensifyParameters",c,v);return c})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var b=a.map(this.geometries,function(a){return a.toJson()}),
c={};this.geometries&&0<this.geometries.length&&(c.geometries=n.toJson({geometryType:h.getJsonType(this.geometries[0]),geometries:b}),c.sr=n.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(c.deviationUnit=this.deviationUnit);this.maxDeviation&&(c.maxDeviation=this.maxDeviation);return c}});b.setObject("tasks.GeneralizeParameters",c,v);return c})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var b=a.map(this.geometries,function(a){return a.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=n.toJson({geometryType:h.getJsonType(this.geometries[0]),geometries:b}),c.sr=n.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(c.bevelRatio=this.bevelRatio);this.offsetDistance&&
(c.offsetDistance=this.offsetDistance);this.offsetHow&&(c.offsetHow=this.offsetHow);this.offsetUnit&&(c.offsetUnit=this.offsetUnit);return c}});b.mixin(c,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});b.setObject("tasks.OffsetParameters",c,v);return c})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(c,
b,a,n,u,v){c=c(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var b={},c=this.geometry1;c&&(b.geometry1=a.toJson({geometryType:v.getJsonType(c),geometry:c}));if(c=this.geometry2)b.geometry2=a.toJson({geometryType:v.getJsonType(c),geometry:c});b.sr=a.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(b.distanceUnit=this.distanceUnit);this.geodesic&&(b.geodesic=this.geodesic);return b}});b.setObject("tasks.DistanceParameters",
c,u);return c})},"esri/utils":function(){define("./domUtils ./lang ./urlUtils ./request ./tileUtils ./graphicsUtils ./deferredUtils ./layerUtils ./geometry/normalizeUtils".split(" "),function(){return{}})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D){var z=b([k],{declaredClass:"esri.layers.KMLLayer",serviceUrl:m.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(a,b){this._outSR=b&&b.outSR||new g({wkid:4326});this._options=n.mixin({},b);w.defaults.kmlService&&(this.serviceUrl=w.defaults.kmlService);if(a=this.linkInfo=b&&b.linkInfo)this.visible=!!a.visibility,this._waitingForMap=!!a.viewFormat;(!a||a&&a.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=
n.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(a){if(a){var b=a.type,c=a.id,d;switch(b){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(a=this["_"+b])&&(d=n.getObject("_mode._featureMap."+c,!1,a));break;case "GroundOverlay":if(a=this._groundLyr){var e=a.getImages(),b=e.length;for(a=0;a<b;a++)if(e[a].id===c){d=e[a];break}}break;case "NetworkLink":u.some(this._links,function(a){return a.linkInfo&&a.linkInfo.id===
c?(d=a,!0):!1});break;case "Folder":for(b=(e=this.folders)?e.length:0,a=0;a<b;a++)if(e[a].id===c){d=e[a];break}}return d}},getLayers:function(){var a=[];this._groundLyr&&a.push(this._groundLyr);this._fLayers&&(a=a.concat(this._fLayers));this._links&&u.forEach(this._links,function(b){b.declaredClass&&a.push(b)});return a},setFolderVisibility:function(a,b){a&&(this._fireUpdateStart(),(a.visible=b)&&(b=this._areLocalAncestorsVisible(a)),this._setState(a,b),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},
onRefresh:function(){},onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(a){var b=this;this._fireUpdateStart();this._io=e({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(a),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:v.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(a){b._io=null;b._initLayer(a)},error:function(a){b._io=null;a=n.mixin(Error(),a);a.message="Unable to load KML: "+(a.message||"");b._fireUpdateEnd(a);
b._errorHandler(a)}})},_initLayer:function(a){var b;this.loaded&&(b=[],u.forEach(this.folders,function(a){a.visible&&b.push(a.id)}),this._options.minScale=this.minScale,this._options.maxScale=this.maxScale,this._options.opacity=this.opacity,this._removeInternalLayers());this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.visibility=a.visibility;this.featureInfos=a.featureInfos;var c,d,e=this.folders=a.folders,k=[],g;if(e)for(d=e.length,c=0;c<d;c++)g=e[c]=new G(e[c]),-1===g.parentFolderId&&
k.push(g);var e=this._links=a.networkLinks,f;d=e?e.length:0;for(c=0;c<d;c++)e[c].viewRefreshMode&&-1!==e[c].viewRefreshMode.toLowerCase().indexOf("onregion")||(f=n.mixin({},this._options),f.linkInfo=e[c],f.id&&(f.id=f.id+"_"+c),g=e[c]=new z(e[c].href,f),g._parentLayer=this,g._parentFolderId=this._getLinkParentId(g.linkInfo.id),g._linkErrorHandle=g.on("error,network-link-error",n.hitch(g,function(a){this._parentLayer.onNetworkLinkError(a.error)})));if((e=a.groundOverlays)&&0<e.length)for(f=n.mixin({},
this._options),f.id&&(f.id+="_mapImage"),g=this._groundLyr=new C(f),d=e.length,c=0;c<d;c++)g.addImage(new E(e[c]));(a=n.getObject("featureCollection.layers",!1,a))&&0<a.length&&(this._fLayers=[],u.forEach(a,function(a,b){var c=n.getObject("featureSet.features",!1,a);c&&0<c.length&&(f=n.mixin({outFields:["*"],infoTemplate:a.popupInfo?new y(a.popupInfo):null,editable:!1},this._options),f.id&&(f.id=f.id+"_"+b),f.webgl=!1,a.layerDefinition.capabilities="Query,Data",a=new D(a,f),a.geometryType&&(this["_"+
a.geometryType]=a),this._fLayers.push(a))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(d=k.length,c=0;c<d;c++)g=k[c],this._setState(g,g.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),u.forEach(this.folders,function(a){-1<u.indexOf(b,a.id)?this.setFolderVisibility(a,!0):this.setFolderVisibility(a,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();this._links&&u.forEach(this._links,
function(b){b.declaredClass&&(a.addLayer(b),b._waitingForMap&&(b._waitingForMap=null,b.visible?b._parseKml(a):b._wMap=a))});var b=a.spatialReference,c=this._outSR,e;if(!b.equals(c))if(b.isWebMercator()&&4326===c.wkid)e=d.geographicToWebMercator;else if(c.isWebMercator()&&4326===b.wkid)e=d.webMercatorToGeographic;else return;this._groundLyr&&(e&&u.forEach(this._groundLyr.getImages(),function(a){a.extent=e(a.extent)}),a.addLayer(this._groundLyr));(b=this._fLayers)&&0<b.length&&u.forEach(b,function(b){if(e){var c=
b.graphics,d,k,g=c?c.length:0;for(d=0;d<g;d++)(k=c[d].geometry)&&c[d].setGeometry(e(k))}a.addLayer(b)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var a=this._map;this._links&&u.forEach(this._links,function(a){a.declaredClass&&a._io&&a._io.cancel();a._linkErrorHandle&&(a._linkErrorHandle.remove(),a._linkErrorHandle=null)});a&&u.forEach(this.getLayers(),a.removeLayer,a)},_setState:function(a,b){a=a.featureInfos;var c,d,e,k=a?a.length:0,g=b?"show":"hide";for(e=0;e<k;e++)if(c=
a[e],d=this.getFeature(c))if("Folder"===c.type)this._setState(d,b&&d.visible);else if("NetworkLink"===c.type)this._setInternalVisibility(d,b);else d[g]()},_areLocalAncestorsVisible:function(a){var b=a.parentFolderId;for(a=a.visible;a&&-1!==b;)b=this.getFeature({type:"Folder",id:b}),a=a&&b.visible,b=b.parentFolderId;return a},_setInternalVisibility:function(a,b){var c=a._parentLayer,d=a._parentFolderId;for(b=b&&a.visible;b&&c;)b=b&&c.visible,-1<d&&(b=b&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",
id:d}))),d=c._parentFolderId,c=c._parentLayer;this._setIntState(a,b)},_setIntState:function(a,b){a&&u.forEach(a.getLayers(),function(c){c.linkInfo?a._setIntState(c,b&&c.visible&&a._areLocalAncestorsVisible(a.getFeature({type:"Folder",id:c._parentFolderId}))):c.setVisibility(b)})},_getLinkParentId:function(a){var b=-1;this.folders&&u.some(this.folders,function(c){return c.networkLinkIds&&-1!==u.indexOf(c.networkLinkIds,a)?(b=c.id,!0):!1});return b},_checkAutoRefresh:function(){var b=this.linkInfo;
if(b)if(this.visible){if(this.loaded&&this._map){var c=b.refreshMode,d=b.refreshInterval,e=b.viewRefreshMode,b=b.viewRefreshTime;c&&-1!==c.toLowerCase().indexOf("oninterval")&&0<d&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*d));e&&-1!==e.toLowerCase().indexOf("onstop")&&0<b&&!this._extChgHandle&&(this._extChgHandle=a.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),a.disconnect(this._extChgHandle),delete this._extChgHandle},
_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(a){a=a||this._map;var b={},e=this.linkInfo,k=a&&a.extent,g;this._url.query&&(n.mixin(b,this._url.query),g=!!this._url.query.token);p.id&&!g&&(g=p.id.findCredential(this._url.path))&&(b.token=g.token);if(e){g=e.viewFormat;var m=e.httpQuery,e=e.viewBoundScale;if(k&&g){var h=k,l=k,y=k.spatialReference;y&&(y.isWebMercator()?h=d.webMercatorToGeographic(k):4326===y.wkid&&(l=d.geographicToWebMercator(k)));
k=h.getCenter();l=Math.max(l.getWidth(),l.getHeight());e&&(h=h.expand(e));g=g.replace(/\[bboxWest\]/ig,h.xmin).replace(/\[bboxEast\]/ig,h.xmax).replace(/\[bboxSouth\]/ig,h.ymin).replace(/\[bboxNorth\]/ig,h.ymax).replace(/\[lookatLon\]/ig,k.x).replace(/\[lookatLat\]/ig,k.y).replace(/\[lookatRange\]/ig,l).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,k.x).replace(/\[lookatTerrainLat\]/ig,k.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,
k.x).replace(/\[cameraLat\]/ig,k.y).replace(/\[cameraAlt\]/ig,l).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,a.width).replace(/\[vertPixels\]/ig,a.height).replace(/\[terrainEnabled\]/ig,0);n.mixin(b,f.queryToObject(g))}m&&(m=m.replace(/\[clientVersion\]/ig,p.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,c.locale),n.mixin(b,f.queryToObject(m)))}a=[];for(var t in b)x.isDefined(b[t])&&
a.push(t+"\x3d"+b[t]);return(a=a.join("\x26"))?"?"+a:""},setScaleRange:function(a,b){this.inherited(arguments);u.forEach(this.getLayers(),function(c){c.setScaleRange(a,b)})},setOpacity:function(a){this.opacity!=a&&(u.forEach(this.getLayers(),function(b){b.setOpacity(a)}),this.opacity=a,this.onOpacityChange(a))},_setMap:function(a,b){this.inherited(arguments);this._map=a;var c=this._div=l.create("div",null,b);t.set(c,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return c},
_unsetMap:function(b,c){this._io&&this._io.cancel();this._stopAutoRefresh();a.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var d=this._div;d&&(c.removeChild(d),l.destroy(d));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(a){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,a),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&a&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&
this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(a){var b,c=[];(a=this.getFeature({type:"Folder",id:a}))&&(b=u.map(a.featureInfos,function(a){if("esriGeometryPoint"===a.type||"esriGeometryPolyline"===a.type||"esriGeometryPolygon"===a.type)return a.id},this))&&0<b.length&&u.forEach(this._fLayers,function(a){var d,e;d=a.toJson();d.featureSet.features&&0<d.featureSet.features.length&&(e=u.filter(d.featureSet.features,function(c){if(-1!==u.indexOf(b,c.attributes[a.objectIdField]))return c},
this));e&&0<e.length&&(d.featureSet.features=e,c.push(d))},this);return c},getFeatureCount:function(a){a=this.getFeature({type:"Folder",id:a});var b={points:0,polylines:0,polygons:0};a&&u.forEach(a.featureInfos,function(a){"esriGeometryPoint"===a.type&&(b.points+=1);"esriGeometryPolyline"===a.type&&(b.polylines+=1);"esriGeometryPolygon"===a.type&&(b.polygons+=1)});return b},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});
n.setObject("layers.KMLLayer",z,p);return z})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(c,b,a,n,u){c=c(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(a){b.mixin(this,a);u.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});b.setObject("layers.KMLFolder",c,n);return c})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(c,b,a,n,u,v){c=c([v],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(a){u.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});b.setObject("layers.KMLGroundOverlay",c,n);return c})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(c,b,a,
n,u,v,h,f,l,t,p,w,x,e){function m(a,c){var d=[],e;if(a&&c&&(c.customLayerParameters||c.customParameters)){e=b.clone(c.customParameters||{});b.mixin(e,c.customLayerParameters||{});a=t.urlToObject(a);for(var g in a.query)e.hasOwnProperty(g)||d.push(g+"\x3d"+a.query[g]);a=a.path+(d.length?"?"+d.join("\x26"):"")}return a}c=c(x,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(c,d){d||(d={});this.urlTemplate=c=m(c,d.wmtsInfo);var g=new w(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,
2.0037508342787E7,new p({wkid:102100})),k=new w(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new p({wkid:102100}));this.initialExtent=d.initialExtent||g;this.fullExtent=d.fullExtent||k;this.tileInfo=d.tileInfo?d.tileInfo:new e({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,
scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},
{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new p(this.tileInfo.spatialReference.toJson());this.copyright=d.copyright||"";var f=new n(c),g=f.scheme+"://"+f.authority+"/";this.urlPath=c.substring(g.length);this.tileServers=d.tileServers||[];-1===f.authority.indexOf("{subDomain}")&&
this.tileServers.push(g);if(d.subDomains&&0<d.subDomains.length&&1<f.authority.split(".").length){this.subDomains=d.subDomains;var x;a.forEach(d.subDomains,function(a){-1<f.authority.indexOf("${subDomain}")?x=f.scheme+"://"+v.substitute(f.authority,{subDomain:a})+"/":-1<f.authority.indexOf("{subDomain}")&&(x=f.scheme+"://"+f.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(x)},this)}this.tileServers=a.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});
this._levelToLevelValue=[];var C=0;a.forEach(this.tileInfo.lods,function(a,b){this._levelToLevelValue[a.level]=a.levelValue||a.level;0===b&&(C=this._levelToLevelValue[a.level])},this);this._wmtsInfo=d.wmtsInfo;var D=b.hitch(this,function(){this.loaded=!0;this.onLoad(this)});u("chrome")?(c=this.getTileUrl(C,0,0),d=h.defaults.io,g="with-credentials"===d.useCors?t.canUseXhr(c,!0):-1,(d=-1<g?d.corsEnabledServers[g]:null)&&d.withCredentials?l({url:c,handleAs:"arraybuffer"}).addBoth(function(){D()}):D()):
D()},getTileUrl:function(a,b,c){a=this._levelToLevelValue[a];var d=this.tileServers[b%this.tileServers.length]+v.substitute(this.urlPath,{level:a,col:c,row:b}),d=d.replace(/\{level\}/gi,a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c),d=this._appendCustomLayerParameters(d),d=this.addTimestampToURL(d);return t.addProxy(d)},_appendCustomLayerParameters:function(a){var c,e;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters))for(c in e=b.clone(this._wmtsInfo.customParameters||
{}),b.mixin(e,this._wmtsInfo.customLayerParameters||{}),e)a+=(-1===a.indexOf("?")?"?":"\x26")+c+"\x3d"+encodeURIComponent(e[c]);return a}});b.setObject("layers.WebTiledLayer",c,f);return c})},"esri/layers/osm":function(){define(["./OpenStreetMapLayer"],function(){return{}})},"esri/layers/wms":function(){define(["./agscommon","./dynamic","./WMSLayer"],function(){return{}})},"esri/layers/dynamic":function(){define(["../geometry","./DynamicMapServiceLayer"],function(){return{}})},"esri/layers/wmts":function(){define(["./agscommon",
"./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/tiled":function(){define(["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y){b=b([g],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(b,c){this.version="1.0.0";this.tileUr=this._url=b;this.serviceMode="RESTful";this._parseCapabilities=a.hitch(this,this._parseCapabilities);this._getCapabilitiesError=a.hitch(this,this._getCapabilitiesError);c||(c={});if(c.serviceMode)if("KVP"===c.serviceMode||"RESTful"===c.serviceMode)this.serviceMode=c.serviceMode;
else return;this.customParameters=c.customParameters;this.customLayerParameters=c.customLayerParameters;this.layerInfo=new y;c.layerInfo&&(this.layerInfo=c.layerInfo,this._identifier=c.layerInfo.identifier,this._tileMatrixSetId=c.layerInfo.tileMatrixSet,c.layerInfo.format&&(this.format="image/"+c.layerInfo.format),this._style=c.layerInfo.style,this.title=c.layerInfo.title,this._dimension=c.layerInfo.dimension,this._dimension2=c.layerInfo.dimension2);c.resourceInfo?(this.version=c.resourceInfo.version,
c.resourceInfo.getTileUrl&&(this._url=this.tileUrl=c.resourceInfo.getTileUrl),this.copyright=c.resourceInfo.copyright,this.layerInfos=c.resourceInfo.layerInfos,this.customParameters=c.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=c.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities();this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""}},setActiveLayer:function(a){this.setVisibleLayer(a)},setVisibleLayer:function(a){this._setActiveLayer(a);this.refresh(!0)},setCustomParameters:function(a,b){this.customParameters=a;this.customLayerParameters=b;this.refresh(!0)},getTileUrl:function(a,b,c){a=this._levelToLevelValue[a];a=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[b%
this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,a).replace(/\{TileRow\}/gi,b).replace(/\{TileCol\}/gi,c).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c);a=this._appendCustomLayerParameters(a);a=this.addTimestampToURL(a);return t.addProxy(a)},getTileUrlTemplate:function(a){var b=
a.identifier,c=a.tileMatrixSet,d=a.format,e=a.style,k=a.dimension,g=a.dimension2;b?a=n.filter(this.layers,function(a){return a.identifier===b})[0]:(a=this.layers[0],b=this.layers[0].identifier);if(a){if(!d)d=a.formats[0];else if(!(-1===d.indexOf("image/")&&-1<n.indexOf(a.formats,d))&&(-1===d.indexOf("image/")&&(d="image/"+d),-1===n.indexOf(a.formats,d))){this.onError(Error("The layer doesn't support the format of "+d));return}if(!e)e=a.styles[0];else if(-1===n.indexOf(a.styles,e)){this.onError(Error("The layer doesn't support the style of "+
e));return}if(!k&&a.dimensions)k=a.dimensions[0];else if(-1===n.indexOf(a.dimensions,k)){this.onError(Error("The layer doesn't support the dimension of "+k));return}if(!g&&a.dimensions2)g=a.dimensions2[0];else if(-1===n.indexOf(a.dimensions2,g)){this.onError(Error("The layer doesn't support the dimension of "+g));return}var f;if(c){if(f=n.filter(a.tileMatrixSetInfos,function(a){return a.tileMatrixSet===c})[0],!f){this.onError(Error("The tileMatrixSetId "+c+" is not supported by the layer of "+b));
return}}else(f=n.filter(a.tileMatrixSetInfos,function(a){return"GoogleMapsCompatible"===a.tileMatrixSet})[0])||(f=a.tileMatrixSetInfos[0]),c=f.tileMatrixSet;return this._getTileUrlTemplate(b,c,d,e,k,g)}this.onError(Error("couldn't find the layer "+b))},_getTileUrlTemplate:function(a,b,c,d,e,g){var k;a||(a=this._identifier);b||(b=this._tileMatrixSetId);c||(c=this.format);d||""===d||(d=this._style);if(this.resourceUrls&&0<this.resourceUrls.length)return k=this.resourceUrls[0].template,k.indexOf(".xxx")===
k.length-4&&(k=k.slice(0,k.length-4)),k=k.replace(/\{Style\}/gi,d),k=k.replace(/\{TileMatrixSet\}/gi,b),k=k.replace(/\{TileMatrix\}/gi,"{level}"),k=k.replace(/\{TileRow\}/gi,"{row}"),k=k.replace(/\{TileCol\}/gi,"{col}"),k=k.replace(/\{dimensionValue\}/gi,e),k=k.replace(/\{dimensionValue2\}/gi,g);"KVP"===this.serviceMode?k=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+a+"\x26STYLE\x3d"+d+"\x26FORMAT\x3d"+c+"\x26TILEMATRIXSET\x3d"+b+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(e="",this._formatDictionary[c.toLowerCase()]&&(e=this._formatDictionary[c.toLowerCase()]),k=this._url+a+"/"+d+"/"+b+"/{level}/{row}/{col}"+e);return k},_parseResourceInfo:function(){var b=this.layerInfos,c,d;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(d=0;d<b.length;d++)if(!(this._identifier&&b[d].identifier!==this._identifier||this.title&&b[d].title!==this.title||this._tileMatrixSetId&&b[d].tileMatrixSet!==this._tileMatrixSetId||this.format&&
"image/"+b[d].format!==this.format||this._style&&b[d].style!==this._style)){a.mixin(this,{description:b[d].description,tileInfo:b[d].tileInfo,spatialReference:b[d].tileInfo.spatialReference,fullExtent:b[d].fullExtent,initialExtent:b[d].initialExtent,_identifier:b[d].identifier,_tileMatrixSetId:b[d].tileMatrixSet,format:"image/"+b[d].format,_style:b[d].style});break}for(d=0;d<b.length;d++)c=b[d].tileInfo,96!==c.dpi&&(n.forEach(c.lods,function(a){a.scale=96*a.scale/c.dpi}),c.dpi=96),n.forEach(c.lods,
function(a){a.resolution=this._getResolution(c.spatialReference.wkid,90.71428571428571*a.scale/96,b[d].tileMatrixSet)},this);this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];n.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=a.levelValue?a.levelValue:a.level},this)},_getCapabilities:function(){var a;"KVP"===this.serviceMode?a=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:
this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===this.serviceMode&&(a=this._url+"/"+this.version+"/WMTSCapabilities.xml");a=this._appendCustomParameters(a);l({url:a,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(a){a=a.replace(/ows:/gi,"");a=v.parse(a);var b=c.query("Contents",a)[0];if(b){var d=c.query("OperationsMetadata",a)[0],e=c.query("[name\x3d'GetTile']",d)[0],d=this._url,e=c.query("Get",
e),k,g=!1,f,m;for(k=0;k<e.length;k++){var h=c.query("Constraint",e[k])[0];if(!h||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,h)){d=e[k].attributes[0].nodeValue;g=!0;break}else if(!h||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",h))f=e[k].attributes[0].nodeValue;else if(!h||this._getTagWithChildTagValue("AllowedValues","Value","KVP",h))m=e[k].attributes[0].nodeValue}g||("KVP"===this.serviceMode&&f?(d=f,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&
m&&(d=m,this.serviceMode="KVP"));-1===d.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(d+="/");"KVP"===this.serviceMode&&(d+=-1<d.indexOf("?")?"":"?");this._url=d;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",a)[0];f=c.query("Layer",b);var l,p=[];this.layers=[];n.forEach(f,function(a){l=this._getTagValues("Identifier",a)[0];p.push(l);this.layers.push(this._getWMTSLayerInfo(l,a,b))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else this.onError(Error("The WMTS capabilities XML is not valid"))},
_setActiveLayer:function(a){a||(a={});a.identifier&&(this._identifier=a.identifier);a.tileMatrixSet&&(this._tileMatrixSetId=a.tileMatrixSet);a.format&&(this.format=a.format);a.style&&(this._style=a.style);a.dimension&&(this._dimension=a.dimension);a.dimension2&&(this._dimension2=a.dimension2);if(this.layers)if(this._identifier?a=n.filter(this.layers,function(a){return a.identifier===this._identifier},this)[0]:(a=this.layers[0],this._identifier=this.layers[0].identifier),a){if(this.format){if(-1===
this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===n.indexOf(a.formats,this.format)){this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=a.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=a.styles[0];else if(-1===n.indexOf(a.styles,this._style)){this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&a.dimensions)this._dimension=
a.dimensions[0];else if(-1===n.indexOf(a.dimensions,this._dimension)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&a.dimensions2)this._dimension2=a.dimensions2[0];else if(-1===n.indexOf(a.dimensions2,this._dimension2)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}var b;if(this._tileMatrixSetId){if(b=n.filter(a.tileMatrixSetInfos,function(a){return a.tileMatrixSet===this._tileMatrixSetId},
this)[0],!b){this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(b=n.filter(a.tileMatrixSetInfos,function(a){return"GoogleMapsCompatible"===a.tileMatrixSet})[0])||(b=a.tileMatrixSetInfos[0]),this._tileMatrixSetId=b.tileMatrixSet;this.description=a.description;this.title=a.title;this.spatialReference=b.tileInfo.spatialReference;this.tileInfo=b.tileInfo;this._levelToLevelValue=[];n.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=
a.levelValue?a.levelValue:a.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=m.geographicToWebMercator(a.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=a.gcsExtent:(this.fullExtent=b.fullExtent,this.initialExtent=b.initialExtent);this.resourceUrls=a.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,
style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(a,b,d){var g=this._getTagValues("Abstract",b)[0],k=this._getTagValues("Title",b)[0],f=c.query("WGS84BoundingBox",b)[0],m=f?this._getTagValues("LowerCorner",f)[0].split(" "):["-180","-90"],h=f?this._getTagValues("UpperCorner",f)[0].split(" "):["180","90"],
f=parseFloat(m[0]),m=parseFloat(m[1]),l=parseFloat(h[0]),h=parseFloat(h[1]),f=new e(f,m,l,h,new w({wkid:4326})),h=this._getTagValues("Identifier",c.query("Style",b)[0]),p=this._getTagValues("Identifier",c.query("Dimension",b)[0]),y=this._getTagValues("Default",c.query("Dimension",b)[0])||this._getTagValues("Value",c.query("Dimension",b)[0]),t=1<c.query("Dimension",b).length?this._getTagValues("Identifier",c.query("Dimension",b)[1]):[],u=1<c.query("Dimension",b).length?this._getTagValues("Default",
c.query("Dimension",b)[1])||this._getTagValues("Value",c.query("Dimension",b)[1]):[],m=this._getTagValues("Format",b);d=this._getLayerMatrixInfos(b,d);a={identifier:a,tileMatrixSetInfos:d,formats:m,styles:h,title:k,description:g,gcsExtent:f,dimensions:y,dimensions2:u};b=c.query("ResourceURL",b);var x=[],v;n.forEach(b,function(a){v=a.getAttribute("template");if(p&&y&&p[0]&&y[0])if(-1<v.indexOf("{"+p+"}"))v=v.replace("{"+p+"}","{dimensionValue}");else{var b=v.toLowerCase().indexOf("{"+p[0].toLowerCase()+
"}");-1<b&&(v=v.substring(0,b)+"{dimensionValue}"+v.substring(b+p[0].length+2))}t&&u&&t[0]&&u[0]&&(-1<v.indexOf("{"+t+"}")?v=v.replace("{"+t+"}","{dimensionValue2}"):(b=v.toLowerCase().indexOf("{"+t[0].toLowerCase()+"}"),-1<b&&(v=v.substring(0,b)+"{dimensionValue2}"+v.substring(b+t[0].length+2))));x.push({template:v,format:a.getAttribute("format"),resourceType:a.getAttribute("resourceType")})});x&&0<x.length&&(a.resourceUrls=x);return a},_getLayerMatrixInfos:function(a,b){var c,d=[];this._allMatrixInfos||
(this._allMatrixInfos=[]);var e=this._getTagValues("TileMatrixSet",a);if(e&&0!==e.length)return n.forEach(e,function(e){var g;if(0<this._allMatrixInfos.length)for(c=0;c<this._allMatrixInfos.length;c++)if(this._allMatrixInfos[c].tileMatrixSet==e){g=this._allMatrixInfos[c];break}g||(g=this._getLayerMatrixInfo(e,a,b),this._allMatrixInfos.push(g));d.push(g)},this),d},_getLayerMatrixInfo:function(a,b,g){var k,f,m,h,l=[];b=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",a,b);var p=this._getTagValues("TileMatrix",
b),y=this._getTagWithChildTagValue("TileMatrixSet","Identifier",a,g),t=this._getTagValues("SupportedCRS",y)[0];k=parseInt(t.split(":").pop(),10);if(900913==k||3857==k)k=102100;if(-1<t.toLowerCase().indexOf("crs84")||-1<t.toLowerCase().indexOf("crs:84"))k=4326,h=!0;else if(-1<t.toLowerCase().indexOf("crs83")||-1<t.toLowerCase().indexOf("crs:83"))k=4269,h=!0;else if(-1<t.toLowerCase().indexOf("crs27")||-1<t.toLowerCase().indexOf("crs:27"))k=4267,h=!0;var n=new w({wkid:k}),u=c.query("TileMatrix",y)[0];
g=parseInt(this._getTagValues("TileWidth",u)[0],10);b=parseInt(this._getTagValues("TileHeight",u)[0],10);f=this._getTagValues("TopLeftCorner",u)[0].split(" ");var v=f[0],G=f[1];1<v.split("E").length&&(f=v.split("E"),v=f[0]*Math.pow(10,f[1]));1<G.split("E").length&&(f=G.split("E"),G=f[0]*Math.pow(10,f[1]));var v=parseFloat(v),G=parseFloat(G),E=h&&4326===k&&90===v&&-180===G;for(f=0;f<this._flippingAxisForWkids.length;f++)if(t.split(":").pop()>=this._flippingAxisForWkids[f][0]&&t.split(":").pop()<=this._flippingAxisForWkids[f][1]||
4326===k&&(!h||E)){4326===k&&90<v&&(v="90");m=new x(G,v,n);break}f===this._flippingAxisForWkids.length&&(m=new x(v,G,n));if(0===p.length)for(p=c.query("TileMatrix",y),f=0;f<p.length;f++)h=this._getLodFromTileMatrix(p[f],k,f,a),l.push(h);else for(f=0;f<p.length;f++)h=this._getTagWithChildTagValue("TileMatrix","Identifier",p[f],y),h=this._getLodFromTileMatrix(h,k,f,a),l.push(h);k=c.query("BoundingBox",y)[0];var I,H;k&&(I=this._getTagValues("LowerCorner",k)[0].split(" "),H=this._getTagValues("UpperCorner",
k)[0].split(" "));I&&1<I.length&&H&&1<H.length?(u=parseFloat(I[0]),k=parseFloat(I[1]),I=parseFloat(H[0]),H=parseFloat(H[1])):(I=this._getTagValues("MatrixWidth",u)[0],k=this._getTagValues("MatrixHeight",u)[0],u=m.x,H=m.y,I=u+I*b*l[0].resolution,k=H-k*g*l[0].resolution);H=I=new e(u,k,I,H,n);m=new d({dpi:96,spatialReference:n,format:this.format,rows:g,cols:b,origin:m,lods:l});return{tileMatrixSet:a,fullExtent:H,initialExtent:I,tileInfo:m}},_getCapabilitiesError:function(a){this.onError(a)},_getLodFromTileMatrix:function(a,
b,c,d){var e=this._getTagValues("Identifier",a)[0];a=this._getTagValues("ScaleDenominator",a)[0];1<a.split("E").length?(a=a.split("E"),a=a[0]*Math.pow(10,a[1])):a=parseFloat(a);b=this._getResolution(b,a,d);return{level:c,levelValue:e,scale:1.058267716535433*a,resolution:b}},_getResolution:function(a,b,c){a=f.isDefined(p[a])?p.values[p[a]]:"default028mm"===c?6370997*Math.PI/180:6378137*Math.PI/180;return 7*b/25E3/a},_getTag:function(a,b){return(a=c.query(a,b))&&0<a.length?a[0]:null},_getTagValues:function(a,
b){var d=[];a=a.split("\x3e");var e;e=c.query(a[0],b)[0];if(1<a.length){for(b=1;b<a.length-1;b++)e=c.query(a[b],e)[0];b=c.query(a[a.length-1],e)}else b=c.query(a[0],b);b&&0<b.length&&n.forEach(b,function(a){9>u("ie")?d.push(a.childNodes.length?a.childNodes[0].nodeValue:""):d.push(a.textContent)});return d},_getAttributeValues:function(a,b,d){a=c.query(a,d);var e=[];a&&0<a.length&&n.forEach(a,function(a){e.push(a.getAttribute(b))});return e},_getTagWithChildTagValue:function(a,b,d,e){e=e.childNodes;
var g,k;for(k=0;k<e.length;k++)if(-1<e[k].nodeName.indexOf(a)&&(9>u("ie")?f.isDefined(c.query(b,e[k])[0])&&(g=c.query(b,e[k])[0].childNodes[0].nodeValue):f.isDefined(c.query(b,e[k])[0])&&(g=c.query(b,e[k])[0].textContent),g===d||d.split(":")&&g===d.split(":")[1]))return e[k]},_appendCustomParameters:function(a){var b;if(this.customParameters)for(b in this.customParameters)a+=(-1===a.indexOf("?")?"?":"\x26")+b+"\x3d"+encodeURIComponent(this.customParameters[b]);return a},_appendCustomLayerParameters:function(b){var c,
d;if(this.customLayerParameters||this.customParameters)for(c in d=a.clone(this.customParameters||{}),a.mixin(d,this.customLayerParameters||{}),d)b+=(-1===b.indexOf("?")?"?":"\x26")+c+"\x3d"+encodeURIComponent(d[c]);return b},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,
4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,
2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],
[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});a.setObject("layers.WMTSLayer",b,h);return b})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(c,b,a,n){c=c(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,
format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(a){a&&(this.title=a.title,this.tileMatrixSet=a.tileMatrixSet,this.format=a.format,this.style=a.style,this.tileInfo=a.tileInfo,this.fullExtent=a.fullExtent,this.initialExtent=a.initialExtent,this.identifier=a.identifier,this.description=a.description,this.dimension=a.dimension)}});b.setObject("layers.WMTSLayerInfo",c,n);return c})},"esri/virtualearth/VEGeocoder":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p){c=c(f,{declaredClass:"esri.virtualearth.VEGeocoder",constructor:function(a){try{if(a=b.mixin({bingMapsKey:null},a||{}),this.url=h.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=h.urlToObject(this.url),this._queue=[],this.bingMapsKey=a.bingMapsKey,this.culture=a.culture||"en-US",this._errorHandler=b.hitch(this,this._errorHandler),this._addressToLocationsHandler=b.hitch(this,this._addressToLocationsHandler),
!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(x){throw this.onError(x),x;}},addressToLocations:function(a,c,e){if(this.bingMapsKey){var f=b.mixin({},this._url.query,{query:a,token:this.bingMapsKey,culture:this.culture}),g=this._addressToLocationsHandler,d=this._errorHandler,h=new n(t._dfdCanceller);h._pendingDfd=p({url:this._url.path,content:f,callbackParamName:"callback",load:function(a,b){g(a,b,c,e,h)},error:function(a){d(a,e,h)}});return h}this._queue.push(arguments)},_addressToLocationsHandler:function(b,
c,e,f,g){try{a.forEach(b,function(a,c){b[c]=new l(a)}),this._successHandler([b],"onAddressToLocationsComplete",e,g)}catch(d){this._errorHandler(d,f,g)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(a){this.bingMapsKey=a},setCulture:function(a){this.culture=a}});b.setObject("virtualearth.VEGeocoder",c,v);return c})},"esri/virtualearth/VEGeocodeResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),
function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",constructor:function(a){b.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},a);this.address&&(this.address=new h(this.address));this.bestView&&(this.bestView=new v(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new u(this.locationArray[0]))}});b.setObject("virtualearth.VEGeocodeResult",
c,n);return c})},"esri/virtualearth/VEAddress":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(c,b,a,n){c=c(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(a){b.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},a)}});b.setObject("virtualearth.VEAddress",c,n);return c})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m){c=c(x,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(a){try{if(a=b.mixin({bingMapsKey:null,culture:"en-US"},a||{}),this.url=t.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=t.urlToObject(this.url),this.spatialReference=new p({wkid:102100}),this.tileInfo=new w({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new p({wkid:102100})),b.mixin(this,a),this.hasAttributionData=this.showAttribution,this._initLayer=b.hitch(this,this._initLayer),this._errorHandler=b.hitch(this,this._errorHandler),this._getTileInfo=b.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(d){throw this.onError(d),d;}},_unsetMap:function(a,b){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var a=this._url.path+"/Imagery/Metadata/"+this.mapStyle,c=window.location.protocol;if(this.bingMapsKey){var e=this.resourceInfo;!this.loaded&&e?this._initLayer(e):m({url:a,content:b.mixin({},{uriScheme:"https:"===c?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(b,c){if(200!==b.statusCode)c=Error(),c.code=b.statusCode,c.message=b.statusDescription,c.details=b.errorDetails,c.authenticationResultCode=b.authenticationResultCode,this.onError(c);else try{this.resourceInfo=a.toJson(b);var d=b.resourceSets[0].resources[0],e=d.imageUrl.replace("{","${");this.tileServers=n.map(d.imageUrlSubdomains,function(a){var b=t.getProtocolForWebResource();return h.substitute(e,{subdomain:a}).replace("http:",b)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var f=this.loadCallback;f&&(delete this.loadCallback,f(this))}}catch(E){this.onError(E)}},getAttributionData:function(){var c=new f,d=a.fromJson(this.resourceInfo),e;this.hasAttributionData&&d&&(e=b.getObject("resourceSets.0.resources.0.imageryProviders",!1,d));e?c.callback({contributors:e}):
(d=Error("Layer does not have attribution data"),d.log=u.isDebug,c.errback(d));return c},getTileUrl:function(a,b,c){return h.substitute(this.tileServers[b%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,b,c),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(a,b,c){var d="",e,f;for(f=a;0<f;f--)a="0",e=1<<f-1,0!=(c&e)&&a++,0!=(b&e)&&(a++,a++),d+=a;return d},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},
setBingMapsKey:function(a){this.bingMapsKey=a},onMapStyleChange:function(){}});b.mixin(c,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});b.setObject("virtualearth.VETiledLayer",c,l);return c})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F,T,B,M,U,N,Q,O,K,I,H,L,fa){var X=c([w,x],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:fa,onLoad:function(){},constructor:function(a,b){a=a||{};this._settings=a.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var b=this._settings.layerInfos;this.featureReductionEnabledLayers=[];a.forEach(b,function(a){a=a.featureLayer;
a.isFeatureReductionEnabled()&&(a.disableFeatureReduction(),this.featureReductionEnabledLayers.push(a))},this);if(a.every(b,function(a){return a.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var c=b.length;a.forEach(b,function(a){a=a.featureLayer;if(a.loaded)c--;else var b=n.connect(a,"onLoad",this,function(a){n.disconnect(b);b=null;c--;c||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=
!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(a){this._updateCurrentFeature(b.hitch(this,function(){this._clearSelection(!1);a&&a()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();
this._disableMapClickHandler();a.forEach(this._eConnects,n.disconnect);n.disconnect(this._dtConnect);n.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();a.forEach(this.featureReductionEnabledLayers,
function(a){a.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new D(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new z(this._settings.map,{textSymbolEditorHolder:this.domNode});this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=b.mixin({reshapeVisible:!1,cutVisible:!1,
mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=b.mixin({polylineDrawTools:[X.CREATE_TOOL_POLYLINE],polygonDrawTools:[X.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?
!0:!1;this._datePackage=this._settings.datePackage;var a=H.defaults;this._settings.geometryService=this._settings.geometryService||a.geometryService;a.geometryService=a.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};a.forEach(this._settings.layerInfos,function(a){if(a.featureLayer&&a.featureLayer.loaded){this._settings.layers.push(a.featureLayer);var b=a.featureLayer.id;a.featureLayer.credential&&
(this._settings.userIds[b]=a.featureLayer.credential.userId);a.userId&&(this._settings.userIds[b]=a.userId);var c=a.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[b]=c.canCreate&&!c.canUpdate?!0:!1;this._isTextSymbolPointLayer(a.featureLayer)&&(a.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=
!1},_saveFeatureOnClient:function(a){var c=this.templatePicker.getSelected(),d;d=c.template?c.featureLayer.renderer.getSymbol(c.template.prototype):c.symbolInfo.symbol;this._tempGraphic=new y(a,d,null,null);this._tempGraphic.setAttributes(b.mixin({},c.template.prototype.attributes));d=this._settings.map;d.graphics.add(this._tempGraphic);a=this._findCenterPoint(a);this._createAttributeInspector();d.infoWindow.setTitle(c.featureLayer?c.featureLayer.name:L.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,
c.featureLayer);this._showInfoWindow(a,d.getInfoWindowAnchor(a));if(this._settings.createOnlyLayer[c.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=n.connect(d.infoWindow,"onHide",this,"_infoWindowHide");n.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=n.connect(this.templatePicker,
"onSelectionChange",b.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(a,b,c){this._tempGraphic.attributes[b]="number"===typeof c&&isNaN(c)?null:c},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);n.disconnect(this._infoWindowHideEvent)},_createFeature:function(c,d){this._editClickPoint=this._findCenterPoint(c);c.rings?this._simplify(c,b.hitch(this,function(c){this._drawingTool!==C.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(c,d)]}],b.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(c,b.hitch(this,function(c){c&&c.length&&this._applyEdits([{layer:this._layer,adds:a.map(c,b.hitch(this,function(a){return this._createGraphic(a,d)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(c,d)]}],b.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(a,b){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(a,b)},_updateCurrentFeature:function(a){var b=
this._isModified();b?this._updateFeature(b,a):a&&a(!1)},_updateFeature:function(a,c,d){var e=a.geometry,f=a.getLayer();f.hasZ&&!f.enableZDefaults||f.hasM&&!f.allowUpdateWithoutMValues||d&&!this._isModified()?(d=new y,d.setAttributes(a.attributes),this._applyEdits([{layer:a.getLayer(),updates:[d]}],c)):e.rings?this._simplify(e,b.hitch(this,function(d){this._applyEdits([{layer:a.getLayer(),updates:[b.mixin(a,{geometry:d})]}],c)})):this._applyEdits([{layer:a.getLayer(),updates:[a]}],c)},_deleteFeature:function(b,
c){if(this._settings.invalidTemplate&&b===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var d=[];b?d.push({layer:b.getLayer(),deletes:[b]}):(d=a.map(a.filter(this._settings.layers,function(a){return 0<a.getSelectedFeatures().length}),function(a){return{layer:a,deletes:a.getSelectedFeatures()}}))&&d.length||!this._currentGraphic||d.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(d,c)}},_stopEditing:function(a,c,
d,f){e.hide(this.progressBar.domNode);this._settings.createOnlyLayer[a.id]||this._undoRedoAdd();var g;!0===a._isSelOnly||1===a.mode||6===a.mode?c&&c.length&&(this.templatePicker.clearSelection(),g=new G,g.objectIds=[c[0].objectId],this._settings.createOnlyLayer[a.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([a],g,b.hitch(this,"_onEditFeature"))):((g=this._selectionHelper.findMapService(this._settings.map,a))&&g.refresh(),c&&c.length&&
(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[a.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):F.findFeatures(c,a,b.hitch(this,"_onEditFeature"))));f&&f.length&&(this._clearSelection(!0),this._undoRedo&&(g=this._selectionHelper.findMapService(a,this._settings.map))&&g.refresh());this._undoRedo&&d&&d.length&&((g=this._selectionHelper.findMapService(a,this._settings.map))&&g.refresh(),this.attributeInspector.refresh(),this._undoRedo=
!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var a=this._edits&&this._edits.length?this._edits[0]:null;if(a){var c=a.adds||[],d=a.updates||[],e=a.deletes||[],f=a.preUpdates||[],a={featureLayer:a.layer};"CUT"===this._activeTool?c.length&&d.length&&f.length&&this.undoManager.add(new U(b.mixin(a,{preUpdatedGraphics:f,addedGraphics:c,postUpdatedGraphics:d}))):
"UNION"===this._activeTool?e.length&&d.length&&f.length&&this.undoManager.add(new N(b.mixin(a,{preUpdatedGraphics:f,deletedGraphics:e,postUpdatedGraphics:d}))):c.length?this.undoManager.add(new T(b.mixin(a,{addedGraphics:c}))):e.length?this.undoManager.add(new M(b.mixin(a,{deletedGraphics:e}))):d.length&&(this._rollbackGraphic||f.length)&&this.undoManager.add(new B(b.mixin(a,{preUpdatedGraphics:f.length?f:[this._rollbackGraphic],postUpdatedGraphics:d})));this._rollbackGraphic=this._edits=null}}},
_activateDrawToolbar:function(a){this._layer=a.featureLayer;this._activeType=a.type;this._drawingTool=(this._activeTemplate=a.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,a.featureLayer);n.disconnect(this._dtConnect);var c=this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var d=b.mixin({},this._activeTemplate.prototype.attributes),c=c.filter(function(a){return!1===a.nullable&&!0===a.editable});
this._settings.invalidTemplate=c.some(function(a){a=d[a.name];return null===a||void 0===a})}this._dtConnect=this._settings.createOnlyLayer[a.featureLayer.id]||this._settings.invalidTemplate?n.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):n.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},
_activateEditToolbar:function(b,c){var d=b.getLayer(),e=d?d.geometryType:null,f=this._isTextSymbolPoint(b),g=z.MOVE;"esriGeometryPoint"!==e&&!0===this._isNotesFeature(b)?(g=g|z.ROTATE|z.SCALE,this._editVertices=!1):"esriGeometryPoint"!==e&&!0===this._editVertices?(g=g|z.ROTATE|z.SCALE,this._editVertices=!1):f?(g=g|z.ROTATE|z.SCALE|z.EDIT_TEXT,this._editVertices=!1):(g|=z.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new y(b.toJson());var e=d.getEditCapabilities({feature:b,
userId:this._settings.userIds[d.id]}),k=a.filter(this._settings.layerInfos,function(a){return a.featureLayer.layerId===d.layerId})[0];e.canUpdate&&!k.disableGeometryUpdate&&e.canUpdateGeometry&&(this.editToolbar.activate(g,b),f&&(this.editToolbar._textEditor._addTextBox(b),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(b)||(b=c&&c.screenPoint||this._findCenterPoint(b),this._showInfoWindow(b,this._settings.map.getInfoWindowAnchor(b)))},
_createGraphic:function(c,d){var e=new y(c,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,d);this._activeTemplate||d?e.attributes=d||b.mixin({},this._activeTemplate.prototype.attributes):(e.attributes=e.attributes||[],a.forEach(this._layer.fields,function(a){e.attributes[a.name]=null},this));return e},_connectEvents:function(){var c=this._settings.layers;a.forEach(c,function(a){this._connect(a,"onEditsComplete",b.hitch(this,"_stopEditing",a))},this);a.forEach(c,function(a){this._connect(a,
"onBeforeApplyEdits",b.hitch(this,function(){e.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",b.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",b.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",b.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",b.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,
"onRotateStart",b.hitch(this,"_hideAttributeInspector"))},_connect:function(a,b,c){this._eConnects.push(n.connect(a,b,c))},_createWidgets:function(){this._selectionHelper=new O(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,e.hide(this.templatePickerDiv);else{var c=a.filter(this._settings.layers,
function(a){return a.getEditCapabilities().canCreate});this.templatePicker=new K({"class":"esriTemplatePicker",featureLayers:c,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=n.connect(this.templatePicker,"onSelectionChange",b.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var c=this._settings.map;
this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new J({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},t.create("div")),this.attributeInspector.startup(),c.infoWindow.setContent(this.attributeInspector.domNode),c.infoWindow.setTitle(L.widgets.attributeInspector.NLS_title),c.infoWindow.resize(350,375),u.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));
this._connect(this.attributeInspector,"onDelete",b.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",b.hitch(this,function(a){this._updateCurrentFeature(b.hitch(this,function(){this._attributeChanged=!1;this._onEditFeature(a)}))}));this._usePopup&&c.infoWindow._setPagerCallbacks(this.attributeInspector,b.hitch(this.attributeInspector,"previous"),b.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",b.hitch(this,function(c,d,e){if(this._settings.createOnlyLayer[this._layer.id]||
this._settings.invalidTemplate)this._saveAttributesOnClient(c,d,e);else{var f=c.getLayer();(f=a.filter(f.fields,function(a){return a.name===d})[0])&&""===e&&(e=null);this._rollbackGraphic=new y(b.clone(c.toJson()));this.attributeInspector._rollbackInfo={field:f,graphic:this._rollbackGraphic};this._currentGraphic.attributes[d]="number"===typeof e&&isNaN(e)?null:e;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=
!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new Q({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:b.hitch(this,"_deleteFeature"),onApplyEdits:b.hitch(this,"_applyEdits"),onShowAttributeInspector:b.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=
!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new k({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,"onUndoComplete",b.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",b.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",b.hitch(this,function(a){if(a.metaKey||a.ctrlKey)"z"===a.charOrCode&&this._undo(),"y"===a.charOrCode&&this._redo()}))},
_updateUndoRedoOperations:function(a){if(a&&a.addedIds){var b;for(b=0;b<this.undoManager.length;b++){var c=this.undoManager.get(b);c&&a.layer===c._featureLayer&&c.updateObjectIds(a.oldIds,a.addedIds)}}a&&"Update Features"===a.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=n.connect(this._settings.map,"onClick",b.hitch(this,function(a){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(b.hitch(this,
function(){this._reset();this._updateSelection(a)})))}))},_disableMapClickHandler:function(){n.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var a=this.templatePicker.getSelected();a?this._updateCurrentFeature(b.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(a)})):(this._reset(),n.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},
_isTextSymbolPoint:function(a){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var b=a.getLayer(),c=b.renderer;a=a.symbol||b._getSymbol(a);!a&&(c.hasVisualVariables("sizeInfo",!1)||c.hasVisualVariables("colorInfo",!1)||c.hasVisualVariables("opacityInfo",!1))&&c.addBreak&&c.infos&&1===c.infos.length&&(a=c.infos[0].symbol||c.defaultSymbol);if(a&&"textsymbol"===a.type)return!0}return!1},_isTextSymbolPointLayer:function(a){return"esriGeometryPoint"===a.geometryType&&a.renderer&&a.renderer._symbols&&
a.renderer._symbols[0]&&a.renderer._symbols[0].symbol&&"textsymbol"===a.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(a){a=a.getLayer();if(!a)return!1;var b,c,d=!1;for(b=0;b<this._settings.layerInfos.length;b++)if(c=this._settings.layerInfos[b],c.featureLayer==a){d=c.disableAttributeUpdate;break}return d},_onEditFeature:function(a,c){if(a=(b.isArray(a)?a[0]:a)||null){var d;this._layer=a.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(a)){c=
c||this._editClickPoint||this._findCenterPoint(a);1<this._currentFeatureCount?(d=this._popupFeatures.indexOf(a),d=p.substitute(L.widgets.popup.NLS_pagingInfo,{index:d+1,total:this._currentFeatureCount})):d=this._layer?this._layer.name:L.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(d);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(c,this._settings.map.getInfoWindowAnchor(c));this._editClickPoint=
null}a!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=a,a.getDojoShape()&&a.getDojoShape().moveToFront(),c=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||c&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(a))}},_applyEdits:function(c,d){c=c||[];if(!(0>=c.length)){this._edits=this._oEdits=c;var g=[];a.forEach(c,function(a){a.layer&&g.push(a.layer.applyEdits(a.adds,a.updates,a.deletes))});0<g.length&&(this._deferredsList=(new f(g)).addCallback(b.hitch(this,
function(){e.hide(this.progressBar.domNode);d&&d();var a=this._settings.map;a&&a.infoWindow.reposition&&a.infoWindow.isShowing&&a.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(a,
b){d.prototype.isSelfIntersecting(a)?this._settings.geometryService.simplify([a],function(a){var c=a&&a.length?a[0]:c;b&&b(c)}):b&&b(a)},_autoComplete:function(a,c){var d=this._getLayers("esriGeometryPolygon"),e=new G;e.geometry=a;e.returnGeometry=!0;this._selectFeatures(d,e,b.hitch(this,function(b){!b||0>=b.length?c&&c([a]):this._settings.geometryService.autoComplete(m.getGeometries(b),this._toPolylines([e.geometry]),function(a){c&&c(a)})}))},_getLayers:function(b){return a.filter(this._settings.layers,
function(a){return a.geometryType===b})},_selectFeatures:function(a,b,c,d){this._selectionHelper.selectFeatures(a,b,d||E.SELECTION_NEW,c)},_updateSelection:function(c){var d=c.mapPoint,e=c.graphic,f=this._settings.layerInfos,g;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,d,E.SELECTION_NEW,b.hitch(this,function(c){var k=a.some(c,b.hitch(this,function(a){return a==e}));if(e&&!k)if(k=e.getLayer(),this._isValidLayer(k)){var m=new G;m.objectIds=[e.attributes[k.objectIdField]];this._selectionHelper.selectFeatures([k],
m,E.SELECTION_ADD,b.hitch(this,function(a){a&&a.length&&(a=a.concat(c),g=F.sortFeaturesById(f,a),this._updatePopupButtons(g),this._onEditFeature(g,d))}))}else c&&c.length?(g=F.sortFeaturesById(f,c),this._updatePopupButtons(g),this._onEditFeature(g,d)):this._clearSelection();else c&&c.length?(g=F.sortFeaturesById(f,c),this._updatePopupButtons(g),this._onEditFeature(g,d)):this._clearSelection()}));e&&this._isTextSymbolPoint(e)&&this._isValidLayer(e.getLayer())&&this.editToolbar.activate(0|z.MOVE|z.ROTATE|
z.SCALE|z.EDIT_TEXT,e)},_updatePopupButtons:function(c){if(this._usePopup&&c){var d=c.length;a.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],b.hitch(this,function(a){1<d?l.remove(a,"hidden"):l.add(a,"hidden")}));var e=1<d?"block":"none";u.query(".esriAttributeInspector .atiLayerName").style({display:e});this._currentFeatureCount=d;this._popupFeatures=c}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(a){this._currentFeatureCount=
0;this._popupFeatures=null;this._selectionHelper.clearSelection(a||!1);this._reset()},_findCenterPoint:function(a){a=a.geometry||a;var b;switch(a.type){case "point":b=a;break;case "polyline":b=a.getPoint(0,Math.ceil(a.paths[0].length/2));break;case "polygon":b=a.rings.length-1,b=a.getPoint(b,a.rings[b].length-1)}return this._settings.map.toScreen(b)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(b){return a.map(b,
function(b){var c=new g(b.spatialReference);a.forEach(b.rings,function(a){c.addPath(a)});return c})},_isNotesFeature:function(b){var c=b.getLayer(),d=c?c.types||null:null;if(!d)return!1;var e=b.attributes[c.typeIdField],f;a.some(d,function(a){return a.id===e?(f=a.templates,!0):!1});return f?(b=f[0]||null)?this._isShapeTool(b.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(a){var b,c=this._settings.layerInfos;for(b=0;b<c.length;b++){var d=c[b];if(a.id==(d.featureLayer?d.featureLayer.id:d.layerId))return!0}return!1},
_isShapeTool:function(a){switch(a){case C.TOOL_ARROW:return D.ARROW;case C.TOOL_LEFT_ARROW:return D.LEFT_ARROW;case C.TOOL_RIGHT_ARROW:return D.RIGHT_ARROW;case C.TOOL_UP_ARROW:return D.UP_ARROW;case C.TOOL_DOWN_ARROW:return D.DOWN_ARROW;case C.TOOL_CIRCLE:return D.CIRCLE;case C.TOOL_ELLIPSE:return D.ELLIPSE;case C.TOOL_TRIANGLE:return D.TRIANGLE;case C.TOOL_RECTANGLE:return D.RECTANGLE;default:return null}},_toDrawTool:function(a,b){b=b.geometryType;switch(a){case C.TOOL_POINT:return D.POINT;case C.TOOL_ARROW:return D.ARROW;
case C.TOOL_LEFT_ARROW:return D.LEFT_ARROW;case C.TOOL_RIGHT_ARROW:return D.RIGHT_ARROW;case C.TOOL_UP_ARROW:return D.UP_ARROW;case C.TOOL_DOWN_ARROW:return D.DOWN_ARROW;case C.TOOL_CIRCLE:return D.CIRCLE;case C.TOOL_ELLIPSE:return D.ELLIPSE;case C.TOOL_TRIANGLE:return D.TRIANGLE;case C.TOOL_RECTANGLE:return D.RECTANGLE;case C.TOOL_LINE:return D.POLYLINE;case C.TOOL_POLYGON:return D.POLYGON;case C.TOOL_FREEHAND:return"esriGeometryPolyline"===b?D.FREEHAND_POLYLINE:D.FREEHAND_POLYGON;default:return a=
D.POINT,"esriGeometryPolyline"===b?(a=D.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===X.CREATE_TOOL_FREEHAND_POLYLINE&&(a=D.FREEHAND_POLYLINE)):"esriGeometryPolygon"===b&&(a=D.POLYGON,this._settings.createOptions.polygonDrawTools[0]===X.CREATE_TOOL_FREEHAND_POLYGON&&(a=D.FREEHAND_POLYGON)),a}},_isModified:function(){var a=this.editToolbar.getCurrentState();return(a.isModified||this._attributeChanged)&&a.graphic?a.graphic:null},_showInfoWindow:function(a,b){this._customAttributeInspector||
this._settings.map.infoWindow.show(a,b)}});b.mixin(X,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",
CREATE_TOOL_LEFT_ARROW:"leftarrow"});b.setObject("dijit.editing.Editor",X,I);return X})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented ./OperationBase".split(" "),function(c,b,a,n,u,v){c=c([v],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(a){a=
a||{};a.maxOperations&&(this.maxOperations=a.maxOperations);this._historyStack=[]},add:function(a){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,a);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var a=this.peekUndo();this.position--;a?(a=a.performUndo(),this.onUndo(),this._checkAvailability(),n(a).then(b.hitch(this,this.onUndoComplete))):
(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var a=this.peekRedo();this.position++;a?(a=a.performRedo(),this.onRedo(),this._checkAvailability(),n(a).then(b.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=
!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<
this._historyStack.length)return this.get(this.position)},get:function(a){return this._historyStack[a]},remove:function(a){0<this._historyStack.length&&(this._historyStack.splice(a,1),0<this.position&&a<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});return u.UndoManager=c})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(c,b,a){c=c(null,{declaredClass:"esri.OperationBase",type:"not implemented",
label:"not implemented",constructor:function(a){a=a||{};a.label&&(this.label=a.label)},performUndo:function(){},performRedo:function(){}});return a.OperationBase=c})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E){var C=b(x,{declaredClass:"esri.toolbars.Edit",constructor:function(b,c){this._map=b;this._tool=0;if(this._map.loaded)this._scratchGL=b.graphics;else var d=n.connect(this._map,"onLoad",this,function(){n.disconnect(d);d=null;this._scratchGL=this._map.graphics});b=h("esri-mobile");this._defaultOptions=a.mixin({vertexSymbol:new y(y.STYLE_CIRCLE,b?20:12,new k(k.STYLE_SOLID,new v([0,0,0,.5]),1),new v([128,128,128])),ghostVertexSymbol:new y(y.STYLE_CIRCLE,
b?18:10,new k(k.STYLE_SOLID,new v([0,0,0,.5]),1),new v([255,255,255,.75])),ghostLineSymbol:new k(k.STYLE_DOT,new v([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:b?24:16,boxLineSymbol:new k(k.STYLE_DASH,new v([64,64,64]),1),boxHandleSymbol:new y(y.STYLE_SQUARE,b?16:9,new k(k.STYLE_SOLID,new v([0,0,0,.5]),1),new v([255,255,255,.75])),textAnchorSymbol:new y(y.STYLE_CIRCLE,10,null,new v([255,0,0]))},c||{})},activate:function(b,c,d){this.deactivate();this._graphic=c;this._options=
a.mixin(a.mixin({},this._defaultOptions),d||{});var e=C.MOVE;d=C.EDIT_VERTICES;var f=C.SCALE,g=C.ROTATE,k=C.EDIT_TEXT,m=!1,h=!1,l=!1,p=this._map,y=p.spatialReference,t=c.geometry.spatialReference;this._geo=!(!y||!t||y.equals(t)||!y.isWebMercator()||4326!==t.wkid);this._isTextPoint=this._prepareTextSymbolEditing(c,b);(b&e)===e&&(m=this._enableMove(c));e=(b&f)===f;g=(b&g)===g;if(e||g)l=this._enableBoxEditing(c,e,g);(b&d)===d&&(h=this._enableVertexEditing(c));(b&k)===k&&this._enableTextEditing(c);if(!(m||
h||l))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=b)this._mapPanEndHandle=n.connect(p,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=n.connect(p,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,c);p.snappingManager&&(m||h)&&p.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,b=this._graphic;if(a){var c=
!!this._modified;this._clear();n.disconnect(this._mapPanEndHandle);n.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(a,b,{isModified:c});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(a,b){},onDeactivate:function(a,b,c){},
onGraphicMoveStart:function(a){},onGraphicFirstMove:function(a){this._modified=!0},onGraphicMove:function(a,b){},onGraphicMoveStop:function(a,b){},onGraphicClick:function(a,b){},onVertexMoveStart:function(a,b){},onVertexFirstMove:function(a,b){this._modified=!0},onVertexMove:function(a,b,c){},onVertexMoveStop:function(a,b,c){},onVertexAdd:function(a,b){this._modified=!0},onVertexClick:function(a,b){},onVertexMouseOver:function(a,b){},onVertexMouseOut:function(a,b){},onVertexDelete:function(a,b){this._modified=
!0},onTextEditStart:function(a,b){},onTextEditEnd:function(a){},onScaleStart:function(a){},onScaleFirstMove:function(a){this._modified=!0},onScale:function(a,b){},onScaleStop:function(a,b){},onRotateStart:function(a){},onRotateFirstMove:function(a){this._modified=!0},onRotate:function(a,b){},onRotateStop:function(a,b){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var d=a.getLayer(),e=d.renderer,d=a.symbol||d._getSymbol(a);!d&&(e.hasVisualVariables("sizeInfo",!1)||e.hasVisualVariables("colorInfo",!1)||e.hasVisualVariables("opacityInfo",!1))&&e.addBreak&&
e.infos&&1===e.infos.length&&(d=e.infos[0].symbol||e.defaultSymbol);if(d&&"textsymbol"===d.type){if((b&C.SCALE)===C.SCALE||(b&C.ROTATE)===C.ROTATE||(b&C.EDIT_TEXT)===C.EDIT_TEXT){a.setSymbol(new G(d.toJson()));var g=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(a),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){g._boxEditor&&g._boxEditor.refresh()})):
c(["../dijit/SymbolEditor"],function(b){if(!g._textSymbolEditor){var c;c=g._options.textSymbolEditorHolder?f.create("div",null,g._options.textSymbolEditorHolder):f.create("div",null,g._map.root);g._textSymbolEditor=new b({graphic:a},c);b=g._textSymbolEditor.domNode.parentNode.id;l.set(g._textSymbolEditor.domNode,{position:"map_root"===b?"absolute":"relative",left:"map_root"===b?g._map.width/2-100+"px":"5px",top:"20px","z-index":50});g._textSymbolEditor.startup();g._textSymbolEditor.createForm(a);
g._textSymbolEditor.show();g._textSymbolEditor.on("symbol-change",function(){g._boxEditor&&g._boxEditor.refresh()})}})}if((b&C.MOVE)===C.MOVE||(b&C.ROTATE)===C.ROTATE||(b&C.SCALE)===C.SCALE)this._textAnchor=new E(a.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(a){var b=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new m(a,b,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var b=
this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=g.create(a,b,this),!0}return!1},_enableBoxEditing:function(a,b,c){var d=this._map,f=a.geometry.type;return"polyline"===f||"polygon"===f||this._isTextPoint?(this._boxEditor=new e(a,d,this,b,c,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(b){return this._isTextPoint?(this._textEditor=new d(b,this._map,this),n.connect(this._textEditor,"onEditStart",a.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(a,b,c){c&&this._refreshMoveables()},_refreshMoveables:function(a){var b=u.filter([this._graphicMover,this._vertexEditor,this._boxEditor],p.isDefined);u.forEach(b,function(b){b.refresh(a)})},_beginOperation:function(a){u.forEach(this._getAffectedTools(a),function(a){a.suspend()})},_endOperation:function(a){u.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var b=[];switch(a){case "MOVE":b=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return b=u.filter(b,p.isDefined)}});a.mixin(C,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});a.setObject("toolbars.Edit",C,t);return C})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d){c=c(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,c,d,e,f,g,m){this._graphic=a;this._map=c;this._toolbar=d;this._scale=e;this._rotate=f;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=g;a=d._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=b.hitch(this,this._moveStartHandler);this._firstMoveHandler=b.hitch(this,this._firstMoveHandler);
this._moveStopHandler=b.hitch(this,this._moveStopHandler);this._moveHandler=b.hitch(this,this._moveHandler);this._isTextPoint=m;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){a.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){a.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
a.forEach(this._connects,n.disconnect);var b=this._toolbar._scratchGL;this._anchors&&a.forEach(this._anchors,function(a){b.remove(a.graphic);(a=a.moveable)&&a.destroy()});this._box&&b.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var c=this._map,e=this._toolbar._scratchGL,f=this._getBoxCoords(),g=new x(c.spatialReference),m=b.clone(a.filter(f,function(a,b){return 8!==b&&0===b%2}));m[0]&&m.push([m[0][0],m[0][1]]);g.addPath(m);this._rotate&&
g.addPath([f[1],f[8]]);this._box?this._box.setGeometry(g):(this._box=new d(g,this._lineSymbol),e.add(this._box));this._anchors?a.forEach(this._anchors,function(a,b){this._scale||(b=8);var d=new w(f[b],c.spatialReference);a.graphic.setGeometry(d);var d=a.moveable,e=a.graphic.getDojoShape();e&&(d?e!==d.shape&&(d.destroy(),a.moveable=this._getMoveable(a.graphic,b)):a.moveable=this._getMoveable(a.graphic,b))},this):(this._anchors=[],this._connects=[],a.forEach(f,function(a,b){!this._scale&&8>b||(a=new w(a,
c.spatialReference),a=new d(a,this._markerSymbol),this._isTextPoint&&1===b%2&&a.hide(),e.add(a),this._anchors.push({graphic:a,moveable:this._getMoveable(a,b)}))},this))}else this._cleanUp()},_getBoxCoords:function(c){var d=this._map,e,f=[],g,m,h;if(this._isTextPoint){e=this._graphic.getNode().getBoundingClientRect();var l=d.__container.getBoundingClientRect();e=[{x:e.left-l.left,y:e.top-l.top},{x:e.right-l.left,y:e.top-l.top},{x:e.right-l.left,y:e.bottom-l.top},{x:e.left-l.left,y:e.bottom-l.top}]}else e=
this._getTransformedBoundingBox(this._graphic);a.forEach(e,function(a,b,e){g=a;(m=e[b+1])||(m=e[0]);h={x:(g.x+m.x)/2,y:(g.y+m.y)/2};c||(g=d.toMap(g),h=d.toMap(h));f.push([g.x,g.y]);f.push([h.x,h.y])});this._rotate&&(e=b.clone(f[1]),e=c?{x:e[0],y:e[1]}:d.toScreen({x:e[0],y:e[1],spatialReference:d.spatialReference}),e.y-=this._toolbar._options.rotateHandleOffset,c||(e=d.toMap(e)),f.push([e.x,e.y]));return f},_getTransformedBoundingBox:function(a){var b=this._map,c=a.geometry.getExtent(),d=a.geometry.spatialReference;
a=new w(c.xmin,c.ymax,d);c=new w(c.xmax,c.ymin,d);a=b.toScreen(a);c=b.toScreen(c);return[{x:a.x,y:a.y},{x:c.x,y:a.y},{x:c.x,y:c.y},{x:a.x,y:c.y}]},_getAllGraphics:function(){var b=[this._box];this._anchors&&a.forEach(this._anchors,function(a){b.push(a.graphic)});return b=a.filter(b,p.isDefined)},_getMoveable:function(a,b){var c=a.getDojoShape();if(c)return a=new f(c),a._index=b,this._connects.push(n.connect(a,"onMoveStart",this._moveStartHandler)),this._connects.push(n.connect(a,"onFirstMove",this._firstMoveHandler)),
this._connects.push(n.connect(a,"onMoveStop",this._moveStopHandler)),a.onMove=this._moveHandler,(c=c.getEventSource())&&h.set(c,"cursor",this._toolbar._cursors["box"+b]),a},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(c){this._toolbar._deactivateScrollWheel();var d=c.host._index,e=this._wrapOffset=c.host.shape._wrapOffsets[0]||0,f=this._graphic.getLayer()._getTransform(),g;c=a.map(this._getBoxCoords(!0),
function(a){return{x:a[0]+e,y:a[1]}});g=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:c[1].x,y:c[3].y};this._centerCoord=l.multiplyPoint(l.invert(f),g);if(8===d)g=l.multiplyPoint(l.invert(f),c[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,g)),this._startLine=[this._centerCoord,g],this._moveLine=b.clone(this._startLine);else if(g=l.multiplyPoint(l.invert(f),c[d]),f=l.multiplyPoint(l.invert(f),c[(d+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,
g)),this._firstMoverToAnchor=Math.sqrt((g.x-this._centerCoord.x)*(g.x-this._centerCoord.x)+(g.y-this._centerCoord.y)*(g.y-this._centerCoord.y)),this._startBox=f,this._startBox.width=c[4].x-c[0].x,this._startBox.height=c[4].y-c[0].y,this._moveBox=b.clone(this._startBox),this._xfactor=g.x>f.x?1:-1,this._yfactor=g.y>f.y?1:-1,1===d||5===d)this._xfactor=0;else if(3===d||7===d)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===d?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},
_moveHandler:function(a,b){a=a.host._index;var c=this._defaultEventArgs,d,e,f;c.angle=0;c.scaleX=1;c.scaleY=1;if(8===a)d=this._startLine,e=this._moveLine,f=e[1],f.x+=b.dx,f.y+=b.dy,b=this._getAngle(d,e),this._isTextPoint&&(b+=this._graphic.symbol.angle),e=l.rotategAt(b,d[0]),this._graphic.getDojoShape().setTransform(e),c.transform=e,c.angle=b,c.around=d[0];else{d=this._startBox;e=this._moveBox;e.width+=b.dx*this._xfactor;e.height+=b.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(d=e.x+
this._xfactor*e.width,e=e.y+this._yfactor*e.height,d=Math.sqrt((d-this._centerCoord.x)*(d-this._centerCoord.x)+(e-this._centerCoord.y)*(e-this._centerCoord.y)),this._scaleRatio=b=f=d/this._firstMoverToAnchor,d=this._centerCoord):(b=e.width/d.width,f=e.height/d.height,d={x:d.x,y:d.y});if(isNaN(b)||Infinity===b||-Infinity===b)b=1;if(isNaN(f)||Infinity===f||-Infinity===f)f=1;e=l.scaleAt(b,f,d);if(this._isTextPoint){var g=l.rotategAt(this._graphic.symbol.angle,d);this._graphic.getDojoShape().setTransform([g,
e])}else this._graphic.getDojoShape().setTransform(e);c.transform=e;c.scaleX=b;c.scaleY=f;c.around=d}this._toolbar["on"+(8===a?this._rotateEvent:this._scaleEvent)](this._graphic,c)},_moveStopHandler:function(a){this._toolbar._activateScrollWheel();var b=this._graphic,c=this._toolbar,d=c._geo?m.geographicToWebMercator(b.geometry):b.geometry,e=d.spatialReference,f=b.getDojoShape(),h=f.getTransform(),l=b.getLayer()._getTransform();this._isTextPoint?(b=this._graphic.symbol,8===a.host._index?b.angle+=
this._getAngle(this._startLine,this._moveLine):b.font.setSize(Math.round(b.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(b)):(d=d.toJson(),this._updateSegments(d.paths||d.rings,h,l,e),f.setTransform(null),d=g.fromJson(d),b.setGeometry(c._geo?m.webMercatorToGeographic(d,!0):d));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;c._endOperation("BOX");this._defaultEventArgs.transform=h;c["on"+(8===a.host._index?this._rotateEvent:
this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(b,c,d,e){var f=this._map,g=this._wrapOffset||0;a.forEach(b,function(b){a.forEach(b,function(a){this._updatePoint(a,e,g,l,f,d,c)},this)},this)},_updatePoint:function(a,b,c,d,e,f,g){b=e.toScreen({x:a[0],y:a[1],spatialReference:b},!0);b.x+=c;b=d.multiplyPoint([f,g,d.invert(f)],b);b.x-=c;c=e.toMap(b);a[0]=c.x;a[1]=c.y},_getAngle:function(a,b){return 180*Math.atan2(b[0].y-b[1].y,b[0].x-b[1].x)/Math.PI-180*Math.atan2(a[0].y-
a[1].y,a[0].x-a[1].x)/Math.PI},_deNormalizePoint:function(a,b){var c=this._map._getFrameWidth();if(-1===c)return a;for(a={x:a.x,y:a.y};Math.abs(a.x-b.x)>=c;)a.x=a.x<b.x?a.x+c:a.x-c;var d=Math.abs(a.x-b.x);Math.abs(a.x-b.x+c)<d?a.x+=c:Math.abs(a.x-b.x-c)<d&&(a.x-=c);return a}});b.setObject("toolbars._Box",c,t);return c})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(c,b,a,n,u,v,h,f,l,t){return b("dojox.gfx.Moveable",null,{constructor:function(a,b){this.shape=a;this.delay=b&&0<b.delay?b.delay:0;this.mover=b&&b.mover?b.mover:l;this.leftButtonOnly=b&&b.leftButtonOnly;this.events=[this.shape.on(v.press,c.hitch(this,"onMouseDown"))]},destroy:function(){a.forEach(this.events,function(a){a.remove()});this.events=this.shape=null},onMouseDown:function(a){this.delay?(this.events.push(this.shape.on(v.move,c.hitch(this,"onMouseMove")),this.shape.on(v.release,c.hitch(this,
"onMouseUp"))),this._lastX=a.clientX,this._lastY=a.clientY):this.leftButtonOnly&&!t.isLeft(a)||new this.mover(this.shape,a,this);n.stop(a)},onMouseMove:function(a){var b=a.clientY;if(Math.abs(a.clientX-this._lastX)>this.delay||Math.abs(b-this._lastY)>this.delay)this.onMouseUp(a),new this.mover(this.shape,a,this);n.stop(a)},onMouseUp:function(a){this.events.pop().remove()},onMoveStart:function(a){u.publish("/gfx/move/start",a);h.add(f.body(),"dojoMove")},onMoveStop:function(a){u.publish("/gfx/move/stop",
a);h.remove(f.body(),"dojoMove")},onFirstMove:function(a){},onMove:function(a,b,c){this.onMoving(a,b,c);this.shape.applyLeftTransform(b);this.onMoved(a,b)},onMoving:function(a,b){},onMoved:function(a,b){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(c,b,a,n,u,v){return a("dojox.gfx.Mover",null,{constructor:function(a,b,l){this.shape=a;this.lastX=b.clientX;this.lastY=b.clientY;a=this.host=l;b=
document;l=n(b,u.move,c.hitch(this,"onFirstMove"));this.events=[n(b,u.move,c.hitch(this,"onMouseMove")),n(b,u.release,c.hitch(this,"destroy")),n(b,"dragstart",c.hitch(v,"stop")),n(b,"selectstart",c.hitch(v,"stop")),l];if(a&&a.onMoveStart)a.onMoveStart(this)},onMouseMove:function(a){var b=a.clientX,c=a.clientY;this.host.onMove(this,{dx:b-this.lastX,dy:c-this.lastY},a);this.lastX=b;this.lastY=c;v.stop(a)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){b.forEach(this.events,
function(a){a.remove()});var a=this.host;if(a&&a.onMoveStop)a.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e){var m=c(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(a,b,c,e){this.graphic=a;this.map=b;this.toolbar=c;this.tempPt=e;this._enableGraphicMover();this._moved=!1},refresh:function(a){var b=this.graphic.getDojoShape();!b||!a&&b._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var b=this.graphic,c=b.getDojoShape();c&&(c._hostGraphic=b,this._moveable=new v(c,{mover:m.Mover}),this._moveStartHandle=
a.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=a.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=a.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=a.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(b=c.getEventSource())&&u.set(b,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var b=this._moveable;if(b){a.disconnect(this._moveStartHandle);a.disconnect(this._firstMoveHandle);
a.disconnect(this._movingHandle);a.disconnect(this._moveStopHandle);var c=b.shape;c&&(c._hostGraphic=null,(c=c.getEventSource())&&u.set(c,"cursor","inherit"));b.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,b=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&b.snappingManager&&b.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(a,b,c){a=a.shape.getTransform();b=this.map;var d;p("esri-pointer")?d=b.navigationManager.pointerEvents._processTouchEvent(c,c):c&&"pointermove"===c.type&&(d=t.prototype._processTouchEvent.call({map:b},c,c));d&&b.snappingManager&&b.snappingManager._onSnappingMouseMoveHandler(d);this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(a){var b=this.graphic,c=this.toolbar,g=this.map,m=c._geo?w.geographicToWebMercator(b.geometry):
b.geometry,h=m.type,l=b.getDojoShape(),p=l.getTransform();if(n.toJson(p)!==n.toJson(this._startTx)){this._moved=!0;switch(h){case "point":var h=[p,f.invert(this._startTx)],t;g.snappingManager&&(t=g.snappingManager._snappingPoint);m=t||g.toMap(f.multiplyPoint(h,g.toScreen(m,!0)));g.snappingManager&&g.snappingManager._killOffSnapping();break;case "polyline":m=this._updatePolyGeometry(m,m.paths,p);break;case "polygon":m=this._updatePolyGeometry(m,m.rings,p)}l.setTransform(null);b.setGeometry(c._geo?
w.webMercatorToGeographic(m,!0):m);this.tempPt&&this.tempPt.setGeometry(new e(b.geometry.toJson()))}else this._moved=!1;c._endOperation("MOVE");c.onGraphicMoveStop(b,p);this._moved||(a=a.__e,g=this.map.position,a=new x(a.pageX-g.x,a.pageY-g.y),c.onGraphicClick(b,{screenPoint:a,mapPoint:this.map.toMap(a)}))},_updatePolyGeometry:function(a,b,c){var d=this.map,e=a.getPoint(0,0),d=d.toMap(d.toScreen(e).offset(c.dx,c.dy));c=d.x-e.x;for(var e=d.y-e.y,f,g,m,d=0;d<b.length;d++)for(g=b[d],f=0;f<g.length;f++)m=
a.getPoint(d,f),a.setPoint(d,f,m.offset(c,e));return a}});m.Mover=c(h,{declaredClass:"esri.toolbars._Mover",constructor:function(a,b,c){this.__e=b}});b.setObject("toolbars._GraphicMover",m,l);b.setObject("toolbars._Mover",m.Mover,l);return m})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(c,
b,a,n,u,v,h,f,l,t,p,w){var x=c(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,b,c){this.graphic=a;this.map=b;this.toolbar=c;a=c._options;this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;b=a.ghostLineSymbol;this._lineStroke={style:b.style,width:b.width,color:b.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=a.connect(l,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=a.connect(l,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var b=this._getGraphicsLayer();this._mouseOverHandle=a.connect(b,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=a.connect(b,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new v({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),b=this._ctxDelete=new h({label:w.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
a.connect(b,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(b),this._ctxMenu.startup())},_removeControllers:function(){a.disconnect(this._firstMoveHandle);a.disconnect(this._moveStopHandle);a.disconnect(this._mouseOverHandle);a.disconnect(this._mouseOutHandle);a.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(a,b,c){var d,e,f=this.graphic,g=[];for(d=0;d<a.length;d++){var m=a[d],h=[];for(e=0;e<m.length;e++)h.push(new l(m[e],b,f,d,e,m.length,this,c));g.push(h)}return g},_remove:function(a){a&&n.forEach(a,function(a){n.forEach(a,function(a){a.destroy()})})},_refresh:function(a){a&&n.forEach(a,function(a){n.forEach(a,function(a){a.refresh()})})},_isNew:function(a){return-1===n.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var b=this._findMover(a);b&&(this.toolbar.onVertexMouseOver(this.graphic,b._getInfo()),b._placeholder||(this._selectedMover=b,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=
this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var b,c=[];b=this._mpVertexMovers;n.forEach(this._vertexMovers,function(a){c=c.concat(a)});b&&n.forEach(b,function(a){c=c.concat(a)});
for(b=0;b<c.length;b++){var d=c[b];if(d.graphic===a)return d}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(a,b){var c=this._isNew(a);b&&(b.dx||b.dy)?(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,c),this._canAdd&&(c?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES")):
!c&&this._canAdd&&this._showRelatedMidpoints(a)},_showRelatedMidpoints:function(a){var b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),c=this._mpVertexMovers[a.segIndex];for(a=0;a<b.length;a++){var d=c[b[a]];d.graphic.show();d.refresh()}},_hideRelatedMidpoints:function(a){var b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),c=this._mpVertexMovers[a.segIndex];for(a=0;a<b.length;a++)c[b[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var b,c=this._getAdjacentMidpoints(a.ptIndex,a.segLength),
d=this._mpVertexMovers[a.segIndex];for(b=0;b<c.length;b++){var e=this._getAdjacentVertices(c[b],a.segLength),f=a.relatedGraphic.geometry.getPoint(a.segIndex,e[0]),e=a.relatedGraphic.geometry.getPoint(a.segIndex,e[1]),f=new t({x:(f.x+e.x)/2,y:(f.y+e.y)/2,spatialReference:f.spatialReference.toJson()});d[c[b]].graphic.setGeometry(f)}},_addMidpoints:function(a){var b=a.segIndex,c=a.ptIndex,d=a.segLength,e=c+1,f,h=d+1;this._mpVertexMovers[b].splice(c,1);var p=this._vertexMovers[b];for(f=0;f<e;f++)p[f].segLength+=
1;for(f=e;f<p.length;f++)p[f].ptIndex+=1,p[f].segLength+=1;a.ptIndex=e;a.segLength=p.length+1;p.splice(e,0,a);a.graphic.setSymbol(this._symbol1);p=this._mpVertexMovers[b];for(f=0;f<c;f++)p[f].segLength+=1;for(f=c;f<d-1;f++)p[f].ptIndex+=1,p[f].segLength+=1;e=this._getAdjacentVertices(c,h);b=this._getAdjacentVertices(c+1,h);d=a.relatedGraphic.geometry.getPoint(a.segIndex,e[0]);f=a.relatedGraphic.geometry.getPoint(a.segIndex,e[1]);e=new t({x:(d.x+f.x)/2,y:(d.y+f.y)/2,spatialReference:d.spatialReference.toJson()});
d=a.relatedGraphic.geometry.getPoint(a.segIndex,b[0]);f=a.relatedGraphic.geometry.getPoint(a.segIndex,b[1]);b=new t({x:(d.x+f.x)/2,y:(d.y+f.y)/2,spatialReference:d.spatialReference.toJson()});d=new l(e,this._symbol2,this.graphic,a.segIndex,c,h,this,!0);a=new l(b,this._symbol2,this.graphic,a.segIndex,c+1,h,this,!0);p.splice(c,0,d,a)},_deleteVertex:function(a){var b,c=a.ptIndex,d=this._vertexMovers[a.segIndex];for(b=0;b<c;b++)--d[b].segLength;for(b=c+1;b<d.length;b++){var e=d[b];--e.ptIndex;--e.segLength}d.splice(c,
1);b=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,b)}});b.mixin(x,{create:function(a,b,c){switch(a.geometry.type){case "multipoint":return new x.MultipointVertexEditor(a,b,c);case "polyline":return new x.PolylineVertexEditor(a,b,c);case "polygon":return new x.PolygonVertexEditor(a,b,c)}}});x.MultipointVertexEditor=c(x,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=a.connect(l,"onMoveStart",this,this._moveStartHandler);
a.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);a.disconnect(this._moveStartHandle)},_getSegments:function(a){var b=a.points,c=[],d=a.spatialReference;for(a=0;a<b.length;a++){var e=b[a];c.push(new t({x:e[0],y:e[1],spatialReference:d.toJson()}))}return[c]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,b,c,d,f){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var b=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(b,
a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var b=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(b,a._getInfo())},_findMover:function(a){var b=[].concat(this._vertexMovers[0]),c=a.target;for(a=0;a<b.length;a++){var d=b[a];if(d.graphic.getDojoShape().getNode()===c)return d}},_moveStartHandler:function(a){var b=a.ptIndex,c=a.segLength-1,d=a.relatedGraphic.geometry.points;a=d.splice(b,1);d.push(a[0]);
d=this._vertexMovers[0];for(a=c;a>b;a--)--d[a].ptIndex;a=d.splice(b,1);d.push(a[0]);a[0].ptIndex=c},_moveStopHandler:function(a){this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,b,c,d,f,k,h,l){a=b.geometry;l?a.removePoint(f):a.setPoint(f,c);b.setGeometry(a)},_deleteMidpoints:function(a){}});x.PolylineVertexEditor=c(x,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(a){var b,c,d=a.paths,e=[];for(b=0;b<d.length;b++){var f=d[b],h=[];for(c=0;c<f.length;c++)h.push(a.getPoint(b,c));e.push(h)}return e},_getMidpointSegments:function(a){var b,c,d=a.paths,e=[],f=a.spatialReference;for(b=0;b<d.length;b++){var h=d[b],l=[];for(c=0;c<h.length-1;c++){var p=a.getPoint(b,c),n=a.getPoint(b,c+1),p=new t({x:(p.x+n.x)/2,y:(p.y+n.y)/2,spatialReference:f.toJson()});l.push(p)}e.push(l)}return e},_getControlPoints:function(a,b,c,d,f){var e=this.map,g,h;this._isNew(a)?
(a=d,d+=1,0<=a&&(g=e.toScreen(b.getPoint(c,a))),d<=f&&(h=e.toScreen(b.getPoint(c,d)))):(a=d-1,d+=1,0<=a&&(g=e.toScreen(b.getPoint(c,a))),d<f&&(h=e.toScreen(b.getPoint(c,d))));return[g,h]},_getAdjacentMidpoints:function(a,b){var c=[],d=a-1;0<=d&&c.push(d);a<b-1&&c.push(a);return c},_getAdjacentVertices:function(a,b){return[a,a+1]},_deleteMidpoints:function(a){var b=this._mpVertexMovers[a.segIndex],c=b.length-1,d=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),e,f=d[0];for(e=0;e<f;e++)--b[e].segLength;
for(e=f+1;e<b.length;e++){var h=b[e];--h.ptIndex;--h.segLength}if(1===d.length)b.splice(f,1)[0].destroy();else for(h=this._getAdjacentVertices(f,c),e=a.relatedGraphic.geometry.getPoint(a.segIndex,h[0]),h=a.relatedGraphic.geometry.getPoint(a.segIndex,h[1]),e=new t({x:(e.x+h.x)/2,y:(e.y+h.y)/2,spatialReference:e.spatialReference.toJson()}),a=new l(e,this._symbol2,this.graphic,a.segIndex,f,c,this,!0),b=b.splice(f,d.length,a),e=0;e<b.length;e++)b[e].destroy()},_updateRelatedGraphic:function(a,b,c,d,f,
k,h,l){a=b.geometry;h?a.insertPoint(d,f+1,p.fromJson(c.toJson())):l?a.removePoint(d,f):a.setPoint(d,f,p.fromJson(c.toJson()));b.setGeometry(a)}});x.PolygonVertexEditor=c(x,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(a){var b,c,d=a.rings,e=[];for(b=0;b<d.length;b++){var f=d[b],h=[];for(c=0;c<f.length-1;c++)h.push(a.getPoint(b,c));e.push(h)}return e},_getMidpointSegments:function(a){var b,c,d=a.rings,e=[],f=a.spatialReference;for(b=0;b<d.length;b++){var h=d[b],
l=[];for(c=0;c<h.length-1;c++){var p=a.getPoint(b,c),n=a.getPoint(b,c+1),p=new t({x:(p.x+n.x)/2,y:(p.y+n.y)/2,spatialReference:f.toJson()});l.push(p)}e.push(l)}return e},_getControlPoints:function(a,b,c,d,f){var e=this.map;this._isNew(a)?a=d:(a=d-1,a=0>a?(f+a)%f:a);d=(d+1)%f;f=e.toScreen(b.getPoint(c,a));b=e.toScreen(b.getPoint(c,d));return[f,b]},_getAdjacentMidpoints:function(a,b){var c=a-1;return[0>c?(b+c)%b:c,a]},_getAdjacentVertices:function(a,b){return[a,(a+1)%b]},_deleteMidpoints:function(a){var b=
a.ptIndex,c=this._mpVertexMovers[a.segIndex],d=c.length-1,e=this._getAdjacentMidpoints(b,a.segLength).sort(),f,h;h=e[0];var p=e[e.length-1];if(0===b)for(f=this._getAdjacentVertices(d-1,d),b=a.relatedGraphic.geometry.getPoint(a.segIndex,f[0]),f=a.relatedGraphic.geometry.getPoint(a.segIndex,f[1]),b=new t({x:(b.x+f.x)/2,y:(b.y+f.y)/2,spatialReference:b.spatialReference.toJson()}),a=new l(b,this._symbol2,this.graphic,a.segIndex,d-1,d,this,!0),c.splice(p,1,a)[0].destroy(),c.splice(h,1)[0].destroy(),e=
0;e<c.length-1;e++)h=c[e],--h.ptIndex,--h.segLength;else{f=this._getAdjacentVertices(h,d);b=a.relatedGraphic.geometry.getPoint(a.segIndex,f[0]);f=a.relatedGraphic.geometry.getPoint(a.segIndex,f[1]);b=new t({x:(b.x+f.x)/2,y:(b.y+f.y)/2,spatialReference:b.spatialReference.toJson()});a=new l(b,this._symbol2,this.graphic,a.segIndex,h,d,this,!0);p=c.splice(h,e.length,a);for(e=0;e<p.length;e++)p[e].destroy();for(e=0;e<h;e++)--c[e].segLength;for(e=h+1;e<c.length;e++)h=c[e],--h.ptIndex,--h.segLength}},_updateRelatedGraphic:function(a,
b,c,d,f,k,h,l){a=b.geometry;h?a.insertPoint(d,f+1,p.fromJson(c.toJson())):l?(a.removePoint(d,f),0===f&&a.setPoint(d,k-1,p.fromJson(a.getPoint(d,0).toJson()))):(a.setPoint(d,f,p.fromJson(c.toJson())),0===f&&a.setPoint(d,k,p.fromJson(c.toJson())));b.setGeometry(a)}});b.setObject("toolbars._GraphicVertexEditor",x,f);b.setObject("toolbars._MultipointVertexEditor",x.MultipointVertexEditor,f);b.setObject("toolbars._PolylineVertexEditor",x.PolylineVertexEditor,f);b.setObject("toolbars._PolygonVertexEditor",
x.PolygonVertexEditor,f);return x})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g){p("dijit-legacy-requires")&&g(0,function(){c(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return a("dijit.Menu",m,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):b.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return x.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||
a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=n.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var c=a;b=this._iframeContentWindow(c);b=w.body(b.document)}else b=a==w.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var d={node:a,iframe:c};u.set(a,"_dijitMenu"+this.id,this._bindings.push(d));var e=l.hitch(this,function(a){var b=this.selector,d=b?function(a){return t.selector(b,a)}:function(a){return a},e=this;
return[t(a,d(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<e._lastKeyDown+500||e._scheduleOpen(this,c,{x:a.pageX,y:a.pageY},a.target)}),t(a,d("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==f.F10||e.leftClickToOpen&&a.keyCode==f.SPACE)a.stopPropagation(),a.preventDefault(),e._scheduleOpen(this,c,null,a.target),e._lastKeyDown=(new Date).getTime()})]});d.connects=b?e(b):[];c&&(d.onloadHandler=l.hitch(this,function(){var a=
this._iframeContentWindow(c),a=w.body(a.document);d.connects=e(a)}),c.addEventListener?c.addEventListener("load",d.onloadHandler,!1):c.attachEvent("onload",d.onloadHandler))},unBindDomNode:function(a){var b;try{b=n.byId(a,this.ownerDocument)}catch(C){return}a="_dijitMenu"+this.id;if(b&&u.has(b,a)){for(var c=u.get(b,a)-1,d=this._bindings[c],e;e=d.connects.pop();)e.remove();(e=d.iframe)&&(e.removeEventListener?e.removeEventListener("load",d.onloadHandler,!1):e.detachEvent("onload",d.onloadHandler));
u.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,e){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:e,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){u.refocus&&x&&x.focus();e.close(u)}var c=a.target,d=a.iframe,f=a.coords,g=!f;this.currentTarget=a.delegatedTarget;if(f){if(d){a=v.position(d,!0);var c=this._iframeContentWindow(d),c=v.docScroll(c.document),m=h.getComputedStyle(d),l=h.toPixelValue,
t=(p("ie")&&p("quirks")?0:l(d,m.paddingLeft))+(p("ie")&&p("quirks")?l(d,m.borderLeftWidth):0),d=(p("ie")&&p("quirks")?0:l(d,m.paddingTop))+(p("ie")&&p("quirks")?l(d,m.borderTopWidth):0);f.x+=a.x+t-c.x;f.y+=a.y+d-c.y}}else f=v.position(c,!0),f.x+=10,f.y+=10;var u=this,d=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var x=!a||n.isDescendant(a,this.domNode)?d:a;e.open({popup:this,x:f.x,y:f.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();g||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);e.close(this)}},destroy:function(){b.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(c,b,a,n){return c("dijit.DropDownMenu",n,{templateString:a,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(a){this._moveToPopup(a);
a.stopPropagation();a.preventDefault()},_onLeftArrow:function(a){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(c,b,a,n,u,v,h,f,l,t,
p,w,x,e,m){return b("dijit._MenuBase",[w,m,e,x],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){u.toggle(this.domNode,"dijitMenuActive",a);u.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=
p.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:v.hitch(this,"childSelector");this.own(f(this.containerNode,f.selector(b,h.enter),function(){a.onItemHover(p.byNode(this))}),f(this.containerNode,f.selector(b,h.leave),function(){a.onItemUnhover(p.byNode(this))}),f(this.containerNode,f.selector(b,t),function(b){a.onItemClick(p.byNode(this),b);b.stopPropagation()}),f(this.containerNode,f.selector(b,
"focusin"),function(){a._onItemFocus(p.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,e){this.inherited(arguments);if(a&&(-1==e||a.popup&&1==e))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=f.once(c.domNode,"mouseover",v.hitch(this,"_onPopupHover")));var d=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&
d.focusChild(a);d._cleanUp()},onExecute:v.hitch(this,"_cleanUp",!0),onClose:function(){d._mouseoverHandle&&(d._mouseoverHandle.remove(),delete d._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(n.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w){c=c(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(a,b,c,f,d,h,k,l){this.point=a;this.symbol=b;this.relatedGraphic=c;this.segIndex=f;this.ptIndex=d;this.segLength=h;this.editor=k;this.map=k.map;this._scratchGL=k.toolbar._scratchGL;this._placeholder=l||!1;this._type=c.geometry.type;this._init();this._enable()},refresh:function(a){if(a||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);
this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var a=new t(this.point.toJson()),a=new p(a,this.symbol);switch(this._type){case "multipoint":a._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(a)}this.graphic=a},_enable:function(){var a=this.graphic.getDojoShape();a&&(a._hasMover=!0,this._moveable=this._getMoveable(a),
(a=a.getEventSource())&&u.set(a,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var b=this._moveable;if(b){a.disconnect(this._startHandle);a.disconnect(this._firstHandle);a.disconnect(this._movingHandle);a.disconnect(this._stopHandle);var c=b.shape;c&&(c=c.getEventSource())&&u.set(c,"cursor","inherit");b.destroy();this._moveable=null}},_needRefresh:function(){var a=this.graphic.getDojoShape(),b=!1;if(a)switch(this._type){case "multipoint":var c=this.relatedGraphic.getDojoShape();
c&&(c=c.children[this.ptIndex],a!==c&&(this.graphic._shape=c,b=!0));break;case "polyline":case "polygon":b=!a._hasMover}return b},_getMoveable:function(b){b=new v(b,n("mac")&&n("ff")&&!l("esri-touch")&&{leftButtonOnly:!0});this._startHandle=a.connect(b,"onMoveStart",this,this._moveStartHandler);this._firstHandle=a.connect(b,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=a.connect(b,"onMoving",this,this._movingHandler);this._stopHandle=a.connect(b,"onMoveStop",this,this._moveStopHandler);
return b},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(a){var b=this.map;b.snappingManager&&b.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();a.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(a){var b=
a.shape,c=this._getControlEdges(),f=this._scratchGL._div,d,h=[],k=a.host.shape._wrapOffsets[0]||0;for(d=0;d<c.length;d++){var l=c[d];l.x1+=k;l.x2+=k;h.push([f.createLine({x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2}).setStroke(this.editor._lineStroke),l.x1,l.y1,l.x2,l.y2])}b._lines=h;a.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(a,b,c){b=this.map;var e;l("esri-pointer")?e=b.navigationManager.pointerEvents._processTouchEvent(c,
c):c&&"pointermove"===c.type&&(e=f.prototype._processTouchEvent.call({map:b},c,c));e&&b.snappingManager&&b.snappingManager._onSnappingMouseMoveHandler(e);c=a.shape;a=c.getTransform();c=c._lines;for(e=0;e<c.length;e++)b=c[e],b[0].setShape({x1:b[1]+a.dx,y1:b[2]+a.dy,x2:b[3],y2:b[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),a)},_moveStopHandler:function(a){a=a.shape;var b=this.editor.toolbar,c=a.getTransform(),f=this.map,d=this.graphic,h=b._geo?w.geographicToWebMercator(d.geometry):
d.geometry;b._activateScrollWheel();var k,l=a._lines;if(l){for(k=0;k<l.length;k++)l[k][0].removeShape();a._lines=null}k=!1;var l=!0,p=this._getInfo();c&&(c.dx||c.dy)?this._placeholder&&(this._placeholder=!1,k=!0):l=!1;var t;f.snappingManager&&(t=f.snappingManager._snappingPoint);t=t||f.toMap(f.toScreen(h).offset(c.dx,c.dy));f.snappingManager&&f.snappingManager._killOffSnapping();a.setTransform(null);d.setGeometry(b._geo?w.webMercatorToGeographic(t,!0):t);this.constructor.onMoveStop(this,c);b.onVertexMoveStop(this.relatedGraphic,
p,c);if(!l)b.onVertexClick(this.relatedGraphic,p);if(k)b.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var a=this.map,b=this.relatedGraphic.geometry,c=this.segIndex,f=this.ptIndex,d=this.segLength,h=this._scratchGL._getTransform(),k=h.dx,h=h.dy,l=a.toScreen(this.graphic.geometry),a=l.x-k,l=l.y-h,p=[],b=this.editor._getControlPoints(this,b,c,f,d);b[0]&&p.push({x1:a,y1:l,x2:b[0].x-k,y2:b[0].y-h});b[1]&&p.push({x1:a,y1:l,x2:b[1].x-k,y2:b[1].y-h});return p}});b.setObject("toolbars.VertexMover",
c,h);b.mixin(c,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return c})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(c,b,a,n,u,v,h,f,l,t){c=c(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(a,b,c){this._graphic=a;this._map=b;this._toolbar=c;this._enable(this._graphic)},destroy:function(){this._disable()},
onEditStart:function(){},onEditEnd:function(){},_enable:function(b){this._editBox?(a.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=a.connect(b.getLayer(),"onDblClick",this,function(c){this._map.navigationManager.setImmediateClick(!1);c.graphic==b&&(n.stop(c),a.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(b))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&
(a.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(c,t){if(!this._editBox){var p;c.symbol.text||(c.symbol.text="Tempt text",c.setSymbol(c.symbol),p="");var e=this._createInputTextStyle(c,this._map);""!==p&&(p=t||c.symbol.text);this._editBox=v.create("input",{type:"text",value:p});f.set(this._editBox,e);h.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);
this._editBox.focus();this._editBoxKeyHandler=a.connect(this._editBox,"onkeyup",b.hitch(this,function(a){a.keyCode!=l.ENTER&&a.keyCode!==l.TAB||this._disable()}));this._editBoxBlurHandler=a.connect(this._editBox,"onblur",b.hitch(this,function(a){this._disable()}));c.symbol.text="";c.setSymbol(c.symbol);c.hide();var m=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",b.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){f.set(m,
{left:this._editBoxLeft+a.delta.x+"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(f.get(m,"left"));this._editBoxTop=parseFloat(f.get(m,"top"))});this.onEditStart(c,this._editBox);this._toolbar.onTextEditStart(c,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(a.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),
this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(a.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(a,b){b=a.getDojoShape().getTransformedBoundingBox();var c=a.symbol.font;return{"font-family":c.family,
"font-size":c.size+"px","font-style":c.style,"font-variant":c.variant,"font-weight":c.weight,left:b[0].x+"px",top:b[0].y+"px",width:Math.abs(b[0].x-b[1].x)/Math.cos(a.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var a=this._graphic.symbol;a.text=this._editBox.value;this._graphic.setSymbol(a)}else this._graphic.getLayer().remove(this._graphic)}});b.setObject("toolbars.TextEditor",c,t);return c})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(c,b,a,n,u){return c("dijit.form.FilteringSelect",[n,u],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(a,b,c,l){b&&b[this.searchAttr]!==this._lastQuery||!b&&a.length&&this.store.getIdentity(a[0])!=this._lastQuery||
(a.length?this.set("item",a[0],l):this.set("value","",l||void 0===l&&!this.focused,this.textbox.value,null))},_openResultList:function(a,b,c){b[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(c,h,f,l){this._onChangeActive||(h=null);if(void 0===l){if(null===c||""===c)if(c="",!b.isString(f)){this._setDisplayedValueAttr(f||"",h);
return}var t=this;this._lastQuery=c;a(this.store.get(c),function(a){t._callbackSetLabel(a?[a]:[],void 0,void 0,h)})}else this.valueNode.value=c,this.inherited(arguments,[c,h,f,l])},_setItemAttr:function(a,b,c){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(a){return a.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(c,h){null==c&&(c="");if(!this._created){if(!("displayedValue"in this.params))return;h=!1}if(this.store){this.closeDropDown();
var f=b.clone(this.query),l=this._getDisplayQueryString(c),t;this.store._oldAPI?t=l:(t=this._patternToRegExp(l),t.toString=function(){return l});this._lastQuery=f[this.searchAttr]=t;this._lastDisplayedValue=this.textbox.value=c;this._set("displayedValue",c);var p=this,n={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};b.mixin(n,this.fetchProperties);this._fetchHandle=this.store.query(f,n);a(this._fetchHandle,function(a){p._fetchHandle=null;p._callbackSetLabel(a||[],f,n,h)},function(a){p._fetchHandle=
null})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(c,b,a,n,u,v){b=b(v,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(a){a=a||{};a.featureLayer&&(this._featureLayer=a.featureLayer,a.addedGraphics&&(this._addedGraphics=a.addedGraphics))},updateObjectIds:function(a,
b){this.updateIds(this._featureLayer,this._addedGraphics,a,b)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(a.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var b=c.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(a.hitch(this,function(a,h,t){a=c.map(a,function(a){return a.objectId});
return{oldIds:b,addedIds:a,layer:this._featureLayer,operation:this}}))}});a.setObject("dijit.editing.Add",b,u);return b})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(c,b,a,n,u){b=b(u,{declaredClass:"esri.EditOperationBase",updateIds:function(a,b,f,l){c.forEach(b,function(b,h){var p=b[a.objectIdField];c.forEach(f,function(c,e){p===c&&(b[a.objectIdField]=l[e])})})}});return n.EditOperationBase=
b})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(c,b,a,n,u,v,h){c=b(h,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(b){var c;b=b||{};if(b.featureLayer&&(this._featureLayer=b.featureLayer,b.preUpdatedGraphics)){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<b.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(b.preUpdatedGraphics[c].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(b.preUpdatedGraphics[c].attributes);if(b.postUpdatedGraphics)for(this._postUpdatedGraphics=b.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<b.postUpdatedGraphics.length;c++)b.postUpdatedGraphics[c].geometry?this._postUpdatedGraphicsGeometries.push(b.postUpdatedGraphics[c].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(b.postUpdatedGraphics[c].geometry),this._postUpdatedGraphicsAttributes.push(a.clone(b.postUpdatedGraphics[c].attributes))}},
updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,b)},performUndo:function(){var b;for(b=0;b<this._postUpdatedGraphics.length;b++)this._preUpdatedGraphicsGeometries[b]?this._postUpdatedGraphics[b].setGeometry(v.fromJson(this._preUpdatedGraphicsGeometries[b])):this._postUpdatedGraphics[b].setGeometry(this._preUpdatedGraphicsGeometries[b]),this._postUpdatedGraphics[b].setAttributes(this._preUpdatedGraphicsAttributes[b]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(a.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var b;for(b=0;b<this._postUpdatedGraphics.length;b++)this._postUpdatedGraphicsGeometries[b]?this._postUpdatedGraphics[b].setGeometry(v.fromJson(this._postUpdatedGraphicsGeometries[b])):this._postUpdatedGraphics[b].setGeometry(this._postUpdatedGraphicsGeometries[b]),this._postUpdatedGraphics[b].setAttributes(this._postUpdatedGraphicsAttributes[b]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(a.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});a.setObject("dijit.editing.Update",c,u);return c})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(c,b,a,n,u,v){b=b(v,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(a){a=a||{};
a.featureLayer&&(this._featureLayer=a.featureLayer,a.deletedGraphics&&(this._deletedGraphics=a.deletedGraphics))},updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._deletedGraphics,a,b)},performUndo:function(){var b=c.map(this._deletedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(a.hitch(this,function(a,h,t){a=c.map(a,function(a){return a.objectId});return{oldIds:b,addedIds:a,
layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(a.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});a.setObject("dijit.editing.Delete",b,u);return b})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(c,b,a,n,u,v,h){b=b(h,{declaredClass:"esri.dijit.editing.Cut",
type:"edit",label:"Cut Features",constructor:function(b){var c;b=b||{};if(b.featureLayer&&(this._featureLayer=b.featureLayer,b.addedGraphics&&(this._addedGraphics=b.addedGraphics,b.preUpdatedGraphics))){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<b.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(b.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(b.preUpdatedGraphics[c].attributes);if(b.postUpdatedGraphics)for(this._postUpdatedGraphics=
b.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<b.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(b.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(a.clone(b.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,
this._addedGraphics,a,b)},performUndo:function(){var b;for(b=0;b<this._postUpdatedGraphics.length;b++)this._postUpdatedGraphics[b].setGeometry(v.fromJson(this._preUpdatedGraphicsGeometries[b])),this._postUpdatedGraphics[b].setAttributes(this._preUpdatedGraphicsAttributes[b]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(a.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var b;for(b=0;b<this._postUpdatedGraphics.length;b++)this._postUpdatedGraphics[b].setGeometry(v.fromJson(this._postUpdatedGraphicsGeometries[b])),
this._postUpdatedGraphics[b].setAttributes(this._postUpdatedGraphicsAttributes[b]);var h=c.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(a.hitch(this,function(a,b,f){a=c.map(a,function(a){return a.objectId});return{oldIds:h,addedIds:a,layer:this._featureLayer,operation:this}}))}});a.setObject("dijit.editing.Cut",b,u);return b})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(c,b,a,n,u,v,h){b=b(h,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(b){b=b||{};this._featureLayer=b.featureLayer;this._deletedGraphics=b.deletedGraphics;this._preUpdatedGraphics=b.preUpdatedGraphics;this._postUpdatedGraphics=b.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var c;for(c=0;c<b.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(b.preUpdatedGraphics[c].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(b.preUpdatedGraphics[c].attributes);for(c=0;c<b.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(b.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(a.clone(b.postUpdatedGraphics[c].attributes))},updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,
this._deletedGraphics,a,b)},performUndo:function(){var b;for(b=0;b<this._postUpdatedGraphics.length;b++)this._postUpdatedGraphics[b].setGeometry(v.fromJson(this._preUpdatedGraphicsGeometries[b])),this._postUpdatedGraphics[b].setAttributes(this._preUpdatedGraphicsAttributes[b]);var h=c.map(this._deletedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(a.hitch(this,function(a,
b,f){a=c.map(a,function(a){return a.objectId});return{oldIds:h,addedIds:a,layer:this._featureLayer,operation:this}}))},performRedo:function(){var b;for(b=0;b<this._postUpdatedGraphics.length;b++)this._postUpdatedGraphics[b].setGeometry(v.fromJson(this._postUpdatedGraphicsGeometries[b])),this._postUpdatedGraphics[b].setAttributes(this._postUpdatedGraphicsAttributes[b]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(a.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});a.setObject("dijit.editing.Union",b,u);return b})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d){c=c([f,v],{declaredClass:"esri.dijit.editing.toolbars.Drawing",
onShowAttributeInspector:function(){},_activateTool:function(a,b){this._settings.editor._activeTool=a;"EDITING"!==a&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==a&&this._settings.editor._hideAttributeInspector();"CLEAR"!==a&&this.inherited(arguments)},_initializeToolbar:function(){a.forEach(this._settings.layers,function(a){this._tbConnects.push(n.connect(a,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(a,b){this._tools.EDITING._activateTool(a,b.geometryType);
this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=h.getSelection(this._settings.layers);var a=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=a);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",0>=a);this._tools.ATTRIBUTES&&
this._tools.ATTRIBUTES.set("disabled",0>=a);this._tools.UNION&&this._tools.UNION.set("disabled",2>a)},_toolFinished:function(a){if("ATTRIBUTES"===a&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===a||"CUT"===a||"RESHAPING"===a||"EDITING"===a)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===a)this.onDelete();this._settings.editor._activeTool=null;this._updateUI()},_createTools:function(){this._tools.SELECT=
new m({settings:this._settings,onClick:b.hitch(this,"_activateTool","SELECT",!0),onFinished:b.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new l(b.mixin(g.selectClear,{settings:this._settings,onClick:b.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new l(b.mixin(e.attributes,{settings:this._settings,onClick:b.hitch(this,"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);
this._createSeparator();this._tools.EDITING=new x({settings:this._settings,onClick:b.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:b.hitch(this,"onApplyEdits"),onFinished:b.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new l(b.mixin(e.del,{settings:this._settings,onClick:b.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||
this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new t({settings:this._settings,onFinished:b.hitch(this,"_toolFinished","CUT"),onClick:b.hitch(this,"_activateTool","CUT",!0),onApplyEdits:b.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new p({settings:this._settings,onFinished:b.hitch(this,"_toolFinished","UNION"),onApplyEdits:b.hitch(this,"onApplyEdits")}),
this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new w({settings:this._settings,onClick:b.hitch(this,"_activateTool","RESHAPING",!0),onFinished:b.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:b.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new l(b.mixin(e.undo,{settings:this._settings,disabled:!0,onClick:b.hitch(this,function(){this._tools.UNDO.set("disabled",
!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new l(b.mixin(e.redo,{settings:this._settings,disabled:!0,onClick:b.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});b.setObject("dijit.editing.toolbars.Drawing",c,d);return c})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),
function(c,b,a,n,u,v,h,f,l){c=c([v],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(a,b){a&&a.settings&&(this._tools=[],this._tbConnects=[],this._initialize(a.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var b,c=this._tools;for(b in c)c.hasOwnProperty(b)&&l.isDefined(this._tools[b])&&this._tools[b].destroy();a.forEach(this._tbConnects,
n.disconnect);this.inherited(arguments)},activate:function(a){this._enabled=!0},deactivate:function(){var a;this._enabled=!1;this._geometryType=this._layer=null;var b=this._tools;for(a in b)b.hasOwnProperty(a)&&(this._tools[a].deactivate(),this._tools[a].setChecked(!1))},isEnabled:function(){return this._enabled},setActiveSymbol:function(a){this._activeSymbol=a},_getSymbol:function(){},_createTools:function(){},_initialize:function(a){this._settings=a;this._toolbar=a.drawToolbar;this._editToolbar=
a.editToolbar;this._initializeToolbar()},_activateTool:function(a,b){this._activeTool&&this._activeTool.deactivate();!0===b&&this._activeTool==this._tools[a]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[a],this._activeTool.setChecked(!0),this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new h)}});b.setObject("dijit.editing.toolbars.ToolbarBase",c,f);return c})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),
function(c,b,a,n,u,v){c=c([n,u],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){n.prototype.destroy.apply(this,arguments);u.prototype.destroy.apply(this,arguments)}});b.setObject("dijit.editing.tools.ButtonToolBase",c,v);return c})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],
function(c,b,a,n,u){c=c(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(a,c){a=a||{};b.mixin(this,a);this.label=this._label?u.widgets.editor.tools[this._label]:"";this._settings=a.settings;this._toolbar=a.settings.drawToolbar;this._editToolbar=a.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},
activate:function(a){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=a,this._toolbar&&this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(a){this._enabled=a;this._updateUI()},setChecked:function(a){this._checked=a},enable:function(a){this._updateUI()},
isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});b.setObject("dijit.editing.tools.ToolBase",c,n);return c})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e){c=c([x],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:p.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(n.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);a.forEach(this._cutConnects,n.disconnect);this._cutConnects=[];this._edits=[]},
_onDrawEnd:function(c){var e=this._cutLayers=a.filter(this._settings.layers,function(a){return"esriGeometryPolygon"===a.geometryType||"esriGeometryPolyline"===a.geometryType&&a.visible&&a._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(a.map(e,b.hitch(this,function(c){return n.connect(c,"onEditsComplete",b.hitch(this,function(c,d,e){if(this._settings.undoRedoManager){var f=this._settings.undoRedoManager;a.forEach(this._edits,b.hitch(this,function(a){f.add(new w({featureLayer:a.layer,
addedGraphics:a.adds,preUpdatedGraphics:a.preUpdates,postUpdatedGraphics:a.updates}))}),this)}this.onFinished()}))})));var d=new l;d.geometry=c;a.forEach(e,function(a,c){this._settings.editor._selectionHelper.selectFeatures([a],d,t.SELECTION_NEW,b.hitch(this,"_cutFeatures",a,d))},this)},_cutFeatures:function(a,c,d){if(d&&d.length){this._edits=[];var e=[];e.push(this._settings.geometryService.cut(h.getGeometries(d),c.geometry,b.hitch(this,"_cutHandler",a,d)));(new v(e)).addCallback(b.hitch(this,function(){this.onApplyEdits(this._edits)}))}},
_cutHandler:function(c,e,d){var g=[],h=[],m=a.map(e,function(a){return new f(b.clone(a.toJson()))}),l,p;a.forEach(d.cutIndexes,function(a,c){l!=a?(l=a,h.push(e[a].setGeometry(d.geometries[c]))):(p=new f(d.geometries[c],null,b.mixin({},e[a].attributes),null),p.attributes[e[0].getLayer().objectIdField]=null,g.push(p))},this);this._edits.push({layer:c,adds:g,updates:h,preUpdates:m})}});b.setObject("dijit.editing.tools.Cut",c,e);return c})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(c,b,a,n,u,v){c=c([n,u],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){n.prototype.destroy.apply(this,arguments);u.prototype.destroy.apply(this,arguments)},setChecked:function(a){n.prototype.setChecked.apply(this,arguments)}});b.setObject("dijit.editing.tools.ToggleToolBase",c,v);return c})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(c,b,a,n,u,v,h,f,l,t){c=c([l],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:h.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(c){this._settings.editor._activeTool="UNION";c=a.filter(this._settings.layers,function(a){return"esriGeometryPolygon"===a.geometryType&&a.visible&&a._isMapAtVisibleScale()});var h=[],l=0;a.forEach(c,function(c,m){var e=c.getSelectedFeatures();2<=
e.length&&(l++,this._settings.geometryService.union(u.getGeometries(e),b.hitch(this,function(d){var g=e.shift(),k=[],m=[];k.push(new v(g.toJson()));m.push(g.setGeometry(d));h.push({layer:c,updates:m,deletes:e,preUpdates:k});l--;if(0>=l)this.onApplyEdits(h,b.hitch(this,function(){if(this._settings.undoRedoManager){var c=this._settings.undoRedoManager;a.forEach(this._edits,b.hitch(this,function(a){c.add(new f({featureLayer:a.layer,deletedGraphics:a.deletes,preUpdatedGraphics:a.preUpdates,postUpdatedGraphics:a.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});b.setObject("dijit.editing.tools.Union",c,t);return c})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(c,b,a,n,u,v,h,f,l,t,p){c=c([t],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:l.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){n.disconnect(this._rConnect);this._rConnect=n.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);n.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(c){var l=this._settings.layers,e=new f;e.geometry=c;c=this._reshapeLayers=a.filter(l,
function(a){return"esriGeometryPolygon"===a.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(c,e,h.SELECTION_NEW,b.hitch(this,"_reshape",e))},_reshape:function(a,c){if(1===c.length){var e=[],f=[],g=[],d=c[0],h=d.getLayer();this._settings.geometryService.reshape(d.geometry,a.geometry,b.hitch(this,function(a){"polyline"===a.type&&a.paths&&0===a.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===a.type&&a.rings&&
0===a.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(g.push(new v(d.toJson())),f.push(d.setGeometry(a)),e.push({layer:h,updates:f,preUpdates:g}),this.onApplyEdits(e,b.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});b.setObject("dijit.editing.tools.Reshape",c,p);return c})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(c,b,a,n,u,v,h,f,l,t){c=c([f],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(a,b){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=u.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(a,b){var c;this.enable(b);for(c in this._tools)this._tools.hasOwnProperty(c)&&(this.dropDown.removeChild(this._tools[c]),
!0===this._tools[c]._enabled&&this.dropDown.addChild(this._tools[c]));if(this._geometryType!==b||!1===this._activeTool._enabled)this._activeTool=this._tools[a.toUpperCase()];this._geometryType=b;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(a){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var c=this._settings.layers,f=this._settings.editor,h=!1,e=!1,m=!1,g=this._toolTypes=[],d;a.forEach(c,function(c){d=c.geometryType;
h=h||"esriGeometryPoint"===d;e=e||"esriGeometryPolyline"===d;m=m||"esriGeometryPolygon"===d;g=g.concat(a.map(this._getTemplatesFromLayer(c),b.hitch(this,function(a){return f._toDrawTool(a.drawingTool,c)})))},this);c=this._settings.createOptions;h&&this._toolTypes.push("point");e&&(this._toolTypes=this._toolTypes.concat(c.polylineDrawTools));m&&(this._toolTypes=this._toolTypes.concat(c.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(g))},_toUnique:function(b){var c={};return a.filter(b,
function(a){return c[a]?!1:c[a]=!0})},_getTemplatesFromLayer:function(b){var c=b.templates||[];a.forEach(b.types,function(a){c=c.concat(a.templates)});return a.filter(c,t.isDefined)},_createTools:function(){a.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(a){var c=b.mixin(h[a],{settings:this._settings,onClick:b.hitch(this,"onItemClicked",h[a].id)});this._tools[a.toUpperCase()]=new v(c)}});b.setObject("dijit.editing.tools.Editing",c,l);return c})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(c,b,a,n,u){c=c([n],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(a){this._enabled=a===this._geomType;this.inherited(arguments)}});b.setObject("dijit.editing.tools.Edit",c,u);return c})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),function(c,b,a,n,u,v){c=c([n,u],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",
destroy:function(){n.prototype.destroy.apply(this,arguments);u.prototype.destroy.apply(this,arguments)}});b.setObject("dijit.editing.tools.MenuItemBase",c,v);return c})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(c,b,a,n){b={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",_drawType:a.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},
polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:a.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:a.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",
_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:a.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:a.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:a.POLYGON,
_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:a.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:a.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",
_drawType:a.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:a.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:a.LEFT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",
_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:a.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:a.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",_drawType:a.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},
triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:a.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",
_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};c.setObject("dijit.editing.tools.EditingTools",b,n);return b})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(c,b,a,n,u,v,h,f,l,t){c=c([h,f],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var a,b=this._tools;for(a in b)b.hasOwnProperty(a)&&t.isDefined(b[a])&&b[a].destroy();this.inherited(arguments)},_createTools:function(){var a,b=new v;this.dropDown=b;for(a in this._tools)this._tools.hasOwnProperty(a)&&b.addChild(this._tools[a]);
this._activeTool=b.getChildren()[0];this._updateUI()},activate:function(a){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(a){for(var b in this._tools)this._tools.hasOwnProperty(b)&&this._tools[b].enable(a);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(a){this._checked=a;this._updateUI()},_onDrawEnd:function(a){},
onLayerChange:function(a,b,c){this._activeTool=null;this._activeType=b;this._activeTemplate=c;this._activeLayer=a},onItemClicked:function(a,b){this._activeTool&&this._activeTool.deactivate();this._activeTool=u.byId(a);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(a){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
n.set(this.focusNode,{outline:"none"});n.set(this.titleNode,{padding:"0px",border:"none"});this._checked?n.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):n.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});b.setObject("dijit.editing.tools.DropDownToolBase",c,l);return c})},"dijit/form/ComboButton":function(){define("dojo/_base/declare dojo/keys ../focus ./DropDownButton dojo/text!./templates/ComboButton.html ../a11yclick".split(" "),
function(c,b,a,n,u){return c("dijit.form.ComboButton",n,{templateString:u,_setIdAttr:"",_setTabIndexAttr:["focusNode","titleNode"],_setTitleAttr:"titleNode",optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyDown:function(c){c.keyCode==b[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]&&(a.focus(this._popupStateNode),c.stopPropagation(),c.preventDefault())},_onArrowKeyDown:function(c){c.keyCode==
b[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]&&(a.focus(this.titleNode),c.stopPropagation(),c.preventDefault())},focus:function(b){this.disabled||a.focus("start"==b?this.titleNode:this._popupStateNode)}})})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x){c=c([w],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=n.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);n.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(a){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var c=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(c,a,this._selectMethod,b.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new h(h.STYLE_CIRCLE,10,new f(f.STYLE_SOLID,new u([0,0,0]),1),new u([255,0,0,.5]));this._polylineSelectionSymbol=new f(f.STYLE_SOLID,new u([0,200,255]),2);this._polygonSelectionSymbol=new l(l.STYLE_SOLID,new f(f.STYLE_SOLID,
new u([0,0,0]),1),new u([0,200,255,.5]))},_initializeLayers:function(){a.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(a){var b=null;switch(a.geometryType){case "esriGeometryPoint":b=this._pointSelectionSymbol;break;case "esriGeometryPolyline":b=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":b=this._polygonSelectionSymbol}a.setSelectionSymbol(a._selectionSymbol||b)},_createTools:function(){a.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(a){var c=b.mixin(p[a],{settings:this._settings,onClick:b.hitch(this,"onItemClicked",p[a].id)});this._tools[a.toUpperCase()]=new t(c)}});b.setObject("dijit.editing.tools.Selection",c,x);return c})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(c,b,a,n,u){b={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:n.EXTENT,_selectMethod:a.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:n.EXTENT,_selectMethod:a.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:n.EXTENT,_selectMethod:a.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};c.setObject("dijit.editing.tools.SelectionTools",b,u);return b})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w){c=c(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(a){this._settings=a||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var b in this._sConnects)this._sConnects.hasOwnProperty(b)&&a.disconnect(this._sConnects[b])},selectFeatures:function(a,c,f,g){f===t.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(a));var d=[];n.forEach(a,function(a){if(!0===a.visible&&!0===a._isMapAtVisibleScale()){var b=f;a._isSelOnly&&b===t.SELECTION_NEW&&(b=t.SELECTION_ADD);d.push(a.selectFeatures(c,b))}});(new v(d)).addCallback(b.hitch(this,function(c){var d=[];n.forEach(c,function(b,c){n.forEach(b[1],function(b){(b=a[c]._mode._getFeature(b.attributes[a[c].objectIdField])||null)&&d.push(b)},this)},this);this._mapServiceCount?((c=f===t.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(a))):
this._createLayerDefs(this._getLayerInfosFromFeatures(d)),this._updateLayerDefs(this._mapServiceInfos,!1,!(d&&d.length||c),b.hitch(this,g,d))):g(d)}))},selectFeaturesByGeometry:function(a,b,c,g){var d=b;-1!==b.declaredClass.indexOf("Extent")&&b.xmax===b.xmin&&b.ymax===b.ymin&&(d=new f(b.xmax,b.ymax,b.spatialReference));d=-1!==d.declaredClass.indexOf("Point")?this._extentFromPoint(d):d;b=new p;b.geometry=d;this.selectFeatures(a,b,c,g)},clearSelection:function(a){n.forEach(this._nonSelOnlyLayers,function(a){a.clearSelection&&
a.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var b=this._getLayerInfosFromSelection(this._settings.layers);n.some(b,function(a){return a.oids&&a.oids.length})&&(this._createLayerDefs(b),this._updateLayerDefs(this._mapServiceInfos,!0,a||!1))}},findMapService:function(a){var b=this._map,c=b.layerIds;a=a&&a._url&&a._url.path?a._url.path.toLowerCase():"";var f,d,h;for(d in c)if(c.hasOwnProperty(d)&&(f=b.getLayer(c[d]),h=f._url?f._url.path?f._url.path.toLowerCase().replace("mapserver",
"featureserver"):f._url.toLowerCase().replace("mapserver","featureserver"):"",a.substr(0,h.length)===h&&"esri.layers.ArcGISDynamicMapServiceLayer"===f.declaredClass))return f},getSelection:function(a){var b=[];n.forEach(a,function(a){a._isSelOnly&&b.push(this._createLayerInfo(a))},this);n.forEach(b,function(a){var b=this._createMapServiceInfo(this.findMapService(a.layer));b&&(b.layerInfos[a.layer.layerId]=a)},this)},_initMapServiceInfos:function(a){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];n.forEach(a,function(a){var b=this.findMapService(a);b?(this._mapServiceCount++,this._createMapServiceInfo(b),b&&b.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(a)},this)},_createMapServiceInfo:function(a){if(!a)return null;var c=this._mapServiceInfos,f=c[a.id];f||(f=c[a.id]={mapService:a,layerInfos:[],layerDefs:b.mixin([],a.layerDefinitions||[]),origLayerDefs:b.mixin([],a.layerDefinitions||[])});return f},_resetMapServiceInfo:function(a){n.forEach(a.layerInfos,this._resetLayerInfo);
a.layerDefs=b.mixin([],a.origLayerDefs||[])},_resetMapServiceInfos:function(){var a=this._mapServiceInfos,b;for(b in a)a.hasOwnProperty(b)&&this._resetMapServiceInfo(a[b])},_createLayerInfo:function(a,b){var c=a.objectIdField;b=b?[]:a.getSelectedFeatures();return{layer:a,selectedFeatures:b||[],oids:n.map(b,function(a){return a.attributes[c]})}},_resetLayerInfo:function(a){a&&(a.selectedFeatures=[],a.oids=[])},_updateLayerDefs:function(c,e,f,g){for(var d in c)if(c.hasOwnProperty(d)){var h=c[d],k=h.mapService,
l=h.layerDefs=e?b.mixin([],h.origLayerDefs||[]):h.layerDefs;l?(f?g&&g():this._sConnects[k.id]=a.connect(k,"onUpdateEnd",b.hitch(this,"_onMapServiceUpdate",h,e,g)),k.setLayerDefinitions(l,f||!1)):g&&g()}},_onMapServiceUpdate:function(b,c,f){a.disconnect(this._sConnects[b.mapService.id]);n.forEach(b.layerInfos,function(a){if(c)a&&a.layer.clearSelection();else{var b=new p;b.objectIds=a?a.oids:[];b.objectIds.length&&a.layer.selectFeatures(b,t.SELECTION_SUBTRACT)}},this);c&&this._resetMapServiceInfo(b);
f&&f()},_createLayerDefs:function(a){n.forEach(a,function(a){var b=a.layer,c=this._createMapServiceInfo(this.findMapService(a.layer));if(c){var c=c.layerDefs,d=b.layerId,e='("'+b.objectIdField+'" NOT IN (',f=a.oids;f&&f.length&&(n.forEach(a.oids,function(a,b){f=!0;b&&(e+=",");e+="'"+a+"'"}),e+="))",c[d]=c.length&&c[d]&&c[d].length?c[d]+(" AND"+e):e)}},this)},_getLayerInfosFromFeatures:function(a){var b=[];n.forEach(a,function(a){var c=a.getLayer();c&&c._isSelOnly&&(b[c.id]||(b[c.id]=this._createLayerInfo(c,
!0)),b[c.id].selectedFeatures.push(a),b[c.id].oids.push(a.attributes[c.objectIdField]))},this);a=[];for(var c in b)b.hasOwnProperty(c)&&a.push(b[c]);return a},_getLayerInfosFromSelection:function(a){var b=[];n.forEach(a,function(a){a._isSelOnly&&b.push(this._createLayerInfo(a,!1))},this);return b},_extentFromPoint:function(a){var b=this._tolerance,c=this._map,f=c.toScreen(a);a=new l(f.x-b,f.y+b);b=new l(f.x+b,f.y-b);a=c.toMap(a);b=c.toMap(b);return new h(a.x,a.y,b.x,b.y,c.spatialReference)}});b.setObject("dijit.editing.SelectionHelper",
c,w);return c})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F,T,B,M,U,N,Q,O,K,I,H,L,fa,X,oa,va,aa,ca,la,ea,ia,Z,na,wa,ta,ha,ja,qa,da,Y,R,V,q,ba,ga,r,W,S,A,ka,pa,sa,ra){var ma=I.getProtocolForWebResource();b=b("esri.dijit.Directions",[R,f],{templateString:T,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],
"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(b,d){if(!b.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!d)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');this._i18n=F;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",
stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",
stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",
stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",
stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",
routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",
esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",
clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",
alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:ma+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:ma+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",geometryTaskUrl:ma+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new X(F.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new X(F.widgets.directions.maneuver,
F.widgets.directions.waypoint),segmentInfoTemplate:new X(F.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),textSymbolFont:new Y("11px",Y.STYLE_NORMAL,Y.VARIANT_NORMAL,Y.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new v([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new ha({url:c.toUrl("./images/Directions/greenPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new ha({url:c.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new ha({url:c.toUrl("./images/Directions/bluePoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new ha({url:c.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new ha({url:c.toUrl("./images/Directions/redPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new ha({url:c.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new ha({url:c.toUrl("./images/Directions/grayPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new ha({url:c.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new ta({color:[255,
255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new ta({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new ja).setColor(new v([20,89,127,.75])).setWidth(10).setCap(ja.CAP_ROUND).setJoin(ja.JOIN_ROUND),segmentSymbol:(new ja).setColor(new v([255,255,255,1])).setWidth(6).setCap(ja.CAP_ROUND).setJoin(ja.JOIN_ROUND),
barrierRenderer:new da({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new da({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new da({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=b;this.defaults=a.mixin({},this.options,b,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(b=2;b<this.defaults.minStops;b++)this.defaults.stops.splice(0,0,"");this.domNode=d},postCreate:function(){this.inherited(arguments);this.own(d(this._activateButtonNode,h,a.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(d(this._lineBarrierButtonNode,h,a.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(d(this._addDestinationNode,
h,a.hitch(this,this._addStopButton)));this.own(d(this._optionsButtonNode,h,a.hitch(this,this._toggleOptionsMenu)));this.own(d(this._saveMenuButton,h,a.hitch(this,this._toggleSaveMenu)));this.own(d(this._saveButton,h,a.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(d(this._saveAsButton,h,a.hitch(this,function(){a.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(d(this._findOptimalOrderNode,h,a.hitch(this,this._toggleCheckbox)));
this.own(d(this._returnToStartNode,h,a.hitch(this,this._toggleCheckbox)));this.own(d(this._useTrafficNode,h,a.hitch(this,this._toggleCheckbox)));this.own(d(this._useMilesNode,h,a.hitch(this,this._toggleUnits)));this.own(d(this._useKilometersNode,h,a.hitch(this,this._toggleUnits)));this.own(d(this._getDirectionsButtonNode,h,a.hitch(this,this.getDirections)));this.own(d(this._clearDirectionsButtonNode,h,a.hitch(this,function(){this.clearDirections()})));var b=a.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(a.hitch(this,function(){E.set(this._startTimeMenu,"display","none")}),100)});this.own(d(this._startTimeButtonNode,h,a.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===E.get(this._startTimeMenu,"display")?E.set(this._startTimeMenu,"display","none"):(E.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(d(this._startTimeMenuLeaveNow,
"blur",b));this.own(d(this._startTimeMenuDepartAt,"blur",b));this.own(d(this._startTimeMenuNone,"blur",b));this.own(d(this._startTimeMenuLeaveNow,"mousedown",a.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(d(this._startTimeMenuDepartAt,"mousedown",a.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(d(this._startTimeMenuNone,"mousedown",a.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new ja).setColor(new v([0,255,0,0])).setWidth(20).setCap(ja.CAP_ROUND);this._stopLayer=new aa({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new aa({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new aa({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new aa({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new aa({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new aa({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var c=new H(null,this.waypointSymbol,{}),b=a.hitch(this,function(){this._moveInProgress||this._solveInProgress||!c._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(c),clearTimeout(c._solveTimeout),c._solveTimeout=null,c.attributes.isWaypoint=!0,c._isStopIcon&&this.stopGraphics[c._index]&&(this._stopLayer.add(this.stopGraphics[c._index]),this._stopLayer.add(this.textGraphics[c._index])));c._showTooltip()});this._handle=a.mixin(c,{_isHandle:!0,_tooltip:M.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:b},this.map.container),_showTooltip:a.hitch(this,function(a){c._tooltip.style.display=!a||a instanceof MouseEvent?
"none":"inline";a&&(a="string"===typeof a?a:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(a)+"\x3c/table\x3e",c._tooltip.innerHTML!==a&&(c._tooltip.innerHTML=a))}),_isShown:a.hitch(this,function(){return-1<u.indexOf(this._stopLayer.graphics,c)}),_remove:b});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();M.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(a.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(a.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(a,b){return this._enqueue(function(){return this._modifyStopSequence(a,
b)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(a,b,c){return this._enqueue(function(){this.clearMessages();return this._removeStop(a,b,c)})},updateStops:function(a){return this._enqueue(function(){return this._updateStops(a)})},addStops:function(b,c){return this._enqueue(function(){return this._addStops(b,c)}).then(a.hitch(this,this.zoomToFullRoute))},addStop:function(a,
b){return this._enqueue(function(){return this._addStop(a,b)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(a,b,c){return this._enqueue(function(){return this._updateStop(a,b,c)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(b){this.routeParams.barriers=b;return this._getDirections().then(a.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(b){this.routeParams.polylineBarriers=b;return this._getDirections().then(a.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(b){this.routeParams.polygonBarriers=b;return this._getDirections().then(a.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(b){return this._enqueue(function(){return this._getDirections().then(a.hitch(this,function(){!0!==b&&this.zoomToFullRoute()}))})},selectSegment:function(a){if(!(!this.directions||!this.directions.features||
0>a||a>=this.directions.features.length))for(var b=z("[data-segment]",this._resultsNode),c=0;c<b.length;c++){var d=parseInt(D.get(b[c],"data-segment"),10);if(a===d&&b[c]!==this._focusedDirectionsItem){this._focusedDirectionsItem=b[c];this.centerAtSegmentStart(a);this.onSegmentSelect(this.directions.features[a]);b[c].focus();break}}},unhighlightSegment:function(a){var b=this._segmentGraphics;if(b&&(!this._focusedDirectionsItem||a)){for(a=0;a<b.length;a++)this._routeLayer.remove(b[a]);this._segmentGraphics=
[]}},highlightSegment:function(b,c){if(!(this._focusedDirectionsItem&&!c||b>=this.directions.features.length)){b=b||0;var d=a.hitch(this,function(a){var b=this.map.toMap({x:0,y:0});return this.map.toScreen(b.offset(a,0)).x}),e=a.hitch(this,function(a){for(var b=0,c=0;c<a.length;c++)for(var e=1;e<a[c].length;e++)var f=a[c][e-1],g=a[c][e],b=b+d(Math.sqrt((f[0]-g[0])*(f[0]-g[0])+(f[1]-g[1])*(f[1]-g[1])));return b}),f=a.hitch(this,function(a){var b=this.map.toMap({x:0,y:0});return this.map.toMap({x:a,
y:0}).x-b.x}),g=function(a,b,c){b=Math.max(1,b);for(var e=c?a[0].length-1:0,f=0,g,h,k,P=[[a[0][c?e:0]]];c&&0<e||!c&&e<a[0].length-1;){h=a[0][c?e-1:e];k=a[0][c?e:e+1];if(g=d(Math.sqrt((h[0]-k[0])*(h[0]-k[0])+(h[1]-k[1])*(h[1]-k[1]))))if(f+g<b)c?P[0].splice(0,0,h):P[0].push(k),f+=g;else{b=(b-f)/g;c?P[0].splice(0,0,[k[0]-(k[0]-h[0])*b,k[1]-(k[1]-h[1])*b]):P[0].push([h[0]+(k[0]-h[0])*b,h[1]+(k[1]-h[1])*b]);break}e+=c?-1:1}return 0<f+g?P:a};c=this.get("directions").features[b];var h=new na(c.geometry),
k=40*Math.PI/180;a.mixin(c.attributes,{_index:b});if(b){var P=g(this.get("directions").features[b-1].geometry.paths,25,!0),l="esriDMTStop"!==c.attributes.maneuverType?g(h.paths,25,!1):P,P=l!==P?[P[0].concat(l[0])]:l,m=(new na(l)).getExtent();if(1<l[0].length&&15<=d(Math.max(m.getWidth(),m.getHeight()))){for(var g=15*Math.cos(k/2),e=15*Math.sin(k/2),p=l[0].length-2,n,k=l[0][p+1],m=0;0<=p&&!m;)n=l[0][p],m=d(Math.sqrt((n[0]-k[0])*(n[0]-k[0])+(n[1]-k[1])*(n[1]-k[1]))),p--;22>m&&(l=m+(22-m)/3,p=m+2*(22-
m)/3,p=[n[0]+p/m*(k[0]-n[0]),n[1]+p/m*(k[1]-n[1])],n=[k[0]-l/m*(k[0]-n[0]),k[1]-l/m*(k[1]-n[1])],k=p,m=22);g/=m;l=[k[0]-(k[0]-n[0])*g,k[1]-(k[1]-n[1])*g];n[1]!==k[1]?(g=(k[0]-n[0])/(k[1]-n[1]),n=f(e/Math.sqrt(1+g*g)),f=g*n):(n=0,f=f(e));Infinity===Math.abs(n)||Infinity===Math.abs(f)||isNaN(n)||isNaN(f)||(P[0].push(k),P[0].push([l[0]-n,l[1]+f]),P[0].push([l[0]+n,l[1]-f]),P[0].push(k))}else P=g(P,2*e(l),!0);h.paths=P}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);f=a.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new v([parseInt(.9*
this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new H(c.geometry,f,c.attributes,this.get("segmentInfoTemplate")),new H(h,this.routeSymbol,c.attributes,this.get("segmentInfoTemplate")),new H(h,this.segmentSymbol,c.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));
c=a.hitch(this,function(a){if(0<a&&a<this.directions.features.length){a=this.directions.features[a]._associatedFeaturesWithWaypoints;for(var b=0;b<a.length;b++)a[b]._associatedSnapFeature&&a[b]._associatedSnapFeature.getDojoShape()&&a[b]._associatedSnapFeature.getDojoShape().moveToFront()}});c(b-1);c(b);this.onSegmentHighlight(this.directions.features[b])}},zoomToSegment:function(b){var c,d=new N;this.directions&&this.directions.features?(c=Math.max(0,Math.min(this.directions.features.length-1,b||
0)),this.map.setExtent(this.get("directions").features[c].geometry.getExtent(),!0).promise.always(a.hitch(this,function(){this.highlightSegment(c);d.resolve()}))):d.reject(Error("No directions."));return d.promise},centerAtSegmentStart:function(b){var c,d=new N;if(this.directions&&this.directions.features){c=Math.max(0,Math.min(this.directions.features.length-1,b||0));var e=this.directions.features[c];this.map.centerAt(e.geometry.getPoint(0,0)).promise.always(a.hitch(this,function(){this.highlightSegment(c,
!0);this._showSegmentPopup(e,c);d.resolve()}))}else d.reject(Error("No directions."));return d.promise},zoomToFullRoute:function(){var a=new N;this.directions&&this.directions.features?(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(a.resolve)):a.resolve();return a.promise},setListIcons:function(){var a,b=this._dnd.getAllNodes();for(a=0;a<b.length;a++){var c=z("."+this._css.stopIconClass,b[a])[0];c&&(c.innerHTML=this._getLetter(a));
C.remove(b[a],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);c=this._getStopSymbol(this.stops[a]);c===this.fromSymbol?C.add(b[a],this._css.stopOriginClass):c===this.toSymbol?C.add(b[a],this._css.stopDestinationClass):c===this.unreachedSymbol&&C.add(b[a],this._css.stopUnreachedClass)}a=z("[data-reverse-td]",this._dndNode)[0];M.destroy(a);this.get("showReverseStopsButton")&&M.create("td",{"data-reverse-td":"true",
rowspan:b.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+F.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(a){a.stopPropagation()},onmouseout:function(a){a.stopPropagation()}},b[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var a=0;a<this.stopGraphics.length;a++)if(this.stopGraphics[a]&&(!this._handle._isShown()||
this._handle._isShown()&&this._handle._index!==a)){this._stopLayer.add(this.stopGraphics[a]);var b=this.stopGraphics[a].getDojoShape();b&&b.moveToFront();this._stopLayer.add(this.textGraphics[a]);(b=this.textGraphics[a].getDojoShape())&&b.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var b=this.stops,c=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&
0===c.indexOf("Attr_")&&(b[c]=a[c]);return b},d=0;d<b.length;d++){var e=b[d];if(e&&e.feature){var f=e.feature.attributes,g=f?f.Status:void 0,h=null;this._isStopAWaypoint(e)||(h=new qa(this._getLetter(d),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&h.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));h=new H(e.feature.geometry,h,{address:e.name},this.get("stopsInfoTemplate"));h._isStopLabel=!0;h._index=d;e=new H(e.feature.geometry,this._getStopSymbol(e),
a.mixin({address:e.name,Status:void 0===g?0:g,CurbApproach:f&&f.CurbApproach?f.CurbApproach:null,TimeWindowStart:f&&f.TimeWindowStart?f.TimeWindowStart:null,TimeWindowEnd:f&&f.TimeWindowEnd?f.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(e)},c(f)),this.get(this._isStopAWaypoint(e)?"waypointInfoTemplate":"stopsInfoTemplate"));e._isStopIcon=!0;e._index=d;this.stopGraphics[d]=e;this.textGraphics[d]=h}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();
this.addRouteSymbols();this.setListIcons()},setTravelMode:function(a){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(a);return this._setTravelMode(a)})},getSupportedTravelModeNames:function(){var a=[],b=this.serviceDescription;if(b&&b.supportedTravelModes&&b.supportedTravelModes.length)for(var b=b.supportedTravelModes,c=0;c<b.length;c++)a.push(b[c].name);return a},setDirectionsLengthUnits:function(){var a=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");
return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(a)})},setDirectionsLanguage:function(){var a=1===arguments.length?arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(a)})},useMyCurrentLocation:function(a){this.clearMessages();return this._createLocateButton(this.geocoders[a],!0,!0)},loadRoute:function(b){return this._enqueue(a.hitch(this,function(){return this._loadRoute(b)}))},
_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var b=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(a.hitch(this,function(){this.mapClickActive=!b;this.set("mapClickActive",b);this._searchSourceSelector&&
this._searchSourceSelector.setValue("all")}))},_activate:function(){var b=this.get("mapClickActive"),c=a.hitch(this,function(a){for(var b=a?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.length;e++){var f=d[e].getDojoShape();f&&f[a?"moveToBack":"moveToFront"].call(f)}});this.drawToolbar&&(this.barrierToolActive=
!1,this.drawToolbar.deactivate(),C.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();b?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=d(this.map,"click",a.hitch(this,function(a){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new H(a.mapPoint)))})),
this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),C.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),C.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());c(!b);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&
this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(pa.FREEHAND_POLYLINE),C.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):(this.drawToolbar.deactivate(),C.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var a=this.get("map"),b=a.graphicsLayerIds.length-
1;a.reorderLayer(this._routeLayer,b);a.reorderLayer(this._polygonBarriersLayer,b);a.reorderLayer(this._polylineBarriersLayer,b);a.reorderLayer(this._barriersLayer,b);a.reorderLayer(this._waypointsEventLayer,b);a.reorderLayer(this._stopLayer,b)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(P){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var a=this._clearDirections(!0),b;if(this._watchEvents&&
this._watchEvents.length)for(b=0;b<this._watchEvents.length;b++)this._watchEvents[b].unwatch();if(this._onEvents&&this._onEvents.length)for(b=0;b<this._onEvents.length;b++)this._onEvents[b].remove();if(this._geocoderEvents)for(b=0;b<this._geocoderEvents.length;b++)this._geocoderEvents[b].value.unwatch(),this._geocoderEvents[b].blur.remove(),this._geocoderEvents[b].select.remove(),this._geocoderEvents[b].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();
this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return a},_getDirections:function(){var b=new N;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(a.hitch(this,function(c){this.stops=c;this._setStops();this._configureRoute().always(a.hitch(this,function(a){b.resolve(a)}))}),a.hitch(this,function(a){this.set("directions",
null);this._clearRouteGraphics();b.reject(a);this.onDirectionsFinish(a)}))):this._clearDirections(!0).always(a.hitch(this,function(){this.createRouteSymbols();b.resolve()}));return b.promise},_clearDirections:function(){var a=new N;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),a.resolve()):arguments.length?a.resolve():this._reset().then(a.resolve,
a.reject):a.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();return a.promise},_setTravelMode:function(a){var b=new N,c=this.serviceDescription,d=function(){b.resolve(a)};if(c&&c.supportedTravelModes&&c.supportedTravelModes.length){for(var e=c.supportedTravelModes,f=!1,c=0;c<e.length;c++)if(e[c].name===a){f=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&
this.routeParams.travelMode.name!==a?(this.routeParams.travelMode=e[c].impedanceAttributeName?e[c]:e[c].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(d)):d();this._travelModeSelector&&this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=e[c].description);break}f||b.reject(a)}else b.reject(a);return b.promise},_setDirectionsLengthUnits:function(a){this._clearDisplayBeforeSolve();var b=new N;C.remove(this._useMilesNode,this._css.stopsPressedButtonClass);
C.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);a===L.KILOMETERS?C.add(this._useKilometersNode,this._css.stopsPressedButtonClass):a===L.MILES&&C.add(this._useMilesNode,this._css.stopsPressedButtonClass);a===L.KILOMETERS||a===L.METERS||a===L.MILES||a===L.FEET||a===L.YARDS||a===L.NAUTICAL_MILES?(this.directionsLengthUnits=a,b.resolve(a)):b.reject(a);return b.promise},_setDirectionsLanguage:function(a){this._clearDisplayBeforeSolve();var b=new N;a=this._setDirectionsLanguageByLocale(a);
this._solveAndZoom().always(function(){b.resolve(a)},b.reject);return b.promise},_showLoadingSpinner:function(a){void 0===a&&(a=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);a?(C.add(this._widgetContainer,this._css.resultsLoadingClass),C.add(this._resultsNode,"esriRoutesContainerBusy")):(C.remove(this._widgetContainer,this._css.resultsLoadingClass),C.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(b,c){var d=new N;this._requestQueueTail||
(this._requestQueueTail=new N,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(a.hitch(this,function(){try{a.mixin(this,{_incrementalSolveStopRange:null},c);var e=b.call(this);e&&"object"===typeof e&&e.hasOwnProperty("isFulfilled")?e.then(a.hitch(this,function(a){d.resolve(a);this._showLoadingSpinner()}),a.hitch(this,function(a){d.reject(a);this._showLoadingSpinner()})):(d.resolve(e),this._showLoadingSpinner())}catch(ua){d.reject(ua),this._showLoadingSpinner()}}));this._requestQueueTail=
d;this._showLoadingSpinner();return d.promise},_createDnD:function(){this._dnd=new Q(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){M.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=F.widgets.directions.trafficLabelLive,C.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var b=
this,c=function(){this._keepDirections||b._clearDisplayBeforeSolve();this._keepDirections=!1},d=a.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),e=a.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()});this._departAtTime=new w({required:!0,value:new Date,onChange:c,onFocus:d,onBlur:e},this._departAtTimeContainer);this._departAtDate=new p({required:!0,value:new Date,onChange:c,onFocus:d,onBlur:e,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},
_setStartTime:function(a,b,c){if(isNaN(c))this.startTime="now"===c?c:"none";else{b=c instanceof Date?c:new Date(c);c=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;var d=6E4*-b.getTimezoneOffset();b=new Date(b-d+(c&&c.arriveTimeUTC?c.ETA-c.arriveTimeUTC:d));this._departAtTime._keepDirections=!a;this._departAtDate._keepDirections=!a;this._departAtTime.setValue(b);this._departAtDate.setValue(b)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var a=
this._getImpedanceAttribute(),a=this._isTimeUnits(a?a.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!a;C[a?"remove":"add"].apply(this,[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);C[a?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);a||this.set("startTime","now")},_usingAGOL:function(a){a||(a=this.routeTaskUrl);return-1<a.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<
this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var b={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=a.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,b)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var a="EN-US"===n.locale.toUpperCase()?L.MILES:L.KILOMETERS;this.defaults.directionsLengthUnits?a=this.defaults.directionsLengthUnits:
this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(a=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",a)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new va(ma+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&
(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(a,b){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);b||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=
this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(a,b){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);b||this.canModifyStops||!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,C.remove(this._startTimeButtonNodeContainer,
"departAtButton"),C.remove(this._departAtContainer,"departAtContainerVisible")):(C.add(this._startTimeButtonNodeContainer,"departAtButton"),C.add(this._departAtContainer,"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=a.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",
!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(b){var c=new N;b?this.get("loaded")?this._reset().then(a.hitch(this,function(){this._addStops(b).then(c.resolve,c.reject)}),c.reject):this._addStops(b).then(c.resolve,c.reject):c.reject();return c.promise},_removeStop:function(b,c,d,e){var f=new N,g=a.hitch(this,function(a){this.stops.splice(a,1);var b=this._dnd.getAllNodes()[a],c=this.get("geocoders");this._geocoderEvents[b.id]&&(this._geocoderEvents[b.id].blur.remove(),
this._geocoderEvents[b.id].select.remove(),this._geocoderEvents[b.id].suggest.remove(),this._geocoderEvents[b.id].value.unwatch());c[a].destroy();c.splice(a,1);this.set("geocoders",c);M.destroy(b);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>b||b>=this.stops.length||void 0===b)b=this.stops.length-1;var h=!1;for(e=this.stopGraphics[b]&&this._isStopAWaypoint(this.stops[b])||e;!h;)g(b),e?h=!0:(b-=0>=b||b<this.stops.length&&
this._isStopAWaypoint(this.stops[b])?0:1,h=!this._isStopAWaypoint(this.stops[b]));for(;this.stops.length-this._getWaypointCount()<this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();d?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),f.resolve()):this._solveAndZoom(c).then(f.resolve,f.reject);return f.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);
this._trafficLayerAdded=!1},_addStops:function(b,c){var d=new N,e=[],f=this.autoSolve;this.autoSolve=!1;void 0===c&&(c=this._getStopCount());for(var g=0;g<Math.min(b.length,this.maxStops-this._getStopCount());g++){var h=new N;this._addStop(b[g],c+g,!0).always(h.resolve);e.push(h)}U(e).always(a.hitch(this,function(){this.autoSolve=f;this._getDirections().always(function(){d.resolve(b)})}));return d.promise},_addStop:function(b,c,d){var e=new N;this._checkMaxStops();this.maxStopsReached?(this._showMessage(F.widgets.directions.error.maximumStops),
e.reject(Error(F.widgets.directions.error.maximumStops))):(void 0===b&&void 0===c&&(c=this.stops.length),b instanceof H&&b.attributes&&b.attributes.isWaypoint&&(!c||c===this.stops.length||2>this._getStopCount())&&!d?(this._showMessage(F.widgets.directions.error.waypointShouldBeInBetweenStops),e.reject(Error(F.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(b).then(a.hitch(this,function(b){this._isStopAWaypoint(b)&&b&&b.feature&&(b.feature.attributes=a.mixin({},b.feature.attributes,
{isWaypoint:!0,CurbApproach:3}));this._insertStop(b,c);this.autoSolve&&""!==b.name?this._getDirections().always(function(){e.resolve(b,c)}):e.resolve(b,c)}),a.hitch(this,function(a){e.reject(a)})));return e.promise},_removeEmptyStops:function(){for(var a=0,b=this.stops.length-this._getWaypointCount()-this.minStops;a<this.stops.length&&0<b;)this.stops[a]&&this.stops[a].name?a++:(this._removeStop(a,!0,!0,!0),b--,this._moveInProgress&&this._handle._index>=a&&this._handle._isStopIcon&&this._handle._index--)},
_setReverseGeocode:function(b,c,d){if(b.feature.geometry&&-1<d){var e={address:b.name};this.stopGraphics[d]&&(a.mixin(this.stopGraphics[d].attributes,e),this.stopGraphics[d].setGeometry(c));this.textGraphics[d]&&(a.mixin(this.textGraphics[d].attributes,e),this.textGraphics[d].setGeometry(c));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(e=this.geocoders[d])&&e.inputNode&&(e.value=b.name,e.inputNode.value=b.name);a.mixin(b.feature.attributes,this.stops[d].feature.attributes);
this.stops[d]=b;this.stops[d].feature.setGeometry(c);this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(a,b){var c,d;if(void 0===b)for(c=0;c<this.geocoders.length;c++){if(!this.geocoders[c].get("value")){d=this.geocoders[c];break}}else c=b,this.geocoders[c]&&!this.geocoders[c].get("value")&&(d=this.geocoders[c]);!d||void 0!==b&&b!==c||this._isStopAWaypoint(a)?(void 0===b&&(b=this.geocoders.length),this.stops.splice(b,0,a),this._createGeocoder(a,
b)):(this.stops[c]=a,d.set("value",a.name),d._stopReference=a);this._optionsMenu()},_createGeocoder:function(b,c){var d=this._dnd.getAllNodes(),e=!1,f=!1,g=d.length;d[c]?(f=d[c],e=!0):e=f=!1;var h=a.hitch(this,function(a,b){var c=b?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,d=b?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;C.replace(a.children[0],c,d);2<this.geocoders.length&&(c=b?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,d=b?this._css.stopIconRemoveClassHidden:
this._css.stopIconRemoveClass,C.replace(a.children[3].children[0],c,d))}),k=M.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(b)?"display:none;":"",onmouseover:function(){h(this,!0)},onmouseout:function(){h(this,!1)}});M.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},k);d=M.create("td",{className:this._css.stopIconColumnClass},k);M.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(g),"data-center-at":"true"},
d);g=M.create("td",{className:this._css.esriStopGeocoderColumnClass},k);g=M.create("div",{},g);d=M.create("td",{className:this._css.stopIconRemoveColumnClass},k);M.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},d);this._dnd.insertNodes(!1,[k],e,f);var e=a.mixin({},this.get("searchOptions"),{value:b.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex}),l=new B(e,g),m=a.hitch(this,function(a,b){this._enqueue(function(){if(b!==a&&l._stopReference&&
l._stopReference.name!==b){var c=u.indexOf(this.stops,l._stopReference);this.stops[c]={name:b};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(c));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});l._tr=k;l._stopReference=b;l.startup();this.geocoders.splice(c,0,l);this._geocoderEvents[k.id]={blur:l.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&
this.search()}),select:l.on("select-result",a.hitch(this,function(a){var b=!0;if(a&&(a.results||a.result)){var c=this._dnd.getAllNodes(),c=u.indexOf(c,k),d=l.value,e=a.results&&a.results.results&&a.results.results.length?a.results.results[0]:a.result;e?(e.name=d,this.stops[c]=this._toPointGeometry(e),this.geocoders[c]._stopReference=this.stops[c],m("",d)):(this.removeStop(c),this.set("directions",null),this._showMessage(F.widgets.directions.error.unknownStop.replace("\x3cname\x3e",a.target.get("value"))),
this._clearRouteGraphics(),b=!1);b&&this.getDirections()}})),suggest:l.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var a=z("LI[role\x3d'menuitem']",this.suggestionsNode),b=0;b<a.length;b++)D.set(a[b],"tabindex",-1);else this._hideSuggestionsMenu()}),value:l.watch("value",function(a,b,c){m(b,c)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var a=
0;a<this.geocoders.length;a++)if(this.geocoders[a].inputNode===document.activeElement){this.geocoders[a]._hideSuggestionsMenu();this.geocoders[a].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(a){a&&", , "===a.name&&(a.name=a.feature&&a.feature.attributes&&a.feature.attributes.Match_addr?a.feature.attributes.Match_addr+("POI"===a.feature.attributes.Addr_type&&a.feature.attributes.City&&-1===a.feature.attributes.Match_addr.indexOf(a.feature.attributes.City)?
", "+a.feature.attributes.City:""):"");return a},_toPointGeometry:function(a){var b=a.feature.geometry;b&&(b.getCentroid?a.feature.geometry=b.getCentroid():b.getExtent&&(b=b.getExtent())&&(a.feature.geometry=b.getCenter()));return a},_removeLocateButtonVisibilityEvents:function(){for(var a=0;a<this.geocoders.length;a++){var b=this.geocoders[a];b._onMouseEnter&&b._onMouseEnter.remove();b._onMouseOut&&b._onMouseOut.remove();b._onKeyPress&&b._onKeyPress.remove();b._locateButton&&(b._locateButton._onMouseEnter&&
b._locateButton._onMouseEnter.remove(),b._locateButton._onMouseOut&&b._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var b=this,c=function(a){a instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;b._createLocateButton(this._geocoder,!0)},e=function(c){c instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(a.hitch(this,
function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||b._destroyLocateButton(this._locateButton)}),400)},f=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(a.hitch(this,function(){""===this.value?b._createLocateButton(this._geocoder,!0):b._destroyLocateButton(this._locateButton)}),400)},g=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},h=function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);
this._geocoder._destroyTimeout=setTimeout(a.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||b._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},k=0;k<this.geocoders.length;k++){var l=this.geocoders[k];l&&l.inputNode&&(l.inputNode._geocoder=l,l._onMouseEnter=d(l.inputNode,y.enter,c),l._onMouseOut=d(l.inputNode,[y.leave,"blur"],e),l._onKeyPress=d(l.inputNode,"keydown",f),l.inputNode._locateButton&&(l=l.inputNode._locateButton,l._onMouseEnter=d(l.domNode,
y.enter,g),l._onMouseOut=d(l.domNode,y.leave,h)))}},_createLocateButton:function(b,e,f){var g=new N;b.inputNode._locateButton&&b.inputNode._locateButton._locating?g.resolve():c(["./LocateButton"],a.hitch(this,function(c){this._destroyLocateButton(b.inputNode._locateButton);if(b&&!this._solveInProgress){var k=M.create("div",{},b.domNode);C.add(b.domNode,this._css.stopsInnerGeocoderClass);var l=new c({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},k);l.startup();b.inputNode._locateButton=
l;l.domNode._geocoder=b;this._setLocateButtonVisibilityEvents();c=a.hitch(this,function(){l._locating=!0;b.set("value","");b.inputNode.placeholder=F.widgets.directions.retrievingMyLocation.toUpperCase()});l._onBeforeLocate=d(l._locateNode,h,c);l._onLocate=d(l,"locate",a.hitch(this,function(c){l._locating=!1;c.graphic?(e&&this._destroyLocateButton(b.inputNode._locateButton),this.updateStop(new H(c.graphic.geometry),u.indexOf(this.geocoders,b)).then(a.hitch(this,function(){1<this.stopGraphics.length?
this.getDirections().always(function(){g.resolve(c)}):g.resolve(c)}))):(b.set("value",""),b.inputNode.placeholder=F.widgets.directions.myLocationError.toUpperCase(),g.reject(c.error))}));f?(c(),l.locate().then(null,g.reject)):g.resolve()}else g.resolve()}));return g.promise},_destroyLocateButton:function(b){if(b){var c=b.domNode._geocoder;clearTimeout(c._destroyTimeout);b._locating?c._destroyTimeout=setTimeout(a.hitch(this,function(){c._lbShown_lb||c._lbShown_f||this._destroyLocateButton(b)}),100):
(b.clear(),b._onBeforeLocate.remove(),b._onLocate.remove(),b._onMouseEnter&&b._onMouseEnter.remove(),b._onMouseOut&&b._onMouseOut.remove(),b.destroy(),c.inputNode&&(c.inputNode._locateButton=null,c._setPlaceholder(c.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(a.hitch(this,function(a,b){for(var c,d,e=0;e<this.get("geocoders").length;e++)this.geocoders[e]._stopReference===a?c=e:this.geocoders[e]._stopReference===b&&(d=e);return c>d?1:d>c?-1:0})),this._setStops())},
_getCandidate:function(b){var c=new N,d=typeof b;b?"object"===d&&b.hasOwnProperty("feature")&&b.hasOwnProperty("name")?(b.feature.attributes&&void 0!==b.feature.attributes.displayName&&!this._isStopAWaypoint(b)&&(b.name=b.feature.attributes.displayName,b.feature.attributes.Name=this._userDefinedStopName),b.name=this._isStopAWaypoint(b)?this._waypointName:String(b.name),"point"!==b.feature.geometry.type&&(b.feature.geometry=new ia([b.feature.geometry.x,b.feature.geometry.y],this.map.spatialReference)),
c.resolve(b)):"object"===d&&b.hasOwnProperty("address")&&b.hasOwnProperty("location")?(b=this._globalGeocoder._hydrateResult(b),c.resolve(b)):"object"!==d||!b.hasOwnProperty("name")||null!==b.name&&""!==b.name?b instanceof H&&b.attributes&&(void 0!==b.attributes.Name||b.attributes.isWaypoint)?(d=this._addStopWrapperToGraphic(b,b.attributes.isWaypoint?this._waypointName:String(b.attributes.Name)),String(b.attributes.Name)&&(d.feature.attributes.Name=this._userDefinedStopName),c.resolve(d)):("object"===
d&&b.hasOwnProperty("name")&&(b=String(b.name)),this._reverseGeocode(b).then(c.resolve,c.reject)):c.resolve(a.clone(this._emptyStop)):c.resolve(a.clone(this._emptyStop));return c.promise},_reverseGeocode:function(b){var c=new N,d,e=b.geometry?b.geometry:b;if(this._globalGeocoder){var f=a.hitch(this,function(a){var b=new N,c=500;if(this.map){var d=this.map.toScreen(e);d.x+=ea._calculateClickTolerance([a]);this.map.spatialReference.isWebMercator()?(c=Math.abs(this.map.toMap(d).x-e.x),b.resolve(c)):
4326===this.map.spatialReference.wkid?(c=Math.abs(ca.geographicToWebMercator(this.map.toMap(d)).x-ca.geographicToWebMercator(e).x),b.resolve(c)):this._geometryService&&(a=new r,a.distanceUnit=ga.UNIT_METER,a.geometry1=e,a.geometry2=this.map.toMap(d),this._geometryService.distance(a,function(a){c=a;b.resolve(c)},function(){b.resolve(c)}))}return b.promise}),g=[],h=this._globalGeocoder.sources,k=function(){h[d].featureLayer&&g.push(f(h[d].featureLayer).then(a.hitch(h[d],function(b){this.searchQueryParams=
a.mixin(this.searchQueryParams,{distance:b})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(d=0;d<h.length;d++)k();else d=this._globalGeocoder.activeSourceIndex,k();U(g).always(a.hitch(this,function(){this._globalGeocoder.search(e).then(a.hitch(this,function(a){var f=!1;if(a){var g=null,h;for(d=0;d<this._globalGeocoder.sources.length;d++)if(a[d]&&a[d].length){h=a[d];break}if(h.length&&(f=!0,g=h[0],this._globalGeocoder.sources[d].featureLayer))for(a=Number.POSITIVE_INFINITY,d=0;d<h.length;d++){h[d]=
this._toPointGeometry(h[d]);var k=la.geodesicLengths([new na({paths:[[ca.xyToLngLat(e.x,e.y),ca.xyToLngLat(h[d].feature.geometry.x,h[d].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];a>k&&(a=k,g=h[d])}(g=this._decorateEmptyAGOLGeocoderResponse(g))&&""!==g.name&&null!==g.name&&void 0!==g.name?(g.name=String(g.name),isNaN(e.x)||isNaN(e.y)||this.map.spatialReference.wkid!==e.spatialReference.wkid?!g.feature.geometry||isNaN(g.feature.geometry.x)||isNaN(g.feature.geometry.y)?
(this._showMessage(F.widgets.directions.error.locator),c.reject(Error(F.widgets.directions.error.locator))):c.resolve(g):(g.feature.geometry=e,c.resolve(g))):f=!1}f||(b instanceof ia?b=new H(b):b instanceof Array&&(b=new H(new ia(b[0],b[1]))),b instanceof H?this._decorateUngeocodedStop(b).then(c.resolve,c.reject):(this._showMessage(F.widgets.directions.error.unknownStop.replace("\x3cname\x3e",b.toString())),c.reject(Error(F.widgets.directions.error.unknownStop.replace("\x3cname\x3e",b.toString())))))}))}))}else this._showMessage(F.widgets.directions.error.locatorUndefined),
c.reject(Error(F.widgets.directions.error.locatorUndefined));return c.promise},_updateStop:function(b,c,d){var e=new N;this.stops&&this.stops[c]?b instanceof H&&b.attributes&&b.attributes.isWaypoint&&(!c||c===this.stops.length-1||2>this._getStopCount())?(this._showMessage(F.widgets.directions.error.waypointShouldBeInBetweenStops),e.reject(Error(F.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(b).then(a.hitch(this,function(a){var b=a.feature,b=b?b.geometry:null,f=this.stops[c].feature,
f=f?f.geometry:null,b=b&&f&&(b.x!==f.x||b.y!==f.y)||!b&&f;this.stops[c]=a;this.geocoders[c]||this._createGeocoder(a,c);f=this.geocoders[c];f._stopReference=a;f._tr.style.display=this._isStopAWaypoint(a)?"none":"";f.value=a.name;f.inputNode&&(f.inputNode.value=a.name);b&&this.autoSolve&&1<this._getStopCount()+this._getWaypointCount()||d?this._getDirections().then(e.resolve,e.reject):(this._setStops(),e.resolve(a))}),a.hitch(this,function(a){e.reject(a)})):(this._showMessage(F.widgets.directions.error.couldNotUpdateStop),
e.reject(Error(F.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return e.promise},_renderDirections:function(){var b=this.get("directions"),c;this._resultsNode&&(c=""+('\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e'),c+=this._renderDirectionsSummary(b),c+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e',c+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e',c+=this._renderDirectionsTable(b),c+="\x3cdiv class\x3d'esriPrintFooter'\x3e"+F.widgets.directions.printDisclaimer+
"\x3c/div\x3e",c+="\x3c/div\x3e",this._resultsNode&&(this._resultsNode.innerHTML=c),this._disconnectResults(),(b=z("[data-segment]",this._resultsNode))&&b.length&&u.forEach(b,a.hitch(this,function(b){this._resultEvents.push(d(b,y.enter,a.hitch(this,function(){if(!this._focusedDirectionsItem){var a=parseInt(D.get(b,"data-segment"),10);this.highlightSegment(a)}})));this._resultEvents.push(d(b,"focusout",a.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(d(b,
y.leave,this.unhighlightSegment));this._resultEvents.push(d(b,"click, keydown",a.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)&&(this._focusedDirectionsItem!==b?this.selectSegment(parseInt(D.get(b,"data-segment"),10)):(b.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))})))},_renderDirectionsSummary:function(b){var c="",d=a.hitch(this,function(){for(var a={},c=this._getDirectionsTimeAttribute()||{},d=this._getTimeNeutralAttribute()||
{},e=0,f=0,g=this.get("stops"),h=g.length-1;0<=h;h--)if(null!==g[h].feature.attributes.ArriveCurbApproach){a=g[h].feature.attributes;break}for(var k in a)a.hasOwnProperty(k)&&(k==="Cumul_"+c.name&&(e=a[k]),k==="Cumul_"+d.name&&(f=a[k]));a="esriTrafficLabelHidden";g=F.widgets.directions.noTraffic;h=b.totalTime-b.totalDriveTime;h=(f-this._convertCostValue(h,c.units,d.units))/(e-h||1);0<h&&.8>h?(a="esriTrafficLabelHeavy",g=F.widgets.directions.heavyTraffic):1===h?(a="esriTrafficLabelNone",g=F.widgets.directions.noTraffic):
1.25<h&&(a="esriTrafficLabelLight",g=F.widgets.directions.ligthTraffic);d=this._formatTime(f,!1,d.units);return{label:g,labelClass:a,ratio:h,noTrafficCostStr:1!==h&&d?d+" "+F.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:e,noTrafficCost:f,timeAtt:c}});if(b.totalLength||b.totalTime){var d=d(),e=this._getImpedanceAttribute(),c=c+("\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e");if(this._isTimeUnits(e.units))c+=this._formatTime(d.trafficCost,
!0,d.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+F.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+F.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(d.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+d.labelClass+"'\x3e"+d.label+"\x3c/div\x3e"+d.noTrafficCostStr:"")+this._formatDistance(b.totalLength);else var e=(e=F.widgets.directions.units[this.directionsLengthUnits])?
e.name:"",f=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,g=this.directions.features[0].attributes,c=c+(J.format(b.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+e+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(d.noTrafficCost&&f?"\x3cdiv class\x3d'esriTrafficLabel "+d.labelClass+"'\x3e"+d.label+"\x3c/div\x3e"+d.noTrafficCostStr:"")+this._formatTime(b.totalTime)+" "+("none"!==this.startTime&&d.noTrafficCost&&f?F.widgets.directions.atTheMoment+
" "+this._toSpatiallyLocalTimeString(g.arriveTimeUTC,g.ETA):""));c+="\x3c/div\x3e\x3c/div\x3e"}return c},_renderDirectionsTable:function(a){for(var b=0,c=0,d=0,e='\x3ctable summary\x3d"'+a.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',f=0;f<a.features.length;f++){var g=a.features[f].attributes;"esriDMTDepart"===g.maneuverType&&(c=d=0);d+=g.length;c+=g.time;b+=g.time;e+=this._renderDirectionsItemTR(a.features[f],d,c,b)}return e+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(a,b,c,
d){var e=this.directions,f=e?u.indexOf(e.features,a):-1;d="";var g=this._css.routeClass,h=a._associatedStopWithReturnToStart&&a._associatedStopWithReturnToStart.attributes,k=a.attributes;if(-1<f){k&&(k.step=f+1);k.maneuverType&&(g+=" "+k.maneuverType);h&&null===h.ArriveCurbApproach&&null!==h.DepartCurbApproach?g+=" "+this._css.routeOriginClass:h&&null!==h.ArriveCurbApproach&&null===h.DepartCurbApproach&&(g+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);d+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+
g+" "+this._css.routeZoomClass+'" data-segment\x3d"'+f+'"\x3e';d+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';d+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';d+=this._getLetter(a._associatedStop);d=d+"\x3c/div\x3e\x3c/td\x3e"+('\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e');d+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';d+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';a=(e.strings[f]||[]).slice();if("esriDMTDepart"===k.maneuverType||"esriDMTStop"===
k.maneuverType)for(e=0;e<this.stops.length;e++)this.stops[e]&&this.stops[e].name&&a.push({string:this.stops[e].name});if(a){g=k.text;for(e=0;e<a.length;e++)g=this._boldText(g,a[e].string);k.formattedText=g}else k.formattedText=k.text;if("esriDMTStop"===k.maneuverType&&(b||c)||"esriDMTDepart"===k.maneuverType&&0===f)b=this._formatDistance(b-k.length,!0),c=this._formatTime(c-k.time),f=this._formatTime(k.time),a=this._formatDistance(k.length,!0),k.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+
b+(b&&c?" \x26middot; ":"")+c+(b||c?"\x3cbr\x3e":"")+(f?F.widgets.directions.serviceTime+":\x26nbsp;"+f:"")+(f&&a?"\x3cbr\x3e":"")+(a?F.widgets.directions.serviceDistance+":\x26nbsp;"+a:"")+"\x3c/div\x3e";d+="\x3cstrong\x3e"+J.format(k.step)+".\x3c/strong\x3e "+k.formattedText;d+="\x3c/div\x3e";b=this._formatDistance(k.length,!0);c=this._formatTime(k.time);"esriDMTStop"!==k.maneuverType&&"esriDMTDepart"!==k.maneuverType||!this.routeParams.startTime||-22091616E5===k.ETA?b&&(d+='\x3cdiv class\x3d"'+
this._css.routeLengthClass+'"\x3e',d+=b,c&&(d+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+c),d+="\x3c/div\x3e"):d+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(k.arriveTimeUTC,k.ETA)+"\x3c/div\x3e";d+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return d},_toSpatiallyLocalTimeString:function(a,b){var c=new Date(b),d=new Date(c.getTime()+6E4*c.getTimezoneOffset()),d=n.date.locale.format(d,{selector:"time"}),e="";a?(b=(b-a)/1E3/60/60,a=Math.floor(b),b=60*(b-a),a=
F.widgets.directions.GMT+(0>a?"":"+")+J.format(a,{pattern:"00"})+J.format(b,{pattern:"00"}),e=d+" "+a):e="now"===this.startTime?n.date.locale.format(c,{selector:"time"}):d;return e},_addStopWrapperToGraphic:function(a,b){return{extent:new Z({xmin:a.geometry.x-.25,ymin:a.geometry.y-.25,xmax:a.geometry.x+.25,ymax:a.geometry.y+.25,spatialReference:a.geometry.spatialReference}),feature:a,name:b}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},
_showBarriers:function(){this._clearBarriersGraphics();var b=this.routeParams,c=b.polylineBarriers&&b.polylineBarriers.features||[],d=b.polygonBarriers&&b.polygonBarriers.features||[];u.forEach(b.barriers&&b.barriers.features||[],a.hitch(this,function(a){this._barriersLayer.add(a)}));u.forEach(c,a.hitch(this,function(a){this._polylineBarriersLayer.add(a)}));u.forEach(d,a.hitch(this,function(a){this._polygonBarriersLayer.add(a)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();
this._polygonBarriersLayer.refresh()},_showRoute:function(a){this._clearDisplayAfterSolve();var b=a.routeResults[0].directions,c=new N;if(b){this.set("solveResult",a);this.set("directions",b);var d=a.routeResults[0].stops,e,f;if(d&&d.length){var g=[];for(e=0;e<d.length;e++){var h=d[e];h.attributes.isWaypoint=h.attributes.Name===this._waypointName||h.attributes.isWaypoint;h=this._addStopWrapperToGraphic(h,h.attributes.Name);this.stops[e]&&this.stops[e].feature&&this.stops[e].feature.attributes&&this.stops[e].feature.attributes.Name===
this._userDefinedStopName&&(h.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===e?this._returnToStartStop=h:g.push(h)}if(this.stops.length>g.length)for(e=0;e<this.stops.length;e++)this.stops[e].feature||""!==this.stops[e].name||g.splice(e,0,this._emptyStop);this.stops=g;for(e=0;e<this.stops.length;e++)this._updateStop(this.stops[e],e);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new H(b.mergedGeometry,
this.get("routeSymbol")));d=[];g=[];for(e=h=0;e<b.featuresWithWaypoints.length;e++){var k=b.featuresWithWaypoints[e];if("esriDMTDepart"===k.attributes.maneuverType)for(f=0;f<this.stops.length;f++)if(this.stops[f].feature===k._associatedStop){h=f+1;break}k.setSymbol(this.get("routeSymbol"));this._routeLayer.add(k);d.push(k);(f=k.getDojoShape())&&f.moveToBack();f=new H(k.geometry,this._symbolEventPaddingDirections,k.attributes);f._nextStopIndex=h-.5;f._isSnapFeature=!0;k._associatedSnapFeature=f;this._waypointsEventLayer.add(f);
"esriDMTDepart"!==k.attributes.maneuverType&&(f=k.geometry.getPoint(0,0))&&(f=new H(f,this.maneuverSymbol),f._directionsFeature=k._associatedFeatureNoWaypoints,g.push(f),this._waypointsEventLayer.add(g[g.length-1]))}this.set("displayedRouteGraphics",d);this.set("displayedManeuverPointGraphics",g);this._renderDirections();for(e=0;e<this.stops.length;e++)if(this._isStopAWaypoint(this.stops[e])&&this._modifiedWaypointIndex===e){for(f=0;f<b.featuresWithWaypoints.length;f++)if(d=b.featuresWithWaypoints[f],
d._associatedStop===this.stops[e].feature){if("esriDMTStop"===d.attributes.maneuverType||"esriDMTDepart"===d.attributes.maneuverType)this.stops[e].feature.geometry.x=d.geometry.paths[0][0][0],this.stops[e].feature.geometry.y=d.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}E.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(a)}else a=a.routeResults[0].route,a.setSymbol(this.routeSymbol),this._routeLayer.add(a),this._incrementalRouteSegment=a;c.resolve();
this._moveLayersToFront();this.createRouteSymbols();return c.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var a=0;a<this.geocoders.length;a++)this.geocoders[a]&&this.stops[a]&&(this.geocoders[a]._stopReference=this.stops[a])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(a){var b=[];if(a&&a.length){for(var c=0;c<a.length;c++)b.push(this._getCandidate(a[c]));
return U(b)}a=new N;a.resolve([]);return a.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";E.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(a){if(a&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var b=a.geometry.getPoint(0,0);a=new H(b,null,a.attributes,this.get("segmentInfoTemplate"));var c=this.get("map").infoWindow;c.setFeatures([a]);c.show(b)}},_addStopButton:function(){this.addStop().then(a.hitch(this,function(){this.get("focusOnNewStop")&&
this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var b=this._dnd.getAllNodes();this.geocoders.sort(a.hitch(this,function(a,c){return a.domNode&&a.domNode.parentNode&&a.domNode.parentNode.parentNode&&c.domNode&&c.domNode.parentNode&&c.domNode.parentNode.parentNode?u.indexOf(b,a.domNode.parentNode.parentNode)>u.indexOf(b,c.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var c=0;c<this.geocoders.length;c++)this.geocoders[c]&&
this.geocoders[c].inputNode&&(this.geocoders[c].inputNode.title=F.widgets.directions.stopNoTitle+(c+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var a=0;a<this._resultEvents.length;a++)this._resultEvents[a]&&this._resultEvents[a].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(a){var b="",c;for(c in a)if(0===c.indexOf("Total_")&&a.hasOwnProperty(c)){var d=this._getCostAttribute(c.substr(6));
d&&(b+=this._isTimeUnits(d.units)?this._formatTime(a[c],!1,d.units):this._formatDistance(a[c],!0,d.units),b+=b?" \x26middot; ":"")}b&&(b=F.widgets.directions.toNearbyStops+": \x3cb\x3e"+b.substr(0,b.length-10)+"\x3c/b\x3e");return b},_formatTime:function(a,b,c){c||(c=(this._getDirectionsTimeAttribute()||{}).units);var d="";c=Math.round(this._convertCostValue(a,c,"esriNAUMinutes"));a=Math.floor(c/60);c=Math.floor(c%60);b?d=J.format(a,{pattern:100>a?"00":"000"})+":"+J.format(c,{pattern:"00"}):(a&&(d+=
a+" "+F.widgets.directions.time.hr+" "),d+=a||c?c+" "+F.widgets.directions.time.min:"");return d},_formatDistance:function(a,b,c){c||(c=this.directionsLengthUnits);var d=this.directionsLengthUnits,e=F.widgets.directions.units[d],f=d.replace("esri","").toLowerCase();a=this._convertCostValue(a,c,d);e&&(f=b?e.abbr:e.name);return a?J.format(a,{locale:"root",places:2})+" "+f:""},_createToolbars:function(){this.editToolbar||(this.editToolbar=new ka(this.map));this.drawToolbar||(this.drawToolbar=new pa(this.map),
F.toolbars.draw.freehand=F.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=a.hitch(this,function(a){var b=new H(a.geometry,null,{BarrierType:0});1<la.geodesicLengths([a.geographicGeometry],L.METERS)[0]&&(this._polylineBarriersLayer.add(b),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new V),this.routeParams.polylineBarriers.features.push(b),this._clearStopsStatusAttr(),this.getDirections(!0))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&
(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var a=new N;this._globalGeocoder=new B(this.get("searchOptions"));d.once(this._globalGeocoder,"load",a.resolve,a.reject);this._globalGeocoder.startup();return a.promise},_init:function(){var b=new N;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);E.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(b.resolve);else d.once(this.get("map"),
"load",a.hitch(this,function(){this._configure().always(b.resolve)}));return b.promise},_setDefaultStops:function(){var b=new N;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(a.hitch(this,function(){this._removeEmptyStops();b.resolve()}),b.reject):b.resolve();return b.promise},_configure:function(){var b=new N;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(a.hitch(this,
function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var c=[this._createRouteTask(),this._setDefaultStops()];U(c).then(a.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var c=this.directionsLanguage||this.userOptions.routeParams&&
this.userOptions.routeParams.directionsLanguage||n.locale.toLowerCase();this._setDirectionsLanguageByLocale(c);this._setupTravelModes().then(a.hitch(this,function(){this.set("loaded",!0);this.onLoad();b.resolve(!0)}),function(a){b.reject(a)})}),function(a){b.reject(a)})}),function(a){b.reject(a)});this._naRouteSharing=null;return b.promise},_setDirectionsLanguageByLocale:function(a){var b=this.serviceDescription.directionsSupportedLanguages,c=function(a){if(b)for(var c=0;c<b.length;c++)if(b[c].toLowerCase().substr(0,
2)===a)return b[c];return null},d=c(a);d||(a=a.substr(0,2),d=c(a));this.directionsLanguage=d;return this.routeParams.directionsLanguage=d},_getStopSymbol:function(a,b){var c=a&&(a.feature&&a.feature.attributes||a.attributes),d=this.stopSymbol;c&&(d=this._isStopAWaypoint(a)?this.waypointSymbol:void 0===c.Status||0===c.Status||6===c.Status?null===c.ArriveCurbApproach&&null!==c.DepartCurbApproach?this.get(b?"fromSymbolDrag":"fromSymbol"):null!==c.ArriveCurbApproach&&null===c.DepartCurbApproach?this.get(b?
"toSymbolDrag":"toSymbol"):this.get(b?"stopSymbolDrag":"stopSymbol"):this.get(b?"unreachedSymbolDrag":"unreachedSymbol"));return d},_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(a){a.target===this._useMilesNode?this.setDirectionsLengthUnits(L.MILES):a.target===this._useKilometersNode&&this.setDirectionsLengthUnits(L.KILOMETERS)},_toggleCheckbox:function(a){var b=
D.get(a.target,"checked");a.target===this._findOptimalOrderNode?this.set("optimalRoute",b):a.target===this._useTrafficNode?this.set("traffic",b):a.target===this._returnToStartNode&&this.set("returnToStart",b)},_isStopLocated:function(a){return a&&a.feature&&a.feature.attributes&&(!a.feature.attributes.Status||6===a.feature.attributes.Status)},_configureRouteOptions:function(){var a=this.get("routeParams"),b;this.get("directionsLengthUnits")?a.directionsLengthUnits=this.get("directionsLengthUnits"):
this.set("directionsLengthUnits",a.directionsLengthUnits);a.findBestSequence=this.get("optimalRoute");if(a.findBestSequence)for(a.preserveFirstStop=this._isStopLocated(this.stops[0]),a.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),b=0;b<this.stops.length;)this._isStopAWaypoint(this.stops[b])?this._removeStop(b,!0,!0):b++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-
1]))for(b=this.stops.length-1;0<b;)this._isStopAWaypoint(this.stops[b])&&this._removeStop(b,!0,!0),b--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(a.useTimeWindows=!0,"now"===this.startTime)a.timeWindowsAreUTC=!0,a.startTimeIsUTC=!0,a.startTime=new Date;else if("none"===this.startTime)a.startTime=null;else{a.timeWindowsAreUTC=!1;a.startTimeIsUTC=!1;var c=this._departAtTime,d=6E4*c.getValue().getTimezoneOffset(),
c=new Date(c.getValue().getTime()+this._departAtDate.getValue().getTime()-d),c=new Date(c.getTime()-6E4*c.getTimezoneOffset());a.startTime=c}else a.startTime=null,a.useTimeWindows=!1;var c=this._getImpedanceAttribute(),d=this._getTimeNeutralAttribute(),e=this._getDirectionsTimeAttribute();b=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;d&&-1===u.indexOf(b,d.name)&&b.push(d.name);!this._isTimeUnits(c.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&
e&&-1===u.indexOf(b,e.name)&&b.push(e.name);this.routeParams.accumulateAttributes=b;a.returnStops=!0;e=[];for(b=0;b<this.stopGraphics.length;b++)if(this.stopGraphics[b]&&(e.push(new H(this.stopGraphics[b].toJson())),b)){var f=e[0].attributes,g=e[b].attributes,h;for(h in g)g.hasOwnProperty(h)&&!f.hasOwnProperty(h)&&(f[h]=null)}this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])?(h=new H(this.stopGraphics[0].toJson()),this._returnToStartStop=this._addStopWrapperToGraphic(h,
h.attributes.Name),e.push(h)):this._returnToStartStop=null;a.stops.features=e;if(d)for(b=0;b<e.length;b++)e[b].attributes["Attr_"+d.name]=this._convertCostValue(e[b].attributes["Attr_"+c.name],c.units,d.units);this.set("routeParams",a)},_configureRoute:function(){var b=new N;b.promise.always(a.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var c=this._incrementalSolveStopRange;
c.start<c.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(c.start,c.end+1):c.start>c.end&&(this.routeParams.stops.features=this.routeParams.stops.features.slice(c.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,c.end+1)))}else this._incrementalSolveStopRange=null;for(var d={},e=this.routeParams.stops.features,f,g,c=0;c<e.length;c++)g=e[c].attributes.address,f=(c===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?
this._waypointName:g)+"_"+this._stopSequence++,e[c].attributes.Name=f,d[f]=g,delete e[c].attributes.address,delete e[c].attributes.isWaypoint,delete e[c].attributes.Status;this._solveInProgress=!0;var h={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,a.hitch(this,function(a){this._solveResultProcessing(a,d,h).then(b.resolve,b.reject)}),a.hitch(this,function(c){a.mixin(this,h);this._solveInProgress=!1;for(var d=0;d<this.stops.length;d++)this.stops[d].feature&&
(this.stops[d].feature.attributes=a.mixin(this.stops[d].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(c);b.reject(c)}));return b.promise},_solveResultProcessing:function(b,c,d){var e=new N;a.mixin(this,d);this._solveInProgress=!1;d=b.routeResults[0];var f=d.directions;d=d.stops;var g;if(f){this._solverMessages=b.messages;var h=function(a){for(var b in c)if(a&&0===f.routeName.indexOf(b)||!a&&0<f.routeName.indexOf(b))return c[b];
return""};g=h(!0);h=h(!1);f.routeName=(g!==this._waypointName?g:F.widgets.directions.waypoint)+" \u2014 "+(h!==this._waypointName?h:F.widgets.directions.waypoint);for(g=0;g<f.features.length;g++)if(h=f.features[g].attributes,"esriDMTDepart"===h.maneuverType||"esriDMTStop"===h.maneuverType)for(var k in c)if(c.hasOwnProperty(k)&&-1<h.text.indexOf(k)){h.text=h.text.replace(k,c[k]);for(var l=0;l<d.length;l++){var m=d[l].attributes;if(m.Name===k){a.mixin(f.features[g],{_associatedStop:d[this.returnToStart&&
l===d.length-1?0:l],_associatedStopWithReturnToStart:d[l]});if(!m.ArriveTime&&!m.ArriveTimeUTC&&h.ETA&&h.arriveTimeUTC){m.ArriveTime=h.ETA;m.ArriveTimeUTC=h.arriveTimeUTC;l=0;if(0==g&&"esriDMTDepart"===h.maneuverType||0<g&&"esriDMTStop"===h.maneuverType)l=this._convertCostValue(h.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");m.DepartTime=m.ArriveTime+l;m.DepartTimeUTC=m.ArriveTimeUTC+l}break}}}for(g=0;g<d.length;g++)this._returnToStartStop&&d[g].attributes.Name===this._returnToStartStop.feature.attributes.Name&&
(this._returnToStartStop._resultsStopIndex=g),d[g].attributes.Name=c[d[g].attributes.Name];this._directionsPostprocessing(f);this.traffic&&this._updateMapTimeExtent()}this._showRoute(b).always(a.hitch(this,function(){this._incrementalSolveStopRange=null;e.resolve(b)}));return e.promise},_directionsPostprocessing:function(b){var c,d,e=function(a,c){var d=b.features[a]._associatedFeaturesWithWaypoints||[];d.push(b.featuresWithWaypoints[c]);b.features[a]._associatedFeaturesWithWaypoints=d;b.featuresWithWaypoints[c]._associatedFeatureNoWaypoints=
b.features[a]};d=a.hitch(this,function(a){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(a._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});b.featuresWithWaypoints=[];for(c=0;c<b.features.length;c++){var f=new H(b.features[c].toJson());f.setInfoTemplate(new X({title:this._i18n.widgets.directions.maneuver,content:d}));b.featuresWithWaypoints.push(f);b.featuresWithWaypoints[c]._associatedStop=b.features[c]._associatedStop;
b.featuresWithWaypoints[c]._associatedStopWithReturnToStart=b.features[c]._associatedStopWithReturnToStart}b.stringsWithWaypoints=a.mixin([],b.strings);b.eventsWithWaypoints=a.mixin([],b.events);for(d=c=0;c<b.features.length;)b.features[c]._associatedStop&&b.features[c]._associatedStop.attributes.Name===this._waypointName?(b.features.splice(c,c?2:1),b.strings.splice(c,c?2:1),b.events.splice(c,c?2:1),c&&b.features[c]&&"esriDMTStraight"===b.features[c].attributes.maneuverType?(f=b.features.splice(c,
1)[0],b.strings[c-1]=(b.strings[c-1]||[]).concat(b.strings.splice(c,1)[0]||[]),b.strings[c-1].length||(b.strings[c-1]=void 0),b.events[c-1]=(b.events[c-1]||[]).concat(b.events.splice(c,1)[0]||[]),b.events[c-1].length||(b.events[c-1]=void 0),b.features[c-1].attributes.length+=f.attributes.length,b.features[c-1].attributes.time+=f.attributes.time,b.features[c-1].geometry.paths[0]=b.features[c-1].geometry.paths[0].concat(f.geometry.paths[0]),e(c-1,d++),e(c-1,d++),e(c-1,d++)):(c&&e(c-1,d++),c<b.features.length&&
e(c,d++))):(e(c,d++),c++)},_boldText:function(a,b){try{var c=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+b.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");a=(" "+a+" ").replace(c,"\x3cstrong\x3e\x26nbsp;"+b+"\x26nbsp;\x3c/strong\x3e");a=a.trim()}catch(ya){}return a},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var a=0;a<this.stopGraphics.length;a++)this._stopLayer.remove(this.stopGraphics[a]),this._stopLayer.remove(this.textGraphics[a]);
this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var a=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},b=(new Date).getTime(),b="none"==this.startTime?b:a.arriveTimeUTC||b;this._useTrafficItemNode.title="none"!==this.startTime&&a.arriveTimeUTC?F.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(a.arriveTimeUTC,a.ETA):"";this._myTimeExtentUpdate=!0;a=new Date(b);this.map.setTimeExtent(new fa(a,
a))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var a=this.displayedRouteGraphics,b=this.displayedManeuverPointGraphics,c=this._routeLayer,d=this._waypointsEventLayer,e=0,f=0,g=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};a&&f<a.length;){if(a[f]._associatedStop)for(var h=0;h<this.stops.length;h++)if(this.stops[h].feature===
a[f]._associatedStop){e=h;break}e>=g.start&&e<g.end||g.start>=g.end&&(e>=g.start||e<g.end)?(c.remove(a[f]),a.splice(f,1)):f++}c.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",a?a:[]);b&&b.length&&u.forEach(b,function(a){d.remove(a)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var a=this.get("map").infoWindow;a&&(a.hide(),a.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);
this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(b){var c=this.alphabet,d="",e=function(a){var b="";"0123456789"===c||"1234567890"===c?b=String(a+1):(a=a||0,a>=c.length&&(b=e(Math.floor(a/c.length)-1),a%=c.length),b+=c[a]);return b},f=b instanceof H?a.hitch(this,function(){for(var a=this.get("returnToStart")?0:-1,c=0;c<this.stops.length;c++)if(this.stops[c].feature===
b){a=c;break}return a})():b;if(-1<f&&c&&c.length){c instanceof Array&&(c=c.toString().replace(/,/g,""));for(var d=-1,g=0;g<=f;g++)d+=this._isStopAWaypoint(this.stops[g])?0:1;d=e(d)}return d},_solveAndZoom:function(b){if(this.autoSolve)return this._getDirections().then(a.hitch(this,function(){b||this.zoomToFullRoute()}));var c=new N;c.resolve();return c.promise},_setupEvents:function(){this._onEvents.push(d(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(d(this._dndNode,
"[data-reverse-stops]:click, [data-reverse-stops]:keydown",a.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(d(this._printButton,"click, keydown",a.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)&&this._printDirections()})));this._onEvents.push(d(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",a.hitch(this,function(a){a&&("click"===a.type||"keydown"===
a.type&&a.keyCode===m.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(d(this._dndNode,"[data-remove]:click, [data-remove]:keydown",a.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)){var b=z("[data-remove]",this._dndNode);a=u.indexOf(b,a.target);this.removeStop(a)}})));this._onEvents.push(d(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",a.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===m.ENTER)){var b=
z("[data-center-at]",this._dndNode);a=u.indexOf(b,a.target);this.stops[a]&&this.stops[a].feature&&this.stops[a].feature.geometry&&this.map.centerAndZoom(this.stops[a].feature.geometry)}})));this._onEvents.push(d(this.map,"zoom-end",a.hitch(this,function(){var a=this._segmentGraphics;a&&a[0]&&void 0!==a[0].attributes._index&&this.highlightSegment(a[0].attributes._index,!0)})));this._onEvents.push(d(this._dnd,"Drop",a.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var a,b,c=!1,d=
[],e=this._dnd.getAllNodes();for(a=0;a<this.geocoders.length;a++)if(b=u.indexOf(e,this.geocoders[a]._tr),-1<b&&a!==b&&a!==b-1){for(;0<b&&this._isStopAWaypoint(this.stops[b]);)b--;c=!0;break}c&&(d=this._markWPsForRemovalAfterUserChangedStopSequence(a,b));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(d);this.stops[b].name&&this.getDirections()})));this._onEvents.push(d(this._dnd,"DndStart",a.hitch(this,function(){var a=z("body")[0];C.add(a,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()})));
this._onEvents.push(d(this._dnd,"DndDrop, DndCancel",a.hitch(this,function(){var a=z("body")[0];C.remove(a,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var b=this._handle,c=a.hitch(this,function(c){var d=a.hitch(this,function(a,d,e,f,g){var h=b._isShown();b.setGeometry(a);b._tooltip.style.left=c.screenPoint.x+"px";b._tooltip.style.top=c.screenPoint.y+"px";!h||b._index===e&&b.attributes.isWaypoint===f||(b._remove(),h=!1);b.setSymbol(d);b._index=e;b._isStopIcon=b._index===
Math.floor(b._index);b.attributes.isWaypoint=f;b._isStopIcon&&(b.attributes.address=this.stopGraphics[e].attributes.address,b.setInfoTemplate(this.stopGraphics[e].infoTemplate));if(this.canModifyWaypoints||b._isStopIcon)h||(this._stopLayer.add(b),(a=b.getDojoShape())&&a[f?"moveToBack":"moveToFront"].call(a)),this.editToolbar.activate(ka.MOVE,b);f=f?b._isStopIcon?F.widgets.directions.dragWaypoint:this.canModifyWaypoints?F.widgets.directions.dragRoute:"":F.widgets.directions.dragStop;b._showTooltip(g||
f)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!b._solveTimeout)if(clearTimeout(b._removeTimeout),(c.graphic._isStopIcon||c.graphic._isStopLabel)&&!c.graphic.attributes.isWaypoint&&this.canModifyStops||c.graphic._isStopIcon&&c.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var e=c.graphic._isStopLabel?this.stopGraphics[c.graphic._index]:c.graphic;d(e.geometry,this._getStopSymbol(this.stops[e._index],!0),e._index,!0===e.attributes.isWaypoint);
this._stopLayer.remove(this.stopGraphics[e._index]);this._stopLayer.remove(this.textGraphics[e._index])}else if(c.graphic._isSnapFeature||c.graphic._isHandle&&!c.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(c.screenPoint).then(a.hitch(this,function(a){if(!this.maxStopsReached&&!this._moveInProgress&&a){for(var e=this.displayedManeuverPointGraphics,f=null,g=0;g<e.length;g++)if(e[g].geometry.x===a.x&&e[g].geometry.y===
a.y){f=e[g]._directionsFeature;e=u.indexOf(this.directions.features,f);-1<e&&this.highlightSegment(e);break}d(a,c.graphic._isHandle?b.symbol:this.waypointSymbol,c.graphic._isHandle?b._index:c.graphic._nextStopIndex,c.graphic._isHandle?b.attributes.isWaypoint:!0,f)}}))}),e=a.hitch(this,function(){clearTimeout(b._removeTimeout);b._removeTimeout=setTimeout(b._remove,100);this.unhighlightSegment()}),f=a.hitch(this,function(a){if(this.barrierToolActive){a=a.graphic;var b=this.routeParams,c=b.barriers?
u.indexOf(b.barriers.features,a):-1,d=b.polygonBarriers?u.indexOf(b.polygonBarriers.features,a):-1,e=b.polylineBarriers?u.indexOf(b.polylineBarriers.features,a):-1;-1<c&&b.barriers.features.splice(c,1);-1<d&&b.polygonBarriers.features.splice(d,1);-1<e&&b.polylineBarriers.features.splice(e,1);this._barriersLayer.remove(a);this._polygonBarriersLayer.remove(a);this._polylineBarriersLayer.remove(a);this._clearStopsStatusAttr();this.getDirections(!0)}});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",
c));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",e));this._onEvents.push(this._stopLayer.on("mouse-move",c));this._onEvents.push(this._stopLayer.on("mouse-out",e));this._onEvents.push(this._barriersLayer.on("click",f));this._onEvents.push(this._polylineBarriersLayer.on("click",f));this._onEvents.push(this._polygonBarriersLayer.on("click",f));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));this._watchEvents.push(this.watch("canModifyStops",
this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",this._setStartTime));this._watchEvents.push(this.watch("traffic",
this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",a.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",a.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",a.hitch(this,function(){this._createGeometryTask()})));this._watchEvents.push(this.watch("routeParams",a.hitch(this,function(){this._createRouteParams();
this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",a.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var a=this.get("searchOptions").sources;if(a)for(var b=0;b<this.geocoders.length;b++)this.geocoders[b].set("sources",a)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));
this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",
this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){E.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){E.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var b=a.hitch(this,function(a){var b="";if((a=a.routeResults?
a.routeResults[0]:null)&&a.route){a=a.route.attributes;var c=this.routeParams.travelMode;if(c)var b=b+("\x3cb\x3e"+c.name+"\x3c/b\x3e "+F.widgets.directions.toNearbyStops+": "),d=void 0!==a["Total_"+c.timeAttributeName]?this._formatTime(a["Total_"+c.timeAttributeName],!1,(this._getCostAttribute(c.timeAttributeName)||{}).units):"",b=b+((void 0!==a["Total_"+c.distanceAttributeName]?this._formatDistance(a["Total_"+c.distanceAttributeName],!0,(this._getCostAttribute(c.distanceAttributeName)||{}).units):
"")+(d?" \x26middot; "+d:""));else b=this._formatArbitraryCostsForRouteTooltip(a)}this._handle._showTooltip(b)}),c=a.hitch(this,function(d,e){var f=new N,g=this._handle,h=this.map.toScreen(g._origPoint).offset(d.transform.dx+g.symbol.xoffset,d.transform.dy+g.symbol.yoffset);d.origMapPoint||(d.origMapPoint=this.map.toMap(h));E.set(g._tooltip,"left",h.x+"px");E.set(g._tooltip,"top",h.y+"px");clearTimeout(g._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())g._solveTimeout=
setTimeout(function(){c(d,e).always(f.resolve)},100);else if(g._isStopIcon){var h=d.graphic._index,k=this.stops[h];(k=k?{name:k.name,extent:k.extent,feature:new H(k.feature.toJson())}:null)?(k.feature.setGeometry(d.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[h])?h:null,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+h-1)%this.stops.length:Math.max(0,h-1),end:this.returnToStart?(h+1)%this.stops.length:Math.min(this.stops.length-1,h+1)},this.updateStop(k,
h,e).always(a.hitch(this,function(a){g._solveTimeout=null;a.routeResults&&b(a);f.resolve()}))):f.resolve()}else f.resolve();return f.promise});this._onEvents.push(d(this.editToolbar,"graphic-click",a.hitch(this,function(b){if(b.graphic.attributes.isWaypoint)!b.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||(this._handle._remove(),this._moveInProgress=!0,this.removeStop(b.graphic._index,!0).always(a.hitch(this,function(){this._moveInProgress=!1})));else{var c=this.get("map").infoWindow;
c&&(c.setFeatures([b.graphic]),c.show(b.graphic.geometry))}})));this._onEvents.push(d(this.editToolbar,"graphic-move-start",a.hitch(this,function(a){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;a=a.graphic;a._origPoint=new ia(a.geometry.toJson());a._maxDeviation=0;a._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(d(this.editToolbar,"graphic-move-stop",a.hitch(this,function(b){this.map.enableMapNavigation();
this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)c(b,!0).always(a.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var d=this.stops[b.graphic._index],e=(d&&d.feature&&d.feature.attributes&&d.feature.attributes.Name)===this._userDefinedStopName,
f=d&&d.name;this._reverseGeocode(new H(b.graphic.toJson())).then(a.hitch(this,function(c){e&&(c.name=f,c.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(c,c.feature.geometry,b.graphic._index).always(a.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(d(this.editToolbar,"graphic-move",a.hitch(this,function(a){var b=this._handle,d=a.transform;
d.dx&&d.dy&&(a.graphic._maxDeviation=Math.max(b._maxDeviation,Math.sqrt(d.dx*d.dx+d.dy*d.dy)));10<b._maxDeviation&&(b._solveHasHappened=!0,a.graphic===b&&b.attributes.isWaypoint&&!b._isStopIcon?(this.set("optimalRoute",!1),b._index+=.5,b._isStopIcon=!0,a.graphic._stopIndex=b._index,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+b._index-1)%this.stops.length:Math.max(0,b._index-1),end:this.returnToStart?(b._index+1)%(this.stops.length+1):Math.min(this.stops.length,b._index+
1)},this.addStop({name:this._waypointName,feature:new H(b.geometry,b.symbol,{isWaypoint:!0,CurbApproach:3})},a.graphic._stopIndex)):((b=a.graphic.getDojoShape())&&b.moveToFront(),c(a)))})))},_isStopAWaypoint:function(a){return a&&a.feature&&a.feature.attributes&&a.feature.attributes.isWaypoint},_getStopCount:function(){var a=0,b;for(b=0;b<this.stops.length;b++)a+=!this._isStopAWaypoint(this.stops[b])&&this.stops[b].name?1:0;return a},_getWaypointCount:function(){var a=0,b;for(b=0;b<this.stops.length;b++)a+=
this._isStopAWaypoint(this.stops[b])?1:0;return a},_decorateUngeocodedStop:function(b){var c=new N,d=function(a,d){c.resolve({name:void 0===a?F.widgets.directions.unlocatedStop:a.toFixed(6)+" "+d.toFixed(6),feature:b})};if(b.geometry)if(b.geometry.spatialReference&&4326!==b.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var e=ca.xyToLngLat(b.geometry.x,b.geometry.y);d(e[0],e[1])}else this._geometryService?(e=new ra,e.outSR=new oa(4326),
e.geometries=[b.geometry],this._geometryService.project(e).then(a.hitch(this,function(a){a&&a.length?d(a[0].x,a[0].y):d(b.geometry.x,b.geometry.y)}),a.hitch(this,function(){d()}))):d(b.geometry.x,b.geometry.y);else d(b.geometry.x,b.geometry.y);else d();return c.promise},_trafficLayerUpdate:function(a,b,c){a=this.get("map");b&&this._trafficLayerAdded&&(a.removeLayer(b),this._trafficLayerAdded=!1);c&&this.get("traffic")&&!this._trafficLayerAdded&&(a.addLayer(c),c.show(),this._trafficLayerAdded=!0)},
_routeTaskError:function(a){var b=F.widgets.directions.error.routeTask,c=a.details,d=function(a){return(res=a.match(/(\d+)/))?": "+res[0]:"."};c&&1===c.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===c[0]?b=F.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===c[0]?b=F.widgets.directions.error.nonNAmTruckingMode:0===c[0].indexOf("The number of input locations loaded into Barriers")?
b=F.widgets.directions.error.tooManyBarriers+d(c[0]):0===c[0].indexOf("The number of input locations loaded into PolygonBarriers")?b=F.widgets.directions.error.tooManyPolygonBarriers+d(c[0]):0===c[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(b=F.widgets.directions.error.tooManyPolylineBarriers+d(c[0])));this._showMessage(b);this.onDirectionsFinish(a)},_showMessage:function(a,b){var c="";this.messages.push({msg:a,error:!b});if(this.messages.length){for(var c=c+"\x3cul\x3e",
d=0;d<this.messages.length;d++)c+='\x3cli class\x3d"'+(this.messages[d].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[d].msg+"\x3c/li\x3e";c+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=c);if(!b)this.onError(a)},_isTimeUnits:function(a){return"milliseconds"===a||"esriNAUSeconds"===a||"esriNAUMinutes"===a||"esriNAUHours"===a||"esriNAUDays"===a},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&
this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var a=(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(a)},
_getCostAttribute:function(a){for(var b=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],c,d=0;d<b.length;d++)if(b[d].name===a&&"esriNAUTCost"===b[d].usageType){c=b[d];break}return c},_convertCostValue:function(a,b,c){var d=this._isTimeUnits(b),e=this._isTimeUnits(c);b=d?this._toMinutes(a,b):this._toMeters(a,b);return d===e?e?this._fromMinutes(b,c):this._fromMeters(b,c):a},_toMinutes:function(a,b,c){a=a||0;switch(b){case "milliseconds":a/=Math.pow(6E4,c?-1:1);
break;case "esriNAUSeconds":a/=Math.pow(60,c?-1:1);break;case "esriNAUHours":a*=Math.pow(60,c?-1:1);break;case "esriNAUDays":a*=Math.pow(1440,c?-1:1)}return a},_fromMinutes:function(a,b){return this._toMinutes(a,b,!0)},_toMeters:function(a,b,c){a=a||0;switch((b||"").replace("esriNAU","esri")){case "esriInches":a*=Math.pow(.0254,c?-1:1);break;case "esriFeet":a*=Math.pow(.3048,c?-1:1);break;case "esriYards":a*=Math.pow(.9144,c?-1:1);break;case "esriMiles":a*=Math.pow(1609.344,c?-1:1);break;case "esriNauticalMiles":a*=
Math.pow(1851.995396854,c?-1:1);break;case "esriMillimeters":a/=Math.pow(1E3,c?-1:1);break;case "esriCentimeters":a/=Math.pow(100,c?-1:1);break;case "esriKilometers":a*=Math.pow(1E3,c?-1:1);break;case "esriDecimeters":a/=Math.pow(10,c?-1:1)}return a},_fromMeters:function(a,b){return this._toMeters(a,b,!0)},_createRouteTask:function(){var b=new N;this.set("routeTask",new q(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(a.hitch(this,
function(c){c.networkDataset?(this.set("serviceDescription",c),this.set("maxStops",parseInt(this.userOptions.maxStops||c.serviceLimits&&c.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,b.resolve()):this.routeTask.getOwningSystemUrl().then(a.hitch(this,function(a){this.owningSystemUrl=a;b.resolve()}),b.reject)):(this._showMessage(F.widgets.directions.error.cantFindRouteServiceDescription),b.reject(Error(F.widgets.directions.error.cantFindRouteServiceDescription)))}),
a.hitch(this,function(){this._showMessage(F.widgets.directions.error.cantFindRouteServiceDescription);b.reject(Error(F.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));return b.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){var b=a.hitch(this,function(a){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",a);for(var b=0;b<
this.geocoders.length;b++)this.geocoders[b].set("activeSourceIndex",a)});if(!this._searchSourceSelector){for(var c=[{value:"all",label:F.widgets.Search.main.all,selected:!0}],d=0;d<this._globalGeocoder.sources.length;d++)c.push({value:String(d),label:this._globalGeocoder.sources[d].name});this._searchSourceSelector=new l({className:"esriSearchSourcesDDL",style:"width:100%;",options:c},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",
b);this._searchSourceSelector.domNode.style.width=""}b("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new l({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",a.hitch(this,function(b){this._travelModeSelector._interractive?
this._enqueue(function(){return this._setTravelMode(b).always(a.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var a=this.get("serviceDescription"),b=a.supportedTravelModes,c=new N;if(b&&b.length&&this._travelModeSelector){for(var d=b[0].name,f=[],g=0;g<b.length;g++){for(var h="AUTOMOBILE"===b[g].type?"Driving":"TRUCK"===b[g].type?"Trucking":"WALK"===b[g].type?"Walking":"Other",k="",l=a.networkDataset.networkAttributes,
m=0;m<l.length;m++){var n=l[m];if(n.name===b[g].impedanceAttributeName){if("esriNAUCentimeters"===n.units||"esriNAUDecimalDegrees"===n.units||"esriNAUDecimeters"===n.units||"esriNAUFeet"===n.units||"esriNAUInches"===n.units||"esriNAUKilometers"===n.units||"esriNAUMeters"===n.units||"esriNAUMiles"===n.units||"esriNAUMillimeters"===n.units||"esriNAUNauticalMiles"===n.units||"esriNAUYards"===n.units)k="Distance";else if("esriNAUDays"===n.units||"esriNAUHours"===n.units||"esriNAUMinutes"===n.units||"esriNAUSeconds"===
n.units)k="Time";break}}f.push({id:b[g].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+h+k+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+b[g].description+'"\x3e'+b[g].name+"\x3c/div\x3e"});!a.defaultTravelMode||b[g].id!==a.defaultTravelMode&&b[g].itemId!==a.defaultTravelMode||(d=b[g].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new e({objectStore:new x({data:f})}));this._travelModeSelector._interractive=
!1;this._travelModeSelector.setValue(d);this._setTravelMode(d).always(c.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),c.resolve();return c.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new W(this.printTaskUrl,{async:!1}):null;var a=new A;a.exportOptions={width:670,height:750,dpi:96};a.format="PNG32";a.layout="MAP_ONLY";a.preserveScale=!1;a.showAttribution=!1;var b=
new S;b.map=this.map;b.outSpatialReference=this.map.spatialReference;b.template=a;this._printParams=b},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new ga(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new ga(this.defaults.geometryTaskUrl):sa.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var a=this.get("serviceDescription");E.set(this._travelModeContainerNode,
"display",this.showTravelModesOption&&a&&a.supportedTravelModes&&a.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){E.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){E.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){E.set(this._activateButtonNode,"display",this.showActivateButton?
"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){E.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var b={returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new V,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,
outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var c=new ba;this.routeParams=a.mixin(c,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),b)},_markWPsForRemovalAfterUserChangedStopSequence:function(a,b){for(var c=a-1,d=[];0<=c&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c--;for(c=a+1;c<this.stops.length&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),
c++;if(b>a)for(c=b+1;c<this.stops.length&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c++;else if(void 0!==b)for(c=b-1;0<=c&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c--;else if(this.returnToStart&&0===a)for(c=this.stops.length-1;0<=c&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c--;return d},_removeSomeWaypoints:function(a){for(var b=new N,c=[],d=0;d<a.length;d++){var e=u.indexOf(this.stops,a[d]);-1<e&&c.push(this._removeStop(e,!0,!0))}U(c).always(b.resolve);
return b.promise},_modifyStopSequence:function(b,c){var d=this._dnd.getAllNodes(),e=new N,f,g=[];if(d.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==b)if(0<=b&&0<=c&&b<this.stops.length&&c<this.stops.length&&b!==c){var d=this._markWPsForRemovalAfterUserChangedStopSequence(b,c),h=this.stops.splice(b,1);this.stops.splice(c,0,h[0]);for(f=0;f<this.stops.length;f++)g.push(this._updateStop(this.stops[f],f));g.push(this._removeSomeWaypoints(d));U(g).always(a.hitch(this,function(){this._solveAndZoom().always(e.resolve)}))}else e.reject("Invalid From and To values.");
else{for(f=0;f<this.stops.length;)this._isStopAWaypoint(this.stops[f])?g.push(this._removeStop(f,!0,!0)):f++;U(g).always(a.hitch(this,function(){g=[];this.stops.reverse();for(f=0;f<this.stops.length;f++)g.push(this._updateStop(this.stops[f],f));U(g).always(a.hitch(this,function(){this._solveAndZoom().always(e.resolve)}))}))}else e.resolve();return e.promise},_setMenuNodeValues:function(a){"traffic"!==a&&this._clearDisplayBeforeSolve();a=this.get("optimalRoute");this._findOptimalOrderNode&&D.set(this._findOptimalOrderNode,
"checked",a);this._returnToStartNode&&(a=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),D.set(this._returnToStartNode,"checked",a),this.set("returnToStart",a),this.maxStopsReached&&this.returnToStart&&this._showMessage(F.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),
this._incrementalSolveStopRange=null,a=this.stops.length;0<a--&&this._isStopAWaypoint(this.stops[a]);)this._removeSomeWaypoints([this.stops[a]]);this._useTrafficNode&&(D.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case L.KILOMETERS:D.set(this._useKilometersNode,"checked",!0);D.set(this._useMilesNode,"checked",!1);break;case L.MILES:D.set(this._useKilometersNode,
"checked",!1),D.set(this._useMilesNode,"checked",!0)}E.set(this._printButton,"display",this.showPrintPage?"inline-block":"none");E.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&E.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&E.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?
"block":"none");this._findOptimalOrderItemNode&&E.set(this._findOptimalOrderItemNode,"display",this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?C.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(C.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===E.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-
this._getWaypointCount()?C.add(this._widgetContainer,this._css.stopsRemovableClass):C.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(a,b,c){C.remove(this.domNode,b);C.add(this.domNode,c)},_toggleOptionsMenu:function(){"block"===E.get(this._optionsMenuNode,"display")?(E.set(this._optionsMenuNode,
"display","none"),C.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=F.widgets.directions.showOptions):(E.set(this._optionsMenuNode,"display","block"),C.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=F.widgets.directions.hideOptions)},_toggleSaveMenu:function(b){"block"===E.get(this._saveMenuNode,"display")||!1===b?(E.set(this._saveMenuNode,"display","none"),C.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):
(this.clearMessages(),E.set(this._saveMenuNode,"display","block"),C.add(this._saveMenuButton,this._css.stopsPressedButtonClass),this._enableSharing().then(a.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var a=this._folderSelector.store.objectStore.data,b=0;b<a.length;b++)if(a[b].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==a[b].id&&(this._folderSelector._interractive=
!1,this._folderSelector.setValue(a[b].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){C[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(M,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?
"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(a){a=c.toUrl(a);return/^https?\:/i.test(a)?a:/^\/\//i.test(a)?ma+a:/^\//i.test(a)?ma+"//"+window.location.host+a:a},_getManeuverImage:function(a){return a?"esriDMTStop"===a||"esriDMTDepart"===a?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+a+".png"):""},_loadPrintDirections:function(b){var c=
this.get("printTemplate"),d=new N;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(d.resolve,d.reject):d.resolve();d.then(a.hitch(this,function(){if(!c&&this.directions){var a=this._getAbsoluteUrl("./css/Directions.css"),d=this._getAbsoluteUrl("./css/DirectionsPrint.css"),e=this._getAbsoluteUrl("./images/Directions/print-logo.png"),f;f=G.isBodyLtr()?"ltr":"rtl";c="";c+="\x3c!DOCTYPE HTML\x3e";c+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+
f+'"\x3e';c+="\x3chead\x3e";c+='\x3cmeta charset\x3d"utf-8"\x3e';c+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';c+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";c+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+a+'" /\x3e';c+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+d+'" /\x3e';c+="\x3c/head\x3e";c+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';c+='\x3cdiv class\x3d"'+
this._css.esriPrintBarClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+F.common.close+'" onclick\x3d"window.close();"\x3e'+F.common.close+"\x3c/div\x3e";c+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+F.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+F.widgets.directions.print+"\x3c/div\x3e";c+="\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';c+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+
'"\x3e';c+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+e+'" /\x3e';c+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+this.get("directions").routeName+"\x3c/div\x3e";c+=this._renderDirectionsSummary(this.directions);b&&(c+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',c+='\x3chr class\x3d"esriNoPrint"/\x3e');c+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';c+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+
this._css.esriPrintNotesClass+'" placeholder\x3d"'+F.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';c+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';c+="\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';c+=this._renderDirectionsTable(this.directions);c+="\x3c/div\x3e";c+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';c+="\x3cp\x3e"+F.widgets.directions.printDisclaimer+"\x3c/p\x3e";c+="\x3c/div\x3e";c+="\x3c/div\x3e";c+="\x3c/body\x3e";
c+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(c);this._printWindow.document.close()}))},_printDirections:function(){if(this.directions){var b=screen.width/2,d=screen.height/1.5,b="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+b+", height\x3d"+d+", top\x3d"+(screen.height/2-d/2)+", left\x3d"+(screen.width/2-b/2);this.get("printPage")?(window.directions=this.get("directions"),
window.open(this.get("printPage"),"directions_widget_print",b,!0)):(this._printWindow=window.open("","directions_widget_print",b,!0),this._loadPrintDirections(!!this._printService),this._printService&&c(["dojo/_base/window"],a.hitch(this,function(b){this.zoomToFullRoute().then(a.hitch(this,function(){this._printService.execute(this._printParams,a.hitch(this,function(a){b.withDoc(this._printWindow.document,function(){var b=k.byId("divMap");b&&(C.remove(b,"esriPrintWait"),C.add(b,"esriPageBreak"),M.create("img",
{src:a.url,"class":"esriPrintMapImg"},b))})}),a.hitch(this,function(a){b.withDoc(this._printWindow.document,function(){var a=k.byId("divMap");a&&C.remove(a,"esriPrintWait")})}))}))})))}},_enableButton:function(a,b){b=b||void 0===b;C[b?"remove":"add"].apply(this,[a,"esriDisabledDirectionsButton"]);a._enabled=b},_clearStopsStatusAttr:function(){for(var a=0;a<this.stops.length;a++)this.stops[a].feature&&this.stops[a].feature.attributes&&(this.stops[a].feature.attributes.Status=void 0)},_enableSharing:function(){var b=
new N;!this._naRouteSharing&&this.owningSystemUrl?c(["../tasks/NARouteSharing"],a.hitch(this,function(c){this._naRouteSharing=new c(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new l({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:a.hitch(this,function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),
this._folderSelector.startup(),this._outputLayer=new t({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:a.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:a.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),onBlur:a.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());
this._naRouteSharing.getFolders().then(a.hitch(this,function(c){for(var d=[],f=0;f<c.length;f++)d.push({id:c[f].url,folderId:c[f].id,label:c[f].title});this._folderSelector.setStore(new e({objectStore:new x({data:d})}));this._naRouteSharing.canCreateItem().then(a.hitch(this,function(a){this._folderSelector.set("disabled",!a);this._userCanCreatePortalItem=a}));this._enableButton(this._saveButton);b.resolve()}),a.hitch(this,function(a){this._naRouteSharing=null;this._toggleSaveMenu(!1);b.reject(a)}))})):
this.owningSystemUrl?b.resolve():(b.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return b.promise},_storeRouteUI:function(){var a=new N;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(a.resolve,a.reject):(this._outputLayer&&this._outputLayer.focus(),a.reject(Error("Need result layer name specified.")));
return a.promise},_storeRoute:function(b,c,d){var e=new N,f=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),e.reject(Error("Not ready to store route.")),e.promise;this.clearMessages();e.then(null,a.hitch(this,function(a){this._showMessage(F.widgets.directions.error.cantSaveRoute)}));e.promise.always(a.hitch(this,function(){this._enableButton(this._saveButton);E.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":
"none");this._showLoadingSpinner();this._savingRoute=!1}));if(f&&f.features&&f.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(b&&c){var g,h;g=a.hitch(this,function(a){return this._naRouteSharing.getAttributeUnits(a,this.serviceDescription)});h=this.routeParams.travelMode.timeAttributeName;var k=this.routeParams.travelMode.distanceAttributeName,l=g(h),m=g(k),n=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,
p=this._naRouteSharing.toMeters,q=this._naRouteSharing.toMinutes,t=function(a,b,c){var d,e;for(e in a)a.hasOwnProperty(e)&&0===e.indexOf(b)&&-1===u.indexOf(c,e.substr(b.length))&&(d=d||{},d[e.substr(b.length)]=a[e]);return d},r=[],H=[],I=[],v;if(h&&l&&k&&m){var w=[],x=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],z=this.serviceDescription.networkDataset.networkAttributes;for(g=0;g<z.length;g++)"esriNAUTCost"===z[g].usageType&&-1===u.indexOf(x,z[g].name)&&
z[g].name!==h&&z[g].name!==k&&w.push(z[g].name);var x=this.get("stops"),y={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(g=0;g<x.length;g++)if(x[g].feature&&x[g].feature.toJson){z=x[g].feature.toJson();v=z.attributes;var L=z.geometry,K=this._naRouteSharing.getUTCOffset(v.ArriveTime,v.ArriveTimeUTC),B=this._naRouteSharing.getUTCOffset(v.DepartTime,v.DepartTimeUTC);a.mixin(y,{xmin:y.xmin>L.x?L.x:y.xmin,ymin:y.ymin>L.y?L.y:y.ymin,xmax:y.xmax<L.x?L.x:y.xmax,ymax:y.ymax<L.y?L.y:y.ymax});
z.attributes={__OBJECTID:g+1,CurbApproach:v.CurbApproach,ArrivalCurbApproach:v.ArriveCurbApproach,DepartureCurbApproach:v.DepartCurbApproach,Name:v.Name===this._waypointName?F.widgets.directions.waypoint:v.Name===this._userDefinedStopName?x[g].name:v.Name,RouteName:f.routeName,Sequence:v.Sequence,Status:v.Status,LocationType:v.isWaypoint?1:0,TimeWindowStart:v.TimeWindowStart,TimeWindowEnd:v.TimeWindowEnd,TimeWindowStartUTCOffset:K,TimeWindowEndUTCOffset:K,ServiceMinutes:q(v["Attr_"+h],l),ServiceMeters:p(v["Attr_"+
k],m),ServiceCosts:O.stringify(t(v,"Attr_",w)),CumulativeMinutes:q(v["Cumul_"+h],l),CumulativeMeters:p(v["Cumul_"+k],m),CumulativeCosts:O.stringify(t(v,"Cumul_",w)),LateMinutes:q(v["Violation_"+h],l),WaitMinutes:q(v["Wait_"+h],l),ArrivalTime:this._naRouteSharing.toUTCTime(v.ArriveTime,K),DepartureTime:this._naRouteSharing.toUTCTime(v.DepartTime,B),ArrivalUTCOffset:K,DepartureUTCOffset:B};r.push(z)}k=0;m=function(a){try{a.strings=O.parse(a.strings)}catch(Aa){J.strings=void 0}if(a.strings&&a.strings.length)for(var b=
0;b<a.strings.length;b++)if("esriDSTGeneral"===a.strings[b].stringType)return a.strings[b].string};x=function(a,b){for(var c=[],d=0;d<(a||[]).length;d++)a[d].stringType!==b&&b||c.push(a[d].string);return c.length?c.toString():void 0};z=function(a){switch(a){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";
case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";
case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";
case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(g=0;g<f.featuresWithWaypoints.length;g++){var A=f.featuresWithWaypoints[g],L=A.toJson(),K=L.attributes,B=L.geometry&&L.geometry.paths&&L.geometry.paths[0]||[],C=L.geometry.hasM||!1||B[0]&&3===B[0].length;v=this._naRouteSharing.getUTCOffset(K.ETA,K.arriveTimeUTC);
L.attributes={__OBJECTID:g+1,Sequence:++k,StopID:function(){var a=void 0,b=A._associatedStopWithReturnToStart&&A._associatedStopWithReturnToStart.attributes.Sequence;if(b)for(var c=0;c<r.length;c++)if(r[c].attributes.Sequence===b){a=r[c].attributes.__OBJECTID;break}return a}(),DirectionPointType:z(K.maneuverType),DisplayText:A._associatedStopWithReturnToStart&&A._associatedStopWithReturnToStart.attributes.isWaypoint?K.text.replace(this._waypointName,F.widgets.directions.waypoint):K.text,ArrivalTime:this._naRouteSharing.toUTCTime(K.ETA,
v),ArrivalUTCOffset:v,Azimuth:void 0,Name:x(f.stringsWithWaypoints[g],"esriDSTStreetName"),AlternateName:x(f.stringsWithWaypoints[g],"esriDSTAltName"),ExitName:x(f.stringsWithWaypoints[g],"esriDSTExit"),IntersectingName:x(f.stringsWithWaypoints[g],"esriDSTCrossStreet"),BranchName:x(f.stringsWithWaypoints[g],"esriDSTBranch"),TowardName:x(f.stringsWithWaypoints[g],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete L.symbol;delete L.infoTemplate;B.length?(L.geometry=
{x:B[0][0],y:B[0][1],spatialReference:L.geometry.spatialReference},C&&a.mixin(L.geometry,{m:B[0][2]})):delete L.geometry;H.push(L);L=A.toJson();K=L.attributes;B=L.geometry&&L.geometry.paths&&L.geometry.paths[0]||[];v=!0;for(h=0;h<B.length-1;h++)if(B[h][0]!==B[h+1][0]||B[h][1]!==B[h+1][1]){v=!1;break}v||(L.attributes={DirectionPointID:g+1,DirectionLineType:"esriDLTSegment",Meters:p(K.length,n),Minutes:q(K.time,l),FromLevel:void 0,ToLevel:void 0},L.geometry.hasM=C,delete L.symbol,delete L.infoTemplate,
I.push(L));var J=f.eventsWithWaypoints[L.attributes.Sequence]||[];for(h=0;h<J.length;h++)L=J[h].toJson(),K=L.attributes,v=this._naRouteSharing.getUTCOffset(K.ETA,K.arriveTimeUTC),L.attributes={Sequence:++k,DirectionPointType:"esriDPTEvent",DisplayText:m(K),ArrivalTime:this._naRouteSharing.toUTCTime(K.ETA,v),ArrivalUTCOffset:v,Name:K.strings},H.push(L)}h=this.routeParams.barriers&&this.routeParams.barriers.features||[];var D=[];for(g=0;g<h.length;g++)k=h[g].toJson(),m=k.attributes,k.attributes={BarrierType:m.BarrierType||
0,FullEdge:m.FullEdge||!1,AddedCost:m["Attr_"+this._getImpedanceAttribute().name]||0,Costs:O.stringify(t(m,"Attr_",w)),CurbApproach:m.CurbApproach||0,Name:m.Name},D.push(k);h=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var T=[];for(g=0;g<h.length;g++)k=h[g].toJson(),m=k.attributes,k.attributes={BarrierType:m.BarrierType||0,ScaleFactor:m["Attr_"+this._getImpedanceAttribute().name]||1,Costs:O.stringify(t(m,"Attr_",w)),Name:m.Name},T.push(k);h=this.routeParams.polygonBarriers&&
this.routeParams.polygonBarriers.features||[];var X=[];for(g=0;g<h.length;g++)k=h[g].toJson(),m=k.attributes,k.attributes={BarrierType:m.BarrierType||0,ScaleFactor:m["Attr_"+this._getImpedanceAttribute().name]||1,Costs:O.stringify(t(m,"Attr_",w)),Name:m.Name},X.push(k);var fa={geometry:f.mergedGeometry,attributes:{RouteName:f.routeName,TotalMinutes:q(f.totalTime,l),TotalMeters:p(f.totalLength,n),TotalLateMinutes:function(){for(var a=0,b=0;b<r.length;b++)a+=r[b].attributes.LateMinutes||0;return a}(),
TotalWaitMinutes:function(){for(var a=0,b=0;b<r.length;b++)a+=r[b].attributes.WaitMinutes||0;return a}(),TotalCosts:r[r.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?r[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?r[r.length-1].attributes.DepartureTime:null,StartUTCOffset:r[0].attributes.ArrivalUTCOffset,EndUTCOffset:r[r.length-1].attributes.DepartureUTCOffset,Messages:O.stringify(this._solverMessages),AnalysisSettings:O.stringify({travelMode:a.hitch(this,
function(){var b=a.clone(this.routeParams.travelMode);"\x26lt;"===b.name.substr(0,4)&&"\x26gt;"===b.name.substr(b.name.length-4,4)&&(b.name=b.name.substr(4,b.name.length-8));return b})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,
accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);a.hitch(this,function(){var b=new N;this._printService?this.zoomToFullRoute().then(a.hitch(this,function(){var a=this._printParams.template,c=a.exportOptions;a.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(d){a.exportOptions=c;b.resolve(d.url)},
function(d){a.exportOptions=c;b.resolve()})})):b.resolve();return b.promise})().then(a.hitch(this,function(g){var h={folder:c,name:b,stops:r,directionPoints:H,directionLines:I,barriers:D,polylineBarriers:T,polygonBarriers:X,extent:a.mixin(a.clone(f.extent),{xmin:y.xmin>f.extent.xmin?f.extent.xmin:y.xmin,ymin:y.ymin>f.extent.ymin?f.extent.ymin:y.ymin,xmax:y.xmax<f.extent.xmax?f.extent.xmax:y.xmax,ymax:y.ymax<f.extent.ymax?f.extent.ymax:y.ymax}),routeInfo:fa,thumbnail:g};this._userCanCreatePortalItem?
this._naRouteSharing.store(h,this.routeLayer.itemId,"1.0.0").then(a.hitch(this,function(b){if(b.success){var c=this._naRouteSharing.portal,c="//"+(c.isPortal?c.portalHostname:c.urlKey+"."+c.customBaseUrl);this._toggleSaveMenu();this._showMessage(F.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+c+"/home/item.html?id\x3d"+b.id+"'\x3e"+F.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(b.id);else this.onRouteItemCreated(b.id);
a.mixin(this.routeLayer,{itemId:b.id,title:h.name,isItemOwner:!0,ownerFolder:d});e.resolve(b)}else e.reject(b)}),e.reject):this._naRouteSharing.createFeatureCollection(h,"1.0.0").then(a.hitch(this,function(a){e.resolve(a);this._toggleSaveMenu();this.onFeatureCollectionCreated(a)}),e.reject)}))}else e.reject(Error("Cannot deduce the impedance used."))}else e.reject(Error("Missing required parameter: layerName, folder must be specified."));else e.reject(Error("Shared route must be built using a Travel Mode."));
else e.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else e.reject(Error("No route to share. Build a route first."));return e.promise},_loadRoute:function(b){var c=new N;c.promise.always(a.hitch(this,function(){this._showLoadingSpinner(!1);E.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(a.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(a.hitch(this,function(){var d=a.clone(this.serviceDescription),f=a.hitch(this,function(c){a.mixin(this.routeLayer,{itemId:b,title:c.title,isItemOwner:c.isItemOwner,ownerFolder:c.ownerFolder})}),g,h,k,l;d.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(b,d).then(a.hitch(this,function(b){if(b.routeParameters){a.mixin(this.routeParams,b.routeParameters);this.routeParams.accumulateAttributes=
b.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var m=b.routeParameters.travelMode,n=m?this._getCostAttribute(m.impedanceAttributeName):void 0,n=n?this._isTimeUnits(n.units)?"Time":"Distance":"";l=d.supportedTravelModes&&d.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=
1!==b.successCode&&n){var p="AUTOMOBILE"===m.type?"Driving":"TRUCK"===m.type?"Trucking":"WALK"===m.type?"Walking":"Other";m.name="\x26lt;"+m.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(d.supportedTravelModes||[]).concat(m);l.push({id:m.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+p+n+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+m.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new e({objectStore:new x({data:l})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(m.name)}else{n=!1;if(m&&m.name)for(l=d.supportedTravelModes||[],g=0;g<l.length;g++)if(l[g].name===m.name){n=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(m.name);this.routeParams.travelMode=l[g].impedanceAttributeName?l[g]:l[g].itemId;b.loadMessages.push({message:F.widgets.directions.error.tmFromPortalSameName+" "+m.name,messageType:"Warning"});break}if(!n)if((m=d.defaultTravelMode)&&l)for(g=
0;g<l.length;g++){if(l[g].id===m){this.routeParams.travelMode=l[g].impedanceAttributeName?l[g]:l[g].itemId;b.loadMessages.push({message:F.widgets.directions.error.tmFromPortalDefault+" "+(l[g].name?l[g].name:l[g].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(b.solveResult&&b.solveResult.routeResults){var q,t=Infinity,r,u=-Infinity,m=b.solveResult.routeResults[0].stops,v=b.solveResult.routeResults[0].directions.features,n={};for(g=
0;g<m.length;g++){var I=m[g].attributes;if(I.isWaypoint)for(h=0;h<v.length;h++)p=v[h].attributes,p._stopSequence===I.Sequence&&(p.text=p.text.replace(I.Name,this._waypointName));k=I.Name+"_"+this._stopSequence++;n[k]=I.isWaypoint?this._waypointName:I.Name;I.Name=k;I.Sequence<t&&(null!==I.ArriveCurbApproach||null!==I.DepartCurbApproach)&&(q=I.Name,t=I.Sequence);I.Sequence>u&&(null!==I.ArriveCurbApproach||null!==I.DepartCurbApproach)&&(r=I.Name,u=I.Sequence)}k=q+" - "+r;b.solveResult.routeResults[0].routeName=
k;b.solveResult.routeResults[0].directions.routeName=k;for(g=0;g<v.length;g++)if(p=v[g].attributes,void 0!==p._stopSequence)for(h=0;h<m.length;h++)if(p._stopSequence===m[h].attributes.Sequence){k=m[h].attributes.Name;p.text=(p.text||"").replace(n[k],k);delete p._stopSequence;break}q=m[m.length-1];m[0].geometry.x===q.geometry.x&&m[0].geometry.y===q.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new H(q.geometry,null,q.attributes),n[q.attributes.Name]),this.set("returnToStart",!0));
this._solveResultProcessing(b.solveResult,n).then(a.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);f(b);this.zoomToFullRoute();c.resolve(b)}),c.reject)}else{if(b.routeParameters){q=b.routeParameters.stops.features;this.stops=[];for(g=0;g<q.length;g++)this.stops.push(this._addStopWrapperToGraphic(q[g],q[g].attributes.Name)),this._updateStop(this.stops[g],g);this._setStops();b.loadMessages.push({message:F.widgets.directions.routeLayerStopsOnly,messageType:"Warning"})}else b.loadMessages.push({message:F.widgets.directions.routeLayerEmpty,
messageType:"Warning"});f(b);c.resolve(b)}for(g=0;g<b.loadMessages.length;g++)this._showMessage(b.loadMessages[g].message)}),a.hitch(this,function(a){c.reject(a);this._showMessage("GWM_0003"===a.messageCode?F.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:F.widgets.directions.error.loadError)}))}),c.reject)}),c.reject);return c.promise}});a.setObject("dijit.Directions",b,K);return b})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),
function(c,b,a,n,u,v){return c("dijit.MenuSeparator",[a,n,u],{templateString:v,buildRendering:function(){this.inherited(arguments);b.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),function(c,b,a,n,u,v,h,f,l,t,p,w){c=c([l,w],{declaredClass:"esri.tasks.RouteTask",
_eventMap:{"solve-complete":["result"]},constructor:function(a){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=b.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(b,c,f,g,d){try{var e=[],h=[],l=b.directions||[],m=b.routes?b.routes.features:[],n=b.stops?b.stops.features:[],u=b.barriers?b.barriers.features:[],w=b.polygonBarriers?
b.polygonBarriers.features:[],x=b.polylineBarriers?b.polylineBarriers.features:[],F=b.messages,T=a.forEach,B=a.indexOf,M=!0,U,N,Q=b.routes&&b.routes.spatialReference||b.stops&&b.stops.spatialReference||b.barriers&&b.barriers.spatialReference||b.polygonBarriers&&b.polygonBarriers.spatialReference||b.polylineBarriers&&b.polylineBarriers.spatialReference;this._chk=b.checksum;T(l,function(a){e.push(U=a.routeName);h[U]={directions:a}});T(m,function(a){-1===B(e,U=a.attributes.Name)&&(e.push(U),h[U]={});
h[U].route=a});T(n,function(a){N=a.attributes;-1===B(e,U=N.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(e.push(U),h[U]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==U&&(M=!1);void 0===h[U].stops&&(h[U].stops=[]);h[U].stops.push(a)});0<n.length&&!0===M&&(h[e[0]].stops=h["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete h["esri.tasks.RouteTask.NULL_ROUTE_NAME"],e.splice(a.indexOf(e,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var O=[];T(e,function(a,b){h[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===
a?null:a;h[a].spatialReference=Q;O.push(new t(h[a]))});b=function(a){T(a,function(b,c){b.geometry&&(b.geometry.spatialReference=Q);a[c]=new v(b)});return a};T(F,function(a,b){F[b]=new p(a)});var K={routeResults:O,barriers:b(u),polygonBarriers:b(w),polylineBarriers:b(x),messages:F};this._successHandler([K],"onSolveComplete",f,d)}catch(I){this._errorHandler(I,g,d)}},solve:function(a,c,f,g){var d=g.assembly;a=this._encode(b.mixin({},this._url.query,{f:"json"},a.toJson(d&&d[0]),this._chk?{checksum:this._chk}:
{}));var e=this._handler,k=this._errorHandler;return h({url:this._url.path,timeout:25E4,content:a,callbackParamName:"callback",load:function(a,b){e(a,b,c,f,g.dfd)},error:function(a){k(a,f,g.dfd)}})},onSolveComplete:function(){}});f._createWrappers(c);b.setObject("tasks.RouteTask",c,u);return c})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.tasks.RouteResult",
constructor:function(b){var c=b.spatialReference,f=b.route;if(b.directions){var n=[],u=[],x=[];a.forEach(b.directions.features,function(a,b){u[b]=a.compressedGeometry;n[b]=a.strings;x[b]=a.events});b.directions.strings=n;b.directions.events=x;this.directions=new h(b.directions,u)}this.routeName=b.routeName;f&&(f.geometry&&(f.geometry.spatialReference=c),this.route=new v(f));if(b.stops){var e=this.stops=[];a.forEach(b.stops,function(a,b){a.geometry&&(a.geometry.spatialReference=c);e[a.attributes.Sequence-
1]=new v(a)})}},routeName:null,directions:null,route:null,stops:null});b.setObject("tasks.RouteResult",c,u);return c})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(c,b,a,n,u,v,h,f,l,t,p){c=c(p,{declaredClass:"esri.tasks.DirectionsFeatureSet",constructor:function(c,f){this.routeId=c.routeId;this.routeName=c.routeName;
b.mixin(this,c.summary);this.extent=new h(this.envelope);var e=this._fromCompressedGeometry,m=this.features,g=this.extent.spatialReference,d=[];a.forEach(f,function(a,b){m[b].setGeometry(d[b]=a?e(a,g):m[b].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(d,g);this.geometryType="esriGeometryPolyline";a.forEach(c.events,function(b,d){a.forEach(b,function(a,c){b[c]=new t(new l(a.point.x,a.point.y,g),null,{ETA:a.ETA,strings:u.stringify(a.strings),arriveTimeUTC:a.arriveTimeUTC})});c.events[d]=
b});delete this.envelope},_fromCompressedGeometry:function(b,c){var e=0,h=0,g=0,d=0,l=[],k,n,p,t,u,v=0,w=0,x=0;(b=b.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(b=[]);0===parseInt(b[v],32)?(v=2,k=parseInt(b[v],32),v++,p=parseInt(b[v],32),v++,k&1&&(w=a.indexOf(b,"|")+1,t=parseInt(b[w],32),w++),k&2&&(x=a.indexOf(b,"|",w)+1,u=parseInt(b[x],32),x++)):(p=parseInt(b[v],32),v++);for(;v<b.length&&"|"!==b[v];)k=parseInt(b[v],32)+e,v++,e=k,n=parseInt(b[v],32)+h,v++,h=n,k=[k/p,n/p],w&&(n=parseInt(b[w],32)+g,w++,g=n,
k.push(n/t)),x&&(n=parseInt(b[x],32)+d,x++,d=n,k.push(n/u)),l.push(k);e=new f({paths:[l],hasZ:0<w,hasM:0<x});e.setSpatialReference(c);return e},_mergePolylinesToSinglePath:function(b,c){var e=[],h=!1;a.forEach(b,function(b){a.forEach(b.paths,function(a){h=h||b.hasM;e=e.concat(a)})});var g=[],d=[0,0];a.forEach(e,function(a){if(a[0]!==d[0]||a[1]!==d[1])g.push(a),d=a});return new f({paths:[g],spatialReference:c,hasM:h})}});b.setObject("tasks.DirectionsFeatureSet",c,v);return c})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(c,b,a,n){c=c(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(a){b.mixin(this,a)}});b.mixin(c,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});b.setObject("tasks.NAMessage",c,n);return c})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(c,
b,a,n,u){return c(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(c,h){var f=new a;if(this._sd)f.resolve(this._sd);else if(this._url&&this._url.orig){var l=this._url.orig,t=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",p,v=function(a){u({url:a+("/"===a[a.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:t},callbackParamName:"callback"}).then(function(a){var c=
[],e=null;if(a&&a.results&&a.results.length)for(var d=0;d<a.results.length;d++)if("supportedTravelModes"===a.results[d].paramName){if(a.results[d].value&&a.results[d].value.features)for(var h=0;h<a.results[d].value.features.length;h++)if(a.results[d].value.features[h].attributes){var k=b.parse(a.results[d].value.features[h].attributes.TravelMode);c.push(k)}}else"defaultTravelMode"===a.results[d].paramName&&(e=a.results[d].value);p.supportedTravelModes=c;p.defaultTravelMode=e;f.resolve(p)},function(a){f.reject(a)})};
u({url:l,content:{f:"json"},callbackParamName:"callback"}).then(function(a){p=a;p.supportedTravelModes||(p.supportedTravelModes=[]);for(a=0;a<p.supportedTravelModes.length;a++)p.supportedTravelModes[a].id||(p.supportedTravelModes[a].id=p.supportedTravelModes[a].itemId);h?f.resolve(p):c?v(c):10.4<=p.currentVersion?u({url:l+("/"===l[l.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(a){p.supportedTravelModes=a.supportedTravelModes;p.defaultTravelMode=
a.defaultTravelMode;f.resolve(p)},function(a){f.reject(a)}):u({url:l.substring(0,l.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(a){a.owningSystemUrl?(l=a.owningSystemUrl,u({url:l+("/"===l[l.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(a){a&&a.helperServices&&a.helperServices.routingUtilities&&a.helperServices.routingUtilities.url?v(a.helperServices.routingUtilities.url):f.resolve(p)},function(a){f.reject(a)})):
f.resolve(p)},function(a){f.reject(a)})},function(a){f.reject(a)})}else f.reject("NA Task has no URL specified.");f.then(n.hitch(this,function(a){this._sd=a}),n.hitch(this,function(){this._sd=null}));return f.promise},getOwningSystemUrl:function(){var b=new a;if(this._url&&this._url.orig){var c=this._url.orig;u({url:c.substring(0,c.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(a){b.resolve(a.owningSystemUrl)})}else b.resolve(void 0);return b.promise}})})},
"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(c,b,a,n,u,v,h,f){c=c(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,
ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,
stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(b){var c={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&a.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||
a.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,
impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:f.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,
travelMode:"object"===typeof this.travelMode?a.toJson(this.travelMode):this.travelMode},l=this.stops;"esri.tasks.FeatureSet"===l.declaredClass&&0<l.features.length?c.stops=a.toJson({type:"features",features:h._encodeGraphics(l.features,b&&b["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===l.declaredClass?c.stops=l:"esri.tasks.DataFile"===l.declaredClass&&(c.stops=a.toJson({type:"features",url:l.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":c.directionsOutputType="esriDOTComplete";break;case "complete-no-events":c.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":c.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":c.directionsOutputType="esriDOTStandard";break;case "summary-only":c.directionsOutputType="esriDOTSummaryOnly";break;default:c.directionsOutputType=this.directionsOutputType}l=function(c,
f){return c?"esri.tasks.FeatureSet"===c.declaredClass?0<c.features.length?a.toJson({type:"features",features:h._encodeGraphics(c.features,b&&b[f])}):null:"esri.tasks.DataLayer"===c.declaredClass?c:"esri.tasks.DataFile"===c.declaredClass?a.toJson({type:"features",url:c.url}):a.toJson(c):null};this.barriers&&(c.barriers=l(this.barriers,"barriers.features"));this.polygonBarriers&&(c.polygonBarriers=l(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(c.polylineBarriers=l(this.polylineBarriers,
"polylineBarriers.features"));return v.filter(c,function(a){if(null!==a)return!0})}});b.setObject("tasks.RouteParameters",c,u);return c})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(c,b,a){b={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"};var n={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",
TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},u={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},v={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},h={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},f={LengthUnit:b,OutputLine:n,
UTurn:u,OutputPolygon:v,TravelDirection:h};c.setObject("tasks._NALengthUnit",b,a);c.setObject("tasks.NAOutputLine",n,a);c.setObject("tasks.NAUTurn",u,a);c.setObject("tasks.NAOutputPolygon",v,a);c.setObject("tasks.NATravelDirection",h,a);return f})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F,T,B,M,U,N,Q){b=b("esri.dijit.Geocoder",[F,y,G],{templateString:e,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(b,d){g.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new J(c.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};b=a.mixin({},this.options,b);this.set("autoComplete",b.autoComplete);this.set("arcgisGeocoder",b.arcgisGeocoder);this.set("value",b.value);this.set("theme",
b.theme);this.set("activeGeocoderIndex",b.activeGeocoderIndex);this.set("maxLocations",b.maxLocations);this.set("minCharacters",b.minCharacters);this.set("searchDelay",b.searchDelay);this.set("geocoderMenu",b.geocoderMenu);this.set("autoNavigate",b.autoNavigate);this.set("showResults",b.showResults);this.set("map",b.map);this.set("activeGeocoder",b.activeGeocoder);this.set("geocoders",b.geocoders);this.set("zoomScale",b.zoomScale);this.set("highlightLocation",b.highlightLocation);this.set("symbol",
b.symbol);this.set("graphicsLayer",b.graphicsLayer);this.set("results",[]);this._i18n=x;this._deferreds=[];this._defaultSR=new D(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=d},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else p.once(this.get("map"),"load",a.hitch(this,function(){this._init()}));else this._init();else this.destroy();else this.destroy()},postCreate:function(){this.inherited(arguments);this.own(p(this.submitNode,d,a.hitch(this,this._findThenSelect)));this.own(p(this.geocoderMenuArrowNode,d,a.hitch(this,this._toggleGeolocatorMenu)));this.own(p(this.inputNode,
d,a.hitch(this,this._inputClick)));this.own(p(this.clearNode,d,a.hitch(this,this.clear)));this.own(p(this.geocoderMenuCloseNode,d,a.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();l.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var a=this.get("highlightGraphic"),b=this.get("graphicsLayer");a&&(b?b.remove(a):this.get("map").graphics.remove(a),
this.set("highlightGraphic",null));v.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);h.remove(this.containerNode,this._css.hasValueClass);v.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){f.set(this.domNode,"display","block")},hide:function(){f.set(this.domNode,"display","none")},find:function(b){var c=new n;if(b)if("string"===typeof b)this._findQuery(b).then(function(a){c.resolve(a)});else if("object"===typeof b&&b.hasOwnProperty("geometry")){var d;
switch(b.geometry.type){case "extent":d=b.geometry.getCenter();break;case "multipoint":d=b.geometry.getExtent().getCenter();break;case "point":d=b.geometry;break;case "polygon":d=b.geometry.getExtent().getCenter();break;case "polyline":d=b.geometry.getExtent().getCenter()}d&&this._reverseGeocodePoint(d,b.geometry).then(function(d){d.results[0]&&(b.hasOwnProperty("attributes")&&d.results[0].feature.setAttributes(a.mixin(d.results[0].feature.attributes,b.attributes)),b.hasOwnProperty("infoTemplate")&&
d.results[0].feature.setInfoTemplate(b.infoTemplate),b.hasOwnProperty("symbol")&&d.results[0].feature.setSymbol(b.symbol));c.resolve(d)},function(a){c.reject(a)})}else"object"===typeof b&&"point"===b.type?this._reverseGeocodePoint(b).then(function(a){c.resolve(a)},function(a){c.reject(a)}):b instanceof Array&&2===b.length?(d=new T(b,new D({wkid:4326})),this._reverseGeocodePoint(d).then(function(a){c.resolve(a)},function(a){c.reject(a)})):c.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(a){c.resolve(a)});
return c.promise},focus:function(){k.focus(this.inputNode);var a=this.get("map");a&&a.disableKeyboardNavigation()},blur:function(){k.curNode&&k.curNode.blur();this.inputNode.blur();this._hideMenus();var a=this.get("map");a&&a.enableKeyboardNavigation()},select:function(a){this.onSelect(a);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&a&&a.hasOwnProperty("extent")&&this.get("map")&&this.get("map").setExtent(a.extent);if(a.feature){var b=this.get("highlightGraphic"),c=this.get("graphicsLayer"),
d=this.get("symbol")||a.feature.symbol;b?(b.setGeometry(a.feature.geometry),b.setAttributes(a.feature.attributes),b.setInfoTemplate(a.feature.infoTemplate),b.setSymbol(d)):(b=a.feature,this.get("highlightLocation")&&(b.setSymbol(d),c?c.add(b):this.get("map").graphics.add(b)));this.set("highlightGraphic",b)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();
this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var b=this.get("activeGeocoder"),c=this.reHostedFS.test(b.url);("query"!==b.type||c)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(a.hitch(this,function(a){this.onAutoComplete(a);this.get("showResults")&&this._showResults(a)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<
a.charCodeAt(b))return!0;return!1},_findQuery:function(b){var c=new n;this._query({delay:0,search:b}).then(a.hitch(this,function(a){this.onFindResults(a);c.resolve(a)}),a.hitch(this,function(a){this.onFindResults(a);c.reject(a)}));return c.promise},_reverseGeocodePoint:function(b,c){var d=new n;if(b&&this.get("activeGeocoder")){var e=c||b;c=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);
this._task.locationToAddress(b,c,a.hitch(this,function(a){a={results:[this._hydrateResult(a)],geometry:e};this.onFindResults(a);d.resolve(a)}),a.hitch(this,function(a){d.reject(a)}))}else d.reject("Geocoder:: no point or active geocoder defined");return d.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=
!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=C.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=x.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",
this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new N(this.get("activeGeocoder").url):new M(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var a=[];this.get("arcgisGeocoder")&&(a=a.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(a=a.concat(this.get("geocoders")));this._geocoders=
a},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);v.set(this.inputNode,"placeholder",this._placeholder);v.set(this.submitNode,"title",this._placeholder)},_updateValue:function(a,b,c){this._ignoreUpdateValue||
(v.set(this.inputNode,"value",c),this._checkStatus())},_updateTheme:function(a,b,c){h.remove(this.domNode,b);h.add(this.domNode,c)},_setActiveGeocoderIndex:function(a,b,c){this.set("activeGeocoderIndex",c);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();a={attr:this.get("activeGeocoder"),oldVal:b,newVal:c};this.onGeocoderSelect(a)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(b){b||(b={delay:0});b.search||(b.search=this.get("value"));
var c=new n;this._deferreds.push(c);b.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(a.hitch(this,function(){this._performTask(c,b)}),b.delay)):this._performTask(c,b);return c.promise},_performTask:function(b,c){if(c.search){this._hideGeolocatorMenu();this._showLoading();var d="";this.get("activeGeocoder").prefix&&(d+=this.get("activeGeocoder").prefix);d+=c.search;this.get("activeGeocoder").suffix&&(d+=this.get("activeGeocoder").suffix);var e=this.get("activeGeocoder").outFields;e&&
(e instanceof Array||(e=[e]));var f=this.get("maxLocations")||6,g=this.get("activeGeocoder").searchExtent,h=this._defaultSR;this.get("map")&&(h=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var k=new U;k.outSpatialReference=h;k.returnGeometry=!0;k.num=f;g&&(k.geometry=g);f=this.get("activeGeocoder").exactMatch;g=this.get("activeGeocoder").field;h="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(d)&&(h="N");k.where=f?g+" \x3d "+
h+"'"+d+"'":"UPPER("+g+") LIKE "+h+"'%"+d.toUpperCase()+"%'";e&&(k.outFields=e);this._task.execute(k,a.hitch(this,function(a){this._receivedResults(a.features,b,c)}),a.hitch(this,function(a){this._receivedResults([],b,c)}))}else k={},this.get("activeGeocoder").categories&&(k.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=h,this.get("map")&&this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&
(h=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||h&&h<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(k.location=this.get("map").extent.getCenter(),k.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&c.autoComplete?(k.text=d,g&&(k.searchExtent=g),this._task.suggestLocations(k).then(a.hitch(this,function(a){this._receivedResults(a,b,c)}),a.hitch(this,function(a){this._receivedResults(a,b,
c)}))):(k.address={},k.maxLocations=f,g&&(k.searchExtent=g),this.get("activeGeocoder").sourceCountry&&(k.countryCode=this.get("activeGeocoder").sourceCountry),c.magicKey&&(k.magicKey=c.magicKey),this.get("activeGeocoder").singleLineFieldName?k.address[this.get("activeGeocoder").singleLineFieldName]=d:k.address["Single Line Input"]=d,e&&(k.outFields=e),this._task.addressToLocations(k,a.hitch(this,function(a){this._receivedResults(a,b,c)}),a.hitch(this,function(a){this._receivedResults(a,b,c)})))}else this._hideLoading(),
b.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var a="";if(this.get("results")&&this.get("results").length&&this.resultsNode){for(var b=this.get("value"),c=new RegExp("("+b+")","gi"),a=a+'\x3cul role\x3d"presentation"\x3e',b=0;b<this.get("results").length&&5>b;++b){var d=this.get("results")[b].text||this.get("results")[b].name,e=this._css.resultsItemClass+" ",e=0===b%2?e+this._css.resultsItemOddClass:e+this._css.resultsItemEvenClass;0===b?e+=" "+this._css.resultsItemFirstClass:
b===this.get("results").length-1&&(e+=" "+this._css.resultsItemLastClass);a+='\x3cli title\x3d"'+d+'" data-text\x3d"'+d+'" data-item\x3d"true" data-index\x3d"'+b+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+e+'"\x3e'+d.replace(c,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}a+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=a);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=a),
this._hideResultsMenu()},_receivedResults:function(a,b){this._hideLoading();a=this._hydrateResults(a);this.set("results",a);a={results:a,value:this.get("value")};b.resolve(a)},_showLoading:function(){h.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){h.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){h.add(this.containerNode,this._css.activeMenuClass);h.add(this.domNode,this._css.GeocoderMenuOpenClass);f.set(this.geocoderMenuNode,"display","block");
v.set(this.geocoderMenuInsertNode,"aria-hidden","false");v.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){h.remove(this.containerNode,this._css.activeMenuClass);h.remove(this.domNode,this._css.GeocoderMenuOpenClass);f.set(this.geocoderMenuNode,"display","none");v.set(this.geocoderMenuInsertNode,"aria-hidden","true");v.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===f.get(this.geocoderMenuNode,
"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){h.add(this.containerNode,this._css.GeocoderActiveClass);h.add(this.domNode,this._css.GeocoderResultsOpenClass);f.set(this.resultsNode,"display","block");v.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){f.set(this.resultsNode,"display","none");h.remove(this.containerNode,this._css.GeocoderActiveClass);h.remove(this.domNode,this._css.GeocoderResultsOpenClass);v.set(this.resultsNode,
"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var a,b="",c;a='\x3cul role\x3d"presentation"\x3e';for(c=0;c<this._geocoders.length;c++){b=this._css.resultsItemClass+" ";b=0===c%2?b+this._css.resultsItemOddClass:b+this._css.resultsItemEvenClass;c===this.get("activeGeocoderIndex")&&(b+=" "+this._css.geocoderSelectedClass);0===c?b+=" "+this._css.resultsItemFirstClass:
c===this._geocoders.length-1&&(b+=" "+this._css.resultsItemLastClass);var d=this._geocoders[c].name||x.widgets.Geocoder.main.untitledGeocoder;a+='\x3cli data-index\x3d"'+c+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+b+'"\x3e';a+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';a+=d;a+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';a+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=a+"\x3c/ul\x3e";this._geocoderMenuEvent();
f.set(this.geocoderMenuNode,"display","none");f.set(this.geocoderMenuArrowNode,"display","block");h.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",f.set(this.geocoderMenuNode,"display","none"),f.set(this.geocoderMenuArrowNode,"display","none"),h.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(h.add(this.containerNode,this._css.hasValueClass),v.set(this.clearNode,"title",x.widgets.Geocoder.main.clearButtonTitle)):
this.clear()},_autoCompleteEvent:function(){var b=w('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=p(b,"click, keydown",a.hitch(this,function(c){this._clearQueryTimeout();var d=parseInt(v.get(c.currentTarget,"data-index"),10),e=v.get(c.currentTarget,"data-text");"click"===c.type||"keydown"===c.type&&c.keyCode===t.ENTER?(v.set(this.inputNode,"value",e),this.set("value",e),this.get("results")&&this.get("results")[d]&&(c=this.get("results")[d],c.name?this.select(c):
this._query({delay:0,search:c.text,magicKey:c.magicKey||null}).then(a.hitch(this,function(a){this.select(a.results[0])})))):"keydown"!==c.type||c.keyCode!==t.BACKSPACE&&c.keyCode!==t.DELETE?"keydown"===c.type&&c.keyCode===t.UP_ARROW?(u.stop(c),c=d-1,0>c?this.inputNode.focus():b[c].focus()):"keydown"===c.type&&c.keyCode===t.DOWN_ARROW?(u.stop(c),c=d+1,c>=b.length?this.inputNode.focus():b[c].focus()):c.keyCode===t.ESCAPE&&this._hideMenus():(u.stop(c),this.inputNode.focus(),c=this.inputNode.value.slice(0,
-1),v.set(this.inputNode,"value",c),this.set("value",c))}))},_geocoderMenuEvent:function(){var b=w('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=p(b,"click, keydown",a.hitch(this,function(a){var c=parseInt(v.get(a.currentTarget,"data-index"),10);"click"===a.type||"keydown"===a.type&&a.keyCode===t.ENTER?(this._setActiveGeocoderIndex(null,null,c),this._hideGeolocatorMenu()):"keydown"===a.type&&a.keyCode===t.UP_ARROW?(u.stop(a),a=c-1,0>a?this.geocoderMenuArrowNode.focus():
b[a].focus()):"keydown"===a.type&&a.keyCode===t.DOWN_ARROW?(u.stop(a),a=c+1,a>=b.length?this.geocoderMenuArrowNode.focus():b[a].focus()):a.keyCode===t.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var a;if(this._events&&this._events.length)for(a=0;a<this._events.length;a++)this._events[a].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var b=p(document,"click",a.hitch(this,function(a){this._hideResultsMenu(a)}));
this._events.push(b);b=p(this.inputNode,"keyup",a.hitch(this,function(a){this._inputKeyUp(a)}));this._events.push(b);b=p(this.inputNode,"keydown",a.hitch(this,function(a){this._inputKeyDown(a)}));this._events.push(b);b=p(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(b);this.get("map")&&(b=p(this.get("map"),"mouse-down",a.hitch(this,function(){this.blur()})),this._events.push(b));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(a.hitch(this,
function(a){a.results&&a.results.length&&(this.select(a.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(a){if(a){this._clearQueryTimeout();var b=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",b);this._ignoreUpdateValue=!1;var c=0;b&&(c=b.length);if(a.ctrlKey||a.metaKey||a.altKey||a.keyCode===t.copyKey||a.keyCode===t.ALT||a.keyCode===t.CTRL||a.keyCode===t.META||a.keyCode===t.SHIFT||a.keyCode===t.UP_ARROW||a.keyCode===t.DOWN_ARROW||a.keyCode===t.LEFT_ARROW||a.keyCode===
t.RIGHT_ARROW)return a;a&&a.keyCode===t.ENTER?(this._cancelDeferreds(),this._findThenSelect()):a&&a.keyCode===t.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===t.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&c>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var a=0;a<this._deferreds.length;a++)this._deferreds[a].cancel("Geocoder:: stop query");this._deferreds=
[]}},_inputKeyDown:function(a){var b=w('[data-item\x3d"true"]',this.resultsNode);a&&a.keyCode===t.TAB?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===t.UP_ARROW?(u.stop(a),(a=b.length)&&b[a-1].focus()):a&&a.keyCode===t.DOWN_ARROW&&(u.stop(a),b[0]&&b[0].focus())},_geocoderMenuButtonKeyDown:function(a){var b=w('[data-item\x3d"true"]',this.geocoderMenuInsertNode);a&&a.keyCode===t.UP_ARROW?(u.stop(a),this._showGeolocatorMenu(),(a=b.length)&&b[a-1].focus()):a&&a.keyCode===t.DOWN_ARROW&&(u.stop(a),
this._showGeolocatorMenu(),b[0]&&b[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(a){var b={},c=this._defaultSR,d;this.get("map")&&(c=this.get("map").spatialReference);if(a.hasOwnProperty("text")&&a.hasOwnProperty("magicKey"))return a;if(a.hasOwnProperty("feature"))b.feature=new z(a.feature),(d=b.feature.geometry)&&d.setSpatialReference(c);else if(a.hasOwnProperty("geometry")){var e=a.symbol||null;d=a.attributes||{};b.feature=new z(a.geometry,e,d,a.infoTemplate||
null);(d=b.feature.geometry)&&d.setSpatialReference(c)}else a.hasOwnProperty("location")?(e=new T(a.location.x,a.location.y,c),d={},a.hasOwnProperty("attributes")&&(d=a.attributes),a.hasOwnProperty("score")&&(d.score=a.score),b.feature=new z(e,null,d,null)):b.feature=null;if(a.hasOwnProperty("extent"))b.extent=new B(a.extent),b.extent.setSpatialReference(new D(c));else if(b.feature&&b.feature.geometry)switch(b.feature.geometry.type){case "extent":b.extent=b.feature.geometry;break;case "multipoint":b.extent=
b.feature.geometry.getExtent();break;case "polygon":b.extent=b.feature.geometry.getExtent();break;case "polyline":b.extent=b.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?b.extent=Q.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(b.feature.geometry):b.extent=this.get("map").extent.centerAt(b.feature.geometry):b.extent=new B({xmin:b.feature.geometry.x-.25,ymin:b.feature.geometry.y-.25,xmax:b.feature.geometry.x+.25,
ymax:b.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else b.extent=null;a.hasOwnProperty("name")?b.name=a.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&a.hasOwnProperty("attributes")&&a.attributes.hasOwnProperty(this.activeGeocoder.field)?b.name=a.attributes[this.activeGeocoder.field]:a.hasOwnProperty("Match_addr")&&"string"===typeof a.Match_addr?b.name=a.Match_addr:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Match_addr")?b.name=
a.address.Match_addr:a.hasOwnProperty("address")&&"string"===typeof a.address?b.name=a.address:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Address")?b.name=a.address.Address:b.name=b.feature&&b.feature.geometry?b.feature.geometry.x+","+b.feature.geometry.y:"";return b},_hydrateResults:function(a){var b=[],c=0;if(a&&a.length)for(c;c<a.length;c++){var d=this._hydrateResult(a[c]);b.push(d)}return b}});a.setObject("dijit.Geocoder",b,E);return b})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F){c=c([l,t],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:J,constructor:function(c,d){b.mixin(this,F.widgets.overviewMap);c=c||{};if(c.map){var e={};d&&(this._detached=!0,e=n.coords(d,!0));this.map=c.map;this.baseLayer=c.baseLayer;this.width=c.width||e.w||this.map.width/4;this.height=c.height||e.h||this.map.height/4;this.attachTo=c.attachTo||"top-right";this.expandFactor=c.expandFactor||2;this.color=c.color||
"#000000";this.opacity=c.opacity||.5;this.maximizeButton=!!c.maximizeButton;this.visible=!!c.visible;if(this.map.loaded)this._initialSetup();else var f=a.connect(this.map,"onLoad",this,function(){a.disconnect(f);f=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>u("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(h.set(this._body,
"display","block"),h.set(this._controllerDiv,"display","none"),h.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():a.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||v.add(this._maximizerDiv,"ovwDisabledButton"),v.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),v.add(this._controllerDiv,
"ovwShow"),v.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));h.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(a){!a||0>=a.w||0>=a.h||this._resize(a.w,a.h)},show:function(){if(!this.visible){var a=this._controllerDiv;a.title=this.NLS_hide;v.remove(a,"ovwShow");v.add(a,"ovwHide");z.show(this._body);
z.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var a=this._controllerDiv;a.title=this.NLS_show;v.remove(a,"ovwHide");v.add(a,"ovwShow");this._maximized&&this._maximizeHandler();z.hide(this._body);z.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var b=this.baseLayer||this._mainMapLayer,c=this.map.spatialReference,f=b.spatialReference;if(f.wkid===c.wkid||
f.wkt===c.wkt){c=b.declaredClass;if(b instanceof e)if(-1!==c.indexOf("VETiledLayer"))this.baseLayer=new E({resourceInfo:b.getResourceInfo(),culture:b.culture,mapStyle:b.mapStyle,bingMapsKey:b.bingMapsKey});else if(-1!==c.indexOf("OpenStreetMapLayer"))this.baseLayer=new G({tileServers:b.tileServers});else if(-1!==c.indexOf("WebTiledLayer")){var c=b.initialExtent,f=b.fullExtent,h=b.tileInfo;this.baseLayer=new b.constructor(b.urlTemplate,{initialExtent:c&&new c.constructor(c.toJson()),fullExtent:f&&
new f.constructor(f.toJson()),tileInfo:h&&new h.constructor(h.toJson()),tileServers:b.tileServers&&b.tileServers.slice(0)})}else this.baseLayer=new d(b.url,{resourceInfo:b.getResourceInfo()});else if(b instanceof m)-1!==c.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new k(b.url):(this.baseLayer=new y(b.url),this.baseLayer.setImageFormat("png24"));else if(b instanceof g)this.baseLayer=new d("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",{});else return;!this._detached&&
this.visible&&this._controllerDiv&&(b=function(){this.visible=!1;this.show()},this.baseLayer.loaded?b.call(this):a.connect(this.baseLayer,"onLoad",this,b))}}},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var a=this._maximizerDiv;this._maximized?(a.title=this.NLS_maximize,v.remove(a,"ovwRestore"),v.add(a,"ovwMaximize"),this._resize(this.width,this.height)):(a.title=this.NLS_restore,v.remove(a,"ovwMaximize"),v.add(a,"ovwRestore"),this._resize(this.map.width,
this.map.height));this._maximized=!this._maximized},_resize:function(a,b){h.set(this._body,{width:a+"px",height:b+"px"});a=D.defaults.map.panDuration;b=this.overviewMap;D.defaults.map.panDuration=0;b&&(b.resize(!0),b.centerAt(this._focusExtent.getCenter()));D.defaults.map.panDuration=a},_initialize:function(){if(this.overviewMap)this._activate();else{var c,d;d=9>u("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=c=new p(d,{slider:!1,showAttribution:!1,logo:!1,lods:this._overviewLods,
wrapAround180:this.map.wrapAround180});a.connect(c,"onLoad",this,function(){this._map_resize_override=b.hitch(c,this._map_resize_override);c.disableMapNavigation();this._activate()});c.addLayer(this.baseLayer)}},_activate:function(){var b=this.map,c=this.overviewMap;this._moveableHandle=new f(this._focusDiv);this._soeConnect=a.connect(b,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=a.connect(b,"onPan",this,this._updateFocus);this._oecConnect=a.connect(c,"onExtentChange",this,this._ovwExtentChangeHandler);
this._opaConnect=a.connect(c,"onPan",this,this._ovwPanHandler);this._ozsConnect=a.connect(c,"onZoomStart",this,function(){z.hide(this._focusDiv)});this._ozeConnect=a.connect(c,"onZoomEnd",this,function(){z.show(this._focusDiv)});this._omsConnect=a.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(b.extent,null,null,null)},_deactivate:function(){a.disconnect(this._soeConnect);a.disconnect(this._ufoConnect);a.disconnect(this._oecConnect);a.disconnect(this._opaConnect);
a.disconnect(this._ozsConnect);a.disconnect(this._ozeConnect);a.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(a,b,c,d){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=a,this.overviewMap.setExtent(a.expand(this.expandFactor),!0))},_updateFocus:function(a){this._suspendPanHandling||(this._focusExtent=a,this._drawFocusDiv(a))},_drawFocusDiv:function(a,b){var c=this.overviewMap,d=c.toScreen(new w(a.xmin,
a.ymax,c.spatialReference)),c=c.toScreen(new w(a.xmax,a.ymin,c.spatialReference));a=c.x-d.x;var c=c.y-d.y,e=!0;a>this.overviewMap.width&&c>this.overviewMap.height&&(e=!1);h.set(this._focusDiv,{left:d.x+(b?b.x:0)+"px",top:d.y+(b?b.y:0)+"px",width:a+"px",height:c+"px",display:e?"block":"none"})},_moveStopHandler:function(a){var b=this._moveableHandle.node.style;a=this._focusExtent;var c=this.overviewMap,b=c.toMap(new x(parseInt(b.left,10),parseInt(b.top,10))),d=new w(a.xmin,a.ymax,c.spatialReference);
this._focusExtent=a.offset(b.x-d.x,b.y-d.y);this._maximized?this._maximizeHandler():c.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(a,b){this._drawFocusDiv(this._focusExtent,b)}});b.setObject("dijit.OverviewMap",c,C);return c})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D){u=c([E,t,p],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:C,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(a,c){b.mixin(this,D.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=b.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},a.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new m.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=b.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var a=this._sliderToTimeExtent();this.onTimeExtentChange(a)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var a=this._getSliderValue();this._offset=b.isArray(a)?
a[1]-a[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(a,b){a&&a.startTime&&a.endTime&&(b=b||this._defaultCount,this.createTimeStopsByTimeInterval(a,Math.ceil((a.endTime-a.startTime)/(b-1)),"esriTimeUnitsMilliseconds"))},createTimeStopsByTimeInterval:function(a,b,c,d){if(a&&a.startTime&&a.endTime){this.fullTimeExtent=
new G(a.startTime,a.endTime);d&&!0===d.resetStartTime&&this._resetStartTime(this.fullTimeExtent,c);this._timeIntervalUnits=c;d=this.fullTimeExtent.startTime;for(var e=[];d<=a.endTime;)e.push(d),d=a._getOffsettedDate(d,b,c);0<e.length&&e[e.length-1]<a.endTime&&e.push(d);this.setTimeStops(e)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(a){this.timeStops=a||[];this._numTicks=this._numStops=this.timeStops.length;!1===k.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=
new G(a[0],a[a.length-1]))},setLoop:function(a){this.loop=a},setThumbCount:function(a){this.thumbCount=a;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(a){this.thumbIndexes=b.clone(a)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(a){this.thumbMovingRate=a;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(a){this.labels=a;this._slider&&this._createSlider()},setTickCount:function(a){this._numTicks=
a;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(a){this._createTimeInstants=a&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(a){this.intermediateChanges=!!a;this._slider&&this._slider.set("intermediateChanges",!!a)},_updateUI:function(){v.remove(this.playPauseBtn.iconNode,
this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";v.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var c=this.domNode;c.parentNode&&!c.dir;)c=c.parentNode;c={onChange:b.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,
"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=h.create("div",{},n.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=h.create("div",{},this._ts,"first");this._timeSliderLabels=h.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(c):this._createSingleSlider(c);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&n.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",
this._ts).forEach(function(a){f.set(a,{background:"none"})});this._initializeThumbs();a.disconnect(this._onChangeConnect);this._onChangeConnect=a.connect(this._slider,"onChange",b.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(a){this._isRangeSlider=!0;this._slider=new (c([w,g],{templateString:d}))(a,this._ts)},_createSingleSlider:function(a){this._isRangeSlider=!1;this._slider=new w(a,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=
null);2>this._numTicks||(this._hTicks=new x({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new e({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var a=this._toSliderValue(this.thumbIndexes[0]),
a=a>this._slider.maximum||a<this._slider.minimum?this._slider.minimum:a;if(!0===this._isRangeSlider){var b=this._toSliderValue(this.thumbIndexes[1]),b=b>this._slider.maximum||b<this._slider.minimum?this._slider.maximum:b;this._setSliderValue([a,b<a?a:b])}else this._setSliderValue(a);this._onHorizontalChange()}},_bumpSlider:function(a){var c=this._getSliderValue(),d=c,e=d,f=a;b.isArray(c)&&(e=c[0],d=c[1],f=[{change:a,useMaxValue:!0},{change:a,useMaxValue:!1}]);1E-10>Math.abs(e-this._slider.minimum)&&
0>a||1E-10>Math.abs(d-this._slider.maximum)&&0<a?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),a=this._sliderToTimeExtent(),this.onTimeExtentChange(a),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(f)},_updateThumbIndexes:function(){var a=this._getSliderValue();b.isArray(a)?(this.thumbIndexes[0]=this._toSliderIndex(a[0]),this.thumbIndexes[1]=this._toSliderIndex(a[1])):this.thumbIndexes[0]=this._toSliderIndex(a)},_sliderToTimeExtent:function(){if(this.timeStops&&
0!==this.timeStops.length){var a=new G,c=this._getSliderValue(),d,e;b.isArray(c)?(c[0]>c[1]?(e=c[0],d=c[1]):(d=c[0],e=c[1]),a.startTime=new Date(this.timeStops[this._toSliderIndex(d)]),a.endTime=new Date(this.timeStops[this._toSliderIndex(e)]),this._adjustTimeExtent(a)):(a.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(c)]):new Date(this.fullTimeExtent.startTime),a.endTime=!0===this._createTimeInstants?a.startTime:new Date(this.timeStops[this._toSliderIndex(c)]));
return a}},_adjustTimeExtent:function(a){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&a.startTime.getTime()!==a.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var b=a.startTime;b.setUTCSeconds(b.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(a=a.endTime,a.setUTCSeconds(a.getUTCSeconds()-1))}},_resetStartTime:function(a,b){switch(b){case "esriTimeUnitsSeconds":a.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":a.startTime.setUTCSeconds(0,
0,0);break;case "esriTimeUnitsHours":a.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":a.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":a.startTime.setUTCDate(a.startTime.getUTCDate()-a.startTime.getUTCDay());break;case "esriTimeUnitsMonths":a.startTime.setUTCDate(1);a.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":a.startTime.setUTCFullYear(a.startTime.getUTCFullYear()-a.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":a.startTime.setUTCFullYear(a.startTime.getUTCFullYear()-
a.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(a){a=Math.floor((a-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));0>a&&(a=0);a>=this._numStops&&(a=this._numStops-1);return a},_toSliderValue:function(a){return a*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},
_setSliderValue:function(a){this._slider._setValueAttr(a,!1,!1)}});b.setObject("dijit.TimeSlider",u,y);return u})},"esri/dijit/MultidimensionalSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F,T,B,M,U,N,Q,O){var K={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};e=c([z,e,m],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:J,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(a,b){c.safeMixin(this,a);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===K.LAYOUT_HORIZONTAL&&(this.templateString=
F);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=T;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var a=this;this._getAllLayersMDInfo().then(function(){a._sortDimensionValues();a.dimensionValues=a.dimensionValues&&a.dimensionValues.length&&!a.useLayersDimSlices?a.dimensionValues:a._mapSortedDimensionValues;a.getUnit();a._setupSlider()});this._timer=new g.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
b.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===K.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",b.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var a=Q(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=O.create("div");B.add(this._passiveLbl1,"esriMdSliderPassiveLbl");O.place(this._passiveLbl1,a[0]);2===this._thumbCount&&(this._passiveLbl2=O.create("div"),
B.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),O.place(this._passiveLbl2,a[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(n(this.domNode,"mouseover",b.hitch(this,"activateSlider")));this._eventHandles.push(n(this.domNode,"mouseleave",b.hitch(this,"deactivateSlider")));this._eventHandles.push(n(this.domNode,N.press,b.hitch(this,"activateSlider")));this._eventHandles.push(n(this.domNode,N.release,b.hitch(this,"deactivateSlider")));this._eventHandles.push(n(this.prevBtn.domNode,
N.press,b.hitch(this,"activateSlider")));this._eventHandles.push(n(this.playPauseBtn.domNode,N.press,b.hitch(this,"activateSlider")));this._eventHandles.push(n(this.nextBtn.domNode,N.press,b.hitch(this,"activateSlider")));var a=Q(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);d.forEach(a,function(a){this._eventHandles.push(n(a,N.press,b.hitch(this,"activateSlider")));this._eventHandles.push(n(a,N.release,b.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){d.forEach(this._eventHandles,
function(a){a&&a.remove()})},activateSlider:function(){9>dojo.isIE&&dojo.style(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);B.remove(this.domNode,"esriMdSliderPassive");B.add(this.domNode,"esriMdSliderActive");M.set(this._passiveLbl1,"display","none");this._passiveLbl2&&M.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>dojo.isIE)){var a=this;this.deactivateTimer=setTimeout(function(){a.sliderActive=!1;
a.updatePassiveLabels();B.remove(a.domNode,"esriMdSliderActive");B.add(a.domNode,"esriMdSliderPassive");a._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&D.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){D.isDefined(this.value)&&(M.set(this._passiveLbl1,"display","inline-block"),
this.value.length?M.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&M.set(this._passiveLbl2,"display","none"))},increment:function(){var a=1;!this.playDirectionAscending&&this.playing&&(a=-1);this._bumpSlider(a)},decrement:function(){var a=-1;!this.playDirectionAscending&&this.playing&&(a=1);this._bumpSlider(a)},_setDimensionAttr:function(a){this._slider&&(a.dimension&&(this.dimension=a.dimension),this.dimensionValues=a.dimensionValues&&a.dimensionValues.length?a.dimensionValues:
[],this.update())},update:function(){var a=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){a._sortDimensionValues();a.getUnit();a.dimensionValues&&a.dimensionValues.length&&!a.useLayersDimSlices||(a.dimensionValues=a._mapSortedDimensionValues);a._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(a){!0!==this.playing&&(this.playing=!1,this._onPlay())},
_setupSlider:function(){this._destroySlider();this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===K.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},
_createRule:function(){this.layout===K.LAYOUT_HORIZONTAL?this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new l({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&
(this._sliderRules=new f({count:this.dimensionValues.length,style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new x({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&
(this._sliderRules=new w({count:this.dimensionValues.length,style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(a){a=a?a:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new t({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:b.hitch(this,"increment"),decrement:b.hitch(this,"decrement"),value:a||0,onChange:b.hitch(this,
this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createHorizontalRangeSlider:function(a){a=a?a:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new p({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:b.hitch(this,"increment"),decrement:b.hitch(this,"decrement"),value:a||[0,1],onChange:b.hitch(this,
this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();n(this._slider.incrementButton,"click",this._slider.increment);n(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(a){a=D.isDefined(a)?a:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new v({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,
style:this.computeSliderStyle(),increment:b.hitch(this,"increment"),decrement:b.hitch(this,"decrement"),value:a||0,onChange:b.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(a){a=a?a:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new h({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,
style:this.computeSliderStyle(),increment:b.hitch(this,"increment"),decrement:b.hitch(this,"decrement"),value:a||[0,1],onChange:b.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(a){var b=this.dimensionValues[a];this.setDimensionInfoText(b);d.forEach(this._layers,function(c){this._updateMosaicRule(c,b);this.prefetch&&this.playing&&this._prefetchData(a,c)},this);this._oldValue=
a;this.value=b;this.updatePassiveLabels();this.onChange(b)},_onRangeSliderChange:function(a){if(this._update){this._snap&&(a=this._snapToNearestRange(a));var c=[this.dimensionValues[a[1]],this.dimensionValues[a[0]]];c.sort(this._sortCompareFunction);this.value=c;this.setDimensionInfoText(c);this.updatePassiveLabels();d.forEach(this._layers,function(b){this._updateMosaicRule(b,c);this.prefetch&&this.playing&&this._prefetchData(a,b)},this);this._update=!0;this._oldValue=b.clone(a);this.onChange(c)}},
destroy:function(){this.inherited(arguments);this._timer.stop();this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(I){this._slider.domNode&&O.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){var a,b;this.mdSliderCell.appendChild(this.sliderNode);this.value&&this.value.length&&0<=d.indexOf(this.dimensionValues,this.value[0])&&0<=d.indexOf(this.dimensionValues,this.value[1])?a=[d.indexOf(this.dimensionValues,
this.value[0]),d.indexOf(this.dimensionValues,this.value[1])]:D.isDefined(this.value)&&(b=d.indexOf(this.dimensionValues,this.value),0<=b&&(a=b));D.isDefined(a)||(a=this._getDefaultSliderValue());this.useDefaults&&D.isDefined(a)&&(a===this.dimensionValues.length-1||a.length&&0<=d.indexOf(a,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===K.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(a):this._createVerticalRangeSlider(a):this.layout===K.LAYOUT_HORIZONTAL?
this._createHorizontalSingleSlider(a):this._createVerticalSingleSlider(a)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var a,b,c=Infinity,e=1,f,g;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(f=0;f<this.dimensionValues.length&&(g=this.dimensionValues[f],b=Math.abs(g-0),b<c&&(c=b,a=g),0!==b);f++);else a=this.dimensionValues[0];a=d.indexOf(this.dimensionValues,a);a=0>a?0:a;2===this._thumbCount&&(a===this.dimensionValues.length-1&&(e=-1),a=[a,
a+e]);return a}},_getMultidimensionalInfo:function(a){function b(){a.getMultidimensionalInfo().then(function(b){a.multidimensionalInfo=b;c.resolve(a)},function(a){c.reject(a)})}var c=new y;if(a.multidimensionalInfo)c.resolve(a);else if(a.loaded)b();else a.on("load",function(){b()});return c},_getAllLayersMDInfo:function(){var a=[];d.forEach(this._layers,function(b){a.push(this._getMultidimensionalInfo(b))},this);return new k(a)},_getImageLayers:function(){var a=this.map.layerIds.concat(this.map.graphicsLayerIds),
b;this._layers=[];d.forEach(a,function(a){b=this.map.getLayer(a);"esri.layers.ArcGISImageServiceLayer"!==b.declaredClass&&"esri.layers.ArcGISImageServiceVectorLayer"!==b.declaredClass&&"esri.layers.RasterLayer"!==b.declaredClass||this._layers.push(b)},this);return this._layers},_sortCompareFunction:function(a,b){return D.isDefined(a)&&D.isDefined(b)?a-b:!1},_getDimensionObjects:function(){function a(a){if(a&&a.values&&a.hasRanges){var b=[];d.forEach(a.values,function(a){a.length?b=c(b,a):b.push.apply(c(b.sort(this._sortCompareFunction),
[a]))},this);b=b.sort(e._sortCompareFunction);a.decodedValues=b}return a}var c=this._merge,e=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();d.forEach(this._layers,function(a){a.multidimensionalInfo&&d.some(a.multidimensionalInfo.variables,function(a){d.some(a.dimensions,function(a){a.name!==this.dimension||a.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&
this.useLayersDimSlices?(this._thumbCount=2,this._snap=!0):this._snap=!1;d.forEach(this._layers,function(c){c.multidimensionalInfo&&d.some(c.multidimensionalInfo.variables,function(c){d.some(c.dimensions,function(c){c.name===this.dimension&&(this._allRangeValues&&c.hasRanges||this.useRanges?this._dimensionObjects.push(a(b.clone(c))):!this._allRangeValues&&c.hasRanges||this._dimensionObjects.push(b.clone(c)))},this)},this)},this)},_merge:function(a,b){for(var c=[],e=0,f=0;e<a.length&&f<b.length;)a[e]<
b[f]?c.push(a[e++]):a[e]>b[f]?c.push(b[f++]):(c.push(b[f++]),e++);c=c.concat(a.slice(e)).concat(b.slice(f));return c=d.filter(c,function(a,b,c){return c.indexOf(a)===b})},_mergeRangeArrays:function(a,b){for(var c=[],e=0,f=0;e<a.length&&f<b.length;)a[e][0]<b[f][0]||a[e][0]===b[f][0]&&a[e][1]<b[f][1]?c.push(a[e++]):a[e][0]>b[f][0]||a[e][0]===b[f][0]&&a[e][1]>b[f][1]?c.push(b[f++]):(c.push(b[f++]),e++);c=c.concat(a.slice(e)).concat(b.slice(f));return c=d.filter(c,function(a,b,c){return c.indexOf(a)===
b},this)},_sortDimensionValues:function(){var a=0,b=this._merge,c=this._mergeRangeArrays;this._getDimensionObjects();1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(a=1;a<this._dimensionObjects.length;a++)this._mapSortedDimensionValues=b(this._mapSortedDimensionValues,this._dimensionObjects[a].decodedValues||
this._dimensionObjects[a].values),this._allRangeValues&&(this._dimensionRangeValues=c(this._dimensionRangeValues,this._dimensionObjects[a].values))},_createDimensionalDefinition:function(a,b){a=[a];return new E({variableName:b,dimensionName:this.dimension,values:a,isSlice:1===a.length})},_updateMosaicRule:function(a,b){var c=!1,e=a.mosaicRule||a.defaultMosaicRule||new G({multidimensionalDefinition:[]}),f=e.multidimensionalDefinition||[];b.length&&b.sort(this._sortCompareFunction);d.forEach(f,function(a){a.dimensionName===
this.dimension&&(a.values=[b],a.isSlice=!this.useRanges,c=!0)},this);!c&&d.some(a.multidimensionalInfo.variables,function(a){if(d.some(a.dimensions,function(a){if(a.name===this.dimension)return!0},this))return!0},this)&&(f.push(this._createDimensionalDefinition(b,"")),c=!0);c&&(e.multidimensionalDefinition=f,a.setMosaicRule(e))},_prefetchData:function(a,c){if(c&&c.mosaicRule){var e,f,g,h=!1,k,l=this,m;this.prefetchedValues[c.id]||(this.prefetchedValues[c.id]=[]);this.prefetchImgNodes[c.id]=[];f=b.clone(c._params);
g=b.clone(c.mosaicRule);for(e=1;e<=this.prefetchFactor;e++)h=!1,d.forEach(g.multidimensionalDefinition,function(b){b.dimensionName===this.dimension&&(this.playDirectionAscending?a.length?(this.snap?(k=this._getNextRangeIndex(a)||a,b.values=[this.dimensionValues[k[0]],this.dimensionValues[k[1]]]):b.values=[this.dimensionValues[(a[0]+e)%this.dimensionValues.length],this.dimensionValues[(a[1]+e)%this.dimensionValues.length]],b.values.sort(this._sortCompareFunction)):b.values=[this.dimensionValues[(a+
e)%this.dimensionValues.length]]:a.length?(this.snap?(k=this._getNextRangeIndex(a,-1)||a,b.values=[this.dimensionValues[k[0]],this.dimensionValues[k[1]]]):b.values=[this.dimensionValues[(this.dimensionValues.length+a[0]-e)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+a[1]-e)%this.dimensionValues.length]],b.values.sort(this._sortCompareFunction)):b.values=[this.dimensionValues[(this.dimensionValues.length+a-e)%this.dimensionValues.length]],d.some(this.prefetchedValues[c.id],
function(a){if(u.stringify(a)===u.stringify(b.values))return!0})||(h=!0,this.prefetchedValues[c.id].push(b.values)))},this),h&&(f.mosaicRule=u.stringify(g.toJson()),c.getImageUrl(this.map.extent,this.map.width,this.map.height,function(a){m=new Image;l.prefetchImgNodes[c.id].push(m);m.src=a},f))}},setDimensionInfoText:function(a){if(D.isDefined(a)){var c=this.unitSymbol||this.unit;if("number"!==typeof a){a=b.clone(a.sort(this._sortCompareFunction));if(0!==a[0]%1||0!==a[1]%1)a[0]=parseFloat(a[0].toFixed(2)),
a[1]=parseFloat(a[1].toFixed(2));a="["+a[0]+", "+a[1]+"]"}else 0!==a%1&&(a=a.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+" ("+c+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===K.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+a):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+a)}},setLabels:function(a){},_filterLabels:function(){if(this.nLabels&&
this.dimensionValues&&this.dimensionValues.length){var a=Math.ceil(this.dimensionValues.length/this.nLabels);return d.map(this.dimensionValues,function(b,c){return 0===c%a||c===this.dimensionValues.length-1?(0!==b%1&&(b=parseFloat(b.toFixed(2))),b):""},this)}},_filterLayers:function(){return d.filter(this._layers,function(a){if(a.multidimensionalInfo&&a.visible&&a.useMapDimensionValue&&d.some(a.multidimensionalInfo.variables,function(a){if(d.some(a.dimensions,function(a){if(a.name===this.dimension)return!0},
this))return!0},this))return!0},this)},_updateUI:function(){B.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":"mdsButton mdsPlayButton";B.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(a){var b=this._slider.value;if(0<=a)!this._snap&&(0>b||b>=this.dimensionValues.length-1||b[0]>=this.dimensionValues.length-1||b[1]>=this.dimensionValues.length-1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues=
{},this.prefetchImgNodes={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(b)):this._slider.set("value",[0,Math.abs(b[0]-b[1])]):this._slider.set("value",0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&b[0]<this.dimensionValues.length-1&&b[1]<this.dimensionValues.length-1?this._slider.set("value",[b[0]+1,b[1]+1]):1===this._thumbCount&&b<this.dimensionValues.length-1?this._slider.set("value",b+1):this._snap&&this._slider.set("value",
this._getNextRangeIndex(b));else if(0>=b||0>=b[0]||0>=b[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(b,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-1-Math.abs(b[0]-b[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());else if(0<=b||0<=b[1])2===this._thumbCount&&0<b[1]&&0<b[0]?this._snap?
this._slider.set("value",this._getNextRangeIndex(b,-1)):this._slider.set("value",[b[0]-1,b[1]-1]):1===this._thumbCount&&0<b&&this._slider.set("value",b-1)},setThumbMovingRate:function(a){this.thumbMovingRate=a;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(a){a=a||this.dimension;var b,c;d.forEach(this._layers,function(e){e.multidimensionalInfo&&e.multidimensionalInfo.variables&&d.forEach(e.multidimensionalInfo.variables,function(e){d.forEach(e.dimensions,
function(d){if(d.name===a&&d.extent&&d.extent.length&&1<d.extent.length){if(!D.isDefined(b)||d.extent[0]<b)b=d.extent[0];if(!D.isDefined(c)||d.extent[1]>c)c=d.extent[1]}},this)},this)},this);return[b,c]},setThumbCount:function(a){this._thumbCount=2==a?2:1;this.value=this.dimensionValues[this._slider.value];this._setupSlider()},clearDimensionalDefinition:function(a){var b,c=[],e;a&&a.mosaicRule&&a.mosaicRule.multidimensionalDefinition&&(e=a.mosaicRule,b=e.multidimensionalDefinition,d.forEach(b,function(a){a.dimensionName!==
this.dimension&&c.push(a)},this),e.multidimensionalDefinition=c,a.setMosaicRule(e))},getUnit:function(){var a=null,b=!1;this.unit=null;d.forEach(this._layers,function(c){c.multidimensionalInfo&&d.forEach(c.multidimensionalInfo.variables,function(c){d.forEach(c.dimensions,function(c){c.name===this.dimension&&c.unit&&(null!=a||b?D.isDefined(c.unit)&&c.unit.replace("esri","").toLowerCase()!==a.toLowerCase()&&(a=null,b=!0):a=c.unit.replace("esri",""))},this)},this)},this);a&&(a=a.replace("esri",""));
this.unit=a;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=b;return a},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;d.some(this._layers,function(a){if(a.fields&&a.fields.length&&d.some(a.fields,function(a){if(a.name&&a.name===this.dimension&&a.alias)return this.dimensionAlias=a.alias,!0},this))return!0},this)},_readMosaicRule:function(){var a;d.forEach(this._layers,function(b){b.mosaicRule&&b.mosaicRule.multidimensionalDefinition&&d.forEach(b.mosaicRule.multidimensionalDefinition,
function(b){b&&b.dimensionName===this.dimension&&b.values&&(a=b.values.length&&b.values[0]&&b.values[0].length?b.values[0]:b.values)},this)},this);this.useRanges=D.isDefined(this.useRanges)?this.useRanges:a&&1!==a.length?!0:!1;a&&(this.useRanges?(this._thumbCount=2,this.value=1===a.length?[a[0],this.dimensionValues[this.dimensionValues.length-1]]:a):1<a.length&&this._snap?(this._thumbCount=2,this.value=a):(this._thumbCount=1,this.useRanges=!1,this.value=a[0]))},hasUnitConflict:function(){this.getUnit();
return this._hasUnitConflict},resizeSlider:function(a,b){M.set(this.domNode,{height:a+"px",width:b+"px"});M.set(this.mdSliderTable,{height:a+"px",width:b+"px"});this.computeSliderStyle()},computeSliderStyle:function(){var b,c;b=U.getContentBox(this.domNode).h-U.getContentBox(this.dimensionInfo).h-(U.getContentBox(this.playPauseBtnRow).h+20);10>=a("ie")&&(b-=53);c="height: "+b+"px;";this._slider&&this._slider.domNode&&M.set(this._slider.domNode,"height",b+"px");return c},getUnitSymbol:function(){if(!D.isDefined(this.unit))return null;
var a=this.unit.toLowerCase();if("meters"===a||"meter"===a)return this.unitSymbols.meter;if("pascal"===a||"pascals"===a)return this.unitSymbols.pascal},_snapToNearestRange:function(a){if(a&&a.length&&this._snap){var c,e,f,g,h=this,k,l,m,n;g=[this.dimensionValues[a[1]],this.dimensionValues[a[0]]];g.sort(this._sortCompareFunction);if(d.some(this._dimensionObjects,function(a){if(d.some(a.values,function(a){if(a&&a.length&&a[0]===g[0]&&a[1]===g[1])return!0}))return!0},this))return a;d.some(this._dimensionObjects,
function(a){if(d.some(a.values,function(a){if(a&&a.length&&a[0]===g[0])return c=b.clone(a.sort(this._sortCompareFunction)),!0},this))return!0},this)&&(d.some(this.dimensionValues,function(a,b){a===c[0]&&(e=b);a===c[1]&&(f=b)}),m=Math.abs(a[0]-e),k=[e,f]);d.some(this._dimensionObjects,function(a){if(d.some(a.values,function(a){if(a&&a.length&&a[1]===g[1])return c=b.clone(a.sort(this._sortCompareFunction)),!0},this))return!0},this)&&(d.some(this.dimensionValues,function(a,b){a===c[1]&&(f=b);a===c[0]&&
(e=b)}),n=Math.abs(a[1]-f),l=[e,f]);a=m&&n?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,k)?l:this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,l)?k:m<=n?k:l:k||l||a;this._update=!1;setTimeout(function(){h._slider.set("value",a)},100);return a}},_arraysEqual:function(a,b){var c;if(!D.isDefined(a)||!D.isDefined(b))return!1;if(a===b)return!0;if(a.length!==b.length)return!1;a.sort(this._sortCompareFunction);b.sort(this._sortCompareFunction);for(c=0;c<a.length;++c)if(a[c]!==
b[c])return!1;return!0},_getNextRangeIndex:function(a,b){if(!this._dimensionRangeValues||!this._dimensionRangeValues.length)return null;var c,e,f,g;b=D.isDefined(b)?b:1;d.some(this._dimensionRangeValues,function(b,d){if(this._arraysEqual(b,[this.dimensionValues[a[0]],this.dimensionValues[a[1]]]))return c=d,!0},this);e=this._dimensionRangeValues[0<b?(c+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+c-1)%this._dimensionRangeValues.length];d.some(this.dimensionValues,function(a,
b){a===e[0]&&(f=b);a===e[1]&&(g=b);if(f&&g)return!0},this);return[f,g]}});b.mixin(e,K);b.setObject("dijit.MultidimensionalSlider",e,C);return e})},"dijit/form/VerticalRule":function(){define(["dojo/_base/declare","./HorizontalRule"],function(c,b){return c("dijit.form.VerticalRule",b,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkV" style\x3d"top:',_isHorizontal:!1})})},"dijit/form/VerticalRuleLabels":function(){define(["dojo/_base/declare",
"./HorizontalRuleLabels"],function(c,b){return c("dijit.form.VerticalRuleLabels",b,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV dijitRuleLabelsContainer dijitRuleLabelsContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerV" style\x3d"top:',_labelPrefix:'"\x3e\x3cspan class\x3d"dijitRuleLabel dijitRuleLabelV"\x3e',_calcPosition:function(a){return 100-a},_isHorizontal:!1})})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D,z,J,F,T,B,M,U,N,Q,O,K,I){b=b([K,m,g],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:I,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(a,b){a=a||{};this.map=a.map;this._hasUI=b?!0:!1;this.bingMapsKey=a.bingMapsKey&&
0<a.bingMapsKey.length?a.bingMapsKey:null;this.showArcGISBasemaps=!1!==a.showArcGISBasemaps;this.basemaps=a.basemaps||[];this.basemapIds=a.basemapIds;this.referenceIds=a.referenceIds;this.basemapsGroup=a.basemapsGroup;this.arcgisUrl=d.dijit._arcgisUrl;a.portalUrl&&(this.arcgisUrl=a.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=k.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));
this.init()},init:function(){this.inherited(arguments);a.forEach(this.basemaps,function(b){b.id&&0!==b.id.length||(b.id=this._getUniqueId());a.forEach(b.layers,function(a){a.opacity=0<=a.opacity?a.opacity:1;a.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&a.forEach(this.basemapIds,function(a){this.map.getLayer(a)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&a.forEach(this.referenceIds,function(a){a=this.map.getLayer(a);a._basemapGalleryLayerType=
"reference";a.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(u.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(u.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup();this._checkVTLSupport().then(u.hitch(this,function(a){this._supportsVTL=a}))},startup:function(){this.loaded?this._refreshUI():n.connect(this,"onLoad",u.hitch(this,
function(){this._refreshUI()}))},select:function(a){this._select(a)},getSelected:function(){return this._selectedBasemap},get:function(a){var b;for(b=0;b<this.basemaps.length;b++)if(this.basemaps[b].id===a)return this.basemaps[b];return null},add:function(a){return a&&!a.id?(a.id=this._getUniqueId(),this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):a&&this._isUniqueId(a.id)?(this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):!1},remove:function(a){var b;for(b=0;b<this.basemaps.length;b++){var c=
this.basemaps[b];if(c.id===a)return this._selectedBasemap&&this._selectedBasemap.id===c.id&&(this._selectedBasemap=null),this.basemaps.splice(b,1),this._refreshUI(),this.onRemove(c),c}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(a){},onRemove:function(a){},onError:function(a){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&
0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(a){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,a):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(a))},_findArcGISBasemapsGroup:function(a){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(a);else{var b=this.arcgisUrl+"/portals/self",
c={f:"json"};c.culture=v.locale;G({url:b,content:c,callbackParamName:"callback",load:u.hitch(this,function(b,c){b&&b.useVectorBasemaps&&b.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(u.hitch(this,function(c){this._basemapGalleryGroupQuery=c?b.vectorBasemapGalleryGroupQuery:b&&b.basemapGalleryGroupQuery?b.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(a)})):(this._basemapGalleryGroupQuery=b&&b.basemapGalleryGroupQuery?b.basemapGalleryGroupQuery:
this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(a))}),error:u.hitch(this,function(a,b){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(a){var b=u.hitch(this,"_findArcGISBasemaps"),c=this.arcgisUrl+"/community/groups",d={};d.q=this._basemapGalleryGroupQuery;d.f="json";G({url:c,content:d,callbackParamName:"callback",load:u.hitch(this,function(c,d){if(0<c.results.length)b(c.results[0].id,a,c.results[0].sortField,
c.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:u.hitch(this,function(a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(a,b,c,d){var e=u.hitch(this,function(a,b,c,d){var e=this.arcgisUrl+"/search",f={};f.q="group:"+a+' AND type:"web map" NOT type:"web mapping application"';f.sortField=c;f.sortOrder="asc"===d?"desc":"asc";f.num=50;f.f="json";G({url:e,content:f,callbackParamName:"callback",
load:u.hitch(this,function(a,c){if(0<a.results.length)b(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:u.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});c&&d?e(a,b,c,d):G({url:this.arcgisUrl+"/community/groups/"+a,content:{f:"json"},callbackParamName:"callback",load:u.hitch(this,function(c,d){c.sortField?e(a,b,c.sortField,c.sortOrder):e(a,b,"name","desc")}),error:u.hitch(this,function(c,
d){e(a,b,"name","desc")})})},_handleArcGISBasemapsResponse:function(b){0<b.length&&(a.forEach(b,function(a,b){if(this.bingMapsKey||!this.bingMapsKey&&a.title&&-1===a.title.indexOf("Bing Maps")){b={};b.id=this._getUniqueId();b.title=a.title;b.thumbnailUrl="";if(a.thumbnail&&a.thumbnail.length&&(b.thumbnailUrl=this.arcgisUrl+"/content/items/"+a.id+"/info/"+a.thumbnail,d.id)){var c=d.id.findCredential(k.urlToObject(this.arcgisUrl).path);c&&(b.thumbnailUrl+="?token\x3d"+c.token)}b.itemId=a.id;a=new O(b,
this);this.basemaps.splice(0,0,a)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(x.empty(this.flowContainer),a.forEach(this.basemaps,function(a,b){a.id||(a.id="basemap_"+b);this.flowContainer.appendChild(this._buildNodeLayout(a))},this),x.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(a){var b=x.create("div",{id:"galleryNode_"+a.id,"class":"esriBasemapGalleryNode"}),d=x.create("a",{href:"javascript:void(0);"},
b);n.connect(d,"onclick",u.hitch(this,"_onNodeClick",a));var e=a.title||"";a.thumbnailUrl?x.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.thumbnailUrl,title:e,alt:e},d):x.create("img",{"class":"esriBasemapGalleryThumbnail",src:c.toUrl("./images/transparent.gif"),title:e,alt:e},d);a=x.create("div",{"class":"esriBasemapGalleryLabelContainer"},b);x.create("span",{innerHTML:e,alt:e,title:e},a);return b},_onNodeClick:function(a,b){b.preventDefault();this._markSelected(a);this.select(a.id)},
_markSelected:function(b){b&&(a.forEach(v.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){e.remove(a,"esriBasemapGallerySelectedNode")}),(b=w.byId("galleryNode_"+b.id))&&e.add(b,"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=!0;var b=this.get(a);b?(b.layers?this._getServiceInfos(b):(a=b.getLayers(this.arcgisUrl),u.isArray(a)?this._getServiceInfos(b):a.addCallback(u.hitch(this,function(a){this._getServiceInfos(b)}))),this._markSelected(b)):this._selectBasemapInProgress=
!1},_getServiceInfos:function(b){"https:"===location.protocol&&a.forEach(b.layers,function(a){if(this._isAgolService(a.url)||this._isHostedService(a.url))a.url=a.url.replace("http:","https:")},this);this._selectedBasemap=b;var c=[];a.forEach(b.layers,function(a){a.url&&0<a.url.length&&!a.isReference&&!a.type&&(a.deferredsPos=c.length,c.push(this._getServiceInfo(a.url)))},this);0<c.length?(new p(c)).addCallback(u.hitch(this,function(c){var d=null;a.forEach(b.layers,function(a){if(0===a.deferredsPos||
a.deferredsPos){a.serviceInfoResponse=c[a.deferredsPos][1];var b=a.serviceInfoResponse.fullExtent;b||(b=a.serviceInfoResponse.extent);d=d?d.union(new E(b)):new E(b)}},this);this.map.extent&&5>this._getIntersectionPercent(d,this.map.extent)&&this.map.setExtent(d,!0);this._switchBasemapLayers(b);this._updateReferenceLayer(b)})):(this._switchBasemapLayers(b),this._updateReferenceLayer(b))},_checkVTLSupport:function(){var a=new t;h("ie")?a.resolve(!1):a.resolve(B.supported());return a},_switchBasemapLayers:function(b){var c=
b.layers,d=!1,e,f,g;a.forEach(c,function(a){"VectorTileLayer"===a.type&&(d=!0)});if(d&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===c[0].type||c[0].type&&-1<c[0].type.indexOf("BingMaps")||"WebTiledLayer"===c[0].type||"VectorTileLayer"===c[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
else{a.forEach(c,function(a){if(!a.isReference&&a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var h=0;a.forEach(c,function(a,b){if(!a.isReference){var d;if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}d=new z({id:"layer_osm",
opacity:a.opacity})}else if(a.type&&-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}d=D.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===a.type?d=D.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(d=D.MAP_STYLE_ROAD);d=new D({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:d,opacity:a.opacity})}else if("WebTiledLayer"===
a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}d=a.initialExtent||a.fullExtent;d=new T(a.templateUrl||a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new E(a.fullExtent),initialExtent:d&&new E(d),subDomains:a.subDomains,tileInfo:a.tileInfo?new M(a.tileInfo):null,tileServers:a.tileServers})}else if("VectorTileLayer"===
a.type){d=new B(a.styleUrl,{visible:a.visibility,opacity:a.opacity});0===b&&1<c.length&&this._removeBasemapLayers();var k=this;n.connect(d,"onLoad",u.hitch(this,function(a,b,d){var e;if(k._sameSpatialReference(d.spatialReference,k.map.spatialReference))if(0<k.map.getNumLevels())if(e=k._sameTilingScheme(d.tileInfo,k.map.__tileInfo))0===b&&1===c.length&&k._removeBasemapLayers(),d._basemapGalleryLayerType="basemap",k.map.addLayer(d,a);else k.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");
else k.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else k.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.")},h,b))}else if(a.serviceInfoResponse&&a.serviceInfoResponse.mapName){e=new C(a.serviceInfoResponse.spatialReference);f=this._sameSpatialReference(e,this.map.spatialReference);if(this.map.spatialReference&&!f){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
return}if(!0===a.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(g=this._sameTilingScheme(a.serviceInfoResponse.tileInfo,this.map.__tileInfo),!g){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===a.serviceInfoResponse.singleFusedMapCache&&-1<a.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}d=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a)}else if(a.serviceInfoResponse&&a.serviceInfoResponse.pixelSizeX){e=new C(a.serviceInfoResponse.spatialReference);f=this._sameSpatialReference(e,this.map.spatialReference);if(!f){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===a.serviceInfoResponse.singleFusedMapCache&&
0<this.map.getNumLevels()&&(g=this._sameTilingScheme(a.serviceInfoResponse.tileInfo,this.map.__tileInfo),!g)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}a.serviceInfoResponse.singleFusedMapCache?d=new J(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility}):a.serviceInfoResponse.pixelSizeX?(d=new N,d.bandIds=a.bandIds,!a.bandIds&&a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount,
10)&&(d.bandIds=[0,1,2]),d=new U(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageServiceParameters:d})):(d=new Q,d.format="png24",a.serviceInfoResponse.supportedImageFormatTypes&&-1<a.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(d.format="png32"),d=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageParameters:d}))}"VectorTileLayer"===a.type?h++:d&&(0===b&&this._removeBasemapLayers(),d._basemapGalleryLayerType=
"basemap",this.map.addLayer(d,h),h++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var b=this.map.layerIds,c=[];a.forEach(b,function(a){a=this.map.getLayer(a);"basemap"===a._basemapGalleryLayerType&&c.push(a)},this);0===c.length&&0<b.length&&c.push(this.map.getLayer(b[0]));0<c.length&&a.forEach(c,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var b;this._removeReferenceLayer();for(b=0;b<a.layers.length;b++)!0===
a.layers[b].isReference&&this._addReferenceLayer(a.layers[b])},_removeReferenceLayer:function(){var a;for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&this.map.removeLayer(b)}},_addReferenceLayer:function(a){"VectorTileLayer"===a.type?this._handleReferenceServiceInfoResponse(a):this._getServiceInfo(a.url,u.hitch(this,"_handleReferenceServiceInfoResponse",a))},_handleReferenceServiceInfoResponse:function(a,b,c){var d;
a.serviceInfoResponse=b;"VectorTileLayer"===a.type?d=new B(a.styleUrl,{visible:a.visibility,opacity:a.opacity}):b&&b.mapName?d=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(a.serviceInfoResponse.singleFusedMapCache?d=new J(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility}):a.serviceInfoResponse.pixelSizeX?(c=new N,c.bandIds=a.bandIds,!a.bandIds&&b.bandCount&&3<parseInt(b.bandCount,10)&&(c.bandIds=[0,1,2]),d=new U(a.url,{resourceInfo:b,
opacity:a.opacity,visible:a.visibility,imageServiceParameters:c})):(b=new Q,b.format="png24",a.serviceInfoResponse.supportedImageFormatTypes&&-1<a.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(b.format="png32"),b.transparent=!0,d=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageParameters:b})));d&&(d._basemapGalleryLayerType="reference",d.attr("data-reference",!0),this.map.addLayer(d))},_getServiceInfo:function(a,b){return G({url:a,content:{f:"json"},
callbackParamName:"callback",load:function(a,c){b&&b(a,c)},error:u.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(b){var c=[];b.displayLevels||(c=a.map(b.serviceInfoResponse.tileInfo.lods,function(a){return a.level}));var d=null;b.exclusionAreas&&b.exclusionAreas.length&&(d=[],a.forEach(b.exclusionAreas,function(a){d.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new E(a.geometry)})}));
return new J(b.url,{resourceInfo:b.serviceInfoResponse,opacity:b.opacity,visible:b.visibility,exclusionAreas:d,displayLevels:b.displayLevels||c})},_loadAsDynamic:function(a){var b=new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});a.visibleLayers&&b.setVisibleLayers(a.visibleLayers);return b},_getIntersectionPercent:function(a,b){return(a=b.intersects(a))?(a=a.getWidth()*a.getHeight(),b=b.getWidth()*b.getHeight(),a/b*100):0},_getIds:function(){var b=[];a.forEach(this.basemaps,
function(a){b.push(a.id)},this);return b},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;)if(-1<a.indexOf(",basemap_"+b+","))b++;else return"basemap_"+b},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+",").indexOf(","+a+",")?!0:!1},_isAgolService:function(a){return a?-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(a){return a?-1!==a.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(a,
b){return a&&b&&a.wkt==b.wkt&&(a.wkid===b.wkid||y.isDefined(a.latestWkid)&&a.latestWkid===b.wkid||y.isDefined(b.latestWkid)&&a.wkid===b.latestWkid||y.isDefined(a.latestWkid)&&a.latestWkid===b.latestWkid)||a&&b&&a.isWebMercator()&&b.isWebMercator()?!0:!1},_sameTilingScheme:function(a,b){var c=this.map,c=c.width>c.height?c.width:c.height,d=!1,e=!1,f,g;for(f=0;f<a.lods.length;f++){var h=a.lods[f].scale;a.dpi!==b.dpi&&(h=a.lods[f].scale/a.dpi);for(g=0;g<b.lods.length;g++){var k=b.lods[g].scale;a.dpi!==
b.dpi&&(k=b.lods[g].scale/b.dpi);if(Math.abs(k-h)/k<1/c)if(d){e=!0;break}else d=!0;if(k<h)break}if(e)break}return e||d&&(1===a.lods.length||1===b.lods.length)?!0:!1}});u.setObject("dijit.BasemapGallery",b,d);return b})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(c,b,a,n,u,v){c=c(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,
format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(b){var c=this.bbox||this.extent;b=(c=c&&b&&c._normalize(!0))?c.spatialReference.wkid||a.toJson(c.spatialReference.toJson()):null;var h=this.imageSpatialReference,c={bbox:c?c.xmin+","+c.ymin+","+c.xmax+","+c.ymax:null,bboxSR:b,size:null!==this.width&&null!==this.height?this.width+
","+this.height:null,imageSR:h?h.wkid||a.toJson(h.toJson()):b,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?a.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?a.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?a.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,
adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};b=this.timeExtent;c.time=b?b.toJson().join(","):null;return v.filter(c,function(a){if(null!==a&&void 0!==a)return!0})}});b.mixin(c,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});b.setObject("layers.ImageServiceParameters",
c,u);return c})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(c,b,a,n,u,v,h){c=c(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,b){a=a||{};this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=b},getLayers:function(c){if(this.layers)return this.layers;
if(this.itemId)return c=v({url:(c||u.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:a.hitch(this,function(a,b){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.")})}),c.addCallback(a.hitch(this,function(a,c){if(a.baseMap)return this.layers=[],b.forEach(a.baseMap.baseMapLayers,function(a){this.layers.push(new h(a))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");
return[]})),c}});a.setObject("dijit.Basemap",c,u);return c})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(c,b,a,n){c=c(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(a){a=a||{};this.url=a.url;this.type=a.type;this.isReference=!0===a.isReference?!0:!1;this.opacity=a.opacity;this.visibleLayers=a.visibleLayers;this.displayLevels=a.displayLevels;this.exclusionAreas=a.exclusionAreas;this.bandIds=a.bandIds;this.templateUrl=
a.templateUrl;this.copyright=a.copyright;this.subDomains=a.subDomains;this.fullExtent=a.fullExtent;this.initialExtent=a.initialExtent;this.tileInfo=a.tileInfo;this.tileServers=a.tileServers;this.styleUrl=a.styleUrl}});b.setObject("dijit.BasemapLayer",c,n);return c})},"esri/dijit/HomeButton":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/HomeButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e){c=b("esri.dijit.HomeButton",[v,f,c],{templateString:p,options:{theme:"HomeButton",map:null,extent:null,fit:!1,visible:!0},constructor:function(b,c){b=a.mixin({},this.options,b);this.domNode=c;this._i18n=w;this.set("map",b.map);this.set("theme",b.theme);this.set("visible",b.visible);this.set("extent",b.extent);this.set("fit",b.fit);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this._css={container:"homeContainer",home:"home",loading:"loading"}},
postCreate:function(){this.inherited(arguments);this.own(l(this._homeNode,h,a.hitch(this,this.home)))},startup:function(){this.inherited(arguments);this.map||this.destroy();if(this.map.loaded)this._init();else l.once(this.map,"load",a.hitch(this,function(){this._init()}))},destroy:function(){this.inherited(arguments)},home:function(){var b=new t,c=this.get("extent");this._showLoading();var d={extent:c};c?this.map.extent!==c?this.map.setExtent(c,this.get("fit")).then(a.hitch(this,function(){this._hideLoading();
this.emit("home",d);b.resolve(d)}),a.hitch(this,function(a){a||(a=Error("HomeButton::Error setting map extent"));d.error=a;this.emit("home",d);b.reject(a)})):(this._hideLoading(),this.emit("home",d),b.resolve(d)):(this._hideLoading(),c=Error("HomeButton::home extent is undefined"),d.error=c,this.emit("home",d),b.reject(c));return b.promise},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_init:function(){this._visible();this.get("extent")||this.set("extent",this.map.extent);
this.set("loaded",!0);this.emit("load",{})},_showLoading:function(){x.add(this._homeNode,this._css.loading)},_hideLoading:function(){x.remove(this._homeNode,this._css.loading)},_updateThemeWatch:function(a,b,c){x.remove(this.domNode,b);x.add(this.domNode,c)},_visible:function(){this.get("visible")?e.set(this.domNode,"display","block"):e.set(this.domNode,"display","none")}});a.setObject("dijit.HomeButton",c,u);return c})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(c,b,a,n,u,v,h,f,l,t,p,w,x,e,m,g,d,y,k,G,E,C,D){c=a("esri.dijit.LocateButton",[f,t,b],{templateString:x,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new C(c.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(a,b){a=n.mixin({},this.options,a);this.domNode=
b;this._i18n=e;b=navigator.geolocation;var c=window.hasOwnProperty("isSecureContext");(c&&window.isSecureContext||!c&&"https:"===window.location.protocol)&&b||(a.visible=!1);this.set("map",a.map);this.set("theme",a.theme);this.set("visible",a.visible);this.set("scale",a.scale);this.set("highlightLocation",a.highlightLocation);this.set("symbol",a.symbol);this.set("infoTemplate",a.infoTemplate);this.set("geolocationOptions",a.geolocationOptions);this.set("useTracking",a.useTracking);this.set("setScale",
a.setScale);this.set("centerAt",a.centerAt);this.set("timeout",a.timeout);this.set("graphicsLayer",a.graphicsLayer);this.set("clearOnTrackingStop",a.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",n.hitch(this,function(){this.get("tracking")&&!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",
tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(p(this._locateNode,l,n.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||this.set("visible",!1);if(this.get("map").loaded)this._init();else p.once(this.get("map"),"load",n.hitch(this,function(){this._init()}))},destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var a=this.get("highlightGraphic"),
b=this.get("graphicsLayer");a&&(b?b.remove(a):this.get("map").graphics.remove(a),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?this.get("tracking")?d.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):d.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):
d.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){m.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(a){return a?{coords:n.mixin({},a.coords),timestamp:a.timestamp}:{}},_startTracking:function(){m.add(this._locateNode,
this._css.tracking);this._removeWatchPosition();var a=navigator.geolocation.watchPosition(n.hitch(this,function(a){a=this._positionToObject(a);this._setPosition(a).then(n.hitch(this,function(a){this._locateEvent(a)}),n.hitch(this,function(a){a||(a=Error("LocateButton::Error setting the position."));this._locateError(a)}))}),n.hitch(this,function(a){this.set("tracking",!1);a||(a=Error("LocateButton::Could not get tracking position."));this._locateError(a)}),this.get("geolocationOptions"));this.set("watchId",
a)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var a=new w;this._removePrivateVars();var b=setTimeout(n.hitch(this,function(){clearTimeout(b);a.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));navigator.geolocation.getCurrentPosition(n.hitch(this,function(c){c=this._positionToObject(c);clearTimeout(b);this._setPosition(c).then(n.hitch(this,function(b){a.resolve(b)}),n.hitch(this,function(b){b||
(b=Error("LocateButton::Error setting map position."));a.reject(b)}))}),n.hitch(this,function(b){b||(b=Error("LocateButton::Could not get current position."));a.reject(b)}),this.get("geolocationOptions"));return a.promise},_locate:function(){var a=new w;this._showLoading();if(navigator.geolocation)this.get("useTracking")?this.get("tracking")?(this._startTracking(),a.resolve({tracking:!0})):(this._stopTracking(),a.resolve({tracking:!1})):this._getCurrentPosition().then(n.hitch(this,function(b){this._locateEvent(b);
a.resolve(b)}),n.hitch(this,function(b){b||(b=Error("LocateButton::Could not get current position."));this._locateError(b);a.reject(b)}));else{var b=Error("LocateButton::geolocation unsupported");this._locateError(b);a.reject(b)}this._setTitle();return a.promise},_projectPoint:function(a){var b=new w,c=this.get("map").spatialReference,d=c.wkid;c.isWebMercator()?(a=y.geographicToWebMercator(a),b.resolve(a)):h.defaults.geometryService&&4326!==d?(d=new D,d.geometries=[a],d.outSR=c,h.defaults.geometryService.project(d).then(n.hitch(this,
function(a){a&&a.length?b.resolve(a[0]):b.reject(Error("LocateButton::Point was not projected."))}),function(a){a||(a=Error("LocateButton::please specify a geometry service on esri/config to project."));b.reject(a)})):b.resolve(a);return b.promise},_getScale:function(a){var b=this.get("scale");return a&&a.coords?b||a.coords.accuracy||5E4:b||5E4},_createPoint:function(a){var b;a&&a.coords&&(b=new k([a.coords.longitude,a.coords.latitude],new G({wkid:4326})));return b},_setPosition:function(a){var b=
new w,c,d;this._removePrivateVars();if((this._position=a)&&a.coords){if(c=this._createPoint(a))this._graphic=d=this._createGraphic(c,a);var e=this._getScale(a);this._scale=e;c?this._projectPoint(c).then(n.hitch(this,function(c){this._graphic=d=this._createGraphic(c,a);var f={graphic:d,scale:e,position:a};this.get("setScale")&&this.get("map").setScale(e);this.get("centerAt")?this.get("map").centerAt(c).then(n.hitch(this,function(){b.resolve(f)}),n.hitch(this,function(a){a||(a=Error("LocateButton::Could not center map."));
b.reject(a)})):b.resolve(f)}),n.hitch(this,function(a){a||(a=Error("LocateButton::Error projecting point."));b.reject(a)})):(c=Error("LocateButton::Invalid point"),b.reject(c))}else c=Error("LocateButton::Invalid position"),b.reject(c);return b.promise},_createGraphic:function(a,b){var c;a&&(b={position:b},c=new E(a,this.get("symbol"),b,this.get("infoTemplate")));return c},_locateEvent:function(a){if(a.graphic){var b=this.get("highlightGraphic"),c=this.get("graphicsLayer");b?(b.setGeometry(a.graphic.geometry),
b.setAttributes(a.graphic.attributes),b.setInfoTemplate(a.graphic.infoTemplate),b.setSymbol(a.graphic.symbol)):(b=a.graphic,this.get("highlightLocation")&&(c?c.add(b):this.get("map").graphics.add(b)));this.set("highlightGraphic",b)}this._hideLoading();this.emit("locate",a)},_locateError:function(a){a={graphic:this._graphic,scale:this._scale,position:this._position,error:a};this._hideLoading();this.emit("locate",a)},_showLoading:function(){this.get("useTracking")||m.add(this._locateNode,this._css.loading)},
_hideLoading:function(){this.get("useTracking")||m.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(a,b,c){m.remove(this.domNode,b);m.add(this.domNode,c)},_visible:function(){this.get("visible")?g.set(this.domNode,"display","block"):g.set(this.domNode,"display","none")}});n.setObject("dijit.LocateButton",c,v);return c})},
"esri/main":function(){define(["./kernel","dojo/i18n!./nls/jsapi","./config","./sniff"],function(c,b){c.bundle=b;return c})},"url:esri/core/request/iframe.html":'\x3c!DOCTYPE html\x3e\r\n\x3chtml\x3e\r\n\x3chead\x3e\r\n  \x3cmeta http-equiv\x3d"Content-Security-Policy" content\x3d"default-src \'none\'; script-src * \'unsafe-inline\'"\x3e\r\n\r\n  \x3cscript\x3e\r\n    var dojoConfig \x3d {\r\n      async: true,\r\n      baseUrl: "../../../dojo/",\r\n      has: {\r\n        "csp-restrictions": true,\r\n        "dojo-preload-i18n-Api": false\r\n      }\r\n    };\r\n  \x3c/script\x3e\r\n  \x3c!--\r\n  This src is relative to this page and assumes dojo is a sibling to esri.\r\n  It is updated when this file is set as the iframe\'s `srcdoc` value.\r\n  --\x3e\r\n  \x3cscript src\x3d"../../../dojo/dojo.js"\x3e\x3c/script\x3e\r\n\r\n  \x3cscript\x3e\r\n    function windowMessageHandler(event) {\r\n      window.removeEventListener("message", windowMessageHandler);\r\n\r\n      var port \x3d event.ports[0];\r\n\r\n      require([\r\n        "dojo/request/script"\r\n      ], function(script) {\r\n        port.postMessage("ready");\r\n\r\n        port.addEventListener("message", function(event) {\r\n          var data \x3d event.data;\r\n          script.get(data.url, data.options)\r\n              .then(function(response) {\r\n                port.postMessage({\r\n                  id: data.id,\r\n                  response: response\r\n                });\r\n              })\r\n              .otherwise(function(error) {\r\n                port.postMessage({\r\n                  id: data.id,\r\n                  isError: true,\r\n                  message: error.message\r\n                });\r\n              });\r\n        });\r\n        port.start();\r\n      });\r\n    }\r\n\r\n    window.addEventListener("message", windowMessageHandler);\r\n  \x3c/script\x3e\r\n\x3c/head\x3e\r\n\x3cbody\x3e\r\n\x3c/body\x3e\r\n\x3c/html\x3e\r\n',
"url:dijit/templates/Dialog.html":'\x3cdiv class\x3d"dijitDialog" role\x3d"dialog" aria-labelledby\x3d"${id}_title"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"titleBar" class\x3d"dijitDialogTitleBar"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"titleNode" class\x3d"dijitDialogTitle" id\x3d"${id}_title"\r\n\t\t\t\trole\x3d"heading" level\x3d"1"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"closeButtonNode" class\x3d"dijitDialogCloseIcon" data-dojo-attach-event\x3d"ondijitclick: onCancel" title\x3d"${buttonCancel}" role\x3d"button" tabindex\x3d"-1"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"closeText" class\x3d"closeText" title\x3d"${buttonCancel}"\x3ex\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitDialogPaneContent"\x3e\x3c/div\x3e\r\n\t${!actionBarTemplate}\r\n\x3c/div\x3e\r\n\r\n',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/form/templates/ComboButton.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tcellspacing\x3d\'0\' cellpadding\x3d\'0\' role\x3d"presentation"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonNode" data-dojo-attach-point\x3d"buttonNode" data-dojo-attach-event\x3d"ondijitclick:__onClick,onkeydown:_onButtonKeyDown"\r\n\t\t\x3e\x3cdiv id\x3d"${id}_button" class\x3d"dijitReset dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInline dijitButtonText" id\x3d"${id}_label" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd id\x3d"${id}_arrow" class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\r\n\t\t\tdata-dojo-attach-point\x3d"_popupStateNode,focusNode,_buttonNode"\r\n\t\t\tdata-dojo-attach-event\x3d"onkeydown:_onArrowKeyDown"\r\n\t\t\ttitle\x3d"${optionsTitle}"\r\n\t\t\trole\x3d"button" aria-haspopup\x3d"true"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitArrowButtonInner" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitArrowButtonChar" role\x3d"presentation"\x3e\x26#9660;\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd style\x3d"display:none !important;"\r\n\t\t\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" data-dojo-attach-point\x3d"valueNode"\r\n\t\t\t\tclass\x3d"dijitOffScreen" aria-hidden\x3d"true" data-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\t/\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/HomeButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_homeNode" title\x3d"${_i18n.widgets.homeButton.home.title}" role\x3d"button" class\x3d"${_css.home}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.homeButton.home.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"*now":function(c){c(['dojo/i18n!*preload*arcgisonline/nls/viewer*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},
"*noref":1}});
define("arcgisonline/viewer",["dojo","dijit","dojox","dojo/require!esri/map,esri/dijit/Attribution,esri/IdentityManager,esri/SnappingManager,esri/tasks/identify,esri/tasks/geometry,esri/layers/FeatureLayer,esri/layers/CSVLayer,esri/layers/KMLLayer,esri/layers/GeoRSSLayer,esri/layers/WebTiledLayer,esri/layers/StreamLayer,esri/layers/osm,esri/layers/VectorTileLayer,esri/layers/wms,esri/layers/wmts,esri/layers/WFSLayer,esri/layers/ArcGISImageServiceVectorLayer,esri/tasks/locator,esri/virtualearth/VEGeocoder,esri/virtualearth/VETiledLayer,esri/dijit/editing/Editor,esri/dijit/editing/TemplatePicker,esri/dijit/Directions,esri/dijit/Geocoder,esri/dijit/OverviewMap,esri/dijit/Scalebar,esri/dijit/Legend,esri/dijit/TimeSlider,esri/dijit/MultidimensionalSlider,esri/dijit/BasemapGallery,esri/dijit/Popup,esri/dijit/HomeButton,esri/dijit/LocateButton,esri/dijit/Search"],function(c,
b,a){c.provide("arcgisonline.viewer");c.require("esri.map");c.require("esri.dijit.Attribution");c.require("esri.IdentityManager");c.require("esri.SnappingManager");c.require("esri.tasks.identify");c.require("esri.tasks.geometry");c.require("esri.layers.FeatureLayer");c.require("esri.layers.CSVLayer");c.require("esri.layers.KMLLayer");c.require("esri.layers.GeoRSSLayer");c.require("esri.layers.WebTiledLayer");c.require("esri.layers.StreamLayer");c.require("esri.layers.osm");c.require("esri.layers.VectorTileLayer");
c.require("esri.layers.wms");c.require("esri.layers.wmts");c.require("esri.layers.WFSLayer");c.require("esri.layers.ArcGISImageServiceVectorLayer");c.require("esri.tasks.locator");c.require("esri.virtualearth.VEGeocoder");c.require("esri.virtualearth.VETiledLayer");c.require("esri.dijit.editing.Editor");c.require("esri.dijit.editing.TemplatePicker");c.require("esri.dijit.Directions");c.require("esri.dijit.Geocoder");c.require("esri.dijit.OverviewMap");c.require("esri.dijit.Scalebar");c.require("esri.dijit.Legend");
c.require("esri.dijit.TimeSlider");c.require("esri.dijit.MultidimensionalSlider");c.require("esri.dijit.BasemapGallery");c.require("esri.dijit.Popup");c.require("esri.dijit.HomeButton");c.require("esri.dijit.LocateButton");c.require("esri.dijit.Search")});